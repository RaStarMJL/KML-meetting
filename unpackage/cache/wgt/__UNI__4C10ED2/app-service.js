if("undefined"==typeof Promise||Promise.prototype.finally||(Promise.prototype.finally=function(e){const t=this.constructor;return this.then((n=>t.resolve(e()).then((()=>n))),(n=>t.resolve(e()).then((()=>{throw n}))))}),"undefined"!=typeof uni&&uni&&uni.requireGlobal){const e=uni.requireGlobal();ArrayBuffer=e.ArrayBuffer,Int8Array=e.Int8Array,Uint8Array=e.Uint8Array,Uint8ClampedArray=e.Uint8ClampedArray,Int16Array=e.Int16Array,Uint16Array=e.Uint16Array,Int32Array=e.Int32Array,Uint32Array=e.Uint32Array,Float32Array=e.Float32Array,Float64Array=e.Float64Array,BigInt64Array=e.BigInt64Array,BigUint64Array=e.BigUint64Array}uni.restoreGlobal&&uni.restoreGlobal(Vue,weex,plus,setTimeout,clearTimeout,setInterval,clearInterval),function(e){"use strict";var t,n,o,i,s;function a(e){const t=Object.create(null,{[Symbol.toStringTag]:{value:"Module"}});if(e)for(const n in e)if("default"!==n){const o=Object.getOwnPropertyDescriptor(e,n);Object.defineProperty(t,n,o.get?o:{enumerable:!0,get:()=>e[n]})}return t.default=e,Object.freeze(t)}const r=a(e),c=function(e){switch(typeof e){case"string":return e;case"boolean":return e?"true":"false";case"number":return isFinite(e)?e:"";default:return""}};function u(e){if("string"==typeof e)return e;const{path:t,query:n}=e,o=function(e,t="&",n="=",o){return null===e&&(e=void 0),"object"==typeof e?Object.keys(e).map((o=>{const i=c(o)+n;return Array.isArray(e[o])?e[o].map((e=>i+c(e))).join(t):i+c(e[o])})).filter(Boolean).join(t):o?c(o)+n+c(e):""}(n);return o?`${t}?${o}`:t}function l(e){const t=e||{},n=t.route;return{page:`/${n}`,params:{},query:t.query,hash:"",fullPath:u({path:`/${n}`,query:t.query}),name:n&&n.replace(/\/(\w)/g,((e,t)=>t.toUpperCase()))}}uni.onAppRoute&&uni.onAppRoute((()=>{const e=getCurrentPages(),t=e[e.length-1];d.setRoute(l(t))}));const d=new class{constructor(){this.route={}}setRoute(e){this.route=e}static useRoute(){return d.route}};const p=new class{push(e,t,n,o){const i={url:u(e),complete:t,fail:n,success:o};(null==e?void 0:e.isTab)&&uni.switchTab(i),(null==e?void 0:e.reLaunch)&&uni.reLaunch(i),uni.navigateTo(i)}replace(e,t,n,o){const i={url:u(e),complete:t,fail:n,success:o};d.setRoute(l(e)),uni.setStorageSync("routeInfo",l(e)),uni.redirectTo(i)}go(e){uni.navigateBack(e)}back(){uni.navigateBack()}},h=e.defineComponent({__name:"index",setup:t=>(e.onMounted((()=>{p.replace({path:"/src/roomkit/pages/home"}),uni.showToast({icon:"loading"})})),(t,n)=>(e.openBlock(),e.createElementBlock("div")))});function g(e){return weex.requireModule(e)}function _(e,t,...n){uni.__log__?uni.__log__(e,t,...n):console[e].apply(console,[...n,t])}const f=t=>(n,o=e.getCurrentInstance())=>{!e.isInSSRComponentSetup&&e.injectHook(t,n,o)},m=f("onLoad"),v=f("onReady"),y=f("onUnload"),I=f("onNavigationBarButtonTap");var M="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function C(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var T={exports:{}};T.exports=function(){function e(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)),o}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,n){return(d=l()?Reflect.construct:function(e,t,n){var o=[null];return o.push.apply(o,t),t=new(Function.bind.apply(e,o)),n&&u(t,n.prototype),t}).apply(null,arguments)}function p(e){var t="function"==typeof Map?new Map:void 0;return function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return d(e,arguments,c(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),u(n,e)}(e)}function h(e,t){if(null==e)return{};var n,o=function(e,t){if(null==e)return{};for(var n,o={},i=Object.keys(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function g(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function f(e){var t=l();return function(){var n,o=c(e);if(n=t?(n=c(this).constructor,Reflect.construct(o,arguments,n)):o.apply(this,arguments),o=this,n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return g(o)}}function m(e,t){return y(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,s=[],a=!0,r=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(s.push(o.value),!t||s.length!==t);a=!0);}catch(c){r=!0,i=c}finally{try{a||null==n.return||n.return()}finally{if(r)throw i}}return s}}(e,t)||C(e,t)||E()}function v(e){return function(e){if(Array.isArray(e))return T(e)}(e)||I(e)||C(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function y(e){if(Array.isArray(e))return e}function I(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function C(e,t){if(e){if("string"==typeof e)return T(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?T(e,t):void 0}}function T(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function E(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function S(e,t){var n,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=C(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==o.return||o.return()}finally{if(a)throw i}}}}var D={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",ALL_RECEIVE_MESSAGE_OPT_UPDATED:"onAllReceiveMessageOptUpdated"},k={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_LIVE:"Live",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_MSG_EXCEPT_AT:"NotReceiveMsgExceptAt",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3,IOS_OFFLINE_PUSH_NO_SOUND:"push.no_sound",IOS_OFFLINE_PUSH_DEFAULT_SOUND:"default"},R={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},L=(s(B,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),B),A=(s(q,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),q),O={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",IPV6:"wss://wssv6.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT0:"wss://*w4s.my-imcloud.com",DEFAULT:"wss://wsssgp.im.qcloud.com",IPV6:"wss://wsssgpv6.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT0:"wss://*w4k.my-imcloud.com",DEFAULT:"wss://wsskr.im.qcloud.com",IPV6:"wss://wsskrv6.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT0:"wss://*w4g.my-imcloud.com",DEFAULT:"wss://wssger.im.qcloud.com",IPV6:"wss://wssgerv6.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT0:"wss://*w4i.my-imcloud.com",DEFAULT:"wss://wssind.my-imcloud.com",IPV6:"wss://wssindv6.im.qcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.19.46"},JPN:{DEFAULT0:"wss://*w4j.my-imcloud.com",DEFAULT:"wss://wssjpn.im.qcloud.com",IPV6:"wss://wssjpnv6.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT0:"wss://*w4u.my-imcloud.com",DEFAULT:"wss://wssusa.im.qcloud.com",IPV6:"wss://wssusav6.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT0:"wss://*w4y.my-imcloud.com",DEFAULT:"wss://wssidn.im.qcloud.com",IPV6:"wss://wssidnv6.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},N={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19,NS_NATIVE_APP:20,RN_NATIVE_APP:21},P="1.7.3",b=537048168,U="CHINA",G={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=O.PRODUCTION[0<arguments.length&&void 0!==arguments[0]?arguments[0]:U]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",GRP_SEARCH:"group_search",GRP_MEMBER_SEARCH:"group_member_search",USER_SEARCH:"user_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},w={SEARCH_GRP_SNS:new A(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new A(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new A(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new A(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new A(0,Math.pow(2,6)).toString(),USER_STATUS:new A(0,Math.pow(2,7)).toString(),CONV_MARK:new A(0,Math.pow(2,9)).toString(),CONV_GROUP:new A(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new A(0,Math.pow(2,11)).toString(),MSG_EXT:new A(0,Math.pow(2,13)).toString(),GRP_COUNTER:new A(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new A(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new A(Math.pow(2,7)).toString(),PLUGIN_CS:new A(Math.pow(2,8)).toString(),PLUGIN_PUSH:new A(Math.pow(2,9)).toString(),PLUGIN_BOT:new A(Math.pow(2,10)).toString(),MSG_REACTION:new A(Math.pow(2,16)).toString(),FOLLOW:new A(Math.pow(2,20)).toString()},F="group_profile",x=["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],V=["Role","JoinTime","MsgSeq","MsgFlag"];function q(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;o(this,q),this.high=e,this.low=t}function B(){o(this,B),this.cache=[],this.options=null}G.HOST.setCurrent(U);for(var H,j="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),K=j&&"function"==typeof wx.createGamePortal,Y="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),z="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),W="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),J="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),$="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,X="undefined"!=typeof uni&&"undefined"==typeof window&&!0,Z=j&&"object"===n(wx.miniapp),Q="undefined"!=typeof uni,ee=j||Y||z||W||J||X||$,te="undefined"==typeof window&&!ee&&void 0!==M&&void 0!==M.NativeScriptGlobals,ne=void 0!==M&&(void 0!==M.nativeModuleProxy||void 0!==M.ReactNative),oe="undefined"!=typeof uni?!ee:"undefined"!=typeof window&&!ee&&!ne,ie=Y?qq:z?tt:W?swan:J?my:j?wx:X?uni:$?jd:{},se=oe&&window&&window.navigator&&window.navigator.userAgent||"",ae=($="WEB",/(micromessenger|webbrowser)/i.test(se)?$="WEB":Y?$="QQ_MP":z?$="TT_MP":W?$="BAIDU_MP":J?$="ALI_MP":j?$=Z?"DONUT_NATIVE_APP":"WX_MP":X?$="UNI_NATIVE_APP":te?$="NS_NATIVE_APP":ne&&($="RN_NATIVE_APP"),N[$]),re=(Z=/iPad/i.test(se),te=/iPhone/i.test(se)&&!Z,$=/iPod/i.test(se),te||Z||$),ce=(te=se.match(/OS (\d+)_/i))&&te[1]?te[1]:null,ue=/Android/i.test(se),le=function(){var e=se.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),de=($=!(Z=/Edge/i.test(se))&&/Chrome/i.test(se),/MSIE/.test(se)||-1<se.indexOf("Trident")&&-1<se.indexOf("rv:11.0")),pe=te=!(te=(te=/MSIE\s(\d+)\.\d/.exec(se))&&parseFloat(te[1]))&&/Trident\/7.0/i.test(se)&&/rv:11.0/.test(se)?11:te,he=/Safari/i.test(se)&&!$&&!ue&&!Z,ge=/Windows/i.test(se),_e=/MAC OS X/i.test(se),fe=oe&&"undefined"!=typeof Worker&&!de,me=ue||re,ve=oe&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy,ye=function(){if("undefined"==typeof window||void 0===window.navigator)return!1;var e=window.navigator.standalone;return!(!re||e||he)}(),Ie="undefined"!=typeof console?console:void 0!==M&&M.console?M.console:"undefined"!=typeof window&&window.console?window.console:{},Me=function(){},Ce=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Te=Ce.length;Te--;)H=Ce[Te],console[H]||(Ie[H]=Me);function Ee(){var e=new Date;return e.setTime(Le()),e}function Se(){Re=0}function De(){return Math.floor(Le()/1e3)}var ke=Ie,Re=0,Le=function(){return(new Date).getTime()+Re},Ae=0;function Oe(){return Kt()?"%c Chat %c":"Chat"}function Ne(){var e=Ee();return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}var Pe={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,o=e.length;n<o;n++){if(gt(e[n]))try{t+=_t(e[n])?JSON.stringify(e[n],["message","code"]):JSON.stringify(e[n])}catch(i){t+=i?i.message:"";break}else t+=e[n];t+=" "}return t},_exec:function(e,t){Kt()?ke[e](Oe(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Ne(),t):ke[e]("".concat(Oe()," ").concat(Ne()," ").concat(t))},d:function(){var e;Ae<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;Ae<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;Ae<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;Ae<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;Ae<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;Ae<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+Ae+" to "+e),Ae=e},getLevel:function(){return Ae}},be={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Ue={NICK:"".concat(te="Tag_Profile_IM_","Nick"),GENDER:"".concat(te,"Gender"),BIRTHDAY:"".concat(te,"BirthDay"),LOCATION:"".concat(te,"Location"),SELFSIGNATURE:"".concat(te,"SelfSignature"),ALLOWTYPE:"".concat(te,"AllowType"),LANGUAGE:"".concat(te,"Language"),AVATAR:"".concat(te,"Image"),MESSAGESETTINGS:"".concat(te,"MsgSettings"),ADMINFORBIDTYPE:"".concat(te,"AdminForbidType"),LEVEL:"".concat(te,"Level"),ROLE:"".concat(te,"Role")},Ge={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},we={UNKNOWN:"".concat($="Gender_Type_","Unknown"),FEMALE:"".concat($,"Female"),MALE:"".concat($,"Male")},Fe={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},xe={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},Ve="JoinedSuccess",qe="WaitAdminApproval",Be="@TOPIC#_",He=Object.prototype.hasOwnProperty;function je(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if($e(e)){for(var t in e)if(He.call(e,t))return!1;return!0}return!!(Ke(e)||Ye(e)||ze(e))&&0===e.size}function Ke(e){return"map"===ft(e)}function Ye(e){return"set"===ft(e)}function ze(e){return"file"===ft(e)}function We(e){return null!==e&&("number"==typeof e&&!isNaN(+e)||"object"===n(e)&&e.constructor===Number)}function Je(e){return null!==e&&"object"===n(e)}function $e(e){if("object"===n(e)&&null!==e){if(null===(e=Object.getPrototypeOf(e)))return 1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return e===t}}function Xe(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===ft(e)}function Ze(e){return Xe(e)&&0<e.length}function Qe(e){return"function"==typeof e}function et(e){return"filelist"===ft(e)}function nt(e){return"string"==typeof e&&(e=e[0],!/[^a-zA-Z0-9]/.test(e))}function ot(e,t,n,o){if(!gt(e)||!gt(t))return 0;for(var i,s=0,a=Object.keys(t),r=0,c=a.length;r<c;r++)if(i=a[r],!(ht(t[i])||n&&n.includes(i)))if(gt(e[i])&&gt(t[i]))s+=ot(e[i],t[i],n,o);else{if(o&&o.includes(t[i]))continue;e[i]!==t[i]&&(e[i]=t[i],s+=1)}return s}function it(e,t){var n,o=new Map,i=S(e.entries());try{for(i.s();!(n=i.n()).done;){var s=m(n.value,2),a=s[0],r=s[1];r&&o.set(a,t?JSON.stringify(r):JSON.parse(JSON.stringify(r)))}}catch(c){i.e(c)}finally{i.f()}return o}function st(e){if(0===e.length)return 0;for(var t=0,n=0,o="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===o?3:2;return n}function at(e){return e=e||99999999,Math.round(Math.random()*e)}function rt(){for(var e="",t=32;0<t;--t)e+=mt[Math.floor(Math.random()*vt)];return e}function ct(e,t){for(var n in e)if(e[n]===t)return 1}function ut(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")}function lt(e){if(0===Object.getOwnPropertyNames(e).length)return Object.create(null);var t,o,i=Array.isArray(e)?[]:Object.create(null);for(o in e)null!==e[o]?void 0!==e[o]?(t=n(e[o]),0<=["string","number","function","boolean"].indexOf(t)?i[o]=e[o]:i[o]=lt(e[o])):i[o]=void 0:i[o]=null;return i}var dt=["url"],pt=function(e){return"string"==typeof e},ht=function(e){return void 0===e},gt=function(e){return Xe(e)||Je(e)},_t=function(e){return e instanceof Error},ft=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},mt=(Date.now||(Date.now=function(){return(new Date).getTime()}),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),vt=mt.length,yt={};function It(e,t){if(!Xe(e)||!Xe(t))return!1;var n=!1;return t.forEach((function(t){var o=t.key,i=(t=t.value,e.find((function(e){return e.key===o})));i?i.value!==t&&(i.value=t,n=!0):(e.push({key:o,value:t}),n=!0)})),n}function Mt(e){return je(e)?[]:e.filter((function(e){return!0===e.isModified}))}function Ct(e){if($e(e)&&$e(e.webhookInfo)){var t=[];if(e.webhookInfo.disableCloudMessagePreHook&&t.push("ForbidBeforeSendMsgCallback"),e.webhookInfo.disableCloudMessagePostHook&&t.push("ForbidAfterSendMsgCallback"),0!==t.length)return t}}function Tt(e){return je(e)?[]:e.filter((function(e){return!1===e.isModified}))}function Et(e){return e===k.GRP_AVCHATROOM}function St(e){var t=e.type;return e=e.groupID,t===k.GRP_COMMUNITY||"".concat(e).startsWith("@TGS#_")&&!"".concat(e).includes(Be)}function Dt(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(Be)}function kt(e){return pt(e)&&e.slice(0,3)===k.CONV_C2C}function Rt(e){return pt(e)&&e.slice(0,5)===k.CONV_GROUP}function Lt(e){return pt(e)&&e===k.CONV_SYSTEM}function At(e,t){var n={};return Object.keys(e).forEach((function(o){n[o]=t(e[o],o)})),n}function Ot(e){return ne?Promise.resolve({width:0,height:0}):ee?new Promise((function(t,n){ie.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):de&&9===pe?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var o=new Image;o.onload=function(){t({width:this.width,height:this.height}),o=null},o.onerror=function(){t({width:0,height:0}),o=null},o.src=e}))}function Nt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function Pt(){var e=ue?"android":re?"ios":ge?"windows":_e?"mac":"unknown";if(ee)try{var t=ie.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function bt(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var i=parseInt(e[o]),s=parseInt(t[o]);if(s<i)return 1;if(i<s)return-1}return 0}function Ut(e){var t=void 0===(t=e.originUrl)?void 0:t,n=e.originWidth,o=e.originHeight,i=(e=void 0===(e=e.min)?198:e,{url:void 0,width:0,height:0});return((n=parseInt(n))<=(o=parseInt(o))?n:o)<=e?(i.url=t,i.width=n,i.height=o):(o<=n?(i.width=Math.ceil(n*e/o),i.height=e):(i.width=e,i.height=Math.ceil(o*e/n)),o=t&&-1<t.indexOf("?")?"".concat(t,"&"):"".concat(t,"?"),i.url="".concat(o,198===e?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),ht(t)?(i.url,h(i,dt)):i}function Gt(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function wt(e){return(e=e.servcmd).slice(e.indexOf(".")+1)}function Ft(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function xt(e,t){return e.includes(t)}function Vt(e,t){return e.includes(t)}function qt(e){return e.split(Be)[0]}var Bt=function(e,t,n){if(ht(t))return"";switch(e){case k.MSG_TEXT:return t.text;case k.MSG_IMAGE:return n?"[Image]":"[图片]";case k.MSG_LOCATION:return n?"[Location]":"[位置]";case k.MSG_AUDIO:return n?"[Voice]":"[语音]";case k.MSG_VIDEO:return n?"[Video]":"[视频]";case k.MSG_FILE:return n?"[File]":"[文件]";case k.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case k.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case k.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case k.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case k.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function Ht(e){return e===k.MSG_TEXT||e===k.MSG_CUSTOM||e===k.MSG_LOCATION||e===k.MSG_FACE}function jt(e){var t=[];if(!pt(e))return t;var n=e.length;if(0===n)return t;for(var o=n-1;0<=o;o--)"1"===e[o]&&t.push(Math.pow(2,n-o-1));return t}function Kt(){return!de&&!ee}function Yt(e){return"the length of userIDList cannot exceed ".concat(e)}function zt(e){var t;if(Xe(e)&&0!==e.length)return t=0,e.forEach((function(e){t+=e})),t.toFixed(0)}function Wt(e){var t;if(Xe(e)&&0!==e.length)return t=0,e.forEach((function(e){t+=e})),(t/e.length).toFixed(0)}function Jt(e,t,n){t=!(1<arguments.length&&void 0!==t)||t,n=!(2<arguments.length&&void 0!==n)||n;var o=Date.now();return t?n?"".concat(o-e," ms"):"".concat(Math.round((o-e)/1e3)," s"):n?o-e:Math.round((o-e)/1e3)}function $t(e){return!!(e&&1<e)}function Xt(e,t,n,o){if(void 0===t)return 1;var i,s,a=!0;return t.required&&je(e)&&(Pe.e("[".concat(n,'] Missing required params: "').concat(o,'".')),a=!1),je(e)||(i=ft(e))!==(s=t.type.toLowerCase())&&("asyncfunction"===i&&"function"===s||(Pe.e("[".concat(n,'] Invalid params: type check failed for "').concat(o,'". Expected ').concat(t.type,".")),a=!1)),t.validator&&!t.validator(e,n,o)&&(Pe.e("[".concat(n,'] Invalid params: custom validator check failed for "').concat(o,'".')),a=!1),a}function Zt(e){return!(!e||!(kt(e)||Rt(e)||Lt(e))&&((e=xn("InvalidConversationID",e))&&Pe.w(e),1))}function Qt(e){""!==e.desc&&""!==xn("API_REFER")&&Pe.w("[".concat(e.api,"] | ").concat(e.paramName," | ").concat(e.desc,", ").concat(xn("API_REFER")).concat(e.api))}function en(){return xn("StringRequiredLog")}function tn(e){return xn("NonEmptyStringRequiredLog",e)}function nn(){return xn("NumberRequiredLog")}function on(){return xn("UndefinedNotAllowedLog")}function sn(){return xn("FileRequiredLog")}function an(){return xn("FunctionRequiredLog")}function rn(){return xn("ArrayRequiredLog")}function cn(){return xn("NonEmptyArrayLog")}function un(){return xn("CallbackMissingLog")}function ln(){return xn("PositiveIntegerRequiredLog")}function dn(e,t){return xn("StringNotLongerThanLog",e,t)}function pn(e,t){return xn("NumberGreaterThanLog",e,t)}function hn(e,t){return xn("NumberGreaterOrEqualLog",e,t)}function gn(e){return xn("KeyValueStringRequiredLog",e)}function _n(){return xn("PlainObjectRequiredLog")}function fn(){return xn("NonEmptyContentRequiredLog")}function mn(){return xn("FileNotSelectedLog")}function vn(){return xn("MessageInstanceRequiredLog")}function yn(){return xn("NonAnonymousFunctionLog")}function In(){return xn("MessageExtensionNotAvailableLog")}function Mn(){return xn("MessageReactionRequiredLog")}function Cn(e,t){return xn("ContainsUnsupportedTypeLog",e,t)}function Tn(e,t,n,o){var i=o.allowUndefined,s=o.allowEmpty;return o=o.maxLength,ht(e)?!!i||(Qt({api:t,paramName:n,desc:on()}),!1):Xe(e)?!(0===e.length&&(Qt({api:t,paramName:n,desc:cn()}),!s)||o&&e.length>o&&(Qt({api:t,paramName:n,desc:xn("MaximumArrayLengthLog",n,o)}),1)):(Qt({api:t,paramName:n,desc:rn()}),!1)}function En(e,t,n,o){var i=o.allowUndefined,s=o.min;return o=o.max,ht(e)?!!i||(Qt({api:t,paramName:n,desc:on()}),!1):We(e)?We(s)&&e<s?(Qt({api:t,paramName:n,desc:0===s?hn(n,s):pn(n,s-1)}),!1):!(We(o)&&o<e&&(Qt({api:t,paramName:n,desc:xn("MaximumNumberLog",n,o)}),1)):(Qt({api:t,paramName:n,desc:nn()}),!1)}function Sn(e){return{code:0,data:e||{}}}function Dn(e){return Promise.resolve(Sn(e))}function kn(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e instanceof Bn)return t&&null!==jn&&jn.emit(D.ERROR,e),Promise.reject(e);if(e instanceof Error)return n=new Bn({code:Hn.UNCAUGHT_ERROR}),t&&null!==jn&&jn.emit(D.ERROR,n),Promise.reject(n);if(ht(e)||ht(e.code))return Promise.reject(new Bn({code:Hn.UNCAUGHT_ERROR}));var n=new Bn(e);return t&&null!==jn&&jn.emit(D.ERROR,n),Promise.reject(n)}var Rn,Ln="unSend",An="success",On="fail",Nn="notStart",Pn="pending",bn="resolved",Un="rejected",Gn={type:"Boolean",required:!0},wn={type:"number",required:!0},Fn={keywordListForMsg:{type:"Array",required:!1,validator:function(e,t,n){return Tn(e,t,n,{allowUndefined:!0,allowEmpty:!0,maxLength:5})}},keywordListExceptMsg:{type:"Array",required:!0,validator:function(e,t,n){return Tn(e,t,n,{allowUndefined:!1,allowEmpty:!1,maxLength:5})}},keywordListMatchType:{type:"String",required:!1,validator:function(e,t,n){return!e||"or"===e||"and"===e||Qt({api:t,paramName:n,desc:"".concat(e," is invalid match type")})}},cursor:{type:"String",required:!1},count:{type:"Number",required:!1,validator:function(e,t,n){return En(e,t,n,{allowUndefined:!0,min:1,max:100})}},groupTypeList:{type:"Array",required:!1,validator:function(e,t,n){if(!e)return!0;if(!Tn(e,t,n,{allowUndefined:!0,allowEmpty:!0}))return!1;var o=[k.GRP_PUBLIC,k.GRP_COMMUNITY,k.GRP_WORK,k.GRP_MEETING];return!(0<e.filter((function(e){return-1===o.indexOf(e)})).length&&(Qt({api:t,paramName:n,desc:Cn(n,"group")}),1))}}},xn=null,Vn={hookGetAPITips:function(e){xn=e},login:{userID:Z={type:"String",required:!0},userSig:Z},addToBlacklist:{userIDList:te={type:"Array",required:!0}},removeFromBlacklist:{userIDList:te},on:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Qt({api:t,paramName:n,desc:tn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Qt({api:t,paramName:n,desc:an()}),!1):(""===e.name&&Qt({api:t,paramName:n,desc:yn()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Qt({api:t,paramName:n,desc:tn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Qt({api:t,paramName:n,desc:an()}),!1):(""===e.name&&Qt({api:t,paramName:n,desc:yn()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Qt({api:t,paramName:n,desc:tn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Qt({api:t,paramName:n,desc:an()}),!1):(""===e.name&&Qt({api:t,paramName:n,desc:yn()}),!0)}}],sendMessage:[t({name:"message"},$={type:"Object",required:!0})],setMessageExtensions:[t(t({name:"message"},$),{},{validator:function(e,t,n){return e.status===An&&!0===e.isSupportExtension||(Qt({api:t,paramName:n,desc:In()}),!1)}}),t({name:"extensions"},te)],getMessageExtensions:[t(t({name:"message"},$),{},{validator:function(e,t,n){return e.status===An&&!0===e.isSupportExtension||(Qt({api:t,paramName:n,desc:In()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},$),{},{validator:function(e,t,n){return e.status===An&&!0===e.isSupportExtension||(Qt({api:t,paramName:n,desc:In()}),!1)}})],addMessageReaction:[t(t({name:"message"},$),{},{validator:function(e,t,n){return e.status===An||(Qt({api:t,paramName:n,desc:Mn()}),!1)}}),t({name:"reactionID"},Z)],removeMessageReaction:[t(t({name:"message"},$),{},{validator:function(e,t,n){return e.status===An||(Qt({api:t,paramName:n,desc:Mn()}),!1)}}),t({name:"reactionID"},Z)],getMessageReactions:{messageList:t({},te)},getAllUserListOfMessageReaction:{message:t(t({},$),{},{validator:function(e,t,n){return e.status===An||(Qt({api:t,paramName:n,desc:Mn()}),!1)}}),reactionID:t({},Z),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:t(t({},Z),{},{validator:Zt}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e,t,n){return!(!ht(e)&&!/^[1-9][0-9]*$/.test(e)&&(Qt({api:t,paramName:n,desc:ln()}),1))}}},getMessageListHopping:{conversationID:t(t({},Z),{},{validator:Zt}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e,t,n){return!(!ht(e)&&0!==e&&1!==e&&(Qt({api:t,paramName:n,desc:xn("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e,t,n){return!(!ht(e)&&!/^[1-9][0-9]*$/.test(e)&&(Qt({api:t,paramName:n,desc:ln}),1))}}},setMessageRead:{conversationID:t(t({},Z),{},{validator:Zt})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e,t,n){return!e||-1!==[k.READ_ALL_C2C_MSG,k.READ_ALL_GROUP_MSG,k.READ_ALL_MSG].indexOf(e)||(Qt({api:t,paramName:n,desc:xn("ValidScopeRequired")}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},Z),{},{validator:Zt})],clearHistoryMessage:[t(t({name:"conversationID"},Z),{},{validator:Zt})],pinConversation:{conversationID:t(t({},Z),{},{validator:Zt}),isPinned:t({},Gn)},setConversationDraft:{conversationID:t(t({},Z),{},{validator:Zt}),draftText:{type:"String",validator:function(e,t,n){return!!pt(e)||(Qt({api:t,paramName:n,desc:en()}),!1)}}},setConversationCustomData:{conversationIDList:t({},te),customData:{type:"String",validator:function(e,t,n){return pt(e)?!(256<e.length&&(Qt({api:t,paramName:n,desc:dn(n,256)}),1)):(Qt({api:t,paramName:n,desc:en()}),!1)}}},markConversation:{conversationIDList:t({},te),markType:{type:"number",validator:function(e,t,n){return We(e)?e<=0?(Qt({api:t,paramName:n,desc:pn(n,0)}),!1):!(e>=Math.pow(2,64)&&(Qt({api:t,paramName:n,desc:xn("NumberLessThanLog",n,"Math.pow(2,64)")}),1)):(Qt({api:t,paramName:n,desc:nn()}),!1)}},enableMark:t({},Gn)},createConversationGroup:{conversationIDList:t({},te),groupName:t(t({},Z),{},{validator:function(e,t,n){return!(!e||32<e.length&&(Qt({api:t,paramName:n,desc:dn(n,32)}),1))}})},deleteConversationGroup:[t({name:"groupName"},Z)],renameConversationGroup:{oldName:t({},Z),newName:t(t({},Z),{},{validator:function(e,t,n){return!(!e||32<e.length&&(Qt({api:t,paramName:n,desc:dn(n,32)}),1))}})},addConversationsToGroup:{conversationIDList:t({},te),groupName:t({},Z)},deleteConversationsFromGroup:{conversationIDList:t({},te),groupName:t({},Z)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Z,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:te},createGroup:{name:Z},joinGroup:{groupID:Z,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},Z)],handleApplication:{message:$,handleAction:Z,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Z,newOwnerID:Z},updateGroupProfile:{groupID:Z,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},Z)],searchGroupByID:[t({name:"groupID"},Z)],getGroupOnlineMemberCount:[t({name:"groupID"},Z)],initGroupAttributes:{groupID:Z,groupAttributes:t(t({},$),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach((function(i){if(!pt(e[i]))return Qt({api:t,paramName:n,desc:gn("value")}),o=!1})),o}})},setGroupAttributes:{groupID:Z,groupAttributes:t(t({},$),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach((function(i){if(!pt(e[i]))return Qt({api:t,paramName:n,desc:gn("value")}),o=!1})),o}})},deleteGroupAttributes:{groupID:Z,keyList:{type:"Array",validator:function(e,t,n){return ht(e)||!Xe(e)?(Qt({api:t,paramName:n,desc:rn()}),!1):!!je(e)||(o=!0,e.forEach((function(e){if(!pt(e))return Qt({api:t,paramName:n,desc:xn("StringArrayRequiredLog")}),o=!1})),o);var o}}},getGroupAttributes:{groupID:Z,keyList:{type:"Array",validator:function(e,t,n){return ht(e)||!Xe(e)?(Qt({api:t,paramName:n,desc:rn()}),!1):!!je(e)||(o=!0,e.forEach((function(e){if(!pt(e))return Qt({api:t,paramName:n,desc:gn("key")}),o=!1})),o);var o}}},setGroupCounters:{groupID:Z,counters:$},increaseGroupCounter:{groupID:Z,key:Z,value:wn},decreaseGroupCounter:{groupID:Z,key:Z,value:wn},getGroupCounters:{groupID:Z},getGroupMemberList:{groupID:Z,count:{type:"Number"}},getGroupMemberProfile:{groupID:Z,userIDList:te,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:Z,userIDList:te},setGroupMemberRole:{groupID:Z,userID:Z,role:Z},setGroupMemberMuteTime:{groupID:Z,userID:Z,muteTime:{type:"Number",validator:function(e){return 0<=e}}},setGroupMemberNameCard:{groupID:Z,userID:{type:"String"},nameCard:{type:"String",validator:function(e,t,n){return pt(e)?(e.length,!0):(Qt({api:t,paramName:n,desc:en()}),!1)}}},setGroupMemberCustomField:{groupID:Z,userID:{type:"String"},memberCustomField:te},deleteGroupMember:{groupID:Z},markGroupMemberList:{groupID:Z,markType:{type:"number",validator:function(e,t,n){return We(e)?!(e<1e3&&(Qt({api:t,paramName:n,desc:hn(n,1e3)}),1)):(Qt({api:t,paramName:n,desc:nn()}),!1)}},userIDList:t({},te),enableMark:t({},Gn)},createTextMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){return $e(e)?pt(e.text)?0!==e.text.length||(Qt({api:t,paramName:"payload.text",desc:fn()}),!1):(Qt({api:t,paramName:"payload.text",desc:en()}),!1):(Qt({api:t,paramName:n,desc:_n()}),!1)}})},createTextAtMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){return $e(e)?pt(e.text)?0===e.text.length?(Qt({api:t,paramName:"payload.text",desc:fn()}),!1):!(e.atUserList&&!Xe(e.atUserList)&&(Qt({api:t,paramName:"payload.atUserList",desc:rn()}),1)):(Qt({api:t,paramName:"payload.text",desc:en()}),!1):(Qt({api:t,paramName:n,desc:_n()}),!1)}})},createCustomMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){return $e(e)?e.data&&!pt(e.data)?(Qt({api:t,paramName:"payload.data",desc:en()}),!1):e.description&&!pt(e.description)?(Qt({api:t,paramName:"payload.description",desc:en()}),!1):!(e.extension&&!pt(e.extension)&&(Qt({api:t,paramName:"payload.extension",desc:en()}),1)):(Qt({api:t,paramName:"payload",desc:_n()}),!1)}})},createImageMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){if(!$e(e))return Qt({api:t,paramName:n,desc:_n()}),!1;if(ht(e.file))return Qt({api:t,paramName:"payload.file",desc:on()}),!1;if(oe){if(!(e.file instanceof HTMLInputElement||ze(e.file)))return $e(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Qt({api:t,paramName:"payload.file",desc:mn()}),!1):(Qt({api:t,paramName:"payload.file",desc:sn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Qt({api:t,paramName:"payload.file",desc:mn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:un()}),!0}}})},createAudioMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){return!!$e(e)||(Qt({api:t,paramName:n,desc:_n()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:un()}),!0}}},createVideoMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){if(!$e(e))return Qt({api:t,paramName:n,desc:_n()}),!1;if(ht(e.file))return Qt({api:t,paramName:"payload.file",desc:on()}),!1;if(oe){if(!(e.file instanceof HTMLInputElement||ze(e.file)))return $e(e.file)&&"undefined"!=typeof uni?!!ze(e.file.tempFile)||(Qt({api:t,paramName:"payload.file",desc:mn()}),!1):(Qt({api:t,paramName:"payload.file",desc:sn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Qt({api:t,paramName:"payload.file",desc:mn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:un()}),!0}}},createFaceMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){return $e(e)?We(e.index)?!!pt(e.data)||(Qt({api:t,paramName:"payload.data",desc:en()}),!1):(Qt({api:t,paramName:"payload.index",desc:nn()}),!1):(Qt({api:t,paramName:n,desc:_n()}),!1)}})},createFileMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){if(!$e(e))return Qt({api:t,paramName:n,desc:_n()}),!1;if(ht(e.file))return Qt({api:t,paramName:"payload.file",desc:on()}),!1;if(oe){if(!(e.file instanceof HTMLInputElement||ze(e.file)))return $e(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Qt({api:t,paramName:"payload.file",desc:mn()}),!1):(Qt({api:t,paramName:"payload.file",desc:sn()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Qt({api:t,paramName:"payload.file",desc:mn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:un()}),!0}}},createLocationMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){return $e(e)?pt(e.description)?We(e.longitude)?!!We(e.latitude)||(Qt({api:t,paramName:"payload.latitude",desc:nn()}),!1):(Qt({api:t,paramName:"payload.longitude",desc:nn()}),!1):(Qt({api:t,paramName:"payload.description",desc:en()}),!1):(Qt({api:t,paramName:n,desc:_n()}),!1)}})},createMergerMessage:{to:Z,conversationType:Z,payload:t(t({},$),{},{validator:function(e,t,n){if(je(e.messageList))return Qt({api:t,paramName:"payload.messageList",desc:cn()}),!1;if(je(e.compatibleText))return Qt({api:t,paramName:"payload.compatibleText",desc:tn("compatibleText")}),!1;var o=!1;return e.messageList.forEach((function(e){e.status===On&&(o=!0)})),!o||(Qt({api:t,paramName:"payload.messageList",desc:xn("MergeFailedMessageLog")}),!1)}})},revokeMessage:[t(t({name:"message"},$),{},{validator:function(e,t,n){return je(e)?(Qt({api:t,paramName:n,desc:vn()}),!1):e.conversationType===k.CONV_SYSTEM?(Qt({api:t,paramName:n,desc:xn("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(Qt({api:t,paramName:n,desc:xn("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},te),{},{validator:function(e,t,n){return!je(e)||(Qt({api:t,paramName:n,desc:cn()}),!1)}})],translateText:{sourceTextList:te,sourceLanguage:Z,targetLanguage:Z},convertVoiceToText:{message:t(t({},$),{},{validator:function(e,t,n){return je(e)?(Qt({api:t,paramName:n,desc:vn()}),!1):e.type===k.MSG_AUDIO&&e.status===An||(Qt({api:t,paramName:n,desc:xn("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[t(t({name:"message"},$),{},{validator:function(e,t,n){return je(e)?(Qt({api:t,paramName:n,desc:vn()}),!1):e.conversationType===k.CONV_SYSTEM?(Qt({api:t,paramName:n,desc:xn("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(Qt({api:t,paramName:n,desc:xn("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:Fn.keywordListForMsg,keywordListMatchType:Fn.keywordListMatchType,cursor:Fn.cursor,senderUserIDList:{type:"Array",required:!1,validator:function(e,t,n){return Tn(e,t,n,{allowUndefined:!0,allowEmpty:!0,maxLength:5})}},messageTypeList:{type:"Array",required:!1,validator:function(e,t,n){if(!e)return!0;if(!Tn(e,t,n,{allowUndefined:!0,allowEmpty:!0}))return!1;var o=[k.MSG_TEXT,k.MSG_IMAGE,k.MSG_AUDIO,k.MSG_FILE,k.MSG_VIDEO,k.MSG_LOCATION,k.MSG_CUSTOM,k.MSG_MERGER];return!(0<e.filter((function(e){return-1===o.indexOf(e)})).length&&(Qt({api:t,paramName:n,desc:Cn(n,"message")}),1))}},conversationID:{type:"String",required:!1,validator:function(e){return!e||Zt(e)}},timePosition:{type:"number",required:!1,validator:function(e,t,n){return En(e,t,n,{allowUndefined:!0,min:0})}},timePeriod:{type:"number",required:!1,validator:function(e,t,n){return En(e,t,n,{allowUndefined:!0,min:0})}}},searchCloudUsers:{keywordList:Fn.keywordListExceptMsg,keywordListMatchType:Fn.keywordListMatchType,cursor:Fn.cursor,count:Fn.count,miniBirthday:{type:"Number",required:!1,validator:function(e,t,n){return En(e,t,n,{allowUndefined:!0,min:0})}},maxBirthday:{type:"Number",required:!1,validator:function(e,t,n){return En(e,t,n,{allowUndefined:!0,min:0})}},gender:{type:"String",required:!1,validator:function(e,t,n){return!e||e===k.GENDER_FEMALE||e===k.GENDER_MALE||Qt({api:t,paramName:n,desc:"".concat(e," is invalid match type")})}}},searchCloudGroups:{keywordList:Fn.keywordListExceptMsg,keywordListMatchType:Fn.keywordListMatchType,cursor:Fn.cursor,count:Fn.count,groupTypeList:Fn.groupTypeList},searchCloudGroupMembers:{keywordList:Fn.keywordListExceptMsg,keywordListMatchType:Fn.keywordListMatchType,cursor:Fn.cursor,count:Fn.count,groupTypeList:Fn.groupTypeList,groupIDList:{type:"Array",required:!1,validator:function(e,t,n){return Tn(e,t,n,{allowUndefined:!0,allowEmpty:!0})}}},getUserProfile:{userIDList:{type:"Array",validator:function(e,t,n){return Xe(e)?(0===e.length&&Qt({api:t,paramName:n,desc:cn()}),!0):(Qt({api:t,paramName:n,desc:rn()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e,t,n){return!!ht(e)||!!Xe(e)||(Qt({api:t,paramName:n,desc:rn()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e,t,n){return!!pt(e)||(Qt({api:t,paramName:n,desc:en()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return Xe(e)?0!==e.length||(Qt({api:t,paramName:n,desc:cn()}),!1):(Qt({api:t,paramName:n,desc:rn()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return Xe(e)?0!==e.length||(Qt({api:t,paramName:n,desc:cn()}),!1):(Qt({api:t,paramName:n,desc:rn()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return!e||!!Xe(e)||(Qt({api:t,paramName:n,desc:rn()}),!1)}}},addFriend:{to:Z,source:{type:"String",required:!0,validator:function(e,t,n){return!(!e||(e.startsWith("AddSource_Type_")?8<e.replace("AddSource_Type_","").length&&(Qt({api:t,paramName:n,desc:dn("keyword",8)}),1):(Qt({api:t,paramName:n,desc:xn("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e,t,n){return!(pt(e)&&96<e.length&&(Qt({api:t,paramName:n,desc:dn(n,96)}),1))}}},deleteFriend:{userIDList:te},checkFriend:{userIDList:te},getFriendProfile:{userIDList:te},updateFriend:{userID:Z,remark:{type:"String",required:!1,validator:function(e,t,n){return!(pt(e)&&96<e.length&&(Qt({api:t,paramName:n,desc:dn(n,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e,t,n){if(e){if(!Xe(e))return Qt({api:t,paramName:n,desc:rn()}),!1;var o=!0;return e.forEach((function(e){return pt(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?pt(e.value)?8<e.key.replace("Tag_SNS_Custom_","").length?(Qt({api:t,paramName:n,desc:dn("keyword",8)}),o=!1):void 0:(Qt({api:t,paramName:n,desc:gn("value")}),o=!1):(Qt({api:t,paramName:n,desc:xn("FriendCustomFieldPrefixLog")}),o=!1)})),o}return!0}}},acceptFriendApplication:{userID:Z},refuseFriendApplication:{userID:Z},deleteFriendApplication:{userID:Z},createFriendGroup:{name:Z},deleteFriendGroup:{name:Z},addToFriendGroup:{name:Z,userIDList:te},removeFromFriendGroup:{name:Z,userIDList:te},renameFriendGroup:{oldName:Z,newName:Z},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e,t,n){return Xe(e)?0!==e.length||(Qt({api:t,paramName:n,desc:cn()}),!1):(Qt({api:t,paramName:n,desc:rn()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e,t,n){return Xe(e)?0!==e.length||(Qt({api:t,paramName:n,desc:cn()}),!1):(Qt({api:t,paramName:n,desc:rn()}),!1)}}],createTopicInCommunity:{groupID:Z,topicName:Z},deleteTopicFromCommunity:{groupID:Z,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!Xe(e)||(Qt({api:t,paramName:n,desc:rn()}),!1)}}},updateTopicProfile:{groupID:Z,topicID:Z},getTopicList:{groupID:Z,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!Xe(e)||(Qt({api:t,paramName:n,desc:rn()}),!1)}}},followUser:[t({name:"userIDList"},te)],unfollowUser:[t({name:"userIDList"},te)],getMyFollowingList:[t(t({name:"startIndex"},Z),{},{required:!1})],getMyFollowersList:[t(t({name:"startIndex"},Z),{},{required:!1})],getMutualFollowersList:[t(t({name:"startIndex"},Z),{},{required:!1})],getUserFollowInfo:[t(t({name:"userIDList"},te),{},{required:!1})],checkFollowType:[t({name:"userIDList"},te)],addSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Qt({api:t,paramName:n,desc:tn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Qt({api:t,paramName:n,desc:an()}),!1):(""===e.name&&Qt({api:t,paramName:n,desc:yn()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Qt({api:t,paramName:n,desc:tn(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Qt({api:t,paramName:n,desc:an()}),!1):(""===e.name&&Qt({api:t,paramName:n,desc:yn()}),!0)}}],invite:{userID:Z},inviteSync:[t(t({},$),{},{validator:function(e,t,n){return $e(e)?!!pt(e.userID)||(Qt({api:t,paramName:"options.userID",desc:en()}),!1):(Qt({api:t,paramName:"options",desc:_n()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:an()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:an()}),!0}}],inviteInGroup:{groupID:Z,inviteeList:te},inviteInGroupSync:[t(t({},$),{},{validator:function(e,t,n){return $e(e)?pt(e.groupID)?!!Xe(e.inviteeList)||(Qt({api:t,paramName:"options.inviteeList",desc:rn()}),!1):(Qt({api:t,paramName:"options.groupID",desc:en()}),!1):(Qt({api:t,paramName:"options",desc:_n()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:an()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return ht(e)&&Qt({api:t,paramName:n,desc:an()}),!0}}],accept:{inviteID:Z},reject:{inviteID:Z},getSignalingInfo:[t(t({name:"message"},$),{},{validator:function(e,t,n){return!je(e)||(Qt({api:t,paramName:n,desc:vn()}),!1)}})],modifyInvitation:{inviteID:Z,data:Z}},qn={login:1,logout:1,getLoginUser:1,getServerTime:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,setMessageRemindType:1,setAllReceiveMessageOpt:1,getAllReceiveMessageOpt:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,searchCloudMessages:1,searchCloudUsers:1,searchCloudGroups:1,searchCloudGroupMembers:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},Bn=(r(po,p(Error)),Rn=f(po),s(po)),Hn={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AV:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_ERR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AV:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AV:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AV:2661,CANNOT_JOIN_NON_AV_WITHOUT_LOGIN:2662,NOT_OWNER:2681,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AV:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,NO_PROTOCOL:2997,NO_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,NO_USE:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020},jn=null,Kn=(s(lo,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){var e=this._m.get(12);return e.isPrivateNetWork()&&!e.getFileDownloadProxy()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getDowloadFileAuthKey",value:function(){return this._m.get(12).getDowloadFileAuthKey()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"getPlatform",value:function(){return ae}},{key:"getCloudConfig",value:function(e){return this._m.get(23).getCloudConfig(e)}},{key:"emitOEvt",value:function(e,t){this._m.getOEmitInst().emit(e,t)}},{key:"emitIEvt",value:function(e,t){this._m.getIEmitInst().emit(e,t)}},{key:"getIEmitInst",value:function(){return this._m.getIEmitInst()}},{key:"req",value:function(e){return this._m.get(20).req(e)}},{key:"canIUse",value:function(e){return this._m.get(27).canIUse(e)}},{key:"getErrMsg",value:function(e,t,n){return this._m.getErrMsg(e,t,n)}},{key:"warn",value:function(e,t,n){(e=this.getErrMsg(e,t,n))&&Pe.w(e)}},{key:"noUse",value:function(e){var t=Hn.NO_USE;return kn({code:t,message:this.getErrMsg(t,e)})}}]),wn=lo,{LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",SEARCH_CONV_GRP_MARK:"search_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",CS:"query",GRP_CS:"query_grp",MBR_CS:"query_grp_member",USER_CS:"query_user",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check",SET_ALL_RECEIVE_MSG_OPT:"ws_set_do_not_disturb",GET_ALL_RECEIVE_MSG_OPT:"ws_get_do_not_disturb"}),Yn="networkRTT",zn="messageE2EDelay",Wn="sendMessageC2C",Jn="sendMessageGroup",$n="sendMessageGroupAV",Xn="sendMessageRichMedia",Zn="cosUpload",Qn="messageReceivedGroup",eo="messageReceivedGroupAVPush",to="messageReceivedGroupAVPull",no=(a(Gn={},Yn,2),a(Gn,zn,3),a(Gn,Wn,4),a(Gn,Jn,5),a(Gn,$n,6),a(Gn,Xn,7),a(Gn,Qn,8),a(Gn,eo,9),a(Gn,to,10),a(Gn,Zn,11),Gn),oo={info:4,warning:5,error:6},io={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},so={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16,tui_key_features:16},ao=(s(uo,[{key:"updateTimeStamp",value:function(){this.timestamp=Le()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._sentFlag||(this._netMonitorModule&&(e=this._netMonitorModule.getNetworkType(),this.setNetworkType(e)),e=Le(),0===this.costTime&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),n?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){t._sentFlag=!0,t._eventStatModule&&t._eventStatModule.pushIn(t)}),0))}},{key:"setError",value:function(e){if(!(e instanceof Error))return Pe.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;var t=!0;return(t=this._netMonitorModule?this._netMonitorModule.isOnline():t)?(e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message)):this.setCode(Hn.NO_NETWORK),this.setLevel("error"),this}},{key:"setCode",value:function(e){return ht(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),We(e)?this.code=e:Pe.w("".concat(this._n,".setCode value not a number, please check!"),e,n(e))),this}},{key:"setMessage",value:function(e){return ht(e)||this._sentFlag||(We(e)&&(this.message=e.toString()),pt(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return ht(e)||this._sentFlag||(this.level=oo[e]),this}},{key:"setMoreMessage",value:function(e){return je(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){return ht(e)?Pe.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(e=io[e.toLowerCase()],ht(e)||(this.networkType=e)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){return this.uiPlatform=e,this}},{key:"setExtension",value:function(e){return this.extension=e,this}},{key:"setEventType",value:function(e){return this.eventType=e,this}}],[{key:"bindEventStatModule",value:function(e){uo.prototype._eventStatModule=e}},{key:"bindNetMonitorModule",value:function(e){uo.prototype._netMonitorModule=e}}]),uo),ro=(s(co,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),co);function co(e){o(this,co),this.type=k.MSG_TEXT,this.content={text:e.text||""}}function uo(e){o(this,uo),this._n="SSOLogData",this.eventType=so[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Le()}function lo(e){o(this,lo),this._m=e,this._n=""}function po(e){o(this,po),t=Rn.call(this);var t,n=e.code,i=e.message;return e=e.data,t.code=n,i?t.message=i:t._getErrMsg&&(t.message=t._getErrMsg(t.code)),t.data=e||{},t}function ho(e,t,n,o){var i;if(o=3<arguments.length&&void 0!==o?o:[],e)return i=e,t&&(e.startsWith("http://")?i=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(i=e.replace(/^https:\/\/[^/]+/,t))),n&&-1===i.indexOf("authKey=")&&fo(i,o)?(-1<i.indexOf("?")?"".concat(i,"&authKey="):"".concat(i,"?authKey=")).concat(n):i}function go(e,t,n){return n=2<arguments.length&&void 0!==n?n:[],e===k.MSG_VIDEO?fo((t[0].content||t[0].payload).snapshotUrl,n)&&(t[0].content?(t[0].content.snapshotUrl=_o(t[0].content.snapshotUrl),t[0].content.thumbUrl=_o(t[0].content.thumbUrl)):(t[0].payload.snapshotUrl=_o(t[0].payload.snapshotUrl),t[0].payload.thumbUrl=_o(t[0].payload.thumbUrl))):e===k.MSG_FILE?fo((t[0].content||t[0].payload).fileUrl,n)&&(t[0].content?t[0].content.fileUrl=_o(t[0].content.fileUrl):t[0].payload.fileUrl=_o(t[0].payload.fileUrl)):e===k.MSG_MERGER&&(e=(n=t[0].content||t[0].payload).downloadKey,n=void 0===(n=n.messageList)?[]:n,je(void 0===e?"":e)&&n.forEach((function(e){go(e.messageBody[0].type,e.messageBody)}))),t}function _o(e){if(!e)return e;if(-1===e.indexOf("authKey="))return e;for(var t=(e=e.split("?"))[1].split("&"),n=0,o=0;o<t.length;o++)if(-1<t[o].indexOf("authKey=")){n=o;break}return t.splice(n,1),0<t.length?"".concat(e[0],"?").concat(t.join("&")):e[0]}function fo(e,t){var n=!1;if(e){var o=(e=e.match(/:\/\/([0-9]?\.)?(.[^/:]+)/))&&e[2]||"";if(o.includes("rich-dev"))return 1;for(var i=0;i<t.length;i++)if(o.endsWith(t[i])){n=!0;break}}return n}s(jo,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=at(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.imageUrl||t.url||"",this.url=ho(t.url||e._imageMemoryURL,e._fileDownloadProxy,e._authKey,e._fileDNList)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t,n=0,o=null;n<=2;)t=ht(e)||ht(e[n])?{type:0,size:0,width:0,height:0,url:""}:e[n],(o=new this._ImageInfoModel(t)).setSizeType(n+1),o.setType(n),this.addImageInfo(o),n++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e[o].size&&(t.size=e[o].size),e[o].url&&t.setImageUrl(e[o].url),e[o].width&&(t.width=e[o].width),e[o].height&&(t.height=e[o].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",o=["http","https"],i=null,s=0;s<e;s++)this.content.imageInfoArray[s].url&&""!==(i=this.content.imageInfoArray[s]).imageUrl&&(n=i.imageUrl.slice(0,i.imageUrl.indexOf("://")+1),t=i.imageUrl.slice(i.imageUrl.indexOf("://")+1),o.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[s].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=be[e.toUpperCase()]||be.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&0<e.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURL",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=void 0===(t=(n=e[0]).width)?0:t,n=void 0===(n=n.height)?0:n;0!==t&&0!==n&&(Gt(e),Object.assign(e[2],Ut({originWidth:t,originHeight:n,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]);var mo=jo,vo=(s(Ho,[{key:"sendable",value:function(){return null!==this.content}}]),Ho),yo=(s(Bo,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),Bo),Io={from:!0,groupID:!0,groupName:!0,to:!0},Mo=(s(qo,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":t.content.operatorInfo={},t._initOperatorInfo(e[n]);break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];Io[o]&&(this.content.groupProfile[o]=e[o])}}},{key:"_initOperatorInfo",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.operatorInfo[o]=e[o]}}},{key:"_updateMemberList",value:function(e){je(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.newGroupProfile[o]="muteAllMembers"!==o?e[o]:1===e[o]}}}]),qo),Co={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},To=(s(Vo,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];Co[o]&&("groupName"===o?this.content.groupProfile.name=e[o]:this.content.groupProfile[o]=e[o])}}}]),Vo),Eo=(s(xo,[{key:"_getFileInfo",value:function(e){return ht(e.fileName)||ht(e.fileSize)?(e=e.file.files[0],X&&(e.path&&-1!==e.path.indexOf(".")&&(t=e.path.slice(e.path.lastIndexOf(".")+1).toLowerCase(),e.type=t,e.name||(e.name="".concat(at(999999),".").concat(t))),e.name||(e.type="",e.name=e.path.slice(e.path.lastIndexOf("/")+1).toLowerCase()),e.suffix&&(e.type=e.suffix),e.url||(e.url=e.path)),{size:e.size,name:e.name}):{size:e.fileSize,name:e.fileName};var t}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),xo),So=(s(Fo,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),Fo),Do=(s(wo,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth;e=e.snapshotHeight,je(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),je(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),je(e)||(this.content.thumbHeight=this.content.snapshotHeight=Number(e))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),wo),ko=(s(Go,[{key:"sendable",value:function(){return!0}}]),Go),Ro=(s(Uo,[{key:"_patchRichMediaPayload",value:function(e,t){e===k.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===k.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===k.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===k.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n,o,i){(n||o)&&(e===k.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=ho(e.url,n,o,i)})):e===k.MSG_VIDEO?(t.videoUrl=ho(t.videoUrl,n,o,i),t.snapshotUrl=ho(t.thumbUrl,n,o,i),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===k.MSG_AUDIO?t.url=ho(t.url,n,o,i):e===k.MSG_FILE&&(t.fileUrl=ho(t.fileUrl,n,o,i)))}}]),Uo),Lo=(s(bo,[{key:"sendable",value:function(){return!je(this.content.messageList)||!je(this.content.downloadKey)}}]),bo),Ao={1:k.MSG_PRIORITY_HIGH,2:k.MSG_PRIORITY_NORMAL,3:k.MSG_PRIORITY_LOW,4:k.MSG_PRIORITY_LOWEST},Oo=(s(Po,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){null!==e&&(pt(e.nick)&&(this.nick=e.nick),pt(e.avatar)&&(this.avatar=e.avatar),$e(e=e.messageFromAccountExtraInformation)&&pt(e.nameCard)&&(this.nameCard=e.nameCard))}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==k.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(k.MSG_AT_ALL))})),Xe(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(k.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?An:Ln,this.from||(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&(!0===this._relayFlag||"function"==typeof this._elements[0].sendable&&this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===k.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){var t,n,o;0===this.clientSequence&&e&&(this.clientSequence=!!e&&(void 0===yt[e]&&(t="3".concat((o=new Date).getHours()).slice(-2),n="0".concat(o.getMinutes()).slice(-2),o="0".concat(o.getSeconds()).slice(-2),yt[e]=parseInt([t,n,o,"0001"].join("")),o=n=t=null,Pe.l("autoIncrementIndex start index:".concat(yt[e]))),yt[e]++)),0===this.sequence&&this.conversationType===k.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===k.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n=this.conversationType;n!==k.CONV_SYSTEM?(e=n===k.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=e?"".concat(n).concat(e):null):this.conversationID=k.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof ro||e instanceof mo||e instanceof vo||e instanceof yo||e instanceof Eo||e instanceof Do||e instanceof Mo||e instanceof To||e instanceof So||e instanceof ko||e instanceof Lo}},{key:"setElement",value:function(e,t,n,o){var i=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();function s(e){if(e.type&&e.content)switch(e.type){case k.MSG_TEXT:i.setTextElement(e.content);break;case k.MSG_IMAGE:i.setImageElement(e.content,t,n,o);break;case k.MSG_AUDIO:i.setAudioElement(e.content,t,n,o);break;case k.MSG_FILE:i.setFileElement(e.content,t,n,o);break;case k.MSG_VIDEO:i.setVideoElement(e.content,t,n,o);break;case k.MSG_CUSTOM:i.setCustomElement(e.content);break;case k.MSG_LOCATION:i.setLocationElement(e.content);break;case k.MSG_GRP_TIP:i.setGroupTipElement(e.content);break;case k.MSG_GRP_SYS_NOTICE:i.setGroupSystemNoticeElement(e.content);break;case k.MSG_FACE:i.setFaceElement(e.content);break;case k.MSG_MERGER:i.setMergerElement(e.content,t,n,o)}}if(Xe(e))for(var a=0;a<e.length;a++)s(e[a]);else s(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){e="string"==typeof e?e:e.text,e=new ro({text:e}),this._elements.push(e)}},{key:"setImageElement",value:function(e,t,n,o){e=new mo(e,t,n,o),this._elements.push(e)}},{key:"setAudioElement",value:function(e,t,n,o){e=new yo(e,t,n,o),this._elements.push(e)}},{key:"setFileElement",value:function(e,t,n,o){e=new Eo(e,t,n,o),this._elements.push(e)}},{key:"setVideoElement",value:function(e,t,n,o){e=new Do(e,t,n,o),this._elements.push(e)}},{key:"setLocationElement",value:function(e){e=new ko(e),this._elements.push(e)}},{key:"setCustomElement",value:function(e){e=new So(e),this._elements.push(e)}},{key:"setGroupTipElement",value:function(e){var t,n={},o=e.operationType;je(e.memberInfoList)?e.operatorInfo&&(n=e.operatorInfo):o!==k.GRP_TIP_MBR_JOIN&&o!==k.GRP_TIP_MBR_KICKED_OUT&&o!==k.GRP_TIP_MBR_SET_ADMIN&&o!==k.GRP_TIP_MBR_CANCELED_ADMIN||(n=e.memberInfoList[0]),je(e.memberExtraInfo)||(t=e.memberExtraInfo.reason,e.msgMemberInfo.forEach((function(e){e.reason=t}))),o=n.nick,n=n.avatar,pt(o)&&(this.nick=o),pt(n)&&(this.avatar=n),o=new Mo(e),this._elements.push(o)}},{key:"setGroupSystemNoticeElement",value:function(e){e=new To(e),this._elements.push(e)}},{key:"setFaceElement",value:function(e){e=new vo(e),this._elements.push(e)}},{key:"setMergerElement",value:function(e,t,n,o){e=new Lo(e,t,n,o),this._elements.push(e)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"_computePriority",value:function(e){return ht(e)?k.MSG_PRIORITY_NORMAL:pt(e)&&-1!==Object.values(Ao).indexOf(e)?e:We(e)&&(e=""+e,-1!==Object.keys(Ao).indexOf(e))?Ao[e]:k.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick;e=e.avatar,pt(t)&&(this.nick=t),pt(e)&&(this.avatar=e)}},{key:"setNameCard",value:function(e){pt(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){var t=e.readReceiptSentByPeer;e=void 0===(e=e.timestamp)?0:e,this.conversationType===k.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===(void 0===t?void 0:t),this.readReceiptInfo.timestamp=e)}}]),Po),No=["sound","FCMChannelID"];function Po(e){o(this,Po),this.ID="",this.conversationID=e.conversationID||null,this.conversationType=e.conversationType||k.CONV_C2C,this.conversationSubType=e.conversationSubType,this.time=e.time||Math.ceil(Date.now()/1e3),this.sequence=e.sequence||0,this.clientSequence=e.clientSequence||e.sequence||0,this.random=e.random||0===e.random?e.random:at(),this.priority=this._computePriority(e.priority),this.nick=e.nick||"",this.avatar=e.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=$t(e.checkResult),this._elements=[],this.isPlaceMessage=e.isPlaceMessage||0,this.isRevoked=2===e.isPlaceMessage||8===e.msgFlagBits,this.from=e.from||null,this.to=e.to||null,this.flow="",this.isSystemMessage=e.isSystemMessage||!1,this.protocol=e.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=e.status||An,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=e.cloudCustomData||"",this.isDeleted=!1,this.isModified=!!e.messageVersion,this._isExcludedFromUnreadCount=!(!e.messageControlInfo||1!==e.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!e.messageControlInfo||1!==e.messageControlInfo.excludedFromLastMessage),this.clientTime=e.clientTime||De()||0,this.senderTinyID=e.senderTinyID||e.tinyID||"",this.readReceiptInfo=e.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0,timestamp:0},this.needReadReceipt=!0===e.needReadReceipt||1===e.needReadReceipt,this.version=e.messageVersion||0,this.isBroadcastMessage=e.isBroadcastMessage||!1,this._receiverList=e.receiverList||void 0,this.isSupportExtension=!0===e.isSupportExtension||1===e.isSupportExtension,this._cmConfigID=e.customModerationConfigurationID,this.revoker=e.revokerInfo&&e.revokerInfo.revoker||"",this.revokerInfo=e.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=e.revokeReason||"",this.reInitialize(e.currentUser),this.extractGroupInfo(e.groupProfile||null),this.handleGroupAtInfo(e),this.initC2CReadReceiptInfo(e)}function bo(e,t,n,i){var s,a,r,c,u,l,d;o(this,bo),this.type=k.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},e.downloadKey?(a=e.downloadKey,r=e.pbDownloadKey,c=e.title,u=e.abstractList,l=e.compatibleText,s=e.version,this.content.downloadKey=a,this.content.pbDownloadKey=r,this.content.title=c,this.content.abstractList=u,this.content.compatibleText=l,this.content.version=s||0):je(e.messageList)?1===e.layersOverLimit&&(this.content.layersOverLimit=!0):(a=e.messageList,r=e.title,c=e.abstractList,u=e.compatibleText,l=e.version,d=[],a.forEach((function(e){je(e)||(e=new Ro(e,t,n,i),d.push(e))})),this.content.messageList=d,this.content.title=r,this.content.abstractList=c,this.content.compatibleText=u,this.content.version=l||0)}function Uo(e,t,n,i){var s,a;o(this,Uo),this.from=e.from,this.messageSender=e.from,this.time=e.time,this.messageSequence=e.sequence,this.clientSequence=e.clientSequence||e.sequence,this.messageRandom=e.random,this.cloudCustomData=e.cloudCustomData||"",this.clientTime=e.clientTime||void 0,e.ID?(this.ID=e.ID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",e.messageBody?this.messageBody=JSON.parse(JSON.stringify(e.messageBody)):this.messageBody=[{type:e.type,payload:e.payload}],e.conversationType?e.conversationType.startsWith(k.CONV_C2C)?this.receiverUserID=e.to:e.conversationType.startsWith(k.CONV_GROUP)&&(this.receiverGroupID=e.to):e.receiverGroupID?this.receiverGroupID=e.receiverGroupID:e.receiverUserID&&(this.receiverUserID=e.receiverUserID),this.messageReceiver=e.to||e.messageReceiver):(this.nick=e.nick||"",this.avatar=e.avatar||"",this.messageBody=[],s=e.elements[0].type,a=e.elements[0].content,this._patchRichMediaPayload(s,a),this._updateRichMediaDownloadUrl(s,a,t,n,i),s===k.MSG_MERGER?this.messageBody.push({type:s,payload:new Lo(a,t,n,i).content}):this.messageBody.push({type:s,payload:a}),e.groupID&&(this.receiverGroupID=e.groupID,this.messageReceiver=e.groupID),e.to&&(this.receiverUserID=e.to,this.messageReceiver=e.to),this.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random))}function Go(e){o(this,Go),this.type=k.MSG_LOCATION;var t=e.description,n=e.longitude;e=e.latitude,this.content={description:t,longitude:n,latitude:e}}function wo(e,t,n,i){o(this,wo),this.type=k.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:e.remoteVideoUrl||e.videoUrl||"",videoFormat:e.videoFormat,videoSecond:parseInt(e.videoSecond,10),videoSize:e.videoSize,videoUrl:ho(e.videoUrl,t,n,i),videoDownloadFlag:2,videoUUID:e.videoUUID,thumbUUID:e.thumbUUID,thumbFormat:e.thumbFormat,thumbWidth:e.thumbWidth,snapshotWidth:e.thumbWidth,thumbHeight:e.thumbHeight,snapshotHeight:e.thumbHeight,thumbSize:e.thumbSize,snapshotSize:e.thumbSize,thumbDownloadFlag:2,thumbUrl:ho(e.thumbUrl,t,n,i),snapshotUrl:ho(e.thumbUrl,t,n,i)}}function Fo(e){o(this,Fo),this.type=k.MSG_CUSTOM,this.content={data:e.data||"",description:e.description||"",extension:e.extension||""}}function xo(e,t,n,i){o(this,xo),this.type=k.MSG_FILE,this._percent=0;var s=this._getFileInfo(e);this.content={downloadFlag:2,fileUrl:ho(e.url||e.fileUrl,t,n,i)||"",uuid:e.uuid,fileName:s.name||"",fileSize:s.size||0}}function Vo(e){o(this,Vo),this.type=k.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(e)}function qo(e){o(this,qo),this.type=k.MSG_GRP_TIP,this.content={},this._initContent(e)}function Bo(e,t,n,i){o(this,Bo),this.type=k.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:e.second,size:e.size,url:ho(e.url,t,n,i),remoteAudioUrl:e.url||"",uuid:e.uuid}}function Ho(e){o(this,Ho),this.type=k.MSG_FACE,this.content=e||null}function jo(e,t,n,i){o(this,jo),this._imageMemoryURL="",this._fileDownloadProxy=t,this._authKey=n,this._fileDNList=i,ee||ne?this.createImageDataASURL(e.file):this.createImageDataASURLInWeb(e.file),this._initImageInfoModel(),this.type=k.MSG_IMAGE,this._percent=0,this.content={imageFormat:e.imageFormat||be.UNKNOWN,uuid:e.uuid,imageInfoArray:[]},this.initImageInfoArray(e.imageInfoArray),this._autoFixUrl()}function Ko(e){if($e(e))return{pushFlag:!0===e.disablePush?1:0,title:e.title||"",desc:e.description||"",ext:e.extension||"",apnsInfo:(o=void 0===(o=(n=e).apnsInfo)?{}:o,i=n.ignoreIOSBadge,n=n.disableVoipPush,i=!0===o.ignoreIOSBadge||!0===(void 0!==i&&i)?1:0,s=void 0,ht(n)||(s=!1===n?1:0),ht(o.disableVoipPush)||(s=!1===o.disableVoipPush?1:0),t(t({},o),{},{badgeMode:i,isVoipPush:s})),androidInfo:(o=void 0===(o=(n=e).androidInfo)?{}:o,n=n.androidOPPOChannelID,n=o.OPPOChannelID||(void 0===n?"":n),i=void 0===(i=o.sound)?"":i,s=void 0===(s=o.FCMChannelID)?"":s,t(t({},h(o,No)),{},{Sound:-1===(i=(o=i).lastIndexOf("."))?o:o.slice(0,i),OPPOChannelID:n,GoogleChannelID:s}))};var n,o,i,s}r(Xo,wn),Yo=f(Xo),s(Xo,[{key:"onNewMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,o=e.C2CRemainingUnreadList,i=e.C2CPairUnreadList,s=(e=e.isSyncingEnded,o=(n||Pe.l("".concat(this._n,".onNewMessage C2CPairUnreadList:"),i,"C2CRemainingUnreadList:",o),t=this._assembly({dataList:t,C2CRemainingUnreadList:o,C2CPairUnreadList:i,isInstantMessage:n})).conversationOptionsList,i=t.messageList,t=t.isUnreadC2CMessage,0<(s=Mt(i)).length&&this.emitOEvt(D.MESSAGE_MODIFIED,s),this.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:n,isUnreadC2CMessage:t,isSyncingEnded:e}),Tt(i));n&&0<s.length&&this.emitOEvt(D.MESSAGE_RECEIVED,s),i.length=0}},{key:"_assembly",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList,i=e.isInstantMessage,s=null,a=[],r=[],c={},u=this.get(26),l=!1,d=this.get(11),p=this.get(4),h=(e=this.get(17),this.getFileDownloadProxy()),g=this.getDowloadFileAuthKey(),_=e.getFileDNList(),f=0,m=t.length;f<m;f++)if(this._isC2CNotice(t[f]))this._noticeFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var v=t[f],y=(v.currentUser=this.getMyUserID(),v.conversationType=k.CONV_C2C,v.isSystemMessage=!!v.isSystemMessage,(ht(v.nick)||ht(v.avatar))&&(l=!0),(s=new Oo(v)).setElement(v.elements,h,g,_),s.setNickAndAvatar({nick:v.nick,avatar:v.avatar}),s.conversationID);if(i){if(this._msgFromUnreadDBMap.get(s.ID))continue;var I,M,C=!1,T=(s.from!==this.getMyUserID()?(M=d.getLatestMessageSentByPeer(y))&&(I=M.nick,M=M.avatar,l?s.setNickAndAvatar({nick:I,avatar:M}):I===s.nick&&M===s.avatar||(C=!0)):(I=d.getLatestMessageSentByMe(y))&&(M=I.nick,T=I.avatar,M===s.nick&&T===s.avatar||(d.modifyMessageSentByMe({conversationID:y,latestNick:s.nick,latestAvatar:s.avatar}),p.mockOnNickAvatarModified(s.nick,s.avatar))),1===t[f].isModified);if(d.isMessageSentByCurrentInstance(s)?s.isModified=T:T=!1,0===v.msgLifeTime)s._onlineOnlyFlag=!0,d.isMessageSentByCurrentInstance(s)||r.push(s);else{if(!d.pushIntoMessageList(r,s,T))continue;C&&(d.modifyMessageSentByPeer({conversationID:y,latestNick:s.nick,latestAvatar:s.avatar}),d.updateUserProfileSpecifiedKey({conversationID:y,nick:s.nick,avatar:s.avatar}))}i&&0<s.clientTime&&u.addMessageDelay(s.clientTime)}else this._msgFromUnreadDBMap.set(s.ID,s);if(0!==v.msgLifeTime){if(!1===s._onlineOnlyFlag){if(We(C=d.getLastMessageTime(y))&&s.time<C)continue;i&&(ht(c[y])?(v=0,"in"===s.flow&&(s._isExcludedFromUnreadCount||(v=1)),c[y]=a.push({conversationID:y,unreadCount:v,type:s.conversationType,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1):(v=c[y],a[v].type=s.conversationType,a[v].subType=s.conversationSubType,a[v].lastMessage=s._isExcludedFromLastMessage?"":s,"in"===s.flow&&(s._isExcludedFromUnreadCount||a[v].unreadCount++)))}}else s._onlineOnlyFlag=!0}this._handleNoticeFromUnreadDB();var E=!1;if(Xe(o)&&0<o.length)for(var S=0,D=o.length;S<D;S++)!function(e){if(o[e].from!==k.CONV_SYSTEM){E=!0;var t=a.find((function(t){return t.conversationID==="".concat(k.CONV_C2C).concat(o[e].from)}));t?t.unreadCount=o[e].unreadCount:a.push({conversationID:"".concat(k.CONV_C2C).concat(o[e].from),unreadCount:o[e].unreadCount,type:k.CONV_C2C})}}(S);if(Xe(n))for(var R=0,L=n.length;R<L;R++)!function(e){a.find((function(t){return t.conversationID==="".concat(k.CONV_C2C).concat(n[e].from)}))||a.push({conversationID:"".concat(k.CONV_C2C).concat(n[e].from),type:k.CONV_C2C,lastMsgTime:n[e].lastMsgTime})}(R);return{conversationOptionsList:a,messageList:r,isUnreadC2CMessage:E}}},{key:"getMessageListFromUnreadDB",value:function(){return v(this._msgFromUnreadDBMap.values())}},{key:"_isC2CNotice",value:function(e){return!(!Xe(e=e.eventArray)||10!==e[0].event)}},{key:"_handleNoticeFromUnreadDB",value:function(){var e,t=this._noticeFromUnreadDBList.length;0!==t&&(Pe.l("".concat(this._n,"._handleNoticeFromUnreadDB count:").concat(t)),e=[],this._noticeFromUnreadDBList.forEach((function(t){t.hasOwnProperty("c2cMessageRevokedNotify")&&e.push(t)})),this.onMsgRevoked({dataList:e}),this._noticeFromUnreadDBList.length=0,e.length=0)}},{key:"onMsgRevoked",value:function(e,t){var n,o=this,i=this.get(11),s=[];e.dataList.forEach((function(e){e.c2cMessageRevokedNotify&&(e=e.c2cMessageRevokedNotify.revokedInfos,ht(e)||e.forEach((function(e){var t=o.getMyUserID()===e.from?"".concat(k.CONV_C2C).concat(e.to):"".concat(k.CONV_C2C).concat(e.from);n=i.revoke(t,e.sequence,e.random);var a,r=e.revokerInfo&&e.revokerInfo.revoker,c=e.revokerInfo&&e.revokerInfo.reason||"";n?a=n:(a={conversationID:t,sequence:e.sequence},e.tinyID&&e.clientTime&&e.random&&(a.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)),e.time&&(a.time=e.time)),a&&(a.revoker=r,a.revokeReason=c,a.revokerInfo={userID:r,nick:"",avatar:""},s.push(a))})))})),0!==s.length&&(Pe.l("".concat(this._n,".onMsgRevoked count:").concat(s.length," updateUnreadCount:").concat(t)),i.onMessageRevoked(s,t),i.updateRevokerInfo(s).then((function(e){o.emitOEvt(D.MESSAGE_REVOKED,e)})))}},{key:"onMsgReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){var n;je(e.c2cMessageReadReceipt)||(n=e.c2cMessageReadReceipt.to,e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){e=e.peerReadTime;var o=(Pe.l("".concat(t._n,".onMsgReadReceipt to:").concat(n," peerReadTime:").concat(e)),"".concat(k.CONV_C2C).concat(n)),i=t.get(11);i.recordPeerReadTime(o,e),i.updateMsgIsPeerReadProp(o,e)})))}))}},{key:"onMsgReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n;je(e.c2cMessageReadNotice)||(n=t.get(11),e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var o=e.from;e=e.peerReadTime,Pe.l("".concat(t._n,".onMsgReadNotice from:").concat(o," lastReadTime:").concat(e)),o="".concat(k.CONV_C2C).concat(o),n.updateIsReadAfterReadReport({conversationID:o,lastMessageTime:e}),n.updateUnreadCount(o)})))}))}},{key:"onMsgModified",value:function(e){Pe.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:k.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Pe.l("".concat(this._n,".onReadReceiptList options:"),e),this.get(11).updateReadReceiptInfo(e.dataList)}},{key:"sendMessage",value:function(e,t){return e=this._createC2CMessagePack(e,t),this.req(e)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null,o=(t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0})),""),i=(pt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),s=($e(t)&&$e(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck")),this.isOnlineMessage(e,t)?0:void 0),a=JSON.parse(JSON.stringify(e.getElements())),r=this.get(17).getFileDNList();return{P:Kn.SEND_C2C_MSG,data:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:go(e.type,a,r),cloudCustomData:o,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:s,nick:e.nick,avatar:e.avatar,offlinePushInfo:Ko(n),messageControlInfo:0!==s?i:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0,cmConfigID:e._cmConfigID,forbidCallbackControl:Ct(t)}}}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.req({P:Kn.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to;return e=e.keyList,Pe.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(e.length)),this.req({P:Kn.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:t,keyList:e}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,o=void 0===(o=e.version)?0:o,i=e.sequence,s=e.random,a=e.time,r=e.payload,c=e.type,u=e.cloudCustomData,l=void(e=e._elements);return Ht(c)&&(1<e.length&&e.splice(0,1,{type:c,content:r}),l=e),this.req({P:Kn.MODIFY_C2C_MSG,data:{from:t,to:n,version:o,sequence:i,random:s,time:a,elements:l,cloudCustomData:u}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageTime,i="".concat(this._n,".").concat("setMessageRead"),s=(e="convID:".concat(n," lastMessageTime:").concat(o),Pe.l("".concat(i," ").concat(e)),We(o)||this.warn("DoNotModifyLastTime"),new ao("setMessageRead"));return s.setMessage(e),this.req({P:Kn.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:o,receipt:1}]}}}).then((function(){s.end(),Pe.l("".concat(i," ok"));var e=t.get(11);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:o}),e.updateUnreadCount(n),Sn()})).catch((function(e){return s.setError(e).end(),Pe.l("".concat(i," failed. error:"),e),kn(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessage"),o=e.peerAccount,i=e.conversationID,s=e.count,a=e.lastMessageTime,r=(e=e.messageKey,"peerAccount:".concat(o," count:").concat(s||15," lastMessageTime:").concat(a||0," messageKey:").concat(e)),c=(Pe.l("".concat(n," ").concat(r)),new ao("getRoamingMessage"));return this.req({P:Kn.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:s||15,lastMessageTime:a||0,messageKey:e}}).then((function(e){var o=(e=e.data).complete,s=e.messageList,a=e.messageKey,u=(e=e.lastMessageTime,ht(s)?Pe.l("".concat(n," ok. complete:").concat(o," but messageList is undefined!")):Pe.l("".concat(n," ok. complete:").concat(o," count:").concat(s.length)),c.setMessage("".concat(r," complete:").concat(o," length:").concat(s.length)).end(),t.get(11)),l=((o=1===o)&&u.setCompleted(i),[]);return s=u.onRoamingMessage(s,i,!0,l),u.modifyMessageList(i),u.updateIsRead(i),u.updateRoamingMsgKeyAndTime(i,a,e),a=u.getPeerReadTime(i),Pe.l("".concat(n," update isPeerRead property. convID:").concat(i," peerReadTime:").concat(a)),a?u.updateMsgIsPeerReadProp(i,a):(e=i.replace(k.CONV_C2C,""),t.getRemotePeerReadTime([e]).then((function(){u.updateMsgIsPeerReadProp(i,u.getPeerReadTime(i))}))),a="",0<s.length?a=s[0].ID:(e=u.getLocalOldestMessage(i))&&(a=e.ID),Pe.l("".concat(n," nextReqID:").concat(a," storedMsgCount:").concat(s.length)),{nextReqID:a,storedMessageList:s,assembledMessageList:l,isPullingCompleted:o}})).catch((function(e){return c.setMessage(r).setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessagesHopping"),o=e.peerAccount,i=void 0===(i=e.time)?0:i,s=e.count,a=e.direction,r="".concat(k.CONV_C2C).concat(o),c="peerAccount:".concat(o," count:").concat(s," time:").concat(i," direction:").concat(a),u=(Pe.l("".concat(n," ").concat(c)),new ao("getRoamingMessagesHopping"));return this.req({P:Kn.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:s+1,lastMessageTime:i,direction:a}}).then((function(e){var o=(e=e.data).complete,i=void 0===(i=e.messageList)?[]:i,s=(e=e.lastMessageTime,"complete:".concat(o," count:").concat(i.length)),l=(Pe.l("".concat(n," ok. ").concat(s)),u.setMessage("".concat(c," ").concat(s)).end(),1!==o&&(1===a?i.pop():i.shift()),t.get(11));return s=l.onRoamingMessage(i,r,!1),t._modifyMessageList(r,s),i=t._computeResult({complete:o,lastMessageTime:e,resultList:s}),l.storeHoppingMessageList(i.messageList),o=l.getPeerReadTime(r),Pe.l("".concat(n," update isPeerRead property. convID:").concat(r," peerReadTime:").concat(o)),o?l.updateMsgIsPeerReadProp(r,o):(e=r.replace(k.CONV_C2C,""),t.getRemotePeerReadTime([e]).then((function(){l.updateMsgIsPeerReadProp(r,l.getPeerReadTime(r))}))),Sn(i)})).catch((function(e){return u.setMessage(c).setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"_computeResult",value:function(e){var t=void 0===(t=e.complete)?0:t,n=e.lastMessageTime;return e={messageList:v(void 0===(e=e.resultList)?[]:e),isCompleted:!1,nextMessageTime:""},1===t?e.isCompleted=!0:e.nextMessageTime=n,e}},{key:"_modifyMessageList",value:function(e,t){if(e=this.get(11).getLocalConversation(e))for(var n=e.userProfile.nick,o=e.userProfile.avatar,i=(e=this.get(4).getNickAndAvatarByUserID(this.getMyUserID())).nick,s=e.avatar,a=t.length-1;0<=a;a--){var r=t[a];"in"===r.flow&&(r.nick!==n&&r.setNickAndAvatar({nick:n}),r.avatar!==o&&r.setNickAndAvatar({avatar:o})),"out"===r.flow&&(r.nick!==i&&r.setNickAndAvatar({nick:i}),r.avatar!==s&&r.setNickAndAvatar({avatar:s}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".").concat("getRemotePeerReadTime");if(je(e))return Promise.resolve();var o=new ao("getRemotePeerReadTime");return Pe.l("".concat(n," userIDList:").concat(e)),this.req({P:Kn.GET_C2C_PEER_READ_TIME,data:{userIDList:e}}).then((function(i){var s=i.data.peerReadTimeList;Pe.l("".concat(n," ok. peerReadTimeList:").concat(s));for(var a="",r=t.get(11),c=0;c<e.length;c++)a+="".concat(e[c],"-").concat(s[c]," "),0<s[c]&&r.recordPeerReadTime("".concat(k.CONV_C2C).concat(e[c]),s[c]);o.setMessage(a).end()})).catch((function(e){o.setError(e).end(),Pe.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=e[0].conversationID.replace(k.CONV_C2C,""),n=new ao("sendReadReceipt"),o=(n.setMessage("peerAccount:".concat(t)),this.getMyUserID());if(0===(e=e.filter((function(e){return e.from!==o&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}))).length)return kn({code:Hn.READ_RECEIPT_MSG_LIST_EMPTY});var i="".concat(this._n,".").concat("sendReadReceipt");return Pe.l("".concat(i,". peerAccount:").concat(t," length:").concat(e.length)),this.req({P:Kn.SEND_C2C_READ_RECEIPT,data:{peerAccount:t,messageInfoList:e}}).then((function(e){return n.end(),Pe.l("".concat(i," ok")),Sn()})).catch((function(e){return n.setError(e).end(),Pe.w("".concat(i," failed. error:"),e),kn(e)}))}},{key:"getReadReceiptList",value:function(e){var t=e[0].conversationID.replace(k.CONV_C2C,"");return Pe.l("".concat(this._n,".getReadReceiptList peerAccount:").concat(t," msgCount:").concat(e.length)),Dn({messageList:e})}},{key:"getMessageExtensions",value:function(e,t){return Pe.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({P:Kn.GET_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Pe.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),this.req({P:Kn.MODIFY_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),extensionList:t,operateType:n}})}},{key:"getMessageKey",value:function(e){var t=e.clientSequence,n=e.random;return e=e.time,"".concat(t,"_").concat(n,"_").concat(e)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._msgFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]);var Yo,zo=Xo,Wo={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)},Jo=(s($o,[{key:"_onCloudConfig",value:function(){var e=this._convM.getCloudConfig("topic_msg_limit");ht(e)||(this.TOPIC_MSG_LIMIT=Number(e)),Pe.l("".concat(this._n,"._onCloudConfig topicMsgLimit:").concat(this.TOPIC_MSG_LIMIT))}},{key:"onCheckTimer",value:function(e){if(e%20==0&&0<this._map.size){var t,n=S(this._map);try{for(n.s();!(t=n.n()).done;){var o=m(t.value,2),i=o[0],s=o[1];i.includes(Be)&&s.size>=this.TOPIC_MSG_LIMIT&&this._convM.clearMemMsg(i,!0)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"pushIn",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,o=!0,i=(this._map.has(n)||this._map.set(n,new Map),this._getUniqueIDOfMsg(e));if(this._map.get(n).has(i)){var s=this._map.get(n).get(i);if(!t||!0===s.isModified)return!1}return this._map.get(n).set(i,e),this._setLatestMsgSentByPeer(n,e),this._setLatestMsgSentByMe(n,e),o}},{key:"unshift",value:function(e,t){var n;if(Xe(e)?0<e.length&&(n=e[0].conversationID,this._unshiftMultipleMsgs(e,t)):(n=e.conversationID,this._unshiftSingleMsg(e,t)),n){var o=Array.from(this._map.get(n).values());if(0!==(e=o.length)){for(var i=e-1;0<=i;i--)if("out"===o[i].flow){this._setLatestMsgSentByMe(n,o[i]);break}if(n.startsWith(k.CONV_C2C))for(var s=e-1;0<=s;s--)if("in"===o[s].flow){this._setLatestMsgSentByPeer(n,o[s]);break}}}}},{key:"_unshiftSingleMsg",value:function(e,t){var n=e.conversationID,o=this._getUniqueIDOfMsg(e);if(!this._map.has(n))return this._map.set(n,new Map),this._map.get(n).set(o,e),void t.push(e);var i=this._map.get(n),s=Array.from(i);i.has(o)||(s.unshift([o,e]),this._map.set(n,new Map(s)),t.push(e))}},{key:"_unshiftMultipleMsgs",value:function(e,t){for(var n=e.length,o=[],i=e[0].conversationID,s=this._map.get(i),a=this._map.has(i)?Array.from(s):[],r=0;r<n;r++){var c=this._getUniqueIDOfMsg(e[r]);s&&s.has(c)||(o.push([c,e[r]]),t.push(e[r]))}this._map.set(i,new Map(o.concat(a)))}},{key:"remove",value:function(e){var t=e.conversationID;e=this._getUniqueIDOfMsg(e),this._map.has(t)&&this._map.get(t).delete(e)}},{key:"revoke",value:function(e,t,n){var o;return this._map.has(e)?(o=this._map.get(e),this._updateMsgIsRevoked(o,t,n)):this._hoppingMsgMap.has(e)?(o=this._hoppingMsgMap.get(e),this._updateMsgIsRevoked(o,t,n)):null}},{key:"_updateMsgIsRevoked",value:function(e,t,n){var o,i=S(e);try{for(i.s();!(o=i.n()).done;){var s=m(o.value,2)[1];if(s.sequence===t&&(ht(n)||s.random===n))return s.isRevoked||(s.isRevoked=!0),s}}catch(a){i.e(a)}finally{i.f()}}},{key:"removeByConvID",value:function(e){var t=this._map.has(e);Pe.l("".concat(this._n,".removeByConvID convID:").concat(e," has:").concat(t)),t&&(this._map.delete(e),this._latestMsgSentByPeerMap.delete(e),this._latestMsgSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t=null;return(t=this._findMsg(e,this._map))?t:this._findMsg(e,this._hoppingMsgMap)}},{key:"_findMsg",value:function(e,t){var n,o=null,i=S(t);try{for(i.s();!(n=i.n()).done;)for(var s=v(m(n.value,2)[1].values()),a=s.length,r=0;r<a;r++)if(s[r].ID===e){o=s[r];break}}catch(c){i.e(c)}finally{i.f()}return o}},{key:"updateMsgIsPeerReadProp",value:function(e,t){var n,o=[];return this._map.has(e)?(n=this._map.get(e),o=this._updateMsgIsPeerReadProp(n,t)):this._hoppingMsgMap.has(e)&&(n=this._hoppingMsgMap.get(e),o=this._updateMsgIsPeerReadProp(n,t)),Pe.l("".concat(this._n,".updateMsgIsPeerReadProp convID:").concat(e," peerReadTime:").concat(t," count:").concat(o.length)),o}},{key:"_updateMsgIsPeerReadProp",value:function(e,t){var n,o=[],i=S(e);try{for(i.s();!(n=i.n()).done;){var s=m(n.value,2)[1];s.time<=t&&!s.isPeerRead&&"out"===s.flow&&(s.isPeerRead=!0,o.push(s))}}catch(a){i.e(a)}finally{i.f()}return o}},{key:"updateMsgIsModifiedProp",value:function(e){var t=e.conversationID;this._map.has(t)&&(e=this._getUniqueIDOfMsg(e),(t=this._map.get(t).get(e))&&(t.isModified=!0))}},{key:"hasLocalMsgList",value:function(e){return this._map.has(e)}},{key:"getLocalMsgList",value:function(e){return this.hasLocalMsgList(e)?v(this._map.get(e).values()):[]}},{key:"getLocalMaxSeq",value:function(e){return this.hasLocalMsgList(e)?(e=v(this._map.get(e).values()).map((function(e){return e.sequence})),Math.max.apply(Math,v(e))):0}},{key:"getLocalMaxTime",value:function(e){return this.hasLocalMsgList(e)?(e=v(this._map.get(e).values()).map((function(e){return e.time})),Math.max.apply(Math,v(e))):0}},{key:"hasLocalMsg",value:function(e,t){for(var n=!1,o=this.getLocalMsgList(e),i=o.length,s=0;s<i;s++)o[s].ID===t&&(n=!0);return n}},{key:"getLocalMsg",value:function(e,t){for(var n=null,o=this.getLocalMsgList(e),i=o.length,s=0;s<i;s++)if(o[s].ID===t){n=o[s];break}return n}},{key:"getLocalLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-1]}},{key:"getLocalSecondLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-2]}},{key:"getLocalOldestMsg",value:function(e){return this.getLocalMsgList(e)[0]}},{key:"_setLatestMsgSentByPeer",value:function(e,t){e.startsWith(k.CONV_C2C)&&"in"===t.flow&&this._latestMsgSentByPeerMap.set(e,t)}},{key:"_setLatestMsgSentByMe",value:function(e,t){"out"===t.flow&&this._latestMsgSentByMeMap.set(e,t)}},{key:"getLatestMsgSentByPeer",value:function(e){return this._latestMsgSentByPeerMap.get(e)}},{key:"getLatestMsgSentByMe",value:function(e){return this._latestMsgSentByMeMap.get(e)}},{key:"modifyMsgSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar;if(!je(e=this._map.get(t))){var i=Array.from(e.values());if(0!==(e=i.length)){for(var s=null,a=0,r=!1,c=e-1;0<=c;c--)"in"===i[c].flow&&((s=i[c]).nick!==n&&(s.setNickAndAvatar({nick:n}),r=!0),s.avatar!==o&&(s.setNickAndAvatar({avatar:o}),r=!0),r&&(a+=1));Pe.l("".concat(this._n,".modifyMsgSentByPeer convID:").concat(t," count:").concat(a))}}}},{key:"modifyMsgSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar;if(!je(e=this._map.get(t))){var i=Array.from(e.values());if(0!==(e=i.length)){for(var s=null,a=0,r=!1,c=e-1;0<=c;c--)"out"===i[c].flow&&((s=i[c]).nick!==n&&(s.setNickAndAvatar({nick:n}),r=!0),s.avatar!==o&&(s.setNickAndAvatar({avatar:o}),r=!0),r&&(a+=1));Pe.l("".concat(this._n,".modifyMsgSentByMe convID:").concat(t," count:").concat(a))}}}},{key:"getTopicConvIDList",value:function(e){return v(this._map.keys()).filter((function(t){return t.startsWith("".concat(k.CONV_GROUP).concat(e))}))}},{key:"onMsgModified",value:function(e,t){if(!this._map.has(e)&&!this._hoppingMsgMap.has(e))return{isUpdated:!1,message:null};var n="".concat(this._n,".onMsgModified"),o=this._getUniqueIDOfMsg(t),i=this._getTargetMsg(e,o),s=!!i;return Pe.l("".concat(n," convID:").concat(e," uniqueID:").concat(o," has:").concat(s)),s?(e=t.messageVersion,o=t.elements,s=t.cloudCustomData,t=t.checkResult,Pe.l("".concat(n," localVersion:").concat(i.version," remoteVersion:").concat(e)),i.version<e?(i.version=e,i._elements=JSON.parse(JSON.stringify(o)),i.payload=i._elements[0].content,i.type=i._elements[0].type,i.cloudCustomData=s,i.isModified=!0,i.hasRiskContent=$t(t),{isUpdated:!0,message:i}):{isUpdated:!1,message:i}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMsg",value:function(e){var t=e.from,n=e.to,o=e.random,i=e.sequence;return e=e.time,"".concat(t,"-").concat(n,"-").concat(o,"-").concat(i,"-").concat(e)}},{key:"_getTargetMsg",value:function(e,t){if(this._map.has(e))return this._map.get(e).get(t);var n=void 0;if(this._hoppingMsgMap.has(e))for(var o=v(this._hoppingMsgMap.get(e).values()),i=0;i<o.length;i++)if(this._getUniqueIDOfMsg(o[i])===t){n=o[i];break}return n}},{key:"storeHoppingMsgList",value:function(e){if(0!==e.length){var t=e[0].conversationID,n=e.length;this._hoppingMsgMap.has(t)||this._hoppingMsgMap.set(t,new Map);for(var o=this._hoppingMsgMap.get(t),i=0;i<n;i++){var s=e[i];o.has(s.ID)||o.set(s.ID,s)}}}},{key:"getHoppingMsg",value:function(e,t){if(this._hoppingMsgMap.has(e))return this._hoppingMsgMap.get(e).get(t)}},{key:"reset",value:function(){this._map.clear(),this._latestMsgSentByPeerMap.clear(),this._latestMsgSentByMeMap.clear(),this._hoppingMsgMap.clear()}}]),$o);function $o(e){o(this,$o),this._convM=e,this._map=new Map,this._n="MsgListHandler",this._latestMsgSentByPeerMap=new Map,this._latestMsgSentByMeMap=new Map,this._hoppingMsgMap=new Map,this.TOPIC_MSG_LIMIT=1e3,this._convM.getIEmitInst().on(Wo.CLOUD_CONFIG,this._onCloudConfig,this)}function Xo(e){return o(this,Xo),(e=Yo.call(this,e))._n="C2CModule",e._msgFromUnreadDBMap=new Map,e._noticeFromUnreadDBList=[],e}function Zo(e){this.mixin(e)}function Qo(e,n,o){return ht(e)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:o&&e.ID||e instanceof Oo?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:Bt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:Bt(e.type,e.payload,n)})}function ei(e,t){return je(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:Bt(e.type,e.payload,t),nick:e.nick||"",avatar:e.avatar||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}}function ti(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var o,i,s=0,a=0;i=t.charAt(a++);~i&&(o=s%4?64*o+i:i,s++%4)&&(n+=String.fromCharCode(255&o>>(-2*s&6))))i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);try{return decodeURIComponent(escape(n))}catch(r){return""}}Zo.mixin=function(e){(e=e.prototype||e)._isReady=!1,e.ready=function(e){if(e)return this._isReady?void(1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},e.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&0<t.length&&t.forEach((function(e){e.call(this)}),e)}),1)},e.resetReady=function(){this._isReady=!1,this._readyQueue=[]},e.isReady=function(){return this._isReady}};var ni,oi,ii,si,ai,ri=["jpg","jpeg","gif","png","bmp","image","webp"],ci=["mp4","quicktime","mov"],ui=(s(ps,[{key:"validate",value:function(e){var t,n=!0,o="";if(je(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,s=null,a=0;a<i;a++){if(s=e.profileCustomField[a],!pt(s.key)||-1===s.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!pt(s.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("profileCustomField"===t)continue;if(je(e[t])&&!pt(e[t])&&!We(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":pt(e[t])||(n=!(o="nick must be a string")),500<st(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(st(e[t])," bytes"),n=!1);break;case"gender":ct(we,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":We(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":pt(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":pt(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":ct(xe,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":We(e.language)||(n=!(o="language must be a number"));break;case"avatar":pt(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":ct(Fe,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":We(e.level)||(n=!(o="level must be a number"));break;case"role":We(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}}]),ps),li=(s(ds,[{key:"set",value:function(e){var t;this.map.size>=this.MAX_LENGTH&&(t=this.map.entries().next().value[0],this.map.delete(t)),this.map.set(e,1)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"reset",value:function(){this.map.clear()}}]),ds),di=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],pi=(s(ls,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)di.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;(e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0),e=JSON.parse(JSON.stringify(e))).lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),ht(e.muteAllMembers)||("On"===e.muteAllMembers?e.muteAllMembers=!0:e.muteAllMembers=!1),e.groupCustomField&&It(this.groupCustomField,e.groupCustomField),ht(e.memberNum)||(this.memberCount=e.memberNum),ht(e.maxMemberNum)||(this.maxMemberCount=e.maxMemberNum),ht(e.isSupportTopic)||(this.isSupportTopic=We(e.isSupportTopic)?1===e.isSupportTopic:e.isSupportTopic),ot(this,e,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),Xe(e.members)&&0<e.members.length&&e.members.forEach((function(e){e.userID===t.selfInfo.userID&&ot(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){e={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList},ot(this.selfInfo,t({},e),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),ls),hi=(s(us,[{key:"toAccount",get:function(){return this.conversationID.startsWith(k.CONV_C2C)?this.conversationID.replace(k.CONV_C2C,""):this.conversationID.startsWith(k.CONV_GROUP)?this.conversationID.replace(k.CONV_GROUP,""):""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),ht(this.userProfile)&&this.type===k.CONV_C2C?this.userProfile=new ui({userID:e.conversationID.replace("C2C","")}):ht(this.groupProfile)&&this.type===k.CONV_GROUP&&(this.groupProfile=new pi({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations;e=e.isUnreadC2CMessage,ht(t)||(Et(this.subType)?this.unreadCount=0:n&&this.type===k.CONV_GROUP||n&&this.type===k.CONV_TOPIC||e&&this.type===k.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=Qo(e)}},{key:"updateGroupAtInfoList",value:function(e){var t;this._isNeedMergeGroupAtInfo(e)||(-1!==(t=(y(t=e.groupAtType)||I(t)||C(t)||E()).slice(0)).indexOf(k.CONV_AT_ME)&&-1!==t.indexOf(k.CONV_AT_ALL)&&(t=[k.CONV_AT_ALL_AT_ME]),t={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:t,__random:e.__random,__sequence:e.__sequence},this.groupAtInfoList.push(t))}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!St({groupID:t}))return!1;var o=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(-1<t.atTypeArray.indexOf(k.CONV_AT_ME)&&-1<e.groupAtType.indexOf(k.CONV_AT_ALL)&&(t.atTypeArray=[k.CONV_AT_ALL_AT_ME]),-1<t.atTypeArray.indexOf(k.CONV_AT_ALL)&&-1<e.groupAtType.indexOf(k.CONV_AT_ME)&&(t.atTypeArray=[k.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),o=!0)})),o}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence;return e=e.time,this.type===k.CONV_C2C&&t===this.lastMessage.lastSequence&&e===this.lastMessage.lastTime||this.type===k.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}},{key:"setDraftText",value:function(e){this.draftText=e}}]),us),gi=(a(Fn={},k.MSG_REMIND_ACPT_AND_NOTE,0),a(Fn,k.MSG_REMIND_DISCARD,1),a(Fn,k.MSG_REMIND_ACPT_NOT_NOTE,2),Fn),_i=(s(cs,[{key:"onAllRcvMsgOptNotify",value:function(e){e=this._handleResult(e),this._convM.emitOEvt(D.ALL_RECEIVE_MESSAGE_OPT_UPDATED,e)}},{key:"getC2CMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".getC2CMsgRemindType");return this._convM.req({P:Kn.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:e}}).then((function(o){Pe.l("".concat(n," ok. userIDList:").concat(e)),o=o.data.muteFlagList,t._convM.onC2CMsgRemindTypeFetched(o)})).catch((function(e){Pe.e("".concat(n," failed. error:"),e)}))}},{key:"set",value:function(e){return e.groupID?this._setGroupMsgRemindType(e):Xe(e.userIDList)?this._setC2CMsgRemindType(e):void 0}},{key:"_setGroupMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".").concat("_setGroupMsgRemindType"),o=e.groupID,i=e.messageRemindType,s="groupID:".concat(o," messageRemindType:").concat(i),a=new ao("_setGroupMsgRemindType"),r=(a.setMessage(s),this._get(7));return r?r.modifyGroupMemberInfo({groupID:o,messageRemindType:i,userID:this._convM.getMyUserID()}).then((function(){a.end(),Pe.l("".concat(n," ok. ").concat(s));var o=t.onGroupMsgRemindTypeUpdated(e);return t._convM.onTotalUnreadCountUpdate(),Sn(o)})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)})):kn({code:Hn.NO_MODULE})}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){var t,n,o=e.groupID,i=(e=e.messageRemindType,Pe.l("".concat(this._n,".onGroupMsgRemindTypeUpdated groupID:").concat(o," messageRemindType:").concat(e)),this._get(7).getLocalGroupProfile(o));return i&&(i.selfInfo.messageRemindType=e),Dt(o)?(t=qt(n=o),(n=this._get(10).getLocalTopic(t,n))&&n.updateSelfInfo({messageRemindType:e})&&this._convM.emitOEvt(D.TOPIC_UPDATED,{groupID:t,topic:n}),{topic:n}):(this._convM.patchMsgRemindType({ID:o,isC2CConversation:!1,messageRemindType:e})&&this._emitConvUpdate(),{group:i})}},{key:"_setC2CMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".").concat("_setC2CMsgRemindType"),o=e.userIDList,i=e.messageRemindType,s=o.slice(0,30),a=(e=gi[i]||0,"userIDList:".concat(s," messageRemindType:").concat(i)),r=new ao("_setC2CMsgRemindType");return r.setMessage(a),this._convM.req({P:Kn.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:s,muteFlag:e}}).then((function(e){r.end(),e=e.data.errorList;var o=[],c=[],u=(Xe(e)&&e.forEach((function(e){o.push(e.userID),c.push({userID:e.userID,code:e.errorCode})})),e=s.filter((function(e){return-1===o.indexOf(e)})),Pe.l("".concat(n," ok. ").concat(a," successUserIDList:").concat(e," failureUserIDList:").concat(JSON.stringify(c))),0);return e.forEach((function(e){t._convM.patchMsgRemindType({ID:e,isC2CConversation:!0,messageRemindType:i})&&(u+=1)})),1<=u&&t._emitConvUpdate(),s.length=o.length=0,t._convM.onTotalUnreadCountUpdate(),Dn({successUserIDList:e.map((function(e){return{userID:e}})),failureUserIDList:c})})).catch((function(e){return r.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"_get",value:function(e){return this._convM.get(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"setAllRcvMsgOpt",value:function(e){var t="".concat(this._n,".").concat("setAllRcvMsgOpt"),n=void 0===(n=e.messageRemindType)?k.MSG_REMIND_ACPT_NOT_NOTE:n,o=void 0===(o=e.isRepeated)||o,i=void 0===(i=(s=this._calcStartAndEndTime(e)).startTime)?0:i,s=void 0===(s=s.endTime)?0:s,a=(e=JSON.stringify(e),new ao("setAllRcvMsgOpt"));return a.setMessage(e),Pe.l("".concat(t," options:").concat(e)),this._convM.req({P:Kn.SET_ALL_RECEIVE_MSG_OPT,data:{messageRemindType:gi[n],startTime:i,endTime:s,isRepeated:o?1:0}}).then((function(e){return a.end(),Pe.l("".concat(t," ok.")),Sn(e)})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"_calcStartAndEndTime",value:function(e){var t=void 0===(t=e.startHour)?0:t,n=void 0===(n=e.startMinute)?0:n,o=void 0===(o=e.startSecond)?0:o,i=void 0===(i=e.duration)?0:i,s=(e=void 0===(e=e.isRepeated)||e,(r=new Date).getFullYear()),a=r.getMonth(),r=r.getDate();return{startTime:s=Math.round(new Date(s,a,r,t,n,o).getTime()/1e3),endTime:e&&86400<=i?s+86400:s+i}}},{key:"getAllRcvMsgOpt",value:function(){var e=this,t="".concat(this._n,".").concat("getAllRcvMsgOpt"),n=new ao("getAllRcvMsgOpt");return this._convM.req({P:Kn.GET_ALL_RECEIVE_MSG_OPT,data:{toAccount:this._convM.getMyUserID()}}).then((function(o){return o=o.data,n.setMessage(JSON.stringify(o)).end(),Pe.l("".concat(t," ok. data:").concat(JSON.stringify(o))),Sn(o=e._handleResult(o))})).catch((function(e){return n.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"_handleResult",value:function(e){var t=e.messageRemindType,n=e.startTime,o=e.endTime,i=(e=e.isRepeated,k.MSG_REMIND_ACPT_AND_NOTE);return 1===t&&(i=k.MSG_REMIND_DISCARD),{messageRemindType:i=2===t?k.MSG_REMIND_ACPT_NOT_NOTE:i,startTime:n,endTime:o,isRepeated:1===e}}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset"))}}]),cs),fi=(s(rs,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),o=e.conversationIDList,i=e.customData,s=(Pe.l("".concat(n," options:"),e),new ao("setConvCustomData")),a=(s.setMessage(JSON.stringify(e)),{fromAccount:this._getMyUserID(),itemList:[]}),r=[],c=[];return o.forEach((function(e){if(!t._hasLocalConv(e))return t._onConvNotFound(c,e),!0;if(!kt(e)&&!Rt(e))return t._onConvIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:i};kt(e)?n.contactItem={type:1,toAccount:e.replace(k.CONV_C2C,"")}:Rt(e)&&(n.contactItem={type:2,groupID:e.replace(k.CONV_GROUP,"")}),a.itemList.push(n)})),c.length===o.length?Dn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:Kn.SET_CONV_CUSTOM_DATA,data:a}).then((function(e){var o,a,u;return s.end(),Pe.l("".concat(n," ok")),Xe(e=e.data.resultItem)&&(u=!1,e.forEach((function(e){o=t._concatConvID(e.contactItem),0===e.resultCode?(r.push(o),(a=t._getLocalConv(o))&&a.customData!==i&&(a.customData=i,u=!0)):c.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConvUpdate()),Sn({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return s.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"markConv",value:function(e){var t=this;if(!this._convM.canIUse(w.CONV_MARK))return this._convM.noUse("markConv");var n="".concat(this._n,".").concat("markConv"),o=e.conversationIDList,i=e.markType,s=e.enableMark,a=(Pe.l("".concat(n," options:"),e),new ao("markConv")),r=void a.setMessage(JSON.stringify(e)),c=void 0,u=(e=this._getFlagBit(i),!0===s?c=[e]:r=[e],{fromAccount:this._getMyUserID(),itemList:[]}),l=[],d=[];return o.forEach((function(e){if(!t._hasLocalConv(e))return t._onConvNotFound(d,e),!0;if(!kt(e)&&!Rt(e))return t._onConvIDInvalid(d,e),!0;var n={operationType:1,contactItem:void 0,clearMark:r,setMark:c};kt(e)?n.contactItem={type:1,toAccount:e.replace(k.CONV_C2C,"")}:Rt(e)&&(n.contactItem={type:2,groupID:e.replace(k.CONV_GROUP,"")}),u.itemList.push(n)})),d.length===o.length?Dn({successConversationIDList:l,failureConversationIDList:d}):this._convM.req({P:Kn.MARK_CONV,data:u}).then((function(e){var o,r,c;return a.end(),Pe.l("".concat(n," ok")),Xe(e=e.data.resultItem)&&(c=!1,e.forEach((function(e){var n;o=t._concatConvID(e.contactItem),0===e.resultCode?(l.push(o),(r=t._getLocalConv(o))&&(n=r.markList.indexOf(i),!0===s?-1===n&&(r.markList.push(i),c=!0):-1!==n&&(r.markList.splice(n,1),c=!0))):d.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===c&&t._emitConvUpdate()),Sn({successConversationIDList:l,failureConversationIDList:d})})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return Pe.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===Un?this.getRemoteConvGroupList().then((function(){return Sn(v(e._convGroupMap.values()))})):Dn(v(this._convGroupMap.values()))}},{key:"searchConvGroupAndMark",value:function(e,t){var n=this,o="".concat(this._n,".searchConvGroupAndMark"),i=[];return e.forEach((function(e){1===t?i.push({type:1,toAccount:e}):2===t&&i.push({type:2,groupID:e})})),Pe.l("".concat(o," type:").concat(t," list:"),e),this._convM.req({P:Kn.SEARCH_CONV_GRP_MARK,data:{fromAccount:this._getMyUserID(),contactItem:i}}).then((function(e){var t=(e=e.data).contactItem;e=e.groupItem,Pe.l("".concat(o," ok. contactItem:"),t,"groupItem:",e),n._fillConvGroupMap(e),n._handleContactItem(t),n._emitConvUpdate()})).catch((function(e){Pe.w("".concat(o," failed. error:"),e)}))}},{key:"_fillConvGroupMap",value:function(e){var t=this;Xe(e)&&e.forEach((function(e){var n=e.convGroupID;e=e.groupName,t._convGroupMap.set(n,e)}))}},{key:"_handleContactItem",value:function(e){var t,n=this;Xe(e)&&e.forEach((function(e){var o=[],i=e.standardMark,s=e.customData,a=e.convGroupIDList;Xe(a)&&a.forEach((function(e){n._convGroupMap.has(e)&&o.push(n._convGroupMap.get(e))})),t=n._concatConvID(e),(t=n._getLocalConv(t))&&(t.markList=jt(i),t.customData=s||"",t.conversationGroupList=[].concat(o))}))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=Pn,this._convM.req({P:Kn.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex}}).then((function(n){var o=(n=n.data).completeFlag,i=n.contactItem,s=void 0===(s=n.nextStartIndex)?0:s;if(n=n.groupItem,e._startIndex=s,Pe.l("".concat(t," completeFlag:").concat(o," nextStartIndex:").concat(s,", groupItem:"),n,"contactItem:",i),e._fillConvGroupMap(n),e._handleContactItem(i),0===o)return e.getRemoteConvGroupList();1===o&&(e._pagingStatus=bn,e._emitConvUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=Un,Pe.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._convM.canIUse(w.CONV_GROUP))return this._convM.noUse("createConvGroup");var n="".concat(this._n,".").concat("createConvGroup"),o=(Pe.l("".concat(n," options:"),e),new ao("createConvGroup")),i=(o.setMessage(JSON.stringify(e)),e.groupName),s=(e=e.conversationIDList,{fromAccount:this._getMyUserID(),itemList:[{groupName:i,contactItem:[]}]}),a=[],r=[];return e.forEach((function(e){return t._hasLocalConv(e)?kt(e)||Rt(e)?void(kt(e)?s.itemList[0].contactItem.push({type:1,toAccount:e.replace(k.CONV_C2C,"")}):Rt(e)&&s.itemList[0].contactItem.push({type:2,groupID:e.replace(k.CONV_GROUP,"")})):(t._onConvIDInvalid(r,e),!0):(t._onConvNotFound(r,e),!0)})),r.length===e.length?Dn({successConversationIDList:a,failureConversationIDList:r}):this._convM.req({P:Kn.CREATE_CONV_GRP,data:s}).then((function(e){o.end(),Pe.l("".concat(n," ok"));var s,c,u,l=(e=e.data.groupResultItem[0]).groupItem;return e=e.resultItem,$e(l)&&(t._convGroupMap.set(l.convGroupID,l.groupName),t._emitConvGroupListUpdate()),Xe(e)&&(u=!1,e.forEach((function(e){s=t._concatConvID(e.contactItem),0===e.resultCode?(a.push(s),(c=t._getLocalConv(s))&&-1===c.conversationGroupList.indexOf(i)&&(c.conversationGroupList.push(i),u=!0)):r.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===u&&(t._emitConvUpdate(),t._emitConvGroupListUpdate())),Sn({successConversationIDList:a,failureConversationIDList:r})})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._convM.canIUse(w.CONV_GROUP))return this._convM.noUse("deleteConvGroup");var n="".concat(this._n,".").concat("deleteConvGroup"),o=(Pe.l("".concat(n," groupName:").concat(e)),new ao("deleteConvGroup"));return o.setMessage(e),this._convM.req({P:Kn.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(i){var s;o.end(),Pe.l("".concat(n," ok")),Xe(i=i.data.groupItem)&&(s=!1,i.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),s=!0)})),!0===s&&t._emitConvGroupListUpdate()),t._eraseFromConversationGroupList([e])})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._convM.canIUse(w.CONV_GROUP))return this._convM.noUse("renameConvGroup");var n="".concat(this._n,".").concat("renameConvGroup"),o=(Pe.l("".concat(n," options:"),e),new ao("renameConvGroup")),i=(o.setMessage(JSON.stringify(e)),e.oldName),s=e.newName;return this._convM.req({P:Kn.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:i,newName:s}}}).then((function(e){o.end(),Pe.l("".concat(n," ok")),e=e.data.updateGroupResult.convGroupID,t._convGroupMap.set(e,s),t._emitConvGroupListUpdate(),e=t._convM.getLocalConvList();var a,r,c=!1;e.forEach((function(e){a=e.conversationGroupList,-1!==(r=a.indexOf(i))&&(a.splice(r,1,s),c=!0)})),!0===c&&t._emitConvUpdate()})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._convM.canIUse(w.CONV_GROUP))return this._convM.noUse("addConvsToGroup");var n="".concat(this._n,".").concat("addConvsToGroup"),o=(Pe.l("".concat(n," options:"),e),new ao("addConvsToGroup")),i=(o.setMessage(JSON.stringify(e)),e.conversationIDList),s=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:s,updateItem:[]}},r=[],c=[];return i.forEach((function(e){return t._hasLocalConv(e)?kt(e)||Rt(e)?void(kt(e)?a.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(k.CONV_C2C,"")}}):Rt(e)&&a.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(k.CONV_GROUP,"")}})):(t._onConvIDInvalid(c,e),!0):(t._onConvNotFound(c,e),!0)})),c.length===i.length?Dn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:Kn.ADD_CONV_TO_GRP,data:a}).then((function(e){var i,a,u;return o.end(),Pe.l("".concat(n," ok")),Xe(e=e.data.updateGroupResult.contactResultItem)&&(u=!1,e.forEach((function(e){i=t._concatConvID(e.contactItem),0===e.resultCode?(a=t._getLocalConv(i))&&-1===a.conversationGroupList.indexOf(s)&&(a.conversationGroupList.push(s),r.push(i),u=!0):c.push({conversationID:i,code:e.resultCode,message:e.resultInfo})})),!0===u&&(t._emitConvUpdate(),t._emitConvInGroupUpdate(s))),Sn({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this,n="deleteConvsFromGroup";if(!this._convM.canIUse(w.CONV_GROUP))return this._convM.noUse(n);var o="".concat(this._n,".").concat(n),i=(Pe.l("".concat(o," options:"),e),new ao(n)),s=(i.setMessage(JSON.stringify(e)),n=e.conversationIDList,e.groupName),a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:s,updateItem:[]}},r=[],c=[];return n.forEach((function(e){return t._hasLocalConv(e)?kt(e)||Rt(e)?void(kt(e)?a.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(k.CONV_C2C,"")}}):Rt(e)&&a.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(k.CONV_GROUP,"")}})):(t._onConvIDInvalid(c,e),!0):(t._onConvNotFound(c,e),!0)})),c.length===n.length?Dn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:Kn.DEL_CONV_FROM_GRP,data:a}).then((function(e){var n,a,u;return i.end(),Pe.l("".concat(o," ok")),Xe(e=e.data.updateGroupResult.contactResultItem)&&(u=!1,e.forEach((function(e){var o;n=t._concatConvID(e.contactItem),0===e.resultCode?!(a=t._getLocalConv(n))||-1!==(o=a.conversationGroupList.indexOf(s))&&(a.conversationGroupList.splice(o,1),r.push(n),u=!0):c.push({conversationID:n,code:e.resultCode,message:e.resultInfo})})),!0===u&&(t._emitConvUpdate(),t._emitConvInGroupUpdate(s))),Sn({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t,n,o=this;je(e)||(Pe.l("".concat(this._n,".onConvMarkUpdated markItemList:"),e),n=!1,e.forEach((function(e){var i=e.recentContactItem,s=e.optType,a=e.standardMark;e=e.customMark,t=o._concatConvID(i),(t=o._getLocalConv(t))&&(1===s?n=o._diffStandardMark(t,a):2===s?n=o._diffCustomMark(t,e):3===s&&(i=o._diffStandardMark(t,a),s=o._diffCustomMark(t,e),n=i||s))})),!0===n&&this._emitConvUpdate())}},{key:"_diffStandardMark",value:function(e,t){t=jt(t);var n=!1;return!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]!==t[n])return!1;return!0}(e.markList,t)&&(e.markList=t,n=!0),n}},{key:"_diffCustomMark",value:function(e,t){var n=!1;return e.customData!==t&&void 0!==t&&(e.customData=t,n=!0),n}},{key:"onConvGroupCreated",value:function(e){var t=this,n=(Pe.l("".concat(this._n,".onConvGroupCreated resultList:"),e),!1),o=!1;Xe(e)&&(e.forEach((function(e){var i,s,a=(s=e.msgGroupItem).groupID,r=s.groupName;t._convGroupMap.get(a)!==r&&(t._convGroupMap.set(a,r),o=!0),Xe(s=e.msgRecentContactItem)&&s.forEach((function(e){i=t._concatConvID(e),(i=t._getLocalConv(i))&&-1===i.conversationGroupList.indexOf(r)&&(i.conversationGroupList.push(r),n=!0)}))})),!0===n&&this._emitConvUpdate(),!0===o&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t,n=this,o=(Pe.l("".concat(this._n,".onConvGroupDeleted groupItemList:"),e),[]);Xe(e)&&(t=!1,e.forEach((function(e){var i=e.groupID;e=e.groupName,n._convGroupMap.has(i)&&(n._convGroupMap.delete(i),t=!0,o.push(e))})),!0===t&&this._emitConvGroupListUpdate()),this._eraseFromConversationGroupList(o)}},{key:"_eraseFromConversationGroupList",value:function(e){je(e)||(this._convM.getLocalConvList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConvUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Pe.l("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t,n,o,i=e.groupID,s=e.groupName,a=e.oldGroupName;this._convGroupMap.get(i)!==s&&(this._convGroupMap.set(i,s),this._emitConvGroupListUpdate(),e=this._convM.getLocalConvList(),o=!1,e.forEach((function(e){t=e.conversationGroupList,-1!==(n=t.indexOf(a))&&(t.splice(n,1,s),o=!0)})),!0===o&&this._emitConvUpdate())}},{key:"onConvInGroupUpdated",value:function(e){var t,n,o,i=this,s=(Pe.l("".concat(this._n,".onConvInGroupUpdated options:"),e),e.oldGroupName);Xe(e=e.recentContactUpdateGroupItem)&&(o=!1,e.forEach((function(e){var a=e.contactOptType;e=e.recentContactItem,t=i._concatConvID(e),(t=i._getLocalConv(t))&&(n=t.conversationGroupList.indexOf(s),1===a?-1===n&&(t.conversationGroupList.push(s),o=!0):2===a&&-1!==n&&(t.conversationGroupList.splice(n,1),o=!0))})),!0===o&&(this._emitConvUpdate(),this._emitConvInGroupUpdate(s)))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t,n,o=this,i=(Pe.l("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e),e.msgRecentContactItem),s=(e=e.msgRecentContactUpdateContactItem,i=this._concatConvID(i),this._getLocalConv(i));s&&Xe(e)&&(n=!1,e.forEach((function(e){var i=e.groupOptType;e=e.recentContactGroupItem.groupName,t=s.conversationGroupList.indexOf(e),1===i?-1===t&&(s.conversationGroupList.push(e),n=!0):2===i&&-1!==t&&(s.conversationGroupList.splice(t,1),n=!0),!0===n&&o._emitConvInGroupUpdate(e)})),!0===n&&this._emitConvUpdate())}},{key:"onConvGroupListSynced",value:function(e){Xe(e)&&0!==e.length&&(Pe.l("".concat(this._n,".onConvGroupListSynced groupItem:"),e),this._fillConvGroupMap(e))}},{key:"getConvGroupListByID",value:function(e){var t,n=this;if(!je(e))return t=[],e.forEach((function(e){n._convGroupMap.has(e)&&t.push(n._convGroupMap.get(e))})),t}},{key:"_onConvNotFound",value:function(e,t){e.push({conversationID:t,code:Hn.CONV_NOT_FOUND,message:this._convM.getErrMsg(Hn.CONV_NOT_FOUND)})}},{key:"_onConvIDInvalid",value:function(e,t){e.push({conversationID:t,code:Hn.INVALID_CONV_ID,message:this._convM.getErrMsg(Hn.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,o=n-1;0<=o;o--)if("1"===t[o])return n-o-1}},{key:"_concatConvID",value:function(e){var t,n=e.type,o=e.to,i=e.groupID;return e=e.userID,1===n?ht(e)?ht(o)||(t="".concat(k.CONV_C2C).concat(o)):t="".concat(k.CONV_C2C).concat(e):2===n&&(t="".concat(k.CONV_GROUP).concat(i)),t}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_getLocalConv",value:function(e){return this._convM.getLocalConversation(e)}},{key:"_hasLocalConv",value:function(e){return this._convM.hasLocalConversation(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOEvt(D.CONVERSATION_GROUP_LIST_UPDATED,v(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._convM.getLocalConvList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._convM.emitOEvt(D.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=Nn}}]),rs),mi=(r(as,wn),ai=f(as),s(as,[{key:"_initListeners",value:function(){var e=this.getIEmitInst();e.on(Wo.A2KEY_AND_TINYID_UPDATED,this._init,this),e.on(Wo.PROFILE_UPDATED,this._onProfileUpdated,this),e.on(Wo.CLOUD_CONFIG,this._onCloudConfig,this)}},{key:"_init",value:function(){var e=this,t=(Pe.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),n=this.isIntl(),o=this.isUsingChatCore();if(t){for(var i=t.length,s=0;s<i;s++){var a=t[s];if(a){if(this._isNonExistentAccount(a.conversationID))continue;if(a.groupProfile&&Et(a.groupProfile.type))continue}this._convMap.set(a.conversationID,new hi(t[s],n,o))}this.emitConvUpdate(!0,!1)}this.ready((function(){0<e._tmpGroupList.length&&(e.updateConvGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConvList()}},{key:"_isNonExistentAccount",value:function(e){var t;return"@TLS#ERROR"===(t=e.startsWith(k.CONV_C2C)?e.replace(k.CONV_C2C,""):t)||"@TLS#NOT_FOUND"===t}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&this._msgListHandler.onCheckTimer(e)}},{key:"onMessageSent",value:function(e){this._onSendOrRcvMsg({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrRcvMsg(e)}},{key:"_onSendOrRcvMsg",value:function(e){var t=this,n=e.conversationOptionsList,o=void 0===(o=e.isInstantMessage)||o,i=void 0!==(i=e.isUnreadC2CMessage)&&i,s=void 0===(s=e.updateUnreadCount)||s,a=void 0!==(a=e.isSyncingEnded)&&a;this._isReady?0!==n.length?(!0===o&&this._checkNewConv(n),this._updateLocalConvList({conversationOptionsList:n,isInstantMessage:o,isUnreadC2CMessage:i,isFromGetConversations:!1,updateUnreadCount:s}),o||(this._convIDFromUnreadDBMap=new Map([].concat(v(this._convIDFromUnreadDBMap),v(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConv(),a&&this.emitIEvt(Wo.C2C_UNREAD_HANDLE_COMPLETED)),0<n.filter((function(e){return!t._isConvNeedShow(e.conversationID)})).length||this.emitConvUpdate()):a&&this.emitIEvt(Wo.C2C_UNREAD_HANDLE_COMPLETED):this.ready((function(){t._onSendOrRcvMsg(e)}))}},{key:"updateConvGroupProfile",value:function(e){var t,n=this;Xe(e)&&0===e.length||(0!==this._convMap.size?(t=!1,e.forEach((function(e){var o="".concat(k.CONV_GROUP).concat(e.groupID);n._convMap.has(o)&&(t=!0,(o=n._convMap.get(o)).groupProfile=JSON.parse(JSON.stringify(e)),o.lastMessage.lastSequence<e.nextMessageSeq&&(o.lastMessage.lastSequence=e.nextMessageSeq-1),o.subType||(o.subType=e.type))})),t&&this.emitConvUpdate(!0,!1)):this._tmpGroupList=e)}},{key:"onMessageRevoked",value:function(e,t){var n,o,i,s=this;0!==e.length&&(n=null,o=!1,i=[],e.forEach((function(e){(n=s._convMap.get(e.conversationID))&&(t&&n.reduceUnreadCount()&&(o=n.type!==k.CONV_TOPIC),n.type===k.CONV_TOPIC?i.push(e):n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),o=!0))})),this.get(10).onMessageRevoked(i),o&&this.emitConvUpdate(!0,!1))}},{key:"updateRevokerInfo",value:function(e){for(var t=new Set,n=0;n<e.length;n++){var o=e[n].revoker;t.add(o)}var i=v(t),s=this.get(4);return new Promise((function(t){s.getUserProfile({userIDList:i}).then((function(n){if(!Xe(n=n.data)||0===n.length)return t(e);var o,i={},s=S(n);try{for(s.s();!(o=s.n()).done;){var a=o.value,r=a.userID,c=a.nick,u=a.avatar;i[r]={nick:c,avatar:u}}}catch(l){s.e(l)}finally{s.f()}e.forEach((function(e){var t=e.revoker;i[t]&&(e.revokerInfo.nick=i[t].nick||"",e.revokerInfo.avatar=i[t].avatar||"")})),t(e)})).catch((function(){t(e)}))}))}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,o=e.sequence,i=e.time,s=this._convMap.get(n);return s&&(t=s.type===k.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:n.replace(k.CONV_GROUP,""),sequence:o}):s.isLastMessageRevoked({sequence:o,time:i})),Pe.l("".concat(this._n,".isLastMessageRevoked options:"),e,"ret:".concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._msgListHandler.getLocalMsg(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)})),e=e[0].conversationID;for(var o=this._msgListHandler.getLocalMsgList(e),i={},s=o.length-1;0<=s;s--)if(!o[s].isDeleted){i=o[s];break}var a,r=this._convMap.get(e);r&&(a=!1,r.lastMessage.lastSequence===i.sequence&&r.lastMessage.lastTime===i.time||(je(i)&&(i=void 0),r.updateLastMessage(i),r.type!==k.CONV_TOPIC&&(a=!0),Pe.l("".concat(this._n,".onMessageDeleted. update convID:").concat(e," with lastMessage:"),r.lastMessage)),e.startsWith(k.CONV_C2C)&&this.updateUnreadCount(e),a&&this.emitConvUpdate(!0,!1))}}},{key:"onMessageModified",value:function(e){var t="".concat(this._n,".onMessageModified"),n=e.conversationType,o=e.from,i=e.to,s=e.time,a=e.sequence,r=e.elements,c=e.cloudCustomData,u=e.messageVersion,l=this.getMyUserID(),d="".concat(n).concat(i),p=(n=(i===l&&n===k.CONV_C2C&&(d="".concat(n).concat(o)),l=this._msgListHandler.onMsgModified(d,e)).isUpdated,l=l.message,!0===n&&this.emitOEvt(D.MESSAGE_MODIFIED,[l]),this._isTopicConv(d));return null===l?Pe.l("".concat(t," message is null! options:"),e):Pe.l("".concat(t," isUpdated:").concat(n," isTopicMessage:").concat(p," from:").concat(o," to:").concat(i," sequence:").concat(l.sequence," time:").concat(l.time)),p?this.get(10).onMessageModified(e):!(n=this._convMap.get(d))||(o=n.lastMessage)&&o.lastTime===s&&o.lastSequence===a&&o.version!==u&&(Pe.l("".concat(t," convID:").concat(d," lastMessage updated")),o.type=r[0].type,o.payload=r[0].content,o.messageForShow=Bt(o.type,o.payload,this.isIntl()),o.cloudCustomData=c,o.version=u,this.emitConvUpdate(!0,!1)),l}},{key:"onNewGroupAtTips",value:function(e){var n=this,o=(e=e.dataList,null);e.forEach((function(e){e.groupAtTips?o=e.groupAtTips:e.elements?o=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(o=t(t({},e),{},{sync:!0})),o.__random=e.random,o.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(o)})),Pe.l("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e,t=this;0!==this._tmpGroupAtTipsList.length&&(e=!1,this._tmpGroupAtTipsList.forEach((function(n){var o=n.groupID,i=n.from,s=void 0===(s=n.topicID)?void 0:s,a=void 0!==(a=n.sync)&&a;i!==t.getMyUserID()&&(ht(s)?(i=t._convMap.get("".concat(k.CONV_GROUP).concat(o)))&&(i.updateGroupAtInfoList(n),e=!0):((o=t._convMap.get("".concat(k.CONV_GROUP).concat(s)))&&(o.updateGroupAtInfoList(n),t.get(10).onAtInfoUpdated({topicID:s,groupAtInfoList:o.groupAtInfoList})),je(o)&&a&&(t.updateTopicConversation([{conversationID:"".concat(k.CONV_GROUP).concat(s),type:k.CONV_TOPIC}]),t._convMap.get("".concat(k.CONV_GROUP).concat(s)).updateGroupAtInfoList(n))))})),e&&this.emitConvUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConv",value:function(e){var t=this,n=[],o=[];e.forEach((function(e){t._convMap.has(e.conversationID)||(e.type===k.CONV_C2C?n.push(e.conversationID.replace(k.CONV_C2C,"")):e.type===k.CONV_GROUP&&o.push(e.conversationID.replace(k.CONV_GROUP,"")))})),0<n.length&&(this._onNewC2CConv(n),n=null),0<o.length&&(this._onNewGroupConv(o),o=null)}},{key:"_onNewC2CConv",value:function(e){var t=this.get(6);return Promise.all([t.getRemotePeerReadTime(e),this._msgRemindHandler.getC2CMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,1)])}},{key:"_onNewGroupConv",value:function(e){var t=this.get(7);return t?Promise.all([t.getMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,2)]):Promise.resolve()}},{key:"_setStorageConvList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this.getLocalConvList().filter((function(e){return e.type===k.CONV_C2C||e.type===k.CONV_GROUP&&e.lastMessage.type!==k.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.get(13).setItem("conversationMap",t,e)}},{key:"emitConvUpdate",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.getLocalConvList();!t||(t=this.get(7))&&t.updateGroupLastMessage(n),e&&(this.get(12).isPartialUpdatedConvs()?(this._diffConvMap(this._convMapForDiff,this._convMap),0<this._partialUpdatedConvMap.size&&(this.emitOEvt(D.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate(),this._convMapForDiff.clear(),this._convMapForDiff=it(this._convMap,!0)),0===this._convMapForDiff.size&&(this._convMapForDiff=it(this._convMap,!0))):(this.emitOEvt(D.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate()))}},{key:"_diffConvMap",value:function(e,t){var n,o=S(t);try{for(o.s();!(n=o.n()).done;){var i=m(n.value,2),s=i[0],a=i[1];e.has(s)&&JSON.stringify(a)===e.get(s)||this._partialUpdatedConvMap.set(s,a)}}catch(r){o.e(r)}finally{o.f()}}},{key:"getPartialUpdatedConvs",value:function(){var e=v(it(this._partialUpdatedConvMap,!1).values());return this._partialUpdatedConvMap.clear(),e}},{key:"getLocalConvList",value:function(){var e=this;return v(this._convMap.values()).filter((function(t){return e._isConvNeedShow(t.conversationID)}))}},{key:"getLocalConversation",value:function(e){return this._convMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._convMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._msgListHandler.getLocalOldestMsg(e)}},{key:"syncConvList",value:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n="syncConvList",o=new ao(n);return this._pagingStatus===Nn&&this._convMap.clear(),this._pagingGetConvList(t).then((function(t){var i=Wt(e._pagingGetCostList),s=zt(e._pagingGetCostList);return e._pagingGetCostList.length=0,e._pagingStatus=bn,e._diffAndDeleteConv(),e.emitConvUpdate(!0,!1),e._setStorageConvList(),e._handleC2CPeerReadTime(),e.emitIEvt(Wo.CONV_SYNC_COMPLETED),s="count:".concat(e._convMap.size," sum:").concat(s," avg:").concat(i),Pe.l("".concat(e._n,".").concat(n,". ").concat(s)),o.setMessage(s).end(),t})).catch((function(t){return e._pagingStatus=Un,o.setMessage(e._pagingTs).setError(t).end(),kn(t)}))}},{key:"_diffAndDeleteConv",value:function(){var e,t=this;this._isSyncCompleted()&&(e=[],this._convMap.forEach((function(n,o){!t._pagingConvIDMap.has(o)&&t._convIDFromUnreadDBMap.has(o)&&(t._convMap.delete(o),e.push(o))})),Pe.l("".concat(this._n,"._diffAndDeleteConv list:").concat(e)),e=null)}},{key:"_pagingGetConvList",value:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n="".concat(this._n,"._pagingGetConvList"),o=(Pe.l("".concat(n," incrementalPullFlag:").concat(t," ts:").concat(this._pagingTs," startIdx:").concat(this._pagingStartIdx)+" pinnedTs:".concat(this._pagingPinnedTs," pinnedStartIdx:").concat(this._pagingPinnedStartIdx)),Date.now());return this._pagingStatus=Pn,this.req({P:Kn.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:t?this._pagingTs:0,startIndex:t?this._pagingStartIdx:0,pinnedTimeStamp:t?this._pagingPinnedTs:0,pinnedStartIndex:t?this._pagingPinnedStartIdx:0,orderType:1}}).then((function(t){var i=(t=t.data).completeFlag,s=void 0===(s=t.conversations)?[]:s,a=t.timeStamp,r=t.startIndex,c=t.pinnedTimeStamp,u=t.pinnedStartIndex;if(t=t.groupItem,e._pagingGetCostList.push(Jt(o,!1)),Pe.l("".concat(n," ok. completeFlag:").concat(i," count:").concat(s.length," cost:").concat(Jt(o))),e._convGroupHandler.onConvGroupListSynced(t),0<s.length&&(t=e._getConvOptions(s),e._pagingConvIDMap=new Map([].concat(v(e._pagingConvIDMap),v(t.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConvList({conversationOptionsList:t,isFromGetConversations:!0,updateUnreadCount:!0}),e.isLoggedIn()&&e.emitConvUpdate()),!e._isReady){if(!e.isLoggedIn())return Dn();e.triggerReady()}return e._pagingTs=a,e._pagingStartIdx=r,e._pagingPinnedTs=c,e._pagingPinnedStartIdx=u,1!==i?e._pagingGetConvList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Dn())})).catch((function(t){throw e.isLoggedIn()&&(e._isReady||(Pe.w("".concat(n," failed. error:"),t),e.triggerReady())),t}))}},{key:"_updateLocalConvList",value:function(e){var t=e.isFromGetConversations,n=Date.now();e=this._getTmpConvListMapping(e).newConvList,this._convMap=new Map(this._sortConvList(v(this._convMap))),t||this._updateUserOrGroupProfile(e),Pe.l("".concat(this._n,"._updateLocalConvList cost:").concat(Jt(n)))}},{key:"_getTmpConvListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,o=e.isInstantMessage,i=e.isUnreadC2CMessage,s=void 0!==i&&i,a=e.updateUnreadCount,r=[],c=[],u=this.get(7),l=this.get(8),d=this.isIntl(),p=this.isUsingChatCore(),h=0,g=t.length;h<g;h++){var _=new hi(t[h],d,p),f=_.conversationID,m=_.type;if(!this._isNonExistentAccount(f)){if(this._convMap.has(f)){var v=this._convMap.get(f);if(n&&m!==k.CONV_TOPIC){this._convMap.set(f,_),m===k.CONV_C2C?_.unreadCount=v.unreadCount:m===k.CONV_GROUP&&(_.groupProfile=JSON.parse(JSON.stringify(v.groupProfile)));continue}var y=["unreadCount","allowType","adminForbidType","payload"],I=(!1===o&&y.push("lastMessage"),"boolean"==typeof o&&y.push("isPinned"),t[h].lastMessage),M=!ht(I);M||t[h].type===k.CONV_TOPIC||this._onLastMsgNotExist(t[h]),ht(o)&&M&&null===v.lastMessage.payload&&(v.lastMessage.payload=I.payload),je(v.lastMessage.revoker)||(v.lastMessage.revoker=null),ot(v,_,y,[null,void 0,"",0,NaN]),!0===a&&v.updateUnreadCount({nextUnreadCount:_.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:s}),o&&M&&(I.payload&&(v.lastMessage.payload=I.payload),v.type===k.CONV_GROUP&&(v.lastMessage.nameCard=I.nameCard,v.lastMessage.nick=I.nick)),M&&v.lastMessage.cloudCustomData!==I.cloudCustomData&&(v.lastMessage.cloudCustomData=I.cloudCustomData||"")}else m===k.CONV_GROUP&&u?(y=_.groupProfile.groupID,(M=u.getLocalGroupProfile(y))&&(_.groupProfile=M,!0===a&&_.updateUnreadCount({nextUnreadCount:0}))):m===k.CONV_C2C&&(v=f.replace(k.CONV_C2C,""),l&&l.isMyFriend(v)&&(_.remark=l.getFriendRemark(v))),r.push(_),this._convMap.set(f,_);this._convMap.get(f).type===k.CONV_TOPIC&&c.push(this._convMap.get(f))}}for(var C=this.get(10),T=0,E=c.length;T<E;T++){var S,D=(S=c[T]).conversationID;je(S=S.groupAtInfoList)||C.onAtInfoUpdated({topicID:D.replace(k.CONV_GROUP,""),groupAtInfoList:S})}return{newConvList:r}}},{key:"_onLastMsgNotExist",value:function(e){new ao("lastMsgNotExist").setMessage(JSON.stringify(e)).end()}},{key:"_sortConvList",value:function(e){var t=[],n=[],o=[],i=[];return e.forEach((function(e){(!0===e[1].isPinned?je(e[1].lastMessage.lastTime)?n:t:je(e[1].lastMessage.lastTime)?i:o).push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(o.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(i)}},{key:"_sortConvListAndEmitEvent",value:function(){this._convMap=new Map(this._sortConvList(v(this._convMap))),this.emitConvUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t,n,o,i,s=this;0!==e.length&&(t=[],n=[],o=this.get(4),i=this.get(7),e.forEach((function(e){var o;e.type===k.CONV_C2C?t.push(e.toAccount):e.type===k.CONV_GROUP&&(o=e.toAccount,i.hasLocalGroup(o)?e.groupProfile=i.getLocalGroupProfile(o):n.push(o))})),Pe.l("".concat(this._n,"._updateUserOrGroupProfile userIDList:").concat(t," groupIDList:").concat(n)),0<t.length&&o.getUserProfile({userIDList:t}).then((function(e){Xe(e=e.data)?e.forEach((function(e){s._doUpdateUserProfile("".concat(k.CONV_C2C).concat(e.userID),e)})):s._doUpdateUserProfile("".concat(k.CONV_C2C).concat(e.userID),e)})),0<n.length&&i.getGroupProfileAdvance({groupIDList:n,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e=e.data.successGroupList;var t=!1;e.forEach((function(e){var n="".concat(k.CONV_GROUP).concat(e.groupID);s._convMap.has(n)&&(ot((n=s._convMap.get(n)).groupProfile,e,[],[null,void 0,"",0,NaN]),!n.subType&&e.type&&(n.subType=e.type),t=!0)})),t&&s.emitConvUpdate()})))}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t,this.emitConvUpdate())}},{key:"_getConvOptions",value:function(e){var n=this,o=[],i=(e=e.filter((function(e){var t=e.type;return e=e.userID,1===t&&!n._isNonExistentAccount(e)||2===t})),this.getMyUserID());return e=e.map((function(e){var s;return ht(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type?(s={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar},o.push(s),{conversationID:"".concat(k.CONV_C2C).concat(e.userID),type:k.CONV_C2C,lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProp(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===i&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},unreadCount:0,userProfile:new ui(s),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,customData:e.customMark||"",markList:jt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId),remark:e.friendRemark||"",messageRemindType:n._transMsgRemindType(e.messageRemindType)}):{conversationID:"".concat(k.CONV_GROUP).concat(e.groupID),type:k.CONV_GROUP,lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new pi({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage,type:e.groupType,nextMessageSeq:e.nextMessageSeq}),unreadCount:n._computeGroupUnreadCount(e),peerReadTime:0,isPinned:1===e.isPinned,version:0,customData:e.customMark||"",markList:jt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId),messageRemindType:n._transMsgRemindType(e.messageRemindType)}})),0<o.length&&this.get(4).onConvProfileUpdated(o),e}},{key:"_transMsgRemindType",value:function(e){var t="";return 0===e?t=k.MSG_REMIND_ACPT_AND_NOTE:1===e?t=k.MSG_REMIND_DISCARD:2===e?t=k.MSG_REMIND_ACPT_NOT_NOTE:3===e&&(t=k.NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT),t}},{key:"_computeGroupUnreadCount",value:function(e){var t;return 0<(t=(void 0===(t=e.unreadCount)?0:t)-(void 0===(e=e.noUnreadCount)?0:e))?t:0}},{key:"_patchTypeAndPayload",value:function(e){var n=(e=e.lastMsg).event,o=void 0===(o=e.elements)?[]:o;return e=void 0===(e=e.groupTips)?{}:e,ht(void 0===n?void 0:n)||je(e)?{type:o[0]?o[0].type:null,payload:o[0]?this._amendLayersOverLimitProp(o[0].content):null}:((n=new Oo(e)).setElement({type:k.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}),o=JSON.parse(JSON.stringify(n.payload)),n=null,{type:k.MSG_GRP_TIP,payload:o})}},{key:"_amendLayersOverLimitProp",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._msgListHandler.getLocalMsgList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof Oo&&this._msgListHandler.remove(e)}},{key:"onConvDeleted",value:function(e){Xe(e)&&(e=e.map((function(e){var t=e.type,n=e.userID;return e=e.groupID,1===t?"".concat(k.CONV_C2C).concat(n):2===t?"".concat(k.CONV_GROUP).concat(e):void 0})),Pe.l("".concat(this._n,".onConvDeleted convIDList:").concat(e)),this.deleteLocalConvList(e))}},{key:"onConvPinnedStatus",value:function(e,t){var n,o=this;Xe(e)&&(n=!1,e.forEach((function(e){var i,s=e.type,a=e.userID;e=e.groupID,1===s?i=o.getLocalConversation("".concat(k.CONV_C2C).concat(a)):2===s&&(i=o.getLocalConversation("".concat(k.CONV_GROUP).concat(e))),i&&(Pe.l("".concat(o._n,".onConvPinnedStatus convID:").concat(i.conversationID," localPinned:").concat(i.isPinned," remotePinned:").concat(t)),t?i.isPinned||(i.isPinned=!0,n=!0):i.isPinned&&(i.isPinned=!1,n=!0))})),n&&this._sortConvListAndEmitEvent())}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,o=e.nextReqMessageID,i=(e=e.count,"".concat(this._n,".getMessageList")),s="";if((r=this.getLocalConversation(n))&&r.groupProfile&&(s=r.groupProfile.type),Et(s))return Pe.l("".concat(i," not available in ").concat(s,". convID:").concat(n)),Dn({messageList:[],nextReqMessageID:"",isCompleted:!0});(ht(e)||15<e)&&(e=15),o||this._isMeInCommunity(n)||this.clearMemMsg(n);var a=this._computeRemainingCount({conversationID:n,nextReqMessageID:o}),r=this._completedMap.has(n);return Pe.l("".concat(i," convID:").concat(n," isEverCleared:").concat(this._isEverCleared(n)," nextReqMessageID:").concat(o)+" remainingCount:".concat(a," count:").concat(e," isCompleted:").concat(r)),this._needGetHistory({conversationID:n,remainingCount:a,count:e})?this.getHistoryMessages({conversationID:n,nextReqMessageID:o,count:20}).then((function(e){var o=e.nextReqID,s=e.storedMessageList,r=e.assembledMessageList,c=(e=e.isPullingCompleted,t._completedMap.has(n)),u=s,l=(0<a&&(u=t._msgListHandler.getLocalMsgList(n).slice(0,s.length+a)),{nextReqMessageID:void 0,messageList:void 0,isCompleted:void 0});return t._isEverCleared(n)?(l.nextReqMessageID=o,l.messageList=r,l.isCompleted=e):(l.nextReqMessageID=c?"":o,l.messageList=u,l.isCompleted=c),s=l.messageList.filter((function(e){return e.isRevoked}))||[],r=l.messageList.map((function(e){return e.sequence})),Pe.l("".concat(i," ret.nextReqMessageID:").concat(l.nextReqMessageID," ret.isCompleted:").concat(l.isCompleted," sequenceList:"),r),Xe(s)&&0!==s.length?t.updateRevokerInfo(s).then((function(e){return e.forEach((function(e){var t=e.revokerInfo;l.messageList=l.messageList.map((function(n){return n.ID===e.ID&&t&&(n.revokeReason=t.reason||"",n.revokerInfo={userID:t.revoker||n.revoker,nick:t.nick,avatar:t.avatar}),n}))})),Sn(l)})):Sn(l)})):(this.modifyMessageList(n),Dn(s=this._getMsgListFromMem({conversationID:n,nextReqMessageID:o,count:e})))}},{key:"_isEverCleared",value:function(e){return this._everClearedMap.has(e)}},{key:"_getMsgListFromMem",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=(e=e.count,"".concat(this._n,"._getMsgListFromMem")),i=this._msgListHandler.getLocalMsgList(t),s=i.length,a=kt(t),r=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(r=a?i.findIndex((function(e){return e.ID===n})):i.findIndex((function(e){return e.sequence+""===n})))>e?(c.messageList=i.slice(r-e,r),c.nextReqMessageID=a?i[r-e].ID:i[r-e].sequence+""):(c.messageList=i.slice(0,r),c.isCompleted=!0):e<s?(c.messageList=i.slice(r=s-e,s),c.nextReqMessageID=a?i[r].ID:i[r].sequence+""):(c.messageList=i.slice(0,s),c.isCompleted=!0),e=c.messageList.map((function(e){return e.sequence})),Pe.l("".concat(o," convID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," sequenceList:").concat(e)),c}},{key:"getMessageListHopping",value:function(e){var t,n,o=e.conversationID,i=e.sequence,s=e.time,a=e.count;return e=void 0===(e=e.direction)?0:e,(ht(a)||15<a)&&(a=15),o.startsWith(k.CONV_C2C)?(t=this.get(6),n=o.replace(k.CONV_C2C,""),t.getRoamingMessagesHopping({peerAccount:n,time:s,count:a,direction:e})):o.startsWith(k.CONV_GROUP)?(t=this.get(7),n=o.replace(k.CONV_GROUP,""),t.getRoamingMessagesHopping({groupID:n,sequence:i,count:a,direction:e})):void 0}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=(e=this._msgListHandler.getLocalMsgList(t)).length;return Pe.l("".concat(this._n,"._computeRemainingCount convID:").concat(t," nextReqMessageID:").concat(n," length:").concat(o)),n?(o=0,kt(t)?o=e.findIndex((function(e){return e.ID===n})):Rt(t)&&(o=-1!==n.indexOf("-")?e.findIndex((function(e){return e.ID===n})):e.findIndex((function(e){return e.sequence+""===n}))),-1===o?0:o):o}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,o=(e=e.count,this.getLocalConversation(t)),i="";return o&&o.groupProfile&&(i=o.groupProfile.type),!Lt(t)&&!Et(i)&&(!!this._isEverCleared(t)||(o=n<=e&&!this._completedMap.has(t),Pe.l("".concat(this._n,"._needGetHistory convID:").concat(t," ret:").concat(o)),o))}},{key:"_isTopicConv",value:function(e){return Dt(e=e.replace(k.CONV_GROUP,""))}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(e=e.nextReqMessageID,t===k.CONV_SYSTEM)return Dn();var o,i,s=15;if(20<n&&(s=20),n=null,kt(t))return c=0,o="",i=!1,r=this._roamingMsgKeyAndTimeMap.has(t),e&&(i=!0,r?(c=this._roamingMsgKeyAndTimeMap.get(t).lastMessageTime,o=this._roamingMsgKeyAndTimeMap.get(t).messageKey):(a=this._msgListHandler.findMessage(e))&&(c=a.time,Pe.l("".concat(this._n,".getHistoryMessages convID:").concat(t," isRelayInfoExisted:").concat(r," lastMessageTime:").concat(c)))),(n=this.get(6)).getRoamingMessage({conversationID:t,peerAccount:t.replace(k.CONV_C2C,""),count:s,lastMessageTime:i?c:0,messageKey:i?o:""});if(Rt(t)){if(!(n=this.get(7)))return kn({code:Hn.NO_MODULE});var a=t.replace(k.CONV_GROUP,""),r=null,c=(this._convMap.has(t)&&!Dt(a)&&(r=this._convMap.get(t).lastMessage),0);return e?c=Number(e):r&&(c=r.lastSequence),n.getRoamingMessage({conversationID:t,groupID:a,count:s,sequence:c})}return Dn()}},{key:"patchConvLastMessage",value:function(e){var t,n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=this.getLocalConversation(e);i&&(t=(n=i.lastMessage).messageForShow,n=n.payload,!(je(t)||je(n)||o)||0!==(t=this._msgListHandler.getLocalMsgList(e)).length&&(n=t[t.length-1],Pe.l("".concat(this._n,".patchConvLastMessage bForceUpdate:").concat(o," convID:").concat(e," payload:"),n.payload),i.updateLastMessage(n)))}},{key:"onRoamingMessage",value:function(){var e,n,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],s=3<arguments.length?arguments[3]:void 0,a=(u=1<arguments.length?arguments[1]:void 0).startsWith(k.CONV_C2C)?k.CONV_C2C:k.CONV_GROUP,r=null,c=[],u=[],l=0,d=o.length,p=a===k.CONV_GROUP,h=this.getFileDownloadProxy(),g=this.getDowloadFileAuthKey(),_=Xe(s),f=this.get(17).getFileDNList(),m=function(){p?--l:++l},v=function(){return p?d<=l:l<d};for(l=p?o.length-1:0,d=p?0:o.length;v();m())1!==o[l].isPlaceMessage&&((r=new Oo(o[l])).to=o[l].to,a!==k.CONV_GROUP||ht(o[l].topicID)||(r.to=o[l].topicID),r.isSystemMessage=!!o[l].isSystemMessage,r.conversationType=a,e=4===o[l].event?{type:k.MSG_GRP_TIP,content:t(t({},o[l].elements),{},{groupProfile:o[l].groupProfile})}:o[l].elements,p||r.setNickAndAvatar({nick:o[l].nick,avatar:o[l].avatar}),je(e)?((n=new ao("emptyMessageBody")).setMessage("from:".concat(r.from," to:").concat(r.to," sequence:").concat(r.sequence," event:").concat(o[l].event)),n.setLevel("warning").end()):(r.setElement(e,h,g,f),r.reInitialize(this.getMyUserID()),c.push(r),_&&s.push(r)));return m=v=null,i?(this._msgListHandler.unshift(c,u),c=null,u):(u=null,c)}},{key:"findMessage",value:function(e){return this._msgListHandler.findMessage(e)}},{key:"_isMeInCommunity",value:function(e){var t=!0;return this._isTopicConv(e)&&(e=qt(e.replace(k.CONV_GROUP,"")),this.get(7).hasLocalGroup(e)||(t=!1,Pe.l("".concat(this._n,"._isMeInCommunity groupID:").concat(e," ret:").concat(t)))),t}},{key:"deleteTopicRoamingInfo",value:function(e){var t=this;St({groupID:e})&&this._msgListHandler.getTopicConvIDList(e).forEach((function(e){t.clearMemMsg(e)}))}},{key:"deleteGroupRoamingInfo",value:function(e){e="".concat(k.CONV_GROUP).concat(e),0<this._msgListHandler.getLocalMsgList(e).length&&this.clearMemMsg(e)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(e="".concat(this._n,".setMessageRead"),Pe.l("".concat(e," convID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return Dn();if(n.type!==k.CONV_GROUP&&n.type!==k.CONV_TOPIC||je(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return Dn();var o=this._msgListHandler.getLocalLastMsg(t),i=n.lastMessage.lastTime,s=(i<(s=this._msgListHandler.getLocalMaxTime(t))&&(Pe.l("".concat(e," update lastMessageTime from ").concat(i," to ").concat(s)),i=s),this._msgListHandler.getLocalMaxSeq(t)),a=n.lastMessage.lastSequence,r=(a<s&&(Pe.l("".concat(e," update lastMessageSeq from ").concat(a," to ").concat(s)),a=s),n.type===k.CONV_TOPIC&&ht(o)&&(e=this.get(10),o=qt(s=t.replace(k.CONV_GROUP,"")),(e=e.getLocalTopic(o,s))&&(a=e.nextMessageSeq-1)),null);switch(n.type){case k.CONV_C2C:return(r=this.get(6))?r.setMessageRead({conversationID:t,lastMessageTime:i}):kn({code:Hn.NO_MODULE});case k.CONV_GROUP:case k.CONV_TOPIC:return(r=this.get(7))?r.setMessageRead({conversationID:t,lastMessageSeq:a}):kn({code:Hn.NO_MODULE});case k.CONV_SYSTEM:return n.unreadCount=0,this.emitConvUpdate(!0,!1),Dn();default:return Dn()}}},{key:"setAllMessageRead",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",o="".concat(this._n,".").concat(n),i=(t.scope||(t.scope=k.READ_ALL_MSG),Pe.l("".concat(o," options:"),t),this._createSetAllMessageReadPack(t));if(0===i.readAllC2CMessage&&0===i.groupMessageReadInfoList.length)return Dn();var s=new ao(n);return this.req({P:Kn.SET_ALL_MSG_READ,data:i}).then((function(n){return n=n.data,n=e._handleAllMsgRead(n),s.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(n))).end(),Dn()})).catch((function(e){return s.setError(e).end(),Pe.w("".concat(o," failed. error:"),e),kn({code:e&&e.code?e.code:Hn.MSG_UNREAD_ALL_FAIL,message:e&&e.message?e.message:void 0})}))}},{key:"setConvCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConv",value:function(e){return this._convGroupHandler.markConv(e)}},{key:"getConvGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConvGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConvGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConvGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConvsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConvsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConvMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConvGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConvGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConvGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConvInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConvLastMessageSeq",value:function(e){var t=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastSequence,t&&e<t.sequence?t.sequence:e}},{key:"_getConvLastMessageTime",value:function(e){var t=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastTime,t&&e<t.time?t.time:e}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},o=e.scope,i=S(this._convMap);try{for(i.s();!(t=i.n()).done;){var s,a=m(t.value,2)[1];if(0<a.unreadCount)if(a.type===k.CONV_C2C&&0===n.readAllC2CMessage){if(o===k.READ_ALL_MSG)n.readAllC2CMessage=1;else if(o===k.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else a.type!==k.CONV_GROUP||o!==k.READ_ALL_GROUP_MSG&&o!==k.READ_ALL_MSG||(s=this._getConvLastMessageSeq(a),n.groupMessageReadInfoList.push({groupID:a.groupProfile.groupID,messageSequence:s}))}}catch(r){i.e(r)}finally{i.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMsgRead(e)}},{key:"_handleAllMsgRead",value:function(e){var t=e.groupMessageReadInfoList;return e=e.readAllC2CMessage,t=this._parseGroupReadInfo(t),1<=this._updateAllConvUnreadCount({readAllC2CMessage:e})&&this.emitConvUpdate(!0,!1),t}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,o=e.length;n<o;n++){var i=(r=e[n]).groupID,s=r.sequence,a=r.retCode,r=r.lastMessageSeq;ht(a)?this._remoteGroupReadSeqMap.set(i,r):(this._remoteGroupReadSeqMap.set(i,s),0!==a&&t.push("".concat(i,"-").concat(s,"-").concat(a)))}return t}},{key:"_updateAllConvUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,o=0,i=S(this._convMap);try{for(i.s();!(t=i.n()).done;){var s,a,r,c,u=m(t.value,2),l=u[0],d=u[1];1<=d.unreadCount&&(1===n&&d.type===k.CONV_C2C?(s=this._getConvLastMessageTime(d),this.updateIsReadAfterReadReport({conversationID:l,lastMessageTime:s})):d.type===k.CONV_GROUP&&(a=l.replace(k.CONV_GROUP,""),this._remoteGroupReadSeqMap.has(a)&&(r=this._remoteGroupReadSeqMap.get(a),c=this._getConvLastMessageSeq(d),this.updateIsReadAfterReadReport({conversationID:l,remoteReadSequence:r}),r<=c&&this._remoteGroupReadSeqMap.delete(a))),this.updateUnreadCount(l,!1)&&(o+=1))}}catch(p){i.e(p)}finally{i.f()}return o}},{key:"isRemoteRead",value:function(e){var t,n=e.conversationID,o=(e=e.sequence,n.replace(k.CONV_GROUP,"")),i=!1;return this._remoteGroupReadSeqMap.has(o)&&(e<=(t=this._remoteGroupReadSeqMap.get(o))&&(i=!0,Pe.l("".concat(this._n,".isRemoteRead convID:").concat(n," msgSeq:").concat(e," remoteReadSeq:").concat(t))),t+10<=e&&this._remoteGroupReadSeqMap.delete(o)),i}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,i=this._msgListHandler.getLocalMsgList(t);if(0!==i.length)for(var s,a=i.length-1;0<=a;a--)if(s=i[a],!(o&&s.time>o||n&&s.sequence>n)){if("in"===s.flow&&s.isRead)break;s.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=!1,i=this.getLocalConversation(e),s=this._msgListHandler.getLocalMsgList(e);if(i)return(t=i.unreadCount)!==(s=s.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length)&&(i.unreadCount=s,o=!0,Pe.l("".concat(this._n,".updateUnreadCount from ").concat(t," to ").concat(s,", convID:").concat(e)),!0===n&&this.emitConvUpdate(!0,!1)),o&&i.type===k.CONV_TOPIC&&(t=i.unreadCount,s=this.get(10),n=e.replace(k.CONV_GROUP,""),s.onUnreadCountUpdatedFromConv(n,t)),o}},{key:"clearGroupAtInfoList",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=this.getLocalConversation(e);o&&0<o.groupAtInfoList.length&&(o.clearGroupAtInfoList(),Pe.l("".concat(this._n,".clearGroupAtInfoList convID:").concat(e)),o.type===k.CONV_TOPIC&&(o=o.groupAtInfoList,t=this.get(10),e=e.replace(k.CONV_GROUP,""),t.onAtInfoUpdated({topicID:e,groupAtInfoList:o})),!0===n&&this.emitConvUpdate(!0,!1))}},{key:"updateReadReceiptInfo",value:function(e){var t,n,o,i=this,s=void 0===(r=e.userID)?void 0:r,a=void 0===(r=e.groupID)?void 0:r,r=e.readReceiptList,c=void 0===(e=e.timestamp)?0:e;je(r)||(t=[],ht(s)?ht(a)||(n="".concat(k.CONV_GROUP).concat(a),r.forEach((function(e){var o=e.tinyID,s=e.clientTime,r=e.random,c=e.readCount;e=e.unreadCount,o="".concat(o,"-").concat(s,"-").concat(r),s=i._msgListHandler.getLocalMsg(n,o)||i._msgListHandler.getHoppingMsg(n,o),r={groupID:a,messageID:o,readCount:0,unreadCount:0},s&&(We(c)&&(s.readReceiptInfo.readCount=c,r.readCount=c),We(e)&&(s.readReceiptInfo.unreadCount=e,r.unreadCount=e),t.push(r))}))):(o="".concat(k.CONV_C2C).concat(s),r.forEach((function(e){var n=e.tinyID,a=e.clientTime;e=e.random,n="".concat(n,"-").concat(a,"-").concat(e),(a=i._msgListHandler.getLocalMsg(o,n)||i._msgListHandler.getHoppingMsg(o,n))&&!a.readReceiptInfo.isPeerRead&&(a.readReceiptInfo.isPeerRead=!0,a.readReceiptInfo.timestamp=c,t.push({userID:s,messageID:n,isPeerRead:!0,timestamp:c}))}))),0<t.length&&this.emitOEvt(D.MESSAGE_READ_RECEIPT_RECEIVED,t))}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!Lt(t.type)){for(var o=[],i=0,s=n.length;i<s;i++)"in"!==n[i].flow?"out"!==n[i].flow||n[i].isRead||n[i].setIsRead(!0):o.push(n[i]);var a=0;a=t.type===k.CONV_C2C?(e=o.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length,o.length-t.unreadCount-e):o.length-t.unreadCount;for(var r=0;r<a&&!o[r].isRead;r++)o[r].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");if(Pe.l("".concat(n)),!(i=this._convMap.get(e)))return Promise.resolve();var o=i.groupAtInfoList;if(0===o.length)return Promise.resolve();var i=void 0,s=(e.startsWith(k.CONV_GROUP)&&(i=e.replace(k.CONV_GROUP,"")),v(o));if((St({groupID:i})||Dt(i))&&0===(s=o.filter((function(e){return!e.atTypeArray.includes(k.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var a=this.getMyUserID();return this.req({P:Kn.DEL_GROUP_AT_TIPS,data:{messageListToDelete:s.map((function(e){return{from:e.from,to:a,messageSeq:e.__sequence,messageRandom:e.__random,groupID:ht(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Pe.l("".concat(n," ok. count:").concat(o.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"appendToMessageList",value:function(e){return this._msgListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this._sll.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this._sll.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._msgListHandler.pushIn(t,n)||this._sll.has(t.random)&&!n||(e.push(t),0))}},{key:"revoke",value:function(e,t,n){return this._msgListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){(!this._peerReadTimeMap.has(e)||this._peerReadTimeMap.get(e)<t)&&this._peerReadTimeMap.set(e,t)}},{key:"updateMsgIsPeerReadProp",value:function(e,t){var n;e.startsWith(k.CONV_C2C)&&0<t&&(0<(n=this._msgListHandler.updateMsgIsPeerReadProp(e,t)).length&&this.emitOEvt(D.MESSAGE_READ_BY_PEER,n),this._convMap.has(e)&&(je(n=this._convMap.get(e).lastMessage)||n.fromAccount===this.getMyUserID()&&n.lastTime<=t&&!n.isPeerRead&&(n.isPeerRead=!0,this.emitConvUpdate(!0,!1))))}},{key:"updateMsgIsModifiedProp",value:function(e){this._msgListHandler.updateMsgIsModifiedProp(e)}},{key:"setCompleted",value:function(e){Pe.l("".concat(this._n,".setCompleted convID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMsgKeyAndTime",value:function(e,t,n){this._roamingMsgKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"getConvList",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getConvList"),i="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._convMap.size,", options:").concat(JSON.stringify(e));return Pe.l("".concat(o,". ").concat(i)),this._pagingStatus===Un?((t=new ao("getConvList")).setMessage(i),this.syncConvList().then((function(){return t.end(),Sn({conversationList:n._getConvList(e),isSyncCompleted:n._isSyncCompleted()})})).catch((function(e){return t.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))):(i=this._getConvList(e),Pe.l("".concat(o,". returned conversation count:").concat(i.length)),Dn({conversationList:i,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConvList",value:function(e){var t,n,o,i,s,a=this;return ht(e)?this.getLocalConvList():Xe(e)?0===e.length?[]:this.getLocalConvList().filter((function(t){return e.includes(t.conversationID)})):$e(e)?(t=e.type,n=e.markType,o=e.groupName,i=e.hasUnreadCount,s=e.hasGroupAtInfo,this.getLocalConvList().filter((function(e){return a._filterType(e,t)&&a._filterMarkType(e,n)&&a._filterGroupName(e,o)&&a._filterUnreadCount(e,i)&&a._filterGroupAtInfo(e,s)}))):[]}},{key:"_filterType",value:function(e,t){return t!==k.CONV_C2C&&t!==k.CONV_GROUP||e.type===t}},{key:"_filterGroupName",value:function(e,t){return!pt(t)||(""===t?0===e.conversationGroupList.length:e.conversationGroupList.includes(t))}},{key:"_filterMarkType",value:function(e,t){return!We(t)||(0===t?0===e.markList.length:e.markList.includes(t))}},{key:"_filterUnreadCount",value:function(e,t){var n=!0;return!0===t?n=1<=e.unreadCount:!1===t&&(n=0===e.unreadCount),n}},{key:"_filterGroupAtInfo",value:function(e,t){var n=!0;return!0===t?n=1<=e.groupAtInfoList.length:!1===t&&(n=0===e.groupAtInfoList.length),n}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=S(this._convMap);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2),o=n[0],i=n[1];i.type===k.CONV_C2C&&this.recordPeerReadTime(o,i.peerReadTime)}}catch(s){t.e(s)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var e=this.get(7);return!e||e.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var e=this.get(7);return e?e.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(e){var t=this.get(7);return!!t&&t.hasLocalGroup(e.replace(k.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this,o=!1;if(this._convMap.has(e)?t=this._convMap.get(e):(t=new hi({conversationID:e,type:kt(e)?k.CONV_C2C:k.CONV_GROUP},this.isIntl(),this.isUsingChatCore()),o=!0),t._isInfoCompleted||t.type===k.CONV_SYSTEM)return Dn({conversation:t});if(Rt(e)){if(!this.get(7))return kn({code:Hn.NO_MODULE});if(!this._hasLocalGroup(e))return Dn({conversation:t})}var i="".concat(this._n,".").concat("getConversationProfile"),s=new ao("getConversationProfile");return Pe.l("".concat(i,". convID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._getUserOrGroupProfile(t).then((function(a){s.setMessage("convID:".concat(e," unreadCount:").concat(a.data.conversation.unreadCount)).end();var r,c=n.get(8);if(c&&t.type===k.CONV_C2C&&(r=e.replace(k.CONV_C2C,""),c.isMyFriend(r)&&(c=c.getFriendRemark(r),t.remark!==c&&(t.remark=c,Pe.l("".concat(i,". convID:").concat(e," patch remark:").concat(t.remark))))),Pe.l("".concat(i," ok. isNewConv:").concat(o," convID:").concat(e)),o){if(t.type===k.CONV_C2C)return n._onNewC2CConv([e.replace(k.CONV_C2C,"")]).then((function(){return Dn({conversation:t})}));if(t.type===k.CONV_GROUP)return n._onNewGroupConv([e.replace(k.CONV_GROUP,"")]).then((function(){return Dn({conversation:t})}))}return a})).catch((function(t){return s.setError(t).setMessage("convID:".concat(e)).end(),Pe.e("".concat(i," failed. error:"),t),kn(t)}))}},{key:"_getUserOrGroupProfile",value:function(e){var t=this;return e.type===k.CONV_C2C?this.get(4).getUserProfile({userIDList:[e.toAccount]}).then((function(n){return 0===(n=n.data).length?kn({code:Hn.USER_OR_GRP_NOT_FOUND}):(e.userProfile=n[0],e._isInfoCompleted=!0,t._insertConvAfterTopmost(e),Dn({conversation:e}))})):this.get(7).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._insertConvAfterTopmost(e),Dn({conversation:e})}))}},{key:"_insertConvAfterTopmost",value:function(e){var t,n;e instanceof hi&&!this._convMap.has(e.conversationID)&&(n=(t=v(this._convMap)).findIndex((function(e){return!1===e[1].isPinned})),t.splice(n,0,[e.conversationID,e]),this._convMap=new Map(t),this._setStorageConvList(),this.emitConvUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;n===t.getMyUserID()?t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar}):(n=t._convMap.get("".concat(k.CONV_C2C).concat(n)))&&(n.userProfile=e)}))}},{key:"_onCloudConfig",value:function(e){"0"===this.getCloudConfig("pull_on_invite")&&(this._bPullOnInvite=!1),Pe.l("".concat(this._n,"._onCloudConfig bPullOnInvite:").concat(this._bPullOnInvite))}},{key:"disableMsgPullOnInvite",value:function(){this._bPullOnInvite=!1}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===bn}},{key:"_errorLog",value:function(e,t,n,o){var i=new Error("Params validate failed."),s="".concat(this.getErrMsg("API_REFER")).concat(e);throw Pe.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrMsg(n,o),", ").concat(s)),Pe.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),i}},{key:"_isValidConvID",value:function(e){return kt(e)||Rt(e)||Lt(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return pt(e)||Je(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),pt(e)?(this._isValidConvID(e)||this._errorLog(n,"options","InvalidConversationID",e),Pe.l("".concat(this._n,".").concat(n," convID:").concat(e)),this.deleteConvList({conversationIDList:[e],flag:1})):(Xe(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConvID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),100<e.conversationIDList.length&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConvList(e))}},{key:"deleteConvList",value:function(e){var t=void 0===(t=e.conversationIDList)?[]:t,n=void 0===(n=e.clearHistoryMessage)||n,o=void 0===(e=e.flag)?0:e,i="".concat(this._n,".").concat("deleteConvList"),s=(e="convIDList:".concat(t," clearHistoryMessage:").concat(n),Pe.l("".concat(i," ").concat(e)),new ao("deleteConvList"));return s.setMessage(e),Promise.all([this.rmLocalOnlyConvList(t),this.rmLocalAndRemoteConvList(t,n)]).then((function(e){return s.end(),0===(e=[].concat(v(e[0]),v(e[1]))).length?kn(new Bn({code:Hn.CONV_NOT_FOUND})):(Pe.l("".concat(i," ok")),Dn(1===o?{conversationID:e[0]}:{conversationIDList:e}))})).catch((function(e){return s.setError(e).end(),Pe.e("".concat(i," failed. error:"),e),kn(e)}))}},{key:"rmLocalOnlyConvList",value:function(e){var t=this;return e.filter((function(e){if(!t._convMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==k.CONV_GROUP||t._hasLocalGroup(e)?n===k.CONV_SYSTEM&&(t.get(7).deleteGroupSystemNotice({messageList:t._msgListHandler.getLocalMsgList(e)}),t.deleteLocalConv(e),!0):(t.deleteLocalConv(e),!0)}))}},{key:"rmLocalAndRemoteConvList",value:function(e,t){var n=this,o={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){var t;n._convMap.has(e)&&((t=n.getLocalConversation(e).type)===k.CONV_C2C?o.conversationList.push({toAccount:e.replace(t,""),type:1}):t===k.CONV_GROUP&&n._hasLocalGroup(e)&&o.conversationList.push({toGroupID:e.replace(t,""),type:2}))})),0===o.conversationList.length?[]:this.req({P:Kn.DEL_CONV,data:o}).then((function(e){var t=[];return 0<e.data.resultList.length&&e.data.resultList.map((function(e){0===e.code&&(e=1===e.type?"".concat(k.CONV_C2C).concat(e.to):"".concat(k.CONV_GROUP).concat(e.groupID),t.push(e))})),n.deleteLocalConvList(t),t}))}},{key:"setConvDraft",value:function(e){var t=e.conversationID,n=(e=e.draftText,"".concat(this._n,".").concat("setConvDraft"));return Pe.l("".concat(n," convID:").concat(t," draftText:").concat(e)),this._convMap.has(t)?((n=this._convMap.get(t)).setDraftText(e),this.emitConvUpdate(),Dn({code:0,conversation:n})):kn({code:Hn.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._convMap.has(e))return kn({code:Hn.CONV_NOT_FOUND});var o=this._convMap.get(e).type;if(o===k.CONV_C2C)n.type=1,n.toAccount=e.replace(k.CONV_C2C,"");else{if(o!==k.CONV_GROUP)return o===k.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._msgListHandler.getLocalMsgList(e)}),Dn({conversationID:e})):kn({code:Hn.CONV_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(k.CONV_GROUP,"")}var i="".concat(this._n,".").concat("clearHistoryMessage"),s=new ao("clearHistoryMessage");return s.setMessage("convID:".concat(e)),Pe.l("".concat(i,". convID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.req({P:Kn.CLEAR_HISTORY_MSG,data:n})})).then((function(){s.end(),Pe.l("".concat(i," ok")),t.clearMemMsg(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConvListAndEmitEvent()),Dn({conversationID:e})})).catch((function(e){return s.setError(e).end(),Pe.e("".concat(i," failed. error:"),e),kn(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,o=e.isPinned,i=this.getLocalConversation(n);if(i&&i.isPinned===o)return Dn({conversationID:n});if(Lt(n))return i&&(i.isPinned=o),this._sortConvListAndEmitEvent(),Dn({conversationID:n});if(e=null,kt(n)?e={type:1,toAccount:n.replace(k.CONV_C2C,"")}:Rt(n)&&(e={type:2,groupID:n.replace(k.CONV_GROUP,"")}),null===e)return kn({code:Hn.INVALID_CONV_ID});var s="".concat(this._n,".").concat("pinConversation"),a="convID:".concat(n," isPinned:").concat(o),r=new ao("pinConversation");return r.setMessage(a),Pe.l("".concat(s,". ").concat(a)),this.req({P:Kn.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:!0===o?1:2,itemList:[e]}}).then((function(){return r.end(),Pe.l("".concat(s," ok")),i?i.isPinned!==o&&(i.isPinned=o):t._convMap.set(n,new hi({conversationID:n,type:kt(n)?k.CONV_C2C:k.CONV_GROUP,isPinned:o},t.isIntl(),t.isUsingChatCore())),t._sortConvListAndEmitEvent(),Sn({conversationID:n})})).catch((function(e){return r.setError(e).end(),Pe.e("".concat(s," failed. error:"),e),kn(e)}))}},{key:"setMessageRemindType",value:function(e){return this._msgRemindHandler.set(e)}},{key:"patchMsgRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,o=e.messageRemindType,i=!1;return(n=this.getLocalConversation("".concat(n?k.CONV_C2C:k.CONV_GROUP).concat(t)))&&n.messageRemindType!==o&&(n.messageRemindType=o,i=!0),Pe.l("".concat(this._n,".patchMsgRemindType options:"),e,"ret:".concat(i)),i}},{key:"onC2CMsgRemindTypeFetched",value:function(e){var t,n=this;Xe(e)&&0<e.length&&(t=0,e.forEach((function(e){var o=e.userID;e=e.muteFlag,e=n._transMsgRemindType(e),!0===n.patchMsgRemindType({ID:o,isC2CConversation:!0,messageRemindType:e})&&(t+=1)})),Pe.l("".concat(this._n,".onC2CMsgRemindTypeFetched updateCount:").concat(t)),1<=t&&this.emitConvUpdate(!0,!1))}},{key:"onC2CMsgRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMsgRemindTypeSynced");e.dataList.forEach((function(e){var o;je(e.muteNotificationsSync)||(o=(e=e.muteNotificationsSync).to,e=e.muteFlag,e=t._transMsgRemindType(e),t.patchMsgRemindType({ID:o,isC2CConversation:!(o=0),messageRemindType:e})&&(o+=1),Pe.l("".concat(n," updateCount:").concat(o)),1<=o&&t.emitConvUpdate(!0,!1))}))}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){this._msgRemindHandler.onGroupMsgRemindTypeUpdated(e)}},{key:"deleteLocalConv",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this._convMap.has(e);Pe.l("".concat(this._n,".deleteLocalConv convID:").concat(e," has:").concat(n)),n&&(this._convMap.delete(e),this._convMapForDiff.delete(e),this.clearMemMsg(e),this._setStorageConvList(!0),t)&&(n=!this._isTopicConv(e),this.emitConvUpdate(n,!1))}},{key:"pullMsgOnInvite",value:function(e){var t,n,o,i,s,a=this.get(7);a&&(t="".concat(this._n,".pullMsgOnInvite"),Pe.l("".concat(t," flag:").concat(this._bPullOnInvite)),this._bPullOnInvite&&(s=this.getLocalLastMessage(e),n=this.getLocalSecondLastMessage(e),i=o=1,s&&(o=s.sequence),n&&(i=n.sequence),s=a.getGroupRemoteLastSeq(e.replace(k.CONV_GROUP,"")),Pe.l("".concat(t," convID:").concat(e," localLastSeq:").concat(o," localSecondLastSeq:").concat(i," remoteLastSeq:").concat(s)),this.clearMemMsg(e),1<o-i?this._recursiveGetMsgList([],e,!1,o,i):1<s-o&&this._recursiveGetMsgList([],e,!0,s,o)))}},{key:"_recursiveGetMsgList",value:function(e,t,n,o,i,s){var a=this;this.getMessageList({conversationID:t,nextReqMessageID:s}).then((function(s){var r=(s=s.data).messageList,c=s.isCompleted,u=(s=s.nextReqMessageID,r.filter((function(e){return n?e.sequence>i&&e.sequence<=o:e.sequence>i&&e.sequence<o})));e.unshift.apply(e,v(u)),!c&&0<r.length&&r[0].sequence>i&&e.length<60?a._recursiveGetMsgList(e,t,n,o,i,s):a._emitMsgReceived(t,e)}))}},{key:"_emitMsgReceived",value:function(e,t){var n,o,i=this;0<t.length&&(t=t.filter((function(e,t,n){return t===n.findIndex((function(t){return t.sequence===e.sequence}))})),n=this.hasLocalConversation(e),o=t.map((function(e){return e.sequence})),Pe.l("".concat(this._n,"._emitMsgReceived convID:").concat(e," has:").concat(n," count:").concat(o.length," sequenceList:"),o),this.emitOEvt(D.MESSAGE_RECEIVED,t),n?this.patchConvLastMessage(e,!0):this.getConversationProfile(e).then((function(){i.patchConvLastMessage(e,!0)})))}},{key:"deleteLocalConvList",value:function(e){var t=this,n=!1;e.forEach((function(e){t._convMap.has(e)&&(t.deleteLocalConv(e,!1),n=!0)})),Pe.l("".concat(this._n,".deleteLocalConvList convID:").concat(e," isConvIDExisted:").concat(n)),n&&this.emitConvUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._msgListHandler.hasLocalMsg(e.conversationID,e.ID)&&!this._sll.has(e.random))}},{key:"modifyMessageList",value:function(e){var t,n;e.startsWith(k.CONV_C2C)&&this._convMap.has(e)&&(n=this._convMap.get(e),t=Date.now(),this._msgListHandler.modifyMsgSentByPeer({conversationID:e,latestNick:n.userProfile.nick,latestAvatar:n.userProfile.avatar}),n=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._msgListHandler.modifyMsgSentByMe({conversationID:e,latestNick:n.nick,latestAvatar:n.avatar}),Pe.l("".concat(this._n,".modifyMessageList convID:").concat(e," cost:").concat(Jt(t))))}},{key:"updateUserProfileSpecifiedKey",value:function(e){Pe.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick;e=e.avatar,this._convMap.has(t)&&(t=this._convMap.get(t).userProfile,pt(n)&&t.nick!==n&&(t.nick=n),pt(e)&&t.avatar!==e&&(t.avatar=e),this.emitConvUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(e){var n=this,o=this.getLocalConvList(),i=Date.now();o.forEach((function(o){n.modifyMessageSentByMe(t({conversationID:o.conversationID},e))})),Pe.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(Jt(i)))}},{key:"modifyMessageSentByMe",value:function(e){this._msgListHandler.modifyMsgSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._msgListHandler.getLatestMsgSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._msgListHandler.modifyMsgSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._msgListHandler.getLatestMsgSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._msgListHandler.pushIn(t)||this._sll.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._msgListHandler.getLocalLastMsg(e)}},{key:"getLocalSecondLastMessage",value:function(e){return this._msgListHandler.getLocalSecondLastMsg(e)}},{key:"checkAndPatchRemark",value:function(){var e,t,n=this.get(8);0===this._convMap.size||!n||0!==(e=v(this._convMap.values()).filter((function(e){return e.type===k.CONV_C2C}))).length&&(t=0,e.forEach((function(e){var o=e.conversationID.replace(k.CONV_C2C,"");n.isMyFriend(o)&&(o=n.getFriendRemark(o),e.remark!==o&&(e.remark=o,t+=1))})),Pe.l("".concat(this._n,".checkAndPatchRemark. c2cConvCount:").concat(e.length," patchedCount:").concat(t)),0<t&&this.emitConvUpdate(!0,!1))}},{key:"updateTopicConversation",value:function(e){this._updateLocalConvList({conversationOptionsList:e,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===k.CONV_C2C?n=this._m.get(6):t.conversationType===k.CONV_GROUP&&(n=this._m.get(7)),n?n.sendReadReceipt(e):kn({code:Hn.NO_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===k.CONV_C2C?n=this._m.get(6):t.conversationType===k.CONV_GROUP&&(n=this._m.get(7)),n?n.getReadReceiptList(e):kn({code:Hn.NO_MODULE})}},{key:"getLastMessageTime",value:function(e){return(e=this.getLocalConversation(e))?e.lastMessage.lastTime:0}},{key:"getTotalUnreadCount",value:function(){var e=this.getLocalConvList(),t=0;return e.forEach((function(e){e.type!==k.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==k.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"onTotalUnreadCountUpdate",value:function(){var e=this.getTotalUnreadCount();this._convTotalUnreadCount!==e&&(Pe.l("".concat(this._n,".onTotalUnreadCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOEvt(D.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(e){if(e=this.getLocalConversation(e),ht(e))return!0;var t=e.type===k.CONV_TOPIC,n=e.type===k.CONV_GROUP&&e.groupProfile.type===k.GRP_ROOM;return e=e.type===k.CONV_GROUP&&e.groupProfile.type===k.GRP_LIVE,!(t||n||e)}},{key:"setAllRcvMsgOpt",value:function(e){return this._msgRemindHandler.setAllRcvMsgOpt(e)}},{key:"getAllRcvMsgOpt",value:function(){return this._msgRemindHandler.getAllRcvMsgOpt()}},{key:"onAllRcvMsgOptNotify",value:function(e){this._msgRemindHandler.onAllRcvMsgOptNotify(e)}},{key:"clearUnreadCount",value:function(e){(e=this.getLocalConversation(e))&&0<e.unreadCount&&(e.unreadCount=0,this.emitConvUpdate(!0,!1))}},{key:"storeHoppingMessageList",value:function(e){this._msgListHandler.storeHoppingMsgList(e)}},{key:"clearMemMsg",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Pe.l("".concat(this._n,".clearMemMsg convID:").concat(e," isOverLimit:").concat(t)),this._msgListHandler.removeByConvID(e),this._completedMap.delete(e),this._roamingMsgKeyAndTimeMap.delete(e),this._everClearedMap.set(e,1)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._setStorageConvList(!0),this._pagingStatus=Nn,this._msgListHandler.reset(),this._msgRemindHandler.reset(),this._roamingMsgKeyAndTimeMap.clear(),this._sll.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._convMap.clear(),this._pagingTs=0,this._pagingStartIdx=0,this._pagingPinnedTs=0,this._pagingPinnedStartIdx=0,this._remoteGroupReadSeqMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this._convMapForDiff.clear(),this._partialUpdatedConvMap.clear(),this._everClearedMap.clear(),this._bPullOnInvite=!0,this._convGroupHandler.reset(),this.resetReady()}}]),as),vi=(s(ss,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupTipsMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var o=e._checkCountMap.get(n),i=e._grpM.hasLocalGroup(n);Pe.l("".concat(e._n,"._check groupID:").concat(n," hasLocalGroup:").concat(i," checkCount:").concat(o)),i?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)}))}},{key:"onNewGroupTips",value:function(e){Pe.l("".concat(this._n,".onNewGroupTips options:").concat(JSON.stringify(e.dataList)));var t=(e=this._assembly(e)).eventDataList,n=e.result;0<(e=e.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(e),0<n.length&&(this._grpM.emitOEvt(D.MESSAGE_RECEIVED,n),this._handleTips(n)),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:!0}))}},{key:"_assembly",value:function(e){for(var n=e.event,o=e.dataList,i=null,s=[],a=[],r={},c=[],u=0,l=o.length;u<l;u++){var d=lt(o[u]);if(6===n){if(this._grpM.isGroupAttributesUpdatedNotice(d))continue;if(this._grpM.isGroupCountersNotice(d))continue}var p=(f=d.groupProfile).groupID,h=void 0===(h=f.communityType)?0:h,g=void 0===(g=f.topicID)?void 0:g,_=f.invisible,f=void 0===(f=f.groupType)?void 0:f,m=void 0;if((y=this._grpM.isMessageFromTopic(h,g))&&(m=k.CONV_TOPIC,d.to=g),(v=this._grpM.hasLocalGroup(p))||!this._grpM.isUnjoinedAVChatRoom(p))if(v||y)if(this._grpM.isMessageFromOrToAVChatroom(p))d.event=n,c.push(d);else if(d.currentUser=this._grpM.getMyUserID(),d.conversationType=k.CONV_GROUP,(i=new Oo(d)).setElement({type:k.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),i.isSystemMessage=!1,1!==_){var v=this._grpM.get(11),y=(_=(y=i).conversationID,y.sequence);if(6===n)i._onlineOnlyFlag=!0,a.push(i);else if(!v.pushIntoNoticeResult(a,i))continue;this._grpM.isMessageFromCommunityOfTopic(h,g)||6===n&&v.getLocalConversation(_)||(6!==n&&this._qualityStat(i),h=v.isRemoteRead({conversationID:_,sequence:y}),ht(r[_])?(g=0,"in"===i.flow&&(i._isExcludedFromUnreadCount||i._onlineOnlyFlag||h||(g=1)),r[_]=s.push({conversationID:_,unreadCount:g,type:ht(m)?i.conversationType:m,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(s[v=r[_]].type=i.conversationType,s[v].subType=i.conversationSubType,s[v].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||i._onlineOnlyFlag||h||s[v].unreadCount++)))}else this._qualityStat(i);else this._cacheAndCompare({groupID:p,event:n,item:d,groupType:f})}return{eventDataList:s,result:a,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e){this._grpM.get(26).addMessageSequence({key:Qn,message:e})}},{key:"_handleTips",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Pe.w("".concat(t._n,"._handleTips unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=(e=e.payload).memberNum;e=e.groupProfile.groupID,(e=this._grpM.getLocalGroupProfile(e))&&We(t)&&e.memberCount!==t&&(e.memberCount=t,this._updateConvGroupProfile(e))}},{key:"_onMemberQuit",value:function(e){var t=(n=e.payload).memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&We(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConvGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=(n=e.payload).memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&We(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConvGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach((function(e){(e=n.getLocalGroupMemberInfo(t,e))&&e.updateRole(k.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach((function(e){(e=n.getLocalGroupMemberInfo(t,e))&&e.updateRole(k.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=(e=e.payload).newGroupProfile,o=e.groupProfile,i=e.operatorInfo,s=(e=o.groupID,this._grpM.getLocalGroupProfile(e));Object.keys(n).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(s,n);break;case"groupName":s.name=n[e];break;default:s[e]=n[e]}})),ht(i)||Object.keys(i).forEach((function(e){var t;"nameCard"===e?s.updateSelfInfo({nameCard:i[e]}):"role"===e&&(t="",400===i[e]?t=k.GRP_MBR_ROLE_OWNER:300===i[e]?t=k.GRP_MBR_ROLE_ADMIN:200===i[e]&&(t=k.GRP_MBR_ROLE_MEMBER),s.updateSelfInfo({role:t}))})),o=!s.isSupportTopic,this._grpM.emitGroupListUpdate(!0,o)}},{key:"_ownerChanged",value:function(e,t){e=e.groupID;var n=this._grpM.getLocalGroupProfile(e),o=this._grpM.getMyUserID();o===t.ownerID&&(n.updateGroup({selfInfo:{role:k.GRP_MBR_ROLE_OWNER}}),n=(t=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(e,o),o=this._grpM.getLocalGroupProfile(e).ownerID,t=t.getLocalGroupMemberInfo(e,o),n&&n.updateRole(k.GRP_MBR_ROLE_OWNER),t&&t.updateRole(k.GRP_MBR_ROLE_MEMBER))}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=(o=e.payload).groupProfile,o=o.memberList,i=n.groupID,s=(Dt(t)&&this._updateTopicMuteTime(e),this._grpM.getGroupMemberHandler());o.forEach((function(e){var t=s.getLocalGroupMemberInfo(i,e.userID);t&&We(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=(e=e.payload).groupProfile,o=void 0===(e=e.memberList)?[]:e,i=(e=this._grpM.get(10),n=n.groupID,e.getLocalTopic(n,t));if(i){for(var s=!1,a=0;a<o.length;a++){var r=o[a];if(r.userID===this._grpM.getMyUserID()&&0<=r.muteTime){i.updateSelfInfo({muteTime:r.muteTime}),s=!0;break}}s&&this._grpM.emitOEvt(D.TOPIC_UPDATED,{groupID:n,topic:i})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=(o=e.payload).groupProfile.groupID,o=o.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(t({groupID:n,topicID:e.to},o))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e,t){var n=this,o=this._cachedGroupTipsMap.get(e)||[];Pe.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," groupType:").concat(t," count:").concat(o.length)),o.forEach((function(e){n.onNewGroupTips(e)})),this._deleteCachedGroupTips(e)}},{key:"_cacheAndCompare",value:function(e){var t=e.groupID,n=e.event,o=e.item;e=e.groupType,Pe.l("".concat(this._n,"._cacheAndCompare groupID:").concat(t," groupType:").concat(e)),this._cacheGroupTips(t,{event:n,dataList:[o]}),n={groupID:t,type:e},e===k.GRP_AVCHATROOM?this._grpM.hasLocalGroup(t)?this._notifyCachedGroupTips(t,e):this._grpM.setUnjoinedAVChatRoom(t):(this._grpM.updateGroupMap([n]),this._notifyCachedGroupTips(t,e)),this._checkCountMap.has(t)||this._checkCountMap.set(t,0)}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),ss),yi=(s(is,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupMessageMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var o=e._checkCountMap.get(n),i=e._grpM.hasLocalGroup(n);Pe.l("".concat(e._n,"._check groupID:").concat(n," hasLocalGroup:").concat(i," checkCount:").concat(o)),i?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)}))}},{key:"updateLastMsg",value:function(e){var n="".concat(this._n,".updateLastMsg");if(0!==this._grpM.getGroupMap().size){for(var o,i,s,a,r=!1,c=e.length,u=0;u<c;u++)(o=e[u]).type===k.CONV_GROUP&&0!==o.lastMessage.lastSequence&&null!==o.lastMessage.payload&&(i=o.conversationID.split(/^GROUP/)[1],(i=this._grpM.getLocalGroupProfile(i))&&(s=i.lastMessage,a=o.lastMessage,JSON.stringify(s)!==JSON.stringify(a)&&(i.lastMessage=t({},o.lastMessage),r=!0)));Pe.l("".concat(n," convCount:").concat(c," groupCount:").concat(this._grpM.getLocalGroupList().length," isUpdated:").concat(r)),r&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewMessage",value:function(e){var t,n=(t=this._assembly(e)).conversationOptionsList,o=t.messageList;0<(0<(0<(t=t.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(t),t=Mt(o)).length&&this._grpM.emitOEvt(D.MESSAGE_MODIFIED,t),0<n.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:n,isInstantMessage:!1!==e.isInstantMessage,updateUnreadCount:!1!==e.updateUnreadCount}),this._grpM.updateNextMessageSeq(n)),t=Tt(o)).length&&this._grpM.emitOEvt(D.MESSAGE_RECEIVED,t),o.length=0}},{key:"_assembly",value:function(e){var t=e.dataList,n=e.event,o=e.isInstantMessage,i=null,s=[],a=[],r=[],c={},u=this._grpM.getFileDownloadProxy(),l=this._grpM.getDowloadFileAuthKey(),d=this._grpM.get(17).getFileDNList(),p=t.length;1<p&&t.sort((function(e,t){return e.sequence-t.sequence}));for(var h=this._grpM.get(11),g=this._grpM.get(4),_=0;_<p;_++){var f,m=lt(t[_]),v=(C=m.groupProfile).groupID,y=void 0===(y=C.communityType)?0:y,I=void 0===(I=C.topicID)?void 0:I,M=C.invisible,C=void 0===(C=C.groupType)?void 0:C,T=void 0,E=this._grpM.isMessageFromTopic(y,I),S=(E&&(T=k.CONV_TOPIC,m.to=I),this._grpM.hasLocalGroup(v));!S&&this._grpM.isUnjoinedAVChatRoom(v)||(S||E?this._grpM.isMessageFromOrToAVChatroom(v)?(m.event=n,r.push(m)):(m.currentUser=this._grpM.getMyUserID(),m.conversationType=k.CONV_GROUP,m.isSystemMessage=!!m.isSystemMessage,(i=new Oo(m)).setElement(m.elements,u,l,d),1!==M?(S=1===t[_].isModified,h.isMessageSentByCurrentInstance(i)?i.isModified=S:S=!1,1===m.onlineOnlyFlag?(i._onlineOnlyFlag=!0,h.isMessageSentByCurrentInstance(i)||a.push(i)):this._grpM.isMessageFromCommunityOfTopic(y,I)?a.push(i):(i.from!==this._grpM.getMyUserID()||(E=h.getLatestMessageSentByMe(i.conversationID))&&(M=E.nick,y=E.avatar,M===i.nick&&y===i.avatar||(h.modifyMessageSentByMe({conversationID:f,latestNick:i.nick,latestAvatar:i.avatar}),g.mockOnNickAvatarModified(i.nick,i.avatar))),h.pushIntoMessageList(a,i,S)&&(this._qualityStat(o,i),f=(I=i).conversationID,E=I.sequence,M=h.isRemoteRead({conversationID:f,sequence:E}),ht(c[f])?(y=0,"in"===i.flow&&(i._isExcludedFromUnreadCount||M||(y=1)),c[f]=s.push({conversationID:f,unreadCount:y,type:ht(T)?i.conversationType:T,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(s[S=c[f]].type=ht(T)?i.conversationType:T,s[S].subType=i.conversationSubType,s[S].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||M||s[S].unreadCount++))))):this._qualityStat(o,i)):this._cacheAndCompare({groupID:v,event:n,item:m,groupType:C}))}return{conversationOptionsList:s,messageList:a,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e,t){var n=this._grpM.get(26);n.addMessageSequence({key:Qn,message:t}),e&&0<t.clientTime&&n.addMessageDelay(t.clientTime)}},{key:"onMsgRevoked",value:function(e,t){var n=this,o=this._grpM.get(11),i=[],s=[];e.dataList.forEach((function(e){var t=e.elements.revokedInfos,n=e.revokerInfo,a=e.groupProfile,r=!1;a&&(r=St({groupID:a.groupID})||!je(a.topicID)),ht(t)||t.forEach((function(e){var t,c=je(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID),u=o.getLocalConversation(c),l=e.revokerInfo&&e.revokerInfo.revoker||n&&n.revoker,d=n&&n.reason||"";u&&Et(u.type)?t={conversationID:c,sequence:e.sequence,ID:"".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)}:(u=o.revoke(c,e.sequence,e.random))?t=u:(t={conversationID:c,sequence:e.sequence},e.tinyID&&e.clientTime&&e.random&&(t.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)),e.time&&(t.time=e.time)),t&&(t.revoker=l,t.revokeReason=d,t.revokerInfo={userID:l,nick:"",avatar:""},r?(t.revokerInfo.nick=a.nick,t.revokerInfo.avatar=a.avatar,i.push(t)):s.push(t))}))})),0===s.length&&0===i.length||(o.onMessageRevoked([].concat(i,s),t),0<i.length&&this._grpM.emitOEvt(D.MESSAGE_REVOKED,i),0<s.length&&o.updateRevokerInfo(s).then((function(e){n._grpM.emitOEvt(D.MESSAGE_REVOKED,e)})))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(v(this._grpM.getGroupMap())),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._grpM.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var i=v(t.keys()),s=0,a=i.length;s<a;s++)this._grpM.deleteGroup(i[s])}},{key:"syncGroupList",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=(this._pagingStatus===Nn&&this._grpM.clearGroupMap(),v(x)),o=this.PAGING_GRP_COUNT_LIMIT,i=[];if(!0===t)return this._pagingGetGroupListWithTopic({limit:o,offset:0,groupBaseInfoFilter:n,groupList:i});t="syncGroupList";var s="".concat(this._n,".").concat(t),a=new ao(t);return this._pagingGetGroupList({limit:o,offset:0,groupBaseInfoFilter:n,groupList:i}).then((function(){var t=Wt(e._pagingGetCostList),n=zt(e._pagingGetCostList),o=(e._pagingGetCostList.length=0,e._pagingStatus=bn,e._groupListTreeShaking(i),e._grpM.updateGroupMap(i),e._grpM.getLocalGroupList().length);return o="count:".concat(o," sum:").concat(n," avg:").concat(t),Pe.l("".concat(s," ok. ").concat(o)),a.setMessage(o).end(),e.tempConversationList&&(e.updateLastMsg(e.tempConversationList),e.tempConversationList=null),e._grpM.emitGroupListUpdate(!0,!0),Sn({groupList:e._grpM.getLocalGroupList()})})).catch((function(t){return e._pagingStatus=Un,a.setError(t).end(),Pe.e("".concat(s," failed. error:"),t),kn(t)}))}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList");if(Pe.l("".concat(t," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===Un||this._pagingStatus===Nn)return this.syncGroupList().then((function(){return Sn({groupList:e._grpM.getLocalGroupList(),isSyncCompleted:e.isPagingGetCompleted()})})).catch((function(e){return Pe.e("".concat(t," failed. error:"),e),kn(e)}));var n=this._grpM.getLocalGroupList();return Pe.l("".concat(t,". returned group count:").concat(n.length)),Dn({groupList:n,isSyncCompleted:this.isPagingGetCompleted()})}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===bn}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),o=e.isCommunityRelay,i=void 0!==o&&o,s=e.limit,a=e.offset,r=e.groupBaseInfoFilter,c=e.groupList,u=Date.now();return this._grpM.req({P:Kn.GET_GRP_LIST,data:{type:i?k.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:s,offset:a,responseFilter:{groupBaseInfoFilter:r,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var o=void 0===(o=(e=e.data).groups)?[]:o,l=(e=e.totalCount,c.push.apply(c,v(o)),t._handleGroupAtInfoWithoutTopic(i,o),!((o=a+s)<e));return e="offset:".concat(a," limit:").concat(s," total:").concat(e," isCompleted:").concat(l," ")+"current:".concat(c.length," isCommunityRelay:").concat(i),t._pagingGetCostList.push(Jt(u,!1)),Pe.l("".concat(n," ok. ").concat(e," cost:").concat(Jt(u))),i||l?!i&&l?(Pe.l("".concat(n," start to get community list")),a=0,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):i&&!l?(a=o,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):Sn({groupList:c}):(a=o,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c}))})).catch((function(e){return 10018===e.code?(Pe.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(s)),s=50,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:i})):i?(11e3===e.code&&Pe.l("".concat(n," ok. community unavailable")),Dn({groupList:c})):kn(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),o=e.limit,i=e.offset,s=e.groupBaseInfoFilter,a=e.groupList,r=Date.now();return this._grpM.req({P:Kn.GET_GRP_LIST,data:{type:k.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:o,offset:i,responseFilter:{groupBaseInfoFilter:s,selfInfoFilter:v(V)},isSupportTopic:1,needAppDefineData:1}}).then((function(e){var c=(e=e.data).groups,u=(e=e.totalCount,a.push.apply(a,v(void 0===c?[]:c)),!((c=i+o)<e));return Pe.l("".concat(n," ok. offset:").concat(i," limit:").concat(o," totalCount:").concat(e," isCompleted:").concat(u," currentCount:").concat(a.length," cost:").concat(Jt(r))),u?(t._grpM.updateGroupMap(a),t._grpM.emitGroupListUpdate(!0,!1),Sn({groupList:e=t._grpM.getLocalGroupList().filter((function(e){return!0===e.isSupportTopic}))})):(i=c,t._pagingGetGroupListWithTopic({limit:o,offset:i,groupBaseInfoFilter:s,groupList:a}))})).catch((function(e){return 10018===e.code?(Pe.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(o)),o=50,t._pagingGetGroupListWithTopic({limit:o,offset:i,groupBaseInfoFilter:s,groupList:a})):kn(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e,t){var n=this,o=this._cachedGroupMessageMap.get(e)||[];Pe.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," groupType:").concat(t," count:").concat(o.length)),o.forEach((function(e){n.onNewMessage(e)})),this._deleteCachedGroupMessage(e)}},{key:"_cacheAndCompare",value:function(e){var t=e.groupID,n=e.event,o=e.item;e=e.groupType,Pe.l("".concat(this._n,"._cacheAndCompare groupID:").concat(t," groupType:").concat(e)),this._cacheGroupMessage(t,{event:n,dataList:[o]}),n={groupID:t,type:e},e===k.GRP_AVCHATROOM?this._grpM.hasLocalGroup(t)?this._notifyCachedGroupMessage(t,e):this._grpM.setUnjoinedAVChatRoom(t):(this._grpM.updateGroupMap([n]),this._notifyCachedGroupMessage(t,e)),this._checkCountMap.has(t)||this._checkCountMap.set(t,0)}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var o=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,i=(e=e.groupAtInfoList,[]);ht(e)||(e.forEach((function(e){i.push(t(t({},e),{},{groupID:n}))})),o._grpM.get(11).onNewGroupAtTips({dataList:i}))}))}},{key:"setPagingGroupCount",value:function(e){ht(e)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(e,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=Nn,this._pagingGetCostList=[]}}]),is),Ii=(s(os,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_attr_cache_time");ht(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=(e=e.elements.newGroupProfile,!ht(e)&&!je(e.groupAttributeOption));return n&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:e.groupAttributeOption}),n}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,o=(e=e.groupAttributeOption).mainSequence,i=e.isWithChangedAttributeInfo,s=void 0===(s=e.groupAttributeList)?[]:s;if(e=e.operationType,Pe.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(i," operationType:").concat(e)),!ht(e)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var a=o-this._getLocalGroupAttributes(n).localMainSequence;if(0!=a){if(1===i&&1==a)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:s,operationType:e}),void this._emitGroupAttributesUpdated(n);this._hasLocalGroupAttributes(n)&&(i=this._getLocalGroupAttributes(n).avChatRoomKey,this._getGroupAttributes({groupID:n,avChatRoomKey:i}).then((function(){t._emitGroupAttributesUpdated(n)})))}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID;e=void 0===(e=e.avChatRoomKey)?void 0:e,this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:e}),Pe.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(e))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,o=e.groupAttributes,i=(e=this._getLocalGroupAttributes(n)).remoteMainSequence,s=(e=e.avChatRoomKey,new ao("initGroupAttributes"));return s.setMessage("groupID:".concat(n," avChatRoomKey:").concat(e," mainSequence:").concat(i)),this._grpM.req({P:Kn.SET_GRP_ATTR,data:{groupID:n,avChatRoomKey:e,mainSequence:i,groupAttributeList:this._transformGroupAttributes(o)}}).then((function(e){Pe.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n));var i=(e=e.data).mainSequence;return(e=v(e.groupAttributeList)).forEach((function(e){e.value=o[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:e,operationType:1}),t._emitGroupAttributesUpdated(n),s.end(),Sn({groupAttributes:o})})).catch((function(e){return s.setError(e).end(),kn(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),o=e.groupID,i=e.groupAttributes,s=(e=this._getLocalGroupAttributes(o)).remoteMainSequence,a=e.avChatRoomKey,r=e.attributes,c=((e=this._transformGroupAttributes(i)).forEach((function(e){var t=e.key;e.sequence=0,r.has(t)&&(e.sequence=r.get(t).sequence)})),new ao("setGroupAttributes"));return c.setMessage("groupID:".concat(o," groupAttributes:").concat(JSON.stringify(i))),Pe.l("".concat(n,". groupID:").concat(o," mainSequence:").concat(s)),this._grpM.req({P:Kn.MODIFY_GRP_ATTR,data:{groupID:o,avChatRoomKey:a,mainSequence:s,groupAttributeList:e}}).then((function(e){Pe.l("".concat(n," ok."));var s=(e=e.data).mainSequence;return(e=v(e.groupAttributeList)).forEach((function(e){e.value=i[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:o}),t._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:s,groupAttributeList:e,operationType:2}),t._emitGroupAttributesUpdated(o),c.end(),Sn({groupAttributes:i})})).catch((function(e){return c.setError(e).end(),kn(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,o=(e=void 0===(e=e.keyList)?[]:e,(r=this._getLocalGroupAttributes(n)).remoteMainSequence),i=r.avChatRoomKey,s=r.attributes,a=v(s.keys()),r=Kn.CLEAR_GRP_ATTR,c=3,u=(i={groupID:n,avChatRoomKey:i,mainSequence:o},[]),l=(0<e.length&&(a=[],r=Kn.DEL_GRP_ATTR,c=4,e.forEach((function(e){var t=0;s.has(e)&&(t=s.get(e).sequence,a.push(e)),u.push({key:e,sequence:t})})),i.groupAttributeList=u),new ao("deleteGroupAttributes"));return l.setMessage("groupID:".concat(n," mainSequence:").concat(o," keyList:").concat(e," proto:").concat(r)),this._grpM.req({P:r,data:i}).then((function(e){return Pe.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),e=e.data.mainSequence,t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:e,groupAttributeList:u,operationType:c}),t._emitGroupAttributesUpdated(n),l.end(),Sn({keyList:a})})).catch((function(e){return l.setError(e).end(),kn(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),o=e.groupID,i=(r=this._getLocalGroupAttributes(o)).avChatRoomKey,s=r.lastUpdateTime,a=r.localMainSequence,r=r.remoteMainSequence,c=new ao("getGroupAttributes");return c.setMessage("groupID:".concat(o," localMainSequence:").concat(a," remoteMainSequence:").concat(r," keyList:").concat(e.keyList)),Date.now()-s>=this.CACHE_EXPIRE_TIME||a<r?this._getGroupAttributes({groupID:o,avChatRoomKey:i}).then((function(i){return c.setMoreMessage("get attributes from remote. count:".concat(i.length)).end(),Pe.l("".concat(n," from remote. groupID:").concat(o)),Sn({groupAttributes:i=t._getCachedAttributes(e)})})).catch((function(e){return c.setError(e).end(),kn(e)})):(c.setMoreMessage("get attributes from cache").end(),Pe.l("".concat(n," from cache. groupID:").concat(o)),Dn({groupAttributes:s=this._getCachedAttributes(e)}))}},{key:"_getGroupAttributes",value:function(e){var n=this,o=0;return ht(e.avChatRoomKey)||(o=1),this._grpM.req({P:Kn.GET_GRP_ATTR,data:t(t({},e),{},{groupType:o})}).then((function(t){Pe.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var o=(t=t.data).mainSequence,i=v(t=t.groupAttributeList);return ht(o)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:o,groupAttributeList:i,operationType:5}),t})).catch((function(e){return kn(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,o=e.groupAttributeList;if(e=e.operationType,this._hasLocalGroupAttributes(t)){var i=this._getLocalGroupAttributes(t),s=i.localMainSequence;if(5===e||n-s==1)i.remoteMainSequence=n,i.localMainSequence=n,i.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:i,groupAttributeList:o,operationType:e});else{if(s===n)return;i.remoteMainSequence=n}this._groupAttributesMap.set(t,i),o="operationType:".concat(e," localMainSequence:").concat(s," remoteMainSequence:").concat(n),Pe.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(o))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=(e=void 0===(e=e.keyList)?[]:e,{});if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t).attributes;if(0<e.length)e.forEach((function(e){o.has(e)&&(n[e]=o.get(e).value)}));else{var i,s=S(o.keys());try{for(s.s();!(i=s.n()).done;){var a=i.value;n[a]=o.get(a).value}}catch(r){s.e(r)}finally{s.f()}}}return n}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList;3!==(e=e.operationType)?4!==e?(1===e&&t.attributes.clear(),n.forEach((function(e){var n=e.key,o=e.value;e=e.sequence,t.attributes.set(n,{value:o,sequence:e})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=(o=this._computeAttrChangedInfo(t)).updatedKeyList,o=o.deletedKeyList;Pe.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(n.length,", delete:").concat(o.length)),0===n.length&&0===o.length||this._grpM.emitOEvt(D.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:n,deletedKeyList:o})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],o=[];return Object.keys(e).forEach((function(o){e[o]!==t._groupAttributesCopy[o]&&n.push(o)})),Object.keys(this._groupAttributesCopy).forEach((function(t){ht(e[t])&&o.push(t)})),this._groupAttributesCopy={},{updatedKeyList:n,deletedKeyList:o}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),os),Mi=(s(ns,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_counter_expire_time");ht(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=!1;return je(e=e.elements.groupCounterInfo)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:e}),n=!0),n}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var o=e.type,i=e.groupCounterSeq;e=void 0===(e=e.counterList)?[]:e,0!==o&&2!==o||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:i,counterList:e}),e.forEach((function(e){t._grpM.emitOEvt(D.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===o&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:i,counterList:e})})),Pe.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID;e=e.avChatRoomKey,this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:e}),Pe.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(e))}},{key:"setGroupCounters",value:function(e){if(!this._grpM.canIUse(w.GRP_COUNTER))return this._grpM.noUse("setGroupCounters");var t="".concat(this._n,".").concat("setGroupCounters"),n=e.groupID,o=(e=e.counters,e=this._convertObjectToList(e),this._getLocalGroupCounters(n).avChatRoomKey),i="groupID:".concat(n," count:").concat(e.length),s=new ao("setGroupCounters");return s.setMessage("".concat(i)),Pe.l("".concat(t,". ").concat(i)),this._updateGroupCounters({groupID:n,counterList:e,avChatRoomKey:o,mode:"Set"}).then((function(e){return s.end(),Pe.l("".concat(t," ok.")),Sn({counters:e})})).catch((function(e){return s.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"increaseGroupCounter",value:function(e){var t="increaseGroupCounter";if(!this._grpM.canIUse(w.GRP_COUNTER))return this._grpM.noUse(t);var n="".concat(this._n,".").concat(t),o=e.groupID,i=e.key,s=(e=e.value,this._getLocalGroupCounters(o).avChatRoomKey),a="groupID:".concat(o," key:").concat(i," value:").concat(e),r=new ao(t);return r.setMessage("".concat(a)),Pe.l("".concat(n,". ").concat(a)),this._updateGroupCounters({groupID:o,counterList:[{key:i,value:e}],avChatRoomKey:s,mode:"Increase"}).then((function(e){return r.end(),Pe.l("".concat(n," ok.")),Sn({counters:e})})).catch((function(e){return r.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t="decreaseGroupCounter";if(!this._grpM.canIUse(w.GRP_COUNTER))return this._grpM.noUse(t);var n="".concat(this._n,".").concat(t),o=e.groupID,i=e.key,s=(e=e.value,this._getLocalGroupCounters(o).avChatRoomKey),a="groupID:".concat(o," key:").concat(i," value:").concat(e),r=new ao(t);return r.setMessage("".concat(a)),Pe.l("".concat(n,". ").concat(a)),this._updateGroupCounters({groupID:o,counterList:[{key:i,value:e}],avChatRoomKey:s,mode:"Decrease"}).then((function(e){return r.end(),Pe.l("".concat(n," ok.")),Sn({counters:e})})).catch((function(e){return r.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._grpM.canIUse(w.GRP_COUNTER))return this._grpM.noUse("getGroupCounters");var n="".concat(this._n,".").concat("getGroupCounters"),o=e.groupID,i=void 0===(e=e.keyList)?[]:e,s=(e=this._getLocalGroupCounters(o)).avChatRoomKey,a=(e=e.lastUpdateTime,new ao("getGroupCounters"));return a.setMessage("groupID:".concat(o)),Date.now()-e>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:o,avChatRoomKey:s}).then((function(e){return a.setMoreMessage("from remote. count:".concat(e.length)).end(),Pe.l("".concat(n," from remote. groupID:").concat(o)),Sn({counters:e=t._getLocalCounters(o,i)})})).catch((function(e){return a.setError(e).end(),kn(e)})):(a.setMoreMessage("from cache").end(),Pe.l("".concat(n," from cache. groupID:").concat(o)),Dn({counters:e=this._getLocalCounters(o,i)}))}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._grpM.req({P:Kn.GET_GRP_COUNTER,data:t({},e)}).then((function(t){var o=void 0===(o=(t=t.data).counterList)?[]:o;return t=t.groupCounterSeq,n._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:t}),Pe.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o})).catch((function(e){return kn(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),o=e.groupID,i=e.avChatRoomKey,s=e.mode;return Pe.l("".concat(n,". groupID:").concat(o," avChatRoomKey:").concat(i," mode:").concat(s)),this._grpM.req({P:Kn.UPDATE_GRP_COUNTER,data:t({},e)}).then((function(e){Pe.l("".concat(n," ok.")),e=e.data.counterList;var t={};return(void 0===e?[]:e).forEach((function(e){var n=e.key;e=e.value,t[n]=e})),t})).catch((function(e){return kn(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t,n,o,i=e.groupID,s=void 0===(s=e.counterList)?[]:s;e=e.groupCounterSeq,this._hasLocalGroupCounters(i)&&(o=this._getLocalGroupCounters(i),t=o.counters,n=o.avChatRoomKey,o=o.groupCounterSeq,0<e&&e<o||(s.forEach((function(e){var n=e.key;e=e.value,t.set(n,e)})),this._groupCountersMap.set(i,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:t,avChatRoomKey:n})))}},{key:"_deleteLocalGroupCounters",value:function(e){var t,n,o=e.groupID,i=void 0===(i=e.counterList)?[]:i;e=e.groupCounterSeq,this._hasLocalGroupCounters(o)&&(n=this._getLocalGroupCounters(o),t=n.counters,n=n.avChatRoomKey,i.forEach((function(e){t.delete(e.key)})),this._groupCountersMap.set(o,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:t,avChatRoomKey:n}))}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var o=this._getLocalGroupCounters(e).counters;if(0<t.length)t.forEach((function(e){o.has(e)&&(n[e]=o.get(e))}));else{var i,s=S(o.keys());try{for(s.s();!(i=s.n()).done;){var a=i.value;n[a]=o.get(a)}}catch(r){s.e(r)}finally{s.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),ns),Ci=(s(ts,[{key:"start",value:function(){var e=this._grpM.isLoggedIn();e||(this._proto=Kn.AV_NOAUTH_POLLING),Pe.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._grpM.req({P:this._proto,data:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(-1<e._timeoutID&&clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(-1<e._timeoutID&&clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Pe.l("".concat(this._n,".stop")),-1<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),ts),Ti={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0,100:!0},Ei=(s(es,[{key:"hasJoinedAVChatRoom",value:function(){var e=[];return 0<(e=0<this._joinedGroupMap.size?v(this._joinedGroupMap.values()).filter((function(e){return e.type===k.GRP_AVCHATROOM})):e).length}},{key:"getJoinedLiveList",value:function(){var e=[];return 0<this._joinedGroupMap.size?v(this._joinedGroupMap.values()).filter((function(e){return e.type===k.GRP_LIVE})):e}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?v(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===v(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n,o=(c=t.data).key,i=c.nextSeq,s=c.rspMsgList,a=c.errorCode,r=c.nextBroadcastSeq,c=c.broadcastMessageList;0!==a?(a=this._pollingRequestInfoMap.get(e),n=new ao("longPollingAVError"),a=a?"".concat(a.key,"-").concat(a.startSeq):"requestInfo is undefined",n.setMessage("".concat(e,"-").concat(a,"-").concat(t.errorInfo)).setCode(t.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(e)&&(pt(o)&&We(i)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:i}),We(r)&&r>this._startBroadcastSeq&&(this._startBroadcastSeq=r),Xe(s)&&0<s.length?(s.forEach((function(e){e.to=e.groupID})),this.onMessage(s,e)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c))}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e,t){if(Xe(e)&&0!==e.length){var n="".concat(this._n,".onMessage"),o=(t&&(n+=" groupID:".concat(t)),0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),i=[],s=this._get(11),a=this._get(26),r=e.length,c=(1<r&&e.sort((function(e,t){return e.sequence-t.sequence})),this._get(12).isUnlimitedAVChatRoom()),u=!1;Pe.getLevel()<=0&&(t=e.map((function(e){return e.sequence})),Pe.l("".concat(n," count:").concat(t.length," sequenceList:").concat(t)),t.length=0);for(var l=0;l<r;l++){var d=this.restoreMessageFromSimplified(e[l]);if(Ti[d.event]){if(6===d.event){if(this._grpM.isGroupAttributesUpdatedNotice(d))continue;if(this._grpM.isGroupCountersNotice(d))continue}if(20!==d.event)if(21!==d.event)if(100!==d.event){o=this.packMessage(d,d.event);var p=1===d.isModified;if(u=1===d.isHistoryMessage,!c){if(this._seqSll.has(o.sequence))continue;this._seqSll.set(o.sequence)}var h=this._IDSll.has(o.ID);h?Pe.w("".concat(n," ID:").concat(o.ID," has:").concat(h)):(this._IDSll.set(o.ID),h=!1,!u&&this._isMessageSentByCurrentInstance(o)?p&&(h=!0,o.isModified=p,s.updateMsgIsModifiedProp(o)):h=!0,h&&(o.conversationType===k.CONV_SYSTEM&&5===o.payload.operationType&&this._onGroupDismissed(o.payload.groupProfile.groupID),u||o.conversationType===k.CONV_SYSTEM||(p=o.conversationID.replace(k.CONV_GROUP,""),this._pollingInstanceMap.has(p)?this._grpM.isLoggedIn()&&a.addMessageSequence({key:to,message:o}):(o.type!==k.MSG_GRP_TIP&&0<o.clientTime&&a.addMessageDelay(o.clientTime),a.addMessageSequence({key:eo,message:o}))),i.push(o)))}else this.onRoomCustomData(d);else this._get(34).onMessageReactionNotify({event:21,dataList:d.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(d)}else Pe.w("".concat(n,". unknown event:").concat(d.event))}0!==i.length&&(0<(t=Mt(i)).length&&this._grpM.emitOEvt(D.MESSAGE_MODIFIED,t),u||0<(t=this.packConversationOption(i)).length&&s.onNewMessage({conversationOptionsList:t,isInstantMessage:!0}),this._checkMessageStacked(i),0<(t=Tt(i)).length&&this._grpM.emitOEvt(D.MESSAGE_RECEIVED,t),i.length=0)}}},{key:"handleMessageRevokedNotice",value:function(e){var t=this,n=e.groupID,o=e.elements.revokeMsgList,i=e.revokerInfo,s=[];o.forEach((function(e){var t=e.tinyID,o=e.clientTime,a=e.random;e=e.sequence,t={conversationID:"".concat(k.CONV_GROUP).concat(n),ID:"".concat(t,"-").concat(o,"-").concat(a),revoker:i.revoker,revokeReason:i.reason||"",revokerInfo:{userID:i.revoker,nick:"",avatar:""},sequence:e},s.push(t)})),0!==s.length&&this._get(11).updateRevokerInfo(s).then((function(e){t._grpM.emitOEvt(D.MESSAGE_REVOKED,e)}))}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=void 0===(t=e.operatorInfo)?{}:t,n=e.operatorID,o=void 0===(o=e.userIDList)?[]:o,i=e.operationType,s=(We(e.groupJoinType)||1!==i&&2!==i||(e.groupJoinType=2===i?0:1),i=t.userID,t.avatar);return t=t.nick,e.operatorInfo={userID:void 0===i?n:i,avatar:void 0===s?"":s,nick:void 0===t?"":t},n=o.map((function(e){return{userID:e}})),e.memberInfoList=e.memberInfoList||n,e}},{key:"restoreMessageFromSimplified",value:function(e){var n,o,i,s=e.event;return this.isBroadcastOrNormal(s)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){var n;return e.type===k.MSG_CUSTOM&&(n=e.content,e.content=t({data:"",description:"",extension:""},void 0===n?{}:n)),e}))),(this.isGroupTip(s)||this.isGroupSystemNotice(s))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(s)&&(e.elements=this.restoreGroupTipElements(e.elements),o=(i=void 0===(i=e.elements)?{}:i).operationType,n=i.operatorInfo,1===o&&(o=[{userID:(void 0===n?{}:n).userID}],i.memberInfoList=i.memberInfoList||o)),this.isGroupSystemNotice(s)&&(i=(n=e.elements).memberInfoList,o=n.operatorInfo,e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},i=i||(void 0===o?{}:o)),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements),s=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,o){return t(t({},n),{},a({},o,e.elements[o]))}),{}),e.elements=s),e}},{key:"_onGroupDismissed",value:function(e){Pe.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked";100<=(e=e.length)&&(this._grpM.warn(t,e),this._reportMessageStackedCount<5&&(new ao(t).setMessage("count:".concat(e," groupID:").concat(v(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._get(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._grpM.getMyUserID(),e.conversationType=5===t?k.CONV_SYSTEM:k.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new Oo(e),o=(e=this.packElements(e,t),t=this._grpM.getFileDownloadProxy(),this._grpM.getDowloadFileAuthKey()),i=this._get(17).getFileDNList();return n.setElement(e,t,o,i),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:k.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:k.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:e.elements}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var o,i=e[n],s=i.conversationID;t.has(s)?"in"===((o=t.get(s)).lastMessage=i).flow&&o.unreadCount++:t.set(s,{conversationID:i.conversationID,unreadCount:"out"===i.flow?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return v(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t,n,o,i=e.groupProfile.groupID;je(e=void 0===(e=e.elements.onlineMemberInfo)?void 0:e)||(t=void 0===(t=e.onlineMemberNum)?0:t,e=void 0===(e=e.expireTime)?this.DEFAULT_EXPIRE_TIME:e,n=this._onlineMemberCountMap.get(i)||{},o=Date.now(),je(n)?Object.assign(n,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:o,memberCount:t,expireTime:e}):(n.latestUpdateTime=o,n.memberCount=t),this._onlineMemberCountMap.set(i,n))}},{key:"_onBroadcastMessage",value:function(e){if(!je(e)){for(var t=[],n=e.length,o=null,i=0;i<n;i++){var s=this.restoreMessageFromSimplified(e[i]);Ti[s.event]?((o=this.packMessage(s,s.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(o.ID)||(t.push(o),this._broadcastMessageIDMap.set(o.ID,1))):Pe.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(s.event))}0<t.length&&this._grpM.emitOEvt(D.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){var t;this._pollingInstanceMap.has(e)?(t=this._pollingInstanceMap.get(e)).isRunning()||t.start():((t=new Ci({manager:this,groupID:e,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(e,t),Pe.l("".concat(this._n,".start groupID:").concat(e)))}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck(e.group).then((function(){var n=e.longPollingKey,o=e.group,i=o.groupID;return t._joinedGroupMap.set(i,o),t._grpM.updateGroupMap([o]),t._grpM.deleteUnjoinedAVChatRoom(i),t._grpM.emitGroupListUpdate(!0,!1),ht(n)?Dn({status:Ve,group:o}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,o=e.group,i=e.startSeq,s=o.groupID;return t._pollingRequestInfoMap.set(s,{key:n,startSeq:void 0===i?0:i}),t.start(s),t._grpM.isLoggedIn()?Dn({status:Ve,group:o}):Dn({status:Ve})}))}},{key:"_preCheck",value:function(e){if(this._get(12).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();if(e.type===k.GRP_LIVE)return Promise.resolve();var t=(e=m(this._joinedGroupMap.entries().next().value,2))[0];if(e=e[1],this._grpM.isLoggedIn()){if(e.selfInfo.role!==k.GRP_MBR_ROLE_OWNER&&e.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(t);this._grpM.deleteLocalGroupAndConversation(t)}else this._grpM.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".").concat("joinWithoutAuth"),i=new ao("joinWithoutAuth");return this._grpM.req({P:Kn.APPLY_JOIN_GRP_NOAUTH,data:e}).then((function(e){if(e=e.data.longPollingKey,i.setMessage("groupID:".concat(n," longPollingKey:").concat(e)).end(!0),ht(e))return kn({code:Hn.CANNOT_JOIN_NON_AV_WITHOUT_LOGIN});Pe.l("".concat(o," ok. groupID:").concat(n)),t._get(11).setCompleted("".concat(k.CONV_GROUP).concat(n));var s=new pi({groupID:n});return t.startRunLoop({group:s,longPollingKey:e}),Sn({status:Ve})})).catch((function(e){return Pe.e("".concat(o," failed. groupID:").concat(n," error:"),e),i.setError(e).setMessage("groupID:".concat(n)).end(!0),kn(e)})).finally((function(){t._grpM.get(14).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return je(t)||n-t.lastSyncTime>1e3*t.expireTime&&1e4<n-t.latestUpdateTime&&3e3<n-t.lastReqTime?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return Sn({memberCount:e.memberCount})})).catch((function(e){return kn(e)}))):Dn({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),o=new ao("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(e).then((function(o){var i=t._onlineMemberCountMap.get(e)||{},s=void 0===(s=(o=o.data).memberCount)?0:s,a=(o=void 0===(o=o.expireTime)?t.DEFAULT_EXPIRE_TIME:o,Pe.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(s," expireTime:").concat(o)),Date.now());return je(i)&&(i.lastReqTime=a),t._onlineMemberCountMap.set(e,Object.assign(i,{lastSyncTime:a,latestUpdateTime:a,memberCount:s,expireTime:o})),{memberCount:s}})).catch((function(t){return Pe.w("".concat(n," failed. error:"),t),o.setCode(t.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(t))).end(),Promise.reject(t)}))}},{key:"_get",value:function(e){return this._grpM.get(e)}},{key:"setPollingInterval",value:function(e){ht(e)||(We(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){ht(e)||(We(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){ht(e)||(We(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){ht(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){e=e.payload.groupProfile.groupID,Pe.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"restartPolling",value:function(){Pe.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=S(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(o){t.e(o)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var t=this._pollingInstanceMap.get(e).getPollingTimerID();return Pe.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t}},{key:"hasPollingInstance",value:function(e){return this._pollingInstanceMap.has(e)}},{key:"onRoomCustomData",value:function(e){var t=e.groupID,n=e.sequence,o=e.time;e=(e=e.elements)&&e.content,this._get(30).onRoomCustomDataReceived(e),Pe.l("".concat(this._n,".onRoomCustomData groupID:").concat(t," sequence:").concat(n," time:").concat(o," data:").concat(e))}},{key:"reset",value:function(e){if(e){Pe.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Pe.l("".concat(this._n,".reset all"));var n,o=S(this._pollingInstanceMap.values());try{for(o.s();!(n=o.n()).done;)n.value.stop()}catch(i){o.e(i)}finally{o.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this._seqSll.reset(),this._IDSll.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),es),Si=(s(Qi,[{key:"updateMember",value:function(e){ht(e.onlineStatus)||(this.isOnline="Online"===e.onlineStatus);var t=[null,void 0,"",0,NaN];e.memberCustomField&&It(this.memberCustomField,e.memberCustomField),ot(this,e,["memberCustomField","marks","onlineStatus"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){ht(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){ht(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&It(this.memberCustomField,e)}}]),Qi),Di=(s(Zi,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,o=0;o<n.length;o++)!function(e){var o=n[e];t.groupMemberListMap.forEach((function(e){e.has(o.userID)&&e.get(o.userID).updateMember({nick:o.nick,avatar:o.avatar})}))}(o)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t,n=this,o=e.groupID,i=void 0===(i=e.role)?void 0:i,s=void 0===(c=e.offset)?0:c,a=void 0===(c=e.count)?15:c,r=(e=void 0===(c=e.filter)?void 0:c,"".concat(this._n,".").concat("getGroupMemberList")),c=this._grpM.hasLocalGroup(o);if(Pe.l("".concat(r," groupID:").concat(o," role:").concat(i," offset:").concat(s," count:").concat(a," hasLocalGroup:").concat(c)),!c)return Dn({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(o).type===k.GRP_AVCHATROOM){if(this._grpM.canIUse(w.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:o,offset:s,filter:e});this._grpM.warn("LiveOnlineMember")}i!==k.GRP_MBR_ROLE_ADMIN&&i!==k.GRP_MBR_ROLE_OWNER&&i!==k.GRP_MBR_ROLE_MEMBER||(t=i);var u=new ao("getGroupMemberList"),l=0,d=(c={groupID:o,limit:100<a?100:a,memberRoleFilter:t?[t]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},St({groupID:o})?c.next="".concat(s):(c.offset=s,l=s+a),[]);return this._grpM.req({P:Kn.GET_GRP_MBR_LIST,data:c}).then((function(e){var t=(e=e.data).members,i=e.memberNum;return e=e.next,ht(e=void 0===e?void 0:e)||(l=je(e)?0:e),Xe(t)&&0!==t.length?(n._grpM.hasLocalGroup(o)&&(n._grpM.getLocalGroupProfile(o).memberNum=i),d=n._updateLocalGroupMemberMap(o,t),n._grpM.get(4).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[Ue.NICK,Ue.AVATAR]})):(l=0,Promise.resolve([]))})).then((function(e){return Xe(e=e.data)&&0!==e.length?(e=e.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),n._updateLocalGroupMemberMap(o,e),d.length<a&&(l=0),u.setMessage("groupID:".concat(o," offset:").concat(s," count:").concat(a)).end(),Pe.l("".concat(r," ok.")),Sn({memberList:d,offset:l})):Dn({memberList:[],offset:l})})).catch((function(e){return u.setError(e).end(),Pe.e("".concat(r," failed. error:"),e),kn(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var n=this,o=e.groupID,i=e.offset,s=(e=e.filter,"".concat(this._n,".").concat("_getAVChatRoomMemberList")),a=new ao("_getAVChatRoomMemberList");return a.setMessage("groupID:".concat(o," offset:").concat(i," filter:").concat(e)),this._grpM.req({P:Kn.GET_AV_MBR_LIST,data:{groupID:o,offset:i,filter:e}}).then((function(e){var i=void 0===(i=(e=e.data).memberList)?[]:i;return e=void 0===(e=e.offset)?0:e,a.end(),Pe.l("".concat(s," ok. member count:").concat(i.length,", next request timestamp:").concat(e)),i=i.map((function(e){return t(t({},e),{},{onlineStatus:"Online"})})),Sn({memberList:i=n._updateLocalGroupMemberMap(o,i),offset:e})})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(s," failed. error:"),e),kn(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n=this,o="getGroupMemberProfile",i="".concat(this._n,".").concat(o),s="groupID:".concat(e.groupID),a=(5<e.userIDList.length?s+=" userIDList.length:".concat(e.userIDList.length):s+=" userIDList:".concat(e.userIDList),Pe.l("".concat(i," ").concat(s)),50<e.userIDList.length&&(e.userIDList=e.userIDList.slice(0,50)),e.groupID),r=e.userIDList;if((i=this._grpM.getLocalGroupProfile(a))&&Et(i.type))return kn({code:i=Hn.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(i,o)});var c=new ao(o);return c.setMessage(s),this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:r})).then((function(e){return Xe(e=e.data.members)&&0!==e.length?(n._updateLocalGroupMemberMap(a,e),n._grpM.get(4).getUserProfile({userIDList:e.map((function(e){return e.userID})),tagList:[Ue.NICK,Ue.AVATAR]})):Dn([])})).then((function(e){return e=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),n._updateLocalGroupMemberMap(a,e),e=r.filter((function(e){return n.hasLocalGroupMember(a,e)})).map((function(e){return n.getLocalGroupMemberInfo(a,e)})),c.end(),Sn({memberList:e})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),o=e.groupID,i=this._grpM.getLocalGroupProfile(o),s=i.type,a=new ao("addGroupMember");return a.setMessage("groupID:".concat(o," groupType:").concat(s)),Et(s)?(s=new Bn({code:Hn.CANNOT_ADD_MEMBER_IN_AV}),a.setError(s).end(),kn(s)):(e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Pe.l("".concat(n," groupID:").concat(o)),this._grpM.req({P:Kn.ADD_GRP_MBR,data:e}).then((function(o){o=o.data.members;var s=(Pe.l("".concat(n," ok")),o.filter((function(e){return 1===e.result})).map((function(e){return e.userID}))),r=o.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),c=o.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),u=(o=o.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),"groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(s,", ")+"failureUserIDList:".concat(r,", ")+"existedUserIDList:".concat(c,", ")+"overLimitUserIDList:".concat(o));return a.setMoreMessage(u).end(),0===s.length?Sn({successUserIDList:s,failureUserIDList:r,existedUserIDList:c,overLimitUserIDList:o}):(t._updateConvGroupProfile(i),Sn({successUserIDList:s,failureUserIDList:r,existedUserIDList:c,overLimitUserIDList:o,group:i}))})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)})))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),o=e.groupID,i=e.userIDList,s=this._grpM.getLocalGroupProfile(o);if(ht(s))return kn({code:Hn.CANNOT_FIND_GRP});if(Et(s.type))return this._grpM.canIUse(w.AV_BAN_MBR)?this._banAVChatRoomMember(e):this._grpM.noUse("deleteGroupMember");var a="groupID:".concat(o," ").concat(5<i.length?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),r=(Pe.l("".concat(n," groupID:").concat(o," userIDList:"),i),new ao("deleteGroupMember"));return r.setMessage(a),this._grpM.req({P:Kn.DEL_GRP_MBR,data:e}).then((function(){return r.end(),Pe.l("".concat(n," ok")),t._updateConvGroupProfile(s),t.deleteLocalGroupMembers(o,i),Sn({group:s,userIDList:i})})).catch((function(e){return r.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("_banAVChatRoomMember"),o=e.groupID,i=e.userIDList,s="groupID:".concat(o," ").concat(5<i.length?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),a=new ao("_banAVChatRoomMember"),r=(a.setMessage(s),Pe.l("".concat(n," groupID:").concat(o," userIDList:"),i),this._grpM.getLocalGroupProfile(o));return ht(e.duration)||0===e.duration?kn({code:Hn.BAN_DURATION_INVALID}):this._grpM.req({P:Kn.BAN_AV_MBR,data:e}).then((function(){return a.end(),Pe.l("".concat(n," ok")),t.deleteLocalGroupMembers(o,i),Sn({group:r,userIDList:i})})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,o=e.userID,i=(e=e.muteTime,"".concat(this._n,".").concat("setGroupMemberMuteTime"));if(o===this._grpM.getMyUserID())return kn({code:Hn.CANNOT_MUTE_SELF});var s="groupID:".concat(n," userID:").concat(o," muteTime:").concat(e),a=(Pe.l("".concat(i," ").concat(s)),new ao("setGroupMemberMuteTime"));return a.setMessage(s),this.modifyGroupMemberInfo({groupID:n,userID:o,muteTime:e}).then((function(e){return a.end(),Pe.l("".concat(i," ok")),Sn({group:t._grpM.getLocalGroupProfile(n),member:e})})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(i," failed. error:"),e),kn(e)}))}},{key:"setGroupMemberRole",value:function(e){var t="".concat(this._n,".").concat("setGroupMemberRole"),n=e.groupID,o=e.userID,i=(e=e.role,"groupID:".concat(n," userID:").concat(o," role:").concat(e)),s=this._grpM.getLocalGroupProfile(n);if(s&&s.selfInfo.role!==k.GRP_MBR_ROLE_OWNER)return kn({code:Hn.NOT_OWNER});var a=[k.GRP_MBR_ROLE_ADMIN,k.GRP_MBR_ROLE_MEMBER];if(St({groupID:n})&&a.push(k.GRP_MBR_ROLE_CUSTOM),a.indexOf(e)<0)return kn({code:Hn.INVALID_MEMBER_ROLE});if(o===this._grpM.getMyUserID())return kn({code:Hn.CANNOT_SET_SELF_MEMBER_ROLE});var r=new ao("setGroupMemberRole");return r.setMessage(i),Pe.l("".concat(t," ").concat(i)),this.modifyGroupMemberInfo({groupID:n,userID:o,role:e}).then((function(e){return r.end(),Pe.l("".concat(t," ok")),Sn({group:s,member:e})})).catch((function(e){return r.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"_filterProfanity",value:function(e,t){if(!(o=this._grpM.get(29)))return!0;var n=(o=o.filterText(t[e],"group_member_profile")).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="setGroupMemberNameCard",o="".concat(this._n,".").concat(n);if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return kn({code:Hn.PROFANITY_FOUND});var i=e.groupID,s=void 0===(r=e.userID)?this._grpM.getMyUserID():r,a=e.nameCard,r="groupID:".concat(i," userID:").concat(s," nameCard:").concat(a);if(Pe.l("".concat(o," ").concat(r)),(e=this._grpM.getLocalGroupProfile(i))&&Et(e.type))return kn({code:e=Hn.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(e,n)});var c=new ao(n);return c.setMessage(r),this.modifyGroupMemberInfo({groupID:i,userID:s,nameCard:a}).then((function(e){Pe.l("".concat(o," ok")),c.end();var n=t._grpM.getLocalGroupProfile(i);return s===t._grpM.getMyUserID()&&n&&n.setSelfNameCard(a),Sn({group:n,member:e})})).catch((function(e){return c.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="setGroupMemberCustomField",o="".concat(this._n,".").concat(n),i=e.groupID,s=void 0===(s=e.userID)?this._grpM.getMyUserID():s,a=(e=e.memberCustomField,"groupID:".concat(i," userID:").concat(s," memberCustomField:").concat(JSON.stringify(e))),r=(Pe.l("".concat(o," ").concat(a)),this._grpM.getLocalGroupProfile(i));if(r&&Et(r.type))return kn({code:r=Hn.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(r,n)});var c=new ao(n);return c.setMessage(a),this.modifyGroupMemberInfo({groupID:i,userID:s,memberCustomField:e}).then((function(e){return c.end(),Pe.l("".concat(o," ok")),Sn({group:t._grpM.getLocalGroupProfile(i),member:e})})).catch((function(e){return c.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,o=e.groupID,i=e.userID,s=void 0;return Dt(o)&&(o=qt(s=o)),this._grpM.req({P:Kn.MODIFY_GRP_MBR_INFO,data:t(t({},e),{},{groupID:o,topicID:s})}).then((function(){if(n.hasLocalGroupMember(o,i))return t=n.getLocalGroupMemberInfo(o,i),ht(e.muteTime)||t.updateMuteUntil(e.muteTime),ht(e.role)||t.updateRole(e.role),ht(e.nameCard)||t.updateNameCard(e.nameCard),ht(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t;var t=n._grpM.getLocalGroupProfile(o);return t&&!Et(t.type)?n.getGroupMemberProfile({groupID:o,userIDList:[i]}).then((function(e){return m(e.data.memberList,1)[0]})):void 0}))}},{key:"markGroupMemberList",value:function(e){var t="".concat(this._n,".").concat("markGroupMemberList"),n=e.groupID,o=e.markType,i=e.enableMark,s=void 0===(e=e.userIDList)?[]:e,a=(e="groupID:".concat(n," markType:").concat(o," enableMark:").concat(i," userIDList count:").concat(s.length),Pe.l("".concat(t," ").concat(e)),2),r=[],c=(!0===i&&(a=1),i=v(s),500<s.length&&(i=s.slice(0,500),Pe.w("".concat(t," ").concat(Yt(500)))),i.forEach((function(e){r.push({userID:e,markType:[o]})})),i=null,new ao("markGroupMemberList"));return c.setMessage(e),this._grpM.req({P:Kn.MARK_AV_MBR_INFO,data:{groupID:n,operationType:a,memberList:r}}).then((function(e){e=e.data.memberList;var n=[],o=[];return(e=void 0===e?[]:e).length===s.length?n.push.apply(n,v(s)):(e.forEach((function(e){n.push(e.userID)})),s.forEach((function(e){n.includes(e)||o.push(e)}))),e="success count:".concat(n.length," fail count:").concat(o.length),c.setMessage(e).end(),Pe.l("".concat(t," ok. ").concat(e)),Sn({successUserIDList:n,failureUserIDList:o})})).catch((function(e){return c.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this._grpM.req({P:Kn.GET_GRP_MBR_PROFILE,data:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return Xe(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new Si(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).set(t.userID,t):(t=(new Map).set(t.userID,t),this.groupMemberListMap.set(e,t))}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),Zi),ki=[17,18,20],Ri=(s(Xi,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,o=(e=e.isInstantMessage,(Pe.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length)),t=this._assembly({notifiesList:t,isInstantMessage:e})).eventDataList);t=t.result,0<o.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:e}),this._onReceivedGroupSystemNotice({result:t,isInstantMessage:e})),e?0<t.length&&this._grpM.emitOEvt(D.MESSAGE_RECEIVED,t):!0===n&&this._clearGroupSystemNotice()}},{key:"_assembly",value:function(e){var n=e.notifiesList,o=e.isInstantMessage,i=null,s=n.length,a=0,r=[],c={conversationID:k.CONV_SYSTEM,unreadCount:0,type:k.CONV_SYSTEM,subType:null,lastMessage:null};for(a=0;a<s;a++){var u=n[a],l=(d=u.groupProfile).communityType,d=void 0===(d=d.topicID)?void 0:d,p=void 0===(p=(h=u.elements).topicIDList)?void 0:p,h=h.operationType;if(!(2!==(void 0===l?0:l)||je(d)&&je(p))){if(ki.includes(h)){this._handleTopicSystemNotice(u);continue}je(d)||(u.to=d)}15!==u.elements.operationType&&(u.currentUser=this._grpM.getMyUserID(),u.conversationType=k.CONV_SYSTEM,u.conversationID=k.CONV_SYSTEM,(i=new Oo(u)).setElement({type:k.MSG_GRP_SYS_NOTICE,content:t(t({},u.elements),{},{groupProfile:t({},u.groupProfile)})}),i.isSystemMessage=!0,(1===i.sequence&&1===i.random||2===i.sequence&&2===i.random)&&(i.sequence=at(),i.random=at(),i.generateMessageID(),Pe.l("".concat(this._n,"._assembly regenerate ID:").concat(i.ID))),this._grpM.get(11).pushIntoNoticeResult(r,i)&&(o?c.unreadCount++:i.setIsRead(!0),c.subType=i.conversationSubType))}return c.lastMessage=r[r.length-1],{eventDataList:0<r.length?[c]:[],result:r}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)})),t=e._grpM.get(11).getLocalMessageList(k.CONV_SYSTEM);var n=[];t.forEach((function(t){var o=(s=t.payload).operatorID,i=s.operationType,s=s.groupProfile;1===i&&(i="".concat(o,"_").concat(s.groupID,"_").concat(s.to),(o=e.pendencyMap.get(i))&&We(o.handled)&&0!==o.handled&&n.push(t))})),e.deleteGroupSystemNotice({messageList:n})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return Xe(e.messageList)&&0!==e.messageList.length?(Pe.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._grpM.req({P:Kn.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:e.messageList.map((function(e){return{from:k.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Pe.l("".concat(n," ok"));var o=t._grpM.get(11);return e.messageList.forEach((function(e){o.deleteLocalMessage(e)})),Sn()})).catch((function(e){return Pe.e("".concat(n," error:"),e),kn(e)}))):Dn()}},{key:"_getPendencyList",value:function(){var e=this,t=(o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,n=o.startTime,o=o.limit;return this._grpM.req({P:Kn.GET_GRP_PENDENCY,data:{type:void 0===t?void 0:t,startTime:void 0===n?0:n,limit:void 0===o?20:o,handleAccount:this._grpM.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(v(n),v(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:k.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,v(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID,note:e.note})})),Dn({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:t._onApplyJoinGroup(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._grpM.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyJoinGroup",value:function(e){var t=this,n=(e=e.payload.groupProfile).groupID,o=(e=e.groupType,this._grpM.hasLocalGroup(n));Pe.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(n," groupType:").concat(e," hasGroup:").concat(o)),o||Et(e)||this._grpM.getGroupProfile({groupID:n}).then((function(e){(e=e.data.group)&&(t._grpM.updateGroupMap([e]),e=!e.isSupportTopic,t._grpM.emitGroupListUpdate(!0,e))}))}},{key:"_onMemberKicked",value:function(e){e=e.payload.groupProfile.groupID,this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e)}},{key:"_onGroupDismissed",value:function(e){e=e.payload.groupProfile.groupID;var t=(this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e),this._grpM._AVChatRoomHandler);t&&t.checkJoinedAVChatRoomByID(e)&&t.reset(e)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;e=this._grpM.hasLocalGroup(n),Pe.l("".concat(this._n,"._onInviteGroup groupID:").concat(n," hasGroup:").concat(e)),this._grpM.getGroupProfile({groupID:n}).then((function(){t._grpM.emitGroupListUpdate(),t._grpM.get(11).pullMsgOnInvite("".concat(k.CONV_GROUP).concat(n))}))}},{key:"_onQuitGroup",value:function(e){var t=(e=e.payload.groupProfile).groupID,n=(e=e.groupType,this._grpM.hasLocalGroup(t));Pe.l("".concat(this._n,"._onQuitGroup groupID:").concat(t," groupType:").concat(e," hasGroup:").concat(n)),n&&this._grpM.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,t))&&e.updateRole(k.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,t))&&e.updateRole(k.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID;e=e.payload.messageRemindType,this._grpM.get(11).onGroupMsgRemindTypeUpdated({groupID:t,messageRemindType:e})}},{key:"_handleTopicSystemNotice",value:function(e){var t=(n=e.groupProfile).groupID,n=n.topicID,o=(e=e.elements).operationType,i=e.topicIDList,s=(e=e.messageRemindType,this._grpM.get(10));17===o?s.onTopicCreated({groupID:t,topicID:n}):18===o?s.onTopicDeleted({groupID:t,topicIDList:i}):20===o&&s.onMessageRemindTypeUpdated({groupID:t,topicID:n,messageRemindType:e})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),Xi),Li=["relayFlag"],Ai=(r($i,wn),si=f($i),s($i,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),o=this.getCloudConfig("polling_simplified_msg"),i=this.getCloudConfig("paging_grp_count");Pe.l("".concat(this._n,"._onCloudConfig pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(o," pagingGroupCount:").concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(o),this._commonGroupHandler.setPagingGroupCount(i)}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t,n=this;return e.conversationType===k.CONV_GROUP?(t=Dt(e.to)?qt(e.to):e.to,this.hasLocalGroup(t)?Dn():this.getGroupProfile({groupID:t}).then((function(o){return o=o.data.group.type,Pe.l("".concat(n._n,".guardForAVChatRoom. groupID:").concat(t," type:").concat(o)),o===k.GRP_AVCHATROOM?kn(new Bn({code:o=Hn.MSG_SEND_FAIL_NOT_IN_AV,message:n.getErrMsg(o,e.from,t),data:{message:e}})):Dn()}))):Dn()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewMessage",value:function(e){this._commonGroupHandler.onNewMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t,n=this;Xe(e)&&(t=this.get(10),e.forEach((function(e){var o=e.conversationID.replace(k.CONV_GROUP,"");Dt(o)&&t.updateUnreadCountAndLastMsg(o,e.lastMessage),n.groupMap.has(o)&&(n.groupMap.get(o).nextMessageSeq=e.lastMessage.sequence+1)})))}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler.onNewGroupTips(e)}},{key:"onMsgRevoked",value:function(e){this._commonGroupHandler.onMsgRevoked(e,!(1<arguments.length&&void 0!==arguments[1])||arguments[1])}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onMsgReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n;e=e.elements.groupMessageReadNotice,ht(e)||(n=t.get(11),e.forEach((function(e){var o=e.groupID,i=void 0===(i=e.topicID)?void 0:i,s=(e=e.lastMessageSeq,Pe.l("".concat(t._n,".onMsgReadNotice groupID:").concat(o," lastMessageSeq:").concat(e)),o="".concat(k.CONV_GROUP).concat(o),!0);je(i)||(o="".concat(k.CONV_GROUP).concat(i),s=!1),n.updateIsReadAfterReadReport({conversationID:o,lastMessageSeq:e}),n.updateUnreadCount(o,s),n.clearGroupAtInfoList(o,s)})))}))}},{key:"onReadReceiptList",value:function(e){var t=this;Pe.l("".concat(this._n,".onReadReceiptList options:"),e),e.dataList.forEach((function(e){var n=e.groupProfile,o=(e=e.elements,n=n.groupID,t.get(11));e=e.readReceiptList,o.updateReadReceiptInfo({groupID:n,readReceiptList:e})}))}},{key:"onMsgModified",value:function(e){Pe.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:k.CONV_GROUP,to:e.topicID||e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new pi(e))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,o=this.get(11);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new pi(e)),o.deleteGroupRoamingInfo(t))}));var i,s=this.getMyUserID(),a=S(this.groupMap);try{for(a.s();!(i=a.n()).done;){var r=m(i.value,2)[1];r.selfInfo.userID=s,"Owner"===r.selfInfo.role&&(r.ownerID=s)}}catch(c){a.e(c)}finally{a.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return v(this.groupMap.values()).filter((function(e){return e.type!==k.GRP_ROOM&&e.type!==k.GRP_LIVE}))}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=v(this.groupMap).filter((function(e){return(e=m(e,2))[0],!je(e[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(v(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler.updateLastMsg(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();e&&this.emitOEvt(D.GROUP_LIST_UPDATED),t&&(e=JSON.parse(JSON.stringify(n)),this.get(11).updateConvGroupProfile(e))}},{key:"getMyNameCardByGroupID",value:function(e){return(e=this.getLocalGroupProfile(e))?e.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMsgRemindType",value:function(e){var t=this;return Xe(e)&&0!==e.length?0===(e=e.filter((function(e){return!Et(t.getLocalGroupProfile(e).type)}))).length?Promise.resolve():(Pe.l("".concat(this._n,".getMsgRemindType groupIDList:").concat(e)),this.getGroupProfileAdvance({groupIDList:e,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then((function(e){e=e.data.successGroupList;var n=t.get(11);e.forEach((function(e){n.onGroupMsgRemindTypeUpdated({groupID:e.groupID,messageRemindType:Xe(e.members)?e.members[0].messageRemindType:""})}))}))):Promise.resolve()}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),o=new ao("getGroupProfile"),i=e.groupID,s=e.groupCustomFieldFilter;return Pe.l("".concat(n," groupID:").concat(i)),s={groupIDList:[i],responseFilter:{groupBaseInfoFilter:v(x),groupCustomFieldFilter:s,memberInfoFilter:[].concat(v(V),["NameCard"])}},this.getGroupProfileAdvance(s).then((function(e){var s=(e=e.data).successGroupList;return e=e.failureGroupList,Pe.l("".concat(n," ok")),0<e.length?kn(e[0]):((e=Et(s[0].type)&&!t.hasLocalGroup(i)?new pi(s[0]):(t.updateGroupMap(s),t.getLocalGroupProfile(i))).isSupportTopic||t.get(11).updateConvGroupProfile([e]),o.setMessage("groupID:".concat(i," type:").concat(e.type," muteAllMembers:").concat(e.muteAllMembers," ownerID:").concat(e.ownerID)).end(),Sn({group:e}))})).catch((function(t){return o.setError(t).setMessage("groupID:".concat(e.groupID)).end(),Pe.e("".concat(n," failed. error:"),t),kn(t)}))}},{key:"getGroupProfileAdvance",value:function(e){var n,o="".concat(this._n,".getGroupProfileAdvance"),i=(Xe(a=e.groupIDList)&&50<a.length&&(this.warn("GetGroupProfileLimit"),a.length=50),[]),s=[],a=(a.forEach((function(e){(St({groupID:e})?s:i).push(e)})),[]);return 0<i.length&&(n=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:i})),a.push(n)),0<s.length&&(n=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:s,relayFlag:0<i.length})),a.push(n)),Promise.all(a).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,v(e.successGroupList)),n.push.apply(n,v(e.failureGroupList))})),Sn({successGroupList:t,failureGroupList:n})})).catch((function(e){return Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,o=void 0!==n&&n,i=h(e,Li);return this.req({P:Kn.GET_GRP_PROFILE,data:i}).then((function(e){return Pe.l("".concat(t._n,"._getGroupProfileAdvance ok. options:"),i),{successGroupList:(e=e.data.groups).filter((function(e){return ht(e.errorCode)||0===e.errorCode})),failureGroupList:e.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new Bn({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return o&&St({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:kn(t)}))}},{key:"createGroup",value:function(e){var n=this,o=[k.GRP_PUBLIC,k.GRP_WORK,k.GRP_MEETING,k.GRP_AVCHATROOM,k.GRP_COMMUNITY],i="".concat(this._n,".").concat("createGroup"),s=e.type,a=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return kn({code:Hn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return kn({code:Hn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return kn({code:Hn.PROFANITY_FOUND});if(!o.includes(s))return kn({code:Hn.ILLEGAL_GRP_TYPE});if(!St({type:s})){if(!je(a)&&St({groupID:a}))return kn({code:Hn.ILLEGAL_GRP_ID});e.isSupportTopic=void 0}if(Et(s)&&!ht(e.memberList)&&0<e.memberList.length&&(e.memberList=void 0),this._canIUseJoinOption(s)||ht(e.joinOption)||(e.joinOption=void 0),St({type:s})){if(!je(a)&&!St({groupID:a}))return kn({code:Hn.ILLEGAL_GRP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var r=new ao("createGroup"),c=(Pe.l("".concat(i," options:"),e),null),u=[];return this.req({P:Kn.CREATE_GRP,data:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(o){var s=(o=o.data).groupID,a=void 0===(o=o.overLimitUserIDList)?[]:o;if(c=s,u=a,o="groupType:".concat(e.type," groupID:").concat(s," overLimitUserIDList:").concat(a),r.setMessage(o).end(),Pe.l("".concat(i," ok. ").concat(o)),e.type===k.GRP_AVCHATROOM)return n.getGroupProfile({groupID:s});if(e.type===k.GRP_COMMUNITY&&1===e.isSupportTopic)return n.getGroupProfile({groupID:s});je(e.memberList)||je(a)||(e.memberList=e.memberList.filter((function(e){return-1===a.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:s})]),o=n.get(2);var l="",d=0,p=(e.type===k.GRP_COMMUNITY?(l=n.isIntl()?"Create Community":"创建社群",d=1):l=n.isIntl()?"Create Group":"创建群组",n.get(4).getMyNick());return l=o.createCustomMessage({to:s,conversationType:k.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:l,cmd:d,opUser:p||n.getMyUserID(),version:4})}}),o.sendMessageInstance(l),n.emitGroupListUpdate(),n.getGroupProfile({groupID:s})})).then((function(e){var t=(n=(e=e.data.group).selfInfo).nameCard,n=n.joinTime;return e.updateSelfInfo({nameCard:t,joinTime:n,messageRemindType:k.MSG_REMIND_ACPT_AND_NOTE,role:k.GRP_MBR_ROLE_OWNER}),Sn({group:e,overLimitUserIDList:u})})).catch((function(o){var s;return r.setMessage("groupType:".concat(e.type)).setError(o).end(),10010===o.code||10007===o.code?(n._silentlyGetGroupProfile(o.code,c),n.updateGroupMap([t(t({},e),{},{groupID:c})]),(s=n.getLocalGroupProfile(c)).selfInfo.role=k.GRP_MBR_ROLE_OWNER,Sn({group:s,overLimitUserIDList:u})):(Pe.e("".concat(i," failed. error:"),o),kn(o))}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup"),o="groupID:".concat(e),i=new ao("dismissGroup");return i.setMessage(o),Pe.l("".concat(n," ").concat(o)),this.req({P:Kn.DISMISS_GRP,data:{groupID:e}}).then((function(){return i.end(),Pe.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),Sn({groupID:e})})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"updateGroupProfile",value:function(e){var t,n=this,o="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)&&(t=this.getLocalGroupProfile(e.groupID).type,this._canIUseJoinOption(t)||ht(e.joinOption)||(Pe.w("".concat(o," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)),ht(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return kn({code:Hn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return kn({code:Hn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return kn({code:Hn.PROFANITY_FOUND});var i=new ao("updateGroupProfile");return i.setMessage(JSON.stringify(e)),Pe.l("".concat(o," groupID:").concat(e.groupID)),this.req({P:Kn.UPDATE_GRP_PROFILE,data:e}).then((function(){return i.end(),Pe.l("".concat(o," ok")),n.hasLocalGroup(e.groupID)&&n.groupMap.get(e.groupID).updateGroup(e),Sn({group:n.groupMap.get(e.groupID)})})).catch((function(e){return i.setError(e).end(),Pe.l("".concat(o," failed. error:"),e),kn(e)}))}},{key:"_filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],F)).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".joinGroup");if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return Dn({status:k.JOIN_STATUS_ALREADY_IN_GROUP});var i=new ao("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return i.setMessage("groupID:".concat(n," joinedStatus:").concat(k.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Dn({status:k.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(s){return i.setMessage("groupID:".concat(n," unjoined")).end(),Pe.w("".concat(o," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return Pe.l("".concat(o," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,o="".concat(this._n,".").concat("applyJoinGroup"),i=e.groupID;if(!je(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return kn({code:Hn.PROFANITY_FOUND});var s=new ao("applyJoinGroup"),a=(e=t({},e),this.canIUse(w.AV_HISTORY_MSG));return a&&(e.historyMessageFlag=1),this.get(11).deleteTopicRoamingInfo(i),this.req({P:Kn.APPLY_JOIN_GRP,data:e}).then((function(e){var t=(e=e.data).joinedStatus,r=e.longPollingKey,c=e.startSeq,u=e.avChatRoomFlag,l=e.avChatRoomKey,d=e.messageList;switch(e="groupID:".concat(i," joinedStatus:").concat(t," longPollingKey:").concat(r," startSeq:").concat(c)+" avChatRoomFlag:".concat(u," canGetAVChatRoomHistoryMsg:").concat(a,",")+" historyMsgCount:".concat(je(d)?0:d.length),s.setMessage(e).end(),Pe.l("".concat(o," ok. ").concat(e)),t){case qe:return Sn({status:qe});case Ve:return n.getGroupProfile({groupID:i}).then((function(e){return e=e.data.group,n._handleJoinResult({group:e,avChatRoomFlag:u,longPollingKey:r,startSeq:c,avChatRoomKey:l,messageList:d})})).catch((function(e){var t;return 10010===e.code||10007===e.code?(n._silentlyGetGroupProfile(e.code,i),t=new pi({groupID:i}),n.updateGroupMap([t]),n._handleJoinResult({group:t,avChatRoomFlag:u,longPollingKey:r,startSeq:c,avChatRoomKey:l,messageList:d})):(Pe.e("".concat(o," failed. error:"),e),kn(e))}));default:var p=new Bn({code:Hn.JOIN_GRP_FAIL});return Pe.e("".concat(o," failed. error:"),p),kn(p)}})).catch((function(e){return s.setMessage("groupID:".concat(i)).setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"_handleJoinResult",value:function(e){var t=this,n=e.group,o=e.avChatRoomFlag,i=e.longPollingKey,s=e.startSeq,a=e.avChatRoomKey,r=e.messageList,c=n.groupID;return 1===o?(this.get(11).setCompleted("".concat(k.CONV_GROUP).concat(c)),this._groupAttributesHandler.initGroupAttributesCache({groupID:c,avChatRoomKey:a}),this._groupCountersHandler.initGroupCountersCache({groupID:c,avChatRoomKey:a}),(e=ht(i)?this._AVChatRoomHandler.handleJoinResult({group:n}):this._AVChatRoomHandler.startRunLoop({group:n,longPollingKey:i,startSeq:s})).then((function(){t._onAVChatRoomHistoryMessage(r,c)})),e):(this.emitGroupListUpdate(!0,!1),Sn({status:Ve,group:n}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup"),o="groupID:".concat(e),i=(Pe.l("".concat(n," ").concat(o)),this.checkJoinedAVChatRoomByID(e));if(!i&&!this.hasLocalGroup(e))return kn({code:Hn.MEMBER_NOT_IN_GRP});if(i&&!this.isLoggedIn())return Pe.l("".concat(n," anonymously ok. ").concat(o)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Dn({groupID:e});var s=new ao("quitGroup");return s.setMessage(o),this.req({P:Kn.QUIT_GRP,data:{groupID:e}}).then((function(){return s.end(),Pe.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),Sn({groupID:e})})).catch((function(e){return s.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"searchGroupByID",value:function(e){var t="".concat(this._n,".").concat("searchGroupByID"),n={groupIDList:[e]},o=new ao("searchGroupByID");return o.setMessage("groupID:".concat(e)),Pe.l("".concat(t," groupID:").concat(e)),this.req({P:Kn.SEARCH_GRP,data:n}).then((function(e){if(0!==(e=e.data.groupProfile)[0].errorCode)throw new Bn({code:e[0].errorCode,message:e[0].errorInfo});return o.end(),Pe.l("".concat(t," ok")),Sn({group:new pi(e[0])})})).catch((function(e){return o.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===k.GRP_AVCHATROOM)return kn({code:Hn.CANNOT_CHANGE_OWNER_IN_AV});if(e.newOwnerID===this.getMyUserID())return kn({code:Hn.CANNOT_CHANGE_OWNER_TO_SELF});var o=new ao("changeGroupOwner");return o.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Pe.l("".concat(n," groupID:").concat(e.groupID)),this.req({P:Kn.CHANGE_GRP_OWNER,data:e}).then((function(){o.end(),Pe.l("".concat(n," ok"));var i,s=e.groupID,a=e.newOwnerID,r=(t.groupMap.get(s).ownerID=a,t._groupMemberHandler.getLocalGroupMemberList(s));return r instanceof Map&&(i=r.get(t.getMyUserID()),ht(i)||(i.updateRole("Member"),t.groupMap.get(s).selfInfo.role="Member"),i=r.get(a),ht(i)||i.updateRole("Owner")),t.emitGroupListUpdate(!0,!1),Sn({group:t.groupMap.get(s)})})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,o,i,s,a=this,r="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application,p=(l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,o=l.payload.authentication,i=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,o=d.authentication,i=d.messageKey),Kn.HANDLE_GRP_APPLICATION),h=(d&&2===d.applicationType&&(p=Kn.HANDLE_INVITE_JOIN_GRP,s=d.userID),new ao("handleGroupApplication"));return h.setMessage("groupID:".concat(n)),Pe.l("".concat(r," groupID:").concat(n)),this.req({P:p,data:{handleAction:c,handleMessage:u,applicant:t,invitee:s,groupID:n,authentication:o,messageKey:i}}).then((function(){return h.end(),Pe.l("".concat(r," ok")),l&&a._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),Sn({group:a.getLocalGroupProfile(n)})})).catch((function(e){return h.setError(e).end(),Pe.e("".concat(r," failed. error"),e),kn(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,o="".concat(this._n,".").concat("handleGroupInvitation"),i=(r=e.message.payload).groupProfile.groupID,s=r.authentication,a=r.messageKey,r=r.operatorID,c=e.handleAction,u=new ao("handleGroupInvitation");return u.setMessage("groupID:".concat(i," inviter:").concat(r," handleAction:").concat(c)),Pe.l("".concat(o," groupID:").concat(i," inviter:").concat(r," handleAction:").concat(c)),this.req({P:Kn.HANDLE_GRP_INVITATION,data:t(t({},e),{},{inviter:r,groupID:i,authentication:s,messageKey:a})}).then((function(){return u.end(),Pe.l("".concat(o," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),Sn({group:n.getLocalGroupProfile(i)})})).catch((function(e){return u.setError(e).end(),Pe.e("".concat(o," failed. error"),e),kn(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".getGroupOnlineMemberCount"),o=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e),i=this.hasLocalGroup(e);if(Pe.l("".concat(n," groupID:").concat(e," isAVChatRoom:").concat(o," has:").concat(i)),o)return this._AVChatRoomHandler.getGroupOnlineMemberCount(e);if(!i)return Dn({memberCount:0});if(o=Date.now(),this._onlineMemberCountMap.has(e)){if(o-(i=this._onlineMemberCountMap.get(e)).lastReqTime<=6e4)return Dn({memberCount:i.memberCount});i.lastReqTime=o}return this.requestOnlineCount(e).then((function(o){return o=void 0===(o=o.data.memberCount)?0:o,t._onlineMemberCountMap.set(e,{lastReqTime:Date.now(),memberCount:o}),Pe.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(o)),Dn({memberCount:o})})).catch((function(e){return Pe.w("".concat(n," failed. error:"),e),Promise.reject(e)}))}},{key:"requestOnlineCount",value:function(e){return this.req({P:Kn.GET_ONLINE_MBR_NUM,data:{groupID:e}})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t,n=this.checkJoinedAVChatRoomByID(e),o=(Pe.l("".concat(this._n,".deleteLocalGroupAndConversation groupID:").concat(e," isJoinedAVChatRoom:").concat(n)),this.get(11)),i="".concat(k.CONV_GROUP).concat(e);n&&(this.stopMessageLongPolling({groupID:e}),o.deleteLocalConv(i)),St({groupID:e})&&(t=this.getLocalGroupProfile(e))&&!0===t.isSupportTopic&&this.get(10).deleteTopicListInCommunity(e),o.clearUnreadCount(i),o.setCompleted(i),this._deleteLocalGroup(e),this._onlineMemberCountMap.delete(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this._groupMemberHandler.deleteGroupMemberList(e)}},{key:"sendMessage",value:function(e,t){return Xe(e._receiverList)&&0<e._receiverList.length&&!this.canIUse(w.MSG_TO_SPECIFIED_GRP_MBR)?this.noUse("Targeted Group Message"):(e=this.createGroupMessagePack(e,t),this.req(e))}},{key:"createGroupMessagePack",value:function(e,t){var n=null,o=(t&&t.offlinePushInfo&&(n=t.offlinePushInfo),""),i=(pt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),s=void($e(t)&&$e(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck"))),a=(Xe(e._receiverList)&&0<e._receiverList.length&&(s=e._receiverList,50<e._receiverList.length&&(s=e._receiverList.slice(0,50),this.warn("ReceiverListLimit"))),this.isOnlineMessage(e,t)?1:0),r=JSON.parse(JSON.stringify(e.getElements())),c=this.get(17).getFileDNList(),u=e.getGroupAtInfoList();return r={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:go(e.type,r,c),cloudCustomData:o,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==k.MSG_TEXT||je(u)?void 0:u,onlineOnlyFlag:a,clientTime:e.clientTime,offlinePushInfo:Ko(n),messageControlInfo:0==a?i:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:s,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0,cmConfigID:e._cmConfigID,forbidCallbackControl:Ct(t)},Dt(e.to)&&(r.groupID=qt(e.to),r.topicID=e.to),{P:Kn.SEND_GRP_MSG,data:r}}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Dt(e.to)&&(t.groupID=qt(e.to),t.topicID=e.to),this.req({P:Kn.REVOKE_GRP_MSG,data:t})}},{key:"deleteMessage",value:function(e){var t=e.to;return e=e.keyList,Pe.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(e.length)),e={groupID:t,deleter:this.getMyUserID(),keyList:e},Dt(t)&&(e.groupID=qt(t),e.topicID=t),this.req({P:Kn.DEL_GRP_MSG,data:e})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,o=e.payload,i=e.type,s=void 0===(s=e.version)?0:s,a=e.cloudCustomData,r=(e=e._elements,t),c=void 0;return t=void(Dt(t)&&(r=qt(t),c=t)),Ht(i)&&(1<e.length&&e.splice(0,1,{type:i,content:o}),t=e),this.req({P:Kn.MODIFY_GRP_MSG,data:{groupID:r,topicID:c,sequence:n,version:s,elements:t,cloudCustomData:a}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessage"),o=e.conversationID,i=e.groupID,s=(e=e.sequence,new ao("getRoamingMessage")),a=0,r=void 0;return Dt(i)&&(i=qt(r=i)),this._computeLastSequence({groupID:i,topicID:r,sequence:e}).then((function(e){return a=e,Pe.l("".concat(n," groupID:").concat(i," startSequence:").concat(a)),t.req({P:Kn.GET_GRP_ROAMING_MSG,data:{groupID:i,count:21,sequence:a,topicID:r}})})).then((function(e){var c=(l=e.data).messageList,u=l.complete,l=void 0===(l=l.invisibleSequenceList)?[]:l,d=(e=void 0===(e=e.data.nextSequence)?0:e,ht(c)?Pe.l("".concat(n," ok. complete:").concat(u," nextSequence:").concat(e," but messageList is undefined!")):Pe.l("".concat(n," ok. complete:").concat(u," nextSequence:").concat(e," count:").concat(c.length)),s.setMessage("groupID:".concat(i," topicID:").concat(r," startSequence:").concat(a," complete:").concat(u," nextSequence:").concat(e)).end(),t.get(11)),p=[],h=[];return je(c)||(p=d.onRoamingMessage(c,o,!0,h),d.updateIsRead(o),d.patchConvLastMessage(o)),(c=2===u||e<1)&&(d.setCompleted(o),e=""),Pe.l("".concat(n," isPullingCompleted:").concat(c," nextReqID:").concat(e," storedMsgCount:").concat(p.length)+" invisibleSeqCount:".concat(l.length)),{nextReqID:e+"",storedMessageList:p,assembledMessageList:h,isPullingCompleted:c}})).catch((function(e){return s.setError(e).setMessage("groupID:".concat(i," topicID:").concat(r," startSequence:").concat(a)).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(k.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".").concat("getReadReceiptList"),n=this._getGroupIDOfMessage(e[0]),o=this.getMyUserID(),i=e.filter((function(e){return e.from===o&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(Pe.l("".concat(t," groupID:").concat(n," sequenceList:").concat(JSON.stringify(i))),0===i.length)return Dn({messageList:e});var s=new ao("getReadReceiptList");return s.setMessage("groupID:".concat(n)),this.req({P:Kn.GET_READ_RECEIPT,data:{groupID:n,sequenceList:i}}).then((function(n){return s.end(),Pe.l("".concat(t," ok")),Xe(n=n.data.readReceiptList)&&n.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),Sn({messageList:e})})).catch((function(e){return s.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"sendReadReceipt",value:function(e){var t="".concat(this._n,".").concat("sendReadReceipt"),n=this._getGroupIDOfMessage(e[0]),o=new ao("sendReadReceipt"),i=(o.setMessage("groupID:".concat(n)),this.getMyUserID());return 0===(e=e.filter((function(e){return e.from!==i&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}))).length?kn({code:Hn.READ_RECEIPT_MSG_LIST_EMPTY}):(Pe.l("".concat(t,". sequenceList:").concat(JSON.stringify(e))),this.req({P:Kn.SEND_READ_RECEIPT,data:{groupID:n,sequenceList:e}}).then((function(e){return o.end(),Pe.l("".concat(t," ok")),Sn()})).catch((function(e){return o.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,o=e.filter,i=e.cursor,s=(e=e.count,this._getGroupIDOfMessage(n)),a=n.ID,r=(n=n.sequence,"".concat(this._n,".").concat("getReadReceiptDetail")),c=this._receiptDetailCompleteMap.get(a)||!1,u=0!==o&&1!==o?0:o,l=(o=pt(i)?i:"",i=!We(e)||e<=0||100<=e?100:e,e="groupID:".concat(s," sequence:").concat(n," cursor:").concat(o," filter:").concat(u," completeFlag:").concat(c),Pe.l("".concat(r," ").concat(e)),{cursor:"",isCompleted:!1,messageID:a,unreadUserIDList:[],readUserIDList:[]}),d=new ao("getReadReceiptDetail");return d.setMessage(e),this.req({P:Kn.GET_READ_RECEIPT_DETAIL,data:{groupID:s,sequence:n,flag:u,cursor:o,count:i}}).then((function(e){d.end();var n=(e=e.data).cursor,o=e.isCompleted,i=e.unreadUserIDList;return e=e.readUserIDList,l.cursor=n,1===o&&(l.isCompleted=!0,t._receiptDetailCompleteMap.set(a,!0)),0===u?l.readUserIDList=e.map((function(e){return e.userID})):1===u&&(l.unreadUserIDList=i.map((function(e){return e.userID}))),Pe.l("".concat(r," ok")),Sn(l)})).catch((function(e){return d.setError(e).end(),Pe.w("".concat(r," failed. error:"),e),kn(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessagesHopping"),o=e.groupID,i=e.count,s=e.sequence,a=e.direction,r=void 0;return ht(s)&&1===a?Dn({messageList:[],isCompleted:!0,nextMessageSeq:""}):(Dt(o)&&(o=qt(r=o)),this._computeReqSeqHopping({groupID:o,topicID:r,sequence:s}).then((function(c){ht(s)||1!==a||(c=s+i-1);var u="".concat(r?"topicID:".concat(r):"groupID:".concat(o)," sequence:").concat(s," reqSeq:").concat(c," direction:").concat(a),l=(Pe.l("".concat(n," ").concat(u)),new ao("getRoamingMessagesHopping"));return t.req({P:Kn.GET_GRP_ROAMING_MSG,data:{groupID:o,topicID:r,count:i,sequence:c}}).then((function(o){var i=void 0===(i=(o=o.data).messageList)?[]:i,r=o.complete,c=void 0===(c=o.nextSequence)?0:c,d=(o=void 0===(o=o.invisibleSequenceList)?[]:o,"complete:".concat(r," nextSequence:").concat(c," remoteMsgCount:").concat(i.length," invisibleSequenceList:").concat(o)),p=(l.setMessage("".concat(u," ").concat(d)).end(),Pe.l("".concat(n," ok. ").concat(d)),d="".concat(k.CONV_GROUP).concat(e.groupID),t.get(11));return d=p.onRoamingMessage(i,d,!1),i=t._computeResult({groupID:e.groupID,direction:a,sequence:s,remoteMessageList:i,processedMessageList:d,complete:r,nextSequence:c,invisibleSequenceList:o}),p.storeHoppingMessageList(i.messageList),Sn(i)})).catch((function(e){return l.setError(e).setMessage("groupID:".concat(o," sequence:").concat(s," count:").concat(i)).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))})))}},{key:"_computeReqSeqHopping",value:function(e){var t=this,n=e.groupID,o=void 0===(o=e.topicID)?void 0:o;return 0<(e=void 0===(e=e.sequence)?void 0:e)?Promise.resolve(e):ht(o)?this.getGroupProfileAdvance({groupIDList:[n],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then((function(e){var o=0;return je(e=e.data.successGroupList)||(o=e[0].nextMessageSeq-1),Pe.l("".concat(t._n,"._computeReqSeqHopping groupID:").concat(n," lastSequence:").concat(o," from remote")),o})).catch((function(e){return kn(e)})):Promise.resolve(0)}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""},n=e.groupID,o=e.direction,i=e.sequence,s=void 0===(s=e.remoteMessageList)?[]:s,a=void 0===(a=e.processedMessageList)?[]:a,r=e.complete,c=e.nextSequence;if(e=e.invisibleSequenceList,0===o)return t.nextMessageSeq=c,(2===r||c<1)&&(t.isCompleted=!0,t.nextMessageSeq=""),t.messageList=a,t;if(1===o){if(je(s)){if(je(e))return t.isCompleted=!0,t.nextMessageSeq="",t;t.nextMessageSeq=e[0]+1}else r=s[0].sequence,c=e[0]||0,t.nextMessageSeq=c<r?r+1:c+1;return a.forEach((function(e){e.sequence>=i&&t.messageList.push(e)})),(St({groupID:n})||Dt(n))&&0===t.messageList.length&&s[0].sequence<i&&(t.isCompleted=!0,t.nextMessageSeq=""),t}}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageSeq,i="".concat(this._n,".").concat("setMessageRead"),s=(e="convID:".concat(n," lastMessageSeq:").concat(o),Pe.l("".concat(i," ").concat(e)),We(o)||this.warn("DoNotModifyLastSeq"),new ao("setMessageRead")),a=(s.setMessage(e),n.replace(k.CONV_GROUP,"")),r=void 0;return Dt(a)&&(a=qt(r=a)),this.req({P:Kn.SET_GRP_MSG_READ,data:{groupID:a,topicID:r,messageReadSeq:o}}).then((function(){s.end(),Pe.l("".concat(i," ok"));var e,c=t.get(11),u=(c.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:o}),!0);return ht(r)||(u=!1,(e=t.get(10).getLocalTopic(a,r))&&e.updateSelfInfo({readedSequence:o})),c.updateUnreadCount(n,u),Sn()})).catch((function(e){return s.setError(e).end(),Pe.l("".concat(i," failed. error:"),e),kn(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=void 0===(n=e.topicID)?void 0:n;return 0<(e=e.sequence)?Promise.resolve(e):ht(n)?this.getGroupLastSequence(t):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t="".concat(this._n,".").concat("getGroupLastSequence"),n=new ao("getGroupLastSequence"),o=0,i="",s="groupID:".concat(e);if(this.hasLocalGroup(e)){var a=this.getLocalGroupProfile(e),r=a.lastMessage;if(0<r.lastSequence&&!1===r.onlineOnlyFlag)return o=r.lastSequence,i="".concat(s,", ").concat(o," from group.lastMessage.lastSequence"),Pe.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o);if(1<a.nextMessageSeq)return o=a.nextMessageSeq-1,i="".concat(s,", ").concat(o," from group.nextMessageSeq"),Pe.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o)}return(r=this.get(11).getLocalConversation("GROUP".concat(e)))&&r.lastMessage.lastSequence&&!1===r.lastMessage.onlineOnlyFlag?(o=r.lastMessage.lastSequence,i="".concat(s,", ").concat(o," from conversation.lastMessage.lastSequence"),Pe.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o)):this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then((function(e){return je(e=e.data.successGroupList)?Pe.w("".concat(t," ").concat(s,", empty successGroupList")):(o=e[0].nextMessageSeq-1,i="".concat(s,", ").concat(o," from remote"),Pe.l("".concat(t," ").concat(i))),n.setMessage(i).end(),o})).catch((function(e){return n.setError(e).setMessage(s).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"getGroupRemoteLastSeq",value:function(e){return(e=this.getLocalGroupProfile(e))?e.nextMessageSeq-1:1}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==k.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e,n){var o;je(e)||(Pe.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(n," count:").concat(e.length)),o=[],e.forEach((function(e){o.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(o,n))}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler.onMessage(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!je(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&je(t)}},{key:"getMessageExtensions",value:function(e,t){return Pe.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({P:Kn.GET_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Pe.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),this.req({P:Kn.MODIFY_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"_genNotifyReqList",value:function(e){for(var t,n,o,i,s=[],a=0,r=e.length;a<r;a++)t=e[a],i=this.getLocalGroupProfile(t).type,n=this._getGroupLastRevokedTime(t),o=1e3*Le(),i={notifyType:1,limit:20,type:St({type:i,groupID:t})?k.GRP_COMMUNITY:void 0,groupID:t,beginTime:n,endTime:o},s.push(i);return s}},{key:"getNotice",value:function(e){var t=this,n="".concat(this._n,".getNotice");0!==(e=e.filter((function(e){if(!t.hasLocalGroup(e))return!1;var n=(e=t.getLocalGroupProfile(e)).type;return e=e.isSupportTopic,!Et(n)&&!e}))).length&&(Pe.l("".concat(n," list:").concat(e)),this.req({P:Kn.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(e)}}).then((function(e){e=e.data.notifyRspList;var o,i,s=[];Xe(e)&&(o={dataList:[]},i="".concat(n," ok."),e.forEach((function(e){var n=e.nextRevokedTime,a=e.groupID,r=e.notifyList;i+=" groupID:".concat(a," nextRevokedTime:").concat(n," count:").concat(r.length,"\n"),o.dataList.push({elements:{revokedInfos:t._genRevokedInfos(e)}}),0!==n?(t._setGroupLastRevokedTime(a,n),s.push(a)):t._setGroupLastRevokedTime(a,1e3*Le())})),Pe.l(i),t.onMsgRevoked(o,!1)),0<s.length&&t.getNotice(s)})).catch((function(e){Pe.e("".concat(n," failed. error:"),e)})))}},{key:"_genRevokedInfos",value:function(e){var n=e.notifyList,o=e.groupID,i=[];return Xe(n)&&n.forEach((function(e){i.push({groupID:o,sequence:e.sequence,random:e.random,revokerInfo:t({},e.revokerInfo)})})),i}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(e){return this._groupMemberHandler.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._groupMemberHandler.getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._groupMemberHandler.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._groupMemberHandler.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._groupMemberHandler.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._groupMemberHandler.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._groupMemberHandler.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._groupMemberHandler.setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._groupMemberHandler.markGroupMemberList(e)}},{key:"modifyGroupMemberInfo",value:function(e){return this._groupMemberHandler.modifyGroupMemberInfo(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var t=this.getLocalGroupProfile(e);return t&&Et(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===k.GRP_PUBLIC||St({type:e})}},{key:"_silentlyGetGroupProfile",value:function(e,t){var n=setTimeout(this.getGroupProfile.bind(this,{groupID:t}),3e3);this._timeoutIDs.push(n),Pe.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(e," groupID:").concat(t," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach((function(e){e&&clearTimeout(e)})),this._timeoutIDs=[]}},{key:"startMessageLongPolling",value:function(e){var t=e.groupID,n=e.longPollingKey,o=(e=void 0===(e=e.longPollingSequence)?1:e,this.get(12).isUnlimitedAVChatRoom()),i=(this._AVChatRoomHandler.hasPollingInstance(t)&&this.stopMessageLongPolling({groupID:t}),this._AVChatRoomHandler.getJoinedLiveList());return!o&&0<i.length&&this.stopMessageLongPolling({groupID:i[0]}),o=new pi({groupID:t,type:k.GRP_LIVE}),Pe.l("".concat(this._n,".startMessageLongPolling groupID:").concat(t," longPollingKey:").concat(n," longPollingSequence:").concat(e)),this._AVChatRoomHandler.startRunLoop({group:o,longPollingKey:n,startSeq:e})}},{key:"stopMessageLongPolling",value:function(e){e=e.groupID;var t=this.get(11);return this._AVChatRoomHandler.reset(e),this._deleteLocalGroup(e),t.deleteLocalConv("".concat(k.CONV_GROUP).concat(e)),Pe.l("".concat(this._n,".stopMessageLongPolling ok, groupID:").concat(e)),Dn({groupID:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),$i),Oi=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],Ni=(s(Ji,[{key:"_initTopic",value:function(e){for(var t in e)Oi.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=ei(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){ht(e.selfInfo)||this.updateSelfInfo(e.selfInfo),ht(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),ot(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0===ot(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),Ji),Pi=(r(Wi,wn),ii=f(Wi),s(Wi,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");ht(e)||(this.TOPIC_CACHE_TIME=Number(e)),ht(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOEvt(D.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,o=e.topicIDList;(void 0===o?[]:o).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOEvt(D.TOPIC_DELETED,e)}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID;(n=this.getLocalTopic(t,n))&&(n.updateTopic(e),this.emitOEvt(D.TOPIC_UPDATED,{groupID:t,topic:n}))}},{key:"onTopicLatestMsg",value:function(e){var t,n,o=(e=e||{}).topicLatestMessage;e=e.excludedUnreadSequenceList,je(o)||(t=o.groupProfile.topicID,o.conversationType=k.CONV_GROUP,o.to=t,(n=new Oo(o)).setElement(o.elements),this.updateUnreadCountAndLastMsg(t,n,e))}},{key:"onMessageRemindTypeUpdated",value:function(e){var t,n=e.groupID,o=e.topicID,i=(e=e.messageRemindType,this.getLocalTopic(n,o));i&&((t=i.updateSelfInfo({messageRemindType:e}))&&this.emitOEvt(D.TOPIC_UPDATED,{groupID:n,topic:i}),Pe.l("".concat(this._n,".onMessageRemindTypeUpdated topicID:").concat(o," messageRemindType:").concat(e," isUpdated:").concat(t)))}},{key:"onAtInfoUpdated",value:function(e){var t=e.topicID,n=(e=e.groupAtInfoList,qt(t));(t=this.getLocalTopic(n,t))&&!ht(e)&&(t.updateGroupAtInfoList(e),this.emitOEvt(D.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"onUnreadCountUpdatedFromConv",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=qt(e);(e=this.getLocalTopic(n,e))&&e.unreadCount!==t&&(e.updateUnreadCount(t),0===t&&e.updateSelfInfo({readedSequence:e.lastMessage.lastSequence}),this.emitOEvt(D.TOPIC_UPDATED,{groupID:n,topic:e}))}},{key:"onMessageSent",value:function(e){var t,n,o=e.groupID,i=e.topicID;e=e.lastMessage,!(i=this.getLocalTopic(o,i))||(n=(t=void 0===(t=e.sequence)?0:t)+1)>i.nextMessageSeq&&(i.updateNextMessageSeq(n),i.updateLastMessage(e),i.updateSelfInfo({readedSequence:t}),i.updateUnreadCount(0),this.emitOEvt(D.TOPIC_UPDATED,{groupID:o,topic:i}))}},{key:"onMessageModified",value:function(e){var t,n=e.to,o=e.time,i=e.sequence,s=e.elements,a=e.cloudCustomData,r=e.messageVersion,c=qt(n),u=this.getLocalTopic(c,n);u&&(t=u.lastMessage,Pe.d("".concat(this._n,".onMessageModified topicID:").concat(n," lastMessage:"),JSON.stringify(t),"options:",JSON.stringify(e)),t&&(null===t.payload||t.lastTime===o&&t.lastSequence===i&&t.version!==r)&&(t.type=s[0].type,t.payload=s[0].content,t.messageForShow=Bt(t.type,t.payload,this.isIntl()),t.cloudCustomData=a,t.version=r,t.lastSequence=i,t.lastTime=o,this.emitOEvt(D.TOPIC_UPDATED,{groupID:c,topic:u})))}},{key:"onMessageRevoked",value:function(e){var t,n,o,i=this;0!==e.length&&(n=t=null,o=!1,e.forEach((function(e){var s=e.to;n=qt(s),(t=i.getLocalTopic(n,s))&&(t.reduceUnreadCount()&&(o=!0),t.isLastMessageRevoked(e)&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(e.revoker),o=!0),(s=t.selfInfo.excludedUnreadSequenceList||[]).push(e.sequence),t.updateSelfInfo({excludedUnreadSequenceList:s}))})),o&&this.emitOEvt(D.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=(e=e.sequence,qt(t));return n=this.getLocalTopic(n,t),t=!1,n?n.isLastMessageRevoked({sequence:e}):t}},{key:"updateUnreadCountAndLastMsg",value:function(e,t,n){var o,i=qt(e),s=this.getLocalTopic(i,e);s&&(o=s.selfInfo.excludedUnreadSequenceList||[],ht(n)||(o=n),t._isExcludedFromUnreadCount&&o.push(t.sequence),s.updateSelfInfo({excludedUnreadSequenceList:o}),Pe.l("".concat(this._n,".updateUnreadCountAndLastMsg seq:").concat(t.sequence," lastSeq:").concat(s.lastMessage.lastSequence)),t.sequence>s.lastMessage.lastSequence&&(s.updateLastMessage(t),n=t.sequence+1,s.updateNextMessageSeq(n),o=this._computeUnreadCount(s),s.updateUnreadCount(o),(t=this.get(11).getLocalConversation("".concat(k.CONV_GROUP).concat(e)))&&t.updateUnreadCount({nextUnreadCount:o,isFromGetConversations:!0}),this.emitOEvt(D.TOPIC_UPDATED,{groupID:i,topic:s})))}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(e){var n=this,o="".concat(this._n,".").concat("createTopicInCommunity"),i=e.topicID;if(!ht(i)&&!Dt(i))return kn({code:Hn.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return kn({code:Hn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return kn({code:Hn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return kn({code:Hn.PROFANITY_FOUND});var s=new ao("createTopicInCommunity");return this.req({P:Kn.CREATE_TOPIC,data:t({},e)}).then((function(i){return i=i.data.topicID,s.setMessage("topicID:".concat(i)).end(),Pe.l("".concat(o," ok. topicID:").concat(i)),n._updateTopicMap([t(t({},e),{},{topicID:i})]),Sn({topicID:i})})).catch((function(e){return s.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),o=e.groupID,i=(e=void 0===(e=e.topicIDList)?[]:e,new ao("deleteTopicFromCommunity"));return i.setMessage("groupID:".concat(o," topicIDList:").concat(e)),this.req({P:Kn.DEL_TOPIC,data:{groupID:o,topicIDList:e}}).then((function(e){e=e.data.resultList;var s=[],a=[];return(void 0===e?[]:e).forEach((function(e){var t=e.topicID,n=e.errorCode;e=e.errorInfo,0===n?s.push({topicID:t}):a.push({topicID:t,code:n,message:e})})),e="success count:".concat(s.length,", fail count:").concat(a.length),i.setMoreMessage(e).end(),Pe.l("".concat(n," ok. ").concat(e)),s.forEach((function(e){t._deleteLocalTopic(o,e.topicID)})),Sn({successTopicList:s,failureTopicList:a})})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"updateTopicProfile",value:function(e){var n=this,o="".concat(this._n,".").concat("updateTopicProfile");if(Pe.l("".concat(o," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return kn({code:Hn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return kn({code:Hn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return kn({code:Hn.PROFANITY_FOUND});var i=new ao("updateTopicProfile");return i.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),ht(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.req({P:Kn.UPDATE_TOPIC_PROFILE,data:t({},e)}).then((function(){return i.end(),Pe.l("".concat(o," ok")),n._updateTopicMap([e]),Sn({topic:n.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"getTopicList",value:function(e){var n=this,o="".concat(this._n,".").concat("getTopicList"),i=e.groupID,s=0===(e=void 0===(e=e.topicIDList)?[]:e).length,a=new ao("getTopicList");if(a.setMessage("groupID:".concat(i)),this._getTopicTimeMap.has(i)){var r=(c=this._getTopicTimeMap.get(i)).isGetAll,c=c.time;if((r||!r&&!s)&&Date.now()-c<1e3*this.TOPIC_CACHE_TIME&&(r=this._getLocalTopicList(i,e),s||r.length===e.length))return a.setMoreMessage("from cache, topic count:".concat(r.length)).end(),Pe.l("".concat(o," groupID:").concat(i," from cache, topic count:").concat(r.length)),Dn({successTopicList:r,failureTopicList:[]})}return this.req({P:Kn.GET_TOPIC_LIST,data:{groupID:i,topicIDList:e}}).then((function(e){e=e.data.topicInfoList;var r=[],c=[],u=[];return(void 0===e?[]:e).forEach((function(e){var n=e.topic,o=e.selfInfo,i=e.errorCode,s=(e=e.errorInfo,n.topicID);0===i?(r.push(t(t({},n),{},{selfInfo:o})),c.push(s)):u.push({topicID:s,code:i,message:e})})),n._updateTopicMap(r),n._handleTopicAtInfo(r),e="success count:".concat(c.length,", fail count:").concat(u.length),a.setMoreMessage(e).end(),Pe.l("".concat(o," groupID:").concat(i," from remote, ").concat(e)),e=[],je(c)||(n._getTopicTimeMap.set(i,{time:Date.now(),isGetAll:s}),e=n._getLocalTopicList(i,c)),Sn({successTopicList:e,failureTopicList:u})})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){var n=null;return this._topicMap.has(e)?this._topicMap.get(e).get(t):n}},{key:"_getLocalTopicList",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=[];return(e=this._topicMap.get(e))&&(n=v(e.values())),0===t.length?n:n.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&this._topicMap.get(e).has(t)&&(this._topicMap.get(e).delete(t),Pe.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var o=e.groupID,i=e.topicID,s=null;t._topicMap.has(o)||t._topicMap.set(o,new Map),t._topicMap.get(o).has(i)?(s=t._topicMap.get(o).get(i)).updateTopic(e):(t._getTopicLastMessage(e),s=new Ni(e,t.isIntl()),t._topicMap.get(o).set(i,s)),e=t._computeUnreadCount(s),s.updateUnreadCount(e),n.push({conversationID:"".concat(k.CONV_GROUP).concat(i),type:k.CONV_TOPIC,unreadCount:e})})),0<n.length&&this.get(11).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;ht(e)?v(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=v(this._topicMap.keys()),n=[],o=this.get(11);t.forEach((function(t){var i=[],s=e._getLocalTopicList(t);o.deleteTopicRoamingInfo(t),s.forEach((function(t){var n=void 0===(n=t.lastMessage.lastTime)?0:n;Date.now()-1e3*n<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(t.topicID)})),0<i.length&&n.push({groupID:t,topicIDList:i})})),Pe.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t,n,o,i=this;0!==e.length&&(n=5<(t=e.shift()).topicIDList.length?"topicIDList.length:".concat(t.topicIDList.length):"topicIDList:".concat(t.topicIDList),(o=new ao("relayGetTopicList")).setMessage(n),Pe.l("".concat(this._n,"._relayGetTopicList. ").concat(n)),this.getTopicList(t).then((function(){o.end(),i._relayGetTopicList(e)})).catch((function(t){o.setError(t).end(),i._relayGetTopicList(e)})))}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var o=e.groupID,i=e.topicID,s=(e=e.groupAtInfoList,[]);ht(e)||(e.forEach((function(e){s.push(t(t({},e),{},{groupID:o,topicID:i}))})),n.get(11).onNewGroupAtTips({dataList:s}))}))}},{key:"_getTopicLastMessage",value:function(e){var t;ht(e.lastMsg)||(t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,avatar:e.lastMsg.avatar,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:je(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker},e.lastMessage=t)}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),o=this.get(11);n.forEach((function(n){n=n.topicID,t._deleteLocalTopic(e,n),t._getTopicTimeMap.delete(e),o.deleteLocalConv("".concat(k.CONV_GROUP).concat(n))}))}},{key:"_computeUnreadCount",value:function(e){var t,n=(i=e.selfInfo).excludedUnreadSequenceList,o=i.readedSequence,i=e.nextMessageSeq-e.selfInfo.readedSequence-1;return Xe(n)&&(t=0,n.forEach((function(n){o<n&&n<=e.nextMessageSeq-1&&(t+=1)})),1<=t&&(i-=t)),i<0?0:i}},{key:"_filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],F)).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"getMessageExtensions",value:function(e,t){Pe.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=qt(e.to);return this.req({P:Kn.GET_GRP_MSG_EXT,data:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=(Pe.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),qt(e.to));return this.req({P:Kn.MODIFY_GRP_MSG_EXT,data:{groupID:o,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),Wi),bi=(s(zi,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),o=e.userIDList;e.fromAccount=this._userM.getMyAccount(),100<o.length&&(Pe.w("".concat(n," ").concat(Yt(100))),o.length=100);for(var i,s=[],a=[],r=0,c=o.length;r<c;r++)i=o[r],this._userM.isMyFriend(i)&&this._contains(i)?a.push(this._getProfileFromMap(i)):s.push(i);if(0===s.length)return Dn(a);e.toAccount=s;var u=e.bFromGetMyProfile||!1,l=[],d=(e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l,new ao("getUserProfile"));return d.setMessage(5<o.length?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),this._userM.req({P:Kn.GET_USER_PROFILE,data:e}).then((function(e){return d.end(),Pe.i("".concat(n," ok")),e=t._handleResponse(e).concat(a),Sn(u?e[0]:e)})).catch((function(e){return d.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"getMyProfile",value:function(){var e,t=this._userM.getMyAccount(),n="".concat(this._n,".getMyProfile");return Pe.l("".concat(n," myAccount:").concat(t)),this._fill(),this._contains(t)?(e=this._getProfileFromMap(t),Pe.d("".concat(n," from cache, myProfile:").concat(JSON.stringify(e))),Dn(e)):this.getUserProfile({fromAccount:t,userIDList:[t],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!Xe(t))return[];for(var n=[],o=(e=Date.now(),0),i=t.length;o<i;o++){var s=(a=t[o]).to,a=a.profileItem;"@TLS#NOT_FOUND"!==s&&""!==s&&(s=this._update(s,this._getLatestProfileFromResponse(s,a)).latestProfile,n.push(s))}return Pe.l("".concat(this._n,"._handleResponse cost:").concat(Jt(e))),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!je(t))for(var o=0,i=t.length;o<i;o++)if(-1<t[o].tag.indexOf("Tag_Profile_Custom"))n.profileCustomField.push({key:t[o].tag,value:t[o].value});else switch(t[o].tag){case Ue.NICK:n.nick=t[o].value;break;case Ue.GENDER:n.gender=t[o].value;break;case Ue.BIRTHDAY:n.birthday=t[o].value;break;case Ue.LOCATION:n.location=t[o].value;break;case Ue.SELFSIGNATURE:n.selfSignature=t[o].value;break;case Ue.ALLOWTYPE:n.allowType=t[o].value;break;case Ue.LANGUAGE:n.language=t[o].value;break;case Ue.AVATAR:n.avatar=t[o].value;break;case Ue.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case Ue.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case Ue.LEVEL:n.level=t[o].value;break;case Ue.ROLE:n.role=t[o].value;break;default:Pe.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[o].tag,t[o].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userM.filterProfanity("nick",e))return kn({code:Hn.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userM.filterProfanity("selfSignature",e))return kn({code:Hn.PROFANITY_FOUND});var o=new ao("updateMyProfile"),i=(o.setMessage(JSON.stringify(e)),(new ui).validate(e));if(!i.valid)return o.setCode(Hn.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(i.tips)).end(),Pe.e("".concat(n," info:").concat(i.tips)),kn({code:Hn.UPDATE_PROFILE_INVALID_PARAM});var s,a=[];for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&("profileCustomField"===s?e.profileCustomField.forEach((function(e){a.push({tag:e.key,value:e.value})})):a.push({tag:Ue[s.toUpperCase()],value:e[s]}));if(0===a.length)return i=new Bn({code:Hn.UPDATE_PROFILE_NO_KEY}),o.setError(i).end(),Pe.e("".concat(n," failed. error:"),i),kn(i);var r=this._userM.getMyAccount();return this._userM.req({P:Kn.UPDATE_MY_PROFILE,data:{fromAccount:r,profileItem:a}}).then((function(i){o.end(),Pe.i("".concat(n," ok"));var s=(a=t._update(r,e)).isProfileUpdated,a=a.latestProfile;return!0===s&&t._userM.emitOEvt(D.PROFILE_UPDATED,[a]),Dn(a)})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!je(t)){var n=t.length;Pe.d("".concat(this._n,".onProfileModified count:").concat(n," dataList:"),e.dataList);for(var o=[],i=0;i<n;i++){var s=t[i].userID,a=(s=this._update(s,this._getLatestProfileFromResponse(s,t[i].profileList))).isProfileUpdated;s=s.latestProfile,!0===a&&o.push(s)}0<o.length&&(this._userM.emitIEvt(Wo.PROFILE_UPDATED,o),this._userM.emitOEvt(D.PROFILE_UPDATED,o))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Pe.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,o=!1,i=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===It(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=i,o=!0),0<ot(n,t,["profileCustomField"])&&(n.lastUpdatedTime=i,o=!0)):(n=new ui(t),!this._userM.isMyFriend(e)&&e!==this._userM.getMyAccount()||(n.lastUpdatedTime=i,o=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userM.getMyAccount()),!0===o&&Pe.l("".concat(this._n,"._update account:").concat(e," isUpdated:").concat(o)),{isProfileUpdated:o,latestProfile:n}}},{key:"_flush",value:function(e){var t=v(this.accountProfileMap.values()),n=this._userM.getStorageModule();Pe.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userM.getStorageModule().getItem(this.TAG);return je(e)?[]:e}},{key:"onConvProfileUpdated",value:function(e){for(var t,n,o=[],i=0,s=e.length;i<s;i++)n=(t=e[i]).userID,this._userM.isMyFriend(n)&&(this._contains(n)?0<ot(this._getProfileFromMap(n),t)&&o.push(n):o.push(t.userID));0!==o.length&&(Pe.l("".concat(this._n,".onConvProfileUpdated toAccountList:").concat(o)),this.getUserProfile({userIDList:o}))}},{key:"getNickAndAvatarByUserID",value:function(e){return this._contains(e)?{nick:(e=this._getProfileFromMap(e)).nick,avatar:e.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(e){var t=this,n=v(new Set(e)),o=(Pe.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(e.length," uniqueUserIDList.length:").concat(n.length)),[]);if(0===e.length)return Promise.resolve(o);e=this._createUserIDListGroup(n);var i=[];return e.forEach((function(e){i.push(t.getUserProfile({userIDList:e}))})),Promise.all(i).then((function(e){return e.forEach((function(e){e=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),o.push.apply(o,v(e))})),o}))}},{key:"_createUserIDListGroup",value:function(e){for(var t=[],n=0;n<e.length;)t.push(e.slice(n,n+=100));return t}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),zi),Ui=s((function e(t){o(this,e)})),Gi=(s(Yi,[{key:"getLocalBlacklist",value:function(){return v(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userM.getMyAccount(),maxLimited:100,startIndex:this._startIndex},o=new ao("getBlacklist");return this._userM.req({P:Kn.GET_BL,data:n}).then((function(n){var i=(n=n.data).blackListItem,s=(n=n.startIndex,je(i)?0:i.length);o.setMessage("count:".concat(s)).end(),Pe.i("".concat(t," ok")),e._startIndex=n,e._handleResponse(i,!0),e._userM.emitOEvt(D.BLACKLIST_UPDATED,v(e._blacklistMap.keys())),0!==e._startIndex&&e.getBlacklist()})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"addBlacklist",value:function(e){var t,n,o=this,i=new ao("addToBlacklist"),s="".concat(this._n,".addBlacklist"),a=this._userM.getMyAccount();return 1===e.userIDList.length&&e.userIDList[0]===a?(n=this._userM.getErrMsg(t=Hn.CANNOT_ADD_SELF_TO_BLACKLIST),i.setCode(t).setMessage(n).end(),n=new Bn({code:t}),Pe.e("".concat(s," failed. error:"),n),kn(n)):(e.userIDList.includes(a)&&(e.userIDList=e.userIDList.filter((function(e){return e!==a}))),e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:Kn.ADD_TO_BL,data:e}).then((function(t){return i.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Pe.i("".concat(s," ok")),o._handleResponse(t.resultItem,!0),Sn(v(o._blacklistMap.keys()))})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(s," failed. error:"),e),kn(e)})))}},{key:"_handleResponse",value:function(e,t){if(!je(e))for(var n,o,i,s=0,a=e.length;s<a;s++)o=e[s].to,i=e[s].resultCode,!ht(i)&&0!==i||(t?((n=this._blacklistMap.has(o)?this._blacklistMap.get(o):new Ui).userID=o,je(e[s].addBlackTimeStamp)||(n.timeStamp=e[s].addBlackTimeStamp),this._blacklistMap.set(o,n)):this._blacklistMap.has(o)&&(n=this._blacklistMap.get(o),this._blacklistMap.delete(o)));Pe.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),o=new ao("removeFromBlacklist");return e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:Kn.RM_FROM_BL,data:e}).then((function(i){return o.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Pe.i("".concat(n," ok")),t._handleResponse(i.data.resultItem,!1),Sn(v(t._blacklistMap.keys()))})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];this._blacklistMap.has(o)&&this._blacklistMap.delete(o)}var i=e.length;0<i&&(Pe.l("".concat(this._n,".onAccountDeleted count:").concat(i," ").concat(i<30?"userIDList:".concat(e):"")),this._userM.emitOEvt(D.BLACKLIST_UPDATED,v(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],o=0,i=e.length;o<i;o++)t=e[o],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Ui({userID:t})),n.push(t));0<n.length&&(Pe.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userM.emitOEvt(D.BLACKLIST_UPDATED,v(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this._startIndex=0}}]),Yi),wi=(s(Ki,[{key:"_onCloudConfig",value:function(){var e=this._userM.getCloudConfig("status_query_count"),t=this._userM.getCloudConfig("status_sub_count"),n=this._userM.getCloudConfig("status_unsub_count");Pe.l("".concat(this._n,"._onCloudConfig statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),ht(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),ht(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),ht(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){e=e.dataList;var t=this._userM.getMyUserID(),n=this._userM.get(12);e=e.map((function(e){var o=e.to,i=e.statusType;return e=ti(e=e.customStatus),o===t&&n.setCustomStatus(e),{userID:o,statusType:i,customStatus:e}})),Pe.l("".concat(this._n,".onUserStatusUpdated list:").concat(JSON.stringify(e))),this._userM.emitOEvt(D.USER_STATUS_UPDATED,e)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userM.filterProfanity("customStatus",e))return kn({code:Hn.PROFANITY_FOUND});var o=new ao("setSelfStatus"),i=e.customStatus;return this._userM.req({P:Kn.SET_SELF_STATUS,data:{customStatus:i}}).then((function(e){return o.setMessage("customStatus:".concat(i)).end(),Pe.l("".concat(n," ok. customStatus:").concat(i)),t._userM.get(12).setCustomStatus(i),Sn({userID:t._userM.getMyUserID(),statusType:1,customStatus:i})})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"getUserStatus",value:function(e){var t="".concat(this._n,".").concat("getUserStatus"),n=void 0===(e=e.userIDList)?[]:e,o=(e=this._userM.getMyUserID(),v(n)),i=void 0,s=o.indexOf(e);if(-1<s&&(o.splice(s,1),i={userID:e,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),0===o.length)return Dn({successUserList:[i],failureUserList:[]});if(!this._userM.canIUse(w.USER_STATUS))return this._userM.noUse("getUserStatus");o.length>this.MAX_QUERY_USER_COUNT&&(Pe.w("".concat(t," ").concat(Yt(this.MAX_QUERY_USER_COUNT))),o=n.slice(0,this.MAX_QUERY_USER_COUNT));var a=new ao("getUserStatus");return this._userM.req({P:Kn.GET_USER_STATUS,data:{userIDList:o}}).then((function(e){var o=void 0===(o=(e=e.data).successUserList)?[]:o,s=(e=void 0===(e=e.failureUserList)?[]:e,o=o.map((function(e){return{userID:e.userID,statusType:e.statusType,customStatus:ti(e=e.customStatus)}})),e=e.map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:je(n)?t:n,code:o,message:e}})),ht(i)||o.unshift(i),"userID count:".concat(n.length,", success count:").concat(o.length,", fail count:").concat(e.length));return a.setMessage("".concat(s)).end(),Pe.l("".concat(t," ok. ").concat(s,".")),Sn({successUserList:o,failureUserList:e})})).catch((function(e){return a.setMessage("userID count:".concat(n.length)).setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"subscribeUserStatus",value:function(e){var t="subscribeUserStatus";if(!this._userM.canIUse(w.USER_STATUS))return this._userM.noUse(t);var n="".concat(this._n,".").concat(t),o=v(e=void 0===(e=e.userIDList)?[]:e),i=(o.length>this.MAX_SUBSCRIBE_USER_COUNT&&(Pe.w("".concat(n," ").concat(Yt(this.MAX_SUBSCRIBE_USER_COUNT))),o=e.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),new ao(t)),s="userID count:".concat(e.length);return Pe.l("".concat(n," ").concat(s)),this._userM.req({P:Kn.SUB_USER_STATUS,data:{userIDList:o}}).then((function(e){return e=(void 0===(e=e.data.failureUserList)?[]:e).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:je(n)?t:n,code:o,message:e}})),i.setMessage("".concat(s," fail count:").concat(e.length)).end(),Pe.l("".concat(n," ok. fail count:").concat(e.length,".")),Sn({failureUserList:e})})).catch((function(e){return i.setMessage(s).setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t="unsubscribeUserStatus";if(!this._userM.canIUse(w.USER_STATUS))return this._userM.noUse(t);var n="".concat(this._n,".").concat(t),o=v(e=void 0===(e=(e||{}).userIDList)?[]:e),i=(e.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Pe.w("".concat(n," ").concat(Yt(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=e.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),new ao(t)),s="userID count:".concat(e.length);return Pe.l("".concat(n," ").concat(s)),t={userIDList:o},0===o.length&&(t.userIDList=void 0,t.unsubscribeAll=1),this._userM.req({P:Kn.UNSUB_USER_STATUS,data:t}).then((function(e){return e=(void 0===(e=e.data.failureUserList)?[]:e).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:je(n)?t:n,code:o,message:e}})),i.setMessage("".concat(s," fail count:").concat(e.length)).end(),Pe.l("".concat(n," ok. fail count:").concat(e.length,".")),Sn({failureUserList:e})})).catch((function(e){return i.setMessage("".concat(s)).setError(e).end(),Pe.e("".concat(n," failed. error:"),e),kn(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),Ki),Fi=(r(ji,wn),oi=f(ji),s(ji,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(e,t){Pe.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(e," avatar:").concat(t)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:Ue.NICK,value:e},{tag:Ue.AVATAR,value:t}]}]})}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t,n;je(e=e.dataList)||(t=[],e.forEach((function(e){e.blackListDelAccount&&t.push.apply(t,v(e.blackListDelAccount))})),0<t.length&&this._blacklistHandler.onAccountDeleted(t),n=[],e.forEach((function(e){e.blackListAddAccount&&n.push.apply(n,v(e.blackListAddAccount))})),0<n.length&&this._blacklistHandler.onAccountAdded(n))}},{key:"onConvProfileUpdated",value:function(e){this._profileHandler.onConvProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],"user_profile")).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.get(8);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getUserNickAndAvatar",value:function(e){return this._profileHandler.getUserNickAndAvatar(e)}},{key:"getLocalBlacklist",value:function(){return Dn(this._blacklistHandler.getLocalBlacklist())}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),ji),xi=(s(Hi,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isPartialUpdatedConvs",value:function(){return this._isPartialUpdatedConvs}},{key:"isIndependentDomainDisabled",value:function(){return this._isIndependentDomainDisabled}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||2e7<=e&&e<9e7||172e7<=e&&e<179e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(e){this._isUsingChatCore=e}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(e){this._uiPlatform=e}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return ve?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(e){this._applicationID=e}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"setDowloadFileAuthKey",value:function(e){this._authKey=e}},{key:"getDowloadFileAuthKey",value:function(){return this._authKey}},{key:"setCustomLoginInfo",value:function(e){this._customLoginInfo=e}},{key:"getCustomLoginInfo",value:function(){return this._customLoginInfo}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,o=!1,i=[];ee&&(i=Object.keys(ie));for(var s=0,a=(i=oe?Q?Object.keys(uni):Object.keys(window):i).length;s<a;s++)if(i[s].toLowerCase().includes("uikit")){e=!0;break}i=null;var r,c=(ee&&!Qe(ie.createGamePortal)&&Qe(getApp)&&!ht(getApp())&&$e(r=getApp().globalData)&&!0===r.isTUIKit&&(t=!0),!0===this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0),null);if(j&&!z&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),Y&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),Xe(c)&&0<c.length){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){o=!0;break}c=null}return e||t||n||o}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),Hi),Vi={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12,"k-rn":13},qi=(r(Bi,wn),ni=f(Bi),s(Bi,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var e=void 0,t=this.get(36),n=this.get(28);return t.canIUseTIMPush()?e=t:n.canIUseOfflinePush()&&(e=n),e}},{key:"login",value:function(e){if(this.isLoggedIn())return t=this.getMyUserID(),(t=this.getErrMsg("RepeatLogin",t))&&Pe.w(t),Dn({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.warn("LoggingIn",e.userID),kn({code:Hn.REPEAT_LOGIN});if(Pe.l("".concat(this._n,".login userID:").concat(e.userID)),0!==(t=this._checkLoginInfo(e)).code)return kn(t);var t=this.get(12),n=e.userID;return e=e.userSig,t.setUserID(n),t.setUserSig(e),this.get(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.get(12),n=t.getScene(),o=0,i=n,s=(n&&n.startsWith("k-")&&(i=Vi[n],n="tuikit"),new ao("login")),a=(s.setMessage("".concat(i)).setMoreMessage("identifier:".concat(this.getMyUserID())),"tuikit"===n),r=0,c=(Q?r=a?3===i||4===i||5===i||6===i?31:9===i||10===i||11===i||12===i?32:4:3:ee?r=K?36:"tuikit"===n?12:11:oe?r=ve?"flutter_web_uikit"===n?21:20:this._isReactUIKit()?me?25:24:a?1===i||2===i?29:7===i||8===i?30:me?17:14:me?16:13:13===i&&(r=38),s.setUIPlatform(r),t.setUIPlatform(r),(a=this.getPushModule())&&(this._isWebUniapp=a.getUniAppPlatform(),i=this._getStatusInstanceID(),t.setStatusInstanceID(i),this.get(20).updateProtocolConfig(),o=a.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({P:Kn.LOGIN,data:{deviceBrand:o,isWebUniapp:this._isWebUniapp,customInfo:t.getCustomLoginInfo()}}).then((function(o){e._lastLoginTs=0;var i=Date.now(),a=null,r=(_=o.data).a2Key,u=_.tinyID,l=_.helloInterval,d=_.instanceID,p=_.timeStamp,h=void 0===(h=_.customStatus)?"":h,g=_.purchaseBits,_=void 0===(_=_.authKey)?"":_,f=1e3*p,m=i-s.getStartTs();if(m=f+parseInt(m/2)-i,i=s.getStartTs()+m,s.start(i),i=f,Re=m,(f=new Date).setTime(i),Pe.i("baseTime from server:".concat(f," offset:").concat(Re)),!u)throw a=new Bn({code:Hn.NO_TINYID}),s.setError(a).end(),a;if(!r)throw a=new Bn({code:Hn.NO_A2KEY}),s.setError(a).end(),a;return i=e.get(21).getSocketID(),f=ti(h),a="socketID:".concat(i," scene:").concat(n," helloInterval:").concat(l," instanceID:").concat(d," timeStamp:").concat(p)+" offset:".concat(m," customStatus:").concat(f," isWebUniapp:").concat(e._isWebUniapp),Pe.l("".concat(c," ok. ").concat(a)),h="",i="",j&&Qe(ie.getAccountInfoSync)&&(p=ie.getAccountInfoSync().miniProgram)&&(h=p.appId,i=p.envVersion),s.setMoreMessage("".concat(a," href:").concat(oe?window.location.href:""," mpAppId:").concat(h," envVersion:").concat(i," authKey:").concat(_)).end(),t.setA2Key(r),t.setTinyID(u),t.setStatusInstanceID(d),t.setCustomStatus(f),t.setDowloadFileAuthKey(_),g&&e.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:g}),e.get(20).updateProtocolConfig(),e.emitIEvt(Wo.A2KEY_AND_TINYID_UPDATED),e._helloInterval=l,e.triggerReady(),(m=e.getPushModule())&&(uni.setStorageSync("timUniAppInstanceID",d),m.init()),e._fetchCloudControlConfig(),e.get(29).init(),o})).catch((function(t){return s.setError(t).end(!0),e._m.setNotReadyReason(Hn.LOGIN_FAILED),Pe.e("".concat(c," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),kn(t)}))}},{key:"logout",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n="".concat(this._n,".logout"),o=this.isLoggedIn();return Pe.i("".concat(n," type:").concat(t," isLoggedIn:").concat(o," isWebUniapp:").concat(this._isWebUniapp)),o?(new ao("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0),0===t&&this._m.setNotReadyReason(Hn.LOGGED_OUT),this.req({P:Kn.LOGOUT,data:{type:t,isWebUniapp:this._isWebUniapp}}).then((function(){return e.resetReady(),Dn({})})).catch((function(t){return Pe.e("".concat(n," error:"),t),e.resetReady(),Dn({})}))):kn({code:Hn.USER_NOT_LOGGED_IN})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")||0}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.req({P:Kn.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Pe.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return je(this.get(12).getSDKAppID())?t=Hn.NO_SDKAPPID:je(e.userID)?t=Hn.NO_IDENTIFIER:je(e.userSig)&&(t=Hn.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return oe&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new ao("kickedOut").setMessage("type:".concat(k.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Pe.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOEvt(D.KICKED_OUT,{type:k.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(Hn.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new ao("kickedOut").setMessage("type:".concat(k.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Pe.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOEvt(D.KICKED_OUT,{type:k.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(Hn.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new ao("kickedOut").setMessage(k.KICKED_OUT_USERSIG_EXPIRED).end(!0),Pe.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),0!==this.get(12).getStatusInstanceID()&&(this.emitOEvt(D.KICKED_OUT,{type:k.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(Hn.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new ao("kickedOut").setMessage("type:".concat(k.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Pe.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.get(12).getStatusInstanceID()&&(this.emitOEvt(D.KICKED_OUT,{type:k.KICKED_OUT_REST_API}),this._m.setNotReadyReason(Hn.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),Bi);function Bi(e){return o(this,Bi),(e=ni.call(this,e))._n="SignModule",e._helloInterval=120,e._lastLoginTs=0,e._lastWsHelloTs=0,e._isWebUniapp=0,Zo.mixin(g(e)),e}function Hi(e,t){o(this,Hi),this._m=e,this._isLoggedIn=!1,this._SDKAppID=t.SDKAppID,this._userID=t.userID||"",this._userSig=t.userSig||"",this._version="3.5.2",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=t.unlimitedAVChatRoom,this._scene=t.scene||"",this._oversea=t.oversea,this._instanceID=t.instanceID,this._statusInstanceID=0,this._isDevMode=t.devMode,this._isTestEnv=t.testEnv,this._proxyServer=t.proxyServer,this._fileUploadProxy=t.fileUploadProxy,this._fileDownloadProxy=t.fileDownloadProxy,this._applicationID=0,this._isPartialUpdatedConvs=t.partialUpdatedConversations,this._isIndependentDomainDisabled=t.disableIndependentDomain,this._isUsingChatCore=!1,this._uiPlatform=0,this._authKey="",this._customLoginInfo=""}function ji(e){return o(this,ji),(e=oi.call(this,e))._n="UserModule",e._profileHandler=new bi(g(e)),e._blacklistHandler=new Gi(g(e)),e._userStatusHandler=new wi(g(e)),e.getIEmitInst().on(Wo.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,g(e)),e}function Ki(e){o(this,Ki),this._userM=e,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getIEmitInst().on(Wo.CLOUD_CONFIG,this._onCloudConfig,this)}function Yi(e){o(this,Yi),this._userM=e,this._n="BlacklistHandler",this._blacklistMap=new Map,this._startIndex=0}function zi(e){o(this,zi),this._userM=e,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function Wi(e){return o(this,Wi),(e=ii.call(this,e))._n="TopicModule",e._topicMap=new Map,e._getTopicTimeMap=new Map,e.TOPIC_CACHE_TIME=300,e.TOPIC_LAST_ACTIVE_TIME=3600,e.getIEmitInst().on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Ji(e,t){o(this,Ji),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=ei(e.lastMessage,t),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(e)}function $i(e){return o(this,$i),(e=si.call(this,e))._n="GroupModule",e._commonGroupHandler=new yi(g(e)),e._groupAttributesHandler=new Ii(g(e)),e._groupCountersHandler=new Mi(g(e)),e._AVChatRoomHandler=new Ei(g(e)),e._groupTipsHandler=new vi(g(e)),e._groupSystemNoticeHandler=new Ri(g(e)),e._groupMemberHandler=new Di(g(e)),e.groupMap=new Map,e._unjoinedAVChatRoomList=new Map,e._receiptDetailCompleteMap=new Map,e._onlineMemberCountMap=new Map,e._timeoutIDs=[],e.getIEmitInst().on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Xi(e){o(this,Xi),this._grpM=e,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function Zi(e){o(this,Zi),this._grpM=e,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getIEmitInst().on(Wo.PROFILE_UPDATED,this._onProfileUpdated,this)}function Qi(e){o(this,Qi),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(e)}function es(e){o(this,es),this._grpM=e,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this._seqSll=new li(200),this._IDSll=new li(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function ts(e){o(this,ts);var t=e.manager,n=e.groupID,i=e.onInit,s=e.onSuccess;e=e.onFail,this._n="Polling",this._manager=t,this._grpM=t._grpM,this._onInit=i,this._onSuccess=s,this._onFail=e,this._groupID=n,this._timeoutID=-1,this._isRunning=!1,this._proto=Kn.AV_POLLING}function ns(e){o(this,ns),this._grpM=e,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Wo.CLOUD_CONFIG,this._onCloudConfig,this)}function os(e){o(this,os),this._grpM=e,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Wo.CLOUD_CONFIG,this._onCloudConfig,this)}function is(e){o(this,is),this._grpM=e,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=Nn,this._pagingGetCostList=[],e.getIEmitInst().on(Wo.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function ss(e){o(this,ss),this._grpM=e,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function as(e){return o(this,as),(e=ai.call(this,e))._n="ConvModule",Zo.mixin(g(e)),e._msgListHandler=new Jo(g(e)),e._msgRemindHandler=new _i(g(e)),e._convGroupHandler=new fi(g(e)),e._sll=new li(100),e._pagingStatus=Nn,e._pagingTs=0,e._pagingStartIdx=0,e._pagingPinnedTs=0,e._pagingPinnedStartIdx=0,e._pagingConvIDMap=new Map,e._convIDFromUnreadDBMap=new Map,e._convMap=new Map,e._tmpGroupList=[],e._tmpGroupAtTipsList=[],e._peerReadTimeMap=new Map,e._completedMap=new Map,e._roamingMsgKeyAndTimeMap=new Map,e._remoteGroupReadSeqMap=new Map,e._convTotalUnreadCount=0,e._pagingGetCostList=[],e._convMapForDiff=new Map,e._partialUpdatedConvMap=new Map,e._everClearedMap=new Map,e._bPullOnInvite=!0,e._initListeners(),e}function rs(e){o(this,rs),this._convM=e,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=Nn}function cs(e){o(this,cs),this._convM=e,this._n="MsgRemindHandler"}function us(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];o(this,us),this.conversationID=e.conversationID||"",this.unreadCount=e.unreadCount||0,this.type=e.type||"",this.lastMessage=Qo(e.lastMessage,t,n),e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=e.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=e.isPinned||!1,this.messageRemindType=e.messageRemindType,this.markList=e.markList||[],this.customData=e.customData||"",this.conversationGroupList=e.conversationGroupList||[],this.draftText=e.draftText||"",this._initProfile(e),this.subType=this.groupProfile?this.groupProfile.type:""}function ls(e){o(this,ls),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(e)}function ds(e){o(this,ds),this.MAX_LENGTH=e,this.map=new Map}function ps(e){var t=this;o(this,ps),je(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||k.ALLOW_TYPE_ALLOW_ANY,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||k.FORBID_TYPE_NONE,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],je(e.profileCustomField)||e.profileCustomField.forEach((function(e){t.profileCustomField.push({key:e.key,value:e.value})})))}function hs(){return null}function gs(e){var t=e.get(12);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:Le()}}s(Ss,[{key:"_errorTolerantHandle",value:function(){ee||"undefined"!=typeof window&&this._canIUseCookies()||(this.getItem=hs,this.setItem=hs,this.removeItem=hs,this.clear=hs)}},{key:"onCheckTimer",value:function(e){e%20==0&&0!==this._storageQueue.size&&this._doFlush()}},{key:"_doFlush",value:function(){try{var e,t=S(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2),o=n[0],i=n[1];this._setStorageSync(this._getKey(o),i)}}catch(s){t.e(s)}finally{t.f()}this._storageQueue.clear()}catch(s){Pe.w("".concat(this._n,"._doFlush error:"),s)}}},{key:"_getPrefix",value:function(){var e=this._m.get(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(o){return Pe.w("".concat(this._n,".getItem error:"),o),{}}}},{key:"setItem",value:function(e,t){var n;2<arguments.length&&void 0!==arguments[2]&&arguments[2]?(n=3<arguments.length&&void 0!==arguments[3]&&!arguments[3]?e:this._getKey(e),this._setStorageSync(n,t)):this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{ee?ie.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Pe.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(o){Pe.w("".concat(this._n,".removeItem error:"),o)}}},{key:"getSize",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"b";try{var o={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(o,"leftSize",{enumerable:!0,get:function(){return o.limitSize-o.size}}),ee&&(o.limitSize=1024*ie.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(ee)ie.getStorageInfoSync().keys.forEach((function(e){o.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}));else if(this._canIUseCookies())for(var i in localStorage)localStorage.hasOwnProperty(i)&&(o.size+=localStorage.getItem(i).length+i.length);return this._convertUnit(o)}catch(s){Pe.w("".concat(this._n," error:"),s)}}},{key:"_convertUnit",value:function(e){var t,n={},o=e.unit;for(t in n.unit=o,e)"number"==typeof e[t]&&("kb"===o.toLowerCase()?n[t]=Math.round(e[t]/1024):"mb"===o.toLowerCase()?n[t]=Math.round(e[t]/1024/1024):n[t]=e[t]);return n}},{key:"_setStorageSync",value:function(e,t){ee?J?my.setStorageSync({key:e,data:t}):ie.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return ee?J?my.getStorageSync({key:e}).data:ie.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){ee?J?my.removeStorageSync({key:e}):ie.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return"undefined"!=typeof window&&navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._doFlush()}}]);var _s,fs=Ss,ms=(s(Es,[{key:"pushIn",value:function(e){Pe.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;Xe(e)&&0!==e.length&&(Pe.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,v(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),Es),vs=(r(Ts,wn),_s=f(Ts),s(Ts,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.get(13),n=t.getItem(this.TAG,!1);!je(n)&&Qe(n.forEach)&&(Pe.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),o=this.getCloudConfig("evt_rpt_sdkappid_bl"),i=this.getCloudConfig("evt_rpt_tinyid_wl");ht(e)||(this.MIN_THRESHOLD=Number(e)),ht(t)||(this.WAITING_TIME=Number(t)),ht(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),ht(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map((function(e){return Number(e)}))),ht(i)||(this.REPORT_TINYID_WHITELIST=i.split(","))}},{key:"pushIn",value:function(e){e instanceof ao&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=(o=this.get(12)).getSDKAppID(),o=o.getTinyID();return xt(this.REPORT_SDKAPPID_BLACKLIST,n)&&!Vt(this.REPORT_TINYID_WHITELIST,o)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e,n,o=this;this._reportBody.isEmpty()||(e=this._reportBody.getLogsInMemory(),0!==(n=this._filterLogs(e)).length?(n={header:gs(this),event:n},this.req({P:Kn.SSO_STAT,data:t({},n)}).then((function(){o._lastReportTime=Date.now()})).catch((function(t){Pe.w("".concat(o._n,"._report failed. error:"),t),o._lastReportTime=Date.now(),o._reportBody.backfill(e),o._reportBody.getLogsNumInMemory()>o.MAX_THRESHOLD&&o._flushAtOnce()}))):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),o="".concat(this._n,"._flushAtOnce");je(t)?(Pe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):((n=n.concat(t)).length>this.MAX_THRESHOLD&&(n=n.slice(0,this.MAX_THRESHOLD)),Pe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1))}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),Ts),ys="none",Is="online",Ms=(s(Cs,[{key:"_startRN",value:function(){var e,t=this;!ne||(e=this._m.get(18).getPlugin("chat-network-monitor"))&&(this._removeListener=e.addEventListener((function(e){var n=e.isConnected;e=e.type,t._networkType!==e&&t._onNetworkStatusChange({isConnected:void 0!==n&&n,networkType:e})})))}},{key:"start",value:function(){var e=this,t="".concat(this._n,".start");ee?(ie.getNetworkType({success:function(n){e._networkType=n.networkType||n.subtype||"",n.networkType===ys?Pe.w("".concat(t," no network, please check!")):Pe.i("".concat(t," networkType:").concat(n.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),ie.onNetworkStatusChange(this._mpNetworkStatusCallback)):oe&&(this._networkType=Is,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:Is})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:ys})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=(e=e.networkType,"".concat(this._n,"._onNetworkStatusChange")),o=!1,i="previous:".concat(this._networkType," current:").concat(e);t?(Pe.i("".concat(n," ").concat(i)),this._networkType!==e&&(o=!0,this._networkType=e,this._m.get(21).reConnect(!0))):this._networkType!==e&&(o=!0,this._networkType=e,Pe.w("".concat(n," no network, please check!")),this._m.get(21).offline()),o&&new ao("networkChange").setMessage("isConnected:".concat(t," ").concat(i)).end()}},{key:"isOnline",value:function(){return this._networkType!==ys}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),ee?null!==this._mpNetworkStatusCallback&&(ie.offNetworkStatusChange&&ie.offNetworkStatusChange(this._mpNetworkStatusCallback),this._mpNetworkStatusCallback=null):oe?(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null)):ne&&this._removeListener&&(this._removeListener(),this._removeListener=null)}}]),Cs);function Cs(e){o(this,Cs),this._m=e,this._networkType=Is,this._n="NetMonitorModule",this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null,this._removeListener=null,this._m.getIEmitInst().on(Wo.A2KEY_AND_TINYID_UPDATED,this._startRN,this)}function Ts(e){o(this,Ts),(e=_s.call(this,e))._n="EventStatModule",e.TAG="im-ssolog-event",e._reportBody=new ms,e.MIN_THRESHOLD=20,e.MAX_THRESHOLD=100,e.WAITING_TIME=6e4,e.REPORT_LEVEL=[4,5,6],e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._lastReportTime=Date.now();var t=e.getIEmitInst();return t.on(Wo.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,g(e)),t.on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Es(e){o(this,Es),this._n="SSOLogBody",this._report=[]}function Ss(e){o(this,Ss),this._m=e,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}function Ds(e,t){return e(t={exports:{}},t.exports),t.exports}var ks,Rs=Ds((function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,o,s,a){if("function"!=typeof o)throw new TypeError("The listener must be a function");return o=new i(o,s||e,a),s=n?n+t:t,e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],o]:e._events[s].push(o):(e._events[s]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function r(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),r.prototype.eventNames=function(){var e,o,i=[];if(0===this._eventsCount)return i;for(o in e=this._events)t.call(e,o)&&i.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},r.prototype.listeners=function(e){e=n?n+e:e;var t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var o=0,i=t.length,s=new Array(i);o<i;o++)s[o]=t[o].fn;return s},r.prototype.listenerCount=function(e){return e=n?n+e:e,(e=this._events[e])?e.fn?1:e.length:0},r.prototype.emit=function(e,t,o,i,s,a){var r=n?n+e:e;if(!this._events[r])return!1;var c,u=this._events[r],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,o),!0;case 4:return u.fn.call(u.context,t,o,i),!0;case 5:return u.fn.call(u.context,t,o,i,s),!0;case 6:return u.fn.call(u.context,t,o,i,s,a),!0}for(h=1,c=new Array(l-1);h<l;h++)c[h-1]=arguments[h];u.fn.apply(u.context,c)}else for(var d,p=u.length,h=0;h<p;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),l){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,o);break;case 4:u[h].fn.call(u[h].context,t,o,i);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[h].fn.apply(u[h].context,c)}return!0},r.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},r.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},r.prototype.removeListener=function(e,t,o,i){if(e=n?n+e:e,!this._events[e])return this;if(!t)return a(this,e),this;var s=this._events[e];if(s.fn)s.fn!==t||i&&!s.once||o&&s.context!==o||a(this,e);else{for(var r=0,c=[],u=s.length;r<u;r++)(s[r].fn!==t||i&&!s[r].once||o&&s[r].context!==o)&&c.push(s[r]);c.length?this._events[e]=1===c.length?c[0]:c:a(this,e)}return this},r.prototype.removeAllListeners=function(e){return e?(e=n?n+e:e,this._events[e]&&a(this,e)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,e.exports=r.EventEmitter=r})),Ls=["rich.my-imcloud.com","imrich.qcloud.com"],As=["requestSnapshotUrl"],Os=(r(ws,wn),ks=f(ws),s(ws,[{key:"_init",value:function(){this._fileDownloadProxy=this.getFileDownloadProxy(),this._authKey=this.getDowloadFileAuthKey();var e=this.get(18);this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=e.getPlugin(e=ee?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.warn("CosReplacement",e)):this.warn("PluginUndetected"))}},{key:"_onCloudConfig",value:function(){var e=this,t="".concat(this._n,"._onCloudConfig"),n=this.getCloudConfig("upload_size_limit"),o=this.getCloudConfig("simple_cos"),i=this.getCloudConfig("file_dn_list");if(Pe.l("".concat(t," uploadSizeLimit:").concat(n," simpleCos:").concat(o)),!ht(n))try{var s=JSON.parse(n);this.UPLOAD_SIZE_LIMIT={A:s.a?1048576*parseInt(s.a):this.UPLOAD_SIZE_LIMIT.A,F:s.f?1048576*parseInt(s.f):this.UPLOAD_SIZE_LIMIT.F,I:s.i?1048576*parseInt(s.i):this.UPLOAD_SIZE_LIMIT.I,V:s.v?1048576*parseInt(s.v):this.UPLOAD_SIZE_LIMIT.V}}catch(a){}if(ht(o)||(this.isSimpleCos="1"===o),!ht(i))try{JSON.parse(i).forEach((function(t){e._fileDNList.includes(t)||e._fileDNList.push(t)}))}catch(a){}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new ao("_getAuthorizationKey"),o=Math.ceil(Date.now()/1e3);this.req({P:Kn.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then((function(i){i=i.data;var s=(Pe.l("".concat(t," ok. data:"),i),i.expiredTime-o);n.setMessage("requestId:".concat(i.requestId," requestTime:").concat(o," expiredTime:").concat(i.expiredTime," diff:").concat(s,"s")).end(),!ee&&i.region&&(e.region=i.region),e.appid=i.appid,e.bucketName=i.bucketName,e.ciUrl=i.ciUrl,e.directory=i.directory,e.downloadUrl=i.downloadUrl,e.uploadUrl=i.uploadUrl,e.cosOptions={secretId:i.secretId,secretKey:i.secretKey,sessionToken:i.sessionToken,expiredTime:i.expiredTime},Pe.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(e){n.setError(e).end(),Pe.w("".concat(t," failed. error:"),e)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),o=Math.ceil(Date.now()/1e3),i=new ao("_getCosPreSigUrl"),s={uploadMethod:e.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:e.userID,conversationType:e.conversationType,uploadConfig:[{fileID:1,fileType:e.fileType,fileName:e.fileName}]},a=Kn.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(s={fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration},a=Kn.COS_PRE_SIG),this.req({P:a,data:s}).then((function(e){t.tryCount=0,e=e.data||{};var s,a,r=(Pe.l("".concat(n," ok. isSimpleCos:").concat(t.isSimpleCos," data:"),e),"");return r=t.isSimpleCos?(s=(a=e.preSig[0]).uploadUrl,a=a.fileKey,"uploadIP:".concat(e.uploadIP," uploadUrl:").concat(s," fileKey:").concat(a," cost:").concat(Jt(o))):"requestId:".concat(e.requestId," expiredTime:").concat(e.expiredTime," diff:").concat(e.expiredTime-o,"s"),i.setMessage(r).end(),e})).catch((function(o){return-1===o.code&&(o.code=Hn.COS_GET_SIG_FAIL),i.setError(o).end(),Pe.w("".concat(n," failed. error:"),o),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,kn({code:Hn.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=ee?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=ee?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"getFileDNList",value:function(){return this._fileDNList}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e._relayFlag)return Promise.resolve();var t=this.get(26);switch(e.type){case k.MSG_IMAGE:return t.addTotalCount(Zn),this._uploadImage(e);case k.MSG_FILE:return t.addTotalCount(Zn),this._uploadFile(e);case k.MSG_AUDIO:return t.addTotalCount(Zn),this._uploadAudio(e);case k.MSG_VIDEO:return t.addTotalCount(Zn),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,o=this.get(2),i=e.getElements()[0],s=o.getMessageOption(e.clientSequence);return this.doUploadImage({file:s.payload.file,to:s.to,message:e,onProgress:function(e){if(i.updatePercent(e),Qe(s.onProgress))try{s.onProgress(e)}catch(t){return kn({code:Hn.MSG_ONPROGRESS_ERR})}}}).then((function(o){var s=o.location,a=o.fileType,r=o.fileSize,c=o.width,u=o.height,l=o.smallImageUrl,d=o.smallImageWidth,p=o.smallImageHeight,h=o.largeImageUrl,g=o.largeImageWidth,_=o.largeImageHeight,f=o.imageInfoArray;o=n.isPrivateNetWork()?s:ut(s),i.updateImageFormat(a);var m,v,y={size:r,url:o,width:c,height:u};if(f&&0<f.length)for(var I=0;I<f.length;I++){var M=f[I];1===M.type?m=M:2===M.type?v=M:y=t(t({},y),M)}else v=l&&h?(m={url:l,width:d,height:p},{url:h,width:g,height:_}):(m=Ut({originUrl:o,originWidth:c,originHeight:u,min:198}),Ut({originUrl:o,originWidth:c,originHeight:u,min:720}));return i.updateImageInfoArray([t({},y),t({},v),t({},m)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(o.updatePercent(e),Qe(i.onProgress))try{i.onProgress(e)}catch(t){return kn({code:Hn.MSG_ONPROGRESS_ERR})}}}).then((function(n){var i=n=n.location;return t.isPrivateNetWork()||(i=ho(i=ut(n),t._fileDownloadProxy,t._authKey,t._fileDNList)),o.updateFileUrl(i),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(o.updatePercent(e),Qe(i.onProgress))try{i.onProgress(e)}catch(t){return kn({code:Hn.MSG_ONPROGRESS_ERR})}}}).then((function(n){return n=n.location,n=t.isPrivateNetWork()?n:ut(n),o.updateAudioUrl(n),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(o.updatePercent(e),Qe(i.onProgress))try{i.onProgress(e)}catch(t){return kn({code:Hn.MSG_ONPROGRESS_ERR})}}}).then((function(n){var i=n.location;return n=n.snapshotInfo,i=t.isPrivateNetWork()?i:ut(i),o.updateVideoUrl(i),je(n)||o.updateSnapshotInfo(n),e}))}},{key:"_checkSizeError",value:function(e){var t="";return"A"===e?t="audio":"I"===e?t="image":"V"===e?t="video":"F"===e&&(t="file"),kn({code:Hn["MSG_".concat(e,"_SIZE_LIMIT")],message:this.getErrMsg("UploadSizeLimit",t,"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576,"MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file||this._isEmptyFileList(e.file.files))return kn({code:Hn.MSG_I_SELECT_F_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;if(!0!==(n=this._checkImageSize(e.file)))return n;var o=null;return this._setUploadFileType(1),this.uploadByCOS(e).then((function(n){if(o=n,t.isPrivateNetWork())return Ot(s);if(Xe(o.imageInfoArray)){var i=o.imageInfoArray.find((function(e){return 3===e.type}));if(i)return i}if(ne)return{width:e.file.width,height:e.file.height};var s=ut(n.location);return t.COSSDK?Ot(s):Ot(s=ho(s,t._fileDownloadProxy,t._authKey,t._fileDNList))})).then((function(e){return o.width=e.width,o.height=e.height,Promise.resolve(o)}))}},{key:"_checkImageType",value:function(e){var t="";return t=ee?e.url.slice(e.url.lastIndexOf(".")+1):ne?e.type.split("/")[1]:e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),0<=ri.indexOf(t.toLowerCase())||kn({code:Hn.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){return 0===(e=(ee||ne?e:e.files[0]).size)?kn({code:Hn.MSG_F_IS_EMPTY}):e<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(e){return!e.file||this._isEmptyFileList(e.file.files)?kn({code:Hn.MSG_F_SELECT_F_FIRST}):e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):0===e.file.files[0].size?kn({code:Hn.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e))}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):0===e.file.videoFile.size?kn({code:Hn.MSG_F_IS_EMPTY}):-1===ci.indexOf(e.file.videoFile.type)?kn({code:Hn.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),ee||ne?this.handleVideoUpload(t(t({},e),{},{file:e.file.videoFile})):oe?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,o){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){o(new Bn({code:Hn.MSG_V_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):0===e.file.size?kn({code:Hn.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):kn({code:Hn.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!Qe(this._cosUploadMethod))return this.warn("PluginUndetected"),kn({code:Hn.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new ao("upload"),o="".concat(this._n,".uploadByCOS"),i=Date.now(),s=this._getFile(e);return new Promise((function(a,r){var c=ee?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||Xe(c.files)&&c.files[0].error)return d=new Bn({code:Hn.MSG_F_UPLOAD_FAIL}),n.setError(d).end(),Pe.l("".concat(o," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&t._getAuthorizationKey(),void r(d);l.fileName=s.name,l.fileSize=s.size,l.fileType=s.type.slice(s.type.indexOf("/")+1).toLowerCase(),l.location=(ee?c:c.files[0].data).Location;var d=Date.now()-i,p=(c=u._formatFileSize(s.size),u._formatSpeed(1e3*s.size/d));return c="size:".concat(c," time:").concat(d,"ms speed:").concat(p),(Pe.l("".concat(o," success. name:").concat(s.name," ").concat(c)),a(l),p=t.get(26)).addCost(Zn,d),p.addFileSize(Zn,s.size),void n.setMessage(c).end()}l=new Bn({code:Hn.MSG_F_UPLOAD_FAIL}),n.setError(l).end(),Pe.w("".concat(o," failed. error:"),e),403===e.statusCode&&t._getAuthorizationKey(),r(l)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),o=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(i,s){var a=new ao("upload"),r=e.requestSnapshotUrl,c=void 0===r?void 0:r,u=h(e,As),l=Date.now();t._cosUploadMethod(u,(function(r,d){var p,h,g;return r||403===d.statusCode?(a.setError(new Bn(r)).end(),h={HttpStatusCode:9999,CostTime:Jt(l,!1),error:r,url:e.url},d.data&&d.data.uploadIP&&(h.uploadIP=d.data.uploadIP),t._uploadSSOLog(h),Pe.l("".concat(n," failed, error:"),r),void s(new Bn({code:Hn.MSG_F_UPLOAD_FAIL}))):(p=Object.create(null),h=d.data.location||"",t.isPrivateNetWork()||0!==h.indexOf("https://")&&0!==h.indexOf("http://")||(h=h.split("//")[1]),p.fileName=o.name,p.fileSize=o.size,p.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),p.location=h,r=Jt(l,!1),h=t._formatFileSize(o.size),g=t._formatSpeed(1e3*o.size/r),h="size:".concat(h," time:").concat(r,"ms speed:").concat(g," res:").concat(JSON.stringify(d.data)),Pe.l("".concat(n," ok. name:").concat(o.name," ").concat(h)),a.setMessage(h).end(),g={HttpStatusCode:d.statusCode,FileSize:o.size,CostTime:r,url:e.url},d.data&&d.data.uploadIP&&(g.uploadIP=d.data.uploadIP),t._uploadSSOLog(g),(h=t.get(26)).addCost(Zn,r),h.addFileSize(Zn,o.size),g=[],u.thumbUrl&&u.largeUrl&&g.push.apply(g,[t._getSmallImageInfoByUrl(u.thumbUrl,p),t._getLargeImageInfoByUrl(u.largeUrl,p)]),1===t.uploadFileType&&t.isSimpleCos&&!t.isPrivateNetWork()&&(g.push(t._getImageInfoArray(u.downloadUrl,p)),d.data.uploadIP&&g.push(t._getDownloadIP(u.downloadUrl.split("//")[1].split("/")[0],p))),c&&g.push(t._getSnapshotInfoByUrl(c,p)),0<g.length?Promise.all(g).then((function(){i(p)})):void i(p))}))}))}))}},{key:"_getDownloadIP",value:function(e,t){var n="".concat(this._n,"._getDownloadIP"),o=Date.now();return this.req({P:Kn.GET_IP,data:{domainName:e}}).then((function(e){var i;e.data&&e.data.ip&&(Pe.l("".concat(n," ok. downloadIP:").concat(e.data.ip," cost:").concat(Jt(o))),(i=t.location.split("/"))[0]=e.data.ip,t.location=i.join("/"))})).catch((function(e){}))}},{key:"_getImageInfoArray",value:function(e,t){var n=this,o="".concat(this._n,"._getImageInfoArray"),i=Date.now();return this.req({P:Kn.GET_IMAGE_INFO,data:{imageUrl:e}}).then((function(e){return e=e.data||{},Pe.l("".concat(o," ok. data: ").concat(JSON.stringify(e)," cost:").concat(Jt(i))),t.imageInfoArray=e.imageInfoArray,e})).catch((function(o){t.imageInfoArray=void 0,n._uploadSSOLog({HttpStatusCode:1e4,CostTime:Jt(i,!1),url:e})}))}},{key:"_uploadSSOLog",value:function(e){var t,n;this.isSimpleCos&&((t=new ao).setEventType(18),e.error&&t.setError(new Bn(e.error)),n="HttpStatusCode:".concat(e.HttpStatusCode,"|CosRequestId:").concat(e.CosRequestId||"","|")+"FileAlreadyExist:".concat(e.FileAlreadyExist||0,"|FileSize:").concat(e.FileSize||0,"|CostTime:").concat(e.CostTime),e.uploadIP&&(n+="|FinalIP:".concat(e.uploadIP)),t.setMessage("OK").setMoreMessage(e.url).setExtension(n).end())}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.get(12).getFileUploadProxy(),n=e;return t?e.replace(/^https:\/\/[^/]+/,t):n}},{key:"_getFile",value:function(e){return Xe(e.file.files)||et(e.file.files)?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Ft(e/1024,1)+"KB/s":Ft(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=(n=t.name).slice(n.lastIndexOf("."));return n=this._genFileName("".concat(at(999999)).concat(n)),{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Pe.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name);return t=t.url,{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:t,onProgress:function(t){if(Pe.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Pe.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t,n=this,o="",i="",s=0,a=this._getFile(e);return s=ee||ne?(o=e.message.type===k.MSG_FILE?(t=(t=a.name).slice(t.lastIndexOf(".")),this._genFileName("".concat(at(999999)).concat(t))):this._genFileName(a.name),i=a.url,1):(t=(t=a.name).slice(t.lastIndexOf(".")),o=this._genFileName("".concat(at(999999)).concat(t)),i=a,0),this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:o,uploadMethod:s,duration:this.duration,userID:e.message.from,conversationType:kt(e.message.conversationID)?1:2}).then((function(t){var s=(l=n.isSimpleCos?t.preSig[0]:t).uploadUrl,a=l.downloadUrl,r=void 0===(r=l.requestSnapshotUrl)?void 0:r,c=l.thumbUrl,u=l.largeUrl,l=l.fileKey;return t=void 0===(t=t.uploadIP)?"":t,{url:n._getRawOrUploadProxyUrl(s),fileType:n.uploadFileType,fileName:o,resources:i,downloadUrl:a,requestSnapshotUrl:r,thumbUrl:c,largeUrl:u,fileKey:l,uploadIP:!n.isPrivateNetWork()&&t,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Pe.w("onProgress callback error:",n),Pe.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(Nt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,o="_getSnapshotInfoByUrl",i=new ao(o);return this.req({P:Kn.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(at(99999)),requestSnapshotUrl:e}}).then((function(e){if(e=(e.data||{}).snapshotUrl,Pe.l("".concat(n._n,".").concat(o," ok. snapshotUrl:").concat(e)),i.setMessage("snapshotUrl:".concat(e)).end(),je(e))return{};var s=ho(e,n._fileDownloadProxy,n._authKey,n._fileDNList);return Ot(s).then((function(e){t.snapshotInfo={snapshotUrl:s,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Pe.w("".concat(n._n,".").concat(o," failed. error:"),e),i.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return Ot(ho(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return Ot(ho(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"_isEmptyFileList",value:function(e){return!(!et(e)||0!==e.length)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset"))}}]),ws),Ns=["downloadKey","pbDownloadKey","messageList"],Ps=(s(Gs,[{key:"uploadMergerMessage",value:function(e,t){var n="".concat(this._n,".").concat("uploadMergerMessage"),o=(Pe.d("".concat(n," message:"),e,"messageBytes:".concat(t)),e=JSON.parse(JSON.stringify(e.payload)).messageList).length,i=this._msgM.get(17).getFileDNList(),s=new ao("uploadMergerMessage");return e.forEach((function(e){go(e.messageBody[0].type,e.messageBody,i)})),this._msgM.req({P:Kn.UPLOAD_MERGER_MSG,data:{messageList:e}}).then((function(e){Pe.d("".concat(n," ok. response:"),e.data);var i={pbDownloadKey:i=(e=e.data).pbDownloadKey,downloadKey:e=e.downloadKey,messageNumber:o};return s.setMessage("".concat(o,"-").concat(t,"-").concat(e)).end(),i})).catch((function(e){throw Pe.w("".concat(n," failed. error:"),e),s.setError(e).end(),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,o="".concat(this._n,".").concat("downloadMergerMessage"),i=(Pe.d("".concat(o," message:"),e),e.payload.downloadKey),s=this._msgM.getFileDownloadProxy(),a=this._msgM.getDowloadFileAuthKey(),r=new ao("downloadMergerMessage");return r.setMessage("downloadKey:".concat(i)),this._msgM.req({P:Kn.DOWNLOAD_MERGER_MSG,data:{downloadKey:i}}).then((function(i){Pe.d("".concat(o," ok. response:"),i.data);var c,u,l=n._msgM.get(17).getFileDNList();return Qe(e.clearElement)?((c=e.payload).downloadKey,c.pbDownloadKey,c.messageList,c=h(c,Ns),e.clearElement(),e.setElement({type:e.type,content:t({messageList:i.data.messageList},c)},s,a,l)):(u=[],i.data.messageList.forEach((function(e){je(e)||(e=new Ro(e,s,a,l),u.push(e))})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""),r.end(),e})).catch((function(e){throw Pe.w("".concat(o," failed. key:").concat(i," error:"),e),r.setError(e).end(),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===k.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var o=null,i=(t&&(t.offlinePushInfo&&(o=t.offlinePushInfo),!0===t.onlineUserOnly&&(o?o.disablePush=!0:o={disablePush:!0})),[]),s=($e(t)&&$e(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck")),""),a=(pt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(s=e.cloudCustomData),n.pbDownloadKey),r=n.downloadKey,c=(n=n.messageNumber,(l=e.payload).title),u=l.abstractList,l=l.compatibleText,d=(d=this._msgM.get(6))&&d.isOnlineMessage(e,t)?0:void 0;return{P:Kn.SEND_C2C_MSG,data:{fromAccount:this._msgM.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:a,downloadKey:r,title:c,abstractList:u,compatibleText:l,messageNumber:n}}],cloudCustomData:s,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:d,offlinePushInfo:Ko(o),messageControlInfo:0!==d?i:void 0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var o=null,i=(t&&t.offlinePushInfo&&(o=t.offlinePushInfo),[]),s=($e(t)&&$e(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck")),""),a=(pt(e.cloudCustomData)&&0<e.cloudCustomData.length&&(s=e.cloudCustomData),n.pbDownloadKey),r=n.downloadKey,c=(n=n.messageNumber,(l=e.payload).title),u=l.abstractList,l=l.compatibleText,d=this._msgM.get(7);return t=d&&d.isOnlineMessage(e,t)?1:0,{P:Kn.SEND_GRP_MSG,data:{fromAccount:this._msgM.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:a,downloadKey:r,title:c,abstractList:u,compatibleText:l,messageNumber:n}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:s,onlineOnlyFlag:t,offlinePushInfo:Ko(o),clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||d.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0==t?i:void 0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0}}}}]),Gs),bs={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Us=[Hn.MSG_ONPROGRESS_ERR,Hn.MSG_I_SELECT_F_FIRST,Hn.MSG_I_TYPES_LIMIT,Hn.MSG_F_IS_EMPTY,Hn.MSG_I_SIZE_LIMIT,Hn.MSG_F_SELECT_F_FIRST,Hn.MSG_F_SIZE_LIMIT,Hn.MSG_V_SIZE_LIMIT,Hn.MSG_V_TYPES_LIMIT,Hn.MSG_A_UPLOAD_FAIL,Hn.MSG_A_SIZE_LIMIT,Hn.COS_UNDETECTED];function Gs(e){o(this,Gs),this._n="MergerMessageHandler",this._msgM=e}function ws(e){o(this,ws),(e=ks.call(this,e))._n="UploadModule",e.TIMUploadPlugin=null,e.timUploadPlugin=null,e.COSSDK=null,e._cosUploadMethod=null,e.expiredTimeLimit=600,e.appid=0,e.bucketName="",e.ciUrl="",e.directory="",e.downloadUrl="",e.uploadUrl="",e.region="ap-shanghai",e.cos=null,e.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},e.uploadFileType="",e.duration=900,e.tryCount=0,e.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},e.isSimpleCos=!1,e._fileDownloadProxy="",e._authKey="",e._fileDNList=Ls;var t=e.getIEmitInst();return t.on(Wo.A2KEY_AND_TINYID_UPDATED,e._init,g(e)),t.on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Fs(e){var t=!1;return Object.values(bs).includes(e)&&(t=!0),120001<=e&&e<=13e4||10100<=e&&e<=10200||t}r(oa,wn),js=f(oa),s(oa,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new Oo(e));return e=pt(e.payload)?e.payload:e.payload.text,e=new ro({text:e}),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new Oo(e));if(ee){if(ze(i=e.payload.file))return void this.warn("FileUnsupportedInMP","createImageMessage");var o=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,i={url:o,name:o.slice(o.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:o.slice(o.lastIndexOf(".")+1).toLowerCase()};e.payload.file=i}else ne?(i={url:(o=e.payload.file).uri,name:o.fileName,size:o.fileSize||1,type:o.type,width:o.width,height:o.height},e.payload.file=i):oe&&(ze(e.payload.file)?(o=e.payload.file,e.payload.file={files:[o]}):$e(e.payload.file)&&"undefined"!=typeof uni&&(i=e.payload.file.tempFiles[0],e.payload.file={files:[i]}));return o=new mo({imageFormat:be.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),i=this._getNickAndAvatarByUserID(t),n.setElement(o),n.setNickAndAvatar(i),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file,n=(ee&&(n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()},e.payload.file=n),ne&&(n={url:t.uri,name:t.uri.slice(t.uri.lastIndexOf("/")+1),size:t.fileSize||1,second:Math.floor(t.duration/1e3),type:t.uri.slice(t.uri.lastIndexOf(".")+1).toLowerCase()},e.payload.file=n,je(t.uri)&&this.warn("VoiceFileInRN")),this.getMyUserID()),o=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new Oo(e));return t=new yo({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size||1,url:t.tempFilePath||t.uri,uuid:this._generateUUID(e.payload.file)}),n=this._getNickAndAvatarByUserID(n),o.setElement(t),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0,{});if(ee){if(J)return void this.warn("VideoUnsupportedInAlipay");if(ze(e.payload.file))return void this.warn("FileUnsupportedInMP","createVideoMessage");var o=e.payload.file;Xe(o.tempFiles)&&(o=o.tempFiles[0]),n.url=o.tempFilePath,n.name=o.tempFilePath.slice(o.tempFilePath.lastIndexOf("/")+1),n.size=o.size||1,n.second=o.duration||0,n.type=o.tempFilePath.slice(o.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else ne?(o=e.payload.file,n.url=o.uri,n.name=o.fileName,n.size=o.fileSize||1,n.second=o.duration||0,n.type=o.type.split("/")[1]):oe&&(ze(e.payload.file)?(o=e.payload.file,e.payload.file.files=[o]):$e(e.payload.file)&&"undefined"!=typeof uni&&(o=e.payload.file.tempFile,e.payload.file.files=[o]),o=e.payload.file,n.url=window.URL.createObjectURL(o.files[0]),n.name=o.files[0].name,n.size=o.files[0].size||1,n.second=o.files[0].duration||0,n.type=o.files[0].type.split("/")[1]);return e.payload.file.videoFile=n,o=new Oo(e),n=new Do({videoFormat:n.type,videoSecond:Ft(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),t=this._getNickAndAvatarByUserID(t),o.setElement(n),o.setNickAndAvatar(t),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new Oo(e));return e=new So({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new Oo(e));return e=new vo(e.payload),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),t=this._getNickAndAvatarByUserID(t),new Oo(e));return e=new Lo(e.payload),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n.setRelayFlag(!0),n}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,o=e.priority,i=e.payload,s=e.needReadReceipt,a=e.receiverList;if(!Xe(i._elements))return kn({code:Hn.MSG_FORWARD_INVALID_ELEMENTS});var r=this.getMyUserID(),c=this._getNickAndAvatarByUserID(r);return i.type===k.MSG_GRP_TIP?kn({code:Hn.MSG_FORWARD_TYPE_INVALID}):(n={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:o,isPlaceMessage:0,status:Ln,currentUser:r,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||i.cloudCustomData||"",needReadReceipt:s,receiverList:a,isSupportExtension:e.isSupportExtension||!1},(t=new Oo(n)).setElement(i._elements[0]),t.setNickAndAvatar(c),t.setNameCard(this._getNameCardByGroupID(i)),t.setRelayFlag(!0),t)}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(ee){if(!j&&!Y&&!X)return;var n=ie.getSystemInfoSync().SDKVersion;if(j&&bt(n,"2.5.0")<0)return void this.warn("WXChooseMessageFile");if(Y&&bt(n,"1.18.0")<0)return void this.warn("QQChooseMessageFile")}oe||X?ze(e.payload.file)?(n=e.payload.file,e.payload.file={files:[n]}):$e(e.payload.file)&&"undefined"!=typeof uni&&(i=(n=e.payload.file).tempFiles,n=n.files,o=null,Xe(i)?o=i[0]:Xe(n)&&(o=n[0]),e.payload.file={files:[o]}):j||Y?(n=t(t({},(i=e.payload.file.tempFiles)[0]),{},{url:i[0].path}),e.payload.file={files:[n]}):ne&&(i=t(t({},o=e.payload.file),{},{url:o.uri}),e.payload.file={files:[i]}),n=this.getMyUserID();var o=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new Oo(e)),i=new Eo({uuid:this._generateUUID(e.payload.file),file:e.payload.file});return n=this._getNickAndAvatarByUserID(n),o.setElement(i),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new Oo(e));return e=new ko(e.payload),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onNoModule",value:function(){return kn({code:Hn.NO_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.get(29).filterMessage(e,t))return e.hasRiskContent=!0,this._onSendMessageFailed(e,new Bn({code:Hn.PROFANITY_FOUND}));var o=null;if(e.conversationType===k.CONV_C2C)o=this.get(6);else{if(e.conversationType!==k.CONV_GROUP)return kn({code:Hn.MSG_INVALID_CONV_TYPE});o=this.get(7)}if(!o)return this._onNoModule();var i,s="".concat(this._n,".sendMessageInstance"),a=this.get(11),r=o.isOnlineMessage(e,t);return this.get(17).upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===Xn&&n.get(26).addSuccessCount(Zn),n._guardForGroup(e).then((function(){if(!e.isSendable())return kn({code:Hn.MSG_F_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var s=function(e){var t="utf-8";oe&&document&&(t=document.charset.toLowerCase());var n,o=0,i=e.length;if("utf-8"===t||"utf8"===t)for(var s=0;s<i;s++)(n=e.codePointAt(s))<=127?o+=1:n<=2047?o+=2:n<=65535?o+=3:(o+=4,s++);else if("utf-16"===t||"utf16"===t)for(var a=0;a<i;a++)(n=e.codePointAt(a))<=65535?o+=2:(o+=4,a++);else o=e.replace(/[^\x00-\xff]/g,"aa").length;return o}(JSON.stringify(e));return e.type===k.MSG_MERGER&&11264<s?n._mergerMessageHandler.uploadMergerMessage(e,s).then((function(o){return o=n._mergerMessageHandler.createMergerMessagePack(e,t,o),n.req(o)})):(a.setMessageRandom(e),o.sendMessage(e,t))})).then((function(o){var c,u=(o=o.data).time,l=o.sequence,d=o.readReceiptCode;return o=o.messageDropReason,We(d)&&0!==d&&(new ao("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(l," readReceiptCode:").concat(d)).end(),Pe.w("".concat(s," readReceiptCode:").concat(d," message:").concat(n.getErrMsg(d)))),o&&(d=new ao("messageDropReason"),o="from:".concat(e.from," to:").concat(e.to," sequence:").concat(l," messageDropReason:").concat(o),d.setMessage(o).end(),Pe.w("".concat(s," ").concat(o))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence),!0===e.isResend&&(c=a.findMessage(e.ID))&&(Pe.l("".concat(s," resend ok. ID:").concat(c.ID)),a.deleteLocalMessage(c)),e.status=An,e.time=u,d=!1,e.conversationType===k.CONV_GROUP?e.sequence=l:e.conversationType!==k.CONV_C2C||(o=a.getLatestMessageSentByMe(e.conversationID))&&(c=o.nick,u=o.avatar,c===e.nick&&u===e.avatar||(d=!0)),d&&a.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),!0===r?e._onlineOnlyFlag=!0:(a.appendToMessageList(e),l=e,$e(t)&&$e(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,l=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0)),o=e.conversationType,Dt(e.to)&&(o=k.CONV_TOPIC,n.get(10).onMessageSent({groupID:qt(e.to),topicID:e.to,lastMessage:l})),a.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:o,subType:e.conversationSubType,lastMessage:l}]})),e._relayFlag||"TIMImageElem"!==e.type||Gt(e.payload.imageInfoArray),Sn({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t,r)}))}},{key:"_guardForGroup",value:function(e){if(e.conversationType!==k.CONV_GROUP)return Promise.resolve();var t=this.get(7);if(!t)return this._onNoModule();if(St({groupID:e.to})){var n=t.getLocalGroupProfile(e.to);if(n&&n.isSupportTopic)return kn({code:Hn.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return t.guardForAVChatRoom(e)}},{key:"_onSendMessageFailed",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o="".concat(this._n,"._onSendMessageFailed"),i=(e.status=On,80001!==t.code&&80004!==t.code||(e.hasRiskContent=!0),this.get(11)),s=(i.deleteMessageRandom(e),10100<=t.code&&t.code<=10200||120001<=t.code&&t.code<=13e4);return n||s||!0===i.appendToMessageList(e)&&Pe.l("".concat(o," message stored, ID:").concat(e.ID)),this._addSendMessageFailCountOnUser(e,t),n=new ao("sendMessage"),s="head.seq:".concat(t.data.headSeq," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to),oe&&("connection"in navigator&&(i=navigator.connection,s+=" downlink:".concat(i.downlink," effectiveType:").concat(i.effectiveType," rtt:").concat(i.rtt)),"memory"in window.performance&&(i=window.performance.memory,s+=" usedJSHeapSize:".concat(i.usedJSHeapSize," totalJSHeapSize:").concat(i.totalJSHeapSize," jsHeapSizeLimit:").concat(i.jsHeapSizeLimit))),n.setMessage(s).setError(t).end(),Pe.e("".concat(o," ").concat(s," error:"),t),kn(new Bn({code:t&&t.code?t.code:Hn.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([k.MSG_IMAGE,k.MSG_AUDIO,k.MSG_VIDEO,k.MSG_FILE].includes(e.type))return Xn;if(e.conversationType===k.CONV_C2C)return Wn;if(e.conversationType===k.CONV_GROUP){var t=this.get(7);if(t&&(t=t.getLocalGroupProfile(e.to)))return Et(e=t.type)?$n:Jn}}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n;(e=this._getSendMessageSpecifiedKey(e))&&((n=this.get(26)).addSuccessCount(e),n.addCost(e,Jt(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){t=void 0===(t=t.code)?-1:t;var n,o=this.get(26);(e=this._getSendMessageSpecifiedKey(e))===Xn&&(n=!1,n=!!Us.includes(t)||n)?o.addFailedCountOfUserSide(Zn):Fs(t)&&e&&o.addFailedCountOfUserSide(e)}},{key:"resendMessage",value:function(e,t){return e.isResend=!0,e.status=Ln,this.sendMessageInstance(e,t)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===k.CONV_C2C?n=this.get(6):e.conversationType===k.CONV_GROUP&&(n=this.get(7)),!n)return this._onNoModule();var o=new ao("revokeMessage"),i=(o.setMessage("type:".concat(e.type," from:").concat(e.from," to:").concat(e.to)),"".concat(this._n,".").concat("revokeMessage"));return n.revokeMessage(e).then((function(n){return je(n=n.data.recallRetList)||0===n[0].retCode?(Pe.i("".concat(i," ok. ID:").concat(e.ID)),e.isRevoked=!0,o.end(),t.get(11).onMessageRevoked([e]),Sn({message:e})):(n=new Bn({code:n[0].retCode,data:{message:e}}),o.setCode(n.code).setMoreMessage(n.message).end(),kn(n))})).catch((function(t){o.setError(t).end();var n=new Bn({code:t&&t.code?t.code:Hn.MSG_REVOKE_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}});return Pe.w("".concat(i," failed. error:"),t),kn(n)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,o=e[0],i=o.conversationID,s="",a=[],r=[];if(o.conversationType===k.CONV_C2C)n=this.get(6),s=i.replace(k.CONV_C2C,""),e.forEach((function(e){e&&e.status===An&&e.conversationID===i&&(e._onlineOnlyFlag||a.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),r.push(e))}));else if(o.conversationType===k.CONV_GROUP)n=this.get(7),s=i.replace(k.CONV_GROUP,""),e.forEach((function(e){e&&e.status===An&&e.conversationID===i&&(e._onlineOnlyFlag||a.push("".concat(e.sequence)),r.push(e))}));else if(o.conversationType===k.CONV_SYSTEM)return kn({code:Hn.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!n)return this._onNoModule();if(0===a.length)return this._onMessageDeleted(r);30<a.length&&(a=a.slice(0,30),r=r.slice(0,30));var c=new ao("deleteMessage"),u=(c.setMessage("to:".concat(s," count:").concat(a.length)),"".concat(this._n,".").concat("deleteMessage"));return n.deleteMessage({to:s,keyList:a}).then((function(e){return c.end(),Pe.i("".concat(u," ok")),t._onMessageDeleted(r)})).catch((function(e){return c.setError(e).end(),Pe.w("".concat(u," failed. error:"),e),kn(e=new Bn({code:e&&e.code?e.code:Hn.MSG_DELETE_FAIL,message:e&&e.message?e.message:void 0}))}))}},{key:"_onMessageDeleted",value:function(e){return this.get(11).onMessageDeleted(e),Dn({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),o=e.sourceTextList,i=e.sourceLanguage,s=(e=e.targetLanguage,new ao("translateText"));return s.setMessage("sourceLanguage:".concat(i," targetLanguage:").concat(e)),this.req({P:Kn.TRANSLATE_TEXT,data:{sourceTextList:o,source:i||"auto",target:e,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var o=(e=e.data).error,i=e.requestID;if(e=e.translatedTextList,0===o.code)return s.end(),Pe.i("".concat(n," ok. requestID:").concat(i)),Sn({translatedTextList:e});throw t(t({},o),{},{requestID:i})})).catch((function(e){return s.setCode(e.code).setMoreMessage(e.requestID).end(),Pe.w("".concat(n," failed. error:"),e),kn({code:Hn.TRANSLATE_TEXT_FAIL})}))}},{key:"convertVoiceToText",value:function(e){var n=e.message,o=(e=e.language,n.payload.url);if(!(n.from===this.getMyUserID()&&"out"===n.flow&&(o=n.payload.remoteAudioUrl),n=/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/).test(o))return kn({code:Hn.UNSUPPORTED_VOICE_FORMAT});n=n.exec(o)[1]||"mp3";var i="16k_zh-PY",s=(e?"zh (cmn-Hans-CN)"===e?i="16k_zh":"en-US"===e?i="16k_en":"yue-Hant-HK"===e?i="16k_yue":"ja-JP"===e&&(i="16k_ja"):i="16k_zh-PY",e="serviceType:".concat(i," url:").concat(o),"".concat(this._n,".").concat("convertVoiceToText")),a=(Pe.i("".concat(s," ").concat(e)),new ao("convertVoiceToText"));return a.setMessage(e),this.req({P:Kn.VOICE_TO_TEXT,data:{url:o,language:i,SDKAppID:this.getSDKAppID(),format:n}}).then((function(e){var n=(e=e.data).error,o=e.requestID;if(e=e.result,0===n.code)return a.end(),Pe.i("".concat(s," ok. requestID:").concat(o)),Sn({result:e});throw t(t({},n),{},{requestID:o})})).catch((function(e){return a.setCode(e.code).setMoreMessage(e.requestID||"").end(),Pe.w("".concat(s," failed. error:"),e),kn({code:Hn.VOICE_TO_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this;if(!1===this.get(29).filterMessage(e))return e.hasRiskContent=!0,kn({code:Hn.PROFANITY_FOUND,data:{message:e}});var n=null,o=e.conversationType,i=e.to;if(o===k.CONV_C2C)n=this.get(6);else if(o===k.CONV_GROUP){if(!(n=this.get(7)))return this._onNoModule();if(n.isMessageFromOrToAVChatroom(i))return kn({code:Hn.MSG_MODIFY_DISABLED_IN_AV,data:{message:e}})}var s=new ao("modifyMessage"),a=(s.setMessage("to:".concat(i)),"".concat(this._n,".modifyRemoteMessage"));return n.modifyRemoteMessage(e).then((function(n){return s.end(),Pe.i("".concat(a," ok")),Sn({message:n=t._onModifyRemoteMessageResp(e,n.data)})})).catch((function(n){var o;return s.setCode(n.code).setMoreMessage(n.message).end(),Pe.w("".concat(a," failed. error:"),n),20027===n.code?(o=t._onModifyRemoteMessageResp(e,n.data),kn({code:Hn.MSG_MODIFY_CONFLICT,data:{message:o}})):kn({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Pe.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,o=e.from,i=e.to,s=e.random,a=e.sequence,r=(e=e.time,t.elements),c=t.messageVersion;return t=void 0===(t=t.cloudCustomData)?"":t,this.get(11).onMessageModified({conversationType:n,from:o,to:i,time:e,random:s,sequence:a,elements:r,cloudCustomData:t,messageVersion:c})}},{key:"_generateUUID",value:function(e){var t=this.get(12);return t="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(rt()),(e=(e=e.name||e.value||e.url||e.tempFilePath)&&e.slice(e.lastIndexOf(".")+1))?"".concat(t,".").concat(e):t}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.get(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===k.CONV_GROUP){var t=this.get(7);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]);var xs,Vs,qs,Bs,Hs,js,Ks=oa,Ys=(r(na,wn),Hs=f(na),s(na,[{key:"onMsgExtNotify",value:function(e){var t=this,n=(e=e.dataList).messageInfo,o=e.operateType,i=e.operateResultList,s=e.tinyID,a=(e=e.globalSequence,n.clientTime),r=(n=n.random,"".concat(s,"-").concat(a,"-").concat(n)),c=[],u=[],l=(Pe.l("".concat(this._n,".onMsgExtNotify messageID:").concat(r," operateType:").concat(o," globalSequence:").concat(e)),this._updateGlobalSeq(r,e),!1),d=!1;i.forEach((function(e){var n=void 0===(n=e.extensions)?[]:n,i=e.clearSequence;1===o?(l=!0,n.forEach((function(e){c.push({key:e.key,value:e.value})})),t._updateLocalExt(r,n)):2===o?(d=!0,n.forEach((function(e){u.push(e.key)})),t._updateLocalExt(r,n)):3===o&&(d=!0,t._hasLocalExt(r)&&t._getLocalExt(r).forEach((function(e,t){e.seq<=i&&!je(e.value)&&u.push(t)})),t._clearLocalExt(r,i))})),l&&this.emitOEvt(D.MESSAGE_EXTENSIONS_UPDATED,{messageID:r,extensions:c}),d&&this.emitOEvt(D.MESSAGE_EXTENSIONS_DELETED,{messageID:r,keyList:u})}},{key:"setMessageExtensions",value:function(e,t){var n="setMessageExtensions";if(!this.canIUse(w.MSG_EXT))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.ID,s=e.conversationID,a=e.sequence,r=e.time,c=v(t),u=(20<t.length&&(c=t.slice(0,20),Pe.w("".concat(o,". the length of extensions cannot exceed 20."))),t="convID:".concat(s," messageID:").concat(i," sequence:").concat(a," time:").concat(r," count:").concat(c.length),new ao(n));return u.setMessage(t),Pe.l("".concat(o," ").concat(t)),this._modifyMsgExts(e,c).then((function(e){var t=e.resultList,n=e.successCount;return e=e.failureCount,n="successCount:".concat(n," failCount:").concat(e),u.setMoreMessage(n).end(),Pe.l("".concat(o," ok. ").concat(n)),Sn({extensions:t})})).catch((function(e){return u.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this,n="getMessageExtensions";if(!this.canIUse(w.MSG_EXT))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.ID,s=e.conversationID,a=e.sequence,r=e.time,c=(s="convID:".concat(s," messageID:").concat(i," sequence:").concat(a," time:").concat(r),new ao(n)),u=(c.setMessage(s),void Pe.l("".concat(o," ").concat(s)));return this.getMsgExtsMap.has(i)&&(u=this._getGlobalSeq(i)),this._getMsgExts(e,u).then((function(e){return c.end(),Pe.l("".concat(o," ok. extCount:").concat(e.length)),ht(u)&&0<e.length&&t.getMsgExtsMap.set(i,1),Sn({extensions:e})})).catch((function(e){return c.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n="deleteMessageExtensions";if(!this.canIUse(w.MSG_EXT))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=[],s=3,a=(je(t)||(s=2,t.forEach((function(e){i.push({key:e,value:"",seq:0})}))),t=e.ID,e.conversationID),r=e.sequence,c=e.time,u=(a="convID:".concat(a," messageID:").concat(t," sequence:").concat(r," time:").concat(c," operateType:").concat(s),new ao(n));return u.setMessage(a),Pe.l("".concat(o," ").concat(a)),this._modifyMsgExts(e,i,s).then((function(e){var t=e.resultList,n=e.successCount,i=(e=e.failureCount,"");return 2===s&&(i="success count:".concat(n," fail count:").concat(e)),u.setMoreMessage("".concat(i)).end(),Pe.l("".concat(o," ok. ").concat(i)),Sn({extensions:t})})).catch((function(e){return u.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"_modifyMsgExts",value:function(e,t){var n=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=Dt(e.to)?k.CONV_TOPIC:e.conversationType,s=void 0,a=(3!==o&&(s=this._getReqExts(e,t)),null);switch(i){case k.CONV_C2C:a=this.get(6);break;case k.CONV_GROUP:a=this.get(7);break;case k.CONV_TOPIC:a=this.get(10);break;default:return kn({code:Hn.NO_MODULE})}return a.modifyMsgExts(e,s,o).then((function(t){var o=(t=t.data).extensions,i=(t=t.seq,[]),s=0,a=0,r=[];return(o=je(o)?[]:o).forEach((function(e){var t=e.errorCode,n=(e=e.extension).key,o=e.value;e=e.seq,i.push({code:t,key:n,value:o}),0===t?s++:a++,r.push({key:n,value:o,seq:e})})),n._updateGlobalSeq(e.ID,t),0<r.length&&(n._updateLocalExt(e.ID,r),r=null),{resultList:i,successCount:s,failureCount:a}})).catch((function(e){return kn(e)}))}},{key:"_getReqExts",value:function(e,t){var n,o=[];return this._hasLocalExt(e.ID)?(n=this._getLocalExt(e.ID),t.forEach((function(e){var t=e.key,i=(e=e.value,0);n.has(t)&&(i=n.get(t).seq),o.push({key:t,value:e,seq:i})}))):t.forEach((function(e){var t=e.key;e=e.value,o.push({key:t,value:e,seq:0})})),o}},{key:"_getMsgExts",value:function(e,t){var n=this,o="".concat(this._n,"._getMsgExts"),i=e.ID,s=null;switch(Dt(e.to)?k.CONV_TOPIC:e.conversationType){case k.CONV_C2C:s=this.get(6);break;case k.CONV_GROUP:s=this.get(7);break;case k.CONV_TOPIC:s=this.get(10);break;default:return kn({code:Hn.NO_MODULE})}return s.getMessageExtensions(e,t).then((function(t){var s=(t=t.data).extensions,a=t.completeFlag,r=t.globalSequence;return t=t.clearSequence,s=je(s)?[]:s,Pe.l("".concat(o," ok. completeFlag:").concat(a," globalSequence:").concat(r," clearSequence:").concat(t," count:").concat(s.length)),n._updateLocalExt(i,s),n._clearLocalExt(i,t),n._updateGlobalSeq(i,r),1!==a?(t=s.slice(-1)[0].seq+1,n._getMsgExts(e,t)):n._getLocalExtList(i)})).catch((function(e){return kn(e)}))}},{key:"_hasLocalExt",value:function(e){return this.msgExtMap.has(e)}},{key:"_getLocalExt",value:function(e){return this.msgExtMap.get(e)}},{key:"_updateLocalExt",value:function(e,t){this._hasLocalExt(e)||this.msgExtMap.set(e,new Map);var n=this._getLocalExt(e);t.forEach((function(e){var t=e.key,o=e.value;e=e.seq,n.set(t,{value:void 0===o?"":o,seq:e})}))}},{key:"_clearLocalExt",value:function(e,t){var n;t<=0||!this._hasLocalExt(e)||(n=this._getLocalExt(e)).forEach((function(e,o){e.seq<=t&&n.delete(o)}))}},{key:"_getLocalExtList",value:function(e){var t=[];return this._hasLocalExt(e)&&this._getLocalExt(e).forEach((function(e,n){je(e=e.value)||t.push({key:n,value:e})})),t}},{key:"_getGlobalSeq",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSeq",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this.msgExtMap.clear(),this.globalSeqMap.clear(),this.getMsgExtsMap.clear()}}]),na),zs=(r(ta,wn),Bs=f(ta),s(ta,[{key:"onReactionNotifyList",value:function(e){var n=this;(void 0===(e=(e||{}).dataList)?[]:e).forEach((function(e){var o=e.C2CMessageInfo,i=void 0===(i=e.groupMessageInfo)?{}:i,s=(e=void 0===(e=e.reactionList)?[]:e,i=(o=t(t({},void 0===o?{}:o),i)).tinyID,o.clientTime),a=(o=o.random,i="".concat(i,"-").concat(s,"-").concat(o),[]);e.forEach((function(e){ht(e.userIDList)&&(e.userIDList=[],e.count=0),a.push.apply(a,v(e.userIDList))})),Pe.l("".concat(n._n,".onReactionNotifyList messageID:").concat(i," reactionList:").concat(e.length)),n._handleReactionSummary([{messageID:i,reactionList:e}],a).then((function(e){n.emitOEvt(D.MESSAGE_REACTIONS_UPDATED,t({},e[0]))}))}))}},{key:"onReactionNotify",value:function(e){var n=(e=e.dataList||{}).C2CMessageInfo,o=void 0===(o=e.groupMessageInfo)?{}:o,i=e.reactionID,s=(e=e.operateType,o=(n=t(t({},void 0===n?{}:n),o)).tinyID,n.clientTime);n=n.random,o="".concat(o,"-").concat(s,"-").concat(n),Pe.l("".concat(this._n,".onReactionNotify messageID:").concat(o," reactionID:").concat(i," operateType:").concat(e)),1===e?this._addReactedByMyselfMap(o,i):this._removeReactedByMyselfMap(o,i),s="".concat(o,"-").concat(i),this._reactionInfoMap.has(s)&&((n=this._reactionInfoMap.get(s)).reactedByMyself=1===e,this.emitOEvt(D.MESSAGE_REACTIONS_UPDATED,{messageID:o,reactionList:[n]}))}},{key:"addMessageReaction",value:function(e,t){var n=this,o="addMessageReaction";if(!this.canIUse(w.MSG_REACTION))return this.noUse(o);var i="".concat(this._n,".").concat(o),s=e.ID,a=e.conversationID,r=(a="convID:".concat(a," messageID:").concat(s," reactionID:").concat(t),new ao(o));return r.setMessage(a),Pe.l("".concat(i," ").concat(a)),s=this._createReactionOperationPack(e,t,1),this._addReactedByMyselfMap(e.ID,t),this.req(s).then((function(){return r.end(),Pe.l("".concat(i," ok.")),Sn()})).catch((function(o){return n._removeReactedByMyselfMap(e.ID,t),r.setError(o).end(),Pe.e("".concat(i," failed. error:"),o),kn(o)}))}},{key:"removeMessageReaction",value:function(e,t){var n="removeMessageReaction";if(!this.canIUse(w.MSG_REACTION))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.ID,s=e.conversationID,a=(s="convID:".concat(s," messageID:").concat(i," reactionID:").concat(t),new ao(n));return a.setMessage(s),Pe.l("".concat(o," ").concat(s)),i=this._createReactionOperationPack(e,t,2),this._removeReactedByMyselfMap(e.ID,t),this.req(i).then((function(){return a.end(),Pe.l("".concat(o," ok.")),Sn()})).catch((function(e){return a.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"getMessageReactions",value:function(e){var n=this,o="getMessageReactions";if(!this.canIUse(w.MSG_REACTION))return this.noUse(o);var i="".concat(this._n,".").concat(o),s=e.messageList,a=e.maxUserCountPerReaction,r=s[0].conversationID,c=(r="convID:".concat(r," maxUserCountPerReaction:").concat(a," msgCount:").concat(s.length),new ao(o)),u=(c.setMessage(r),Pe.l("".concat(i," ").concat(r)),new Map);return a=this._createReactionSummaryPack(t(t({},e),{},{messageIDMap:u})),this.req(a).then((function(e){e=e.data.resultList;var t=[],o=[];return(void 0===e?[]:e).forEach((function(e){var n=void 0===(n=e.messageKey)?void 0:n,i=void 0===(i=e.messageSequence)?void 0:i;e=void 0===(e=e.reactionList)?[]:e,i=ht(n)?u.get(i):u.get(n),t.push({messageID:i,reactionList:e}),e.forEach((function(e){o.push.apply(o,v(e.userIDList))}))})),n._handleReactionSummary(t,o)})).then((function(e){return c.end(),Pe.l("".concat(i," ok.")),u.clear(),Sn({resultList:e})})).catch((function(e){return c.setError(e).end(),Pe.e("".concat(i," failed. error:"),e),kn(e)}))}},{key:"getAllUserListOfMessageReaction",value:function(e){var t=this,n="getAllUserListOfMessageReaction";if(!this.canIUse(w.MSG_REACTION))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.message,s=e.reactionID,a=e.nextSeq,r=e.count,c=i.ID,u=(i=i.conversationID,i="convID:".concat(i," messageID:").concat(c," reactionID:").concat(s," nextSeq:").concat(a," count:").concat(r),new ao(n)),l=(u.setMessage(i),Pe.l("".concat(o," ").concat(i)),{userList:[],nextSeq:0,isCompleted:!1});return c=this._createReactionUserListPack(e),this.req(c).then((function(e){var n=void 0===(n=(e=e.data).userIDList)?[]:n;return e=void 0===(e=e.nextSeq)?0:e,l.nextSeq=e,l.isCompleted=0===e,t.get(4).getUserNickAndAvatar(n)})).then((function(e){return l.userList=e,u.end(),Pe.l("".concat(o," ok.")),Sn(l)})).catch((function(e){return u.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"_createReactionOperationPack",value:function(e,t,n){var o,i,s=void 0;return t={reactionID:t,userIDList:[this.getMyUserID()]},e.conversationType===k.CONV_C2C&&(o=this.get(6),s=1===n?Kn.ADD_C2C_MSG_REACTION:Kn.RM_C2C_MSG_REACTION,t.from=e.from,t.to=e.to,t.messageKey=o.getMessageKey(e)),e.conversationType===k.CONV_GROUP&&(o=void 0,i=e.to,Dt(e.to)&&(i=qt(o=e.to)),s=1===n?Kn.ADD_GRP_MSG_REACTION:Kn.RM_GRP_MSG_REACTION,t.groupID=i,t.topicID=o,t.messageSequence=e.sequence),{P:s,data:t}}},{key:"_createReactionSummaryPack",value:function(e){var t,n,o,i=e.messageList,s=void 0===(s=e.maxUserCountPerReaction)?10:s,a=e.messageIDMap,r=void 0,c=void 0;return(e=i[0]).conversationType===k.CONV_C2C&&(t=this.get(6),n=i.map((function(e){var n=t.getMessageKey(e);return a.set(n,e.ID),n})),r=Kn.GET_C2C_MSG_REACTIONS,c={from:e.from,to:e.to,messageKeyList:n,count:s}),e.conversationType===k.CONV_GROUP&&(n=void 0,o=e.to,Dt(e.to)&&(o=qt(n=e.to)),e=i.map((function(e){return a.set(e.sequence,e.ID),e.sequence})),r=Kn.GET_GRP_MSG_REACTIONS,c={groupID:o,topicID:n,messageSequenceList:e,count:s}),{P:r,data:c}}},{key:"_createReactionUserListPack",value:function(e){var t=e.message,n=e.reactionID,o=e.nextSeq,i=void 0;return n={reactionID:n,nextSeq:void 0===o?0:o,count:100<(e=void 0===(e=e.count)?100:e)?100:e},t.conversationType===k.CONV_C2C&&(o=this.get(6),i=Kn.GET_C2C_MSG_REACTION_USER_LIST,n.from=t.from,n.to=t.to,n.messageKey=o.getMessageKey(t)),t.conversationType===k.CONV_GROUP&&(e=void 0,o=t.to,Dt(t.to)&&(o=qt(e=t.to)),i=Kn.GET_GRP_MSG_REACTION_USER_LIST,n.groupID=o,n.topicID=e,n.messageSequence=t.sequence),{P:i,data:n}}},{key:"_handleReactionSummary",value:function(e,t){var n=this;return this.get(4).getUserNickAndAvatar(t).then((function(t){var o=[];return e.forEach((function(e){var i=[];e.reactionList.forEach((function(o){var s=o.reactionID,a=o.count,r=o.userIDList,c=(o=void 0===(o=o.reactedByMyself)?void 0:o,[]);r.forEach((function(e){t.forEach((function(t){e===t.userID&&c.push(t)}))})),r={reactionID:s,totalUserCount:a,partialUserList:c,reactedByMyself:n._computeReactedByMyself({reactedByMyself:o,messageID:e.messageID,reactionID:s})},i.push(r),ht(o)&&!n._reactedByMyselfMap.has(e.messageID)&&(a="".concat(e.messageID,"-").concat(s),n._reactionInfoMap.set(a,r))})),o.push({messageID:e.messageID,reactionList:i})})),o}))}},{key:"_addReactedByMyselfMap",value:function(e,t){this._reactedByMyselfMap.has(e)||this._reactedByMyselfMap.set(e,[]),-1===(e=this._reactedByMyselfMap.get(e)).indexOf(t)&&e.push(t)}},{key:"_removeReactedByMyselfMap",value:function(e,t){!this._reactedByMyselfMap.has(e)||-1<(t=(e=this._reactedByMyselfMap.get(e)).indexOf(t))&&e.splice(t,1)}},{key:"_computeReactedByMyself",value:function(e){var t=e.reactedByMyself,n=e.messageID;return e=e.reactionID,ht(t)?!!this._reactedByMyselfMap.has(n)&&this._reactedByMyselfMap.get(n).includes(e):1===t}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),ta),Ws=(r(ea,wn),qs=f(ea),s(ea,[{key:"sendMessage",value:function(e){var t=this,n=this._createMsg(e);if(null===n)return kn({code:Hn.MSG_SEND_FAIL});this._addSendMessageTotalCount(n);var o=Date.now();return this.get(11).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var i=(e=e.data).time,s=e.sequence;return We(e=e.readReceiptCode)&&0!==e&&(new ao("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(s," readReceiptCode:").concat(e)).end(),Pe.w("".concat(t._n,".sendMessage readReceiptCode:").concat(e," message:").concat(t.getErrMsg(e)))),t._addSendMessageSuccessCount(n,o),e=t.get(11),n.status=An,n.time=i,n.conversationType===k.CONV_GROUP&&(n.sequence=s),e.appendToMessageList(n),i=n,!0===n._isExcludedFromLastMessage&&(i=""),e.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:i}]}),Sn({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.get(20),o="";return e.conversationType===k.CONV_C2C&&(o="".concat(G.NAME.OPEN_IM,".").concat(Kn.SEND_C2C_MSG)),e.conversationType===k.CONV_GROUP&&(o="".concat(G.NAME.GRP,".").concat(Kn.SEND_GRP_MSG)),n.sendComboMessage({servcmd:o,data:t})}},{key:"_createMsg",value:function(e){var t="".concat(this._n,"._createMsg"),n=null;try{var o,i=this.getMyUserID(),s={};s.senderTinyID=this.getMyTinyID(),s.currentUser=i,s.from=e.From_Account||i,e.GroupId?(s.conversationID="".concat(k.CONV_GROUP).concat(e.GroupId),s.conversationType=k.CONV_GROUP,s.to=e.GroupId):e.To_Account&&(s.conversationID="".concat(k.CONV_C2C).concat(e.To_Account),s.conversationType=k.CONV_C2C,s.to=e.To_Account),s.time=e.MsgTimeStamp||0,s.random=e.Random||e.MsgRandom||0,s.priority=e.MsgPriority,pt(e.CloudCustomData)&&0<e.CloudCustomData.length&&(s.cloudCustomData=e.CloudCustomData),Xe(e.SendMsgControl)&&(s.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(s.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(s.messageControlInfo.excludedFromLastMessage=1)),s.conversationType===k.CONV_GROUP&&Xe(e.To_Account)&&0<e.To_Account.length&&(o=e.To_Account,50<e.To_Account.length&&(o=e.To_Account.slice(0,50),Pe.w("".concat(t," To_Account must be less than or equal to 50."))),s.receiverList=v(o),e.To_Account=v(o)),1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(s.needReadReceipt=!0),1===e.SupportMessageExtension&&(s.isSupportExtension=!0),(n=new Oo(s)).status=Ln,e.MsgClientTime=n.clientTime,n.conversationType===k.CONV_C2C&&(e.MsgSeq=n.sequence);for(var a,r=e.MsgBody.length,c=0;c<r;c++)"TIMTextElem"===(a=e.MsgBody[c]).MsgType?n.setTextElement(a.MsgContent.Text):"TIMCustomElem"===a.MsgType?n.setCustomElement({data:a.MsgContent.Data||"",description:a.MsgContent.Desc||"",extension:a.MsgContent.Ext||""}):"TIMFaceElem"===a.MsgType&&n.setFaceElement({index:a.MsgContent.Index,data:a.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(l){n=null,Pe.e("".concat(t," failed. error:"),l)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=On,this.get(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new ao("sendMessage"),o="head.seq:".concat(t.data.headSeq,"  type:").concat(e.type," from:").concat(e.from," to:").concat(e.to);return n.setMessage(o).setError(t).end(),Pe.e("".concat(this._n,"._onSendMessageFailed ").concat(o," error:"),t),kn(new Bn({code:t&&t.code?t.code:Hn.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){return e.conversationType===k.CONV_C2C?Wn:e.conversationType===k.CONV_GROUP&&(e=this.get(7).getLocalGroupProfile(e.to))?Et(e=e.type)?$n:Jn:void 0}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n;(e=this._getSendMessageSpecifiedKey(e))&&((n=this.get(26)).addSuccessCount(e),n.addCost(e,Jt(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){t=void 0===(t=t.code)?-1:t;var n=this.get(26);e=this._getSendMessageSpecifiedKey(e),Fs(t)&&e&&n.addFailedCountOfUserSide(e)}}]),ea),Js=(r(Qs,wn),Vs=f(Qs),s(Qs,[{key:"registerPlugin",value:function(e){var t=this,n="0";Object.keys(e).forEach((function(o){t.plugins[o]=e[o],"tim-upload-plugin"===o&&"function"==typeof e[o].getVersion&&(n=e[o].getVersion())})),new ao("registerPlugin").setMessage("".concat(Object.keys(e))).setMoreMessage("version:".concat(n)).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),Qs),$s=(r(Zs,wn),xs=f(Zs),s(Zs,[{key:"_init",value:function(){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,o=e.cookie,i=e.syncFlag,s=e.isOnlineSync,a="".concat(this._n,"._startSync"),r=(Pe.l("".concat(a," options:"),e),new ao("syncUnread"));r.setMessage(JSON.stringify(e)),this.req({P:Kn.SYNC_UNREAD_MSG,data:{cookie:o,syncFlag:i,isOnlineSync:s}}).then((function(e){var o=(i=e.data).cookie,i=i.syncFlag,s="$cookie:".concat(o," syncFlag:").concat(i);Pe.l("".concat(a," ok. ").concat(s)),n._cookie=o,r.setMoreMessage(s).end(),je(o)||(0===i||1===i?(n._dispatch(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:o,syncFlag:i,isOnlineSync:0})):2===i&&n._dispatch(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){r.setError(e).end(),Pe.e("".concat(a," failed. error:"),e)}))}},{key:"_dispatch",value:function(e){e.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.get(6).onNewMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList,isSyncingEnded:e.isSyncingEnded})}},{key:"syncOnNeed",value:function(){Pe.l("".concat(this._n,".syncOnNeed cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"syncOnReconnected",value:function(){Pe.l("".concat(this._n,".syncOnReconnected cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),Zs),Xs={req:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList",cmConfigID:"CustomModerationConfigID"},res:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself",Level:"messageRemindType",PeerReadTime:"timestamp",NoUnreadSeqList:"excludedUnreadSequenceList",NewMsg:"topicLatestMessage"},ignoreKeyWord:["C2C","ID","USP"]};function Zs(e){return o(this,Zs),(e=xs.call(this,e))._n="SyncUnreadMsgModule",e._cookie="",e._onlineSyncFlag=!1,e.getIEmitInst().on(Wo.A2KEY_AND_TINYID_UPDATED,e._init,g(e)),e}function Qs(e){return o(this,Qs),(e=Vs.call(this,e))._n="PluginModule",e.plugins={},e}function ea(e){return o(this,ea),(e=qs.call(this,e))._n="ComboMsgModule",e}function ta(e){return o(this,ta),(e=Bs.call(this,e))._n="MsgReactionModule",e._reactedByMyselfMap=new Map,e._reactionInfoMap=new Map,e}function na(e){return o(this,na),(e=Hs.call(this,e))._n="MsgExtModule",e.msgExtMap=new Map,e.globalSeqMap=new Map,e.getMsgExtsMap=new Map,e}function oa(e){return o(this,oa),(e=js.call(this,e))._n="MessageModule",e._messageOptionsMap=new Map,e._mergerMessageHandler=new Ps(g(e)),e}function ia(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e=e=(e=e!==e.toLowerCase()?sa(e):e).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e)}var sa=function(e){for(var t=!1,n=!1,o=!1,i=0;i<e.length;i++){var s=e[i];t&&/[a-zA-Z]/.test(s)&&s.toUpperCase()===s?(e=e.slice(0,i)+"-"+e.slice(i),o=n,n=!(t=!1),i++):n&&o&&/[a-zA-Z]/.test(s)&&s.toLowerCase()===s?(e=e.slice(0,i-1)+"-"+e.slice(i-1),o=n,t=!(n=!1)):(t=s.toLowerCase()===s&&s.toUpperCase()!==s,o=n,n=s.toUpperCase()===s&&s.toLowerCase()!==s)}return e};function aa(e,t){var n=0;return function e(t,o){return 100<++n?(n--,t):Xe(t)?(i=t.map((function(t){return Je(t)?e(t,o):t})),n--,i):Je(t)?(s=t,a=function(e,t){if(!nt(t))return!1;if(t!==ia(t))for(var n=0;n<Xs.ignoreKeyWord.length&&!t.includes(Xs.ignoreKeyWord[n]);n++);var i;return ht(o[t])?(i=t)[0].toUpperCase()+ia(i).slice(1):o[t]},r=Object.create(null),Object.keys(s).forEach((function(e){var t=a(s[e],e);t&&(r[t]=s[e])})),i=At(i=r,(function(t,n){return Xe(t)||Je(t)?e(t,o):t})),n--,i):void 0;var i,s,a,r}(e,t)}for(var ra,ca=String.fromCharCode,ua=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320)if(56320<=(e=0|e.charCodeAt(1))&&e<=57343){if(65535<(t=(t<<10)+e-56613888|0))return ca(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533;else t<=57343&&(t=65533);return t<=2047?ca(192|t>>>6,128|63&t):ca(224|t>>>12,128|t>>>6&63,128|63&t)},la=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,ua),n=0|t.length,o=new Uint8Array(n),i=0;i<n;i=i+1|0)o[i]=0|t.charCodeAt(i);return o},da=(s(ba,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(e){this._handler.onOpen({id:this._id,res:JSON.stringify(e)})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){e=this._canIUseBinaryFrame?this._isAppCompressedData(e.data)?this._handler.inflate(e.data):function(e){for(var t=new Uint8Array(e),n="",o=0,i=t.length;o<i;){var s=t[o],a=0,r=0;if(s<=127?(a=0,r=255&s):s<=223?(a=1,r=31&s):s<=239?(a=2,r=15&s):s<=244&&(a=3,r=7&s),0<i-o-a)for(var c=0;c<a;)r=r<<6|63&(s=t[o+c+1]),c+=1;else r=65533,a=i-o;n+=String.fromCodePoint(r),o+=a+1}return n}(e.data):e.data,this._handler.onMessage({data:e})}},{key:"_isAppCompressedData",value:function(e){return 67===(e=new Uint8Array(e))[0]&&79===e[1]&&77===e[2]&&80===e[3]}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),J)return ie.offSocketClose(),ie.offSocketMessage(),ie.offSocketOpen(),ie.offSocketError(),void ie.closeSocket();this._socket&&(ee?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),W?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?la(e.data).buffer:e.data}):J?ie.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket&&(ee?this._socket.send({data:this._canIUseBinaryFrame?la(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket.send(this._canIUseBinaryFrame?la(e.data):e.data))}}]),ba),pa=["keyMap"],ha=["keyMap"],ga="connected",_a="connecting",fa="disconnected",ma=(s(Pa,[{key:"_setWebsocketHost",value:function(){var e=this._chM.get(12);this._currentSite=U,this._chM.isOversea()&&(this._currentSite="OVERSEA"),e.isSingaporeSite()?this._currentSite="SINGAPORE":e.isKoreaSite()?this._currentSite="KOREA":e.isGermanySite()?this._currentSite="GERMANY":e.isIndiaSite()?this._currentSite="IND":e.isJapanSite()?this._currentSite="JPN":e.isUSASite()?this._currentSite="USA":e.isIndonesiaSite()&&(this._currentSite="INDONESIA"),G.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){var e=this._chM.get(12).getSDKAppID()+"",t=this._chM.get(12).isIndependentDomainDisabled();je(e=(ht(G.HOST.CURRENT.BACKUP)?this._url=G.HOST.CURRENT.DEFAULT:""===this._url?this._url=t?G.HOST.CURRENT.DEFAULT:G.HOST.CURRENT.DEFAULT0.replace("*",e):-1<this._url.indexOf(e)?this._url=G.HOST.CURRENT.DEFAULT:this._url===G.HOST.CURRENT.DEFAULT?this._url=G.HOST.CURRENT.IPV6||G.HOST.CURRENT.BACKUP:this._url===G.HOST.CURRENT.IPV6?this._url=G.HOST.CURRENT.BACKUP:this._url===G.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?G.HOST.CURRENT.ANYCAST:G.HOST.CURRENT.DEFAULT:this._url===G.HOST.CURRENT.ANYCAST&&(G.HOST.CURRENT.ANYCAST="",this._url=G.HOST.CURRENT.DEFAULT),t=this._chM.get(12)).getProxyServer())||(this._url=e),t.isTestEnv()&&(this._url=O.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return oe&&G.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&(this._checkPromiseMap(),this._checkNativeAppWS())}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.reject,i=t.timestamp,s=(t=t.headSeq,15e3);-1!==n.indexOf(Kn.LOGIN)?s=9e4:-1!==n.indexOf(Kn.PING)&&(s=3e3),Date.now()-i>=s&&(Pe.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),o(new Bn({code:Hn.NETWORK_TIMEOUT,data:{headSeq:t}})),e._chM.onRequestTimeout())}))}},{key:"_checkNativeAppWS",value:function(){X&&!this.isConnected()&&this._reConnect()}},{key:"onOpen",value:function(e){var t,n;this._readyState!==fa&&(this._onOpenTs=Date.now(),n=e.id,e=e.res,this._socketID=n,t=Jt(this._startTs,!1),n="socketID:".concat(n," res:").concat(e),Pe.l("".concat(this._n,"._onOpen cost:").concat(t," ms. ").concat(n)),new ao("wsOnOpen").setMessage(t).setCostTime(t).setMoreMessage(n).end(),this._readyState=ga,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen())}},{key:"onClose",value:function(e){var t=new ao("wsOnClose"),n=e.id,o=(e=e.e,"sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(e.code," reason:").concat(e.reason)),i=0;0!==this._onOpenTs&&(i=Date.now()-this._onOpenTs),t.setMessage(i).setCostTime(i).setMoreMessage(o).setCode(e.code).end(!0),Pe.l("".concat(this._n,"._onClose ").concat(o," onlineTime:").concat(i)),n===this._socketID&&(this._readyState=fa,i<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(e){var t=e.id,n=(e=e.e,"sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID));new ao("wsOnError").setMessage(e.errMsg||JSON.stringify(e,["message","code"])).setMoreMessage(n).setLevel("error").end(!0),Pe.w("".concat(this._n,"._onError"),e,n),t===this._socketID&&(this._readyState=fa,this._chM.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(r){new ao("jsonParseError").setMessage(e.data).end()}if(t&&t.head){e=this._getRequestIDFromHead(t.head);var n,o,i,s,a=t.body;if(this._chM.get(30).isTRTCCommand(e)||(s=wt(t.head),a=function e(t,n){return Xe(t)?t.map((function(t){return Je(t)?e(t,n):t})):Je(t)?(o=t,i=function(e,t){return ht(n[t])?ia(t):n[t]},s={},Object.keys(o).forEach((function(e){s[i(o[e],e)]=o[e]})),At(s,(function(t){return Xe(t)||Je(t)?e(t,n):t}))):void 0;var o,i,s}(t.body,this._getResKeyMap(s))),Pe.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(a)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e))return n=(s=this._promiseMap.get(e)).resolve,o=s.reject,i=s.timestamp,s=s.headSeq,this._promiseMap.delete(e),this._calcRTT(i),void(a.errorCode&&0!==a.errorCode?(this._chM.onErrorCodeNotZero(a),o(new Bn({code:a.errorCode,message:a.errorInfo||"",data:e.includes(Kn.MODIFY_C2C_MSG)||e.includes(Kn.MODIFY_GRP_MSG)?{elements:a.elements,messageVersion:a.messageVersion,cloudCustomData:a.cloudCustomData,headSeq:s}:{headSeq:s}}))):n(Sn(a)));this._chM.onMessage({head:t.head,body:a})}}},{key:"_calcRTT",value:function(e){e=Date.now()-e,this._chM.get(26).addRTT(e)}},{key:"_connect",value:function(){this._readyState!==_a&&this._readyState!==ga&&(this._startTs=Date.now(),this._onOpenTs=0,this._readyState=_a,this._socket=new da(this),this._socketID=this._socket.getID(),Pe.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new ao("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end())}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=Pt(),t=((J||j&&"windows"===e||X)&&(this._canIUseBinaryFrame=!1),-1),n=("ios"===e?t=ce||-1:"android"===e&&(t=le||-1),this._chM.get(12)),o=this._chM.getPlatform(),i=n.getSDKAppID();return n=n.getInstanceID(),i="sdkappid=".concat(i,"&instanceid=").concat(n,"&random=").concat(this._getRandom(),"&platform=").concat(o,"&host=").concat(e)+"&version=".concat(t,"&sdkversion=").concat("3.5.2"),K&&(i+="&isminigame=1"),this._chM.canIUseInflate()&&(i+="&compress=gzip"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(i)}},{key:"_closeConnection",value:function(e){Pe.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=fa)}},{key:"_resend",value:function(){var e=this;if(Pe.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.uplinkData,i=t.resolve;t=t.reject,-1!==n.indexOf(Kn.AV_POLLING)?e._promiseMap.delete(n):(e._promiseMap.set(n,{resolve:i,reject:t,timestamp:Date.now(),uplinkData:o}),e._execute(n,o))})),0<this._simpleRequestMap.size){var t,n=S(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var o=m(t.value,2),i=o[0],s=o[1];this._execute(i,s)}}catch(a){n.e(a)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this,n=(e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.head.cs=this._calcCheckSum(e.head.servcmd,e.body),e.keyMap,h(e,pa)),o=this._getRequestIDFromHead(e.head),i=JSON.stringify(n);return new Promise((function(s,a){t._promiseMap.set(o,{resolve:s,reject:a,timestamp:Date.now(),uplinkData:i,headSeq:e.head.seq}),Pe.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(o," readyState:").concat(t._readyState)),t._readyState!==ga?t._reConnect():(t._execute(o,i),t._chM.get(26).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=h(e,ha);e=this._getRequestIDFromHead(e.head),t=JSON.stringify(t),this._readyState!==ga?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(e,t):Pe.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(e,t)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:ee?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Pe.l("".concat(this._n,"._onSendFail requestID:").concat(e)),this._chM.onSendFail()}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=at()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResKeyMap",value:function(e){return e=this._chM.getKeyMap(e),t(t({},Xs.res),e.res)}},{key:"_reConnect",value:function(){this._readyState!==ga&&this._readyState!==_a&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e="".concat(this._n,".forcedReconnect");Pe.l("".concat(e," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(Pe.w("".concat(e," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=X?Date.now()+5e3:Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===ga}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"getSocketID",value:function(){return this._socketID}},{key:"inflate",value:function(e){if(this._chM.canIUseInflate())return this._chM.get(37).inflate(e)}},{key:"setIsWorkerEnabled",value:function(e){Pe.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&fe}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"_calcCheckSum",value:function(e,t){if(-1!==e.indexOf(Kn.PING)||-1!==e.indexOf(Kn.LOGIN)||-1!==e.indexOf(Kn.LOGOUT)||-1!==e.indexOf(Kn.AV_POLLING)||-1!==e.indexOf(Kn.AV_NOAUTH_POLLING))return 0;for(var n=la(JSON.stringify(t)),o=4294967295,i=0,s=n.length;i<s;i++){o^=n[i];for(var a=0;a<8;a++)1&~o?o>>>=1:o=o>>>1^3988292384}return(4294967295^o)>>>0}},{key:"close",value:function(){Pe.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=at(),this._readyState=fa,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),Pa),va=function(e,t,n){return new Promise((function(o,i){var s,a,r="application/x-www-form-urlencoded;charset=UTF-8";ee?ie.request({url:t,data:n,method:e,timeout:3e3,header:{"content-type":r},success:function(e){e&&e.data&&e.data.NetCheckInfo&&Pe.l("".concat("getconninfo ok in"," miniapp. ret:"),e.data),o()},fail:function(){i(new Bn({code:Hn.NETWORK_ERROR}))}}):(s=new XMLHttpRequest,a=setTimeout((function(){s.abort(),i(new Bn({code:Hn.NETWORK_TIMEOUT}))}),3e3),s.onreadystatechange=function(){4===s.readyState&&(a&&clearTimeout(a),200===s.status||304===s.status?(s.responseText&&-1<s.responseText.indexOf("NetCheckInfo")&&Pe.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(s.responseText)),o()):i(new Bn({code:Hn.NETWORK_ERROR})))},s.open(e,t,!0),s.setRequestHeader("Content-type",r),n?s.send(n):s.send())}))},ya=(r(Na,wn),ra=f(Na),s(Na,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.get(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.get(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==k.NET_STATE_CONNECTED&&e.head.servcmd.includes(Kn.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=G.HOST.CURRENT.STAT;return t="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),e=JSON.stringify(e.body),va("POST",t,e)}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){ee&&!X&&this.warn("DomainNameInMP"),this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.get(20).getKeyMap(e)}},{key:"onRequestTimeout",value:function(){3e4<=Date.now()-this._lastDiagnoseTS&&this.diagnose()}},{key:"onSendFail",value:function(){this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"onReconnected",value:function(){Pe.l("".concat(this._n,".onReconnected cost:").concat(Jt(this._disconnectedTS,!0,!0))),this._m.restartTimer(),this.get(20).onReconnected(Jt(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(k.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Pe.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!1,n=(this._socketHandler&&(t=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t));if(Pe.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===k.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(k.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Pe.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),e===k.NET_STATE_DISCONNECTED&&0===this._disconnectedTS&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=e,this.emitOEvt(D.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e,t=this;!0!==this._probing&&(this._probing=!0,e=this.get(20).getProtocolData({P:Kn.PING}),this.send(e).then((function(){t._probing=!1})).catch((function(e){t._probing=!1;var n=t.get(15).isOnline();if(Pe.w("".concat(t._n,"._ping failed. bOnline:").concat(n," error:"),e),e&&60002===e.code)return new ao("error").setMessage("code:".concat(e.code," message:").concat(e.message)).end(),t._fatalErrorFlag=!0,void t._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED);n?t.reConnect():t._emitNetStateChangeEvent(k.NET_STATE_DISCONNECTED)})))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"canIUseInflate",value:function(){return this._m.canIUseInflate()}},{key:"getSocketID",value:function(){if(this._socketHandler)return this._socketHandler.getSocketID()}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._lastDiagnoseTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var e=this,t=this._socketHandler.getURL(),n=t.split("/")[2];n.startsWith("ws")&&(t=t.slice(t.indexOf("info?")+5),n="https://".concat(n,"/v3/netcheck/getconninfo?").concat(t,"&reqtime=").concat(Date.now()),va("GET",n).catch((function(t){Pe.w("".concat(e._n,"._diagnoseBySSO failed. error:"),t)})))}},{key:"_diagnoseByCDN",value:function(){var e=this,t=(t=this._socketHandler.getURL()).slice(t.indexOf("info?")+5);t="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(t,"&reqtime=").concat(Date.now()),va("GET",t).catch((function(t){Pe.w("".concat(e._n,"._diagnoseByCDN failed. error:"),t)}))}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._previousState=k.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0,this._lastDiagnoseTS=0}}]),Na),Ia=["a2","tinyid"],Ma=["a2","tinyid"],Ca=(s(Oa,[{key:"_fillMap",value:function(){this._map.clear();var e=this._sessionM.genCommonHead(),n=this._sessionM.genCosSpecifiedHead(),o=this._sessionM.genSSOReportHead();this._map.set(Kn.LOGIN,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0,customInfo:""},keyMap:{req:{deviceBrand:"InstType"},res:{InstId:"instanceID",HelloInterval:"helloInterval",RichMsgAuthKey:"authKey"}}}),this._map.set(Kn.LOGOUT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.LOGOUT)}),body:{type:0,isWebUniapp:0},keyMap:{req:{type:"wslogout_type"}}}),this._map.set(Kn.HELLO,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.HELLO)}),body:{isWebUniapp:0},keyMap:{res:{NewInstInfo:"newInstanceInfo"}}}),this._map.set(Kn.KICK_OTHER,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.STAT_SERVICE,".").concat(Kn.KICK_OTHER)}),body:{}}),this._map.set(Kn.COS_SIGN,{head:t(t({},n),{},{servcmd:"".concat(G.NAME.IM_COS_SIGN,".").concat(Kn.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{req:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},res:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._map.set(Kn.COS_PRE_SIG,{head:t(t({},n),{},{servcmd:"".concat(G.NAME.CUSTOM_UPLOAD,".").concat(Kn.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{req:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},res:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._map.set(Kn.SIMPLE_COS_PRE_SIG,{head:t(t({},n),{},{servcmd:"".concat(G.NAME.CUSTOM_UPLOAD,".").concat(Kn.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{req:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},res:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._map.set(Kn.GET_IMAGE_INFO,{head:t(t({},n),{},{servcmd:"".concat(G.NAME.CUSTOM_UPLOAD,".").concat(Kn.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{req:{imageUrl:"str_image_url"},res:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._map.set(Kn.GET_IP,{head:t(t({},n),{},{servcmd:"".concat(G.NAME.CUSTOM_UPLOAD,".").concat(Kn.GET_IP)}),body:{domainName:""},keyMap:{req:{domainName:"str_domain"},res:{str_final_ip:"ip"}}}),this._map.set(Kn.VIDEO_COVER,{head:t(t({},n),{},{servcmd:"".concat(G.NAME.CUSTOM_UPLOAD,".").concat(Kn.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{req:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},res:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._map.set(Kn.FETCH_COMMERCIAL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_CONFIG_MANAGER,".").concat(Kn.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{req:{SDKAppID:"uint32_sdkappid"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(Kn.PUSHED_COMMERCIAL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_CONFIG_MANAGER,".").concat(Kn.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(Kn.FETCH_CLOUD_CTRL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_CONFIG_MANAGER,".").concat(Kn.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{req:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(Kn.PUSHED_CLOUD_CTRL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_CONFIG_MANAGER,".").concat(Kn.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(Kn.OVERLOAD_NOTIFY,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OVERLOAD_PUSH,".").concat(Kn.OVERLOAD_NOTIFY)}),body:{},keyMap:{res:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._map.set(Kn.SYNC_UNREAD_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1,needCachedMsg:1},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},res:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._map.set(Kn.GET_PROFANITY_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_MSG_AUDIT_MGR,".").concat(Kn.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{req:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},res:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._map.set(Kn.SEND_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",OPPOCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:"",HonorImportance:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0,forbidCallbackControl:void 0},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID",OPPOChannelID:"OPPOChannelID",OPPOCategory:"OPPOCategory",VIVOClassification:"VIVOClassification",VIVOCategory:"VIVOCategory",HonorImportance:"HonorImportance"}}}),this._map.set(Kn.SEND_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",OPPOCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:"",HonorImportance:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0,forbidCallbackControl:void 0},keyMap:{req:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID",OPPOChannelID:"OPPOChannelID",OPPOCategory:"OPPOCategory",VIVOClassification:"VIVOClassification",VIVOCategory:"VIVOCategory",HonorImportance:"HonorImportance"},res:{MsgTime:"time",MsgSeq:"sequence"}}}),this._map.set(Kn.REVOKE_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{req:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._map.set(Kn.REVOKE_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{req:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._map.set(Kn.GET_C2C_ROAMING_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{req:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},res:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._map.set(Kn.MODIFY_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(Kn.GET_GRP_ROAMING_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{req:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},res:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._map.set(Kn.SET_C2C_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{req:{lastMessageTime:"LastedMsgTime"}}}),this._map.set(Kn.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{req:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._map.set(Kn.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Peer_Account"},res:{MuteNotificationsList:"muteFlagList"}}}),this._map.set(Kn.SET_GRP_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{req:{messageReadSeq:"MsgReadedSeq"}}}),this._map.set(Kn.SET_ALL_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{req:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},res:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._map.set(Kn.DEL_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{req:{keyList:"MsgKeyList"}}}),this._map.set(Kn.DEL_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{req:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._map.set(Kn.TRANSLATE_TEXT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_TRANSLATE,".").concat(Kn.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{req:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},res:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(Kn.VOICE_TO_TEXT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_SPEECH,".").concat(Kn.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{req:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},res:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(Kn.MODIFY_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(Kn.GET_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequence:"MsgSeq"}}}),this._map.set(Kn.SEND_C2C_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{req:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._map.set(Kn.SEND_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._map.set(Kn.GET_READ_RECEIPT_DETAIL,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{req:{sequence:"MsgSeq",count:"Num"},res:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._map.set(Kn.MODIFY_C2C_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(Kn.GET_C2C_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._map.set(Kn.MODIFY_GRP_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(Kn.GET_GRP_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._map.set(Kn.ADD_C2C_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(Kn.RM_C2C_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(Kn.GET_C2C_MSG_REACTIONS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._map.set(Kn.GET_C2C_MSG_REACTION_USER_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._map.set(Kn.ADD_GRP_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(Kn.RM_GRP_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(Kn.GET_GRP_MSG_REACTIONS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{res:{MsgSeq:"messageSequence"}}}),this._map.set(Kn.GET_GRP_MSG_REACTION_USER_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM_MSG_EXT,".").concat(Kn.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._map.set(Kn.GET_C2C_PEER_READ_TIME,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{req:{userIDList:"To_Account"},res:{ReadTime:"peerReadTimeList"}}}),this._map.set(Kn.PAGING_GET_CONV_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{req:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},res:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._map.set(Kn.DEL_CONV,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{req:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},res:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._map.set(Kn.CLEAR_HISTORY_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{req:{toGroupID:"ToGroupid"}}}),this._map.set(Kn.PIN_CONV,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{req:{itemList:"RecentContactItem"}}}),this._map.set(Kn.DEL_GROUP_AT_TIPS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(Kn.SET_CONV_CUSTOM_DATA,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(Kn.MARK_CONV,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(Kn.CREATE_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"GroupContactItem",groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(Kn.DEL_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{res:{GroupId:"convGroupID"}}}),this._map.set(Kn.RENAME_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{req:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},res:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._map.set(Kn.ADD_CONV_TO_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}}}),this._map.set(Kn.DEL_CONV_FROM_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0}}),this._map.set(Kn.GET_CONV_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startIndex:void 0},keyMap:{res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._map.set(Kn.SEARCH_CONV_GRP_MARK,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.RECENT_CONTACT,".").concat(Kn.SEARCH_CONV_GRP_MARK)}),body:{fromAccount:"",contactItem:void 0},keyMap:{req:{groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList",ContactResultItem:"contactItem"}}}),this._map.set(Kn.GET_USER_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.PROFILE,".").concat(Kn.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(Kn.UPDATE_MY_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.PROFILE,".").concat(Kn.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:Ue.NICK,value:""},{tag:Ue.GENDER,value:""},{tag:Ue.ALLOWTYPE,value:""},{tag:Ue.AVATAR,value:""}]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(Kn.GET_BL,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30}}),this._map.set(Kn.ADD_TO_BL,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(Kn.RM_FROM_BL,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(Kn.SET_SELF_STATUS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.SET_SELF_STATUS)}),body:{customStatus:""}}),this._map.set(Kn.GET_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._map.set(Kn.SUB_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(Kn.UNSUB_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(Kn.GET_FD_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{res:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._map.set(Kn.ADD_FD,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{req:{source:"AddSource",wording:"AddWording",type:"AddType"},res:{ResultItem:"resultList"}}}),this._map.set(Kn.UPDATE_FD,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{req:{snsItem:"SnsItem"},res:{ResultItem:"resultList"}}}),this._map.set(Kn.DEL_FD,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"DeleteType"},res:{ResultItem:"resultList"}}}),this._map.set(Kn.GET_FD_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{res:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._map.set(Kn.CHECK_FD,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"CheckType"},res:{InfoItem:"resultList"}}}),this._map.set(Kn.GET_FD_APPLICATION_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{res:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._map.set(Kn.RESPOND_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{req:{tag:"TagName",action:"ResponseAction"},res:{ResultItem:"resultList"}}}),this._map.set(Kn.DEL_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{req:{type:"PendencyType",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(Kn.REPORT_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{req:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._map.set(Kn.CREATE_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{req:{groupName:"GroupName",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(Kn.DEL_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{req:{nameList:"GroupName"}}}),this._map.set(Kn.GET_FD_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{res:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._map.set(Kn.UPDATE_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FD,".").concat(Kn.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{req:{oldName:"GroupOldName",newName:"GroupNewName"},res:{UpdateType:"type",ResultItem:"resultList"}}}),this._map.set(Kn.GET_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0,needAppDefineData:1},keyMap:{req:{memberAccount:"Member_Account"},res:{GroupIdList:"groups",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime",AppDefinedData:"groupCustomField"}}}),this._map.set(Kn.GET_GRP_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{req:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(Kn.CREATE_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{req:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},res:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._map.set(Kn.DISMISS_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.DISMISS_GRP)}),body:{groupID:void 0}}),this._map.set(Kn.UPDATE_GRP_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{req:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},res:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(Kn.APPLY_JOIN_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{req:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},res:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._map.set(Kn.APPLY_JOIN_GRP_NOAUTH,(e.a2,e.tinyid,{head:t(t({},h(e,Ia)),{},{servcmd:"".concat(G.NAME.BIG_GRP_NO_AUTH,".").concat(Kn.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{req:{applyMessage:"ApplyMsg"},res:{HugeGroupFlag:"avChatRoomFlag"}}})),this._map.set(Kn.QUIT_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.QUIT_GRP)}),body:{groupID:void 0}}),this._map.set(Kn.SEARCH_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}}}),this._map.set(Kn.CHANGE_GRP_OWNER,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{req:{newOwnerID:"NewOwner_Account"}}}),this._map.set(Kn.HANDLE_GRP_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(Kn.HANDLE_INVITE_JOIN_GRP,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._map.set(Kn.HANDLE_GRP_INVITATION,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(Kn.GET_GRP_PENDENCY,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{req:{handleAccount:"Handle_Account"},res:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._map.set(Kn.DEL_GRP_SYSTEM_NOTICE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(Kn.AV_POLLING,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.BIG_GRP_POLLING,".").concat(Kn.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._map.set(Kn.AV_NOAUTH_POLLING,(e.a2,e.tinyid,{head:t(t({},h(e,Ma)),{},{servcmd:"".concat(G.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(Kn.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._map.set(Kn.GET_ONLINE_MBR_NUM,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{res:{OnlineMemberNum:"memberCount"}}}),this._map.set(Kn.SET_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(Kn.MODIFY_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(Kn.DEL_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key"}}}),this._map.set(Kn.CLEAR_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._map.set(Kn.GET_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_ATTR,".").concat(Kn.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{req:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._map.set(Kn.GET_GRP_NOTIFY,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{req:{notifyReqList:"NotifyReqList"},res:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._map.set(Kn.UPDATE_GRP_COUNTER,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{req:{counterList:"GroupCounter"}}}),this._map.set(Kn.GET_GRP_COUNTER,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{req:{keyList:"GroupCounterKeys"}}}),this._map.set(Kn.CREATE_TOPIC,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_COMMUNITY,".").concat(Kn.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{req:{avatar:"FaceUrl"}}}),this._map.set(Kn.DEL_TOPIC,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_COMMUNITY,".").concat(Kn.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{req:{topicIDList:"TopicIdList"},res:{DestroyResultItem:"resultList"}}}),this._map.set(Kn.UPDATE_TOPIC_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_COMMUNITY,".").concat(Kn.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{req:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._map.set(Kn.GET_TOPIC_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_COMMUNITY,".").concat(Kn.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{req:{topicIDList:"TopicIdList"},res:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence"}}}),this._map.set(Kn.GET_GRP_MBR_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._map.set(Kn.GET_AV_MBR_LIST,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_AV,".").concat(Kn.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{req:{offset:"Timestamp",filter:"Mark"},res:{NextTimestamp:"offset"}}}),this._map.set(Kn.GET_GRP_MBR_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._map.set(Kn.ADD_GRP_MBR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{req:{userID:"Member_Account",userIDList:"MemberList"},res:{MemberList:"members"}}}),this._map.set(Kn.DEL_GRP_MBR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{req:{userIDList:"MemberToDel_Account"}}}),this._map.set(Kn.BAN_AV_MBR,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{req:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._map.set(Kn.MODIFY_GRP_MBR_INFO,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP,".").concat(Kn.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{req:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._map.set(Kn.MARK_AV_MBR_INFO,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_AV,".").concat(Kn.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{req:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},res:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._map.set(Kn.CS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.MSG_SEARCH,".").concat(Kn.CS)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{req:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList",keywords:"Keywords",keywordMatchType:"KeywordMatchType",count:"Count",miniBirthday:"UserBirthStart",maxBirthday:"UserBirthEnd",gender:"UserGenderType",groupTypeList:"GroupType",groupIDList:"GroupIdList"},res:{GroupID:"groupID",UserID:"userID",ErrorCode:"code",ErrorInfo:"message",TotalCount:"totalCount",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",Users:"userList",ProfileItems:"profileItems",StrValue:"value",IntValue:"value",Groups:"groupList",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupOwnerUserID:"ownerID",GroupOwnerUserName:"ownerNick",GroupOwnerTinyID:"ownerTinyID",GroupMemberNum:"memberNum",GroupName:"name",GroupType:"type",GroupMembers:"groupMemberList",GroupMemberUserID:"userID",GroupMemberTinyID:"userTinyID",GroupMemberUserName:"nick",GroupMemberNameCard:"nameCard"}}}),this._map.set(Kn.USER_CS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.USER_SEARCH,".").concat(Kn.CS)}),body:{keywords:void 0,keywordMatchType:0,miniBirthday:void 0,maxBirthday:void 0,gender:void 0,count:20,cursor:void 0}}),this._map.set(Kn.GRP_CS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_SEARCH,".").concat(Kn.CS)}),body:{keywords:void 0,keywordMatchType:0,groupType:void 0,count:20,cursor:void 0}}),this._map.set(Kn.MBR_CS,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.GRP_MEMBER_SEARCH,".").concat(Kn.CS)}),body:{keywords:void 0,keywordMatchType:0,groupType:void 0,groupIDList:void 0,count:20,cursor:void 0}}),this._map.set(Kn.SSO_STAT,{head:t(t({},o),{},{servcmd:"".concat(G.NAME.IM_OPEN_STAT,".").concat(Kn.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{req:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._map.set(Kn.PING,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.HEARTBEAT,".").concat(Kn.PING)}),body:{}}),this._map.set(Kn.MSG_PUSH,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_PUSH,".").concat(Kn.MSG_PUSH)}),body:{},keyMap:{res:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}),this._map.set(Kn.MULTI_MSG_PUSH,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_PUSH,".").concat(Kn.MULTI_MSG_PUSH)}),body:{},keyMap:{res:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._map.set(Kn.MSG_PUSH_ACK,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OPEN_IM,".").concat(Kn.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{req:{sessionData:"SessionData"}}}),this._map.set(Kn.STATUS_FORCE_OFFLINE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{res:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._map.set(Kn.DOWNLOAD_MERGER_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_LONG_MSG,".").concat(Kn.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{res:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._map.set(Kn.UPLOAD_MERGER_MSG,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_LONG_MSG,".").concat(Kn.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._map.set(Kn.FOLLOW,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FOLLOW,".").concat(Kn.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"FollowItem"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(Kn.UNFOLLOW,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FOLLOW,".").concat(Kn.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(Kn.GET_FOLLOW_INFO,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FOLLOW,".").concat(Kn.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._map.set(Kn.GET_FOLLOW,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FOLLOW,".").concat(Kn.GET_FOLLOW)}),body:{fromAccount:"",type:1,nextCursor:"",count:500},keyMap:{req:{type:"FollowType",nextCursor:"StartCursor",count:"WantNum"},res:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._map.set(Kn.CHECK_FOLLOW_TYPE,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.FOLLOW,".").concat(Kn.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(Kn.SET_TOKEN,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{req:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._map.set(Kn.STAT_FOREGROUND,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._map.set(Kn.STAT_BACKGROUND,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_OPEN_STATUS,".").concat(Kn.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{req:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._map.set(Kn.PUSH_REPORT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.OFFLINE_PUSH_REPORT,".").concat(Kn.PUSH_REPORT)}),body:{eventList:[]},keyMap:{req:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}}),this._map.set(Kn.SET_ALL_RECEIVE_MSG_OPT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_MSG_LOGIC,".").concat(Kn.SET_ALL_RECEIVE_MSG_OPT)}),body:{startTime:0,endTime:0,isRepeated:0,messageRemindType:0},keyMap:{req:{messageRemindType:"Level"}}}),this._map.set(Kn.GET_ALL_RECEIVE_MSG_OPT,{head:t(t({},e),{},{servcmd:"".concat(G.NAME.IM_MSG_LOGIC,".").concat(Kn.GET_ALL_RECEIVE_MSG_OPT)}),body:{toAccount:void 0}})}},{key:"has",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"update",value:function(){this._fillMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Pe.w("".concat(this._n,".getKeyMap unknown P:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.P,n=e.data;if(e=this.get(t),t=null,n){var o,i=this._simpleDeepCopy(e),s=(i=this._updateService(n,i)).body,a=Object.create(null);for(o in s)if(Object.prototype.hasOwnProperty.call(s,o)){if(a[o]=s[o],void 0===n[o])continue;a[o]=n[o]}i.body=a,t=this._getUplinkData(i)}else t=this._getUplinkData(e);return t}},{key:"_getUplinkData",value:function(e){var t=wt((e=this._dataCleaner(e)).head);return t=aa(e.body,this._getReqKeyMap(t)),e.body=t,e}},{key:"_updateService",value:function(e,t){var n,o,i=wt(t.head);return this._isFromGroupRequest(t)&&(n=e.type,o=e.groupID,e=void 0===(e=e.groupIDList)?[]:e,ht(o=void 0===o?void 0:o)&&(o=e[0]||""),St({type:n,groupID:o})&&(t.head.servcmd="".concat(G.NAME.GRP_COMMUNITY,".").concat(i))),t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(G.NAME.GRP)||e.head.servcmd.includes(G.NAME.GRP_ATTR)}},{key:"_getReqKeyMap",value:function(e){return e=this.getKeyMap(e),t(t({},Xs.req),e.req)}},{key:"_dataCleaner",value:function(e){var t,o=Array.isArray(e)?[]:Object.create(null);for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&nt(t)&&null!==e[t]&&void 0!==e[t]&&("object"!==n(e[t])?o[t]=e[t]:o[t]=this._dataCleaner.bind(this)(e[t]));return o}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),o={},i=0,s=n.length;i<s;i++)Xe(e[t=n[i]])?o[t]=Array.from(e[t]):Je(e[t])?o[t]=this._simpleDeepCopy(e[t]):o[t]=e[t];return o}}]),Oa),Ta=[Kn.MSG_PUSH_ACK],Ea=(s(Aa,[{key:"_onC2CMsgArray",value:function(e){var t=this._sessionM.get(6);e.dataList.forEach((function(e){var t;1===e.isSyncMessage&&(t=e.from,e.from=e.to,e.to=t)})),1===e.needSync&&this._sessionM.get(19).syncOnNeed(),t.onNewMessage({dataList:e.dataList,isInstantMessage:!0})}},{key:"_onC2CMsgModified",value:function(e){this._sessionM.get(6).onMsgModified(e)}},{key:"_onGroupMsgArray",value:function(e){var t=this._sessionM.get(7);t&&t.onNewMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_onGroupMsgModified",value:function(e){var t=this._sessionM.get(7);t&&t.onMsgModified(e)}},{key:"_onGroupTips",value:function(e){var t=this._sessionM.get(7);if(t){var n=e.event,o=e.dataList,i=e.isInstantMessage,s=void 0===i||i,a=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:o});break;case 5:for(var r=0;r<o.length;r++)if(Xe(o[r].elements.revokedInfos))t.onMsgRevoked({dataList:o});else if(Xe(o[r].elements.groupMessageReadNotice))t.onMsgReadNotice({dataList:o});else{if(!Xe(o[r].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:o,isInstantMessage:s,isSyncingEnded:a});break}t.onReadReceiptList({dataList:o})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:o});break;default:Pe.l("".concat(this._n,"._onGroupTips unknown event:").concat(n," dataList:"),o)}}}},{key:"_onC2CNotifyMsgArray",value:function(e){var t,n=this,o=e.dataList;Xe(o)&&(t=this._sessionM.get(6),o.forEach((function(e){var i,s;$e(e)&&(e.hasOwnProperty("kickoutMsgNotify")?(i=(s=e.kickoutMsgNotify).kickType,s=void 0===(s=s.newInstanceInfo)?{}:s,1===i?n._sessionM.onMultipleAccountKickedOut(s):2===i?n._sessionM.onMultipleDeviceKickedOut(s):3===i&&n._sessionM.onRestApiKickedOut(s)):e.hasOwnProperty("c2cMessageRevokedNotify")?t&&t.onMsgRevoked({dataList:o},!0):e.hasOwnProperty("c2cMessageReadReceipt")?t&&t.onMsgReadReceipt({dataList:o}):e.hasOwnProperty("c2cMessageReadNotice")?t&&t.onMsgReadNotice({dataList:o}):e.hasOwnProperty("muteNotificationsSync")&&n._sessionM.get(11).onC2CMsgRemindTypeSynced({dataList:o}))})))}},{key:"_onC2CReadReceiptArray",value:function(e){this._sessionM.get(6).onReadReceiptList(e)}},{key:"_onProfileModified",value:function(e){this._sessionM.get(4).onProfileModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_onRelationChainModified",value:function(e){this._sessionM.get(4).onRelationChainModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_onRecentContact",value:function(e){var t;!Xe(e=e.dataList)||(t=this._sessionM.get(11))&&e.forEach((function(e){var n,o,i=e.pushType;1===i?(n=e.recentContactDeleteItem,t.onConvDeleted(n.recentContactList)):2===i?(n=e.recentContactTopItem,t.onConvPinnedStatus(n.recentContactList,!0)):3===i?(n=e.recentContactTopItem,t.onConvPinnedStatus(n.recentContactList,!1)):4===i?(n=e.recentContactMarkContact,t.onConvMarkUpdated(n.recentContactMarkContactItem)):5===i?(n=e.recentContactCreateContactGroup,t.onConvGroupCreated(n.msgContactGroupContactItem)):6===i?(n=e.recentContactDelContactGroup,t.onConvGroupDeleted(n.msgGroupItem)):7===i&&(i=(n=e.recentContactUpdateContactGroup).updateType,e=n.msgUpdateGroup,n=n.msgUpdateContact,1===i?1===(o=e.updateGroupType)?t.onConvGroupNameUpdated(e):2===o&&t.onConvInGroupUpdated(e):2===i&&t.onConvAddedToOrDeletedFromGroup(n))}))}},{key:"_onAllMsgRead",value:function(e){e=e.dataList;var t=this._sessionM.get(11);t&&t.onPushedAllMessageRead(e)}},{key:"_onUserStatusList",value:function(e){this._sessionM.get(4).onUserStatusUpdated(e)}},{key:"_onMsgExtNotify",value:function(e){this._sessionM.get(3).onMsgExtNotify(e)}},{key:"_onMsgReactionNotifyList",value:function(e){this._sessionM.get(34).onReactionNotifyList(e)}},{key:"_onMsgReactionNotify",value:function(e){this._sessionM.get(34).onReactionNotify(e)}},{key:"_onFollowNotify",value:function(e){this._sessionM.get(35).onFollowNotify(e)}},{key:"_onTopicLatestMsg",value:function(e){this._sessionM.get(10).onTopicLatestMsg(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMsgFromIMOpenPush(e)){var o,i=n.eventArray,s=n.isInstantMessage,a=n.isSyncingEnded,r=n.needSync;if(Xe(i))for(var c,u,l,d=0,p=i.length;d<p;d++)100!==(l=(c=i[d]).event)?24!==l?26!==l?(o=Object.keys(c).find((function(e){return-1!==t._keys.indexOf(e)})))?(u=14===l?{readAllC2CMessage:c[o],groupMessageReadInfoList:c.groupMessageReadNotice||[]}:16===l?{userID:c.userID,timestamp:c.timestamp,readReceiptList:c[o]}:c[o],this._eventHandlerMap.get(o)({event:l,dataList:u,isInstantMessage:s,isSyncingEnded:a,needSync:r})):Pe.l("".concat(this._n,".onMessage unknown eventItem:"),c):this._onTopicLatestMsg(c):this._onAllRcvMsgOptNotify(c):this._onRoomCustomData(c.content)}}},{key:"_onRoomCustomData",value:function(e){this._sessionM.get(30).onRoomCustomDataReceived(e),Pe.l("".concat(this._n,"._onRoomCustomData data:").concat(e))}},{key:"_onAllRcvMsgOptNotify",value:function(e){this._sessionM.get(11).onAllRcvMsgOptNotify(e)}},{key:"_filterMsgFromIMOpenPush",value:function(e){var t=e.head,n=(e=e.body,t=t.servcmd,!1);return!(n=ht(t)?n:t.includes(G.NAME.IM_CONFIG_MANAGER)||t.includes(G.NAME.OVERLOAD_PUSH)||t.includes(G.NAME.STAT_SERVICE))||(t.includes(Kn.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedConfig(e):t.includes(Kn.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(e):t.includes(Kn.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(e):t.includes(Kn.KICK_OTHER)&&(n=Date.now(),this._sessionM.reLoginOnKickOther(),e=new ao("kickOther"),n-=t=this._sessionM.get(1).getLastWsHelloTs(),e.setMessage("last wshello time:".concat(t," diff:").concat(n,"ms")).end()),!1)}}]),Aa),Sa=[{cmd:Kn.GET_GRP_PROFILE,interval:1,count:8},{cmd:Kn.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:Kn.GET_AV_MBR_LIST,interval:3,count:1},{cmd:Kn.GET_GRP_PENDENCY,interval:1,count:15},{cmd:Kn.GET_TOPIC_LIST,interval:1,count:10},{cmd:Kn.SET_GRP_ATTR,interval:5,count:10},{cmd:Kn.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:Kn.DEL_GRP_ATTR,interval:5,count:10},{cmd:Kn.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:Kn.GET_GRP_ATTR,interval:5,count:20},{cmd:Kn.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:Kn.GET_GRP_COUNTER,interval:5,count:20},{cmd:Kn.SET_ALL_MSG_READ,interval:1,count:1},{cmd:Kn.GET_USER_STATUS,interval:5,count:20},{cmd:Kn.SUB_USER_STATUS,interval:5,count:20},{cmd:Kn.UNSUB_USER_STATUS,interval:5,count:20},{cmd:Kn.CS,interval:5,count:20},{cmd:Kn.GRP_CS,interval:5,count:20},{cmd:Kn.MBR_CS,interval:5,count:20},{cmd:Kn.USER_CS,interval:5,count:20},{cmd:Kn.CHECK_FOLLOW_TYPE,interval:5,count:20},{cmd:Kn.GET_GRP_ROAMING_MSG,interval:1,count:20},{cmd:Kn.GET_C2C_ROAMING_MSG,interval:1,count:20}],Da=new Map,ka=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Ra=0,La=ka.length;Ra<La;Ra++)Da.set(Ra,ka[Ra]);function Aa(e){o(this,Aa),this._sessionM=e,this._n="MsgDispatcher",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._onC2CMsgArray.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._onGroupMsgArray.bind(this)),this._eventHandlerMap.set("groupTips",this._onGroupTips.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._onC2CNotifyMsgArray.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._onC2CReadReceiptArray.bind(this)),this._eventHandlerMap.set("profileModify",this._onProfileModified.bind(this)),this._eventHandlerMap.set("friendListMod",this._onRelationChainModified.bind(this)),this._eventHandlerMap.set("recentContactMod",this._onRecentContact.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._onAllMsgRead.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._onC2CMsgModified.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._onGroupMsgModified.bind(this)),this._eventHandlerMap.set("userStatusList",this._onUserStatusList.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._onMsgExtNotify.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._onMsgReactionNotifyList.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._onMsgReactionNotify.bind(this)),this._eventHandlerMap.set("followChangeList",this._onFollowNotify.bind(this)),this._keys=v(this._eventHandlerMap.keys())}function Oa(e){o(this,Oa),this._n="PHandler",this._sessionM=e,this._map=new Map,this._fillMap()}function Na(e){return o(this,Na),(e=ra.call(this,e))._n="ChannelModule",e._socketHandler=new ma(g(e)),e._probing=!1,e._isAppShowing=!0,e._previousState=k.NET_STATE_CONNECTED,e._timerForNotLoggedIn=-1,e._timerForNotLoggedIn=setInterval(e.onCheckTimer.bind(g(e)),1e3),e._fatalErrorFlag=!1,e._disconnectedTS=0,e._lastDiagnoseTS=0,e}function Pa(e){o(this,Pa),this._chM=e,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=fa,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=at(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=U,this._setWebsocketHost(),this._initConnection()}function ba(e){o(this,ba);var t,n,i=(this._handler=e).getURL();this._socket=null,this._workerSocket=null,this._id=at(),this._handler.getIsWorkerEnabled()?(t=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen", extensions: _socket.extensions });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(t),(n=this)._workerSocket.onmessage=function(e){var t=(i=e.data).callback,o=i.e,i=i.extensions;"onOpen"===t?n._onOpen(i):"onClose"===t?n._onClose(o):"onError"===t?n._onError(o):"onMessage"===t&&n._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:i})):ee?J?(ie.connectSocket({url:i,header:{"content-type":"application/json"}}),ie.onSocketClose(this._onClose.bind(this)),ie.onSocketOpen(this._onOpen.bind(this)),ie.onSocketMessage(this._onMessage.bind(this)),ie.onSocketError(this._onError.bind(this))):(this._socket=ie.connectSocket({url:i,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):(this._socket=new WebSocket(i),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this,this._socket.extensions),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=e.canIUseBinaryFrame()}function Ua(e){for(var t,n,o=e,i="",s=0,a=(o=e.length%8!=0?"0".repeat(8-e.length%8)+e:o).length;s<a;s+=8)t=parseInt(o.slice(s,s+4),2),n=parseInt(o.slice(s+4,s+8),2),i+=Da.get(t)+Da.get(n);return i}function Ga(e){if(e<0||53<e)return NaN;var t=0|1073741824*Math.random();return 30<e?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e}function wa(e,t){for(var n=e.toString(16),o=t-n.length,i="0";0<o;o>>>=1,i+=i)1&o&&(n=i+n);return n}r(nc,wn),Wa=f(nc),s(nc,[{key:"_init",value:function(){this._updateCmdFreqLimitMap(Sa)}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");ht(e)||(e=JSON.parse(e),this._updateCmdFreqLimitMap(e))}},{key:"_updateCmdFreqLimitMap",value:function(e){var t=this;e.forEach((function(e){t._cmdFreqLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._pHandler.update()}},{key:"req",value:function(e){Pe.d("".concat(this._n,".req options:"),e);var t=e.P;if(!this._pHandler.has(t))return Pe.w("".concat(this._n,".req unknown P:").concat(t)),kn({code:Hn.NO_PROTOCOL});var n=(e=this.getProtocolData(e)).head.servcmd;if(this._isFreqOverLimit(n))return kn({code:o=Hn.OVER_FREQUENCY_LIMIT,message:this.getErrMsg(o,this._getCmd(n))});if(this._isServerOverload(n))return kn({code:o=Hn.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrMsg(o,this._getCmd(n))});var o=this.get(21);return Ta.includes(t)?o.simplySend(e):o.send(e)}},{key:"getKeyMap",value:function(e){return this._pHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:b,websdkversion:P,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:12775283,sdkability_ext:Ua(""),cappid:e.getApplicationID(),cs:0}}},{key:"genCosSpecifiedHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:b,websdkversion:P,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:Ua(""),cappid:e.getApplicationID(),cs:0}}},{key:"genSSOReportHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:b,websdkversion:P,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:Ua(""),cappid:e.getApplicationID(),cs:0}}},{key:"getProtocolData",value:function(e){return this._pHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd;return e=e.data,n={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd;return e=e.data,n={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"onErrorCodeNotZero",value:function(e){var t,n=e.errorCode;n===Hn.HELLO_ANSWER_KICKED_OUT&&(t=e.kickType,e=void 0===(e=e.newInstanceInfo)?{}:e,1===t?this.onMultipleAccountKickedOut(e):2===t?this.onMultipleDeviceKickedOut(e):3===t&&this.onRestApiKickedOut(e)),n!==Hn.MSG_A2KEY_EXPIRED&&n!==Hn.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(e){var t=(n=e.body).needAck,n=n.sessionData;1===(void 0===t?0:t)&&this._sendACK(n),this._msgDispatcher.onMessage(e)}},{key:"onReconnected",value:function(e){this._incrementalPullContactFlag=e<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Pe.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Pe.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e,t,n,o=this,i="".concat(this._n,"._reLogin");this.isLoggedIn()&&(e=0,(t=this.get(1).getPushModule())&&(e=t.getUniAppPlatform()),n=new ao("reLogin"),this.req({P:Kn.LOGIN,data:{isWebUniapp:e,customInfo:this.get(12).getCustomLoginInfo()}}).then((function(e){var t=(e=e.data).instanceID,s=(e=e.customStatus,o.get(12)),a=ti(e),r=(s.setStatusInstanceID(t),o.get(21)),c=r.getSocketID();c="socketID:".concat(c," instanceID:").concat(t," customStatus:").concat(a),n.setMessage(c).end(!0),Pe.l("".concat(i," ok. ").concat(c)),s.getCustomStatus()!==a&&o.get(4).onUserStatusUpdated({dataList:[{to:o.getMyUserID(),statusType:k.USER_STATUS_ONLINE,customStatus:e}]}),r.diagnose(),o.get(11).syncConvList(o._incrementalPullContactFlag).then((function(){Pe.l("".concat(i,", sync conv list ok.")),o.get(25).start()})),((t=o.get(7))&&t.updateLocalMainSequenceOnReconnected(),c=o.get(10)).resetGetTopicTime(),c.getTopicListOnReconnected(),(s=o.get(35))&&s.clearCacheOnReconnected()})))}},{key:"onMultipleAccountKickedOut",value:function(e){this.get(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.get(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.get(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.req({P:Kn.MSG_PUSH_ACK,data:{sessionData:e}})}},{key:"_isFreqOverLimit",value:function(e){if(e=e.split(".")[1],!this._cmdFreqLimitMap.has(e))return!1;if(!this._cmdReqInfoMap.has(e))return this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1;var t=(n=this._cmdFreqLimitMap.get(e)).count,n=n.interval,o=(i=this._cmdReqInfoMap.get(e)).startTime,i=i.requestCount;return Date.now()-o>1e3*n?(this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1):(this._cmdReqInfoMap.set(e,{startTime:o,requestCount:i+=1}),t<i)}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=(n=this._serverOverloadInfoMap.get(e)).overloadTime,n=n.waitingTime;return Date.now()-t<=1e3*n||(this._serverOverloadInfoMap.delete(e),!1)}},{key:"_getCmd",value:function(e){var t="";if(!e.includes("."))return t;var n,o=e.split(".")[1];for(n in Kn)if(Kn[n]===o){t=n;break}return t}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand;e=e.waitingTime,this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:e}),Pe.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(e,"s cmd:").concat(this._getCmd(t)))}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._updateCmdFreqLimitMap(Sa),this._cmdReqInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var Fa,xa,Va,qa,Ba,Ha,ja,Ka,Ya,za,Wa,Ja=nc,$a=(r(tc,wn),za=f(tc),s(tc,[{key:"getCloudConfig",value:function(e){return ht(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"getServerConfig",value:function(e){var t={code:0,data:""};return!ht(e)&&this._cloudConfig.has(e)&&(t.data=this._cloudConfig.get(e)),Promise.resolve(t)}},{key:"_canFetch",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e,t=this,n="".concat(this._n,".fetchConfig"),o=this._canFetch();Pe.l("".concat(n," canFetch:").concat(o)),o&&(e=new ao("fetchCloudCtrlConfig"),o=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({P:Kn.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:o,version:this._version}}).then((function(o){t._isFetching=!1;var i=(s=o.data).version,s=s.cloudControlConfig;e.setMessage("version:".concat(t._version," newVersion:").concat(i," config:").concat(s)).end(),Pe.l("".concat(n," ok")),t._parse(o.data)})).catch((function(o){t._isFetching=!1,e.setError(o).end(),Pe.l("".concat(n," failed. error:"),o),t._setExpiredTime(12e4)})))}},{key:"onPushedConfig",value:function(e){Pe.l("".concat(this._n,".onPushedConfig config:"),e),new ao("pushedCloudCtrlConfig").setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parse(e)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"_parse",value:function(e){var t=this,n="".concat(this._n,"._parse"),o=e.errorCode,i=e.errorMessage,s=e.cloudControlConfig,a=e.version,r=e.expiredTime;if(0===o){if(this._version!==a){var c=null;try{c=JSON.parse(s)}catch(u){this.isPrivateNetWork()||Pe.e("".concat(n," failed. config:"),s)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=a,this.emitIEvt(Wo.CLOUD_CONFIG))}this._setExpiredTime(1e3*r)}else ht(o)?(Pe.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTime(36e5)):(Pe.e("".concat(n," errorCode:").concat(o," errorMessage:").concat(i)),this._setExpiredTime(12e4))}},{key:"_setExpiredTime",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),tc),Xa=(r(ec,wn),Ya=f(ec),s(ec,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n,o,i=this,s=this._getLocalConvList().filter((function(e){return e.type===k.CONV_GROUP&&e.groupProfile.type!==k.GRP_AVCHATROOM})),a=this.get(11),r=[];s.forEach((function(s){var c=s.conversationID;s=s.lastMessage,e=c.replace(k.CONV_GROUP,""),t=a.getLocalLastMessage(c),s&&0!==s.lastSequence&&t?(n=s.lastSequence,t=t.sequence,o=n-t,0<t&&1<=o&&o<300?i._recoverGroupMsg({groupID:e,localLastMessageSequence:t,remoteLastMessageSequence:n}):r.push(e)):r.push(e)})),this._getGroupNotice(r)}},{key:"_recoverC2CChat",value:function(){var e,t,n,o=this,i=this._getLocalConvList().filter((function(e){return e.type===k.CONV_C2C})),s=this.get(11),a=[Promise.resolve()];i.forEach((function(i){var r=i.conversationID;i=i.lastMessage,e=s.getLocalLastMessage(r),i&&0!==i.lastTime&&e&&(t=i.lastTime,e=e.time,n=t-e,0<e&&1<=n&&n<=600&&a.push(o._recoverC2CMsg({conversationID:r,localLastMessageTime:e,remoteLastMessageTime:t})))})),Promise.all(a).then((function(){Pe.l("".concat(o._n,"._recoverC2CChat all done")),o.get(19).syncOnReconnected()}))}},{key:"_getLocalConvList",value:function(){return this.get(11).getLocalConvList()}},{key:"_recoverGroupMsg",value:function(e){var t=this,n="".concat(this._n,".").concat("_recoverGroupMsg"),o=(Pe.l("".concat(n," options:"),e),e.groupID),i=e.localLastMessageSequence,s=e.remoteLastMessageSequence,a=JSON.stringify(e),r=new ao("_recoverGroupMsg");r.setMessage(a),this._getGroupRoamingMsg({groupID:o,sequence:i}).then((function(e){var c=(e=e.data).complete,u=e.messageList;if(!ht(u)){e=u[0].sequence;var l=u.map((function(e){return e.sequence})),d=(l="".concat(a," complete:").concat(c," sequenceList:").concat(l),Pe.l("".concat(n," ").concat(l)),e!==i&&e<s&&2!==c&&t._recoverGroupMsg({groupID:o,localLastMessageSequence:e,remoteLastMessageSequence:s}),r.setMessage(l).end(),t.get(7));1<u.length&&u.sort((function(e,t){return e.sequence-t.sequence}));for(var p=!1,h=0,g=u.length;h<g;h++)if(u[h].from===k.CONV_SYSTEM){p=!0;break}if(p)for(var _=0,f=u.length;_<f;_++){var m=u[_];m.from!==k.CONV_SYSTEM?d.onNewMessage({dataList:[m],isInstantMessage:!1,updateUnreadCount:!1}):d.onNewGroupTips({event:m.event,dataList:[m]})}else d.onNewMessage({dataList:u,isInstantMessage:!1,updateUnreadCount:!1})}})).catch((function(e){r.setError(e).end(),Pe.w("".concat(n," failed. error:"),e)}))}},{key:"_getGroupNotice",value:function(e){var t=e.length;if(Pe.l("".concat(this._n,"._getGroupNotice length:").concat(t)),0!==t){var n=this.get(7);if(t<=10)n.getNotice(e);else{var o=Math.floor(t/10);5<=o&&(o=5);for(var i=0;i<=o;i++)n.getNotice(e.slice(10*i,10*(i+1)))}}}},{key:"_getGroupRoamingMsg",value:function(e){var t=e.groupID;return e=e.sequence,this.req({P:Kn.GET_GRP_ROAMING_MSG,data:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:e+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMsg",value:function(e){var t=this,n="".concat(this._n,".").concat("_recoverC2CMsg"),o=(Pe.l("".concat(n," options:"),e),e.conversationID),i=e.localLastMessageTime,s=e.remoteLastMessageTime,a=JSON.stringify(e),r=new ao("_recoverC2CMsg");return r.setMessage(a),this._getC2CRoamingMsg({conversationID:o,time:i}).then((function(e){var i=(e=e.data).complete;if(e=e.messageList,!ht(e)){var c=e.length;if(t.get(6).onNewMessage({dataList:e,isInstantMessage:!0}),c=e[c-1].time,e=e.map((function(e){return e.random})),e="".concat(a," complete:").concat(i," randomList:").concat(e),Pe.l("".concat(n," ").concat(e)),r.setMessage(e).end(),c<s&&1!==i)return t._recoverC2CMsg({conversationID:o,localLastMessageTime:c,remoteLastMessageTime:s})}})).catch((function(e){r.setError(e).end(),Pe.w("".concat(n," failed. error:"),e)}))}},{key:"_getC2CRoamingMsg",value:function(e){var t=e.conversationID;return e=e.time,this.req({P:Kn.GET_C2C_ROAMING_MSG,data:{peerAccount:t.replace(k.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:e,direction:1}})}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset"))}}]),ec),Za=(s(Qr,[{key:"addMessageDelay",value:function(e){0<=(e=De()-e)&&this._e2eDelayArray.push(e)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),Ft(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,o=e.max;return t.filter((function(e){return n<=e&&e<o})).length}},{key:"_calcPercent",value:function(e,t){return 100<(e=Ft(e/t*100,2))?100:e}},{key:"_checkE2EDelayException",value:function(e,t){var n,o,i,s=e.filter((function(e){return t<e}));0<s.length&&(n=s.length,o=Math.min.apply(Math,v(s)),i=Math.max.apply(Math,v(s)),s=this._calcAvg(s,n),50<(e=Ft(n/e.length*100,2))&&new ao("messageE2EDelayException").setMessage("count:".concat(n," min:").concat(o," max:").concat(i," avg:").concat(s," percent:").concat(e)).setLevel("warning").end())}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=v(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),o=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),i=this._calcPercent(n,e),s=this._calcPercent(o,e),a=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:i,countLessThan3Second:o,percentOfCountLessThan3Second:s,avgDelay:a}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),Qr),Qa=(s(Zr,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){return 0===t?0:100<(e=Ft(e/t*100,2))?100:e}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,v(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,v(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=v(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),o=this._calcSuccessRateOfRequest(n,e);return t=this._calcAvg(t,n),Pe.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(t)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:o,avgRTT:t}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),Zr),er=(s(Xr,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(ht(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(ht(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(ht(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(ht(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(ht(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){return ht(e)||!this._map.has(e)?-1:100<(e=Ft((e=this._map.get(e)).successCount/e.totalCount*100,2))?100:e}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(ht(e)||!this._map.has(e))return-1;var t=this._map.get(e);return 100<(e=Ft(e=this._calcSuccessCountOfPlatform(e)/t.totalCount*100,2))?100:e}},{key:"_calcTotalCount",value:function(e){return ht(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return ht(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){return ht(e)||!this._map.has(e)?-1:(e=this._map.get(e)).successCount+e.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return ht(e)||!this._map.has(e)?-1:e===Zn?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),o=this._calcSuccessRateOfBusiness(e),i=this._calcSuccessCountOfPlatform(e),s=this._calcSuccessRateOfPlatform(e),a=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:o,successCountOfPlatform:i,successRateOfPlatform:s,avgValue:a}}},{key:"reset",value:function(e){ht(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),Xr),tr=(s($r,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(ht(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var o,i,s=n.conversationID;return n=n.sequence,s=s.replace(k.CONV_GROUP,""),0!==this._lastMap.get(t).size&&this._lastMap.get(t).has(s)?(i=(o=this._lastMap.get(t).get(s)).length-1,n>o[0]&&n<o[i]?(o.push(n),o.sort(),this._lastMap.get(t).set(s,o)):this._addCurrentMap(e)):this._addCurrentMap(e),!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=(e=e.message).conversationID;e=e.sequence,n=n.replace(k.CONV_GROUP,""),this._currentMap.get(t).has(n)||this._currentMap.get(t).set(n,[]),this._currentMap.get(t).get(n).push(e)}},{key:"_copyData",value:function(e){if(!ht(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),o=S(this._currentMap.get(e));try{for(o.s();!(t=o.n()).done;){var i=m(t.value,2),s=i[0],a=i[1];n.set(s,a)}}catch(r){o.e(r)}finally{o.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(ht(this._currentMap.get(e))||ht(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,o){var i=(e=v(e.values())).length;e=e[i-1]-e[0]+1,t+=e,n+=i})),0===t)return null;var o=Ft(n/t*100,2);return 100<o&&(o=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:o}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),$r),nr=(r(Jr,wn),Ka=f(Jr),s(Jr,[{key:"_onLoginSuccess",value:function(){var e=this,t=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),n=t.getItem(this.TAG,!1);!je(n)&&Qe(n.forEach)&&(Pe.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");ht(e)||(this.REPORT_INTERVAL=Number(e)),ht(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),ht(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Pe.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Pe.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Pe.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Pe.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Pe.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Pe.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},o=io[this.get(15).getNetworkType()];switch(ht(o)&&(o=8),o={qualityType:no[e],timestamp:Le(),networkType:o,extension:""},e){case Yn:n=this._avgRTT.getStatResult();break;case zn:n=this._avgE2EDelay.getStatResult();break;case Wn:case Jn:case $n:case Xn:case Zn:n=this._rateMessageSent.getStatResult(e);break;case Qn:case eo:case to:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},o),n)}},{key:"_report",value:function(e){var t=this,n=[],o=null,i=(ht(e)?this._qualityItems.forEach((function(e){null!==(o=t._getQualityItem(e))&&(o.reportIndex=t.reportIndex,o.wholePeriod=t.wholePeriod,n.push(o))})):null!==(o=this._getQualityItem(e))&&(o.reportIndex=this.reportIndex,o.wholePeriod=this.wholePeriod,n.push(o)),Pe.d("".concat(this._n,"._report"),n),0<this._statInfoArr.length&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]),e=this.get(12)).getSDKAppID();e=e.getTinyID(),0<(n=xt(this.REPORT_SDKAPPID_BLACKLIST,i)&&!Vt(this.REPORT_TINYID_WHITELIST,e)?[]:n).length&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,o={header:gs(this),quality:e};this.req({P:Kn.SSO_STAT,data:t({},o)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){Pe.w("".concat(n._n,"._doReport failed. error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._statInfoArr,o="".concat(this._n,"._flushAtOnce");je(t)?(Pe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):(10<(n=n.concat(t)).length&&(n=n.slice(0,10)),Pe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),Jr),or=s((function e(t){o(this,e),je(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.time=t.time||0,this.source=t.source||"",this.wording=t.wording||"",this.type=t.type||"")})),ir=(s(Wr,[{key:"getLocalApplicationList",value:function(){return{friendApplicationList:v(this._map.values()),unreadCount:this._unreadCount}}},{key:"_onApplicationListUpdated",value:function(){this._snsM.emitOEvt(D.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:v(this._map.values()),unreadCount:this._unreadCount})}},{key:"onApplicationRead",value:function(){this._unreadCount=0,this._onApplicationListUpdated()}},{key:"onApplicationAdded",value:function(e,n){var o,i,s=this;je(e)||(o="",o=n===this._snsM.getMyUserID()?k.SNS_APPLICATION_SENT_BY_ME:k.SNS_APPLICATION_SENT_TO_ME,i=!1,e.forEach((function(e){var n="".concat(e.userID,"_").concat(o);o!==k.SNS_APPLICATION_SENT_TO_ME||s._map.has(n)||(s._unreadCount+=1),s._map.set(n,new or(t(t({},e),{},{type:o}))),i=!0})),i&&this._onApplicationListUpdated())}},{key:"onApplicationDeleted",value:function(e){je(e)||(this._startTime=0,this._currentSeq=0,this.getApplicationList())}},{key:"getApplicationList",value:function(){var e=this,t="".concat(this._n,".").concat("getApplicationList"),n=new ao("getApplicationList");return this._snsM.req({P:Kn.GET_FD_APPLICATION_LIST,data:{applicationType:k.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSeq}}).then((function(o){var i=(o=o.data).resultList,s=o.unreadCount,a=o.startTime,r=(o=o.currentSequence,e._startTime=a,e._currentSeq=o,e._unreadCount=s,Xe(i)?i.length:0);r="applicationCount:".concat(r," unreadCount:").concat(s," startTime:").concat(a," currentSequence:").concat(o),n.setMessage(r).end(),Pe.i("".concat(t," ok. ").concat(r)),e._map.clear(),Xe(i)&&i.forEach((function(t){var n=t.userID,o=t.type;t=new or(t),e._map.set("".concat(n,"_").concat(o),t)})),e._onApplicationListUpdated()})).catch((function(e){return n.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"deleteApplication",value:function(e){var t="".concat(this._n,".").concat("deleteApplication"),n=e.userID,o=e.type;if(o&&(o===k.SNS_APPLICATION_SENT_BY_ME||o===k.SNS_APPLICATION_SENT_TO_ME)||(o=k.SNS_APPLICATION_SENT_TO_ME),!this._map.has("".concat(n,"_").concat(o)))return kn({code:Hn.FRIEND_APPLICATION_NOT_EXIST});var i=new ao("deleteApplication");return i.setMessage("userID:".concat(n," type:").concat(o)),this._snsM.req({P:Kn.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[n],type:o}}).then((function(e){var s=(r=(e=e.data.resultList)[0]).to,a=r.resultCode,r=r.resultInfo;return i.setMoreMessage("resultList:".concat(JSON.stringify(e))).end(),Pe.i("".concat(t," ok. userID:").concat(n," type:").concat(o)),0===a?Sn():kn({userID:s,code:a,message:r})})).catch((function(e){return i.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"acceptApplication",value:function(e){var t="".concat(this._n,".").concat("acceptApplication"),n=e.userID,o=e.remark,i=e.tag,s=e.type,a=(s&&(s===k.SNS_APPLICATION_AGREE||s===k.SNS_APPLICATION_AGREE_AND_ADD)||(s=k.SNS_APPLICATION_AGREE_AND_ADD),new ao("acceptApplication"));return a.setMessage("userID:".concat(n," type:").concat(s)),this._snsM.req({P:Kn.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,remark:o,tag:i,action:s}]}}).then((function(e){a.end();var o=(e=e.data.resultList[0]).resultCode;if(e=e.resultInfo,0!==o)return kn({code:o,message:e});Pe.i("".concat(t," ok. userID:").concat(n," type:").concat(s))})).catch((function(e){return a.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"refuseApplication",value:function(e){var t="".concat(this._n,".").concat("refuseApplication"),n=e.userID,o=new ao("refuseApplication");return o.setMessage("userID:".concat(n)),this._snsM.req({P:Kn.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,action:"Response_Action_Reject"}]}}).then((function(e){o.end();var i=(e=e.data.resultList[0]).resultCode;if(e=e.resultInfo,0!==i)return kn({code:i,message:e});Pe.i("".concat(t," ok. userID:").concat(n))})).catch((function(e){return o.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"setApplicationRead",value:function(){var e=this,t="".concat(this._n,".").concat("setApplicationRead"),n=new ao("setApplicationRead");return this._snsM.req({P:Kn.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:Ft(Le()/1e3,0)}}).then((function(o){n.end(),Pe.i("".concat(t," ok")),e._unreadCount=0})).catch((function(e){return n.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"reset",value:function(){this._maxLimited=100,this._currentSeq=0,this._unreadCount=0,this._map.clear()}}]),Wr),sr=(s(zr,[{key:"validate",value:function(e){var t,n=!0,o="";if(je(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,s=null,a=0;a<i;a++){if(s=e.profileCustomField[a],!pt(s.key)||-1===s.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!pt(s.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("profileCustomField"===t)continue;if(je(e[t])&&!pt(e[t])&&!We(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":pt(e[t])||(n=!(o="nick must be a string")),500<st(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(st(e[t])," bytes"),n=!1);break;case"gender":ct(we,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":We(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":pt(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":pt(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":ct(xe,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":We(e.language)||(n=!(o="language must be a number"));break;case"avatar":pt(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":ct(Fe,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":We(e.level)||(n=!(o="level must be a number"));break;case"role":We(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}},{key:"update",value:function(e){var t,n="",o=[];this.friendCustomField.forEach((function(e){o.push(e.key)}));for(var i=0,s=e.length;i<s;i++)if(n=e[i].tag,t=e[i].value,-1<n.indexOf("Tag_SNS_Custom"))-1<o.indexOf(n)?this.friendCustomField.forEach((function(e){e.key===n&&(e.value=t)})):this.friendCustomField.push({key:n,value:t});else if(-1<n.indexOf("Tag_Profile_Custom")){var a=!1;this.profile.profileCustomField.forEach((function(e){e.key===n&&(e.value=t,a=!0)})),a||this.profile.profileCustomField.push({key:n,value:t})}else switch(n){case Ue.NICK:this.profile.nick=t;break;case Ue.GENDER:this.profile.gender=t;break;case Ue.BIRTHDAY:this.profile.birthday=t;break;case Ue.LOCATION:this.profile.location=t;break;case Ue.SELFSIGNATURE:this.profile.selfSignature=t;break;case Ue.ALLOWTYPE:this.profile.allowType=t;break;case Ue.LANGUAGE:this.profile.language=t;break;case Ue.AVATAR:this.profile.avatar=t;break;case Ue.MESSAGESETTINGS:this.profile.messageSettings=t;break;case Ue.ADMINFORBIDTYPE:this.profile.adminForbidType=t;break;case Ue.LEVEL:this.profile.level=t;break;case Ue.ROLE:this.profile.role=t;break;case Ge.REMARK:this.remark=t;break;case Ge.ADDTIME:this.addTime=t;break;case Ge.GROUP:this.groupList=JSON.parse(JSON.stringify(t));break;case Ge.ADDSOURCE:this.source=t;break;case Ge.ADDWORDING:break;default:Pe.d("snsProfileItem unkown tag->",e[i].tag)}this.timestamp=Date.now(),o.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){-1===this.groupList.indexOf(e)&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){-1<(e=this.groupList.indexOf(e))&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}]),zr),ar=(s(Yr,[{key:"getLocalFriendList",value:function(){return v(this._map.values())}},{key:"getFriendRemark",value:function(e){return this._map.has(e)?this._map.get(e).remark:""}},{key:"onFriendProfileModified",value:function(e){var t,n=this;je(e=e.dataList)||(t=this._snsM.get(11),e.forEach((function(e){var o,i=e.userID;e=e.profileList,n.isMyFriend(i)&&(Pe.l("".concat(n._n,".onFriendProfileModified. friend account:").concat(i,", profileList:").concat(JSON.stringify(e))),(o=n._map.get(i)).update(e),t.modifyMessageSentByPeer({conversationID:"".concat(k.CONV_C2C).concat(i),latestNick:o.profile.nick,latestAvatar:o.profile.avatar}))})),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(e){var t=this;0!==e.length&&(Pe.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach((function(e){t._map.set(e,new sr(e))})),this.getFriendProfile({userIDList:e}).then((function(n){e.forEach((function(e){var n=t._map.get(e);0<n.groupList.length&&t._snsM.updateWhenFriendAdded({nameList:n.groupList,userID:e})})),t._onFriendListUpdated()})))}},{key:"onFriendDeleted",value:function(e){var t=this;0!==e.length&&(Pe.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach((function(e){var n=t._map.get(e);0<n.groupList.length&&t._snsM.updateWhenFriendDeleted({nameList:n.groupList,userID:e}),t._map.delete(e)})),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOEvt(D.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getFriendProfile"),o=(e=e.userIDList,[]),i=[],s=[];if(e.forEach((function(e){var n;t._map.has(e)?(n=t._map.get(e),Date.now()-n.timestamp<t._expirationTime?i.push(n):s.push(e)):o.push({userID:e,code:Hn.NOT_MY_FRIEND,message:t._snsM.getErrMsg(Hn.NOT_MY_FRIEND)})})),0===s.length)return Pe.i("".concat(n," newUserIDList is empty")),Dn({friendList:i,failureUserIDList:o});var a=new ao("getFriendProfile");return a.setMessage("userIDList:".concat(s)),Pe.i("".concat(n," userIDList:").concat(s)),this._snsM.req({P:Kn.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:s}}).then((function(e){return a.end(),Pe.i("".concat(n," ok")),e.data.resultList.forEach((function(e){var n,s=e.to,a=e.resultCode,r=e.resultInfo;e=e.tagValueList,ht(a)||0===a?(t._map.has(s)?(n=t._map.get(s)).update(e):(n=new sr(s,e),t._map.set(s,n)),i.push(n)):o.push({userID:s,code:a,message:r})})),Sn({friendList:i,failureUserIDList:o})})).catch((function(e){return a.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"isMyFriend",value:function(e){return this._map.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendList"),n=new ao("getFriendList"),o=Date.now();this._snsM.req({P:Kn.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIdx,standardSequence:this._standardSeq,customSequence:this._customSeq}}).then((function(i){var s=(i=i.data).friendCount,a=i.resultList,r=i.nextStartIndex,c=i.standardSequence,u=i.customSequence;i=i.completeFlag,e._startIdx=r,e._standardSeq=c,e._customSeq=u,s="friendCount:".concat(s," nextStartIndex:").concat(r," standardSequence:").concat(c," ")+"customSequence:".concat(u," completeFlag:").concat(i," cost:").concat(Jt(o)),n.setMessage(s).end(),Pe.i("".concat(t," ok."),s),je(a)||a.forEach((function(t){var n=t.to;t=t.tagValueList,e._map.set(n,new sr(n,t))})),0===i?e.pagingGetFriendList():(e._snsM.emitOEvt(D.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())})).catch((function(e){return n.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"_pagingGetFriendProfile",value:function(){var e=this,t=v(this._map.keys()),n=this._snsM.get(4),o=t.length,i=o<=100?1:Math.ceil(o/100);Pe.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(o," pageCount:").concat(i));for(var s=0;s<i;s++)n.getUserProfile({userIDList:t.slice(100*s,100*(s+1))}).then((function(t){t.data.forEach((function(t){var n=e._map.get(t.userID);n&&n.updateProfile(t)})),e._onFriendListUpdated()}))}},{key:"addFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("addFriend");if(this._map.has(e.to))return kn({code:Hn.ALREADY_MY_FRIEND});if(e.wording&&!1===this._snsM.filterProfanity("wording",e))return kn({code:Hn.PROFANITY_FOUND});var o=e.to,i=e.source,s=e.type,a=e.wording,r=e.remark,c=(e=e.groupName,s),u=(c&&(c===k.SNS_ADD_TYPE_SINGLE||c===k.SNS_ADD_TYPE_BOTH)||(c=k.SNS_ADD_TYPE_BOTH),new ao("addFriend"));return u.setMessage("to:".concat(o," source:").concat(i," type:").concat(c)),this._snsM.req({P:Kn.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:o,source:i,wording:a,remark:r,groupName:e}],type:c}}).then((function(e){e=e.data.resultList;var o=(u.setMoreMessage("resultList:".concat(JSON.stringify(e))).end(),e=e[0]).to,i=e.resultCode;return e=e.resultInfo,Pe.i("".concat(n," ok. to:").concat(o," type:").concat(c," code:").concat(i)),ht(i)||0===i?Sn({userID:o,code:0}):30539===i?Sn({userID:o,code:i,message:t._snsM.getErrMsg(i)}):kn({userID:o,code:i,message:t._snsM.getErrMsg(i)||e})})).catch((function(e){return u.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"deleteFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriend"),o=e.userIDList,i=(e=e.type,1e3<o.length&&(Pe.w("".concat(n," ").concat(Yt(1e3))),o.length=1e3),[]),s=[],a=[];if(o.forEach((function(e){t._map.has(e)?a.push(e):i.push({userID:e,code:Hn.NOT_MY_FRIEND,message:t._snsM.getErrMsg(Hn.NOT_MY_FRIEND)})})),0===a.length)return Dn({successUserIDList:s,failureUserIDList:i});var r=((o=e)&&(o===k.SNS_DELETE_TYPE_SINGLE||o===k.SNS_DELETE_TYPE_BOTH)||(o=k.SNS_DELETE_TYPE_BOTH),new ao("deleteFriend"));return r.setMessage("userIDList:".concat(a," type:").concat(o)),this._snsM.req({P:Kn.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:a,type:o}}).then((function(e){return r.end(),Pe.i("".concat(n," ok")),je(e=e.data.resultList)||e.forEach((function(e){var t=e.to,n=e.resultCode;e=e.resultInfo,ht(n)||0===n?s.push({userID:t}):i.push({userID:t,code:n,message:e})})),Sn({successUserIDList:s,failureUserIDList:i})})).catch((function(e){return r.setError(e).end(),Pe.w("".concat(n," error:"),e),kn(e)}))}},{key:"updateFriend",value:function(e){var t=this,n=e.userID,o=e.remark,i=e.friendCustomField;if(!this._map.has(n))return kn({code:Hn.NOT_MY_FRIEND});var s="".concat(this._n,".").concat("updateFriend"),a=new ao("updateFriend"),r=(a.setMessage("userID:".concat(n," remark:").concat(o," friendCustomField:").concat(i)),[]);return ht(o)||r.push({tag:Ge.REMARK,value:o}),Xe(i)&&0<i.length&&i.forEach((function(e){r.push({tag:e.key,value:e.value})})),this._snsM.req({P:Kn.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:n,snsItem:r}]}}).then((function(e){a.end(),Pe.i("".concat(s," ok"));var n=(e=e.data.resultList[0]).to,r=e.resultCode;return e=e.resultInfo,ht(r)||0===r?((n=t._map.get(n))&&(ht(o)||(n.remark=o),Xe(i)&&0<i.length&&It(n.friendCustomField,i),t._onFriendListUpdated()),Sn(n)):kn({code:r,message:e})})).catch((function(e){return a.setError(e).end(),Pe.w("".concat(s," failed. error:"),e),kn(e)}))}},{key:"checkFriend",value:function(e){var t="".concat(this._n,".").concat("checkFriend"),n=e.userIDList,o=e.type,i=(o&&(o===k.SNS_CHECK_TYPE_SINGLE||o===k.SNS_CHECK_TYPE_BOTH)||(o=k.SNS_CHECK_TYPE_BOTH),new ao("checkFriend"));return i.setMessage("userIDList:".concat(n," type:").concat(o)),this._snsM.req({P:Kn.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:n,type:o}}).then((function(e){i.end(),Pe.i("".concat(t," ok. userIDList:").concat(n," type:").concat(o));var s=[],a=[];return Xe(e=e.data.resultList)&&e.forEach((function(e){var t=e.to,n=e.relation,o=e.resultCode;e=e.resultInfo,ht(o)||0===o?s.push({userID:t,code:0,relation:n}):a.push({userID:t,code:o,message:e})})),Sn({successUserIDList:s,failureUserIDList:a})})).catch((function(e){return i.setError(e).end(),Pe.w("".concat(t," failed. error:"),e),kn(e)}))}},{key:"onAddedToFriendGroup",value:function(e){var t=this,n=e.name;e=e.userIDList,Pe.l("".concat(this._n,".onAddedToFriendGroup groupName:").concat(n," userIDList:").concat(e)),n&&!je(e)&&e.forEach((function(e){t._map.has(e)&&t._map.get(e).addToGroupList(n)}))}},{key:"onRemovedFromFriendGroup",value:function(e){var t=this,n=e.name;e=e.userIDList,Pe.l("".concat(this._n,".onRemovedFromFriendGroup groupName:").concat(n," userIDList:").concat(e)),n&&!je(e)&&e.forEach((function(e){t._map.has(e)&&t._map.get(e).removeFromGroupList(n)}))}},{key:"reset",value:function(){this._map.clear(),this._startIdx=0,this._standardSeq=0,this._customSeq=0}}]),Yr),rr=(s(Kr,[{key:"addToUserIDList",value:function(e){-1===this.userIDList.indexOf(e)&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){-1<(e=this.userIDList.indexOf(e))&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}]),Kr),cr=(s(jr,[{key:"getLocalGroupList",value:function(){return v(this._map.values())}},{key:"_onGroupListUpdated",value:function(){var e=v(this._map.values());this._snsM.emitOEvt(D.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList"),n=new ao("getGroupList");return this._snsM.req({P:Kn.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then((function(o){n.end(),je(o=o.data.resultList)?Pe.i("".concat(t," ok. count:0")):(Pe.i("".concat(t," ok. count:").concat(o.length)),e._map.clear(),o.forEach((function(t){var n=new rr(t);e._map.set(t.name,n)})),e._onGroupListUpdated())})).catch((function(e){return n.setError(e).end(),Pe.w("".concat(t," error:"),e),kn(e)}))}},{key:"createGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("createGroup"),o=e.name;if(e=e.userIDList,this._map.has(o))return kn({code:Hn.FRIEND_GRP_EXISTED});var i="name:".concat(o," userIDList:").concat(e),s=new ao("createGroup");return s.setMessage(i),this._snsM.req({P:Kn.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[o],userIDList:Xe(e)?e:void 0}}).then((function(e){s.end(),Pe.l("".concat(n," ok. ").concat(i)),e=e.data.resultList;var a=[],r=[];return e&&e.forEach((function(e){var t=e.to,n=e.resultCode,o=e.resultInfo;ht(n)||0===n?a.push(t):(t={userID:e.to,code:n,message:o},r.push(t))})),e=new rr({name:o,userIDList:a}),t._map.set(o,e),t._snsM.onAddedToFriendGroup({name:o,userIDList:a}),t._onGroupListUpdated(),Sn({friendGroup:e,failureUserIDList:r})})).catch((function(e){return s.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"deleteGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroup"),o=e.name;if(!this._map.has(o))return this._onGroupNotExist();var i="name:".concat(o),s=new ao("deleteGroup");return s.setMessage(i),this._snsM.req({P:Kn.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[o]}}).then((function(e){s.end(),Pe.l("".concat(n," ok. ").concat(i));var a=t._map.get(o);return a&&(t._snsM.onRemovedFromFriendGroup({name:o,userIDList:a.userIDList}),t._map.delete(o),a.userIDList.length=0),t._onGroupListUpdated(),Sn(a)})).catch((function(e){return s.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"renameGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("renameGroup"),o=e.oldName,i=e.newName;if(!this._map.has(o))return this._onGroupNotExist();var s="oldName:".concat(o," newName:").concat(i),a=new ao("renameGroup");return a.setMessage(s),this._snsM.req({P:Kn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,newName:i}}).then((function(){var e;return a.end(),Pe.l("".concat(n," ok. ").concat(s)),t._map.has(o)?((e=t._map.get(o)).name=i,t._map.delete(o),t._map.set(i,e),t._snsM.onRemovedFromFriendGroup({name:o,userIDList:e.userIDList}),t._snsM.onAddedToFriendGroup({name:i,userIDList:e.userIDList}),t._onGroupListUpdated(),Sn(e)):Sn()})).catch((function(e){return a.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"addToGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("addToGroup"),o=e.name;if(e=e.userIDList,!this._map.has(o))return this._onGroupNotExist();var i="name:".concat(o," userIDList:").concat(e),s=new ao("addToGroup");return s.setMessage(i),this._snsM.req({P:Kn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:e.filter((function(e){return t._snsM.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Add"}}))}}).then((function(e){return s.end(),Pe.l("".concat(n," ok. ").concat(i)),t._onGroupUpdated(o,e)})).catch((function(e){return s.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"removeFromGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("removeFromGroup"),o=e.name;if(e=e.userIDList,!this._map.has(o))return this._onGroupNotExist();var i="name:".concat(o," userIDList:").concat(e),s=new ao("removeFromGroup");return s.setMessage(i),this._snsM.req({P:Kn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:e.filter((function(e){return t._snsM.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Delete"}}))}}).then((function(e){return s.end(),Pe.l("".concat(n," ok. ").concat(i)),t._onGroupUpdated(o,e)})).catch((function(e){return s.setError(e).end(),Pe.w("".concat(n," failed. error:"),e),kn(e)}))}},{key:"_onGroupUpdated",value:function(e,t){t=t.data.resultList;var n=this._map.get(e),o=[],i=[],s=[];return Xe(t)&&t.forEach((function(e){var t=e.to,a=e.resultCode,r=e.resultInfo,c=e.type;0===a?"Update_Type_Add"===c?n&&(n.addToUserIDList(t),i.push(t)):"Update_Type_Delete"===c&&n&&(n.removeFromUserIDList(t),s.push(t)):o.push({to:e.to,code:a,message:r})})),Pe.l("".concat(this._n,"._onGroupUpdated name:").concat(e," userIDList:").concat(n.userIDList)),0<i.length&&this._snsM.onAddedToFriendGroup({name:e,userIDList:i}),0<s.length&&this._snsM.onRemovedFromFriendGroup({name:e,userIDList:s}),Sn({friendGroup:n,failureUserIDList:o})}},{key:"updateWhenFriendAdded",value:function(e){var t=this,n=e.nameList,o=e.userID;Pe.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(o," nameList:").concat(n)),je(n)||n.forEach((function(e){t._map.has(e)&&t._map.get(e).addToUserIDList(o)}))}},{key:"updateWhenFriendDeleted",value:function(e){var t=this,n=e.nameList,o=e.userID;Pe.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(o," nameList:").concat(n)),je(n)||n.forEach((function(e){t._map.has(e)&&t._map.get(e).removeFromUserIDList(o)}))}},{key:"_onGroupNotExist",value:function(e){return kn({code:Hn.FRIEND_GRP_NOT_EXIST})}},{key:"reset",value:function(){this._map.clear()}}]),jr),ur=(r(Hr,wn),ja=f(Hr),s(Hr,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getGroupList(),this._friendApplicationHandler.getApplicationList()}},{key:"onRelationChainModified",value:function(e){var t,n,o,i,s,a,r=this;je(e=e.dataList)||(t=[],n=[],o=[],s=!(i=[]),a="",e.forEach((function(e){var c;3!==e.pushType&&4!==e.pushType||!e.from||(a=e.from),e.friendAddAccount&&(t.push.apply(t,v(e.friendAddAccount)),i.push.apply(i,v(e.friendAddAccount))),e.friendDelAccount&&n.push.apply(n,v(e.friendDelAccount)),e.friendApplicationAdded&&o.push.apply(o,v(e.friendApplicationAdded)),e.friendApplicationDeletedUserIDList&&i.push.apply(i,v(e.friendApplicationDeletedUserIDList)),e.reportTime&&7===e.pushType&&(s=!0),e.friendUpInfo&&(c={dataList:[]},e.friendUpInfo.forEach((function(e){c.dataList.push({userID:e.friendAccount,profileList:v(e.sns)})})),r.onFriendProfileModified(c))})),s&&this._friendApplicationHandler.onApplicationRead(),this._friendApplicationHandler.onApplicationAdded(o,a),this._friendApplicationHandler.onApplicationDeleted(i),this._friendHandler.onFriendAdded(t),this._friendHandler.onFriendDeleted(n))}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],"sns")).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this._friendHandler.getLocalFriendList();return e?Dn(t):t}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"onAddedToFriendGroup",value:function(e){this._friendHandler.onAddedToFriendGroup(e)}},{key:"onRemovedFromFriendGroup",value:function(e){this._friendHandler.onRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){return Dn(this._friendApplicationHandler.getLocalApplicationList())}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){return Dn(this._friendGroupHandler.getLocalGroupList())}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Hr),lr=(r(Br,wn),Ha=f(Br),s(Br,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&fe}},{key:"startWorkerTimer",value:function(){Pe.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Pe.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var e,t;fe&&(e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(e),(t=this)._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Pe.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()})}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("enable_worker");Pe.l("".concat(this._n,"._onCloudConfig enableWorker:").concat(e)),ht(e)||"1"===e?!this._isWorkerEnabled&&fe&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&fe&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Pe.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset"))}}]),Br),dr=(s(qr,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&1<=e.length&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._featureMap.clear();for(var t,n=e.length-1,o=0;0<=n;n--,o++)t=(o<32?new A(0,Math.pow(2,o)):new A(Math.pow(2,o-32),0)).toString(),"1"===e[n]?this._featureMap.set(t,!0):this._featureMap.set(t,!1)}else Pe.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._featureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,o=!0,i=t.length-1,s=0;0<=i;i--,s++)if("1"===t.charAt(i)&&(n=(s<32?new A(0,Math.pow(2,s)):new A(Math.pow(2,s-32),0)).toString(),!this._featureMap.get(n))){o=!1;break}return Pe.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," key:").concat(n," ret:").concat(o)),Dn({enabled:o})}},{key:"isFeatureEnabledForStat",value:function(e){for(var t=parseInt(e).toString(2),n=t.length-1,o=0;0<=n;n--,o++)if("1"===t.charAt(n)){if(i=(o<32?new A(0,Math.pow(2,o)):new A(Math.pow(2,o-32),0)).toString(),!this._featureMap.get(i))break;var i,s="",a=0;i===w.PLUGIN_TRANSLATE?(s="plugin_translate",a=16):i===w.PLUGIN_VOICE_TO_TEXT?(s="plugin_voice_to_text",a=17):i===w.PLUGIN_CS?(s="plugin_cs",a=14):i===w.PLUGIN_PUSH?(s="plugin_push",a=13):i===w.PLUGIN_BOT?(s="plugin_bot",a=15):i===w.MSG_REACTION&&(s="plugin_emoji_reaction",a=18),""!==s&&(i=this._commercialConfigM.get(12).getUIPlatform(),new ao(s).setCode(a).setUIPlatform(i).end(),Pe.l("".concat(this._n,".isFeatureEnabledForStat ").concat(s," code:").concat(a," uiPlatform:").concat(i)))}}},{key:"isCSPluginEnabled",value:function(){var e;this._isCSPluginReported||(e=this._commercialConfigM.get(12).getUIPlatform(),new ao("plugin_search").setCode(6).setUIPlatform(e).end(),this._isCSPluginReported=!0)}},{key:"clear",value:function(){this._featureMap.clear(),this._isCSPluginReported=!1}}]),qr),pr=(s(Vr,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e,t,n=this,o=this._canFetch(),i="".concat(this._n,".fetchConfig");Pe.l("".concat(i," canFetch:").concat(o)),o&&(e=new ao("fetchCommercialConfig"),o=this.get(12).getSDKAppID(),t=this.get(20),this._isFetching=!0,t.req({P:Kn.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:o}}).then((function(t){e.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Pe.l("".concat(i," ok.")),n._parseConfig(t.data),n._isFetching=!1})).catch((function(t){e.setError(t).end(),n._isFetching=!1})))}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));Pe.l("".concat(t)),new ao("pushedCommercialConfig").setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,o=e.errorMessage,i=e.purchaseBits,s=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(i),this._expiredTime=Date.now()+1e3*s):ht(n)?(Pe.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Pe.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"isFeatureEnabledForStat",value:function(e){this._purchasedFeatureHandler.isFeatureEnabledForStat(e)}},{key:"isCSPluginEnabled",value:function(){this._purchasedFeatureHandler.isCSPluginEnabled()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),Vr),hr=(r(xr,wn),Ba=f(xr),s(xr,[{key:"registerPlugin",value:function(e){var t,n,o,i,s,a,r,c,u,l,d,p,h;X?(this._offlinePushPlugin=e["tim-offline-push-plugin"],t=(h=e.offlinePushConfig||{}).huaweiBusinessID,n=h.xiaomiBusinessID,o=h.xiaomiAppID,i=h.xiaomiAppKey,s=h.meizuBusinessID,a=h.meizuAppID,r=h.meizuAppKey,c=h.vivoBusinessID,u=h.oppoBusinessID,l=h.oppoAppKey,d=h.oppoAppSecret,p=h.honorBusinessID,h=h.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=t,this._androidPushConfig.xiaomiPushBussinessId=n,this._androidPushConfig.xiaomiPushAppId=o,this._androidPushConfig.xiaomiPushAppKey=i,this._androidPushConfig.meizuPushBussinessId=s,this._androidPushConfig.meizuPushAppId=a,this._androidPushConfig.meizuPushAppKey=r,this._androidPushConfig.vivoPushBussinessId=c,this._androidPushConfig.oppoPushBussinessId=u,this._androidPushConfig.oppoPushAppKey=l,this._androidPushConfig.oppoPushAppSecret=d,this._androidPushConfig.honorPushBussinessId=p,new ao("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!ht(this._offlinePushPlugin))).end(!0),Pe.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=h,this._setAppShowListener()):this.warn("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Qe(this._offlinePushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),Pe.l("".concat(n," start. ").concat(e)),new ao("_getDeviceToken").setMessage("".concat(e)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var i,s,a,r,c=new ao("getDeviceTokenRes"),u=o.code,l=o.msg;0===u?(i=(r=o.data).deviceToken,s=r.deviceBrand,a=r.deviceType,r=r.bussinessId,t._deviceToken=i,t._businessID=r||t._iosBusinessID,e="deviceToken:".concat(i,", deviceBrand:").concat(s||a,", businessID:").concat(t._businessID),Pe.l("".concat(n," ok. ").concat(e)),c.setMessage(e).end(!0),t._setToken()):(c.setMessage("code:".concat(u,", msg:").concat(l)).end(!0),Pe.e("".concat(n," failed. error:"),o))}))):Pe.e("".concat(n," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return X&&!ht(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");ht(this._offlinePushPlugin)?Pe.e("".concat(t," offlinePushPlugin is undefined")):Qe(this._offlinePushPlugin.setAppShowListener)?(new ao("_setAppShowListener").end(!0),Pe.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){n=(n||{}).appShow,new ao("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),Pe.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(0===n?(e._getConvUnreadCount(),e._onBackground()):1===n&&e._onForeground())}))):Pe.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!ht(this._offlinePushPlugin)&&Qe(this._offlinePushPlugin.getDeviceType))return e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,Pe.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,"._setToken"),t=this.get(12),n=1,o="",i="",s=(je(this._deviceToken)&&(n=0),this.getUniAppPlatform()),a=this.getDeviceBrand(),r=(s===N.IOS||s===N.IPAD||s===N.MAC?i=this._deviceToken:s===N.ANDROID&&(o=this._deviceToken),new ao("offlinePushSetToken"));return s="deviceToken:".concat(i||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(a,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(n,", platform:").concat(s),r.setMessage("".concat(s)),Pe.l("".concat(e," ").concat(s)),this.req({P:Kn.SET_TOKEN,data:{tokenID:o,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:a,deviceToken:i,isWebUniapp:this._isWebUniapp}}).then((function(t){return r.end(),Pe.l("".concat(e," ok")),t})).catch((function(t){return r.setError(t).end(),Pe.e("".concat(e," failed. error:"),t),kn(t)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach((function(t){t.type===k.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===k.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new ao("_onBackground");this.req({P:Kn.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(o){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Pe.l("".concat(t," ok")),o})).catch((function(e){n.setError(e).end(),Pe.e("".concat(t," failed. error:"),e)}))}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new ao("_onForeground");this.req({P:Kn.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then((function(n){return t.end(),Pe.l("".concat(e," ok")),n})).catch((function(n){t.setError(n).end(),Pe.e("".concat(e," failed. error:"),n)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?N.IOS:"android"===e?N.ANDROID:1002===t?N.IPAD:1001===t?N.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Pe.l("".concat(this._n,".reset"))}}]),xr),gr=(r(Fr,wn),qa=f(Fr),s(Fr,[{key:"registerPlugin",value:function(e){var t,n,o;X?(t="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=e["tim-push"],this._getDeviceInfo(),n=(o=e.pushConfig||{}).androidConfig,o=o.iOSConfig,Je(n)&&(this._androidPushConfig=n[this._deviceInfo.packageName]),n=(o||{}).iOSBusinessID,this._iOSBusinessID=n,o=!ht(this._pushPlugin),new ao("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(o)).end(!0),Pe.l("".concat(t," ok. pushConfig:").concat(JSON.stringify(e.pushConfig))),o?(this._setAppShowListener(),this._setPushEventReportListener()):Pe.e("".concat(t," ").concat(this._pluginName," is undefined"))):this.warn("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var e=this,n="".concat(this._n,".").concat("_reportEventCacheList");Qe(this._pushPlugin.getPushEventCacheList)?(new ao("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList((function(o){var i=o.code,s=o.data.eventList,a=new ao("getPushEventCacheListRes");if(a.setCode(i),0!==i)a.setMessage("res:".concat(JSON.stringify(o))).end(!0),Pe.e("".concat(n," failed. error:").concat(JSON.stringify(o)));else{i=s.length<10?"eventList:".concat(JSON.stringify(s)):"eventList.length:".concat(s.length),Pe.l("".concat(n," ok. ").concat(i)),a.setMessage(i).end(!0);for(var r=t(t({},o.data),{},{eventList:[]});0<s.length;)r.eventList=s.splice(0,40),e._pushReport(r)}}))):Pe.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Qe(this._pushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),Pe.l("".concat(n," start. ").concat(e)),new ao("_getDeviceToken").setMessage("".concat(e)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var i,s,a,r=o.code,c=o.msg,u=new ao("getDeviceTokenRes");if(u.setCode(r),0===r)return i=(r=o.data).deviceToken,s=r.deviceBrand,a=r.deviceType,r=r.bussinessId,t._deviceToken=i,t._businessID=r||t._iOSBusinessID,e="deviceToken:".concat(i," deviceBrand:").concat(s||a," businessID:").concat(t._businessID),Pe.l("".concat(n," ok. ").concat(e)),u.setMessage(e).end(!0),void t._setToken();u.setMessage(c).end(!0),Pe.e("".concat(n," failed. error:").concat(JSON.stringify(o)))}))):Pe.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var e="".concat(this._n,".").concat("_getDeviceInfo");if(Qe(this._pushPlugin.getDeviceInfo)){var n=this._pushPlugin.getDeviceInfo(),o=n.code,i=n.data,s=new ao("_getDeviceInfo");if(s.setCode(o),0===o)return this._deviceInfo=t(t({},this._deviceInfo),i),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),o="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),Pe.l("".concat(e," ok. ").concat(o)),void s.setMessage(o).end(!0);s.setMessage("deviceInfoRes:".concat(JSON.stringify(n))).end(!0),Pe.e("".concat(e," failed. error:").concat(JSON.stringify(n)))}else Pe.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return X&&!ht(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");Qe(this._pushPlugin.setAppShowListener)?(new ao("_setAppShowListener").end(!0),Pe.l("".concat(t," start")),this._pushPlugin.setAppShowListener((function(n){n=(n||{}).appShow,new ao("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),Pe.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(0===n?(e._getConvUnreadCount(),e._onBackground()):1===n&&e._onForeground())}))):Pe.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setPushEventReportListener");Qe(this._pushPlugin.setPushEventReportListener)?(new ao("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener((function(n){var o=n.code,i=n.data,s=i.eventList,a=new ao("setPushEventReportListenerRes");if(a.setCode(o),0===o)return o="eventList:".concat(JSON.stringify(s)),Pe.l("".concat(t," ok. ").concat(o)),a.setMessage(o).end(!0),void(e._m.isReady()&&Xe(s)&&0<s.length&&e._pushReport(i));a.setMessage("res:".concat(JSON.stringify(n))).end(!0),Pe.e("".concat(t," failed. error:").concat(JSON.stringify(n)))}))):Pe.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!ht(this._pushPlugin)&&Qe(this._pushPlugin.getDeviceType))return e=(this._pushPlugin.getDeviceType()||{}).deviceType,Pe.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,".").concat("_setToken"),n=this.get(12),o=1,i="",s="",a=(je(this._deviceToken)&&(o=0),this.getUniAppPlatform()),r=this.getDeviceBrand(),c=(a===N.IOS||a===N.IPAD||a===N.MAC?s=this._deviceToken:a===N.ANDROID&&(i=this._deviceToken),a=t({tokenID:i,pushMsg:o,sdkAppID:n.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:r,deviceToken:s,isWebUniapp:this._isWebUniapp},this._deviceInfo),new ao("_setToken"));i="data:".concat(JSON.stringify(a)),c.setMessage("".concat(i)),Pe.l("".concat(e," ").concat(i)),this.req({P:Kn.SET_TOKEN,data:a}).then((function(){c.end(),Pe.w("".concat(e," ok"))})).catch((function(t){c.setError(t).end(),Pe.e("".concat(e," failed. error:"),t),kn(t)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach((function(t){t.type===k.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===k.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new ao("_onBackground");this.req({P:Kn.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(){n.setMessage("c2cUnreadCount:".concat(e._c2cUnreadCount," groupUnreadCount:").concat(e._groupUnreadCount)).end(),Pe.l("".concat(t," ok"))})).catch((function(e){n.setError(e).end(),Pe.e("".concat(t," failed. error:"),e)}))}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new ao("_onForeground");this.req({P:Kn.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then((function(){t.end(),Pe.l("".concat(e," ok"))})).catch((function(n){t.setError(n).end(),Pe.e("".concat(e," failed. error:"),n)}))}},{key:"_pushReport",value:function(e){var t=this,n="".concat(this._n,".").concat("_pushReport"),o=new ao("_pushReport");this.req({P:Kn.PUSH_REPORT,data:{eventList:e.eventList}}).then((function(){o.end(),t._notifyReportSuccess(e)})).catch((function(e){o.setError(e).end(),Pe.e("".concat(n," failed. error:"),e)}))}},{key:"_notifyReportSuccess",value:function(e){!ht(this._pushPlugin)&&Qe(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(e),Pe.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?N.IOS:"android"===e?N.ANDROID:1002===t?N.IPAD:1001===t?N.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Pe.l("".concat(this._n,".reset"))}}]),Fr),_r=(r(wr,wn),Va=f(wr),s(wr,[{key:"init",value:function(){var e=this.get(18).getPlugin("tim-profanity-filter-plugin");e&&(this._plugin=new e({logger:Pe,isArray:Xe,isMap:Ke,isDevMode:this.isDevMode()}),this._getLexicon())}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;t=e.type;var o=e.conversationType;if(t!==k.MSG_TEXT&&t!==k.MSG_CUSTOM)return n;var i,s="".concat(this._n,".filterMessage");if(Pe.l("".concat(s)),t===k.MSG_TEXT){if(o===k.CONV_C2C?i="c2c_text_message":o===k.CONV_GROUP&&(i="group_text_message"),!this._isConfigOn(i))return n;var a=(r=this._plugin.filter(e.payload.text)).type,r=r.modifiedText;1===a?n=!1:2===a&&(e.payload.text=r)}else if(t===k.MSG_CUSTOM){if(o===k.CONV_C2C?i="c2c_custom_message":o===k.CONV_GROUP&&(i="group_custom_message"),!this._isConfigOn(i))return n;a=this._plugin.filter(e.payload.data),r=this._plugin.filter(e.payload.description),t=this._plugin.filter(e.payload.extension),1===a.type||1===r.type||1===t.type?n=!1:(2===a.type&&(e.payload.data=a.modifiedText),2===r.type&&(e.payload.description=r.modifiedText),2===t.type&&(e.payload.extension=t.modifiedText))}return Pe.l("".concat(s," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),o={isAllowedToSend:!0,modifiedText:e};return this._plugin&&this._canIUseLexicon&&this._isConfigOn(t)?(Pe.l("".concat(n)),e=(t=this._plugin.filter(e)).type,t=t.modifiedText,1===e?o.isAllowedToSend=!1:2===e&&(o.modifiedText=t),Pe.l("".concat(n," done. ret:"),o),o):o}},{key:"_getLexicon",value:function(){var e=this,t=new ao("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({P:Kn.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then((function(o){var i=(o=o.data).errorInfo,s=o.filterConfig,a=o.lexicon,r=o.strToken,c=o.completeFlag,u=o.nextStartIndex,l=o.version,d=(o=o.expiredTime,i.errorCode),p=i.errorMessage;return 0!==d?(e._isFetching=!1,Pe.w("".concat(n," failed. error:"),i),void t.setCode(d).setMessage(p).end()):(e._onFilterConfig(s),e._getToken(r),1===c?(Pe.l("".concat(n," done. version:").concat(l," expiredTime:").concat(o)),e._version=l,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*o,void e._plugin.onLexiconCompleted(a)):(e._startIndex=u,e._plugin.onLexiconSliced(a),void e._getLexicon()))})).catch((function(o){t.setError(o).end(),e._isFetching=!1,Pe.l("".concat(n," failed. error:"),o)}))}},{key:"_onFilterConfig",value:function(e){var t=this;je(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Pe.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(pt(e)){var t=e.length,n="";if(t%2==0)for(var o=0;o<=t-1;o+=2)n=(n+=e[o+1])+e[o];else{for(var i=0;i<t-1;i+=2)n=(n+=e[i+1])+e[i];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),wr),fr=(s(Gr,[{key:"_onCloudConfig",value:function(){var e=this,t=this._m.get(23).getCloudConfig("rtc_cmd");ht(t)||((t=JSON.parse(t)).forEach((function(t){e._TRTCCommandList.includes(t)||e._TRTCCommandList.push(t)})),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var e,t=0,n=this._TRTCCommandList.length;t<n;t++)e=this._TRTCCommandList[t].split(".")[0],this._TRTCCommandMap.set(e,1)}},{key:"onRoomCustomDataReceived",value:function(e){this._m.getOEmitInst().emit(D.ROOM_CUSTOM_DATA_RECEIVED,e)}},{key:"sendTRTCCustomData",value:function(e){var t=e.serviceCommand,n=(e=e.data,"".concat(G.NAME.TUIROOM_SVR,".*"));return ht(t)||(n=t),this._isValidServiceCommand(n)?this._trans({servcmd:n,data:e}):kn({code:Hn.INVALID_TRTC_CMD})}},{key:"_trans",value:function(e){Pe.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.servcmd;return e=e.data,this._m.get(20).trans({servcmd:t,data:pt(e)?JSON.parse(e):e})}},{key:"_isValidServiceCommand",value:function(e){return e.endsWith(".*")?this._TRTCCommandList.includes(e):(e=e.split(".")[0],this._TRTCCommandMap.has(e))}},{key:"isTRTCCommand",value:function(e){return e=e.split(".")[0],this._TRTCCommandMap.has(e)}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset"))}}]),Gr),mr=(s(Ur,[{key:"_init",value:function(){var e,t=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(t){try{e=JSON.parse(t)}catch(n){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),Pe.w("".concat(this._n,"._init error:"),n)}e&&(this._needToUpdate(e)?this._fetch():this._fillMap(e.message))}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime;return e=e.localSavedVersion,t=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,e=!e||"3.5.2"!==e,Pe.l("".concat(this._n,"._needToUpdate isTimeout:").concat(t," isDifferentVersion:").concat(e)),t||e}},{key:"_fetch",value:function(){var e,t,n,o,i,s;this._m.get(12).isPrivateNetWork()||(e="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.7/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),o=this,ee?ie.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){o._fillAndSave(e.data),Pe.l("".concat(n," mini program"))},fail:function(){}}):(i=new XMLHttpRequest,s=setTimeout((function(){i.abort()}),3e3),i.onreadystatechange=function(){4===i.readyState&&(s&&clearTimeout(s),200!==i.status&&304!==i.status||(Pe.l("".concat(n," browser")),o._fillAndSave(i.responseText)))},i.open("GET",e,!0),i.setRequestHeader("Content-type",t),i.send()))}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"3.5.2"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,o=e.split(";\n"),i=o.length,s=new RegExp(/'/g),a=0;a<i;a++)if(n=o[a].indexOf(":"),t=o[a].slice(0,n),n=o[a].slice(n+1,o[a].length),!t.startsWith("//")){if(ht(n))continue;this._map.set(t,n.replace(s,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,o=e.replacement1;return e=e.replacement2,t="".concat(n,t?"_en":"_cn"),!this._map.has(t)&&this._map.has(n)&&(t=n),n="",this._map.has(t)&&(n=this._map.get(t),ht(o)||(n=n.replace("$replacement1",o)),ht(e)||(n=n.replace("$replacement2",e))),n}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset"))}}]),Ur),vr=(s(br,[{key:"onNewMessageList",value:function(e){var t=this;e.forEach((function(e){var n=t.getPayloadData(e);n&&t._handleActionType(n,e)}))}},{key:"onMessageModified",value:function(e){var t=this;e.forEach((function(e){var n=t.getPayloadData(e);n&&t._onInvitationModified(n,e)}))}},{key:"getPayloadData",value:function(e){var t="".concat(this._n,".getPayloadData");e=e.payload.data;try{return JSON.parse(e)}catch(n){return Pe.e("".concat(t," JSON parse error. signalingData:").concat(e)),null}}},{key:"_handleActionType",value:function(e,t){switch(e.actionType){case R.ACTION_TYPE_INVITE:this._onNewInvitationReceived(e,t);break;case R.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(e);break;case R.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(e);break;case R.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(e);break;case R.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(e)}}},{key:"_genBaseEmitData",value:function(e){return{inviteID:e.inviteID,inviter:e.inviter,groupID:e.groupID,data:e.data||""}}},{key:"_onNewInvitationReceived",value:function(e,n){var o="".concat(this._n,"._onNewInvitationReceived"),i=e.inviteID,s=e.inviteeList,a=e.groupID,r=e.inviter,c=this._sigM.getMyUserID(),u=s.includes(c),l=e.timeout,d=(Ee().getTime()-1e3*n.time)/1e3;0<l&&0<d&&d<l&&(l-=d),o="".concat(o," myselfIncluded:").concat(u," groupID:").concat(a," signalObj:").concat(JSON.stringify(e)),Pe.l("".concat(o," timeout:").concat(l,"s delta:").concat(d,"s")),(a&&u||!a)&&((o=this._sigM.getInviteInfo(i))&&o===e||(o||this._sigM.setInviteInfo(i,t(t({},e),{},{message:n})),this._sigM.emitEvent(R.NEW_INVITATION_RECEIVED,t(t({},this._genBaseEmitData(e)),{},{inviteeList:s})),r!==c&&this._sigM.startTimer(t(t({},e),{},{timeout:l}))))}},{key:"_onInviteeRejected",value:function(e){var n="".concat(this._n,"._onInviteeRejected"),o=e.inviteID,i=e.inviter,s=e.groupID,a=this._sigM.hasInviteInfo(o);Pe.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(a," inviter:").concat(i," groupID:").concat(s)),a&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(R.INVITEE_REJECTED,t(t({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(e){var n="".concat(this._n,"._onInviteeAccepted"),o=e.inviteID,i=e.inviter,s=e.groupID,a=this._sigM.hasInviteInfo(o);Pe.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(a," inviter:").concat(i," groupID:").concat(s)),a&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(R.INVITEE_ACCEPTED,t(t({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(e){var t="".concat(this._n,"._onInvitationCancelled"),n=e.inviteID,o=e.inviter,i=e.groupID,s=this._sigM.hasInviteInfo(n);Pe.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(s," inviter:").concat(o," groupID:").concat(i)),s&&(this._sigM.deleteInviteInfo(n),this._sigM.emitEvent(R.INVITATION_CANCELLED,this._genBaseEmitData(e)))}},{key:"_onInvitationTimeout",value:function(e){var n="".concat(this._n,"._onInvitationTimeout"),o=e.inviteID,i=e.inviter,s=e.groupID,a=e.inviteeList,r=this._sigM.hasInviteInfo(o);Pe.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(r," inviter:").concat(i," groupID:").concat(s,"  data:").concat(e.data)),r&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(R.INVITATION_TIMEOUT,t(t({},this._genBaseEmitData(e)),{},{inviteeList:a,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(e,n){var o="".concat(this._n,"._onInvitationModified"),i=e.inviteID,s=e.data,a=this._sigM.hasInviteInfo(i);Pe.l("".concat(o," inviteID:").concat(i," hasInviteID:").concat(a," data:").concat(s)),a&&(this._sigM.setInviteInfo(i,t(t({},e),{},{message:n})),this._sigM.emitEvent(R.INVITATION_MODIFIED,{inviteID:i,data:s}))}}]),br),yr=(s(Pr,[{key:"generateInviteID",value:function(){var e,t=(t=wa)((e=Ga)(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12);return Pe.l("".concat(this._n,".generateInviteID inviteID:").concat(t)),t}},{key:"createInviteInfo",value:function(e){var n=this.generateInviteID(),o=(e=this.createInviteCustomData(t(t({},e),{},{inviteID:n}))).groupID,i=e.inviteeList;return o=o||i[0],{customData:e,message:this._sigM.createSignaling(e,o),inviteID:n}}},{key:"_genBaseCustomData",value:function(e){var t=e.data,n=e.inviteID;return{businessID:1,timeout:0,data:void 0===t?"":t,inviteID:void 0===n?"":n,groupID:void 0===(e=e.groupID)?"":e}}},{key:"createInviteCustomData",value:function(e){var n=e.userID,o=void 0===(o=e.timeout)?0:o,i=void 0===(i=e.groupID)?"":i,s=this._sigM.getMyUserID();return s=t(t({},this._genBaseCustomData(e)),{},{actionType:R.ACTION_TYPE_INVITE,inviter:s,inviteeList:i?e.inviteeList:[n],timeout:o}),Pe.l("".concat(this._n,".createInviteCustomData customData:"),s),s}},{key:"createCancelCustomData",value:function(e){var n,o="".concat(this._n,".createCancelCustomData"),i=e.inviteID,s=this._sigM.getMyUserID(),a=(i=this._sigM.getInviteInfo(i)).inviteeList,r=i.groupID;return(i=i.inviter)===s?n=t(t({},this._genBaseCustomData(e)),{},{actionType:R.ACTION_TYPE_CANCEL_INVITE,groupID:r,inviter:s,inviteeList:a}):Pe.e("".concat(o," unmatched inviter:").concat(i," and my userID:").concat(s)),Pe.l("".concat(o," customData:"),n),n}},{key:"createAcceptCustomData",value:function(e){var n,o="".concat(this._n,".createAcceptCustomData"),i=e.inviteID,s=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(i),r=a.inviter,c=a.groupID;return a.inviteeList.includes(s)?n=t(t({},this._genBaseCustomData(e)),{},{actionType:R.ACTION_TYPE_ACCEPT_INVITE,groupID:c,inviter:r,inviteeList:[s]}):Pe.e("".concat(o," userID:").concat(s," not in inviteeList. inviteID:").concat(i," groupID:").concat(c)),Pe.l("".concat(o," customData:"),n),n}},{key:"createRejectCustomData",value:function(e){var n,o="".concat(this._n,".createRejectCustomData"),i=e.inviteID,s=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(i),r=a.inviter,c=a.groupID;return a.inviteeList.includes(s)?n=t(t({},this._genBaseCustomData(e)),{},{actionType:R.ACTION_TYPE_REJECT_INVITE,groupID:c,inviter:r,inviteeList:[s]}):Pe.e("".concat(o," userID:").concat(s," not in inviteeList. inviteID:").concat(i," groupID:").concat(c)),Pe.l("".concat(o," customData:"),n),n}},{key:"createTimeoutCustomData",value:function(e){var n="".concat(this._n,".createTimeoutCustomData"),o=e.inviteeList,i=e.inviter,s=void 0!==(s=e.isInviter)&&s,a=this._sigM.getMyUserID();return e=t(t({},this._genBaseCustomData(e)),{},{actionType:R.ACTION_TYPE_INVITE_TIMEOUT,inviter:i,inviteeList:s?o:[a]}),Pe.l("".concat(n," customData:"),e),e}}]),Pr),Ir=(s(Nr,[{key:"setCloudConfig",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300;this.COUNT=e,this.EXPIRED_TIME=t,Pe.l("".concat(this._n,".setCloudConfig count:").concat(e,", time:").concat(t))}},{key:"getHistorySignaling",value:function(){var e=this,t=this._sigM.get(11).getLocalConvList();je(t)||(this._getC2CSignalingList(),t=this._getValidGroupConvList(t),this._getGroupSignalingList(t).then((function(t){e._handleSignalingList(t)})))}},{key:"_getC2CSignalingList",value:function(){var e=this._sigM.get(6).getMessageListFromUnreadDB();e=this._sigM.filterMessageList(e),this._getRelatedToMeMap(e)}},{key:"_getGroupSignalingList",value:function(e){var t=this;return 0===(e=this._createPromiseList(e)).length?Promise.resolve(this._sortSignaling(this._relatedToMeMap)):this._concurrentGetMessageList(e).then((function(e){var n=new Map;return e.forEach((function(e){e=e.list,e=t._getRelatedToMeMap(e),n=new Map([].concat(v(n),v(e)))})),t._sortSignaling(n)}))}},{key:"_handleSignalingList",value:function(e){je(e)||this._sigM.onNewMessageList(e)}},{key:"_getValidGroupConvList",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var i=(a=e[n]).type,s=a.unreadCount,a=a.lastMessage;i=i===k.CONV_GROUP,a=this._isNotExpired(a),i&&s&&a&&t.push(e[n])}return t}},{key:"_isNotExpired",value:function(e){return!(!e||!e.lastTime)&&e.lastTime>De()-this.EXPIRED_TIME}},{key:"_createPromiseList",value:function(e){for(var t=[],n=0;n<e.length;n++){var o=(i=e[n]).conversationID,i=(i=i.unreadCount)<this.COUNT?i:this.COUNT;this._map.set(o,{msgCount:i,list:[]}),i=this._sigM.get(11).getMessageList({conversationID:o}),t.push(i)}return t}},{key:"_concurrentGetMessageList",value:function(e){var t=this,n=[];return Promise.all(e).then((function(e){for(var o=0;o<e.length;o++){var i=(s=e[o]).code,s=s.data;0===i&&0!==s.messageList.length&&(t._handleMessageList(s.messageList),(i=t._relayGetMessageList(s))&&n.push(i))}return 0<n.length?t._concurrentGetMessageList(n):t._map}))}},{key:"_relayGetMessageList",value:function(e){var t=e.messageList,n=e.nextReqMessageID;if(e=e.isCompleted,0===t.length)return null;t=t[0].conversationID;var o=this._map.get(t).msgCount;return 0===o||e?null:this._sigM.get(11).getMessageList({conversationID:t,nextReqMessageID:n,count:o})}},{key:"_handleMessageList",value:function(e){var t=e.length,n=e[0].conversationID,o=(i=this._map.get(n)).msgCount,i=i.list;this._map.set(n,{msgCount:0<o-t?o-t:0,list:i.concat(this._sigM.filterMessageList(e))})}},{key:"_getRelatedToMeMap",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._saveRelatedToMe(n)}return this._relatedToMeMap}},{key:"_saveRelatedToMe",value:function(e){var t,n=(t=this._sigM.getPayloadData(e)||{}).actionType,o=void 0===(t=t.inviteID)?"":t;switch(void 0===n?"":n){case R.ACTION_TYPE_INVITE:this._setHistoryInvite(e);break;case R.ACTION_TYPE_REJECT_INVITE:case R.ACTION_TYPE_ACCEPT_INVITE:this._updateHistoryInvite(e);break;case R.ACTION_TYPE_CANCEL_INVITE:this._delHistoryInvite(o);break;case R.ACTION_TYPE_INVITE_TIMEOUT:this._updateHistoryInvite(e)}}},{key:"_setHistoryInvite",value:function(e){var n=this._sigM.getPayloadData(e)||{},o=void 0===(o=n.inviteID)?"":o,i=void 0===(i=n.inviteeList)?[]:i,s=void 0===(s=n.timeout)?0:s,a=this._sigM.getMyUserID();i.includes(a)&&(i=De()-e.time,0<s&&s<i&&0!==s||this._relatedToMeMap.set(o,t(t({},n),{},{messageList:[e]})))}},{key:"_delHistoryInvite",value:function(e){this._relatedToMeMap.has(e)&&this._relatedToMeMap.delete(e)}},{key:"_updateHistoryInvite",value:function(e){var t=void 0===(t=(i=this._sigM.getPayloadData(e)||{}).inviteID)?"":t,n=void 0===(i=i.inviteeList)?[]:i;if(this._relatedToMeMap.has(t)){for(var o=(i=this._relatedToMeMap.get(t)).inviteeList,i=i.messageList,s=0;s<n.length;s++){var a=n[s];o.includes(a)&&o.splice(o.indexOf(a),1)}0===o.length?this._delHistoryInvite(t):i.push(e)}else this._delHistoryInvite(t)}},{key:"_sortSignaling",value:function(e){var t=[];return e.forEach((function(e){t=[].concat(v(t),v(e.messageList))})),t.sort((function(e,t){return e.time-t.time}))}},{key:"reset",value:function(){this._map.clear(),this._relatedToMeMap.clear()}}]),Nr),Mr=s((function e(t,n){o(this,e),this.businessID=t.businessID||1,this.inviteID=t.inviteID,this.groupID=t.groupID||"",this.inviter=t.inviter||"",this.inviteeList=t.inviteeList||[],this.data=t.data||"",this.actionType=t.actionType||R.ACTION_TYPE_INVITE,this.timeout=t.timeout||0})),Cr=["message"],Tr=["message"],Er=(r(Or,wn),xa=f(Or),s(Or,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isCloudConfigCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isCloudConfigCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onCloudConfig",value:function(){this._isCloudConfigCompleted=!0;var e=this.getCloudConfig("history_s_count"),t=this.getCloudConfig("history_s_time");ht(e)||(e=Number(e)),ht(t)||(t=Number(t)),this._historySignalingHandler.setCloudConfig(e,t),this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"_isListenerExisted",value:function(){return-1<this._m.getOEmitInst().eventNames().indexOf(R.NEW_INVITATION_RECEIVED)}},{key:"onReady",value:function(){this._isSyncCompleted=!0;var e=this._isListenerExisted();Pe.l("".concat(this._n,".onReady. isListenerExisted: ").concat(e)),e&&this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onNewMessageList(e)}},{key:"onMessageModified",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onMessageModified(e)}},{key:"hasInviteInfo",value:function(e){return this._inviteInfoMap.has(e)}},{key:"getInviteInfo",value:function(e){return this._inviteInfoMap.get(e)}},{key:"setInviteInfo",value:function(e,n){var o=n.message;n=h(n,Cr),Pe.l("".concat(this._n,".setInviteInfo inviteID:").concat(e," data:"),n),this._inviteInfoMap.set(e,t(t({},n),{},{message:o}))}},{key:"deleteInviteInfo",value:function(e){this.hasInviteInfo(e)&&(Pe.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(e,".")),this._inviteInfoMap.delete(e))}},{key:"updateInviteInfo",value:function(e){var t="".concat(this._n,".updateInviteInfo"),n=e.inviteID,o=e.inviter,i=e.inviteeList;e=e.groupID,Pe.l("".concat(t," inviteID:").concat(n," inviter:").concat(o," groupID:").concat(e)),e&&this.hasInviteInfo(n)?(o=i[0],(e=this.getInviteInfo(n).inviteeList).includes(o)&&(e.splice(e.indexOf(o),1),Pe.l("".concat(t," remove ").concat(o,". localInviteeList.length:").concat(e.length))),0===e.length&&this.deleteInviteInfo(n)):this.deleteInviteInfo(n)}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(e,t){this.emitOEvt(e,t)}},{key:"addSignalingListener",value:function(e,t,n){this._canIUseSignaling||(this._canIUseSignaling=!0),this._m.getOEmitInst().on(e,t,n)}},{key:"removeSignalingListener",value:function(e,t,n){this._m.getOEmitInst().off(e,t,n),this._isListenerExisted()||(this._canIUseSignaling=!1)}},{key:"invite",value:function(e){var n=this,o="".concat(this._n,".").concat("invite"),i=this._localSignalingHandler.createInviteInfo(e),s=i.message,a=i.customData,r=i.inviteID;return Pe.l("".concat(o," options:").concat(JSON.stringify(e)," inviteID:").concat(r)),this.sendSignaling(s,e).then((function(e){return e&&0===e.code?(n.setInviteInfo(r,t(t({},a),{},{message:s})),n.startTimer(t(t({},a),{},{inviteID:r})),t(t({},e),{},{inviteID:r})):e})).catch((function(e){return kn(e)}))}},{key:"inviteSync",value:function(e,n,o){var i=this,s="".concat(this._n,".").concat("inviteSync"),a=this._localSignalingHandler.createInviteInfo(e),r=a.message,c=a.customData,u=a.inviteID;return Pe.l("".concat(s," options:").concat(JSON.stringify(e)," inviteID:").concat(u)),this.sendSignaling(r,e).then((function(e){if(e&&0===e.code)return i.setInviteInfo(u,t(t({},c),{},{message:r})),i.startTimer(t(t({},c),{},{inviteID:u})),n&&n({inviteID:u}),{inviteID:u};o&&o(0===e.code,e.message||"")})).catch((function(e){return o&&o(e.code,e.message),kn(e)})),u}},{key:"_handleImResponse",value:function(e,t,n){t&&0===t.code&&(this._isHandling=!1,n?this.deleteInviteInfo(e.inviteID):this.updateInviteInfo(e))}},{key:"cancel",value:function(e){var n=this,o="".concat(this._n,".").concat("cancel");if(Pe.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return kn({code:Hn.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var i=this._localSignalingHandler.createCancelCustomData(e);if(!i)return this._isHandling=!1,kn({code:Hn.SIGNALING_NO_PERMISSION});o=i.groupID;var s=i.inviteeList;return o=o||s[0],s=this.createSignaling(i,o),this.sendSignaling(s,e).then((function(o){return n._handleImResponse(i,o,!0),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return kn(e)}))}},{key:"accept",value:function(e){var n=this,o="".concat(this._n,".").concat("accept");if(Pe.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return kn({code:Hn.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var i=this._localSignalingHandler.createAcceptCustomData(e);return i?(o=this.createSignaling(i),this.sendSignaling(o,e).then((function(o){return n._handleImResponse(i,o),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return kn(e)}))):(this._isHandling=!1,kn({code:Hn.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(e){var n=this,o="".concat(this._n,".").concat("reject");if(Pe.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return kn({code:Hn.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var i=this._localSignalingHandler.createRejectCustomData(e);return i?(o=this.createSignaling(i),this.sendSignaling(o,e).then((function(o){return n._handleImResponse(i,o,!0),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return kn(e)}))):(this._isHandling=!1,kn({code:Hn.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(e){var t="".concat(this._n,".getSignalingInfo"),n=e.ID,o=e.from,i=e.to,s=this._filterSignaling(e),a=null;return s&&(e=this.getPayloadData(e),a=new Mr(e)),e=s?"actionType:".concat(a.actionType):"",Pe.l("".concat(t," messageID:").concat(n," from:").concat(o," to:").concat(i," ")+"".concat(e," isSignaling:").concat(s)),a}},{key:"modifyInvitation",value:function(e){var n=this,o=e.inviteID;if(e=e.data,!this.hasInviteInfo(o))return kn({code:Hn.SIGNALING_INVALID_INVITE_ID});var i=this.getInviteInfo(o),s=i.message,a=h(i,Tr),r=s.payload.data;return a.data=e,s.payload.data=JSON.stringify(a),this.get(2).modifyRemoteMessage(s).then((function(e){return n.hasInviteInfo(o)&&n.setInviteInfo(o,t(t({},a),{},{message:s})),e})).catch((function(e){return s.payload.data=r,kn(e)}))}},{key:"_genMsgCtrlInfo",value:function(){var e=void 0===(e=(i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data)?"":e,t=i.onlineUserOnly,n=void 0===(n=i.inviteID)?"":n,o=i.offlinePushInfo,i=i.actionType,s={_onlineOnlyFlag:!1};return n={onlineUserOnly:(s=n&&this.getInviteInfo(n)?this.getInviteInfo(n).message:s)._onlineOnlyFlag||t||!1,offlinePushInfo:o,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}},i===R.ACTION_TYPE_INVITE_TIMEOUT?(s=!!e.match(/excludeTimeoutSignalingFromHistoryMessage/),n.messageControlInfo.excludedFromUnreadCount=s,n.messageControlInfo.excludedFromLastMessage=s,n):(t=!!e.match(/excludeFromHistoryMessage/),o=!!e.match(/excludeOriginalSignalingFromHistoryMessage/),n.messageControlInfo.excludedFromUnreadCount=t||o,n.messageControlInfo.excludedFromLastMessage=t||o,n)}},{key:"sendSignaling",value:function(e,t){var n=this;return this.get(2).sendMessageInstance(e,this._genMsgCtrlInfo(t)).catch((function(e){return n._isHandling=!1,kn(e)}))}},{key:"filterMessageList",value:function(e){var t=this;return e.filter((function(e){return t._filterSignaling(e)}))}},{key:"getPayloadData",value:function(e){return this._remoteSignalingHandler.getPayloadData(e)}},{key:"createSignaling",value:function(e,t){var n=e.groupID,o=e.inviter;return t={to:t||n||o,conversationType:n?k.CONV_GROUP:k.CONV_C2C,priority:k.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(e)}},o=this.get(2).createCustomMessage(t),Pe.l("".concat(this._n,".createSignaling. message:"),o),o}},{key:"_filterSignaling",value:function(e){var t,n,o=!1;return e.type&&e.type===k.MSG_CUSTOM&&(t=e.cloudCustomData,e=void 0===(e=e.payload.data)?"":e,t=(void 0===t?"":t).match(/"type":"tsignaling"/),n=e.match(/inviteID/),e=e.match(/actionType/),o=t||n&&e),!!o}},{key:"startTimer",value:function(e){var t,n,o,i=this,s="".concat(this._n,".startTimer"),a=e.timeout,r=e.inviteID,c=e.inviter,u=e.groupID,l=c===this.getMyUserID();Pe.l("".concat(s," timeout:").concat(a," isInviter:").concat(l," groupID:").concat(u)),a<=0||(t=l?a+5:a,n=1,o=setInterval((function(){var a=i._hasLocalInviteInfo(e,l);n<t&&a?++n:(a&&i._sendTimeoutNotice(r,l),Pe.l("".concat(s," end.")),clearInterval(o))}),1e3))}},{key:"_hasLocalInviteInfo",value:function(e,t){var n=e.inviteID;if(e=e.groupID,!this.hasInviteInfo(n))return!1;var o="".concat(this._n,"._hasLocalInviteInfo"),i=this.getInviteInfo(n).inviteeList;return Pe.l("".concat(o," inviteID:").concat(n," inviteeList:").concat(i," groupID:").concat(e)),!e||(t?0<i.length:0<i.length&&i.includes(this.getMyUserID()))}},{key:"_getReceiver",value:function(e,t){var n=t.groupID,o=t.inviteeList;return t=t.inviter,e?n||o[0]:n||t}},{key:"_sendTimeoutNotice",value:function(e,n){var o=this,i=this.getInviteInfo(e),s=this._getReceiver(n,i),a=(Pe.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(e," to:").concat(s," isInviter:").concat(n)),this._localSignalingHandler.createTimeoutCustomData(t(t({},i),{},{isInviter:n}))),r=this.createSignaling(a,s);return this.sendSignaling(r,a).then((function(t){var i,s,c;t&&0===t.code&&(t=a.data,i=a.groupID,s=a.inviteeList,c=a.inviter,o.emitEvent(R.INVITATION_TIMEOUT,{data:t,groupID:i,inviteID:e,inviteeList:s,inviter:c,isSelfTimeout:!0,message:r}),n?o.deleteInviteInfo(e):o.updateInviteInfo(a))}))}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1,this._isCloudConfigCompleted=!1}}]),Or),Sr=["followDiffList"],Dr=["from"],kr={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},Rr=(r(Ar,wn),Fa=f(Ar),s(Ar,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("follow_req_count");ht(e)||(e=Number(e),this.DEFAULT_COUNT=e>this.MAX_COUNT?this.MAX_COUNT:e,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList()}},{key:"onFollowNotify",value:function(e){var t=this;e=e.dataList||[],Pe.l("".concat(this._n,".onFollowNotify followChangeList:").concat(e.length)),e.forEach((function(e){var n=void 0===(n=e.followDiffList)?[]:n,o=(e=h(e,Sr)).from,i=h(e,Dr);n.forEach((function(e){var n=e.isAdd,s=(e=void 0===(e=e.followType)?0:e,t._initFollowInfo());1===n?(i.userID=o,s[e].userInfoList.push(i),s[e].isAdd=!0):(s[e].userInfoList.push(o),s[e].isAdd=!1),t._emitEvent(s)}))}))}},{key:"_initFollowInfo",value:function(){var e={};return Object.values(kr).forEach((function(t){t!==kr.NONE&&(e[t]={userInfoList:[],isAdd:!1})})),e}},{key:"_emitEvent",value:function(e){var t=this;Object.keys(e).forEach((function(n){n=Number(n);var o=e[n];0<o.userInfoList.length&&(n===kr.FOLLOWERS&&(t._clearFollowList(kr.FOLLOWERS),t.emitOEvt(D.MY_FOLLOWERS_LIST_UPDATED,o)),n===kr.FOLLOWING&&(t._clearFollowList(kr.FOLLOWING),t.emitOEvt(D.MY_FOLLOWING_LIST_UPDATED,o)),n===kr.MUTUAL&&(t._clearFollowList(kr.MUTUAL),t.emitOEvt(D.MUTUAL_FOLLOWERS_LIST_UPDATED,o)))}))}},{key:"followUser",value:function(e){if(!this.canIUse(w.FOLLOW))return this.noUse("followUser");var t="".concat(this._n,".").concat("followUser"),n="userIDList:".concat(e.length),o=new ao("followUser");return o.setMessage(n),Pe.l("".concat(t," ").concat(n)),this.req({P:Kn.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e.map((function(e){return{userID:e}}))}}).then((function(e){return o.end(),Pe.l("".concat(t," ok.")),Sn(e.data.resultList)})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"unfollowUser",value:function(e){if(!this.canIUse(w.FOLLOW))return this.noUse("unfollowUser");var t="".concat(this._n,".").concat("unfollowUser"),n="userIDList:".concat(e.length),o=new ao("unfollowUser");return o.setMessage(n),Pe.l("".concat(t," ").concat(n)),this.req({P:Kn.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then((function(e){return o.end(),Pe.l("".concat(t," ok.")),Sn(e.data.resultList)})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"getMyFollowersList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMyFollowersList";if(!this.canIUse(w.FOLLOW))return this.noUse(o);var i=n||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(i)){var s=(r=this._myFollowersList.get(i)).resultList,a=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<s.length)return Pe.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),Dn({resultList:s,nextCursor:a})}return this._getFollowList(n,kr.FOLLOWERS).then((function(s){return e._myFollowersList.set(i,t(t({},s),{},{lastUpdateTime:Date.now()})),Pe.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),Sn(s)}))}},{key:"getMyFollowingList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMyFollowingList";if(!this.canIUse(w.FOLLOW))return this.noUse(o);var i=n||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(i)){var s=(r=this._myFollowingList.get(i)).resultList,a=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<s.length)return Pe.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),Dn({resultList:s,nextCursor:a})}return this._getFollowList(n,kr.FOLLOWING).then((function(s){return e._myFollowingList.set(i,t(t({},s),{},{lastUpdateTime:Date.now()})),Pe.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),Sn(s)}))}},{key:"getMutualFollowersList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMutualFollowersList";if(!this.canIUse(w.FOLLOW))return this.noUse(o);var i=n||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(i)){var s=(r=this._myMutualFollowersList.get(i)).resultList,a=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<s.length)return Pe.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),Dn({resultList:s,nextCursor:a})}return this._getFollowList(n,kr.MUTUAL).then((function(s){return e._myMutualFollowersList.set(i,t(t({},s),{},{lastUpdateTime:Date.now()})),Pe.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),Sn(s)}))}},{key:"_getFollowList",value:function(e,n){var o=this,i=new ao("_getFollowList");return i.setMessage("nextCursor:".concat(e," type:").concat(n)),this.req({P:Kn.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:e,type:n}}).then((function(e){i.end();var n=void 0===(n=(e=e.data).resultList)?[]:n,s=(e=void 0===(e=e.nextCursor)?"":e,[]);return n.forEach((function(e){var n=e.userID,i=e.followTime;e=e.profileList,s.push(t({userID:n,followTime:i},o._handleProfileItem(void 0===e?[]:e)))})),{resultList:s,nextCursor:e}})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(o._n,"._getFollowList failed. error:"),e),kn(e)}))}},{key:"_handleProfileItem",value:function(e){var t={};return e.forEach((function(e){switch(e.tag){case Ue.NICK:t.nick=e.value;break;case Ue.GENDER:t.gender=e.value;break;case Ue.BIRTHDAY:t.birthday=e.value;break;case Ue.LOCATION:t.location=e.value;break;case Ue.SELFSIGNATURE:t.selfSignature=e.value;break;case Ue.ALLOWTYPE:t.allowType=e.value;break;case Ue.LANGUAGE:t.language=e.value;break;case Ue.AVATAR:t.avatar=e.value;break;case Ue.MESSAGESETTINGS:t.messageSettings=e.value;break;case Ue.ADMINFORBIDTYPE:t.adminForbidType=e.value;break;case Ue.LEVEL:t.level=e.value;break;case Ue.ROLE:t.role=e.value;break;default:t[e.tag]=e.value}})),t}},{key:"getUserFollowInfo",value:function(e){if(!this.canIUse(w.FOLLOW))return this.noUse("getUserFollowInfo");var t=e,n=!1,o=(ht(e)&&(t=[this.getMyUserID()],n=!0),"".concat(this._n,".").concat("getUserFollowInfo")),i=(e="userIDList:".concat(t.length," isGetMyFollowInfo:").concat(n),new ao("getUserFollowInfo"));return i.setMessage(e),Pe.l("".concat(o," ").concat(e)),this.req({P:Kn.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then((function(e){i.end(),Pe.l("".concat(o," ok.")),e=e.data.followInfoList;var t=[];return(void 0===e?[]:e).forEach((function(e){var n=e.followersCount,o=e.followingCount;e=e.mutualFollowersCount,t.push({followersCount:n,followingCount:o,mutualFollowersCount:e})})),Sn(t)})).catch((function(e){return i.setError(e).end(),Pe.e("".concat(o," failed. error:"),e),kn(e)}))}},{key:"checkFollowType",value:function(e){if(!this.canIUse(w.FOLLOW))return this.noUse("checkFollowType");100<e.length&&(e=e.slice(0,100),Pe.w("".concat(t," ").concat(Yt(100))));var t="".concat(this._n,".").concat("checkFollowType"),n="userIDList length:".concat(e.length," "),o=new ao("checkFollowType");return o.setMessage(n),Pe.l("".concat(t," ").concat(n)),this.req({P:Kn.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then((function(e){o.end(),Pe.l("".concat(t," ok.")),e=e.data.resultList;var n=[];return(void 0===e?[]:e).forEach((function(e){var t=e.userID;e=e.followType,n.push({userID:t,followType:e})})),Sn(n)})).catch((function(e){return o.setError(e).end(),Pe.e("".concat(t," failed. error:"),e),kn(e)}))}},{key:"_clearFollowList",value:function(e){if(ht(e))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();e!==kr.FOLLOWERS?e!==kr.FOLLOWING?e!==kr.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._clearFollowList()}}]),Ar),Lr=Ds((function(e,t){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t,o,i=Array.prototype.slice.call(arguments,1);i.length;){var s=i.shift();if(s){if("object"!==n(s))throw new TypeError(s+"must be non-object");for(var a in s)t=s,o=a,Object.prototype.hasOwnProperty.call(t,o)&&(e[a]=s[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,o,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),i);else for(var s=0;s<o;s++)e[i+s]=t[n+s]},flattenChunks:function(e){for(var t,n,o,i=0,s=0,a=e.length;s<a;s++)i+=e[s].length;for(o=new Uint8Array(i),s=t=0,a=e.length;s<a;s++)n=e[s],o.set(n,t),t+=n.length;return o}},s={arraySet:function(e,t,n,o,i){for(var s=0;s<o;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(o)}));function Ar(e){return o(this,Ar),(e=Fa.call(this,e))._n="FollowModule",e._myFollowersList=new Map,e._myFollowingList=new Map,e._myMutualFollowersList=new Map,e.MAX_CATCH_TIME=6e5,e.FIRST_PAGE_INDEX=rt(),e.DEFAULT_COUNT=500,e.MAX_COUNT=1e3,e.getIEmitInst().on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Or(e){o(this,Or),(e=xa.call(this,e))._n="SignalingModule",e._inviteInfoMap=new Map,e._canIUseSignaling=!1,e._isHandling=!1,e._remoteSignalingHandler=new vr(g(e)),e._localSignalingHandler=new yr(g(e)),e._historySignalingHandler=new Ir(g(e)),e._isC2CUnreadHandleCompleted=!1,e._isConvSyncCompleted=!1,e._isSyncCompleted=!1,e._isCloudConfigCompleted=!1;var t=e.getIEmitInst();return t.on(Wo.C2C_UNREAD_HANDLE_COMPLETED,e.onC2CUnreadHandleCompleted,g(e)),t.on(Wo.CONV_SYNC_COMPLETED,e.onConvSyncCompleted,g(e)),t.on(Wo.CLOUD_CONFIG,e.onCloudConfig,g(e)),e}function Nr(e){o(this,Nr),this._n="HistorySignalingHandler",this._sigM=e,this.COUNT=20,this.EXPIRED_TIME=300,this._map=new Map,this._relatedToMeMap=new Map}function Pr(e){o(this,Pr),this._n="LocalSignalingHandler",this._sigM=e}function br(e){o(this,br),this._n="RemoteSignalingHandler",this._sigM=e}function Ur(e){o(this,Ur),this._m=e,this._n="ErrMsgModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function Gr(e){o(this,Gr),this._m=e,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*","live_engine_pk.*","trtc_ai_service.*","call_engine_srv.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getIEmitInst().on(Wo.CLOUD_CONFIG,this._onCloudConfig,this)}function wr(e){return o(this,wr),(e=Va.call(this,e))._n="ProfanityFilterModule",e._plugin=null,e._filterConfigMap=new Map,e._startIndex=0,e._version=0,e._canIUseLexicon=!1,e._isFetching=!1,e._expiredTime=0,e}function Fr(e){var t;return o(this,Fr),(t=qa.call(this,e))._m=e,t._n="TIMPushModule",t._pluginName="TIMPush",t._pushPlugin=void 0,t._androidPushConfig={},t._deviceToken="",t._businessID=0,t._iOSBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},t}function xr(e){var t;return o(this,xr),(t=Ba.call(this,e))._m=e,t._n="OfflinePushModule",t._offlinePushPlugin=void 0,t._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},t._deviceToken="",t._businessID=0,t._iosBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t}function Vr(e){o(this,Vr),this._m=e,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new dr(this)}function qr(e){o(this,qr),this._commercialConfigM=e,this._n="PurchasedFeatureHandler",this._isCSPluginReported=!1,this._featureMap=new Map}function Br(e){return o(this,Br),(e=Ha.call(this,e))._n="WorkerTimerModule",e._isWorkerEnabled=!0,e._workerTimer=null,e._timerID=-1,e._init(),e.getIEmitInst().on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function Hr(e){return o(this,Hr),(e=ja.call(this,e))._n="SnsModule",e._friendHandler=new ar(g(e)),e._friendApplicationHandler=new ir(g(e)),e._friendGroupHandler=new cr(g(e)),e.getIEmitInst().on(Wo.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,g(e)),e}function jr(e){o(this,jr),this._snsM=e,this._n="FriendGroupHandler",this._map=new Map}function Kr(e){o(this,Kr),je(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}function Yr(e){o(this,Yr),this._snsM=e,this._n="FriendHandler",this._map=new Map,this._startIdx=0,this._standardSeq=0,this._customSeq=0,this._expirationTime=18e4}function zr(e,n){o(this,zr),this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var i={},s=[];if(i.userID=e,!je(n))for(var a,r="",c=0,u=n.length;c<u;c++)if(r=n[c].tag,a=n[c].value,-1<r.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:r,value:a});else if(-1<r.indexOf("Tag_Profile_Custom"))s.push({key:r,value:a});else switch(r){case Ue.NICK:i.nick=a;break;case Ue.GENDER:i.gender=a;break;case Ue.BIRTHDAY:i.birthday=a;break;case Ue.LOCATION:i.location=a;break;case Ue.SELFSIGNATURE:i.selfSignature=a;break;case Ue.ALLOWTYPE:i.allowType=a;break;case Ue.LANGUAGE:i.language=a;break;case Ue.AVATAR:i.avatar=a;break;case Ue.MESSAGESETTINGS:i.messageSettings=a;break;case Ue.ADMINFORBIDTYPE:i.adminForbidType=a;break;case Ue.LEVEL:i.level=a;break;case Ue.ROLE:i.role=a;break;case Ge.REMARK:this.remark=a;break;case Ge.ADDTIME:this.addTime=a;break;case Ge.GROUP:this.groupList=JSON.parse(JSON.stringify(a));break;case Ge.ADDSOURCE:this.source=a;break;case Ge.ADDWORDING:break;default:Pe.l("snsProfileItem unknown tag->",n[c].tag)}this.profile=new ui(t(t({},i),{},{profileCustomField:s}))}function Wr(e){o(this,Wr),this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSeq=0,this._map=new Map,this._unreadCount=0}function Jr(e){o(this,Jr),(e=Ka.call(this,e))._n="QualityStatModule",e.TAG="im-ssolog-quality-stat",e.reportIndex=0,e.wholePeriod=!1,e._qualityItems=[Yn,zn,Wn,Jn,$n,Xn,Zn,Qn,eo,to],e._messageSentItems=[Wn,Jn,$n,Xn,Zn],e._messageReceivedItems=[Qn,eo,to],e.REPORT_INTERVAL=120,e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._statInfoArr=[],e._avgRTT=new Qa,e._avgE2EDelay=new Za,e._rateMessageSent=new er,e._rateMessageReceived=new tr;var t=e.getIEmitInst();return t.on(Wo.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,g(e)),t.on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function $r(){o(this,$r),this._lastMap=new Map,this._currentMap=new Map}function Xr(){o(this,Xr),this._map=new Map}function Zr(){o(this,Zr),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function Qr(){o(this,Qr),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function ec(e){return o(this,ec),(e=Ya.call(this,e))._n="RecoverMsgModule",e.PULL_LIMIT_COUNT=15,e}function tc(e){return o(this,tc),(e=za.call(this,e))._n="CloudControlModule",e._cloudConfig=new Map,e._expiredTime=0,e._version=0,e._isFetching=!1,e}function nc(e){return o(this,nc),(e=Wa.call(this,e))._n="SessionModule",e._platform=e.getPlatform(),e._pHandler=new Ca(g(e)),e._msgDispatcher=new Ea(g(e)),e._cmdFreqLimitMap=new Map,e._cmdReqInfoMap=new Map,e._serverOverloadInfoMap=new Map,e._incrementalPullContactFlag=!0,e._init(),e.getIEmitInst().on(Wo.CLOUD_CONFIG,e._onCloudConfig,g(e)),e}function oc(e,t,n,o){for(var i=65535&e,s=e>>>16&65535,a=0;0!==n;){for(n-=a=2e3<n?2e3:n;s=s+(i=i+t[o++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16}function ic(e,t,n,o){var i=ac,s=o+n;e^=-1;for(var a=o;a<s;a++)e=e>>>8^i[255&(e^t[a])];return~e}function sc(e,t,n,o,i,s,a,r){var c,u,l,d,p,h,g,_,f,m=r.bits,v=0,y=0,I=0,M=0,C=0,T=0,E=0,S=0,D=0,k=0,R=null,L=0,A=new Lr.Buf16(16),O=new Lr.Buf16(16),N=null,P=0;for(v=0;v<=15;v++)A[v]=0;for(y=0;y<o;y++)A[t[n+y]]++;for(C=m,M=15;1<=M&&0===A[M];M--);if(M<C&&(C=M),0===M)return i[s++]=20971520,i[s++]=20971520,r.bits=1,0;for(I=1;I<M&&0===A[I];I++);for(C<I&&(C=I),v=S=1;v<=15;v++)if((S=(S<<1)-A[v])<0)return-1;if(0<S&&(0===e||1!==M))return-1;for(O[1]=0,v=1;v<15;v++)O[v+1]=O[v]+A[v];for(y=0;y<o;y++)0!==t[n+y]&&(a[O[t[n+y]]++]=y);if(h=0===e?(R=N=a,19):1===e?(R=rc,L-=257,N=cc,P-=257,256):(R=uc,N=lc,-1),v=I,p=s,E=y=k=0,l=-1,d=(D=1<<(T=C))-1,1===e&&852<D||2===e&&592<D)return 1;for(;;){for(f=a[y]<h?(_=0,a[y]):a[y]>h?(_=N[P+a[y]],R[L+a[y]]):(_=96,0),c=1<<(g=v-E),I=u=1<<T;i[p+(k>>E)+(u-=c)]=g<<24|_<<16|f,0!==u;);for(c=1<<v-1;k&c;)c>>=1;if(k=0!==c?(k&c-1)+c:0,y++,0==--A[v]){if(v===M)break;v=t[n+a[y]]}if(C<v&&(k&d)!==l){for(p+=I,S=1<<(T=v-(E=0===E?C:E));T+E<M&&!((S-=A[T+E])<=0);)T++,S<<=1;if(D+=1<<T,1===e&&852<D||2===e&&592<D)return 1;i[l=k&d]=C<<24|T<<16|p-s}}return 0!==k&&(i[p+k]=v-E<<24|64<<16),r.bits=C,0}Lr.assign,Lr.shrinkBuf,Lr.setTyped,Lr.Buf8,Lr.Buf16,Lr.Buf32;var ac=function(){for(var e=[],t=0;t<256;t++){for(var n=t,o=0;o<8;o++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),rc=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],cc=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],uc=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],lc=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function dc(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function pc(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Lr.Buf16(320),this.work=new Lr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function hc(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Lr.Buf32(852),t.distcode=t.distdyn=new Lr.Buf32(592),t.sane=1,t.back=-1,0):-2}function gc(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,hc(e)):-2}function _c(e,t){var n,o;return e&&e.state?(o=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?-2:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,gc(e))):-2}function fc(e,t){var n;return e?(n=new pc,(e.state=n).window=null,0!==(n=_c(e,t))&&(e.state=null),n):-2}var mc,vc,yc=!0;function Ic(e,t,n,o){var i;return null===(e=e.state).window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Lr.Buf8(e.wsize)),o>=e.wsize?(Lr.arraySet(e.window,t,n-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):((i=e.wsize-e.wnext)>o&&(i=o),Lr.arraySet(e.window,t,n-o,i,e.wnext),(o-=i)?(Lr.arraySet(e.window,t,n-o,o,0),e.wnext=o,e.whave=e.wsize):(e.wnext+=i,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=i))),0}var Mc={inflateReset:gc,inflateReset2:_c,inflateResetKeep:hc,inflateInit:function(e){return fc(e,15)},inflateInit2:fc,inflate:function(e,t){var n,o,i,s,a,r,c,u,l,d,p,h,g,_,f,m,v,y,I,M,C,T,E,S,D=0,k=new Lr.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,o=e.input,r=e.avail_in,u=n.hold,l=n.bits,d=r,p=c,T=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(2&n.wrap&&35615===u){k[n.check=0]=255&u,k[1]=u>>>8&255,n.check=ic(n.check,k,2,0),l=u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=30;break}if(l-=4,C=8+(15&(u>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=ic(n.check,k,2,0)),l=u=0,n.mode=3;case 3:for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,k[2]=u>>>16&255,k[3]=u>>>24&255,n.check=ic(n.check,k,4,0)),l=u=0,n.mode=4;case 4:for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=ic(n.check,k,2,0)),l=u=0,n.mode=5;case 5:if(1024&n.flags){for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=ic(n.check,k,2,0)),l=u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=(h=n.length)>r?r:h)&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Lr.arraySet(n.head.extra,o,s,h,C)),512&n.flags&&(n.check=ic(n.check,o,h,s)),r-=h,s+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===r)break e;for(h=0;C=o[s+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C)),C&&h<r;);if(512&n.flags&&(n.check=ic(n.check,o,h,s)),r-=h,s+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===r)break e;for(h=0;C=o[s+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C)),C&&h<r;);if(512&n.flags&&(n.check=ic(n.check,o,h,s)),r-=h,s+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}l=u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}e.adler=n.check=dc(u),l=u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&l,l-=7&l,n.mode=27;break}for(;l<3;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}switch(n.last=1&u,--l,3&(u>>>=1)){case 0:n.mode=14;break;case 1:L=A=void 0;var L,A=n;if(yc){for(mc=new Lr.Buf32(512),vc=new Lr.Buf32(32),L=0;L<144;)A.lens[L++]=8;for(;L<256;)A.lens[L++]=9;for(;L<280;)A.lens[L++]=7;for(;L<288;)A.lens[L++]=8;for(sc(1,A.lens,0,288,mc,0,A.work,{bits:9}),L=0;L<32;)A.lens[L++]=5;sc(2,A.lens,0,32,vc,0,A.work,{bits:5}),yc=!1}if(A.lencode=mc,A.lenbits=9,A.distcode=vc,A.distbits=5,n.mode=20,6!==t)break;u>>>=2,l-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&u,l=u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(0===(h=c<(h=r<h?r:h)?c:h))break e;Lr.arraySet(i,o,s,h,a),r-=h,s+=h,c-=h,a+=h,n.length-=h;break}n.mode=12;break;case 17:for(;l<14;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;l<3;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.lens[R[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[R[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},T=sc(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;m=(D=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&D,!((f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(v<16)u>>>=f,l-=f,n.lens[n.have++]=v;else{if(16===v){for(S=f+2;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u>>>=f,l-=f,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}C=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===v){for(S=f+3;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}C=0,h=3+(7&(u>>>=f)),u>>>=3,l=l-f-3}else{for(S=f+7;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}C=0,h=11+(127&(u>>>=f)),u>>>=7,l=l-f-7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;h--;)n.lens[n.have++]=C}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,E={bits:n.lenbits},T=sc(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},T=sc(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,T){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=r&&258<=c){e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,j=q=G=U=b=P=N=O=oe=ne=te=ee=Q=Z=X=$=J=W=z=Y=K=H=B=V=x=void 0;var O,N,P,b,U,G,w=e,F=p,x=w.state,V=w.next_in,q=w.input,B=V+(w.avail_in-5),H=w.next_out,j=w.output,K=H-(F-w.avail_out),Y=H+(w.avail_out-257),z=x.dmax,W=x.wsize,J=x.whave,$=x.wnext,X=x.window,Z=x.hold,Q=x.bits,ee=x.lencode,te=x.distcode,ne=(1<<x.lenbits)-1,oe=(1<<x.distbits)-1;t:do{for(Q<15&&(Z+=q[V++]<<Q,Q+=8,Z+=q[V++]<<Q,Q+=8),O=ee[Z&ne];;){if(Z>>>=N=O>>>24,Q-=N,0==(N=O>>>16&255))j[H++]=65535&O;else{if(!(16&N)){if(!(64&N)){O=ee[(65535&O)+(Z&(1<<N)-1)];continue}if(32&N){x.mode=12;break t}w.msg="invalid literal/length code",x.mode=30;break t}for(P=65535&O,(N&=15)&&(Q<N&&(Z+=q[V++]<<Q,Q+=8),P+=Z&(1<<N)-1,Z>>>=N,Q-=N),Q<15&&(Z+=q[V++]<<Q,Q+=8,Z+=q[V++]<<Q,Q+=8),O=te[Z&oe];;){if(Z>>>=N=O>>>24,Q-=N,!(16&(N=O>>>16&255))){if(!(64&N)){O=te[(65535&O)+(Z&(1<<N)-1)];continue}w.msg="invalid distance code",x.mode=30;break t}if(b=65535&O,Q<(N&=15)&&(Z+=q[V++]<<Q,(Q+=8)<N&&(Z+=q[V++]<<Q,Q+=8)),(b+=Z&(1<<N)-1)>z){w.msg="invalid distance too far back",x.mode=30;break t}if(Z>>>=N,Q-=N,b>(N=H-K)){if((N=b-N)>J&&x.sane){w.msg="invalid distance too far back",x.mode=30;break t}if(G=X,(U=0)===$){if(U+=W-N,N<P){for(P-=N;j[H++]=X[U++],--N;);U=H-b,G=j}}else if($<N){if(U+=W+$-N,(N-=$)<P){for(P-=N;j[H++]=X[U++],--N;);if(U=0,$<P){for(P-=N=$;j[H++]=X[U++],--N;);U=H-b,G=j}}}else if(U+=$-N,N<P){for(P-=N;j[H++]=X[U++],--N;);U=H-b,G=j}for(;2<P;)j[H++]=G[U++],j[H++]=G[U++],j[H++]=G[U++],P-=3;P&&(j[H++]=G[U++],1<P&&(j[H++]=G[U++]))}else{for(U=H-b;j[H++]=j[U++],j[H++]=j[U++],j[H++]=j[U++],2<(P-=3););P&&(j[H++]=j[U++],1<P&&(j[H++]=j[U++]))}break}}break}}while(V<B&&H<Y);V-=P=Q>>3,Z&=(1<<(Q-=P<<3))-1,w.next_in=V,w.next_out=H,w.avail_in=V<B?B-V+5:5-(V-B),w.avail_out=H<Y?Y-H+257:257-(H-Y),x.hold=Z,x.bits=Q,a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,o=e.input,r=e.avail_in,u=n.hold,l=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;m=(D=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&D,!((f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(m&&!(240&m)){for(y=f,I=m,M=v;m=(D=n.lencode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,v=65535&D,!(y+(f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=f,l-=f,n.back+=f,n.length=v,0===m){n.mode=26;break}if(32&m){n.back=-1,n.mode=12;break}if(64&m){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&m,n.mode=22;case 22:if(n.extra){for(S=n.extra;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(D=n.distcode[u&(1<<n.distbits)-1])>>>16&255,v=65535&D,!((f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(!(240&m)){for(y=f,I=m,M=v;m=(D=n.distcode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,v=65535&D,!(y+(f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=f,l-=f,n.back+=f,64&m){e.msg="invalid distance code",n.mode=30;break}n.offset=v,n.extra=15&m,n.mode=24;case 24:if(n.extra){for(S=n.extra;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===c)break e;if(n.offset>(h=p-c)){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}g=h>n.wnext?(h-=n.wnext,n.wsize-h):n.wnext-h,h>n.length&&(h=n.length),_=n.window}else _=i,g=a-n.offset,h=n.length;for(c-=h=c<h?c:h,n.length-=h;i[a++]=_[g++],--h;);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;i[a++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;l<32;){if(0===r)break e;r--,u|=o[s++]<<l,l+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=(n.flags?ic:oc)(n.check,i,p,a-p)),p=c,(n.flags?u:dc(u))!==n.check){e.msg="incorrect data check",n.mode=30;break}l=u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}l=u=0}n.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return-4;default:return-2}return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,(n.wsize||p!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&Ic(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=(n.flags?ic:oc)(n.check,i,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==d&&0===p||4===t)&&0===T?-5:T},inflateEnd:function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var n;return e&&e.state&&2&(n=e.state).wrap?((n.head=t).done=!1,0):-2},inflateSetDictionary:function(e,t){var n,o=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&oc(1,t,o,0)!==n.check?-3:Ic(e,t,o,o)?(n.mode=31,-4):(n.havedict=1,0)},inflateInfo:"pako inflate (from Nodeca project)"},Cc=!0,Tc=!0;try{String.fromCharCode.apply(null,[0])}catch(nu){Cc=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(nu){Tc=!1}for(var Ec=new Lr.Buf8(256),Sc=0;Sc<256;Sc++)Ec[Sc]=252<=Sc?6:248<=Sc?5:240<=Sc?4:224<=Sc?3:192<=Sc?2:1;function Dc(e,t){for(var n,o,i=t||e.length,s=new Array(2*i),a=0,r=0;r<i;)if((n=e[r++])<128)s[a++]=n;else if(4<(o=Ec[n]))s[a++]=65533,r+=o-1;else{for(n&=2===o?31:3===o?15:7;1<o&&r<i;)n=n<<6|63&e[r++],o--;1<o?s[a++]=65533:n<65536?s[a++]=n:(n-=65536,s[a++]=55296|n>>10&1023,s[a++]=56320|1023&n)}var c=s,u=a;if(u<65534&&(c.subarray&&Tc||!c.subarray&&Cc))return String.fromCharCode.apply(null,Lr.shrinkBuf(c,u));for(var l="",d=0;d<u;d++)l+=String.fromCharCode(c[d]);return l}function kc(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Rc(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}Ec[254]=Ec[254]=1;var Lc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Ac={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Oc=Object.prototype.toString;function Nc(e){if(!(this instanceof Nc))return new Nc(e);this.options=Lr.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new kc,this.strm.avail_out=0,(e=Mc.inflateInit2(this.strm,t.windowBits))!==Lc.Z_OK)throw new Error(Ac[e]);if(this.header=new Rc,Mc.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=function(e){for(var t,n,o,i,s=e.length,a=0,r=0;r<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(o=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Lr.Buf8(a),r=i=0;i<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(o=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),n<128?t[i++]=n:(n<2048?t[i++]=192|n>>>6:(n<65536?t[i++]=224|n>>>12:(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63),t[i++]=128|n>>>6&63),t[i++]=128|63&n);return t}(t.dictionary):"[object ArrayBuffer]"===Oc.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=Mc.inflateSetDictionary(this.strm,t.dictionary))!==Lc.Z_OK))throw new Error(Ac[e])}function Pc(e,t){if((t=new Nc(t)).push(e,!0),t.err)throw t.msg||Ac[t.err];return t.result}Nc.prototype.push=function(e,t){var n,o,i,s,a,r=this.strm,c=this.options.chunkSize,u=this.options.dictionary,l=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?Lc.Z_FINISH:Lc.Z_NO_FLUSH,"string"==typeof e?r.input=function(e){for(var t=new Lr.Buf8(e.length),n=0,o=t.length;n<o;n++)t[n]=e.charCodeAt(n);return t}(e):"[object ArrayBuffer]"===Oc.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new Lr.Buf8(c),r.next_out=0,r.avail_out=c),(n=(n=Mc.inflate(r,Lc.Z_NO_FLUSH))===Lc.Z_NEED_DICT&&u?Mc.inflateSetDictionary(this.strm,u):n)===Lc.Z_BUF_ERROR&&!0===l&&(n=Lc.Z_OK,l=!1),n!==Lc.Z_STREAM_END&&n!==Lc.Z_OK)return this.onEnd(n),!(this.ended=!0);r.next_out&&(0!==r.avail_out&&n!==Lc.Z_STREAM_END&&(0!==r.avail_in||o!==Lc.Z_FINISH&&o!==Lc.Z_SYNC_FLUSH)||("string"===this.options.to?(i=function(e,t){for(var n=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+Ec[e[n]]>t?n:t}(r.output,r.next_out),s=r.next_out-i,a=Dc(r.output,i),r.next_out=s,r.avail_out=c-s,s&&Lr.arraySet(r.output,r.output,i,s,0),this.onData(a)):this.onData(Lr.shrinkBuf(r.output,r.next_out)))),0===r.avail_in&&0===r.avail_out&&(l=!0)}while((0<r.avail_in||0===r.avail_out)&&n!==Lc.Z_STREAM_END);return(o=n===Lc.Z_STREAM_END?Lc.Z_FINISH:o)===Lc.Z_FINISH?(n=Mc.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Lc.Z_OK):o!==Lc.Z_SYNC_FLUSH||(this.onEnd(Lc.Z_OK),!(r.avail_out=0))},Nc.prototype.onData=function(e){this.chunks.push(e)},Nc.prototype.onEnd=function(e){e===Lc.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Lr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},te={},(0,Lr.assign)(te,{Inflate:Nc,inflate:Pc,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Pc(e,t)},ungzip:Pc},Lc);var bc,Uc=te,Gc=(s(eu,[{key:"inflate",value:function(e){e=new Uint8Array(e).slice(4);var t,n=Date.now();try{t=Uc.inflate(e,{to:"string"}),this._bLogForInflateOK||(this._bLogForInflateOK=!0,new ao("inflateOK").end())}catch(i){return this._bLogForInflateError?void 0:(this._bLogForInflateError=!0,void new ao("inflateError").setMessage(i).end())}e=e.length+4;var o=t.length;return Pe.d("inflate ok. zipped:".concat(e," unzipped:").concat(o)+" compression ratio:".concat(Math.round(100*(o-e)/o),"% cost:").concat(Date.now()-n)),t}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._bLogForInflateOK=!1,this._bLogForInflateError=!1}}]),eu),wc="Message",Fc="User",xc="Group",Vc="GroupMember",qc=["count"],Bc=["conversationID","timePosition","timePeriod"],Hc=["miniBirthday","maxBirthday"],jc=(a($={},wc,Kn.CS),a($,Fc,Kn.USER_CS),a($,xc,Kn.GRP_CS),a($,Vc,Kn.MBR_CS),$),Kc=(r(Qc,wn),bc=f(Qc),s(Qc,[{key:"searchCloudMessages",value:function(e){return this.search(wc,e)}},{key:"searchCloudUsers",value:function(e){return this.search(Fc,e)}},{key:"searchCloudGroups",value:function(e){return this.search(xc,e)}},{key:"searchCloudGroupMembers",value:function(e){return this.search(Vc,e)}},{key:"search",value:function(e,t){var n=this,o="searchCloud".concat(e,"s"),i="".concat(this._n,".").concat(o);if(!t)return kn({code:Hn.OPTIONS_IS_EMPTY,message:this.getErrMsg(Hn.OPTIONS_IS_EMPTY,o)});var s=t.keywordList,a=Ze(s),r=t.count;if(t.count&&(r=parseInt(r)),e===wc&&!a&&!Ze(t.senderUserIDList)&&!Ze(t.messageTypeList)||e!==wc&&!a)throw Pe.e("[".concat(o,'] Missing required params: "keywordList".')),new Error("Params validate failed.");var c=Date.now(),u=new ao(o),l="keywordList:".concat(s," keywordListMatchType:").concat(t.keywordListMatchType," cursor:").concat(t.cursor," count:").concat(r);return Pe.l("".concat(i," ").concat(l)),this.req({P:jc[e],data:this._genParams(e,t)}).then((function(o){var s=(a=o.data).code,a=a.message;if(0!==s)return 60020===(r=s)?r="SearchUnable":e!==wc&&27003===s?r="SearchParamsError":e!==wc&&60018===s&&(r="SearchOverLimit"),r=n.getErrMsg(r)||a,a=new Bn({code:s,message:r}),u.setMessage(l).setError(a).end(),kn(a);n.get(27).isCSPluginEnabled(),a=void 0===(r=(s=o.data).cursor)?"":r;var r=s.totalCount;return s="totalCount:".concat(r," cost:").concat(Jt(c)),Sn({searchResultList:(Pe.l("".concat(i," ok. cursor:").concat(a," ").concat(s)),u.setMessage("".concat(l," ").concat(s)).end(),s=n._genRes(e,t,o.data)),cursor:a,totalCount:r})})).catch((function(e){return u.setMessage(l).setError(e).end(),kn(e)}))}},{key:"_genParams",value:function(e,t){var n=t.count,o=h(t,qc);return n&&(o.count=parseInt(n)),e===wc?this._genMsgParams(o):(n=t.keywordList,t=t.keywordListMatchType,o.keywords=n,o.keywordMatchType="and"===t?1:0,e===Fc?this._genUserParams(o):o)}},{key:"_genMsgParams",value:function(e){var t=e.conversationID,n=e.timePosition,o=e.timePeriod;return e=h(e,Bc),ht(t)||(kt(t)&&(e.account=t.replace(k.CONV_C2C,"")),Rt(t)&&(e.groupID=t.replace(k.CONV_GROUP,""))),We(o)&&0<o&&(We(n)&&0<n?e.startTime=n-o:e.startTime=De()-o),e.startTime&&e.startTime<0&&(e.startTime=void 0),We(n)&&0<n&&(e.endTime=n),e}},{key:"_genUserParams",value:function(e){var t=e.miniBirthday,n=e.maxBirthday;return e=h(e,Hc),We(t)&&(e.miniBirthday=parseInt(t),We(n)||(e.maxBirthday=4294967295)),We(n)&&(e.maxBirthday=parseInt(n)),e}},{key:"_genRes",value:function(e,t,n){switch(e){case wc:return this._genMsgRes(n.searchResult,!t.conversationID);case Fc:return this._genUserRes(n.userList);case xc:return this._genGrpRes(n.groupList);case Vc:return this._genMemberRes(n.groupMemberList);default:return[]}}},{key:"_genMsgRes",value:function(e,t){var n=this.get(11);return Xe(e)&&0!==e.length?e.map((function(e){var o=e.groupID,i=e.userID,s=e.messageCount,a=(e=void 0===(e=e.messageList)?[]:e,{conversationID:i=o?"".concat(k.CONV_GROUP).concat(o):"".concat(k.CONV_C2C).concat(i),messageCount:s,messageList:[]});return t&&1<s||0<(s=e.filter((function(e){return!!e}))).length&&(e=n.onRoamingMessage(s,i,!1),o&&e.reverse(),a.messageList=e,a.messageCount=e.length),a})):[]}},{key:"_genUserRes",value:function(e){var t=this.get(4)._profileHandler;if(!Xe(e))return[];for(var n=[],o=0,i=e.length;o<i;o++){var s=(a=e[o]).userID,a=a.profileItems;"@TLS#NOT_FOUND"!==s&&""!==s&&(s=t._update(s,t._getLatestProfileFromResponse(s,a)).latestProfile,n.push(s))}return n}},{key:"_genGrpRes",value:function(e){if(!Xe(e))return[];for(var t=[],n=0,o=e.length;n<o;n++)e[n]&&e[n].groupID&&t.push(new pi(e[n]));return t}},{key:"_genMemberRes",value:function(e){if(!Xe(e))return[];for(var t,n,o,i,s,a,r=new Map,c=0,u=e.length;c<u;c++)e[c]&&e[c].userID&&e[c].groupID&&(n=(t=e[c]).groupID,i=t.name,s=t.type,a=t.avatar,o=t.nick,i={groupID:n,name:i,type:s,avatar:a},s={userID:t.userID,nick:o,nameCard:t.nameCard},r.has(n)?((a=r.get(n)).memberList.push(s),r.set(n,a)):r.set(n,{groupInfo:i,memberList:[s]}));return v(r.values())}}]),Qc),Yc=(s(Zc,[{key:"_startTimer",value:function(){var e=this._map.get(24),t=e.isWorkerEnabled();Pe.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Pe.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._map.get(24),t=e.isWorkerEnabled();Pe.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Pe.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Pe.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Pe.l("".concat(this._n,"._startMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Pe.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Pe.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=S(this._map);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(o){t.e(o)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._map.get(1)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e,t,n=!0;this._readyList.forEach((function(e){e.isReady()||(n=!1)})),n&&!this._isReady&&(this._isReady=!0,this._oEmitter.emit(D.SDK_READY),e=Date.now()-this._startLoginTs,Pe.w("SDK is ready. cost ".concat(e," ms")),this._startLoginTs=Date.now(),t=this._ssoLogForReady.getStartTs()+Re,this._ssoLogForReady.setMessage(e).start(t).end())}},{key:"login",value:function(){0===this._startLoginTs&&(Se(),this._startLoginTs=Date.now(),this._startTimer(),this._map.get(15).start(),this._ssoLogForReady=new ao("sdkReady"),this._reason=Hn.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOEmitInst",value:function(){return null===this._oEmitter&&(this._oEmitter=new Rs,e=this._oEmitter,jn=e,this._oEmitter._emit=this._oEmitter.emit,this._oEmitter.emit=function(e,t){var n,o,i=this;this._canIUseSignaling()&&(e===D.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(t),e===D.MESSAGE_MODIFIED&&this.get(33).onMessageModified(t)),e===D.CONVERSATION_LIST_UPDATED||e===D.FRIEND_LIST_UPDATED||e===D.GROUP_LIST_UPDATED||e===D.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?!1!==this._eventThrottling?this._eventThrottleMap.has(e)?(n=Date.now())-(o=this._eventThrottleMap.get(e)).last<=1e3?(-1<o.timeoutID&&clearTimeout(o.timeoutID),o.timeoutID=setTimeout((function(){o.last=Date.now(),i._oEmitter._emit.apply(i._oEmitter,[e,{name:e,data:i._getEventData(e)}])}),1e3)):(o.last=n,this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}])):(this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}])):this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}]):this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:t}])}.bind(this)),this._oEmitter;var e}},{key:"_canIUseSignaling",value:function(){var e=this.get(33);return!!e&&e.canIUseSignaling()}},{key:"_getEventData",value:function(e){return e===D.CONVERSATION_LIST_UPDATED?this._map.get(12).isPartialUpdatedConvs()?this._map.get(11).getPartialUpdatedConvs():this._map.get(11).getLocalConvList():e===D.FRIEND_LIST_UPDATED?this._map.get(8).getLocalFriendList(!1):e===D.GROUP_LIST_UPDATED?this._map.get(7).getLocalGroupList():e===D.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._map.get(11).getTotalUnreadCount():e===D.CONVERSATION_ID_LIST_UPDATED?this._map.get(11).getUpdatedConvIDList():void 0}},{key:"getIEmitInst",value:function(){return null===this._iEmitter&&(this._iEmitter=new Rs,this._iEmitter._emit=this._iEmitter.emit,this._iEmitter.emit=function(e,t){e=$e(t)&&t.data?[e,{name:e,data:t.data}]:[e,{name:e,data:t}],this._iEmitter._emit.apply(this._iEmitter,e)}.bind(this)),this._iEmitter}},{key:"hasModule",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"canIUseModule",value:function(e){return!this._map.get(12).isUsingChatCore()||this._optionalModuleMap.has(e)}},{key:"canIUseInflate",value:function(){return!!this._map.get(37)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrMsg",value:function(e,t,n){return this._map.get(32).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"warn",value:function(e,t,n){(e=this.getErrMsg(e,t,n))&&Pe.w(e)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Pe.w("Oops! ".concat(t)),new ao("error").setMessage(t).setLevel("error").end(),this.getOEmitInst().emit(D.ERROR,e)}},{key:"restartTimer",value:function(){Pe.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var e=this.get(7);e&&e.restartPolling()}},{key:"getTimerID",value:function(){var e=this._map.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._map.get(7).getPollingTimerID(e)}},{key:"statTUIKeyFeatures",value:function(e){var t=e.code,n=t+(e=void 0===(e=e.msg)?"":e);this._codeMsgForTUIMap.has(n)||(this._codeMsgForTUIMap.set(n,1),n=this.get(12).getUIPlatform(),new ao("tui_key_features").setCode(t).setMessage(e).setUIPlatform(n).end())}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),Se();var e,t=S(this._map);try{for(t.s();!(e=t.n()).done;){var n=m(e.value,2)[1];n.reset&&n.reset()}}catch(a){t.e(a)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._oEmitter.emit(D.SDK_NOT_READY);var o,i=S(this._eventThrottleMap);try{for(i.s();!(o=i.n()).done;){var s=m(o.value,2)[1];-1<s.timeoutID&&clearTimeout(s.timeoutID)}}catch(a){i.e(a)}finally{i.f()}this._eventThrottleMap.clear(),this._codeMsgForTUIMap.clear()}}]),Zc),zc=(s(Xc,[{key:"defense",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(e,t,n),this._funcMap.get(e).set(t,o)),o}},{key:"defenseOnce",value:function(e,t){return"function"!=typeof t?null:this._pack(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.warn("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var o=this;return function(){try{t.apply(n,Array.from(arguments))}catch(a){var i=Object.values(D).indexOf(e),s="CallbackError";-1!==i&&(i=Object.keys(D)[i],o._m.warn(s,i,a)),o._reportCount<5&&(new ao(s).setMessage("eventName:".concat(e)).setMoreMessage(a.message).end(),o._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){Pe.l("".concat(this._n,".reset")),this._reportCount=0}}]),Xc),Wc=(s($c,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._get(1).login(e)}},{key:"logout",value:function(){var e=this;return this._get(1).logout().then((function(t){return e._safetyCallbackFactory.reset(),e._m.reset(),t}))}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"getServerTime",value:function(){return Le()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrMsg",value:function(e,t,n){return this._m.getErrMsg(e,t,n)}},{key:"_get",value:function(e){return this._m.get(e)}},{key:"destroy",value:function(){var e=this,t=this._get(12),n=t.getSDKAppID();return Pe.w("destroy ".concat(n," ").concat(t.getInstanceID())),this.logout().finally((function(){e._safetyCallbackFactory.destroy(),e._m.stopTimer(),e._get(24).terminate(),e._get(21).dealloc(),e._m.getOEmitInst().emit(D.SDK_DESTROY,{SDKAppID:n})}))}},{key:"on",value:function(e,t,n){Pe.d("on","eventName:".concat(e)),this._m.getOEmitInst().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Pe.d("once","eventName:".concat(e)),this._m.getOEmitInst().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,o){Pe.d("off","eventName:".concat(e));var i=this._safetyCallbackFactory.find(e,t);null!==i&&(this._m.getOEmitInst().off(e,i,n,o),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){(ht(e["tim-push"])?ht(e["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(e)}},{key:"setLogLevel",value:function(e){var t;e<=0&&((t=this.getErrMsg("TIM_ASCII_ART"))&&_("log","at node_modules/@tencentcloud/chat/index.js:1",t),(t=this.getErrMsg("API_REFER"))&&(Kt()?_("log","at node_modules/@tencentcloud/chat/index.js:1","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",t):_("log","at node_modules/@tencentcloud/chat/index.js:1","IM SDK API ->",t)),(t=this.getErrMsg("DOCS_GUIDE"))&&_("log","at node_modules/@tencentcloud/chat/index.js:1",t),t=this.getErrMsg("IOS_WEBVIEW_WARNING"),ye&&t&&_("warn","at node_modules/@tencentcloud/chat/index.js:1",t)),Pe.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._get(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._get(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._get(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._get(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._get(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._get(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._get(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._get(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==k.MSG_MERGER?kn({code:Hn.MSG_MERGER_TYPE_INVALID}):je(e.payload.downloadKey)?kn({code:Hn.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(e).catch((function(e){return kn({code:Hn.MSG_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._get(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof Oo?this._get(2).sendMessageInstance(e,t):kn({code:Hn.MSG_INSTANCE_REQUIRED})}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._get(31).sendMessage(t):"handleGroupInvitation"===e?this._get(7).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._get(27).isFeatureEnabled(t):"isFeatureEnabledForStat"===e?this._get(27).isFeatureEnabledForStat(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e||"sendRoomCustomData"===e?this._get(30).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():"getPollingTimerID"===e?this._m.getPollingTimerID(t):"setApplicationID"===e?(this._get(12).setApplicationID(t),void this._get(20).updateProtocolConfig()):"getServerConfig"===e?this._get(23).getServerConfig(t):"canIUseModule"===e?this._m.canIUseModule(t):"startMessageLongPolling"===e?this._get(7).startMessageLongPolling(t):"stopMessageLongPolling"===e?this._get(7).stopMessageLongPolling(t):"disableMessagePullOnInvite"===e?this._get(11).disableMsgPullOnInvite(t):"clearLocalMessage"===e?this._get(11).clearMemMsg(t,!1):"setCustomLoginInfo"===e?this._get(12).setCustomLoginInfo(t):"statTUIKeyFeatures"===e?this._m.statTUIKeyFeatures(t):kn({code:Hn.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._get(2).revokeMessage(e)}},{key:"resendMessage",value:function(e,t){return e instanceof Oo?this._get(2).resendMessage(e,t):kn({code:Hn.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(e){return this._get(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._get(2).translateText(e)}},{key:"convertVoiceToText",value:function(e){return this._get(2).convertVoiceToText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._get(3).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._get(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._get(3).deleteMessageExtensions(e,t)}},{key:"addMessageReaction",value:function(e,t){return this._get(34).addMessageReaction(e,t)}},{key:"removeMessageReaction",value:function(e,t){return this._get(34).removeMessageReaction(e,t)}},{key:"getMessageReactions",value:function(e){return this._get(34).getMessageReactions(e)}},{key:"getAllUserListOfMessageReaction",value:function(e){return this._get(34).getAllUserListOfMessageReaction(e)}},{key:"modifyMessage",value:function(e){return this._get(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._get(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._get(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._get(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._get(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){var t=this._get(7);return t?t.getReadReceiptDetail(e):kn({code:Hn.NO_MODULE})}},{key:"findMessage",value:function(e){return this._get(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._get(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._get(11).getConvList(e)}},{key:"getConversationProfile",value:function(e){return this._get(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._get(11).deleteConversation(e)}},{key:"setConversationDraft",value:function(e){return this._get(11).setConvDraft(e)}},{key:"clearHistoryMessage",value:function(e){return this._get(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._get(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._get(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._get(11).setMessageRemindType(e)}},{key:"setAllReceiveMessageOpt",value:function(e){return this._get(11).setAllRcvMsgOpt(e)}},{key:"getAllReceiveMessageOpt",value:function(){return this._get(11).getAllRcvMsgOpt()}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadCount()}},{key:"setConversationCustomData",value:function(e){return this._get(11).setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._get(11).markConv(e)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._get(11).createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._get(11).deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._get(11).renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._get(11).addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._get(11).deleteConvsFromGroup(e)}},{key:"searchCloudMessages",value:function(e){var t=this._get(38);return t?t.searchCloudMessages(e):kn({code:Hn.NO_MODULE})}},{key:"searchCloudUsers",value:function(e){var t=this._get(38);return t?t.searchCloudUsers(e):kn({code:Hn.NO_MODULE})}},{key:"searchCloudGroups",value:function(e){var t=this._get(38);return t?t.searchCloudGroups(e):kn({code:Hn.NO_MODULE})}},{key:"searchCloudGroupMembers",value:function(e){var t=this._get(38);return t?t.searchCloudGroupMembers(e):kn({code:Hn.NO_MODULE})}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._get(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._get(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._get(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._get(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._get(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._get(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._get(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._get(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._get(8);return e?e.getLocalFriendList():kn({code:Hn.NO_MODULE})}},{key:"addFriend",value:function(e){var t=this._get(8);return t?t.addFriend(e):kn({code:Hn.NO_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._get(8);return t?t.deleteFriend(e):kn({code:Hn.NO_MODULE})}},{key:"checkFriend",value:function(e){var t=this._get(8);return t?t.checkFriend(e):kn({code:Hn.NO_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._get(8);return t?t.getFriendProfile(e):kn({code:Hn.NO_MODULE})}},{key:"updateFriend",value:function(e){var t=this._get(8);return t?t.updateFriend(e):kn({code:Hn.NO_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._get(8);return e?e.getLocalFriendApplicationList():kn({code:Hn.NO_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._get(8);return t?t.acceptFriendApplication(e):kn({code:Hn.NO_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._get(8);return t?t.refuseFriendApplication(e):kn({code:Hn.NO_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._get(8);return t?t.deleteFriendApplication(e):kn({code:Hn.NO_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._get(8);return e?e.setFriendApplicationRead():kn({code:Hn.NO_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._get(8);return e?e.getLocalFriendGroupList():kn({code:Hn.NO_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._get(8);return t?t.createFriendGroup(e):kn({code:Hn.NO_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._get(8);return t?t.deleteFriendGroup(e):kn({code:Hn.NO_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._get(8);return t?t.addToFriendGroup(e):kn({code:Hn.NO_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._get(8);return t?t.removeFromFriendGroup(e):kn({code:Hn.NO_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._get(8);return t?t.renameFriendGroup(e):kn({code:Hn.NO_MODULE})}},{key:"followUser",value:function(e){var t=this._get(35);return t?t.followUser(e):kn({code:Hn.NO_MODULE})}},{key:"unfollowUser",value:function(e){var t=this._get(35);return t?t.unfollowUser(e):kn({code:Hn.NO_MODULE})}},{key:"getMyFollowersList",value:function(e){var t=this._get(35);return t?t.getMyFollowersList(e):kn({code:Hn.NO_MODULE})}},{key:"getMyFollowingList",value:function(e){var t=this._get(35);return t?t.getMyFollowingList(e):kn({code:Hn.NO_MODULE})}},{key:"getMutualFollowersList",value:function(e){var t=this._get(35);return t?t.getMutualFollowersList(e):kn({code:Hn.NO_MODULE})}},{key:"getUserFollowInfo",value:function(e){var t=this._get(35);return t?t.getUserFollowInfo(e):kn({code:Hn.NO_MODULE})}},{key:"checkFollowType",value:function(e){var t=this._get(35);return t?t.checkFollowType(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupList",value:function(){var e=this._get(7);return e?e.getGroupList():kn({code:Hn.NO_MODULE})}},{key:"getGroupProfile",value:function(e){var t=this._get(7);return t?t.getGroupProfile(e):kn({code:Hn.NO_MODULE})}},{key:"createGroup",value:function(e){var t=this._get(7);return t?t.createGroup(e):kn({code:Hn.NO_MODULE})}},{key:"dismissGroup",value:function(e){var t=this._get(7);return t?t.dismissGroup(e):kn({code:Hn.NO_MODULE})}},{key:"updateGroupProfile",value:function(e){var t=this._get(7);return t?t.updateGroupProfile(e):kn({code:Hn.NO_MODULE})}},{key:"joinGroup",value:function(e){var t=this._get(7);return t?t.joinGroup(e):kn({code:Hn.NO_MODULE})}},{key:"quitGroup",value:function(e){var t=this._get(7);return t?t.quitGroup(e):kn({code:Hn.NO_MODULE})}},{key:"searchGroupByID",value:function(e){var t=this._get(7);return t?t.searchGroupByID(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._get(7);return t?t.getGroupOnlineMemberCount(e):kn({code:Hn.NO_MODULE})}},{key:"changeGroupOwner",value:function(e){var t=this._get(7);return t?t.changeGroupOwner(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupApplicationList",value:function(){var e=this._get(7);return e?e.getGroupApplicationList():kn({code:Hn.NO_MODULE})}},{key:"handleGroupApplication",value:function(e){var t=this._get(7);return t?t.handleGroupApplication(e):kn({code:Hn.NO_MODULE})}},{key:"initGroupAttributes",value:function(e){var t=this._get(7);return t?t.initGroupAttributes(e):kn({code:Hn.NO_MODULE})}},{key:"setGroupAttributes",value:function(e){var t=this._get(7);return t?t.setGroupAttributes(e):kn({code:Hn.NO_MODULE})}},{key:"deleteGroupAttributes",value:function(e){var t=this._get(7);return t?t.deleteGroupAttributes(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupAttributes",value:function(e){var t=this._get(7);return t?t.getGroupAttributes(e):kn({code:Hn.NO_MODULE})}},{key:"setGroupCounters",value:function(e){var t=this._get(7);return t?t.setGroupCounters(e):kn({code:Hn.NO_MODULE})}},{key:"increaseGroupCounter",value:function(e){var t=this._get(7);return t?t.increaseGroupCounter(e):kn({code:Hn.NO_MODULE})}},{key:"decreaseGroupCounter",value:function(e){var t=this._get(7);return t?t.decreaseGroupCounter(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupCounters",value:function(e){var t=this._get(7);return t?t.getGroupCounters(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupMemberList",value:function(e){var t=this._get(7);return t?t.getGroupMemberList(e):kn({code:Hn.NO_MODULE})}},{key:"getGroupMemberProfile",value:function(e){var t=this._get(7);return t?t.getGroupMemberProfile(e):kn({code:Hn.NO_MODULE})}},{key:"addGroupMember",value:function(e){var t=this._get(7);return t?t.addGroupMember(e):kn({code:Hn.NO_MODULE})}},{key:"deleteGroupMember",value:function(e){var t=this._get(7);return t?t.deleteGroupMember(e):kn({code:Hn.NO_MODULE})}},{key:"setGroupMemberMuteTime",value:function(e){var t=this._get(7);return t?t.setGroupMemberMuteTime(e):kn({code:Hn.NO_MODULE})}},{key:"setGroupMemberRole",value:function(e){var t=this._get(7);return t?t.setGroupMemberRole(e):kn({code:Hn.NO_MODULE})}},{key:"setGroupMemberNameCard",value:function(e){var t=this._get(7);return t?t.setGroupMemberNameCard(e):kn({code:Hn.NO_MODULE})}},{key:"setGroupMemberCustomField",value:function(e){var t=this._get(7);return t?t.setGroupMemberCustomField(e):kn({code:Hn.NO_MODULE})}},{key:"markGroupMemberList",value:function(e){var t=this._get(7);return t?t.markGroupMemberList(e):kn({code:Hn.NO_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._get(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._get(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._get(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._get(10).getTopicList(e)}},{key:"addSignalingListener",value:function(e,t,n){var o=this._get(33);o&&o.addSignalingListener(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"removeSignalingListener",value:function(e,t,n){var o,i=this._safetyCallbackFactory.find(e,t);null===i||(o=this._get(33))&&(o.removeSignalingListener(e,i,n),this._safetyCallbackFactory.delete(e,t))}},{key:"invite",value:function(e){var t=this._get(33);return t?t.invite(e):kn({code:Hn.NO_MODULE})}},{key:"inviteSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"inviteInGroup",value:function(e){var t=this._get(33);return t?t.invite(e):kn({code:Hn.NO_MODULE})}},{key:"inviteInGroupSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"cancel",value:function(e){var t=this._get(33);return t?t.cancel(e):kn({code:Hn.NO_MODULE})}},{key:"accept",value:function(e){var t=this._get(33);return t?t.accept(e):kn({code:Hn.NO_MODULE})}},{key:"reject",value:function(e){var t=this._get(33);return t?t.reject(e):kn({code:Hn.NO_MODULE})}},{key:"getSignalingInfo",value:function(e){var t=this._get(33);return t?t.getSignalingInfo(e):null}},{key:"modifyInvitation",value:function(e){var t=this._get(33);return t?t.modifyInvitation(e):kn({code:Hn.NO_MODULE})}}]),$c),Jc={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function $c(e){o(this,$c),e={SDKAppID:e.SDKAppID,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,instanceID:Nt(),devMode:e.devMode||!1,testEnv:e.testEnv||!1,proxyServer:e.proxyServer||void 0,fileUploadProxy:e.fileUploadProxy||void 0,fileDownloadProxy:e.fileDownloadProxy||e.fileUploadProxy||void 0,eventThrottling:!1!==e.eventThrottling,partialUpdatedConversations:!0===e.partialUpdatedConversations,disableIndependentDomain:!0===e.disableIndependentDomain,modules:e.modules||void 0},this._m=new Yc(e),this._safetyCallbackFactory=new zc(this._m)}function Xc(e){o(this,Xc),this._funcMap=new Map,this._m=e,this._n="SafetyCallback",this._reportCount=0}function Zc(e){var t=this;o(this,Zc);var n,i=new ao("sdkConstruct"),s=(this._n="ModuleManager",this._isReady=!1,this._reason=Hn.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._map=new Map,this._optionalModuleMap=new Map,this._codeMsgForTUIMap=new Map,this._iEmitter=null,this._oEmitter=null,this._checkCount=0,this._checkTimer=-1,this._map.set(12,new xi(this,e)),this._map.set(37,new Gc(this)),this._map.set(15,new Ms(this)),this._map.set(27,new pr(this)),this._map.set(23,new $a(this)),this._map.set(24,new lr(this)),this._map.set(26,new nr(this)),this._map.set(21,new ya(this)),this._map.set(20,new Ja(this)),this._map.set(1,new qi(this)),this._map.set(2,new Ks(this)),this._map.set(3,new Ys(this)),this._map.set(34,new zs(this)),this._map.set(31,new Ws(this)),this._map.set(4,new Fi(this)),this._map.set(6,new zo(this)),this._map.set(11,new mi(this)),this._map.set(7,new Ai(this)),this._map.set(10,new Pi(this)),this._map.set(13,new fs(this)),this._map.set(32,new mr(this)),this._map.set(14,new vs(this)),this._map.set(17,new Os(this)),this._map.set(18,new Js(this)),this._map.set(19,new $s(this)),this._map.set(25,new Xa(this)),this._map.set(8,new ur(this)),this._map.set(28,new hr(this)),this._map.set(36,new gr(this)),this._map.set(29,new _r(this)),this._map.set(30,new fr(this)),this._map.set(33,new Er(this)),this._map.set(35,new Rr(this)),this._map.set(38,new Kc(this)),this._eventThrottleMap=new Map,this._eventThrottling=e.eventThrottling,this._map.get(12).isPartialUpdatedConvs()&&(this._eventThrottling=!1),$e(e.modules)?(Object.keys(e.modules).forEach((function(o){n=e.modules[o],"group-module"===o?t._map.set(7,new n(t)):"relationship-module"===o?t._map.set(8,new n(t)):"signaling-module"===o?t._map.set(33,new n(t)):"follow-module"===o?t._map.set(35,new n(t)):"cloud-search-module"===o&&t._map.set(38,new n(t)),t._optionalModuleMap.set(o,1)})),this._map.get(12).setUsingChatCore(!0)):this._map.has(7)||this._map.get(12).setUsingChatCore(!0),e.instanceID),a=e.SDKAppID,r=this._map.get(12).isIntl(),c=this._map.get(12).isUsingChatCore();s="instanceID:".concat(s," SDKAppID:").concat(a," isIntl:").concat(r," isUsingChatCore:").concat(c," host:").concat(Pt())+" isIOSWebView:".concat(ye," platform:").concat(ae," canIUseInflate:").concat(this.canIUseInflate())+" workerAvailable:".concat(fe," eventThrottling:").concat(this._eventThrottling," UserAgent:").concat(se),ao.bindEventStatModule(this._map.get(14)),ao.bindNetMonitorModule(this._map.get(15)),i.setMessage("".concat(s," ").concat(function(){var e="";if(ee)try{var t=ie.getSystemInfoSync(),n=t.model,o=t.version,i=t.system,s=t.platform,a=t.SDKVersion;e="model:".concat(n," version:").concat(o," system:").concat(i," platform:").concat(s," SDKVersion:").concat(a)}catch(r){e=""}return e}())).end(),Pe.i("SDK ".concat(s)),Bn.prototype._getErrMsg=this.getErrMsg.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function Qc(e){return o(this,Qc),(e=bc.call(this,e))._n="CSModule",e}function eu(e){o(this,eu),this._m=e,this._n="InflateModule",this._bLogForInflateOK=!1,this._bLogForInflateError=!1}var tu={};return(Z={}).create=function(e){var n,o,i,s="TencentCloudChat.create",a=0;if(We(i=e.SDKAppID))a=i;else if(a=parseInt(i),isNaN(i))return Pe.e("".concat(s," failed. Failed to parse the SDKAppID, please check the arguments")),null;return a&&tu[a]?tu[a]:(Pe.l("".concat(s)),(i=new Wc(t(t({},e),{},{SDKAppID:a}))).on(D.SDK_DESTROY,(function(e){tu[e.data.SDKAppID]=null,delete tu[e.data.SDKAppID]})),n=i,o=Object.create(null),Object.keys(qn).forEach((function(e){var t;n[e]&&(t=new L,o[e]=function(){var o=Array.from(arguments);return t.use((function(t,o){var i=function(e,t){if(e.isReady()||1===Jc[t])return!0;var n={code:n=e.getNotReadyReason(),message:"".concat(e.getErrMsg(n)," | ").concat(t," | ").concat(e.getErrMsg(Hn.SDK_IS_NOT_READY))};return e.onError(n),n}(n,e);return!0===i?o():kn(i)})).use((function(t,n){if(!0===function(e,t,n){if(void 0===t)return!0;var o=!0;if($e(t))Object.keys(t).forEach((function(i){var s=1===e.length?e[0][i]:void 0;o=!!Xt(s,t[i],n,i)&&o}));else if(Xe(t))for(var i=0;i<t.length;i++)o=!!Xt(e[i],t[i],n,t[i].name)&&o;if(o)return o;throw new Error("Params validate failed.")}(t,Vn[e],e))return n()})).use((function(t,o){return n[e].apply(n,t)})),t.run(o)})})),e=o,tu[a]=e,Vn.hookGetAPITips(i.getErrMsg.bind(i)),Pe.l("".concat(s," ok")),e)},Z.TYPES=k,Z.EVENT=D,Z.TSignaling=R,Z.VERSION="3.5.2",Pe.l("TencentCloudChat.VERSION:".concat(Z.VERSION)),Z}();const E=C(T.exports);var S={exports:{}};!function(e){e.exports=function(){function e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if(null==e)return{};var n,o,i=function(e,t){if(null==e)return{};var n,o,i={},s=Object.keys(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(o=0;o<s.length;o++)n=s[o],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(i[n]=e[n])}return i}var c=void 0!==M?M:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},u="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),l="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),d="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),p="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),h="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),g="undefined"!=typeof uni&&"undefined"==typeof window&&!0,f=g&&"ios"===uni.getDeviceInfo().platform.toLocaleLowerCase(),m=(g&&uni.getDeviceInfo().platform.toLocaleLowerCase(),u||l||d||p||h||g),v=void 0!==c&&(void 0!==c.nativeModuleProxy||void 0!==c.ReactNative),y=l?qq:d?tt:p?swan:h?my:u?wx:g?uni:{},I=function(e){if("object"!==n(e)||null===e)return!1;var t=Object.getPrototypeOf(e);if(null===t)return!0;for(var o=t;null!==Object.getPrototypeOf(o);)o=Object.getPrototypeOf(o);return t===o};function C(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(I(e)){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1}var T=function(){function e(){o(this,e),this._n="WebRequest"}return s(e,[{key:"request",value:function(e,n){var o=this,i="".concat(this._n,".request"),s=e.downloadUrl||"",a=(e.method||"PUT").toUpperCase(),r=e.url;if(_("log","at node_modules/tim-upload-plugin/index.js:1","%c tim-upload-plugin %c","background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent","".concat(i," URL:").concat(r)),e.qs){var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"&",n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"=";return C(e)?"":I(e)?Object.keys(e).map((function(o){var i=encodeURIComponent(o)+n;return Array.isArray(e[o])?e[o].map((function(e){return i+encodeURIComponent(e)})).join(t):i+encodeURIComponent(e[o])})).filter(Boolean).join(t):void 0}(e.qs);c&&(r+="".concat(-1===r.indexOf("?")?"?":"&").concat(c))}var u=new XMLHttpRequest;u.open(a,r,!0),u.responseType=e.dataType||"text";var l=e.headers||{};if(e.uploadByIP&&(l=t(t({},l),{},{host:e.uploadIP})),!C(l))for(var d in l)l.hasOwnProperty(d)&&"content-length"!==d.toLowerCase()&&"user-agent"!==d.toLowerCase()&&"origin"!==d.toLowerCase()&&"host"!==d.toLowerCase()&&u.setRequestHeader(d,l[d]);return u.onload=function(){if(200===u.status)n(null,o._xhrRes(u,o._xhrBody(u,s,e.uploadByIP&&e.uploadIP),l));else{if(e.uploadIP&&-1===e.url.indexOf(e.uploadIP))return e.url=(i=e.url,a=e.uploadIP,i.replace(/^http(s)?:\/\/(.*?)\//,"https://".concat(a,"/"))),e.uploadByIP=!0,o.request(e,n);var t={code:u.status,message:JSON.stringify(u.responseText)};n(t,o._xhrRes(u,o._xhrBody(u,s,e.uploadByIP&&e.uploadIP),l))}var i,a},u.onerror=function(t){var i=o._xhrBody(u,s,e.uploadByIP&&e.uploadIP),a={code:u.status,message:JSON.stringify(u.responseText)};i||u.statusText||0!==u.status||(t.message="CORS blocked or network error"),n(a,o._xhrRes(u,i)),a=null},e.onProgress&&u.upload&&(u.upload.onprogress=function(t){var n=t.total,o=t.loaded,i=Math.floor(100*o/n);e.onProgress({total:n,loaded:o,percent:(i>=100?100:i)/100})}),u.send(e.resources),u}},{key:"_xhrRes",value:function(e,t){var n={};return e.getAllResponseHeaders().trim().split("\n").forEach((function(e){if(e){var t=e.indexOf(":"),o=e.substr(0,t).trim().toLowerCase(),i=e.substr(t+1).trim();n[o]=i}})),{statusCode:e.status,statusMessage:e.statusText,headers:n,data:t}}},{key:"_xhrBody",value:function(e,t,n){return 200===e.status&&t?{location:t,uploadIP:n}:{response:e.responseText,uploadIP:n}}}]),e}(),E=["unknown","image","video","audio","log"],S=["name"],D=function(){function e(){o(this,e)}return s(e,[{key:"request",value:function(e,n){var o=this,i=e.resources,s=void 0===i?"":i,a=e.headers,c=void 0===a?{}:a,u=e.url,l=e.downloadUrl,d=void 0===l?"":l,p=u,g=null,_=d.match(/^(https?:\/\/[^/]+\/)([^/]*\/?)(.*)$/),m=decodeURIComponent(_[3]),v=m.indexOf("?")>-1?m.split("?")[0]:m,I={key:e.fileKey?e.fileKey:v,success_action_status:200,"Content-Type":""},M={};if(f){var C=u.split("?sign=");if(C.length>1){var T=C[1];p="".concat(C[0],"?sign=").concat(encodeURIComponent("".concat(T))),M.sign=decodeURIComponent(T),M.signature=decodeURIComponent(T)}}var D={url:p,header:c,name:"file",filePath:s,formData:t(t({},I),M),timeout:e.timeout||3e5};if(h){var k=D;k.name,D=t(t({},r(k,S)),{},{fileName:"file",fileType:E[e.fileType]})}return(g=y.uploadFile(t(t({},D),{},{success:function(e){o._handleResponse({response:e,downloadUrl:d,callback:n})},fail:function(e){o._handleResponse({response:e,downloadUrl:d,callback:n})}}))).onProgressUpdate&&g.onProgressUpdate((function(t){e.onProgress&&e.onProgress({total:t.totalBytesExpectedToSend,loaded:t.totalBytesSent,percent:Math.floor(t.progress)/100})})),g}},{key:"_handleResponse",value:function(e){var n=e.downloadUrl,o=e.response,i=e.callback,s=o.header,a={};if(s)for(var r in s)s.hasOwnProperty(r)&&(a[r.toLowerCase()]=s[r]);var c=+o.statusCode;200===c?i(null,{statusCode:c,headers:a,data:t(t({},o.data),{},{location:n})}):i({code:c,message:JSON.stringify(o.data)},{statusCode:c,headers:a,data:void 0})}}]),e}(),k=function(){function e(){o(this,e)}return s(e,[{key:"request",value:function(e,t){var n=this,o=e.resources,i=void 0===o?"":o,s=e.fileKey,a=void 0===s?"":s,r=e.url,c=e.downloadUrl,u=void 0===c?"":c,l=new FormData;l.append("key",a),l.append("success_action_status",200),l.append("file",{uri:i,type:"application/octet-stream",name:"uploaded_file"}),fetch(r,{method:"POST",headers:{"Content-Type":"multipart/form-data"},body:l}).then((function(e){n._handleResponse({response:e,downloadUrl:u,callback:t})})).catch((function(e){n._handleResponse({response:e,downloadUrl:u,callback:t})}))}},{key:"_handleResponse",value:function(e){var t=e.downloadUrl,n=e.response,o=e.callback,i=n.headers,s=n.status,a=i&&i.map||{};200===s?o(null,{statusCode:200,headers:a,data:{location:t}}):o({code:s,message:JSON.stringify(n)},{statusCode:s,headers:a,data:void 0})}}]),e}();return function(){function e(){o(this,e),this.retry=1,this.tryCount=0,this.systemClockOffset=0,this.httpRequest=m?new D:v?new k:new T,_("log","at node_modules/tim-upload-plugin/index.js:1","TIMUploadPlugin.VERSION: ".concat("1.4.2"))}return s(e,[{key:"uploadFile",value:function(e,t){var n=this;return this.httpRequest.request(e,(function(o,i){o&&n.tryCount<n.retry&&n.allowRetry(o)?(n.tryCount++,n.uploadFile(e,t)):(n.tryCount=0,t(o,i))}))}},{key:"allowRetry",value:function(e){var t=!1,n=!1;if(e){var o=e.headers&&(e.headers.date||e.headers.Date)||e.error&&e.error.ServerTime;try{var i=e.error&&e.error.Code,s=e.error&&e.error.Message;("RequestTimeTooSkewed"===i||"AccessDenied"===i&&"Request has expired"===s)&&(n=!0)}catch(c){}if(n&&o){var a=Date.now(),r=Date.parse(o);Math.abs(a+this.systemClockOffset-r)>=3e4&&(this.systemClockOffset=r-a,t=!0)}else 5===Math.floor(e.statusCode/100)&&(t=!0)}return t}}],[{key:"getVersion",value:function(){return"1.4.2"}}]),e}()}()}(S);const D=C(S.exports);var k=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,62,0,62,0,63,52,53,54,55,56,57,58,59,60,61,0,0,0,0,0,0,0,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,0,0,0,0,63,0,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];const R={getRandomValues(e){if(!(e instanceof Int8Array||e instanceof Uint8Array||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Uint8ClampedArray))throw new Error("Expected an integer array");if(e.byteLength>65536)throw new Error("Can only request a maximum of 65536 bytes");return function(e,t){for(var n,o=e.length,i="="===e[o-2]?2:"="===e[o-1]?1:0,s=0,a=o-i&4294967292,r=0;r<a;r+=4)n=k[e.charCodeAt(r)]<<18|k[e.charCodeAt(r+1)]<<12|k[e.charCodeAt(r+2)]<<6|k[e.charCodeAt(r+3)],t[s++]=n>>16&255,t[s++]=n>>8&255,t[s++]=255&n;1===i&&(n=k[e.charCodeAt(r)]<<10|k[e.charCodeAt(r+1)]<<4|k[e.charCodeAt(r+2)]>>2,t[s++]=n>>8&255,t[s++]=255&n),2===i&&(n=k[e.charCodeAt(r)]<<2|k[e.charCodeAt(r+1)]>>4,t[s++]=255&n)}(g("DCloud-Crypto").getRandomValues(e.byteLength),new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e}};var L={exports:{}};!function(e){e.exports=function(){function e(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function t(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,(i=void 0,"symbol"==typeof(i=function(e,t){if("object"!=typeof e||null===e)return e;var n=e[Symbol.toPrimitive];if(void 0!==n){var o=n.call(e,t||"default");if("object"!=typeof o)return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(o.key,"string"))?i:String(i)),o)}var i}function n(e,n,o){return n&&t(e.prototype,n),o&&t(e,o),Object.defineProperty(e,"prototype",{writable:!1}),e}function o(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,s,a,r=[],c=!0,u=!1;try{if(s=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;c=!1}else for(;!(c=(o=s.call(n)).done)&&(r.push(o.value),r.length!==t);c=!0);}catch(l){u=!0,i=l}finally{try{if(!c&&null!=n.return&&(a=n.return(),Object(a)!==a))return}finally{if(u)throw i}}return r}}(e,t)||s(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function i(e){return function(e){if(Array.isArray(e))return a(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||s(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function s(e,t){if(e){if("string"==typeof e)return a(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?a(e,t):void 0}}function a(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function r(e,t){var n="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!n){if(Array.isArray(e)||(n=s(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var o=0,i=function(){};return{s:i,n:function(){return o>=e.length?{done:!0}:{done:!1,value:e[o++]}},e:function(e){throw e},f:i}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,r=!0,c=!1;return{s:function(){n=n.call(e)},n:function(){var e=n.next();return r=e.done,e},e:function(e){c=!0,a=e},f:function(){try{r||null==n.return||n.return()}finally{if(c)throw a}}}}var c,u,l=function(){for(var e=" \t\r\n~!@#$%^&*()_+-=【】、{}|;':\"，。、《》？αβγδεζηθικλμνξοπρστυφχψωΑΒΓΔΕΖΗΘΙΚΛΜΝΞΟΠΡΣΤΥΦΧΨΩ。，、；：？！…—·ˉ¨‘’“”々～‖∶＂＇｀｜〃〔〕〈〉《》「」『』．〖〗【】（）［］｛｝ⅠⅡⅢⅣⅤⅥⅦⅧⅨⅩⅪⅫ⒈⒉⒊⒋⒌⒍⒎⒏⒐⒑⒒⒓⒔⒕⒖⒗⒘⒙⒚⒛㈠㈡㈢㈣㈤㈥㈦㈧㈨㈩①②③④⑤⑥⑦⑧⑨⑩⑴⑵⑶⑷⑸⑹⑺⑻⑼⑽⑾⑿⒀⒁⒂⒃⒄⒅⒆⒇≈≡≠＝≤≥＜＞≮≯∷±＋－×÷／∫∮∝∞∧∨∑∏∪∩∈∵∴⊥∥∠⌒⊙≌∽√§№☆★○●◎◇◆□℃‰€■△▲※→←↑↓〓¤°＃＆＠＼︿＿￣―♂♀┌┍┎┐┑┒┓─┄┈├┝┞┟┠┡┢┣│┆┊┬┭┮┯┰┱┲┳┼┽┾┿╀╁╂╃└┕┖┗┘┙┚┛━┅┉┤┥┦┧┨┩┪┫┃┇┋┴┵┶┷┸┹┺┻╋╊╉╈╇╆╅╄",t=new Map,n=0,o=e.length;n<o;n++)t.set(e.charCodeAt(0),!0);return t}(),d=function(){function t(n){e(this,t);var o,s=n.input,a=n.isArray,r=n.isMap;this._trieTree={},a(s)?o=s:r(s)&&(o=i(s.keys()),this._map=s);for(var c=0,u=o.length;c<u;c++)if(o[c]){for(var l=this._trieTree,d=o[c],p=0,h=d.length;p<h;p++)l[d[p]]||(l[d[p]]={}),l=l[d[p]];l.isEnd=!0}}return n(t,[{key:"filter",value:function(e){var t=e.text,n=e.replacingEnabled;if(0===Object.keys(this._trieTree).length)return{isMatched:!1,modifiedText:t};for(var o=this._trieTree,i=t.toLowerCase(),s="",a=!1,r=i.length,c=0;c<r;c++)if(!0!==l.get(i.charCodeAt(c))){for(var u=0,d="",p=!1,h=c;h<r;h++){if(!o[i[h]]){o=this._trieTree;break}if(d+=i[h],o[i[h]].isEnd){p=!0,u=h-c,o=this._trieTree;break}o=o[i[h]]}if(u>1&&(c+=u),p){if(a=!0,!n)break;var g=this._map.get(d)||"*";s=t.replace(new RegExp(d,"gi"),g)}}return{isMatched:a,modifiedText:s}}},{key:"reset",value:function(){this._trieTree={},this._map=null}}]),t}(),p="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:void 0!==M?M:"undefined"!=typeof self?self:{},h={},g=(c=function(e,t){var n,o,i,s,a,r,c,u,l,d,g,_,f;e.exports=(r=r||function(e){var t;if("undefined"!=typeof window&&R&&(t=R),!t&&"undefined"!=typeof window&&window.msCrypto&&(t=window.msCrypto),!t&&void 0!==p&&p.crypto&&(t=p.crypto),!t)try{t=h}catch(f){}var n=function(){if(t){if("function"==typeof t.getRandomValues)try{return t.getRandomValues(new Uint32Array(1))[0]}catch(f){}if("function"==typeof t.randomBytes)try{return t.randomBytes(4).readInt32LE()}catch(f){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),i={},s=i.lib={},a=s.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},r=s.WordArray=a.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes,i=e.sigBytes;if(this.clamp(),o%4)for(var s=0;s<i;s++){var a=n[s>>>2]>>>24-s%4*8&255;t[o+s>>>2]|=a<<24-(o+s)%4*8}else for(s=0;s<i;s+=4)t[o+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=a.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],o=0;o<e;o+=4)t.push(n());return new r.init(t,e)}}),c=i.enc={},u=c.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;o.push((s>>>4).toString(16)),o.push((15&s).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new r.init(n,t/2)}},l=c.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new r.init(n,t)}},d=c.Utf8={stringify:function(e){try{return decodeURIComponent(escape(l.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return l.parse(unescape(encodeURIComponent(e)))}},g=s.BufferedBlockAlgorithm=a.extend({reset:function(){this._data=new r.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=d.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,o=this._data,i=o.words,s=o.sigBytes,a=this.blockSize,c=s/(4*a),u=(c=t?e.ceil(c):e.max((0|c)-this._minBufferSize,0))*a,l=e.min(4*u,s);if(u){for(var d=0;d<u;d+=a)this._doProcessBlock(i,d);n=i.splice(0,u),o.sigBytes-=l}return new r.init(n,l)},clone:function(){var e=a.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),_=(s.Hasher=g.extend({cfg:a.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){g.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new _.HMAC.init(e,n).finalize(t)}}}),i.algo={});return i}(Math),a=(s=r).lib.WordArray,s.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp();for(var i=[],s=0;s<n;s+=3)for(var a=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,r=0;r<4&&s+.75*r<n;r++)i.push(o.charAt(a>>>6*(3-r)&63));var c=o.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var i=0;i<n.length;i++)o[n.charCodeAt(i)]=i}var s=n.charAt(64);if(s){var r=e.indexOf(s);-1!==r&&(t=r)}return function(e,t,n){for(var o=[],i=0,s=0;s<t;s++)if(s%4){var r=n[e.charCodeAt(s-1)]<<s%4*2|n[e.charCodeAt(s)]>>>6-s%4*2;o[i>>>2]|=r<<24-i%4*8,i++}return a.create(o,i)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},function(e){var t=r,n=t.lib,o=n.WordArray,i=n.Hasher,s=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=s.MD5=i.extend({_doReset:function(){this._hash=new o.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,i=e[o];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,r=e[t+0],c=e[t+1],h=e[t+2],g=e[t+3],_=e[t+4],f=e[t+5],m=e[t+6],v=e[t+7],y=e[t+8],I=e[t+9],M=e[t+10],C=e[t+11],T=e[t+12],E=e[t+13],S=e[t+14],D=e[t+15],k=s[0],R=s[1],L=s[2],A=s[3];k=u(k,R,L,A,r,7,a[0]),A=u(A,k,R,L,c,12,a[1]),L=u(L,A,k,R,h,17,a[2]),R=u(R,L,A,k,g,22,a[3]),k=u(k,R,L,A,_,7,a[4]),A=u(A,k,R,L,f,12,a[5]),L=u(L,A,k,R,m,17,a[6]),R=u(R,L,A,k,v,22,a[7]),k=u(k,R,L,A,y,7,a[8]),A=u(A,k,R,L,I,12,a[9]),L=u(L,A,k,R,M,17,a[10]),R=u(R,L,A,k,C,22,a[11]),k=u(k,R,L,A,T,7,a[12]),A=u(A,k,R,L,E,12,a[13]),L=u(L,A,k,R,S,17,a[14]),k=l(k,R=u(R,L,A,k,D,22,a[15]),L,A,c,5,a[16]),A=l(A,k,R,L,m,9,a[17]),L=l(L,A,k,R,C,14,a[18]),R=l(R,L,A,k,r,20,a[19]),k=l(k,R,L,A,f,5,a[20]),A=l(A,k,R,L,M,9,a[21]),L=l(L,A,k,R,D,14,a[22]),R=l(R,L,A,k,_,20,a[23]),k=l(k,R,L,A,I,5,a[24]),A=l(A,k,R,L,S,9,a[25]),L=l(L,A,k,R,g,14,a[26]),R=l(R,L,A,k,y,20,a[27]),k=l(k,R,L,A,E,5,a[28]),A=l(A,k,R,L,h,9,a[29]),L=l(L,A,k,R,v,14,a[30]),k=d(k,R=l(R,L,A,k,T,20,a[31]),L,A,f,4,a[32]),A=d(A,k,R,L,y,11,a[33]),L=d(L,A,k,R,C,16,a[34]),R=d(R,L,A,k,S,23,a[35]),k=d(k,R,L,A,c,4,a[36]),A=d(A,k,R,L,_,11,a[37]),L=d(L,A,k,R,v,16,a[38]),R=d(R,L,A,k,M,23,a[39]),k=d(k,R,L,A,E,4,a[40]),A=d(A,k,R,L,r,11,a[41]),L=d(L,A,k,R,g,16,a[42]),R=d(R,L,A,k,m,23,a[43]),k=d(k,R,L,A,I,4,a[44]),A=d(A,k,R,L,T,11,a[45]),L=d(L,A,k,R,D,16,a[46]),k=p(k,R=d(R,L,A,k,h,23,a[47]),L,A,r,6,a[48]),A=p(A,k,R,L,v,10,a[49]),L=p(L,A,k,R,S,15,a[50]),R=p(R,L,A,k,f,21,a[51]),k=p(k,R,L,A,T,6,a[52]),A=p(A,k,R,L,g,10,a[53]),L=p(L,A,k,R,M,15,a[54]),R=p(R,L,A,k,c,21,a[55]),k=p(k,R,L,A,y,6,a[56]),A=p(A,k,R,L,D,10,a[57]),L=p(L,A,k,R,m,15,a[58]),R=p(R,L,A,k,E,21,a[59]),k=p(k,R,L,A,_,6,a[60]),A=p(A,k,R,L,C,10,a[61]),L=p(L,A,k,R,h,15,a[62]),R=p(R,L,A,k,I,21,a[63]),s[0]=s[0]+k|0,s[1]=s[1]+R|0,s[2]=s[2]+L|0,s[3]=s[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(o/4294967296),a=o;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var r=this._hash,c=r.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return r},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,o,i,s,a){var r=e+(t&n|~t&o)+i+a;return(r<<s|r>>>32-s)+t}function l(e,t,n,o,i,s,a){var r=e+(t&o|n&~o)+i+a;return(r<<s|r>>>32-s)+t}function d(e,t,n,o,i,s,a){var r=e+(t^n^o)+i+a;return(r<<s|r>>>32-s)+t}function p(e,t,n,o,i,s,a){var r=e+(n^(t|~o))+i+a;return(r<<s|r>>>32-s)+t}t.MD5=i._createHelper(c),t.HmacMD5=i._createHmacHelper(c)}(Math),u=(c=r).lib,l=u.WordArray,d=u.Hasher,g=c.algo,_=[],f=g.SHA1=d.extend({_doReset:function(){this._hash=new l.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],r=n[4],c=0;c<80;c++){if(c<16)_[c]=0|e[t+c];else{var u=_[c-3]^_[c-8]^_[c-14]^_[c-16];_[c]=u<<1|u>>>31}var l=(o<<5|o>>>27)+r+_[c];l+=c<20?1518500249+(i&s|~i&a):c<40?1859775393+(i^s^a):c<60?(i&s|i&a|s&a)-1894007588:(i^s^a)-899497514,r=a,a=s,s=i<<30|i>>>2,i=o,o=l}n[0]=n[0]+o|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(o+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=d.clone.call(this);return e._hash=this._hash.clone(),e}}),c.SHA1=d._createHelper(f),c.HmacSHA1=d._createHmacHelper(f),function(e){var t=r,n=t.lib,o=n.WordArray,i=n.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),o=2;o<=n;o++)if(!(t%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,i=0;i<64;)t(o)&&(i<8&&(a[i]=n(e.pow(o,.5))),c[i]=n(e.pow(o,1/3)),i++),o++}();var u=[],l=s.SHA256=i.extend({_doReset:function(){this._hash=new o.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],r=n[4],l=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var g=u[h-15],_=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,f=u[h-2],m=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;u[h]=_+u[h-7]+m+u[h-16]}var v=o&i^o&s^i&s,y=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),I=p+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&l^~r&d)+c[h]+u[h];p=d,d=l,l=r,r=a+I|0,a=s,s=i,i=o,o=I+(y+v)|0}n[0]=n[0]+o|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+r|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(o/4294967296),n[15+(i+64>>>9<<4)]=o,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=i._createHelper(l),t.HmacSHA256=i._createHmacHelper(l)}(Math),function(){var e=r,t=e.lib.WordArray,n=e.enc;function o(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i+=2){var s=t[i>>>2]>>>16-i%4*8&65535;o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var n=e.length,o=[],i=0;i<n;i++)o[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return t.create(o,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,i=[],s=0;s<n;s+=2){var a=o(t[s>>>2]>>>16-s%4*8&65535);i.push(String.fromCharCode(a))}return i.join("")},parse:function(e){for(var n=e.length,i=[],s=0;s<n;s++)i[s>>>1]|=o(e.charCodeAt(s)<<16-s%2*16);return t.create(i,2*n)}}}(),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,o=[],i=0;i<n;i++)o[i>>>2]|=e[i]<<24-i%4*8;t.call(this,o,n)}else t.apply(this,arguments)}).prototype=e}}(),
/** @preserve
              (c) 2012 by C��dric Mesnil. All rights reserved.
               Redistribution and use in source and binary forms, with or without modification, are permitted provided that the following conditions are met:
                   - Redistributions of source code must retain the above copyright notice, this list of conditions and the following disclaimer.
                  - Redistributions in binary form must reproduce the above copyright notice, this list of conditions and the following disclaimer in the documentation and/or other materials provided with the distribution.
               THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
              */
function(){var e=r,t=e.lib,n=t.WordArray,o=t.Hasher,i=e.algo,s=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),a=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=n.create([0,1518500249,1859775393,2400959708,2840853838]),d=n.create([1352829926,1548603684,1836072691,2053994217,0]),p=i.RIPEMD160=o.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,i=e[o];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var r,p,y,I,M,C,T,E,S,D,k,R=this._hash.words,L=l.words,A=d.words,O=s.words,N=a.words,P=c.words,b=u.words;for(C=r=R[0],T=p=R[1],E=y=R[2],S=I=R[3],D=M=R[4],n=0;n<80;n+=1)k=r+e[t+O[n]]|0,k+=n<16?h(p,y,I)+L[0]:n<32?g(p,y,I)+L[1]:n<48?_(p,y,I)+L[2]:n<64?f(p,y,I)+L[3]:m(p,y,I)+L[4],k=(k=v(k|=0,P[n]))+M|0,r=M,M=I,I=v(y,10),y=p,p=k,k=C+e[t+N[n]]|0,k+=n<16?m(T,E,S)+A[0]:n<32?f(T,E,S)+A[1]:n<48?_(T,E,S)+A[2]:n<64?g(T,E,S)+A[3]:h(T,E,S)+A[4],k=(k=v(k|=0,b[n]))+D|0,C=D,D=S,S=v(E,10),E=T,T=k;k=R[1]+y+S|0,R[1]=R[2]+I+D|0,R[2]=R[3]+M+C|0,R[3]=R[4]+r+T|0,R[4]=R[0]+p+E|0,R[0]=k},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,s=i.words,a=0;a<5;a++){var r=s[a];s[a]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}return i},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function _(e,t,n){return(e|~t)^n}function f(e,t,n){return e&n|t&~n}function m(e,t,n){return e^(t|~n)}function v(e,t){return e<<t|e>>>32-t}e.RIPEMD160=o._createHelper(p),e.HmacRIPEMD160=o._createHmacHelper(p)}(),function(){var e=r,t=e.lib.Base,n=e.enc.Utf8;e.algo.HMAC=t.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=n.parse(t));var o=e.blockSize,i=4*o;t.sigBytes>i&&(t=e.finalize(t)),t.clamp();for(var s=this._oKey=t.clone(),a=this._iKey=t.clone(),r=s.words,c=a.words,u=0;u<o;u++)r[u]^=1549556828,c[u]^=909522486;s.sigBytes=a.sigBytes=i,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})}(),function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,i=e.algo,s=i.SHA1,a=i.HMAC,c=i.PBKDF2=n.extend({cfg:n.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,i=a.create(n.hasher,e),s=o.create(),r=o.create([1]),c=s.words,u=r.words,l=n.keySize,d=n.iterations;c.length<l;){var p=i.update(t).finalize(r);i.reset();for(var h=p.words,g=h.length,_=p,f=1;f<d;f++){_=i.finalize(_),i.reset();for(var m=_.words,v=0;v<g;v++)h[v]^=m[v]}s.concat(p),u[0]++}return s.sigBytes=4*l,s}});e.PBKDF2=function(e,t,n){return c.create(n).compute(e,t)}}(),function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,i=e.algo,s=i.MD5,a=i.EvpKDF=n.extend({cfg:n.extend({keySize:4,hasher:s,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,i=this.cfg,s=i.hasher.create(),a=o.create(),r=a.words,c=i.keySize,u=i.iterations;r.length<c;){n&&s.update(n),n=s.update(e).finalize(t),s.reset();for(var l=1;l<u;l++)n=s.finalize(n),s.reset();a.concat(n)}return a.sigBytes=4*c,a}});e.EvpKDF=function(e,t,n){return a.create(n).compute(e,t)}}(),function(){var e=r,t=e.lib.WordArray,n=e.algo,o=n.SHA256,i=n.SHA224=o.extend({_doReset:function(){this._hash=new t.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=4,e}});e.SHA224=o._createHelper(i),e.HmacSHA224=o._createHmacHelper(i)}(),function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,i=e.x64={};i.Word=n.extend({init:function(e,t){this.high=e,this.low=t}}),i.WordArray=n.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],i=0;i<t;i++){var s=e[i];n.push(s.high),n.push(s.low)}return o.create(n,this.sigBytes)},clone:function(){for(var e=n.clone.call(this),t=e.words=this.words.slice(0),o=t.length,i=0;i<o;i++)t[i]=t[i].clone();return e}})}(),function(e){var t=r,n=t.lib,o=n.WordArray,i=n.Hasher,s=t.x64.Word,a=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var o=(2*e+3*t)%5;e=t%5,t=o}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,a=0;a<24;a++){for(var r=0,d=0,p=0;p<7;p++){if(1&i){var h=(1<<p)-1;h<32?d^=1<<h:r^=1<<h-32}128&i?i=i<<1^113:i<<=1}l[a]=s.create(r,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=s.create()}();var p=a.SHA3=i.extend({cfg:i.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new s.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,o=this.blockSize/2,i=0;i<o;i++){var s=e[t+2*i],a=e[t+2*i+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(R=n[i]).high^=a,R.low^=s}for(var r=0;r<24;r++){for(var p=0;p<5;p++){for(var h=0,g=0,_=0;_<5;_++)h^=(R=n[p+5*_]).high,g^=R.low;var f=d[p];f.high=h,f.low=g}for(p=0;p<5;p++){var m=d[(p+4)%5],v=d[(p+1)%5],y=v.high,I=v.low;for(h=m.high^(y<<1|I>>>31),g=m.low^(I<<1|y>>>31),_=0;_<5;_++)(R=n[p+5*_]).high^=h,R.low^=g}for(var M=1;M<25;M++){var C=(R=n[M]).high,T=R.low,E=c[M];E<32?(h=C<<E|T>>>32-E,g=T<<E|C>>>32-E):(h=T<<E-32|C>>>64-E,g=C<<E-32|T>>>64-E);var S=d[u[M]];S.high=h,S.low=g}var D=d[0],k=n[0];for(D.high=k.high,D.low=k.low,p=0;p<5;p++)for(_=0;_<5;_++){var R=n[M=p+5*_],L=d[M],A=d[(p+1)%5+5*_],O=d[(p+2)%5+5*_];R.high=L.high^~A.high&O.high,R.low=L.low^~A.low&O.low}R=n[0];var N=l[r];R.high^=N.high,R.low^=N.low}},_doFinalize:function(){var t=this._data,n=t.words,i=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;n[i>>>5]|=1<<24-i%32,n[(e.ceil((i+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,r=this.cfg.outputLength/8,c=r/8,u=[],l=0;l<c;l++){var d=a[l],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(p)}return new o.init(u,r)},clone:function(){for(var e=i.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=i._createHelper(p),t.HmacSHA3=i._createHmacHelper(p)}(Math),function(){var e=r,t=e.lib.Hasher,n=e.x64,o=n.Word,i=n.WordArray,s=e.algo;function a(){return o.create.apply(o,arguments)}var c=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=a()}();var l=s.SHA512=t.extend({_doReset:function(){this._hash=new i.init([new o.init(1779033703,4089235720),new o.init(3144134277,2227873595),new o.init(1013904242,4271175723),new o.init(2773480762,1595750129),new o.init(1359893119,2917565137),new o.init(2600822924,725511199),new o.init(528734635,4215389547),new o.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],r=n[4],l=n[5],d=n[6],p=n[7],h=o.high,g=o.low,_=i.high,f=i.low,m=s.high,v=s.low,y=a.high,I=a.low,M=r.high,C=r.low,T=l.high,E=l.low,S=d.high,D=d.low,k=p.high,R=p.low,L=h,A=g,O=_,N=f,P=m,b=v,U=y,G=I,w=M,F=C,x=T,V=E,q=S,B=D,H=k,j=R,K=0;K<80;K++){var Y,z,W=u[K];if(K<16)z=W.high=0|e[t+2*K],Y=W.low=0|e[t+2*K+1];else{var J=u[K-15],$=J.high,X=J.low,Z=($>>>1|X<<31)^($>>>8|X<<24)^$>>>7,Q=(X>>>1|$<<31)^(X>>>8|$<<24)^(X>>>7|$<<25),ee=u[K-2],te=ee.high,ne=ee.low,oe=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ie=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),se=u[K-7],ae=se.high,re=se.low,ce=u[K-16],ue=ce.high,le=ce.low;z=(z=(z=Z+ae+((Y=Q+re)>>>0<Q>>>0?1:0))+oe+((Y+=ie)>>>0<ie>>>0?1:0))+ue+((Y+=le)>>>0<le>>>0?1:0),W.high=z,W.low=Y}var de,pe=w&x^~w&q,he=F&V^~F&B,ge=L&O^L&P^O&P,_e=A&N^A&b^N&b,fe=(L>>>28|A<<4)^(L<<30|A>>>2)^(L<<25|A>>>7),me=(A>>>28|L<<4)^(A<<30|L>>>2)^(A<<25|L>>>7),ve=(w>>>14|F<<18)^(w>>>18|F<<14)^(w<<23|F>>>9),ye=(F>>>14|w<<18)^(F>>>18|w<<14)^(F<<23|w>>>9),Ie=c[K],Me=Ie.high,Ce=Ie.low,Te=H+ve+((de=j+ye)>>>0<j>>>0?1:0),Ee=me+_e;H=q,j=B,q=x,B=V,x=w,V=F,w=U+(Te=(Te=(Te=Te+pe+((de+=he)>>>0<he>>>0?1:0))+Me+((de+=Ce)>>>0<Ce>>>0?1:0))+z+((de+=Y)>>>0<Y>>>0?1:0))+((F=G+de|0)>>>0<G>>>0?1:0)|0,U=P,G=b,P=O,b=N,O=L,N=A,L=Te+(fe+ge+(Ee>>>0<me>>>0?1:0))+((A=de+Ee|0)>>>0<de>>>0?1:0)|0}g=o.low=g+A,o.high=h+L+(g>>>0<A>>>0?1:0),f=i.low=f+N,i.high=_+O+(f>>>0<N>>>0?1:0),v=s.low=v+b,s.high=m+P+(v>>>0<b>>>0?1:0),I=a.low=I+G,a.high=y+U+(I>>>0<G>>>0?1:0),C=r.low=C+F,r.high=M+w+(C>>>0<F>>>0?1:0),E=l.low=E+V,l.high=T+x+(E>>>0<V>>>0?1:0),D=d.low=D+B,d.high=S+q+(D>>>0<B>>>0?1:0),R=p.low=R+j,p.high=k+H+(R>>>0<j>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[30+(o+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(o+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),function(){var e=r,t=e.x64,n=t.Word,o=t.WordArray,i=e.algo,s=i.SHA512,a=i.SHA384=s.extend({_doReset:function(){this._hash=new o.init([new n.init(3418070365,3238371032),new n.init(1654270250,914150663),new n.init(2438529370,812702999),new n.init(355462360,4144912697),new n.init(1731405415,4290775857),new n.init(2394180231,1750603025),new n.init(3675008525,1694076839),new n.init(1203062813,3204075428)])},_doFinalize:function(){var e=s._doFinalize.call(this);return e.sigBytes-=16,e}});e.SHA384=s._createHelper(a),e.HmacSHA384=s._createHmacHelper(a)}(),r.lib.Cipher||function(){var e=r,t=e.lib,n=t.Base,o=t.WordArray,i=t.BufferedBlockAlgorithm,s=e.enc,a=(s.Utf8,s.Base64),c=e.algo.EvpKDF,u=t.Cipher=i.extend({cfg:n.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){i.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?v:f}return function(t){return{encrypt:function(n,o,i){return e(o).encrypt(t,n,o,i)},decrypt:function(n,o,i){return e(o).decrypt(t,n,o,i)}}}}()}),l=(t.StreamCipher=u.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),e.mode={}),d=t.BlockCipherMode=n.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),p=l.CBC=function(){var e=d.extend();function t(e,t,n){var o,i=this._iv;i?(o=i,this._iv=void 0):o=this._prevBlock;for(var s=0;s<n;s++)e[t+s]^=o[s]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize;t.call(this,e,n,i),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize,s=e.slice(n,n+i);o.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=s}}),e}(),h=(e.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,i=n-e.sigBytes%n,s=i<<24|i<<16|i<<8|i,a=[],r=0;r<i;r+=4)a.push(s);var c=o.create(a,i);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(t.BlockCipher=u.extend({cfg:u.cfg.extend({mode:p,padding:h}),reset:function(){var e;u.reset.call(this);var t=this.cfg,n=t.iv,o=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=o.createEncryptor:(e=o.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(o,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),t.CipherParams=n.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),_=(e.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?o.create([1398893684,1701076831]).concat(n).concat(t):t).toString(a)},parse:function(e){var t,n=a.parse(e),i=n.words;return 1398893684==i[0]&&1701076831==i[1]&&(t=o.create(i.slice(2,4)),i.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},f=t.SerializableCipher=n.extend({cfg:n.extend({format:_}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var i=e.createEncryptor(n,o),s=i.finalize(t),a=i.cfg;return g.create({ciphertext:s,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),m=(e.kdf={}).OpenSSL={execute:function(e,t,n,i){i||(i=o.random(8));var s=c.create({keySize:t+n}).compute(e,i),a=o.create(s.words.slice(t),4*n);return s.sigBytes=4*t,g.create({key:s,iv:a,salt:i})}},v=t.PasswordBasedCipher=f.extend({cfg:f.cfg.extend({kdf:m}),encrypt:function(e,t,n,o){var i=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize);o.iv=i.iv;var s=f.encrypt.call(this,e,t,i.key,o);return s.mixIn(i),s},decrypt:function(e,t,n,o){o=this.cfg.extend(o),t=this._parse(t,o.format);var i=o.kdf.execute(n,e.keySize,e.ivSize,t.salt);return o.iv=i.iv,f.decrypt.call(this,e,t,i.key,o)}})}(),r.mode.CFB=function(){var e=r.lib.BlockCipherMode.extend();function t(e,t,n,o){var i,s=this._iv;s?(i=s.slice(0),this._iv=void 0):i=this._prevBlock,o.encryptBlock(i,0);for(var a=0;a<n;a++)e[t+a]^=i[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize;t.call(this,e,n,i,o),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize,s=e.slice(n,n+i);t.call(this,e,n,i,o),this._prevBlock=s}}),e}(),r.mode.ECB=((i=r.lib.BlockCipherMode.extend()).Encryptor=i.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),i.Decryptor=i.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),i),r.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,o=4*t,i=o-n%o,s=n+i-1;e.clamp(),e.words[s>>>2]|=i<<24-s%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso10126={pad:function(e,t){var n=4*t,o=n-e.sigBytes%n;e.concat(r.lib.WordArray.random(o-1)).concat(r.lib.WordArray.create([o<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso97971={pad:function(e,t){e.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(e,t)},unpad:function(e){r.pad.ZeroPadding.unpad(e),e.sigBytes--}},r.mode.OFB=(o=(n=r.lib.BlockCipherMode.extend()).Encryptor=n.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=this._iv,s=this._keystream;i&&(s=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(s,0);for(var a=0;a<o;a++)e[t+a]^=s[a]}}),n.Decryptor=o,n),r.pad.NoPadding={pad:function(){},unpad:function(){}},function(){var e=r,t=e.lib.CipherParams,n=e.enc.Hex;e.format.Hex={stringify:function(e){return e.ciphertext.toString(n)},parse:function(e){var o=n.parse(e);return t.create({ciphertext:o})}}}(),function(){var e=r,t=e.lib.BlockCipher,n=e.algo,o=[],i=[],s=[],a=[],c=[],u=[],l=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var g=r^r<<1^r<<2^r<<3^r<<4;g=g>>>8^255&g^99,o[n]=g,i[g]=n;var _=e[n],f=e[_],m=e[f],v=257*e[g]^16843008*g;s[n]=v<<24|v>>>8,a[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,u[n]=v,v=16843009*m^65537*f^257*_^16843008*n,l[g]=v<<24|v>>>8,d[g]=v<<16|v>>>16,p[g]=v<<8|v>>>24,h[g]=v,n?(n=_^e[e[e[m^_]]],r^=e[e[r]]):n=r=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],_=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,i=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],a=0;a<i;a++)a<n?s[a]=t[a]:(u=s[a-1],a%n?n>6&&a%n==4&&(u=o[u>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[255&u]):(u=o[(u=u<<8|u>>>24)>>>24]<<24|o[u>>>16&255]<<16|o[u>>>8&255]<<8|o[255&u],u^=g[a/n|0]<<24),s[a]=s[a-n]^u);for(var r=this._invKeySchedule=[],c=0;c<i;c++){if(a=i-c,c%4)var u=s[a];else u=s[a-4];r[c]=c<4||a<=4?u:l[o[u>>>24]]^d[o[u>>>16&255]]^p[o[u>>>8&255]]^h[o[255&u]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,s,a,c,u,o)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,h,i),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,i,s,a,r){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,g=1;g<c;g++){var _=o[u>>>24]^i[l>>>16&255]^s[d>>>8&255]^a[255&p]^n[h++],f=o[l>>>24]^i[d>>>16&255]^s[p>>>8&255]^a[255&u]^n[h++],m=o[d>>>24]^i[p>>>16&255]^s[u>>>8&255]^a[255&l]^n[h++],v=o[p>>>24]^i[u>>>16&255]^s[l>>>8&255]^a[255&d]^n[h++];u=_,l=f,d=m,p=v}_=(r[u>>>24]<<24|r[l>>>16&255]<<16|r[d>>>8&255]<<8|r[255&p])^n[h++],f=(r[l>>>24]<<24|r[d>>>16&255]<<16|r[p>>>8&255]<<8|r[255&u])^n[h++],m=(r[d>>>24]<<24|r[p>>>16&255]<<16|r[u>>>8&255]<<8|r[255&l])^n[h++],v=(r[p>>>24]<<24|r[u>>>16&255]<<16|r[l>>>8&255]<<8|r[255&d])^n[h++],e[t]=_,e[t+1]=f,e[t+2]=m,e[t+3]=v},keySize:8});e.AES=t._createHelper(_)}(),function(){var e=r,t=e.lib,n=t.WordArray,o=t.BlockCipher,i=e.algo,s=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=i.DES=o.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var o=s[n]-1;t[n]=e[o>>>5]>>>31-o%32&1}for(var i=this._subKeys=[],r=0;r<16;r++){var u=i[r]=[],l=c[r];for(n=0;n<24;n++)u[n/6|0]|=t[(a[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(a[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=i[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var o=0;o<16;o++){for(var i=n[o],s=this._lBlock,a=this._rBlock,r=0,c=0;c<8;c++)r|=u[c][((a^i[c])&l[c])>>>0];this._lBlock=a,this._rBlock=s^r}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=o._createHelper(d);var g=i.TripleDES=o.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),o=e.length<4?e.slice(0,2):e.slice(2,4),i=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=d.createEncryptor(n.create(t)),this._des2=d.createEncryptor(n.create(o)),this._des3=d.createEncryptor(n.create(i))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=o._createHelper(g)}(),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,o=n.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,o=this._S=[],i=0;i<256;i++)o[i]=i;i=0;for(var s=0;i<256;i++){var a=i%n,r=t[a>>>2]>>>24-a%4*8&255;s=(s+o[i]+r)%256;var c=o[i];o[i]=o[s],o[s]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=i.call(this)},keySize:8,ivSize:0});function i(){for(var e=this._S,t=this._i,n=this._j,o=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[n],e[n]=s,o|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,o}e.RC4=t._createHelper(o);var s=n.RC4Drop=o.extend({cfg:o.cfg.extend({drop:192}),_doReset:function(){o._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)i.call(this)}});e.RC4Drop=t._createHelper(s)}(),
/** @preserve
               * Counter block mode compatible with  Dr Brian Gladman fileenc.c
               * derived from CryptoJS.mode.CTR
               * Jan Hruby jhruby.web@gmail.com
               */
r.mode.CTRGladman=function(){var e=r.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,n=e>>8&255,o=255&e;255===t?(t=0,255===n?(n=0,255===o?o=0:++o):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=o}return e}var n=e.Encryptor=e.extend({processBlock:function(e,n){var o,i=this._cipher,s=i.blockSize,a=this._iv,r=this._counter;a&&(r=this._counter=a.slice(0),this._iv=void 0),0===((o=r)[0]=t(o[0]))&&(o[1]=t(o[1]));var c=r.slice(0);i.encryptBlock(c,0);for(var u=0;u<s;u++)e[n+u]^=c[u]}});return e.Decryptor=n,e}(),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,o=[],i=[],s=[],a=n.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)i[n]^=o[n+4&7];if(t){var s=t.words,a=s[0],r=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=l,i[3]^=p,i[4]^=u,i[5]^=d,i[6]^=l,i[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)o[i]=16711935&(o[i]<<8|o[i]>>>24)|4278255360&(o[i]<<24|o[i]>>>8),e[t+i]^=o[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],a=65535&o,r=o>>>16,c=((a*a>>>17)+a*r>>>15)+r*r,u=((4294901760&o)*o|0)+((65535&o)*o|0);s[n]=c^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.Rabbit=t._createHelper(a)}(),r.mode.CTR=function(){var e=r.lib.BlockCipherMode.extend(),t=e.Encryptor=e.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0);var a=s.slice(0);n.encryptBlock(a,0),s[o-1]=s[o-1]+1|0;for(var r=0;r<o;r++)e[t+r]^=a[r]}});return e.Decryptor=t,e}(),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,o=[],i=[],s=[],a=n.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)o[i]^=n[i+4&7];if(t){var s=t.words,a=s[0],r=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(o[0]^=u,o[1]^=d,o[2]^=l,o[3]^=p,o[4]^=u,o[5]^=d,o[6]^=l,o[7]^=p,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),o[0]=n[0]^n[5]>>>16^n[3]<<16,o[1]=n[2]^n[7]>>>16^n[5]<<16,o[2]=n[4]^n[1]>>>16^n[7]<<16,o[3]=n[6]^n[3]>>>16^n[1]<<16;for(var i=0;i<4;i++)o[i]=16711935&(o[i]<<8|o[i]>>>24)|4278255360&(o[i]<<24|o[i]>>>8),e[t+i]^=o[i]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)i[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<i[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<i[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<i[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<i[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<i[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<i[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<i[6]>>>0?1:0)|0,this._b=t[7]>>>0<i[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],a=65535&o,r=o>>>16,c=((a*a>>>17)+a*r>>>15)+r*r,u=((4294901760&o)*o|0)+((65535&o)*o|0);s[n]=c^u}e[0]=s[0]+(s[7]<<16|s[7]>>>16)+(s[6]<<16|s[6]>>>16)|0,e[1]=s[1]+(s[0]<<8|s[0]>>>24)+s[7]|0,e[2]=s[2]+(s[1]<<16|s[1]>>>16)+(s[0]<<16|s[0]>>>16)|0,e[3]=s[3]+(s[2]<<8|s[2]>>>24)+s[1]|0,e[4]=s[4]+(s[3]<<16|s[3]>>>16)+(s[2]<<16|s[2]>>>16)|0,e[5]=s[5]+(s[4]<<8|s[4]>>>24)+s[3]|0,e[6]=s[6]+(s[5]<<16|s[5]>>>16)+(s[4]<<16|s[4]>>>16)|0,e[7]=s[7]+(s[6]<<8|s[6]>>>24)+s[5]|0}e.RabbitLegacy=t._createHelper(a)}(),r.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},r)},c(u={exports:{}},u.exports),u.exports);return function(){function t(n){e(this,t);var o=n.isArray,i=n.isMap,s=n.isDevMode;this._isArray=o,this._isMap=i,this._isDevMode=s,this._interceptProfanityList=[],this._interceptFilter=null,this._interceptRegExpList=[],this._replacingProfanityMap=new Map,this._replacingFilter=null,this._replacingRegExpMap=new Map,this._key="",this._iv="",this._decryptOptions=void 0,this._n="TIMProfanityFilterPlugin",!0===s&&_("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n,".VERSION:").concat("1.1.0"))}return n(t,[{key:"onToken",value:function(e){this._key=g.enc.Utf8.parse(e.slice(0,32)),this._iv=this._key,this._decryptOptions={iv:this._iv,mode:g.mode.CBC,padding:g.pad.Pkcs7}}},{key:"onLexiconSliced",value:function(e){if(this._isArray(e)&&0!==e.length){var t,n,o,i=r(e);try{for(i.s();!(o=i.n()).done;){var s=o.value,a=s.filterType,c=s.profanityType,u=s.profanity,l=s.replacement;t=this._getDecryptedString(u),n=this._getDecryptedString(l),1===a?1===c?this._interceptProfanityList.push(t):2===c&&this._interceptRegExpList.push(t):2===a&&(1===c?this._replacingProfanityMap.set(t,n):2===c&&this._replacingRegExpMap.set(t,n))}}catch(d){i.e(d)}finally{i.f()}}}},{key:"_getDecryptedString",value:function(e){var t=g.AES.decrypt(e,this._key,this._decryptOptions);return g.enc.Utf8.stringify(t).toLowerCase()}},{key:"onLexiconCompleted",value:function(e){this.onLexiconSliced(e),this._interceptFilter=new d({input:this._interceptProfanityList,isArray:this._isArray,isMap:this._isMap}),this._replacingFilter=new d({input:this._replacingProfanityMap,isArray:this._isArray,isMap:this._isMap}),!0===this._isDevMode&&(_("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _interceptProfanityList ->"),this._interceptProfanityList),_("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _interceptRegExpList ->"),this._interceptRegExpList),_("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _replacingProfanityMap ->"),this._replacingProfanityMap),_("log","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n," _replacingRegExpMap ->"),this._replacingRegExpMap))}},{key:"filter",value:function(e){var t={type:0,modifiedText:e};if("string"!=typeof e)return!0===this._isDevMode&&_("warn","at node_modules/tim-profanity-filter-plugin/index.js:15","".concat(this._n,".filter invalid params, string required!")),t;if(!0===this._interceptFilter.filter({text:e,replacingEnabled:!1}).isMatched)return t.type=1,t;for(var n=!1,i=0,s=this._interceptRegExpList.length;i<s;i++)if(new RegExp(this._interceptRegExpList[i],"gi").test(e.toLowerCase())){n=!0;break}if(n)return t.type=1,t;var a=this._replacingFilter.filter({text:e,replacingEnabled:!0});!0===a.isMatched&&(t.type=2,t.modifiedText=a.modifiedText);var c,u=t.modifiedText,l=null,d=r(this._replacingRegExpMap);try{for(d.s();!(c=d.n()).done;){var p=o(c.value,2),h=p[0],g=p[1];l=new RegExp(h,"gi"),u=u.replace(l,g)}}catch(f){d.e(f)}finally{d.f()}return u!==e&&(t.type=2,t.modifiedText=u),t}},{key:"reset",value:function(){this._isArray=null,this._isMap=null,this._interceptProfanityList.length=0,this._interceptRegExpList.length=0,this._replacingProfanityMap.clear(),this._replacingRegExpMap.clear(),this._key="",this._iv="",this._decryptOptions={},this._interceptFilter&&this._interceptFilter.reset(),this._replacingFilter&&this._replacingFilter.reset()}}]),t}()}()}(L);const A=C(L.exports);let O=class{constructor(){this.serviceMap=new Map}registerService(e,t){this.serviceMap.has(e)||(_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIServiceManager.registerService serviceName:${e}`),this.serviceMap.set(e,t))}unregisterService(e){this.serviceMap.has(e)&&(_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIServiceManager.unregisterService serviceName:${e}`),this.serviceMap.delete(e))}getService(e){return this.serviceMap.get(e)}callService(e){const{serviceName:t,method:n,params:o,callback:i}=e,s=this.getService(t);if(_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIServiceManager.callService serviceName:${t}, service:`,s),s)return s.onCall(n,o,i)}},N=class{constructor(){this.extensionMap=new Map}registerExtension(e,t){if(_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIExtensionManager.registerExtension extensionID:${e}`),!this.extensionMap.has(e)){const t=[];this.extensionMap.set(e,t)}const n=this.extensionMap.get(e);-1===n.indexOf(t)&&n.push(t)}unregisterExtension(e,t){if(_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIExtensionManager.unregisterExtension extensionID:${e}`),this.extensionMap.has(e)){const n=this.extensionMap.get(e),o=n.indexOf(t);o>-1&&n.splice(o,1)}}getExtensionList(e,t){_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIExtensionManager.getExtensionList extensionID:${e} ${t?`params:${JSON.stringify(t)}`:""}`);let n=[],o=[];if(this.extensionMap.has(e)){n=this.extensionMap.get(e);for(let i=0;i<n.length;i++){const s=n[i].onGetExtension(e,t);o=o.concat(s)}}return o}};const P=["vue2","vue3","rn"],b={TUILogin:{EVENT:{LOGIN_STATE_CHANGED:"loginStateChanged"},EVENT_SUB_KEY:{USER_LOGIN_SUCCESS:"userLoginSuccess",USER_LOGOUT_SUCCESS:"userLogoutSuccess",USER_KICKED_OFFLINE:"userKickedOffline",USER_SIG_EXPIRED:"userSigExpired"}},TUIConversation:{SERVICE:{NAME:"TUIConversationService",METHOD:{CREATE_CONVERSATION:"createConversation",HIDE_CONVERSATION_HEADER:"hideConversationHeader"}},EXTENSION:{CONV_POP_MENU:{EXT_ID:"conversationPopMenu"},CONV_GROUP:{EXT_ID:"conversationGroup"}}},TUIChat:{SERVICE:{NAME:"TUIChatService",METHOD:{UPDATE_MESSAGE_LIST:"updateMessageList",CLOSE_MESSAGE_POP_MENU:"closeMessagePopMenu",SEND_CUSTOM_MESSAGE:"sendCustomMessage",SEND_TEXT_MESSAGE:"sendTextMessage",SET_CHAT_TYPE:"setChatType",UPDATE_MESSAGE_INFO:"updateMessageInfo"}},EXTENSION:{INPUT_MORE:{EXT_ID:"inputToolBarMore"},MSG_POP_MENU:{EXT_ID:"messagePopMenu"},CHAT_HEADER:{EXT_ID:"chatHeader"}},TYPE:{C2C:"C2C",GROUP:"GROUP",CUSTOMER_SERVICE:"customerService",ROOM:"room"},EVENT:{CHAT_STATE_CHANGED:"chatStateChanged",CHAT_TYPE_CHANGED:"chatTypeChanged"},EVENT_SUB_KEY:{CHAT_OPENED:"chatOpened",CHANGE_SUCCESS:"changeSuccess"},FEATURE:{DownloadFile:"DownloadFile",CopyMessage:"CopyMessage",DeleteMessage:"DeleteMessage",RevokeMessage:"RevokeMessage",QuoteMessage:"QuoteMessage",ForwardMessage:"ForwardMessage",TranslateMessage:"TranslateMessage",VoiceToText:"VoiceToText",MultiSelection:"MultiSelection",EmojiReaction:"EmojiReaction",InputEmoji:"InputEmoji",InputStickers:"InputStickers",InputImage:"InputImage",InputVoice:"InputVoice",InputVideo:"InputVideo",InputFile:"InputFile",InputEvaluation:"InputEvaluation",InputQuickReplies:"InputQuickReplies",InputMention:"InputMention",MessageSearch:"MessageSearch",ReadStatus:"ReadStatus"}},TUIGroup:{SERVICE:{NAME:"TUIGroupService",METHOD:{CREATE_GROUP:"createGroup",OPEN_GROUP_MANAGEMENT:"openGroupManagement",SELECT_GROUP_MEMBER:"selectGroupMember"}}},TUIContact:{SERVICE:{NAME:"TUIContactService",METHOD:{SELECT_FRIEND:"selectFriend"}},EXTENSION:{CONTACT_LIST:{EXT_ID:"contactList"}}},TUISearch:{SERVICE:{NAME:"TUISearchService",METHOD:{SEARCH_GROUP:"searchGroup",SEARCH_USER:"searchUser",SEARCH_FRIEND:"searchFriend",SEARCH_GROUP_MEMBER:"searchGroupMember"}},EXTENSION:{SEARCH_MORE:{EXT_ID:"searchMore"}}},TUICalling:{SERVICE:{NAME:"TUICallingService",METHOD:{START_CALL:"startCall"}}},TUIRoom:{SERVICE:{NAME:"TUIRoomService"}},TUIEmojiPlugin:{SERVICE:{NAME:"TUIEmojiPluginService",METHOD:{CLOSE_EMOJI_DETAIL:"closeEmojiDetail"}}},TUITranslate:{EVENT:{LANGUAGE_CHANGED:"languageChanged"},EVENT_SUB_KEY:{CHANGE_SUCCESS:"changeSuccess"}},TUITranslatePlugin:{SERVICE:{NAME:"TUITranslatePluginService"}},TUIVoiceToTextPlugin:{SERVICE:{NAME:"TUIVoiceToTextPluginService"}},TUICustomerServicePlugin:{SERVICE:{NAME:"TUICustomerServicePlugin",METHOD:{ACTIVE_CONVERSATION:"activeConversation",FILTER_MESSAGE:"filterMessage"}},EXTENSION:{}},TUIPushPlugin:{SERVICE:{NAME:"TUIPushPluginService"}},TUIChatbotPlugin:{SERVICE:{NAME:"TUIChatbotPluginService"}},TUITheme:{EVENT:{THEME_CHANGED:"themeChanged"},EVENT_SUB_KEY:{CHANGE_SUCCESS:"changeSuccess"}}},U="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),G="undefined"!=typeof uni&&"undefined"==typeof window,w="undefined"!=typeof uni,F=("undefined"!=typeof uni||"undefined"!=typeof window)&&!(U||G);U?wx:w?uni:window;const x=F&&window&&window.navigator&&window.navigator.userAgent||"",V=/Android/i.test(x),q=/(?:Windows Phone)/.test(x),B=/(?:SymbianOS)/.test(x),H=/iPad/i.test(x)||/iPhone/i.test(x)||/iPod/i.test(x),j=V||q||B||H,K=F&&!j,Y=G&&!U,z={[b.TUITranslatePlugin.SERVICE.NAME]:Math.pow(2,38),[b.TUIVoiceToTextPlugin.SERVICE.NAME]:Math.pow(2,39),[b.TUICustomerServicePlugin.SERVICE.NAME]:Math.pow(2,40),[b.TUIPushPlugin.SERVICE.NAME]:Math.pow(2,41),[b.TUIChatbotPlugin.SERVICE.NAME]:Math.pow(2,42),[b.TUIEmojiPlugin.SERVICE.NAME]:Math.pow(2,48)};let W=class e{constructor(e){this.loginStatusPromise=new Map,this.SDKAppID=0,this.userID="",this.userSig="",this.TUICore=e,this.isOnChatEvent=!1}static getInstance(t){return!e.instance&&t&&(e.instance=new e(t)),e.instance}login(e){const{SDKAppID:t,userID:n,userSig:o,framework:i}=e;return this.chat=E.create(Object.assign(Object.assign({},e),{scene:this.getStatScene(i)})),this.EVENT=E.EVENT,this.TYPES=E.TYPES,this.SDKAppID=t,this.userID=n,this.userSig=o,this.offChatEvent(),this.onChatEvent(),this.registerPlugin(e),this.loginChat(e)}logout(){return this.chat.logout().then((e=>(this.userID="",this.userSig="",this.TUICore.notifyEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_LOGOUT_SUCCESS),Promise.resolve(e))))}destroy(){return this.chat.destroy().then((e=>(this.userID="",this.userSig="",this.TUICore.notifyEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_LOGOUT_SUCCESS),Promise.resolve(e))))}setLogLevel(e){return this.chat.setLogLevel(e)}getContext(){return{chat:this.chat,SDKAppID:this.SDKAppID,userID:this.userID,userSig:this.userSig}}reportPlugin(){var e;for(const t in z)this.TUICore.getService(t)&&(null===(e=this.chat.callExperimentalAPI("isFeatureEnabledForStat",z[t]))||void 0===e||e.catch((e=>{})))}loginChat(e){const{userID:t,userSig:n}=e;return new Promise(((e,o)=>{this.chat.login({userID:t,userSig:n}).then((t=>{t.data.repeatLogin&&this.chat.isReady()&&e(t),this.reportPlugin(),this.loginStatusPromise.set("login",{resolve:e,reject:o,imResponse:t})})).catch((e=>{o(e)}))}))}onChatEvent(){this.chat.on(this.EVENT.SDK_READY,this.onSDKReady,this),this.chat.on(this.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.chat.on(this.EVENT.KICKED_OUT,this.onUserKicked,this),this.isOnChatEvent=!0}offChatEvent(){this.isOnChatEvent&&(this.chat.off(this.EVENT.SDK_READY,this.onSDKReady,this),this.chat.off(this.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.chat.off(this.EVENT.KICKED_OUT,this.onUserKicked,this),this.isOnChatEvent=!1)}onSDKReady(){if(this.loginStatusPromise.has("login")){this.TUICore.notifyEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS);const e=setTimeout((()=>{const t=this.loginStatusPromise.get("login");t.resolve(t.imResponse),clearTimeout(e),this.loginStatusPromise.delete("login")}),500)}}onSDKNotReady(){this.loginStatusPromise.has("login")&&this.loginStatusPromise.get("login").reject(new Error("sdk not ready")),this.loginStatusPromise.delete("login")}onUserKicked(e){e.data.type!==this.TYPES.KICKED_OUT_USERSIG_EXPIRED?this.TUICore.notifyEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_KICKED_OFFLINE):this.TUICore.notifyEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_SIG_EXPIRED)}registerPlugin(e){const{useUploadPlugin:t=!1,useProfanityFilterPlugin:n=!1,TUIOfflinePush:o,offlinePushConfig:i,TIMPush:s,pushConfig:a}=e;!0===t&&this.chat.registerPlugin({"tim-upload-plugin":D}),!0===n&&this.chat.registerPlugin({"tim-profanity-filter-plugin":A}),Y&&s&&a&&this.chat.registerPlugin({"tim-push":s,pushConfig:a}),Y&&o&&i&&this.chat.registerPlugin({"tim-offline-push-plugin":o,offlinePushConfig:i})}getStatScene(e){let t;return e&&P.indexOf(e)>-1&&(t=this.genStatScene(e)),t}genStatScene(e){if("rn"===e)return"k-rn";let t="";return w?(K&&(t=`k-${e}-pc-uni`),j&&(t=`k-${e}-h5-uni`),Y&&(t=`k-${e}-app-uni`),U&&(t=`k-${e}-mp-uni`),t):(K&&(t=`k-${e}-pc`),j&&(t=`k-${e}-h5`),t)}},J=class{constructor(){this.eventMap=new Map}registerEvent(e,t,n){const o=this.getKey(e,t);if(_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIEventManager.registerEvent eventName:${e} subKey:${t}`),!this.eventMap.has(o)){const e=[];this.eventMap.set(o,e)}const i=this.eventMap.get(o);-1===i.indexOf(n)&&(i.push(n),this.renotify(e,t,n))}unregisterEvent(e,t,n){_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIEventManager.unregisterEvent eventName:${e} subKey:${t}`);const o=this.getKey(e,t);if(this.eventMap.has(o)){const e=this.eventMap.get(o),t=e.indexOf(n);t>-1&&e.splice(t,1)}}notifyEvent(e,t,n){const o=this.getKey(e,t),i=n?`params:${JSON.stringify(n)}`:"";_("log","at node_modules/@tencentcloud/tui-core/index.js:1",`TUIEventManager.notifyEvent eventName:${e} subKey:${t} ${i}`),this.eventMap.has(o)&&this.eventMap.get(o).forEach((o=>{o.onNotifyEvent(e,t,n)}))}getKey(e,t){let n=e;return t&&(n=`${e}-${n}`),n}renotify(e,t,n){if(e===b.TUILogin.EVENT.LOGIN_STATE_CHANGED&&t===b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS){const{chat:e}=W.getInstance().getContext();e&&e.isReady()&&(n.onNotifyEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS),_("log","at node_modules/@tencentcloud/tui-core/index.js:1","TUIEventManager.renotify success."))}}};_("log","at node_modules/@tencentcloud/tui-core/index.js:1","TUICore.VERSION:2.4.0");const $=class e{constructor(){this.serviceManager=new O,this.extensionManager=new N,this.eventManager=new J}static getInstance(){return e.instance||(_("log","at node_modules/@tencentcloud/tui-core/index.js:1","TUICore.getInstance ok."),e.instance=new e),e.instance}registerService(e,t){return this.serviceManager.registerService(e,t)}unregisterService(e){return this.serviceManager.unregisterService(e)}getService(e){return this.serviceManager.getService(e)}callService(e){return this.serviceManager.callService(e)}registerExtension(e,t){return this.extensionManager.registerExtension(e,t)}unregisterExtension(e,t){return this.extensionManager.unregisterExtension(e,t)}getExtensionList(e,t){return this.extensionManager.getExtensionList(e,t)}registerEvent(e,t,n){return this.eventManager.registerEvent(e,t,n)}unregisterEvent(e,t,n){return this.eventManager.unregisterEvent(e,t,n)}notifyEvent(e,t,n){return this.eventManager.notifyEvent(e,t,n)}}.getInstance(),X=W.getInstance($),Z="/assets/avatar.00b7c7aa.png",Q=(e,t)=>{const n=e.__vccOpts||e;for(const[o,i]of t)n[o]=i;return n},ee=Q(e.defineComponent({__name:"Avatar",props:{imgSrc:{},size:{}},setup(t){const n=t,o=e.computed((()=>i.value?Z:n.imgSrc||Z)),i=e.ref(!1);function s(){i.value=!0}return(t,n)=>(e.openBlock(),e.createElementBlock("image",{class:"avatar",src:o.value,onError:s},null,40,["src"]))}}),[["__scopeId","data-v-cbda6d98"]]);const te=e=>void 0===e;function ne(e,t="px"){return(e=>"number"==typeof e)(e)||(e=>"string"==typeof e&&!isNaN(Number(e)))(e)?e+t:e}function oe(){let e=function(e){var t;const n=null==(t=null==window?void 0:window.location)?void 0:t.href.replace(/^[^?]*\?/,""),o=new RegExp(`(^|&)${e}=([^&#]*)(&|$|)`,"i"),i=null==n?void 0:n.match(o);return i?i[2]:null}("lang")||uni.getStorageSync("tuiRoom-language")||(null==navigator?void 0:navigator.language)||"zh";return e=e.replace(/_/,"-").toLowerCase(),"zh-cn"===e||"zh"===e?e="zh-CN":"en"!==e&&"en-us"!==e&&"en-GB"!==e||(e="en-US"),e}const ie=e.ref("");const se=new class{constructor(e){this.messages=e.messages,ie.value=e.locale,this.global={},this.global.locale=ie,this.global.t=this.t.bind(this)}getNamed(e){return t=>e[t]||t}t(e,t){const n=this.messages[ie.value];if(!n[e])return e;if("function"==typeof n[e]){const o=this.getNamed(t||{});return n[e]({named:o})}return n[e]}install(){}}({locale:oe()||"zh-CN",messages:{"zh-CN":{"":"","Sign in":"请登录","Phone Login":"手机登录","Email Login":"邮箱登录","I have read and agree to the":"我已阅读并同意","Privacy Policy":"隐私协议",and:"和","Terms of Use":"用户协议",Login:"登录","Mobile number":"请输入您的手机号","Verification code":"请输入验证码","Email address":"请输入邮箱","Please enter a valid phone number!":"请输入正确的手机号！","Please enter a valid email address!":"请输入正确的邮箱地址！","Please enter your phone number!":"请输入手机号！","Please enter your email address!":"请输入邮箱地址！","Please enter the verification code!":"请输入验证码！","Please accept the privacy policy and user agreement!":"请同意隐私协议及用户协议！","Incorrect verification code, please check the code!":"验证码错误，请检查验证码！","The verification code has expired, please retrieve a new one!":"验证码已过期，请重新获取验证码！","The verification code has been used, please retrieve a new one!":"验证码已使用，请重新获取验证码！","Login failed, please try again.":"登录失败，请重试",SEND:"获取验证码"," ":"倒计时","The room does not exist, please confirm the room number or create a room!":"房间不存在，请确认房间号或创建房间！","Log out":"退出登录","Edit profile":"编辑资料","User Name":"用户名","Please input user name":"请输入用户名","Username length should be greater than 0":"昵称长度应该大于0",Save:"保存",Camera:"摄像头",Mic:"麦克风","Off Camera":"摄像头已关闭","Mic settings":"麦克风设置",Output:"输出",Speaker:"扬声器",Test:"测试",Stop:"停止测试",Preview:"视频画面",Mirror:"视频镜像",Resolution:"分辨率","More Camera Settings":"更多摄像头设置","Join the room ?":"是否进入房间?","You are invited to room ":"您被邀请进入 ",Room:"房间",Join:"确定进入","Switch Theme":"换肤",Layout:"布局","New Room":"新建房间","Room Type":"房间类型","Your Name":"您的名字","Turn on the microphone":"开启麦克风","Turn on the speaker":"开启扬声器","Turn on the video":"开启视频","Free Speech Room":"自由发言房间","On-stage Speaking Room":"上台发言房间","Join Room":"进入房间","Enter room ID":"输入房间号","video conferencing":" 的视频会议","Quick Meeting":"的快速会议","Room ID":"房间号","Low Definition":"流畅","Standard Definition":"标清","High Definition":"高清","Super Definition":"超清","End sharing":"结束共享","Stop sharing?":"是否停止屏幕共享？","Stop sharing":"停止共享","You are sharing the screen...":"你正在共享屏幕...",Sure:"确定",Sharing:"屏幕共享中","Share screen":"共享屏幕","Grant permission to screen recording":"打开屏幕录制权限","Open the system preferences settings":"打开系统便好设置",'Due to macOS 10.15 system requirements, please check the current application in "System Preferences - Security & Privacy - Screen Recording".':'由于macos 10.15 系统要求，请在"系统偏好设置-安全性与隐私-屏幕录制"中勾选当前应用程序。',"Others will no longer see your screen after you stop sharing. Are you sure you want to stop?":"是否结束当前的共享屏幕，停止后所有人将无法继续观看屏幕内容","Others will no longer see your screen after you stop sharing.":"停止后所有人将无法继续观看屏幕内容","You currently do not have sharing permission, please raise your hand to apply for sharing permission first":"您当前没有共享权限，请先举手申请上台获取共享权限",Host:"房主",Me:"我",me:"我",Admin:"管理员",RoomOwner:"主持人",More:"更多","Raise hand":"举手",Agree:"同意",Chat:"聊天",Cancel:"取消",Exit:"退出全屏","Full screen":"全屏",Members:"成员","Search Member":"搜索成员","Transfer owner":"转交房主","Set as administrator":"设为管理员","Revoke administrator":"撤销管理员","The administrator status of sb has been withdrawn":({named:e})=>`已将 ${e("name")} 的管理员身份撤回`,"sb has been set as administrator":({named:e})=>`已将 ${e("name")} 设为管理员`,"You have been invited by the administrator to step down, please raise your hand if you need to speak":"您已被管理员邀请下台，需要发言请先举手",Invite:"邀请",Settings:"设置",EndPC:"结束房间",EndH5:"结束",Tips:"提示",'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.':"您当前是房间主持人，请选择相应操作。若选择“结束房间”，将解散当前房间并将全体成员移出。若选择“离开房间”，当前房间不会解散，您的主持人权限将移交给其他成员。",'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.':"您当前是房间主持人，请选择相应操作。若选择“结束房间”，将解散当前房间并将全体成员移出。","If you do not want to end the meeting, please designate a new host before leaving the meeting.":"如果您不想结束会议，请在离开会议前指定新的主持人。","Are you sure you want to leave this room?":"确定离开房间吗？","New host":"选择主持人","Transfer and leave":"移交并离开","Leave room?":"是否要离开房间","Select a new host":"请选择新的房间主持人","Appoint a new host":"指定一位新的主持人","The host closed the room.":"主持人结束会议，已解散房间",Note:"通知",Confirm:"确认",Leave:"离开房间",Dismiss:"结束房间","The administrator has been changed to ":"管理员已变更为","Muted by the moderator":"已被主持人禁言","Type a message":"说点什么...",Send:"发送","Failed to send the message":"发送消息失败","Applying for the stage":"正在申请上台","Apply for the stage":"申请上台","Cancel Apply":"取消申请","Are you sure you want to step down":"确定要下台吗",Check:"查看",Neglect:"忽略","Disable all audios":"全体静音","Enable all audios":"解除全体静音","Disable all videos":"全体静画","Enable all videos":"解除全体静画","All mute":"全体静音","All current and new members will be muted":"所有及新加入的成员将被静音","All and new members will be banned from the camera":"所有及新加入的成员将被禁止视频","All stop video":"全体禁画","Lift all mute":"取消全体静音","Lift stop all video":"取消全体禁画","No relevant user found.":"未找到相关用户","Member List":"成员列表",Unmute:"解除静音","Cancel Unmute":"取消解除禁言",Mute:"静音",members:"人","Failed to get chat message":"获取聊天消息失败","Agree to the stage":"同意上台","Take the stage now":"立即上台","Stay off the stage":"暂不上台","Cancel stage":"取消邀请上台","Invite stage":"邀请上台","Refuse stage":"拒绝上台","Members applying on stage":"成员上台申请","Enable video":"请求开启视频","Cancel Enable video":"取消解除禁画","Disable video":"关闭视频","Enable chat":"解除禁言","Disable chat":"禁言","Kick out":"踢出房间","is sharing their screen":"的屏幕分享","Apply to stage":"上台申请","Apply to stage application":"请求上台申请","Member Onstage Application":"成员上台申请",Reject:"拒绝","Reject All":"全部拒绝","Agree All":"全部同意","Please raise your hand to apply":"如果您想发言请先举手申请上麦","You can turn on the microphone and camera once you are on stage":"上台后可以打开麦克风和摄像头","Sb invites you to speak on stage":({named:e})=>`${e("role")}邀请您上台发言`,"After agreeing to go on stage, you can turn on the camera and microphone. Do you agree to go on stage?":"同意上台后可打开摄像头和麦克风，是否同意上台？","Hand down":"手放下","Step down(Master)":"邀请下台","Step down":"下台","sb has rejected your application for the stage":({named:e})=>`${e("role")}拒绝了你的上台申请`,"You have been invited by the host to step down, please raise your hand if you need to speak":"您已被主持人邀请下台，需要发言请先举手","Select a screen/window":"选择屏幕/窗口",Screen:"屏幕",Window:"窗口",Share:"开始分享","Safety Reminder":"安全提醒","Continue sharing":"继续共享","Select a screen or window first":"请选择要分享的屏幕或者窗口",Grid:"一屏九等分","Gallery on right":"右侧成员列表","Gallery at top":"顶部成员列表","Network ":"网络",Latency:"延迟",Stability:"稳定",Fluctuation:"波动",Lag:"卡顿",Disconnected:"已断开","Packet loss":"丢包率","Share the room ID or invite link":"您可以通过复制房间号或者邀请链接的方式邀请更多人加入房间","Invite by room number":"通过房间号邀请","Invite via room link":"通过房间链接邀请","Room Link":"房间链接","You can share the room number or link to invite more people to join the room.":"您可以分享房间号或链接邀请更多人加入房间。","You can share the room number to invite more people to join the room":"您可以分享房间号邀请更多人加入房间","If you have any questions, please feel free to join our QQ group or send an email":"如果有任何问题欢迎加入我们的QQ群或者发送邮件。","If you have any questions, please email us.":"如果有任何问题欢迎加入我们的交流群或者发送邮件。","Join our product discussion group":"加入产品交流群","Our email address":"我们的邮件地址","Join now":"立即加入","Room QR code":"房间二维码","Search for conference attendees":"搜索参会成员","Invite via client scheme":"通过客户端 scheme 邀请","Contact us":"联系我们","Member management":"成员管理","Grid view":"宫格视图","Join our QQ group chat or email us.":"如果有任何问题欢迎加入我们的QQ群或者发送邮件","group chat":"QQ 群",Email:"邮箱地址","Audio settings":"声音设置","Camera settings":"摄像头设置",Copy:"复制","Copied successfully":"复制成功","accepted the invitation to the stage":"接受了上台邀请","declined the invitation to the stage":"拒绝了上台邀请","All audios disabled":"已开启全体静音","All audios enabled":"已解除全体静音","Your microphone has been turned off":"已关闭您的麦克风","Sb invites you to turn on the microphone":({named:e})=>`${e("role")}邀请你打开麦克风`,"All videos disabled":"已开启全体禁画","All videos enabled":"已解除全体禁画","Disabling text chat for all is enabled":"已开启全体禁止文字聊天","Unblocked all text chat":"已解除全体禁止文字聊天","Your camera has been turned off":"已关闭您的摄像头","Sb invites you to turn on the camera":({named:e})=>`${e("role")}邀请你打开摄像头`,"The host has turned off your screen sharing":"主持人已关闭您的屏幕分享","Turn on the camera":"打开摄像头","Keep it closed":"保持关闭","You have been banned from text chat":"您被禁止文字聊天","You are allowed to text chat":"您被允许文字聊天","kicked out of the room by the host":"被主持人踢出房间","kicked out of the room by other device":"相同账号在其他客户端进入房间","kicked out of the room by serve":"被服务端踢出房间","Reject on Stage failed, please retry":({named:e})=>`拒绝 ${e("name")} 上台失败, 请重试`,"Agree on Stage failed, please retry":({named:e})=>`同意 ${e("name")} 上台失败, 请重试`,"Has been fully muted and cannot open the microphone":"已被全员静音，无法打开麦克风","Has been muted by the host and cannot open the microphone":"已被主持人静音，无法打开麦克风","To apply to speak in the room, please raise your hand first to apply for the microphone":"申请发言房间，请先举手申请上麦","Has been full static painting, can not open the video":"已被全员静画，无法打开视频","It has been stilled by the host and cannot open the video":"已被主持人静画，无法打开视频","Failed to enter the room.":"进入房间失败！","Has been full static painting, can not share your screen":"已被全员静画，无法打开屏幕分享","Microphone not detected on current device":"当前设备未检测到麦克风","Camera not detected on current device":"当前设备未检测到摄像头","Camera And Microphone not detected on current device":"当前设备未检测到摄像头和麦克风","Another user is currently sharing the screen, screen sharing is not possible.":"当前有其他用户正在屏幕共享，无法进行屏幕共享","This action causes the room to be exited, does it continue?":"该操作会导致退出房间，是否继续？","This action causes the room to be disbanded, does it continue?":"该操作会导致解散房间，是否继续？","Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.":"共享屏幕时可能会泄露短信验证码、密码等隐私信息，造成财产损失，请警惕各种诈骗行为","Please enter the room number":"请输入房间号","The current browser does not support capturing audio and video":"当前浏览器不支持采集音频和视频","The current browser does not support getting microphone and camera list":"当前浏览器不支持获取麦克风和摄像头列表","The current browser does not support screen sharing":"当前浏览器不支持屏幕分享","The current browser does not support capturing audio":"当前浏览器不支持采集音频","The current browser does not support capturing video":"当前浏览器不支持采集视频","The current browser does not support audio and video communication capabilities":"当前浏览器不支持音视频通信能力","whether to kick sb off the room":({named:e})=>`是否将 ${e("name")} 移出房间`,"An invitation to open the microphone has been sent to sb.":({named:e})=>`已向 ${e("name")} 发出开启麦克风邀请`,"An invitation to open the camera has been sent to sb.":({named:e})=>`已向 ${e("name")} 发出开启摄像头邀请`,"Transfer owner failed, please try again.":"转交房主失败，请重试","Sb has been set as an administrator":({named:e})=>`已将 ${e("name")} 设为管理员`,"Succeed on stage":"上台成功","After unlocking, users can freely turn on the microphone":"解除后用户可以自由开启麦克风","Members will not be able to open the microphone":"成员将无法开启麦克风","After unlocking, users can freely turn on the camera":"解除后用户可以自由开启视频","Members will not be able to open the camera":"成员将无法开启视频画面","You have become a administrator":"您已成为管理员","You are now a room owner":"您已成为房主","Your administrator status has been revoked":"您的管理员身份被收回","After transfer the room owner, you will become a general user":"转交房主后将成为普通成员","Transfer the roomOwner to sb":({named:e})=>`将房主转移给${e("name")}`,"Confirm transfer":"确认转交","The room owner has been transferred to sb":({named:e})=>`已将房主转交给${e("name")}`,"Application to go on stage was rejected":"上台申请被拒绝","You are now an administrator":"您已成为管理员","The RoomOwner has withdrawn your administrator privileges":"房主已收回您的管理员权限","This member has already received the same request, please try again later":"该成员已收到相同请求，请稍后再试","Failed to go on stage, invitation has timed out":"上台失败，邀请已超时","The current number of people on stage has reached the limit":"当前上台人数已达上限","The invitation to sb to go on stage has timed out":({named:e})=>`对${e("name")}的上台邀请已超时`,"Currently no member has applied to go on stage":"暂无成员申请上台",Operate:"操作","Stage management":"上台管理","Already on stage":"已上台","Not on stage":"未上台","To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve":"再次上台需重新发起申请，并等待房主/管理员通过","To go on stage again, a new application needs to be initiated":"再次上台需重新发起申请","The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it":"上台申请已发出，请等待房主/管理员通过","Cancellation request has been sent, please wait for the roomOwner/administrator to approve it":"取消上台申请已发出，请等待房主/管理员通过","Canceled application to go on stage":"已取消上台申请","and so on":"等","people applying to stage":"人正在申请上台","and so on number people applying to stage":({named:e})=>`等 ${e("number")} 人正在申请上台`,"quick meeting":"快速会议",Meeting:"会议","Meeting in progress":"会议 进行中",Initiating:"正在发起","X people have joined":({values:e})=>`${null==e?void 0:e.number} 人已入会`,"Waiting for members to join the meeting":"等待成员入会","X people are in the meeting":({values:e})=>`${null==e?void 0:e.number} 人在会议中`,"Already joined":"已入会","Enter the meeting":"进入会议","Ending meeting":"正在结束会议","The meeting has ended":"会议已结束","Currently in a meeting, please exit the current meeting before proceeding.":"正在会议中，请先退出当前会议后再进行操作","Failed to initiate meeting":"发起会议失败","Failed to enter the meeting":"进入会议失败"},"en-US":{"":"","Sign in":"Sign in","Phone Login":"Phone Login","Email Login":"Email Login","I have read and agree to the":"I have read and agree to the","Privacy Policy":"Privacy Policy",and:"and","Terms of Use":"Terms of Use",Login:"Login","Mobile number":"Mobile number","Verification code":"Verification code","Email address":"Email address","Please enter a valid phone number!":"Please enter a valid phone number!","Please enter a valid email address!":"Please enter a valid email address!","Please enter your phone number!":"Please enter your phone number!","Please enter your email address!":"Please enter your email address!","Please enter the verification code!":"Please enter the verification code!","Please accept the privacy policy and user agreement!":"Please accept the privacy policy and user agreement!","Incorrect verification code, please check the code!":"Incorrect verification code, please check the code!","The verification code has expired, please retrieve a new one!":"The verification code has expired, please retrieve a new one!","The verification code has been used, please retrieve a new one!":"The verification code has been used, please retrieve a new one!","Login failed, please try again.":"Login failed, please try again.",SEND:"SEND"," ":" ","The room does not exist, please confirm the room number or create a room!":"The room does not exist, please confirm the room number or create a room!","Log out":"Log out","Edit profile":"Edit profile","User Name":"User Name","Please input user name":"Please input user name","Username length should be greater than 0":"Username length should be greater than 0",Save:"Save",Camera:"Camera",Mic:"Mic","Off Camera":"Off Camera","Mic settings":"Mic settings",Output:"Output",Speaker:"Speaker",Test:"Test",Stop:"Stop",Preview:"Preview",Mirror:"Mirror",Resolution:"Resolution","More Camera Settings":"More Camera Settings","Join the room ?":"Join the room ?","You are invited to room ":"You are invited to room ",Room:"Room",Join:"Join",Sure:"Sure","Switch Theme":"Switch Theme",Layout:"Layout","New Room":"New Room","Room Type":"Room Type","Your Name":"Your Name","Grid view":"Grid view","Speaker view":"Speaker view","Turn on the microphone":"Turn on the microphone","Turn on the speaker":"Turn on the speaker","Turn on the video":"Turn on the video","Free Speech Room":"Free Speech Room","On-stage Speaking Room":"On-stage Speaking Room","Join Room":"Join Room","Enter room ID":"Enter room ID","video conferencing":" 's video conferencing","Quick Meeting":" 's Quick Meeting","Room ID":"Room ID","Low Definition":"Low Definition","Standard Definition":"Standard Definition","High Definition":"High Definition","Super Definition":"Super Definition","End sharing":"End sharing","Stop sharing?":"Stop sharing?","Stop sharing":"Stop sharing","You are sharing the screen...":"You are sharing the screen...",Sharing:"Sharing","Safety Reminder":"Safety Reminder","Share screen":"Share screen","Grant permission to screen recording":"Grant permission to screen recording","Open the system preferences settings":"Open the system preferences settings",'Due to macOS 10.15 system requirements, please check the current application in "System Preferences - Security & Privacy - Screen Recording".':'Due to macOS 10.15 system requirements, please check the current application in "System Preferences - Security & Privacy - Screen Recording".',"Others will no longer see your screen after you stop sharing. Are you sure you want to stop?":"Others will no longer see your screen after you stop sharing. Are you sure you want to stop?","Others will no longer see your screen after you stop sharing.":"Others will no longer see your screen after you stop sharing.","You currently do not have sharing permission, please raise your hand to apply for sharing permission first":"You currently do not have sharing permission, please raise your hand to apply for sharing permission first",Host:"Host",Admin:"Admin",RoomOwner:"RoomOwner",Me:"Me",me:"me",More:"More","Raise hand":"Raise hand",Agree:"Agree",Chat:"Chat",Cancel:"Cancel",Exit:"Exit full screen","Full screen":"Full screen",Members:"Members","Search Member":"Search Member","Transfer owner":"Transfer owner","Set as administrator":"Set as administrator","Revoke administrator":"Revoke administrator","The administrator status of sb has been withdrawn":({named:e})=>`The administrator status of ${e("name")} has been withdrawn`,"sb has been set as administrator":({named:e})=>`${e("name")} has been set as administrator`,"You have been invited by the administrator to step down, please raise your hand if you need to speak":"You have been invited by the administrator to step down, please raise your hand if you need to speak",Invite:"Invite",Settings:"Settings",EndPC:"End",EndH5:"End",'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.':'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.','You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.':'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.',"If you do not want to end the meeting, please designate a new host before leaving the meeting.":"If you do not want to end the meeting, please designate a new host before leaving the meeting.","Are you sure you want to leave this room?":"Are you sure you want to leave this room?","New host":"New host","Transfer and leave":"Transfer and leave","Leave room?":"Leave room?","Select a new host":"Select a new host","Appoint a new host":"Appoint a new host","The host closed the room.":"The host closed the room.",Note:"Note",Confirm:"Confirm",Leave:"Leave",Dismiss:"Dismiss","The administrator has been changed to ":"The administrator has been changed to ","Muted by the moderator":"Muted by the moderator","Type a message":"Type a message",Send:"Send","Failed to send the message":"Failed to send the message","Applying for the stage":"Applying for the stage","Apply for the stage":"Apply for the stage","Cancel Apply":"Cancel Apply","Are you sure you want to step down":"Are you sure you want to step down",Check:"Check",Neglect:"Neglect","Disable all audios":"Disable all audios","Enable all audios":"Enable all audios","Disable all videos":"Disable all videos","Enable all videos":"Enable all videos","Member List":"Member List","All mute":"All mute","All stop video":"All stop video","Lift all mute":"Lift all mute","Lift stop all video":"Lift stop all video",Unmute:"Unmute","Cancel Unmute":"Cancel Unmute",Mute:"Mute",members:"members","Failed to get chat message":"Failed to get chat message","Agree to the stage":"Agree to the stage","Take the stage now":"Take the stage now","Stay off the stage":"Stay off the stage","Cancel stage":"Cancel stage","Invite stage":"Invite stage","Refuse stage":"Refuse stage","Members applying on stage":"Members applying on stage","Step down":"Step down","Step down(Master)":"Step down","Enable video":"Enable video","Disable video":"Disable video","Enable chat":"Enable chat","Disable chat":"Disable chat","Kick out":"Kick out","is sharing their screen":"is sharing their screen","Apply to stage":"Apply to stage","Apply to stage application":"Apply to stage application","Member Onstage Application":"Member Onstage Application",Reject:"Reject","Reject All":"Reject All","Agree All":"Agree All","Please raise your hand to apply":"Please raise your hand to apply","You can turn on the microphone and camera once you are on stage":"You can turn on the microphone and camera once you are on stage","Sb invites you to speak on stage":({named:e})=>`${e("role")} invites you to speak on stage`,"After agreeing to go on stage, you can turn on the camera and microphone. Do you agree to go on stage?":"After agreeing to go on stage, you can turn on the camera and microphone. Do you agree to go on stage?","Hand down":"Hand down","sb has rejected your application for the stage":({named:e})=>`${e("role")} has rejected your application for the stage`,"You have been invited by the host to step down, please raise your hand if you need to speak":"You have been invited by the host to step down, please raise your hand if you need to speak","If you have any questions, please email us.":"If you have any questions, please email us.","Join our product discussion group":"Join our product discussion group","Our email address":"Our email address","Join now":"Join now","Select a screen/window":"Select a screen/window",Screen:"Screen",Window:"Window",Share:"Share","Continue sharing":"Continue sharing","Select a screen or window first":"Select a screen or window first",Grid:"Grid",Tips:"Tips","Gallery on right":"Gallery on right","Gallery at top":"Gallery at top","Network ":"Network ",Latency:"Latency",Stability:"Stability",Fluctuation:"Fluctuation",Lag:"Lag",Disconnected:"Disconnected","Packet loss":"Packet loss","Share the room ID or invite link":"Share the room ID or invite link","Invite by room number":"Invite by room number","Invite via room link":"Invite via room link","Room Link":"Room Link","You can share the room number or link to invite more people to join the room.":"You can share the room number or link to invite more people to join the room.","You can share the room number to invite more people to join the room":"You can share the room number to invite more people to join the room","If you have any questions, please feel free to join our QQ group or send an email":"If you have any questions, please feel free to join our QQ group or send an email","Room QR code":"Room QR code","Search for conference attendees":"Search for conference attendees","Invite via client scheme":"Invite via client scheme","All current and new members will be muted":"All current and new members will be muted","All and new members will be banned from the camera":"All and new members will be banned from the camera","No relevant user found.":"No relevant user found.","Contact us":"Contact us","Member management":"Member management","Join our QQ group chat or email us.":"Join our QQ group chat or email us.","group chat":"group chat",Email:"Email","Audio settings":"Audio settings","Camera settings":"Camera settings",Copy:"Copy","Copied successfully":"Copied successfully","accepted the invitation to the stage":"accepted the invitation to the stage","declined the invitation to the stage":"declined the invitation to the stage","All audios disabled":"All audios disabled","All audios enabled":"All audios enabled","Your microphone has been turned off":"Your microphone has been turned off","Sb invites you to turn on the microphone":({named:e})=>`${e("role")} invites you to turn on the microphone`,"All videos disabled":"All videos disabled","All videos enabled":"All videos enabled","Disabling text chat for all is enabled":"Disabling text chat for all is enabled","Unblocked all text chat":"Unblocked all text chat","Your camera has been turned off":"Your camera has been turned off","Sb invites you to turn on the camera":({named:e})=>`${e("role")} invites you to turn on the camera`,"The host has turned off your screen sharing":"The host has turned off your screen sharing","Turn on the camera":"Turn on the camera","Keep it closed":"Keep it closed","You have been banned from text chat":"You have been banned from text chat","You are allowed to text chat":"You are allowed to text chat","kicked out of the room by the host":"kicked out of the room by the host","kicked out of the room by other device":"kicked out of the room by other device","kicked out of the room by serve":"kicked out of the room by serve","Reject on Stage failed, please retry":({named:e})=>`Reject ${e("name")} on Stage failed, please retry`,"Agree on Stage failed, please retry":({named:e})=>`Agree ${e("name")} on Stage failed, please retry`,"Has been fully muted and cannot open the microphone":"Has been fully muted and cannot open the microphone","Has been muted by the host and cannot open the microphone":"Has been muted by the host and cannot open the microphone","To apply to speak in the room, please raise your hand first to apply for the microphone":"To apply to speak in the room, please raise your hand first to apply for the microphone","Has been full static painting, can not open the video":"Has been full static painting, can not open the video","It has been stilled by the host and cannot open the video":"It has been stilled by the host and cannot open the video","Failed to enter the room.":"Failed to enter the room.","Has been full static painting, can not share your screen":"Has been full static painting, can not share your screen.","Microphone not detected on current device":"Microphone not detected on current device","Camera not detected on current device":"Camera not detected on current device","Camera And Microphone not detected on current device":"Camera And Microphone not detected on current device","Another user is currently sharing the screen, screen sharing is not possible.":"Another user is currently sharing the screen, screen sharing is not possible.","This action causes the room to be disbanded, does it continue?":"This action causes the room to be disbanded, does it continue?","This action causes the room to be exited, does it continue?":"This action causes the room to be exited, does it continue?","Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.":"Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.","Please enter the room number":"Please enter the room number","whether to kick sb off the room":({named:e})=>`whether to kick ${e("name")} off the room`,"The current browser does not support capturing audio and video":"The current browser does not support capturing audio and video","The current browser does not support getting microphone and camera list":"The current browser does not support getting audio/video device list","The current browser does not support screen sharing":"The current browser does not support screen sharing","The current browser does not support capturing audio":"The current browser does not support capture audio","The current browser does not support capturing video":"The current browser does not support capture video","The current browser does not support audio and video communication capabilities":"The current browser does not support audio and video communication capabilities","An invitation to open the microphone has been sent to sb.":({named:e})=>`An invitation to open the microphone has been sent to ${e("name")}`,"An invitation to open the camera has been sent to sb.":({named:e})=>`An invitation to open the camera has been sent to ${e("name")}`,"Transfer owner failed, please try again.":"Transfer owner failed, please try again.","Sb has been set as an administrator":({named:e})=>`${e("name")} has been set as an administrator.`,"Succeed on stage":"Succeed on stage","After unlocking, users can freely turn on the microphone":"After unlocking, users can freely turn on the microphone","Members will not be able to open the microphone":"Members will not be able to open the microphone","After unlocking, users can freely turn on the camera":"After unlocking, users can freely turn on the camera","Members will not be able to open the camera":"Members will not be able to open the camera","You have become a administrator":"You have become a administrator","You are now a room owner":"You are now a room owner","Your administrator status has been revoked":"Your administrator status has been revoked","After transfer the room owner, you will become a general user":"After transfer the room owner, you will become a general user","Transfer the roomOwner to sb":({named:e})=>`Transfer the roomOwner to ${e("name")}`,"Confirm transfer":"Confirm transfer","The room owner has been transferred to sb":({named:e})=>`The room owner has been transferred to ${e("name")}`,"Application to go on stage was rejected":"Application to go on stage was rejected","You are now an administrator":"You are now an administrator","The RoomOwner has withdrawn your administrator privileges":"The RoomOwner has withdrawn your administrator privileges","This member has already received the same request, please try again later":"This member has already received the same request, please try again later","Failed to go on stage, invitation has timed out":"Failed to go on stage, invitation has timed out","The current number of people on stage has reached the limit":"The current number of people on stage has reached the limit","The invitation to sb to go on stage has timed out":({named:e})=>`The invitation to ${e("name")} to go on stage has timed out`,"Currently no member has applied to go on stage":"Currently no member has applied to go on stage",Operate:"Operate","Stage management":"Stage management","Already on stage":"Already on stage","Not on stage":"Not on stage","To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve":"To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve","To go on stage again, a new application needs to be initiated":"To go on stage again, a new application needs to be initiated","The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it":"The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it","Cancellation request has been sent, please wait for the roomOwner/administrator to approve it":"Cancellation request has been sent, please wait for the roomOwner/administrator to approve it","Canceled application to go on stage":"Canceled application to go on stage","and so on":"and so on","people applying to stage":"people applying to stage","and so on number people applying to stage":({named:e})=>`and so on ${e("number")} people applying to stage`,"quick meeting":"quick meeting",Meeting:"Meeting","Meeting in progress":"Meeting in progress",Initiating:"Initiating","X people have joined":({values:e})=>`${null==e?void 0:e.number} people have joined`,"Waiting for members to join the meeting":"Waiting for members to join the meeting","X people are in the meeting":({values:e})=>`${null==e?void 0:e.number} people are in the meeting`,"Already joined":"Already joined","Enter the meeting":"Enter the meeting","Ending meeting":"Ending meeting","The meeting has ended":"The meeting has ended","Currently in a meeting, please exit the current meeting before proceeding.":"Currently in a meeting, please exit the current meeting before proceeding.","Failed to initiate meeting":"Failed to initiate meeting","Failed to enter the meeting":"Failed to enter the meeting"}}});function ae(){return{t:se.global.t.bind(se)}}
/*!
   * pinia v2.1.7
   * (c) 2023 Eduardo San Martin Morote
   * @license MIT
   */
let re;const ce=e=>re=e,ue=Symbol();function le(e){return e&&"object"==typeof e&&"[object Object]"===Object.prototype.toString.call(e)&&"function"!=typeof e.toJSON}var de,pe;(pe=de||(de={})).direct="direct",pe.patchObject="patch object",pe.patchFunction="patch function";const he="undefined"!=typeof window;function ge(){const t=e.effectScope(!0),n=t.run((()=>e.ref({})));let o=[],i=[];const s=e.markRaw({install(e){ce(s),s._a=e,e.provide(ue,s),e.config.globalProperties.$pinia=s,i.forEach((e=>o.push(e))),i=[]},use(e){return this._a?o.push(e):i.push(e),this},_p:o,_a:null,_e:t,_s:new Map,state:n});return s}const _e=()=>{};function fe(t,n,o,i=_e){t.push(n);const s=()=>{const e=t.indexOf(n);e>-1&&(t.splice(e,1),i())};return!o&&e.getCurrentScope()&&e.onScopeDispose(s),s}function me(e,...t){e.slice().forEach((e=>{e(...t)}))}const ve=e=>e();function ye(t,n){t instanceof Map&&n instanceof Map&&n.forEach(((e,n)=>t.set(n,e))),t instanceof Set&&n instanceof Set&&n.forEach(t.add,t);for(const o in n){if(!n.hasOwnProperty(o))continue;const i=n[o],s=t[o];le(s)&&le(i)&&t.hasOwnProperty(o)&&!e.isRef(i)&&!e.isReactive(i)?t[o]=ye(s,i):t[o]=i}return t}const Ie=Symbol();const{assign:Me}=Object;function Ce(t,n,o={},i,s,a){let r;const c=Me({actions:{}},o),u={deep:!0};let l,d,p,h=[],g=[];const _=i.state.value[t];let f;function m(n){let o;l=d=!1,"function"==typeof n?(n(i.state.value[t]),o={type:de.patchFunction,storeId:t,events:p}):(ye(i.state.value[t],n),o={type:de.patchObject,payload:n,storeId:t,events:p});const s=f=Symbol();e.nextTick().then((()=>{f===s&&(l=!0)})),d=!0,me(h,o,i.state.value[t])}a||_||(i.state.value[t]={}),e.ref({});const v=a?function(){const{state:e}=o,t=e?e():{};this.$patch((e=>{Me(e,t)}))}:_e;function y(e,n){return function(){ce(i);const o=Array.from(arguments),s=[],a=[];let r;me(g,{args:o,name:e,store:M,after:function(e){s.push(e)},onError:function(e){a.push(e)}});try{r=n.apply(this&&this.$id===t?this:M,o)}catch(c){throw me(a,c),c}return r instanceof Promise?r.then((e=>(me(s,e),e))).catch((e=>(me(a,e),Promise.reject(e)))):(me(s,r),r)}}const I={_p:i,$id:t,$onAction:fe.bind(null,g),$patch:m,$reset:v,$subscribe(n,o={}){const s=fe(h,n,o.detached,(()=>a())),a=r.run((()=>e.watch((()=>i.state.value[t]),(e=>{("sync"===o.flush?d:l)&&n({storeId:t,type:de.direct,events:p},e)}),Me({},u,o))));return s},$dispose:function(){r.stop(),h=[],g=[],i._s.delete(t)}},M=e.reactive(I);i._s.set(t,M);const C=(i._a&&i._a.runWithContext||ve)((()=>i._e.run((()=>(r=e.effectScope()).run(n)))));for(const S in C){const n=C[S];if(e.isRef(n)&&(E=n,!e.isRef(E)||!E.effect)||e.isReactive(n))a||(!_||le(T=n)&&T.hasOwnProperty(Ie)||(e.isRef(n)?n.value=_[S]:ye(n,_[S])),i.state.value[t][S]=n);else if("function"==typeof n){const e=y(S,n);C[S]=e,c.actions[S]=n}}var T,E;return Me(M,C),Me(e.toRaw(M),C),Object.defineProperty(M,"$state",{get:()=>i.state.value[t],set:e=>{m((t=>{Me(t,e)}))}}),i._p.forEach((e=>{Me(M,r.run((()=>e({store:M,app:i._a,pinia:i,options:c}))))})),_&&a&&o.hydrate&&o.hydrate(M.$state,_),l=!0,d=!0,M}function Te(t,n,o){let i,s;const a="function"==typeof n;function r(t,o){const r=e.hasInjectionContext();(t=t||(r?e.inject(ue,null):null))&&ce(t),(t=re)._s.has(i)||(a?Ce(i,n,s,t):function(t,n,o){const{state:i,actions:s,getters:a}=n,r=o.state.value[t];let c;c=Ce(t,(function(){r||(o.state.value[t]=i?i():{});const n=e.toRefs(o.state.value[t]);return Me(n,s,Object.keys(a||{}).reduce(((n,i)=>(n[i]=e.markRaw(e.computed((()=>{ce(o);const e=o._s.get(t);return a[i].call(e,e)}))),n)),{}))}),n,o,0,!0)}(i,s,t));return t._s.get(i)}return"string"==typeof t?(i=t,s=a?o:n):(s=t,i=t.id),r.$id=i,r}let Ee="Store";function Se(e,t){return Array.isArray(t)?t.reduce(((t,n)=>(t[n]=function(){return e(this.$pinia)[n]},t)),{}):Object.keys(t).reduce(((n,o)=>(n[o]=function(){const n=e(this.$pinia),i=t[o];return"function"==typeof i?i.call(this,n):n[i]},n)),{})}const De=Se;function ke(t){{t=e.toRaw(t);const n={};for(const o in t){const i=t[o];(e.isRef(i)||e.isReactive(i))&&(n[o]=e.toRef(t,o))}return n}}const Re=Object.freeze(Object.defineProperty({__proto__:null,get MutationType(){return de},PiniaVuePlugin:function(e){e.mixin({beforeCreate(){const e=this.$options;if(e.pinia){const t=e.pinia;if(!this._provided){const e={};Object.defineProperty(this,"_provided",{get:()=>e,set:t=>Object.assign(e,t)})}this._provided[ue]=t,this.$pinia||(this.$pinia=t),t._a=this,he&&ce(t)}else!this.$pinia&&e.parent&&e.parent.$pinia&&(this.$pinia=e.parent.$pinia)},destroyed(){delete this._pStores}})},acceptHMRUpdate:function(e,t){return()=>{}},createPinia:ge,defineStore:Te,getActivePinia:()=>e.hasInjectionContext()&&e.inject(ue)||re,mapActions:function(e,t){return Array.isArray(t)?t.reduce(((t,n)=>(t[n]=function(...t){return e(this.$pinia)[n](...t)},t)),{}):Object.keys(t).reduce(((n,o)=>(n[o]=function(...n){return e(this.$pinia)[t[o]](...n)},n)),{})},mapGetters:De,mapState:Se,mapStores:function(...e){return e.reduce(((e,t)=>(e[t.$id+Ee]=function(){return t(this.$pinia)},e)),{})},mapWritableState:function(e,t){return Array.isArray(t)?t.reduce(((t,n)=>(t[n]={get(){return e(this.$pinia)[n]},set(t){return e(this.$pinia)[n]=t}},t)),{}):Object.keys(t).reduce(((n,o)=>(n[o]={get(){return e(this.$pinia)[t[o]]},set(n){return e(this.$pinia)[t[o]]=n}},n)),{})},setActivePinia:ce,setMapStoreSuffix:function(e){Ee=e},skipHydrate:function(e){return Object.defineProperty(e,Ie,{})},storeToRefs:ke},Symbol.toStringTag,{value:"Module"}));var Le=(e=>(e.SIX_EQUAL_POINTS="six_equal_points",e.NINE_EQUAL_POINTS="nine_equal_points",e.TWENTY_FIVE_EQUAL_POINTS="twenty_five_equal_points",e.RIGHT_SIDE_LIST="right_side_list",e.TOP_SIDE_LIST="top_side_list",e.LARGE_SMALL_WINDOW="large_small_window",e.GRID_VIEW="grid_view",e))(Le||{});const Ae="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Oe="undefined"!=typeof uni&&"undefined"==typeof window,Ne="undefined"!=typeof uni,Pe=("undefined"!=typeof uni||"undefined"!=typeof window)&&!(Ae||Oe),be=Ae?wx:Ne?uni:"undefined"!=typeof window?window:{},Ue=Pe&&window&&window.navigator&&window.navigator.userAgent||"",Ge=/Android/i.test(Ue),we=/(?:Windows Phone)/.test(Ue),Fe=/(?:SymbianOS)/.test(Ue),xe=/OpenHarmony/i.test(Ue),Ve=Pe&&("ontouchstart"in window||navigator.maxTouchPoints>0)&&function(){if(Pe){if(/Tablet|Pad/i.test(Ue))return!0;if(180===window.orientation||0===window.orientation)return window.innerWidth>=768&&window.innerHeight>=1024;if(90===window.orientation||-90===window.orientation)return window.innerWidth>=1024&&window.innerHeight>=768}return!1}(),qe=/iPhone/i.test(Ue)||/iPod/i.test(Ue),Be=Ae,He=Ge||we||Fe||qe||Ve||xe,je=Pe&&!He,Ke=Oe&&!Ae;function Ye(){let e="";return je?e="pc":He?e="h5":Be?e="wechat":Ke&&(e="app"),e}const ze=new Map;function We(e,t){if(!e)return Promise.reject(new Error(`getBoundingClientRect get error selector ${typeof e}.`));if(window||document){const t="object"==typeof e?e:document.querySelector(e);if(!t)return Promise.reject(new Error(`getBoundingClientRect can't find ${e} dom.`));const n=t.getBoundingClientRect();return Promise.resolve({id:t.id,top:n.top,left:n.left,right:n.right,bottom:n.bottom,width:n.width,height:n.height,x:n.x,y:n.y})}if(Ne){if(!t)return Promise.reject(new Error("getBoundingClientRect need instanceName in params."));const n=uni.createSelectorQuery().in(ze.get(t));return new Promise(((t,o)=>{n.select(e).boundingClientRect((e=>{e&&t(e)})).exec(),setTimeout((()=>o(new Error(`getBoundingClientRect ${e} timeout.`))),500)}))}return Promise.reject(new Error("getBoundingClientRect occur error"))}function Je(e,t){if(!e)return Promise.reject(new Error(`getScrollInfo get error selector ${typeof e}.`));if(!Ne&&window){const t="object"==typeof e?e:document.querySelector(e);return t?Promise.resolve({id:t.id,scrollTop:t.scrollTop,scrollLeft:t.scrollLeft,scrollWidth:t.scrollWidth,scrollHeight:t.scrollHeight}):Promise.reject(new Error(`getScrollInfo can't find ${e} dom.`))}if(Ne){if(!t)return Promise.reject(new Error("getScrollInfo need instanceName in params."));const n=uni.createSelectorQuery().in(ze.get(t));return new Promise(((t,o)=>{n.select(e).scrollOffset((e=>{e&&t(e)})).exec(),setTimeout((()=>o(new Error(`getScrollInfo ${e} timeout.`))),500)}))}return Promise.reject(new Error("getScrollInfo occur error"))}_("log","at node_modules/@tencentcloud/universal-api/index.js:1","UniversalAPI.VERSION:2.4.0");const $e=new class e{constructor(){if(e.instance)return e.instance;e.instance=this,this.eventCallback=null,this.listener=null,this.button=0,this.init()}init(){Pe&&(this.eventCallback=e=>{this.listener&&this.listener(e)},document.addEventListener("mousedown",this.eventCallback))}listen(e){if(Pe){const{domRefs:t,ignoreDomRefs:n,handler:o,button:i=0}=e;this.button=i,this.listener=e=>{const i=Array.isArray(n)?n:[n];for(const t of i)if(t&&t.contains(e.target))return;const s=Array.isArray(t)?t:[t];for(const t of s)if(t&&t.contains(e.target)&&this.button===e.button)return;o(e),this.remove()}}}remove(){this.listener=null,this.button=-1}};Ye();const Xe="h5"===Ye(),Ze="wechat"===Ye(),Qe="app"===Ye(),et=Xe||Ze||Qe,nt=(null==(t=null==navigator?void 0:navigator.userAgent)?void 0:t.toLowerCase().indexOf(" electron/"))>-1;navigator&&(null==(n=null==navigator?void 0:navigator.userAgent)||n.toLocaleLowerCase().indexOf("micromessenger"));const ot=Te("basic",{state:()=>({sdkAppId:0,userId:"",userSig:"",userName:"",avatarUrl:"",useStringRoomId:!1,roomId:"",roomMode:"FreeSpeech",isSidebarOpen:!1,layout:Ze||Qe?Le.SIX_EQUAL_POINTS:Le.NINE_EQUAL_POINTS,showSettingDialog:!1,showApplyUserList:!1,activeSettingTab:"audio",isLocalStreamMirror:!0,isFrontCamera:!0,sidebarName:"",masterUserId:"",localQuality:0,networkInfo:{userId:"",downLoss:0,quality:0,upLoss:0,delay:0},lang:oe(),defaultTheme:Qe?"white":"black",isSupportSwitchTheme:!0,showHeaderTool:!0,shareLink:"",isRoomLinkVisible:!nt&&!Ze,isSchemeLinkVisible:!et,isShowScreenShareAntiFraud:!1,isOpenMic:!1,componentConfig:{SwitchTheme:{visible:!0},InviteControl:{visible:!0},RoomLink:{visible:!0}}}),getters:{},actions:{setSdkAppId(e){this.sdkAppId=e},setUserId(e){this.userId=e},setUserSig(e){this.userSig=e},setUserName(e){this.userName=e},setAvatarUrl(e){this.avatarUrl=e},setRoomId(e){this.roomId=e,this.useStringRoomId="string"==typeof e},setSidebarOpenStatus(e){this.isSidebarOpen=e},setSidebarName(e){this.sidebarName=e},setLayout(e){this.layout=e},setShowSettingDialog(e){this.showSettingDialog=e},setShowApplyUserList(e){this.showApplyUserList=e},setActiveSettingTab(e){this.activeSettingTab=e},setIsLocalStreamMirror(e){this.isLocalStreamMirror=e},setIsFrontCamera(e){this.isFrontCamera=e},setDefaultTheme(e){this.defaultTheme=e},setIsSupportSwitchTheme(e){this.isSupportSwitchTheme=e},setShowHeaderTool(e){this.showHeaderTool=e},setShareLink(e){this.shareLink=e},setIsRoomLinkVisible(e){this.isRoomLinkVisible=e},setIsSchemeLinkVisible(e){this.isSchemeLinkVisible=e},setIsShowScreenShareAntiFraud(e){this.isShowScreenShareAntiFraud=e},setBasicInfo(e){if(!e)return;const{sdkAppId:t,userId:n,userSig:o,userName:i,avatarUrl:s,roomId:a,theme:r,showHeaderTool:c}=e;t&&this.setSdkAppId(t),n&&this.setUserId(n),o&&this.setUserSig(o),i&&this.setUserName(i),s&&this.setAvatarUrl(s),a&&this.setRoomId(a),r&&!te(r.defaultTheme)&&this.setDefaultTheme(r.defaultTheme),r&&!te(r.isSupportSwitchTheme)&&this.setIsSupportSwitchTheme(r.isSupportSwitchTheme),!te(c)&&this.setShowHeaderTool(c)},setMasterUserId(e){this.masterUserId=e},setLocalQuality(e){const t=null==e?void 0:e.find((e=>e.userId===this.userId));this.localQuality=null==t?void 0:t.quality},setNetworkInfo(e){e.userId===this.userId&&(this.networkInfo=e)},setLang(e){this.lang=e},setIsOpenMic(e){this.isOpenMic=e},reset(){this.isSidebarOpen=!1,this.layout=Ze||Qe?Le.SIX_EQUAL_POINTS:Le.NINE_EQUAL_POINTS,this.showSettingDialog=!1,this.activeSettingTab="audio",this.isLocalStreamMirror=!0,this.sidebarName="",this.masterUserId="",this.localQuality=0,this.roomId="",this.useStringRoomId=!1,this.roomMode="FreeSpeech",this.showApplyUserList=!1,this.isFrontCamera=!0,this.showHeaderTool=!0,this.shareLink="",this.isOpenMic=!1}}}),it=e=>{const{type:t="",message:n="",duration:o=2e3}=e;return uni.showToast({title:n,icon:Qe?"none":st(t),image:"",duration:o,mask:!1})},st=(e="")=>{switch(e){case"success":case"error":case"loading":return e;default:return"none"}};var at,rt,ct,ut,lt,dt,pt,ht,gt,_t,ft,mt,vt,yt,It,Mt,Ct,Tt,Et,St,Dt,kt,Rt,Lt,At,Ot,Nt,Pt,bt,Ut=(e=>(e[e.NORMAL=3e3]="NORMAL",e[e.LONG=5e3]="LONG",e))(Ut||{});function Gt(e,t,n,o){var i,s=arguments.length,a=s<3?t:null===o?o=Object.getOwnPropertyDescriptor(t,n):o;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)a=Reflect.decorate(e,t,n,o);else for(var r=e.length-1;r>=0;r--)(i=e[r])&&(a=(s<3?i(a):s>3?i(t,n,a):i(t,n))||a);return s>3&&a&&Object.defineProperty(t,n,a),a}function wt(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(t){s(t)}}function r(e){try{c(o.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError,(bt=at||(at={}))[bt.ERR_SUCC=0]="ERR_SUCC",bt[bt.ERR_FAILED=-1]="ERR_FAILED",bt[bt.ERR_FREQ_LIMIT=-2]="ERR_FREQ_LIMIT",bt[bt.ERR_REPEAT_OPERATION=-3]="ERR_REPEAT_OPERATION",bt[bt.ERR_SDKAPPID_NOT_FOUND=-1e3]="ERR_SDKAPPID_NOT_FOUND",bt[bt.ERR_INVALID_PARAMETER=-1001]="ERR_INVALID_PARAMETER",bt[bt.ERR_SDK_NOT_INITIALIZED=-1002]="ERR_SDK_NOT_INITIALIZED",bt[bt.ERR_PERMISSION_DENIED=-1003]="ERR_PERMISSION_DENIED",bt[bt.ERR_REQUIRE_PAYMENT=-1004]="ERR_REQUIRE_PAYMENT",bt[bt.ERR_CAMERA_START_FAILED=-1100]="ERR_CAMERA_START_FAILED",bt[bt.ERR_CAMERA_NOT_AUTHORIZED=-1101]="ERR_CAMERA_NOT_AUTHORIZED",bt[bt.ERR_CAMERA_OCCUPIED=-1102]="ERR_CAMERA_OCCUPIED",bt[bt.ERR_CAMERA_DEVICE_EMPTY=-1103]="ERR_CAMERA_DEVICE_EMPTY",bt[bt.ERR_MICROPHONE_START_FAILED=-1104]="ERR_MICROPHONE_START_FAILED",bt[bt.ERR_MICROPHONE_NOT_AUTHORIZED=-1105]="ERR_MICROPHONE_NOT_AUTHORIZED",bt[bt.ERR_MICROPHONE_OCCUPIED=-1106]="ERR_MICROPHONE_OCCUPIED",bt[bt.ERR_MICROPHONE_DEVICE_EMPTY=-1107]="ERR_MICROPHONE_DEVICE_EMPTY",bt[bt.ERR_GET_SCREEN_SHARING_TARGET_FAILED=-1108]="ERR_GET_SCREEN_SHARING_TARGET_FAILED",bt[bt.ERR_START_SCREEN_SHARING_FAILED=-1109]="ERR_START_SCREEN_SHARING_FAILED",bt[bt.ERR_ROOM_ID_NOT_EXIST=-2100]="ERR_ROOM_ID_NOT_EXIST",bt[bt.ERR_OPERATION_INVALID_BEFORE_ENTER_ROOM=-2101]="ERR_OPERATION_INVALID_BEFORE_ENTER_ROOM",bt[bt.ERR_EXIT_NOT_SUPPORTED_FOR_ROOM_OWNER=-2102]="ERR_EXIT_NOT_SUPPORTED_FOR_ROOM_OWNER",bt[bt.ERR_OPERATION_NOT_SUPPORTED_IN_CURRENT_ROOM_TYPE=-2103]="ERR_OPERATION_NOT_SUPPORTED_IN_CURRENT_ROOM_TYPE",bt[bt.ERR_ROOM_ID_INVALID=-2105]="ERR_ROOM_ID_INVALID",bt[bt.ERR_ROOM_ID_OCCUPIED=-2106]="ERR_ROOM_ID_OCCUPIED",bt[bt.ERR_ROOM_NAME_INVALID=-2107]="ERR_ROOM_NAME_INVALID",bt[bt.ERR_ALREADY_IN_OTHER_ROOM=-2108]="ERR_ALREADY_IN_OTHER_ROOM",bt[bt.ERR_NEED_PASSWORD=-2109]="ERR_NEED_PASSWORD",bt[bt.ERR_WRONG_PASSWORD=-2110]="ERR_WRONG_PASSWORD",bt[bt.ERR_ROOM_USER_FULL=-2111]="ERR_ROOM_USER_FULL",bt[bt.ERR_USER_NOT_EXIST=-2200]="ERR_USER_NOT_EXIST",bt[bt.ERR_USER_NOT_ENTERED=-2201]="ERR_USER_NOT_ENTERED",bt[bt.ERR_NEED_OWNER_PERMISSION=-2300]="ERR_NEED_OWNER_PERMISSION",bt[bt.ERR_NEED_ADMIN_PERMISSION=-2301]="ERR_NEED_ADMIN_PERMISSION",bt[bt.ERR_REQUEST_NO_PERMISSION=-2310]="ERR_REQUEST_NO_PERMISSION",bt[bt.ERR_REQUEST_ID_INVALID=-2311]="ERR_REQUEST_ID_INVALID",bt[bt.ERR_REQUEST_ID_REPEAT=-2312]="ERR_REQUEST_ID_REPEAT",bt[bt.ERR_REQUEST_ID_CONFLICT=-2313]="ERR_REQUEST_ID_CONFLICT",bt[bt.ERR_MAX_SEAT_COUNT_LIMIT=-2340]="ERR_MAX_SEAT_COUNT_LIMIT",bt[bt.ERR_ALREADY_IN_SEAT=-2341]="ERR_ALREADY_IN_SEAT",bt[bt.ERR_SEAT_OCCUPIED=-2342]="ERR_SEAT_OCCUPIED",bt[bt.ERR_SEAT_LOCKED=-2343]="ERR_SEAT_LOCKED",bt[bt.ERR_SEAT_INDEX_NOT_EXIST=-2344]="ERR_SEAT_INDEX_NOT_EXIST",bt[bt.ERR_USER_NOT_IN_SEAT=-2345]="ERR_USER_NOT_IN_SEAT",bt[bt.ERR_ALL_SEAT_OCCUPIED=-2346]="ERR_ALL_SEAT_OCCUPIED",bt[bt.ERR_SEAT_NOT_SUPPORT_LINK_MIC=-2347]="ERR_SEAT_NOT_SUPPORT_LINK_MIC",bt[bt.ERR_OPEN_MICROPHONE_NEED_SEAT_UNLOCK=-2360]="ERR_OPEN_MICROPHONE_NEED_SEAT_UNLOCK",bt[bt.ERR_OPEN_MICROPHONE_NEED_PERMISSION_FROM_ADMIN=-2361]="ERR_OPEN_MICROPHONE_NEED_PERMISSION_FROM_ADMIN",bt[bt.ERR_OPEN_CAMERA_NEED_SEAT_UNLOCK=-2370]="ERR_OPEN_CAMERA_NEED_SEAT_UNLOCK",bt[bt.ERR_OPEN_CAMERA_NEED_PERMISSION_FROM_ADMIN=-2371]="ERR_OPEN_CAMERA_NEED_PERMISSION_FROM_ADMIN",bt[bt.ERR_OPEN_SCREEN_SHARE_NEED_SEAT_UNLOCK=-2372]="ERR_OPEN_SCREEN_SHARE_NEED_SEAT_UNLOCK",bt[bt.ERR_OPEN_SCREEN_SHARE_NEED_PERMISSION_FROM_ADMIN=-2373]="ERR_OPEN_SCREEN_SHARE_NEED_PERMISSION_FROM_ADMIN",bt[bt.ERR_SEND_MESSAGE_DISABLED_FOR_ALL=-2380]="ERR_SEND_MESSAGE_DISABLED_FOR_ALL",bt[bt.ERR_SEND_MESSAGE_DISABLED_FOR_CURRENT=-2381]="ERR_SEND_MESSAGE_DISABLED_FOR_CURRENT",function(e){e[e.kRoomOwner=0]="kRoomOwner",e[e.kAdministrator=1]="kAdministrator",e[e.kGeneralUser=2]="kGeneralUser"}(rt||(rt={})),function(e){e[e.kVideoQuality_360p=1]="kVideoQuality_360p",e[e.kVideoQuality_540p=2]="kVideoQuality_540p",e[e.kVideoQuality_720p=3]="kVideoQuality_720p",e[e.kVideoQuality_1080p=4]="kVideoQuality_1080p"}(ct||(ct={})),function(e){e[e.kAudioProfileSpeech=0]="kAudioProfileSpeech",e[e.kAudioProfileDefault=1]="kAudioProfileDefault",e[e.kAudioProfileMusic=2]="kAudioProfileMusic"}(ut||(ut={})),function(e){e[e.kCameraStream=0]="kCameraStream",e[e.kScreenStream=1]="kScreenStream",e[e.kCameraStreamLow=2]="kCameraStreamLow"}(lt||(lt={})),function(e){e[e.kQualityUnknown=0]="kQualityUnknown",e[e.kQualityExcellent=1]="kQualityExcellent",e[e.kQualityGood=2]="kQualityGood",e[e.kQualityPoor=3]="kQualityPoor",e[e.kQualityBad=4]="kQualityBad",e[e.kQualityVeryBad=5]="kQualityVeryBad",e[e.kQualityDown=6]="kQualityDown"}(dt||(dt={})),function(e){e[e.kConference=1]="kConference",e[e.kLive=2]="kLive"}(pt||(pt={})),function(e){e[e.kFreeToTake=1]="kFreeToTake",e[e.kApplyToTake=2]="kApplyToTake"}(ht||(ht={})),function(e){e[e.kMicrophone=1]="kMicrophone",e[e.kCamera=2]="kCamera",e[e.kScreen=3]="kScreen"}(gt||(gt={})),function(e){e[e.kWindow=0]="kWindow",e[e.kScreen=1]="kScreen"}(_t||(_t={})),function(e){e[e.kChangedBySelf=0]="kChangedBySelf",e[e.kChangedByAdmin=1]="kChangedByAdmin"}(ft||(ft={})),function(e){e[e.kKickedByAdmin=0]="kKickedByAdmin",e[e.kKickedByLoggedOnOtherDevice=1]="kKickedByLoggedOnOtherDevice",e[e.kKickedByServer=2]="kKickedByServer"}(mt||(mt={})),function(e){e[e.kInvalidAction=0]="kInvalidAction",e[e.kRequestToOpenRemoteCamera=1]="kRequestToOpenRemoteCamera",e[e.kRequestToOpenRemoteMicrophone=2]="kRequestToOpenRemoteMicrophone",e[e.kRequestToConnectOtherRoom=3]="kRequestToConnectOtherRoom",e[e.kRequestToTakeSeat=4]="kRequestToTakeSeat",e[e.kRequestRemoteUserOnSeat=5]="kRequestRemoteUserOnSeat",e[e.kApplyToAdminToOpenLocalCamera=6]="kApplyToAdminToOpenLocalCamera",e[e.kApplyToAdminToOpenLocalMicrophone=7]="kApplyToAdminToOpenLocalMicrophone",e[e.kApplyToAdminToOpenLocalScreenShare=8]="kApplyToAdminToOpenLocalScreenShare"}(vt||(vt={})),function(e){e[e.kRequestAccepted=0]="kRequestAccepted",e[e.kRequestRejected=1]="kRequestRejected",e[e.kRequestCancelled=2]="kRequestCancelled",e[e.kRequestTimeout=3]="kRequestTimeout",e[e.kRequestError=4]="kRequestError",e[e.kRequestId=5]="kRequestId"}(yt||(yt={})),function(e){e[e.kAnchor=0]="kAnchor",e[e.kAudience=1]="kAudience"}(It||(It={})),function(e){e[e.kResolutionMode_Landscape=0]="kResolutionMode_Landscape",e[e.kResolutionMode_Portrait=1]="kResolutionMode_Portrait"}(Mt||(Mt={})),function(e){e[e.kMediaDeviceTypeUnknown=-1]="kMediaDeviceTypeUnknown",e[e.kMediaDeviceTypeAudioInput=0]="kMediaDeviceTypeAudioInput",e[e.kMediaDeviceTypeAudioOutput=1]="kMediaDeviceTypeAudioOutput",e[e.kMediaDeviceTypeVideoCamera=2]="kMediaDeviceTypeVideoCamera"}(Ct||(Ct={})),function(e){e[e.kMediaDeviceStateAdd=0]="kMediaDeviceStateAdd",e[e.kMediaDeviceStateRemove=1]="kMediaDeviceStateRemove",e[e.kMediaDeviceStateActive=2]="kMediaDeviceStateActive"}(Tt||(Tt={})),function(e){e[e.kAudioRouteSpeakerphone=0]="kAudioRouteSpeakerphone",e[e.kAudioRouteEarpiece=1]="kAudioRouteEarpiece"}(Et||(Et={})),function(e){e[e.kConferenceStatusNone=0]="kConferenceStatusNone",e[e.kConferenceStatusNotStarted=1]="kConferenceStatusNotStarted",e[e.kConferenceStatusRunning=2]="kConferenceStatusRunning"}(St||(St={})),function(e){e[e.kConferenceCancelReasonCancelledByAdmin=0]="kConferenceCancelReasonCancelledByAdmin",e[e.kConferenceCancelReasonRemovedFromAttendees=1]="kConferenceCancelReasonRemovedFromAttendees"}(Dt||(Dt={})),function(e){e[e.kNone=0]="kNone",e[e.kPending=1]="kPending",e[e.kTimeout=2]="kTimeout",e[e.kAccepted=3]="kAccepted",e[e.kRejected=4]="kRejected"}(kt||(kt={})),function(e){e[e.kSuccess=0]="kSuccess",e[e.kAlreadyInInvitationList=1]="kAlreadyInInvitationList",e[e.kAlreadyInConference=2]="kAlreadyInConference"}(Rt||(Rt={})),function(e){e[e.kRejectToEnter=0]="kRejectToEnter",e[e.kInOtherConference=1]="kInOtherConference"}(Lt||(Lt={})),function(e){e.onError="onError",e.onKickedOutOfRoom="onKickedOutOfRoom",e.onKickedOffLine="onKickedOffLine",e.onUserSigExpired="onUserSigExpired",e.onRoomDismissed="onRoomDismissed",e.onRoomNameChanged="onRoomNameChanged",e.onRoomSeatModeChanged="onRoomSeatModeChanged",e.onAllUserCameraDisableChanged="onAllUserCameraDisableChanged",e.onAllUserMicrophoneDisableChanged="onAllUserMicrophoneDisableChanged",e.onScreenShareForAllUserDisableChanged="onScreenShareForAllUserDisableChanged",e.onSendMessageForAllUserDisableChanged="onSendMessageForAllUserDisableChanged",e.onRoomMaxSeatCountChanged="onRoomMaxSeatCountChanged",e.onRemoteUserEnterRoom="onRemoteUserEnterRoom",e.onRemoteUserLeaveRoom="onRemoteUserLeaveRoom",e.onUserInfoChanged="onUserInfoChanged",e.onUserRoleChanged="onUserRoleChanged",e.onUserVideoStateChanged="onUserVideoStateChanged",e.onUserAudioStateChanged="onUserAudioStateChanged",e.onSendMessageForUserDisableChanged="onSendMessageForUserDisableChanged",e.onUserVoiceVolumeChanged="onUserVoiceVolumeChanged",e.onUserNetworkQualityChanged="onUserNetworkQualityChanged",e.onSeatListChanged="onSeatListChanged",e.onKickedOffSeat="onKickedOffSeat",e.onRequestReceived="onRequestReceived",e.onRequestCancelled="onRequestCancelled",e.onRequestProcessed="onRequestProcessed",e.onReceiveTextMessage="onReceiveTextMessage",e.onReceiveCustomMessage="onReceiveCustomMessage",e.onDeviceChange="onDeviceChange",e.onUserScreenCaptureStopped="onUserScreenCaptureStopped"}(At||(At={})),function(e){e.onDeviceChanged="onDeviceChanged",e.onTestMicVolume="onTestMicVolume",e.onTestSpeakerVolume="onTestSpeakerVolume"}(Ot||(Ot={})),function(e){e.onConferenceScheduled="onConferenceScheduled",e.onConferenceWillStart="onConferenceWillStart",e.onConferenceCancelled="onConferenceCancelled",e.onConferenceInfoChanged="onConferenceInfoChanged",e.onScheduleAttendeesChanged="onScheduleAttendeesChanged",e.onConferenceStatusChanged="onConferenceStatusChanged"}(Nt||(Nt={})),function(e){e.onReceiveInvitation="onReceiveInvitation",e.onInvitationHandledByOtherDevice="onInvitationHandledByOtherDevice",e.onInvitationCancelled="onInvitationCancelled",e.onInvitationAccepted="onInvitationAccepted",e.onInvitationRejected="onInvitationRejected",e.onInvitationTimeout="onInvitationTimeout",e.onInvitationRevokedByAdmin="onInvitationRevokedByAdmin",e.onInvitationAdded="onInvitationAdded",e.onInvitationRemoved="onInvitationRemoved",e.onInvitationStatusChanged="onInvitationStatusChanged"}(Pt||(Pt={}));const Ft=e=>"function"==typeof e,xt=e=>void 0===e,Vt=e=>"string"==typeof e,qt=e=>"number"==typeof e;function Bt(e){return Reflect.apply(Object.prototype.toString,e,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}const Ht=function(e){if(!e||"object"!=typeof e||"[object Object]"!=Object.prototype.toString.call(e))return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;const n=Object.prototype.hasOwnProperty.call(t,"constructor")&&t.constructor;return"function"==typeof n&&n instanceof n&&Function.prototype.toString.call(n)===Function.prototype.toString.call(Object)};function jt(e){if("string"!=typeof e)return e;let t;try{const n=JSON.parse(e);t="object"==typeof n&&n?n:e}catch(n){t=e}return t}let Kt=class extends Error{constructor(e){const{code:t,message:n,name:o}=e;super(n),this.code=t,this.message=n,this.name=o||""}};const Yt="INVALID_PARAMETER_TYPE",zt="INVALID_PARAMETER_INSTANCE",Wt={INVALID_PARAMETER_REQUIRED:e=>{const{key:t,rule:n,fnName:o,value:i}=e;return`'${t||n.name}' is a required param when calling ${o}(), received: ${i}.`},INVALID_PARAMETER_TYPE:e=>{const{key:t,rule:n,fnName:o,value:i}=e,s=`${t||n.name}`;let a="";return a=Array.isArray(n.type)?n.type.join("|"):n.type,`'${s}' must be type of ${a} when calling ${o}(), received type: ${Bt(i)}.`},INVALID_PARAMETER_EMPTY:e=>{const{key:t,rule:n,fnName:o,value:i}=e;return`'${t||n.name}' cannot be '${i}' when calling ${o}().`},INVALID_PARAMETER_INSTANCE:e=>{const{key:t,rule:n,fnName:o,value:i}=e;return`'${t||n.name}' must be instanceof ${n.instanceOf.name||n.instanceOf} when calling ${o}(), received type: ${Bt(i)}.`},INVALID_PARAMETER_RANGE:e=>{const{key:t,rule:n,fnName:o,value:i}=e;return`'${t||n.name}' must be one of ${n.values.join("|")} when calling ${o}(), received: ${i}.`},CANNOT_LESS_THAN_ZERO:e=>{const{key:t,rule:n,fnName:o,value:i}=e;return`'${t||n.name}' cannot be less than 0 when calling ${o}().`},xxx:"lajfl "};function Jt(e){const{key:t,data:n}=e;return Wt[t]?Ft(Wt[t])?Wt[t](n):Vt(Wt[t])?Wt[t]:"":""}function $t(...e){return function(t,n,o){const i=o.value;return o.value=function(...t){return Zt.call(this,e,t,n,this.className),i.apply(this,t)},o}}function Xt(...e){return function(t,n,o){const i=o.value;return o.value=function(...t){return wt(this,void 0,void 0,(function*(){return Zt.call(this,e,t,n,this.className),i.apply(this,t)}))},o}}function Zt(e,t,n,o){try{for(let i=0;i<e.length;i++)Qt.call(this,{rule:e[i],value:t[i],key:e[i].name,fnName:n,className:o})}catch(i){throw _("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",i,i.code,i.message),i}}function Qt(e){const{rule:t,value:n,key:o,fnName:i,className:s}=e;if(xt(n)){if(t.required)throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:"INVALID_PARAMETER_REQUIRED",data:{key:o,rule:t,fnName:i,value:n}})});return}if(Array.isArray(t.type)){if(!t.type.map((e=>e.toLowerCase())).includes(Bt(n)))throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:Yt,data:{key:o,rule:t,fnName:i,value:n}})})}else if(!xt(t.type)&&Bt(n)!==t.type)throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:Yt,data:{key:o,rule:t,fnName:i,value:n}})});if(!1===t.allowEmpty){const e=qt(n)&&(0===n||Number.isNaN(n)),s=Vt(n)&&""===n.trim();if(e||s)throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:"INVALID_PARAMETER_EMPTY",data:{key:o,rule:t,fnName:i,value:n}})})}if(t.notLessThanZero&&qt(n)&&n<0)throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:"CANNOT_LESS_THAN_ZERO",data:{key:o,rule:t,fnName:i,value:n}})});if(Vt(t.instanceOf)){if(!n||n.name_!==t.instanceOf)throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:zt,data:{key:o,rule:t,fnName:i,value:n}})})}else if(Ft(t.instanceOf)&&!(n instanceof t.instanceOf))throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:zt,data:{key:o,rule:t,fnName:i,value:n}})});if(t.values&&!t.values.includes(n))throw new Kt({code:at.ERR_INVALID_PARAMETER,message:Jt({key:"INVALID_PARAMETER_RANGE",data:{key:o,rule:t,fnName:i,value:n}})});const{properties:a}=t;Ht(a)&&"object"===Bt(n)&&Object.keys(a).forEach((e=>{Qt.call(this,{rule:a[e],value:n&&n[e],key:`${o}.${e}`,fnName:i,className:s})}));const{arrayItem:r}=t;Ht(r)&&"array"===Bt(n)&&n.forEach(((e,t)=>{Qt.call(this,{rule:r,value:e,key:`${o}[${t}]`,fnName:i,className:s})})),Ft(t.validate)&&t.validate.call(this,n,o,i,s,this)}const en=new WeakMap;function tn(){return function(e,t,n){const o=n.value,i=e=>{const{fn:t,args:n,context:o,resolve:s,reject:a}=e;t.apply(o,n).then(s,a).finally((()=>{const e=en.get(o);e&&(e.shift(),e[0]&&i(Object.assign({},e[0])))}))};return n.value=function(...e){return new Promise(((n,s)=>{if(en.has(this)){const a=en.get(this),{length:r}=a;a.push({fn:o,args:e,context:this,resolve:n,reject:s,name:t}),0===r&&i({fn:o,args:e,context:this,resolve:n,reject:s})}else en.set(this,[{fn:o,args:e,context:this,resolve:n,reject:s,name:t}]),i({fn:o,args:e,context:this,resolve:n,reject:s})}))},n}}const nn="string",on="number",sn="boolean",an="array",rn="object",cn="uniapp",un={login:{name:"options",required:!0,type:rn,properties:{sdkAppId:{required:!0,type:on,allowEmpty:!1},userId:{required:!0,type:nn,allowEmpty:!1},userSig:{required:!0,type:nn,allowEmpty:!1}}},setSelfInfo:{name:"options",required:!0,type:rn,properties:{userName:{required:!0,type:nn},avatarUrl:{required:!0,type:nn},customInfo:{required:!1,type:rn,allowEmpty:!1}}},createRoom:{name:"options",required:!0,type:rn,properties:{roomId:{required:!0,type:nn,allowEmpty:!1},roomName:{type:nn,allowEmpty:!1},roomType:{instanceof:pt},isMicrophoneDisableForAllUser:{type:sn},isScreenShareDisableForAllUser:{type:sn},isCameraDisableForAllUser:{type:sn},isMessageDisableForAllUser:{type:sn},maxSeatCount:{type:on},password:{type:nn}}},enterRoom:{name:"options",required:!0,type:rn,properties:{roomId:{required:!0,type:nn,allowEmpty:!1},roomType:{instanceof:pt},options:{type:rn,properties:{password:{type:nn}}}}},updateRoomNameByAdmin:{name:"options",require:!0,type:rn,properties:{roomName:{require:!0,type:nn,allowEmpty:!1}}},setRoomMaxSeatCount:{name:"options",require:!0,type:rn,properties:{maxSeatCount:{require:!0,type:on}}},getUserList:{name:"options",required:!1,type:rn,properties:{nextSequence:{type:nn}}},getUserInfo:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1}}},setCustomInfoForUser:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},customInfo:{required:!0,type:rn,allowEmpty:!1}}},takeSeat:{name:"options",required:!0,type:rn,properties:{seatIndex:{required:!0,type:on},timeout:{required:!0,type:on},requestCallback:{instanceof:Function}}},getSeatList:{},openRemoteDeviceByAdmin:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},timeout:{required:!0,type:on},device:{require:!0,instanceof:gt}}},closeRemoteDeviceByAdmin:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},device:{required:!0,instanceof:gt}}},takeUserOnSeatByAdmin:{name:"options",required:!0,type:rn,properties:{seatIndex:{required:!0,type:on},userId:{required:!0,type:nn,allowEmpty:!1},timeout:{required:!0,type:on},requestCallback:{instanceof:Function}}},kickUserOffSeatByAdmin:{name:"options",required:!0,type:rn,properties:{seatIndex:{required:!0,type:on},userId:{required:!0,type:nn,allowEmpty:!1}}},cancelRequest:{name:"options",required:!0,type:rn,properties:{requestId:{required:!0,type:nn,allowEmpty:!1}}},responseRemoteRequest:{name:"options",required:!0,type:rn,properties:{requestId:{required:!0,type:nn,allowEmpty:!1},agree:{required:!0,type:sn}}},setLocalVideoView:{name:"options",required:!1,type:rn,properties:{view:{required:!1,type:[nn,an,"null"],allowEmpty:!1,validate:e=>{if(e instanceof Array&&e.some((e=>null===e)))throw new Kt({code:at.ERR_INVALID_PARAMETER,message:"When calling the setLocalVideoView interface with the view parameter as an array, the array content cannot contain null."})}}}},openLocalCamera:{name:"options",type:rn,properties:{isFrontCamera:{type:sn,allowEmpty:!1}}},closeLocalCamera:{},openLocalMicrophone:{},closeLocalMicrophone:{},setVideoResolutionMode:{name:"options",required:!0,type:rn,properties:{streamType:{required:!0,instanceof:lt},resolutionMode:{required:!0,instanceof:Mt}}},updateVideoQuality:{name:"options",required:!0,type:rn,properties:{quality:{required:!0,instanceof:ct}}},updateVideoQualityEx:{name:"options",required:!0,type:rn,properties:{streamType:{required:!0,instanceof:lt},encoderParams:{required:!0,properties:{quality:{instanceof:ct},fps:{type:on},bitrate:{type:on},resolutionMode:{instanceof:Mt}}}}},updateAudioQuality:{name:"options",required:!0,type:rn,properties:{quality:{required:!0,instanceof:ut}}},muteRemoteAudioStream:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},isMute:{required:!0,type:sn}}},startPushLocalVideo:{},stopPushLocalVideo:{},startPushLocalAudio:{},stopPushLocalAudio:{},setRemoteVideoView:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},streamType:{required:!0,instanceof:lt},view:{required:!0,type:[nn,an],allowEmpty:!1}}},startPlayRemoteVideo:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},streamType:{required:!0,instanceof:lt}}},stopPlayRemoteVideo:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},streamType:{required:!0,instanceof:lt}}},changeUserRole:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},userRole:{required:!0,instanceof:rt}}},changeUserNameCard:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1},nameCard:{required:!0,type:nn}}},kickRemoteUserOutOfRoom:{name:"options",required:!0,type:rn,properties:{userId:{required:!0,type:nn,allowEmpty:!1}}},sendTextMessage:{name:"options",required:!0,type:rn,properties:{messageText:{require:!0,type:nn,allowEmpty:!1}}},sendCustomMessage:{name:"options",required:!0,type:rn,properties:{messageText:{require:!0,type:nn,allowEmpty:!1}}},startScreenSharing:{name:"options",type:rn,properties:{screenAudio:{type:sn},view:{type:nn}}},stopScreenSharing:{},startScreenSharingElectron:{name:"options",required:!0,type:[rn,"string"],properties:{targetId:{require:!0,type:nn},view:{type:nn}}},selectScreenSharingTarget:{name:"options",required:!0,type:[rn,"string"],properties:{targetId:{require:!0,type:nn}}},setCurrentCameraDevice:{name:"options",required:!0,type:rn,properties:{deviceId:{require:!0,type:nn}}},setCurrentMicDevice:{name:"options",required:!0,type:rn,properties:{deviceId:{require:!0,type:nn}}},setCurrentSpeakerDevice:{name:"options",required:!0,type:rn,properties:{deviceId:{require:!0,type:nn}}},disableDeviceForAllUserByAdmin:{name:"options",required:!0,type:rn,properties:{isDisable:{require:!0,type:sn},device:{require:!0,instanceof:gt}}},disableSendingMessageForAllUser:{name:"options",required:!0,type:rn,properties:{isDisable:{require:!0,type:sn}}},disableSendingMessageByAdmin:{name:"options",required:!0,type:rn,properties:{userId:{require:!0,instanceof:nn},isDisable:{require:!0,type:sn}}},updateRoomSeatModeByAdmin:{name:"options",required:!0,type:rn,properties:{seatMode:{require:!0,instanceof:ht}}},updateRoomPasswordByAdmin:{name:"options",required:!0,type:rn,properties:{password:{required:!0,type:nn,allowEmpty:!1}}},applyToAdminToOpenLocalDevice:{name:"options",required:!0,type:rn,properties:{timeout:{required:!0,type:on},device:{require:!0,instanceof:gt}}},setMaxSeatCount:{name:"options",required:!0,type:rn,properties:{maxSeatCount:{require:!0,type:on}}},lockSeatByAdmin:{name:"options",required:!0,type:rn,properties:{seatIndex:{required:!0,type:on},lockParams:{require:!0,type:rn,properties:{lockSeat:{require:!0,type:sn},lockVideo:{require:!0,type:sn},lockAudio:{require:!0,type:sn}}}}}};plus.os.name;var ln=function(e){return new Promise(((t,n)=>{plus.android.requestPermissions([e],(e=>{let n=0;for(let t=0;t<e.granted.length;t++){_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`已获取的权限：${e.granted[t]}`),n=1}for(let t=0;t<e.deniedPresent.length;t++){_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`拒绝本次申请的权限：${e.deniedPresent[t]}`),n=0}for(let t=0;t<e.deniedAlways.length;t++){_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`永久拒绝申请的权限：${e.deniedAlways[t]}`),n=-1}t(n)}),(e=>{_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`申请权限错误：${e.code} = ${e.message}`),t({code:e.code,message:e.message})}))}))},dn="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},pn={};!function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,o,s,a){if("function"!=typeof o)throw new TypeError("The listener must be a function");var r=new i(o,s||e,a),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],r]:e._events[c].push(r):(e._events[c]=r,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function r(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),r.prototype.eventNames=function(){var e,o,i=[];if(0===this._eventsCount)return i;for(o in e=this._events)t.call(e,o)&&i.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},r.prototype.listeners=function(e){var t=n?n+e:e,o=this._events[t];if(!o)return[];if(o.fn)return[o.fn];for(var i=0,s=o.length,a=new Array(s);i<s;i++)a[i]=o[i].fn;return a},r.prototype.listenerCount=function(e){var t=n?n+e:e,o=this._events[t];return o?o.fn?1:o.length:0},r.prototype.emit=function(e,t,o,i,s,a){var r=n?n+e:e;if(!this._events[r])return!1;var c,u,l=this._events[r],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,o),!0;case 4:return l.fn.call(l.context,t,o,i),!0;case 5:return l.fn.call(l.context,t,o,i,s),!0;case 6:return l.fn.call(l.context,t,o,i,s,a),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var p,h=l.length;for(u=0;u<h;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,o);break;case 4:l[u].fn.call(l[u].context,t,o,i);break;default:if(!c)for(p=1,c=new Array(d-1);p<d;p++)c[p-1]=arguments[p];l[u].fn.apply(l[u].context,c)}}return!0},r.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},r.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},r.prototype.removeListener=function(e,t,o,i){var s=n?n+e:e;if(!this._events[s])return this;if(!t)return a(this,s),this;var r=this._events[s];if(r.fn)r.fn!==t||i&&!r.once||o&&r.context!==o||a(this,s);else{for(var c=0,u=[],l=r.length;c<l;c++)(r[c].fn!==t||i&&!r[c].once||o&&r[c].context!==o)&&u.push(r[c]);u.length?this._events[s]=1===u.length?u[0]:u:a(this,s)}return this},r.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&a(this,t)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,r.EventEmitter=r,e.exports=r}({get exports(){return pn},set exports(e){pn=e}});var hn=pn;let gn=class e{constructor(e){const{Module:t,logger:n}=e;this.deviceManager||(this.logger=n,this.deviceManager=t)}static getInstance(t){return e.instance||(e.instance=new e(t)),e.instance}JSCallNativeFunctionSync(e,t){return this.deviceManager[e](t)}switchCamera(e){return wt(this,void 0,void 0,(function*(){this.logger.info("deviceManager.switchCamera with options: ",e);const{isFrontCamera:t}=e,n={frontCamera:t};yield this.JSCallNativeFunctionSync("switchCamera",n)}))}},_n=class e{constructor(e){const{Module:t,logger:n}=e;this.trtcCloud||(this.logger=n,this.trtcCloud=t)}static getInstance(t){return e.instance||(e.instance=new e(t)),e.instance}JSCallNativeFunctionSync(e,t){return this.trtcCloud[e](t)}setLocalRenderParams(e){return wt(this,void 0,void 0,(function*(){this.logger.info("deviceManager.setLocalRenderParams with options: ",e),yield this.JSCallNativeFunctionSync("setLocalRenderParams",e)}))}};var fn={};({get exports(){return fn},set exports(e){fn=e}}).exports=function(){function e(e,t){var n,o=Object.keys(e);return Object.getOwnPropertySymbols&&(n=Object.getOwnPropertySymbols(e),t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)),o}function t(t){for(var n=1;n<arguments.length;n++){var o=null!=arguments[n]?arguments[n]:{};n%2?e(Object(o),!0).forEach((function(e){a(t,e,o[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(o)):e(Object(o)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(o,e))}))}return t}function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function s(e,t,n){return t&&i(e.prototype,t),n&&i(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&u(e,t)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function u(e,t){return(u=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}function d(e,t,n){return(d=l()?Reflect.construct:function(e,t,n){var o=[null];return o.push.apply(o,t),t=new(Function.bind.apply(e,o)),n&&u(t,n.prototype),t}).apply(null,arguments)}function p(e,t){if(null==e)return{};var n,o=function(e,t){if(null==e)return{};for(var n,o={},i=Object.keys(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols)for(var i=Object.getOwnPropertySymbols(e),s=0;s<i.length;s++)n=i[s],0<=t.indexOf(n)||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n]);return o}function h(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function g(e){var t=l();return function(){var n,o=c(e);if(n=t?(n=c(this).constructor,Reflect.construct(o,arguments,n)):o.apply(this,arguments),o=this,n&&("object"==typeof n||"function"==typeof n))return n;if(void 0!==n)throw new TypeError("Derived constructors may only return object or undefined");return h(o)}}function f(e,t){return v(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,i,s=[],a=!0,r=!1;try{for(n=n.call(e);!(a=(o=n.next()).done)&&(s.push(o.value),!t||s.length!==t);a=!0);}catch(c){r=!0,i=c}finally{try{a||null==n.return||n.return()}finally{if(r)throw i}}return s}}(e,t)||I(e,t)||C()}function m(e){return function(e){if(Array.isArray(e))return M(e)}(e)||y(e)||I(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function v(e){if(Array.isArray(e))return e}function y(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function I(e,t){if(e){if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Map"===(n="Object"===n&&e.constructor?e.constructor.name:n)||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?M(e,t):void 0}}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}function C(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function T(e,t){var n,o="undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(!o){if(Array.isArray(e)||(o=I(e))||t&&e&&"number"==typeof e.length)return o&&(e=o),n=0,{s:t=function(){},n:function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}},e:function(e){throw e},f:t};throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var i,s=!0,a=!1;return{s:function(){o=o.call(e)},n:function(){var e=o.next();return s=e.done,e},e:function(e){a=!0,i=e},f:function(){try{s||null==o.return||o.return()}finally{if(a)throw i}}}}var E={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",ALL_RECEIVE_MESSAGE_OPT_UPDATED:"onAllReceiveMessageOptUpdated"},S={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_LIVE:"Live",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_MSG_EXCEPT_AT:"NotReceiveMsgExceptAt",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3,IOS_OFFLINE_PUSH_NO_SOUND:"push.no_sound",IOS_OFFLINE_PUSH_DEFAULT_SOUND:"default"},D={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},k=(s(V,[{key:"use",value:function(e){if("function"!=typeof e)throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}]),V),R=(s(x,[{key:"equal",value:function(e){return null!==e&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),t=Number(this.low).toString(16);if(t.length<8)for(var n=8-t.length;n;)t="0"+t,n--;return e+t}}]),x),L={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT0:"wss://*w4s.my-imcloud.com",DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT0:"wss://*w4k.my-imcloud.com",DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT0:"wss://*w4g.my-imcloud.com",DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT0:"wss://*w4i.my-imcloud.com",DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.18.188"},JPN:{DEFAULT0:"wss://*w4j.my-imcloud.com",DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT0:"wss://*w4u.my-imcloud.com",DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT0:"wss://*w4y.my-imcloud.com",DEFAULT:"wss://wssidn.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},A={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19,NS_NATIVE_APP:20,RN_NATIVE_APP:21},O="1.7.3",N=537048168,P="CHINA",b={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=L.PRODUCTION[0<arguments.length&&void 0!==arguments[0]?arguments[0]:P]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},U={SEARCH_GRP_SNS:new R(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new R(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new R(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new R(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new R(0,Math.pow(2,6)).toString(),USER_STATUS:new R(0,Math.pow(2,7)).toString(),CONV_MARK:new R(0,Math.pow(2,9)).toString(),CONV_GROUP:new R(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new R(0,Math.pow(2,11)).toString(),MSG_EXT:new R(0,Math.pow(2,13)).toString(),GRP_COUNTER:new R(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new R(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new R(Math.pow(2,7)).toString(),PLUGIN_CS:new R(Math.pow(2,8)).toString(),PLUGIN_PUSH:new R(Math.pow(2,9)).toString(),PLUGIN_BOT:new R(Math.pow(2,10)).toString(),MSG_REACTION:new R(Math.pow(2,16)).toString(),FOLLOW:new R(Math.pow(2,20)).toString()},G="group_profile",w=["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],F=["Role","JoinTime","MsgSeq","MsgFlag"];function x(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0;o(this,x),this.high=e,this.low=t}function V(){o(this,V),this.cache=[],this.options=null}b.HOST.setCurrent(P);for(var q,B="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),H=B&&"function"==typeof wx.createGamePortal,j="undefined"!=typeof qq&&"function"==typeof qq.getSystemInfoSync&&Boolean(qq.getSystemInfoSync().fontSizeSetting),K="undefined"!=typeof tt&&"function"==typeof tt.getSystemInfoSync&&Boolean(tt.getSystemInfoSync().fontSizeSetting),Y="undefined"!=typeof swan&&"function"==typeof swan.getSystemInfoSync&&Boolean(swan.getSystemInfoSync().fontSizeSetting),z="undefined"!=typeof my&&"function"==typeof my.getSystemInfoSync&&Boolean(my.getSystemInfoSync().fontSizeSetting),W="undefined"!=typeof jd&&"function"==typeof jd.getSystemInfoSync,J="undefined"!=typeof uni&&"undefined"==typeof window&&!0,$=B&&"object"===n(wx.miniapp),X="undefined"!=typeof uni,Z=B||j||K||Y||z||J||W,Q="undefined"==typeof window&&!Z&&void 0!==dn&&void 0!==dn.NativeScriptGlobals,ee=void 0!==dn&&(void 0!==dn.nativeModuleProxy||void 0!==dn.ReactNative),te="undefined"!=typeof uni?!Z:"undefined"!=typeof window&&!Z&&!ee,ne=j?qq:K?tt:Y?swan:z?my:B?wx:J?uni:W?jd:{},oe=te&&window&&window.navigator&&window.navigator.userAgent||"",ie=(W="WEB",/(micromessenger|webbrowser)/i.test(oe)?W="WEB":j?W="QQ_MP":K?W="TT_MP":Y?W="BAIDU_MP":z?W="ALI_MP":B?W=$?"DONUT_NATIVE_APP":"WX_MP":J?W="UNI_NATIVE_APP":Q?W="NS_NATIVE_APP":ee&&(W="RN_NATIVE_APP"),A[W]),se=($=/iPad/i.test(oe),Q=/iPhone/i.test(oe)&&!$,W=/iPod/i.test(oe),Q||$||W),ae=(Q=oe.match(/OS (\d+)_/i))&&Q[1]?Q[1]:null,re=/Android/i.test(oe),ce=function(){var e=oe.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var t=e[1]&&parseFloat(e[1]),n=e[2]&&parseFloat(e[2]);return t&&n?parseFloat(e[1]+"."+e[2]):t||null}(),ue=(W=!($=/Edge/i.test(oe))&&/Chrome/i.test(oe),/MSIE/.test(oe)||-1<oe.indexOf("Trident")&&-1<oe.indexOf("rv:11.0")),le=Q=!(Q=(Q=/MSIE\s(\d+)\.\d/.exec(oe))&&parseFloat(Q[1]))&&/Trident\/7.0/i.test(oe)&&/rv:11.0/.test(oe)?11:Q,de=/Safari/i.test(oe)&&!W&&!re&&!$,pe=/Windows/i.test(oe),he=/MAC OS X/i.test(oe),ge=te&&"undefined"!=typeof Worker&&!ue,_e=re||se,fe=te&&void 0!==window.tencent_cloud_im_csig_flutter_for_web_25F_cy,me=function(){if("undefined"==typeof window||void 0===window.navigator)return!1;var e=window.navigator.standalone;return!(!se||e||de)}(),ve="undefined"!=typeof console?console:void 0!==dn&&dn.console?dn.console:"undefined"!=typeof window&&window.console?window.console:{},ye=function(){},Ie=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],Me=Ie.length;Me--;)q=Ie[Me],console[q]||(ve[q]=ye);function Ce(){var e=new Date;return e.setTime(ke()),e}function Te(){De=0}function Ee(){return Math.floor(ke()/1e3)}var Se=ve,De=0,ke=function(){return(new Date).getTime()+De},Re=0;function Le(){return Vt()?"%c Chat %c":"Chat"}function Ae(){var e=Ce();return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(e){var t;switch(e.toString().length){case 1:t="00"+e;break;case 2:t="0"+e;break;default:t=e}return t}(e.getMilliseconds())}var Oe={arguments2String:function(e){var t="";if(1===e.length)t=e[0];else for(var n=0,o=e.length;n<o;n++){if(lt(e[n]))try{t+=dt(e[n])?JSON.stringify(e[n],["message","code"]):JSON.stringify(e[n])}catch(i){t+=i?i.message:"";break}else t+=e[n];t+=" "}return t},_exec:function(e,t){Vt()?Se[e](Le(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",Ae(),t):Se[e]("".concat(Le()," ").concat(Ae()," ").concat(t))},d:function(){var e;Re<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;Re<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;Re<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;Re<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;Re<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;Re<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+Re+" to "+e),Re=e},getLevel:function(){return Re}},Ne={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Pe={NICK:"".concat(Q="Tag_Profile_IM_","Nick"),GENDER:"".concat(Q,"Gender"),BIRTHDAY:"".concat(Q,"BirthDay"),LOCATION:"".concat(Q,"Location"),SELFSIGNATURE:"".concat(Q,"SelfSignature"),ALLOWTYPE:"".concat(Q,"AllowType"),LANGUAGE:"".concat(Q,"Language"),AVATAR:"".concat(Q,"Image"),MESSAGESETTINGS:"".concat(Q,"MsgSettings"),ADMINFORBIDTYPE:"".concat(Q,"AdminForbidType"),LEVEL:"".concat(Q,"Level"),ROLE:"".concat(Q,"Role")},be={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},Ue={UNKNOWN:"".concat(W="Gender_Type_","Unknown"),FEMALE:"".concat(W,"Female"),MALE:"".concat(W,"Male")},Ge={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},we={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},Fe="JoinedSuccess",xe="WaitAdminApproval",Ve="@TOPIC#_",qe=Object.prototype.hasOwnProperty;function Be(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(ze(e)){for(var t in e)if(qe.call(e,t))return!1;return!0}return!!(He(e)||function(e){return"set"===pt(e)}(e)||je(e))&&0===e.size}function He(e){return"map"===pt(e)}function je(e){return"file"===pt(e)}function Ke(e){return null!==e&&("number"==typeof e&&!isNaN(+e)||"object"===n(e)&&e.constructor===Number)}function Ye(e){return null!==e&&"object"===n(e)}function ze(e){if("object"===n(e)&&null!==e){if(null===(e=Object.getPrototypeOf(e)))return 1;for(var t=e;null!==Object.getPrototypeOf(t);)t=Object.getPrototypeOf(t);return e===t}}function We(e){return"function"==typeof Array.isArray?Array.isArray(e):"array"===pt(e)}function Je(e){return"function"==typeof e}function $e(e){return"filelist"===pt(e)}function Xe(e){return"string"==typeof e&&(e=e[0],!/[^a-zA-Z0-9]/.test(e))}function Ze(e,t,n,o){if(!lt(e)||!lt(t))return 0;for(var i,s=0,a=Object.keys(t),r=0,c=a.length;r<c;r++)if(i=a[r],!(ut(t[i])||n&&n.includes(i)))if(lt(e[i])&&lt(t[i]))s+=Ze(e[i],t[i],n,o);else{if(o&&o.includes(t[i]))continue;e[i]!==t[i]&&(e[i]=t[i],s+=1)}return s}function Qe(e,t){var n,o=new Map,i=T(e.entries());try{for(i.s();!(n=i.n()).done;){var s=f(n.value,2),a=s[0],r=s[1];r&&o.set(a,t?JSON.stringify(r):JSON.parse(JSON.stringify(r)))}}catch(c){i.e(c)}finally{i.f()}return o}function et(e){if(0===e.length)return 0;for(var t=0,n=0,o="undefined"!=typeof document&&void 0!==document.characterSet?document.characterSet:"UTF-8";void 0!==e[t];)n+=e[t++].charCodeAt[t]<=255?1:!1===o?3:2;return n}function nt(e){return e=e||99999999,Math.round(Math.random()*e)}function ot(){for(var e="",t=32;0<t;--t)e+=ht[Math.floor(Math.random()*gt)];return e}function it(e,t){for(var n in e)if(e[n]===t)return 1}function st(e){return-1===e.indexOf("http://")||-1===e.indexOf("https://")?"https://"+e:e.replace(/https|http/,"https")}function at(e){if(0===Object.getOwnPropertyNames(e).length)return Object.create(null);var t,o,i=Array.isArray(e)?[]:Object.create(null);for(o in e)null!==e[o]?void 0!==e[o]?(t=n(e[o]),0<=["string","number","function","boolean"].indexOf(t)?i[o]=e[o]:i[o]=at(e[o])):i[o]=void 0:i[o]=null;return i}var rt=["url"],ct=function(e){return"string"==typeof e},ut=function(e){return void 0===e},lt=function(e){return We(e)||Ye(e)},dt=function(e){return e instanceof Error},pt=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},ht=(Date.now||(Date.now=function(){return(new Date).getTime()}),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),gt=ht.length,_t={};function ft(e,t){if(!We(e)||!We(t))return!1;var n=!1;return t.forEach((function(t){var o=t.key,i=(t=t.value,e.find((function(e){return e.key===o})));i?i.value!==t&&(i.value=t,n=!0):(e.push({key:o,value:t}),n=!0)})),n}function mt(e){return Be(e)?[]:e.filter((function(e){return!0===e.isModified}))}function vt(e){return Be(e)?[]:e.filter((function(e){return!1===e.isModified}))}function yt(e){return e===S.GRP_AVCHATROOM}function It(e){var t=e.type;return e=e.groupID,t===S.GRP_COMMUNITY||"".concat(e).startsWith("@TGS#_")&&!"".concat(e).includes(Ve)}function Mt(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(Ve)}function Ct(e){return ct(e)&&e.slice(0,3)===S.CONV_C2C}function Tt(e){return ct(e)&&e.slice(0,5)===S.CONV_GROUP}function Et(e){return ct(e)&&e===S.CONV_SYSTEM}function St(e,t){var n={};return Object.keys(e).forEach((function(o){n[o]=t(e[o],o)})),n}function Dt(e){return ee?Promise.resolve({width:0,height:0}):Z?new Promise((function(t,n){ne.getImageInfo({src:e,success:function(e){t({width:e.width,height:e.height})},fail:function(){t({width:0,height:0})}})})):ue&&9===le?Promise.resolve({width:0,height:0}):new Promise((function(t,n){var o=new Image;o.onload=function(){t({width:this.width,height:this.height}),o=null},o.onerror=function(){t({width:0,height:0}),o=null},o.src=e}))}function kt(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function Rt(){var e=re?"android":se?"ios":pe?"windows":he?"mac":"unknown";if(Z)try{var t=ne.getSystemInfoSync().platform;void 0!==t&&(e=t)}catch(n){}return e}function Lt(e,t){e=e.split("."),t=t.split(".");for(var n=Math.max(e.length,t.length);e.length<n;)e.push("0");for(;t.length<n;)t.push("0");for(var o=0;o<n;o++){var i=parseInt(e[o]),s=parseInt(t[o]);if(s<i)return 1;if(i<s)return-1}return 0}function At(e){var t=void 0===(t=e.originUrl)?void 0:t,n=e.originWidth,o=e.originHeight,i=(e=void 0===(e=e.min)?198:e,{url:void 0,width:0,height:0});return((n=parseInt(n))<=(o=parseInt(o))?n:o)<=e?(i.url=t,i.width=n,i.height=o):(o<=n?(i.width=Math.ceil(n*e/o),i.height=e):(i.width=e,i.height=Math.ceil(o*e/n)),o=t&&-1<t.indexOf("?")?"".concat(t,"&"):"".concat(t,"?"),i.url="".concat(o,198===e?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),ut(t)?(i.url,p(i,rt)):i}function Ot(e){var t=e[2];e[2]=e[1],e[1]=t;for(var n=0;n<e.length;n++)e[n].setType(n)}function Nt(e){return(e=e.servcmd).slice(e.indexOf(".")+1)}function Pt(e,t){return Math.round(Number(e)*Math.pow(10,t))/Math.pow(10,t)}function bt(e,t){return e.includes(t)}function Ut(e,t){return e.includes(t)}function Gt(e){return e.split(Ve)[0]}var wt=function(e,t,n){if(ut(t))return"";switch(e){case S.MSG_TEXT:return t.text;case S.MSG_IMAGE:return n?"[Image]":"[图片]";case S.MSG_LOCATION:return n?"[Location]":"[位置]";case S.MSG_AUDIO:return n?"[Voice]":"[语音]";case S.MSG_VIDEO:return n?"[Video]":"[视频]";case S.MSG_FILE:return n?"[File]":"[文件]";case S.MSG_CUSTOM:return n?"[Custom Messages]":"[自定义消息]";case S.MSG_GRP_TIP:return n?"[Group Notification]":"[群提示消息]";case S.MSG_GRP_SYS_NOTICE:return n?"[Group System Message]":"[群系统通知]";case S.MSG_FACE:return n?"[Animated Sticker]":"[动画表情]";case S.MSG_MERGER:return n?"[Chat Record]":"[聊天记录]";default:return""}};function Ft(e){return e===S.MSG_TEXT||e===S.MSG_CUSTOM||e===S.MSG_LOCATION||e===S.MSG_FACE}function xt(e){var t=[];if(!ct(e))return t;var n=e.length;if(0===n)return t;for(var o=n-1;0<=o;o--)"1"===e[o]&&t.push(Math.pow(2,n-o-1));return t}function Vt(){return!ue&&!Z}function qt(e){return"the length of userIDList cannot exceed ".concat(e)}function Bt(e){var t;if(We(e)&&0!==e.length)return t=0,e.forEach((function(e){t+=e})),t.toFixed(0)}function Ht(e){var t;if(We(e)&&0!==e.length)return t=0,e.forEach((function(e){t+=e})),(t/e.length).toFixed(0)}function jt(e,t,n){t=!(1<arguments.length&&void 0!==t)||t,n=!(2<arguments.length&&void 0!==n)||n;var o=Date.now();return t?n?"".concat(o-e," ms"):"".concat(Math.round((o-e)/1e3)," s"):n?o-e:Math.round((o-e)/1e3)}function Kt(e){return!!(e&&1<e)}function Yt(e,t,n,o){if(void 0===t)return 1;var i,s,a=!0;return t.required&&Be(e)&&(Oe.e("[".concat(n,'] Missing required params: "').concat(o,'".')),a=!1),Be(e)||(i=pt(e))!==(s=t.type.toLowerCase())&&("asyncfunction"===i&&"function"===s||(Oe.e("[".concat(n,'] Invalid params: type check failed for "').concat(o,'". Expected ').concat(t.type,".")),a=!1)),t.validator&&!t.validator(e,n,o)&&(Oe.e("[".concat(n,'] Invalid params: custom validator check failed for "').concat(o,'".')),a=!1),a}function zt(e){return!(!e||!(Ct(e)||Tt(e)||Et(e))&&((e=Pn("InvalidConversationID",e))&&Oe.w(e),1))}function Wt(e){""!==e.desc&&""!==Pn("API_REFER")&&Oe.w("[".concat(e.api,"] | ").concat(e.paramName," | ").concat(e.desc,", ").concat(Pn("API_REFER")).concat(e.api))}function Jt(){return Pn("StringRequiredLog")}function $t(e){return Pn("NonEmptyStringRequiredLog",e)}function Xt(){return Pn("NumberRequiredLog")}function Zt(){return Pn("UndefinedNotAllowedLog")}function Qt(){return Pn("FileRequiredLog")}function en(){return Pn("FunctionRequiredLog")}function tn(){return Pn("ArrayRequiredLog")}function nn(){return Pn("NonEmptyArrayLog")}function on(){return Pn("CallbackMissingLog")}function sn(){return Pn("PositiveIntegerRequiredLog")}function an(e,t){return Pn("StringNotLongerThanLog",e,t)}function rn(e,t){return Pn("NumberGreaterOrEqualLog",e,t)}function cn(e){return Pn("KeyValueStringRequiredLog",e)}function un(){return Pn("PlainObjectRequiredLog")}function ln(){return Pn("NonEmptyContentRequiredLog")}function pn(){return Pn("FileNotSelectedLog")}function hn(){return Pn("MessageInstanceRequiredLog")}function gn(){return Pn("NonAnonymousFunctionLog")}function _n(){return Pn("MessageExtensionNotAvailableLog")}function fn(){return Pn("MessageReactionRequiredLog")}function mn(e,t){return Pn("MaximumArrayLengthLog",e,t)}function vn(e){return{code:0,data:e||{}}}function yn(e){return Promise.resolve(vn(e))}function In(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];if(e instanceof Gn)return t&&null!==Fn&&Fn.emit(E.ERROR,e),Promise.reject(e);if(e instanceof Error)return n=new Gn({code:wn.UNCAUGHT_ERROR}),t&&null!==Fn&&Fn.emit(E.ERROR,n),Promise.reject(n);if(ut(e)||ut(e.code))return Promise.reject(new Gn({code:wn.UNCAUGHT_ERROR}));var n=new Gn(e);return t&&null!==Fn&&Fn.emit(E.ERROR,n),Promise.reject(n)}var Mn,Cn,Tn,En="unSend",Sn="success",Dn="fail",kn="notStart",Rn="pending",Ln="resolved",An="rejected",On={type:"Boolean",required:!0},Nn={type:"number",required:!0},Pn=null,bn={hookGetAPITips:function(e){Pn=e},login:{userID:$={type:"String",required:!0},userSig:$},addToBlacklist:{userIDList:Q={type:"Array",required:!0}},removeFromBlacklist:{userIDList:Q},on:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:$t(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:en()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:$t(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:en()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:$t(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:en()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],sendMessage:[t({name:"message"},W={type:"Object",required:!0})],setMessageExtensions:[t(t({name:"message"},W),{},{validator:function(e,t,n){return e.status===Sn&&!0===e.isSupportExtension||(Wt({api:t,paramName:n,desc:_n()}),!1)}}),t({name:"extensions"},Q)],getMessageExtensions:[t(t({name:"message"},W),{},{validator:function(e,t,n){return e.status===Sn&&!0===e.isSupportExtension||(Wt({api:t,paramName:n,desc:_n()}),!1)}})],deleteMessageExtensions:[t(t({name:"message"},W),{},{validator:function(e,t,n){return e.status===Sn&&!0===e.isSupportExtension||(Wt({api:t,paramName:n,desc:_n()}),!1)}})],addMessageReaction:[t(t({name:"message"},W),{},{validator:function(e,t,n){return e.status===Sn||(Wt({api:t,paramName:n,desc:fn()}),!1)}}),t({name:"reactionID"},$)],removeMessageReaction:[t(t({name:"message"},W),{},{validator:function(e,t,n){return e.status===Sn||(Wt({api:t,paramName:n,desc:fn()}),!1)}}),t({name:"reactionID"},$)],getMessageReactions:{messageList:t({},Q)},getAllUserListOfMessageReaction:{message:t(t({},W),{},{validator:function(e,t,n){return e.status===Sn||(Wt({api:t,paramName:n,desc:fn()}),!1)}}),reactionID:t({},$),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:t(t({},$),{},{validator:zt}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e,t,n){return!(!ut(e)&&!/^[1-9][0-9]*$/.test(e)&&(Wt({api:t,paramName:n,desc:sn()}),1))}}},getMessageListHopping:{conversationID:t(t({},$),{},{validator:zt}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e,t,n){return!(!ut(e)&&0!==e&&1!==e&&(Wt({api:t,paramName:n,desc:Pn("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e,t,n){return!(!ut(e)&&!/^[1-9][0-9]*$/.test(e)&&(Wt({api:t,paramName:n,desc:sn}),1))}}},setMessageRead:{conversationID:t(t({},$),{},{validator:zt})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e,t,n){return!e||-1!==[S.READ_ALL_C2C_MSG,S.READ_ALL_GROUP_MSG,S.READ_ALL_MSG].indexOf(e)||(Wt({api:t,paramName:n,desc:Pn("ValidScopeRequired")}),!1)}}},getConversationProfile:[t(t({name:"conversationID"},$),{},{validator:zt})],clearHistoryMessage:[t(t({name:"conversationID"},$),{},{validator:zt})],pinConversation:{conversationID:t(t({},$),{},{validator:zt}),isPinned:t({},On)},setConversationDraft:{conversationID:t(t({},$),{},{validator:zt}),draftText:{type:"String",validator:function(e,t,n){return!!ct(e)||(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},setConversationCustomData:{conversationIDList:t({},Q),customData:{type:"String",validator:function(e,t,n){return ct(e)?!(256<e.length&&(Wt({api:t,paramName:n,desc:an(n,256)}),1)):(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},markConversation:{conversationIDList:t({},Q),markType:{type:"number",validator:function(e,t,n){return Ke(e)?e<=0?(Wt({api:t,paramName:n,desc:Pn("NumberGreaterThanLog",n,0)}),!1):!(e>=Math.pow(2,64)&&(Wt({api:t,paramName:n,desc:Pn("NumberLessThanLog",n,"Math.pow(2,64)")}),1)):(Wt({api:t,paramName:n,desc:Xt()}),!1)}},enableMark:t({},On)},createConversationGroup:{conversationIDList:t({},Q),groupName:t(t({},$),{},{validator:function(e,t,n){return!(!e||32<e.length&&(Wt({api:t,paramName:n,desc:an(n,32)}),1))}})},deleteConversationGroup:[t({name:"groupName"},$)],renameConversationGroup:{oldName:t({},$),newName:t(t({},$),{},{validator:function(e,t,n){return!(!e||32<e.length&&(Wt({api:t,paramName:n,desc:an(n,32)}),1))}})},addConversationsToGroup:{conversationIDList:t({},Q),groupName:t({},$)},deleteConversationsFromGroup:{conversationIDList:t({},Q),groupName:t({},$)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:$,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:Q},createGroup:{name:$},joinGroup:{groupID:$,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[t({name:"groupID"},$)],handleApplication:{message:W,handleAction:$,handleMessage:{type:"String"}},changeGroupOwner:{groupID:$,newOwnerID:$},updateGroupProfile:{groupID:$,muteAllMembers:{type:"Boolean"}},dismissGroup:[t({name:"groupID"},$)],searchGroupByID:[t({name:"groupID"},$)],getGroupOnlineMemberCount:[t({name:"groupID"},$)],initGroupAttributes:{groupID:$,groupAttributes:t(t({},W),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach((function(i){if(!ct(e[i]))return Wt({api:t,paramName:n,desc:cn("value")}),o=!1})),o}})},setGroupAttributes:{groupID:$,groupAttributes:t(t({},W),{},{validator:function(e,t,n){var o=!0;return Object.keys(e).forEach((function(i){if(!ct(e[i]))return Wt({api:t,paramName:n,desc:cn("value")}),o=!1})),o}})},deleteGroupAttributes:{groupID:$,keyList:{type:"Array",validator:function(e,t,n){return ut(e)||!We(e)?(Wt({api:t,paramName:n,desc:tn()}),!1):!!Be(e)||(o=!0,e.forEach((function(e){if(!ct(e))return Wt({api:t,paramName:n,desc:Pn("StringArrayRequiredLog")}),o=!1})),o);var o}}},getGroupAttributes:{groupID:$,keyList:{type:"Array",validator:function(e,t,n){return ut(e)||!We(e)?(Wt({api:t,paramName:n,desc:tn()}),!1):!!Be(e)||(o=!0,e.forEach((function(e){if(!ct(e))return Wt({api:t,paramName:n,desc:cn("key")}),o=!1})),o);var o}}},setGroupCounters:{groupID:$,counters:W},increaseGroupCounter:{groupID:$,key:$,value:Nn},decreaseGroupCounter:{groupID:$,key:$,value:Nn},getGroupCounters:{groupID:$},getGroupMemberList:{groupID:$,count:{type:"Number"}},getGroupMemberProfile:{groupID:$,userIDList:Q,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:$,userIDList:Q},setGroupMemberRole:{groupID:$,userID:$,role:$},setGroupMemberMuteTime:{groupID:$,userID:$,muteTime:{type:"Number",validator:function(e){return 0<=e}}},setGroupMemberNameCard:{groupID:$,userID:{type:"String"},nameCard:{type:"String",validator:function(e,t,n){return ct(e)?(e.length,!0):(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},setGroupMemberCustomField:{groupID:$,userID:{type:"String"},memberCustomField:Q},deleteGroupMember:{groupID:$},markGroupMemberList:{groupID:$,markType:{type:"number",validator:function(e,t,n){return Ke(e)?!(e<1e3&&(Wt({api:t,paramName:n,desc:rn(n,1e3)}),1)):(Wt({api:t,paramName:n,desc:Xt()}),!1)}},userIDList:t({},Q),enableMark:t({},On)},createTextMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){return ze(e)?ct(e.text)?0!==e.text.length||(Wt({api:t,paramName:"payload.text",desc:ln()}),!1):(Wt({api:t,paramName:"payload.text",desc:Jt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createTextAtMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){return ze(e)?ct(e.text)?0===e.text.length?(Wt({api:t,paramName:"payload.text",desc:ln()}),!1):!(e.atUserList&&!We(e.atUserList)&&(Wt({api:t,paramName:"payload.atUserList",desc:tn()}),1)):(Wt({api:t,paramName:"payload.text",desc:Jt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createCustomMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){return ze(e)?e.data&&!ct(e.data)?(Wt({api:t,paramName:"payload.data",desc:Jt()}),!1):e.description&&!ct(e.description)?(Wt({api:t,paramName:"payload.description",desc:Jt()}),!1):!(e.extension&&!ct(e.extension)&&(Wt({api:t,paramName:"payload.extension",desc:Jt()}),1)):(Wt({api:t,paramName:"payload",desc:un()}),!1)}})},createImageMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){if(!ze(e))return Wt({api:t,paramName:n,desc:un()}),!1;if(ut(e.file))return Wt({api:t,paramName:"payload.file",desc:Zt()}),!1;if(te){if(!(e.file instanceof HTMLInputElement||je(e.file)))return ze(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Wt({api:t,paramName:"payload.file",desc:pn()}),!1):(Wt({api:t,paramName:"payload.file",desc:Qt()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Wt({api:t,paramName:"payload.file",desc:pn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:on()}),!0}}})},createAudioMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){return!!ze(e)||(Wt({api:t,paramName:n,desc:un()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:on()}),!0}}},createVideoMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){if(!ze(e))return Wt({api:t,paramName:n,desc:un()}),!1;if(ut(e.file))return Wt({api:t,paramName:"payload.file",desc:Zt()}),!1;if(te){if(!(e.file instanceof HTMLInputElement||je(e.file)))return ze(e.file)&&"undefined"!=typeof uni?!!je(e.file.tempFile)||(Wt({api:t,paramName:"payload.file",desc:pn()}),!1):(Wt({api:t,paramName:"payload.file",desc:Qt()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Wt({api:t,paramName:"payload.file",desc:pn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:on()}),!0}}},createFaceMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){return ze(e)?Ke(e.index)?!!ct(e.data)||(Wt({api:t,paramName:"payload.data",desc:Jt()}),!1):(Wt({api:t,paramName:"payload.index",desc:Xt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createFileMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){if(!ze(e))return Wt({api:t,paramName:n,desc:un()}),!1;if(ut(e.file))return Wt({api:t,paramName:"payload.file",desc:Zt()}),!1;if(te){if(!(e.file instanceof HTMLInputElement||je(e.file)))return ze(e.file)&&"undefined"!=typeof uni?0!==e.file.tempFilePaths.length&&0!==e.file.tempFiles.length||(Wt({api:t,paramName:"payload.file",desc:pn()}),!1):(Wt({api:t,paramName:"payload.file",desc:Qt()}),!1);if(e.file instanceof HTMLInputElement&&0===e.file.files.length)return Wt({api:t,paramName:"payload.file",desc:pn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:on()}),!0}}},createLocationMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){return ze(e)?ct(e.description)?Ke(e.longitude)?!!Ke(e.latitude)||(Wt({api:t,paramName:"payload.latitude",desc:Xt()}),!1):(Wt({api:t,paramName:"payload.longitude",desc:Xt()}),!1):(Wt({api:t,paramName:"payload.description",desc:Jt()}),!1):(Wt({api:t,paramName:n,desc:un()}),!1)}})},createMergerMessage:{to:$,conversationType:$,payload:t(t({},W),{},{validator:function(e,t,n){if(Be(e.messageList))return Wt({api:t,paramName:"payload.messageList",desc:nn()}),!1;if(Be(e.compatibleText))return Wt({api:t,paramName:"payload.compatibleText",desc:$t("compatibleText")}),!1;var o=!1;return e.messageList.forEach((function(e){e.status===Dn&&(o=!0)})),!o||(Wt({api:t,paramName:"payload.messageList",desc:Pn("MergeFailedMessageLog")}),!1)}})},revokeMessage:[t(t({name:"message"},W),{},{validator:function(e,t,n){return Be(e)?(Wt({api:t,paramName:n,desc:hn()}),!1):e.conversationType===S.CONV_SYSTEM?(Wt({api:t,paramName:n,desc:Pn("MessageCanBeRevokedDesc")}),!1):!0!==e.isRevoked||(Wt({api:t,paramName:n,desc:Pn("MessageRevokedLog")}),!1)}})],deleteMessage:[t(t({name:"messageList"},Q),{},{validator:function(e,t,n){return!Be(e)||(Wt({api:t,paramName:n,desc:nn()}),!1)}})],translateText:{sourceTextList:Q,sourceLanguage:$,targetLanguage:$},convertVoiceToText:{message:t(t({},W),{},{validator:function(e,t,n){return Be(e)?(Wt({api:t,paramName:n,desc:hn()}),!1):e.type===S.MSG_AUDIO&&e.status===Sn||(Wt({api:t,paramName:n,desc:Pn("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[t(t({name:"message"},W),{},{validator:function(e,t,n){return Be(e)?(Wt({api:t,paramName:n,desc:hn()}),!1):e.conversationType===S.CONV_SYSTEM?(Wt({api:t,paramName:n,desc:Pn("MessageCanBeModifiedLog")}),!1):!0!==e._onlineOnlyFlag||(Wt({api:t,paramName:n,desc:Pn("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(We(e)?0===e.length?(Wt({api:t,paramName:n,desc:nn()}),1):5<e.length&&(Wt({api:t,paramName:n,desc:mn(n,5)}),1):(Wt({api:t,paramName:n,desc:tn()}),1)))}},keywordListMatchType:{type:"String",required:!1,validator:function(e,t,n){return!e||"or"===e||"and"===e||Wt({api:t,paramName:n,desc:"".concat(e," is invalid match type")})}},senderUserIDList:{type:"Array",required:!1,validator:function(e,t,n){return!(e&&(We(e)?(0===e.length&&Wt({api:t,paramName:n,desc:nn()}),5<e.length&&(Wt({api:t,paramName:n,desc:mn(n,5)}),1)):(Wt({api:t,paramName:n,desc:tn()}),1)))}},messageTypeList:{type:"Array",required:!1,validator:function(e,t,n){if(!e)return!0;if(!We(e))return Wt({api:t,paramName:n,desc:tn()}),!1;0===e.length&&Wt({api:t,paramName:n,desc:nn()});var o=[S.MSG_TEXT,S.MSG_IMAGE,S.MSG_AUDIO,S.MSG_FILE,S.MSG_VIDEO,S.MSG_LOCATION,S.MSG_CUSTOM,S.MSG_MERGER];return!(0<e.filter((function(e){return-1===o.indexOf(e)})).length&&(Wt({api:t,paramName:n,desc:Pn("ContainsUnsupportedMessageTypeLog",n)}),1))}},conversationID:{type:"String",required:!1,validator:function(e){return!e||zt(e)}},timePosition:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(Wt({api:t,paramName:n,desc:rn(n,0)}),1))}},timePeriod:{type:"number",required:!1,validator:function(e,t,n){return!(e&&e<0&&(Wt({api:t,paramName:n,desc:rn(n,0)}),1))}},cursor:{type:"String",required:!1}},getUserProfile:{userIDList:{type:"Array",validator:function(e,t,n){return We(e)?(0===e.length&&Wt({api:t,paramName:n,desc:nn()}),!0):(Wt({api:t,paramName:n,desc:tn()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e,t,n){return!!ut(e)||!!We(e)||(Wt({api:t,paramName:n,desc:tn()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e,t,n){return!!ct(e)||(Wt({api:t,paramName:n,desc:Jt()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:nn()}),!1):(Wt({api:t,paramName:n,desc:tn()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:nn()}),!1):(Wt({api:t,paramName:n,desc:tn()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e,t,n){return!e||!!We(e)||(Wt({api:t,paramName:n,desc:tn()}),!1)}}},addFriend:{to:$,source:{type:"String",required:!0,validator:function(e,t,n){return!(!e||(e.startsWith("AddSource_Type_")?8<e.replace("AddSource_Type_","").length&&(Wt({api:t,paramName:n,desc:an("keyword",8)}),1):(Wt({api:t,paramName:n,desc:Pn("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e,t,n){return!(ct(e)&&96<e.length&&(Wt({api:t,paramName:n,desc:an(n,96)}),1))}}},deleteFriend:{userIDList:Q},checkFriend:{userIDList:Q},getFriendProfile:{userIDList:Q},updateFriend:{userID:$,remark:{type:"String",required:!1,validator:function(e,t,n){return!(ct(e)&&96<e.length&&(Wt({api:t,paramName:n,desc:an(n,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e,t,n){if(e){if(!We(e))return Wt({api:t,paramName:n,desc:tn()}),!1;var o=!0;return e.forEach((function(e){return ct(e.key)&&-1!==e.key.indexOf("Tag_SNS_Custom")?ct(e.value)?8<e.key.replace("Tag_SNS_Custom_","").length?(Wt({api:t,paramName:n,desc:an("keyword",8)}),o=!1):void 0:(Wt({api:t,paramName:n,desc:cn("value")}),o=!1):(Wt({api:t,paramName:n,desc:Pn("FriendCustomFieldPrefixLog")}),o=!1)})),o}return!0}}},acceptFriendApplication:{userID:$},refuseFriendApplication:{userID:$},deleteFriendApplication:{userID:$},createFriendGroup:{name:$},deleteFriendGroup:{name:$},addToFriendGroup:{name:$,userIDList:Q},removeFromFriendGroup:{name:$,userIDList:Q},renameFriendGroup:{oldName:$,newName:$},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:nn()}),!1):(Wt({api:t,paramName:n,desc:tn()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e,t,n){return We(e)?0!==e.length||(Wt({api:t,paramName:n,desc:nn()}),!1):(Wt({api:t,paramName:n,desc:tn()}),!1)}}],createTopicInCommunity:{groupID:$,topicName:$},deleteTopicFromCommunity:{groupID:$,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!We(e)||(Wt({api:t,paramName:n,desc:tn()}),!1)}}},updateTopicProfile:{groupID:$,topicID:$},getTopicList:{groupID:$,topicIDList:{type:"Array",validator:function(e,t,n){return!e||!!We(e)||(Wt({api:t,paramName:n,desc:tn()}),!1)}}},followUser:[t({name:"userIDList"},Q)],unfollowUser:[t({name:"userIDList"},Q)],getMyFollowingList:[t(t({name:"startIndex"},$),{},{required:!1})],getMyFollowersList:[t(t({name:"startIndex"},$),{},{required:!1})],getMutualFollowersList:[t(t({name:"startIndex"},$),{},{required:!1})],getUserFollowInfo:[t(t({name:"userIDList"},Q),{},{required:!1})],checkFollowType:[t({name:"userIDList"},Q)],addSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:$t(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:en()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(e,t,n){return"string"==typeof e&&0!==e.length||(Wt({api:t,paramName:n,desc:$t(n)}),!1)}},{name:"handler",type:"Function",validator:function(e,t,n){return"function"!=typeof e?(Wt({api:t,paramName:n,desc:en()}),!1):(""===e.name&&Wt({api:t,paramName:n,desc:gn()}),!0)}}],invite:{userID:$},inviteSync:[t(t({},W),{},{validator:function(e,t,n){return ze(e)?!!ct(e.userID)||(Wt({api:t,paramName:"options.userID",desc:Jt()}),!1):(Wt({api:t,paramName:"options",desc:un()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:en()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:en()}),!0}}],inviteInGroup:{groupID:$,inviteeList:Q},inviteInGroupSync:[t(t({},W),{},{validator:function(e,t,n){return ze(e)?ct(e.groupID)?!!We(e.inviteeList)||(Wt({api:t,paramName:"options.inviteeList",desc:tn()}),!1):(Wt({api:t,paramName:"options.groupID",desc:Jt()}),!1):(Wt({api:t,paramName:"options",desc:un()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:en()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,t,n){return ut(e)&&Wt({api:t,paramName:n,desc:en()}),!0}}],accept:{inviteID:$},reject:{inviteID:$},getSignalingInfo:[t(t({name:"message"},W),{},{validator:function(e,t,n){return!Be(e)||(Wt({api:t,paramName:n,desc:hn()}),!1)}})],modifyInvitation:{inviteID:$,data:$}},Un={login:1,logout:1,getLoginUser:1,getServerTime:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,searchCloudMessages:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,setMessageRemindType:1,setAllReceiveMessageOpt:1,getAllReceiveMessageOpt:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},Gn=(r(so,(Cn=Error,Tn="function"==typeof Map?new Map:void 0,function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==Tn){if(Tn.has(e))return Tn.get(e);Tn.set(e,t)}function t(){return d(e,arguments,c(this).constructor)}return t.prototype=Object.create(e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),u(t,e)}(Cn))),Mn=g(so),s(so)),wn={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AV:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_ERR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AV:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AV:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AV:2661,CANNOT_JOIN_NON_AV_WITHOUT_LOGIN:2662,NOT_OWNER:2681,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AV:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,NO_PROTOCOL:2997,NO_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,NO_USE:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020,MSG_SEARCH_CURSOR_INVALID:27002,MSG_SEARCH_CURSOR_EXPIRED:27003},Fn=null,xn=(s(io,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){var e=this._m.get(12);return e.isPrivateNetWork()&&!e.getFileDownloadProxy()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getDowloadFileAuthKey",value:function(){return this._m.get(12).getDowloadFileAuthKey()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"getPlatform",value:function(){return ie}},{key:"getCloudConfig",value:function(e){return this._m.get(23).getCloudConfig(e)}},{key:"emitOEvt",value:function(e,t){this._m.getOEmitInst().emit(e,t)}},{key:"emitIEvt",value:function(e,t){this._m.getIEmitInst().emit(e,t)}},{key:"getIEmitInst",value:function(){return this._m.getIEmitInst()}},{key:"req",value:function(e){return this._m.get(20).req(e)}},{key:"canIUse",value:function(e){return this._m.get(27).canIUse(e)}},{key:"getErrMsg",value:function(e,t,n){return this._m.getErrMsg(e,t,n)}},{key:"warn",value:function(e,t,n){(e=this.getErrMsg(e,t,n))&&Oe.w(e)}},{key:"noUse",value:function(e){var t=wn.NO_USE;return In({code:t,message:this.getErrMsg(t,e)})}}]),Nn=io,{LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",SEARCH_CONV_GRP_MARK:"search_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",MSG_CLOUD_SEARCH:"query",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check",SET_ALL_RECEIVE_MSG_OPT:"ws_set_do_not_disturb",GET_ALL_RECEIVE_MSG_OPT:"ws_get_do_not_disturb"}),Vn="networkRTT",qn="messageE2EDelay",Bn="sendMessageC2C",Hn="sendMessageGroup",jn="sendMessageGroupAV",Kn="sendMessageRichMedia",Yn="cosUpload",zn="messageReceivedGroup",Wn="messageReceivedGroupAVPush",Jn="messageReceivedGroupAVPull",$n=(a(On={},Vn,2),a(On,qn,3),a(On,Bn,4),a(On,Hn,5),a(On,jn,6),a(On,Kn,7),a(On,zn,8),a(On,Wn,9),a(On,Jn,10),a(On,Yn,11),On),Xn={info:4,warning:5,error:6},Zn={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Qn={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16},eo=(s(oo,[{key:"updateTimeStamp",value:function(){this.timestamp=ke()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e,t=this,n=0<arguments.length&&void 0!==arguments[0]&&arguments[0];this._sentFlag||(this._netMonitorModule&&(e=this._netMonitorModule.getNetworkType(),this.setNetworkType(e)),e=ke(),0===this.costTime&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),n?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout((function(){t._sentFlag=!0,t._eventStatModule&&t._eventStatModule.pushIn(t)}),0))}},{key:"setError",value:function(e){if(!(e instanceof Error))return Oe.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;var t=!0;return(t=this._netMonitorModule?this._netMonitorModule.isOnline():t)?(e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message)):this.setCode(wn.NO_NETWORK),this.setLevel("error"),this}},{key:"setCode",value:function(e){return ut(e)||this._sentFlag||("ECONNABORTED"===e&&(this.code=103),Ke(e)?this.code=e:Oe.w("".concat(this._n,".setCode value not a number, please check!"),e,n(e))),this}},{key:"setMessage",value:function(e){return ut(e)||this._sentFlag||(Ke(e)&&(this.message=e.toString()),ct(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return ut(e)||this._sentFlag||(this.level=Xn[e]),this}},{key:"setMoreMessage",value:function(e){return Be(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){return ut(e)?Oe.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(e=Zn[e.toLowerCase()],ut(e)||(this.networkType=e)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){return this.uiPlatform=e,this}},{key:"setExtension",value:function(e){return this.extension=e,this}},{key:"setEventType",value:function(e){return this.eventType=e,this}}],[{key:"bindEventStatModule",value:function(e){oo.prototype._eventStatModule=e}},{key:"bindNetMonitorModule",value:function(e){oo.prototype._netMonitorModule=e}}]),oo),to=(s(no,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return 0!==this.content.text.length}}]),no);function no(e){o(this,no),this.type=S.MSG_TEXT,this.content={text:e.text||""}}function oo(e){o(this,oo),this._n="SSOLogData",this.eventType=Qn[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=ke()}function io(e){o(this,io),this._m=e,this._n=""}function so(e){o(this,so),t=Mn.call(this);var t,n=e.code,i=e.message;return e=e.data,t.code=n,i?t.message=i:t._getErrMsg&&(t.message=t._getErrMsg(t.code)),t.data=e||{},t}function ao(e,t,n,o){var i;if(o=3<arguments.length&&void 0!==o?o:[],e)return i=e,t&&(e.startsWith("http://")?i=e.replace(/^http:\/\/[^/]+/,t):e.startsWith("https://")&&(i=e.replace(/^https:\/\/[^/]+/,t))),n&&-1===i.indexOf("authKey=")&&uo(i,o)?(-1<i.indexOf("?")?"".concat(i,"&authKey="):"".concat(i,"?authKey=")).concat(n):i}function ro(e,t,n){return n=2<arguments.length&&void 0!==n?n:[],e===S.MSG_VIDEO?uo((t[0].content||t[0].payload).snapshotUrl,n)&&(t[0].content?(t[0].content.snapshotUrl=co(t[0].content.snapshotUrl),t[0].content.thumbUrl=co(t[0].content.thumbUrl)):(t[0].payload.snapshotUrl=co(t[0].payload.snapshotUrl),t[0].payload.thumbUrl=co(t[0].payload.thumbUrl))):e===S.MSG_FILE?uo((t[0].content||t[0].payload).fileUrl,n)&&(t[0].content?t[0].content.fileUrl=co(t[0].content.fileUrl):t[0].payload.fileUrl=co(t[0].payload.fileUrl)):e===S.MSG_MERGER&&(e=(n=t[0].content||t[0].payload).downloadKey,n=void 0===(n=n.messageList)?[]:n,Be(void 0===e?"":e)&&n.forEach((function(e){ro(e.messageBody[0].type,e.messageBody)}))),t}function co(e){if(!e)return e;if(-1===e.indexOf("authKey="))return e;for(var t=(e=e.split("?"))[1].split("&"),n=0,o=0;o<t.length;o++)if(-1<t[o].indexOf("authKey=")){n=o;break}return t.splice(n,1),0<t.length?"".concat(e[0],"?").concat(t.join("&")):e[0]}function uo(e,t){var n=!1;if(e){var o=(e=e.match(/:\/\/([0-9]?\.)?(.[^/:]+)/))&&e[2]||"";if(o.includes("rich-dev"))return 1;for(var i=0;i<t.length;i++)if(o.endsWith(t[i])){n=!0;break}}return n}s(wo,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(t){this.instanceID=nt(9999999),this.sizeType=t.type||0,this.type=0,this.size=t.size||0,this.width=t.width||0,this.height=t.height||0,this.imageUrl=t.imageUrl||t.url||"",this.url=ao(t.url||e._imageMemoryURL,e._fileDownloadProxy,e._authKey,e._fileDNList)},this._ImageInfoModel.prototype={setSizeType:function(e){this.sizeType=e},setType:function(e){this.type=e},setImageUrl:function(e){e&&(this.imageUrl=e)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var t,n=0,o=null;n<=2;)t=ut(e)||ut(e[n])?{type:0,size:0,width:0,height:0,url:""}:e[n],(o=new this._ImageInfoModel(t)).setSizeType(n+1),o.setType(n),this.addImageInfo(o),n++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var t,n=this.content.imageInfoArray.length,o=0;o<n;o++)t=this.content.imageInfoArray[o],e[o].size&&(t.size=e[o].size),e[o].url&&t.setImageUrl(e[o].url),e[o].width&&(t.width=e[o].width),e[o].height&&(t.height=e[o].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,t="",n="",o=["http","https"],i=null,s=0;s<e;s++)this.content.imageInfoArray[s].url&&""!==(i=this.content.imageInfoArray[s]).imageUrl&&(n=i.imageUrl.slice(0,i.imageUrl.indexOf("://")+1),t=i.imageUrl.slice(i.imageUrl.indexOf("://")+1),o.indexOf(n)<0&&(n="https:"),this.content.imageInfoArray[s].setImageUrl([n,t].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=Ne[e.toUpperCase()]||Ne.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){void 0!==e&&0<e.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURL",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,t){this.content.imageInfoArray[t]instanceof this._ImageInfoModel||(this.content.imageInfoArray[t]=e)}},{key:"addImageInfo",value:function(e){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,t=void 0===(t=(n=e[0]).width)?0:t,n=void 0===(n=n.height)?0:n;0!==t&&0!==n&&(Ot(e),Object.assign(e[2],At({originWidth:t,originHeight:n,min:720})))}},{key:"sendable",value:function(){return 0!==this.content.imageInfoArray.length&&""!==this.content.imageInfoArray[0].imageUrl&&0!==this.content.imageInfoArray[0].size}}]);var lo=wo,po=(s(Go,[{key:"sendable",value:function(){return null!==this.content}}]),Go),ho=(s(Uo,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return""!==this.content.remoteAudioUrl}}]),Uo),go={from:!0,groupID:!0,groupName:!0,to:!0},_o=(s(bo,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"remarkInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;case"operatorInfo":t.content.operatorInfo={},t._initOperatorInfo(e[n]);break;case"memberInfoList":case"msgMemberInfo":t._updateMemberList(e[n]);break;case"memberNum":t.content[n]=e[n],t.content.memberCount=e[n];break;case"newGroupProfile":t.content.newGroupProfile={},t._initNewGroupProfile(e[n]);break;default:t.content[n]=e[n]}})),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];go[o]&&(this.content.groupProfile[o]=e[o])}}},{key:"_initOperatorInfo",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.operatorInfo[o]=e[o]}}},{key:"_updateMemberList",value:function(e){Be(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach((function(t){e.forEach((function(e){t.userID===e.userID&&Object.assign(t,e)}))}))}},{key:"_initNewGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];this.content.newGroupProfile[o]="muteAllMembers"!==o?e[o]:1===e[o]}}}]),bo),fo={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},mo=(s(Po,[{key:"_initContent",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"memberInfoList":break;case"remarkInfo":t.content.handleMessage=e[n];break;case"groupProfile":t.content.groupProfile={},t._initGroupProfile(e[n]);break;default:t.content[n]=e[n]}}))}},{key:"_initGroupProfile",value:function(e){for(var t=Object.keys(e),n=0;n<t.length;n++){var o=t[n];fo[o]&&("groupName"===o?this.content.groupProfile.name=e[o]:this.content.groupProfile[o]=e[o])}}}]),Po),vo=(s(No,[{key:"_getFileInfo",value:function(e){return ut(e.fileName)||ut(e.fileSize)?(e=e.file.files[0],J&&(e.path&&-1!==e.path.indexOf(".")&&(t=e.path.slice(e.path.lastIndexOf(".")+1).toLowerCase(),e.type=t,e.name||(e.name="".concat(nt(999999),".").concat(t))),e.name||(e.type="",e.name=e.path.slice(e.path.lastIndexOf("/")+1).toLowerCase()),e.suffix&&(e.type=e.suffix),e.url||(e.url=e.path)),{size:e.size,name:e.name}):{size:e.fileSize,name:e.fileName};var t}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return""!==this.content.fileUrl&&""!==this.content.fileName&&0!==this.content.fileSize}}]),No),yo=(s(Oo,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return 0!==this.content.data.length||0!==this.content.description.length||0!==this.content.extension.length}}]),Oo),Io=(s(Ao,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var t=e.snapshotUrl,n=e.snapshotWidth;e=e.snapshotHeight,Be(t)||(this.content.thumbUrl=this.content.snapshotUrl=t),Be(n)||(this.content.thumbWidth=this.content.snapshotWidth=Number(n)),Be(e)||(this.content.thumbHeight=this.content.snapshotHeight=Number(e))}},{key:"sendable",value:function(){return""!==this.content.remoteVideoUrl}}]),Ao),Mo=(s(Lo,[{key:"sendable",value:function(){return!0}}]),Lo),Co=(s(Ro,[{key:"_patchRichMediaPayload",value:function(e,t){e===S.MSG_IMAGE?t.imageInfoArray.forEach((function(e){!e.imageUrl&&e.url&&(e.imageUrl=e.url,e.sizeType=e.type,1===e.type?e.type=0:3===e.type&&(e.type=1))})):e===S.MSG_VIDEO?!t.remoteVideoUrl&&t.videoUrl&&(t.remoteVideoUrl=t.videoUrl):e===S.MSG_AUDIO?!t.remoteAudioUrl&&t.url&&(t.remoteAudioUrl=t.url):e===S.MSG_FILE&&!t.fileUrl&&t.url&&(t.fileUrl=t.url,t.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,t,n,o,i){(n||o)&&(e===S.MSG_IMAGE?t.imageInfoArray.forEach((function(e){e.url=ao(e.url,n,o,i)})):e===S.MSG_VIDEO?(t.videoUrl=ao(t.videoUrl,n,o,i),t.snapshotUrl=ao(t.thumbUrl,n,o,i),t.snapshotHeight=t.thumbHeight,t.snapshotWidth=t.thumbWidth):e===S.MSG_AUDIO?t.url=ao(t.url,n,o,i):e===S.MSG_FILE&&(t.fileUrl=ao(t.fileUrl,n,o,i)))}}]),Ro),To=(s(ko,[{key:"sendable",value:function(){return!Be(this.content.messageList)||!Be(this.content.downloadKey)}}]),ko),Eo={1:S.MSG_PRIORITY_HIGH,2:S.MSG_PRIORITY_NORMAL,3:S.MSG_PRIORITY_LOW,4:S.MSG_PRIORITY_LOWEST},So=(s(Do,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){null!==e&&(ct(e.nick)&&(this.nick=e.nick),ct(e.avatar)&&(this.avatar=e.avatar),ze(e=e.messageFromAccountExtraInformation)&&ct(e.nameCard)&&(this.nameCard=e.nameCard))}},{key:"handleGroupAtInfo",value:function(e){var t=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach((function(e){e!==S.MSG_AT_ALL?(t._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:e}),t.atUserList.push(e)):(t._groupAtInfoList.push({groupAtAllFlag:1}),t.atUserList.push(S.MSG_AT_ALL))})),We(e.groupAtInfo)&&e.groupAtInfo.forEach((function(e){0===e.groupAtAllFlag?t.atUserList.push(e.groupAtUserID):1===e.groupAtAllFlag&&t.atUserList.push(S.MSG_AT_ALL)}))}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?Sn:En,this.from||(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return 0!==this._elements.length&&(!0===this._relayFlag||"function"==typeof this._elements[0].sendable&&this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===S.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){var t,n,o;0===this.clientSequence&&e&&(this.clientSequence=!!e&&(void 0===_t[e]&&(t="3".concat((o=new Date).getHours()).slice(-2),n="0".concat(o.getMinutes()).slice(-2),o="0".concat(o.getSeconds()).slice(-2),_t[e]=parseInt([t,n,o,"0001"].join("")),o=n=t=null,Oe.l("autoIncrementIndex start index:".concat(_t[e]))),_t[e]++)),0===this.sequence&&this.conversationType===S.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===S.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){""!==e&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var t=this.to,n=this.conversationType;n!==S.CONV_SYSTEM?(e=n===S.CONV_C2C?e===this.from?t:this.from:this.to,this.conversationID=e?"".concat(n).concat(e):null):this.conversationID=S.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof to||e instanceof lo||e instanceof po||e instanceof ho||e instanceof vo||e instanceof Io||e instanceof _o||e instanceof mo||e instanceof yo||e instanceof Mo||e instanceof To}},{key:"setElement",value:function(e,t,n,o){var i=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();function s(e){if(e.type&&e.content)switch(e.type){case S.MSG_TEXT:i.setTextElement(e.content);break;case S.MSG_IMAGE:i.setImageElement(e.content,t,n,o);break;case S.MSG_AUDIO:i.setAudioElement(e.content,t,n,o);break;case S.MSG_FILE:i.setFileElement(e.content,t,n,o);break;case S.MSG_VIDEO:i.setVideoElement(e.content,t,n,o);break;case S.MSG_CUSTOM:i.setCustomElement(e.content);break;case S.MSG_LOCATION:i.setLocationElement(e.content);break;case S.MSG_GRP_TIP:i.setGroupTipElement(e.content);break;case S.MSG_GRP_SYS_NOTICE:i.setGroupSystemNoticeElement(e.content);break;case S.MSG_FACE:i.setFaceElement(e.content);break;case S.MSG_MERGER:i.setMergerElement(e.content,t,n,o)}}if(We(e))for(var a=0;a<e.length;a++)s(e[a]);else s(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){e="string"==typeof e?e:e.text,e=new to({text:e}),this._elements.push(e)}},{key:"setImageElement",value:function(e,t,n,o){e=new lo(e,t,n,o),this._elements.push(e)}},{key:"setAudioElement",value:function(e,t,n,o){e=new ho(e,t,n,o),this._elements.push(e)}},{key:"setFileElement",value:function(e,t,n,o){e=new vo(e,t,n,o),this._elements.push(e)}},{key:"setVideoElement",value:function(e,t,n,o){e=new Io(e,t,n,o),this._elements.push(e)}},{key:"setLocationElement",value:function(e){e=new Mo(e),this._elements.push(e)}},{key:"setCustomElement",value:function(e){e=new yo(e),this._elements.push(e)}},{key:"setGroupTipElement",value:function(e){var t,n={},o=e.operationType;Be(e.memberInfoList)?e.operatorInfo&&(n=e.operatorInfo):o!==S.GRP_TIP_MBR_JOIN&&o!==S.GRP_TIP_MBR_KICKED_OUT&&o!==S.GRP_TIP_MBR_SET_ADMIN&&o!==S.GRP_TIP_MBR_CANCELED_ADMIN||(n=e.memberInfoList[0]),Be(e.memberExtraInfo)||(t=e.memberExtraInfo.reason,e.msgMemberInfo.forEach((function(e){e.reason=t}))),o=n.nick,n=n.avatar,ct(o)&&(this.nick=o),ct(n)&&(this.avatar=n),o=new _o(e),this._elements.push(o)}},{key:"setGroupSystemNoticeElement",value:function(e){e=new mo(e),this._elements.push(e)}},{key:"setFaceElement",value:function(e){e=new po(e),this._elements.push(e)}},{key:"setMergerElement",value:function(e,t,n,o){e=new To(e,t,n,o),this._elements.push(e)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"_computePriority",value:function(e){return ut(e)?S.MSG_PRIORITY_NORMAL:ct(e)&&-1!==Object.values(Eo).indexOf(e)?e:Ke(e)&&(e=""+e,-1!==Object.keys(Eo).indexOf(e))?Eo[e]:S.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var t=e.nick;e=e.avatar,ct(t)&&(this.nick=t),ct(e)&&(this.avatar=e)}},{key:"setNameCard",value:function(e){ct(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){var t=e.readReceiptSentByPeer;e=void 0===(e=e.timestamp)?0:e,this.conversationType===S.CONV_C2C&&!0===this.needReadReceipt&&(this.readReceiptInfo.isPeerRead=1===(void 0===t?void 0:t),this.readReceiptInfo.timestamp=e)}}]),Do);function Do(e){o(this,Do),this.ID="",this.conversationID=e.conversationID||null,this.conversationType=e.conversationType||S.CONV_C2C,this.conversationSubType=e.conversationSubType,this.time=e.time||Math.ceil(Date.now()/1e3),this.sequence=e.sequence||0,this.clientSequence=e.clientSequence||e.sequence||0,this.random=e.random||0===e.random?e.random:nt(),this.priority=this._computePriority(e.priority),this.nick=e.nick||"",this.avatar=e.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=Kt(e.checkResult),this._elements=[],this.isPlaceMessage=e.isPlaceMessage||0,this.isRevoked=2===e.isPlaceMessage||8===e.msgFlagBits,this.from=e.from||null,this.to=e.to||null,this.flow="",this.isSystemMessage=e.isSystemMessage||!1,this.protocol=e.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=e.status||Sn,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=e.cloudCustomData||"",this.isDeleted=!1,this.isModified=!!e.messageVersion,this._isExcludedFromUnreadCount=!(!e.messageControlInfo||1!==e.messageControlInfo.excludedFromUnreadCount),this._isExcludedFromLastMessage=!(!e.messageControlInfo||1!==e.messageControlInfo.excludedFromLastMessage),this.clientTime=e.clientTime||Ee()||0,this.senderTinyID=e.senderTinyID||e.tinyID||"",this.readReceiptInfo=e.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0,timestamp:0},this.needReadReceipt=!0===e.needReadReceipt||1===e.needReadReceipt,this.version=e.messageVersion||0,this.isBroadcastMessage=e.isBroadcastMessage||!1,this._receiverList=e.receiverList||void 0,this.isSupportExtension=!0===e.isSupportExtension||1===e.isSupportExtension,this._cmConfigID=e.customModerationConfigurationID,this.revoker=e.revokerInfo&&e.revokerInfo.revoker||"",this.revokerInfo=e.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=e.revokeReason||"",this.reInitialize(e.currentUser),this.extractGroupInfo(e.groupProfile||null),this.handleGroupAtInfo(e),this.initC2CReadReceiptInfo(e)}function ko(e,t,n,i){var s,a,r,c,u,l,d;o(this,ko),this.type=S.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},e.downloadKey?(a=e.downloadKey,r=e.pbDownloadKey,c=e.title,u=e.abstractList,l=e.compatibleText,s=e.version,this.content.downloadKey=a,this.content.pbDownloadKey=r,this.content.title=c,this.content.abstractList=u,this.content.compatibleText=l,this.content.version=s||0):Be(e.messageList)?1===e.layersOverLimit&&(this.content.layersOverLimit=!0):(a=e.messageList,r=e.title,c=e.abstractList,u=e.compatibleText,l=e.version,d=[],a.forEach((function(e){Be(e)||(e=new Co(e,t,n,i),d.push(e))})),this.content.messageList=d,this.content.title=r,this.content.abstractList=c,this.content.compatibleText=u,this.content.version=l||0)}function Ro(e,t,n,i){var s,a;o(this,Ro),this.from=e.from,this.messageSender=e.from,this.time=e.time,this.messageSequence=e.sequence,this.clientSequence=e.clientSequence||e.sequence,this.messageRandom=e.random,this.cloudCustomData=e.cloudCustomData||"",this.clientTime=e.clientTime||void 0,e.ID?(this.ID=e.ID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",e.messageBody?this.messageBody=JSON.parse(JSON.stringify(e.messageBody)):this.messageBody=[{type:e.type,payload:e.payload}],e.conversationType?e.conversationType.startsWith(S.CONV_C2C)?this.receiverUserID=e.to:e.conversationType.startsWith(S.CONV_GROUP)&&(this.receiverGroupID=e.to):e.receiverGroupID?this.receiverGroupID=e.receiverGroupID:e.receiverUserID&&(this.receiverUserID=e.receiverUserID),this.messageReceiver=e.to||e.messageReceiver):(this.nick=e.nick||"",this.avatar=e.avatar||"",this.messageBody=[],s=e.elements[0].type,a=e.elements[0].content,this._patchRichMediaPayload(s,a),this._updateRichMediaDownloadUrl(s,a,t,n,i),s===S.MSG_MERGER?this.messageBody.push({type:s,payload:new To(a,t,n,i).content}):this.messageBody.push({type:s,payload:a}),e.groupID&&(this.receiverGroupID=e.groupID,this.messageReceiver=e.groupID),e.to&&(this.receiverUserID=e.to,this.messageReceiver=e.to),this.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random))}function Lo(e){o(this,Lo),this.type=S.MSG_LOCATION;var t=e.description,n=e.longitude;e=e.latitude,this.content={description:t,longitude:n,latitude:e}}function Ao(e,t,n,i){o(this,Ao),this.type=S.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:e.remoteVideoUrl||e.videoUrl||"",videoFormat:e.videoFormat,videoSecond:parseInt(e.videoSecond,10),videoSize:e.videoSize,videoUrl:ao(e.videoUrl,t,n,i),videoDownloadFlag:2,videoUUID:e.videoUUID,thumbUUID:e.thumbUUID,thumbFormat:e.thumbFormat,thumbWidth:e.thumbWidth,snapshotWidth:e.thumbWidth,thumbHeight:e.thumbHeight,snapshotHeight:e.thumbHeight,thumbSize:e.thumbSize,snapshotSize:e.thumbSize,thumbDownloadFlag:2,thumbUrl:ao(e.thumbUrl,t,n,i),snapshotUrl:ao(e.thumbUrl,t,n,i)}}function Oo(e){o(this,Oo),this.type=S.MSG_CUSTOM,this.content={data:e.data||"",description:e.description||"",extension:e.extension||""}}function No(e,t,n,i){o(this,No),this.type=S.MSG_FILE,this._percent=0;var s=this._getFileInfo(e);this.content={downloadFlag:2,fileUrl:ao(e.url||e.fileUrl,t,n,i)||"",uuid:e.uuid,fileName:s.name||"",fileSize:s.size||0}}function Po(e){o(this,Po),this.type=S.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(e)}function bo(e){o(this,bo),this.type=S.MSG_GRP_TIP,this.content={},this._initContent(e)}function Uo(e,t,n,i){o(this,Uo),this.type=S.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:e.second,size:e.size,url:ao(e.url,t,n,i),remoteAudioUrl:e.url||"",uuid:e.uuid}}function Go(e){o(this,Go),this.type=S.MSG_FACE,this.content=e||null}function wo(e,t,n,i){o(this,wo),this._imageMemoryURL="",this._fileDownloadProxy=t,this._authKey=n,this._fileDNList=i,Z||ee?this.createImageDataASURL(e.file):this.createImageDataASURLInWeb(e.file),this._initImageInfoModel(),this.type=S.MSG_IMAGE,this._percent=0,this.content={imageFormat:e.imageFormat||Ne.UNKNOWN,uuid:e.uuid,imageInfoArray:[]},this.initImageInfoArray(e.imageInfoArray),this._autoFixUrl()}function Fo(e){if(ze(e))return{pushFlag:!0===e.disablePush?1:0,title:e.title||"",desc:e.description||"",ext:e.extension||"",apnsInfo:(o=void 0===(o=(n=e).apnsInfo)?{}:o,i=n.ignoreIOSBadge,n=n.disableVoipPush,i=!0===o.ignoreIOSBadge||!0===(void 0!==i&&i)?1:0,s=void 0,ut(n)||(s=!1===n?1:0),ut(o.disableVoipPush)||(s=!1===o.disableVoipPush?1:0),t(t({},o),{},{badgeMode:i,isVoipPush:s})),androidInfo:(o=void 0===(o=(n=e).androidInfo)?{}:o,n=n.androidOPPOChannelID,n=o.OPPOChannelID||(void 0===n?"":n),t(t({},o),{},{Sound:-1===(s=(i=o.sound||"").lastIndexOf("."))?i:i.slice(0,s),OPPOChannelID:n,GoogleChannelID:o.FCMChannelID||""}))};var n,o,i,s}r(jo,Nn),xo=g(jo),s(jo,[{key:"onNewMessage",value:function(e){var t=e.dataList,n=e.isInstantMessage,o=e.C2CRemainingUnreadList,i=e.C2CPairUnreadList,s=(e=e.isSyncingEnded,o=(n||Oe.l("".concat(this._n,".onNewMessage C2CPairUnreadList:"),i,"C2CRemainingUnreadList:",o),t=this._assembly({dataList:t,C2CRemainingUnreadList:o,C2CPairUnreadList:i,isInstantMessage:n})).conversationOptionsList,i=t.messageList,t=t.isUnreadC2CMessage,0<(s=mt(i)).length&&this.emitOEvt(E.MESSAGE_MODIFIED,s),this.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:n,isUnreadC2CMessage:t,isSyncingEnded:e}),vt(i));n&&0<s.length&&this.emitOEvt(E.MESSAGE_RECEIVED,s),i.length=0}},{key:"_assembly",value:function(e){for(var t=e.dataList,n=e.C2CRemainingUnreadList,o=e.C2CPairUnreadList,i=e.isInstantMessage,s=null,a=[],r=[],c={},u=this.get(26),l=!1,d=this.get(11),p=this.get(4),h=(e=this.get(17),this.getFileDownloadProxy()),g=this.getDowloadFileAuthKey(),_=e.getFileDNList(),f=0,m=t.length;f<m;f++)if(this._isC2CNotice(t[f]))this._noticeFromUnreadDBList.push(t[f].eventArray[0].c2CNotifyMsgArray[0]);else{var v=t[f],y=(v.currentUser=this.getMyUserID(),v.conversationType=S.CONV_C2C,v.isSystemMessage=!!v.isSystemMessage,(ut(v.nick)||ut(v.avatar))&&(l=!0),(s=new So(v)).setElement(v.elements,h,g,_),s.setNickAndAvatar({nick:v.nick,avatar:v.avatar}),s.conversationID);if(i){if(this._msgFromUnreadDBMap.get(s.ID))continue;var I,M,C=!1,T=(s.from!==this.getMyUserID()?(M=d.getLatestMessageSentByPeer(y))&&(I=M.nick,M=M.avatar,l?s.setNickAndAvatar({nick:I,avatar:M}):I===s.nick&&M===s.avatar||(C=!0)):(I=d.getLatestMessageSentByMe(y))&&(M=I.nick,T=I.avatar,M===s.nick&&T===s.avatar||(d.modifyMessageSentByMe({conversationID:y,latestNick:s.nick,latestAvatar:s.avatar}),p.mockOnNickAvatarModified(s.nick,s.avatar))),1===t[f].isModified);if(d.isMessageSentByCurrentInstance(s)?s.isModified=T:T=!1,0===v.msgLifeTime)s._onlineOnlyFlag=!0,d.isMessageSentByCurrentInstance(s)||r.push(s);else{if(!d.pushIntoMessageList(r,s,T))continue;C&&(d.modifyMessageSentByPeer({conversationID:y,latestNick:s.nick,latestAvatar:s.avatar}),d.updateUserProfileSpecifiedKey({conversationID:y,nick:s.nick,avatar:s.avatar}))}i&&0<s.clientTime&&u.addMessageDelay(s.clientTime)}else this._msgFromUnreadDBMap.set(s.ID,s);if(0!==v.msgLifeTime){if(!1===s._onlineOnlyFlag){if(Ke(C=d.getLastMessageTime(y))&&s.time<C)continue;i&&(ut(c[y])?(v=0,"in"===s.flow&&(s._isExcludedFromUnreadCount||(v=1)),c[y]=a.push({conversationID:y,unreadCount:v,type:s.conversationType,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1):(v=c[y],a[v].type=s.conversationType,a[v].subType=s.conversationSubType,a[v].lastMessage=s._isExcludedFromLastMessage?"":s,"in"===s.flow&&(s._isExcludedFromUnreadCount||a[v].unreadCount++)))}}else s._onlineOnlyFlag=!0}this._handleNoticeFromUnreadDB();var E=!1;if(We(o)&&0<o.length)for(var D=0,k=o.length;D<k;D++)!function(e){if(o[e].from!==S.CONV_SYSTEM){E=!0;var t=a.find((function(t){return t.conversationID==="".concat(S.CONV_C2C).concat(o[e].from)}));t?t.unreadCount=o[e].unreadCount:a.push({conversationID:"".concat(S.CONV_C2C).concat(o[e].from),unreadCount:o[e].unreadCount,type:S.CONV_C2C})}}(D);if(We(n))for(var R=0,L=n.length;R<L;R++)!function(e){a.find((function(t){return t.conversationID==="".concat(S.CONV_C2C).concat(n[e].from)}))||a.push({conversationID:"".concat(S.CONV_C2C).concat(n[e].from),type:S.CONV_C2C,lastMsgTime:n[e].lastMsgTime})}(R);return{conversationOptionsList:a,messageList:r,isUnreadC2CMessage:E}}},{key:"getMessageListFromUnreadDB",value:function(){return m(this._msgFromUnreadDBMap.values())}},{key:"_isC2CNotice",value:function(e){return!(!We(e=e.eventArray)||10!==e[0].event)}},{key:"_handleNoticeFromUnreadDB",value:function(){var e,t=this._noticeFromUnreadDBList.length;0!==t&&(Oe.l("".concat(this._n,"._handleNoticeFromUnreadDB count:").concat(t)),e=[],this._noticeFromUnreadDBList.forEach((function(t){t.hasOwnProperty("c2cMessageRevokedNotify")&&e.push(t)})),this.onMsgRevoked({dataList:e}),this._noticeFromUnreadDBList.length=0,e.length=0)}},{key:"onMsgRevoked",value:function(e){var t,n=this,o=this.get(11),i=[];e.dataList.forEach((function(e){e.c2cMessageRevokedNotify&&(e=e.c2cMessageRevokedNotify.revokedInfos,ut(e)||e.forEach((function(e){var s=n.getMyUserID()===e.from?"".concat(S.CONV_C2C).concat(e.to):"".concat(S.CONV_C2C).concat(e.from);t=o.revoke(s,e.sequence,e.random);var a,r=e.revokerInfo&&e.revokerInfo.revoker,c=e.revokerInfo&&e.revokerInfo.reason||"";t?a=t:(a={conversationID:s,sequence:e.sequence},e.tinyID&&e.clientTime&&e.random&&(a.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)),e.time&&(a.time=e.time)),a&&(a.revoker=r,a.revokeReason=c,a.revokerInfo={userID:r,nick:"",avatar:""},i.push(a))})))})),0!==i.length&&(o.onMessageRevoked(i),Oe.l("".concat(this._n,".onMsgRevoked count:").concat(i.length)),o.updateRevokerInfo(i).then((function(e){n.emitOEvt(E.MESSAGE_REVOKED,e)})))}},{key:"onMsgReadReceipt",value:function(e){var t=this;e.dataList.forEach((function(e){var n;Be(e.c2cMessageReadReceipt)||(n=e.c2cMessageReadReceipt.to,e.c2cMessageReadReceipt.uinPairReadArray.forEach((function(e){e=e.peerReadTime;var o=(Oe.l("".concat(t._n,".onMsgReadReceipt to:").concat(n," peerReadTime:").concat(e)),"".concat(S.CONV_C2C).concat(n)),i=t.get(11);i.recordPeerReadTime(o,e),i.updateMsgIsPeerReadProp(o,e)})))}))}},{key:"onMsgReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n;Be(e.c2cMessageReadNotice)||(n=t.get(11),e.c2cMessageReadNotice.uinPairReadArray.forEach((function(e){var o=e.from;e=e.peerReadTime,Oe.l("".concat(t._n,".onMsgReadNotice from:").concat(o," lastReadTime:").concat(e)),o="".concat(S.CONV_C2C).concat(o),n.updateIsReadAfterReadReport({conversationID:o,lastMessageTime:e}),n.updateUnreadCount(o)})))}))}},{key:"onMsgModified",value:function(e){Oe.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:S.CONV_C2C}))}))}},{key:"onReadReceiptList",value:function(e){Oe.l("".concat(this._n,".onReadReceiptList options:"),e),this.get(11).updateReadReceiptInfo(e.dataList)}},{key:"sendMessage",value:function(e,t){return e=this._createC2CMessagePack(e,t),this.req(e)}},{key:"_createC2CMessagePack",value:function(e,t){var n=null,o=(t&&(t.offlinePushInfo&&(n=t.offlinePushInfo),!0===t.onlineUserOnly&&(n?n.disablePush=!0:n={disablePush:!0})),""),i=(ct(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),s=(ze(t)&&ze(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck")),this.isOnlineMessage(e,t)?0:void 0),a=JSON.parse(JSON.stringify(e.getElements())),r=this.get(17).getFileDNList();return{P:xn.SEND_C2C_MSG,data:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:ro(e.type,a,r),cloudCustomData:o,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:s,nick:e.nick,avatar:e.avatar,offlinePushInfo:Fo(n),messageControlInfo:0!==s?i:void 0,clientTime:e.clientTime,needReadReceipt:!0===e.needReadReceipt?1:0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0,cmConfigID:e._cmConfigID}}}},{key:"isOnlineMessage",value:function(e,t){return!(!t||!0!==t.onlineUserOnly)}},{key:"revokeMessage",value:function(e){return this.req({P:xn.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var t=e.to;return e=e.keyList,Oe.l("".concat(this._n,".deleteMessage toAccount:").concat(t," count:").concat(e.length)),this.req({P:xn.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:t,keyList:e}})}},{key:"modifyRemoteMessage",value:function(e){var t=e.from,n=e.to,o=void 0===(o=e.version)?0:o,i=e.sequence,s=e.random,a=e.time,r=e.payload,c=e.type,u=e.cloudCustomData,l=void(e=e._elements);return Ft(c)&&(1<e.length&&e.splice(0,1,{type:c,content:r}),l=e),this.req({P:xn.MODIFY_C2C_MSG,data:{from:t,to:n,version:o,sequence:i,random:s,time:a,elements:l,cloudCustomData:u}})}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageTime,i="".concat(this._n,".").concat("setMessageRead"),s=(e="convID:".concat(n," lastMessageTime:").concat(o),Oe.l("".concat(i," ").concat(e)),Ke(o)||this.warn("DoNotModifyLastTime"),new eo("setMessageRead"));return s.setMessage(e),this.req({P:xn.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:n.replace("C2C",""),lastMessageTime:o,receipt:1}]}}}).then((function(){s.end(),Oe.l("".concat(i," ok"));var e=t.get(11);return e.updateIsReadAfterReadReport({conversationID:n,lastMessageTime:o}),e.updateUnreadCount(n),vn()})).catch((function(e){return s.setError(e).end(),Oe.l("".concat(i," failed. error:"),e),In(e)}))}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessage"),o=e.peerAccount,i=e.conversationID,s=e.count,a=e.lastMessageTime,r=(e=e.messageKey,"peerAccount:".concat(o," count:").concat(s||15," lastMessageTime:").concat(a||0," messageKey:").concat(e)),c=(Oe.l("".concat(n," ").concat(r)),new eo("getRoamingMessage"));return this.req({P:xn.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:s||15,lastMessageTime:a||0,messageKey:e}}).then((function(e){var o=(e=e.data).complete,s=e.messageList,a=e.messageKey,u=(e=e.lastMessageTime,ut(s)?Oe.l("".concat(n," ok. complete:").concat(o," but messageList is undefined!")):Oe.l("".concat(n," ok. complete:").concat(o," count:").concat(s.length)),c.setMessage("".concat(r," complete:").concat(o," length:").concat(s.length)).end(),t.get(11)),l=((o=1===o)&&u.setCompleted(i),[]);return s=u.onRoamingMessage(s,i,!0,l),u.modifyMessageList(i),u.updateIsRead(i),u.updateRoamingMsgKeyAndTime(i,a,e),a=u.getPeerReadTime(i),Oe.l("".concat(n," update isPeerRead property. convID:").concat(i," peerReadTime:").concat(a)),a?u.updateMsgIsPeerReadProp(i,a):(e=i.replace(S.CONV_C2C,""),t.getRemotePeerReadTime([e]).then((function(){u.updateMsgIsPeerReadProp(i,u.getPeerReadTime(i))}))),a="",0<s.length?a=s[0].ID:(e=u.getLocalOldestMessage(i))&&(a=e.ID),Oe.l("".concat(n," nextReqID:").concat(a," storedMsgCount:").concat(s.length)),{nextReqID:a,storedMessageList:s,assembledMessageList:l,isPullingCompleted:o}})).catch((function(e){return c.setMessage(r).setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessagesHopping"),o=e.peerAccount,i=void 0===(i=e.time)?0:i,s=e.count,a=e.direction,r="".concat(S.CONV_C2C).concat(o),c="peerAccount:".concat(o," count:").concat(s," time:").concat(i," direction:").concat(a),u=(Oe.l("".concat(n," ").concat(c)),new eo("getRoamingMessagesHopping"));return this.req({P:xn.GET_C2C_ROAMING_MSG,data:{peerAccount:o,count:s+1,lastMessageTime:i,direction:a}}).then((function(e){var o=(e=e.data).complete,i=void 0===(i=e.messageList)?[]:i,s=(e=e.lastMessageTime,"complete:".concat(o," count:").concat(i.length)),l=(Oe.l("".concat(n," ok. ").concat(s)),u.setMessage("".concat(c," ").concat(s)).end(),1!==o&&(1===a?i.pop():i.shift()),t.get(11));return s=l.onRoamingMessage(i,r,!1),t._modifyMessageList(r,s),i=t._computeResult({complete:o,lastMessageTime:e,resultList:s}),l.storeHoppingMessageList(i.messageList),o=l.getPeerReadTime(r),Oe.l("".concat(n," update isPeerRead property. convID:").concat(r," peerReadTime:").concat(o)),o?l.updateMsgIsPeerReadProp(r,o):(e=r.replace(S.CONV_C2C,""),t.getRemotePeerReadTime([e]).then((function(){l.updateMsgIsPeerReadProp(r,l.getPeerReadTime(r))}))),vn(i)})).catch((function(e){return u.setMessage(c).setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"_computeResult",value:function(e){var t=void 0===(t=e.complete)?0:t,n=e.lastMessageTime;return e={messageList:m(void 0===(e=e.resultList)?[]:e),isCompleted:!1,nextMessageTime:""},1===t?e.isCompleted=!0:e.nextMessageTime=n,e}},{key:"_modifyMessageList",value:function(e,t){if(e=this.get(11).getLocalConversation(e))for(var n=e.userProfile.nick,o=e.userProfile.avatar,i=(e=this.get(4).getNickAndAvatarByUserID(this.getMyUserID())).nick,s=e.avatar,a=t.length-1;0<=a;a--){var r=t[a];"in"===r.flow&&(r.nick!==n&&r.setNickAndAvatar({nick:n}),r.avatar!==o&&r.setNickAndAvatar({avatar:o})),"out"===r.flow&&(r.nick!==i&&r.setNickAndAvatar({nick:i}),r.avatar!==s&&r.setNickAndAvatar({avatar:s}))}}},{key:"getRemotePeerReadTime",value:function(e){var t=this,n="".concat(this._n,".").concat("getRemotePeerReadTime");if(Be(e))return Promise.resolve();var o=new eo("getRemotePeerReadTime");return Oe.l("".concat(n," userIDList:").concat(e)),this.req({P:xn.GET_C2C_PEER_READ_TIME,data:{userIDList:e}}).then((function(i){var s=i.data.peerReadTimeList;Oe.l("".concat(n," ok. peerReadTimeList:").concat(s));for(var a="",r=t.get(11),c=0;c<e.length;c++)a+="".concat(e[c],"-").concat(s[c]," "),0<s[c]&&r.recordPeerReadTime("".concat(S.CONV_C2C).concat(e[c]),s[c]);o.setMessage(a).end()})).catch((function(e){o.setError(e).end(),Oe.w("".concat(n," failed. error:"),e)}))}},{key:"sendReadReceipt",value:function(e){var t=e[0].conversationID.replace(S.CONV_C2C,""),n=new eo("sendReadReceipt"),o=(n.setMessage("peerAccount:".concat(t)),this.getMyUserID());if(0===(e=e.filter((function(e){return e.from!==o&&!0===e.needReadReceipt})).map((function(e){return{fromAccount:e.from,toAccount:e.to,sequence:e.sequence,random:e.random,time:e.time,clientTime:e.clientTime}}))).length)return In({code:wn.READ_RECEIPT_MSG_LIST_EMPTY});var i="".concat(this._n,".").concat("sendReadReceipt");return Oe.l("".concat(i,". peerAccount:").concat(t," length:").concat(e.length)),this.req({P:xn.SEND_C2C_READ_RECEIPT,data:{peerAccount:t,messageInfoList:e}}).then((function(e){return n.end(),Oe.l("".concat(i," ok")),vn()})).catch((function(e){return n.setError(e).end(),Oe.w("".concat(i," failed. error:"),e),In(e)}))}},{key:"getReadReceiptList",value:function(e){var t=e[0].conversationID.replace(S.CONV_C2C,"");return Oe.l("".concat(this._n,".getReadReceiptList peerAccount:").concat(t," msgCount:").concat(e.length)),yn({messageList:e})}},{key:"getMessageExtensions",value:function(e,t){return Oe.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({P:xn.GET_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Oe.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),this.req({P:xn.MODIFY_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),extensionList:t,operateType:n}})}},{key:"getMessageKey",value:function(e){var t=e.clientSequence,n=e.random;return e=e.time,"".concat(t,"_").concat(n,"_").concat(e)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._msgFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]);var xo,Vo=jo,qo={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)},Bo=(s(Ho,[{key:"_onCloudConfig",value:function(){var e=this._convM.getCloudConfig("topic_msg_limit");ut(e)||(this.TOPIC_MSG_LIMIT=Number(e)),Oe.l("".concat(this._n,"._onCloudConfig topicMsgLimit:").concat(this.TOPIC_MSG_LIMIT))}},{key:"onCheckTimer",value:function(e){if(e%20==0&&0<this._map.size){var t,n=T(this._map);try{for(n.s();!(t=n.n()).done;){var o=f(t.value,2),i=o[0],s=o[1];i.includes(Ve)&&s.size>=this.TOPIC_MSG_LIMIT&&this._convM.clearMemMsg(i,!0)}}catch(a){n.e(a)}finally{n.f()}}}},{key:"pushIn",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1],n=e.conversationID,o=(this._map.has(n)||this._map.set(n,new Map),this._getUniqueIDOfMsg(e));if(this._map.get(n).has(o)){var i=this._map.get(n).get(o);if(!t||!0===i.isModified)return!1}return this._map.get(n).set(o,e),this._setLatestMsgSentByPeer(n,e),this._setLatestMsgSentByMe(n,e),!0}},{key:"unshift",value:function(e,t){var n;if(We(e)?0<e.length&&(n=e[0].conversationID,this._unshiftMultipleMsgs(e,t)):(n=e.conversationID,this._unshiftSingleMsg(e,t)),n){var o=Array.from(this._map.get(n).values());if(0!==(e=o.length)){for(var i=e-1;0<=i;i--)if("out"===o[i].flow){this._setLatestMsgSentByMe(n,o[i]);break}if(n.startsWith(S.CONV_C2C))for(var s=e-1;0<=s;s--)if("in"===o[s].flow){this._setLatestMsgSentByPeer(n,o[s]);break}}}}},{key:"_unshiftSingleMsg",value:function(e,t){var n=e.conversationID,o=this._getUniqueIDOfMsg(e);if(!this._map.has(n))return this._map.set(n,new Map),this._map.get(n).set(o,e),void t.push(e);var i=this._map.get(n),s=Array.from(i);i.has(o)||(s.unshift([o,e]),this._map.set(n,new Map(s)),t.push(e))}},{key:"_unshiftMultipleMsgs",value:function(e,t){for(var n=e.length,o=[],i=e[0].conversationID,s=this._map.get(i),a=this._map.has(i)?Array.from(s):[],r=0;r<n;r++){var c=this._getUniqueIDOfMsg(e[r]);s&&s.has(c)||(o.push([c,e[r]]),t.push(e[r]))}this._map.set(i,new Map(o.concat(a)))}},{key:"remove",value:function(e){var t=e.conversationID;e=this._getUniqueIDOfMsg(e),this._map.has(t)&&this._map.get(t).delete(e)}},{key:"revoke",value:function(e,t,n){var o;return this._map.has(e)?(o=this._map.get(e),this._updateMsgIsRevoked(o,t,n)):this._hoppingMsgMap.has(e)?(o=this._hoppingMsgMap.get(e),this._updateMsgIsRevoked(o,t,n)):null}},{key:"_updateMsgIsRevoked",value:function(e,t,n){var o,i=T(e);try{for(i.s();!(o=i.n()).done;){var s=f(o.value,2)[1];if(s.sequence===t&&(ut(n)||s.random===n))return s.isRevoked||(s.isRevoked=!0),s}}catch(a){i.e(a)}finally{i.f()}}},{key:"removeByConvID",value:function(e){var t=this._map.has(e);Oe.l("".concat(this._n,".removeByConvID convID:").concat(e," has:").concat(t)),t&&(this._map.delete(e),this._latestMsgSentByPeerMap.delete(e),this._latestMsgSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var t;return(t=this._findMsg(e,this._map))?t:this._findMsg(e,this._hoppingMsgMap)}},{key:"_findMsg",value:function(e,t){var n,o=null,i=T(t);try{for(i.s();!(n=i.n()).done;)for(var s=m(f(n.value,2)[1].values()),a=s.length,r=0;r<a;r++)if(s[r].ID===e){o=s[r];break}}catch(c){i.e(c)}finally{i.f()}return o}},{key:"updateMsgIsPeerReadProp",value:function(e,t){var n,o=[];return this._map.has(e)?(n=this._map.get(e),o=this._updateMsgIsPeerReadProp(n,t)):this._hoppingMsgMap.has(e)&&(n=this._hoppingMsgMap.get(e),o=this._updateMsgIsPeerReadProp(n,t)),Oe.l("".concat(this._n,".updateMsgIsPeerReadProp convID:").concat(e," peerReadTime:").concat(t," count:").concat(o.length)),o}},{key:"_updateMsgIsPeerReadProp",value:function(e,t){var n,o=[],i=T(e);try{for(i.s();!(n=i.n()).done;){var s=f(n.value,2)[1];s.time<=t&&!s.isPeerRead&&"out"===s.flow&&(s.isPeerRead=!0,o.push(s))}}catch(a){i.e(a)}finally{i.f()}return o}},{key:"updateMsgIsModifiedProp",value:function(e){var t=e.conversationID;this._map.has(t)&&(e=this._getUniqueIDOfMsg(e),(t=this._map.get(t).get(e))&&(t.isModified=!0))}},{key:"hasLocalMsgList",value:function(e){return this._map.has(e)}},{key:"getLocalMsgList",value:function(e){return this.hasLocalMsgList(e)?m(this._map.get(e).values()):[]}},{key:"getLocalMaxSeq",value:function(e){return this.hasLocalMsgList(e)?(e=m(this._map.get(e).values()).map((function(e){return e.sequence})),Math.max.apply(Math,m(e))):0}},{key:"getLocalMaxTime",value:function(e){return this.hasLocalMsgList(e)?(e=m(this._map.get(e).values()).map((function(e){return e.time})),Math.max.apply(Math,m(e))):0}},{key:"hasLocalMsg",value:function(e,t){for(var n=!1,o=this.getLocalMsgList(e),i=o.length,s=0;s<i;s++)o[s].ID===t&&(n=!0);return n}},{key:"getLocalMsg",value:function(e,t){for(var n=null,o=this.getLocalMsgList(e),i=o.length,s=0;s<i;s++)if(o[s].ID===t){n=o[s];break}return n}},{key:"getLocalLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-1]}},{key:"getLocalSecondLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-2]}},{key:"getLocalOldestMsg",value:function(e){return this.getLocalMsgList(e)[0]}},{key:"_setLatestMsgSentByPeer",value:function(e,t){e.startsWith(S.CONV_C2C)&&"in"===t.flow&&this._latestMsgSentByPeerMap.set(e,t)}},{key:"_setLatestMsgSentByMe",value:function(e,t){"out"===t.flow&&this._latestMsgSentByMeMap.set(e,t)}},{key:"getLatestMsgSentByPeer",value:function(e){return this._latestMsgSentByPeerMap.get(e)}},{key:"getLatestMsgSentByMe",value:function(e){return this._latestMsgSentByMeMap.get(e)}},{key:"modifyMsgSentByPeer",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar;if(!Be(e=this._map.get(t))){var i=Array.from(e.values());if(0!==(e=i.length)){for(var s=null,a=0,r=!1,c=e-1;0<=c;c--)"in"===i[c].flow&&((s=i[c]).nick!==n&&(s.setNickAndAvatar({nick:n}),r=!0),s.avatar!==o&&(s.setNickAndAvatar({avatar:o}),r=!0),r&&(a+=1));Oe.l("".concat(this._n,".modifyMsgSentByPeer convID:").concat(t," count:").concat(a))}}}},{key:"modifyMsgSentByMe",value:function(e){var t=e.conversationID,n=e.latestNick,o=e.latestAvatar;if(!Be(e=this._map.get(t))){var i=Array.from(e.values());if(0!==(e=i.length)){for(var s=null,a=0,r=!1,c=e-1;0<=c;c--)"out"===i[c].flow&&((s=i[c]).nick!==n&&(s.setNickAndAvatar({nick:n}),r=!0),s.avatar!==o&&(s.setNickAndAvatar({avatar:o}),r=!0),r&&(a+=1));Oe.l("".concat(this._n,".modifyMsgSentByMe convID:").concat(t," count:").concat(a))}}}},{key:"getTopicConvIDList",value:function(e){return m(this._map.keys()).filter((function(t){return t.startsWith("".concat(S.CONV_GROUP).concat(e))}))}},{key:"onMsgModified",value:function(e,t){if(!this._map.has(e)&&!this._hoppingMsgMap.has(e))return{isUpdated:!1,message:null};var n="".concat(this._n,".onMsgModified"),o=this._getUniqueIDOfMsg(t),i=this._getTargetMsg(e,o),s=!!i;return Oe.l("".concat(n," convID:").concat(e," uniqueID:").concat(o," has:").concat(s)),s?(e=t.messageVersion,o=t.elements,s=t.cloudCustomData,t=t.checkResult,Oe.l("".concat(n," localVersion:").concat(i.version," remoteVersion:").concat(e)),i.version<e?(i.version=e,i._elements=JSON.parse(JSON.stringify(o)),i.payload=i._elements[0].content,i.type=i._elements[0].type,i.cloudCustomData=s,i.isModified=!0,i.hasRiskContent=Kt(t),{isUpdated:!0,message:i}):{isUpdated:!1,message:i}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMsg",value:function(e){var t=e.from,n=e.to,o=e.random,i=e.sequence;return e=e.time,"".concat(t,"-").concat(n,"-").concat(o,"-").concat(i,"-").concat(e)}},{key:"_getTargetMsg",value:function(e,t){if(this._map.has(e))return this._map.get(e).get(t);var n=void 0;if(this._hoppingMsgMap.has(e))for(var o=m(this._hoppingMsgMap.get(e).values()),i=0;i<o.length;i++)if(this._getUniqueIDOfMsg(o[i])===t){n=o[i];break}return n}},{key:"storeHoppingMsgList",value:function(e){if(0!==e.length){var t=e[0].conversationID,n=e.length;this._hoppingMsgMap.has(t)||this._hoppingMsgMap.set(t,new Map);for(var o=this._hoppingMsgMap.get(t),i=0;i<n;i++){var s=e[i];o.has(s.ID)||o.set(s.ID,s)}}}},{key:"getHoppingMsg",value:function(e,t){if(this._hoppingMsgMap.has(e))return this._hoppingMsgMap.get(e).get(t)}},{key:"reset",value:function(){this._map.clear(),this._latestMsgSentByPeerMap.clear(),this._latestMsgSentByMeMap.clear(),this._hoppingMsgMap.clear()}}]),Ho);function Ho(e){o(this,Ho),this._convM=e,this._map=new Map,this._n="MsgListHandler",this._latestMsgSentByPeerMap=new Map,this._latestMsgSentByMeMap=new Map,this._hoppingMsgMap=new Map,this.TOPIC_MSG_LIMIT=1e3,this._convM.getIEmitInst().on(qo.CLOUD_CONFIG,this._onCloudConfig,this)}function jo(e){return o(this,jo),(e=xo.call(this,e))._n="C2CModule",e._msgFromUnreadDBMap=new Map,e._noticeFromUnreadDBList=[],e}function Ko(e){this.mixin(e)}function Yo(e,n,o){return ut(e)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:o&&e.ID||e instanceof So?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:wt(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:t(t({},e),{},{messageForShow:wt(e.type,e.payload,n)})}function zo(e,t){return Be(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:wt(e.type,e.payload,t),nick:e.nick||"",avatar:e.avatar||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}}function Wo(e){var t=String(e).replace(/[=]+$/,""),n="";if(t.length%4==1)return"";for(var o,i,s=0,a=0;i=t.charAt(a++);~i&&(o=s%4?64*o+i:i,s++%4)&&(n+=String.fromCharCode(255&o>>(-2*s&6))))i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);try{return decodeURIComponent(escape(n))}catch(r){return""}}Ko.mixin=function(e){(e=e.prototype||e)._isReady=!1,e.ready=function(e){if(e)return this._isReady?void(1<arguments.length&&void 0!==arguments[1]&&arguments[1]?e.call(this):setTimeout(e,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(e))},e.triggerReady=function(){var e=this;this._isReady=!0,setTimeout((function(){var t=e._readyQueue;e._readyQueue=[],t&&0<t.length&&t.forEach((function(e){e.call(this)}),e)}),1)},e.resetReady=function(){this._isReady=!1,this._readyQueue=[]},e.isReady=function(){return this._isReady}};var Jo,$o,Xo,Zo,Qo,ei=["jpg","jpeg","gif","png","bmp","image","webp"],ti=["mp4","quicktime","mov"],ni=(s(ss,[{key:"validate",value:function(e){var t,n=!0,o="";if(Be(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,s=null,a=0;a<i;a++){if(s=e.profileCustomField[a],!ct(s.key)||-1===s.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ct(s.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("profileCustomField"===t)continue;if(Be(e[t])&&!ct(e[t])&&!Ke(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":ct(e[t])||(n=!(o="nick must be a string")),500<et(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(et(e[t])," bytes"),n=!1);break;case"gender":it(Ue,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":Ke(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":ct(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":ct(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":it(we,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":Ke(e.language)||(n=!(o="language must be a number"));break;case"avatar":ct(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":it(Ge,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":Ke(e.level)||(n=!(o="level must be a number"));break;case"role":Ke(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}}]),ss),oi=(s(is,[{key:"set",value:function(e){var t;this.map.size>=this.MAX_LENGTH&&(t=this.map.entries().next().value[0],this.map.delete(t)),this.map.set(e,1)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"reset",value:function(){this.map.clear()}}]),is),ii=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],si=(s(os,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var t in e)ii.indexOf(t)<0||("selfInfo"!==t?("memberNum"===t&&(this.memberCount=e[t]),"maxMemberNum"===t&&(this.maxMemberCount=e[t]),"isSupportTopic"!==t?this[t]=e[t]:this.isSupportTopic=1===e[t]):this.updateSelfInfo(e[t]))}},{key:"updateGroup",value:function(e){var t=this;(e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0),e=JSON.parse(JSON.stringify(e))).lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),ut(e.muteAllMembers)||("On"===e.muteAllMembers?e.muteAllMembers=!0:e.muteAllMembers=!1),e.groupCustomField&&ft(this.groupCustomField,e.groupCustomField),ut(e.memberNum)||(this.memberCount=e.memberNum),ut(e.maxMemberNum)||(this.maxMemberCount=e.maxMemberNum),ut(e.isSupportTopic)||(this.isSupportTopic=Ke(e.isSupportTopic)?1===e.isSupportTopic:e.isSupportTopic),Ze(this,e,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),We(e.members)&&0<e.members.length&&e.members.forEach((function(e){e.userID===t.selfInfo.userID&&Ze(t.selfInfo,e,["sequence"])}))}},{key:"updateSelfInfo",value:function(e){e={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList},Ze(this.selfInfo,t({},e),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),os),ai=(s(ns,[{key:"toAccount",get:function(){return this.conversationID.startsWith(S.CONV_C2C)?this.conversationID.replace(S.CONV_C2C,""):this.conversationID.startsWith(S.CONV_GROUP)?this.conversationID.replace(S.CONV_GROUP,""):""}},{key:"_initProfile",value:function(e){var t=this;Object.keys(e).forEach((function(n){switch(n){case"userProfile":t.userProfile=e.userProfile;break;case"groupProfile":t.groupProfile=e.groupProfile}})),ut(this.userProfile)&&this.type===S.CONV_C2C?this.userProfile=new ni({userID:e.conversationID.replace("C2C","")}):ut(this.groupProfile)&&this.type===S.CONV_GROUP&&(this.groupProfile=new si({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var t=e.nextUnreadCount,n=e.isFromGetConversations;e=e.isUnreadC2CMessage,ut(t)||(yt(this.subType)?this.unreadCount=0:n&&this.type===S.CONV_GROUP||n&&this.type===S.CONV_TOPIC||e&&this.type===S.CONV_C2C?this.unreadCount=t:this.unreadCount=this.unreadCount+t)}},{key:"updateLastMessage",value:function(e){this.lastMessage=Yo(e)}},{key:"updateGroupAtInfoList",value:function(e){var t;this._isNeedMergeGroupAtInfo(e)||(-1!==(t=(v(t=e.groupAtType)||y(t)||I(t)||C()).slice(0)).indexOf(S.CONV_AT_ME)&&-1!==t.indexOf(S.CONV_AT_ALL)&&(t=[S.CONV_AT_ALL_AT_ME]),t={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:t,__random:e.__random,__sequence:e.__sequence},this.groupAtInfoList.push(t))}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var t=e.groupID,n=e.sequence;if(!It({groupID:t}))return!1;var o=!1;return this.groupAtInfoList.forEach((function(t){t.messageSequence===n&&(-1<t.atTypeArray.indexOf(S.CONV_AT_ME)&&-1<e.groupAtType.indexOf(S.CONV_AT_ALL)&&(t.atTypeArray=[S.CONV_AT_ALL_AT_ME]),-1<t.atTypeArray.indexOf(S.CONV_AT_ALL)&&-1<e.groupAtType.indexOf(S.CONV_AT_ME)&&(t.atTypeArray=[S.CONV_AT_ALL_AT_ME],t.__random=e.__random,t.__sequence=e.__sequence),o=!0)})),o}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){var t=e.sequence;return e=e.time,this.type===S.CONV_C2C&&t===this.lastMessage.lastSequence&&e===this.lastMessage.lastTime||this.type===S.CONV_GROUP&&t===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}},{key:"setDraftText",value:function(e){this.draftText=e}}]),ns),ri=(a(Q={},S.MSG_REMIND_ACPT_AND_NOTE,0),a(Q,S.MSG_REMIND_DISCARD,1),a(Q,S.MSG_REMIND_ACPT_NOT_NOTE,2),Q),ci=(s(ts,[{key:"onAllRcvMsgOptNotify",value:function(e){e=this._handleResult(e),this._convM.emitOEvt(E.ALL_RECEIVE_MESSAGE_OPT_UPDATED,e)}},{key:"getC2CMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".getC2CMsgRemindType");return this._convM.req({P:xn.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:e}}).then((function(o){Oe.l("".concat(n," ok. userIDList:").concat(e)),o=o.data.muteFlagList,t._convM.onC2CMsgRemindTypeFetched(o)})).catch((function(e){Oe.e("".concat(n," failed. error:"),e)}))}},{key:"set",value:function(e){return e.groupID?this._setGroupMsgRemindType(e):We(e.userIDList)?this._setC2CMsgRemindType(e):void 0}},{key:"_setGroupMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".").concat("_setGroupMsgRemindType"),o=e.groupID,i=e.messageRemindType,s="groupID:".concat(o," messageRemindType:").concat(i),a=new eo("_setGroupMsgRemindType"),r=(a.setMessage(s),this._get(7));return r?r.modifyGroupMemberInfo({groupID:o,messageRemindType:i,userID:this._convM.getMyUserID()}).then((function(){a.end(),Oe.l("".concat(n," ok. ").concat(s));var o=t.onGroupMsgRemindTypeUpdated(e);return t._convM.onTotalUnreadCountUpdate(),vn(o)})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)})):In({code:wn.NO_MODULE})}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){var t,n,o=e.groupID,i=(e=e.messageRemindType,Oe.l("".concat(this._n,".onGroupMsgRemindTypeUpdated groupID:").concat(o," messageRemindType:").concat(e)),this._get(7).getLocalGroupProfile(o));return i&&(i.selfInfo.messageRemindType=e),Mt(o)?(t=Gt(n=o),(n=this._get(10).getLocalTopic(t,n))&&n.updateSelfInfo({messageRemindType:e})&&this._convM.emitOEvt(E.TOPIC_UPDATED,{groupID:t,topic:n}),{topic:n}):(this._convM.patchMsgRemindType({ID:o,isC2CConversation:!1,messageRemindType:e})&&this._emitConvUpdate(),{group:i})}},{key:"_setC2CMsgRemindType",value:function(e){var t=this,n="".concat(this._n,".").concat("_setC2CMsgRemindType"),o=e.userIDList,i=e.messageRemindType,s=o.slice(0,30),a=(e=ri[i]||0,"userIDList:".concat(s," messageRemindType:").concat(i)),r=new eo("_setC2CMsgRemindType");return r.setMessage(a),this._convM.req({P:xn.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:s,muteFlag:e}}).then((function(e){r.end(),e=e.data.errorList;var o=[],c=[],u=(We(e)&&e.forEach((function(e){o.push(e.userID),c.push({userID:e.userID,code:e.errorCode})})),e=s.filter((function(e){return-1===o.indexOf(e)})),Oe.l("".concat(n," ok. ").concat(a," successUserIDList:").concat(e," failureUserIDList:").concat(JSON.stringify(c))),0);return e.forEach((function(e){t._convM.patchMsgRemindType({ID:e,isC2CConversation:!0,messageRemindType:i})&&(u+=1)})),1<=u&&t._emitConvUpdate(),s.length=o.length=0,t._convM.onTotalUnreadCountUpdate(),yn({successUserIDList:e.map((function(e){return{userID:e}})),failureUserIDList:c})})).catch((function(e){return r.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"_get",value:function(e){return this._convM.get(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"setAllRcvMsgOpt",value:function(e){var t="".concat(this._n,".").concat("setAllRcvMsgOpt"),n=void 0===(n=e.messageRemindType)?S.MSG_REMIND_ACPT_NOT_NOTE:n,o=void 0===(o=e.isRepeated)||o,i=void 0===(i=(s=this._calcStartAndEndTime(e)).startTime)?0:i,s=void 0===(s=s.endTime)?0:s,a=(e=JSON.stringify(e),new eo("setAllRcvMsgOpt"));return a.setMessage(e),Oe.l("".concat(t," options:").concat(e)),this._convM.req({P:xn.SET_ALL_RECEIVE_MSG_OPT,data:{messageRemindType:ri[n],startTime:i,endTime:s,isRepeated:o?1:0}}).then((function(e){return a.end(),Oe.l("".concat(t," ok.")),vn(e)})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_calcStartAndEndTime",value:function(e){var t=void 0===(t=e.startHour)?0:t,n=void 0===(n=e.startMinute)?0:n,o=void 0===(o=e.startSecond)?0:o,i=void 0===(i=e.duration)?0:i,s=(e=void 0===(e=e.isRepeated)||e,(r=new Date).getFullYear()),a=r.getMonth(),r=r.getDate();return{startTime:s=Math.round(new Date(s,a,r,t,n,o).getTime()/1e3),endTime:e&&86400<=i?s+86400:s+i}}},{key:"getAllRcvMsgOpt",value:function(){var e=this,t="".concat(this._n,".").concat("getAllRcvMsgOpt"),n=new eo("getAllRcvMsgOpt");return this._convM.req({P:xn.GET_ALL_RECEIVE_MSG_OPT,data:{toAccount:this._convM.getMyUserID()}}).then((function(o){return o=o.data,n.setMessage(JSON.stringify(o)).end(),Oe.l("".concat(t," ok. data:").concat(JSON.stringify(o))),vn(o=e._handleResult(o))})).catch((function(e){return n.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_handleResult",value:function(e){var t=e.messageRemindType,n=e.startTime,o=e.endTime,i=(e=e.isRepeated,S.MSG_REMIND_ACPT_AND_NOTE);return 1===t&&(i=S.MSG_REMIND_DISCARD),{messageRemindType:i=2===t?S.MSG_REMIND_ACPT_NOT_NOTE:i,startTime:n,endTime:o,isRepeated:1===e}}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset"))}}]),ts),ui=(s(es,[{key:"setConvCustomData",value:function(e){var t=this,n="".concat(this._n,".").concat("setConvCustomData"),o=e.conversationIDList,i=e.customData,s=(Oe.l("".concat(n," options:"),e),new eo("setConvCustomData")),a=(s.setMessage(JSON.stringify(e)),{fromAccount:this._getMyUserID(),itemList:[]}),r=[],c=[];return o.forEach((function(e){if(!t._hasLocalConv(e))return t._onConvNotFound(c,e),!0;if(!Ct(e)&&!Tt(e))return t._onConvIDInvalid(c,e),!0;var n={operationType:2,contactItem:void 0,customMark:i};Ct(e)?n.contactItem={type:1,toAccount:e.replace(S.CONV_C2C,"")}:Tt(e)&&(n.contactItem={type:2,groupID:e.replace(S.CONV_GROUP,"")}),a.itemList.push(n)})),c.length===o.length?yn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:xn.SET_CONV_CUSTOM_DATA,data:a}).then((function(e){var o,a,u;return s.end(),Oe.l("".concat(n," ok")),We(e=e.data.resultItem)&&(u=!1,e.forEach((function(e){o=t._concatConvID(e.contactItem),0===e.resultCode?(r.push(o),(a=t._getLocalConv(o))&&a.customData!==i&&(a.customData=i,u=!0)):c.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===u&&t._emitConvUpdate()),vn({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return s.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"markConv",value:function(e){var t=this;if(!this._convM.canIUse(U.CONV_MARK))return this._convM.noUse("markConv");var n="".concat(this._n,".").concat("markConv"),o=e.conversationIDList,i=e.markType,s=e.enableMark,a=(Oe.l("".concat(n," options:"),e),new eo("markConv")),r=void a.setMessage(JSON.stringify(e)),c=void 0,u=(e=this._getFlagBit(i),!0===s?c=[e]:r=[e],{fromAccount:this._getMyUserID(),itemList:[]}),l=[],d=[];return o.forEach((function(e){if(!t._hasLocalConv(e))return t._onConvNotFound(d,e),!0;if(!Ct(e)&&!Tt(e))return t._onConvIDInvalid(d,e),!0;var n={operationType:1,contactItem:void 0,clearMark:r,setMark:c};Ct(e)?n.contactItem={type:1,toAccount:e.replace(S.CONV_C2C,"")}:Tt(e)&&(n.contactItem={type:2,groupID:e.replace(S.CONV_GROUP,"")}),u.itemList.push(n)})),d.length===o.length?yn({successConversationIDList:l,failureConversationIDList:d}):this._convM.req({P:xn.MARK_CONV,data:u}).then((function(e){var o,r,c;return a.end(),Oe.l("".concat(n," ok")),We(e=e.data.resultItem)&&(c=!1,e.forEach((function(e){var n;o=t._concatConvID(e.contactItem),0===e.resultCode?(l.push(o),(r=t._getLocalConv(o))&&(n=r.markList.indexOf(i),!0===s?-1===n&&(r.markList.push(i),c=!0):-1!==n&&(r.markList.splice(n,1),c=!0))):d.push({conversationID:o,code:e.resultCode,message:e.resultInfo})})),!0===c&&t._emitConvUpdate()),vn({successConversationIDList:l,failureConversationIDList:d})})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"getLocalConvGroupList",value:function(){var e=this;return Oe.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===An?this.getRemoteConvGroupList().then((function(){return vn(m(e._convGroupMap.values()))})):yn(m(this._convGroupMap.values()))}},{key:"searchConvGroupAndMark",value:function(e,t){var n=this,o="".concat(this._n,".searchConvGroupAndMark"),i=[];return e.forEach((function(e){1===t?i.push({type:1,toAccount:e}):2===t&&i.push({type:2,groupID:e})})),Oe.l("".concat(o," type:").concat(t," list:"),e),this._convM.req({P:xn.SEARCH_CONV_GRP_MARK,data:{fromAccount:this._getMyUserID(),contactItem:i}}).then((function(e){var t=(e=e.data).contactItem;e=e.groupItem,Oe.l("".concat(o," ok. contactItem:"),t,"groupItem:",e),n._fillConvGroupMap(e),n._handleContactItem(t),n._emitConvUpdate()})).catch((function(e){Oe.w("".concat(o," failed. error:"),e)}))}},{key:"_fillConvGroupMap",value:function(e){var t=this;We(e)&&e.forEach((function(e){var n=e.convGroupID;e=e.groupName,t._convGroupMap.set(n,e)}))}},{key:"_handleContactItem",value:function(e){var t,n=this;We(e)&&e.forEach((function(e){var o=[],i=e.standardMark,s=e.customData,a=e.convGroupIDList;We(a)&&a.forEach((function(e){n._convGroupMap.has(e)&&o.push(n._convGroupMap.get(e))})),t=n._concatConvID(e),(t=n._getLocalConv(t))&&(t.markList=xt(i),t.customData=s||"",t.conversationGroupList=[].concat(o))}))}},{key:"getRemoteConvGroupList",value:function(){var e=this,t="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=Rn,this._convM.req({P:xn.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex}}).then((function(n){var o=(n=n.data).completeFlag,i=n.contactItem,s=void 0===(s=n.nextStartIndex)?0:s;if(n=n.groupItem,e._startIndex=s,Oe.l("".concat(t," completeFlag:").concat(o," nextStartIndex:").concat(s,", groupItem:"),n,"contactItem:",i),e._fillConvGroupMap(n),e._handleContactItem(i),0===o)return e.getRemoteConvGroupList();1===o&&(e._pagingStatus=Ln,e._emitConvUpdate(),e._emitConvGroupListUpdate())})).catch((function(n){e._pagingStatus=An,Oe.w("".concat(t," failed. error:"),n)}))}},{key:"createConvGroup",value:function(e){var t=this;if(!this._convM.canIUse(U.CONV_GROUP))return this._convM.noUse("createConvGroup");var n="".concat(this._n,".").concat("createConvGroup"),o=(Oe.l("".concat(n," options:"),e),new eo("createConvGroup")),i=(o.setMessage(JSON.stringify(e)),e.groupName),s=(e=e.conversationIDList,{fromAccount:this._getMyUserID(),itemList:[{groupName:i,contactItem:[]}]}),a=[],r=[];return e.forEach((function(e){return t._hasLocalConv(e)?Ct(e)||Tt(e)?void(Ct(e)?s.itemList[0].contactItem.push({type:1,toAccount:e.replace(S.CONV_C2C,"")}):Tt(e)&&s.itemList[0].contactItem.push({type:2,groupID:e.replace(S.CONV_GROUP,"")})):(t._onConvIDInvalid(r,e),!0):(t._onConvNotFound(r,e),!0)})),r.length===e.length?yn({successConversationIDList:a,failureConversationIDList:r}):this._convM.req({P:xn.CREATE_CONV_GRP,data:s}).then((function(e){o.end(),Oe.l("".concat(n," ok"));var s,c,u,l=(e=e.data.groupResultItem[0]).groupItem;return e=e.resultItem,ze(l)&&(t._convGroupMap.set(l.convGroupID,l.groupName),t._emitConvGroupListUpdate()),We(e)&&(u=!1,e.forEach((function(e){s=t._concatConvID(e.contactItem),0===e.resultCode?(a.push(s),(c=t._getLocalConv(s))&&-1===c.conversationGroupList.indexOf(i)&&(c.conversationGroupList.push(i),u=!0)):r.push({conversationID:s,code:e.resultCode,message:e.resultInfo})})),!0===u&&(t._emitConvUpdate(),t._emitConvGroupListUpdate())),vn({successConversationIDList:a,failureConversationIDList:r})})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"deleteConvGroup",value:function(e){var t=this;if(!this._convM.canIUse(U.CONV_GROUP))return this._convM.noUse("deleteConvGroup");var n="".concat(this._n,".").concat("deleteConvGroup"),o=(Oe.l("".concat(n," groupName:").concat(e)),new eo("deleteConvGroup"));return o.setMessage(e),this._convM.req({P:xn.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[e]}}).then((function(i){var s;o.end(),Oe.l("".concat(n," ok")),We(i=i.data.groupItem)&&(s=!1,i.forEach((function(e){t._convGroupMap.has(e.convGroupID)&&(t._convGroupMap.delete(e.convGroupID),s=!0)})),!0===s&&t._emitConvGroupListUpdate()),t._eraseFromConversationGroupList([e])})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"renameConvGroup",value:function(e){var t=this;if(!this._convM.canIUse(U.CONV_GROUP))return this._convM.noUse("renameConvGroup");var n="".concat(this._n,".").concat("renameConvGroup"),o=(Oe.l("".concat(n," options:"),e),new eo("renameConvGroup")),i=(o.setMessage(JSON.stringify(e)),e.oldName),s=e.newName;return this._convM.req({P:xn.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:i,newName:s}}}).then((function(e){o.end(),Oe.l("".concat(n," ok")),e=e.data.updateGroupResult.convGroupID,t._convGroupMap.set(e,s),t._emitConvGroupListUpdate(),e=t._convM.getLocalConvList();var a,r,c=!1;e.forEach((function(e){a=e.conversationGroupList,-1!==(r=a.indexOf(i))&&(a.splice(r,1,s),c=!0)})),!0===c&&t._emitConvUpdate()})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"addConvsToGroup",value:function(e){var t=this;if(!this._convM.canIUse(U.CONV_GROUP))return this._convM.noUse("addConvsToGroup");var n="".concat(this._n,".").concat("addConvsToGroup"),o=(Oe.l("".concat(n," options:"),e),new eo("addConvsToGroup")),i=(o.setMessage(JSON.stringify(e)),e.conversationIDList),s=e.groupName,a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:s,updateItem:[]}},r=[],c=[];return i.forEach((function(e){return t._hasLocalConv(e)?Ct(e)||Tt(e)?void(Ct(e)?a.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:e.replace(S.CONV_C2C,"")}}):Tt(e)&&a.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:e.replace(S.CONV_GROUP,"")}})):(t._onConvIDInvalid(c,e),!0):(t._onConvNotFound(c,e),!0)})),c.length===i.length?yn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:xn.ADD_CONV_TO_GRP,data:a}).then((function(e){var i,a,u;return o.end(),Oe.l("".concat(n," ok")),We(e=e.data.updateGroupResult.contactResultItem)&&(u=!1,e.forEach((function(e){i=t._concatConvID(e.contactItem),0===e.resultCode?(a=t._getLocalConv(i))&&-1===a.conversationGroupList.indexOf(s)&&(a.conversationGroupList.push(s),r.push(i),u=!0):c.push({conversationID:i,code:e.resultCode,message:e.resultInfo})})),!0===u&&(t._emitConvUpdate(),t._emitConvInGroupUpdate(s))),vn({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"deleteConvsFromGroup",value:function(e){var t=this,n="deleteConvsFromGroup";if(!this._convM.canIUse(U.CONV_GROUP))return this._convM.noUse(n);var o="".concat(this._n,".").concat(n),i=(Oe.l("".concat(o," options:"),e),new eo(n)),s=(i.setMessage(JSON.stringify(e)),n=e.conversationIDList,e.groupName),a={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:s,updateItem:[]}},r=[],c=[];return n.forEach((function(e){return t._hasLocalConv(e)?Ct(e)||Tt(e)?void(Ct(e)?a.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:e.replace(S.CONV_C2C,"")}}):Tt(e)&&a.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:e.replace(S.CONV_GROUP,"")}})):(t._onConvIDInvalid(c,e),!0):(t._onConvNotFound(c,e),!0)})),c.length===n.length?yn({successConversationIDList:r,failureConversationIDList:c}):this._convM.req({P:xn.DEL_CONV_FROM_GRP,data:a}).then((function(e){var n,a,u;return i.end(),Oe.l("".concat(o," ok")),We(e=e.data.updateGroupResult.contactResultItem)&&(u=!1,e.forEach((function(e){var o;n=t._concatConvID(e.contactItem),0===e.resultCode?!(a=t._getLocalConv(n))||-1!==(o=a.conversationGroupList.indexOf(s))&&(a.conversationGroupList.splice(o,1),r.push(n),u=!0):c.push({conversationID:n,code:e.resultCode,message:e.resultInfo})})),!0===u&&(t._emitConvUpdate(),t._emitConvInGroupUpdate(s))),vn({successConversationIDList:r,failureConversationIDList:c})})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"onConvMarkUpdated",value:function(e){var t,n,o=this;Be(e)||(Oe.l("".concat(this._n,".onConvMarkUpdated markItemList:"),e),n=!1,e.forEach((function(e){var i=e.recentContactItem,s=e.optType,a=e.standardMark;e=e.customMark,t=o._concatConvID(i),(t=o._getLocalConv(t))&&(1===s?n=o._diffStandardMark(t,a):2===s?n=o._diffCustomMark(t,e):3===s&&(i=o._diffStandardMark(t,a),s=o._diffCustomMark(t,e),n=i||s))})),!0===n&&this._emitConvUpdate())}},{key:"_diffStandardMark",value:function(e,t){t=xt(t);var n=!1;return!0!==function(e,t){if(e===t)return!0;if(!e||!t)return!1;if(e.length!==t.length)return!1;for(var n=0,o=e.length;n<o;n++)if(e[n]!==t[n])return!1;return!0}(e.markList,t)&&(e.markList=t,n=!0),n}},{key:"_diffCustomMark",value:function(e,t){var n=!1;return e.customData!==t&&void 0!==t&&(e.customData=t,n=!0),n}},{key:"onConvGroupCreated",value:function(e){var t=this,n=(Oe.l("".concat(this._n,".onConvGroupCreated resultList:"),e),!1),o=!1;We(e)&&(e.forEach((function(e){var i,s,a=(s=e.msgGroupItem).groupID,r=s.groupName;t._convGroupMap.get(a)!==r&&(t._convGroupMap.set(a,r),o=!0),We(s=e.msgRecentContactItem)&&s.forEach((function(e){i=t._concatConvID(e),(i=t._getLocalConv(i))&&-1===i.conversationGroupList.indexOf(r)&&(i.conversationGroupList.push(r),n=!0)}))})),!0===n&&this._emitConvUpdate(),!0===o&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var t,n=this,o=(Oe.l("".concat(this._n,".onConvGroupDeleted groupItemList:"),e),[]);We(e)&&(t=!1,e.forEach((function(e){var i=e.groupID;e=e.groupName,n._convGroupMap.has(i)&&(n._convGroupMap.delete(i),t=!0,o.push(e))})),!0===t&&this._emitConvGroupListUpdate()),this._eraseFromConversationGroupList(o)}},{key:"_eraseFromConversationGroupList",value:function(e){Be(e)||(this._convM.getLocalConvList().forEach((function(t){t.conversationGroupList=t.conversationGroupList.filter((function(t){return!e.includes(t)}))})),this._emitConvUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){Oe.l("".concat(this._n,".onConvGroupNameUpdated options:"),e);var t,n,o,i=e.groupID,s=e.groupName,a=e.oldGroupName;this._convGroupMap.get(i)!==s&&(this._convGroupMap.set(i,s),this._emitConvGroupListUpdate(),e=this._convM.getLocalConvList(),o=!1,e.forEach((function(e){t=e.conversationGroupList,-1!==(n=t.indexOf(a))&&(t.splice(n,1,s),o=!0)})),!0===o&&this._emitConvUpdate())}},{key:"onConvInGroupUpdated",value:function(e){var t,n,o,i=this,s=(Oe.l("".concat(this._n,".onConvInGroupUpdated options:"),e),e.oldGroupName);We(e=e.recentContactUpdateGroupItem)&&(o=!1,e.forEach((function(e){var a=e.contactOptType;e=e.recentContactItem,t=i._concatConvID(e),(t=i._getLocalConv(t))&&(n=t.conversationGroupList.indexOf(s),1===a?-1===n&&(t.conversationGroupList.push(s),o=!0):2===a&&-1!==n&&(t.conversationGroupList.splice(n,1),o=!0))})),!0===o&&(this._emitConvUpdate(),this._emitConvInGroupUpdate(s)))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var t,n,o=this,i=(Oe.l("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e),e.msgRecentContactItem),s=(e=e.msgRecentContactUpdateContactItem,i=this._concatConvID(i),this._getLocalConv(i));s&&We(e)&&(n=!1,e.forEach((function(e){var i=e.groupOptType;e=e.recentContactGroupItem.groupName,t=s.conversationGroupList.indexOf(e),1===i?-1===t&&(s.conversationGroupList.push(e),n=!0):2===i&&-1!==t&&(s.conversationGroupList.splice(t,1),n=!0),!0===n&&o._emitConvInGroupUpdate(e)})),!0===n&&this._emitConvUpdate())}},{key:"onConvGroupListSynced",value:function(e){We(e)&&0!==e.length&&(Oe.l("".concat(this._n,".onConvGroupListSynced groupItem:"),e),this._fillConvGroupMap(e))}},{key:"getConvGroupListByID",value:function(e){var t,n=this;if(!Be(e))return t=[],e.forEach((function(e){n._convGroupMap.has(e)&&t.push(n._convGroupMap.get(e))})),t}},{key:"_onConvNotFound",value:function(e,t){e.push({conversationID:t,code:wn.CONV_NOT_FOUND,message:this._convM.getErrMsg(wn.CONV_NOT_FOUND)})}},{key:"_onConvIDInvalid",value:function(e,t){e.push({conversationID:t,code:wn.INVALID_CONV_ID,message:this._convM.getErrMsg(wn.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(e){for(var t=e.toString(2),n=t.length,o=n-1;0<=o;o--)if("1"===t[o])return n-o-1}},{key:"_concatConvID",value:function(e){var t,n=e.type,o=e.to,i=e.groupID;return e=e.userID,1===n?ut(e)?ut(o)||(t="".concat(S.CONV_C2C).concat(o)):t="".concat(S.CONV_C2C).concat(e):2===n&&(t="".concat(S.CONV_GROUP).concat(i)),t}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_getLocalConv",value:function(e){return this._convM.getLocalConversation(e)}},{key:"_hasLocalConv",value:function(e){return this._convM.hasLocalConversation(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOEvt(E.CONVERSATION_GROUP_LIST_UPDATED,m(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var t={groupName:e,conversationList:[]},n=this._convM.getLocalConvList();t.conversationList=n.filter((function(t){return t.conversationGroupList.includes(e)})),this._convM.emitOEvt(E.CONVERSATION_IN_GROUP_UPDATED,t)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=kn}}]),es),li=(r(Qi,Nn),Qo=g(Qi),s(Qi,[{key:"_initListeners",value:function(){var e=this.getIEmitInst();e.on(qo.A2KEY_AND_TINYID_UPDATED,this._init,this),e.on(qo.PROFILE_UPDATED,this._onProfileUpdated,this),e.on(qo.CLOUD_CONFIG,this._onCloudConfig,this)}},{key:"_init",value:function(){var e=this,t=(Oe.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),n=this.isIntl(),o=this.isUsingChatCore();if(t){for(var i=t.length,s=0;s<i;s++){var a=t[s];if(a){if(this._isNonExistentAccount(a.conversationID))continue;if(a.groupProfile&&yt(a.groupProfile.type))continue}this._convMap.set(a.conversationID,new ai(t[s],n,o))}this.emitConvUpdate(!0,!1)}this.ready((function(){0<e._tmpGroupList.length&&(e.updateConvGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)})),this.syncConvList()}},{key:"_isNonExistentAccount",value:function(e){var t;return"@TLS#ERROR"===(t=e.startsWith(S.CONV_C2C)?e.replace(S.CONV_C2C,""):t)||"@TLS#NOT_FOUND"===t}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&this._msgListHandler.onCheckTimer(e)}},{key:"onMessageSent",value:function(e){this._onSendOrRcvMsg({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrRcvMsg(e)}},{key:"_onSendOrRcvMsg",value:function(e){var t=this,n=e.conversationOptionsList,o=void 0===(o=e.isInstantMessage)||o,i=void 0!==(i=e.isUnreadC2CMessage)&&i,s=void 0===(s=e.updateUnreadCount)||s,a=void 0!==(a=e.isSyncingEnded)&&a;this._isReady?0!==n.length?(!0===o&&this._checkNewConv(n),this._updateLocalConvList({conversationOptionsList:n,isInstantMessage:o,isUnreadC2CMessage:i,isFromGetConversations:!1,updateUnreadCount:s}),o||(this._convIDFromUnreadDBMap=new Map([].concat(m(this._convIDFromUnreadDBMap),m(n.map((function(e){return[e.conversationID,1]}))))),this._diffAndDeleteConv(),a&&this.emitIEvt(qo.C2C_UNREAD_HANDLE_COMPLETED)),0<n.filter((function(e){return!t._isConvNeedShow(e.conversationID)})).length||this.emitConvUpdate()):a&&this.emitIEvt(qo.C2C_UNREAD_HANDLE_COMPLETED):this.ready((function(){t._onSendOrRcvMsg(e)}))}},{key:"updateConvGroupProfile",value:function(e){var t,n=this;We(e)&&0===e.length||(0!==this._convMap.size?(t=!1,e.forEach((function(e){var o="".concat(S.CONV_GROUP).concat(e.groupID);n._convMap.has(o)&&(t=!0,(o=n._convMap.get(o)).groupProfile=JSON.parse(JSON.stringify(e)),o.lastMessage.lastSequence<e.nextMessageSeq&&(o.lastMessage.lastSequence=e.nextMessageSeq-1),o.subType||(o.subType=e.type))})),t&&this.emitConvUpdate(!0,!1)):this._tmpGroupList=e)}},{key:"onMessageRevoked",value:function(e,t){var n,o,i,s=this;0!==e.length&&(n=null,o=!1,i=[],e.forEach((function(e){(n=s._convMap.get(e.conversationID))&&(t&&n.reduceUnreadCount()&&(o=n.type!==S.CONV_TOPIC),n.type===S.CONV_TOPIC?i.push(e):n.isLastMessageRevoked({sequence:e.sequence,time:e.time})&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(e.revoker),o=!0))})),this.get(10).onMessageRevoked(i),o&&this.emitConvUpdate(!0,!1))}},{key:"updateRevokerInfo",value:function(e){for(var t=new Set,n=0;n<e.length;n++){var o=e[n].revoker;t.add(o)}var i=m(t),s=this.get(4);return new Promise((function(t){s.getUserProfile({userIDList:i}).then((function(n){if(!We(n=n.data)||0===n.length)return t(e);var o,i={},s=T(n);try{for(s.s();!(o=s.n()).done;){var a=o.value,r=a.userID,c=a.nick,u=a.avatar;i[r]={nick:c,avatar:u}}}catch(l){s.e(l)}finally{s.f()}e.forEach((function(e){var t=e.revoker;i[t]&&(e.revokerInfo.nick=i[t].nick||"",e.revokerInfo.avatar=i[t].avatar||"")})),t(e)})).catch((function(){t(e)}))}))}},{key:"isLastMessageRevoked",value:function(e){var t=!1,n=e.conversationID,o=e.sequence,i=e.time,s=this._convMap.get(n);return s&&(t=s.type===S.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:n.replace(S.CONV_GROUP,""),sequence:o}):s.isLastMessageRevoked({sequence:o,time:i})),Oe.l("".concat(this._n,".isLastMessageRevoked options:"),e,"ret:".concat(t)),t}},{key:"onMessageDeleted",value:function(e){var t=this;if(0!==e.length){var n=null;e.forEach((function(e){(n=t._msgListHandler.getLocalMsg(e.conversationID,e.ID))&&(n.isDeleted=!0),e!==n&&(e.isDeleted=!0)})),e=e[0].conversationID;for(var o=this._msgListHandler.getLocalMsgList(e),i={},s=o.length-1;0<=s;s--)if(!o[s].isDeleted){i=o[s];break}var a,r=this._convMap.get(e);r&&(a=!1,r.lastMessage.lastSequence===i.sequence&&r.lastMessage.lastTime===i.time||(Be(i)&&(i=void 0),r.updateLastMessage(i),r.type!==S.CONV_TOPIC&&(a=!0),Oe.l("".concat(this._n,".onMessageDeleted. update convID:").concat(e," with lastMessage:"),r.lastMessage)),e.startsWith(S.CONV_C2C)&&this.updateUnreadCount(e),a&&this.emitConvUpdate(!0,!1))}}},{key:"onMessageModified",value:function(e){var t="".concat(this._n,".onMessageModified"),n=e.conversationType,o=e.from,i=e.to,s=e.time,a=e.sequence,r=e.elements,c=e.cloudCustomData,u=e.messageVersion,l=this.getMyUserID(),d="".concat(n).concat(i),p=(n=(i===l&&n===S.CONV_C2C&&(d="".concat(n).concat(o)),l=this._msgListHandler.onMsgModified(d,e)).isUpdated,l=l.message,!0===n&&this.emitOEvt(E.MESSAGE_MODIFIED,[l]),this._isTopicConv(d));return null===l?Oe.l("".concat(t," message is null! options:"),e):Oe.l("".concat(t," isUpdated:").concat(n," isTopicMessage:").concat(p," from:").concat(o," to:").concat(i," sequence:").concat(l.sequence," time:").concat(l.time)),p?this.get(10).onMessageModified(e):!(n=this._convMap.get(d))||(o=n.lastMessage)&&o.lastTime===s&&o.lastSequence===a&&o.version!==u&&(Oe.l("".concat(t," convID:").concat(d," lastMessage updated")),o.type=r[0].type,o.payload=r[0].content,o.messageForShow=wt(o.type,o.payload,this.isIntl()),o.cloudCustomData=c,o.version=u,this.emitConvUpdate(!0,!1)),l}},{key:"onNewGroupAtTips",value:function(e){var n=this,o=(e=e.dataList,null);e.forEach((function(e){e.groupAtTips?o=e.groupAtTips:e.elements?o=t(t({},e.elements),{},{sync:!0}):e.groupAtType&&(o=t(t({},e),{},{sync:!0})),o.__random=e.random,o.__sequence=e.clientSequence,n._tmpGroupAtTipsList.push(o)})),Oe.l("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e,t=this;0!==this._tmpGroupAtTipsList.length&&(e=!1,this._tmpGroupAtTipsList.forEach((function(n){var o,i=n.groupID,s=n.from,a=void 0===(a=n.topicID)?void 0:a,r=void 0!==(r=n.sync)&&r;s!==t.getMyUserID()&&(ut(a)?(s=t._convMap.get("".concat(S.CONV_GROUP).concat(i)))&&(s.updateGroupAtInfoList(n),e=!0):((i=t._convMap.get("".concat(S.CONV_GROUP).concat(a)))&&(i.updateGroupAtInfoList(n),s=t.get(10),o=i.groupAtInfoList,s.onAtInfoUpdated({topicID:a,groupAtInfoList:o})),Be(i)&&r&&(t.updateTopicConversation([{conversationID:"".concat(S.CONV_GROUP).concat(a),type:S.CONV_TOPIC}]),t._convMap.get("".concat(S.CONV_GROUP).concat(a)).updateGroupAtInfoList(n))))})),e&&this.emitConvUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConv",value:function(e){var t=this,n=[],o=[];e.forEach((function(e){t._convMap.has(e.conversationID)||(e.type===S.CONV_C2C?n.push(e.conversationID.replace(S.CONV_C2C,"")):e.type===S.CONV_GROUP&&o.push(e.conversationID.replace(S.CONV_GROUP,"")))})),0<n.length&&(this._onNewC2CConv(n),n=null),0<o.length&&(this._onNewGroupConv(o),o=null)}},{key:"_onNewC2CConv",value:function(e){var t=this.get(6);return Promise.all([t.getRemotePeerReadTime(e),this._msgRemindHandler.getC2CMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,1)])}},{key:"_onNewGroupConv",value:function(e){var t=this.get(7);return t?Promise.all([t.getMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,2)]):Promise.resolve()}},{key:"_setStorageConvList",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=this.getLocalConvList().filter((function(e){return e.type===S.CONV_C2C||e.type===S.CONV_GROUP&&e.lastMessage.type!==S.MSG_GRP_TIP})).slice(0,20).map((function(e){return{conversationID:e.conversationID,type:e.type,subType:e.subType,lastMessage:e.lastMessage,groupProfile:e.groupProfile,userProfile:e.userProfile}}));this.get(13).setItem("conversationMap",t,e)}},{key:"emitConvUpdate",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.getLocalConvList();!t||(t=this.get(7))&&t.updateGroupLastMessage(n),e&&(this.get(12).isPartialUpdatedConvs()?(this._diffConvMap(this._convMapForDiff,this._convMap),0<this._partialUpdatedConvMap.size&&(this.emitOEvt(E.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate(),this._convMapForDiff.clear(),this._convMapForDiff=Qe(this._convMap,!0)),0===this._convMapForDiff.size&&(this._convMapForDiff=Qe(this._convMap,!0))):(this.emitOEvt(E.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate()))}},{key:"_diffConvMap",value:function(e,t){var n,o=T(t);try{for(o.s();!(n=o.n()).done;){var i=f(n.value,2),s=i[0],a=i[1];e.has(s)&&JSON.stringify(a)===e.get(s)||this._partialUpdatedConvMap.set(s,a)}}catch(r){o.e(r)}finally{o.f()}}},{key:"getPartialUpdatedConvs",value:function(){var e=m(Qe(this._partialUpdatedConvMap,!1).values());return this._partialUpdatedConvMap.clear(),e}},{key:"getLocalConvList",value:function(){var e=this;return m(this._convMap.values()).filter((function(t){return e._isConvNeedShow(t.conversationID)}))}},{key:"getLocalConversation",value:function(e){return this._convMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._convMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._msgListHandler.getLocalOldestMsg(e)}},{key:"syncConvList",value:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n="syncConvList",o=new eo(n);return this._pagingStatus===kn&&this._convMap.clear(),this._pagingGetConvList(t).then((function(t){var i=Ht(e._pagingGetCostList),s=Bt(e._pagingGetCostList);return e._pagingGetCostList.length=0,e._pagingStatus=Ln,e._diffAndDeleteConv(),e.emitConvUpdate(!0,!1),e._setStorageConvList(),e._handleC2CPeerReadTime(),e.emitIEvt(qo.CONV_SYNC_COMPLETED),s="count:".concat(e._convMap.size," sum:").concat(s," avg:").concat(i),Oe.l("".concat(e._n,".").concat(n,". ").concat(s)),o.setMessage(s).end(),t})).catch((function(t){return e._pagingStatus=An,o.setMessage(e._pagingTs).setError(t).end(),In(t)}))}},{key:"_diffAndDeleteConv",value:function(){var e,t=this;this._isSyncCompleted()&&(e=[],this._convMap.forEach((function(n,o){!t._pagingConvIDMap.has(o)&&t._convIDFromUnreadDBMap.has(o)&&(t._convMap.delete(o),e.push(o))})),Oe.l("".concat(this._n,"._diffAndDeleteConv list:").concat(e)),e=null)}},{key:"_pagingGetConvList",value:function(){var e=this,t=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],n="".concat(this._n,"._pagingGetConvList"),o=(Oe.l("".concat(n," incrementalPullFlag:").concat(t," ts:").concat(this._pagingTs," startIdx:").concat(this._pagingStartIdx)+" pinnedTs:".concat(this._pagingPinnedTs," pinnedStartIdx:").concat(this._pagingPinnedStartIdx)),Date.now());return this._pagingStatus=Rn,this.req({P:xn.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:t?this._pagingTs:0,startIndex:t?this._pagingStartIdx:0,pinnedTimeStamp:t?this._pagingPinnedTs:0,pinnedStartIndex:t?this._pagingPinnedStartIdx:0,orderType:1}}).then((function(t){var i=(t=t.data).completeFlag,s=void 0===(s=t.conversations)?[]:s,a=t.timeStamp,r=t.startIndex,c=t.pinnedTimeStamp,u=t.pinnedStartIndex;if(t=t.groupItem,e._pagingGetCostList.push(jt(o,!1)),Oe.l("".concat(n," ok. completeFlag:").concat(i," count:").concat(s.length," cost:").concat(jt(o))),e._convGroupHandler.onConvGroupListSynced(t),0<s.length&&(t=e._getConvOptions(s),e._pagingConvIDMap=new Map([].concat(m(e._pagingConvIDMap),m(t.map((function(e){return[e.conversationID,1]}))))),e._updateLocalConvList({conversationOptionsList:t,isFromGetConversations:!0,updateUnreadCount:!0}),e.isLoggedIn()&&e.emitConvUpdate()),!e._isReady){if(!e.isLoggedIn())return yn();e.triggerReady()}return e._pagingTs=a,e._pagingStartIdx=r,e._pagingPinnedTs=c,e._pagingPinnedStartIdx=u,1!==i?e._pagingGetConvList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),yn())})).catch((function(t){throw e.isLoggedIn()&&(e._isReady||(Oe.w("".concat(n," failed. error:"),t),e.triggerReady())),t}))}},{key:"_updateLocalConvList",value:function(e){var t=e.isFromGetConversations,n=Date.now();e=this._getTmpConvListMapping(e).newConvList,this._convMap=new Map(this._sortConvList(m(this._convMap))),t||this._updateUserOrGroupProfile(e),Oe.l("".concat(this._n,"._updateLocalConvList cost:").concat(jt(n)))}},{key:"_getTmpConvListMapping",value:function(e){for(var t=e.conversationOptionsList,n=e.isFromGetConversations,o=e.isInstantMessage,i=e.isUnreadC2CMessage,s=void 0!==i&&i,a=e.updateUnreadCount,r=[],c=[],u=this.get(7),l=this.get(8),d=this.isIntl(),p=this.isUsingChatCore(),h=0,g=t.length;h<g;h++){var _=new ai(t[h],d,p),f=_.conversationID,m=_.type;if(!this._isNonExistentAccount(f)){if(this._convMap.has(f)){var v=this._convMap.get(f);if(n){this._convMap.set(f,_),m===S.CONV_C2C?_.unreadCount=v.unreadCount:m===S.CONV_GROUP&&(_.groupProfile=JSON.parse(JSON.stringify(v.groupProfile)));continue}var y=["unreadCount","allowType","adminForbidType","payload"],I=(!1===o&&y.push("lastMessage"),"boolean"==typeof o&&y.push("isPinned"),t[h].lastMessage),M=!ut(I);M||t[h].type===S.CONV_TOPIC||this._onLastMsgNotExist(t[h]),ut(o)&&M&&null===v.lastMessage.payload&&(v.lastMessage.payload=I.payload),Be(v.lastMessage.revoker)||(v.lastMessage.revoker=null),Ze(v,_,y,[null,void 0,"",0,NaN]),!0===a&&v.updateUnreadCount({nextUnreadCount:_.unreadCount,isFromGetConversations:n,isUnreadC2CMessage:s}),o&&M&&(I.payload&&(v.lastMessage.payload=I.payload),v.type===S.CONV_GROUP&&(v.lastMessage.nameCard=I.nameCard,v.lastMessage.nick=I.nick)),M&&v.lastMessage.cloudCustomData!==I.cloudCustomData&&(v.lastMessage.cloudCustomData=I.cloudCustomData||"")}else m===S.CONV_GROUP&&u?(y=_.groupProfile.groupID,(M=u.getLocalGroupProfile(y))&&(_.groupProfile=M,!0===a&&_.updateUnreadCount({nextUnreadCount:0}))):m===S.CONV_C2C&&(v=f.replace(S.CONV_C2C,""),l&&l.isMyFriend(v)&&(_.remark=l.getFriendRemark(v))),r.push(_),this._convMap.set(f,_);this._convMap.get(f).type===S.CONV_TOPIC&&c.push(this._convMap.get(f))}}for(var C=this.get(10),T=0,E=c.length;T<E;T++){var D,k=(D=c[T]).conversationID;Be(D=D.groupAtInfoList)||C.onAtInfoUpdated({topicID:k.replace(S.CONV_GROUP,""),groupAtInfoList:D})}return{newConvList:r}}},{key:"_onLastMsgNotExist",value:function(e){new eo("lastMsgNotExist").setMessage(JSON.stringify(e)).end()}},{key:"_sortConvList",value:function(e){var t=[],n=[],o=[],i=[];return e.forEach((function(e){(!0===e[1].isPinned?Be(e[1].lastMessage.lastTime)?n:t:Be(e[1].lastMessage.lastTime)?i:o).push(e)})),t.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})).concat(n).concat(o.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime}))).concat(i)}},{key:"_sortConvListAndEmitEvent",value:function(){this._convMap=new Map(this._sortConvList(m(this._convMap))),this.emitConvUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var t,n,o,i,s=this;0!==e.length&&(t=[],n=[],o=this.get(4),i=this.get(7),e.forEach((function(e){var o;e.type===S.CONV_C2C?t.push(e.toAccount):e.type===S.CONV_GROUP&&(o=e.toAccount,i.hasLocalGroup(o)?e.groupProfile=i.getLocalGroupProfile(o):n.push(o))})),Oe.l("".concat(this._n,"._updateUserOrGroupProfile userIDList:").concat(t," groupIDList:").concat(n)),0<t.length&&o.getUserProfile({userIDList:t}).then((function(e){We(e=e.data)?e.forEach((function(e){s._doUpdateUserProfile("".concat(S.CONV_C2C).concat(e.userID),e)})):s._doUpdateUserProfile("".concat(S.CONV_C2C).concat(e.userID),e)})),0<n.length&&i.getGroupProfileAdvance({groupIDList:n,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then((function(e){e=e.data.successGroupList;var t=!1;e.forEach((function(e){var n="".concat(S.CONV_GROUP).concat(e.groupID);s._convMap.has(n)&&(Ze((n=s._convMap.get(n)).groupProfile,e,[],[null,void 0,"",0,NaN]),!n.subType&&e.type&&(n.subType=e.type),t=!0)})),t&&s.emitConvUpdate()})))}},{key:"_doUpdateUserProfile",value:function(e,t){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=t,this.emitConvUpdate())}},{key:"_getConvOptions",value:function(e){var n=this,o=[],i=(e=e.filter((function(e){var t=e.type;return e=e.userID,1===t&&!n._isNonExistentAccount(e)||2===t})),this.getMyUserID());return e=e.map((function(e){var s;return ut(e.lastMsg)&&(e.lastMsg={elements:[]}),1===e.type?(s={userID:e.userID,nick:e.peerNick,avatar:e.peerAvatar},o.push(s),{conversationID:"".concat(S.CONV_C2C).concat(e.userID),type:S.CONV_C2C,lastMessage:{lastTime:e.time,lastSequence:e.sequence,fromAccount:e.lastC2CMsgFromAccount,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:null,payload:e.lastMsg.elements[0]?n._amendLayersOverLimitProp(e.lastMsg.elements[0].content):null,cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:8===e.lastMessageFlag,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:e.lastC2CMsgFromAccount===i&&e.time<=e.c2cPeerReadTime,revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null},unreadCount:0,userProfile:new ni(s),peerReadTime:e.c2cPeerReadTime,isPinned:1===e.isPinned,customData:e.customMark||"",markList:xt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId),remark:e.friendRemark||"",messageRemindType:n._transMsgRemindType(e.messageRemindType)}):{conversationID:"".concat(S.CONV_GROUP).concat(e.groupID),type:S.CONV_GROUP,lastMessage:t(t({lastTime:e.time,lastSequence:e.sequence,fromAccount:e.msgGroupFromAccount},n._patchTypeAndPayload(e)),{},{cloudCustomData:e.lastMsg.cloudCustomData||"",isRevoked:2===e.lastMessageFlag,onlineOnlyFlag:!1,nick:e.senderNick||"",nameCard:e.senderNameCard||"",revoker:e.lastMsg.revokerInfo?e.lastMsg.revokerInfo.revoker:null}),groupProfile:new si({groupID:e.groupID,name:e.groupNick,avatar:e.groupImage,type:e.groupType,nextMessageSeq:e.nextMessageSeq}),unreadCount:n._computeGroupUnreadCount(e),peerReadTime:0,isPinned:1===e.isPinned,version:0,customData:e.customMark||"",markList:xt(e.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(e.contactGroupId),messageRemindType:n._transMsgRemindType(e.messageRemindType)}})),0<o.length&&this.get(4).onConvProfileUpdated(o),e}},{key:"_transMsgRemindType",value:function(e){var t="";return 0===e?t=S.MSG_REMIND_ACPT_AND_NOTE:1===e?t=S.MSG_REMIND_DISCARD:2===e?t=S.MSG_REMIND_ACPT_NOT_NOTE:3===e&&(t=S.NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT),t}},{key:"_computeGroupUnreadCount",value:function(e){var t;return 0<(t=(void 0===(t=e.unreadCount)?0:t)-(void 0===(e=e.noUnreadCount)?0:e))?t:0}},{key:"_patchTypeAndPayload",value:function(e){var n=(e=e.lastMsg).event,o=void 0===(o=e.elements)?[]:o;return e=void 0===(e=e.groupTips)?{}:e,ut(void 0===n?void 0:n)||Be(e)?{type:o[0]?o[0].type:null,payload:o[0]?this._amendLayersOverLimitProp(o[0].content):null}:((n=new So(e)).setElement({type:S.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}),o=JSON.parse(JSON.stringify(n.payload)),n=null,{type:S.MSG_GRP_TIP,payload:o})}},{key:"_amendLayersOverLimitProp",value:function(e){var t=e.layersOverLimit;return 0===t?e.layersOverLimit=!1:1===t&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._msgListHandler.getLocalMsgList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof So&&this._msgListHandler.remove(e)}},{key:"onConvDeleted",value:function(e){We(e)&&(e=e.map((function(e){var t=e.type,n=e.userID;return e=e.groupID,1===t?"".concat(S.CONV_C2C).concat(n):2===t?"".concat(S.CONV_GROUP).concat(e):void 0})),Oe.l("".concat(this._n,".onConvDeleted convIDList:").concat(e)),this.deleteLocalConvList(e))}},{key:"onConvPinnedStatus",value:function(e,t){var n,o=this;We(e)&&(n=!1,e.forEach((function(e){var i,s=e.type,a=e.userID;e=e.groupID,1===s?i=o.getLocalConversation("".concat(S.CONV_C2C).concat(a)):2===s&&(i=o.getLocalConversation("".concat(S.CONV_GROUP).concat(e))),i&&(Oe.l("".concat(o._n,".onConvPinnedStatus convID:").concat(i.conversationID," localPinned:").concat(i.isPinned," remotePinned:").concat(t)),t?i.isPinned||(i.isPinned=!0,n=!0):i.isPinned&&(i.isPinned=!1,n=!0))})),n&&this._sortConvListAndEmitEvent())}},{key:"getMessageList",value:function(e){var t=this,n=e.conversationID,o=e.nextReqMessageID,i=(e=e.count,"".concat(this._n,".getMessageList")),s="";if((r=this.getLocalConversation(n))&&r.groupProfile&&(s=r.groupProfile.type),yt(s))return Oe.l("".concat(i," not available in ").concat(s,". convID:").concat(n)),yn({messageList:[],nextReqMessageID:"",isCompleted:!0});(ut(e)||15<e)&&(e=15),o||this._isMeInCommunity(n)||this.clearMemMsg(n);var a=this._computeRemainingCount({conversationID:n,nextReqMessageID:o}),r=this._completedMap.has(n);return Oe.l("".concat(i," convID:").concat(n," isEverCleared:").concat(this._isEverCleared(n)," nextReqMessageID:").concat(o)+" remainingCount:".concat(a," count:").concat(e," isCompleted:").concat(r)),this._needGetHistory({conversationID:n,remainingCount:a,count:e})?this.getHistoryMessages({conversationID:n,nextReqMessageID:o,count:20}).then((function(e){var o=e.nextReqID,s=e.storedMessageList,r=e.assembledMessageList,c=(e=e.isPullingCompleted,t._completedMap.has(n)),u=s,l=(0<a&&(u=t._msgListHandler.getLocalMsgList(n).slice(0,s.length+a)),{nextReqMessageID:void 0,messageList:void 0,isCompleted:void 0});return t._isEverCleared(n)?(l.nextReqMessageID=o,l.messageList=r,l.isCompleted=e):(l.nextReqMessageID=c?"":o,l.messageList=u,l.isCompleted=c),s=l.messageList.filter((function(e){return e.isRevoked}))||[],r=l.messageList.map((function(e){return e.sequence})),Oe.l("".concat(i," ret.nextReqMessageID:").concat(l.nextReqMessageID," ret.isCompleted:").concat(l.isCompleted," sequenceList:"),r),We(s)&&0!==s.length?t.updateRevokerInfo(s).then((function(e){return e.forEach((function(e){var t=e.revokerInfo;l.messageList=l.messageList.map((function(n){return n.ID===e.ID&&t&&(n.revokeReason=t.reason||"",n.revokerInfo={userID:t.revoker||n.revoker,nick:t.nick,avatar:t.avatar}),n}))})),vn(l)})):vn(l)})):(this.modifyMessageList(n),yn(s=this._getMsgListFromMem({conversationID:n,nextReqMessageID:o,count:e})))}},{key:"_isEverCleared",value:function(e){return this._everClearedMap.has(e)}},{key:"_getMsgListFromMem",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=(e=e.count,"".concat(this._n,"._getMsgListFromMem")),i=this._msgListHandler.getLocalMsgList(t),s=i.length,a=Ct(t),r=0,c={isCompleted:!1,nextReqMessageID:"",messageList:[]};return n?(r=a?i.findIndex((function(e){return e.ID===n})):i.findIndex((function(e){return e.sequence+""===n})))>e?(c.messageList=i.slice(r-e,r),c.nextReqMessageID=a?i[r-e].ID:i[r-e].sequence+""):(c.messageList=i.slice(0,r),c.isCompleted=!0):e<s?(c.messageList=i.slice(r=s-e,s),c.nextReqMessageID=a?i[r].ID:i[r].sequence+""):(c.messageList=i.slice(0,s),c.isCompleted=!0),e=c.messageList.map((function(e){return e.sequence})),Oe.l("".concat(o," convID:").concat(t)+" ret.nextReqMessageID:".concat(c.nextReqMessageID," ret.isCompleted:").concat(c.isCompleted," sequenceList:").concat(e)),c}},{key:"getMessageListHopping",value:function(e){var t,n,o=e.conversationID,i=e.sequence,s=e.time,a=e.count;return e=void 0===(e=e.direction)?0:e,(ut(a)||15<a)&&(a=15),o.startsWith(S.CONV_C2C)?(t=this.get(6),n=o.replace(S.CONV_C2C,""),t.getRoamingMessagesHopping({peerAccount:n,time:s,count:a,direction:e})):o.startsWith(S.CONV_GROUP)?(t=this.get(7),n=o.replace(S.CONV_GROUP,""),t.getRoamingMessagesHopping({groupID:n,sequence:i,count:a,direction:e})):void 0}},{key:"_computeRemainingCount",value:function(e){var t=e.conversationID,n=e.nextReqMessageID,o=(e=this._msgListHandler.getLocalMsgList(t)).length;return Oe.l("".concat(this._n,"._computeRemainingCount convID:").concat(t," nextReqMessageID:").concat(n," length:").concat(o)),n?(o=0,Ct(t)?o=e.findIndex((function(e){return e.ID===n})):Tt(t)&&(o=-1!==n.indexOf("-")?e.findIndex((function(e){return e.ID===n})):e.findIndex((function(e){return e.sequence+""===n}))),-1===o?0:o):o}},{key:"_needGetHistory",value:function(e){var t=e.conversationID,n=e.remainingCount,o=(e=e.count,this.getLocalConversation(t)),i="";return o&&o.groupProfile&&(i=o.groupProfile.type),!Et(t)&&!yt(i)&&(!!this._isEverCleared(t)||(o=n<=e&&!this._completedMap.has(t),Oe.l("".concat(this._n,"._needGetHistory convID:").concat(t," ret:").concat(o)),o))}},{key:"_isTopicConv",value:function(e){return Mt(e=e.replace(S.CONV_GROUP,""))}},{key:"getHistoryMessages",value:function(e){var t=e.conversationID,n=e.count;if(e=e.nextReqMessageID,t===S.CONV_SYSTEM)return yn();var o,i,s=15;if(20<n&&(s=20),n=null,Ct(t))return c=0,o="",i=!1,r=this._roamingMsgKeyAndTimeMap.has(t),e&&(i=!0,r?(c=this._roamingMsgKeyAndTimeMap.get(t).lastMessageTime,o=this._roamingMsgKeyAndTimeMap.get(t).messageKey):(a=this._msgListHandler.findMessage(e))&&(c=a.time,Oe.l("".concat(this._n,".getHistoryMessages convID:").concat(t," isRelayInfoExisted:").concat(r," lastMessageTime:").concat(c)))),(n=this.get(6)).getRoamingMessage({conversationID:t,peerAccount:t.replace(S.CONV_C2C,""),count:s,lastMessageTime:i?c:0,messageKey:i?o:""});if(Tt(t)){if(!(n=this.get(7)))return In({code:wn.NO_MODULE});var a=t.replace(S.CONV_GROUP,""),r=null,c=(this._convMap.has(t)&&!Mt(a)&&(r=this._convMap.get(t).lastMessage),0);return e?c=Number(e):r&&(c=r.lastSequence),n.getRoamingMessage({conversationID:t,groupID:a,count:s,sequence:c})}return yn()}},{key:"patchConvLastMessage",value:function(e){var t,n,o=1<arguments.length&&void 0!==arguments[1]&&arguments[1],i=this.getLocalConversation(e);i&&(t=(n=i.lastMessage).messageForShow,n=n.payload,!(Be(t)||Be(n)||o)||0!==(t=this._msgListHandler.getLocalMsgList(e)).length&&(n=t[t.length-1],Oe.l("".concat(this._n,".patchConvLastMessage bForceUpdate:").concat(o," convID:").concat(e," payload:"),n.payload),i.updateLastMessage(n)))}},{key:"onRoamingMessage",value:function(){var e,n,o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[],i=!(2<arguments.length&&void 0!==arguments[2])||arguments[2],s=3<arguments.length?arguments[3]:void 0,a=(u=1<arguments.length?arguments[1]:void 0).startsWith(S.CONV_C2C)?S.CONV_C2C:S.CONV_GROUP,r=null,c=[],u=[],l=0,d=o.length,p=a===S.CONV_GROUP,h=this.getFileDownloadProxy(),g=this.getDowloadFileAuthKey(),_=We(s),f=this.get(17).getFileDNList(),m=function(){p?--l:++l},v=function(){return p?d<=l:l<d};for(l=p?o.length-1:0,d=p?0:o.length;v();m())1!==o[l].isPlaceMessage&&((r=new So(o[l])).to=o[l].to,a!==S.CONV_GROUP||ut(o[l].topicID)||(r.to=o[l].topicID),r.isSystemMessage=!!o[l].isSystemMessage,r.conversationType=a,e=4===o[l].event?{type:S.MSG_GRP_TIP,content:t(t({},o[l].elements),{},{groupProfile:o[l].groupProfile})}:o[l].elements,p||r.setNickAndAvatar({nick:o[l].nick,avatar:o[l].avatar}),Be(e)?((n=new eo("emptyMessageBody")).setMessage("from:".concat(r.from," to:").concat(r.to," sequence:").concat(r.sequence," event:").concat(o[l].event)),n.setLevel("warning").end()):(r.setElement(e,h,g,f),r.reInitialize(this.getMyUserID()),c.push(r),_&&s.push(r)));return m=v=null,i?(this._msgListHandler.unshift(c,u),c=null,u):(u=null,c)}},{key:"findMessage",value:function(e){return this._msgListHandler.findMessage(e)}},{key:"_isMeInCommunity",value:function(e){var t=!0;return this._isTopicConv(e)&&(e=Gt(e.replace(S.CONV_GROUP,"")),this.get(7).hasLocalGroup(e)||(t=!1,Oe.l("".concat(this._n,"._isMeInCommunity groupID:").concat(e," ret:").concat(t)))),t}},{key:"deleteTopicRoamingInfo",value:function(e){var t=this;It({groupID:e})&&this._msgListHandler.getTopicConvIDList(e).forEach((function(e){t.clearMemMsg(e)}))}},{key:"deleteGroupRoamingInfo",value:function(e){e="".concat(S.CONV_GROUP).concat(e),0<this._msgListHandler.getLocalMsgList(e).length&&this.clearMemMsg(e)}},{key:"setMessageRead",value:function(e){var t=e.conversationID,n=this.getLocalConversation(t);if(e="".concat(this._n,".setMessageRead"),Oe.l("".concat(e," convID:").concat(t," unreadCount:").concat(n?n.unreadCount:0)),!n)return yn();if(n.type!==S.CONV_GROUP&&n.type!==S.CONV_TOPIC||Be(n.groupAtInfoList)||this.deleteGroupAtTips(t),0===n.unreadCount)return yn();var o=this._msgListHandler.getLocalLastMsg(t),i=n.lastMessage.lastTime,s=(i<(s=this._msgListHandler.getLocalMaxTime(t))&&(Oe.l("".concat(e," update lastMessageTime from ").concat(i," to ").concat(s)),i=s),this._msgListHandler.getLocalMaxSeq(t)),a=n.lastMessage.lastSequence,r=(a<s&&(Oe.l("".concat(e," update lastMessageSeq from ").concat(a," to ").concat(s)),a=s),n.type===S.CONV_TOPIC&&ut(o)&&(e=this.get(10),o=Gt(s=t.replace(S.CONV_GROUP,"")),(e=e.getLocalTopic(o,s))&&(a=e.nextMessageSeq-1)),null);switch(n.type){case S.CONV_C2C:return(r=this.get(6))?r.setMessageRead({conversationID:t,lastMessageTime:i}):In({code:wn.NO_MODULE});case S.CONV_GROUP:case S.CONV_TOPIC:return(r=this.get(7))?r.setMessageRead({conversationID:t,lastMessageSeq:a}):In({code:wn.NO_MODULE});case S.CONV_SYSTEM:return n.unreadCount=0,this.emitConvUpdate(!0,!1),yn();default:return yn()}}},{key:"setAllMessageRead",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n="setAllMessageRead",o="".concat(this._n,".").concat(n),i=(t.scope||(t.scope=S.READ_ALL_MSG),Oe.l("".concat(o," options:"),t),this._createSetAllMessageReadPack(t));if(0===i.readAllC2CMessage&&0===i.groupMessageReadInfoList.length)return yn();var s=new eo(n);return this.req({P:xn.SET_ALL_MSG_READ,data:i}).then((function(n){return n=n.data,n=e._handleAllMsgRead(n),s.setMessage("scope:".concat(t.scope," failureGroups:").concat(JSON.stringify(n))).end(),yn()})).catch((function(e){return s.setError(e).end(),Oe.w("".concat(o," failed. error:"),e),In({code:e&&e.code?e.code:wn.MSG_UNREAD_ALL_FAIL,message:e&&e.message?e.message:void 0})}))}},{key:"setConvCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConv",value:function(e){return this._convGroupHandler.markConv(e)}},{key:"getConvGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConvGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConvGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConvGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConvsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConvsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConvMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConvGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConvGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConvGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConvInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConvLastMessageSeq",value:function(e){var t=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastSequence,t&&e<t.sequence?t.sequence:e}},{key:"_getConvLastMessageTime",value:function(e){var t=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastTime,t&&e<t.time?t.time:e}},{key:"_createSetAllMessageReadPack",value:function(e){var t,n={readAllC2CMessage:0,groupMessageReadInfoList:[]},o=e.scope,i=T(this._convMap);try{for(i.s();!(t=i.n()).done;){var s,a=f(t.value,2)[1];if(0<a.unreadCount)if(a.type===S.CONV_C2C&&0===n.readAllC2CMessage){if(o===S.READ_ALL_MSG)n.readAllC2CMessage=1;else if(o===S.READ_ALL_C2C_MSG){n.readAllC2CMessage=1;break}}else a.type!==S.CONV_GROUP||o!==S.READ_ALL_GROUP_MSG&&o!==S.READ_ALL_MSG||(s=this._getConvLastMessageSeq(a),n.groupMessageReadInfoList.push({groupID:a.groupProfile.groupID,messageSequence:s}))}}catch(r){i.e(r)}finally{i.f()}return n}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMsgRead(e)}},{key:"_handleAllMsgRead",value:function(e){var t=e.groupMessageReadInfoList;return e=e.readAllC2CMessage,t=this._parseGroupReadInfo(t),1<=this._updateAllConvUnreadCount({readAllC2CMessage:e})&&this.emitConvUpdate(!0,!1),t}},{key:"_parseGroupReadInfo",value:function(e){var t=[];if(e&&e.length)for(var n=0,o=e.length;n<o;n++){var i=(r=e[n]).groupID,s=r.sequence,a=r.retCode,r=r.lastMessageSeq;ut(a)?this._remoteGroupReadSeqMap.set(i,r):(this._remoteGroupReadSeqMap.set(i,s),0!==a&&t.push("".concat(i,"-").concat(s,"-").concat(a)))}return t}},{key:"_updateAllConvUnreadCount",value:function(e){var t,n=e.readAllC2CMessage,o=0,i=T(this._convMap);try{for(i.s();!(t=i.n()).done;){var s,a,r,c,u=f(t.value,2),l=u[0],d=u[1];1<=d.unreadCount&&(1===n&&d.type===S.CONV_C2C?(s=this._getConvLastMessageTime(d),this.updateIsReadAfterReadReport({conversationID:l,lastMessageTime:s})):d.type===S.CONV_GROUP&&(a=l.replace(S.CONV_GROUP,""),this._remoteGroupReadSeqMap.has(a)&&(r=this._remoteGroupReadSeqMap.get(a),c=this._getConvLastMessageSeq(d),this.updateIsReadAfterReadReport({conversationID:l,remoteReadSequence:r}),r<=c&&this._remoteGroupReadSeqMap.delete(a))),this.updateUnreadCount(l,!1)&&(o+=1))}}catch(p){i.e(p)}finally{i.f()}return o}},{key:"isRemoteRead",value:function(e){var t,n=e.conversationID,o=(e=e.sequence,n.replace(S.CONV_GROUP,"")),i=!1;return this._remoteGroupReadSeqMap.has(o)&&(e<=(t=this._remoteGroupReadSeqMap.get(o))&&(i=!0,Oe.l("".concat(this._n,".isRemoteRead convID:").concat(n," msgSeq:").concat(e," remoteReadSeq:").concat(t))),t+10<=e&&this._remoteGroupReadSeqMap.delete(o)),i}},{key:"updateIsReadAfterReadReport",value:function(e){var t=e.conversationID,n=e.lastMessageSeq,o=e.lastMessageTime,i=this._msgListHandler.getLocalMsgList(t);if(0!==i.length)for(var s,a=i.length-1;0<=a;a--)if(s=i[a],!(o&&s.time>o||n&&s.sequence>n)){if("in"===s.flow&&s.isRead)break;s.setIsRead(!0)}}},{key:"updateUnreadCount",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=!1,i=this.getLocalConversation(e),s=this._msgListHandler.getLocalMsgList(e);if(i)return(t=i.unreadCount)!==(s=s.filter((function(e){return!e.isRead&&!e._onlineOnlyFlag&&!e.isDeleted})).length)&&(i.unreadCount=s,o=!0,Oe.l("".concat(this._n,".updateUnreadCount from ").concat(t," to ").concat(s,", convID:").concat(e)),!0===n&&this.emitConvUpdate(!0,!1)),o&&i.type===S.CONV_TOPIC&&(t=i.unreadCount,s=this.get(10),n=e.replace(S.CONV_GROUP,""),s.onUnreadCountUpdatedFromConv(n,t)),o}},{key:"clearGroupAtInfoList",value:function(e){var t,n=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],o=this.getLocalConversation(e);o&&0<o.groupAtInfoList.length&&(o.clearGroupAtInfoList(),Oe.l("".concat(this._n,".clearGroupAtInfoList convID:").concat(e)),o.type===S.CONV_TOPIC&&(o=o.groupAtInfoList,t=this.get(10),e=e.replace(S.CONV_GROUP,""),t.onAtInfoUpdated({topicID:e,groupAtInfoList:o})),!0===n&&this.emitConvUpdate(!0,!1))}},{key:"updateReadReceiptInfo",value:function(e){var t,n,o,i=this,s=void 0===(r=e.userID)?void 0:r,a=void 0===(r=e.groupID)?void 0:r,r=e.readReceiptList,c=void 0===(e=e.timestamp)?0:e;Be(r)||(t=[],ut(s)?ut(a)||(n="".concat(S.CONV_GROUP).concat(a),r.forEach((function(e){var o=e.tinyID,s=e.clientTime,r=e.random,c=e.readCount;e=e.unreadCount,o="".concat(o,"-").concat(s,"-").concat(r),s=i._msgListHandler.getLocalMsg(n,o)||i._msgListHandler.getHoppingMsg(n,o),r={groupID:a,messageID:o,readCount:0,unreadCount:0},s&&(Ke(c)&&(s.readReceiptInfo.readCount=c,r.readCount=c),Ke(e)&&(s.readReceiptInfo.unreadCount=e,r.unreadCount=e),t.push(r))}))):(o="".concat(S.CONV_C2C).concat(s),r.forEach((function(e){var n=e.tinyID,a=e.clientTime;e=e.random,n="".concat(n,"-").concat(a,"-").concat(e),(a=i._msgListHandler.getLocalMsg(o,n)||i._msgListHandler.getHoppingMsg(o,n))&&!a.readReceiptInfo.isPeerRead&&(a.readReceiptInfo.isPeerRead=!0,a.readReceiptInfo.timestamp=c,t.push({userID:s,messageID:n,isPeerRead:!0,timestamp:c}))}))),0<t.length&&this.emitOEvt(E.MESSAGE_READ_RECEIPT_RECEIVED,t))}},{key:"updateIsRead",value:function(e){var t=this.getLocalConversation(e),n=this.getLocalMessageList(e);if(t&&0!==n.length&&!Et(t.type)){for(var o=[],i=0,s=n.length;i<s;i++)"in"!==n[i].flow?"out"!==n[i].flow||n[i].isRead||n[i].setIsRead(!0):o.push(n[i]);var a;a=t.type===S.CONV_C2C?(e=o.slice(-t.unreadCount).filter((function(e){return e.isRevoked})).length,o.length-t.unreadCount-e):o.length-t.unreadCount;for(var r=0;r<a&&!o[r].isRead;r++)o[r].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var t=this,n="".concat(this._n,".deleteGroupAtTips");if(Oe.l("".concat(n)),!(i=this._convMap.get(e)))return Promise.resolve();var o=i.groupAtInfoList;if(0===o.length)return Promise.resolve();var i=void 0,s=(e.startsWith(S.CONV_GROUP)&&(i=e.replace(S.CONV_GROUP,"")),m(o));if((It({groupID:i})||Mt(i))&&0===(s=o.filter((function(e){return!e.atTypeArray.includes(S.CONV_AT_ALL)}))).length)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var a=this.getMyUserID();return this.req({P:xn.DEL_GROUP_AT_TIPS,data:{messageListToDelete:s.map((function(e){return{from:e.from,to:a,messageSeq:e.__sequence,messageRandom:e.__random,groupID:ut(e.topicID)?e.groupID:e.topicID}}))}}).then((function(){return Oe.l("".concat(n," ok. count:").concat(o.length)),t.clearGroupAtInfoList(e,!1),Promise.resolve()})).catch((function(e){return Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"appendToMessageList",value:function(e){return this._msgListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this._sll.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this._sll.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,t,n){return!(!this._msgListHandler.pushIn(t,n)||this._sll.has(t.random)&&!n||(e.push(t),0))}},{key:"revoke",value:function(e,t,n){return this._msgListHandler.revoke(e,t,n)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,t){(!this._peerReadTimeMap.has(e)||this._peerReadTimeMap.get(e)<t)&&this._peerReadTimeMap.set(e,t)}},{key:"updateMsgIsPeerReadProp",value:function(e,t){var n;e.startsWith(S.CONV_C2C)&&0<t&&(0<(n=this._msgListHandler.updateMsgIsPeerReadProp(e,t)).length&&this.emitOEvt(E.MESSAGE_READ_BY_PEER,n),this._convMap.has(e)&&(Be(n=this._convMap.get(e).lastMessage)||n.fromAccount===this.getMyUserID()&&n.lastTime<=t&&!n.isPeerRead&&(n.isPeerRead=!0,this.emitConvUpdate(!0,!1))))}},{key:"updateMsgIsModifiedProp",value:function(e){this._msgListHandler.updateMsgIsModifiedProp(e)}},{key:"setCompleted",value:function(e){Oe.l("".concat(this._n,".setCompleted convID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMsgKeyAndTime",value:function(e,t,n){this._roamingMsgKeyAndTimeMap.set(e,{messageKey:t,lastMessageTime:n})}},{key:"getConvList",value:function(e){var t,n=this,o="".concat(this._n,".").concat("getConvList"),i="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._convMap.size,", options:").concat(JSON.stringify(e));return Oe.l("".concat(o,". ").concat(i)),this._pagingStatus===An?((t=new eo("getConvList")).setMessage(i),this.syncConvList().then((function(){return t.end(),vn({conversationList:n._getConvList(e),isSyncCompleted:n._isSyncCompleted()})})).catch((function(e){return t.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))):(i=this._getConvList(e),Oe.l("".concat(o,". returned conversation count:").concat(i.length)),yn({conversationList:i,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConvList",value:function(e){var t,n,o,i,s,a=this;return ut(e)?this.getLocalConvList():We(e)?0===e.length?[]:this.getLocalConvList().filter((function(t){return e.includes(t.conversationID)})):ze(e)?(t=e.type,n=e.markType,o=e.groupName,i=e.hasUnreadCount,s=e.hasGroupAtInfo,this.getLocalConvList().filter((function(e){return a._filterType(e,t)&&a._filterMarkType(e,n)&&a._filterGroupName(e,o)&&a._filterUnreadCount(e,i)&&a._filterGroupAtInfo(e,s)}))):[]}},{key:"_filterType",value:function(e,t){return t!==S.CONV_C2C&&t!==S.CONV_GROUP||e.type===t}},{key:"_filterGroupName",value:function(e,t){return!ct(t)||(""===t?0===e.conversationGroupList.length:e.conversationGroupList.includes(t))}},{key:"_filterMarkType",value:function(e,t){return!Ke(t)||(0===t?0===e.markList.length:e.markList.includes(t))}},{key:"_filterUnreadCount",value:function(e,t){var n=!0;return!0===t?n=1<=e.unreadCount:!1===t&&(n=0===e.unreadCount),n}},{key:"_filterGroupAtInfo",value:function(e,t){var n=!0;return!0===t?n=1<=e.groupAtInfoList.length:!1===t&&(n=0===e.groupAtInfoList.length),n}},{key:"_handleC2CPeerReadTime",value:function(){var e,t=T(this._convMap);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2),o=n[0],i=n[1];i.type===S.CONV_C2C&&this.recordPeerReadTime(o,i.peerReadTime)}}catch(s){t.e(s)}finally{t.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var e=this.get(7);return!e||e.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var e=this.get(7);return e?e.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(e){var t=this.get(7);return!!t&&t.hasLocalGroup(e.replace(S.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var t,n=this,o=!1;if(this._convMap.has(e)?t=this._convMap.get(e):(t=new ai({conversationID:e,type:Ct(e)?S.CONV_C2C:S.CONV_GROUP},this.isIntl(),this.isUsingChatCore()),o=!0),t._isInfoCompleted||t.type===S.CONV_SYSTEM)return yn({conversation:t});if(Tt(e)){if(!this.get(7))return In({code:wn.NO_MODULE});if(!this._hasLocalGroup(e))return yn({conversation:t})}var i="".concat(this._n,".").concat("getConversationProfile"),s=new eo("getConversationProfile");return Oe.l("".concat(i,". convID:").concat(e," remark:").concat(t.remark," lastMessage:"),t.lastMessage),this._getUserOrGroupProfile(t).then((function(a){s.setMessage("convID:".concat(e," unreadCount:").concat(a.data.conversation.unreadCount)).end();var r,c=n.get(8);if(c&&t.type===S.CONV_C2C&&(r=e.replace(S.CONV_C2C,""),c.isMyFriend(r)&&(c=c.getFriendRemark(r),t.remark!==c&&(t.remark=c,Oe.l("".concat(i,". convID:").concat(e," patch remark:").concat(t.remark))))),Oe.l("".concat(i," ok. isNewConv:").concat(o," convID:").concat(e)),o){if(t.type===S.CONV_C2C)return n._onNewC2CConv([e.replace(S.CONV_C2C,"")]).then((function(){return yn({conversation:t})}));if(t.type===S.CONV_GROUP)return n._onNewGroupConv([e.replace(S.CONV_GROUP,"")]).then((function(){return yn({conversation:t})}))}return a})).catch((function(t){return s.setError(t).setMessage("convID:".concat(e)).end(),Oe.e("".concat(i," failed. error:"),t),In(t)}))}},{key:"_getUserOrGroupProfile",value:function(e){var t=this;return e.type===S.CONV_C2C?this.get(4).getUserProfile({userIDList:[e.toAccount]}).then((function(n){return 0===(n=n.data).length?In({code:wn.USER_OR_GRP_NOT_FOUND}):(e.userProfile=n[0],e._isInfoCompleted=!0,t._insertConvAfterTopmost(e),yn({conversation:e}))})):this.get(7).getGroupProfile({groupID:e.toAccount}).then((function(n){return e.groupProfile=n.data.group,e._isInfoCompleted=!0,t._insertConvAfterTopmost(e),yn({conversation:e})}))}},{key:"_insertConvAfterTopmost",value:function(e){var t,n;e instanceof ai&&!this._convMap.has(e.conversationID)&&(n=(t=m(this._convMap)).findIndex((function(e){return!1===e[1].isPinned})),t.splice(n,0,[e.conversationID,e]),this._convMap=new Map(t),this._setStorageConvList(),this.emitConvUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var t=this;e.data.forEach((function(e){var n=e.userID;n===t.getMyUserID()?t._onMyProfileModified({latestNick:e.nick,latestAvatar:e.avatar}):(n=t._convMap.get("".concat(S.CONV_C2C).concat(n)))&&(n.userProfile=e)}))}},{key:"_onCloudConfig",value:function(e){"0"===this.getCloudConfig("pull_on_invite")&&(this._bPullOnInvite=!1),Oe.l("".concat(this._n,"._onCloudConfig bPullOnInvite:").concat(this._bPullOnInvite))}},{key:"disableMsgPullOnInvite",value:function(){this._bPullOnInvite=!1}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===Ln}},{key:"_errorLog",value:function(e,t,n,o){var i=new Error("Params validate failed."),s="".concat(this.getErrMsg("API_REFER")).concat(e);throw Oe.w("[".concat(e,"] | ").concat(t," | ").concat(this.getErrMsg(n,o),", ").concat(s)),Oe.e("[".concat(e,"] Invalid ").concat(t,": type check failed for ").concat(t,".")),i}},{key:"_isValidConvID",value:function(e){return Ct(e)||Tt(e)||Et(e)}},{key:"deleteConversation",value:function(e){var t=this,n="deleteConversation";return ct(e)||Ye(e)||this._errorLog(n,"options","StringOrObjectRequiredLog"),ct(e)?(this._isValidConvID(e)||this._errorLog(n,"options","InvalidConversationID",e),Oe.l("".concat(this._n,".").concat(n," convID:").concat(e)),this.deleteConvList({conversationIDList:[e],flag:1})):(We(e.conversationIDList)||this._errorLog(n,"conversationIDList","ArrayRequiredLog"),0===e.conversationIDList.length&&this._errorLog(n,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach((function(e){t._isValidConvID(e)||t._errorLog(n,"conversationIDList","InvalidConversationID",e)})),"clearHistoryMessage"in e&&"boolean"!=typeof e.clearHistoryMessage&&this._errorLog(n,"clearHistoryMessage","BooleanRequiredLog"),100<e.conversationIDList.length&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConvList(e))}},{key:"deleteConvList",value:function(e){var t=void 0===(t=e.conversationIDList)?[]:t,n=void 0===(n=e.clearHistoryMessage)||n,o=void 0===(e=e.flag)?0:e,i="".concat(this._n,".").concat("deleteConvList"),s=(e="convIDList:".concat(t," clearHistoryMessage:").concat(n),Oe.l("".concat(i," ").concat(e)),new eo("deleteConvList"));return s.setMessage(e),Promise.all([this.rmLocalOnlyConvList(t),this.rmLocalAndRemoteConvList(t,n)]).then((function(e){return s.end(),0===(e=[].concat(m(e[0]),m(e[1]))).length?In(new Gn({code:wn.CONV_NOT_FOUND})):(Oe.l("".concat(i," ok")),yn(1===o?{conversationID:e[0]}:{conversationIDList:e}))})).catch((function(e){return s.setError(e).end(),Oe.e("".concat(i," failed. error:"),e),In(e)}))}},{key:"rmLocalOnlyConvList",value:function(e){var t=this;return e.filter((function(e){if(!t._convMap.has(e))return!1;var n=t.getLocalConversation(e).type;return n!==S.CONV_GROUP||t._hasLocalGroup(e)?n===S.CONV_SYSTEM&&(t.get(7).deleteGroupSystemNotice({messageList:t._msgListHandler.getLocalMsgList(e)}),t.deleteLocalConv(e),!0):(t.deleteLocalConv(e),!0)}))}},{key:"rmLocalAndRemoteConvList",value:function(e,t){var n=this,o={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:t?1:0};return e.forEach((function(e){var t;n._convMap.has(e)&&((t=n.getLocalConversation(e).type)===S.CONV_C2C?o.conversationList.push({toAccount:e.replace(t,""),type:1}):t===S.CONV_GROUP&&n._hasLocalGroup(e)&&o.conversationList.push({toGroupID:e.replace(t,""),type:2}))})),0===o.conversationList.length?[]:this.req({P:xn.DEL_CONV,data:o}).then((function(e){var t=[];return 0<e.data.resultList.length&&e.data.resultList.map((function(e){0===e.code&&(e=1===e.type?"".concat(S.CONV_C2C).concat(e.to):"".concat(S.CONV_GROUP).concat(e.groupID),t.push(e))})),n.deleteLocalConvList(t),t}))}},{key:"setConvDraft",value:function(e){var t=e.conversationID,n=(e=e.draftText,"".concat(this._n,".").concat("setConvDraft"));return Oe.l("".concat(n," convID:").concat(t," draftText:").concat(e)),this._convMap.has(t)?((n=this._convMap.get(t)).setDraftText(e),this.emitConvUpdate(),yn({code:0,conversation:n})):In({code:wn.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(e){var t=this,n={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._convMap.has(e))return In({code:wn.CONV_NOT_FOUND});var o=this._convMap.get(e).type;if(o===S.CONV_C2C)n.type=1,n.toAccount=e.replace(S.CONV_C2C,"");else{if(o!==S.CONV_GROUP)return o===S.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._msgListHandler.getLocalMsgList(e)}),yn({conversationID:e})):In({code:wn.CONV_UN_RECORDED_TYPE});n.type=2,n.toGroupID=e.replace(S.CONV_GROUP,"")}var i="".concat(this._n,".").concat("clearHistoryMessage"),s=new eo("clearHistoryMessage");return s.setMessage("convID:".concat(e)),Oe.l("".concat(i,". convID:").concat(e)),this.setMessageRead({conversationID:e}).then((function(){return t.req({P:xn.CLEAR_HISTORY_MSG,data:n})})).then((function(){s.end(),Oe.l("".concat(i," ok")),t.clearMemMsg(e);var n=t.getLocalConversation(e);return n&&(n.updateLastMessage(),t._sortConvListAndEmitEvent()),yn({conversationID:e})})).catch((function(e){return s.setError(e).end(),Oe.e("".concat(i," failed. error:"),e),In(e)}))}},{key:"pinConversation",value:function(e){var t=this,n=e.conversationID,o=e.isPinned,i=this.getLocalConversation(n);if(i&&i.isPinned===o)return yn({conversationID:n});if(Et(n))return i&&(i.isPinned=o),this._sortConvListAndEmitEvent(),yn({conversationID:n});if(e=null,Ct(n)?e={type:1,toAccount:n.replace(S.CONV_C2C,"")}:Tt(n)&&(e={type:2,groupID:n.replace(S.CONV_GROUP,"")}),null===e)return In({code:wn.INVALID_CONV_ID});var s="".concat(this._n,".").concat("pinConversation"),a="convID:".concat(n," isPinned:").concat(o),r=new eo("pinConversation");return r.setMessage(a),Oe.l("".concat(s,". ").concat(a)),this.req({P:xn.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:!0===o?1:2,itemList:[e]}}).then((function(){return r.end(),Oe.l("".concat(s," ok")),i?i.isPinned!==o&&(i.isPinned=o):t._convMap.set(n,new ai({conversationID:n,type:Ct(n)?S.CONV_C2C:S.CONV_GROUP,isPinned:o},t.isIntl(),t.isUsingChatCore())),t._sortConvListAndEmitEvent(),vn({conversationID:n})})).catch((function(e){return r.setError(e).end(),Oe.e("".concat(s," failed. error:"),e),In(e)}))}},{key:"setMessageRemindType",value:function(e){return this._msgRemindHandler.set(e)}},{key:"patchMsgRemindType",value:function(e){var t=e.ID,n=e.isC2CConversation,o=e.messageRemindType,i=!1;return(n=this.getLocalConversation("".concat(n?S.CONV_C2C:S.CONV_GROUP).concat(t)))&&n.messageRemindType!==o&&(n.messageRemindType=o,i=!0),Oe.l("".concat(this._n,".patchMsgRemindType options:"),e,"ret:".concat(i)),i}},{key:"onC2CMsgRemindTypeFetched",value:function(e){var t,n=this;We(e)&&0<e.length&&(t=0,e.forEach((function(e){var o=e.userID;e=e.muteFlag,e=n._transMsgRemindType(e),!0===n.patchMsgRemindType({ID:o,isC2CConversation:!0,messageRemindType:e})&&(t+=1)})),Oe.l("".concat(this._n,".onC2CMsgRemindTypeFetched updateCount:").concat(t)),1<=t&&this.emitConvUpdate(!0,!1))}},{key:"onC2CMsgRemindTypeSynced",value:function(e){var t=this,n="".concat(this._n,".onC2CMsgRemindTypeSynced");e.dataList.forEach((function(e){var o;Be(e.muteNotificationsSync)||(o=(e=e.muteNotificationsSync).to,e=e.muteFlag,e=t._transMsgRemindType(e),t.patchMsgRemindType({ID:o,isC2CConversation:!(o=0),messageRemindType:e})&&(o+=1),Oe.l("".concat(n," updateCount:").concat(o)),1<=o&&t.emitConvUpdate(!0,!1))}))}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){this._msgRemindHandler.onGroupMsgRemindTypeUpdated(e)}},{key:"deleteLocalConv",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this._convMap.has(e);Oe.l("".concat(this._n,".deleteLocalConv convID:").concat(e," has:").concat(n)),n&&(this._convMap.delete(e),this._convMapForDiff.delete(e),this.clearMemMsg(e),this._setStorageConvList(!0),t)&&(n=!this._isTopicConv(e),this.emitConvUpdate(n,!1))}},{key:"pullMsgOnInvite",value:function(e){var t,n,o,i,s,a=this.get(7);a&&(t="".concat(this._n,".pullMsgOnInvite"),Oe.l("".concat(t," flag:").concat(this._bPullOnInvite)),this._bPullOnInvite&&(s=this.getLocalLastMessage(e),n=this.getLocalSecondLastMessage(e),i=o=1,s&&(o=s.sequence),n&&(i=n.sequence),s=a.getGroupRemoteLastSeq(e.replace(S.CONV_GROUP,"")),Oe.l("".concat(t," convID:").concat(e," localLastSeq:").concat(o," localSecondLastSeq:").concat(i," remoteLastSeq:").concat(s)),this.clearMemMsg(e),1<o-i?this._recursiveGetMsgList([],e,!1,o,i):1<s-o&&this._recursiveGetMsgList([],e,!0,s,o)))}},{key:"_recursiveGetMsgList",value:function(e,t,n,o,i,s){var a=this;this.getMessageList({conversationID:t,nextReqMessageID:s}).then((function(s){var r=(s=s.data).messageList,c=s.isCompleted,u=(s=s.nextReqMessageID,r.filter((function(e){return n?e.sequence>i&&e.sequence<=o:e.sequence>i&&e.sequence<o})));e.unshift.apply(e,m(u)),!c&&0<r.length&&r[0].sequence>i&&e.length<60?a._recursiveGetMsgList(e,t,n,o,i,s):a._emitMsgReceived(t,e)}))}},{key:"_emitMsgReceived",value:function(e,t){var n,o,i=this;0<t.length&&(t=t.filter((function(e,t,n){return t===n.findIndex((function(t){return t.sequence===e.sequence}))})),n=this.hasLocalConversation(e),o=t.map((function(e){return e.sequence})),Oe.l("".concat(this._n,"._emitMsgReceived convID:").concat(e," has:").concat(n," count:").concat(o.length," sequenceList:"),o),this.emitOEvt(E.MESSAGE_RECEIVED,t),n?this.patchConvLastMessage(e,!0):this.getConversationProfile(e).then((function(){i.patchConvLastMessage(e,!0)})))}},{key:"deleteLocalConvList",value:function(e){var t=this,n=!1;e.forEach((function(e){t._convMap.has(e)&&(t.deleteLocalConv(e,!1),n=!0)})),Oe.l("".concat(this._n,".deleteLocalConvList convID:").concat(e," isConvIDExisted:").concat(n)),n&&this.emitConvUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._msgListHandler.hasLocalMsg(e.conversationID,e.ID)&&!this._sll.has(e.random))}},{key:"modifyMessageList",value:function(e){var t,n;e.startsWith(S.CONV_C2C)&&this._convMap.has(e)&&(n=this._convMap.get(e),t=Date.now(),this._msgListHandler.modifyMsgSentByPeer({conversationID:e,latestNick:n.userProfile.nick,latestAvatar:n.userProfile.avatar}),n=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._msgListHandler.modifyMsgSentByMe({conversationID:e,latestNick:n.nick,latestAvatar:n.avatar}),Oe.l("".concat(this._n,".modifyMessageList convID:").concat(e," cost:").concat(jt(t))))}},{key:"updateUserProfileSpecifiedKey",value:function(e){Oe.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var t=e.conversationID,n=e.nick;e=e.avatar,this._convMap.has(t)&&(t=this._convMap.get(t).userProfile,ct(n)&&t.nick!==n&&(t.nick=n),ct(e)&&t.avatar!==e&&(t.avatar=e),this.emitConvUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(e){var n=this,o=this.getLocalConvList(),i=Date.now();o.forEach((function(o){n.modifyMessageSentByMe(t({conversationID:o.conversationID},e))})),Oe.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(jt(i)))}},{key:"modifyMessageSentByMe",value:function(e){this._msgListHandler.modifyMsgSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._msgListHandler.getLatestMsgSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._msgListHandler.modifyMsgSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._msgListHandler.getLatestMsgSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,t){return!(!this._msgListHandler.pushIn(t)||this._sll.has(t.random)||(e.push(t),0))}},{key:"getLocalLastMessage",value:function(e){return this._msgListHandler.getLocalLastMsg(e)}},{key:"getLocalSecondLastMessage",value:function(e){return this._msgListHandler.getLocalSecondLastMsg(e)}},{key:"checkAndPatchRemark",value:function(){var e,t,n=this.get(8);0===this._convMap.size||!n||0!==(e=m(this._convMap.values()).filter((function(e){return e.type===S.CONV_C2C}))).length&&(t=0,e.forEach((function(e){var o=e.conversationID.replace(S.CONV_C2C,"");n.isMyFriend(o)&&(o=n.getFriendRemark(o),e.remark!==o&&(e.remark=o,t+=1))})),Oe.l("".concat(this._n,".checkAndPatchRemark. c2cConvCount:").concat(e.length," patchedCount:").concat(t)),0<t&&this.emitConvUpdate(!0,!1))}},{key:"updateTopicConversation",value:function(e){this._updateLocalConvList({conversationOptionsList:e,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(e){var t=e[0],n=null;return t.conversationType===S.CONV_C2C?n=this._m.get(6):t.conversationType===S.CONV_GROUP&&(n=this._m.get(7)),n?n.sendReadReceipt(e):In({code:wn.NO_MODULE})}},{key:"getReadReceiptList",value:function(e){var t=e[0],n=null;return t.conversationType===S.CONV_C2C?n=this._m.get(6):t.conversationType===S.CONV_GROUP&&(n=this._m.get(7)),n?n.getReadReceiptList(e):In({code:wn.NO_MODULE})}},{key:"getLastMessageTime",value:function(e){return(e=this.getLocalConversation(e))?e.lastMessage.lastTime:0}},{key:"getTotalUnreadCount",value:function(){var e=this.getLocalConvList(),t=0;return e.forEach((function(e){e.type!==S.CONV_SYSTEM&&(""!==e.messageRemindType&&e.messageRemindType!==S.MSG_REMIND_ACPT_AND_NOTE||(t+=e.unreadCount))})),t}},{key:"onTotalUnreadCountUpdate",value:function(){var e=this.getTotalUnreadCount();this._convTotalUnreadCount!==e&&(Oe.l("".concat(this._n,".onTotalUnreadCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOEvt(E.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(e){if(e=this.getLocalConversation(e),ut(e))return!0;var t=e.type===S.CONV_TOPIC,n=e.type===S.CONV_GROUP&&e.groupProfile.type===S.GRP_ROOM;return e=e.type===S.CONV_GROUP&&e.groupProfile.type===S.GRP_LIVE,!(t||n||e)}},{key:"setAllRcvMsgOpt",value:function(e){return this._msgRemindHandler.setAllRcvMsgOpt(e)}},{key:"getAllRcvMsgOpt",value:function(){return this._msgRemindHandler.getAllRcvMsgOpt()}},{key:"onAllRcvMsgOptNotify",value:function(e){this._msgRemindHandler.onAllRcvMsgOptNotify(e)}},{key:"clearUnreadCount",value:function(e){(e=this.getLocalConversation(e))&&0<e.unreadCount&&(e.unreadCount=0,this.emitConvUpdate(!0,!1))}},{key:"storeHoppingMessageList",value:function(e){this._msgListHandler.storeHoppingMsgList(e)}},{key:"clearMemMsg",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]&&arguments[1];Oe.l("".concat(this._n,".clearMemMsg convID:").concat(e," isOverLimit:").concat(t)),this._msgListHandler.removeByConvID(e),this._completedMap.delete(e),this._roamingMsgKeyAndTimeMap.delete(e),this._everClearedMap.set(e,1)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._setStorageConvList(!0),this._pagingStatus=kn,this._msgListHandler.reset(),this._msgRemindHandler.reset(),this._roamingMsgKeyAndTimeMap.clear(),this._sll.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._convMap.clear(),this._pagingTs=0,this._pagingStartIdx=0,this._pagingPinnedTs=0,this._pagingPinnedStartIdx=0,this._remoteGroupReadSeqMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this._convMapForDiff.clear(),this._partialUpdatedConvMap.clear(),this._everClearedMap.clear(),this._bPullOnInvite=!0,this._convGroupHandler.reset(),this.resetReady()}}]),Qi),di=(s(Zi,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupTipsMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupTipsMap.forEach((function(t,n){var o=e._checkCountMap.get(n),i=e._grpM.hasLocalGroup(n);Oe.l("".concat(e._n,"._check groupID:").concat(n," hasLocalGroup:").concat(i," checkCount:").concat(o)),i?(e._notifyCachedGroupTips(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)}))}},{key:"onNewGroupTips",value:function(e){Oe.l("".concat(this._n,".onNewGroupTips options:").concat(JSON.stringify(e.dataList)));var t=(e=this._assembly(e)).eventDataList,n=e.result;0<(e=e.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(e),0<n.length&&(this._grpM.emitOEvt(E.MESSAGE_RECEIVED,n),this._handleTips(n)),0<t.length&&(this._grpM.updateNextMessageSeq(t),this._grpM.get(11).onNewMessage({conversationOptionsList:t,isInstantMessage:!0}))}},{key:"_assembly",value:function(e){for(var n=e.event,o=e.dataList,i=null,s=[],a=[],r={},c=[],u=0,l=o.length;u<l;u++){var d=at(o[u]);if(6===n){if(this._grpM.isGroupAttributesUpdatedNotice(d))continue;if(this._grpM.isGroupCountersNotice(d))continue}var p=(f=d.groupProfile).groupID,h=void 0===(h=f.communityType)?0:h,g=void 0===(g=f.topicID)?void 0:g,_=f.invisible,f=void 0===(f=f.groupType)?void 0:f,m=void 0;if((y=this._grpM.isMessageFromTopic(h,g))&&(m=S.CONV_TOPIC,d.to=g),(v=this._grpM.hasLocalGroup(p))||!this._grpM.isUnjoinedAVChatRoom(p))if(v||y)if(this._grpM.isMessageFromOrToAVChatroom(p))d.event=n,c.push(d);else if(d.currentUser=this._grpM.getMyUserID(),d.conversationType=S.CONV_GROUP,(i=new So(d)).setElement({type:S.MSG_GRP_TIP,content:t(t({},d.elements),{},{groupProfile:d.groupProfile})}),i.isSystemMessage=!1,1!==_){var v=this._grpM.get(11),y=(_=(y=i).conversationID,y.sequence);if(6===n)i._onlineOnlyFlag=!0,a.push(i);else if(!v.pushIntoNoticeResult(a,i))continue;this._grpM.isMessageFromCommunityOfTopic(h,g)||6===n&&v.getLocalConversation(_)||(6!==n&&this._qualityStat(i),h=v.isRemoteRead({conversationID:_,sequence:y}),ut(r[_])?(g=0,"in"===i.flow&&(i._isExcludedFromUnreadCount||i._onlineOnlyFlag||h||(g=1)),r[_]=s.push({conversationID:_,unreadCount:g,type:ut(m)?i.conversationType:m,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(s[v=r[_]].type=i.conversationType,s[v].subType=i.conversationSubType,s[v].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||i._onlineOnlyFlag||h||s[v].unreadCount++)))}else this._qualityStat(i);else this._cacheAndCompare({groupID:p,event:n,item:d,groupType:f})}return{eventDataList:s,result:a,AVChatRoomMessageList:c}}},{key:"_qualityStat",value:function(e){this._grpM.get(26).addMessageSequence({key:zn,message:e})}},{key:"_handleTips",value:function(e){var t=this;e.forEach((function(e){switch(e.payload.operationType){case 1:t._onNewMemberComeIn(e);break;case 2:t._onMemberQuit(e);break;case 3:t._onMemberKickedOut(e);break;case 4:t._onMemberSetAdmin(e);break;case 5:t._onMemberCancelledAdmin(e);break;case 6:t._onGroupProfileModified(e);break;case 7:t._onMemberInfoModified(e);break;case 8:t._onTopicProfileUpdated(e);break;default:Oe.w("".concat(t._n,"._handleTips unknown operationType:").concat(e.payload.operationType))}}))}},{key:"_onNewMemberComeIn",value:function(e){var t=(e=e.payload).memberNum;e=e.groupProfile.groupID,(e=this._grpM.getLocalGroupProfile(e))&&Ke(t)&&e.memberCount!==t&&(e.memberCount=t,this._updateConvGroupProfile(e))}},{key:"_onMemberQuit",value:function(e){var t=(n=e.payload).memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&Ke(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConvGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var t=(n=e.payload).memberNum,n=n.groupProfile.groupID,o=this._grpM.getLocalGroupProfile(n);o&&Ke(t)&&o.memberCount!==t&&(o.memberCount=t,this._updateConvGroupProfile(o)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(n,e.payload.userIDList)}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach((function(e){(e=n.getLocalGroupMemberInfo(t,e))&&e.updateRole(S.GRP_MBR_ROLE_ADMIN)}))}},{key:"_onMemberCancelledAdmin",value:function(e){var t=e.payload.groupProfile.groupID,n=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach((function(e){(e=n.getLocalGroupMemberInfo(t,e))&&e.updateRole(S.GRP_MBR_ROLE_MEMBER)}))}},{key:"_onGroupProfileModified",value:function(e){var t=this,n=(e=e.payload).newGroupProfile,o=e.groupProfile,i=e.operatorInfo,s=(e=o.groupID,this._grpM.getLocalGroupProfile(e));Object.keys(n).forEach((function(e){switch(e){case"ownerID":t._ownerChanged(s,n);break;case"groupName":s.name=n[e];break;default:s[e]=n[e]}})),ut(i)||Object.keys(i).forEach((function(e){var t;"nameCard"===e?s.updateSelfInfo({nameCard:i[e]}):"role"===e&&(t="",400===i[e]?t=S.GRP_MBR_ROLE_OWNER:300===i[e]?t=S.GRP_MBR_ROLE_ADMIN:200===i[e]&&(t=S.GRP_MBR_ROLE_MEMBER),s.updateSelfInfo({role:t}))})),o=!s.isSupportTopic,this._grpM.emitGroupListUpdate(!0,o)}},{key:"_ownerChanged",value:function(e,t){e=e.groupID;var n=this._grpM.getLocalGroupProfile(e),o=this._grpM.getMyUserID();o===t.ownerID&&(n.updateGroup({selfInfo:{role:S.GRP_MBR_ROLE_OWNER}}),n=(t=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(e,o),o=this._grpM.getLocalGroupProfile(e).ownerID,t=t.getLocalGroupMemberInfo(e,o),n&&n.updateRole(S.GRP_MBR_ROLE_OWNER),t&&t.updateRole(S.GRP_MBR_ROLE_MEMBER))}},{key:"_onMemberInfoModified",value:function(e){var t=e.to,n=(o=e.payload).groupProfile,o=o.memberList,i=n.groupID,s=(Mt(t)&&this._updateTopicMuteTime(e),this._grpM.getGroupMemberHandler());o.forEach((function(e){var t=s.getLocalGroupMemberInfo(i,e.userID);t&&Ke(e.muteTime)&&t.updateMuteUntil(e.muteTime)}))}},{key:"_updateTopicMuteTime",value:function(e){var t=e.to,n=(e=e.payload).groupProfile,o=void 0===(e=e.memberList)?[]:e,i=(e=this._grpM.get(10),n=n.groupID,e.getLocalTopic(n,t));if(i){for(var s=!1,a=0;a<o.length;a++){var r=o[a];if(r.userID===this._grpM.getMyUserID()&&0<=r.muteTime){i.updateSelfInfo({muteTime:r.muteTime}),s=!0;break}}s&&this._grpM.emitOEvt(E.TOPIC_UPDATED,{groupID:n,topic:i})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=(o=e.payload).groupProfile.groupID,o=o.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(t({groupID:n,topicID:e.to},o))}},{key:"_cacheGroupTips",value:function(e,t){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(t)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e,t){var n=this,o=this._cachedGroupTipsMap.get(e)||[];Oe.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," groupType:").concat(t," count:").concat(o.length)),o.forEach((function(e){n.onNewGroupTips(e)})),this._deleteCachedGroupTips(e)}},{key:"_cacheAndCompare",value:function(e){var t=e.groupID,n=e.event,o=e.item;e=e.groupType,Oe.l("".concat(this._n,"._cacheAndCompare groupID:").concat(t," groupType:").concat(e)),this._cacheGroupTips(t,{event:n,dataList:[o]}),n={groupID:t,type:e},e===S.GRP_AVCHATROOM?this._grpM.hasLocalGroup(t)?this._notifyCachedGroupTips(t,e):this._grpM.setUnjoinedAVChatRoom(t):(this._grpM.updateGroupMap([n]),this._notifyCachedGroupTips(t,e)),this._checkCountMap.has(t)||this._checkCountMap.set(t,0)}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),Zi),pi=(s(Xi,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupMessageMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupMessageMap.forEach((function(t,n){var o=e._checkCountMap.get(n),i=e._grpM.hasLocalGroup(n);Oe.l("".concat(e._n,"._check groupID:").concat(n," hasLocalGroup:").concat(i," checkCount:").concat(o)),i?(e._notifyCachedGroupMessage(n),e._checkCountMap.delete(n),e._grpM.deleteUnjoinedAVChatRoom(n)):o>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(n),e._checkCountMap.delete(n)):e._checkCountMap.set(n,++o)}))}},{key:"updateLastMsg",value:function(e){var n="".concat(this._n,".updateLastMsg");if(0!==this._grpM.getGroupMap().size){for(var o,i,s,a,r=!1,c=e.length,u=0;u<c;u++)(o=e[u]).type===S.CONV_GROUP&&0!==o.lastMessage.lastSequence&&null!==o.lastMessage.payload&&(i=o.conversationID.split(/^GROUP/)[1],(i=this._grpM.getLocalGroupProfile(i))&&(s=i.lastMessage,a=o.lastMessage,JSON.stringify(s)!==JSON.stringify(a)&&(i.lastMessage=t({},o.lastMessage),r=!0)));Oe.l("".concat(n," convCount:").concat(c," groupCount:").concat(this._grpM.getLocalGroupList().length," isUpdated:").concat(r)),r&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewMessage",value:function(e){var t,n=(t=this._assembly(e)).conversationOptionsList,o=t.messageList;0<(0<(0<(t=t.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(t),t=mt(o)).length&&this._grpM.emitOEvt(E.MESSAGE_MODIFIED,t),0<n.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:n,isInstantMessage:!1!==e.isInstantMessage,updateUnreadCount:!1!==e.updateUnreadCount}),this._grpM.updateNextMessageSeq(n)),t=vt(o)).length&&this._grpM.emitOEvt(E.MESSAGE_RECEIVED,t),o.length=0}},{key:"_assembly",value:function(e){var t=e.dataList,n=e.event,o=e.isInstantMessage,i=null,s=[],a=[],r=[],c={},u=this._grpM.getFileDownloadProxy(),l=this._grpM.getDowloadFileAuthKey(),d=this._grpM.get(17).getFileDNList(),p=t.length;1<p&&t.sort((function(e,t){return e.sequence-t.sequence}));for(var h=this._grpM.get(11),g=this._grpM.get(4),_=0;_<p;_++){var f,m=at(t[_]),v=(C=m.groupProfile).groupID,y=void 0===(y=C.communityType)?0:y,I=void 0===(I=C.topicID)?void 0:I,M=C.invisible,C=void 0===(C=C.groupType)?void 0:C,T=void 0,E=this._grpM.isMessageFromTopic(y,I),D=(E&&(T=S.CONV_TOPIC,m.to=I),this._grpM.hasLocalGroup(v));!D&&this._grpM.isUnjoinedAVChatRoom(v)||(D||E?this._grpM.isMessageFromOrToAVChatroom(v)?(m.event=n,r.push(m)):(m.currentUser=this._grpM.getMyUserID(),m.conversationType=S.CONV_GROUP,m.isSystemMessage=!!m.isSystemMessage,(i=new So(m)).setElement(m.elements,u,l,d),1!==M?(D=1===t[_].isModified,h.isMessageSentByCurrentInstance(i)?i.isModified=D:D=!1,1===m.onlineOnlyFlag?(i._onlineOnlyFlag=!0,h.isMessageSentByCurrentInstance(i)||a.push(i)):this._grpM.isMessageFromCommunityOfTopic(y,I)?a.push(i):(i.from!==this._grpM.getMyUserID()||(E=h.getLatestMessageSentByMe(i.conversationID))&&(M=E.nick,y=E.avatar,M===i.nick&&y===i.avatar||(h.modifyMessageSentByMe({conversationID:f,latestNick:i.nick,latestAvatar:i.avatar}),g.mockOnNickAvatarModified(i.nick,i.avatar))),h.pushIntoMessageList(a,i,D)&&(this._qualityStat(o,i),f=(I=i).conversationID,E=I.sequence,M=h.isRemoteRead({conversationID:f,sequence:E}),ut(c[f])?(y=0,"in"===i.flow&&(i._isExcludedFromUnreadCount||M||(y=1)),c[f]=s.push({conversationID:f,unreadCount:y,type:ut(T)?i.conversationType:T,subType:i.conversationSubType,lastMessage:i._isExcludedFromLastMessage?"":i})-1):(s[D=c[f]].type=ut(T)?i.conversationType:T,s[D].subType=i.conversationSubType,s[D].lastMessage=i._isExcludedFromLastMessage?"":i,"in"===i.flow&&(i._isExcludedFromUnreadCount||M||s[D].unreadCount++))))):this._qualityStat(o,i)):this._cacheAndCompare({groupID:v,event:n,item:m,groupType:C}))}return{conversationOptionsList:s,messageList:a,AVChatRoomMessageList:r}}},{key:"_qualityStat",value:function(e,t){var n=this._grpM.get(26);n.addMessageSequence({key:zn,message:t}),e&&0<t.clientTime&&n.addMessageDelay(t.clientTime)}},{key:"onMsgRevoked",value:function(e,t){var n=this,o=this._grpM.get(11),i=[],s=[];e.dataList.forEach((function(e){var t=e.elements.revokedInfos,n=e.revokerInfo,a=e.groupProfile,r=!1;a&&(r=It({groupID:a.groupID})||!Be(a.topicID)),ut(t)||t.forEach((function(e){var t,c=Be(e.topicID)?"GROUP".concat(e.groupID):"GROUP".concat(e.topicID),u=o.getLocalConversation(c),l=e.revokerInfo&&e.revokerInfo.revoker||n&&n.revoker,d=n&&n.reason||"";u&&yt(u.type)?t={conversationID:c,sequence:e.sequence,ID:"".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)}:(u=o.revoke(c,e.sequence,e.random))?t=u:(t={conversationID:c,sequence:e.sequence},e.tinyID&&e.clientTime&&e.random&&(t.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random)),e.time&&(t.time=e.time)),t&&(t.revoker=l,t.revokeReason=d,t.revokerInfo={userID:l,nick:"",avatar:""},r?(t.revokerInfo.nick=a.nick,t.revokerInfo.avatar=a.avatar,i.push(t)):s.push(t))}))})),0===s.length&&0===i.length||(o.onMessageRevoked([].concat(i,s),t),0<i.length&&this._grpM.emitOEvt(E.MESSAGE_REVOKED,i),0<s.length&&o.updateRevokerInfo(s).then((function(e){n._grpM.emitOEvt(E.MESSAGE_REVOKED,e)})))}},{key:"_groupListTreeShaking",value:function(e){for(var t=new Map(m(this._grpM.getGroupMap())),n=0,o=e.length;n<o;n++)t.delete(e[n].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach((function(e){t.delete(e)})),this._grpM.getGroupMap().forEach((function(e,n){e.isSupportTopic&&t.delete(n)}));for(var i=m(t.keys()),s=0,a=i.length;s<a;s++)this._grpM.deleteGroup(i[s])}},{key:"syncGroupList",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]&&arguments[0],n=(this._pagingStatus===kn&&this._grpM.clearGroupMap(),m(w)),o=this.PAGING_GRP_COUNT_LIMIT,i=[];if(!0===t)return this._pagingGetGroupListWithTopic({limit:o,offset:0,groupBaseInfoFilter:n,groupList:i});t="syncGroupList";var s="".concat(this._n,".").concat(t),a=new eo(t);return this._pagingGetGroupList({limit:o,offset:0,groupBaseInfoFilter:n,groupList:i}).then((function(){var t=Ht(e._pagingGetCostList),n=Bt(e._pagingGetCostList),o=(e._pagingGetCostList.length=0,e._pagingStatus=Ln,e._groupListTreeShaking(i),e._grpM.updateGroupMap(i),e._grpM.getLocalGroupList().length);return o="count:".concat(o," sum:").concat(n," avg:").concat(t),Oe.l("".concat(s," ok. ").concat(o)),a.setMessage(o).end(),e.tempConversationList&&(e.updateLastMsg(e.tempConversationList),e.tempConversationList=null),e._grpM.emitGroupListUpdate(!0,!0),vn({groupList:e._grpM.getLocalGroupList()})})).catch((function(t){return e._pagingStatus=An,a.setError(t).end(),Oe.e("".concat(s," failed. error:"),t),In(t)}))}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList");if(Oe.l("".concat(t," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===An||this._pagingStatus===kn)return this.syncGroupList().then((function(){return vn({groupList:e._grpM.getLocalGroupList(),isSyncCompleted:e.isPagingGetCompleted()})})).catch((function(e){return Oe.e("".concat(t," failed. error:"),e),In(e)}));var n=this._grpM.getLocalGroupList();return Oe.l("".concat(t,". returned group count:").concat(n.length)),yn({groupList:n,isSyncCompleted:this.isPagingGetCompleted()})}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===Ln}},{key:"_pagingGetGroupList",value:function(e){var t=this,n="".concat(this._n,".").concat("_pagingGetGroupList"),o=e.isCommunityRelay,i=void 0!==o&&o,s=e.limit,a=e.offset,r=e.groupBaseInfoFilter,c=e.groupList,u=Date.now();return this._grpM.req({P:xn.GET_GRP_LIST,data:{type:i?S.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:s,offset:a,responseFilter:{groupBaseInfoFilter:r,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then((function(e){var o=void 0===(o=(e=e.data).groups)?[]:o,l=(e=e.totalCount,c.push.apply(c,m(o)),t._handleGroupAtInfoWithoutTopic(i,o),!((o=a+s)<e));return e="offset:".concat(a," limit:").concat(s," total:").concat(e," isCompleted:").concat(l," ")+"current:".concat(c.length," isCommunityRelay:").concat(i),t._pagingGetCostList.push(jt(u,!1)),Oe.l("".concat(n," ok. ").concat(e," cost:").concat(jt(u))),i||l?!i&&l?(Oe.l("".concat(n," start to get community list")),a=0,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):i&&!l?(a=o,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:!0})):vn({groupList:c}):(a=o,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c}))})).catch((function(e){return 10018===e.code?(Oe.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(s)),s=50,t._pagingGetGroupList({limit:s,offset:a,groupBaseInfoFilter:r,groupList:c,isCommunityRelay:i})):i?(11e3===e.code&&Oe.l("".concat(n," ok. community unavailable")),yn({groupList:c})):In(e)}))}},{key:"_pagingGetGroupListWithTopic",value:function(e){var t=this,n="".concat(this._n,"._pagingGetGroupListWithTopic"),o=e.limit,i=e.offset,s=e.groupBaseInfoFilter,a=e.groupList,r=Date.now();return this._grpM.req({P:xn.GET_GRP_LIST,data:{type:S.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:o,offset:i,responseFilter:{groupBaseInfoFilter:s,selfInfoFilter:m(F)},isSupportTopic:1,needAppDefineData:1}}).then((function(e){var c=(e=e.data).groups,u=(e=e.totalCount,a.push.apply(a,m(void 0===c?[]:c)),!((c=i+o)<e));return Oe.l("".concat(n," ok. offset:").concat(i," limit:").concat(o," totalCount:").concat(e," isCompleted:").concat(u," currentCount:").concat(a.length," cost:").concat(jt(r))),u?(t._grpM.updateGroupMap(a),t._grpM.emitGroupListUpdate(!0,!1),vn({groupList:e=t._grpM.getLocalGroupList().filter((function(e){return!0===e.isSupportTopic}))})):(i=c,t._pagingGetGroupListWithTopic({limit:o,offset:i,groupBaseInfoFilter:s,groupList:a}))})).catch((function(e){return 10018===e.code?(Oe.w("".concat(t.logPrefix," response size exceeds the limit, request count:").concat(o)),o=50,t._pagingGetGroupListWithTopic({limit:o,offset:i,groupBaseInfoFilter:s,groupList:a})):In(e)}))}},{key:"_cacheGroupMessage",value:function(e,t){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(t)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e,t){var n=this,o=this._cachedGroupMessageMap.get(e)||[];Oe.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," groupType:").concat(t," count:").concat(o.length)),o.forEach((function(e){n.onNewMessage(e)})),this._deleteCachedGroupMessage(e)}},{key:"_cacheAndCompare",value:function(e){var t=e.groupID,n=e.event,o=e.item;e=e.groupType,Oe.l("".concat(this._n,"._cacheAndCompare groupID:").concat(t," groupType:").concat(e)),this._cacheGroupMessage(t,{event:n,dataList:[o]}),n={groupID:t,type:e},e===S.GRP_AVCHATROOM?this._grpM.hasLocalGroup(t)?this._notifyCachedGroupMessage(t,e):this._grpM.setUnjoinedAVChatRoom(t):(this._grpM.updateGroupMap([n]),this._notifyCachedGroupMessage(t,e)),this._checkCountMap.has(t)||this._checkCountMap.set(t,0)}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var o=this;e&&0!==n.length&&n.forEach((function(e){var n=e.groupID,i=(e=e.groupAtInfoList,[]);ut(e)||(e.forEach((function(e){i.push(t(t({},e),{},{groupID:n}))})),o._grpM.get(11).onNewGroupAtTips({dataList:i}))}))}},{key:"setPagingGroupCount",value:function(e){ut(e)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(e,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=kn,this._pagingGetCostList=[]}}]),Xi),hi=(s($i,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_attr_cache_time");ut(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach((function(e){e.localMainSequence=0}))}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var t=e.to,n=(e=e.elements.newGroupProfile,!ut(e)&&!Be(e.groupAttributeOption));return n&&this._onGroupAttributesUpdated({groupID:t,groupAttributeOption:e.groupAttributeOption}),n}},{key:"_onGroupAttributesUpdated",value:function(e){var t=this,n=e.groupID,o=(e=e.groupAttributeOption).mainSequence,i=e.isWithChangedAttributeInfo,s=void 0===(s=e.groupAttributeList)?[]:s;if(e=e.operationType,Oe.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(n," isWithChangedAttributeInfo:").concat(i," operationType:").concat(e)),!ut(e)){this._groupAttributesCopy=this._getCachedAttributes({groupID:n});var a=o-this._getLocalGroupAttributes(n).localMainSequence;if(0!=a){if(1===i&&1==a)return this._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:o,groupAttributeList:s,operationType:e}),void this._emitGroupAttributesUpdated(n);this._hasLocalGroupAttributes(n)&&(i=this._getLocalGroupAttributes(n).avChatRoomKey,this._getGroupAttributes({groupID:n,avChatRoomKey:i}).then((function(){t._emitGroupAttributesUpdated(n)})))}}}},{key:"initGroupAttributesCache",value:function(e){var t=e.groupID;e=void 0===(e=e.avChatRoomKey)?void 0:e,this._groupAttributesMap.set(t,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:e}),Oe.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(t," avChatRoomKey:").concat(e))}},{key:"initGroupAttributes",value:function(e){var t=this,n=e.groupID,o=e.groupAttributes,i=(e=this._getLocalGroupAttributes(n)).remoteMainSequence,s=(e=e.avChatRoomKey,new eo("initGroupAttributes"));return s.setMessage("groupID:".concat(n," avChatRoomKey:").concat(e," mainSequence:").concat(i)),this._grpM.req({P:xn.SET_GRP_ATTR,data:{groupID:n,avChatRoomKey:e,mainSequence:i,groupAttributeList:this._transformGroupAttributes(o)}}).then((function(e){Oe.l("".concat(t._n,".").concat("initGroupAttributes"," ok. groupID:").concat(n));var i=(e=e.data).mainSequence;return(e=m(e.groupAttributeList)).forEach((function(e){e.value=o[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:i,groupAttributeList:e,operationType:1}),t._emitGroupAttributesUpdated(n),s.end(),vn({groupAttributes:o})})).catch((function(e){return s.setError(e).end(),In(e)}))}},{key:"setGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("setGroupAttributes"),o=e.groupID,i=e.groupAttributes,s=(e=this._getLocalGroupAttributes(o)).remoteMainSequence,a=e.avChatRoomKey,r=e.attributes,c=((e=this._transformGroupAttributes(i)).forEach((function(e){var t=e.key;e.sequence=0,r.has(t)&&(e.sequence=r.get(t).sequence)})),new eo("setGroupAttributes"));return c.setMessage("groupID:".concat(o," groupAttributes:").concat(JSON.stringify(i))),Oe.l("".concat(n,". groupID:").concat(o," mainSequence:").concat(s)),this._grpM.req({P:xn.MODIFY_GRP_ATTR,data:{groupID:o,avChatRoomKey:a,mainSequence:s,groupAttributeList:e}}).then((function(e){Oe.l("".concat(n," ok."));var s=(e=e.data).mainSequence;return(e=m(e.groupAttributeList)).forEach((function(e){e.value=i[e.key]})),t._groupAttributesCopy=t._getCachedAttributes({groupID:o}),t._refreshCachedGroupAttributes({groupID:o,remoteMainSequence:s,groupAttributeList:e,operationType:2}),t._emitGroupAttributesUpdated(o),c.end(),vn({groupAttributes:i})})).catch((function(e){return c.setError(e).end(),In(e)}))}},{key:"deleteGroupAttributes",value:function(e){var t=this,n=e.groupID,o=(e=void 0===(e=e.keyList)?[]:e,(r=this._getLocalGroupAttributes(n)).remoteMainSequence),i=r.avChatRoomKey,s=r.attributes,a=m(s.keys()),r=xn.CLEAR_GRP_ATTR,c=3,u=(i={groupID:n,avChatRoomKey:i,mainSequence:o},[]),l=(0<e.length&&(a=[],r=xn.DEL_GRP_ATTR,c=4,e.forEach((function(e){var t=0;s.has(e)&&(t=s.get(e).sequence,a.push(e)),u.push({key:e,sequence:t})})),i.groupAttributeList=u),new eo("deleteGroupAttributes"));return l.setMessage("groupID:".concat(n," mainSequence:").concat(o," keyList:").concat(e," proto:").concat(r)),this._grpM.req({P:r,data:i}).then((function(e){return Oe.l("".concat(t._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(n)),e=e.data.mainSequence,t._groupAttributesCopy=t._getCachedAttributes({groupID:n}),t._refreshCachedGroupAttributes({groupID:n,remoteMainSequence:e,groupAttributeList:u,operationType:c}),t._emitGroupAttributesUpdated(n),l.end(),vn({keyList:a})})).catch((function(e){return l.setError(e).end(),In(e)}))}},{key:"getGroupAttributes",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupAttributes"),o=e.groupID,i=(r=this._getLocalGroupAttributes(o)).avChatRoomKey,s=r.lastUpdateTime,a=r.localMainSequence,r=r.remoteMainSequence,c=new eo("getGroupAttributes");return c.setMessage("groupID:".concat(o," localMainSequence:").concat(a," remoteMainSequence:").concat(r," keyList:").concat(e.keyList)),Date.now()-s>=this.CACHE_EXPIRE_TIME||a<r?this._getGroupAttributes({groupID:o,avChatRoomKey:i}).then((function(i){return c.setMoreMessage("get attributes from remote. count:".concat(i.length)).end(),Oe.l("".concat(n," from remote. groupID:").concat(o)),vn({groupAttributes:i=t._getCachedAttributes(e)})})).catch((function(e){return c.setError(e).end(),In(e)})):(c.setMoreMessage("get attributes from cache").end(),Oe.l("".concat(n," from cache. groupID:").concat(o)),yn({groupAttributes:s=this._getCachedAttributes(e)}))}},{key:"_getGroupAttributes",value:function(e){var n=this,o=0;return ut(e.avChatRoomKey)||(o=1),this._grpM.req({P:xn.GET_GRP_ATTR,data:t(t({},e),{},{groupType:o})}).then((function(t){Oe.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var o=(t=t.data).mainSequence,i=m(t=t.groupAttributeList);return ut(o)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:o,groupAttributeList:i,operationType:5}),t})).catch((function(e){return In(e)}))}},{key:"_refreshCachedGroupAttributes",value:function(e){var t=e.groupID,n=e.remoteMainSequence,o=e.groupAttributeList;if(e=e.operationType,this._hasLocalGroupAttributes(t)){var i=this._getLocalGroupAttributes(t),s=i.localMainSequence;if(5===e||n-s==1)i.remoteMainSequence=n,i.localMainSequence=n,i.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:i,groupAttributeList:o,operationType:e});else{if(s===n)return;i.remoteMainSequence=n}this._groupAttributesMap.set(t,i),o="operationType:".concat(e," localMainSequence:").concat(s," remoteMainSequence:").concat(n),Oe.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(o))}}},{key:"_getCachedAttributes",value:function(e){var t=e.groupID,n=(e=void 0===(e=e.keyList)?[]:e,{});if(this._hasLocalGroupAttributes(t)){var o=this._getLocalGroupAttributes(t).attributes;if(0<e.length)e.forEach((function(e){o.has(e)&&(n[e]=o.get(e).value)}));else{var i,s=T(o.keys());try{for(s.s();!(i=s.n()).done;){var a=i.value;n[a]=o.get(a).value}}catch(r){s.e(r)}finally{s.f()}}}return n}},{key:"_updateCachedAttributes",value:function(e){var t=e.groupAttributes,n=e.groupAttributeList;3!==(e=e.operationType)?4!==e?(1===e&&t.attributes.clear(),n.forEach((function(e){var n=e.key,o=e.value;e=e.sequence,t.attributes.set(n,{value:o,sequence:e})}))):n.forEach((function(e){t.attributes.delete(e.key)})):t.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_emitGroupAttributesUpdated",value:function(e){var t=this._getCachedAttributes({groupID:e}),n=(o=this._computeAttrChangedInfo(t)).updatedKeyList,o=o.deletedKeyList;Oe.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(n.length,", delete:").concat(o.length)),0===n.length&&0===o.length||this._grpM.emitOEvt(E.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:t,updatedKeyList:n,deletedKeyList:o})}},{key:"_computeAttrChangedInfo",value:function(e){var t=this,n=[],o=[];return Object.keys(e).forEach((function(o){e[o]!==t._groupAttributesCopy[o]&&n.push(o)})),Object.keys(this._groupAttributesCopy).forEach((function(t){ut(e[t])&&o.push(t)})),this._groupAttributesCopy={},{updatedKeyList:n,deletedKeyList:o}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),$i),gi=(s(Ji,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_counter_expire_time");ut(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var t=e.to,n=!1;return Be(e=e.elements.groupCounterInfo)||(this._onGroupCountersUpdated({groupID:t,groupCounterInfo:e}),n=!0),n}},{key:"_onGroupCountersUpdated",value:function(e){var t=this,n=e.groupID;e.groupCounterInfo.forEach((function(e){var o=e.type,i=e.groupCounterSeq;e=void 0===(e=e.counterList)?[]:e,0!==o&&2!==o||(t._updateLocalGroupCounters({groupID:n,groupCounterSeq:i,counterList:e}),e.forEach((function(e){t._grpM.emitOEvt(E.GROUP_COUNTER_UPDATED,{groupID:n,key:e.key,value:e.value})}))),1===o&&t._deleteLocalGroupCounters({groupID:n,groupCounterSeq:i,counterList:e})})),Oe.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(n))}},{key:"initGroupCountersCache",value:function(e){var t=e.groupID;e=e.avChatRoomKey,this._groupCountersMap.set(t,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:e}),Oe.l("".concat(this._n,".initGroupCountersCache groupID:").concat(t," avChatRoomKey:").concat(e))}},{key:"setGroupCounters",value:function(e){if(!this._grpM.canIUse(U.GRP_COUNTER))return this._grpM.noUse("setGroupCounters");var t="".concat(this._n,".").concat("setGroupCounters"),n=e.groupID,o=(e=e.counters,e=this._convertObjectToList(e),this._getLocalGroupCounters(n).avChatRoomKey),i="groupID:".concat(n," count:").concat(e.length),s=new eo("setGroupCounters");return s.setMessage("".concat(i)),Oe.l("".concat(t,". ").concat(i)),this._updateGroupCounters({groupID:n,counterList:e,avChatRoomKey:o,mode:"Set"}).then((function(e){return s.end(),Oe.l("".concat(t," ok.")),vn({counters:e})})).catch((function(e){return s.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"increaseGroupCounter",value:function(e){var t="increaseGroupCounter";if(!this._grpM.canIUse(U.GRP_COUNTER))return this._grpM.noUse(t);var n="".concat(this._n,".").concat(t),o=e.groupID,i=e.key,s=(e=e.value,this._getLocalGroupCounters(o).avChatRoomKey),a="groupID:".concat(o," key:").concat(i," value:").concat(e),r=new eo(t);return r.setMessage("".concat(a)),Oe.l("".concat(n,". ").concat(a)),this._updateGroupCounters({groupID:o,counterList:[{key:i,value:e}],avChatRoomKey:s,mode:"Increase"}).then((function(e){return r.end(),Oe.l("".concat(n," ok.")),vn({counters:e})})).catch((function(e){return r.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"decreaseGroupCounter",value:function(e){var t="decreaseGroupCounter";if(!this._grpM.canIUse(U.GRP_COUNTER))return this._grpM.noUse(t);var n="".concat(this._n,".").concat(t),o=e.groupID,i=e.key,s=(e=e.value,this._getLocalGroupCounters(o).avChatRoomKey),a="groupID:".concat(o," key:").concat(i," value:").concat(e),r=new eo(t);return r.setMessage("".concat(a)),Oe.l("".concat(n,". ").concat(a)),this._updateGroupCounters({groupID:o,counterList:[{key:i,value:e}],avChatRoomKey:s,mode:"Decrease"}).then((function(e){return r.end(),Oe.l("".concat(n," ok.")),vn({counters:e})})).catch((function(e){return r.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"getGroupCounters",value:function(e){var t=this;if(!this._grpM.canIUse(U.GRP_COUNTER))return this._grpM.noUse("getGroupCounters");var n="".concat(this._n,".").concat("getGroupCounters"),o=e.groupID,i=void 0===(e=e.keyList)?[]:e,s=(e=this._getLocalGroupCounters(o)).avChatRoomKey,a=(e=e.lastUpdateTime,new eo("getGroupCounters"));return a.setMessage("groupID:".concat(o)),Date.now()-e>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:o,avChatRoomKey:s}).then((function(e){return a.setMoreMessage("from remote. count:".concat(e.length)).end(),Oe.l("".concat(n," from remote. groupID:").concat(o)),vn({counters:e=t._getLocalCounters(o,i)})})).catch((function(e){return a.setError(e).end(),In(e)})):(a.setMoreMessage("from cache").end(),Oe.l("".concat(n," from cache. groupID:").concat(o)),yn({counters:e=this._getLocalCounters(o,i)}))}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._grpM.req({P:xn.GET_GRP_COUNTER,data:t({},e)}).then((function(t){var o=void 0===(o=(t=t.data).counterList)?[]:o;return t=t.groupCounterSeq,n._updateLocalGroupCounters({groupID:e.groupID,counterList:o,groupCounterSeq:t}),Oe.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),o})).catch((function(e){return In(e)}))}},{key:"_convertObjectToList",value:function(e){var t=[];return Object.keys(e).forEach((function(n){t.push({key:n,value:e[n]})})),t}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),o=e.groupID,i=e.avChatRoomKey,s=e.mode;return Oe.l("".concat(n,". groupID:").concat(o," avChatRoomKey:").concat(i," mode:").concat(s)),this._grpM.req({P:xn.UPDATE_GRP_COUNTER,data:t({},e)}).then((function(e){Oe.l("".concat(n," ok.")),e=e.data.counterList;var t={};return(void 0===e?[]:e).forEach((function(e){var n=e.key;e=e.value,t[n]=e})),t})).catch((function(e){return In(e)}))}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var t,n,o,i=e.groupID,s=void 0===(s=e.counterList)?[]:s;e=e.groupCounterSeq,this._hasLocalGroupCounters(i)&&(o=this._getLocalGroupCounters(i),t=o.counters,n=o.avChatRoomKey,o=o.groupCounterSeq,0<e&&e<o||(s.forEach((function(e){var n=e.key;e=e.value,t.set(n,e)})),this._groupCountersMap.set(i,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:t,avChatRoomKey:n})))}},{key:"_deleteLocalGroupCounters",value:function(e){var t,n,o=e.groupID,i=void 0===(i=e.counterList)?[]:i;e=e.groupCounterSeq,this._hasLocalGroupCounters(o)&&(n=this._getLocalGroupCounters(o),t=n.counters,n=n.avChatRoomKey,i.forEach((function(e){t.delete(e.key)})),this._groupCountersMap.set(o,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:t,avChatRoomKey:n}))}},{key:"_getLocalCounters",value:function(e,t){var n={};if(!this._hasLocalGroupCounters(e))return n;var o=this._getLocalGroupCounters(e).counters;if(0<t.length)t.forEach((function(e){o.has(e)&&(n[e]=o.get(e))}));else{var i,s=T(o.keys());try{for(s.s();!(i=s.n()).done;){var a=i.value;n[a]=o.get(a)}}catch(r){s.e(r)}finally{s.f()}}return n}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),Ji),_i=(s(Wi,[{key:"start",value:function(){var e=this._grpM.isLoggedIn();e||(this._proto=xn.AV_NOAUTH_POLLING),Oe.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,t=this._onInit(this._groupID);this._grpM.req({P:this._proto,data:t}).then((function(t){e._onSuccess(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))})).catch((function(t){e._onFail(e._groupID,t),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))}))}},{key:"stop",value:function(){Oe.l("".concat(this._n,".stop")),0<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),Wi),fi={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0,100:!0},mi=(s(zi,[{key:"hasJoinedAVChatRoom",value:function(){var e=[];return 0<(e=0<this._joinedGroupMap.size?m(this._joinedGroupMap.values()).filter((function(e){return e.type===S.GRP_AVCHATROOM})):e).length}},{key:"getJoinedLiveList",value:function(){return 0<this._joinedGroupMap.size?m(this._joinedGroupMap.values()).filter((function(e){return e.type===S.GRP_LIVE})):[]}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?m(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===m(this._pollingInstanceMap.keys())[0]?t(t({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):t(t({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,t){var n,o=(c=t.data).key,i=c.nextSeq,s=c.rspMsgList,a=c.errorCode,r=c.nextBroadcastSeq,c=c.broadcastMessageList;0!==a?(a=this._pollingRequestInfoMap.get(e),n=new eo("longPollingAVError"),a=a?"".concat(a.key,"-").concat(a.startSeq):"requestInfo is undefined",n.setMessage("".concat(e,"-").concat(a,"-").concat(t.errorInfo)).setCode(t.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(e)&&(ct(o)&&Ke(i)&&this._pollingRequestInfoMap.set(e,{key:o,startSeq:i}),Ke(r)&&r>this._startBroadcastSeq&&(this._startBroadcastSeq=r),We(s)&&0<s.length?(s.forEach((function(e){e.to=e.groupID})),this.onMessage(s,e)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(c))}},{key:"_handleFailure",value:function(e,t){}},{key:"onMessage",value:function(e,t){if(We(e)&&0!==e.length){var n="".concat(this._n,".onMessage"),o=(t&&(n+=" groupID:".concat(t)),0!==this._pollingNoMessageCount&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),i=[],s=this._get(11),a=this._get(26),r=e.length,c=(1<r&&e.sort((function(e,t){return e.sequence-t.sequence})),this._get(12).isUnlimitedAVChatRoom()),u=!1;Oe.getLevel()<=0&&(t=e.map((function(e){return e.sequence})),Oe.l("".concat(n," count:").concat(t.length," sequenceList:").concat(t)),t.length=0);for(var l=0;l<r;l++){var d=this.restoreMessageFromSimplified(e[l]);if(fi[d.event]){if(6===d.event){if(this._grpM.isGroupAttributesUpdatedNotice(d))continue;if(this._grpM.isGroupCountersNotice(d))continue}if(20!==d.event)if(21!==d.event)if(100!==d.event){o=this.packMessage(d,d.event);var p=1===d.isModified;if(u=1===d.isHistoryMessage,!c){if(this._seqSll.has(o.sequence))continue;this._seqSll.set(o.sequence)}var h=this._IDSll.has(o.ID);h?Oe.w("".concat(n," ID:").concat(o.ID," has:").concat(h)):(this._IDSll.set(o.ID),h=!1,!u&&this._isMessageSentByCurrentInstance(o)?p&&(h=!0,o.isModified=p,s.updateMsgIsModifiedProp(o)):h=!0,h&&(o.conversationType===S.CONV_SYSTEM&&5===o.payload.operationType&&this._onGroupDismissed(o.payload.groupProfile.groupID),u||o.conversationType===S.CONV_SYSTEM||(p=o.conversationID.replace(S.CONV_GROUP,""),this._pollingInstanceMap.has(p)?this._grpM.isLoggedIn()&&a.addMessageSequence({key:Jn,message:o}):(o.type!==S.MSG_GRP_TIP&&0<o.clientTime&&a.addMessageDelay(o.clientTime),a.addMessageSequence({key:Wn,message:o}))),i.push(o)))}else this.onRoomCustomData(d);else this._get(34).onMessageReactionNotify({event:21,dataList:d.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(d)}else Oe.w("".concat(n,". unknown event:").concat(d.event))}0!==i.length&&(0<(t=mt(i)).length&&this._grpM.emitOEvt(E.MESSAGE_MODIFIED,t),u||0<(t=this.packConversationOption(i)).length&&s.onNewMessage({conversationOptionsList:t,isInstantMessage:!0}),this._checkMessageStacked(i),0<(t=vt(i)).length&&this._grpM.emitOEvt(E.MESSAGE_RECEIVED,t),i.length=0)}}},{key:"handleMessageRevokedNotice",value:function(e){var t=this,n=e.groupID,o=e.elements.revokeMsgList,i=e.revokerInfo,s=[];o.forEach((function(e){var t=e.tinyID,o=e.clientTime,a=e.random;e=e.sequence,t={conversationID:"".concat(S.CONV_GROUP).concat(n),ID:"".concat(t,"-").concat(o,"-").concat(a),revoker:i.revoker,revokeReason:i.reason||"",revokerInfo:{userID:i.revoker,nick:"",avatar:""},sequence:e},s.push(t)})),0!==s.length&&this._get(11).updateRevokerInfo(s).then((function(e){t._grpM.emitOEvt(E.MESSAGE_REVOKED,e)}))}},{key:"isBroadcastOrNormal",value:function(e){return 3===e||17===e}},{key:"isGroupTip",value:function(e){return 4===e||6===e}},{key:"isGroupSystemNotice",value:function(e){return 5===e}},{key:"restoreGroupTipElements",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=void 0===(t=e.operatorInfo)?{}:t,n=e.operatorID,o=void 0===(o=e.userIDList)?[]:o,i=e.operationType,s=(Ke(e.groupJoinType)||1!==i&&2!==i||(e.groupJoinType=2===i?0:1),i=t.userID,t.avatar);return t=t.nick,e.operatorInfo={userID:void 0===i?n:i,avatar:void 0===s?"":s,nick:void 0===t?"":t},n=o.map((function(e){return{userID:e}})),e.memberInfoList=e.memberInfoList||n,e}},{key:"restoreMessageFromSimplified",value:function(e){var n,o,i,s=e.event;return this.isBroadcastOrNormal(s)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map((function(e){var n;return e.type===S.MSG_CUSTOM&&(n=e.content,e.content=t({data:"",description:"",extension:""},void 0===n?{}:n)),e}))),(this.isGroupTip(s)||this.isGroupSystemNotice(s))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(s)&&(e.elements=this.restoreGroupTipElements(e.elements),o=(i=void 0===(i=e.elements)?{}:i).operationType,n=i.operatorInfo,1===o&&(o=[{userID:(void 0===n?{}:n).userID}],i.memberInfoList=i.memberInfoList||o)),this.isGroupSystemNotice(s)&&(i=(n=e.elements).memberInfoList,o=n.operatorInfo,e.elements.memberInfoList=t({userID:e.elements.operatorID,avatar:"",nick:""},i=i||(void 0===o?{}:o)),e.elements=t({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements),s=Object.keys(e.elements).filter((function(e){return"operatorInfo"!==e})).reduce((function(n,o){return t(t({},n),{},a({},o,e.elements[o]))}),{}),e.elements=s),e}},{key:"_onGroupDismissed",value:function(e){Oe.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var t="MessageStacked";100<=(e=e.length)&&(this._grpM.warn(t,e),this._reportMessageStackedCount<5&&(new eo(t).setMessage("count:".concat(e," groupID:").concat(m(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._get(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,t){e.currentUser=this._grpM.getMyUserID(),e.conversationType=5===t?S.CONV_SYSTEM:S.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var n=new So(e),o=(e=this.packElements(e,t),t=this._grpM.getFileDownloadProxy(),this._grpM.getDowloadFileAuthKey()),i=this._get(17).getFileDNList();return n.setElement(e,t,o,i),n}},{key:"packElements",value:function(e,n){return 4===n||6===n?(this._updateMemberCountByGroupTips(e),{type:S.MSG_GRP_TIP,content:t(t({},e.elements),{},{groupProfile:e.groupProfile})}):5===n?{type:S.MSG_GRP_SYS_NOTICE,content:t(t({},e.elements),{},{groupProfile:t(t({},e.groupProfile),{},{groupID:e.groupID})})}:e.elements}},{key:"packConversationOption",value:function(e){for(var t=new Map,n=0;n<e.length;n++){var o,i=e[n],s=i.conversationID;t.has(s)?"in"===((o=t.get(s)).lastMessage=i).flow&&o.unreadCount++:t.set(s,{conversationID:i.conversationID,unreadCount:"out"===i.flow?0:1,type:i.conversationType,subType:i.conversationSubType,lastMessage:i})}return m(t.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var t,n,o,i=e.groupProfile.groupID;Be(e=void 0===(e=e.elements.onlineMemberInfo)?void 0:e)||(t=void 0===(t=e.onlineMemberNum)?0:t,e=void 0===(e=e.expireTime)?this.DEFAULT_EXPIRE_TIME:e,n=this._onlineMemberCountMap.get(i)||{},o=Date.now(),Be(n)?Object.assign(n,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:o,memberCount:t,expireTime:e}):(n.latestUpdateTime=o,n.memberCount=t),this._onlineMemberCountMap.set(i,n))}},{key:"_onBroadcastMessage",value:function(e){if(!Be(e)){for(var t=[],n=e.length,o=null,i=0;i<n;i++){var s=this.restoreMessageFromSimplified(e[i]);fi[s.event]?((o=this.packMessage(s,s.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(o.ID)||(t.push(o),this._broadcastMessageIDMap.set(o.ID,1))):Oe.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(s.event))}0<t.length&&this._grpM.emitOEvt(E.MESSAGE_RECEIVED,t)}}},{key:"start",value:function(e){var t;this._pollingInstanceMap.has(e)?(t=this._pollingInstanceMap.get(e)).isRunning()||t.start():((t=new _i({manager:this,groupID:e,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(e,t),Oe.l("".concat(this._n,".start groupID:").concat(e)))}},{key:"handleJoinResult",value:function(e){var t=this;return this._preCheck(e.group).then((function(){var n=e.longPollingKey,o=e.group,i=o.groupID;return t._joinedGroupMap.set(i,o),t._grpM.updateGroupMap([o]),t._grpM.deleteUnjoinedAVChatRoom(i),t._grpM.emitGroupListUpdate(!0,!1),ut(n)?yn({status:Fe,group:o}):Promise.resolve()}))}},{key:"startRunLoop",value:function(e){var t=this;return this.handleJoinResult(e).then((function(){var n=e.longPollingKey,o=e.group,i=e.startSeq,s=o.groupID;return t._pollingRequestInfoMap.set(s,{key:n,startSeq:void 0===i?0:i}),t.start(s),t._grpM.isLoggedIn()?yn({status:Fe,group:o}):yn({status:Fe})}))}},{key:"_preCheck",value:function(e){if(this._get(12).isUnlimitedAVChatRoom())return Promise.resolve();if(!this.hasJoinedAVChatRoom())return Promise.resolve();if(e.type===S.GRP_LIVE)return Promise.resolve();var t=(e=f(this._joinedGroupMap.entries().next().value,2))[0];if(e=e[1],this._grpM.isLoggedIn()){if(e.selfInfo.role!==S.GRP_MBR_ROLE_OWNER&&e.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(t);this._grpM.deleteLocalGroupAndConversation(t)}else this._grpM.deleteLocalGroupAndConversation(t);return this.reset(t),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".").concat("joinWithoutAuth"),i=new eo("joinWithoutAuth");return this._grpM.req({P:xn.APPLY_JOIN_GRP_NOAUTH,data:e}).then((function(e){if(e=e.data.longPollingKey,i.setMessage("groupID:".concat(n," longPollingKey:").concat(e)).end(!0),ut(e))return In({code:wn.CANNOT_JOIN_NON_AV_WITHOUT_LOGIN});Oe.l("".concat(o," ok. groupID:").concat(n)),t._get(11).setCompleted("".concat(S.CONV_GROUP).concat(n));var s=new si({groupID:n});return t.startRunLoop({group:s,longPollingKey:e}),vn({status:Fe})})).catch((function(e){return Oe.e("".concat(o," failed. groupID:").concat(n," error:"),e),i.setError(e).setMessage("groupID:".concat(n)).end(!0),In(e)})).finally((function(){t._grpM.get(14).reportAtOnce()}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._onlineMemberCountMap.get(e)||{},n=Date.now();return Be(t)||n-t.lastSyncTime>1e3*t.expireTime&&1e4<n-t.latestUpdateTime&&3e3<n-t.lastReqTime?(t.lastReqTime=n,this._onlineMemberCountMap.set(e,t),this._getGroupOnlineMemberCount(e).then((function(e){return vn({memberCount:e.memberCount})})).catch((function(e){return In(e)}))):yn({memberCount:t.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),o=new eo("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(e).then((function(o){var i=t._onlineMemberCountMap.get(e)||{},s=void 0===(s=(o=o.data).memberCount)?0:s,a=(o=void 0===(o=o.expireTime)?t.DEFAULT_EXPIRE_TIME:o,Oe.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(s," expireTime:").concat(o)),Date.now());return Be(i)&&(i.lastReqTime=a),t._onlineMemberCountMap.set(e,Object.assign(i,{lastSyncTime:a,latestUpdateTime:a,memberCount:s,expireTime:o})),{memberCount:s}})).catch((function(t){return Oe.w("".concat(n," failed. error:"),t),o.setCode(t.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(t))).end(),Promise.reject(t)}))}},{key:"_get",value:function(e){return this._grpM.get(e)}},{key:"setPollingInterval",value:function(e){ut(e)||(Ke(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){ut(e)||(Ke(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){ut(e)||(Ke(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){ut(e)||"0"!==e&&"1"!==e||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){e=e.payload.groupProfile.groupID,Oe.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"restartPolling",value:function(){Oe.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,t=T(this._pollingInstanceMap.values());try{for(t.s();!(e=t.n()).done;){var n=e.value;n.stop(),n.start()}}catch(o){t.e(o)}finally{t.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var t=this._pollingInstanceMap.get(e).getPollingTimerID();return Oe.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(t)),t}},{key:"hasPollingInstance",value:function(e){return this._pollingInstanceMap.has(e)}},{key:"onRoomCustomData",value:function(e){var t=e.groupID,n=e.sequence,o=e.time;e=(e=e.elements)&&e.content,this._get(30).onRoomCustomDataReceived(e),Oe.l("".concat(this._n,".onRoomCustomData groupID:").concat(t," sequence:").concat(n," time:").concat(o," data:").concat(e))}},{key:"reset",value:function(e){if(e){Oe.l("".concat(this._n,".reset groupID:").concat(e));var t=this._pollingInstanceMap.get(e);t&&t.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{Oe.l("".concat(this._n,".reset all"));var n,o=T(this._pollingInstanceMap.values());try{for(o.s();!(n=o.n()).done;)n.value.stop()}catch(i){o.e(i)}finally{o.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this._seqSll.reset(),this._IDSll.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),zi),vi=(s(Yi,[{key:"updateMember",value:function(e){ut(e.onlineStatus)||(this.isOnline="Online"===e.onlineStatus);var t=[null,void 0,"",0,NaN];e.memberCustomField&&ft(this.memberCustomField,e.memberCustomField),Ze(this,e,["memberCustomField","marks","onlineStatus"],t)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){ut(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){ut(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&ft(this.memberCustomField,e)}}]),Yi),yi=(s(Ki,[{key:"_onProfileUpdated",value:function(e){for(var t=this,n=e.data,o=0;o<n.length;o++)!function(e){var o=n[e];t.groupMemberListMap.forEach((function(e){e.has(o.userID)&&e.get(o.userID).updateMember({nick:o.nick,avatar:o.avatar})}))}(o)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var t,n=this,o=e.groupID,i=void 0===(i=e.role)?void 0:i,s=void 0===(c=e.offset)?0:c,a=void 0===(c=e.count)?15:c,r=(e=void 0===(c=e.filter)?void 0:c,"".concat(this._n,".").concat("getGroupMemberList")),c=this._grpM.hasLocalGroup(o);if(Oe.l("".concat(r," groupID:").concat(o," role:").concat(i," offset:").concat(s," count:").concat(a," hasLocalGroup:").concat(c)),!c)return yn({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(o).type===S.GRP_AVCHATROOM){if(this._grpM.canIUse(U.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:o,offset:s,filter:e});this._grpM.warn("LiveOnlineMember")}i!==S.GRP_MBR_ROLE_ADMIN&&i!==S.GRP_MBR_ROLE_OWNER&&i!==S.GRP_MBR_ROLE_MEMBER||(t=i);var u=new eo("getGroupMemberList"),l=0,d=(c={groupID:o,limit:100<a?100:a,memberRoleFilter:t?[t]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},It({groupID:o})?c.next="".concat(s):(c.offset=s,l=s+a),[]);return this._grpM.req({P:xn.GET_GRP_MBR_LIST,data:c}).then((function(e){var t=(e=e.data).members,i=e.memberNum;return e=e.next,ut(e=void 0===e?void 0:e)||(l=Be(e)?0:e),We(t)&&0!==t.length?(n._grpM.hasLocalGroup(o)&&(n._grpM.getLocalGroupProfile(o).memberNum=i),d=n._updateLocalGroupMemberMap(o,t),n._grpM.get(4).getUserProfile({userIDList:t.map((function(e){return e.userID})),tagList:[Pe.NICK,Pe.AVATAR]})):(l=0,Promise.resolve([]))})).then((function(e){return We(e=e.data)&&0!==e.length?(e=e.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),n._updateLocalGroupMemberMap(o,e),d.length<a&&(l=0),u.setMessage("groupID:".concat(o," offset:").concat(s," count:").concat(a)).end(),Oe.l("".concat(r," ok.")),vn({memberList:d,offset:l})):yn({memberList:[],offset:l})})).catch((function(e){return u.setError(e).end(),Oe.e("".concat(r," failed. error:"),e),In(e)}))}},{key:"_getAVChatRoomMemberList",value:function(e){var n=this,o=e.groupID,i=e.offset,s=(e=e.filter,"".concat(this._n,".").concat("_getAVChatRoomMemberList")),a=new eo("_getAVChatRoomMemberList");return a.setMessage("groupID:".concat(o," offset:").concat(i," filter:").concat(e)),this._grpM.req({P:xn.GET_AV_MBR_LIST,data:{groupID:o,offset:i,filter:e}}).then((function(e){var i=void 0===(i=(e=e.data).memberList)?[]:i;return e=void 0===(e=e.offset)?0:e,a.end(),Oe.l("".concat(s," ok. member count:").concat(i.length,", next request timestamp:").concat(e)),i=i.map((function(e){return t(t({},e),{},{onlineStatus:"Online"})})),vn({memberList:i=n._updateLocalGroupMemberMap(o,i),offset:e})})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(s," failed. error:"),e),In(e)}))}},{key:"getGroupMemberProfile",value:function(e){var n=this,o="getGroupMemberProfile",i="".concat(this._n,".").concat(o),s="groupID:".concat(e.groupID),a=(5<e.userIDList.length?s+=" userIDList.length:".concat(e.userIDList.length):s+=" userIDList:".concat(e.userIDList),Oe.l("".concat(i," ").concat(s)),50<e.userIDList.length&&(e.userIDList=e.userIDList.slice(0,50)),e.groupID),r=e.userIDList;if((i=this._grpM.getLocalGroupProfile(a))&&yt(i.type))return In({code:i=wn.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(i,o)});var c=new eo(o);return c.setMessage(s),this._getGroupMemberProfileAdvance(t(t({},e),{},{userIDList:r})).then((function(e){return We(e=e.data.members)&&0!==e.length?(n._updateLocalGroupMemberMap(a,e),n._grpM.get(4).getUserProfile({userIDList:e.map((function(e){return e.userID})),tagList:[Pe.NICK,Pe.AVATAR]})):yn([])})).then((function(e){return e=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),n._updateLocalGroupMemberMap(a,e),e=r.filter((function(e){return n.hasLocalGroupMember(a,e)})).map((function(e){return n.getLocalGroupMemberInfo(a,e)})),c.end(),vn({memberList:e})}))}},{key:"addGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("addGroupMember"),o=e.groupID,i=this._grpM.getLocalGroupProfile(o),s=i.type,a=new eo("addGroupMember");return a.setMessage("groupID:".concat(o," groupType:").concat(s)),yt(s)?(s=new Gn({code:wn.CANNOT_ADD_MEMBER_IN_AV}),a.setError(s).end(),In(s)):(e.userIDList=e.userIDList.map((function(e){return{userID:e}})),Oe.l("".concat(n," groupID:").concat(o)),this._grpM.req({P:xn.ADD_GRP_MBR,data:e}).then((function(o){o=o.data.members;var s=(Oe.l("".concat(n," ok")),o.filter((function(e){return 1===e.result})).map((function(e){return e.userID}))),r=o.filter((function(e){return 0===e.result})).map((function(e){return e.userID})),c=o.filter((function(e){return 2===e.result})).map((function(e){return e.userID})),u=(o=o.filter((function(e){return 4===e.result})).map((function(e){return e.userID})),"groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(s,", ")+"failureUserIDList:".concat(r,", ")+"existedUserIDList:".concat(c,", ")+"overLimitUserIDList:".concat(o));return a.setMoreMessage(u).end(),0===s.length?vn({successUserIDList:s,failureUserIDList:r,existedUserIDList:c,overLimitUserIDList:o}):(t._updateConvGroupProfile(i),vn({successUserIDList:s,failureUserIDList:r,existedUserIDList:c,overLimitUserIDList:o,group:i}))})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)})))}},{key:"deleteGroupMember",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroupMember"),o=e.groupID,i=e.userIDList,s=this._grpM.getLocalGroupProfile(o);if(ut(s))return In({code:wn.CANNOT_FIND_GRP});if(yt(s.type))return this._grpM.canIUse(U.AV_BAN_MBR)?this._banAVChatRoomMember(e):this._grpM.noUse("deleteGroupMember");var a="groupID:".concat(o," ").concat(5<i.length?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),r=(Oe.l("".concat(n," groupID:").concat(o," userIDList:"),i),new eo("deleteGroupMember"));return r.setMessage(a),this._grpM.req({P:xn.DEL_GRP_MBR,data:e}).then((function(){return r.end(),Oe.l("".concat(n," ok")),t._updateConvGroupProfile(s),t.deleteLocalGroupMembers(o,i),vn({group:s,userIDList:i})})).catch((function(e){return r.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var t=this,n="".concat(this._n,".").concat("_banAVChatRoomMember"),o=e.groupID,i=e.userIDList,s="groupID:".concat(o," ").concat(5<i.length?"userIDList.length:".concat(i.length):"userIDList:".concat(i)),a=new eo("_banAVChatRoomMember"),r=(a.setMessage(s),Oe.l("".concat(n," groupID:").concat(o," userIDList:"),i),this._grpM.getLocalGroupProfile(o));return ut(e.duration)||0===e.duration?In({code:wn.BAN_DURATION_INVALID}):this._grpM.req({P:xn.BAN_AV_MBR,data:e}).then((function(){return a.end(),Oe.l("".concat(n," ok")),t.deleteLocalGroupMembers(o,i),vn({group:r,userIDList:i})})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"setGroupMemberMuteTime",value:function(e){var t=this,n=e.groupID,o=e.userID,i=(e=e.muteTime,"".concat(this._n,".").concat("setGroupMemberMuteTime"));if(o===this._grpM.getMyUserID())return In({code:wn.CANNOT_MUTE_SELF});var s="groupID:".concat(n," userID:").concat(o," muteTime:").concat(e),a=(Oe.l("".concat(i," ").concat(s)),new eo("setGroupMemberMuteTime"));return a.setMessage(s),this.modifyGroupMemberInfo({groupID:n,userID:o,muteTime:e}).then((function(e){return a.end(),Oe.l("".concat(i," ok")),vn({group:t._grpM.getLocalGroupProfile(n),member:e})})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(i," failed. error:"),e),In(e)}))}},{key:"setGroupMemberRole",value:function(e){var t="".concat(this._n,".").concat("setGroupMemberRole"),n=e.groupID,o=e.userID,i=(e=e.role,"groupID:".concat(n," userID:").concat(o," role:").concat(e)),s=this._grpM.getLocalGroupProfile(n);if(s&&s.selfInfo.role!==S.GRP_MBR_ROLE_OWNER)return In({code:wn.NOT_OWNER});var a=[S.GRP_MBR_ROLE_ADMIN,S.GRP_MBR_ROLE_MEMBER];if(It({groupID:n})&&a.push(S.GRP_MBR_ROLE_CUSTOM),a.indexOf(e)<0)return In({code:wn.INVALID_MEMBER_ROLE});if(o===this._grpM.getMyUserID())return In({code:wn.CANNOT_SET_SELF_MEMBER_ROLE});var r=new eo("setGroupMemberRole");return r.setMessage(i),Oe.l("".concat(t," ").concat(i)),this.modifyGroupMemberInfo({groupID:n,userID:o,role:e}).then((function(e){return r.end(),Oe.l("".concat(t," ok")),vn({group:s,member:e})})).catch((function(e){return r.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_filterProfanity",value:function(e,t){if(!(o=this._grpM.get(29)))return!0;var n=(o=o.filterText(t[e],"group_member_profile")).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"setGroupMemberNameCard",value:function(e){var t=this,n="setGroupMemberNameCard",o="".concat(this._n,".").concat(n);if(e.nameCard&&!1===this._filterProfanity("nameCard",e))return In({code:wn.PROFANITY_FOUND});var i=e.groupID,s=void 0===(r=e.userID)?this._grpM.getMyUserID():r,a=e.nameCard,r="groupID:".concat(i," userID:").concat(s," nameCard:").concat(a);if(Oe.l("".concat(o," ").concat(r)),(e=this._grpM.getLocalGroupProfile(i))&&yt(e.type))return In({code:e=wn.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(e,n)});var c=new eo(n);return c.setMessage(r),this.modifyGroupMemberInfo({groupID:i,userID:s,nameCard:a}).then((function(e){Oe.l("".concat(o," ok")),c.end();var n=t._grpM.getLocalGroupProfile(i);return s===t._grpM.getMyUserID()&&n&&n.setSelfNameCard(a),vn({group:n,member:e})})).catch((function(e){return c.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"setGroupMemberCustomField",value:function(e){var t=this,n="setGroupMemberCustomField",o="".concat(this._n,".").concat(n),i=e.groupID,s=void 0===(s=e.userID)?this._grpM.getMyUserID():s,a=(e=e.memberCustomField,"groupID:".concat(i," userID:").concat(s," memberCustomField:").concat(JSON.stringify(e))),r=(Oe.l("".concat(o," ").concat(a)),this._grpM.getLocalGroupProfile(i));if(r&&yt(r.type))return In({code:r=wn.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(r,n)});var c=new eo(n);return c.setMessage(a),this.modifyGroupMemberInfo({groupID:i,userID:s,memberCustomField:e}).then((function(e){return c.end(),Oe.l("".concat(o," ok")),vn({group:t._grpM.getLocalGroupProfile(i),member:e})})).catch((function(e){return c.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,o=e.groupID,i=e.userID,s=void 0;return Mt(o)&&(o=Gt(s=o)),this._grpM.req({P:xn.MODIFY_GRP_MBR_INFO,data:t(t({},e),{},{groupID:o,topicID:s})}).then((function(){if(n.hasLocalGroupMember(o,i))return t=n.getLocalGroupMemberInfo(o,i),ut(e.muteTime)||t.updateMuteUntil(e.muteTime),ut(e.role)||t.updateRole(e.role),ut(e.nameCard)||t.updateNameCard(e.nameCard),ut(e.memberCustomField)||t.updateMemberCustomField(e.memberCustomField),t;var t=n._grpM.getLocalGroupProfile(o);return t&&!yt(t.type)?n.getGroupMemberProfile({groupID:o,userIDList:[i]}).then((function(e){return f(e.data.memberList,1)[0]})):void 0}))}},{key:"markGroupMemberList",value:function(e){var t="".concat(this._n,".").concat("markGroupMemberList"),n=e.groupID,o=e.markType,i=e.enableMark,s=void 0===(e=e.userIDList)?[]:e,a=(e="groupID:".concat(n," markType:").concat(o," enableMark:").concat(i," userIDList count:").concat(s.length),Oe.l("".concat(t," ").concat(e)),2),r=[],c=(!0===i&&(a=1),i=m(s),500<s.length&&(i=s.slice(0,500),Oe.w("".concat(t," ").concat(qt(500)))),i.forEach((function(e){r.push({userID:e,markType:[o]})})),i=null,new eo("markGroupMemberList"));return c.setMessage(e),this._grpM.req({P:xn.MARK_AV_MBR_INFO,data:{groupID:n,operationType:a,memberList:r}}).then((function(e){e=e.data.memberList;var n=[],o=[];return(e=void 0===e?[]:e).length===s.length?n.push.apply(n,m(s)):(e.forEach((function(e){n.push(e.userID)})),s.forEach((function(e){n.includes(e)||o.push(e)}))),e="success count:".concat(n.length," fail count:").concat(o.length),c.setMessage(e).end(),Oe.l("".concat(t," ok. ").concat(e)),vn({successUserIDList:n,failureUserIDList:o})})).catch((function(e){return c.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this._grpM.req({P:xn.GET_GRP_MBR_PROFILE,data:t(t({},e),{},{memberInfoFilter:e.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(e,t){var n=this;return We(t)&&0!==t.length?t.map((function(t){return n.hasLocalGroupMember(e,t.userID)?n.getLocalGroupMemberInfo(e,t.userID).updateMember(t):n.setLocalGroupMember(e,new vi(t)),n.getLocalGroupMemberInfo(e,t.userID)})):[]}},{key:"deleteLocalGroupMembers",value:function(e,t){var n=this.groupMemberListMap.get(e);n&&t.forEach((function(e){n.delete(e)}))}},{key:"getLocalGroupMemberInfo",value:function(e,t){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(t):null}},{key:"setLocalGroupMember",value:function(e,t){this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).set(t.userID,t):(t=(new Map).set(t.userID,t),this.groupMemberListMap.set(e,t))}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,t){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(t)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),Ki),Ii=[17,18,20],Mi=(s(ji,[{key:"onNewGroupSystemNotice",value:function(e){var t=e.dataList,n=e.isSyncingEnded,o=(e=e.isInstantMessage,(Oe.d("".concat(this._n,".onReceiveSystemNotice count:").concat(t.length)),t=this._assembly({notifiesList:t,isInstantMessage:e})).eventDataList);t=t.result,0<o.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:e}),this._onReceivedGroupSystemNotice({result:t,isInstantMessage:e})),e?0<t.length&&this._grpM.emitOEvt(E.MESSAGE_RECEIVED,t):!0===n&&this._clearGroupSystemNotice()}},{key:"_assembly",value:function(e){var n=e.notifiesList,o=e.isInstantMessage,i=null,s=n.length,a=0,r=[],c={conversationID:S.CONV_SYSTEM,unreadCount:0,type:S.CONV_SYSTEM,subType:null,lastMessage:null};for(a=0;a<s;a++){var u=n[a],l=(d=u.groupProfile).communityType,d=void 0===(d=d.topicID)?void 0:d,p=void 0===(p=(h=u.elements).topicIDList)?void 0:p,h=h.operationType;if(!(2!==(void 0===l?0:l)||Be(d)&&Be(p))){if(Ii.includes(h)){this._handleTopicSystemNotice(u);continue}Be(d)||(u.to=d)}15!==u.elements.operationType&&(u.currentUser=this._grpM.getMyUserID(),u.conversationType=S.CONV_SYSTEM,u.conversationID=S.CONV_SYSTEM,(i=new So(u)).setElement({type:S.MSG_GRP_SYS_NOTICE,content:t(t({},u.elements),{},{groupProfile:t({},u.groupProfile)})}),i.isSystemMessage=!0,(1===i.sequence&&1===i.random||2===i.sequence&&2===i.random)&&(i.sequence=nt(),i.random=nt(),i.generateMessageID(),Oe.l("".concat(this._n,"._assembly regenerate ID:").concat(i.ID))),this._grpM.get(11).pushIntoNoticeResult(r,i)&&(o?c.unreadCount++:i.setIsRead(!0),c.subType=i.conversationSubType))}return c.lastMessage=r[r.length-1],{eventDataList:0<r.length?[c]:[],result:r}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then((function(t){t.forEach((function(t){e.pendencyMap.set("".concat(t.from,"_").concat(t.groupID,"_").concat(t.to),t)})),t=e._grpM.get(11).getLocalMessageList(S.CONV_SYSTEM);var n=[];t.forEach((function(t){var o=(s=t.payload).operatorID,i=s.operationType,s=s.groupProfile;1===i&&(i="".concat(o,"_").concat(s.groupID,"_").concat(s.to),(o=e.pendencyMap.get(i))&&Ke(o.handled)&&0!==o.handled&&n.push(t))})),e.deleteGroupSystemNotice({messageList:n})}))}},{key:"deleteGroupSystemNotice",value:function(e){var t=this,n="".concat(this._n,".deleteGroupSystemNotice");return We(e.messageList)&&0!==e.messageList.length?(Oe.l("".concat(n," ")+e.messageList.map((function(e){return e.ID}))),this._grpM.req({P:xn.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:e.messageList.map((function(e){return{from:S.CONV_SYSTEM,messageSeq:e.clientSequence,messageRandom:e.random}}))}}).then((function(){Oe.l("".concat(n," ok"));var o=t._grpM.get(11);return e.messageList.forEach((function(e){o.deleteLocalMessage(e)})),vn()})).catch((function(e){return Oe.e("".concat(n," error:"),e),In(e)}))):yn()}},{key:"_getPendencyList",value:function(){var e=this,t=(o=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).type,n=o.startTime,o=o.limit;return this._grpM.req({P:xn.GET_GRP_PENDENCY,data:{type:void 0===t?void 0:t,startTime:void 0===n?0:n,limit:void 0===o?20:o,handleAccount:this._grpM.getMyUserID()}}).then((function(t){var n=t.data.pendencyList;return 0!==t.data.nextStartTime?e._getPendencyList({startTime:t.data.nextStartTime}).then((function(e){return[].concat(m(n),m(e))})):n}))}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then((function(t){return e._getPendencyList({type:S.GRP_COMMUNITY}).then((function(n){return t.push.apply(t,m(n)),e._handlePendencyResult(t)})).catch((function(n){return e._handlePendencyResult(t)}))}))}},{key:"_handlePendencyResult",value:function(e){var t=this,n=[];return e.forEach((function(e){t.pendencyMap.set("".concat(e.from,"_").concat(e.groupID,"_").concat(e.to),e),0===e.handled&&n.push({applicant:e.from,applicantNick:e.fromUserNickName,groupName:e.groupName,groupID:e.groupID,authentication:e.authentication,messageKey:e.time,applicationType:e.applicationType,userID:e.userID,note:e.note})})),yn({applicationList:n})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var t=this,n=e.result;e.isInstantMessage&&n.forEach((function(e){switch(e.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:t._onApplyJoinGroup(e);break;case 4:t._onMemberKicked(e);break;case 5:t._onGroupDismissed(e);break;case 7:t._onInviteGroup(e);break;case 8:t._onQuitGroup(e);break;case 9:t._onSetManager(e);break;case 10:t._onDeleteManager(e);break;case 20:t._onMessageRemindTypeSynced(e);break;case 21:t._grpM.onAVChatRoomMemberBanned(e)}}))}},{key:"_onApplyJoinGroup",value:function(e){var t=this,n=(e=e.payload.groupProfile).groupID,o=(e=e.groupType,this._grpM.hasLocalGroup(n));Oe.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(n," groupType:").concat(e," hasGroup:").concat(o)),o||yt(e)||this._grpM.getGroupProfile({groupID:n}).then((function(e){(e=e.data.group)&&(t._grpM.updateGroupMap([e]),e=!e.isSupportTopic,t._grpM.emitGroupListUpdate(!0,e))}))}},{key:"_onMemberKicked",value:function(e){e=e.payload.groupProfile.groupID,this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e)}},{key:"_onGroupDismissed",value:function(e){e=e.payload.groupProfile.groupID;var t=(this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e),this._grpM._AVChatRoomHandler);t&&t.checkJoinedAVChatRoomByID(e)&&t.reset(e)}},{key:"_onInviteGroup",value:function(e){var t=this,n=e.payload.groupProfile.groupID;e=this._grpM.hasLocalGroup(n),Oe.l("".concat(this._n,"._onInviteGroup groupID:").concat(n," hasGroup:").concat(e)),this._grpM.getGroupProfile({groupID:n}).then((function(){t._grpM.emitGroupListUpdate(),t._grpM.get(11).pullMsgOnInvite("".concat(S.CONV_GROUP).concat(n))}))}},{key:"_onQuitGroup",value:function(e){var t=(e=e.payload.groupProfile).groupID,n=(e=e.groupType,this._grpM.hasLocalGroup(t));Oe.l("".concat(this._n,"._onQuitGroup groupID:").concat(t," groupType:").concat(e," hasGroup:").concat(n)),n&&this._grpM.deleteLocalGroupAndConversation(t)}},{key:"_onSetManager",value:function(e){var t=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,t))&&e.updateRole(S.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var t=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,t))&&e.updateRole(S.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var t=e.payload.groupProfile.groupID;e=e.payload.messageRemindType,this._grpM.get(11).onGroupMsgRemindTypeUpdated({groupID:t,messageRemindType:e})}},{key:"_handleTopicSystemNotice",value:function(e){var t=(n=e.groupProfile).groupID,n=n.topicID,o=(e=e.elements).operationType,i=e.topicIDList,s=(e=e.messageRemindType,this._grpM.get(10));17===o?s.onTopicCreated({groupID:t,topicID:n}):18===o?s.onTopicDeleted({groupID:t,topicIDList:i}):20===o&&s.onMessageRemindTypeUpdated({groupID:t,topicID:n,messageRemindType:e})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),ji),Ci=["relayFlag"],Ti=(r(Hi,Nn),Zo=g(Hi),s(Hi,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("polling_interval"),t=this.getCloudConfig("polling_interval_plus"),n=this.getCloudConfig("polling_no_msg_count"),o=this.getCloudConfig("polling_simplified_msg"),i=this.getCloudConfig("paging_grp_count");Oe.l("".concat(this._n,"._onCloudConfig pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(t," pollingNoMessageCount:").concat(n)+" pollingSimplifiedMessage:".concat(o," pagingGroupCount:").concat(i)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(t),this._AVChatRoomHandler.setPollingNoMessageCount(n),this._AVChatRoomHandler.setPollingSimplifiedMessage(o),this._commonGroupHandler.setPagingGroupCount(i)}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var t,n=this;return e.conversationType===S.CONV_GROUP?(t=Mt(e.to)?Gt(e.to):e.to,this.hasLocalGroup(t)?yn():this.getGroupProfile({groupID:t}).then((function(o){return o=o.data.group.type,Oe.l("".concat(n._n,".guardForAVChatRoom. groupID:").concat(t," type:").concat(o)),o===S.GRP_AVCHATROOM?In(new Gn({code:o=wn.MSG_SEND_FAIL_NOT_IN_AV,message:n.getErrMsg(o,e.from,t),data:{message:e}})):yn()}))):yn()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewMessage",value:function(e){this._commonGroupHandler.onNewMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var t,n=this;We(e)&&(t=this.get(10),e.forEach((function(e){var o=e.conversationID.replace(S.CONV_GROUP,"");Mt(o)&&t.updateUnreadCountAndLastMsg(o,e.lastMessage),n.groupMap.has(o)&&(n.groupMap.get(o).nextMessageSeq=e.lastMessage.sequence+1)})))}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler.onNewGroupTips(e)}},{key:"onMsgRevoked",value:function(e){this._commonGroupHandler.onMsgRevoked(e,!(1<arguments.length&&void 0!==arguments[1])||arguments[1])}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onMsgReadNotice",value:function(e){var t=this;e.dataList.forEach((function(e){var n;e=e.elements.groupMessageReadNotice,ut(e)||(n=t.get(11),e.forEach((function(e){var o=e.groupID,i=void 0===(i=e.topicID)?void 0:i,s=(e=e.lastMessageSeq,Oe.l("".concat(t._n,".onMsgReadNotice groupID:").concat(o," lastMessageSeq:").concat(e)),o="".concat(S.CONV_GROUP).concat(o),!0);Be(i)||(o="".concat(S.CONV_GROUP).concat(i),s=!1),n.updateIsReadAfterReadReport({conversationID:o,lastMessageSeq:e}),n.updateUnreadCount(o,s),n.clearGroupAtInfoList(o,s)})))}))}},{key:"onReadReceiptList",value:function(e){var t=this;Oe.l("".concat(this._n,".onReadReceiptList options:"),e),e.dataList.forEach((function(e){var n=e.groupProfile,o=(e=e.elements,n=n.groupID,t.get(11));e=e.readReceiptList,o.updateReadReceiptInfo({groupID:n,readReceiptList:e})}))}},{key:"onMsgModified",value:function(e){Oe.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach((function(e){n.onMessageModified(t(t({},e),{},{conversationType:S.CONV_GROUP,to:e.topicID||e.groupID}))}))}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new si(e))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var t,n=this,o=this.get(11);e.forEach((function(e){t=e.groupID,n.groupMap.has(t)?n.groupMap.get(t).updateGroup(e):(n.groupMap.set(t,new si(e)),o.deleteGroupRoamingInfo(t))}));var i,s=this.getMyUserID(),a=T(this.groupMap);try{for(a.s();!(i=a.n()).done;){var r=f(i.value,2)[1];r.selfInfo.userID=s,"Owner"===r.selfInfo.role&&(r.ownerID=s)}}catch(c){a.e(c)}finally{a.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return m(this.groupMap.values()).filter((function(e){return e.type!==S.GRP_ROOM&&e.type!==S.GRP_LIVE}))}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=m(this.groupMap).filter((function(e){return(e=f(e,2))[0],!Be(e[1].lastMessage)}));e.sort((function(e,t){return t[1].lastMessage.lastTime-e[1].lastMessage.lastTime})),this.groupMap=new Map(m(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler.updateLastMsg(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1],n=this.getLocalGroupList();e&&this.emitOEvt(E.GROUP_LIST_UPDATED),t&&(e=JSON.parse(JSON.stringify(n)),this.get(11).updateConvGroupProfile(e))}},{key:"getMyNameCardByGroupID",value:function(e){return(e=this.getLocalGroupProfile(e))?e.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMsgRemindType",value:function(e){var t=this;return We(e)&&0!==e.length?0===(e=e.filter((function(e){return!yt(t.getLocalGroupProfile(e).type)}))).length?Promise.resolve():(Oe.l("".concat(this._n,".getMsgRemindType groupIDList:").concat(e)),this.getGroupProfileAdvance({groupIDList:e,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then((function(e){e=e.data.successGroupList;var n=t.get(11);e.forEach((function(e){n.onGroupMsgRemindTypeUpdated({groupID:e.groupID,messageRemindType:We(e.members)?e.members[0].messageRemindType:""})}))}))):Promise.resolve()}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getGroupProfile"),o=new eo("getGroupProfile"),i=e.groupID,s=e.groupCustomFieldFilter;return Oe.l("".concat(n," groupID:").concat(i)),s={groupIDList:[i],responseFilter:{groupBaseInfoFilter:m(w),groupCustomFieldFilter:s,memberInfoFilter:[].concat(m(F),["NameCard"])}},this.getGroupProfileAdvance(s).then((function(e){var s=(e=e.data).successGroupList;return e=e.failureGroupList,Oe.l("".concat(n," ok")),0<e.length?In(e[0]):((e=yt(s[0].type)&&!t.hasLocalGroup(i)?new si(s[0]):(t.updateGroupMap(s),t.getLocalGroupProfile(i))).isSupportTopic||t.get(11).updateConvGroupProfile([e]),o.setMessage("groupID:".concat(i," type:").concat(e.type," muteAllMembers:").concat(e.muteAllMembers," ownerID:").concat(e.ownerID)).end(),vn({group:e}))})).catch((function(t){return o.setError(t).setMessage("groupID:".concat(e.groupID)).end(),Oe.e("".concat(n," failed. error:"),t),In(t)}))}},{key:"getGroupProfileAdvance",value:function(e){var n,o="".concat(this._n,".getGroupProfileAdvance"),i=(We(a=e.groupIDList)&&50<a.length&&(this.warn("GetGroupProfileLimit"),a.length=50),[]),s=[],a=(a.forEach((function(e){(It({groupID:e})?s:i).push(e)})),[]);return 0<i.length&&(n=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:i})),a.push(n)),0<s.length&&(n=this._getGroupProfileAdvance(t(t({},e),{},{groupIDList:s,relayFlag:0<i.length})),a.push(n)),Promise.all(a).then((function(e){var t=[],n=[];return e.forEach((function(e){t.push.apply(t,m(e.successGroupList)),n.push.apply(n,m(e.failureGroupList))})),vn({successGroupList:t,failureGroupList:n})})).catch((function(e){return Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"_getGroupProfileAdvance",value:function(e){var t=this,n=e.relayFlag,o=void 0!==n&&n,i=p(e,Ci);return this.req({P:xn.GET_GRP_PROFILE,data:i}).then((function(e){return Oe.l("".concat(t._n,"._getGroupProfileAdvance ok. options:"),i),{successGroupList:(e=e.data.groups).filter((function(e){return ut(e.errorCode)||0===e.errorCode})),failureGroupList:e.filter((function(e){return e.errorCode&&0!==e.errorCode})).map((function(e){return new Gn({code:e.errorCode,message:e.errorInfo,data:{groupID:e.groupID}})}))}})).catch((function(t){return o&&It({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:In(t)}))}},{key:"createGroup",value:function(e){var n=this,o=[S.GRP_PUBLIC,S.GRP_WORK,S.GRP_MEETING,S.GRP_AVCHATROOM,S.GRP_COMMUNITY],i="".concat(this._n,".").concat("createGroup"),s=e.type,a=e.groupID;if(e.name&&!1===this._filterProfanity("name",e))return In({code:wn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return In({code:wn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return In({code:wn.PROFANITY_FOUND});if(!o.includes(s))return In({code:wn.ILLEGAL_GRP_TYPE});if(!It({type:s})){if(!Be(a)&&It({groupID:a}))return In({code:wn.ILLEGAL_GRP_ID});e.isSupportTopic=void 0}if(yt(s)&&!ut(e.memberList)&&0<e.memberList.length&&(e.memberList=void 0),this._canIUseJoinOption(s)||ut(e.joinOption)||(e.joinOption=void 0),It({type:s})){if(!Be(a)&&!It({groupID:a}))return In({code:wn.ILLEGAL_GRP_ID});e.isSupportTopic=!0===e.isSupportTopic?1:0}var r=new eo("createGroup"),c=(Oe.l("".concat(i," options:"),e),null),u=[];return this.req({P:xn.CREATE_GRP,data:t(t({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then((function(o){var s=(o=o.data).groupID,a=void 0===(o=o.overLimitUserIDList)?[]:o;if(c=s,u=a,o="groupType:".concat(e.type," groupID:").concat(s," overLimitUserIDList:").concat(a),r.setMessage(o).end(),Oe.l("".concat(i," ok. ").concat(o)),e.type===S.GRP_AVCHATROOM)return n.getGroupProfile({groupID:s});if(e.type===S.GRP_COMMUNITY&&1===e.isSupportTopic)return n.getGroupProfile({groupID:s});Be(e.memberList)||Be(a)||(e.memberList=e.memberList.filter((function(e){return-1===a.indexOf(e.userID)}))),n.updateGroupMap([t(t({},e),{},{groupID:s})]),o=n.get(2);var l="",d=0,p=(e.type===S.GRP_COMMUNITY?(l=n.isIntl()?"Create Community":"创建社群",d=1):l=n.isIntl()?"Create Group":"创建群组",n.get(4).getMyNick());return l=o.createCustomMessage({to:s,conversationType:S.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:l,cmd:d,opUser:p||n.getMyUserID(),version:4})}}),o.sendMessageInstance(l),n.emitGroupListUpdate(),n.getGroupProfile({groupID:s})})).then((function(e){var t=(n=(e=e.data.group).selfInfo).nameCard,n=n.joinTime;return e.updateSelfInfo({nameCard:t,joinTime:n,messageRemindType:S.MSG_REMIND_ACPT_AND_NOTE,role:S.GRP_MBR_ROLE_OWNER}),vn({group:e,overLimitUserIDList:u})})).catch((function(o){var s;return r.setMessage("groupType:".concat(e.type)).setError(o).end(),10010===o.code||10007===o.code?(n._silentlyGetGroupProfile(o.code,c),n.updateGroupMap([t(t({},e),{},{groupID:c})]),(s=n.getLocalGroupProfile(c)).selfInfo.role=S.GRP_MBR_ROLE_OWNER,vn({group:s,overLimitUserIDList:u})):(Oe.e("".concat(i," failed. error:"),o),In(o))}))}},{key:"dismissGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("dismissGroup"),o="groupID:".concat(e),i=new eo("dismissGroup");return i.setMessage(o),Oe.l("".concat(n," ").concat(o)),this.req({P:xn.DISMISS_GRP,data:{groupID:e}}).then((function(){return i.end(),Oe.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),t.checkJoinedAVChatRoomByID(e)&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),vn({groupID:e})})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"updateGroupProfile",value:function(e){var t,n=this,o="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)&&(t=this.getLocalGroupProfile(e.groupID).type,this._canIUseJoinOption(t)||ut(e.joinOption)||(Oe.w("".concat(o," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)),ut(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&!1===this._filterProfanity("name",e))return In({code:wn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return In({code:wn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return In({code:wn.PROFANITY_FOUND});var i=new eo("updateGroupProfile");return i.setMessage(JSON.stringify(e)),Oe.l("".concat(o," groupID:").concat(e.groupID)),this.req({P:xn.UPDATE_GRP_PROFILE,data:e}).then((function(){return i.end(),Oe.l("".concat(o," ok")),n.hasLocalGroup(e.groupID)&&n.groupMap.get(e.groupID).updateGroup(e),vn({group:n.groupMap.get(e.groupID)})})).catch((function(e){return i.setError(e).end(),Oe.l("".concat(o," failed. error:"),e),In(e)}))}},{key:"_filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],G)).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"joinGroup",value:function(e){var t=this,n=e.groupID,o="".concat(this._n,".joinGroup");if(this.deleteUnjoinedAVChatRoom(n),this.hasLocalGroup(n)){if(!this.isLoggedIn())return yn({status:S.JOIN_STATUS_ALREADY_IN_GROUP});var i=new eo("applyJoinGroup");return this.getGroupProfile({groupID:n}).then((function(){return i.setMessage("groupID:".concat(n," joinedStatus:").concat(S.JOIN_STATUS_ALREADY_IN_GROUP)).end(),yn({status:S.JOIN_STATUS_ALREADY_IN_GROUP})})).catch((function(s){return i.setMessage("groupID:".concat(n," unjoined")).end(),Oe.w("".concat(o," ").concat(n," was unjoined, now join!")),t.groupMap.delete(n),t.applyJoinGroup(e)}))}return Oe.l("".concat(o," groupID:").concat(n)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,o="".concat(this._n,".").concat("applyJoinGroup"),i=e.groupID;if(!Be(e.applyMessage)&&!1===this._filterProfanity("applyMessage",e))return In({code:wn.PROFANITY_FOUND});var s=new eo("applyJoinGroup"),a=(e=t({},e),this.canIUse(U.AV_HISTORY_MSG));return a&&(e.historyMessageFlag=1),this.get(11).deleteTopicRoamingInfo(i),this.req({P:xn.APPLY_JOIN_GRP,data:e}).then((function(e){var t=(e=e.data).joinedStatus,r=e.longPollingKey,c=e.startSeq,u=e.avChatRoomFlag,l=e.avChatRoomKey,d=e.messageList;switch(e="groupID:".concat(i," joinedStatus:").concat(t," longPollingKey:").concat(r," startSeq:").concat(c)+" avChatRoomFlag:".concat(u," canGetAVChatRoomHistoryMsg:").concat(a,",")+" historyMsgCount:".concat(Be(d)?0:d.length),s.setMessage(e).end(),Oe.l("".concat(o," ok. ").concat(e)),t){case xe:return vn({status:xe});case Fe:return n.getGroupProfile({groupID:i}).then((function(e){return e=e.data.group,n._handleJoinResult({group:e,avChatRoomFlag:u,longPollingKey:r,startSeq:c,avChatRoomKey:l,messageList:d})})).catch((function(e){var t;return 10010===e.code||10007===e.code?(n._silentlyGetGroupProfile(e.code,i),t=new si({groupID:i}),n.updateGroupMap([t]),n._handleJoinResult({group:t,avChatRoomFlag:u,longPollingKey:r,startSeq:c,avChatRoomKey:l,messageList:d})):(Oe.e("".concat(o," failed. error:"),e),In(e))}));default:var p=new Gn({code:wn.JOIN_GRP_FAIL});return Oe.e("".concat(o," failed. error:"),p),In(p)}})).catch((function(e){return s.setMessage("groupID:".concat(i)).setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"_handleJoinResult",value:function(e){var t=this,n=e.group,o=e.avChatRoomFlag,i=e.longPollingKey,s=e.startSeq,a=e.avChatRoomKey,r=e.messageList,c=n.groupID;return 1===o?(this.get(11).setCompleted("".concat(S.CONV_GROUP).concat(c)),this._groupAttributesHandler.initGroupAttributesCache({groupID:c,avChatRoomKey:a}),this._groupCountersHandler.initGroupCountersCache({groupID:c,avChatRoomKey:a}),(e=ut(i)?this._AVChatRoomHandler.handleJoinResult({group:n}):this._AVChatRoomHandler.startRunLoop({group:n,longPollingKey:i,startSeq:s})).then((function(){t._onAVChatRoomHistoryMessage(r,c)})),e):(this.emitGroupListUpdate(!0,!1),vn({status:Fe,group:n}))}},{key:"quitGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("quitGroup"),o="groupID:".concat(e),i=(Oe.l("".concat(n," ").concat(o)),this.checkJoinedAVChatRoomByID(e));if(!i&&!this.hasLocalGroup(e))return In({code:wn.MEMBER_NOT_IN_GRP});if(i&&!this.isLoggedIn())return Oe.l("".concat(n," anonymously ok. ").concat(o)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),yn({groupID:e});var s=new eo("quitGroup");return s.setMessage(o),this.req({P:xn.QUIT_GRP,data:{groupID:e}}).then((function(){return s.end(),Oe.l("".concat(n," ok")),t.deleteLocalGroupAndConversation(e),i&&t._AVChatRoomHandler.reset(e),t._groupAttributesHandler.deleteLocalGroupAttributes(e),vn({groupID:e})})).catch((function(e){return s.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"searchGroupByID",value:function(e){var t="".concat(this._n,".").concat("searchGroupByID"),n={groupIDList:[e]},o=new eo("searchGroupByID");return o.setMessage("groupID:".concat(e)),Oe.l("".concat(t," groupID:").concat(e)),this.req({P:xn.SEARCH_GRP,data:n}).then((function(e){if(0!==(e=e.data.groupProfile)[0].errorCode)throw new Gn({code:e[0].errorCode,message:e[0].errorInfo});return o.end(),Oe.l("".concat(t," ok")),vn({group:new si(e[0])})})).catch((function(e){return o.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"changeGroupOwner",value:function(e){var t=this,n="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===S.GRP_AVCHATROOM)return In({code:wn.CANNOT_CHANGE_OWNER_IN_AV});if(e.newOwnerID===this.getMyUserID())return In({code:wn.CANNOT_CHANGE_OWNER_TO_SELF});var o=new eo("changeGroupOwner");return o.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),Oe.l("".concat(n," groupID:").concat(e.groupID)),this.req({P:xn.CHANGE_GRP_OWNER,data:e}).then((function(){o.end(),Oe.l("".concat(n," ok"));var i,s=e.groupID,a=e.newOwnerID,r=(t.groupMap.get(s).ownerID=a,t._groupMemberHandler.getLocalGroupMemberList(s));return r instanceof Map&&(i=r.get(t.getMyUserID()),ut(i)||(i.updateRole("Member"),t.groupMap.get(s).selfInfo.role="Member"),i=r.get(a),ut(i)||i.updateRole("Owner")),t.emitGroupListUpdate(!0,!1),vn({group:t.groupMap.get(s)})})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var t,n,o,i,s,a=this,r="".concat(this._n,".").concat("handleGroupApplication"),c=e.handleAction,u=e.handleMessage,l=e.message,d=e.application,p=(l?(t=l.payload.operatorID,n=l.payload.groupProfile.groupID,o=l.payload.authentication,i=l.payload.messageKey):d&&(t=d.applicant,n=d.groupID,o=d.authentication,i=d.messageKey),xn.HANDLE_GRP_APPLICATION),h=(d&&2===d.applicationType&&(p=xn.HANDLE_INVITE_JOIN_GRP,s=d.userID),new eo("handleGroupApplication"));return h.setMessage("groupID:".concat(n)),Oe.l("".concat(r," groupID:").concat(n)),this.req({P:p,data:{handleAction:c,handleMessage:u,applicant:t,invitee:s,groupID:n,authentication:o,messageKey:i}}).then((function(){return h.end(),Oe.l("".concat(r," ok")),l&&a._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),vn({group:a.getLocalGroupProfile(n)})})).catch((function(e){return h.setError(e).end(),Oe.e("".concat(r," failed. error"),e),In(e)}))}},{key:"handleGroupInvitation",value:function(e){var n=this,o="".concat(this._n,".").concat("handleGroupInvitation"),i=(r=e.message.payload).groupProfile.groupID,s=r.authentication,a=r.messageKey,r=r.operatorID,c=e.handleAction,u=new eo("handleGroupInvitation");return u.setMessage("groupID:".concat(i," inviter:").concat(r," handleAction:").concat(c)),Oe.l("".concat(o," groupID:").concat(i," inviter:").concat(r," handleAction:").concat(c)),this.req({P:xn.HANDLE_GRP_INVITATION,data:t(t({},e),{},{inviter:r,groupID:i,authentication:s,messageKey:a})}).then((function(){return u.end(),Oe.l("".concat(o," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),vn({group:n.getLocalGroupProfile(i)})})).catch((function(e){return u.setError(e).end(),Oe.e("".concat(o," failed. error"),e),In(e)}))}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this,n="".concat(this._n,".getGroupOnlineMemberCount"),o=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e),i=this.hasLocalGroup(e);if(Oe.l("".concat(n," groupID:").concat(e," isAVChatRoom:").concat(o," has:").concat(i)),o)return this._AVChatRoomHandler.getGroupOnlineMemberCount(e);if(!i)return yn({memberCount:0});if(o=Date.now(),this._onlineMemberCountMap.has(e)){if(o-(i=this._onlineMemberCountMap.get(e)).lastReqTime<=6e4)return yn({memberCount:i.memberCount});i.lastReqTime=o}return this.requestOnlineCount(e).then((function(o){return o=void 0===(o=o.data.memberCount)?0:o,t._onlineMemberCountMap.set(e,{lastReqTime:Date.now(),memberCount:o}),Oe.l("".concat(n," ok. groupID:").concat(e," memberCount:").concat(o)),yn({memberCount:o})})).catch((function(e){return Oe.w("".concat(n," failed. error:"),e),Promise.reject(e)}))}},{key:"requestOnlineCount",value:function(e){return this.req({P:xn.GET_ONLINE_MBR_NUM,data:{groupID:e}})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var t,n=this.checkJoinedAVChatRoomByID(e),o=(Oe.l("".concat(this._n,".deleteLocalGroupAndConversation groupID:").concat(e," isJoinedAVChatRoom:").concat(n)),this.get(11)),i="".concat(S.CONV_GROUP).concat(e);n&&(this.stopMessageLongPolling({groupID:e}),o.deleteLocalConv(i)),It({groupID:e})&&(t=this.getLocalGroupProfile(e))&&!0===t.isSupportTopic&&this.get(10).deleteTopicListInCommunity(e),o.clearUnreadCount(i),o.setCompleted(i),this._deleteLocalGroup(e),this._onlineMemberCountMap.delete(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this._groupMemberHandler.deleteGroupMemberList(e)}},{key:"sendMessage",value:function(e,t){return We(e._receiverList)&&0<e._receiverList.length&&!this.canIUse(U.MSG_TO_SPECIFIED_GRP_MBR)?this.noUse("Targeted Group Message"):(e=this.createGroupMessagePack(e,t),this.req(e))}},{key:"createGroupMessagePack",value:function(e,t){var n=null,o=(t&&t.offlinePushInfo&&(n=t.offlinePushInfo),""),i=(ct(e.cloudCustomData)&&0<e.cloudCustomData.length&&(o=e.cloudCustomData),[]),s=void(ze(t)&&ze(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck"))),a=(We(e._receiverList)&&0<e._receiverList.length&&(s=e._receiverList,50<e._receiverList.length&&(s=e._receiverList.slice(0,50),this.warn("ReceiverListLimit"))),this.isOnlineMessage(e,t)?1:0),r=JSON.parse(JSON.stringify(e.getElements())),c=(t=this.get(17).getFileDNList(),e.getGroupAtInfoList());return r={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:ro(e.type,r,t),cloudCustomData:o,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==S.MSG_TEXT||Be(c)?void 0:c,onlineOnlyFlag:a,clientTime:e.clientTime,offlinePushInfo:Fo(n),messageControlInfo:0==a?i:void 0,needReadReceipt:!0!==e.needReadReceipt||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:s,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0,cmConfigID:e._cmConfigID},Mt(e.to)&&(r.groupID=Gt(e.to),r.topicID=e.to),{P:xn.SEND_GRP_MSG,data:r}}},{key:"revokeMessage",value:function(e){var t={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return Mt(e.to)&&(t.groupID=Gt(e.to),t.topicID=e.to),this.req({P:xn.REVOKE_GRP_MSG,data:t})}},{key:"deleteMessage",value:function(e){var t=e.to;return e=e.keyList,Oe.l("".concat(this._n,".deleteMessage groupID:").concat(t," count:").concat(e.length)),e={groupID:t,deleter:this.getMyUserID(),keyList:e},Mt(t)&&(e.groupID=Gt(t),e.topicID=t),this.req({P:xn.DEL_GRP_MSG,data:e})}},{key:"modifyRemoteMessage",value:function(e){var t=e.to,n=e.sequence,o=e.payload,i=e.type,s=void 0===(s=e.version)?0:s,a=e.cloudCustomData,r=(e=e._elements,t),c=void 0;return t=void(Mt(t)&&(r=Gt(t),c=t)),Ft(i)&&(1<e.length&&e.splice(0,1,{type:i,content:o}),t=e),this.req({P:xn.MODIFY_GRP_MSG,data:{groupID:r,topicID:c,sequence:n,version:s,elements:t,cloudCustomData:a}})}},{key:"getRoamingMessage",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessage"),o=e.conversationID,i=e.groupID,s=(e=e.sequence,new eo("getRoamingMessage")),a=0,r=void 0;return Mt(i)&&(i=Gt(r=i)),this._computeLastSequence({groupID:i,topicID:r,sequence:e}).then((function(e){return a=e,Oe.l("".concat(n," groupID:").concat(i," startSequence:").concat(a)),t.req({P:xn.GET_GRP_ROAMING_MSG,data:{groupID:i,count:21,sequence:a,topicID:r}})})).then((function(e){var c=(l=e.data).messageList,u=l.complete,l=void 0===(l=l.invisibleSequenceList)?[]:l,d=(e=void 0===(e=e.data.nextSequence)?0:e,ut(c)?Oe.l("".concat(n," ok. complete:").concat(u," nextSequence:").concat(e," but messageList is undefined!")):Oe.l("".concat(n," ok. complete:").concat(u," nextSequence:").concat(e," count:").concat(c.length)),s.setMessage("groupID:".concat(i," topicID:").concat(r," startSequence:").concat(a," complete:").concat(u," nextSequence:").concat(e)).end(),t.get(11)),p=[],h=[];return Be(c)||(p=d.onRoamingMessage(c,o,!0,h),d.updateIsRead(o),d.patchConvLastMessage(o)),(c=2===u||e<1)&&(d.setCompleted(o),e=""),Oe.l("".concat(n," isPullingCompleted:").concat(c," nextReqID:").concat(e," storedMsgCount:").concat(p.length)+" invisibleSeqCount:".concat(l.length)),{nextReqID:e+"",storedMessageList:p,assembledMessageList:h,isPullingCompleted:c}})).catch((function(e){return s.setError(e).setMessage("groupID:".concat(i," topicID:").concat(r," startSequence:").concat(a)).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(S.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var t="".concat(this._n,".").concat("getReadReceiptList"),n=this._getGroupIDOfMessage(e[0]),o=this.getMyUserID(),i=e.filter((function(e){return e.from===o&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}));if(Oe.l("".concat(t," groupID:").concat(n," sequenceList:").concat(JSON.stringify(i))),0===i.length)return yn({messageList:e});var s=new eo("getReadReceiptList");return s.setMessage("groupID:".concat(n)),this.req({P:xn.GET_READ_RECEIPT,data:{groupID:n,sequenceList:i}}).then((function(n){return s.end(),Oe.l("".concat(t," ok")),We(n=n.data.readReceiptList)&&n.forEach((function(t){e.forEach((function(e){0===t.code&&t.sequence===e.sequence&&(e.readReceiptInfo.readCount=t.readCount,e.readReceiptInfo.unreadCount=t.unreadCount)}))})),vn({messageList:e})})).catch((function(e){return s.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"sendReadReceipt",value:function(e){var t="".concat(this._n,".").concat("sendReadReceipt"),n=this._getGroupIDOfMessage(e[0]),o=new eo("sendReadReceipt"),i=(o.setMessage("groupID:".concat(n)),this.getMyUserID());return 0===(e=e.filter((function(e){return e.from!==i&&!0===e.needReadReceipt})).map((function(e){return{sequence:e.sequence}}))).length?In({code:wn.READ_RECEIPT_MSG_LIST_EMPTY}):(Oe.l("".concat(t,". sequenceList:").concat(JSON.stringify(e))),this.req({P:xn.SEND_READ_RECEIPT,data:{groupID:n,sequenceList:e}}).then((function(e){return o.end(),Oe.l("".concat(t," ok")),vn()})).catch((function(e){return o.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)})))}},{key:"getReadReceiptDetail",value:function(e){var t=this,n=e.message,o=e.filter,i=e.cursor,s=(e=e.count,this._getGroupIDOfMessage(n)),a=n.ID,r=(n=n.sequence,"".concat(this._n,".").concat("getReadReceiptDetail")),c=this._receiptDetailCompleteMap.get(a)||!1,u=0!==o&&1!==o?0:o,l=(o=ct(i)?i:"",i=!Ke(e)||e<=0||100<=e?100:e,e="groupID:".concat(s," sequence:").concat(n," cursor:").concat(o," filter:").concat(u," completeFlag:").concat(c),Oe.l("".concat(r," ").concat(e)),{cursor:"",isCompleted:!1,messageID:a,unreadUserIDList:[],readUserIDList:[]}),d=new eo("getReadReceiptDetail");return d.setMessage(e),this.req({P:xn.GET_READ_RECEIPT_DETAIL,data:{groupID:s,sequence:n,flag:u,cursor:o,count:i}}).then((function(e){d.end();var n=(e=e.data).cursor,o=e.isCompleted,i=e.unreadUserIDList;return e=e.readUserIDList,l.cursor=n,1===o&&(l.isCompleted=!0,t._receiptDetailCompleteMap.set(a,!0)),0===u?l.readUserIDList=e.map((function(e){return e.userID})):1===u&&(l.unreadUserIDList=i.map((function(e){return e.userID}))),Oe.l("".concat(r," ok")),vn(l)})).catch((function(e){return d.setError(e).end(),Oe.w("".concat(r," failed. error:"),e),In(e)}))}},{key:"getRoamingMessagesHopping",value:function(e){var t=this,n="".concat(this._n,".").concat("getRoamingMessagesHopping"),o=e.groupID,i=e.count,s=e.sequence,a=e.direction,r=void 0;return ut(s)&&1===a?yn({messageList:[],isCompleted:!0,nextMessageSeq:""}):(Mt(o)&&(o=Gt(r=o)),this._computeReqSeqHopping({groupID:o,topicID:r,sequence:s}).then((function(c){ut(s)||1!==a||(c=s+i-1);var u="".concat(r?"topicID:".concat(r):"groupID:".concat(o)," sequence:").concat(s," reqSeq:").concat(c," direction:").concat(a),l=(Oe.l("".concat(n," ").concat(u)),new eo("getRoamingMessagesHopping"));return t.req({P:xn.GET_GRP_ROAMING_MSG,data:{groupID:o,topicID:r,count:i,sequence:c}}).then((function(o){var i=void 0===(i=(o=o.data).messageList)?[]:i,r=o.complete,c=void 0===(c=o.nextSequence)?0:c,d=(o=void 0===(o=o.invisibleSequenceList)?[]:o,"complete:".concat(r," nextSequence:").concat(c," remoteMsgCount:").concat(i.length," invisibleSequenceList:").concat(o)),p=(l.setMessage("".concat(u," ").concat(d)).end(),Oe.l("".concat(n," ok. ").concat(d)),d="".concat(S.CONV_GROUP).concat(e.groupID),t.get(11));return d=p.onRoamingMessage(i,d,!1),i=t._computeResult({groupID:e.groupID,direction:a,sequence:s,remoteMessageList:i,processedMessageList:d,complete:r,nextSequence:c,invisibleSequenceList:o}),p.storeHoppingMessageList(i.messageList),vn(i)})).catch((function(e){return l.setError(e).setMessage("groupID:".concat(o," sequence:").concat(s," count:").concat(i)).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))})))}},{key:"_computeReqSeqHopping",value:function(e){var t=this,n=e.groupID,o=void 0===(o=e.topicID)?void 0:o;return 0<(e=void 0===(e=e.sequence)?void 0:e)?Promise.resolve(e):ut(o)?this.getGroupProfileAdvance({groupIDList:[n],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then((function(e){var o=0;return Be(e=e.data.successGroupList)||(o=e[0].nextMessageSeq-1),Oe.l("".concat(t._n,"._computeReqSeqHopping groupID:").concat(n," lastSequence:").concat(o," from remote")),o})).catch((function(e){return In(e)})):Promise.resolve(0)}},{key:"_computeResult",value:function(e){var t={messageList:[],isCompleted:!1,nextMessageSeq:""},n=e.groupID,o=e.direction,i=e.sequence,s=void 0===(s=e.remoteMessageList)?[]:s,a=void 0===(a=e.processedMessageList)?[]:a,r=e.complete,c=e.nextSequence;if(e=e.invisibleSequenceList,0===o)return t.nextMessageSeq=c,(2===r||c<1)&&(t.isCompleted=!0,t.nextMessageSeq=""),t.messageList=a,t;if(1===o){if(Be(s)){if(Be(e))return t.isCompleted=!0,t.nextMessageSeq="",t;t.nextMessageSeq=e[0]+1}else r=s[0].sequence,c=e[0]||0,t.nextMessageSeq=c<r?r+1:c+1;return a.forEach((function(e){e.sequence>=i&&t.messageList.push(e)})),(It({groupID:n})||Mt(n))&&0===t.messageList.length&&s[0].sequence<i&&(t.isCompleted=!0,t.nextMessageSeq=""),t}}},{key:"setMessageRead",value:function(e){var t=this,n=e.conversationID,o=e.lastMessageSeq,i="".concat(this._n,".").concat("setMessageRead"),s=(e="convID:".concat(n," lastMessageSeq:").concat(o),Oe.l("".concat(i," ").concat(e)),Ke(o)||this.warn("DoNotModifyLastSeq"),new eo("setMessageRead")),a=(s.setMessage(e),n.replace(S.CONV_GROUP,"")),r=void 0;return Mt(a)&&(a=Gt(r=a)),this.req({P:xn.SET_GRP_MSG_READ,data:{groupID:a,topicID:r,messageReadSeq:o}}).then((function(){s.end(),Oe.l("".concat(i," ok"));var e,c=t.get(11),u=(c.updateIsReadAfterReadReport({conversationID:n,lastMessageSeq:o}),!0);return ut(r)||(u=!1,(e=t.get(10).getLocalTopic(a,r))&&e.updateSelfInfo({readedSequence:o})),c.updateUnreadCount(n,u),vn()})).catch((function(e){return s.setError(e).end(),Oe.l("".concat(i," failed. error:"),e),In(e)}))}},{key:"_computeLastSequence",value:function(e){var t=e.groupID,n=void 0===(n=e.topicID)?void 0:n;return 0<(e=e.sequence)?Promise.resolve(e):ut(n)?this.getGroupLastSequence(t):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var t="".concat(this._n,".").concat("getGroupLastSequence"),n=new eo("getGroupLastSequence"),o=0,i="",s="groupID:".concat(e);if(this.hasLocalGroup(e)){var a=this.getLocalGroupProfile(e),r=a.lastMessage;if(0<r.lastSequence&&!1===r.onlineOnlyFlag)return o=r.lastSequence,i="".concat(s,", ").concat(o," from group.lastMessage.lastSequence"),Oe.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o);if(1<a.nextMessageSeq)return o=a.nextMessageSeq-1,i="".concat(s,", ").concat(o," from group.nextMessageSeq"),Oe.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o)}return(r=this.get(11).getLocalConversation("GROUP".concat(e)))&&r.lastMessage.lastSequence&&!1===r.lastMessage.onlineOnlyFlag?(o=r.lastMessage.lastSequence,i="".concat(s,", ").concat(o," from conversation.lastMessage.lastSequence"),Oe.l("".concat(t," ").concat(i)),n.setMessage(i).end(),Promise.resolve(o)):this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then((function(e){return Be(e=e.data.successGroupList)?Oe.w("".concat(t," ").concat(s,", empty successGroupList")):(o=e[0].nextMessageSeq-1,i="".concat(s,", ").concat(o," from remote"),Oe.l("".concat(t," ").concat(i))),n.setMessage(i).end(),o})).catch((function(e){return n.setError(e).setMessage(s).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"isMessageFromOrToAVChatroom",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"getGroupRemoteLastSeq",value:function(e){return(e=this.getLocalGroupProfile(e))?e.nextMessageSeq-1:1}},{key:"isOnlineMessage",value:function(e,t){return!(!this._canIUseOnlineOnlyFlag(e)||!t||!0!==t.onlineUserOnly)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var t=this.getJoinedAVChatRoom();return!t||!t.includes(e.to)||e.conversationType!==S.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e,n){var o;Be(e)||(Oe.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(n," count:").concat(e.length)),o=[],e.forEach((function(e){o.push(t(t({},e),{},{isHistoryMessage:1}))})),this.onAVChatRoomMessage(o,n))}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler.onMessage(e,1<arguments.length&&void 0!==arguments[1]?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,t){return 2===e&&!Be(t)}},{key:"isMessageFromCommunityOfTopic",value:function(e,t){return 2===e&&Be(t)}},{key:"getMessageExtensions",value:function(e,t){return Oe.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t)),this.req({P:xn.GET_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1;return Oe.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),this.req({P:xn.MODIFY_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"_genNotifyReqList",value:function(e){for(var t,n,o,i,s=[],a=0,r=e.length;a<r;a++)t=e[a],i=this.getLocalGroupProfile(t).type,n=this._getGroupLastRevokedTime(t),o=1e3*ke(),i={notifyType:1,limit:20,type:It({type:i,groupID:t})?S.GRP_COMMUNITY:void 0,groupID:t,beginTime:n,endTime:o},s.push(i);return s}},{key:"getNotice",value:function(e){var t=this,n="".concat(this._n,".getNotice");0!==(e=e.filter((function(e){if(!t.hasLocalGroup(e))return!1;var n=(e=t.getLocalGroupProfile(e)).type;return e=e.isSupportTopic,!yt(n)&&!e}))).length&&(Oe.l("".concat(n," list:").concat(e)),this.req({P:xn.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(e)}}).then((function(e){e=e.data.notifyRspList;var o,i,s=[];We(e)&&(o={dataList:[]},i="".concat(n," ok."),e.forEach((function(e){var n=e.nextRevokedTime,a=e.groupID,r=e.notifyList;i+=" groupID:".concat(a," nextRevokedTime:").concat(n," count:").concat(r.length,"\n"),o.dataList.push({elements:{revokedInfos:t._genRevokedInfos(e)}}),0!==n?(t._setGroupLastRevokedTime(a,n),s.push(a)):t._setGroupLastRevokedTime(a,1e3*ke())})),Oe.l(i),t.onMsgRevoked(o,!1)),0<s.length&&t.getNotice(s)})).catch((function(e){Oe.e("".concat(n," failed. error:"),e)})))}},{key:"_genRevokedInfos",value:function(e){var n=e.notifyList,o=e.groupID,i=[];return We(n)&&n.forEach((function(e){i.push({groupID:o,sequence:e.sequence,random:e.random,revokerInfo:t({},e.revokerInfo)})})),i}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,t){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=t)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(e){return this._groupMemberHandler.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._groupMemberHandler.getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._groupMemberHandler.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._groupMemberHandler.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._groupMemberHandler.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._groupMemberHandler.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._groupMemberHandler.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._groupMemberHandler.setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._groupMemberHandler.markGroupMemberList(e)}},{key:"modifyGroupMemberInfo",value:function(e){return this._groupMemberHandler.modifyGroupMemberInfo(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var t=this.getLocalGroupProfile(e);return t&&yt(t.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===S.GRP_PUBLIC||It({type:e})}},{key:"_silentlyGetGroupProfile",value:function(e,t){var n=setTimeout(this.getGroupProfile.bind(this,{groupID:t}),3e3);this._timeoutIDs.push(n),Oe.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(e," groupID:").concat(t," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach((function(e){clearTimeout(e)})),this._timeoutIDs=[]}},{key:"startMessageLongPolling",value:function(e){var t=e.groupID,n=e.longPollingKey,o=(e=void 0===(e=e.longPollingSequence)?1:e,this.get(12).isUnlimitedAVChatRoom()),i=(this._AVChatRoomHandler.hasPollingInstance(t)&&this.stopMessageLongPolling({groupID:t}),this._AVChatRoomHandler.getJoinedLiveList());return!o&&0<i.length&&this.stopMessageLongPolling({groupID:i[0]}),o=new si({groupID:t,type:S.GRP_LIVE}),Oe.l("".concat(this._n,".startMessageLongPolling groupID:").concat(t," longPollingKey:").concat(n," longPollingSequence:").concat(e)),this._AVChatRoomHandler.startRunLoop({group:o,longPollingKey:n,startSeq:e})}},{key:"stopMessageLongPolling",value:function(e){e=e.groupID;var t=this.get(11);return this._AVChatRoomHandler.reset(e),this._deleteLocalGroup(e),t.deleteLocalConv("".concat(S.CONV_GROUP).concat(e)),Oe.l("".concat(this._n,".stopMessageLongPolling ok, groupID:").concat(e)),yn({groupID:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),Hi),Ei=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],Si=(s(Bi,[{key:"_initTopic",value:function(e){for(var t in e)Ei.indexOf(t)<0||("selfInfo"===t?this.updateSelfInfo(e[t]):this[t]="muteAllMembers"===t?1===e[t]:e[t])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=zo(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){ut(e.selfInfo)||this.updateSelfInfo(e.selfInfo),ut(e.muteAllMembers)||(this.muteAllMembers=1===e.muteAllMembers),Ze(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return 0===Ze(this.selfInfo,e,[],[""])}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),Bi),Di=(r(qi,Nn),Xo=g(qi),s(qi,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("topic_cache_time"),t=this.getCloudConfig("topic_last_active_time");ut(e)||(this.TOPIC_CACHE_TIME=Number(e)),ut(t)||(this.TOPIC_LAST_ACTIVE_TIME=Number(t))}},{key:"onTopicCreated",value:function(e){var t=e.groupID;this.resetGetTopicTime(t),this.emitOEvt(E.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var t=this,n=e.groupID,o=e.topicIDList;(void 0===o?[]:o).forEach((function(e){t._deleteLocalTopic(n,e)})),this.emitOEvt(E.TOPIC_DELETED,e)}},{key:"onTopicProfileUpdated",value:function(e){var t=e.groupID,n=e.topicID;(n=this.getLocalTopic(t,n))&&(n.updateTopic(e),this.emitOEvt(E.TOPIC_UPDATED,{groupID:t,topic:n}))}},{key:"onTopicLatestMsg",value:function(e){var t,n,o=(e=e||{}).topicLatestMessage;e=e.excludedUnreadSequenceList,Be(o)||(t=o.groupProfile.topicID,o.conversationType=S.CONV_GROUP,o.to=t,(n=new So(o)).setElement(o.elements),this.updateUnreadCountAndLastMsg(t,n,e))}},{key:"onMessageRemindTypeUpdated",value:function(e){var t,n=e.groupID,o=e.topicID,i=(e=e.messageRemindType,this.getLocalTopic(n,o));i&&((t=i.updateSelfInfo({messageRemindType:e}))&&this.emitOEvt(E.TOPIC_UPDATED,{groupID:n,topic:i}),Oe.l("".concat(this._n,".onMessageRemindTypeUpdated topicID:").concat(o," messageRemindType:").concat(e," isUpdated:").concat(t)))}},{key:"onAtInfoUpdated",value:function(e){var t=e.topicID,n=(e=e.groupAtInfoList,Gt(t));(t=this.getLocalTopic(n,t))&&!ut(e)&&(t.updateGroupAtInfoList(e),this.emitOEvt(E.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"onUnreadCountUpdatedFromConv",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:0,n=Gt(e);(e=this.getLocalTopic(n,e))&&e.unreadCount!==t&&(e.updateUnreadCount(t),0===t&&e.updateSelfInfo({readedSequence:e.lastMessage.lastSequence}),this.emitOEvt(E.TOPIC_UPDATED,{groupID:n,topic:e}))}},{key:"onMessageSent",value:function(e){var t,n,o=e.groupID,i=e.topicID;e=e.lastMessage,!(i=this.getLocalTopic(o,i))||(n=(t=void 0===(t=e.sequence)?0:t)+1)>i.nextMessageSeq&&(i.updateNextMessageSeq(n),i.updateLastMessage(e),i.updateSelfInfo({readedSequence:t}),i.updateUnreadCount(0),this.emitOEvt(E.TOPIC_UPDATED,{groupID:o,topic:i}))}},{key:"onMessageModified",value:function(e){var t,n=e.to,o=e.time,i=e.sequence,s=e.elements,a=e.cloudCustomData,r=e.messageVersion,c=Gt(n),u=this.getLocalTopic(c,n);u&&(t=u.lastMessage,Oe.d("".concat(this._n,".onMessageModified topicID:").concat(n," lastMessage:"),JSON.stringify(t),"options:",JSON.stringify(e)),t&&(null===t.payload||t.lastTime===o&&t.lastSequence===i&&t.version!==r)&&(t.type=s[0].type,t.payload=s[0].content,t.messageForShow=wt(t.type,t.payload,this.isIntl()),t.cloudCustomData=a,t.version=r,t.lastSequence=i,t.lastTime=o,this.emitOEvt(E.TOPIC_UPDATED,{groupID:c,topic:u})))}},{key:"onMessageRevoked",value:function(e){var t,n,o,i=this;0!==e.length&&(n=t=null,o=!1,e.forEach((function(e){var s=e.to;n=Gt(s),(t=i.getLocalTopic(n,s))&&(t.reduceUnreadCount()&&(o=!0),t.isLastMessageRevoked(e)&&(t.setLastMessageRevoked(!0),t.setLastMessageRevoker(e.revoker),o=!0),(s=t.selfInfo.excludedUnreadSequenceList||[]).push(e.sequence),t.updateSelfInfo({excludedUnreadSequenceList:s}))})),o&&this.emitOEvt(E.TOPIC_UPDATED,{groupID:n,topic:t}))}},{key:"isLastMessageRevoked",value:function(e){var t=e.topicID,n=(e=e.sequence,Gt(t));return n=this.getLocalTopic(n,t),t=!1,n?n.isLastMessageRevoked({sequence:e}):t}},{key:"updateUnreadCountAndLastMsg",value:function(e,t,n){var o,i=Gt(e),s=this.getLocalTopic(i,e);s&&(o=s.selfInfo.excludedUnreadSequenceList||[],ut(n)||(o=n),t._isExcludedFromUnreadCount&&o.push(t.sequence),s.updateSelfInfo({excludedUnreadSequenceList:o}),Oe.l("".concat(this._n,".updateUnreadCountAndLastMsg seq:").concat(t.sequence," lastSeq:").concat(s.lastMessage.lastSequence)),t.sequence>s.lastMessage.lastSequence&&(s.updateLastMessage(t),n=t.sequence+1,s.updateNextMessageSeq(n),o=this._computeUnreadCount(s),s.updateUnreadCount(o),(t=this.get(11).getLocalConversation("".concat(S.CONV_GROUP).concat(e)))&&t.updateUnreadCount({nextUnreadCount:o,isFromGetConversations:!0}),this.emitOEvt(E.TOPIC_UPDATED,{groupID:i,topic:s})))}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(e){var n=this,o="".concat(this._n,".").concat("createTopicInCommunity"),i=e.topicID;if(!ut(i)&&!Mt(i))return In({code:wn.ILLEGAL_TOPIC_ID});if(e.topicName&&!1===this._filterProfanity("topicName",e))return In({code:wn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return In({code:wn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return In({code:wn.PROFANITY_FOUND});var s=new eo("createTopicInCommunity");return this.req({P:xn.CREATE_TOPIC,data:t({},e)}).then((function(i){return i=i.data.topicID,s.setMessage("topicID:".concat(i)).end(),Oe.l("".concat(o," ok. topicID:").concat(i)),n._updateTopicMap([t(t({},e),{},{topicID:i})]),vn({topicID:i})})).catch((function(e){return s.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"deleteTopicFromCommunity",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteTopicFromCommunity"),o=e.groupID,i=(e=void 0===(e=e.topicIDList)?[]:e,new eo("deleteTopicFromCommunity"));return i.setMessage("groupID:".concat(o," topicIDList:").concat(e)),this.req({P:xn.DEL_TOPIC,data:{groupID:o,topicIDList:e}}).then((function(e){e=e.data.resultList;var s=[],a=[];return(void 0===e?[]:e).forEach((function(e){var t=e.topicID,n=e.errorCode;e=e.errorInfo,0===n?s.push({topicID:t}):a.push({topicID:t,code:n,message:e})})),e="success count:".concat(s.length,", fail count:").concat(a.length),i.setMoreMessage(e).end(),Oe.l("".concat(n," ok. ").concat(e)),s.forEach((function(e){t._deleteLocalTopic(o,e.topicID)})),vn({successTopicList:s,failureTopicList:a})})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"updateTopicProfile",value:function(e){var n=this,o="".concat(this._n,".").concat("updateTopicProfile");if(Oe.l("".concat(o," options:"),e),e.topicName&&!1===this._filterProfanity("topicName",e))return In({code:wn.PROFANITY_FOUND});if(e.introduction&&!1===this._filterProfanity("introduction",e))return In({code:wn.PROFANITY_FOUND});if(e.notification&&!1===this._filterProfanity("notification",e))return In({code:wn.PROFANITY_FOUND});var i=new eo("updateTopicProfile");return i.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),ut(e.muteAllMembers)||(e.muteAllMembers=!0===e.muteAllMembers?"On":"Off"),this.req({P:xn.UPDATE_TOPIC_PROFILE,data:t({},e)}).then((function(){return i.end(),Oe.l("".concat(o," ok")),n._updateTopicMap([e]),vn({topic:n.getLocalTopic(e.groupID,e.topicID)})})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"getTopicList",value:function(e){var n=this,o="".concat(this._n,".").concat("getTopicList"),i=e.groupID,s=0===(e=void 0===(e=e.topicIDList)?[]:e).length,a=new eo("getTopicList");if(a.setMessage("groupID:".concat(i)),this._getTopicTimeMap.has(i)){var r=(c=this._getTopicTimeMap.get(i)).isGetAll,c=c.time;if((r||!r&&!s)&&Date.now()-c<1e3*this.TOPIC_CACHE_TIME&&(r=this._getLocalTopicList(i,e),s||r.length===e.length))return a.setMoreMessage("from cache, topic count:".concat(r.length)).end(),Oe.l("".concat(o," groupID:").concat(i," from cache, topic count:").concat(r.length)),yn({successTopicList:r,failureTopicList:[]})}return this.req({P:xn.GET_TOPIC_LIST,data:{groupID:i,topicIDList:e}}).then((function(e){e=e.data.topicInfoList;var r=[],c=[],u=[];return(void 0===e?[]:e).forEach((function(e){var n=e.topic,o=e.selfInfo,i=e.errorCode,s=(e=e.errorInfo,n.topicID);0===i?(r.push(t(t({},n),{},{selfInfo:o})),c.push(s)):u.push({topicID:s,code:i,message:e})})),n._updateTopicMap(r),n._handleTopicAtInfo(r),e="success count:".concat(c.length,", fail count:").concat(u.length),a.setMoreMessage(e).end(),Oe.l("".concat(o," groupID:").concat(i," from remote, ").concat(e)),e=[],Be(c)||(n._getTopicTimeMap.set(i,{time:Date.now(),isGetAll:s}),e=n._getLocalTopicList(i,c)),vn({successTopicList:e,failureTopicList:u})})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"hasLocalTopic",value:function(e,t){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(t)}},{key:"getLocalTopic",value:function(e,t){return this._topicMap.has(e)?this._topicMap.get(e).get(t):null}},{key:"_getLocalTopicList",value:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:[],n=[];return(e=this._topicMap.get(e))&&(n=m(e.values())),0===t.length?n:n.filter((function(e){return t.includes(e.topicID)}))}},{key:"_deleteLocalTopic",value:function(e,t){this._topicMap.has(e)&&this._topicMap.get(e).has(t)&&(this._topicMap.get(e).delete(t),Oe.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(t)))}},{key:"_updateTopicMap",value:function(e){var t=this,n=[];e.forEach((function(e){var o=e.groupID,i=e.topicID,s=null;t._topicMap.has(o)||t._topicMap.set(o,new Map),t._topicMap.get(o).has(i)?(s=t._topicMap.get(o).get(i)).updateTopic(e):(t._getTopicLastMessage(e),s=new Si(e,t.isIntl()),t._topicMap.get(o).set(i,s)),e=t._computeUnreadCount(s),s.updateUnreadCount(e),n.push({conversationID:"".concat(S.CONV_GROUP).concat(i),type:S.CONV_TOPIC,unreadCount:e})})),0<n.length&&this.get(11).updateTopicConversation(n)}},{key:"resetGetTopicTime",value:function(e){var t=this;ut(e)?m(this._getTopicTimeMap.keys()).forEach((function(e){t._getTopicTimeMap.set(e,0)})):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,t=m(this._topicMap.keys()),n=[],o=this.get(11);t.forEach((function(t){var i=[],s=e._getLocalTopicList(t);o.deleteTopicRoamingInfo(t),s.forEach((function(t){var n=void 0===(n=t.lastMessage.lastTime)?0:n;Date.now()-1e3*n<1e3*e.TOPIC_LAST_ACTIVE_TIME&&i.push(t.topicID)})),0<i.length&&n.push({groupID:t,topicIDList:i})})),Oe.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(n.length)),this._relayGetTopicList(n)}},{key:"_relayGetTopicList",value:function(e){var t,n,o,i=this;0!==e.length&&(n=5<(t=e.shift()).topicIDList.length?"topicIDList.length:".concat(t.topicIDList.length):"topicIDList:".concat(t.topicIDList),(o=new eo("relayGetTopicList")).setMessage(n),Oe.l("".concat(this._n,"._relayGetTopicList. ").concat(n)),this.getTopicList(t).then((function(){o.end(),i._relayGetTopicList(e)})).catch((function(t){o.setError(t).end(),i._relayGetTopicList(e)})))}},{key:"_handleTopicAtInfo",value:function(e){var n=this;0!==e.length&&e.forEach((function(e){var o=e.groupID,i=e.topicID,s=(e=e.groupAtInfoList,[]);ut(e)||(e.forEach((function(e){s.push(t(t({},e),{},{groupID:o,topicID:i}))})),n.get(11).onNewGroupAtTips({dataList:s}))}))}},{key:"_getTopicLastMessage",value:function(e){var t;ut(e.lastMsg)||(t={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,avatar:e.lastMsg.avatar,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:2===e.lastMsg.isPlaceMessage,revoker:Be(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker},e.lastMessage=t)}},{key:"deleteTopicListInCommunity",value:function(e){var t=this,n=this._getLocalTopicList(e),o=this.get(11);n.forEach((function(n){n=n.topicID,t._deleteLocalTopic(e,n),t._getTopicTimeMap.delete(e),o.deleteLocalConv("".concat(S.CONV_GROUP).concat(n))}))}},{key:"_computeUnreadCount",value:function(e){var t,n=(i=e.selfInfo).excludedUnreadSequenceList,o=i.readedSequence,i=e.nextMessageSeq-e.selfInfo.readedSequence-1;return We(n)&&(t=0,n.forEach((function(n){o<n&&n<=e.nextMessageSeq-1&&(t+=1)})),1<=t&&(i-=t)),i<0?0:i}},{key:"_filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],G)).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"getMessageExtensions",value:function(e,t){Oe.l("".concat(this._n,".getMessageExtensions startSequence:").concat(t));var n=Gt(e.to);return this.req({P:xn.GET_GRP_MSG_EXT,data:{groupID:n,topicID:e.to,messageSequence:e.sequence,startSequence:t}})}},{key:"modifyMsgExts",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,o=(Oe.l("".concat(this._n,".modifyMsgExts operateType:").concat(n)),Gt(e.to));return this.req({P:xn.MODIFY_GRP_MSG_EXT,data:{groupID:o,topicID:e.to,messageSequence:e.sequence,extensionList:t,operateType:n}})}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),qi),ki=(s(Vi,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getUserProfile"),o=e.userIDList;e.fromAccount=this._userM.getMyAccount(),100<o.length&&(Oe.w("".concat(n," ").concat(qt(100))),o.length=100);for(var i,s=[],a=[],r=0,c=o.length;r<c;r++)i=o[r],this._userM.isMyFriend(i)&&this._contains(i)?a.push(this._getProfileFromMap(i)):s.push(i);if(0===s.length)return yn(a);e.toAccount=s;var u=e.bFromGetMyProfile||!1,l=[],d=(e.toAccount.forEach((function(e){l.push({toAccount:e,standardSequence:0,customSequence:0})})),e.userItem=l,new eo("getUserProfile"));return d.setMessage(5<o.length?"userIDList.length:".concat(o.length):"userIDList:".concat(o)),this._userM.req({P:xn.GET_USER_PROFILE,data:e}).then((function(e){return d.end(),Oe.i("".concat(n," ok")),e=t._handleResponse(e).concat(a),vn(u?e[0]:e)})).catch((function(e){return d.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"getMyProfile",value:function(){var e,t=this._userM.getMyAccount(),n="".concat(this._n,".getMyProfile");return Oe.l("".concat(n," myAccount:").concat(t)),this._fill(),this._contains(t)?(e=this._getProfileFromMap(t),Oe.d("".concat(n," from cache, myProfile:").concat(JSON.stringify(e))),yn(e)):this.getUserProfile({fromAccount:t,userIDList:[t],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var t=e.data.userProfileItem;if(!We(t))return[];for(var n=[],o=(e=Date.now(),0),i=t.length;o<i;o++){var s=(a=t[o]).to,a=a.profileItem;"@TLS#NOT_FOUND"!==s&&""!==s&&(s=this._update(s,this._getLatestProfileFromResponse(s,a)).latestProfile,n.push(s))}return Oe.l("".concat(this._n,"._handleResponse cost:").concat(jt(e))),n}},{key:"_getLatestProfileFromResponse",value:function(e,t){var n={userID:e,profileCustomField:[]};if(!Be(t))for(var o=0,i=t.length;o<i;o++)if(-1<t[o].tag.indexOf("Tag_Profile_Custom"))n.profileCustomField.push({key:t[o].tag,value:t[o].value});else switch(t[o].tag){case Pe.NICK:n.nick=t[o].value;break;case Pe.GENDER:n.gender=t[o].value;break;case Pe.BIRTHDAY:n.birthday=t[o].value;break;case Pe.LOCATION:n.location=t[o].value;break;case Pe.SELFSIGNATURE:n.selfSignature=t[o].value;break;case Pe.ALLOWTYPE:n.allowType=t[o].value;break;case Pe.LANGUAGE:n.language=t[o].value;break;case Pe.AVATAR:n.avatar=t[o].value;break;case Pe.MESSAGESETTINGS:n.messageSettings=t[o].value;break;case Pe.ADMINFORBIDTYPE:n.adminForbidType=t[o].value;break;case Pe.LEVEL:n.level=t[o].value;break;case Pe.ROLE:n.role=t[o].value;break;default:Oe.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),t[o].tag,t[o].value)}return n}},{key:"updateMyProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&!1===this._userM.filterProfanity("nick",e))return In({code:wn.PROFANITY_FOUND});if(e.selfSignature&&!1===this._userM.filterProfanity("selfSignature",e))return In({code:wn.PROFANITY_FOUND});var o=new eo("updateMyProfile"),i=(o.setMessage(JSON.stringify(e)),(new ni).validate(e));if(!i.valid)return o.setCode(wn.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(i.tips)).end(),Oe.e("".concat(n," info:").concat(i.tips)),In({code:wn.UPDATE_PROFILE_INVALID_PARAM});var s,a=[];for(s in e)Object.prototype.hasOwnProperty.call(e,s)&&("profileCustomField"===s?e.profileCustomField.forEach((function(e){a.push({tag:e.key,value:e.value})})):a.push({tag:Pe[s.toUpperCase()],value:e[s]}));if(0===a.length)return i=new Gn({code:wn.UPDATE_PROFILE_NO_KEY}),o.setError(i).end(),Oe.e("".concat(n," failed. error:"),i),In(i);var r=this._userM.getMyAccount();return this._userM.req({P:xn.UPDATE_MY_PROFILE,data:{fromAccount:r,profileItem:a}}).then((function(i){o.end(),Oe.i("".concat(n," ok"));var s=(a=t._update(r,e)).isProfileUpdated,a=a.latestProfile;return!0===s&&t._userM.emitOEvt(E.PROFILE_UPDATED,[a]),yn(a)})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"onProfileModified",value:function(e){var t=e.dataList;if(!Be(t)){var n=t.length;Oe.d("".concat(this._n,".onProfileModified count:").concat(n," dataList:"),e.dataList);for(var o=[],i=0;i<n;i++){var s=t[i].userID,a=(s=this._update(s,this._getLatestProfileFromResponse(s,t[i].profileList))).isProfileUpdated;s=s.latestProfile,!0===a&&o.push(s)}0<o.length&&(this._userM.emitIEvt(qo.PROFILE_UPDATED,o),this._userM.emitOEvt(E.PROFILE_UPDATED,o))}}},{key:"_fill",value:function(){if(0===this.accountProfileMap.size){for(var e=this._getCachedProfiles(),t=Date.now(),n=0,o=e.length;n<o;n++)t-e[n].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[n].userID,e[n]);Oe.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,t){var n,o=!1,i=Date.now();return this._contains(e)?(n=this._getProfileFromMap(e),t.profileCustomField&&!0===ft(n.profileCustomField,t.profileCustomField)&&(n.lastUpdatedTime=i,o=!0),0<Ze(n,t,["profileCustomField"])&&(n.lastUpdatedTime=i,o=!0)):(n=new ni(t),!this._userM.isMyFriend(e)&&e!==this._userM.getMyAccount()||(n.lastUpdatedTime=i,o=!0,this.accountProfileMap.set(e,n))),this._flush(e===this._userM.getMyAccount()),!0===o&&Oe.l("".concat(this._n,"._update account:").concat(e," isUpdated:").concat(o)),{isProfileUpdated:o,latestProfile:n}}},{key:"_flush",value:function(e){var t=m(this.accountProfileMap.values()),n=this._userM.getStorageModule();Oe.d("".concat(this._n,"._flush length:").concat(t.length," flushAtOnce:").concat(e)),n.setItem(this.TAG,t,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userM.getStorageModule().getItem(this.TAG);return Be(e)?[]:e}},{key:"onConvProfileUpdated",value:function(e){for(var t,n,o=[],i=0,s=e.length;i<s;i++)n=(t=e[i]).userID,this._userM.isMyFriend(n)&&(this._contains(n)?0<Ze(this._getProfileFromMap(n),t)&&o.push(n):o.push(t.userID));0!==o.length&&(Oe.l("".concat(this._n,".onConvProfileUpdated toAccountList:").concat(o)),this.getUserProfile({userIDList:o}))}},{key:"getNickAndAvatarByUserID",value:function(e){return this._contains(e)?{nick:(e=this._getProfileFromMap(e)).nick,avatar:e.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(e){var t=this,n=m(new Set(e)),o=(Oe.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(e.length," uniqueUserIDList.length:").concat(n.length)),[]);if(0===e.length)return Promise.resolve(o);e=this._createUserIDListGroup(n);var i=[];return e.forEach((function(e){i.push(t.getUserProfile({userIDList:e}))})),Promise.all(i).then((function(e){return e.forEach((function(e){e=e.data.map((function(e){return{userID:e.userID,nick:e.nick,avatar:e.avatar}})),o.push.apply(o,m(e))})),o}))}},{key:"_createUserIDListGroup",value:function(e){for(var t=[],n=0;n<e.length;)t.push(e.slice(n,n+=100));return t}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),Vi),Ri=s((function e(t){o(this,e)})),Li=(s(xi,[{key:"getLocalBlacklist",value:function(){return m(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,t="".concat(this._n,".getBlacklist"),n={fromAccount:this._userM.getMyAccount(),maxLimited:100,startIndex:this._startIndex},o=new eo("getBlacklist");return this._userM.req({P:xn.GET_BL,data:n}).then((function(n){var i=(n=n.data).blackListItem,s=(n=n.startIndex,Be(i)?0:i.length);o.setMessage("count:".concat(s)).end(),Oe.i("".concat(t," ok")),e._startIndex=n,e._handleResponse(i,!0),e._userM.emitOEvt(E.BLACKLIST_UPDATED,m(e._blacklistMap.keys())),0!==e._startIndex&&e.getBlacklist()})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"addBlacklist",value:function(e){var t,n,o=this,i=new eo("addToBlacklist"),s="".concat(this._n,".addBlacklist"),a=this._userM.getMyAccount();return 1===e.userIDList.length&&e.userIDList[0]===a?(n=this._userM.getErrMsg(t=wn.CANNOT_ADD_SELF_TO_BLACKLIST),i.setCode(t).setMessage(n).end(),n=new Gn({code:t}),Oe.e("".concat(s," failed. error:"),n),In(n)):(e.userIDList.includes(a)&&(e.userIDList=e.userIDList.filter((function(e){return e!==a}))),e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:xn.ADD_TO_BL,data:e}).then((function(t){return i.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Oe.i("".concat(s," ok")),o._handleResponse(t.resultItem,!0),vn(m(o._blacklistMap.keys()))})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(s," failed. error:"),e),In(e)})))}},{key:"_handleResponse",value:function(e,t){if(!Be(e))for(var n,o,i,s=0,a=e.length;s<a;s++)o=e[s].to,i=e[s].resultCode,!ut(i)&&0!==i||(t?((n=this._blacklistMap.has(o)?this._blacklistMap.get(o):new Ri).userID=o,Be(e[s].addBlackTimeStamp)||(n.timeStamp=e[s].addBlackTimeStamp),this._blacklistMap.set(o,n)):this._blacklistMap.has(o)&&(n=this._blacklistMap.get(o),this._blacklistMap.delete(o)));Oe.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(t))}},{key:"deleteBlacklist",value:function(e){var t=this,n="".concat(this._n,".deleteBlacklist"),o=new eo("removeFromBlacklist");return e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:xn.RM_FROM_BL,data:e}).then((function(i){return o.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),Oe.i("".concat(n," ok")),t._handleResponse(i.data.resultItem,!1),vn(m(t._blacklistMap.keys()))})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"onAccountDeleted",value:function(e){for(var t=0,n=e.length;t<n;t++){var o=e[t];this._blacklistMap.has(o)&&this._blacklistMap.delete(o)}var i=e.length;0<i&&(Oe.l("".concat(this._n,".onAccountDeleted count:").concat(i," ").concat(i<30?"userIDList:".concat(e):"")),this._userM.emitOEvt(E.BLACKLIST_UPDATED,m(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var t,n=[],o=0,i=e.length;o<i;o++)t=e[o],this._blacklistMap.has(t)||(this._blacklistMap.set(t,new Ri({userID:t})),n.push(t));0<n.length&&(Oe.l("".concat(this._n,".onAccountAdded count:").concat(n.length," userIDList:"),n),this._userM.emitOEvt(E.BLACKLIST_UPDATED,m(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this._startIndex=0}}]),xi),Ai=(s(Fi,[{key:"_onCloudConfig",value:function(){var e=this._userM.getCloudConfig("status_query_count"),t=this._userM.getCloudConfig("status_sub_count"),n=this._userM.getCloudConfig("status_unsub_count");Oe.l("".concat(this._n,"._onCloudConfig statusQueryCount:").concat(e," statusSubscribeCount:").concat(t)+" statusUnsubscribeCount:".concat(n)),ut(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),ut(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(t,10)),ut(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(n,10))}},{key:"onUserStatusUpdated",value:function(e){e=e.dataList;var t=this._userM.getMyUserID(),n=this._userM.get(12);e=e.map((function(e){var o=e.to,i=e.statusType;return e=Wo(e=e.customStatus),o===t&&n.setCustomStatus(e),{userID:o,statusType:i,customStatus:e}})),Oe.l("".concat(this._n,".onUserStatusUpdated list:").concat(JSON.stringify(e))),this._userM.emitOEvt(E.USER_STATUS_UPDATED,e)}},{key:"setSelfStatus",value:function(e){var t=this,n="".concat(this._n,".setSelfStatus");if(!1===this._userM.filterProfanity("customStatus",e))return In({code:wn.PROFANITY_FOUND});var o=new eo("setSelfStatus"),i=e.customStatus;return this._userM.req({P:xn.SET_SELF_STATUS,data:{customStatus:i}}).then((function(e){return o.setMessage("customStatus:".concat(i)).end(),Oe.l("".concat(n," ok. customStatus:").concat(i)),t._userM.get(12).setCustomStatus(i),vn({userID:t._userM.getMyUserID(),statusType:1,customStatus:i})})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"getUserStatus",value:function(e){var t="".concat(this._n,".").concat("getUserStatus"),n=void 0===(e=e.userIDList)?[]:e,o=(e=this._userM.getMyUserID(),m(n)),i=void 0,s=o.indexOf(e);if(-1<s&&(o.splice(s,1),i={userID:e,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),0===o.length)return yn({successUserList:[i],failureUserList:[]});if(!this._userM.canIUse(U.USER_STATUS))return this._userM.noUse("getUserStatus");o.length>this.MAX_QUERY_USER_COUNT&&(Oe.w("".concat(t," ").concat(qt(this.MAX_QUERY_USER_COUNT))),o=n.slice(0,this.MAX_QUERY_USER_COUNT));var a=new eo("getUserStatus");return this._userM.req({P:xn.GET_USER_STATUS,data:{userIDList:o}}).then((function(e){var o=void 0===(o=(e=e.data).successUserList)?[]:o,s=(e=void 0===(e=e.failureUserList)?[]:e,o=o.map((function(e){return{userID:e.userID,statusType:e.statusType,customStatus:Wo(e=e.customStatus)}})),e=e.map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:Be(n)?t:n,code:o,message:e}})),ut(i)||o.unshift(i),"userID count:".concat(n.length,", success count:").concat(o.length,", fail count:").concat(e.length));return a.setMessage("".concat(s)).end(),Oe.l("".concat(t," ok. ").concat(s,".")),vn({successUserList:o,failureUserList:e})})).catch((function(e){return a.setMessage("userID count:".concat(n.length)).setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"subscribeUserStatus",value:function(e){var t="subscribeUserStatus";if(!this._userM.canIUse(U.USER_STATUS))return this._userM.noUse(t);var n="".concat(this._n,".").concat(t),o=m(e=void 0===(e=e.userIDList)?[]:e),i=(o.length>this.MAX_SUBSCRIBE_USER_COUNT&&(Oe.w("".concat(n," ").concat(qt(this.MAX_SUBSCRIBE_USER_COUNT))),o=e.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),new eo(t)),s="userID count:".concat(e.length);return Oe.l("".concat(n," ").concat(s)),this._userM.req({P:xn.SUB_USER_STATUS,data:{userIDList:o}}).then((function(e){return e=(void 0===(e=e.data.failureUserList)?[]:e).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:Be(n)?t:n,code:o,message:e}})),i.setMessage("".concat(s," fail count:").concat(e.length)).end(),Oe.l("".concat(n," ok. fail count:").concat(e.length,".")),vn({failureUserList:e})})).catch((function(e){return i.setMessage(s).setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"unsubscribeUserStatus",value:function(e){var t="unsubscribeUserStatus";if(!this._userM.canIUse(U.USER_STATUS))return this._userM.noUse(t);var n="".concat(this._n,".").concat(t),o=m(e=void 0===(e=(e||{}).userIDList)?[]:e),i=(e.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(Oe.w("".concat(n," ").concat(qt(this.MAX_UNSUBSCRIBE_USER_COUNT))),o=e.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),new eo(t)),s="userID count:".concat(e.length);return Oe.l("".concat(n," ").concat(s)),t={userIDList:o},0===o.length&&(t.userIDList=void 0,t.unsubscribeAll=1),this._userM.req({P:xn.UNSUB_USER_STATUS,data:t}).then((function(e){return e=(void 0===(e=e.data.failureUserList)?[]:e).map((function(e){var t=e.userID,n=e.invalidUserID,o=e.errorCode;return e=e.errorInfo,{userID:Be(n)?t:n,code:o,message:e}})),i.setMessage("".concat(s," fail count:").concat(e.length)).end(),Oe.l("".concat(n," ok. fail count:").concat(e.length,".")),vn({failureUserList:e})})).catch((function(e){return i.setMessage("".concat(s)).setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),Fi),Oi=(r(wi,Nn),$o=g(wi),s(wi,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(e,t){Oe.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(e," avatar:").concat(t)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:Pe.NICK,value:e},{tag:Pe.AVATAR,value:t}]}]})}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var t,n;Be(e=e.dataList)||(t=[],e.forEach((function(e){e.blackListDelAccount&&t.push.apply(t,m(e.blackListDelAccount))})),0<t.length&&this._blacklistHandler.onAccountDeleted(t),n=[],e.forEach((function(e){e.blackListAddAccount&&n.push.apply(n,m(e.blackListAddAccount))})),0<n.length&&this._blacklistHandler.onAccountAdded(n))}},{key:"onConvProfileUpdated",value:function(e){this._profileHandler.onConvProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],"user_profile")).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"isMyFriend",value:function(e){var t=this.get(8);return!!t&&t.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getUserNickAndAvatar",value:function(e){return this._profileHandler.getUserNickAndAvatar(e)}},{key:"getLocalBlacklist",value:function(){return yn(this._blacklistHandler.getLocalBlacklist())}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),wi),Ni=(s(Gi,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isPartialUpdatedConvs",value:function(){return this._isPartialUpdatedConvs}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return 0===(e=this._SDKAppID)||2e7<=e&&e<9e7||172e7<=e&&e<179e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(e){this._isUsingChatCore=e}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(e){this._uiPlatform=e}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return fe?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(e){this._applicationID=e}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"setDowloadFileAuthKey",value:function(e){this._authKey=e}},{key:"getDowloadFileAuthKey",value:function(){return this._authKey}},{key:"setCustomLoginInfo",value:function(e){this._customLoginInfo=e}},{key:"getCustomLoginInfo",value:function(){return this._customLoginInfo}},{key:"_isTUIKit",value:function(){var e=!1,t=!1,n=!1,o=!1,i=[];Z&&(i=Object.keys(ne));for(var s=0,a=(i=te?X?Object.keys(uni):Object.keys(window):i).length;s<a;s++)if(i[s].toLowerCase().includes("uikit")){e=!0;break}i=null;var r,c=(Z&&!Je(ne.createGamePortal)&&Je(getApp)&&!ut(getApp())&&ze(r=getApp().globalData)&&!0===r.isTUIKit&&(t=!0),!0===this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))&&(n=!0),null);if(B&&!K&&"undefined"==typeof uni&&__wxConfig&&(c=__wxConfig.pages),j&&"undefined"==typeof uni&&__qqConfig&&(c=__qqConfig.pages),We(c)&&0<c.length){for(var u=0,l=c.length;u<l;u++)if(c[u].toLowerCase().includes("tui")){o=!0;break}c=null}return e||t||n||o}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),Gi),Pi={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12,"k-rn":13},bi=(r(Ui,Nn),Jo=g(Ui),s(Ui,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var e=void 0,t=this.get(36),n=this.get(28);return t.canIUseTIMPush()?e=t:n.canIUseOfflinePush()&&(e=n),e}},{key:"login",value:function(e){if(this.isLoggedIn())return t=this.getMyUserID(),(t=this.getErrMsg("RepeatLogin",t))&&Oe.w(t),yn({actionStatus:"OK",errorCode:0,errorInfo:t,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.warn("LoggingIn",e.userID),In({code:wn.REPEAT_LOGIN});if(Oe.l("".concat(this._n,".login userID:").concat(e.userID)),0!==(t=this._checkLoginInfo(e)).code)return In(t);var t=this.get(12),n=e.userID;return e=e.userSig,t.setUserID(n),t.setUserSig(e),this.get(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,t=this.get(12),n=t.getScene(),o=0,i=n,s=(n&&n.startsWith("k-")&&(i=Pi[n],n="tuikit"),new eo("login")),a=(s.setMessage("".concat(i)).setMoreMessage("identifier:".concat(this.getMyUserID())),"tuikit"===n),r=0,c=(X?r=a?3===i||4===i||5===i||6===i?31:9===i||10===i||11===i||12===i?32:4:3:Z?r=H?36:"tuikit"===n?12:11:te?r=fe?"flutter_web_uikit"===n?21:20:this._isReactUIKit()?_e?25:24:a?1===i||2===i?29:7===i||8===i?30:_e?17:14:_e?16:13:13===i&&(r=38),s.setUIPlatform(r),t.setUIPlatform(r),(a=this.getPushModule())&&(this._isWebUniapp=a.getUniAppPlatform(),i=this._getStatusInstanceID(),t.setStatusInstanceID(i),this.get(20).updateProtocolConfig(),o=a.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({P:xn.LOGIN,data:{deviceBrand:o,isWebUniapp:this._isWebUniapp,customInfo:t.getCustomLoginInfo()}}).then((function(o){e._lastLoginTs=0;var i=Date.now(),a=null,r=(_=o.data).a2Key,u=_.tinyID,l=_.helloInterval,d=_.instanceID,p=_.timeStamp,h=void 0===(h=_.customStatus)?"":h,g=_.purchaseBits,_=void 0===(_=_.authKey)?"":_,f=1e3*p,m=i-s.getStartTs();if(m=f+parseInt(m/2)-i,i=s.getStartTs()+m,s.start(i),i=f,De=m,(f=new Date).setTime(i),Oe.i("baseTime from server:".concat(f," offset:").concat(De)),!u)throw a=new Gn({code:wn.NO_TINYID}),s.setError(a).end(),a;if(!r)throw a=new Gn({code:wn.NO_A2KEY}),s.setError(a).end(),a;return i=e.get(21).getSocketID(),f=Wo(h),a="socketID:".concat(i," scene:").concat(n," helloInterval:").concat(l," instanceID:").concat(d," timeStamp:").concat(p)+" offset:".concat(m," customStatus:").concat(f," isWebUniapp:").concat(e._isWebUniapp),Oe.l("".concat(c," ok. ").concat(a)),h="",i="",B&&Je(ne.getAccountInfoSync)&&(p=ne.getAccountInfoSync().miniProgram)&&(h=p.appId,i=p.envVersion),s.setMoreMessage("".concat(a," href:").concat(te?window.location.href:""," mpAppId:").concat(h," envVersion:").concat(i," authKey:").concat(_)).end(),t.setA2Key(r),t.setTinyID(u),t.setStatusInstanceID(d),t.setCustomStatus(f),t.setDowloadFileAuthKey(_),g&&e.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:g}),e.get(20).updateProtocolConfig(),e.emitIEvt(qo.A2KEY_AND_TINYID_UPDATED),e._helloInterval=l,e.triggerReady(),(m=e.getPushModule())&&(uni.setStorageSync("timUniAppInstanceID",d),m.init()),e._fetchCloudControlConfig(),e.get(29).init(),o})).catch((function(t){return s.setError(t).end(!0),e._m.setNotReadyReason(wn.LOGIN_FAILED),Oe.e("".concat(c," failed. error:"),t),e._lastLoginTs=0,e._m.onLoginFailed(),In(t)}))}},{key:"logout",value:function(){var e=this,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:0,n="".concat(this._n,".logout"),o=this.isLoggedIn();return Oe.i("".concat(n," type:").concat(t," isLoggedIn:").concat(o," isWebUniapp:").concat(this._isWebUniapp)),o?(new eo("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0),0===t&&this._m.setNotReadyReason(wn.LOGGED_OUT),this.req({P:xn.LOGOUT,data:{type:t,isWebUniapp:this._isWebUniapp}}).then((function(){return e.resetReady(),yn({})})).catch((function(t){return Oe.e("".concat(n," error:"),t),e.resetReady(),yn({})}))):In({code:wn.USER_NOT_LOGGED_IN})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")||0}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.req({P:xn.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch((function(t){Oe.w("".concat(e._n,"._hello error:"),t)}))}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var t=0;return Be(this.get(12).getSDKAppID())?t=wn.NO_SDKAPPID:Be(e.userID)?t=wn.NO_IDENTIFIER:Be(e.userSig)&&(t=wn.NO_USERSIG),{code:t}}},{key:"_isReactUIKit",value:function(){return te&&void 0!==window.tencent_cloud_im_csig_react_uikit_23F_xa}},{key:"onMultipleAccountKickedOut",value:function(e){var t=this;new eo("kickedOut").setMessage("type:".concat(S.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Oe.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOEvt(E.KICKED_OUT,{type:S.KICKED_OUT_MULT_ACCOUNT}),t._m.setNotReadyReason(wn.KICKED_OUT_MULT_ACCOUNT),t._m.reset()}))}},{key:"onMultipleDeviceKickedOut",value:function(e){var t=this;new eo("kickedOut").setMessage("type:".concat(S.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Oe.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then((function(){t.emitOEvt(E.KICKED_OUT,{type:S.KICKED_OUT_MULT_DEVICE}),t._m.setNotReadyReason(wn.KICKED_OUT_MULT_DEVICE),t._m.reset()}))}},{key:"onUserSigExpired",value:function(){new eo("kickedOut").setMessage(S.KICKED_OUT_USERSIG_EXPIRED).end(!0),Oe.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),0!==this.get(12).getStatusInstanceID()&&(this.emitOEvt(E.KICKED_OUT,{type:S.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(wn.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new eo("kickedOut").setMessage("type:".concat(S.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),Oe.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),0!==this.get(12).getStatusInstanceID()&&(this.emitOEvt(E.KICKED_OUT,{type:S.KICKED_OUT_REST_API}),this._m.setNotReadyReason(wn.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),Ui);function Ui(e){return o(this,Ui),(e=Jo.call(this,e))._n="SignModule",e._helloInterval=120,e._lastLoginTs=0,e._lastWsHelloTs=0,e._isWebUniapp=0,Ko.mixin(h(e)),e}function Gi(e,t){o(this,Gi),this._m=e,this._isLoggedIn=!1,this._SDKAppID=t.SDKAppID,this._userID=t.userID||"",this._userSig=t.userSig||"",this._version="3.4.8",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=t.unlimitedAVChatRoom,this._scene=t.scene||"",this._oversea=t.oversea,this._instanceID=t.instanceID,this._statusInstanceID=0,this._isDevMode=t.devMode,this._isTestEnv=t.testEnv,this._proxyServer=t.proxyServer,this._fileUploadProxy=t.fileUploadProxy,this._fileDownloadProxy=t.fileDownloadProxy,this._applicationID=0,this._isPartialUpdatedConvs=t.partialUpdatedConversations,this._isUsingChatCore=!1,this._uiPlatform=0,this._authKey="",this._customLoginInfo=""}function wi(e){return o(this,wi),(e=$o.call(this,e))._n="UserModule",e._profileHandler=new ki(h(e)),e._blacklistHandler=new Li(h(e)),e._userStatusHandler=new Ai(h(e)),e.getIEmitInst().on(qo.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,h(e)),e}function Fi(e){o(this,Fi),this._userM=e,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getIEmitInst().on(qo.CLOUD_CONFIG,this._onCloudConfig,this)}function xi(e){o(this,xi),this._userM=e,this._n="BlacklistHandler",this._blacklistMap=new Map,this._startIndex=0}function Vi(e){o(this,Vi),this._userM=e,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function qi(e){return o(this,qi),(e=Xo.call(this,e))._n="TopicModule",e._topicMap=new Map,e._getTopicTimeMap=new Map,e.TOPIC_CACHE_TIME=300,e.TOPIC_LAST_ACTIVE_TIME=3600,e.getIEmitInst().on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function Bi(e,t){o(this,Bi),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=zo(e.lastMessage,t),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(e)}function Hi(e){return o(this,Hi),(e=Zo.call(this,e))._n="GroupModule",e._commonGroupHandler=new pi(h(e)),e._groupAttributesHandler=new hi(h(e)),e._groupCountersHandler=new gi(h(e)),e._AVChatRoomHandler=new mi(h(e)),e._groupTipsHandler=new di(h(e)),e._groupSystemNoticeHandler=new Mi(h(e)),e._groupMemberHandler=new yi(h(e)),e.groupMap=new Map,e._unjoinedAVChatRoomList=new Map,e._receiptDetailCompleteMap=new Map,e._onlineMemberCountMap=new Map,e._timeoutIDs=[],e.getIEmitInst().on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function ji(e){o(this,ji),this._grpM=e,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function Ki(e){o(this,Ki),this._grpM=e,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getIEmitInst().on(qo.PROFILE_UPDATED,this._onProfileUpdated,this)}function Yi(e){o(this,Yi),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(e)}function zi(e){o(this,zi),this._grpM=e,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this._seqSll=new oi(200),this._IDSll=new oi(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function Wi(e){o(this,Wi);var t=e.manager,n=e.groupID,i=e.onInit,s=e.onSuccess;e=e.onFail,this._n="Polling",this._manager=t,this._grpM=t._grpM,this._onInit=i,this._onSuccess=s,this._onFail=e,this._groupID=n,this._timeoutID=-1,this._isRunning=!1,this._proto=xn.AV_POLLING}function Ji(e){o(this,Ji),this._grpM=e,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(qo.CLOUD_CONFIG,this._onCloudConfig,this)}function $i(e){o(this,$i),this._grpM=e,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(qo.CLOUD_CONFIG,this._onCloudConfig,this)}function Xi(e){o(this,Xi),this._grpM=e,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=kn,this._pagingGetCostList=[],e.getIEmitInst().on(qo.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function Zi(e){o(this,Zi),this._grpM=e,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function Qi(e){return o(this,Qi),(e=Qo.call(this,e))._n="ConvModule",Ko.mixin(h(e)),e._msgListHandler=new Bo(h(e)),e._msgRemindHandler=new ci(h(e)),e._convGroupHandler=new ui(h(e)),e._sll=new oi(100),e._pagingStatus=kn,e._pagingTs=0,e._pagingStartIdx=0,e._pagingPinnedTs=0,e._pagingPinnedStartIdx=0,e._pagingConvIDMap=new Map,e._convIDFromUnreadDBMap=new Map,e._convMap=new Map,e._tmpGroupList=[],e._tmpGroupAtTipsList=[],e._peerReadTimeMap=new Map,e._completedMap=new Map,e._roamingMsgKeyAndTimeMap=new Map,e._remoteGroupReadSeqMap=new Map,e._convTotalUnreadCount=0,e._pagingGetCostList=[],e._convMapForDiff=new Map,e._partialUpdatedConvMap=new Map,e._everClearedMap=new Map,e._bPullOnInvite=!0,e._initListeners(),e}function es(e){o(this,es),this._convM=e,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=kn}function ts(e){o(this,ts),this._convM=e,this._n="MsgRemindHandler"}function ns(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2];o(this,ns),this.conversationID=e.conversationID||"",this.unreadCount=e.unreadCount||0,this.type=e.type||"",this.lastMessage=Yo(e.lastMessage,t,n),e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=e.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=e.isPinned||!1,this.messageRemindType=e.messageRemindType,this.markList=e.markList||[],this.customData=e.customData||"",this.conversationGroupList=e.conversationGroupList||[],this.draftText=e.draftText||"",this._initProfile(e),this.subType=this.groupProfile?this.groupProfile.type:""}function os(e){o(this,os),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(e)}function is(e){o(this,is),this.MAX_LENGTH=e,this.map=new Map}function ss(e){var t=this;o(this,ss),Be(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||S.ALLOW_TYPE_ALLOW_ANY,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||S.FORBID_TYPE_NONE,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Be(e.profileCustomField)||e.profileCustomField.forEach((function(e){t.profileCustomField.push({key:e.key,value:e.value})})))}function as(){return null}function rs(e){var t=e.get(12);return{SDKType:10,SDKAppID:t.getSDKAppID(),SDKVersion:t.getVersion(),tinyID:Number(t.getTinyID()),userID:t.getUserID(),platform:e.getPlatform(),instanceID:t.getInstanceID(),traceID:ke()}}s(vs,[{key:"_errorTolerantHandle",value:function(){Z||"undefined"!=typeof window&&this._canIUseCookies()||(this.getItem=as,this.setItem=as,this.removeItem=as,this.clear=as)}},{key:"onCheckTimer",value:function(e){e%20==0&&0!==this._storageQueue.size&&this._doFlush()}},{key:"_doFlush",value:function(){try{var e,t=T(this._storageQueue);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2),o=n[0],i=n[1];this._setStorageSync(this._getKey(o),i)}}catch(s){t.e(s)}finally{t.f()}this._storageQueue.clear()}catch(s){Oe.w("".concat(this._n,"._doFlush error:"),s)}}},{key:"_getPrefix",value:function(){var e=this._m.get(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;return this.getStorageSync(n)}catch(o){return Oe.w("".concat(this._n,".getItem error:"),o),{}}}},{key:"setItem",value:function(e,t){var n;2<arguments.length&&void 0!==arguments[2]&&arguments[2]?(n=3<arguments.length&&void 0!==arguments[3]&&!arguments[3]?e:this._getKey(e),this._setStorageSync(n,t)):this._storageQueue.set(e,t)}},{key:"clear",value:function(){try{Z?ne.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){Oe.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var t=!(1<arguments.length&&void 0!==arguments[1])||arguments[1];try{var n=t?this._getKey(e):e;this._removeStorageSync(n)}catch(o){Oe.w("".concat(this._n,".removeItem error:"),o)}}},{key:"getSize",value:function(e){var t=this,n=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"b";try{var o={size:0,limitSize:5242880,unit:n};if(Object.defineProperty(o,"leftSize",{enumerable:!0,get:function(){return o.limitSize-o.size}}),Z&&(o.limitSize=1024*ne.getStorageInfoSync().limitSize),e)o.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(Z)ne.getStorageInfoSync().keys.forEach((function(e){o.size+=JSON.stringify(t.getStorageSync(e)).length+t._getKey(e).length}));else if(this._canIUseCookies())for(var i in localStorage)localStorage.hasOwnProperty(i)&&(o.size+=localStorage.getItem(i).length+i.length);return this._convertUnit(o)}catch(s){Oe.w("".concat(this._n," error:"),s)}}},{key:"_convertUnit",value:function(e){var t,n={},o=e.unit;for(t in n.unit=o,e)"number"==typeof e[t]&&("kb"===o.toLowerCase()?n[t]=Math.round(e[t]/1024):"mb"===o.toLowerCase()?n[t]=Math.round(e[t]/1024/1024):n[t]=e[t]);return n}},{key:"_setStorageSync",value:function(e,t){Z?z?my.setStorageSync({key:e,data:t}):ne.setStorageSync(e,t):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(t))}},{key:"getStorageSync",value:function(e){return Z?z?my.getStorageSync({key:e}).data:ne.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){Z?z?my.removeStorageSync({key:e}):ne.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return"undefined"!=typeof window&&navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._doFlush()}}]);var cs,us=vs,ls=(s(ms,[{key:"pushIn",value:function(e){Oe.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var t;We(e)&&0!==e.length&&(Oe.d("".concat(this._n,".backfill"),this._report.length,e.length),(t=this._report).unshift.apply(t,m(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return 0===this._report.length}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),ms),ds=(r(fs,Nn),cs=g(fs),s(fs,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,t=this.get(13),n=t.getItem(this.TAG,!1);!Be(n)&&Je(n.forEach)&&(Oe.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach((function(t){e._reportBody.pushIn(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),t=this.getCloudConfig("evt_rpt_waiting"),n=this.getCloudConfig("evt_rpt_level"),o=this.getCloudConfig("evt_rpt_sdkappid_bl"),i=this.getCloudConfig("evt_rpt_tinyid_wl");ut(e)||(this.MIN_THRESHOLD=Number(e)),ut(t)||(this.WAITING_TIME=Number(t)),ut(n)||(this.REPORT_LEVEL=n.split(",").map((function(e){return Number(e)}))),ut(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map((function(e){return Number(e)}))),ut(i)||(this.REPORT_TINYID_WHITELIST=i.split(","))}},{key:"pushIn",value:function(e){e instanceof eo&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var t=this,n=(o=this.get(12)).getSDKAppID(),o=o.getTinyID();return bt(this.REPORT_SDKAPPID_BLACKLIST,n)&&!Ut(this.REPORT_TINYID_WHITELIST,o)?[]:e.filter((function(e){return t.REPORT_LEVEL.includes(e.level)}))}},{key:"_report",value:function(){var e,n,o=this;this._reportBody.isEmpty()||(e=this._reportBody.getLogsInMemory(),0!==(n=this._filterLogs(e)).length?(n={header:rs(this),event:n},this.req({P:xn.SSO_STAT,data:t({},n)}).then((function(){o._lastReportTime=Date.now()})).catch((function(t){Oe.w("".concat(o._n,"._report failed. error:"),t),o._lastReportTime=Date.now(),o._reportBody.backfill(e),o._reportBody.getLogsNumInMemory()>o.MAX_THRESHOLD&&o._flushAtOnce()}))):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._reportBody.getLogsInMemory(),o="".concat(this._n,"._flushAtOnce");Be(t)?(Oe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):((n=n.concat(t)).length>this.MAX_THRESHOLD&&(n=n.slice(0,this.MAX_THRESHOLD)),Oe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1))}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),fs),ps="none",hs="online",gs=(s(_s,[{key:"_startRN",value:function(){var e,t=this;!ee||(e=this._m.get(18).getPlugin("chat-network-monitor"))&&(this._removeListener=e.addEventListener((function(e){var n=e.isConnected;e=e.type,t._networkType!==e&&t._onNetworkStatusChange({isConnected:void 0!==n&&n,networkType:e})})))}},{key:"start",value:function(){var e=this,t="".concat(this._n,".start");Z?(ne.getNetworkType({success:function(n){e._networkType=n.networkType||n.subtype||"",n.networkType===ps?Oe.w("".concat(t," no network, please check!")):Oe.i("".concat(t," networkType:").concat(n.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),ne.onNetworkStatusChange(this._mpNetworkStatusCallback)):te&&(this._networkType=hs,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:hs})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:ps})}},{key:"_onNetworkStatusChange",value:function(e){var t=e.isConnected,n=(e=e.networkType,"".concat(this._n,"._onNetworkStatusChange")),o=!1,i="previous:".concat(this._networkType," current:").concat(e);t?(Oe.i("".concat(n," ").concat(i)),this._networkType!==e&&(o=!0,this._networkType=e,this._m.get(21).reConnect(!0))):this._networkType!==e&&(o=!0,this._networkType=e,Oe.w("".concat(n," no network, please check!")),this._m.get(21).offline()),o&&new eo("networkChange").setMessage("isConnected:".concat(t," ").concat(i)).end()}},{key:"isOnline",value:function(){return this._networkType!==ps}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),Z?null!==this._mpNetworkStatusCallback&&(ne.offNetworkStatusChange&&ne.offNetworkStatusChange(this._mpNetworkStatusCallback),this._mpNetworkStatusCallback=null):te?(null!==this._webOnlineCallback&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),null!==this._onWebOffline&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null)):ee&&this._removeListener&&(this._removeListener(),this._removeListener=null)}}]),_s);function _s(e){o(this,_s),this._m=e,this._networkType=hs,this._n="NetMonitorModule",this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null,this._removeListener=null,this._m.getIEmitInst().on(qo.A2KEY_AND_TINYID_UPDATED,this._startRN,this)}function fs(e){o(this,fs),(e=cs.call(this,e))._n="EventStatModule",e.TAG="im-ssolog-event",e._reportBody=new ls,e.MIN_THRESHOLD=20,e.MAX_THRESHOLD=100,e.WAITING_TIME=6e4,e.REPORT_LEVEL=[4,5,6],e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._lastReportTime=Date.now();var t=e.getIEmitInst();return t.on(qo.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,h(e)),t.on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function ms(e){o(this,ms),this._n="SSOLogBody",this._report=[]}function vs(e){o(this,vs),this._m=e,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}function ys(e,t){return e(t={exports:{}},t.exports),t.exports}var Is,Ms=ys((function(e){var t=Object.prototype.hasOwnProperty,n="~";function o(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function s(e,t,o,s,a){if("function"!=typeof o)throw new TypeError("The listener must be a function");return o=new i(o,s||e,a),s=n?n+t:t,e._events[s]?e._events[s].fn?e._events[s]=[e._events[s],o]:e._events[s].push(o):(e._events[s]=o,e._eventsCount++),e}function a(e,t){0==--e._eventsCount?e._events=new o:delete e._events[t]}function r(){this._events=new o,this._eventsCount=0}Object.create&&(o.prototype=Object.create(null),(new o).__proto__||(n=!1)),r.prototype.eventNames=function(){var e,o,i=[];if(0===this._eventsCount)return i;for(o in e=this._events)t.call(e,o)&&i.push(n?o.slice(1):o);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},r.prototype.listeners=function(e){e=n?n+e:e;var t=this._events[e];if(!t)return[];if(t.fn)return[t.fn];for(var o=0,i=t.length,s=new Array(i);o<i;o++)s[o]=t[o].fn;return s},r.prototype.listenerCount=function(e){return e=n?n+e:e,(e=this._events[e])?e.fn?1:e.length:0},r.prototype.emit=function(e,t,o,i,s,a){var r=n?n+e:e;if(!this._events[r])return!1;var c,u=this._events[r],l=arguments.length;if(u.fn){switch(u.once&&this.removeListener(e,u.fn,void 0,!0),l){case 1:return u.fn.call(u.context),!0;case 2:return u.fn.call(u.context,t),!0;case 3:return u.fn.call(u.context,t,o),!0;case 4:return u.fn.call(u.context,t,o,i),!0;case 5:return u.fn.call(u.context,t,o,i,s),!0;case 6:return u.fn.call(u.context,t,o,i,s,a),!0}for(h=1,c=new Array(l-1);h<l;h++)c[h-1]=arguments[h];u.fn.apply(u.context,c)}else for(var d,p=u.length,h=0;h<p;h++)switch(u[h].once&&this.removeListener(e,u[h].fn,void 0,!0),l){case 1:u[h].fn.call(u[h].context);break;case 2:u[h].fn.call(u[h].context,t);break;case 3:u[h].fn.call(u[h].context,t,o);break;case 4:u[h].fn.call(u[h].context,t,o,i);break;default:if(!c)for(d=1,c=new Array(l-1);d<l;d++)c[d-1]=arguments[d];u[h].fn.apply(u[h].context,c)}return!0},r.prototype.on=function(e,t,n){return s(this,e,t,n,!1)},r.prototype.once=function(e,t,n){return s(this,e,t,n,!0)},r.prototype.removeListener=function(e,t,o,i){if(e=n?n+e:e,!this._events[e])return this;if(!t)return a(this,e),this;var s=this._events[e];if(s.fn)s.fn!==t||i&&!s.once||o&&s.context!==o||a(this,e);else{for(var r=0,c=[],u=s.length;r<u;r++)(s[r].fn!==t||i&&!s[r].once||o&&s[r].context!==o)&&c.push(s[r]);c.length?this._events[e]=1===c.length?c[0]:c:a(this,e)}return this},r.prototype.removeAllListeners=function(e){return e?(e=n?n+e:e,this._events[e]&&a(this,e)):(this._events=new o,this._eventsCount=0),this},r.prototype.off=r.prototype.removeListener,r.prototype.addListener=r.prototype.on,r.prefixed=n,e.exports=r.EventEmitter=r})),Cs=["rich.my-imcloud.com","imrich.qcloud.com"],Ts=["requestSnapshotUrl"],Es=(r(As,Nn),Is=g(As),s(As,[{key:"_init",value:function(){this._fileDownloadProxy=this.getFileDownloadProxy(),this._authKey=this.getDowloadFileAuthKey();var e=this.get(18);this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=e.getPlugin(e=Z?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.warn("CosReplacement",e)):this.warn("PluginUndetected"))}},{key:"_onCloudConfig",value:function(){var e=this,t="".concat(this._n,"._onCloudConfig"),n=this.getCloudConfig("upload_size_limit"),o=this.getCloudConfig("simple_cos"),i=this.getCloudConfig("file_dn_list");if(Oe.l("".concat(t," uploadSizeLimit:").concat(n," simpleCos:").concat(o)),!ut(n))try{var s=JSON.parse(n);this.UPLOAD_SIZE_LIMIT={A:s.a?1048576*parseInt(s.a):this.UPLOAD_SIZE_LIMIT.A,F:s.f?1048576*parseInt(s.f):this.UPLOAD_SIZE_LIMIT.F,I:s.i?1048576*parseInt(s.i):this.UPLOAD_SIZE_LIMIT.I,V:s.v?1048576*parseInt(s.v):this.UPLOAD_SIZE_LIMIT.V}}catch(a){}if(ut(o)||(this.isSimpleCos="1"===o),!ut(i))try{JSON.parse(i).forEach((function(t){e._fileDNList.includes(t)||e._fileDNList.push(t)}))}catch(a){}}},{key:"_getAuthorizationKey",value:function(){var e=this,t="".concat(this._n,".").concat("_getAuthorizationKey"),n=new eo("_getAuthorizationKey"),o=Math.ceil(Date.now()/1e3);this.req({P:xn.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then((function(i){i=i.data;var s=(Oe.l("".concat(t," ok. data:"),i),i.expiredTime-o);n.setMessage("requestId:".concat(i.requestId," requestTime:").concat(o," expiredTime:").concat(i.expiredTime," diff:").concat(s,"s")).end(),!Z&&i.region&&(e.region=i.region),e.appid=i.appid,e.bucketName=i.bucketName,e.ciUrl=i.ciUrl,e.directory=i.directory,e.downloadUrl=i.downloadUrl,e.uploadUrl=i.uploadUrl,e.cosOptions={secretId:i.secretId,secretKey:i.secretKey,sessionToken:i.sessionToken,expiredTime:i.expiredTime},Oe.l("".concat(t," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()})).catch((function(e){n.setError(e).end(),Oe.w("".concat(t," failed. error:"),e)}))}},{key:"_getCosPreSigUrl",value:function(e){var t=this,n="".concat(this._n,".").concat("_getCosPreSigUrl"),o=Math.ceil(Date.now()/1e3),i=new eo("_getCosPreSigUrl"),s={uploadMethod:e.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:e.userID,conversationType:e.conversationType,uploadConfig:[{fileID:1,fileType:e.fileType,fileName:e.fileName}]},a=xn.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(s={fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration},a=xn.COS_PRE_SIG),this.req({P:a,data:s}).then((function(e){t.tryCount=0,e=e.data||{};var s,a,r=Oe.l("".concat(n," ok. isSimpleCos:").concat(t.isSimpleCos," data:"),e);return r=t.isSimpleCos?(s=(a=e.preSig[0]).uploadUrl,a=a.fileKey,"uploadIP:".concat(e.uploadIP," uploadUrl:").concat(s," fileKey:").concat(a," cost:").concat(jt(o))):"requestId:".concat(e.requestId," expiredTime:").concat(e.expiredTime," diff:").concat(e.expiredTime-o,"s"),i.setMessage(r).end(),e})).catch((function(o){return-1===o.code&&(o.code=wn.COS_GET_SIG_FAIL),i.setError(o).end(),Oe.w("".concat(n," failed. error:"),o),t.tryCount<1?(t.tryCount++,t._getCosPreSigUrl(e)):(t.tryCount=0,In({code:wn.COS_GET_SIG_FAIL}))}))}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(t,n){e.timUploadPlugin.uploadFile(t,n)});this.appid&&(this.cos=Z?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=Z?function(t,n){e.cos.postObject(t,n)}:function(t,n){e.cos.uploadFiles(t,n)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"getFileDNList",value:function(){return this._fileDNList}},{key:"_getAuthorization",value:function(e,t){t({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(!0===e._relayFlag)return Promise.resolve();var t=this.get(26);switch(e.type){case S.MSG_IMAGE:return t.addTotalCount(Yn),this._uploadImage(e);case S.MSG_FILE:return t.addTotalCount(Yn),this._uploadFile(e);case S.MSG_AUDIO:return t.addTotalCount(Yn),this._uploadAudio(e);case S.MSG_VIDEO:return t.addTotalCount(Yn),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,o=this.get(2),i=e.getElements()[0],s=o.getMessageOption(e.clientSequence);return this.doUploadImage({file:s.payload.file,to:s.to,message:e,onProgress:function(e){if(i.updatePercent(e),Je(s.onProgress))try{s.onProgress(e)}catch(t){return In({code:wn.MSG_ONPROGRESS_ERR})}}}).then((function(o){var s=o.location,a=o.fileType,r=o.fileSize,c=o.width,u=o.height,l=o.smallImageUrl,d=o.smallImageWidth,p=o.smallImageHeight,h=o.largeImageUrl,g=o.largeImageWidth,_=o.largeImageHeight,f=o.imageInfoArray;o=n.isPrivateNetWork()?s:st(s),i.updateImageFormat(a);var m,v,y={size:r,url:o,width:c,height:u};if(f&&0<f.length)for(var I=0;I<f.length;I++){var M=f[I];1===M.type?m=M:2===M.type?v=M:y=t(t({},y),M)}else v=l&&h?(m={url:l,width:d,height:p},{url:h,width:g,height:_}):(m=At({originUrl:o,originWidth:c,originHeight:u,min:198}),At({originUrl:o,originWidth:c,originHeight:u,min:720}));return i.updateImageInfoArray([t({},y),t({},v),t({},m)]),e}))}},{key:"_uploadFile",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadFile({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(o.updatePercent(e),Je(i.onProgress))try{i.onProgress(e)}catch(t){return In({code:wn.MSG_ONPROGRESS_ERR})}}}).then((function(n){var i=n=n.location;return t.isPrivateNetWork()||(i=ao(i=st(n),t._fileDownloadProxy,t._authKey,t._fileDNList)),o.updateFileUrl(i),e}))}},{key:"_uploadAudio",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadAudio({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(o.updatePercent(e),Je(i.onProgress))try{i.onProgress(e)}catch(t){return In({code:wn.MSG_ONPROGRESS_ERR})}}}).then((function(n){return n=n.location,n=t.isPrivateNetWork()?n:st(n),o.updateAudioUrl(n),e}))}},{key:"_uploadVideo",value:function(e){var t=this,n=this.get(2),o=e.getElements()[0],i=n.getMessageOption(e.clientSequence);return this.doUploadVideo({file:i.payload.file,to:i.to,message:e,onProgress:function(e){if(o.updatePercent(e),Je(i.onProgress))try{i.onProgress(e)}catch(t){return In({code:wn.MSG_ONPROGRESS_ERR})}}}).then((function(n){var i=n.location;return n=n.snapshotInfo,i=t.isPrivateNetWork()?i:st(i),o.updateVideoUrl(i),Be(n)||o.updateSnapshotInfo(n),e}))}},{key:"_checkSizeError",value:function(e){var t="";return"A"===e?t="audio":"I"===e?t="image":"V"===e?t="video":"F"===e&&(t="file"),In({code:wn["MSG_".concat(e,"_SIZE_LIMIT")],message:this.getErrMsg("UploadSizeLimit",t,"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576,"MB"))})}},{key:"doUploadImage",value:function(e){var t=this;if(!e.file||this._isEmptyFileList(e.file.files))return In({code:wn.MSG_I_SELECT_F_FIRST});var n=this._checkImageType(e.file);if(!0!==n)return n;if(!0!==(n=this._checkImageSize(e.file)))return n;var o=null;return this._setUploadFileType(1),this.uploadByCOS(e).then((function(n){if(o=n,t.isPrivateNetWork())return Dt(s);if(We(o.imageInfoArray)){var i=o.imageInfoArray.find((function(e){return 3===e.type}));if(i)return i}if(ee)return{width:e.file.width,height:e.file.height};var s=st(n.location);return t.COSSDK?Dt(s):Dt(s=ao(s,t._fileDownloadProxy,t._authKey,t._fileDNList))})).then((function(e){return o.width=e.width,o.height=e.height,Promise.resolve(o)}))}},{key:"_checkImageType",value:function(e){var t="";return t=Z?e.url.slice(e.url.lastIndexOf(".")+1):ee?e.type.split("/")[1]:e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),0<=ei.indexOf(t.toLowerCase())||In({code:wn.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){return 0===(e=(Z||ee?e:e.files[0]).size)?In({code:wn.MSG_F_IS_EMPTY}):e<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(e){return!e.file||this._isEmptyFileList(e.file.files)?In({code:wn.MSG_F_SELECT_F_FIRST}):e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):0===e.file.files[0].size?In({code:wn.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e))}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):0===e.file.videoFile.size?In({code:wn.MSG_F_IS_EMPTY}):-1===ti.indexOf(e.file.videoFile.type)?In({code:wn.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),Z||ee?this.handleVideoUpload(t(t({},e),{},{file:e.file.videoFile})):te?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var t=this;return new Promise((function(n,o){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){t.uploadByCOS(e).then((function(e){n(e)})).catch((function(){o(new Gn({code:wn.MSG_V_UPLOAD_FAIL}))}))}))}))}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):0===e.file.size?In({code:wn.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):In({code:wn.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var t=this;if(!Je(this._cosUploadMethod))return this.warn("PluginUndetected"),In({code:wn.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var n=new eo("upload"),o="".concat(this._n,".uploadByCOS"),i=Date.now(),s=this._getFile(e);return new Promise((function(a,r){var c=Z?t._createCosOptionsWXMiniApp(e):t._createCosOptionsWeb(e),u=t;t._cosUploadMethod(c,(function(e,c){var l=Object.create(null);if(c){if(e||We(c.files)&&c.files[0].error)return d=new Gn({code:wn.MSG_F_UPLOAD_FAIL}),n.setError(d).end(),Oe.l("".concat(o," failed. error:"),c.files[0].error),403===c.files[0].error.statusCode&&t._getAuthorizationKey(),void r(d);l.fileName=s.name,l.fileSize=s.size,l.fileType=s.type.slice(s.type.indexOf("/")+1).toLowerCase(),l.location=(Z?c:c.files[0].data).Location;var d=Date.now()-i,p=(c=u._formatFileSize(s.size),u._formatSpeed(1e3*s.size/d));return c="size:".concat(c," time:").concat(d,"ms speed:").concat(p),(Oe.l("".concat(o," success. name:").concat(s.name," ").concat(c)),a(l),p=t.get(26)).addCost(Yn,d),p.addFileSize(Yn,s.size),void n.setMessage(c).end()}l=new Gn({code:wn.MSG_F_UPLOAD_FAIL}),n.setError(l).end(),Oe.w("".concat(o," failed. error:"),e),403===e.statusCode&&t._getAuthorizationKey(),r(l)}))}))}},{key:"_uploadWithPreSigUrl",value:function(e){var t=this,n="".concat(this._n,"._uploadWithPreSigUrl"),o=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then((function(e){return new Promise((function(i,s){var a=new eo("upload"),r=e.requestSnapshotUrl,c=void 0===r?void 0:r,u=p(e,Ts),l=Date.now();t._cosUploadMethod(u,(function(r,d){var p,h,g;return r||403===d.statusCode?(a.setError(new Gn(r)).end(),h={HttpStatusCode:9999,CostTime:jt(l,!1),error:r,url:e.url},d.data&&d.data.uploadIP&&(h.uploadIP=d.data.uploadIP),t._uploadSSOLog(h),Oe.l("".concat(n," failed, error:"),r),void s(new Gn({code:wn.MSG_F_UPLOAD_FAIL}))):(p=Object.create(null),h=d.data.location||"",t.isPrivateNetWork()||0!==h.indexOf("https://")&&0!==h.indexOf("http://")||(h=h.split("//")[1]),p.fileName=o.name,p.fileSize=o.size,p.fileType=o.type.slice(o.type.indexOf("/")+1).toLowerCase(),p.location=h,r=jt(l,!1),h=t._formatFileSize(o.size),g=t._formatSpeed(1e3*o.size/r),h="size:".concat(h," time:").concat(r,"ms speed:").concat(g," res:").concat(JSON.stringify(d.data)),Oe.l("".concat(n," ok. name:").concat(o.name," ").concat(h)),a.setMessage(h).end(),g={HttpStatusCode:d.statusCode,FileSize:o.size,CostTime:r,url:e.url},d.data&&d.data.uploadIP&&(g.uploadIP=d.data.uploadIP),t._uploadSSOLog(g),(h=t.get(26)).addCost(Yn,r),h.addFileSize(Yn,o.size),g=[],u.thumbUrl&&u.largeUrl&&g.push.apply(g,[t._getSmallImageInfoByUrl(u.thumbUrl,p),t._getLargeImageInfoByUrl(u.largeUrl,p)]),1===t.uploadFileType&&t.isSimpleCos&&!t.isPrivateNetWork()&&(g.push(t._getImageInfoArray(u.downloadUrl,p)),d.data.uploadIP&&g.push(t._getDownloadIP(u.downloadUrl.split("//")[1].split("/")[0],p))),c&&g.push(t._getSnapshotInfoByUrl(c,p)),0<g.length?Promise.all(g).then((function(){i(p)})):void i(p))}))}))}))}},{key:"_getDownloadIP",value:function(e,t){var n="".concat(this._n,"._getDownloadIP"),o=Date.now();return this.req({P:xn.GET_IP,data:{domainName:e}}).then((function(e){var i;e.data&&e.data.ip&&(Oe.l("".concat(n," ok. downloadIP:").concat(e.data.ip," cost:").concat(jt(o))),(i=t.location.split("/"))[0]=e.data.ip,t.location=i.join("/"))})).catch((function(e){}))}},{key:"_getImageInfoArray",value:function(e,t){var n=this,o="".concat(this._n,"._getImageInfoArray"),i=Date.now();return this.req({P:xn.GET_IMAGE_INFO,data:{imageUrl:e}}).then((function(e){return e=e.data||{},Oe.l("".concat(o," ok. data: ").concat(JSON.stringify(e)," cost:").concat(jt(i))),t.imageInfoArray=e.imageInfoArray,e})).catch((function(o){t.imageInfoArray=void 0,n._uploadSSOLog({HttpStatusCode:1e4,CostTime:jt(i,!1),url:e})}))}},{key:"_uploadSSOLog",value:function(e){var t,n;this.isSimpleCos&&((t=new eo).setEventType(18),e.error&&t.setError(new Gn(e.error)),n="HttpStatusCode:".concat(e.HttpStatusCode,"|CosRequestId:").concat(e.CosRequestId||"","|")+"FileAlreadyExist:".concat(e.FileAlreadyExist||0,"|FileSize:").concat(e.FileSize||0,"|CostTime:").concat(e.CostTime),e.uploadIP&&(n+="|FinalIP:".concat(e.uploadIP)),t.setMessage("OK").setMoreMessage(e.url).setExtension(n).end())}},{key:"_getRawOrUploadProxyUrl",value:function(e){var t=this.get(12).getFileUploadProxy(),n=e;return t?e.replace(/^https:\/\/[^/]+/,t):n}},{key:"_getFile",value:function(e){return We(e.file.files)||$e(e.file.files)?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?Pt(e/1024,1)+"KB/s":Pt(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var t=this._getFile(e),n=(n=t.name).slice(n.lastIndexOf("."));return n=this._genFileName("".concat(nt(999999)).concat(n)),{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),Body:t}],SliceSize:1048576,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Oe.w("onProgress callback error:",n)}},onFileFinish:function(e,t,n){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var t=this._getFile(e),n=this._genFileName(t.name);return t=t.url,{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(n),FilePath:t,onProgress:function(t){if(Oe.l(JSON.stringify(t)),"function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Oe.w("onProgress callback error:",n)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var t,n,o=this,i="",s="",a=this._getFile(e);return n=Z||ee?(i=e.message.type===S.MSG_FILE?(t=(t=a.name).slice(t.lastIndexOf(".")),this._genFileName("".concat(nt(999999)).concat(t))):this._genFileName(a.name),s=a.url,1):(t=(t=a.name).slice(t.lastIndexOf(".")),i=this._genFileName("".concat(nt(999999)).concat(t)),s=a,0),this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:i,uploadMethod:n,duration:this.duration,userID:e.message.from,conversationType:Ct(e.message.conversationID)?1:2}).then((function(t){var n=(l=o.isSimpleCos?t.preSig[0]:t).uploadUrl,a=l.downloadUrl,r=void 0===(r=l.requestSnapshotUrl)?void 0:r,c=l.thumbUrl,u=l.largeUrl,l=l.fileKey;return t=void 0===(t=t.uploadIP)?"":t,{url:o._getRawOrUploadProxyUrl(n),fileType:o.uploadFileType,fileName:i,resources:s,downloadUrl:a,requestSnapshotUrl:r,thumbUrl:c,largeUrl:u,fileKey:l,uploadIP:!o.isPrivateNetWork()&&t,onProgress:function(t){if("function"==typeof e.onProgress)try{e.onProgress(t.percent)}catch(n){Oe.w("onProgress callback error:",n),Oe.e(n)}}}}))}},{key:"_genFileName",value:function(e){return"".concat(kt(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,t){var n=this,o="_getSnapshotInfoByUrl",i=new eo(o);return this.req({P:xn.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(nt(99999)),requestSnapshotUrl:e}}).then((function(e){if(e=(e.data||{}).snapshotUrl,Oe.l("".concat(n._n,".").concat(o," ok. snapshotUrl:").concat(e)),i.setMessage("snapshotUrl:".concat(e)).end(),Be(e))return{};var s=ao(e,n._fileDownloadProxy,n._authKey,n._fileDNList);return Dt(s).then((function(e){t.snapshotInfo={snapshotUrl:s,snapshotWidth:e.width,snapshotHeight:e.height}}))})).catch((function(e){return Oe.w("".concat(n._n,".").concat(o," failed. error:"),e),i.setCode(e.errorCode).setMessage(e.errorInfo).end(),{}}))}},{key:"_getSmallImageInfoByUrl",value:function(e,t){return Dt(ao(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then((function(n){t.smallImageUrl=e,t.smallImageWidth=n.width,t.smallImageHeight=n.height}))}},{key:"_getLargeImageInfoByUrl",value:function(e,t){return Dt(ao(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then((function(n){t.largeImageUrl=e,t.largeImageWidth=n.width,t.largeImageHeight=n.height}))}},{key:"_isEmptyFileList",value:function(e){return!(!$e(e)||0!==e.length)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset"))}}]),As),Ss=["downloadKey","pbDownloadKey","messageList"],Ds=(s(Ls,[{key:"uploadMergerMessage",value:function(e,t){var n="".concat(this._n,".").concat("uploadMergerMessage"),o=(Oe.d("".concat(n," message:"),e,"messageBytes:".concat(t)),e=JSON.parse(JSON.stringify(e.payload)).messageList).length,i=this._msgM.get(17).getFileDNList(),s=new eo("uploadMergerMessage");return e.forEach((function(e){ro(e.messageBody[0].type,e.messageBody,i)})),this._msgM.req({P:xn.UPLOAD_MERGER_MSG,data:{messageList:e}}).then((function(e){Oe.d("".concat(n," ok. response:"),e.data);var i={pbDownloadKey:i=(e=e.data).pbDownloadKey,downloadKey:e=e.downloadKey,messageNumber:o};return s.setMessage("".concat(o,"-").concat(t,"-").concat(e)).end(),i})).catch((function(e){throw Oe.w("".concat(n," failed. error:"),e),s.setError(e).end(),e}))}},{key:"downloadMergerMessage",value:function(e){var n=this,o="".concat(this._n,".").concat("downloadMergerMessage"),i=(Oe.d("".concat(o," message:"),e),e.payload.downloadKey),s=this._msgM.getFileDownloadProxy(),a=this._msgM.getDowloadFileAuthKey(),r=new eo("downloadMergerMessage");return r.setMessage("downloadKey:".concat(i)),this._msgM.req({P:xn.DOWNLOAD_MERGER_MSG,data:{downloadKey:i}}).then((function(i){Oe.d("".concat(o," ok. response:"),i.data);var c,u,l=n._msgM.get(17).getFileDNList();return Je(e.clearElement)?((c=e.payload).downloadKey,c.pbDownloadKey,c.messageList,c=p(c,Ss),e.clearElement(),e.setElement({type:e.type,content:t({messageList:i.data.messageList},c)},s,a,l)):(u=[],i.data.messageList.forEach((function(e){Be(e)||(e=new Co(e,s,a,l),u.push(e))})),e.payload.messageList=u,e.payload.downloadKey="",e.payload.pbDownloadKey=""),r.end(),e})).catch((function(e){throw Oe.w("".concat(o," failed. key:").concat(i," error:"),e),r.setError(e).end(),e}))}},{key:"createMergerMessagePack",value:function(e,t,n){return e.conversationType===S.CONV_C2C?this._createC2CMergerMessagePack(e,t,n):this._createGroupMergerMessagePack(e,t,n)}},{key:"_createC2CMergerMessagePack",value:function(e,t,n){var o=null,i=(t&&(t.offlinePushInfo&&(o=t.offlinePushInfo),!0===t.onlineUserOnly&&(o?o.disablePush=!0:o={disablePush:!0})),[]),s=(ze(t)&&ze(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck")),""),a=(ct(e.cloudCustomData)&&0<e.cloudCustomData.length&&(s=e.cloudCustomData),n.pbDownloadKey),r=n.downloadKey,c=(n=n.messageNumber,(l=e.payload).title),u=l.abstractList,l=l.compatibleText,d=(d=this._msgM.get(6))&&d.isOnlineMessage(e,t)?0:void 0;return{P:xn.SEND_C2C_MSG,data:{fromAccount:this._msgM.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:a,downloadKey:r,title:c,abstractList:u,compatibleText:l,messageNumber:n}}],cloudCustomData:s,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:d,offlinePushInfo:Fo(o),messageControlInfo:0!==d?i:void 0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,t,n){var o=null,i=(t&&t.offlinePushInfo&&(o=t.offlinePushInfo),[]),s=(ze(t)&&ze(t.messageControlInfo)&&(s=(r=t.messageControlInfo).excludedFromUnreadCount,a=r.excludedFromLastMessage,r=r.excludedFromContentModeration,!0===s&&i.push("NoUnread"),!0===a&&i.push("NoLastMsg"),!0===r&&i.push("NoMsgCheck")),""),a=(ct(e.cloudCustomData)&&0<e.cloudCustomData.length&&(s=e.cloudCustomData),n.pbDownloadKey),r=n.downloadKey,c=(n=n.messageNumber,(l=e.payload).title),u=l.abstractList,l=l.compatibleText,d=this._msgM.get(7);return t=d&&d.isOnlineMessage(e,t)?1:0,{P:xn.SEND_GRP_MSG,data:{fromAccount:this._msgM.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:a,downloadKey:r,title:c,abstractList:u,compatibleText:l,messageNumber:n}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:s,onlineOnlyFlag:t,offlinePushInfo:Fo(o),clientTime:e.clientTime,needReadReceipt:!0!==e.needReadReceipt||d.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:0==t?i:void 0,isSupportExtension:!0===e.isSupportExtension?1:0,isRelayMessage:!0===e._relayFlag?1:0}}}}]),Ls),ks={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Rs=[wn.MSG_ONPROGRESS_ERR,wn.MSG_I_SELECT_F_FIRST,wn.MSG_I_TYPES_LIMIT,wn.MSG_F_IS_EMPTY,wn.MSG_I_SIZE_LIMIT,wn.MSG_F_SELECT_F_FIRST,wn.MSG_F_SIZE_LIMIT,wn.MSG_V_SIZE_LIMIT,wn.MSG_V_TYPES_LIMIT,wn.MSG_A_UPLOAD_FAIL,wn.MSG_A_SIZE_LIMIT,wn.COS_UNDETECTED];function Ls(e){o(this,Ls),this._n="MergerMessageHandler",this._msgM=e}function As(e){o(this,As),(e=Is.call(this,e))._n="UploadModule",e.TIMUploadPlugin=null,e.timUploadPlugin=null,e.COSSDK=null,e._cosUploadMethod=null,e.expiredTimeLimit=600,e.appid=0,e.bucketName="",e.ciUrl="",e.directory="",e.downloadUrl="",e.uploadUrl="",e.region="ap-shanghai",e.cos=null,e.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},e.uploadFileType="",e.duration=900,e.tryCount=0,e.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},e.isSimpleCos=!1,e._fileDownloadProxy="",e._authKey="",e._fileDNList=Cs;var t=e.getIEmitInst();return t.on(qo.A2KEY_AND_TINYID_UPDATED,e._init,h(e)),t.on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function Os(e){var t=!1;return Object.values(ks).includes(e)&&(t=!0),120001<=e&&e<=13e4||10100<=e&&e<=10200||t}var Ns,Ps,bs,Us,Gs,ws,Fs=["conversationID","timePosition","timePeriod"],xs=(r(Xs,Nn),ws=g(Xs),s(Xs,[{key:"createTextMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new So(e));return e=ct(e.payload)?e.payload:e.payload.text,e=new to({text:e}),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createImageMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new So(e));if(Z){if(je(i=e.payload.file))return void this.warn("FileUnsupportedInMP","createImageMessage");var o=i.tempFiles[0].path||i.tempFiles[0].tempFilePath,i={url:o,name:o.slice(o.lastIndexOf("/")+1),size:i.tempFiles&&i.tempFiles[0].size||1,type:o.slice(o.lastIndexOf(".")+1).toLowerCase()};e.payload.file=i}else ee?(i={url:(o=e.payload.file).uri,name:o.fileName,size:o.fileSize||1,type:o.type,width:o.width,height:o.height},e.payload.file=i):te&&(je(e.payload.file)?(o=e.payload.file,e.payload.file={files:[o]}):ze(e.payload.file)&&"undefined"!=typeof uni&&(i=e.payload.file.tempFiles[0],e.payload.file={files:[i]}));return o=new lo({imageFormat:Ne.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),i=this._getNickAndAvatarByUserID(t),n.setElement(o),n.setNickAndAvatar(i),n.setNameCard(this._getNameCardByGroupID(n)),this._messageOptionsMap.set(n.clientSequence,e),n}},{key:"createAudioMessage",value:function(e){var t=e.payload.file,n=(Z&&(n={url:t.tempFilePath,name:t.tempFilePath.slice(t.tempFilePath.lastIndexOf("/")+1),size:t.fileSize,second:parseInt(t.duration)/1e3,type:t.tempFilePath.slice(t.tempFilePath.lastIndexOf(".")+1).toLowerCase()},e.payload.file=n),ee&&(n={url:t.uri,name:t.uri.slice(t.uri.lastIndexOf("/")+1),size:t.fileSize||1,second:Math.floor(t.duration/1e3),type:t.uri.slice(t.uri.lastIndexOf(".")+1).toLowerCase()},e.payload.file=n),this.getMyUserID()),o=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new So(e));return t=new ho({second:Math.floor(t.duration/1e3),size:t.fileSize||t.size||1,url:t.tempFilePath,uuid:this._generateUUID(e.payload.file)}),n=this._getNickAndAvatarByUserID(n),o.setElement(t),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createVideoMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0,{});if(Z){if(z)return void this.warn("VideoUnsupportedInAlipay");if(je(e.payload.file))return void this.warn("FileUnsupportedInMP","createVideoMessage");var o=e.payload.file;We(o.tempFiles)&&(o=o.tempFiles[0]),n.url=o.tempFilePath,n.name=o.tempFilePath.slice(o.tempFilePath.lastIndexOf("/")+1),n.size=o.size||1,n.second=o.duration||0,n.type=o.tempFilePath.slice(o.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else ee?(o=e.payload.file,n.url=o.uri,n.name=o.fileName,n.size=o.fileSize||1,n.second=o.duration||0,n.type=o.type.split("/")[1]):te&&(je(e.payload.file)?(o=e.payload.file,e.payload.file.files=[o]):ze(e.payload.file)&&"undefined"!=typeof uni&&(o=e.payload.file.tempFile,e.payload.file.files=[o]),o=e.payload.file,n.url=window.URL.createObjectURL(o.files[0]),n.name=o.files[0].name,n.size=o.files[0].size||1,n.second=o.files[0].duration||0,n.type=o.files[0].type.split("/")[1]);return e.payload.file.videoFile=n,o=new So(e),n=new Io({videoFormat:n.type,videoSecond:Pt(n.second,0),videoSize:n.size,remoteVideoUrl:"",videoUrl:n.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),t=this._getNickAndAvatarByUserID(t),o.setElement(n),o.setNickAndAvatar(t),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createCustomMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new So(e));return e=new yo({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createFaceMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new So(e));return e=new po(e.payload),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"createMergerMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),t=this._getNickAndAvatarByUserID(t),new So(e));return e=new To(e.payload),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n.setRelayFlag(!0),n}},{key:"createForwardMessage",value:function(e){var t=e.to,n=e.conversationType,o=e.priority,i=e.payload,s=e.needReadReceipt,a=e.receiverList;if(!We(i._elements))return In({code:wn.MSG_FORWARD_INVALID_ELEMENTS});var r=this.getMyUserID(),c=this._getNickAndAvatarByUserID(r);return i.type===S.MSG_GRP_TIP?In({code:wn.MSG_FORWARD_TYPE_INVALID}):(n={to:t,conversationType:n,conversationID:"".concat(n).concat(t),priority:o,isPlaceMessage:0,status:En,currentUser:r,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||i.cloudCustomData||"",needReadReceipt:s,receiverList:a,isSupportExtension:e.isSupportExtension||!1},(t=new So(n)).setElement(i._elements[0]),t.setNickAndAvatar(c),t.setNameCard(this._getNameCardByGroupID(i)),t.setRelayFlag(!0),t)}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(Z){if(!B&&!j&&!J)return;var n=ne.getSystemInfoSync().SDKVersion;if(B&&Lt(n,"2.5.0")<0)return void this.warn("WXChooseMessageFile");if(j&&Lt(n,"1.18.0")<0)return void this.warn("QQChooseMessageFile")}te||J?je(e.payload.file)?(n=e.payload.file,e.payload.file={files:[n]}):ze(e.payload.file)&&"undefined"!=typeof uni&&(i=(n=e.payload.file).tempFiles,n=n.files,o=null,We(i)?o=i[0]:We(n)&&(o=n[0]),e.payload.file={files:[o]}):B||j?(n=t(t({},(i=e.payload.file.tempFiles)[0]),{},{url:i[0].path}),e.payload.file={files:[n]}):ee&&(i=t(t({},o=e.payload.file),{},{url:o.uri}),e.payload.file={files:[i]}),n=this.getMyUserID();var o=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new So(e)),i=new vo({uuid:this._generateUUID(e.payload.file),file:e.payload.file});return n=this._getNickAndAvatarByUserID(n),o.setElement(i),o.setNickAndAvatar(n),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,e),o}},{key:"createLocationMessage",value:function(e){var t=this.getMyUserID(),n=(e.currentUser=t,e.senderTinyID=this.getMyTinyID(),new So(e));return e=new Mo(e.payload),t=this._getNickAndAvatarByUserID(t),n.setElement(e),n.setNickAndAvatar(t),n.setNameCard(this._getNameCardByGroupID(n)),n}},{key:"_onNoModule",value:function(){return In({code:wn.NO_MODULE})}},{key:"sendMessageInstance",value:function(e,t){var n=this;if(!1===this.get(29).filterMessage(e,t))return e.hasRiskContent=!0,this._onSendMessageFailed(e,new Gn({code:wn.PROFANITY_FOUND}));var o=null;if(e.conversationType===S.CONV_C2C)o=this.get(6);else{if(e.conversationType!==S.CONV_GROUP)return In({code:wn.MSG_INVALID_CONV_TYPE});o=this.get(7)}if(!o)return this._onNoModule();var i,s="".concat(this._n,".sendMessageInstance"),a=this.get(11),r=o.isOnlineMessage(e,t);return this.get(17).upload(e).then((function(){return n._getSendMessageSpecifiedKey(e)===Kn&&n.get(26).addSuccessCount(Yn),n._guardForGroup(e).then((function(){if(!e.isSendable())return In({code:wn.MSG_F_URL_IS_EMPTY});n._addSendMessageTotalCount(e),i=Date.now();var s=function(e){var t="utf-8";te&&document&&(t=document.charset.toLowerCase());var n,o=0,i=e.length;if("utf-8"===t||"utf8"===t)for(var s=0;s<i;s++)(n=e.codePointAt(s))<=127?o+=1:n<=2047?o+=2:n<=65535?o+=3:(o+=4,s++);else if("utf-16"===t||"utf16"===t)for(var a=0;a<i;a++)(n=e.codePointAt(a))<=65535?o+=2:(o+=4,a++);else o=e.replace(/[^\x00-\xff]/g,"aa").length;return o}(JSON.stringify(e));return e.type===S.MSG_MERGER&&11264<s?n._mergerMessageHandler.uploadMergerMessage(e,s).then((function(o){return o=n._mergerMessageHandler.createMergerMessagePack(e,t,o),n.req(o)})):(a.setMessageRandom(e),o.sendMessage(e,t))})).then((function(o){var c,u=(o=o.data).time,l=o.sequence,d=o.readReceiptCode;return o=o.messageDropReason,Ke(d)&&0!==d&&(new eo("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(l," readReceiptCode:").concat(d)).end(),Oe.w("".concat(s," readReceiptCode:").concat(d," message:").concat(n.getErrMsg(d)))),o&&(d=new eo("messageDropReason"),o="from:".concat(e.from," to:").concat(e.to," sequence:").concat(l," messageDropReason:").concat(o),d.setMessage(o).end(),Oe.w("".concat(s," ").concat(o))),n._addSendMessageSuccessCount(e,i),n._messageOptionsMap.delete(e.clientSequence),!0===e.isResend&&(c=a.findMessage(e.ID))&&(Oe.l("".concat(s," resend ok. ID:").concat(c.ID)),a.deleteLocalMessage(c)),e.status=Sn,e.time=u,d=!1,e.conversationType===S.CONV_GROUP?e.sequence=l:e.conversationType!==S.CONV_C2C||(o=a.getLatestMessageSentByMe(e.conversationID))&&(c=o.nick,u=o.avatar,c===e.nick&&u===e.avatar||(d=!0)),d&&a.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),!0===r?e._onlineOnlyFlag=!0:(a.appendToMessageList(e),l=e,ze(t)&&ze(t.messageControlInfo)&&(!0===t.messageControlInfo.excludedFromLastMessage&&(e._isExcludedFromLastMessage=!0,l=""),!0===t.messageControlInfo.excludedFromUnreadCount&&(e._isExcludedFromUnreadCount=!0)),o=e.conversationType,Mt(e.to)&&(o=S.CONV_TOPIC,n.get(10).onMessageSent({groupID:Gt(e.to),topicID:e.to,lastMessage:l})),a.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:o,subType:e.conversationSubType,lastMessage:l}]})),e._relayFlag||"TIMImageElem"!==e.type||Ot(e.payload.imageInfoArray),vn({message:e})}))})).catch((function(t){return n._onSendMessageFailed(e,t,r)}))}},{key:"_guardForGroup",value:function(e){if(e.conversationType!==S.CONV_GROUP)return Promise.resolve();var t=this.get(7);if(!t)return this._onNoModule();if(It({groupID:e.to})){var n=t.getLocalGroupProfile(e.to);if(n&&n.isSupportTopic)return In({code:wn.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return t.guardForAVChatRoom(e)}},{key:"_onSendMessageFailed",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]&&arguments[2],o="".concat(this._n,"._onSendMessageFailed"),i=(e.status=Dn,80001!==t.code&&80004!==t.code||(e.hasRiskContent=!0),this.get(11)),s=(i.deleteMessageRandom(e),10100<=t.code&&t.code<=10200||120001<=t.code&&t.code<=13e4);return n||s||!0===i.appendToMessageList(e)&&Oe.l("".concat(o," message stored, ID:").concat(e.ID)),this._addSendMessageFailCountOnUser(e,t),n=new eo("sendMessage"),s="head.seq:".concat(t.data.headSeq," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to),te&&("connection"in navigator&&(i=navigator.connection,s+=" downlink:".concat(i.downlink," effectiveType:").concat(i.effectiveType," rtt:").concat(i.rtt)),"memory"in window.performance&&(i=window.performance.memory,s+=" usedJSHeapSize:".concat(i.usedJSHeapSize," totalJSHeapSize:").concat(i.totalJSHeapSize," jsHeapSizeLimit:").concat(i.jsHeapSizeLimit))),n.setMessage(s).setError(t).end(),Oe.e("".concat(o," ").concat(s," error:"),t),In(new Gn({code:t&&t.code?t.code:wn.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([S.MSG_IMAGE,S.MSG_AUDIO,S.MSG_VIDEO,S.MSG_FILE].includes(e.type))return Kn;if(e.conversationType===S.CONV_C2C)return Bn;if(e.conversationType===S.CONV_GROUP){var t=this.get(7);if(t&&(t=t.getLocalGroupProfile(e.to)))return yt(e=t.type)?jn:Hn}}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n;(e=this._getSendMessageSpecifiedKey(e))&&((n=this.get(26)).addSuccessCount(e),n.addCost(e,jt(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){t=void 0===(t=t.code)?-1:t;var n,o=this.get(26);(e=this._getSendMessageSpecifiedKey(e))===Kn&&(n=!1,n=!!Rs.includes(t)||n)?o.addFailedCountOfUserSide(Yn):Os(t)&&e&&o.addFailedCountOfUserSide(e)}},{key:"resendMessage",value:function(e,t){return e.isResend=!0,e.status=En,this.sendMessageInstance(e,t)}},{key:"revokeMessage",value:function(e){var t=this,n=null;if(e.conversationType===S.CONV_C2C?n=this.get(6):e.conversationType===S.CONV_GROUP&&(n=this.get(7)),!n)return this._onNoModule();var o=new eo("revokeMessage"),i=(o.setMessage("type:".concat(e.type," from:").concat(e.from," to:").concat(e.to)),"".concat(this._n,".").concat("revokeMessage"));return n.revokeMessage(e).then((function(n){return Be(n=n.data.recallRetList)||0===n[0].retCode?(Oe.i("".concat(i," ok. ID:").concat(e.ID)),e.isRevoked=!0,o.end(),t.get(11).onMessageRevoked([e]),vn({message:e})):(n=new Gn({code:n[0].retCode,data:{message:e}}),o.setCode(n.code).setMoreMessage(n.message).end(),In(n))})).catch((function(t){o.setError(t).end();var n=new Gn({code:t&&t.code?t.code:wn.MSG_REVOKE_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}});return Oe.w("".concat(i," failed. error:"),t),In(n)}))}},{key:"deleteMessage",value:function(e){var t=this,n=null,o=e[0],i=o.conversationID,s="",a=[],r=[];if(o.conversationType===S.CONV_C2C)n=this.get(6),s=i.replace(S.CONV_C2C,""),e.forEach((function(e){e&&e.status===Sn&&e.conversationID===i&&(e._onlineOnlyFlag||a.push("".concat(e.sequence,"_").concat(e.random,"_").concat(e.time)),r.push(e))}));else if(o.conversationType===S.CONV_GROUP)n=this.get(7),s=i.replace(S.CONV_GROUP,""),e.forEach((function(e){e&&e.status===Sn&&e.conversationID===i&&(e._onlineOnlyFlag||a.push("".concat(e.sequence)),r.push(e))}));else if(o.conversationType===S.CONV_SYSTEM)return In({code:wn.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!n)return this._onNoModule();if(0===a.length)return this._onMessageDeleted(r);30<a.length&&(a=a.slice(0,30),r=r.slice(0,30));var c=new eo("deleteMessage"),u=(c.setMessage("to:".concat(s," count:").concat(a.length)),"".concat(this._n,".").concat("deleteMessage"));return n.deleteMessage({to:s,keyList:a}).then((function(e){return c.end(),Oe.i("".concat(u," ok")),t._onMessageDeleted(r)})).catch((function(e){return c.setError(e).end(),Oe.w("".concat(u," failed. error:"),e),In(e=new Gn({code:e&&e.code?e.code:wn.MSG_DELETE_FAIL,message:e&&e.message?e.message:void 0}))}))}},{key:"_onMessageDeleted",value:function(e){return this.get(11).onMessageDeleted(e),yn({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),o=e.sourceTextList,i=e.sourceLanguage,s=(e=e.targetLanguage,new eo("translateText"));return s.setMessage("sourceLanguage:".concat(i," targetLanguage:").concat(e)),this.req({P:xn.TRANSLATE_TEXT,data:{sourceTextList:o,source:i||"auto",target:e,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then((function(e){var o=(e=e.data).error,i=e.requestID;if(e=e.translatedTextList,0===o.code)return s.end(),Oe.i("".concat(n," ok. requestID:").concat(i)),vn({translatedTextList:e});throw t(t({},o),{},{requestID:i})})).catch((function(e){return s.setCode(e.code).setMoreMessage(e.requestID).end(),Oe.w("".concat(n," failed. error:"),e),In({code:wn.TRANSLATE_TEXT_FAIL})}))}},{key:"convertVoiceToText",value:function(e){var n=e.message,o=(e=e.language,n.payload.url);if(!(n.from===this.getMyUserID()&&"out"===n.flow&&(o=n.payload.remoteAudioUrl),n=/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/).test(o))return In({code:wn.UNSUPPORTED_VOICE_FORMAT});n=n.exec(o)[1]||"mp3";var i="16k_zh-PY",s=(e?"zh (cmn-Hans-CN)"===e?i="16k_zh":"en-US"===e?i="16k_en":"yue-Hant-HK"===e?i="16k_yue":"ja-JP"===e&&(i="16k_ja"):i="16k_zh-PY",e="serviceType:".concat(i," url:").concat(o),"".concat(this._n,".").concat("convertVoiceToText")),a=(Oe.i("".concat(s," ").concat(e)),new eo("convertVoiceToText"));return a.setMessage(e),this.req({P:xn.VOICE_TO_TEXT,data:{url:o,language:i,SDKAppID:this.getSDKAppID(),format:n}}).then((function(e){var n=(e=e.data).error,o=e.requestID;if(e=e.result,0===n.code)return a.end(),Oe.i("".concat(s," ok. requestID:").concat(o)),vn({result:e});throw t(t({},n),{},{requestID:o})})).catch((function(e){return a.setCode(e.code).setMoreMessage(e.requestID||"").end(),Oe.w("".concat(s," failed. error:"),e),In({code:wn.VOICE_TO_TEXT_FAIL})}))}},{key:"modifyRemoteMessage",value:function(e){var t=this;if(!1===this.get(29).filterMessage(e))return e.hasRiskContent=!0,In({code:wn.PROFANITY_FOUND,data:{message:e}});var n=null,o=e.conversationType,i=e.to;if(o===S.CONV_C2C)n=this.get(6);else if(o===S.CONV_GROUP){if(!(n=this.get(7)))return this._onNoModule();if(n.isMessageFromOrToAVChatroom(i))return In({code:wn.MSG_MODIFY_DISABLED_IN_AV,data:{message:e}})}var s=new eo("modifyMessage"),a=(s.setMessage("to:".concat(i)),"".concat(this._n,".modifyRemoteMessage"));return n.modifyRemoteMessage(e).then((function(n){return s.end(),Oe.i("".concat(a," ok")),vn({message:n=t._onModifyRemoteMessageResp(e,n.data)})})).catch((function(n){var o;return s.setCode(n.code).setMoreMessage(n.message).end(),Oe.w("".concat(a," failed. error:"),n),20027===n.code?(o=t._onModifyRemoteMessageResp(e,n.data),In({code:wn.MSG_MODIFY_CONFLICT,data:{message:o}})):In({code:n.code,message:n.message,data:{message:e}})}))}},{key:"_generateSearchdata",value:function(e){var t=e.conversationID,n=e.timePosition,o=e.timePeriod;return e=p(e,Fs),ut(t)||(Ct(t)&&(e.account=t.replace(S.CONV_C2C,"")),Tt(t)&&(e.groupID=t.replace(S.CONV_GROUP,""))),Ke(o)&&0<o&&(Ke(n)&&0<n?e.startTime=n-o:e.startTime=Ee()-o),e.startTime&&e.startTime<0&&(e.startTime=void 0),Ke(n)&&0<n&&(e.endTime=n),e}},{key:"searchCloudMessages",value:function(e){var t=this,n="searchCloudMessages",o="".concat(this._n,".").concat(n);if(!e)return In({code:wn.OPTIONS_IS_EMPTY,message:this.getErrMsg(wn.OPTIONS_IS_EMPTY,n)});var i=e.keywordList,s=e.keywordListMatchType,a=e.conversationID,r=e.cursor,c=We(e.senderUserIDList)&&0<e.senderUserIDList.length,u=We(e.messageTypeList)&&0<e.messageTypeList.length;if(!i&&!c&&!u)throw Oe.e("[".concat(n,'] Missing required params: "keywordList".')),new Error("Params validate failed.");var l=Date.now(),d=new eo(n),p="keywordList:".concat(i," keywordListMatchType:").concat(s," ")+"convID:".concat(a," cursor:").concat(r);return Oe.l("".concat(o," ").concat(p)),this.req({P:xn.MSG_CLOUD_SEARCH,data:this._generateSearchdata(e)}).then((function(n){var i=(s=n.data).code,s=s.message;if(0!==i)return s=t.getErrMsg(60020===i?"SearchCloudMessagesUnavailable":i)||s,i=new Gn({code:i,message:s}),d.setMessage(p).setError(i).end(),In(i);t.get(27).isSearchCloudMessagesEnabled(),i=(s=n.data).cursor,n=s.totalCount,s=s.searchResult;var a="totalCount:".concat(n," cost:").concat(jt(l));return vn({searchResultList:(Oe.l("".concat(o," ok. cursor:").concat(i," ").concat(a)),d.setMessage("".concat(p," ").concat(a)).end(),a=t._handleSearchResults(s,!e.conversationID)),cursor:i,totalCount:n})})).catch((function(e){return d.setMessage(p).setError(e).end(),In(e)}))}},{key:"_handleSearchResults",value:function(e,t){var n=this.get(11);return We(e)&&0!==e.length?e.map((function(e){var o=e.groupID,i=e.userID,s=e.messageCount,a=(e=void 0===(e=e.messageList)?[]:e,{conversationID:i=o?"".concat(S.CONV_GROUP).concat(o):"".concat(S.CONV_C2C).concat(i),messageCount:s,messageList:[]});return t&&1<s||0<(s=e.filter((function(e){return!!e}))).length&&(e=n.onRoamingMessage(s,i,!1),o&&e.reverse(),a.messageList=e,a.messageCount=e.length),a})):[]}},{key:"_onModifyRemoteMessageResp",value:function(e,t){Oe.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),t);var n=e.conversationType,o=e.from,i=e.to,s=e.random,a=e.sequence,r=(e=e.time,t.elements),c=t.messageVersion;return t=void 0===(t=t.cloudCustomData)?"":t,this.get(11).onMessageModified({conversationType:n,from:o,to:i,time:e,random:s,sequence:a,elements:r,cloudCustomData:t,messageVersion:c})}},{key:"_generateUUID",value:function(e){var t=this.get(12);return t="".concat(t.getSDKAppID(),"-").concat(t.getUserID(),"-").concat(ot()),(e=(e=e.name||e.value||e.url||e.tempFilePath)&&e.slice(e.lastIndexOf(".")+1))?"".concat(t,".").concat(e):t}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.get(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===S.CONV_GROUP){var t=this.get(7);if(t)return t.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),Xs),Vs=(r($s,Nn),Gs=g($s),s($s,[{key:"onMsgExtNotify",value:function(e){var t=this,n=(e=e.dataList).messageInfo,o=e.operateType,i=e.operateResultList,s=e.tinyID,a=(e=e.globalSequence,n.clientTime),r=(n=n.random,"".concat(s,"-").concat(a,"-").concat(n)),c=[],u=[],l=(Oe.l("".concat(this._n,".onMsgExtNotify messageID:").concat(r," operateType:").concat(o," globalSequence:").concat(e)),this._updateGlobalSeq(r,e),!1),d=!1;i.forEach((function(e){var n=void 0===(n=e.extensions)?[]:n,i=e.clearSequence;1===o?(l=!0,n.forEach((function(e){c.push({key:e.key,value:e.value})})),t._updateLocalExt(r,n)):2===o?(d=!0,n.forEach((function(e){u.push(e.key)})),t._updateLocalExt(r,n)):3===o&&(d=!0,t._hasLocalExt(r)&&t._getLocalExt(r).forEach((function(e,t){e.seq<=i&&!Be(e.value)&&u.push(t)})),t._clearLocalExt(r,i))})),l&&this.emitOEvt(E.MESSAGE_EXTENSIONS_UPDATED,{messageID:r,extensions:c}),d&&this.emitOEvt(E.MESSAGE_EXTENSIONS_DELETED,{messageID:r,keyList:u})}},{key:"setMessageExtensions",value:function(e,t){var n="setMessageExtensions";if(!this.canIUse(U.MSG_EXT))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.ID,s=e.conversationID,a=e.sequence,r=e.time,c=m(t),u=(20<t.length&&(c=t.slice(0,20),Oe.w("".concat(o,". the length of extensions cannot exceed 20."))),t="convID:".concat(s," messageID:").concat(i," sequence:").concat(a," time:").concat(r," count:").concat(c.length),new eo(n));return u.setMessage(t),Oe.l("".concat(o," ").concat(t)),this._modifyMsgExts(e,c).then((function(e){var t=e.resultList,n=e.successCount;return e=e.failureCount,n="successCount:".concat(n," failCount:").concat(e),u.setMoreMessage(n).end(),Oe.l("".concat(o," ok. ").concat(n)),vn({extensions:t})})).catch((function(e){return u.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"getMessageExtensions",value:function(e){var t=this,n="getMessageExtensions";if(!this.canIUse(U.MSG_EXT))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.ID,s=e.conversationID,a=e.sequence,r=e.time,c=(s="convID:".concat(s," messageID:").concat(i," sequence:").concat(a," time:").concat(r),new eo(n)),u=(c.setMessage(s),void Oe.l("".concat(o," ").concat(s)));return this.getMsgExtsMap.has(i)&&(u=this._getGlobalSeq(i)),this._getMsgExts(e,u).then((function(e){return c.end(),Oe.l("".concat(o," ok. extCount:").concat(e.length)),ut(u)&&0<e.length&&t.getMsgExtsMap.set(i,1),vn({extensions:e})})).catch((function(e){return c.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"deleteMessageExtensions",value:function(e,t){var n="deleteMessageExtensions";if(!this.canIUse(U.MSG_EXT))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=[],s=3,a=(Be(t)||(s=2,t.forEach((function(e){i.push({key:e,value:"",seq:0})}))),t=e.ID,e.conversationID),r=e.sequence,c=e.time,u=(a="convID:".concat(a," messageID:").concat(t," sequence:").concat(r," time:").concat(c," operateType:").concat(s),new eo(n));return u.setMessage(a),Oe.l("".concat(o," ").concat(a)),this._modifyMsgExts(e,i,s).then((function(e){var t=e.resultList,n=e.successCount,i=(e=e.failureCount,"");return 2===s&&(i="success count:".concat(n," fail count:").concat(e)),u.setMoreMessage("".concat(i)).end(),Oe.l("".concat(o," ok. ").concat(i)),vn({extensions:t})})).catch((function(e){return u.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"_modifyMsgExts",value:function(e,t){var n=this,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:1,i=Mt(e.to)?S.CONV_TOPIC:e.conversationType,s=void 0,a=(3!==o&&(s=this._getReqExts(e,t)),null);switch(i){case S.CONV_C2C:a=this.get(6);break;case S.CONV_GROUP:a=this.get(7);break;case S.CONV_TOPIC:a=this.get(10);break;default:return In({code:wn.NO_MODULE})}return a.modifyMsgExts(e,s,o).then((function(t){var o=(t=t.data).extensions,i=(t=t.seq,[]),s=0,a=0,r=[];return(o=Be(o)?[]:o).forEach((function(e){var t=e.errorCode,n=(e=e.extension).key,o=e.value;e=e.seq,i.push({code:t,key:n,value:o}),0===t?s++:a++,r.push({key:n,value:o,seq:e})})),n._updateGlobalSeq(e.ID,t),0<r.length&&(n._updateLocalExt(e.ID,r),r=null),{resultList:i,successCount:s,failureCount:a}})).catch((function(e){return In(e)}))}},{key:"_getReqExts",value:function(e,t){var n,o=[];return this._hasLocalExt(e.ID)?(n=this._getLocalExt(e.ID),t.forEach((function(e){var t=e.key,i=(e=e.value,0);n.has(t)&&(i=n.get(t).seq),o.push({key:t,value:e,seq:i})}))):t.forEach((function(e){var t=e.key;e=e.value,o.push({key:t,value:e,seq:0})})),o}},{key:"_getMsgExts",value:function(e,t){var n=this,o="".concat(this._n,"._getMsgExts"),i=e.ID,s=null;switch(Mt(e.to)?S.CONV_TOPIC:e.conversationType){case S.CONV_C2C:s=this.get(6);break;case S.CONV_GROUP:s=this.get(7);break;case S.CONV_TOPIC:s=this.get(10);break;default:return In({code:wn.NO_MODULE})}return s.getMessageExtensions(e,t).then((function(t){var s=(t=t.data).extensions,a=t.completeFlag,r=t.globalSequence;return t=t.clearSequence,s=Be(s)?[]:s,Oe.l("".concat(o," ok. completeFlag:").concat(a," globalSequence:").concat(r," clearSequence:").concat(t," count:").concat(s.length)),n._updateLocalExt(i,s),n._clearLocalExt(i,t),n._updateGlobalSeq(i,r),1!==a?(t=s.slice(-1)[0].seq+1,n._getMsgExts(e,t)):n._getLocalExtList(i)})).catch((function(e){return In(e)}))}},{key:"_hasLocalExt",value:function(e){return this.msgExtMap.has(e)}},{key:"_getLocalExt",value:function(e){return this.msgExtMap.get(e)}},{key:"_updateLocalExt",value:function(e,t){this._hasLocalExt(e)||this.msgExtMap.set(e,new Map);var n=this._getLocalExt(e);t.forEach((function(e){var t=e.key,o=e.value;e=e.seq,n.set(t,{value:void 0===o?"":o,seq:e})}))}},{key:"_clearLocalExt",value:function(e,t){var n;t<=0||!this._hasLocalExt(e)||(n=this._getLocalExt(e)).forEach((function(e,o){e.seq<=t&&n.delete(o)}))}},{key:"_getLocalExtList",value:function(e){var t=[];return this._hasLocalExt(e)&&this._getLocalExt(e).forEach((function(e,n){Be(e=e.value)||t.push({key:n,value:e})})),t}},{key:"_getGlobalSeq",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSeq",value:function(e,t){this.globalSeqMap.set(e,t)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this.msgExtMap.clear(),this.globalSeqMap.clear(),this.getMsgExtsMap.clear()}}]),$s),qs=(r(Js,Nn),Us=g(Js),s(Js,[{key:"onReactionNotifyList",value:function(e){var n=this;(void 0===(e=(e||{}).dataList)?[]:e).forEach((function(e){var o=e.C2CMessageInfo,i=void 0===(i=e.groupMessageInfo)?{}:i,s=(e=void 0===(e=e.reactionList)?[]:e,i=(o=t(t({},void 0===o?{}:o),i)).tinyID,o.clientTime),a=(o=o.random,i="".concat(i,"-").concat(s,"-").concat(o),[]);e.forEach((function(e){ut(e.userIDList)&&(e.userIDList=[],e.count=0),a.push.apply(a,m(e.userIDList))})),Oe.l("".concat(n._n,".onReactionNotifyList messageID:").concat(i," reactionList:").concat(e.length)),n._handleReactionSummary([{messageID:i,reactionList:e}],a).then((function(e){n.emitOEvt(E.MESSAGE_REACTIONS_UPDATED,t({},e[0]))}))}))}},{key:"onReactionNotify",value:function(e){var n=(e=e.dataList||{}).C2CMessageInfo,o=void 0===(o=e.groupMessageInfo)?{}:o,i=e.reactionID,s=(e=e.operateType,o=(n=t(t({},void 0===n?{}:n),o)).tinyID,n.clientTime);n=n.random,o="".concat(o,"-").concat(s,"-").concat(n),Oe.l("".concat(this._n,".onReactionNotify messageID:").concat(o," reactionID:").concat(i," operateType:").concat(e)),1===e?this._addReactedByMyselfMap(o,i):this._removeReactedByMyselfMap(o,i),s="".concat(o,"-").concat(i),this._reactionInfoMap.has(s)&&((n=this._reactionInfoMap.get(s)).reactedByMyself=1===e,this.emitOEvt(E.MESSAGE_REACTIONS_UPDATED,{messageID:o,reactionList:[n]}))}},{key:"addMessageReaction",value:function(e,t){var n=this,o="addMessageReaction";if(!this.canIUse(U.MSG_REACTION))return this.noUse(o);var i="".concat(this._n,".").concat(o),s=e.ID,a=e.conversationID,r=(a="convID:".concat(a," messageID:").concat(s," reactionID:").concat(t),new eo(o));return r.setMessage(a),Oe.l("".concat(i," ").concat(a)),s=this._createReactionOperationPack(e,t,1),this._addReactedByMyselfMap(e.ID,t),this.req(s).then((function(){return r.end(),Oe.l("".concat(i," ok.")),vn()})).catch((function(o){return n._removeReactedByMyselfMap(e.ID,t),r.setError(o).end(),Oe.e("".concat(i," failed. error:"),o),In(o)}))}},{key:"removeMessageReaction",value:function(e,t){var n="removeMessageReaction";if(!this.canIUse(U.MSG_REACTION))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.ID,s=e.conversationID,a=(s="convID:".concat(s," messageID:").concat(i," reactionID:").concat(t),new eo(n));return a.setMessage(s),Oe.l("".concat(o," ").concat(s)),i=this._createReactionOperationPack(e,t,2),this._removeReactedByMyselfMap(e.ID,t),this.req(i).then((function(){return a.end(),Oe.l("".concat(o," ok.")),vn()})).catch((function(e){return a.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"getMessageReactions",value:function(e){var n=this,o="getMessageReactions";if(!this.canIUse(U.MSG_REACTION))return this.noUse(o);var i="".concat(this._n,".").concat(o),s=e.messageList,a=e.maxUserCountPerReaction,r=s[0].conversationID,c=(r="convID:".concat(r," maxUserCountPerReaction:").concat(a," msgCount:").concat(s.length),new eo(o)),u=(c.setMessage(r),Oe.l("".concat(i," ").concat(r)),new Map);return a=this._createReactionSummaryPack(t(t({},e),{},{messageIDMap:u})),this.req(a).then((function(e){e=e.data.resultList;var t=[],o=[];return(void 0===e?[]:e).forEach((function(e){var n=void 0===(n=e.messageKey)?void 0:n,i=void 0===(i=e.messageSequence)?void 0:i;e=void 0===(e=e.reactionList)?[]:e,i=ut(n)?u.get(i):u.get(n),t.push({messageID:i,reactionList:e}),e.forEach((function(e){o.push.apply(o,m(e.userIDList))}))})),n._handleReactionSummary(t,o)})).then((function(e){return c.end(),Oe.l("".concat(i," ok.")),u.clear(),vn({resultList:e})})).catch((function(e){return c.setError(e).end(),Oe.e("".concat(i," failed. error:"),e),In(e)}))}},{key:"getAllUserListOfMessageReaction",value:function(e){var t=this,n="getAllUserListOfMessageReaction";if(!this.canIUse(U.MSG_REACTION))return this.noUse(n);var o="".concat(this._n,".").concat(n),i=e.message,s=e.reactionID,a=e.nextSeq,r=e.count,c=i.ID,u=(i=i.conversationID,i="convID:".concat(i," messageID:").concat(c," reactionID:").concat(s," nextSeq:").concat(a," count:").concat(r),new eo(n)),l=(u.setMessage(i),Oe.l("".concat(o," ").concat(i)),{userList:[],nextSeq:0,isCompleted:!1});return c=this._createReactionUserListPack(e),this.req(c).then((function(e){var n=void 0===(n=(e=e.data).userIDList)?[]:n;return e=void 0===(e=e.nextSeq)?0:e,l.nextSeq=e,l.isCompleted=0===e,t.get(4).getUserNickAndAvatar(n)})).then((function(e){return l.userList=e,u.end(),Oe.l("".concat(o," ok.")),vn(l)})).catch((function(e){return u.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"_createReactionOperationPack",value:function(e,t,n){var o,i,s=void 0;return t={reactionID:t,userIDList:[this.getMyUserID()]},e.conversationType===S.CONV_C2C&&(o=this.get(6),s=1===n?xn.ADD_C2C_MSG_REACTION:xn.RM_C2C_MSG_REACTION,t.from=e.from,t.to=e.to,t.messageKey=o.getMessageKey(e)),e.conversationType===S.CONV_GROUP&&(o=void 0,i=e.to,Mt(e.to)&&(i=Gt(o=e.to)),s=1===n?xn.ADD_GRP_MSG_REACTION:xn.RM_GRP_MSG_REACTION,t.groupID=i,t.topicID=o,t.messageSequence=e.sequence),{P:s,data:t}}},{key:"_createReactionSummaryPack",value:function(e){var t,n,o,i=e.messageList,s=void 0===(s=e.maxUserCountPerReaction)?10:s,a=e.messageIDMap,r=void 0,c=void 0;return(e=i[0]).conversationType===S.CONV_C2C&&(t=this.get(6),n=i.map((function(e){var n=t.getMessageKey(e);return a.set(n,e.ID),n})),r=xn.GET_C2C_MSG_REACTIONS,c={from:e.from,to:e.to,messageKeyList:n,count:s}),e.conversationType===S.CONV_GROUP&&(n=void 0,o=e.to,Mt(e.to)&&(o=Gt(n=e.to)),e=i.map((function(e){return a.set(e.sequence,e.ID),e.sequence})),r=xn.GET_GRP_MSG_REACTIONS,c={groupID:o,topicID:n,messageSequenceList:e,count:s}),{P:r,data:c}}},{key:"_createReactionUserListPack",value:function(e){var t=e.message,n=e.reactionID,o=e.nextSeq,i=void 0;return n={reactionID:n,nextSeq:void 0===o?0:o,count:100<(e=void 0===(e=e.count)?100:e)?100:e},t.conversationType===S.CONV_C2C&&(o=this.get(6),i=xn.GET_C2C_MSG_REACTION_USER_LIST,n.from=t.from,n.to=t.to,n.messageKey=o.getMessageKey(t)),t.conversationType===S.CONV_GROUP&&(e=void 0,o=t.to,Mt(t.to)&&(o=Gt(e=t.to)),i=xn.GET_GRP_MSG_REACTION_USER_LIST,n.groupID=o,n.topicID=e,n.messageSequence=t.sequence),{P:i,data:n}}},{key:"_handleReactionSummary",value:function(e,t){var n=this;return this.get(4).getUserNickAndAvatar(t).then((function(t){var o=[];return e.forEach((function(e){var i=[];e.reactionList.forEach((function(o){var s=o.reactionID,a=o.count,r=o.userIDList,c=(o=void 0===(o=o.reactedByMyself)?void 0:o,[]);r.forEach((function(e){t.forEach((function(t){e===t.userID&&c.push(t)}))})),r={reactionID:s,totalUserCount:a,partialUserList:c,reactedByMyself:n._computeReactedByMyself({reactedByMyself:o,messageID:e.messageID,reactionID:s})},i.push(r),ut(o)&&!n._reactedByMyselfMap.has(e.messageID)&&(a="".concat(e.messageID,"-").concat(s),n._reactionInfoMap.set(a,r))})),o.push({messageID:e.messageID,reactionList:i})})),o}))}},{key:"_addReactedByMyselfMap",value:function(e,t){this._reactedByMyselfMap.has(e)||this._reactedByMyselfMap.set(e,[]),-1===(e=this._reactedByMyselfMap.get(e)).indexOf(t)&&e.push(t)}},{key:"_removeReactedByMyselfMap",value:function(e,t){!this._reactedByMyselfMap.has(e)||-1<(t=(e=this._reactedByMyselfMap.get(e)).indexOf(t))&&e.splice(t,1)}},{key:"_computeReactedByMyself",value:function(e){var t=e.reactedByMyself,n=e.messageID;return e=e.reactionID,ut(t)?!!this._reactedByMyselfMap.has(n)&&this._reactedByMyselfMap.get(n).includes(e):1===t}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),Js),Bs=(r(Ws,Nn),bs=g(Ws),s(Ws,[{key:"sendMessage",value:function(e){var t=this,n=this._createMsg(e);if(null===n)return In({code:wn.MSG_SEND_FAIL});this._addSendMessageTotalCount(n);var o=Date.now();return this.get(11).setMessageRandom(n),this._sendComboMessage(n,e).then((function(e){var i=(e=e.data).time,s=e.sequence;return Ke(e=e.readReceiptCode)&&0!==e&&(new eo("sendMessageWithReceipt").setMessage("from:".concat(n.from," to:").concat(n.to," sequence:").concat(s," readReceiptCode:").concat(e)).end(),Oe.w("".concat(t._n,".sendMessage readReceiptCode:").concat(e," message:").concat(t.getErrMsg(e)))),t._addSendMessageSuccessCount(n,o),e=t.get(11),n.status=Sn,n.time=i,n.conversationType===S.CONV_GROUP&&(n.sequence=s),e.appendToMessageList(n),i=n,!0===n._isExcludedFromLastMessage&&(i=""),e.onMessageSent({conversationOptionsList:[{conversationID:n.conversationID,unreadCount:0,type:n.conversationType,subType:n.conversationSubType,lastMessage:i}]}),vn({message:n})})).catch((function(e){return t._onSendMessageFailed(n,e)}))}},{key:"_sendComboMessage",value:function(e,t){var n=this._m.get(20),o="";return e.conversationType===S.CONV_C2C&&(o="".concat(b.NAME.OPEN_IM,".").concat(xn.SEND_C2C_MSG)),e.conversationType===S.CONV_GROUP&&(o="".concat(b.NAME.GRP,".").concat(xn.SEND_GRP_MSG)),n.sendComboMessage({servcmd:o,data:t})}},{key:"_createMsg",value:function(e){var t="".concat(this._n,"._createMsg"),n=null;try{var o,i=this.getMyUserID(),s={};s.senderTinyID=this.getMyTinyID(),s.currentUser=i,s.from=e.From_Account||i,e.GroupId?(s.conversationID="".concat(S.CONV_GROUP).concat(e.GroupId),s.conversationType=S.CONV_GROUP,s.to=e.GroupId):e.To_Account&&(s.conversationID="".concat(S.CONV_C2C).concat(e.To_Account),s.conversationType=S.CONV_C2C,s.to=e.To_Account),s.time=e.MsgTimeStamp||0,s.random=e.Random||e.MsgRandom||0,s.priority=e.MsgPriority,ct(e.CloudCustomData)&&0<e.CloudCustomData.length&&(s.cloudCustomData=e.CloudCustomData),We(e.SendMsgControl)&&(s.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(s.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(s.messageControlInfo.excludedFromLastMessage=1)),s.conversationType===S.CONV_GROUP&&We(e.To_Account)&&0<e.To_Account.length&&(o=e.To_Account,50<e.To_Account.length&&(o=e.To_Account.slice(0,50),Oe.w("".concat(t," To_Account must be less than or equal to 50."))),s.receiverList=m(o),e.To_Account=m(o)),1!==e.IsNeedReadReceipt&&1!==e.NeedReadReceipt||(s.needReadReceipt=!0),1===e.SupportMessageExtension&&(s.isSupportExtension=!0),(n=new So(s)).status=En,e.MsgClientTime=n.clientTime,n.conversationType===S.CONV_C2C&&(e.MsgSeq=n.sequence);for(var a,r=e.MsgBody.length,c=0;c<r;c++)"TIMTextElem"===(a=e.MsgBody[c]).MsgType?n.setTextElement(a.MsgContent.Text):"TIMCustomElem"===a.MsgType?n.setCustomElement({data:a.MsgContent.Data||"",description:a.MsgContent.Desc||"",extension:a.MsgContent.Ext||""}):"TIMFaceElem"===a.MsgType&&n.setFaceElement({index:a.MsgContent.Index,data:a.MsgContent.Data});var u=n.getElements();n.payload=u[0].content,n.type=u[0].type}catch(l){n=null,Oe.e("".concat(t," failed. error:"),l)}return n}},{key:"_onSendMessageFailed",value:function(e,t){e.status=Dn,this.get(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,t);var n=new eo("sendMessage"),o="head.seq:".concat(t.data.headSeq,"  type:").concat(e.type," from:").concat(e.from," to:").concat(e.to);return n.setMessage(o).setError(t).end(),Oe.e("".concat(this._n,"._onSendMessageFailed ").concat(o," error:"),t),In(new Gn({code:t&&t.code?t.code:wn.MSG_SEND_FAIL,message:t&&t.message?t.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){return e.conversationType===S.CONV_C2C?Bn:e.conversationType===S.CONV_GROUP&&(e=this.get(7).getLocalGroupProfile(e.to))?yt(e=e.type)?jn:Hn:void 0}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,t){var n;(e=this._getSendMessageSpecifiedKey(e))&&((n=this.get(26)).addSuccessCount(e),n.addCost(e,jt(t,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,t){t=void 0===(t=t.code)?-1:t;var n=this.get(26);e=this._getSendMessageSpecifiedKey(e),Os(t)&&e&&n.addFailedCountOfUserSide(e)}}]),Ws),Hs=(r(zs,Nn),Ps=g(zs),s(zs,[{key:"registerPlugin",value:function(e){var t=this,n="0";Object.keys(e).forEach((function(o){t.plugins[o]=e[o],"tim-upload-plugin"===o&&"function"==typeof e[o].getVersion&&(n=e[o].getVersion())})),new eo("registerPlugin").setMessage("".concat(Object.keys(e))).setMoreMessage("version:".concat(n)).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),zs),js=(r(Ys,Nn),Ns=g(Ys),s(Ys,[{key:"_init",value:function(){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,o=e.cookie,i=e.syncFlag,s=e.isOnlineSync,a="".concat(this._n,"._startSync"),r=(Oe.l("".concat(a," options:"),e),new eo("syncUnread"));r.setMessage(JSON.stringify(e)),this.req({P:xn.SYNC_UNREAD_MSG,data:{cookie:o,syncFlag:i,isOnlineSync:s}}).then((function(e){var o=(i=e.data).cookie,i=i.syncFlag,s="$cookie:".concat(o," syncFlag:").concat(i);Oe.l("".concat(a," ok. ").concat(s)),n._cookie=o,r.setMoreMessage(s).end(),Be(o)||(0===i||1===i?(n._dispatch(t(t({},e.data),{},{isSyncingEnded:!1})),n._startSync({cookie:o,syncFlag:i,isOnlineSync:0})):2===i&&n._dispatch(t(t({},e.data),{},{isSyncingEnded:!0})))})).catch((function(e){r.setError(e).end(),Oe.e("".concat(a," failed. error:"),e)}))}},{key:"_dispatch",value:function(e){e.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.get(6).onNewMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList,isSyncingEnded:e.isSyncingEnded})}},{key:"syncOnNeed",value:function(){Oe.l("".concat(this._n,".syncOnNeed cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"syncOnReconnected",value:function(){Oe.l("".concat(this._n,".syncOnReconnected cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),Ys),Ks={req:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList",cmConfigID:"CustomModerationConfigID"},res:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself",Level:"messageRemindType",PeerReadTime:"timestamp",NoUnreadSeqList:"excludedUnreadSequenceList",NewMsg:"topicLatestMessage"},ignoreKeyWord:["C2C","ID","USP"]};function Ys(e){return o(this,Ys),(e=Ns.call(this,e))._n="SyncUnreadMsgModule",e._cookie="",e._onlineSyncFlag=!1,e.getIEmitInst().on(qo.A2KEY_AND_TINYID_UPDATED,e._init,h(e)),e}function zs(e){return o(this,zs),(e=Ps.call(this,e))._n="PluginModule",e.plugins={},e}function Ws(e){return o(this,Ws),(e=bs.call(this,e))._n="ComboMsgModule",e}function Js(e){return o(this,Js),(e=Us.call(this,e))._n="MsgReactionModule",e._reactedByMyselfMap=new Map,e._reactionInfoMap=new Map,e}function $s(e){return o(this,$s),(e=Gs.call(this,e))._n="MsgExtModule",e.msgExtMap=new Map,e.globalSeqMap=new Map,e.getMsgExtsMap=new Map,e}function Xs(e){return o(this,Xs),(e=ws.call(this,e))._n="MessageModule",e._messageOptionsMap=new Map,e._mergerMessageHandler=new Ds(h(e)),e}function Zs(e,t){if("string"!=typeof e&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");return t=Object.assign({pascalCase:!1},t),0===(e=Array.isArray(e)?e.map((function(e){return e.trim()})).filter((function(e){return e.length})).join("-"):e.trim()).length?"":1===e.length?t.pascalCase?e.toUpperCase():e.toLowerCase():(e=e=(e=e!==e.toLowerCase()?Qs(e):e).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,(function(e,t){return t.toUpperCase()})).replace(/\d+(\w|$)/g,(function(e){return e.toUpperCase()})),t.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e)}var Qs=function(e){for(var t=!1,n=!1,o=!1,i=0;i<e.length;i++){var s=e[i];t&&/[a-zA-Z]/.test(s)&&s.toUpperCase()===s?(e=e.slice(0,i)+"-"+e.slice(i),o=n,n=!(t=!1),i++):n&&o&&/[a-zA-Z]/.test(s)&&s.toLowerCase()===s?(e=e.slice(0,i-1)+"-"+e.slice(i-1),o=n,t=!(n=!1)):(t=s.toLowerCase()===s&&s.toUpperCase()!==s,o=n,n=s.toUpperCase()===s&&s.toLowerCase()!==s)}return e};for(var ea,ta=String.fromCharCode,na=function(e){var t=0|e.charCodeAt(0);if(55296<=t)if(t<56320)if(56320<=(e=0|e.charCodeAt(1))&&e<=57343){if(65535<(t=(t<<10)+e-56613888|0))return ta(240|t>>>18,128|t>>>12&63,128|t>>>6&63,128|63&t)}else t=65533;else t<=57343&&(t=65533);return t<=2047?ta(192|t>>>6,128|63&t):ta(224|t>>>12,128|t>>>6&63,128|63&t)},oa=function(e){for(var t=void 0===e?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,na),n=0|t.length,o=new Uint8Array(n),i=0;i<n;i=i+1|0)o[i]=0|t.charCodeAt(i);return o},ia=(s(ka,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(e){this._handler.onOpen({id:this._id,res:JSON.stringify(e)})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e:e})}},{key:"_onMessage",value:function(e){e=this._canIUseBinaryFrame?this._isAppCompressedData(e.data)?this._handler.inflate(e.data):function(e){for(var t=new Uint8Array(e),n="",o=0,i=t.length;o<i;){var s=t[o],a=0,r=0;if(s<=127?(a=0,r=255&s):s<=223?(a=1,r=31&s):s<=239?(a=2,r=15&s):s<=244&&(a=3,r=7&s),0<i-o-a)for(var c=0;c<a;)r=r<<6|63&(s=t[o+c+1]),c+=1;else r=65533,a=i-o;n+=String.fromCodePoint(r),o+=a+1}return n}(e.data):e.data,this._handler.onMessage({data:e})}},{key:"_isAppCompressedData",value:function(e){return 67===(e=new Uint8Array(e))[0]&&79===e[1]&&77===e[2]&&80===e[3]}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e:e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),z)return ne.offSocketClose(),ne.offSocketMessage(),ne.offSocketOpen(),ne.offSocketError(),void ne.closeSocket();this._socket&&(Z?(this._socket.onClose((function(){})),this._socket.onOpen((function(){})),this._socket.onMessage((function(){})),this._socket.onError((function(){}))):(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),Y?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?oa(e.data).buffer:e.data}):z?ne.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket&&(Z?this._socket.send({data:this._canIUseBinaryFrame?oa(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket.send(this._canIUseBinaryFrame?oa(e.data):e.data))}}]),ka),sa=["keyMap"],aa=["keyMap"],ra="connected",ca="connecting",ua="disconnected",la=(s(Da,[{key:"_setWebsocketHost",value:function(){var e=this._chM.get(12);this._currentSite=P,this._chM.isOversea()&&(this._currentSite="OVERSEA"),e.isSingaporeSite()?this._currentSite="SINGAPORE":e.isKoreaSite()?this._currentSite="KOREA":e.isGermanySite()?this._currentSite="GERMANY":e.isIndiaSite()?this._currentSite="IND":e.isJapanSite()?this._currentSite="JPN":e.isUSASite()?this._currentSite="USA":e.isIndonesiaSite()&&(this._currentSite="INDONESIA"),b.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){var e=this._chM.get(12).getSDKAppID()+"",t=(ut(b.HOST.CURRENT.BACKUP)?this._url=b.HOST.CURRENT.DEFAULT:""===this._url?this._url=b.HOST.CURRENT.DEFAULT0.replace("*",e):-1<this._url.indexOf(e)?this._url=b.HOST.CURRENT.DEFAULT:this._url===b.HOST.CURRENT.DEFAULT?this._url=b.HOST.CURRENT.BACKUP:this._url===b.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?b.HOST.CURRENT.ANYCAST:b.HOST.CURRENT.DEFAULT:this._url===b.HOST.CURRENT.ANYCAST&&(b.HOST.CURRENT.ANYCAST="",this._url=b.HOST.CURRENT.DEFAULT),e=this._chM.get(12)).getProxyServer();Be(t)||(this._url=t),e.isTestEnv()&&(this._url=L.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return te&&b.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&(this._checkPromiseMap(),this._checkNativeAppWS())}},{key:"_checkPromiseMap",value:function(){var e=this;0!==this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.reject,i=t.timestamp,s=(t=t.headSeq,15e3);-1!==n.indexOf(xn.LOGIN)?s=9e4:-1!==n.indexOf(xn.PING)&&(s=3e3),Date.now()-i>=s&&(Oe.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(n)),e._promiseMap.delete(n),o(new Gn({code:wn.NETWORK_TIMEOUT,data:{headSeq:t}})),e._chM.onRequestTimeout())}))}},{key:"_checkNativeAppWS",value:function(){J&&!this.isConnected()&&this._reConnect()}},{key:"onOpen",value:function(e){var t,n;this._readyState!==ua&&(this._onOpenTs=Date.now(),n=e.id,e=e.res,this._socketID=n,t=jt(this._startTs,!1),n="socketID:".concat(n," res:").concat(e),Oe.l("".concat(this._n,"._onOpen cost:").concat(t," ms. ").concat(n)),new eo("wsOnOpen").setMessage(t).setCostTime(t).setMoreMessage(n).end(),this._readyState=ra,this._reConnectCount=0,this._resend(),!0===this._reConnectFlag&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen())}},{key:"onClose",value:function(e){var t=new eo("wsOnClose"),n=e.id,o=(e=e.e,"sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID," code:").concat(e.code," reason:").concat(e.reason)),i=0;0!==this._onOpenTs&&(i=Date.now()-this._onOpenTs),t.setMessage(i).setCostTime(i).setMoreMessage(o).setCode(e.code).end(!0),Oe.l("".concat(this._n,"._onClose ").concat(o," onlineTime:").concat(i)),n===this._socketID&&(this._readyState=ua,i<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(e){var t=e.id,n=(e=e.e,"sourceSocketID:".concat(t," currentSocketID:").concat(this._socketID));new eo("wsOnError").setMessage(e.errMsg||JSON.stringify(e,["message","code"])).setMoreMessage(n).setLevel("error").end(!0),Oe.w("".concat(this._n,"._onError"),e,n),t===this._socketID&&(this._readyState=ua,this._chM.onError())}},{key:"onMessage",value:function(e){var t;try{t=JSON.parse(e.data)}catch(r){new eo("jsonParseError").setMessage(e.data).end()}if(t&&t.head){e=this._getRequestIDFromHead(t.head);var n,o,i,s,a=t.body;if(this._chM.get(30).isTRTCCommand(e)||(s=Nt(t.head),a=function e(t,n){return We(t)?t.map((function(t){return Ye(t)?e(t,n):t})):Ye(t)?(o=t,i=function(e,t){return ut(n[t])?Zs(t):n[t]},s={},Object.keys(o).forEach((function(e){s[i(o[e],e)]=o[e]})),St(s,(function(t){return We(t)||Ye(t)?e(t,n):t}))):void 0;var o,i,s}(t.body,this._getResKeyMap(s))),Oe.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(a)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e))return n=(s=this._promiseMap.get(e)).resolve,o=s.reject,i=s.timestamp,s=s.headSeq,this._promiseMap.delete(e),this._calcRTT(i),void(a.errorCode&&0!==a.errorCode?(this._chM.onErrorCodeNotZero(a),o(new Gn({code:a.errorCode,message:a.errorInfo||"",data:e.includes(xn.MODIFY_C2C_MSG)||e.includes(xn.MODIFY_GRP_MSG)?{elements:a.elements,messageVersion:a.messageVersion,cloudCustomData:a.cloudCustomData,headSeq:s}:{headSeq:s}}))):n(vn(a)));this._chM.onMessage({head:t.head,body:a})}}},{key:"_calcRTT",value:function(e){e=Date.now()-e,this._chM.get(26).addRTT(e)}},{key:"_connect",value:function(){this._readyState!==ca&&this._readyState!==ra&&(this._startTs=Date.now(),this._onOpenTs=0,this._readyState=ca,this._socket=new ia(this),this._socketID=this._socket.getID(),Oe.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new eo("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end())}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=Rt(),t=((z||B&&"windows"===e||J)&&(this._canIUseBinaryFrame=!1),-1),n=("ios"===e?t=ae||-1:"android"===e&&(t=ce||-1),this._chM.get(12)),o=this._chM.getPlatform(),i=n.getSDKAppID();return n=n.getInstanceID(),i="sdkappid=".concat(i,"&instanceid=").concat(n,"&random=").concat(this._getRandom(),"&platform=").concat(o,"&host=").concat(e)+"&version=".concat(t,"&sdkversion=").concat("3.4.8"),H&&(i+="&isminigame=1"),this._chM.canIUseInflate()&&(i+="&compress=gzip"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(i)}},{key:"_closeConnection",value:function(e){Oe.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=ua)}},{key:"_resend",value:function(){var e=this;if(Oe.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach((function(t,n){var o=t.uplinkData,i=t.resolve;t=t.reject,-1!==n.indexOf(xn.AV_POLLING)?e._promiseMap.delete(n):(e._promiseMap.set(n,{resolve:i,reject:t,timestamp:Date.now(),uplinkData:o}),e._execute(n,o))})),0<this._simpleRequestMap.size){var t,n=T(this._simpleRequestMap);try{for(n.s();!(t=n.n()).done;){var o=f(t.value,2),i=o[0],s=o[1];this._execute(i,s)}}catch(a){n.e(a)}finally{n.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var t=this,n=(e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.head.cs=this._calcCheckSum(e.head.servcmd,e.body),e.keyMap,p(e,sa)),o=this._getRequestIDFromHead(e.head),i=JSON.stringify(n);return new Promise((function(s,a){t._promiseMap.set(o,{resolve:s,reject:a,timestamp:Date.now(),uplinkData:i,headSeq:e.head.seq}),Oe.d("".concat(t._n,".send uplinkData:").concat(JSON.stringify(n)," requestID:").concat(o," readyState:").concat(t._readyState)),t._readyState!==ra?t._reConnect():(t._execute(o,i),t._chM.get(26).addRequestCount())}))}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var t=p(e,aa);e=this._getRequestIDFromHead(e.head),t=JSON.stringify(t),this._readyState!==ra?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(e,t):Oe.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(e,t)}},{key:"_execute",value:function(e,t){this._socket.send({data:t,fail:Z?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){Oe.l("".concat(this._n,"._onSendFail requestID:").concat(e)),this._chM.onSendFail()}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,2415919103===this._startSequence&&(this._startSequence=nt()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResKeyMap",value:function(e){return e=this._chM.getKeyMap(e),t(t({},Ks.res),e.res)}},{key:"_reConnect",value:function(){this._readyState!==ra&&this._readyState!==ca&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e="".concat(this._n,".forcedReconnect");Oe.l("".concat(e," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(Oe.w("".concat(e," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=J?Date.now()+5e3:Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===ra}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"getSocketID",value:function(){return this._socketID}},{key:"inflate",value:function(e){if(this._chM.canIUseInflate())return this._chM.get(37).inflate(e)}},{key:"setIsWorkerEnabled",value:function(e){Oe.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&ge}},{key:"_getRandom",value:function(){return 0===this._random&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"_calcCheckSum",value:function(e,t){if(-1!==e.indexOf(xn.PING)||-1!==e.indexOf(xn.LOGIN)||-1!==e.indexOf(xn.LOGOUT)||-1!==e.indexOf(xn.AV_POLLING)||-1!==e.indexOf(xn.AV_NOAUTH_POLLING))return 0;for(var n=oa(JSON.stringify(t)),o=4294967295,i=0,s=n.length;i<s;i++){o^=n[i];for(var a=0;a<8;a++)1&~o?o>>>=1:o=o>>>1^3988292384}return(4294967295^o)>>>0}},{key:"close",value:function(){Oe.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=nt(),this._readyState=ua,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),Da),da=function(e,t,n){return new Promise((function(o,i){var s,a,r="application/x-www-form-urlencoded;charset=UTF-8";Z?ne.request({url:t,data:n,method:e,timeout:3e3,header:{"content-type":r},success:function(e){e&&e.data&&e.data.NetCheckInfo&&Oe.l("".concat("getconninfo ok in"," miniapp. ret:"),e.data),o()},fail:function(){i(new Gn({code:wn.NETWORK_ERROR}))}}):(s=new XMLHttpRequest,a=setTimeout((function(){s.abort(),i(new Gn({code:wn.NETWORK_TIMEOUT}))}),3e3),s.onreadystatechange=function(){4===s.readyState&&(clearTimeout(a),200===s.status||304===s.status?(s.responseText&&-1<s.responseText.indexOf("NetCheckInfo")&&Oe.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(s.responseText)),o()):i(new Gn({code:wn.NETWORK_ERROR})))},s.open(e,t,!0),s.setRequestHeader("Content-type",r),n?s.send(n):s.send())}))},pa=(r(Sa,Nn),ea=g(Sa),s(Sa,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.get(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.get(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==S.NET_STATE_CONNECTED&&e.head.servcmd.includes(xn.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var t=b.HOST.CURRENT.STAT;return t="".concat(t,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),e=JSON.stringify(e.body),da("POST",t,e)}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){Z&&!J&&this.warn("DomainNameInMP"),this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.get(20).getKeyMap(e)}},{key:"onRequestTimeout",value:function(){3e4<=Date.now()-this._lastDiagnoseTS&&this.diagnose()}},{key:"onSendFail",value:function(){this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"onReconnected",value:function(){Oe.l("".concat(this._n,".onReconnected cost:").concat(jt(this._disconnectedTS,!0,!0))),this._m.restartTimer(),this.get(20).onReconnected(jt(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(S.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){Oe.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=0<arguments.length&&void 0!==arguments[0]&&arguments[0],t=!1,n=(this._socketHandler&&(t=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(t));if(Oe.l("".concat(this._n,".reConnect ").concat(n)),!this._fatalErrorFlag&&this._socketHandler){if(!0===e)this._socketHandler.forcedReconnect();else{if(this._previousState===S.NET_STATE_CONNECTING&&t)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(S.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(Oe.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),e===S.NET_STATE_DISCONNECTED&&0===this._disconnectedTS&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=e,this.emitOEvt(E.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e,t=this;!0!==this._probing&&(this._probing=!0,e=this.get(20).getProtocolData({P:xn.PING}),this.send(e).then((function(){t._probing=!1})).catch((function(e){t._probing=!1;var n=t.get(15).isOnline();if(Oe.w("".concat(t._n,"._ping failed. bOnline:").concat(n," error:"),e),e&&60002===e.code)return new eo("error").setMessage("code:".concat(e.code," message:").concat(e.message)).end(),t._fatalErrorFlag=!0,void t._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED);n?t.reConnect():t._emitNetStateChangeEvent(S.NET_STATE_DISCONNECTED)})))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"canIUseInflate",value:function(){return this._m.canIUseInflate()}},{key:"getSocketID",value:function(){if(this._socketHandler)return this._socketHandler.getSocketID()}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._lastDiagnoseTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var e=this,t=this._socketHandler.getURL(),n=t.split("/")[2];n.startsWith("ws")&&(t=t.slice(t.indexOf("info?")+5),n="https://".concat(n,"/v3/netcheck/getconninfo?").concat(t,"&reqtime=").concat(Date.now()),da("GET",n).catch((function(t){Oe.w("".concat(e._n,"._diagnoseBySSO failed. error:"),t)})))}},{key:"_diagnoseByCDN",value:function(){var e=this,t=(t=this._socketHandler.getURL()).slice(t.indexOf("info?")+5);t="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(t,"&reqtime=").concat(Date.now()),da("GET",t).catch((function(t){Oe.w("".concat(e._n,"._diagnoseByCDN failed. error:"),t)}))}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._previousState=S.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0,this._lastDiagnoseTS=0}}]),Sa),ha=["a2","tinyid"],ga=["a2","tinyid"],_a=(s(Ea,[{key:"_fillMap",value:function(){this._map.clear();var e=this._sessionM.genCommonHead(),n=this._sessionM.genCosSpecifiedHead(),o=this._sessionM.genSSOReportHead();this._map.set(xn.LOGIN,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0,customInfo:""},keyMap:{req:{deviceBrand:"InstType"},res:{InstId:"instanceID",HelloInterval:"helloInterval",RichMsgAuthKey:"authKey"}}}),this._map.set(xn.LOGOUT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.LOGOUT)}),body:{type:0,isWebUniapp:0},keyMap:{req:{type:"wslogout_type"}}}),this._map.set(xn.HELLO,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.HELLO)}),body:{isWebUniapp:0},keyMap:{res:{NewInstInfo:"newInstanceInfo"}}}),this._map.set(xn.KICK_OTHER,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.STAT_SERVICE,".").concat(xn.KICK_OTHER)}),body:{}}),this._map.set(xn.COS_SIGN,{head:t(t({},n),{},{servcmd:"".concat(b.NAME.IM_COS_SIGN,".").concat(xn.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{req:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},res:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._map.set(xn.COS_PRE_SIG,{head:t(t({},n),{},{servcmd:"".concat(b.NAME.CUSTOM_UPLOAD,".").concat(xn.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{req:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},res:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._map.set(xn.SIMPLE_COS_PRE_SIG,{head:t(t({},n),{},{servcmd:"".concat(b.NAME.CUSTOM_UPLOAD,".").concat(xn.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{req:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},res:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._map.set(xn.GET_IMAGE_INFO,{head:t(t({},n),{},{servcmd:"".concat(b.NAME.CUSTOM_UPLOAD,".").concat(xn.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{req:{imageUrl:"str_image_url"},res:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._map.set(xn.GET_IP,{head:t(t({},n),{},{servcmd:"".concat(b.NAME.CUSTOM_UPLOAD,".").concat(xn.GET_IP)}),body:{domainName:""},keyMap:{req:{domainName:"str_domain"},res:{str_final_ip:"ip"}}}),this._map.set(xn.VIDEO_COVER,{head:t(t({},n),{},{servcmd:"".concat(b.NAME.CUSTOM_UPLOAD,".").concat(xn.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{req:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},res:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._map.set(xn.FETCH_COMMERCIAL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_CONFIG_MANAGER,".").concat(xn.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{req:{SDKAppID:"uint32_sdkappid"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(xn.PUSHED_COMMERCIAL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_CONFIG_MANAGER,".").concat(xn.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(xn.FETCH_CLOUD_CTRL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_CONFIG_MANAGER,".").concat(xn.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{req:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(xn.PUSHED_CLOUD_CTRL_CONFIG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_CONFIG_MANAGER,".").concat(xn.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(xn.OVERLOAD_NOTIFY,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OVERLOAD_PUSH,".").concat(xn.OVERLOAD_NOTIFY)}),body:{},keyMap:{res:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._map.set(xn.SYNC_UNREAD_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1,needCachedMsg:1},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},res:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._map.set(xn.GET_PROFANITY_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_MSG_AUDIT_MGR,".").concat(xn.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{req:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},res:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._map.set(xn.SEND_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"}}}),this._map.set(xn.SEND_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{req:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"},res:{MsgTime:"time",MsgSeq:"sequence"}}}),this._map.set(xn.REVOKE_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{req:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._map.set(xn.REVOKE_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{req:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._map.set(xn.GET_C2C_ROAMING_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{req:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},res:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._map.set(xn.MODIFY_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(xn.GET_GRP_ROAMING_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{req:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},res:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._map.set(xn.SET_C2C_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{req:{lastMessageTime:"LastedMsgTime"}}}),this._map.set(xn.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{req:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._map.set(xn.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Peer_Account"},res:{MuteNotificationsList:"muteFlagList"}}}),this._map.set(xn.SET_GRP_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{req:{messageReadSeq:"MsgReadedSeq"}}}),this._map.set(xn.SET_ALL_MSG_READ,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{req:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},res:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._map.set(xn.DEL_C2C_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{req:{keyList:"MsgKeyList"}}}),this._map.set(xn.DEL_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{req:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._map.set(xn.TRANSLATE_TEXT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_TRANSLATE,".").concat(xn.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{req:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},res:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(xn.VOICE_TO_TEXT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_SPEECH,".").concat(xn.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{req:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},res:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(xn.MODIFY_GRP_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(xn.GET_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequence:"MsgSeq"}}}),this._map.set(xn.SEND_C2C_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{req:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._map.set(xn.SEND_READ_RECEIPT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._map.set(xn.GET_READ_RECEIPT_DETAIL,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{req:{sequence:"MsgSeq",count:"Num"},res:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._map.set(xn.MODIFY_C2C_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(xn.GET_C2C_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._map.set(xn.MODIFY_GRP_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(xn.GET_GRP_MSG_EXT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._map.set(xn.MSG_CLOUD_SEARCH,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.MSG_SEARCH,".").concat(xn.MSG_CLOUD_SEARCH)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{req:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList"},res:{GroupID:"groupID",UserID:"userID",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(xn.ADD_C2C_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(xn.RM_C2C_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(xn.GET_C2C_MSG_REACTIONS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._map.set(xn.GET_C2C_MSG_REACTION_USER_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._map.set(xn.ADD_GRP_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(xn.RM_GRP_MSG_REACTION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(xn.GET_GRP_MSG_REACTIONS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{res:{MsgSeq:"messageSequence"}}}),this._map.set(xn.GET_GRP_MSG_REACTION_USER_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM_MSG_EXT,".").concat(xn.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._map.set(xn.GET_C2C_PEER_READ_TIME,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{req:{userIDList:"To_Account"},res:{ReadTime:"peerReadTimeList"}}}),this._map.set(xn.PAGING_GET_CONV_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{req:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},res:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._map.set(xn.DEL_CONV,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{req:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},res:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._map.set(xn.CLEAR_HISTORY_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{req:{toGroupID:"ToGroupid"}}}),this._map.set(xn.PIN_CONV,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{req:{itemList:"RecentContactItem"}}}),this._map.set(xn.DEL_GROUP_AT_TIPS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(xn.SET_CONV_CUSTOM_DATA,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(xn.MARK_CONV,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(xn.CREATE_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"GroupContactItem",groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(xn.DEL_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{res:{GroupId:"convGroupID"}}}),this._map.set(xn.RENAME_CONV_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{req:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},res:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._map.set(xn.ADD_CONV_TO_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}}}),this._map.set(xn.DEL_CONV_FROM_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0}}),this._map.set(xn.GET_CONV_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startIndex:void 0},keyMap:{res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._map.set(xn.SEARCH_CONV_GRP_MARK,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.RECENT_CONTACT,".").concat(xn.SEARCH_CONV_GRP_MARK)}),body:{fromAccount:"",contactItem:void 0},keyMap:{req:{groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList",ContactResultItem:"contactItem"}}}),this._map.set(xn.GET_USER_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.PROFILE,".").concat(xn.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(xn.UPDATE_MY_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.PROFILE,".").concat(xn.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:Pe.NICK,value:""},{tag:Pe.GENDER,value:""},{tag:Pe.ALLOWTYPE,value:""},{tag:Pe.AVATAR,value:""}]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(xn.GET_BL,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30}}),this._map.set(xn.ADD_TO_BL,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(xn.RM_FROM_BL,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(xn.SET_SELF_STATUS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.SET_SELF_STATUS)}),body:{customStatus:""}}),this._map.set(xn.GET_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._map.set(xn.SUB_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(xn.UNSUB_USER_STATUS,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(xn.GET_FD_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{res:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._map.set(xn.ADD_FD,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{req:{source:"AddSource",wording:"AddWording",type:"AddType"},res:{ResultItem:"resultList"}}}),this._map.set(xn.UPDATE_FD,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{req:{snsItem:"SnsItem"},res:{ResultItem:"resultList"}}}),this._map.set(xn.DEL_FD,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"DeleteType"},res:{ResultItem:"resultList"}}}),this._map.set(xn.GET_FD_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{res:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._map.set(xn.CHECK_FD,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"CheckType"},res:{InfoItem:"resultList"}}}),this._map.set(xn.GET_FD_APPLICATION_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{res:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._map.set(xn.RESPOND_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{req:{tag:"TagName",action:"ResponseAction"},res:{ResultItem:"resultList"}}}),this._map.set(xn.DEL_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{req:{type:"PendencyType",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(xn.REPORT_FD_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{req:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._map.set(xn.CREATE_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{req:{groupName:"GroupName",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(xn.DEL_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{req:{nameList:"GroupName"}}}),this._map.set(xn.GET_FD_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{res:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._map.set(xn.UPDATE_FD_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FD,".").concat(xn.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{req:{oldName:"GroupOldName",newName:"GroupNewName"},res:{UpdateType:"type",ResultItem:"resultList"}}}),this._map.set(xn.GET_GRP_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0,needAppDefineData:1},keyMap:{req:{memberAccount:"Member_Account"},res:{GroupIdList:"groups",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime",AppDefinedData:"groupCustomField"}}}),this._map.set(xn.GET_GRP_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{req:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(xn.CREATE_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{req:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},res:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._map.set(xn.DISMISS_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.DISMISS_GRP)}),body:{groupID:void 0}}),this._map.set(xn.UPDATE_GRP_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{req:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},res:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(xn.APPLY_JOIN_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{req:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},res:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._map.set(xn.APPLY_JOIN_GRP_NOAUTH,(e.a2,e.tinyid,{head:t(t({},p(e,ha)),{},{servcmd:"".concat(b.NAME.BIG_GRP_NO_AUTH,".").concat(xn.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{req:{applyMessage:"ApplyMsg"},res:{HugeGroupFlag:"avChatRoomFlag"}}})),this._map.set(xn.QUIT_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.QUIT_GRP)}),body:{groupID:void 0}}),this._map.set(xn.SEARCH_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}}}),this._map.set(xn.CHANGE_GRP_OWNER,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{req:{newOwnerID:"NewOwner_Account"}}}),this._map.set(xn.HANDLE_GRP_APPLICATION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(xn.HANDLE_INVITE_JOIN_GRP,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._map.set(xn.HANDLE_GRP_INVITATION,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(xn.GET_GRP_PENDENCY,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{req:{handleAccount:"Handle_Account"},res:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._map.set(xn.DEL_GRP_SYSTEM_NOTICE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(xn.AV_POLLING,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.BIG_GRP_POLLING,".").concat(xn.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._map.set(xn.AV_NOAUTH_POLLING,(e.a2,e.tinyid,{head:t(t({},p(e,ga)),{},{servcmd:"".concat(b.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(xn.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._map.set(xn.GET_ONLINE_MBR_NUM,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{res:{OnlineMemberNum:"memberCount"}}}),this._map.set(xn.SET_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(xn.MODIFY_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(xn.DEL_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key"}}}),this._map.set(xn.CLEAR_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._map.set(xn.GET_GRP_ATTR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_ATTR,".").concat(xn.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{req:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._map.set(xn.GET_GRP_NOTIFY,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{req:{notifyReqList:"NotifyReqList"},res:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._map.set(xn.UPDATE_GRP_COUNTER,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{req:{counterList:"GroupCounter"}}}),this._map.set(xn.GET_GRP_COUNTER,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{req:{keyList:"GroupCounterKeys"}}}),this._map.set(xn.CREATE_TOPIC,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_COMMUNITY,".").concat(xn.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{req:{avatar:"FaceUrl"}}}),this._map.set(xn.DEL_TOPIC,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_COMMUNITY,".").concat(xn.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{req:{topicIDList:"TopicIdList"},res:{DestroyResultItem:"resultList"}}}),this._map.set(xn.UPDATE_TOPIC_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_COMMUNITY,".").concat(xn.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{req:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._map.set(xn.GET_TOPIC_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_COMMUNITY,".").concat(xn.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{req:{topicIDList:"TopicIdList"},res:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence"}}}),this._map.set(xn.GET_GRP_MBR_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._map.set(xn.GET_AV_MBR_LIST,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_AV,".").concat(xn.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{req:{offset:"Timestamp",filter:"Mark"},res:{NextTimestamp:"offset"}}}),this._map.set(xn.GET_GRP_MBR_PROFILE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._map.set(xn.ADD_GRP_MBR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{req:{userID:"Member_Account",userIDList:"MemberList"},res:{MemberList:"members"}}}),this._map.set(xn.DEL_GRP_MBR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{req:{userIDList:"MemberToDel_Account"}}}),this._map.set(xn.BAN_AV_MBR,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{req:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._map.set(xn.MODIFY_GRP_MBR_INFO,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP,".").concat(xn.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{req:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._map.set(xn.MARK_AV_MBR_INFO,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.GRP_AV,".").concat(xn.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{req:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},res:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._map.set(xn.SSO_STAT,{head:t(t({},o),{},{servcmd:"".concat(b.NAME.IM_OPEN_STAT,".").concat(xn.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{req:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._map.set(xn.PING,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.HEARTBEAT,".").concat(xn.PING)}),body:{}}),this._map.set(xn.MSG_PUSH,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_PUSH,".").concat(xn.MSG_PUSH)}),body:{},keyMap:{res:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}),this._map.set(xn.MULTI_MSG_PUSH,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_PUSH,".").concat(xn.MULTI_MSG_PUSH)}),body:{},keyMap:{res:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._map.set(xn.MSG_PUSH_ACK,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OPEN_IM,".").concat(xn.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{req:{sessionData:"SessionData"}}}),this._map.set(xn.STATUS_FORCE_OFFLINE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{res:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._map.set(xn.DOWNLOAD_MERGER_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_LONG_MSG,".").concat(xn.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{res:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._map.set(xn.UPLOAD_MERGER_MSG,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_LONG_MSG,".").concat(xn.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._map.set(xn.FOLLOW,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FOLLOW,".").concat(xn.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"FollowItem"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(xn.UNFOLLOW,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FOLLOW,".").concat(xn.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(xn.GET_FOLLOW_INFO,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FOLLOW,".").concat(xn.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._map.set(xn.GET_FOLLOW,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FOLLOW,".").concat(xn.GET_FOLLOW)}),body:{fromAccount:"",type:1,nextCursor:"",count:500},keyMap:{req:{type:"FollowType",nextCursor:"StartCursor",count:"WantNum"},res:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._map.set(xn.CHECK_FOLLOW_TYPE,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.FOLLOW,".").concat(xn.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(xn.SET_TOKEN,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{req:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._map.set(xn.STAT_FOREGROUND,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._map.set(xn.STAT_BACKGROUND,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_OPEN_STATUS,".").concat(xn.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{req:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._map.set(xn.PUSH_REPORT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.OFFLINE_PUSH_REPORT,".").concat(xn.PUSH_REPORT)}),body:{eventList:[]},keyMap:{req:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}}),this._map.set(xn.SET_ALL_RECEIVE_MSG_OPT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_MSG_LOGIC,".").concat(xn.SET_ALL_RECEIVE_MSG_OPT)}),body:{startTime:0,endTime:0,isRepeated:0,messageRemindType:0},keyMap:{req:{messageRemindType:"Level"}}}),this._map.set(xn.GET_ALL_RECEIVE_MSG_OPT,{head:t(t({},e),{},{servcmd:"".concat(b.NAME.IM_MSG_LOGIC,".").concat(xn.GET_ALL_RECEIVE_MSG_OPT)}),body:{toAccount:void 0}})}},{key:"has",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"update",value:function(){this._fillMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(Oe.w("".concat(this._n,".getKeyMap unknown P:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var t=e.P,n=e.data;if(e=this.get(t),t=null,n){var o,i=this._simpleDeepCopy(e),s=(i=this._updateService(n,i)).body,a=Object.create(null);for(o in s)if(Object.prototype.hasOwnProperty.call(s,o)){if(a[o]=s[o],void 0===n[o])continue;a[o]=n[o]}i.body=a,t=this._getUplinkData(i)}else t=this._getUplinkData(e);return t}},{key:"_getUplinkData",value:function(e){var t=Nt((e=this._dataCleaner(e)).head);return t=function(e,t){var n=0;return function e(t,o){return 100<++n?(n--,t):We(t)?(i=t.map((function(t){return Ye(t)?e(t,o):t})),n--,i):Ye(t)?(s=t,a=function(e,t){if(!Xe(t))return!1;if(t!==Zs(t))for(var n=0;n<Ks.ignoreKeyWord.length&&!t.includes(Ks.ignoreKeyWord[n]);n++);var i;return ut(o[t])?"OPPOChannelID"===(i=t)?i:i[0].toUpperCase()+Zs(i).slice(1):o[t]},r=Object.create(null),Object.keys(s).forEach((function(e){var t=a(s[e],e);t&&(r[t]=s[e])})),i=St(i=r,(function(t,n){return We(t)||Ye(t)?e(t,o):t})),n--,i):void 0;var i,s,a,r}(e,t)}(e.body,this._getReqKeyMap(t)),e.body=t,e}},{key:"_updateService",value:function(e,t){var n,o,i=Nt(t.head);return this._isFromGroupRequest(t)&&(n=e.type,o=e.groupID,e=void 0===(e=e.groupIDList)?[]:e,ut(o=void 0===o?void 0:o)&&(o=e[0]||""),It({type:n,groupID:o})&&(t.head.servcmd="".concat(b.NAME.GRP_COMMUNITY,".").concat(i))),t}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(b.NAME.GRP)||e.head.servcmd.includes(b.NAME.GRP_ATTR)}},{key:"_getReqKeyMap",value:function(e){return e=this.getKeyMap(e),t(t({},Ks.req),e.req)}},{key:"_dataCleaner",value:function(e){var t,o=Array.isArray(e)?[]:Object.create(null);for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&Xe(t)&&null!==e[t]&&void 0!==e[t]&&("object"!==n(e[t])?o[t]=e[t]:o[t]=this._dataCleaner.bind(this)(e[t]));return o}},{key:"_simpleDeepCopy",value:function(e){for(var t,n=Object.keys(e),o={},i=0,s=n.length;i<s;i++)We(e[t=n[i]])?o[t]=Array.from(e[t]):Ye(e[t])?o[t]=this._simpleDeepCopy(e[t]):o[t]=e[t];return o}}]),Ea),fa=[xn.MSG_PUSH_ACK],ma=(s(Ta,[{key:"_onC2CMsgArray",value:function(e){var t=this._sessionM.get(6);e.dataList.forEach((function(e){var t;1===e.isSyncMessage&&(t=e.from,e.from=e.to,e.to=t)})),1===e.needSync&&this._sessionM.get(19).syncOnNeed(),t.onNewMessage({dataList:e.dataList,isInstantMessage:!0})}},{key:"_onC2CMsgModified",value:function(e){this._sessionM.get(6).onMsgModified(e)}},{key:"_onGroupMsgArray",value:function(e){var t=this._sessionM.get(7);t&&t.onNewMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_onGroupMsgModified",value:function(e){var t=this._sessionM.get(7);t&&t.onMsgModified(e)}},{key:"_onGroupTips",value:function(e){var t=this._sessionM.get(7);if(t){var n=e.event,o=e.dataList,i=e.isInstantMessage,s=void 0===i||i,a=e.isSyncingEnded;switch(n){case 4:case 6:t.onNewGroupTips({event:n,dataList:o});break;case 5:for(var r=0;r<o.length;r++)if(We(o[r].elements.revokedInfos))t.onMsgRevoked({dataList:o});else if(We(o[r].elements.groupMessageReadNotice))t.onMsgReadNotice({dataList:o});else{if(!We(o[r].elements.readReceiptList)){t.onNewGroupSystemNotice({dataList:o,isInstantMessage:s,isSyncingEnded:a});break}t.onReadReceiptList({dataList:o})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:o});break;default:Oe.l("".concat(this._n,"._onGroupTips unknown event:").concat(n," dataList:"),o)}}}},{key:"_onC2CNotifyMsgArray",value:function(e){var t,n=this,o=e.dataList;We(o)&&(t=this._sessionM.get(6),o.forEach((function(e){var i,s;ze(e)&&(e.hasOwnProperty("kickoutMsgNotify")?(i=(s=e.kickoutMsgNotify).kickType,s=void 0===(s=s.newInstanceInfo)?{}:s,1===i?n._sessionM.onMultipleAccountKickedOut(s):2===i?n._sessionM.onMultipleDeviceKickedOut(s):3===i&&n._sessionM.onRestApiKickedOut(s)):e.hasOwnProperty("c2cMessageRevokedNotify")?t&&t.onMsgRevoked({dataList:o}):e.hasOwnProperty("c2cMessageReadReceipt")?t&&t.onMsgReadReceipt({dataList:o}):e.hasOwnProperty("c2cMessageReadNotice")?t&&t.onMsgReadNotice({dataList:o}):e.hasOwnProperty("muteNotificationsSync")&&n._sessionM.get(11).onC2CMsgRemindTypeSynced({dataList:o}))})))}},{key:"_onC2CReadReceiptArray",value:function(e){this._sessionM.get(6).onReadReceiptList(e)}},{key:"_onProfileModified",value:function(e){this._sessionM.get(4).onProfileModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onFriendProfileModified({dataList:e.dataList})}},{key:"_onRelationChainModified",value:function(e){this._sessionM.get(4).onRelationChainModified({dataList:e.dataList});var t=this._sessionM.get(8);t&&t.onRelationChainModified({dataList:e.dataList})}},{key:"_onRecentContact",value:function(e){var t;!We(e=e.dataList)||(t=this._sessionM.get(11))&&e.forEach((function(e){var n,o,i=e.pushType;1===i?(n=e.recentContactDeleteItem,t.onConvDeleted(n.recentContactList)):2===i?(n=e.recentContactTopItem,t.onConvPinnedStatus(n.recentContactList,!0)):3===i?(n=e.recentContactTopItem,t.onConvPinnedStatus(n.recentContactList,!1)):4===i?(n=e.recentContactMarkContact,t.onConvMarkUpdated(n.recentContactMarkContactItem)):5===i?(n=e.recentContactCreateContactGroup,t.onConvGroupCreated(n.msgContactGroupContactItem)):6===i?(n=e.recentContactDelContactGroup,t.onConvGroupDeleted(n.msgGroupItem)):7===i&&(i=(n=e.recentContactUpdateContactGroup).updateType,e=n.msgUpdateGroup,n=n.msgUpdateContact,1===i?1===(o=e.updateGroupType)?t.onConvGroupNameUpdated(e):2===o&&t.onConvInGroupUpdated(e):2===i&&t.onConvAddedToOrDeletedFromGroup(n))}))}},{key:"_onAllMsgRead",value:function(e){e=e.dataList;var t=this._sessionM.get(11);t&&t.onPushedAllMessageRead(e)}},{key:"_onUserStatusList",value:function(e){this._sessionM.get(4).onUserStatusUpdated(e)}},{key:"_onMsgExtNotify",value:function(e){this._sessionM.get(3).onMsgExtNotify(e)}},{key:"_onMsgReactionNotifyList",value:function(e){this._sessionM.get(34).onReactionNotifyList(e)}},{key:"_onMsgReactionNotify",value:function(e){this._sessionM.get(34).onReactionNotify(e)}},{key:"_onFollowNotify",value:function(e){this._sessionM.get(35).onFollowNotify(e)}},{key:"_onTopicLatestMsg",value:function(e){this._sessionM.get(10).onTopicLatestMsg(e)}},{key:"onMessage",value:function(e){var t=this,n=e.body;if(this._filterMsgFromIMOpenPush(e)){var o,i=n.eventArray,s=n.isInstantMessage,a=n.isSyncingEnded,r=n.needSync;if(We(i))for(var c,u,l,d=0,p=i.length;d<p;d++)100!==(l=(c=i[d]).event)?24!==l?26!==l?(o=Object.keys(c).find((function(e){return-1!==t._keys.indexOf(e)})))?(u=14===l?{readAllC2CMessage:c[o],groupMessageReadInfoList:c.groupMessageReadNotice||[]}:16===l?{userID:c.userID,timestamp:c.timestamp,readReceiptList:c[o]}:c[o],this._eventHandlerMap.get(o)({event:l,dataList:u,isInstantMessage:s,isSyncingEnded:a,needSync:r})):Oe.l("".concat(this._n,".onMessage unknown eventItem:"),c):this._onTopicLatestMsg(c):this._onAllRcvMsgOptNotify(c):this._onRoomCustomData(c.content)}}},{key:"_onRoomCustomData",value:function(e){this._sessionM.get(30).onRoomCustomDataReceived(e),Oe.l("".concat(this._n,"._onRoomCustomData data:").concat(e))}},{key:"_onAllRcvMsgOptNotify",value:function(e){this._sessionM.get(11).onAllRcvMsgOptNotify(e)}},{key:"_filterMsgFromIMOpenPush",value:function(e){var t=e.head,n=(e=e.body,t=t.servcmd,!1);return!(n=ut(t)?n:t.includes(b.NAME.IM_CONFIG_MANAGER)||t.includes(b.NAME.OVERLOAD_PUSH)||t.includes(b.NAME.STAT_SERVICE))||(t.includes(xn.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedConfig(e):t.includes(xn.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(e):t.includes(xn.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(e):t.includes(xn.KICK_OTHER)&&(n=Date.now(),this._sessionM.reLoginOnKickOther(),e=new eo("kickOther"),n-=t=this._sessionM.get(1).getLastWsHelloTs(),e.setMessage("last wshello time:".concat(t," diff:").concat(n,"ms")).end()),!1)}}]),Ta),va=[{cmd:xn.GET_GRP_PROFILE,interval:1,count:8},{cmd:xn.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:xn.GET_AV_MBR_LIST,interval:3,count:1},{cmd:xn.GET_GRP_PENDENCY,interval:1,count:15},{cmd:xn.GET_TOPIC_LIST,interval:1,count:10},{cmd:xn.SET_GRP_ATTR,interval:5,count:10},{cmd:xn.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:xn.DEL_GRP_ATTR,interval:5,count:10},{cmd:xn.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:xn.GET_GRP_ATTR,interval:5,count:20},{cmd:xn.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:xn.GET_GRP_COUNTER,interval:5,count:20},{cmd:xn.SET_ALL_MSG_READ,interval:1,count:1},{cmd:xn.GET_USER_STATUS,interval:5,count:20},{cmd:xn.SUB_USER_STATUS,interval:5,count:20},{cmd:xn.UNSUB_USER_STATUS,interval:5,count:20},{cmd:xn.MSG_CLOUD_SEARCH,interval:1,count:2},{cmd:xn.CHECK_FOLLOW_TYPE,interval:5,count:20},{cmd:xn.GET_GRP_ROAMING_MSG,interval:1,count:20},{cmd:xn.GET_C2C_ROAMING_MSG,interval:1,count:20}],ya=new Map,Ia=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Ma=0,Ca=Ia.length;Ma<Ca;Ma++)ya.set(Ma,Ia[Ma]);function Ta(e){o(this,Ta),this._sessionM=e,this._n="MsgDispatcher",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._onC2CMsgArray.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._onGroupMsgArray.bind(this)),this._eventHandlerMap.set("groupTips",this._onGroupTips.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._onC2CNotifyMsgArray.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._onC2CReadReceiptArray.bind(this)),this._eventHandlerMap.set("profileModify",this._onProfileModified.bind(this)),this._eventHandlerMap.set("friendListMod",this._onRelationChainModified.bind(this)),this._eventHandlerMap.set("recentContactMod",this._onRecentContact.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._onAllMsgRead.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._onC2CMsgModified.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._onGroupMsgModified.bind(this)),this._eventHandlerMap.set("userStatusList",this._onUserStatusList.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._onMsgExtNotify.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._onMsgReactionNotifyList.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._onMsgReactionNotify.bind(this)),this._eventHandlerMap.set("followChangeList",this._onFollowNotify.bind(this)),this._keys=m(this._eventHandlerMap.keys())}function Ea(e){o(this,Ea),this._n="PHandler",this._sessionM=e,this._map=new Map,this._fillMap()}function Sa(e){return o(this,Sa),(e=ea.call(this,e))._n="ChannelModule",e._socketHandler=new la(h(e)),e._probing=!1,e._isAppShowing=!0,e._previousState=S.NET_STATE_CONNECTED,e._timerForNotLoggedIn=-1,e._timerForNotLoggedIn=setInterval(e.onCheckTimer.bind(h(e)),1e3),e._fatalErrorFlag=!1,e._disconnectedTS=0,e._lastDiagnoseTS=0,e}function Da(e){o(this,Da),this._chM=e,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=ua,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=nt(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=P,this._setWebsocketHost(),this._initConnection()}function ka(e){o(this,ka);var t,n,i=(this._handler=e).getURL();this._socket=null,this._workerSocket=null,this._id=nt(),this._handler.getIsWorkerEnabled()?(t=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen", extensions: _socket.extensions });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(t),(n=this)._workerSocket.onmessage=function(e){var t=(i=e.data).callback,o=i.e,i=i.extensions;"onOpen"===t?n._onOpen(i):"onClose"===t?n._onClose(o):"onError"===t?n._onError(o):"onMessage"===t&&n._onMessage(e.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:i})):Z?z?(ne.connectSocket({url:i,header:{"content-type":"application/json"}}),ne.onSocketClose(this._onClose.bind(this)),ne.onSocketOpen(this._onOpen.bind(this)),ne.onSocketMessage(this._onMessage.bind(this)),ne.onSocketError(this._onError.bind(this))):(this._socket=ne.connectSocket({url:i,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):(this._socket=new WebSocket(i),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this,this._socket.extensions),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=e.canIUseBinaryFrame()}function Ra(e){for(var t,n,o=e,i="",s=0,a=(o=e.length%8!=0?"0".repeat(8-e.length%8)+e:o).length;s<a;s+=8)t=parseInt(o.slice(s,s+4),2),n=parseInt(o.slice(s+4,s+8),2),i+=ya.get(t)+ya.get(n);return i}function La(e){if(e<0||53<e)return NaN;var t=0|1073741824*Math.random();return 30<e?t+1073741824*(0|Math.random()*(1<<e-30)):t>>>30-e}function Aa(e,t){for(var n=e.toString(16),o=t-n.length,i="0";0<o;o>>>=1,i+=i)1&o&&(n=i+n);return n}r(Wr,Nn),qa=g(Wr),s(Wr,[{key:"_init",value:function(){this._updateCmdFreqLimitMap(va)}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");ut(e)||(e=JSON.parse(e),this._updateCmdFreqLimitMap(e))}},{key:"_updateCmdFreqLimitMap",value:function(e){var t=this;e.forEach((function(e){t._cmdFreqLimitMap.set(e.cmd,{interval:e.interval,count:e.count})}))}},{key:"updateProtocolConfig",value:function(){this._pHandler.update()}},{key:"req",value:function(e){Oe.d("".concat(this._n,".req options:"),e);var t=e.P;if(!this._pHandler.has(t))return Oe.w("".concat(this._n,".req unknown P:").concat(t)),In({code:wn.NO_PROTOCOL});var n=(e=this.getProtocolData(e)).head.servcmd;if(this._isFreqOverLimit(n))return In({code:o=wn.OVER_FREQUENCY_LIMIT,message:this.getErrMsg(o,this._getCmd(n))});if(this._isServerOverload(n))return In({code:o=wn.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrMsg(o,this._getCmd(n))});var o=this.get(21);return fa.includes(t)?o.simplySend(e):o.send(e)}},{key:"getKeyMap",value:function(e){return this._pHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:N,websdkversion:O,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:12775283,sdkability_ext:Ra(""),cappid:e.getApplicationID(),cs:0}}},{key:"genCosSpecifiedHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:N,websdkversion:O,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:Ra(""),cappid:e.getApplicationID(),cs:0}}},{key:"genSSOReportHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:N,websdkversion:O,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:Ra(""),cappid:e.getApplicationID(),cs:0}}},{key:"getProtocolData",value:function(e){return this._pHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd;return e=e.data,n={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd;return e=e.data,n={head:t(t({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"onErrorCodeNotZero",value:function(e){var t,n=e.errorCode;n===wn.HELLO_ANSWER_KICKED_OUT&&(t=e.kickType,e=void 0===(e=e.newInstanceInfo)?{}:e,1===t?this.onMultipleAccountKickedOut(e):2===t?this.onMultipleDeviceKickedOut(e):3===t&&this.onRestApiKickedOut(e)),n!==wn.MSG_A2KEY_EXPIRED&&n!==wn.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(e){var t=(n=e.body).needAck,n=n.sessionData;1===(void 0===t?0:t)&&this._sendACK(n),this._msgDispatcher.onMessage(e)}},{key:"onReconnected",value:function(e){this._incrementalPullContactFlag=e<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){Oe.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){Oe.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e,t,n,o=this,i="".concat(this._n,"._reLogin");this.isLoggedIn()&&(e=0,(t=this.get(1).getPushModule())&&(e=t.getUniAppPlatform()),n=new eo("reLogin"),this.req({P:xn.LOGIN,data:{isWebUniapp:e,customInfo:this.get(12).getCustomLoginInfo()}}).then((function(e){var t=(e=e.data).instanceID,s=(e=e.customStatus,o.get(12)),a=Wo(e),r=(s.setStatusInstanceID(t),o.get(21)),c=r.getSocketID();c="socketID:".concat(c," instanceID:").concat(t," customStatus:").concat(a),n.setMessage(c).end(!0),Oe.l("".concat(i," ok. ").concat(c)),s.getCustomStatus()!==a&&o.get(4).onUserStatusUpdated({dataList:[{to:o.getMyUserID(),statusType:S.USER_STATUS_ONLINE,customStatus:e}]}),r.diagnose(),o.get(11).syncConvList(o._incrementalPullContactFlag).then((function(){Oe.l("".concat(i,", sync conv list ok.")),o.get(25).start()})),((t=o.get(7))&&t.updateLocalMainSequenceOnReconnected(),c=o.get(10)).resetGetTopicTime(),c.getTopicListOnReconnected(),(s=o.get(35))&&s.clearCacheOnReconnected()})))}},{key:"onMultipleAccountKickedOut",value:function(e){this.get(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.get(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.get(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.req({P:xn.MSG_PUSH_ACK,data:{sessionData:e}})}},{key:"_isFreqOverLimit",value:function(e){if(e=e.split(".")[1],!this._cmdFreqLimitMap.has(e))return!1;if(!this._cmdReqInfoMap.has(e))return this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1;var t=(n=this._cmdFreqLimitMap.get(e)).count,n=n.interval,o=(i=this._cmdReqInfoMap.get(e)).startTime,i=i.requestCount;return Date.now()-o>1e3*n?(this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1):(this._cmdReqInfoMap.set(e,{startTime:o,requestCount:i+=1}),t<i)}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var t=(n=this._serverOverloadInfoMap.get(e)).overloadTime,n=n.waitingTime;return Date.now()-t<=1e3*n||(this._serverOverloadInfoMap.delete(e),!1)}},{key:"_getCmd",value:function(e){var t="";if(!e.includes("."))return t;var n,o=e.split(".")[1];for(n in xn)if(xn[n]===o){t=n;break}return t}},{key:"onPushedServerOverload",value:function(e){var t=e.overloadCommand;e=e.waitingTime,this._serverOverloadInfoMap.set(t,{overloadTime:Date.now(),waitingTime:e}),Oe.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(e,"s cmd:").concat(this._getCmd(t)))}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._updateCmdFreqLimitMap(va),this._cmdReqInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var Oa,Na,Pa,ba,Ua,Ga,wa,Fa,xa,Va,qa,Ba=Wr,Ha=(r(zr,Nn),Va=g(zr),s(zr,[{key:"getCloudConfig",value:function(e){return ut(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"getServerConfig",value:function(e){var t={code:0,data:""};return!ut(e)&&this._cloudConfig.has(e)&&(t.data=this._cloudConfig.get(e)),Promise.resolve(t)}},{key:"_canFetch",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e,t=this,n="".concat(this._n,".fetchConfig"),o=this._canFetch();Oe.l("".concat(n," canFetch:").concat(o)),o&&(e=new eo("fetchCloudCtrlConfig"),o=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({P:xn.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:o,version:this._version}}).then((function(o){t._isFetching=!1;var i=(s=o.data).version,s=s.cloudControlConfig;e.setMessage("version:".concat(t._version," newVersion:").concat(i," config:").concat(s)).end(),Oe.l("".concat(n," ok")),t._parse(o.data)})).catch((function(o){t._isFetching=!1,e.setError(o).end(),Oe.l("".concat(n," failed. error:"),o),t._setExpiredTime(12e4)})))}},{key:"onPushedConfig",value:function(e){Oe.l("".concat(this._n,".onPushedConfig config:"),e),new eo("pushedCloudCtrlConfig").setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parse(e)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"_parse",value:function(e){var t=this,n="".concat(this._n,"._parse"),o=e.errorCode,i=e.errorMessage,s=e.cloudControlConfig,a=e.version,r=e.expiredTime;if(0===o){if(this._version!==a){var c=null;try{c=JSON.parse(s)}catch(u){this.isPrivateNetWork()||Oe.e("".concat(n," failed. config:"),s)}c&&(this._cloudConfig.clear(),Object.keys(c).forEach((function(e){t._cloudConfig.set(e,c[e])})),this._version=a,this.emitIEvt(qo.CLOUD_CONFIG))}this._setExpiredTime(1e3*r)}else ut(o)?(Oe.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTime(36e5)):(Oe.e("".concat(n," errorCode:").concat(o," errorMessage:").concat(i)),this._setExpiredTime(12e4))}},{key:"_setExpiredTime",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),zr),ja=(r(Yr,Nn),xa=g(Yr),s(Yr,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,t,n,o,i=this,s=this._getLocalConvList().filter((function(e){return e.type===S.CONV_GROUP&&e.groupProfile.type!==S.GRP_AVCHATROOM})),a=this.get(11),r=[];s.forEach((function(s){var c=s.conversationID;s=s.lastMessage,e=c.replace(S.CONV_GROUP,""),t=a.getLocalLastMessage(c),s&&0!==s.lastSequence&&t?(n=s.lastSequence,t=t.sequence,o=n-t,0<t&&1<=o&&o<300?i._recoverGroupMsg({groupID:e,localLastMessageSequence:t,remoteLastMessageSequence:n}):r.push(e)):r.push(e)})),this._getGroupNotice(r)}},{key:"_recoverC2CChat",value:function(){var e,t,n,o=this,i=this._getLocalConvList().filter((function(e){return e.type===S.CONV_C2C})),s=this.get(11),a=[Promise.resolve()];i.forEach((function(i){var r=i.conversationID;i=i.lastMessage,e=s.getLocalLastMessage(r),i&&0!==i.lastTime&&e&&(t=i.lastTime,e=e.time,n=t-e,0<e&&1<=n&&n<=600&&a.push(o._recoverC2CMsg({conversationID:r,localLastMessageTime:e,remoteLastMessageTime:t})))})),Promise.all(a).then((function(){Oe.l("".concat(o._n,"._recoverC2CChat all done")),o.get(19).syncOnReconnected()}))}},{key:"_getLocalConvList",value:function(){return this.get(11).getLocalConvList()}},{key:"_recoverGroupMsg",value:function(e){var t=this,n="".concat(this._n,".").concat("_recoverGroupMsg"),o=(Oe.l("".concat(n," options:"),e),e.groupID),i=e.localLastMessageSequence,s=e.remoteLastMessageSequence,a=JSON.stringify(e),r=new eo("_recoverGroupMsg");r.setMessage(a),this._getGroupRoamingMsg({groupID:o,sequence:i}).then((function(e){var c=(e=e.data).complete,u=e.messageList;if(!ut(u)){e=u[0].sequence;var l=u.map((function(e){return e.sequence})),d=(l="".concat(a," complete:").concat(c," sequenceList:").concat(l),Oe.l("".concat(n," ").concat(l)),e!==i&&e<s&&2!==c&&t._recoverGroupMsg({groupID:o,localLastMessageSequence:e,remoteLastMessageSequence:s}),r.setMessage(l).end(),t.get(7));1<u.length&&u.sort((function(e,t){return e.sequence-t.sequence}));for(var p=!1,h=0,g=u.length;h<g;h++)if(u[h].from===S.CONV_SYSTEM){p=!0;break}if(p)for(var _=0,f=u.length;_<f;_++){var m=u[_];m.from!==S.CONV_SYSTEM?d.onNewMessage({dataList:[m],isInstantMessage:!1,updateUnreadCount:!1}):d.onNewGroupTips({event:m.event,dataList:[m]})}else d.onNewMessage({dataList:u,isInstantMessage:!1,updateUnreadCount:!1})}})).catch((function(e){r.setError(e).end(),Oe.w("".concat(n," failed. error:"),e)}))}},{key:"_getGroupNotice",value:function(e){var t=e.length;if(Oe.l("".concat(this._n,"._getGroupNotice length:").concat(t)),0!==t){var n=this.get(7);if(t<=10)n.getNotice(e);else{var o=Math.floor(t/10);5<=o&&(o=5);for(var i=0;i<=o;i++)n.getNotice(e.slice(10*i,10*(i+1)))}}}},{key:"_getGroupRoamingMsg",value:function(e){var t=e.groupID;return e=e.sequence,this.req({P:xn.GET_GRP_ROAMING_MSG,data:{groupID:t,count:this.PULL_LIMIT_COUNT,sequence:e+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMsg",value:function(e){var t=this,n="".concat(this._n,".").concat("_recoverC2CMsg"),o=(Oe.l("".concat(n," options:"),e),e.conversationID),i=e.localLastMessageTime,s=e.remoteLastMessageTime,a=JSON.stringify(e),r=new eo("_recoverC2CMsg");return r.setMessage(a),this._getC2CRoamingMsg({conversationID:o,time:i}).then((function(e){var i=(e=e.data).complete;if(e=e.messageList,!ut(e)){var c=e.length;if(t.get(6).onNewMessage({dataList:e,isInstantMessage:!0}),c=e[c-1].time,e=e.map((function(e){return e.random})),e="".concat(a," complete:").concat(i," randomList:").concat(e),Oe.l("".concat(n," ").concat(e)),r.setMessage(e).end(),c<s&&1!==i)return t._recoverC2CMsg({conversationID:o,localLastMessageTime:c,remoteLastMessageTime:s})}})).catch((function(e){r.setError(e).end(),Oe.w("".concat(n," failed. error:"),e)}))}},{key:"_getC2CRoamingMsg",value:function(e){var t=e.conversationID;return e=e.time,this.req({P:xn.GET_C2C_ROAMING_MSG,data:{peerAccount:t.replace(S.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:e,direction:1}})}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset"))}}]),Yr),Ka=(s(Kr,[{key:"addMessageDelay",value:function(e){0<=(e=Ee()-e)&&this._e2eDelayArray.push(e)}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),Pt(n/t,1)}},{key:"_calcCountWithLimit",value:function(e){var t=e.e2eDelayArray,n=e.min,o=e.max;return t.filter((function(e){return n<=e&&e<o})).length}},{key:"_calcPercent",value:function(e,t){return 100<(e=Pt(e/t*100,2))?100:e}},{key:"_checkE2EDelayException",value:function(e,t){var n,o,i,s=e.filter((function(e){return t<e}));0<s.length&&(n=s.length,o=Math.min.apply(Math,m(s)),i=Math.max.apply(Math,m(s)),s=this._calcAvg(s,n),50<(e=Pt(n/e.length*100,2))&&new eo("messageE2EDelayException").setMessage("count:".concat(n," min:").concat(o," max:").concat(i," avg:").concat(s," percent:").concat(e)).setLevel("warning").end())}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(0===e)return null;var t=m(this._e2eDelayArray),n=this._calcCountWithLimit({e2eDelayArray:t,min:0,max:1}),o=this._calcCountWithLimit({e2eDelayArray:t,min:1,max:3}),i=this._calcPercent(n,e),s=this._calcPercent(o,e),a=this._calcAvg(t,e);return this._checkE2EDelayException(t,3),t.length=0,this.reset(),{totalCount:e,countLessThan1Second:n,percentOfCountLessThan1Second:i,countLessThan3Second:o,percentOfCountLessThan3Second:s,avgDelay:a}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),Kr),Ya=(s(jr,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,t){return 0===t?0:100<(e=Pt(e/t*100,2))?100:e}},{key:"_calcAvg",value:function(e,t){if(0===t)return 0;var n=0;return e.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,m(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,m(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),t=m(this._rttArray);if(0===e)return null;var n=this._calcRTTCount(t),o=this._calcSuccessRateOfRequest(n,e);return t=this._calcAvg(t,n),Oe.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(t)),this.reset(),{totalCount:e,rttCount:n,successRateOfRequest:o,avgRTT:t}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),jr),za=(s(Hr,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}))}},{key:"addTotalCount",value:function(e){return!(ut(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(ut(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(ut(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,t){return!(ut(e)||!this._map.has(e)||(this._map.get(e).costArray.push(t),0))}},{key:"addFileSize",value:function(e,t){return!(ut(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(t),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){return ut(e)||!this._map.has(e)?-1:100<(e=Pt((e=this._map.get(e)).successCount/e.totalCount*100,2))?100:e}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(ut(e)||!this._map.has(e))return-1;var t=this._map.get(e);return 100<(e=Pt(e=this._calcSuccessCountOfPlatform(e)/t.totalCount*100,2))?100:e}},{key:"_calcTotalCount",value:function(e){return ut(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return ut(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){return ut(e)||!this._map.has(e)?-1:(e=this._map.get(e)).successCount+e.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return ut(e)||!this._map.has(e)?-1:e===Yn?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var t=this._map.get(e).costArray.length;if(0===t)return 0;var n=0;return this._map.get(e).costArray.forEach((function(e){n+=e})),parseInt(n/t)}},{key:"_calcAvgSpeed",value:function(e){var t=0,n=0;return this._map.get(e).costArray.forEach((function(e){t+=e})),this._map.get(e).fileSizeArray.forEach((function(e){n+=e})),parseInt(1e3*n/t)}},{key:"getStatResult",value:function(e){var t=this._calcTotalCount(e);if(0===t)return null;var n=this._calcSuccessCountOfBusiness(e),o=this._calcSuccessRateOfBusiness(e),i=this._calcSuccessCountOfPlatform(e),s=this._calcSuccessRateOfPlatform(e),a=this._calcAvg(e);return this.reset(e),{totalCount:t,successCountOfBusiness:n,successRateOfBusiness:o,successCountOfPlatform:i,successRateOfPlatform:s,avgValue:a}}},{key:"reset",value:function(e){ut(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),Hr),Wa=(s(Br,[{key:"initMap",value:function(e){var t=this;e.forEach((function(e){t._lastMap.set(e,new Map),t._currentMap.set(e,new Map)}))}},{key:"addMessageSequence",value:function(e){var t=e.key,n=e.message;if(ut(t)||!this._lastMap.has(t)||!this._currentMap.has(t))return!1;var o,i,s=n.conversationID;return n=n.sequence,s=s.replace(S.CONV_GROUP,""),0!==this._lastMap.get(t).size&&this._lastMap.get(t).has(s)?(i=(o=this._lastMap.get(t).get(s)).length-1,n>o[0]&&n<o[i]?(o.push(n),o.sort(),this._lastMap.get(t).set(s,o)):this._addCurrentMap(e)):this._addCurrentMap(e),!0}},{key:"_addCurrentMap",value:function(e){var t=e.key,n=(e=e.message).conversationID;e=e.sequence,n=n.replace(S.CONV_GROUP,""),this._currentMap.get(t).has(n)||this._currentMap.get(t).set(n,[]),this._currentMap.get(t).get(n).push(e)}},{key:"_copyData",value:function(e){if(!ut(e)){this._lastMap.set(e,new Map);var t,n=this._lastMap.get(e),o=T(this._currentMap.get(e));try{for(o.s();!(t=o.n()).done;){var i=f(t.value,2),s=i[0],a=i[1];n.set(s,a)}}catch(r){o.e(r)}finally{o.f()}n=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(ut(this._currentMap.get(e))||ut(this._lastMap.get(e)))return null;if(0===this._lastMap.get(e).size)return this._copyData(e),null;var t=0,n=0;if(this._lastMap.get(e).forEach((function(e,o){var i=(e=m(e.values())).length;e=e[i-1]-e[0]+1,t+=e,n+=i})),0===t)return null;var o=Pt(n/t*100,2);return 100<o&&(o=100),this._copyData(e),{totalCount:t,successCountOfMessageReceived:n,successRateOfMessageReceived:o}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),Br),Ja=(r(qr,Nn),Fa=g(qr),s(qr,[{key:"_onLoginSuccess",value:function(){var e=this,t=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),n=t.getItem(this.TAG,!1);!Be(n)&&Je(n.forEach)&&(Oe.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(n.length)),n.forEach((function(t){e._statInfoArr.push(t)})),t.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("q_rpt_interval"),t=this.getCloudConfig("q_rpt_sdkappid_bl"),n=this.getCloudConfig("q_rpt_tinyid_wl");ut(e)||(this.REPORT_INTERVAL=Number(e)),ut(t)||(this.REPORT_SDKAPPID_BLACKLIST=t.split(",").map((function(e){return Number(e)}))),ut(n)||(this.REPORT_TINYID_WHITELIST=n.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||Oe.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||Oe.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||Oe.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,t){this._rateMessageSent.addCost(e,t)||Oe.w("".concat(this._n,".addCost invalid key or cost:"),e,t)}},{key:"addFileSize",value:function(e,t){this._rateMessageSent.addFileSize(e,t)||Oe.w("".concat(this._n,".addFileSize invalid key or size:"),e,t)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||Oe.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},o=Zn[this.get(15).getNetworkType()];switch(ut(o)&&(o=8),o={qualityType:$n[e],timestamp:ke(),networkType:o,extension:""},e){case Vn:n=this._avgRTT.getStatResult();break;case qn:n=this._avgE2EDelay.getStatResult();break;case Bn:case Hn:case jn:case Kn:case Yn:n=this._rateMessageSent.getStatResult(e);break;case zn:case Wn:case Jn:n=this._rateMessageReceived.getStatResult(e)}return null===n?null:t(t({},o),n)}},{key:"_report",value:function(e){var t=this,n=[],o=null,i=(ut(e)?this._qualityItems.forEach((function(e){null!==(o=t._getQualityItem(e))&&(o.reportIndex=t.reportIndex,o.wholePeriod=t.wholePeriod,n.push(o))})):null!==(o=this._getQualityItem(e))&&(o.reportIndex=this.reportIndex,o.wholePeriod=this.wholePeriod,n.push(o)),Oe.d("".concat(this._n,"._report"),n),0<this._statInfoArr.length&&(n=n.concat(this._statInfoArr),this._statInfoArr=[]),e=this.get(12)).getSDKAppID();e=e.getTinyID(),0<(n=bt(this.REPORT_SDKAPPID_BLACKLIST,i)&&!Ut(this.REPORT_TINYID_WHITELIST,e)?[]:n).length&&this._doReport(n)}},{key:"_doReport",value:function(e){var n=this,o={header:rs(this),quality:e};this.req({P:xn.SSO_STAT,data:t({},o)}).then((function(){n.reportIndex++,n.wholePeriod=!1})).catch((function(t){Oe.w("".concat(n._n,"._doReport failed. error:"),t),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()}))}},{key:"_flushAtOnce",value:function(){var e=this.get(13),t=e.getItem(this.TAG,!1),n=this._statInfoArr,o="".concat(this._n,"._flushAtOnce");Be(t)?(Oe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)):(10<(n=n.concat(t)).length&&(n=n.slice(0,10)),Oe.l("".concat(o," count:").concat(n.length)),e.setItem(this.TAG,n,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),qr),$a=s((function e(t){o(this,e),Be(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",this.time=t.time||0,this.source=t.source||"",this.wording=t.wording||"",this.type=t.type||"")})),Xa=(s(Vr,[{key:"getLocalApplicationList",value:function(){return{friendApplicationList:m(this._map.values()),unreadCount:this._unreadCount}}},{key:"_onApplicationListUpdated",value:function(){this._snsM.emitOEvt(E.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:m(this._map.values()),unreadCount:this._unreadCount})}},{key:"onApplicationRead",value:function(){this._unreadCount=0,this._onApplicationListUpdated()}},{key:"onApplicationAdded",value:function(e,n){var o,i,s=this;Be(e)||("",o=n===this._snsM.getMyUserID()?S.SNS_APPLICATION_SENT_BY_ME:S.SNS_APPLICATION_SENT_TO_ME,i=!1,e.forEach((function(e){var n="".concat(e.userID,"_").concat(o);o!==S.SNS_APPLICATION_SENT_TO_ME||s._map.has(n)||(s._unreadCount+=1),s._map.set(n,new $a(t(t({},e),{},{type:o}))),i=!0})),i&&this._onApplicationListUpdated())}},{key:"onApplicationDeleted",value:function(e){Be(e)||(this._startTime=0,this._currentSeq=0,this.getApplicationList())}},{key:"getApplicationList",value:function(){var e=this,t="".concat(this._n,".").concat("getApplicationList"),n=new eo("getApplicationList");return this._snsM.req({P:xn.GET_FD_APPLICATION_LIST,data:{applicationType:S.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSeq}}).then((function(o){var i=(o=o.data).resultList,s=o.unreadCount,a=o.startTime,r=(o=o.currentSequence,e._startTime=a,e._currentSeq=o,e._unreadCount=s,We(i)?i.length:0);r="applicationCount:".concat(r," unreadCount:").concat(s," startTime:").concat(a," currentSequence:").concat(o),n.setMessage(r).end(),Oe.i("".concat(t," ok. ").concat(r)),e._map.clear(),We(i)&&i.forEach((function(t){var n=t.userID,o=t.type;t=new $a(t),e._map.set("".concat(n,"_").concat(o),t)})),e._onApplicationListUpdated()})).catch((function(e){return n.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"deleteApplication",value:function(e){var t="".concat(this._n,".").concat("deleteApplication"),n=e.userID,o=e.type;if(o&&(o===S.SNS_APPLICATION_SENT_BY_ME||o===S.SNS_APPLICATION_SENT_TO_ME)||(o=S.SNS_APPLICATION_SENT_TO_ME),!this._map.has("".concat(n,"_").concat(o)))return In({code:wn.FRIEND_APPLICATION_NOT_EXIST});var i=new eo("deleteApplication");return i.setMessage("userID:".concat(n," type:").concat(o)),this._snsM.req({P:xn.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[n],type:o}}).then((function(e){var s=(r=(e=e.data.resultList)[0]).to,a=r.resultCode,r=r.resultInfo;return i.setMoreMessage("resultList:".concat(JSON.stringify(e))).end(),Oe.i("".concat(t," ok. userID:").concat(n," type:").concat(o)),0===a?vn():In({userID:s,code:a,message:r})})).catch((function(e){return i.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"acceptApplication",value:function(e){var t="".concat(this._n,".").concat("acceptApplication"),n=e.userID,o=e.remark,i=e.tag,s=e.type,a=(s&&(s===S.SNS_APPLICATION_AGREE||s===S.SNS_APPLICATION_AGREE_AND_ADD)||(s=S.SNS_APPLICATION_AGREE_AND_ADD),new eo("acceptApplication"));return a.setMessage("userID:".concat(n," type:").concat(s)),this._snsM.req({P:xn.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,remark:o,tag:i,action:s}]}}).then((function(e){a.end();var o=(e=e.data.resultList[0]).resultCode;if(e=e.resultInfo,0!==o)return In({code:o,message:e});Oe.i("".concat(t," ok. userID:").concat(n," type:").concat(s))})).catch((function(e){return a.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"refuseApplication",value:function(e){var t="".concat(this._n,".").concat("refuseApplication"),n=e.userID,o=new eo("refuseApplication");return o.setMessage("userID:".concat(n)),this._snsM.req({P:xn.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:n,action:"Response_Action_Reject"}]}}).then((function(e){o.end();var i=(e=e.data.resultList[0]).resultCode;if(e=e.resultInfo,0!==i)return In({code:i,message:e});Oe.i("".concat(t," ok. userID:").concat(n))})).catch((function(e){return o.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"setApplicationRead",value:function(){var e=this,t="".concat(this._n,".").concat("setApplicationRead"),n=new eo("setApplicationRead");return this._snsM.req({P:xn.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:Pt(ke()/1e3,0)}}).then((function(o){n.end(),Oe.i("".concat(t," ok")),e._unreadCount=0})).catch((function(e){return n.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"reset",value:function(){this._maxLimited=100,this._currentSeq=0,this._unreadCount=0,this._map.clear()}}]),Vr),Za=(s(xr,[{key:"validate",value:function(e){var t,n=!0,o="";if(Be(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var i=e.profileCustomField.length,s=null,a=0;a<i;a++){if(s=e.profileCustomField[a],!ct(s.key)||-1===s.key.indexOf("Tag_Profile_Custom"))return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!ct(s.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(t in e)if(Object.prototype.hasOwnProperty.call(e,t)){if("profileCustomField"===t)continue;if(Be(e[t])&&!ct(e[t])&&!Ke(e[t])){o="key:"+t+", invalid value:"+e[t],n=!1;continue}switch(t){case"nick":ct(e[t])||(n=!(o="nick must be a string")),500<et(e[t])&&(o="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(et(e[t])," bytes"),n=!1);break;case"gender":it(Ue,e.gender)||(o="key:gender, invalid value:"+e.gender,n=!1);break;case"birthday":Ke(e.birthday)||(n=!(o="birthday must be a number"));break;case"location":ct(e.location)||(n=!(o="location must be a string"));break;case"selfSignature":ct(e.selfSignature)||(n=!(o="selfSignature must be a string"));break;case"allowType":it(we,e.allowType)||(o="key:allowType, invalid value:"+e.allowType,n=!1);break;case"language":Ke(e.language)||(n=!(o="language must be a number"));break;case"avatar":ct(e.avatar)||(n=!(o="avatar must be a string"));break;case"messageSettings":0!==e.messageSettings&&1!==e.messageSettings&&(n=!(o="messageSettings must be 0 or 1"));break;case"adminForbidType":it(Ge,e.adminForbidType)||(o="key:adminForbidType, invalid value:"+e.adminForbidType,n=!1);break;case"level":Ke(e.level)||(n=!(o="level must be a number"));break;case"role":Ke(e.role)||(n=!(o="role must be a number"));break;default:o="unknown key:"+t+"  "+e[t],n=!1}}return{valid:n,tips:o}}},{key:"update",value:function(e){var t,n="",o=[];this.friendCustomField.forEach((function(e){o.push(e.key)}));for(var i=0,s=e.length;i<s;i++)if(n=e[i].tag,t=e[i].value,-1<n.indexOf("Tag_SNS_Custom"))-1<o.indexOf(n)?this.friendCustomField.forEach((function(e){e.key===n&&(e.value=t)})):this.friendCustomField.push({key:n,value:t});else if(-1<n.indexOf("Tag_Profile_Custom")){var a=!1;this.profile.profileCustomField.forEach((function(e){e.key===n&&(e.value=t,a=!0)})),a||this.profile.profileCustomField.push({key:n,value:t})}else switch(n){case Pe.NICK:this.profile.nick=t;break;case Pe.GENDER:this.profile.gender=t;break;case Pe.BIRTHDAY:this.profile.birthday=t;break;case Pe.LOCATION:this.profile.location=t;break;case Pe.SELFSIGNATURE:this.profile.selfSignature=t;break;case Pe.ALLOWTYPE:this.profile.allowType=t;break;case Pe.LANGUAGE:this.profile.language=t;break;case Pe.AVATAR:this.profile.avatar=t;break;case Pe.MESSAGESETTINGS:this.profile.messageSettings=t;break;case Pe.ADMINFORBIDTYPE:this.profile.adminForbidType=t;break;case Pe.LEVEL:this.profile.level=t;break;case Pe.ROLE:this.profile.role=t;break;case be.REMARK:this.remark=t;break;case be.ADDTIME:this.addTime=t;break;case be.GROUP:this.groupList=JSON.parse(JSON.stringify(t));break;case be.ADDSOURCE:this.source=t;break;case be.ADDWORDING:break;default:Oe.d("snsProfileItem unkown tag->",e[i].tag)}this.timestamp=Date.now(),o.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){-1===this.groupList.indexOf(e)&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){-1<(e=this.groupList.indexOf(e))&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}]),xr),Qa=(s(Fr,[{key:"getLocalFriendList",value:function(){return m(this._map.values())}},{key:"getFriendRemark",value:function(e){return this._map.has(e)?this._map.get(e).remark:""}},{key:"onFriendProfileModified",value:function(e){var t,n=this;Be(e=e.dataList)||(t=this._snsM.get(11),e.forEach((function(e){var o,i=e.userID;e=e.profileList,n.isMyFriend(i)&&(Oe.l("".concat(n._n,".onFriendProfileModified. friend account:").concat(i,", profileList:").concat(JSON.stringify(e))),(o=n._map.get(i)).update(e),t.modifyMessageSentByPeer({conversationID:"".concat(S.CONV_C2C).concat(i),latestNick:o.profile.nick,latestAvatar:o.profile.avatar}))})),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(e){var t=this;0!==e.length&&(Oe.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach((function(e){t._map.set(e,new Za(e))})),this.getFriendProfile({userIDList:e}).then((function(n){e.forEach((function(e){var n=t._map.get(e);0<n.groupList.length&&t._snsM.updateWhenFriendAdded({nameList:n.groupList,userID:e})})),t._onFriendListUpdated()})))}},{key:"onFriendDeleted",value:function(e){var t=this;0!==e.length&&(Oe.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach((function(e){var n=t._map.get(e);0<n.groupList.length&&t._snsM.updateWhenFriendDeleted({nameList:n.groupList,userID:e}),t._map.delete(e)})),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOEvt(E.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(e){var t=this,n="".concat(this._n,".").concat("getFriendProfile"),o=(e=e.userIDList,[]),i=[],s=[];if(e.forEach((function(e){var n;t._map.has(e)?(n=t._map.get(e),Date.now()-n.timestamp<t._expirationTime?i.push(n):s.push(e)):o.push({userID:e,code:wn.NOT_MY_FRIEND,message:t._snsM.getErrMsg(wn.NOT_MY_FRIEND)})})),0===s.length)return Oe.i("".concat(n," newUserIDList is empty")),yn({friendList:i,failureUserIDList:o});var a=new eo("getFriendProfile");return a.setMessage("userIDList:".concat(s)),Oe.i("".concat(n," userIDList:").concat(s)),this._snsM.req({P:xn.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:s}}).then((function(e){return a.end(),Oe.i("".concat(n," ok")),e.data.resultList.forEach((function(e){var n,s=e.to,a=e.resultCode,r=e.resultInfo;e=e.tagValueList,ut(a)||0===a?(t._map.has(s)?(n=t._map.get(s)).update(e):(n=new Za(s,e),t._map.set(s,n)),i.push(n)):o.push({userID:s,code:a,message:r})})),vn({friendList:i,failureUserIDList:o})})).catch((function(e){return a.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"isMyFriend",value:function(e){return this._map.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,t="".concat(this._n,".").concat("getFriendList"),n=new eo("getFriendList"),o=Date.now();this._snsM.req({P:xn.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIdx,standardSequence:this._standardSeq,customSequence:this._customSeq}}).then((function(i){var s=(i=i.data).friendCount,a=i.resultList,r=i.nextStartIndex,c=i.standardSequence,u=i.customSequence;i=i.completeFlag,e._startIdx=r,e._standardSeq=c,e._customSeq=u,s="friendCount:".concat(s," nextStartIndex:").concat(r," standardSequence:").concat(c," ")+"customSequence:".concat(u," completeFlag:").concat(i," cost:").concat(jt(o)),n.setMessage(s).end(),Oe.i("".concat(t," ok."),s),Be(a)||a.forEach((function(t){var n=t.to;t=t.tagValueList,e._map.set(n,new Za(n,t))})),0===i?e.pagingGetFriendList():(e._snsM.emitOEvt(E.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())})).catch((function(e){return n.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"_pagingGetFriendProfile",value:function(){var e=this,t=m(this._map.keys()),n=this._snsM.get(4),o=t.length,i=o<=100?1:Math.ceil(o/100);Oe.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(o," pageCount:").concat(i));for(var s=0;s<i;s++)n.getUserProfile({userIDList:t.slice(100*s,100*(s+1))}).then((function(t){t.data.forEach((function(t){var n=e._map.get(t.userID);n&&n.updateProfile(t)})),e._onFriendListUpdated()}))}},{key:"addFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("addFriend");if(this._map.has(e.to))return In({code:wn.ALREADY_MY_FRIEND});if(e.wording&&!1===this._snsM.filterProfanity("wording",e))return In({code:wn.PROFANITY_FOUND});var o=e.to,i=e.source,s=e.type,a=e.wording,r=e.remark,c=(e=e.groupName,s),u=(c&&(c===S.SNS_ADD_TYPE_SINGLE||c===S.SNS_ADD_TYPE_BOTH)||(c=S.SNS_ADD_TYPE_BOTH),new eo("addFriend"));return u.setMessage("to:".concat(o," source:").concat(i," type:").concat(c)),this._snsM.req({P:xn.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:o,source:i,wording:a,remark:r,groupName:e}],type:c}}).then((function(e){e=e.data.resultList;var o=(u.setMoreMessage("resultList:".concat(JSON.stringify(e))).end(),e=e[0]).to,i=e.resultCode;return e=e.resultInfo,Oe.i("".concat(n," ok. to:").concat(o," type:").concat(c," code:").concat(i)),ut(i)||0===i?vn({userID:o,code:0}):30539===i?vn({userID:o,code:i,message:t._snsM.getErrMsg(i)}):In({userID:o,code:i,message:t._snsM.getErrMsg(i)||e})})).catch((function(e){return u.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"deleteFriend",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteFriend"),o=e.userIDList,i=(e=e.type,1e3<o.length&&(Oe.w("".concat(n," ").concat(qt(1e3))),o.length=1e3),[]),s=[],a=[];if(o.forEach((function(e){t._map.has(e)?a.push(e):i.push({userID:e,code:wn.NOT_MY_FRIEND,message:t._snsM.getErrMsg(wn.NOT_MY_FRIEND)})})),0===a.length)return yn({successUserIDList:s,failureUserIDList:i});var r=((o=e)&&(o===S.SNS_DELETE_TYPE_SINGLE||o===S.SNS_DELETE_TYPE_BOTH)||(o=S.SNS_DELETE_TYPE_BOTH),new eo("deleteFriend"));return r.setMessage("userIDList:".concat(a," type:").concat(o)),this._snsM.req({P:xn.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:a,type:o}}).then((function(e){return r.end(),Oe.i("".concat(n," ok")),Be(e=e.data.resultList)||e.forEach((function(e){var t=e.to,n=e.resultCode;e=e.resultInfo,ut(n)||0===n?s.push({userID:t}):i.push({userID:t,code:n,message:e})})),vn({successUserIDList:s,failureUserIDList:i})})).catch((function(e){return r.setError(e).end(),Oe.w("".concat(n," error:"),e),In(e)}))}},{key:"updateFriend",value:function(e){var t=this,n=e.userID,o=e.remark,i=e.friendCustomField;if(!this._map.has(n))return In({code:wn.NOT_MY_FRIEND});var s="".concat(this._n,".").concat("updateFriend"),a=new eo("updateFriend"),r=(a.setMessage("userID:".concat(n," remark:").concat(o," friendCustomField:").concat(i)),[]);return ut(o)||r.push({tag:be.REMARK,value:o}),We(i)&&0<i.length&&i.forEach((function(e){r.push({tag:e.key,value:e.value})})),this._snsM.req({P:xn.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:n,snsItem:r}]}}).then((function(e){a.end(),Oe.i("".concat(s," ok"));var n=(e=e.data.resultList[0]).to,r=e.resultCode;return e=e.resultInfo,ut(r)||0===r?((n=t._map.get(n))&&(ut(o)||(n.remark=o),We(i)&&0<i.length&&ft(n.friendCustomField,i),t._onFriendListUpdated()),vn(n)):In({code:r,message:e})})).catch((function(e){return a.setError(e).end(),Oe.w("".concat(s," failed. error:"),e),In(e)}))}},{key:"checkFriend",value:function(e){var t="".concat(this._n,".").concat("checkFriend"),n=e.userIDList,o=e.type,i=(o&&(o===S.SNS_CHECK_TYPE_SINGLE||o===S.SNS_CHECK_TYPE_BOTH)||(o=S.SNS_CHECK_TYPE_BOTH),new eo("checkFriend"));return i.setMessage("userIDList:".concat(n," type:").concat(o)),this._snsM.req({P:xn.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:n,type:o}}).then((function(e){i.end(),Oe.i("".concat(t," ok. userIDList:").concat(n," type:").concat(o));var s=[],a=[];return We(e=e.data.resultList)&&e.forEach((function(e){var t=e.to,n=e.relation,o=e.resultCode;e=e.resultInfo,ut(o)||0===o?s.push({userID:t,code:0,relation:n}):a.push({userID:t,code:o,message:e})})),vn({successUserIDList:s,failureUserIDList:a})})).catch((function(e){return i.setError(e).end(),Oe.w("".concat(t," failed. error:"),e),In(e)}))}},{key:"onAddedToFriendGroup",value:function(e){var t=this,n=e.name;e=e.userIDList,Oe.l("".concat(this._n,".onAddedToFriendGroup groupName:").concat(n," userIDList:").concat(e)),n&&!Be(e)&&e.forEach((function(e){t._map.has(e)&&t._map.get(e).addToGroupList(n)}))}},{key:"onRemovedFromFriendGroup",value:function(e){var t=this,n=e.name;e=e.userIDList,Oe.l("".concat(this._n,".onRemovedFromFriendGroup groupName:").concat(n," userIDList:").concat(e)),n&&!Be(e)&&e.forEach((function(e){t._map.has(e)&&t._map.get(e).removeFromGroupList(n)}))}},{key:"reset",value:function(){this._map.clear(),this._startIdx=0,this._standardSeq=0,this._customSeq=0}}]),Fr),er=(s(wr,[{key:"addToUserIDList",value:function(e){-1===this.userIDList.indexOf(e)&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){-1<(e=this.userIDList.indexOf(e))&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}]),wr),tr=(s(Gr,[{key:"getLocalGroupList",value:function(){return m(this._map.values())}},{key:"_onGroupListUpdated",value:function(){var e=m(this._map.values());this._snsM.emitOEvt(E.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getGroupList",value:function(){var e=this,t="".concat(this._n,".").concat("getGroupList"),n=new eo("getGroupList");return this._snsM.req({P:xn.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then((function(o){n.end(),Be(o=o.data.resultList)?Oe.i("".concat(t," ok. count:0")):(Oe.i("".concat(t," ok. count:").concat(o.length)),e._map.clear(),o.forEach((function(t){var n=new er(t);e._map.set(t.name,n)})),e._onGroupListUpdated())})).catch((function(e){return n.setError(e).end(),Oe.w("".concat(t," error:"),e),In(e)}))}},{key:"createGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("createGroup"),o=e.name;if(e=e.userIDList,this._map.has(o))return In({code:wn.FRIEND_GRP_EXISTED});var i="name:".concat(o," userIDList:").concat(e),s=new eo("createGroup");return s.setMessage(i),this._snsM.req({P:xn.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[o],userIDList:We(e)?e:void 0}}).then((function(e){s.end(),Oe.l("".concat(n," ok. ").concat(i)),e=e.data.resultList;var a=[],r=[];return e&&e.forEach((function(e){var t=e.to,n=e.resultCode,o=e.resultInfo;ut(n)||0===n?a.push(t):(t={userID:e.to,code:n,message:o},r.push(t))})),e=new er({name:o,userIDList:a}),t._map.set(o,e),t._snsM.onAddedToFriendGroup({name:o,userIDList:a}),t._onGroupListUpdated(),vn({friendGroup:e,failureUserIDList:r})})).catch((function(e){return s.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"deleteGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("deleteGroup"),o=e.name;if(!this._map.has(o))return this._onGroupNotExist();var i="name:".concat(o),s=new eo("deleteGroup");return s.setMessage(i),this._snsM.req({P:xn.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[o]}}).then((function(e){s.end(),Oe.l("".concat(n," ok. ").concat(i));var a=t._map.get(o);return a&&(t._snsM.onRemovedFromFriendGroup({name:o,userIDList:a.userIDList}),t._map.delete(o),a.userIDList.length=0),t._onGroupListUpdated(),vn(a)})).catch((function(e){return s.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"renameGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("renameGroup"),o=e.oldName,i=e.newName;if(!this._map.has(o))return this._onGroupNotExist();var s="oldName:".concat(o," newName:").concat(i),a=new eo("renameGroup");return a.setMessage(s),this._snsM.req({P:xn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,newName:i}}).then((function(){var e;return a.end(),Oe.l("".concat(n," ok. ").concat(s)),t._map.has(o)?((e=t._map.get(o)).name=i,t._map.delete(o),t._map.set(i,e),t._snsM.onRemovedFromFriendGroup({name:o,userIDList:e.userIDList}),t._snsM.onAddedToFriendGroup({name:i,userIDList:e.userIDList}),t._onGroupListUpdated(),vn(e)):vn()})).catch((function(e){return a.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"addToGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("addToGroup"),o=e.name;if(e=e.userIDList,!this._map.has(o))return this._onGroupNotExist();var i="name:".concat(o," userIDList:").concat(e),s=new eo("addToGroup");return s.setMessage(i),this._snsM.req({P:xn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:e.filter((function(e){return t._snsM.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Add"}}))}}).then((function(e){return s.end(),Oe.l("".concat(n," ok. ").concat(i)),t._onGroupUpdated(o,e)})).catch((function(e){return s.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"removeFromGroup",value:function(e){var t=this,n="".concat(this._n,".").concat("removeFromGroup"),o=e.name;if(e=e.userIDList,!this._map.has(o))return this._onGroupNotExist();var i="name:".concat(o," userIDList:").concat(e),s=new eo("removeFromGroup");return s.setMessage(i),this._snsM.req({P:xn.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:o,updateGroupItem:e.filter((function(e){return t._snsM.isMyFriend(e)})).map((function(e){return{to:e,updateType:"Update_Type_Delete"}}))}}).then((function(e){return s.end(),Oe.l("".concat(n," ok. ").concat(i)),t._onGroupUpdated(o,e)})).catch((function(e){return s.setError(e).end(),Oe.w("".concat(n," failed. error:"),e),In(e)}))}},{key:"_onGroupUpdated",value:function(e,t){t=t.data.resultList;var n=this._map.get(e),o=[],i=[],s=[];return We(t)&&t.forEach((function(e){var t=e.to,a=e.resultCode,r=e.resultInfo,c=e.type;0===a?"Update_Type_Add"===c?n&&(n.addToUserIDList(t),i.push(t)):"Update_Type_Delete"===c&&n&&(n.removeFromUserIDList(t),s.push(t)):o.push({to:e.to,code:a,message:r})})),Oe.l("".concat(this._n,"._onGroupUpdated name:").concat(e," userIDList:").concat(n.userIDList)),0<i.length&&this._snsM.onAddedToFriendGroup({name:e,userIDList:i}),0<s.length&&this._snsM.onRemovedFromFriendGroup({name:e,userIDList:s}),vn({friendGroup:n,failureUserIDList:o})}},{key:"updateWhenFriendAdded",value:function(e){var t=this,n=e.nameList,o=e.userID;Oe.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(o," nameList:").concat(n)),Be(n)||n.forEach((function(e){t._map.has(e)&&t._map.get(e).addToUserIDList(o)}))}},{key:"updateWhenFriendDeleted",value:function(e){var t=this,n=e.nameList,o=e.userID;Oe.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(o," nameList:").concat(n)),Be(n)||n.forEach((function(e){t._map.has(e)&&t._map.get(e).removeFromUserIDList(o)}))}},{key:"_onGroupNotExist",value:function(e){return In({code:wn.FRIEND_GRP_NOT_EXIST})}},{key:"reset",value:function(){this._map.clear()}}]),Gr),nr=(r(Ur,Nn),wa=g(Ur),s(Ur,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getGroupList(),this._friendApplicationHandler.getApplicationList()}},{key:"onRelationChainModified",value:function(e){var t,n,o,i,s,a,r=this;Be(e=e.dataList)||(t=[],n=[],o=[],s=!(i=[]),a="",e.forEach((function(e){var c;3!==e.pushType&&4!==e.pushType||!e.from||(a=e.from),e.friendAddAccount&&(t.push.apply(t,m(e.friendAddAccount)),i.push.apply(i,m(e.friendAddAccount))),e.friendDelAccount&&n.push.apply(n,m(e.friendDelAccount)),e.friendApplicationAdded&&o.push.apply(o,m(e.friendApplicationAdded)),e.friendApplicationDeletedUserIDList&&i.push.apply(i,m(e.friendApplicationDeletedUserIDList)),e.reportTime&&7===e.pushType&&(s=!0),e.friendUpInfo&&(c={dataList:[]},e.friendUpInfo.forEach((function(e){c.dataList.push({userID:e.friendAccount,profileList:m(e.sns)})})),r.onFriendProfileModified(c))})),s&&this._friendApplicationHandler.onApplicationRead(),this._friendApplicationHandler.onApplicationAdded(o,a),this._friendApplicationHandler.onApplicationDeleted(i),this._friendHandler.onFriendAdded(t),this._friendHandler.onFriendDeleted(n))}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,t){if(!(o=this.get(29)))return!0;var n=(o=o.filterText(t[e],"sns")).isAllowedToSend,o=o.modifiedText;return!0===n&&(t[e]=o,!0)}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(0<arguments.length&&void 0!==arguments[0])||arguments[0],t=this._friendHandler.getLocalFriendList();return e?yn(t):t}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"onAddedToFriendGroup",value:function(e){this._friendHandler.onAddedToFriendGroup(e)}},{key:"onRemovedFromFriendGroup",value:function(e){this._friendHandler.onRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){return yn(this._friendApplicationHandler.getLocalApplicationList())}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){return yn(this._friendGroupHandler.getLocalGroupList())}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Ur),or=(r(br,Nn),Ga=g(br),s(br,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&ge}},{key:"startWorkerTimer",value:function(){Oe.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){Oe.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var e,t;ge&&(e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(e),(t=this)._workerTimer.onmessage=function(e){e.data?(t._timerID=e.data,Oe.l("".concat(t._n,"._init seed:").concat(t._timerID))):t._m.onCheckTimer()})}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("enable_worker");Oe.l("".concat(this._n,"._onCloudConfig enableWorker:").concat(e)),ut(e)||"1"===e?!this._isWorkerEnabled&&ge&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&ge&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){Oe.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset"))}}]),br),ir=(s(Pr,[{key:"isValidPurchaseBits",value:function(e){return e&&"string"==typeof e&&1<=e.length&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._featureMap.clear();for(var t,n=e.length-1,o=0;0<=n;n--,o++)t=(o<32?new R(0,Math.pow(2,o)):new R(Math.pow(2,o-32),0)).toString(),"1"===e[n]?this._featureMap.set(t,!0):this._featureMap.set(t,!1)}else Oe.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._featureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var t=parseInt(e).toString(2),n=void 0,o=!0,i=t.length-1,s=0;0<=i;i--,s++)if("1"===t.charAt(i)&&(n=(s<32?new R(0,Math.pow(2,s)):new R(Math.pow(2,s-32),0)).toString(),!this._featureMap.get(n))){o=!1;break}return Oe.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," key:").concat(n," ret:").concat(o)),yn({enabled:o})}},{key:"isFeatureEnabledForStat",value:function(e){for(var t=parseInt(e).toString(2),n=t.length-1,o=0;0<=n;n--,o++)if("1"===t.charAt(n)){if(i=(o<32?new R(0,Math.pow(2,o)):new R(Math.pow(2,o-32),0)).toString(),!this._featureMap.get(i))break;var i,s="",a=0;i===U.PLUGIN_TRANSLATE?(s="plugin_translate",a=16):i===U.PLUGIN_VOICE_TO_TEXT?(s="plugin_voice_to_text",a=17):i===U.PLUGIN_CS?(s="plugin_cs",a=14):i===U.PLUGIN_PUSH?(s="plugin_push",a=13):i===U.PLUGIN_BOT?(s="plugin_bot",a=15):i===U.MSG_REACTION&&(s="plugin_emoji_reaction",a=18),""!==s&&(i=this._commercialConfigM.get(12).getUIPlatform(),new eo(s).setCode(a).setUIPlatform(i).end(),Oe.l("".concat(this._n,".isFeatureEnabledForStat ").concat(s," code:").concat(a," uiPlatform:").concat(i)))}}},{key:"isSearchCloudMessagesEnabled",value:function(){var e;this._isSCMReported||(e=this._commercialConfigM.get(12).getUIPlatform(),new eo("plugin_search").setCode(6).setUIPlatform(e).end(),this._isSCMReported=!0)}},{key:"clear",value:function(){this._featureMap.clear(),this._isSCMReported=!1}}]),Pr),sr=(s(Nr,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e,t,n=this,o=this._canFetch(),i="".concat(this._n,".fetchConfig");Oe.l("".concat(i," canFetch:").concat(o)),o&&(e=new eo("fetchCommercialConfig"),o=this.get(12).getSDKAppID(),t=this.get(20),this._isFetching=!0,t.req({P:xn.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:o}}).then((function(t){e.setMessage("purchaseBits:".concat(t.data.purchaseBits)).end(),Oe.l("".concat(i," ok.")),n._parseConfig(t.data),n._isFetching=!1})).catch((function(t){e.setError(t).end(),n._isFetching=!1})))}},{key:"onPushedConfig",value:function(e){var t="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));Oe.l("".concat(t)),new eo("pushedCommercialConfig").setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var t="".concat(this._n,"._parseConfig"),n=e.errorCode,o=e.errorMessage,i=e.purchaseBits,s=e.expiredTime;0===n?(this._purchasedFeatureHandler.parsePurchaseBits(i),this._expiredTime=Date.now()+1e3*s):ut(n)?(Oe.l("".concat(t," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(Oe.e("".concat(t," errorCode:").concat(n," errorMessage:").concat(o)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"isFeatureEnabledForStat",value:function(e){this._purchasedFeatureHandler.isFeatureEnabledForStat(e)}},{key:"isSearchCloudMessagesEnabled",value:function(){this._purchasedFeatureHandler.isSearchCloudMessagesEnabled()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),Nr),ar=(r(Or,Nn),Ua=g(Or),s(Or,[{key:"registerPlugin",value:function(e){var t,n,o,i,s,a,r,c,u,l,d,p,h;J?(this._offlinePushPlugin=e["tim-offline-push-plugin"],t=(h=e.offlinePushConfig||{}).huaweiBusinessID,n=h.xiaomiBusinessID,o=h.xiaomiAppID,i=h.xiaomiAppKey,s=h.meizuBusinessID,a=h.meizuAppID,r=h.meizuAppKey,c=h.vivoBusinessID,u=h.oppoBusinessID,l=h.oppoAppKey,d=h.oppoAppSecret,p=h.honorBusinessID,h=h.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=t,this._androidPushConfig.xiaomiPushBussinessId=n,this._androidPushConfig.xiaomiPushAppId=o,this._androidPushConfig.xiaomiPushAppKey=i,this._androidPushConfig.meizuPushBussinessId=s,this._androidPushConfig.meizuPushAppId=a,this._androidPushConfig.meizuPushAppKey=r,this._androidPushConfig.vivoPushBussinessId=c,this._androidPushConfig.oppoPushBussinessId=u,this._androidPushConfig.oppoPushAppKey=l,this._androidPushConfig.oppoPushAppSecret=d,this._androidPushConfig.honorPushBussinessId=p,new eo("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!ut(this._offlinePushPlugin))).end(!0),Oe.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=h,this._setAppShowListener()):this.warn("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Je(this._offlinePushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),Oe.l("".concat(n," start. ").concat(e)),new eo("_getDeviceToken").setMessage("".concat(e)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var i,s,a,r,c=new eo("getDeviceTokenRes"),u=o.code,l=o.msg;0===u?(i=(r=o.data).deviceToken,s=r.deviceBrand,a=r.deviceType,r=r.bussinessId,t._deviceToken=i,t._businessID=r||t._iosBusinessID,e="deviceToken:".concat(i,", deviceBrand:").concat(s||a,", businessID:").concat(t._businessID),Oe.l("".concat(n," ok. ").concat(e)),c.setMessage(e).end(!0),t._setToken()):(c.setMessage("code:".concat(u,", msg:").concat(l)).end(!0),Oe.e("".concat(n," failed. error:"),o))}))):Oe.e("".concat(n," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return J&&!ut(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");ut(this._offlinePushPlugin)?Oe.e("".concat(t," offlinePushPlugin is undefined")):Je(this._offlinePushPlugin.setAppShowListener)?(new eo("_setAppShowListener").end(!0),Oe.l("".concat(t," start")),this._offlinePushPlugin.setAppShowListener((function(n){n=(n||{}).appShow,new eo("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),Oe.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(0===n?(e._getConvUnreadCount(),e._onBackground()):1===n&&e._onForeground())}))):Oe.e("".concat(t," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!ut(this._offlinePushPlugin)&&Je(this._offlinePushPlugin.getDeviceType))return e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,Oe.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,"._setToken"),t=this.get(12),n=1,o="",i="",s=(Be(this._deviceToken)&&(n=0),this.getUniAppPlatform()),a=this.getDeviceBrand(),r=(s===A.IOS||s===A.IPAD||s===A.MAC?i=this._deviceToken:s===A.ANDROID&&(o=this._deviceToken),new eo("offlinePushSetToken"));return s="deviceToken:".concat(i||o,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(a,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(n,", platform:").concat(s),r.setMessage("".concat(s)),Oe.l("".concat(e," ").concat(s)),this.req({P:xn.SET_TOKEN,data:{tokenID:o,pushMsg:n,sdkAppID:t.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:a,deviceToken:i,isWebUniapp:this._isWebUniapp}}).then((function(t){return r.end(),Oe.l("".concat(e," ok")),t})).catch((function(t){return r.setError(t).end(),Oe.e("".concat(e," failed. error:"),t),In(t)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach((function(t){t.type===S.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===S.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new eo("_onBackground");this.req({P:xn.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(o){return n.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),Oe.l("".concat(t," ok")),o})).catch((function(e){n.setError(e).end(),Oe.e("".concat(t," failed. error:"),e)}))}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new eo("_onForeground");this.req({P:xn.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then((function(n){return t.end(),Oe.l("".concat(e," ok")),n})).catch((function(n){t.setError(n).end(),Oe.e("".concat(e," failed. error:"),n)}))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?A.IOS:"android"===e?A.ANDROID:1002===t?A.IPAD:1001===t?A.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Oe.l("".concat(this._n,".reset"))}}]),Or),rr=(r(Ar,Nn),ba=g(Ar),s(Ar,[{key:"registerPlugin",value:function(e){var t,n,o;J?(t="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=e["tim-push"],this._getDeviceInfo(),n=(o=e.pushConfig||{}).androidConfig,o=o.iOSConfig,Ye(n)&&(this._androidPushConfig=n[this._deviceInfo.packageName]),n=(o||{}).iOSBusinessID,this._iOSBusinessID=n,o=!ut(this._pushPlugin),new eo("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(o)).end(!0),Oe.l("".concat(t," ok. pushConfig:").concat(JSON.stringify(e.pushConfig))),o?(this._setAppShowListener(),this._setPushEventReportListener()):Oe.e("".concat(t," ").concat(this._pluginName," is undefined"))):this.warn("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var e=this,n="".concat(this._n,".").concat("_reportEventCacheList");Je(this._pushPlugin.getPushEventCacheList)?(new eo("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList((function(o){var i=o.code,s=o.data.eventList,a=new eo("getPushEventCacheListRes");if(a.setCode(i),0!==i)a.setMessage("res:".concat(JSON.stringify(o))).end(!0),Oe.e("".concat(n," failed. error:").concat(JSON.stringify(o)));else{i=s.length<10?"eventList:".concat(JSON.stringify(s)):"eventList.length:".concat(s.length),Oe.l("".concat(n," ok. ").concat(i)),a.setMessage(i).end(!0);for(var r=t(t({},o.data),{},{eventList:[]});0<s.length;)r.eventList=s.splice(0,40),e._pushReport(r)}}))):Oe.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var e,t=this,n="".concat(this._n,".").concat("_getDeviceToken");Je(this._pushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),Oe.l("".concat(n," start. ").concat(e)),new eo("_getDeviceToken").setMessage("".concat(e)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,(function(o){var i,s,a,r=o.code,c=o.msg,u=new eo("getDeviceTokenRes");if(u.setCode(r),0===r)return i=(r=o.data).deviceToken,s=r.deviceBrand,a=r.deviceType,r=r.bussinessId,t._deviceToken=i,t._businessID=r||t._iOSBusinessID,e="deviceToken:".concat(i," deviceBrand:").concat(s||a," businessID:").concat(t._businessID),Oe.l("".concat(n," ok. ").concat(e)),u.setMessage(e).end(!0),void t._setToken();u.setMessage(c).end(!0),Oe.e("".concat(n," failed. error:").concat(JSON.stringify(o)))}))):Oe.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var e="".concat(this._n,".").concat("_getDeviceInfo");if(Je(this._pushPlugin.getDeviceInfo)){var n=this._pushPlugin.getDeviceInfo(),o=n.code,i=n.data,s=new eo("_getDeviceInfo");if(s.setCode(o),0===o)return this._deviceInfo=t(t({},this._deviceInfo),i),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),o="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),Oe.l("".concat(e," ok. ").concat(o)),void s.setMessage(o).end(!0);s.setMessage("deviceInfoRes:".concat(JSON.stringify(n))).end(!0),Oe.e("".concat(e," failed. error:").concat(JSON.stringify(n)))}else Oe.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return J&&!ut(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setAppShowListener");Je(this._pushPlugin.setAppShowListener)?(new eo("_setAppShowListener").end(!0),Oe.l("".concat(t," start")),this._pushPlugin.setAppShowListener((function(n){n=(n||{}).appShow,new eo("setAppShowListenerRes").setMessage("appShow:".concat(n)).end(!0),Oe.l("".concat(t," ok. appShow:").concat(n)),e._m.isReady()&&(0===n?(e._getConvUnreadCount(),e._onBackground()):1===n&&e._onForeground())}))):Oe.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var e=this,t="".concat(this._n,".").concat("_setPushEventReportListener");Je(this._pushPlugin.setPushEventReportListener)?(new eo("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener((function(n){var o=n.code,i=n.data,s=i.eventList,a=new eo("setPushEventReportListenerRes");if(a.setCode(o),0===o)return o="eventList:".concat(JSON.stringify(s)),Oe.l("".concat(t," ok. ").concat(o)),a.setMessage(o).end(!0),void(e._m.isReady()&&We(s)&&0<s.length&&e._pushReport(i));a.setMessage("res:".concat(JSON.stringify(n))).end(!0),Oe.e("".concat(t," failed. error:").concat(JSON.stringify(n)))}))):Oe.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!ut(this._pushPlugin)&&Je(this._pushPlugin.getDeviceType))return e=(this._pushPlugin.getDeviceType()||{}).deviceType,Oe.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,".").concat("_setToken"),n=this.get(12),o=1,i="",s="",a=(Be(this._deviceToken)&&(o=0),this.getUniAppPlatform()),r=this.getDeviceBrand(),c=(a===A.IOS||a===A.IPAD||a===A.MAC?s=this._deviceToken:a===A.ANDROID&&(i=this._deviceToken),a=t({tokenID:i,pushMsg:o,sdkAppID:n.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:r,deviceToken:s,isWebUniapp:this._isWebUniapp},this._deviceInfo),new eo("_setToken"));i="data:".concat(JSON.stringify(a)),c.setMessage("".concat(i)),Oe.l("".concat(e," ").concat(i)),this.req({P:xn.SET_TOKEN,data:a}).then((function(){c.end(),Oe.w("".concat(e," ok"))})).catch((function(t){c.setError(t).end(),Oe.e("".concat(e," failed. error:"),t),In(t)}))}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach((function(t){t.type===S.CONV_C2C&&(e._c2cUnreadCount+=t.unreadCount),t.type===S.CONV_GROUP&&(e._groupUnreadCount+=t.unreadCount)}))}},{key:"_onBackground",value:function(){var e=this,t="".concat(this._n,".").concat("_onBackground"),n=new eo("_onBackground");this.req({P:xn.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then((function(){n.setMessage("c2cUnreadCount:".concat(e._c2cUnreadCount," groupUnreadCount:").concat(e._groupUnreadCount)).end(),Oe.l("".concat(t," ok"))})).catch((function(e){n.setError(e).end(),Oe.e("".concat(t," failed. error:"),e)}))}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),t=new eo("_onForeground");this.req({P:xn.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then((function(){t.end(),Oe.l("".concat(e," ok"))})).catch((function(n){t.setError(n).end(),Oe.e("".concat(e," failed. error:"),n)}))}},{key:"_pushReport",value:function(e){var t=this,n="".concat(this._n,".").concat("_pushReport"),o=new eo("_pushReport");this.req({P:xn.PUSH_REPORT,data:{eventList:e.eventList}}).then((function(){o.end(),t._notifyReportSuccess(e)})).catch((function(e){o.setError(e).end(),Oe.e("".concat(n," failed. error:"),e)}))}},{key:"_notifyReportSuccess",value:function(e){!ut(this._pushPlugin)&&Je(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(e),Oe.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,t=this.getDeviceBrand();return"ios"===e?A.IOS:"android"===e?A.ANDROID:1002===t?A.IPAD:1001===t?A.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,Oe.l("".concat(this._n,".reset"))}}]),Ar),cr=(r(Lr,Nn),Pa=g(Lr),s(Lr,[{key:"init",value:function(){var e=this.get(18).getPlugin("tim-profanity-filter-plugin");e&&(this._plugin=new e({logger:Oe,isArray:We,isMap:He,isDevMode:this.isDevMode()}),this._getLexicon())}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,t){var n=!0;if(!this._plugin||!this._canIUseLexicon)return n;if(t&&t.messageControlInfo&&!0===t.messageControlInfo.excludedFromContentModeration)return n;t=e.type;var o=e.conversationType;if(t!==S.MSG_TEXT&&t!==S.MSG_CUSTOM)return n;var i,s="".concat(this._n,".filterMessage");if(Oe.l("".concat(s)),t===S.MSG_TEXT){if(o===S.CONV_C2C?i="c2c_text_message":o===S.CONV_GROUP&&(i="group_text_message"),!this._isConfigOn(i))return n;var a=(r=this._plugin.filter(e.payload.text)).type,r=r.modifiedText;1===a?n=!1:2===a&&(e.payload.text=r)}else if(t===S.MSG_CUSTOM){if(o===S.CONV_C2C?i="c2c_custom_message":o===S.CONV_GROUP&&(i="group_custom_message"),!this._isConfigOn(i))return n;a=this._plugin.filter(e.payload.data),r=this._plugin.filter(e.payload.description),t=this._plugin.filter(e.payload.extension),1===a.type||1===r.type||1===t.type?n=!1:(2===a.type&&(e.payload.data=a.modifiedText),2===r.type&&(e.payload.description=r.modifiedText),2===t.type&&(e.payload.extension=t.modifiedText))}return Oe.l("".concat(s," done. isAllowedToSend:").concat(n)),n}},{key:"filterText",value:function(e,t){var n="".concat(this._n,".filterText"),o={isAllowedToSend:!0,modifiedText:e};return this._plugin&&this._canIUseLexicon&&this._isConfigOn(t)?(Oe.l("".concat(n)),e=(t=this._plugin.filter(e)).type,t=t.modifiedText,1===e?o.isAllowedToSend=!1:2===e&&(o.modifiedText=t),Oe.l("".concat(n," done. ret:"),o),o):o}},{key:"_getLexicon",value:function(){var e=this,t=new eo("profanityFilter"),n="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({P:xn.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then((function(o){var i=(o=o.data).errorInfo,s=o.filterConfig,a=o.lexicon,r=o.strToken,c=o.completeFlag,u=o.nextStartIndex,l=o.version,d=(o=o.expiredTime,i.errorCode),p=i.errorMessage;return 0!==d?(e._isFetching=!1,Oe.w("".concat(n," failed. error:"),i),void t.setCode(d).setMessage(p).end()):(e._onFilterConfig(s),e._getToken(r),1===c?(Oe.l("".concat(n," done. version:").concat(l," expiredTime:").concat(o)),e._version=l,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*o,void e._plugin.onLexiconCompleted(a)):(e._startIndex=u,e._plugin.onLexiconSliced(a),void e._getLexicon()))})).catch((function(o){t.setError(o).end(),e._isFetching=!1,Oe.l("".concat(n," failed. error:"),o)}))}},{key:"_onFilterConfig",value:function(e){var t=this;Be(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach((function(n){t._filterConfigMap.set(n,e[n])})),Oe.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return 1===this._filterConfigMap.get(e)}},{key:"_getToken",value:function(e){if(ct(e)){var t=e.length,n="";if(t%2==0)for(var o=0;o<=t-1;o+=2)n=(n+=e[o+1])+e[o];else{for(var i=0;i<t-1;i+=2)n=(n+=e[i+1])+e[i];n+=e[t-1]}this._plugin.onToken(n)}}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),Lr),ur=(s(Rr,[{key:"_onCloudConfig",value:function(){var e=this,t=this._m.get(23).getCloudConfig("rtc_cmd");ut(t)||((t=JSON.parse(t)).forEach((function(t){e._TRTCCommandList.includes(t)||e._TRTCCommandList.push(t)})),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var e,t=0,n=this._TRTCCommandList.length;t<n;t++)e=this._TRTCCommandList[t].split(".")[0],this._TRTCCommandMap.set(e,1)}},{key:"onRoomCustomDataReceived",value:function(e){this._m.getOEmitInst().emit(E.ROOM_CUSTOM_DATA_RECEIVED,e)}},{key:"sendTRTCCustomData",value:function(e){var t=e.serviceCommand,n=(e=e.data,"".concat(b.NAME.TUIROOM_SVR,".*"));return ut(t)||(n=t),this._isValidServiceCommand(n)?this._trans({servcmd:n,data:e}):In({code:wn.INVALID_TRTC_CMD})}},{key:"_trans",value:function(e){Oe.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var t=e.servcmd;return e=e.data,this._m.get(20).trans({servcmd:t,data:ct(e)?JSON.parse(e):e})}},{key:"_isValidServiceCommand",value:function(e){return e.endsWith(".*")?this._TRTCCommandList.includes(e):(e=e.split(".")[0],this._TRTCCommandMap.has(e))}},{key:"isTRTCCommand",value:function(e){return e=e.split(".")[0],this._TRTCCommandMap.has(e)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset"))}}]),Rr),lr=(s(kr,[{key:"_init",value:function(){var e,t=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(t){try{e=JSON.parse(t)}catch(n){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),Oe.w("".concat(this._n,"._init error:"),n)}e&&(this._needToUpdate(e)?this._fetch():this._fillMap(e.message))}else this._fetch()}},{key:"_needToUpdate",value:function(e){var t=e.localSavedTime;return e=e.localSavedVersion,t=t&&(new Date).getTime()-t>=this.STORAGE_EXPIRES_TIME,e=!e||"3.4.8"!==e,Oe.l("".concat(this._n,"._needToUpdate isTimeout:").concat(t," isDifferentVersion:").concat(e)),t||e}},{key:"_fetch",value:function(){var e,t,n,o,i,s;this._m.get(12).isPrivateNetWork()||(e="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.6/tim-error-message.txt",t="application/x-www-form-urlencoded;charset=UTF-8",n="".concat(this._n,"._fetch ok in"),o=this,Z?ne.request({url:e,method:"GET",timeout:3e3,header:{"content-type":t},dataType:"text",success:function(e){o._fillAndSave(e.data),Oe.l("".concat(n," mini program"))},fail:function(){}}):(i=new XMLHttpRequest,s=setTimeout((function(){i.abort()}),3e3),i.onreadystatechange=function(){4===i.readyState&&(clearTimeout(s),200!==i.status&&304!==i.status||(Oe.l("".concat(n," browser")),o._fillAndSave(i.responseText)))},i.open("GET",e,!0),i.setRequestHeader("Content-type",t),i.send()))}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:(new Date).getTime(),localSavedVersion:"3.4.8"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var t,n,o=e.split(";\n"),i=o.length,s=new RegExp(/'/g),a=0;a<i;a++)if(n=o[a].indexOf(":"),t=o[a].slice(0,n),n=o[a].slice(n+1,o[a].length),!t.startsWith("//")){if(ut(n))continue;this._map.set(t,n.replace(s,""))}}},{key:"get",value:function(e){var t=e.isIntl,n=e.key,o=e.replacement1;return e=e.replacement2,t="".concat(n,t?"_en":"_cn"),!this._map.has(t)&&this._map.has(n)&&(t=n),n="",this._map.has(t)&&(n=this._map.get(t),ut(o)||(n=n.replace("$replacement1",o)),ut(e)||(n=n.replace("$replacement2",e))),n}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset"))}}]),kr),dr=(s(Dr,[{key:"onNewMessageList",value:function(e){var t=this;e.forEach((function(e){var n=t.getPayloadData(e);n&&t._handleActionType(n,e)}))}},{key:"onMessageModified",value:function(e){var t=this;e.forEach((function(e){var n=t.getPayloadData(e);n&&t._onInvitationModified(n,e)}))}},{key:"getPayloadData",value:function(e){var t="".concat(this._n,".getPayloadData");e=e.payload.data;try{return JSON.parse(e)}catch(n){return Oe.e("".concat(t," JSON parse error. signalingData:").concat(e)),null}}},{key:"_handleActionType",value:function(e,t){switch(e.actionType){case D.ACTION_TYPE_INVITE:this._onNewInvitationReceived(e,t);break;case D.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(e);break;case D.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(e);break;case D.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(e);break;case D.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(e)}}},{key:"_genBaseEmitData",value:function(e){return{inviteID:e.inviteID,inviter:e.inviter,groupID:e.groupID,data:e.data||""}}},{key:"_onNewInvitationReceived",value:function(e,n){var o="".concat(this._n,"._onNewInvitationReceived"),i=e.inviteID,s=e.inviteeList,a=e.groupID,r=e.inviter,c=this._sigM.getMyUserID(),u=s.includes(c),l=e.timeout,d=(Ce().getTime()-1e3*n.time)/1e3;0<l&&0<d&&d<l&&(l-=d),o="".concat(o," myselfIncluded:").concat(u," groupID:").concat(a," signalObj:").concat(JSON.stringify(e)),Oe.l("".concat(o," timeout:").concat(l,"s delta:").concat(d,"s")),(a&&u||!a)&&((o=this._sigM.getInviteInfo(i))&&o===e||(o||this._sigM.setInviteInfo(i,t(t({},e),{},{message:n})),this._sigM.emitEvent(D.NEW_INVITATION_RECEIVED,t(t({},this._genBaseEmitData(e)),{},{inviteeList:s})),r!==c&&this._sigM.startTimer(t(t({},e),{},{timeout:l}))))}},{key:"_onInviteeRejected",value:function(e){var n="".concat(this._n,"._onInviteeRejected"),o=e.inviteID,i=e.inviter,s=e.groupID,a=this._sigM.hasInviteInfo(o);Oe.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(a," inviter:").concat(i," groupID:").concat(s)),a&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(D.INVITEE_REJECTED,t(t({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(e){var n="".concat(this._n,"._onInviteeAccepted"),o=e.inviteID,i=e.inviter,s=e.groupID,a=this._sigM.hasInviteInfo(o);Oe.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(a," inviter:").concat(i," groupID:").concat(s)),a&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(D.INVITEE_ACCEPTED,t(t({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(e){var t="".concat(this._n,"._onInvitationCancelled"),n=e.inviteID,o=e.inviter,i=e.groupID,s=this._sigM.hasInviteInfo(n);Oe.l("".concat(t," inviteID:").concat(n," hasInviteID:").concat(s," inviter:").concat(o," groupID:").concat(i)),s&&(this._sigM.deleteInviteInfo(n),this._sigM.emitEvent(D.INVITATION_CANCELLED,this._genBaseEmitData(e)))}},{key:"_onInvitationTimeout",value:function(e){var n="".concat(this._n,"._onInvitationTimeout"),o=e.inviteID,i=e.inviter,s=e.groupID,a=e.inviteeList,r=this._sigM.hasInviteInfo(o);Oe.l("".concat(n," inviteID:").concat(o," hasInviteID:").concat(r," inviter:").concat(i," groupID:").concat(s,"  data:").concat(e.data)),r&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(D.INVITATION_TIMEOUT,t(t({},this._genBaseEmitData(e)),{},{inviteeList:a,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(e,n){var o="".concat(this._n,"._onInvitationModified"),i=e.inviteID,s=e.data;Oe.l("".concat(o," inviteID:").concat(i," data:").concat(s)),this._sigM.setInviteInfo(i,t(t({},e),{},{message:n})),this._sigM.emitEvent(D.INVITATION_MODIFIED,{inviteID:i,data:s})}}]),Dr),pr=(s(Sr,[{key:"generateInviteID",value:function(){var e,t=(t=Aa)((e=La)(32),8)+"-"+t(e(16),4)+"-"+t(16384|e(12),4)+"-"+t(32768|e(14),4)+"-"+t(e(48),12);return Oe.l("".concat(this._n,".generateInviteID inviteID:").concat(t)),t}},{key:"createInviteInfo",value:function(e){var n=this.generateInviteID(),o=(e=this.createInviteCustomData(t(t({},e),{},{inviteID:n}))).groupID,i=e.inviteeList;return o=o||i[0],{customData:e,message:this._sigM.createSignaling(e,o),inviteID:n}}},{key:"_genBaseCustomData",value:function(e){var t=e.data,n=e.inviteID;return{businessID:1,timeout:0,data:void 0===t?"":t,inviteID:void 0===n?"":n,groupID:void 0===(e=e.groupID)?"":e}}},{key:"createInviteCustomData",value:function(e){var n=e.userID,o=void 0===(o=e.timeout)?0:o,i=void 0===(i=e.groupID)?"":i,s=this._sigM.getMyUserID();return s=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_INVITE,inviter:s,inviteeList:i?e.inviteeList:[n],timeout:o}),Oe.l("".concat(this._n,".createInviteCustomData customData:"),s),s}},{key:"createCancelCustomData",value:function(e){var n,o="".concat(this._n,".createCancelCustomData"),i=e.inviteID,s=this._sigM.getMyUserID(),a=(i=this._sigM.getInviteInfo(i)).inviteeList,r=i.groupID;return(i=i.inviter)===s?n=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_CANCEL_INVITE,groupID:r,inviter:s,inviteeList:a}):Oe.e("".concat(o," unmatched inviter:").concat(i," and my userID:").concat(s)),Oe.l("".concat(o," customData:"),n),n}},{key:"createAcceptCustomData",value:function(e){var n,o="".concat(this._n,".createAcceptCustomData"),i=e.inviteID,s=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(i),r=a.inviter,c=a.groupID;return a.inviteeList.includes(s)?n=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_ACCEPT_INVITE,groupID:c,inviter:r,inviteeList:[s]}):Oe.e("".concat(o," userID:").concat(s," not in inviteeList. inviteID:").concat(i," groupID:").concat(c)),Oe.l("".concat(o," customData:"),n),n}},{key:"createRejectCustomData",value:function(e){var n,o="".concat(this._n,".createRejectCustomData"),i=e.inviteID,s=this._sigM.getMyUserID(),a=this._sigM.getInviteInfo(i),r=a.inviter,c=a.groupID;return a.inviteeList.includes(s)?n=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_REJECT_INVITE,groupID:c,inviter:r,inviteeList:[s]}):Oe.e("".concat(o," userID:").concat(s," not in inviteeList. inviteID:").concat(i," groupID:").concat(c)),Oe.l("".concat(o," customData:"),n),n}},{key:"createTimeoutCustomData",value:function(e){var n="".concat(this._n,".createTimeoutCustomData"),o=e.inviteeList,i=e.inviter,s=void 0!==(s=e.isInviter)&&s,a=this._sigM.getMyUserID();return e=t(t({},this._genBaseCustomData(e)),{},{actionType:D.ACTION_TYPE_INVITE_TIMEOUT,inviter:i,inviteeList:s?o:[a]}),Oe.l("".concat(n," customData:"),e),e}}]),Sr),hr=(s(Er,[{key:"setCloudConfig",value:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:20,t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:300;this.COUNT=e,this.EXPIRED_TIME=t,Oe.l("".concat(this._n,".setCloudConfig count:").concat(e,", time:").concat(t))}},{key:"getHistorySignaling",value:function(){var e=this,t=this._sigM.get(11).getLocalConvList();Be(t)||(this._getC2CSignalingList(),t=this._getValidGroupConvList(t),this._getGroupSignalingList(t).then((function(t){e._handleSignalingList(t)})))}},{key:"_getC2CSignalingList",value:function(){var e=this._sigM.get(6).getMessageListFromUnreadDB();e=this._sigM.filterMessageList(e),this._getRelatedToMeMap(e)}},{key:"_getGroupSignalingList",value:function(e){var t=this;return 0===(e=this._createPromiseList(e)).length?Promise.resolve(this._sortSignaling(this._relatedToMeMap)):this._concurrentGetMessageList(e).then((function(e){var n=new Map;return e.forEach((function(e){e=e.list,e=t._getRelatedToMeMap(e),n=new Map([].concat(m(n),m(e)))})),t._sortSignaling(n)}))}},{key:"_handleSignalingList",value:function(e){Be(e)||this._sigM.onNewMessageList(e)}},{key:"_getValidGroupConvList",value:function(e){for(var t=[],n=0,o=e.length;n<o;n++){var i=(a=e[n]).type,s=a.unreadCount,a=a.lastMessage;i=i===S.CONV_GROUP,a=this._isNotExpired(a),i&&s&&a&&t.push(e[n])}return t}},{key:"_isNotExpired",value:function(e){return!(!e||!e.lastTime)&&e.lastTime>Ee()-this.EXPIRED_TIME}},{key:"_createPromiseList",value:function(e){for(var t=[],n=0;n<e.length;n++){var o=(i=e[n]).conversationID,i=(i=i.unreadCount)<this.COUNT?i:this.COUNT;this._map.set(o,{msgCount:i,list:[]}),i=this._sigM.get(11).getMessageList({conversationID:o}),t.push(i)}return t}},{key:"_concurrentGetMessageList",value:function(e){var t=this,n=[];return Promise.all(e).then((function(e){for(var o=0;o<e.length;o++){var i=(s=e[o]).code,s=s.data;0===i&&0!==s.messageList.length&&(t._handleMessageList(s.messageList),(i=t._relayGetMessageList(s))&&n.push(i))}return 0<n.length?t._concurrentGetMessageList(n):t._map}))}},{key:"_relayGetMessageList",value:function(e){var t=e.messageList,n=e.nextReqMessageID;if(e=e.isCompleted,0===t.length)return null;t=t[0].conversationID;var o=this._map.get(t).msgCount;return 0===o||e?null:this._sigM.get(11).getMessageList({conversationID:t,nextReqMessageID:n,count:o})}},{key:"_handleMessageList",value:function(e){var t=e.length,n=e[0].conversationID,o=(i=this._map.get(n)).msgCount,i=i.list;this._map.set(n,{msgCount:0<o-t?o-t:0,list:i.concat(this._sigM.filterMessageList(e))})}},{key:"_getRelatedToMeMap",value:function(e){for(var t=0;t<e.length;t++){var n=e[t];this._saveRelatedToMe(n)}return this._relatedToMeMap}},{key:"_saveRelatedToMe",value:function(e){var t,n=(t=this._sigM.getPayloadData(e)||{}).actionType,o=void 0===(t=t.inviteID)?"":t;switch(void 0===n?"":n){case D.ACTION_TYPE_INVITE:this._setHistoryInvite(e);break;case D.ACTION_TYPE_REJECT_INVITE:case D.ACTION_TYPE_ACCEPT_INVITE:this._updateHistoryInvite(e);break;case D.ACTION_TYPE_CANCEL_INVITE:this._delHistoryInvite(o);break;case D.ACTION_TYPE_INVITE_TIMEOUT:this._updateHistoryInvite(e)}}},{key:"_setHistoryInvite",value:function(e){var n=this._sigM.getPayloadData(e)||{},o=void 0===(o=n.inviteID)?"":o,i=void 0===(i=n.inviteeList)?[]:i,s=void 0===(s=n.timeout)?0:s,a=this._sigM.getMyUserID();i.includes(a)&&(i=Ee()-e.time,0<s&&s<i&&0!==s||this._relatedToMeMap.set(o,t(t({},n),{},{messageList:[e]})))}},{key:"_delHistoryInvite",value:function(e){this._relatedToMeMap.has(e)&&this._relatedToMeMap.delete(e)}},{key:"_updateHistoryInvite",value:function(e){var t=void 0===(t=(i=this._sigM.getPayloadData(e)||{}).inviteID)?"":t,n=void 0===(i=i.inviteeList)?[]:i;if(this._relatedToMeMap.has(t)){for(var o=(i=this._relatedToMeMap.get(t)).inviteeList,i=i.messageList,s=0;s<n.length;s++){var a=n[s];o.includes(a)&&o.splice(o.indexOf(a),1)}0===o.length?this._delHistoryInvite(t):i.push(e)}else this._delHistoryInvite(t)}},{key:"_sortSignaling",value:function(e){var t=[];return e.forEach((function(e){t=[].concat(m(t),m(e.messageList))})),t.sort((function(e,t){return e.time-t.time}))}},{key:"reset",value:function(){this._map.clear(),this._relatedToMeMap.clear()}}]),Er),gr=s((function e(t,n){o(this,e),this.businessID=t.businessID||1,this.inviteID=t.inviteID,this.groupID=t.groupID||"",this.inviter=t.inviter||"",this.inviteeList=t.inviteeList||[],this.data=t.data||"",this.actionType=t.actionType||D.ACTION_TYPE_INVITE,this.timeout=t.timeout||0})),_r=["message"],fr=["message"],mr=(r(Tr,Nn),Na=g(Tr),s(Tr,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isCloudConfigCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isCloudConfigCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onCloudConfig",value:function(){this._isCloudConfigCompleted=!0;var e=this.getCloudConfig("history_s_count"),t=this.getCloudConfig("history_s_time");ut(e)||(e=Number(e)),ut(t)||(t=Number(t)),this._historySignalingHandler.setCloudConfig(e,t),this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"_isListenerExisted",value:function(){return-1<this._m.getOEmitInst().eventNames().indexOf(D.NEW_INVITATION_RECEIVED)}},{key:"onReady",value:function(){this._isSyncCompleted=!0;var e=this._isListenerExisted();Oe.l("".concat(this._n,".onReady. isListenerExisted: ").concat(e)),e&&this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onNewMessageList(e)}},{key:"onMessageModified",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onMessageModified(e)}},{key:"hasInviteInfo",value:function(e){return this._inviteInfoMap.has(e)}},{key:"getInviteInfo",value:function(e){return this._inviteInfoMap.get(e)}},{key:"setInviteInfo",value:function(e,n){var o=n.message;n=p(n,_r),Oe.l("".concat(this._n,".setInviteInfo inviteID:").concat(e," data:"),n),this._inviteInfoMap.set(e,t(t({},n),{},{message:o}))}},{key:"deleteInviteInfo",value:function(e){this.hasInviteInfo(e)&&(Oe.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(e,".")),this._inviteInfoMap.delete(e))}},{key:"updateInviteInfo",value:function(e){var t="".concat(this._n,".updateInviteInfo"),n=e.inviteID,o=e.inviter,i=e.inviteeList;e=e.groupID,Oe.l("".concat(t," inviteID:").concat(n," inviter:").concat(o," groupID:").concat(e)),e&&this.hasInviteInfo(n)?(o=i[0],(e=this.getInviteInfo(n).inviteeList).includes(o)&&(e.splice(e.indexOf(o),1),Oe.l("".concat(t," remove ").concat(o,". localInviteeList.length:").concat(e.length))),0===e.length&&this.deleteInviteInfo(n)):this.deleteInviteInfo(n)}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(e,t){this.emitOEvt(e,t)}},{key:"addSignalingListener",value:function(e,t,n){this._canIUseSignaling||(this._canIUseSignaling=!0),this._m.getOEmitInst().on(e,t,n)}},{key:"removeSignalingListener",value:function(e,t,n){this._m.getOEmitInst().off(e,t,n),this._isListenerExisted()||(this._canIUseSignaling=!1)}},{key:"invite",value:function(e){var n=this,o="".concat(this._n,".").concat("invite"),i=this._localSignalingHandler.createInviteInfo(e),s=i.message,a=i.customData,r=i.inviteID;return Oe.l("".concat(o," options:").concat(JSON.stringify(e)," inviteID:").concat(r)),this.sendSignaling(s,e).then((function(e){return e&&0===e.code?(n.setInviteInfo(r,t(t({},a),{},{message:s})),n.startTimer(t(t({},a),{},{inviteID:r})),t(t({},e),{},{inviteID:r})):e})).catch((function(e){return In(e)}))}},{key:"inviteSync",value:function(e,n,o){var i=this,s="".concat(this._n,".").concat("inviteSync"),a=this._localSignalingHandler.createInviteInfo(e),r=a.message,c=a.customData,u=a.inviteID;return Oe.l("".concat(s," options:").concat(JSON.stringify(e)," inviteID:").concat(u)),this.sendSignaling(r,e).then((function(e){if(e&&0===e.code)return i.setInviteInfo(u,t(t({},c),{},{message:r})),i.startTimer(t(t({},c),{},{inviteID:u})),n&&n({inviteID:u}),{inviteID:u};o&&o(0===e.code,e.message||"")})).catch((function(e){return o&&o(e.code,e.message),In(e)})),u}},{key:"_handleImResponse",value:function(e,t,n){t&&0===t.code&&(this._isHandling=!1,n?this.deleteInviteInfo(e.inviteID):this.updateInviteInfo(e))}},{key:"cancel",value:function(e){var n=this,o="".concat(this._n,".").concat("cancel");if(Oe.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:wn.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var i=this._localSignalingHandler.createCancelCustomData(e);if(!i)return this._isHandling=!1,In({code:wn.SIGNALING_NO_PERMISSION});o=i.groupID;var s=i.inviteeList;return o=o||s[0],s=this.createSignaling(i,o),this.sendSignaling(s,e).then((function(o){return n._handleImResponse(i,o,!0),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return In(e)}))}},{key:"accept",value:function(e){var n=this,o="".concat(this._n,".").concat("accept");if(Oe.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:wn.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var i=this._localSignalingHandler.createAcceptCustomData(e);return i?(o=this.createSignaling(i),this.sendSignaling(o,e).then((function(o){return n._handleImResponse(i,o),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return In(e)}))):(this._isHandling=!1,In({code:wn.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(e){var n=this,o="".concat(this._n,".").concat("reject");if(Oe.l("".concat(o," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:wn.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var i=this._localSignalingHandler.createRejectCustomData(e);return i?(o=this.createSignaling(i),this.sendSignaling(o,e).then((function(o){return n._handleImResponse(i,o,!0),0===o.code?t(t({},o),{},{inviteID:e.inviteID}):o})).catch((function(e){return In(e)}))):(this._isHandling=!1,In({code:wn.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(e){var t="".concat(this._n,".getSignalingInfo"),n=e.ID,o=e.from,i=e.to,s=this._filterSignaling(e),a=null;return s&&(e=this.getPayloadData(e),a=new gr(e)),e=s?"actionType:".concat(a.actionType):"",Oe.l("".concat(t," messageID:").concat(n," from:").concat(o," to:").concat(i," ")+"".concat(e," isSignaling:").concat(s)),a}},{key:"modifyInvitation",value:function(e){var n=this,o=e.inviteID,i=e.data;if(!this.hasInviteInfo(e.inviteID)||this._isHandling)return In({code:wn.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var s=(e=this.getInviteInfo(o)).message,a=p(e,fr),r=s.payload.data;return a.data=i,s.payload.data=JSON.stringify(a),this.get(2).modifyRemoteMessage(s).then((function(e){return n.setInviteInfo(o,t(t({},a),{},{message:s})),n._isHandling=!1,e})).catch((function(e){return n._isHandling=!1,s.payload.data=r,In(e)}))}},{key:"_genMsgCtrlInfo",value:function(){var e=void 0===(e=(i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).data)?"":e,t=i.onlineUserOnly,n=void 0===(n=i.inviteID)?"":n,o=i.offlinePushInfo,i=i.actionType,s={_onlineOnlyFlag:!1};return n={onlineUserOnly:(s=n&&this.getInviteInfo(n)?this.getInviteInfo(n).message:s)._onlineOnlyFlag||t||!1,offlinePushInfo:o,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}},i===D.ACTION_TYPE_INVITE_TIMEOUT?(s=!!e.match(/excludeTimeoutSignalingFromHistoryMessage/),n.messageControlInfo.excludedFromUnreadCount=s,n.messageControlInfo.excludedFromLastMessage=s,n):(t=!!e.match(/excludeFromHistoryMessage/),o=!!e.match(/excludeOriginalSignalingFromHistoryMessage/),n.messageControlInfo.excludedFromUnreadCount=t||o,n.messageControlInfo.excludedFromLastMessage=t||o,n)}},{key:"sendSignaling",value:function(e,t){var n=this;return this.get(2).sendMessageInstance(e,this._genMsgCtrlInfo(t)).catch((function(e){return n._isHandling=!1,In(e)}))}},{key:"filterMessageList",value:function(e){var t=this;return e.filter((function(e){return t._filterSignaling(e)}))}},{key:"getPayloadData",value:function(e){return this._remoteSignalingHandler.getPayloadData(e)}},{key:"createSignaling",value:function(e,t){var n=e.groupID,o=e.inviter;return t={to:t||n||o,conversationType:n?S.CONV_GROUP:S.CONV_C2C,priority:S.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(e)}},o=this.get(2).createCustomMessage(t),Oe.l("".concat(this._n,".createSignaling. message:"),o),o}},{key:"_filterSignaling",value:function(e){var t,n,o=!1;return e.type&&e.type===S.MSG_CUSTOM&&(t=e.cloudCustomData,e=void 0===(e=e.payload.data)?"":e,t=(void 0===t?"":t).match(/"type":"tsignaling"/),n=e.match(/inviteID/),e=e.match(/actionType/),o=t||n&&e),!!o}},{key:"startTimer",value:function(e){var t,n,o,i=this,s="".concat(this._n,".startTimer"),a=e.timeout,r=e.inviteID,c=e.inviter,u=e.groupID,l=c===this.getMyUserID();Oe.l("".concat(s," timeout:").concat(a," isInviter:").concat(l," groupID:").concat(u)),a<=0||(t=l?a+5:a,n=1,o=setInterval((function(){var a=i._hasLocalInviteInfo(e,l);n<t&&a?++n:(a&&i._sendTimeoutNotice(r,l),Oe.l("".concat(s," end.")),clearInterval(o))}),1e3))}},{key:"_hasLocalInviteInfo",value:function(e,t){var n=e.inviteID;if(e=e.groupID,!this.hasInviteInfo(n))return!1;var o="".concat(this._n,"._hasLocalInviteInfo"),i=this.getInviteInfo(n).inviteeList;return Oe.l("".concat(o," inviteID:").concat(n," inviteeList:").concat(i," groupID:").concat(e)),!e||(t?0<i.length:0<i.length&&i.includes(this.getMyUserID()))}},{key:"_getReceiver",value:function(e,t){var n=t.groupID,o=t.inviteeList;return t=t.inviter,e?n||o[0]:n||t}},{key:"_sendTimeoutNotice",value:function(e,n){var o=this,i=this.getInviteInfo(e),s=this._getReceiver(n,i),a=(Oe.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(e," to:").concat(s," isInviter:").concat(n)),this._localSignalingHandler.createTimeoutCustomData(t(t({},i),{},{isInviter:n}))),r=this.createSignaling(a,s);return this.sendSignaling(r,a).then((function(t){var i,s,c;t&&0===t.code&&(t=a.data,i=a.groupID,s=a.inviteeList,c=a.inviter,o.emitEvent(D.INVITATION_TIMEOUT,{data:t,groupID:i,inviteID:e,inviteeList:s,inviter:c,isSelfTimeout:!0,message:r}),n?o.deleteInviteInfo(e):o.updateInviteInfo(a))}))}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1,this._isCloudConfigCompleted=!1}}]),Tr),vr=["followDiffList"],yr={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},Ir=(r(Cr,Nn),Oa=g(Cr),s(Cr,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("follow_req_count");ut(e)||(e=Number(e),this.DEFAULT_COUNT=e>this.MAX_COUNT?this.MAX_COUNT:e,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList(),this._followType.clear()}},{key:"onFollowNotify",value:function(e){var t=this;e=e.dataList||[],Oe.l("".concat(this._n,".onFollowNotify followChangeList:").concat(e.length)),e.forEach((function(e){var n=void 0===(n=e.followDiffList)?[]:n,o=p(e,vr);n.forEach((function(e){var n=e.isAdd,i=(e=void 0===(e=e.followType)?[]:e,t._initFollowInfo());i[e].userInfoList.push(o),i[e].isAdd=1===n,t._emitEvent(i)}))}))}},{key:"_initFollowInfo",value:function(){var e={};return Object.values(yr).forEach((function(t){t!==yr.NONE&&(e[t]={userInfoList:[],isAdd:!1})})),e}},{key:"_emitEvent",value:function(e){var t=this;Object.keys(e).forEach((function(n){n=Number(n);var o=e[n];0<o.userInfoList.length&&(n===yr.FOLLOWERS&&(t._clearFollowList(yr.FOLLOWERS),t.emitOEvt(E.MY_FOLLOWERS_LIST_UPDATED,o)),n===yr.FOLLOWING&&(t._clearFollowList(yr.FOLLOWING),t.emitOEvt(E.MY_FOLLOWING_LIST_UPDATED,o)),n===yr.MUTUAL&&(t._clearFollowList(yr.MUTUAL),t.emitOEvt(E.MUTUAL_FOLLOWERS_LIST_UPDATED,o)))}))}},{key:"followUser",value:function(e){if(!this.canIUse(U.FOLLOW))return this.noUse("followUser");var t="".concat(this._n,".").concat("followUser"),n="userIDList:".concat(e.length),o=new eo("followUser");return o.setMessage(n),Oe.l("".concat(t," ").concat(n)),this.req({P:xn.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e.map((function(e){return{userID:e}}))}}).then((function(e){return o.end(),Oe.l("".concat(t," ok.")),vn(e.data.resultList)})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"unfollowUser",value:function(e){if(!this.canIUse(U.FOLLOW))return this.noUse("unfollowUser");var t="".concat(this._n,".").concat("unfollowUser"),n="userIDList:".concat(e.length),o=new eo("unfollowUser");return o.setMessage(n),Oe.l("".concat(t," ").concat(n)),this.req({P:xn.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then((function(e){return o.end(),Oe.l("".concat(t," ok.")),vn(e.data.resultList)})).catch((function(e){return o.setError(e).end(),Oe.e("".concat(t," failed. error:"),e),In(e)}))}},{key:"getMyFollowersList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMyFollowersList";if(!this.canIUse(U.FOLLOW))return this.noUse(o);var i=n||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(i)){var s=(r=this._myFollowersList.get(i)).resultList,a=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<s.length)return Oe.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),yn({resultList:s,nextCursor:a})}return this._getFollowList(n,yr.FOLLOWERS).then((function(s){return e._myFollowersList.set(i,t(t({},s),{},{lastUpdateTime:Date.now()})),Oe.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),vn(s)}))}},{key:"getMyFollowingList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMyFollowingList";if(!this.canIUse(U.FOLLOW))return this.noUse(o);var i=n||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(i)){var s=(r=this._myFollowingList.get(i)).resultList,a=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<s.length)return Oe.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),yn({resultList:s,nextCursor:a})}return this._getFollowList(n,yr.FOLLOWING).then((function(s){return e._myFollowingList.set(i,t(t({},s),{},{lastUpdateTime:Date.now()})),Oe.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),vn(s)}))}},{key:"getMutualFollowersList",value:function(){var e=this,n=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"",o="getMutualFollowersList";if(!this.canIUse(U.FOLLOW))return this.noUse(o);var i=n||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(i)){var s=(r=this._myMutualFollowersList.get(i)).resultList,a=r.nextCursor,r=r.lastUpdateTime;if(Date.now()-r<this.MAX_CATCH_TIME&&0<s.length)return Oe.l("".concat(this._n,".").concat(o," nextCursor:").concat(n," from local.")),yn({resultList:s,nextCursor:a})}return this._getFollowList(n,yr.MUTUAL).then((function(s){return e._myMutualFollowersList.set(i,t(t({},s),{},{lastUpdateTime:Date.now()})),Oe.l("".concat(e._n,".").concat(o," nextCursor:").concat(n," from remote.")),vn(s)}))}},{key:"_getFollowList",value:function(e,n){var o=this,i=new eo("_getFollowList");return i.setMessage("nextCursor:".concat(e," type:").concat(n)),this.req({P:xn.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:e,type:n}}).then((function(e){i.end();var n=void 0===(n=(e=e.data).resultList)?[]:n,s=(e=void 0===(e=e.nextCursor)?"":e,[]);return n.forEach((function(e){var n=e.userID,i=e.followTime;e=e.profileList,s.push(t({userID:n,followTime:i},o._handleProfileItem(void 0===e?[]:e)))})),{resultList:s,nextCursor:e}})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(o._n,"._getFollowList failed. error:"),e),In(e)}))}},{key:"_handleProfileItem",value:function(e){var t={};return e.forEach((function(e){switch(e.tag){case Pe.NICK:t.nick=e.value;break;case Pe.GENDER:t.gender=e.value;break;case Pe.BIRTHDAY:t.birthday=e.value;break;case Pe.LOCATION:t.location=e.value;break;case Pe.SELFSIGNATURE:t.selfSignature=e.value;break;case Pe.ALLOWTYPE:t.allowType=e.value;break;case Pe.LANGUAGE:t.language=e.value;break;case Pe.AVATAR:t.avatar=e.value;break;case Pe.MESSAGESETTINGS:t.messageSettings=e.value;break;case Pe.ADMINFORBIDTYPE:t.adminForbidType=e.value;break;case Pe.LEVEL:t.level=e.value;break;case Pe.ROLE:t.role=e.value;break;default:t[e.tag]=e.value}})),t}},{key:"getUserFollowInfo",value:function(e){if(!this.canIUse(U.FOLLOW))return this.noUse("getUserFollowInfo");var t=e,n=!1,o=(ut(e)&&(t=[this.getMyUserID()],n=!0),"".concat(this._n,".").concat("getUserFollowInfo")),i=(e="userIDList:".concat(t.length," isGetMyFollowInfo:").concat(n),new eo("getUserFollowInfo"));return i.setMessage(e),Oe.l("".concat(o," ").concat(e)),this.req({P:xn.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then((function(e){i.end(),Oe.l("".concat(o," ok.")),e=e.data.followInfoList;var t=[];return(void 0===e?[]:e).forEach((function(e){var n=e.followersCount,o=e.followingCount;e=e.mutualFollowersCount,t.push({followersCount:n,followingCount:o,mutualFollowersCount:e})})),vn(t)})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(o," failed. error:"),e),In(e)}))}},{key:"checkFollowType",value:function(e){var t=this;if(!this.canIUse(U.FOLLOW))return this.noUse("checkFollowType");100<e.length&&(e=e.slice(0,100),Oe.w("".concat(n," ").concat(qt(100))));var n="".concat(this._n,".").concat("checkFollowType"),o="userIDList length:".concat(e.length," "),i=new eo("checkFollowType"),s=(i.setMessage(o),Oe.l("".concat(n," ").concat(o)),[]),a=[];return e.forEach((function(e){var n;t._followType.has(e)?(n=t._followType.get(e),s.push({userID:e,followType:n})):a.push(e)})),Oe.l("".concat(n," from local count:").concat(s.length,", from remote count:").concat(a.length,".")),0===a.length?yn(s):this.req({P:xn.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:a}}).then((function(e){return i.end(),Oe.l("".concat(n," ok.")),(void 0===(e=e.data.resultList)?[]:e).forEach((function(e){var n=e.userID;e=e.followType,t._setFollowType(n,e),s.push({userID:n,followType:e})})),vn(s)})).catch((function(e){return i.setError(e).end(),Oe.e("".concat(n," failed. error:"),e),In(e)}))}},{key:"_setFollowType",value:function(e,t){this._followType.set(e,t)}},{key:"_clearFollowList",value:function(e){if(ut(e))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();e!==yr.FOLLOWERS?e!==yr.FOLLOWING?e!==yr.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._clearFollowList(),this._followType.clear()}}]),Cr),Mr=ys((function(e,t){var o="undefined"!=typeof Uint8Array&&"undefined"!=typeof Uint16Array&&"undefined"!=typeof Int32Array;t.assign=function(e){for(var t,o,i=Array.prototype.slice.call(arguments,1);i.length;){var s=i.shift();if(s){if("object"!==n(s))throw new TypeError(s+"must be non-object");for(var a in s)t=s,o=a,Object.prototype.hasOwnProperty.call(t,o)&&(e[a]=s[a])}}return e},t.shrinkBuf=function(e,t){return e.length===t?e:e.subarray?e.subarray(0,t):(e.length=t,e)};var i={arraySet:function(e,t,n,o,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),i);else for(var s=0;s<o;s++)e[i+s]=t[n+s]},flattenChunks:function(e){for(var t,n,o,i=0,s=0,a=e.length;s<a;s++)i+=e[s].length;for(o=new Uint8Array(i),s=t=0,a=e.length;s<a;s++)n=e[s],o.set(n,t),t+=n.length;return o}},s={arraySet:function(e,t,n,o,i){for(var s=0;s<o;s++)e[i+s]=t[n+s]},flattenChunks:function(e){return[].concat.apply([],e)}};t.setTyped=function(e){e?(t.Buf8=Uint8Array,t.Buf16=Uint16Array,t.Buf32=Int32Array,t.assign(t,i)):(t.Buf8=Array,t.Buf16=Array,t.Buf32=Array,t.assign(t,s))},t.setTyped(o)}));function Cr(e){return o(this,Cr),(e=Oa.call(this,e))._n="FollowModule",e._myFollowersList=new Map,e._myFollowingList=new Map,e._myMutualFollowersList=new Map,e._followType=new Map,e.MAX_CATCH_TIME=6e5,e.FIRST_PAGE_INDEX=ot(),e.DEFAULT_COUNT=500,e.MAX_COUNT=1e3,e.getIEmitInst().on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function Tr(e){o(this,Tr),(e=Na.call(this,e))._n="SignalingModule",e._inviteInfoMap=new Map,e._canIUseSignaling=!1,e._isHandling=!1,e._remoteSignalingHandler=new dr(h(e)),e._localSignalingHandler=new pr(h(e)),e._historySignalingHandler=new hr(h(e)),e._isC2CUnreadHandleCompleted=!1,e._isConvSyncCompleted=!1,e._isSyncCompleted=!1,e._isCloudConfigCompleted=!1;var t=e.getIEmitInst();return t.on(qo.C2C_UNREAD_HANDLE_COMPLETED,e.onC2CUnreadHandleCompleted,h(e)),t.on(qo.CONV_SYNC_COMPLETED,e.onConvSyncCompleted,h(e)),t.on(qo.CLOUD_CONFIG,e.onCloudConfig,h(e)),e}function Er(e){o(this,Er),this._n="HistorySignalingHandler",this._sigM=e,this.COUNT=20,this.EXPIRED_TIME=300,this._map=new Map,this._relatedToMeMap=new Map}function Sr(e){o(this,Sr),this._n="LocalSignalingHandler",this._sigM=e}function Dr(e){o(this,Dr),this._n="RemoteSignalingHandler",this._sigM=e}function kr(e){o(this,kr),this._m=e,this._n="ErrMsgModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function Rr(e){o(this,Rr),this._m=e,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*","live_engine_pk.*","trtc_ai_service.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getIEmitInst().on(qo.CLOUD_CONFIG,this._onCloudConfig,this)}function Lr(e){return o(this,Lr),(e=Pa.call(this,e))._n="ProfanityFilterModule",e._plugin=null,e._filterConfigMap=new Map,e._startIndex=0,e._version=0,e._canIUseLexicon=!1,e._isFetching=!1,e._expiredTime=0,e}function Ar(e){var t;return o(this,Ar),(t=ba.call(this,e))._m=e,t._n="TIMPushModule",t._pluginName="TIMPush",t._pushPlugin=void 0,t._androidPushConfig={},t._deviceToken="",t._businessID=0,t._iOSBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},t}function Or(e){var t;return o(this,Or),(t=Ua.call(this,e))._m=e,t._n="OfflinePushModule",t._offlinePushPlugin=void 0,t._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},t._deviceToken="",t._businessID=0,t._iosBusinessID=0,t._c2cUnreadCount=0,t._groupUnreadCount=0,t._isWebUniapp=0,t}function Nr(e){o(this,Nr),this._m=e,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new ir(this)}function Pr(e){o(this,Pr),this._commercialConfigM=e,this._n="PurchasedFeatureHandler",this._isSCMReported=!1,this._featureMap=new Map}function br(e){return o(this,br),(e=Ga.call(this,e))._n="WorkerTimerModule",e._isWorkerEnabled=!0,e._workerTimer=null,e._timerID=-1,e._init(),e.getIEmitInst().on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function Ur(e){return o(this,Ur),(e=wa.call(this,e))._n="SnsModule",e._friendHandler=new Qa(h(e)),e._friendApplicationHandler=new Xa(h(e)),e._friendGroupHandler=new tr(h(e)),e.getIEmitInst().on(qo.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,h(e)),e}function Gr(e){o(this,Gr),this._snsM=e,this._n="FriendGroupHandler",this._map=new Map}function wr(e){o(this,wr),Be(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}function Fr(e){o(this,Fr),this._snsM=e,this._n="FriendHandler",this._map=new Map,this._startIdx=0,this._standardSeq=0,this._customSeq=0,this._expirationTime=18e4}function xr(e,n){o(this,xr),this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var i={},s=[];if(i.userID=e,!Be(n))for(var a,r="",c=0,u=n.length;c<u;c++)if(r=n[c].tag,a=n[c].value,-1<r.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:r,value:a});else if(-1<r.indexOf("Tag_Profile_Custom"))s.push({key:r,value:a});else switch(r){case Pe.NICK:i.nick=a;break;case Pe.GENDER:i.gender=a;break;case Pe.BIRTHDAY:i.birthday=a;break;case Pe.LOCATION:i.location=a;break;case Pe.SELFSIGNATURE:i.selfSignature=a;break;case Pe.ALLOWTYPE:i.allowType=a;break;case Pe.LANGUAGE:i.language=a;break;case Pe.AVATAR:i.avatar=a;break;case Pe.MESSAGESETTINGS:i.messageSettings=a;break;case Pe.ADMINFORBIDTYPE:i.adminForbidType=a;break;case Pe.LEVEL:i.level=a;break;case Pe.ROLE:i.role=a;break;case be.REMARK:this.remark=a;break;case be.ADDTIME:this.addTime=a;break;case be.GROUP:this.groupList=JSON.parse(JSON.stringify(a));break;case be.ADDSOURCE:this.source=a;break;case be.ADDWORDING:break;default:Oe.l("snsProfileItem unknown tag->",n[c].tag)}this.profile=new ni(t(t({},i),{},{profileCustomField:s}))}function Vr(e){o(this,Vr),this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSeq=0,this._map=new Map,this._unreadCount=0}function qr(e){o(this,qr),(e=Fa.call(this,e))._n="QualityStatModule",e.TAG="im-ssolog-quality-stat",e.reportIndex=0,e.wholePeriod=!1,e._qualityItems=[Vn,qn,Bn,Hn,jn,Kn,Yn,zn,Wn,Jn],e._messageSentItems=[Bn,Hn,jn,Kn,Yn],e._messageReceivedItems=[zn,Wn,Jn],e.REPORT_INTERVAL=120,e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._statInfoArr=[],e._avgRTT=new Ya,e._avgE2EDelay=new Ka,e._rateMessageSent=new za,e._rateMessageReceived=new Wa;var t=e.getIEmitInst();return t.on(qo.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,h(e)),t.on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function Br(){o(this,Br),this._lastMap=new Map,this._currentMap=new Map}function Hr(){o(this,Hr),this._map=new Map}function jr(){o(this,jr),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function Kr(){o(this,Kr),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function Yr(e){return o(this,Yr),(e=xa.call(this,e))._n="RecoverMsgModule",e.PULL_LIMIT_COUNT=15,e}function zr(e){return o(this,zr),(e=Va.call(this,e))._n="CloudControlModule",e._cloudConfig=new Map,e._expiredTime=0,e._version=0,e._isFetching=!1,e}function Wr(e){return o(this,Wr),(e=qa.call(this,e))._n="SessionModule",e._platform=e.getPlatform(),e._pHandler=new _a(h(e)),e._msgDispatcher=new ma(h(e)),e._cmdFreqLimitMap=new Map,e._cmdReqInfoMap=new Map,e._serverOverloadInfoMap=new Map,e._incrementalPullContactFlag=!0,e._init(),e.getIEmitInst().on(qo.CLOUD_CONFIG,e._onCloudConfig,h(e)),e}function Jr(e,t,n,o){for(var i=65535&e,s=e>>>16&65535,a=0;0!==n;){for(n-=a=2e3<n?2e3:n;s=s+(i=i+t[o++]|0)|0,--a;);i%=65521,s%=65521}return i|s<<16}function $r(e,t,n,o){var i=Zr,s=o+n;e^=-1;for(var a=o;a<s;a++)e=e>>>8^i[255&(e^t[a])];return~e}function Xr(e,t,n,o,i,s,a,r){var c,u,l,d,p,h,g,_,f,m=r.bits,v=0,y=0,I=0,M=0,C=0,T=0,E=0,S=0,D=0,k=0,R=null,L=0,A=new Mr.Buf16(16),O=new Mr.Buf16(16),N=null,P=0;for(v=0;v<=15;v++)A[v]=0;for(y=0;y<o;y++)A[t[n+y]]++;for(C=m,M=15;1<=M&&0===A[M];M--);if(M<C&&(C=M),0===M)return i[s++]=20971520,i[s++]=20971520,r.bits=1,0;for(I=1;I<M&&0===A[I];I++);for(C<I&&(C=I),v=S=1;v<=15;v++)if((S=(S<<1)-A[v])<0)return-1;if(0<S&&(0===e||1!==M))return-1;for(O[1]=0,v=1;v<15;v++)O[v+1]=O[v]+A[v];for(y=0;y<o;y++)0!==t[n+y]&&(a[O[t[n+y]]++]=y);if(h=0===e?(R=N=a,19):1===e?(R=Qr,L-=257,N=ec,P-=257,256):(R=tc,N=nc,-1),v=I,p=s,E=y=k=0,l=-1,d=(D=1<<(T=C))-1,1===e&&852<D||2===e&&592<D)return 1;for(;;){for(f=a[y]<h?(_=0,a[y]):a[y]>h?(_=N[P+a[y]],R[L+a[y]]):(_=96,0),c=1<<(g=v-E),I=u=1<<T;i[p+(k>>E)+(u-=c)]=g<<24|_<<16|f,0!==u;);for(c=1<<v-1;k&c;)c>>=1;if(k=0!==c?(k&c-1)+c:0,y++,0==--A[v]){if(v===M)break;v=t[n+a[y]]}if(C<v&&(k&d)!==l){for(p+=I,S=1<<(T=v-(E=0===E?C:E));T+E<M&&!((S-=A[T+E])<=0);)T++,S<<=1;if(D+=1<<T,1===e&&852<D||2===e&&592<D)return 1;i[l=k&d]=C<<24|T<<16|p-s}}return 0!==k&&(i[p+k]=v-E<<24|64<<16),r.bits=C,0}Mr.assign,Mr.shrinkBuf,Mr.setTyped,Mr.Buf8,Mr.Buf16,Mr.Buf32;var Zr=function(){for(var e=[],t=0;t<256;t++){for(var n=t,o=0;o<8;o++)n=1&n?3988292384^n>>>1:n>>>1;e[t]=n}return e}(),Qr=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],ec=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],tc=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],nc=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function oc(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function ic(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new Mr.Buf16(320),this.work=new Mr.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function sc(e){var t;return e&&e.state?(t=e.state,e.total_in=e.total_out=t.total=0,e.msg="",t.wrap&&(e.adler=1&t.wrap),t.mode=1,t.last=0,t.havedict=0,t.dmax=32768,t.head=null,t.hold=0,t.bits=0,t.lencode=t.lendyn=new Mr.Buf32(852),t.distcode=t.distdyn=new Mr.Buf32(592),t.sane=1,t.back=-1,0):-2}function ac(e){var t;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,sc(e)):-2}function rc(e,t){var n,o;return e&&e.state?(o=e.state,t<0?(n=0,t=-t):(n=1+(t>>4),t<48&&(t&=15)),t&&(t<8||15<t)?-2:(null!==o.window&&o.wbits!==t&&(o.window=null),o.wrap=n,o.wbits=t,ac(e))):-2}function cc(e,t){var n;return e?(n=new ic,(e.state=n).window=null,0!==(n=rc(e,t))&&(e.state=null),n):-2}var uc,lc,dc=!0;function pc(e,t,n,o){var i;return null===(e=e.state).window&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new Mr.Buf8(e.wsize)),o>=e.wsize?(Mr.arraySet(e.window,t,n-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):((i=e.wsize-e.wnext)>o&&(i=o),Mr.arraySet(e.window,t,n-o,i,e.wnext),(o-=i)?(Mr.arraySet(e.window,t,n-o,o,0),e.wnext=o,e.whave=e.wsize):(e.wnext+=i,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=i))),0}var hc={inflateReset:ac,inflateReset2:rc,inflateResetKeep:sc,inflateInit:function(e){return cc(e,15)},inflateInit2:cc,inflate:function(e,t){var n,o,i,s,a,r,c,u,l,d,p,h,g,_,f,m,v,y,I,M,C,T,E,S,D=0,k=new Mr.Buf8(4),R=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return-2;12===(n=e.state).mode&&(n.mode=13),a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,o=e.input,r=e.avail_in,u=n.hold,l=n.bits,d=r,p=c,T=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(2&n.wrap&&35615===u){k[n.check=0]=255&u,k[1]=u>>>8&255,n.check=$r(n.check,k,2,0),l=u=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=30;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=30;break}if(l-=4,C=8+(15&(u>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=30;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&u?10:12,l=u=0;break;case 2:for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=30;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=30;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=$r(n.check,k,2,0)),l=u=0,n.mode=3;case 3:for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,k[2]=u>>>16&255,k[3]=u>>>24&255,n.check=$r(n.check,k,4,0)),l=u=0,n.mode=4;case 4:for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=$r(n.check,k,2,0)),l=u=0,n.mode=5;case 5:if(1024&n.flags){for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(k[0]=255&u,k[1]=u>>>8&255,n.check=$r(n.check,k,2,0)),l=u=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=(h=n.length)>r?r:h)&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Mr.arraySet(n.head.extra,o,s,h,C)),512&n.flags&&(n.check=$r(n.check,o,h,s)),r-=h,s+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===r)break e;for(h=0;C=o[s+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C)),C&&h<r;);if(512&n.flags&&(n.check=$r(n.check,o,h,s)),r-=h,s+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===r)break e;for(h=0;C=o[s+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C)),C&&h<r;);if(512&n.flags&&(n.check=$r(n.check,o,h,s)),r-=h,s+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=30;break}l=u=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=12;break;case 10:for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}e.adler=n.check=oc(u),l=u=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,2;e.adler=n.check=1,n.mode=12;case 12:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&l,l-=7&l,n.mode=27;break}for(;l<3;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}switch(n.last=1&u,--l,3&(u>>>=1)){case 0:n.mode=14;break;case 1:L=A=void 0;var L,A=n;if(dc){for(uc=new Mr.Buf32(512),lc=new Mr.Buf32(32),L=0;L<144;)A.lens[L++]=8;for(;L<256;)A.lens[L++]=9;for(;L<280;)A.lens[L++]=7;for(;L<288;)A.lens[L++]=8;for(Xr(1,A.lens,0,288,uc,0,A.work,{bits:9}),L=0;L<32;)A.lens[L++]=5;Xr(2,A.lens,0,32,lc,0,A.work,{bits:5}),dc=!1}if(A.lencode=uc,A.lenbits=9,A.distcode=lc,A.distbits=5,n.mode=20,6!==t)break;u>>>=2,l-=2;break e;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=30}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=30;break}if(n.length=65535&u,l=u=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(0===(h=c<(h=r<h?r:h)?c:h))break e;Mr.arraySet(i,o,s,h,a),r-=h,s+=h,c-=h,a+=h,n.length-=h;break}n.mode=12;break;case 17:for(;l<14;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,286<n.nlen||30<n.ndist){e.msg="too many length or distance symbols",n.mode=30;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;l<3;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.lens[R[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[R[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},T=Xr(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid code lengths set",n.mode=30;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;m=(D=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&D,!((f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(v<16)u>>>=f,l-=f,n.lens[n.have++]=v;else{if(16===v){for(S=f+2;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u>>>=f,l-=f,0===n.have){e.msg="invalid bit length repeat",n.mode=30;break}C=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===v){for(S=f+3;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}C=0,h=3+(7&(u>>>=f)),u>>>=3,l=l-f-3}else{for(S=f+7;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}C=0,h=11+(127&(u>>>=f)),u>>>=7,l=l-f-7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=30;break}for(;h--;)n.lens[n.have++]=C}}if(30===n.mode)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=30;break}if(n.lenbits=9,E={bits:n.lenbits},T=Xr(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid literal/lengths set",n.mode=30;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},T=Xr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,T){e.msg="invalid distances set",n.mode=30;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(6<=r&&258<=c){e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,j=G=U=b=P=N=O=Q=Z=H=V=x=void 0;var O,N,P,b,U,G,w=e,F=p,x=w.state,V=w.next_in,q=w.input,B=V+(w.avail_in-5),H=w.next_out,j=w.output,K=H-(F-w.avail_out),Y=H+(w.avail_out-257),z=x.dmax,W=x.wsize,J=x.whave,$=x.wnext,X=x.window,Z=x.hold,Q=x.bits,ee=x.lencode,te=x.distcode,ne=(1<<x.lenbits)-1,oe=(1<<x.distbits)-1;t:do{for(Q<15&&(Z+=q[V++]<<Q,Q+=8,Z+=q[V++]<<Q,Q+=8),O=ee[Z&ne];;){if(Z>>>=N=O>>>24,Q-=N,0==(N=O>>>16&255))j[H++]=65535&O;else{if(!(16&N)){if(!(64&N)){O=ee[(65535&O)+(Z&(1<<N)-1)];continue}if(32&N){x.mode=12;break t}w.msg="invalid literal/length code",x.mode=30;break t}for(P=65535&O,(N&=15)&&(Q<N&&(Z+=q[V++]<<Q,Q+=8),P+=Z&(1<<N)-1,Z>>>=N,Q-=N),Q<15&&(Z+=q[V++]<<Q,Q+=8,Z+=q[V++]<<Q,Q+=8),O=te[Z&oe];;){if(Z>>>=N=O>>>24,Q-=N,!(16&(N=O>>>16&255))){if(!(64&N)){O=te[(65535&O)+(Z&(1<<N)-1)];continue}w.msg="invalid distance code",x.mode=30;break t}if(b=65535&O,Q<(N&=15)&&(Z+=q[V++]<<Q,(Q+=8)<N&&(Z+=q[V++]<<Q,Q+=8)),(b+=Z&(1<<N)-1)>z){w.msg="invalid distance too far back",x.mode=30;break t}if(Z>>>=N,Q-=N,b>(N=H-K)){if((N=b-N)>J&&x.sane){w.msg="invalid distance too far back",x.mode=30;break t}if(G=X,(U=0)===$){if(U+=W-N,N<P){for(P-=N;j[H++]=X[U++],--N;);U=H-b,G=j}}else if($<N){if(U+=W+$-N,(N-=$)<P){for(P-=N;j[H++]=X[U++],--N;);if(U=0,$<P){for(P-=N=$;j[H++]=X[U++],--N;);U=H-b,G=j}}}else if(U+=$-N,N<P){for(P-=N;j[H++]=X[U++],--N;);U=H-b,G=j}for(;2<P;)j[H++]=G[U++],j[H++]=G[U++],j[H++]=G[U++],P-=3;P&&(j[H++]=G[U++],1<P&&(j[H++]=G[U++]))}else{for(U=H-b;j[H++]=j[U++],j[H++]=j[U++],j[H++]=j[U++],2<(P-=3););P&&(j[H++]=j[U++],1<P&&(j[H++]=j[U++]))}break}}break}}while(V<B&&H<Y);V-=P=Q>>3,Z&=(1<<(Q-=P<<3))-1,w.next_in=V,w.next_out=H,w.avail_in=V<B?B-V+5:5-(V-B),w.avail_out=H<Y?Y-H+257:257-(H-Y),x.hold=Z,x.bits=Q,a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,o=e.input,r=e.avail_in,u=n.hold,l=n.bits,12===n.mode&&(n.back=-1);break}for(n.back=0;m=(D=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&D,!((f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(m&&!(240&m)){for(y=f,I=m,M=v;m=(D=n.lencode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,v=65535&D,!(y+(f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=f,l-=f,n.back+=f,n.length=v,0===m){n.mode=26;break}if(32&m){n.back=-1,n.mode=12;break}if(64&m){e.msg="invalid literal/length code",n.mode=30;break}n.extra=15&m,n.mode=22;case 22:if(n.extra){for(S=n.extra;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(D=n.distcode[u&(1<<n.distbits)-1])>>>16&255,v=65535&D,!((f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(!(240&m)){for(y=f,I=m,M=v;m=(D=n.distcode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,v=65535&D,!(y+(f=D>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=f,l-=f,n.back+=f,64&m){e.msg="invalid distance code",n.mode=30;break}n.offset=v,n.extra=15&m,n.mode=24;case 24:if(n.extra){for(S=n.extra;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=30;break}n.mode=25;case 25:if(0===c)break e;if(n.offset>(h=p-c)){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=30;break}g=h>n.wnext?(h-=n.wnext,n.wsize-h):n.wnext-h,h>n.length&&(h=n.length),_=n.window}else _=i,g=a-n.offset,h=n.length;for(c-=h=c<h?c:h,n.length-=h;i[a++]=_[g++],--h;);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;i[a++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;l<32;){if(0===r)break e;r--,u|=o[s++]<<l,l+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=(n.flags?$r:Jr)(n.check,i,p,a-p)),p=c,(n.flags?u:oc(u))!==n.check){e.msg="incorrect data check",n.mode=30;break}l=u=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=30;break}l=u=0}n.mode=29;case 29:T=1;break e;case 30:T=-3;break e;case 31:return-4;default:return-2}return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,(n.wsize||p!==e.avail_out&&n.mode<30&&(n.mode<27||4!==t))&&pc(e,e.output,e.next_out,p-e.avail_out),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=(n.flags?$r:Jr)(n.check,i,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(12===n.mode?128:0)+(20===n.mode||15===n.mode?256:0),(0==d&&0===p||4===t)&&0===T?-5:T},inflateEnd:function(e){if(!e||!e.state)return-2;var t=e.state;return t.window&&(t.window=null),e.state=null,0},inflateGetHeader:function(e,t){var n;return e&&e.state&&2&(n=e.state).wrap?((n.head=t).done=!1,0):-2},inflateSetDictionary:function(e,t){var n,o=t.length;return!e||!e.state||0!==(n=e.state).wrap&&11!==n.mode?-2:11===n.mode&&Jr(1,t,o,0)!==n.check?-3:pc(e,t,o,o)?(n.mode=31,-4):(n.havedict=1,0)},inflateInfo:"pako inflate (from Nodeca project)"},gc=!0,_c=!0;try{String.fromCharCode.apply(null,[0])}catch(wc){gc=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(wc){_c=!1}for(var fc=new Mr.Buf8(256),mc=0;mc<256;mc++)fc[mc]=252<=mc?6:248<=mc?5:240<=mc?4:224<=mc?3:192<=mc?2:1;function vc(e,t){for(var n,o,i=t||e.length,s=new Array(2*i),a=0,r=0;r<i;)if((n=e[r++])<128)s[a++]=n;else if(4<(o=fc[n]))s[a++]=65533,r+=o-1;else{for(n&=2===o?31:3===o?15:7;1<o&&r<i;)n=n<<6|63&e[r++],o--;1<o?s[a++]=65533:n<65536?s[a++]=n:(n-=65536,s[a++]=55296|n>>10&1023,s[a++]=56320|1023&n)}var c=s,u=a;if(u<65534&&(c.subarray&&_c||!c.subarray&&gc))return String.fromCharCode.apply(null,Mr.shrinkBuf(c,u));for(var l="",d=0;d<u;d++)l+=String.fromCharCode(c[d]);return l}function yc(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Ic(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}fc[254]=fc[254]=1;var Mc={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Cc={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Tc=Object.prototype.toString;function Ec(e){if(!(this instanceof Ec))return new Ec(e);this.options=Mr.assign({chunkSize:16384,windowBits:0,to:""},e||{});var t=this.options;if(t.raw&&0<=t.windowBits&&t.windowBits<16&&(t.windowBits=-t.windowBits,0===t.windowBits&&(t.windowBits=-15)),!(0<=t.windowBits&&t.windowBits<16)||e&&e.windowBits||(t.windowBits+=32),15<t.windowBits&&t.windowBits<48&&!(15&t.windowBits)&&(t.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new yc,this.strm.avail_out=0,(e=hc.inflateInit2(this.strm,t.windowBits))!==Mc.Z_OK)throw new Error(Cc[e]);if(this.header=new Ic,hc.inflateGetHeader(this.strm,this.header),t.dictionary&&("string"==typeof t.dictionary?t.dictionary=function(e){for(var t,n,o,i,s=e.length,a=0,r=0;r<s;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(o=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),a+=n<128?1:n<2048?2:n<65536?3:4;for(t=new Mr.Buf8(a),r=i=0;i<a;r++)55296==(64512&(n=e.charCodeAt(r)))&&r+1<s&&56320==(64512&(o=e.charCodeAt(r+1)))&&(n=65536+(n-55296<<10)+(o-56320),r++),n<128?t[i++]=n:(n<2048?t[i++]=192|n>>>6:(n<65536?t[i++]=224|n>>>12:(t[i++]=240|n>>>18,t[i++]=128|n>>>12&63),t[i++]=128|n>>>6&63),t[i++]=128|63&n);return t}(t.dictionary):"[object ArrayBuffer]"===Tc.call(t.dictionary)&&(t.dictionary=new Uint8Array(t.dictionary)),t.raw&&(e=hc.inflateSetDictionary(this.strm,t.dictionary))!==Mc.Z_OK))throw new Error(Cc[e])}function Sc(e,t){if((t=new Ec(t)).push(e,!0),t.err)throw t.msg||Cc[t.err];return t.result}Ec.prototype.push=function(e,t){var n,o,i,s,a,r=this.strm,c=this.options.chunkSize,u=this.options.dictionary,l=!1;if(this.ended)return!1;o=t===~~t?t:!0===t?Mc.Z_FINISH:Mc.Z_NO_FLUSH,"string"==typeof e?r.input=function(e){for(var t=new Mr.Buf8(e.length),n=0,o=t.length;n<o;n++)t[n]=e.charCodeAt(n);return t}(e):"[object ArrayBuffer]"===Tc.call(e)?r.input=new Uint8Array(e):r.input=e,r.next_in=0,r.avail_in=r.input.length;do{if(0===r.avail_out&&(r.output=new Mr.Buf8(c),r.next_out=0,r.avail_out=c),(n=(n=hc.inflate(r,Mc.Z_NO_FLUSH))===Mc.Z_NEED_DICT&&u?hc.inflateSetDictionary(this.strm,u):n)===Mc.Z_BUF_ERROR&&!0===l&&(n=Mc.Z_OK,l=!1),n!==Mc.Z_STREAM_END&&n!==Mc.Z_OK)return this.onEnd(n),!(this.ended=!0);r.next_out&&(0!==r.avail_out&&n!==Mc.Z_STREAM_END&&(0!==r.avail_in||o!==Mc.Z_FINISH&&o!==Mc.Z_SYNC_FLUSH)||("string"===this.options.to?(i=function(e,t){for(var n=(t=(t=t||e.length)>e.length?e.length:t)-1;0<=n&&128==(192&e[n]);)n--;return!(n<0||0===n)&&n+fc[e[n]]>t?n:t}(r.output,r.next_out),s=r.next_out-i,a=vc(r.output,i),r.next_out=s,r.avail_out=c-s,s&&Mr.arraySet(r.output,r.output,i,s,0),this.onData(a)):this.onData(Mr.shrinkBuf(r.output,r.next_out)))),0===r.avail_in&&0===r.avail_out&&(l=!0)}while((0<r.avail_in||0===r.avail_out)&&n!==Mc.Z_STREAM_END);return(o=n===Mc.Z_STREAM_END?Mc.Z_FINISH:o)===Mc.Z_FINISH?(n=hc.inflateEnd(this.strm),this.onEnd(n),this.ended=!0,n===Mc.Z_OK):o!==Mc.Z_SYNC_FLUSH||(this.onEnd(Mc.Z_OK),!(r.avail_out=0))},Ec.prototype.onData=function(e){this.chunks.push(e)},Ec.prototype.onEnd=function(e){e===Mc.Z_OK&&("string"===this.options.to?this.result=this.chunks.join(""):this.result=Mr.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},W={};var Dc=((0,Mr.assign)(W,{Inflate:Ec,inflate:Sc,inflateRaw:function(e,t){return(t=t||{}).raw=!0,Sc(e,t)},ungzip:Sc},Mc),W),kc=(s(Uc,[{key:"inflate",value:function(e){e=new Uint8Array(e).slice(4);var t,n=Date.now();try{t=Dc.inflate(e,{to:"string"}),this._bLogForInflateOK||(this._bLogForInflateOK=!0,new eo("inflateOK").end())}catch(i){return this._bLogForInflateError?void 0:(this._bLogForInflateError=!0,void new eo("inflateError").setMessage(i).end())}e=e.length+4;var o=t.length;return Oe.d("inflate ok. zipped:".concat(e," unzipped:").concat(o)+" compression ratio:".concat(Math.round(100*(o-e)/o),"% cost:").concat(Date.now()-n)),t}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._bLogForInflateOK=!1,this._bLogForInflateError=!1}}]),Uc),Rc=(s(bc,[{key:"_startTimer",value:function(){var e=this._map.get(24),t=e.isWorkerEnabled();Oe.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),Oe.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._map.get(24),t=e.isWorkerEnabled();Oe.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(t," seed:").concat(this._checkTimer)),t?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){Oe.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){Oe.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){Oe.l("".concat(this._n,"._startMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){Oe.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){Oe.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,t=T(this._map);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2)[1];n.onCheckTimer&&n.onCheckTimer(this._checkCount)}}catch(o){t.e(o)}finally{t.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._map.get(1)],this._readyList.forEach((function(t){t.ready((function(){return e._onModuleReady()}))}))}},{key:"_onModuleReady",value:function(){var e,t,n=!0;this._readyList.forEach((function(e){e.isReady()||(n=!1)})),n&&!this._isReady&&(this._isReady=!0,this._oEmitter.emit(E.SDK_READY),e=Date.now()-this._startLoginTs,Oe.w("SDK is ready. cost ".concat(e," ms")),this._startLoginTs=Date.now(),t=this._ssoLogForReady.getStartTs()+De,this._ssoLogForReady.setMessage(e).start(t).end())}},{key:"login",value:function(){0===this._startLoginTs&&(Te(),this._startLoginTs=Date.now(),this._startTimer(),this._map.get(15).start(),this._ssoLogForReady=new eo("sdkReady"),this._reason=wn.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOEmitInst",value:function(){return null===this._oEmitter&&(this._oEmitter=new Ms,e=this._oEmitter,Fn=e,this._oEmitter._emit=this._oEmitter.emit,this._oEmitter.emit=function(e,t){var n,o,i=this;this._canIUseSignaling()&&(e===E.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(t),e===E.MESSAGE_MODIFIED&&this.get(33).onMessageModified(t)),e===E.CONVERSATION_LIST_UPDATED||e===E.FRIEND_LIST_UPDATED||e===E.GROUP_LIST_UPDATED||e===E.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?!1!==this._eventThrottling?this._eventThrottleMap.has(e)?(n=Date.now())-(o=this._eventThrottleMap.get(e)).last<=1e3?(o.timeoutID&&clearTimeout(o.timeoutID),o.timeoutID=setTimeout((function(){o.last=Date.now(),i._oEmitter._emit.apply(i._oEmitter,[e,{name:e,data:i._getEventData(e)}])}),1e3)):(o.last=n,this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}])):(this._eventThrottleMap.set(e,{last:Date.now(),timeoutID:-1}),this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}])):this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:this._getEventData(e)}]):this._oEmitter._emit.apply(this._oEmitter,[e,{name:e,data:t}])}.bind(this)),this._oEmitter;var e}},{key:"_canIUseSignaling",value:function(){var e=this.get(33);return!!e&&e.canIUseSignaling()}},{key:"_getEventData",value:function(e){return e===E.CONVERSATION_LIST_UPDATED?this._map.get(12).isPartialUpdatedConvs()?this._map.get(11).getPartialUpdatedConvs():this._map.get(11).getLocalConvList():e===E.FRIEND_LIST_UPDATED?this._map.get(8).getLocalFriendList(!1):e===E.GROUP_LIST_UPDATED?this._map.get(7).getLocalGroupList():e===E.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._map.get(11).getTotalUnreadCount():e===E.CONVERSATION_ID_LIST_UPDATED?this._map.get(11).getUpdatedConvIDList():void 0}},{key:"getIEmitInst",value:function(){return null===this._iEmitter&&(this._iEmitter=new Ms,this._iEmitter._emit=this._iEmitter.emit,this._iEmitter.emit=function(e,t){e=ze(t)&&t.data?[e,{name:e,data:t.data}]:[e,{name:e,data:t}],this._iEmitter._emit.apply(this._iEmitter,e)}.bind(this)),this._iEmitter}},{key:"hasModule",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"canIUseModule",value:function(e){return!this._map.get(12).isUsingChatCore()||this._optionalModuleMap.has(e)}},{key:"canIUseInflate",value:function(){return!!this._map.get(37)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrMsg",value:function(e,t,n){return this._map.get(32).get({key:e,replacement1:t,replacement2:n,isIntl:this.isIntl()})}},{key:"warn",value:function(e,t,n){(e=this.getErrMsg(e,t,n))&&Oe.w(e)}},{key:"onError",value:function(e){var t="code:".concat(e.code," message:").concat(e.message);Oe.w("Oops! ".concat(t)),new eo("error").setMessage(t).setLevel("error").end(),this.getOEmitInst().emit(E.ERROR,e)}},{key:"restartTimer",value:function(){Oe.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var e=this.get(7);e&&e.restartPolling()}},{key:"getTimerID",value:function(){var e=this._map.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._map.get(7).getPollingTimerID(e)}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),Te();var e,t=T(this._map);try{for(t.s();!(e=t.n()).done;){var n=f(e.value,2)[1];n.reset&&n.reset()}}catch(a){t.e(a)}finally{t.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._oEmitter.emit(E.SDK_NOT_READY);var o,i=T(this._eventThrottleMap);try{for(i.s();!(o=i.n()).done;){var s=f(o.value,2)[1];s.timeoutID&&clearTimeout(s.timeoutID)}}catch(a){i.e(a)}finally{i.f()}this._eventThrottleMap.clear()}}]),bc),Lc=(s(Pc,[{key:"defense",value:function(e,t){var n=2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0;if("string"!=typeof e)return null;if(0===e.length)return null;if("function"!=typeof t)return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(t))return this._funcMap.get(e).get(t);this._funcMap.has(e)||this._funcMap.set(e,new Map);var o=null;return this._funcMap.get(e).has(t)?o=this._funcMap.get(e).get(t):(o=this._pack(e,t,n),this._funcMap.get(e).set(t,o)),o}},{key:"defenseOnce",value:function(e,t){return"function"!=typeof t?null:this._pack(e,t,2<arguments.length&&void 0!==arguments[2]?arguments[2]:void 0)}},{key:"find",value:function(e,t){return"string"!=typeof e||0===e.length||"function"!=typeof t?null:this._funcMap.has(e)&&this._funcMap.get(e).has(t)?this._funcMap.get(e).get(t):(this._m.warn("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,t){return"function"==typeof t&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(t)&&(this._funcMap.get(e).delete(t),0===this._funcMap.get(e).size&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,t,n){var o=this;return function(){try{t.apply(n,Array.from(arguments))}catch(a){var i=Object.values(E).indexOf(e),s="CallbackError";-1!==i&&(i=Object.keys(E)[i],o._m.warn(s,i,a)),o._reportCount<5&&(new eo(s).setMessage("eventName:".concat(e)).setMoreMessage(a.message).end(),o._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){Oe.l("".concat(this._n,".reset")),this._reportCount=0}}]),Pc),Ac=(s(Nc,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._get(1).login(e)}},{key:"logout",value:function(){var e=this;return this._get(1).logout().then((function(t){return e._safetyCallbackFactory.reset(),e._m.reset(),t}))}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"getServerTime",value:function(){return ke()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrMsg",value:function(e,t,n){return this._m.getErrMsg(e,t,n)}},{key:"_get",value:function(e){return this._m.get(e)}},{key:"destroy",value:function(){var e=this,t=this._get(12),n=t.getSDKAppID();return Oe.w("destroy ".concat(n," ").concat(t.getInstanceID())),this.logout().finally((function(){e._safetyCallbackFactory.destroy(),e._m.stopTimer(),e._get(24).terminate(),e._get(21).dealloc(),e._m.getOEmitInst().emit(E.SDK_DESTROY,{SDKAppID:n})}))}},{key:"on",value:function(e,t,n){Oe.d("on","eventName:".concat(e)),this._m.getOEmitInst().on(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"once",value:function(e,t,n){Oe.d("once","eventName:".concat(e)),this._m.getOEmitInst().once(e,this._safetyCallbackFactory.defenseOnce(e,t,n),n||this)}},{key:"off",value:function(e,t,n,o){Oe.d("off","eventName:".concat(e));var i=this._safetyCallbackFactory.find(e,t);null!==i&&(this._m.getOEmitInst().off(e,i,n,o),this._safetyCallbackFactory.delete(e,t))}},{key:"registerPlugin",value:function(e){(ut(e["tim-push"])?ut(e["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(e)}},{key:"setLogLevel",value:function(e){var t;e<=0&&((t=this.getErrMsg("TIM_ASCII_ART"))&&_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",t),(t=this.getErrMsg("API_REFER"))&&(Vt()?_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",t):_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","IM SDK API ->",t)),(t=this.getErrMsg("DOCS_GUIDE"))&&_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",t),t=this.getErrMsg("IOS_WEBVIEW_WARNING"),me&&t&&_("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",t)),Oe.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._get(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._get(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._get(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._get(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._get(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._get(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._get(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._get(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==S.MSG_MERGER?In({code:wn.MSG_MERGER_TYPE_INVALID}):Be(e.payload.downloadKey)?In({code:wn.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(e).catch((function(e){return In({code:wn.MSG_MERGER_DOWNLOAD_FAIL})}))}},{key:"createForwardMessage",value:function(e){return this._get(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,t){return e instanceof So?this._get(2).sendMessageInstance(e,t):In({code:wn.MSG_INSTANCE_REQUIRED})}},{key:"searchCloudMessages",value:function(e){return this._get(2).searchCloudMessages(e)}},{key:"callExperimentalAPI",value:function(e,t){return"sendComboMessage"===e?this._get(31).sendMessage(t):"handleGroupInvitation"===e?this._get(7).handleGroupInvitation(t):"isCommercialAbilityEnabled"===e?this._get(27).isFeatureEnabled(t):"isFeatureEnabledForStat"===e?this._get(27).isFeatureEnabledForStat(t):"isIntl"===e?this.isIntl():"sendTRTCCustomData"===e||"sendRoomCustomData"===e?this._get(30).sendTRTCCustomData(t):"getTimerID"===e?this._m.getTimerID():"getPollingTimerID"===e?this._m.getPollingTimerID(t):"setApplicationID"===e?(this._get(12).setApplicationID(t),void this._get(20).updateProtocolConfig()):"getServerConfig"===e?this._get(23).getServerConfig(t):"canIUseModule"===e?this._m.canIUseModule(t):"startMessageLongPolling"===e?this._get(7).startMessageLongPolling(t):"stopMessageLongPolling"===e?this._get(7).stopMessageLongPolling(t):"disableMessagePullOnInvite"===e?this._get(11).disableMsgPullOnInvite(t):"clearLocalMessage"===e?this._get(11).clearMemMsg(t,!1):"setCustomLoginInfo"===e?this._get(12).setCustomLoginInfo(t):In({code:wn.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._get(2).revokeMessage(e)}},{key:"resendMessage",value:function(e,t){return e instanceof So?this._get(2).resendMessage(e,t):In({code:wn.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(e){return this._get(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._get(2).translateText(e)}},{key:"convertVoiceToText",value:function(e){return this._get(2).convertVoiceToText(e)}},{key:"setMessageExtensions",value:function(e,t){return this._get(3).setMessageExtensions(e,t)}},{key:"getMessageExtensions",value:function(e){return this._get(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,t){return this._get(3).deleteMessageExtensions(e,t)}},{key:"addMessageReaction",value:function(e,t){return this._get(34).addMessageReaction(e,t)}},{key:"removeMessageReaction",value:function(e,t){return this._get(34).removeMessageReaction(e,t)}},{key:"getMessageReactions",value:function(e){return this._get(34).getMessageReactions(e)}},{key:"getAllUserListOfMessageReaction",value:function(e){return this._get(34).getAllUserListOfMessageReaction(e)}},{key:"modifyMessage",value:function(e){return this._get(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._get(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._get(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._get(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._get(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){var t=this._get(7);return t?t.getReadReceiptDetail(e):In({code:wn.NO_MODULE})}},{key:"findMessage",value:function(e){return this._get(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._get(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._get(11).getConvList(e)}},{key:"getConversationProfile",value:function(e){return this._get(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._get(11).deleteConversation(e)}},{key:"setConversationDraft",value:function(e){return this._get(11).setConvDraft(e)}},{key:"clearHistoryMessage",value:function(e){return this._get(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._get(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._get(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._get(11).setMessageRemindType(e)}},{key:"setAllReceiveMessageOpt",value:function(e){return this._get(11).setAllRcvMsgOpt(e)}},{key:"getAllReceiveMessageOpt",value:function(){return this._get(11).getAllRcvMsgOpt()}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadCount()}},{key:"setConversationCustomData",value:function(e){return this._get(11).setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._get(11).markConv(e)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._get(11).createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._get(11).deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._get(11).renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._get(11).addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._get(11).deleteConvsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._get(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._get(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._get(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._get(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._get(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._get(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._get(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._get(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._get(8);return e?e.getLocalFriendList():In({code:wn.NO_MODULE})}},{key:"addFriend",value:function(e){var t=this._get(8);return t?t.addFriend(e):In({code:wn.NO_MODULE})}},{key:"deleteFriend",value:function(e){var t=this._get(8);return t?t.deleteFriend(e):In({code:wn.NO_MODULE})}},{key:"checkFriend",value:function(e){var t=this._get(8);return t?t.checkFriend(e):In({code:wn.NO_MODULE})}},{key:"getFriendProfile",value:function(e){var t=this._get(8);return t?t.getFriendProfile(e):In({code:wn.NO_MODULE})}},{key:"updateFriend",value:function(e){var t=this._get(8);return t?t.updateFriend(e):In({code:wn.NO_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._get(8);return e?e.getLocalFriendApplicationList():In({code:wn.NO_MODULE})}},{key:"acceptFriendApplication",value:function(e){var t=this._get(8);return t?t.acceptFriendApplication(e):In({code:wn.NO_MODULE})}},{key:"refuseFriendApplication",value:function(e){var t=this._get(8);return t?t.refuseFriendApplication(e):In({code:wn.NO_MODULE})}},{key:"deleteFriendApplication",value:function(e){var t=this._get(8);return t?t.deleteFriendApplication(e):In({code:wn.NO_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._get(8);return e?e.setFriendApplicationRead():In({code:wn.NO_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._get(8);return e?e.getLocalFriendGroupList():In({code:wn.NO_MODULE})}},{key:"createFriendGroup",value:function(e){var t=this._get(8);return t?t.createFriendGroup(e):In({code:wn.NO_MODULE})}},{key:"deleteFriendGroup",value:function(e){var t=this._get(8);return t?t.deleteFriendGroup(e):In({code:wn.NO_MODULE})}},{key:"addToFriendGroup",value:function(e){var t=this._get(8);return t?t.addToFriendGroup(e):In({code:wn.NO_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var t=this._get(8);return t?t.removeFromFriendGroup(e):In({code:wn.NO_MODULE})}},{key:"renameFriendGroup",value:function(e){var t=this._get(8);return t?t.renameFriendGroup(e):In({code:wn.NO_MODULE})}},{key:"followUser",value:function(e){var t=this._get(35);return t?t.followUser(e):In({code:wn.NO_MODULE})}},{key:"unfollowUser",value:function(e){var t=this._get(35);return t?t.unfollowUser(e):In({code:wn.NO_MODULE})}},{key:"getMyFollowersList",value:function(e){var t=this._get(35);return t?t.getMyFollowersList(e):In({code:wn.NO_MODULE})}},{key:"getMyFollowingList",value:function(e){var t=this._get(35);return t?t.getMyFollowingList(e):In({code:wn.NO_MODULE})}},{key:"getMutualFollowersList",value:function(e){var t=this._get(35);return t?t.getMutualFollowersList(e):In({code:wn.NO_MODULE})}},{key:"getUserFollowInfo",value:function(e){var t=this._get(35);return t?t.getUserFollowInfo(e):In({code:wn.NO_MODULE})}},{key:"checkFollowType",value:function(e){var t=this._get(35);return t?t.checkFollowType(e):In({code:wn.NO_MODULE})}},{key:"getGroupList",value:function(){var e=this._get(7);return e?e.getGroupList():In({code:wn.NO_MODULE})}},{key:"getGroupProfile",value:function(e){var t=this._get(7);return t?t.getGroupProfile(e):In({code:wn.NO_MODULE})}},{key:"createGroup",value:function(e){var t=this._get(7);return t?t.createGroup(e):In({code:wn.NO_MODULE})}},{key:"dismissGroup",value:function(e){var t=this._get(7);return t?t.dismissGroup(e):In({code:wn.NO_MODULE})}},{key:"updateGroupProfile",value:function(e){var t=this._get(7);return t?t.updateGroupProfile(e):In({code:wn.NO_MODULE})}},{key:"joinGroup",value:function(e){var t=this._get(7);return t?t.joinGroup(e):In({code:wn.NO_MODULE})}},{key:"quitGroup",value:function(e){var t=this._get(7);return t?t.quitGroup(e):In({code:wn.NO_MODULE})}},{key:"searchGroupByID",value:function(e){var t=this._get(7);return t?t.searchGroupByID(e):In({code:wn.NO_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(e){var t=this._get(7);return t?t.getGroupOnlineMemberCount(e):In({code:wn.NO_MODULE})}},{key:"changeGroupOwner",value:function(e){var t=this._get(7);return t?t.changeGroupOwner(e):In({code:wn.NO_MODULE})}},{key:"getGroupApplicationList",value:function(){var e=this._get(7);return e?e.getGroupApplicationList():In({code:wn.NO_MODULE})}},{key:"handleGroupApplication",value:function(e){var t=this._get(7);return t?t.handleGroupApplication(e):In({code:wn.NO_MODULE})}},{key:"initGroupAttributes",value:function(e){var t=this._get(7);return t?t.initGroupAttributes(e):In({code:wn.NO_MODULE})}},{key:"setGroupAttributes",value:function(e){var t=this._get(7);return t?t.setGroupAttributes(e):In({code:wn.NO_MODULE})}},{key:"deleteGroupAttributes",value:function(e){var t=this._get(7);return t?t.deleteGroupAttributes(e):In({code:wn.NO_MODULE})}},{key:"getGroupAttributes",value:function(e){var t=this._get(7);return t?t.getGroupAttributes(e):In({code:wn.NO_MODULE})}},{key:"setGroupCounters",value:function(e){var t=this._get(7);return t?t.setGroupCounters(e):In({code:wn.NO_MODULE})}},{key:"increaseGroupCounter",value:function(e){var t=this._get(7);return t?t.increaseGroupCounter(e):In({code:wn.NO_MODULE})}},{key:"decreaseGroupCounter",value:function(e){var t=this._get(7);return t?t.decreaseGroupCounter(e):In({code:wn.NO_MODULE})}},{key:"getGroupCounters",value:function(e){var t=this._get(7);return t?t.getGroupCounters(e):In({code:wn.NO_MODULE})}},{key:"getGroupMemberList",value:function(e){var t=this._get(7);return t?t.getGroupMemberList(e):In({code:wn.NO_MODULE})}},{key:"getGroupMemberProfile",value:function(e){var t=this._get(7);return t?t.getGroupMemberProfile(e):In({code:wn.NO_MODULE})}},{key:"addGroupMember",value:function(e){var t=this._get(7);return t?t.addGroupMember(e):In({code:wn.NO_MODULE})}},{key:"deleteGroupMember",value:function(e){var t=this._get(7);return t?t.deleteGroupMember(e):In({code:wn.NO_MODULE})}},{key:"setGroupMemberMuteTime",value:function(e){var t=this._get(7);return t?t.setGroupMemberMuteTime(e):In({code:wn.NO_MODULE})}},{key:"setGroupMemberRole",value:function(e){var t=this._get(7);return t?t.setGroupMemberRole(e):In({code:wn.NO_MODULE})}},{key:"setGroupMemberNameCard",value:function(e){var t=this._get(7);return t?t.setGroupMemberNameCard(e):In({code:wn.NO_MODULE})}},{key:"setGroupMemberCustomField",value:function(e){var t=this._get(7);return t?t.setGroupMemberCustomField(e):In({code:wn.NO_MODULE})}},{key:"markGroupMemberList",value:function(e){var t=this._get(7);return t?t.markGroupMemberList(e):In({code:wn.NO_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._get(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._get(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._get(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._get(10).getTopicList(e)}},{key:"addSignalingListener",value:function(e,t,n){var o=this._get(33);o&&o.addSignalingListener(e,this._safetyCallbackFactory.defense(e,t,n),n)}},{key:"removeSignalingListener",value:function(e,t,n){var o,i=this._safetyCallbackFactory.find(e,t);null===i||(o=this._get(33))&&(o.removeSignalingListener(e,i,n),this._safetyCallbackFactory.delete(e,t))}},{key:"invite",value:function(e){var t=this._get(33);return t?t.invite(e):In({code:wn.NO_MODULE})}},{key:"inviteSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"inviteInGroup",value:function(e){var t=this._get(33);return t?t.invite(e):In({code:wn.NO_MODULE})}},{key:"inviteInGroupSync",value:function(e,t,n){var o=this._get(33);return o?o.inviteSync(e,t,n):""}},{key:"cancel",value:function(e){var t=this._get(33);return t?t.cancel(e):In({code:wn.NO_MODULE})}},{key:"accept",value:function(e){var t=this._get(33);return t?t.accept(e):In({code:wn.NO_MODULE})}},{key:"reject",value:function(e){var t=this._get(33);return t?t.reject(e):In({code:wn.NO_MODULE})}},{key:"getSignalingInfo",value:function(e){var t=this._get(33);return t?t.getSignalingInfo(e):null}},{key:"modifyInvitation",value:function(e){var t=this._get(33);return t?t.modifyInvitation(e):In({code:wn.NO_MODULE})}}]),Nc),Oc={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function Nc(e){o(this,Nc),e={SDKAppID:e.SDKAppID,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,instanceID:kt(),devMode:e.devMode||!1,testEnv:e.testEnv||!1,proxyServer:e.proxyServer||void 0,fileUploadProxy:e.fileUploadProxy||void 0,fileDownloadProxy:e.fileDownloadProxy||e.fileUploadProxy||void 0,eventThrottling:!1!==e.eventThrottling,partialUpdatedConversations:!0===e.partialUpdatedConversations,modules:e.modules||void 0},this._m=new Rc(e),this._safetyCallbackFactory=new Lc(this._m)}function Pc(e){o(this,Pc),this._funcMap=new Map,this._m=e,this._n="SafetyCallback",this._reportCount=0}function bc(e){var t=this;o(this,bc);var n,i=new eo("sdkConstruct"),s=(this._n="ModuleManager",this._isReady=!1,this._reason=wn.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._map=new Map,this._optionalModuleMap=new Map,this._iEmitter=null,this._oEmitter=null,this._checkCount=0,this._checkTimer=-1,this._map.set(12,new Ni(this,e)),this._map.set(37,new kc(this)),this._map.set(15,new gs(this)),this._map.set(27,new sr(this)),this._map.set(23,new Ha(this)),this._map.set(24,new or(this)),this._map.set(26,new Ja(this)),this._map.set(21,new pa(this)),this._map.set(20,new Ba(this)),this._map.set(1,new bi(this)),this._map.set(2,new xs(this)),this._map.set(3,new Vs(this)),this._map.set(34,new qs(this)),this._map.set(31,new Bs(this)),this._map.set(4,new Oi(this)),this._map.set(6,new Vo(this)),this._map.set(11,new li(this)),this._map.set(7,new Ti(this)),this._map.set(10,new Di(this)),this._map.set(13,new us(this)),this._map.set(32,new lr(this)),this._map.set(14,new ds(this)),this._map.set(17,new Es(this)),this._map.set(18,new Hs(this)),this._map.set(19,new js(this)),this._map.set(25,new ja(this)),this._map.set(8,new nr(this)),this._map.set(28,new ar(this)),this._map.set(36,new rr(this)),this._map.set(29,new cr(this)),this._map.set(30,new ur(this)),this._map.set(33,new mr(this)),this._map.set(35,new Ir(this)),this._eventThrottleMap=new Map,this._eventThrottling=e.eventThrottling,this._map.get(12).isPartialUpdatedConvs()&&(this._eventThrottling=!1),ze(e.modules)?(Object.keys(e.modules).forEach((function(o){n=e.modules[o],"group-module"===o?t._map.set(7,new n(t)):"relationship-module"===o?t._map.set(8,new n(t)):"signaling-module"===o?t._map.set(33,new n(t)):"follow-module"===o&&t._map.set(35,new n(t)),t._optionalModuleMap.set(o,1)})),this._map.get(12).setUsingChatCore(!0)):this._map.has(7)||this._map.get(12).setUsingChatCore(!0),e.instanceID),a=e.SDKAppID,r=this._map.get(12).isIntl(),c=this._map.get(12).isUsingChatCore();s="instanceID:".concat(s," SDKAppID:").concat(a," isIntl:").concat(r," isUsingChatCore:").concat(c," host:").concat(Rt())+" isIOSWebView:".concat(me," platform:").concat(ie," canIUseInflate:").concat(this.canIUseInflate())+" workerAvailable:".concat(ge," eventThrottling:").concat(this._eventThrottling," UserAgent:").concat(oe),eo.bindEventStatModule(this._map.get(14)),eo.bindNetMonitorModule(this._map.get(15)),i.setMessage("".concat(s," ").concat(function(){var e="";if(Z)try{var t=ne.getSystemInfoSync(),n=t.model,o=t.version,i=t.system,s=t.platform,a=t.SDKVersion;e="model:".concat(n," version:").concat(o," system:").concat(i," platform:").concat(s," SDKVersion:").concat(a)}catch(r){e=""}return e}())).end(),Oe.i("SDK ".concat(s)),Gn.prototype._getErrMsg=this.getErrMsg.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function Uc(e){o(this,Uc),this._m=e,this._n="InflateModule",this._bLogForInflateOK=!1,this._bLogForInflateError=!1}var Gc={};return($={}).create=function(e){var n,o,i,s="TencentCloudChat.create",a=0;if(Ke(i=e.SDKAppID))a=i;else if(a=parseInt(i),isNaN(i))return Oe.e("".concat(s," failed. Failed to parse the SDKAppID, please check the arguments")),null;return a&&Gc[a]?Gc[a]:(Oe.l("".concat(s)),(i=new Ac(t(t({},e),{},{SDKAppID:a}))).on(E.SDK_DESTROY,(function(e){Gc[e.data.SDKAppID]=null,delete Gc[e.data.SDKAppID]})),n=i,o=Object.create(null),Object.keys(Un).forEach((function(e){var t;n[e]&&(t=new k,o[e]=function(){var o=Array.from(arguments);return t.use((function(t,o){var i=function(e,t){if(e.isReady()||1===Oc[t])return!0;var n={code:n=e.getNotReadyReason(),message:"".concat(e.getErrMsg(n)," | ").concat(t," | ").concat(e.getErrMsg(wn.SDK_IS_NOT_READY))};return e.onError(n),n}(n,e);return!0===i?o():In(i)})).use((function(t,n){if(!0===function(e,t,n){if(void 0===t)return!0;var o=!0;if(ze(t))Object.keys(t).forEach((function(i){var s=1===e.length?e[0][i]:void 0;o=!!Yt(s,t[i],n,i)&&o}));else if(We(t))for(var i=0;i<t.length;i++)o=!!Yt(e[i],t[i],n,t[i].name)&&o;if(o)return o;throw new Error("Params validate failed.")}(t,bn[e],e))return n()})).use((function(t,o){return n[e].apply(n,t)})),t.run(o)})})),e=o,Gc[a]=e,bn.hookGetAPITips(i.getErrMsg.bind(i)),Oe.l("".concat(s," ok")),e)},$.TYPES=S,$.EVENT=E,$.TSignaling=D,$.VERSION="3.4.8",Oe.l("TencentCloudChat.VERSION:".concat($.VERSION)),$}();var mn=fn;let vn=class{constructor(e,t){if(this.trtcCloud=e,t){const{userId:n,sdkAppId:o,seq:i}=t;this.seq=i,e._log&&(this.logger=e._log.createLogger({id:`roomEngine${i}`,userId:n,sdkAppId:o}))}else this.logger=e._log;this.logger||(this.logger={debug:t=>{e.logger&&e.logger.debug?e.logger.debug(t):_("debug","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),t)},info:t=>{e.logger&&e.logger.info?e.logger.info(t):_("info","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),t)},warn:t=>{e.logger&&e.logger.warn?e.logger.warn(t):_("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),t)},error:t=>{e.logger&&e.logger.error?e.logger.error(t):_("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),t)}})}getLogMessage(e){try{return e.map((e=>"string"!=typeof e?JSON.stringify(e):e)).join(" ")}catch(t){return e}}update(e){const{userId:t,sdkAppId:n}=e;this.trtcCloud._log&&this.trtcCloud._log.createLogger&&(this.logger=this.trtcCloud._log.createLogger({id:`roomEngine${this.seq}`,userId:t,sdkAppId:n}))}debug(...e){const t=this.getLogMessage(e);this.logger.debug(t)}info(...e){const t=this.getLogMessage(e);this.logger&&this.logger.info&&this.logger.info(t)}warn(...e){const t=this.getLogMessage(e);this.logger&&this.logger.warn&&this.logger.warn(t)}error(...e){const t=this.getLogMessage(e);this.logger&&this.logger.error&&this.logger.error(t)}getTime(){const e=new Date;return`${e.toLocaleTimeString("en-US",{hour12:!1})}.${function(e){let t;switch(e.toString().length){case 1:t=`00${e}`;break;case 2:t=`0${e}`;break;default:t=e}return t}(e.getMilliseconds())}`}};const yn=new hn;let In=class e{constructor(e){const{Module:t,logger:n,globalEvent:o}=e;this.conferenceInvitationManager||(this.logger=n,this.conferenceInvitationManager=t,this.globalEvent=o)}static getInstance(t){return e.instance||(e.instance=new e(t)),e.instance}JSCallNativeFunctionPromise(e,t){return new Promise(((n,o)=>{const i=t=>{const i=jt(t);0===i.code?(this.logger.info(`conferenceInvitationManager.${e} success`,i.data),n(i.data)):(this.logger.warn(`conferenceInvitationManager.${e} fail. `,i),o(new Kt(i)))};try{if(!t)return this.conferenceInvitationManager[e](i);this.conferenceInvitationManager[e](t,i)}catch(s){this.logger.warn(`conferenceInvitationManager.${e} error. `,s.code,s.message),o(new Kt({code:s.code||at.ERR_FAILED,message:s.message}))}}))}JSCallNativeFunctionSync(e,t){return this.conferenceInvitationManager[e](t)}inviteUsers(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceInvitationManager.inviteUsers with options: ",e),yield this.JSCallNativeFunctionPromise("inviteUsers",e)}))}cancelInvitation(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceInvitationManager.cancelInvitation with options: ",e),yield this.JSCallNativeFunctionPromise("cancelInvitation",e)}))}accept(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceInvitationManager.accept with options: ",e),yield this.JSCallNativeFunctionPromise("accept",e)}))}reject(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceInvitationManager.reject with options: ",e),yield this.JSCallNativeFunctionPromise("reject",e)}))}getInvitationList(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("conferenceInvitationManager.getInvitationList with options: ",e),yield this.JSCallNativeFunctionPromise("getInvitationList",e)}))}static once(e,t){"ready"===e&&t()}on(e,t){yn.on(e,t),this.setObserver(e)}setObserver(e){this.logger.info(`listen for event: ${e}`),this.globalEvent.addEventListener(e,(t=>{"{}"===JSON.stringify(t)?yn.emit(e):yn.emit(e,t),this.logger.info(`conferenceInvitationManager received event: [${e}] ${JSON.stringify(t)}`)}))}off(e,t){yn.off(e,t)}};const Mn=new hn;let Cn=class e{constructor(e){const{Module:t,logger:n,globalEvent:o}=e;this.conferenceListManager||(this.logger=n,this.conferenceListManager=t,this.globalEvent=o)}static getInstance(t){return e.instance||(e.instance=new e(t)),e.instance}JSCallNativeFunctionPromise(e,t){return new Promise(((n,o)=>{const i=t=>{const i=jt(t);0===i.code?(this.logger.info(`conferenceInvitationManager.${e} success`,i.data),n(i.data)):(this.logger.warn(`conferenceInvitationManager.${e} fail. `,i),o(new Kt(i)))};try{if(!t)return this.conferenceListManager[e](i);this.conferenceListManager[e](t,i)}catch(s){this.logger.warn(`conferenceInvitationManager.${e} error. `,s.code,s.message),o(new Kt({code:s.code||at.ERR_FAILED,message:s.message}))}}))}JSCallNativeFunctionSync(e,t){return this.conferenceListManager[e](t)}scheduleConference(e){return wt(this,void 0,void 0,(function*(){const{scheduleStartTime:t,scheduleEndTime:n,scheduleAttendees:o=[],reminderSecondsBeforeStart:i=0,roomId:s,roomName:a,roomType:r,maxSeatCount:c,isSeatEnabled:u=!1,seatMode:l=ht.kFreeToTake,isMicrophoneDisableForAllUser:d,isScreenShareDisableForAllUser:p,isCameraDisableForAllUser:h,isMessageDisableForAllUser:g,password:_=""}=e;delete e.password,this.logger.info("conferenceListManager.scheduleConference with options: ",e);const f={conferenceInfo:{basicRoomInfo:{roomId:s,roomType:r,name:a,isSeatEnabled:u,seatMode:l,isMicrophoneDisableForAllUser:d,isScreenShareDisableForAllUser:p,isCameraDisableForAllUser:h,isMessageDisableForAllUser:g,maxSeatCount:c,password:_},scheduleStartTime:t,scheduleEndTime:n,scheduleAttendees:o,reminderSecondsBeforeStart:i}};yield this.JSCallNativeFunctionPromise("scheduleConference",f)}))}cancelConference(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceListManager.cancelConference with options: ",e),yield this.JSCallNativeFunctionPromise("cancelConference",e)}))}updateConferenceInfo(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceListManager.updateConferenceInfo with options: ",e),yield this.JSCallNativeFunctionPromise("updateConferenceInfo",e)}))}fetchScheduledConferenceList(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceListManager.fetchScheduledConferenceList with options: ",e);const{cursor:t,count:n,statusArray:o}=e,i={cursor:t,count:n,status:o};return _("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",i),yield this.JSCallNativeFunctionPromise("fetchScheduledConferenceList",i)}))}fetchAttendeeList(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("conferenceListManager.fetchAttendeeList with options: ",e),yield this.JSCallNativeFunctionPromise("fetchAttendeeList",e)}))}addAttendeesByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceListManager.addAttendeesByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("addAttendeesByAdmin",e)}))}removeAttendeesByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("conferenceListManager.removeAttendeesByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("removeAttendeesByAdmin",e)}))}static once(e,t){"ready"===e&&t()}on(e,t){Mn.on(e,t),this.setObserver(e)}setObserver(e){this.logger.info(`listen for event: ${e}`),this.globalEvent.addEventListener(e,(t=>{"{}"===JSON.stringify(t)?Mn.emit(e):Mn.emit(e,t),this.logger.info(`conferenceInvitationManager received event: [${e}] ${JSON.stringify(t)}`)}))}off(e,t){Mn.off(e,t)}};var Tn,En,Sn,Dn,kn,Rn,Ln,An,On,Nn,Pn,bn,Un,Gn,wn,Fn,xn,Vn,qn;Cn.ROOM_NAME=1,Cn.SCHEDULED_START_TIME=65536,Cn.SCHEDULED_END_TIME=1<<17,function(e){e[e.TRTCVideoResolution_120_120=1]="TRTCVideoResolution_120_120",e[e.TRTCVideoResolution_160_160=3]="TRTCVideoResolution_160_160",e[e.TRTCVideoResolution_270_270=5]="TRTCVideoResolution_270_270",e[e.TRTCVideoResolution_480_480=7]="TRTCVideoResolution_480_480",e[e.TRTCVideoResolution_160_120=50]="TRTCVideoResolution_160_120",e[e.TRTCVideoResolution_240_180=52]="TRTCVideoResolution_240_180",e[e.TRTCVideoResolution_280_210=54]="TRTCVideoResolution_280_210",e[e.TRTCVideoResolution_320_240=56]="TRTCVideoResolution_320_240",e[e.TRTCVideoResolution_400_300=58]="TRTCVideoResolution_400_300",e[e.TRTCVideoResolution_480_360=60]="TRTCVideoResolution_480_360",e[e.TRTCVideoResolution_640_480=62]="TRTCVideoResolution_640_480",e[e.TRTCVideoResolution_960_720=64]="TRTCVideoResolution_960_720",e[e.TRTCVideoResolution_160_90=100]="TRTCVideoResolution_160_90",e[e.TRTCVideoResolution_256_144=102]="TRTCVideoResolution_256_144",e[e.TRTCVideoResolution_320_180=104]="TRTCVideoResolution_320_180",e[e.TRTCVideoResolution_480_270=106]="TRTCVideoResolution_480_270",e[e.TRTCVideoResolution_640_360=108]="TRTCVideoResolution_640_360",e[e.TRTCVideoResolution_960_540=110]="TRTCVideoResolution_960_540",e[e.TRTCVideoResolution_1280_720=112]="TRTCVideoResolution_1280_720",e[e.TRTCVideoResolution_1920_1080=114]="TRTCVideoResolution_1920_1080"}(Tn||(Tn={})),function(e){e[e.TRTCVideoStreamTypeBig=0]="TRTCVideoStreamTypeBig",e[e.TRTCVideoStreamTypeSmall=1]="TRTCVideoStreamTypeSmall",e[e.TRTCVideoStreamTypeSub=2]="TRTCVideoStreamTypeSub"}(En||(En={})),function(e){e[e.TRTCVideoFillMode_Fill=0]="TRTCVideoFillMode_Fill",e[e.TRTCVideoFillMode_Fit=1]="TRTCVideoFillMode_Fit"}(Sn||(Sn={})),function(e){e[e.TRTCVideoMirrorType_Auto=0]="TRTCVideoMirrorType_Auto",e[e.TRTCVideoMirrorType_Enable=1]="TRTCVideoMirrorType_Enable",e[e.TRTCVideoMirrorType_Disable=2]="TRTCVideoMirrorType_Disable"}(Dn||(Dn={})),function(e){e[e.TRTCBeautyStyleSmooth=0]="TRTCBeautyStyleSmooth",e[e.TRTCBeautyStyleNature=1]="TRTCBeautyStyleNature"}(kn||(kn={})),function(e){e[e.TRTCAppSceneVideoCall=0]="TRTCAppSceneVideoCall",e[e.TRTCAppSceneLIVE=1]="TRTCAppSceneLIVE",e[e.TRTCAppSceneAudioCall=2]="TRTCAppSceneAudioCall",e[e.TRTCAppSceneVoiceChatRoom=3]="TRTCAppSceneVoiceChatRoom"}(Rn||(Rn={})),function(e){e[e.TRTCRoleAnchor=20]="TRTCRoleAnchor",e[e.TRTCRoleAudience=21]="TRTCRoleAudience"}(Ln||(Ln={})),function(e){e[e.TRTCAudioQualityDefault=0]="TRTCAudioQualityDefault",e[e.TRTCAudioQualitySpeech=1]="TRTCAudioQualitySpeech",e[e.TRTCAudioQualityMusic=3]="TRTCAudioQualityMusic"}(An||(An={})),function(e){e[e.TRTCDeviceStateAdd=0]="TRTCDeviceStateAdd",e[e.TRTCDeviceStateRemove=1]="TRTCDeviceStateRemove",e[e.TRTCDeviceStateActive=2]="TRTCDeviceStateActive"}(On||(On={})),function(e){e[e.TRTCDeviceTypeUnknow=-1]="TRTCDeviceTypeUnknow",e[e.TRTCDeviceTypeMic=0]="TRTCDeviceTypeMic",e[e.TRTCDeviceTypeSpeaker=1]="TRTCDeviceTypeSpeaker",e[e.TRTCDeviceTypeCamera=2]="TRTCDeviceTypeCamera"}(Nn||(Nn={}));let Bn=class{constructor(e=Tn.TRTCVideoResolution_640_360,t=15,n=550){this.videoResolution=e,this.videoFps=t,this.videoBitrate=n}};!function(e){e[e.TRTCVideoRotation0=0]="TRTCVideoRotation0",e[e.TRTCVideoRotation90=1]="TRTCVideoRotation90",e[e.TRTCVideoRotation180=2]="TRTCVideoRotation180",e[e.TRTCVideoRotation270=3]="TRTCVideoRotation270"}(Pn||(Pn={})),function(e){e[e.TRTCQuality_Unknown=0]="TRTCQuality_Unknown",e[e.TRTCQuality_Excellent=1]="TRTCQuality_Excellent",e[e.TRTCQuality_Good=2]="TRTCQuality_Good",e[e.TRTCQuality_Poor=3]="TRTCQuality_Poor",e[e.TRTCQuality_Bad=4]="TRTCQuality_Bad",e[e.TRTCQuality_Vbad=5]="TRTCQuality_Vbad",e[e.TRTCQuality_Down=6]="TRTCQuality_Down"}(bn||(bn={})),function(e){e[e.TRTCVideoResolutionModeLandscape=0]="TRTCVideoResolutionModeLandscape",e[e.TRTCVideoResolutionModePortrait=1]="TRTCVideoResolutionModePortrait"}(Un||(Un={})),function(e){e[e.TRTCVideoQosPreferenceSmooth=1]="TRTCVideoQosPreferenceSmooth",e[e.TRTCVideoQosPreferenceClear=2]="TRTCVideoQosPreferenceClear"}(Gn||(Gn={})),function(e){e[e.TRTCQosControlModeClient=0]="TRTCQosControlModeClient",e[e.TRTCQosControlModeServer=1]="TRTCQosControlModeServer"}(wn||(wn={})),function(e){e[e.TRTCLogLevelVerbose=0]="TRTCLogLevelVerbose",e[e.TRTCLogLevelDebug=1]="TRTCLogLevelDebug",e[e.TRTCLogLevelInfo=2]="TRTCLogLevelInfo",e[e.TRTCLogLevelWarn=3]="TRTCLogLevelWarn",e[e.TRTCLogLevelError=4]="TRTCLogLevelError",e[e.TRTCLogLevelFatal=5]="TRTCLogLevelFatal",e[e.TRTCLogLevelNone=6]="TRTCLogLevelNone"}(Fn||(Fn={})),function(e){e[e.TRTCScreenCaptureSourceTypeUnknown=-1]="TRTCScreenCaptureSourceTypeUnknown",e[e.TRTCScreenCaptureSourceTypeWindow=0]="TRTCScreenCaptureSourceTypeWindow",e[e.TRTCScreenCaptureSourceTypeScreen=1]="TRTCScreenCaptureSourceTypeScreen",e[e.TRTCScreenCaptureSourceTypeCustom=2]="TRTCScreenCaptureSourceTypeCustom"}(xn||(xn={})),function(e){e[e.TRTCTranscodingConfigMode_Unknown=0]="TRTCTranscodingConfigMode_Unknown",e[e.TRTCTranscodingConfigMode_Manual=1]="TRTCTranscodingConfigMode_Manual",e[e.TRTCTranscodingConfigMode_Template_PureAudio=2]="TRTCTranscodingConfigMode_Template_PureAudio",e[e.TRTCTranscodingConfigMode_Template_PresetLayout=3]="TRTCTranscodingConfigMode_Template_PresetLayout",e[e.TRTCTranscodingConfigMode_Template_ScreenSharing=4]="TRTCTranscodingConfigMode_Template_ScreenSharing",e[e.TRTC_TranscodingConfigMode_Unknown=5]="TRTC_TranscodingConfigMode_Unknown",e[e.TRTC_TranscodingConfigMode_Manual=6]="TRTC_TranscodingConfigMode_Manual",e[e.TRTC_TranscodingConfigMode_Template_PureAudio=7]="TRTC_TranscodingConfigMode_Template_PureAudio",e[e.TRTC_TranscodingConfigMode_Template_PresetLayout=8]="TRTC_TranscodingConfigMode_Template_PresetLayout",e[e.TRTC_TranscodingConfigMode_Template_ScreenSharing=9]="TRTC_TranscodingConfigMode_Template_ScreenSharing"}(Vn||(Vn={})),function(e){e[e.TRTCMixInputTypeUndefined=0]="TRTCMixInputTypeUndefined",e[e.TRTCMixInputTypeAudioVideo=1]="TRTCMixInputTypeAudioVideo",e[e.TRTCMixInputTypePureVideo=2]="TRTCMixInputTypePureVideo",e[e.TRTCMixInputTypePureAudio=3]="TRTCMixInputTypePureAudio"}(qn||(qn={}));const Hn=new vn({}),jn=g("TencentCloud-TUIRoomEngine"),Kn=g("globalEvent"),Yn=cn;let zn=1;const Wn=new hn;let Jn=class e{constructor(){this.roomId="",this.localVideoQuality=ct.kVideoQuality_720p,this.localAudioQuality=ut.kAudioProfileDefault,this.roomEngine||(this.roomEngine=jn,this.logger=new vn({},{sdkAppId:e.sdkAppId,userId:e.userId,seq:zn}),zn+=1)}static JSCallNativeFunctionPromise(e,t){return new Promise(((n,o)=>{const i=t=>{const i=jt(t);0===i.code?(Hn.info(`roomEngine.${e} success`,i),n(i)):(_("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`roomEngine.${e} fail. `,i),o(new Kt(i)))};try{t?jn[e](t,i):jn[e](i)}catch(s){_("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`roomEngine.${e} error. `,s.code,s.message),o(new Kt({code:s.code||at.ERR_FAILED,message:s.message}))}}))}static JSCallNativeFunctionSync(e,t){return jn[e](t)}JSCallNativeFunctionPromise(e,t){return new Promise(((n,o)=>{const i=t=>{const i=jt(t);0===i.code?(this.logger.info(`roomEngine.${e} success`,i.data),n(i.data)):(this.logger.warn(`roomEngine.${e} fail. `,i),o(new Kt(i)))};try{if(!t)return this.roomEngine[e](i);this.roomEngine[e](t,i)}catch(s){this.logger.warn(`roomEngine.${e} error. `,s.code,s.message),o(new Kt({code:s.code||at.ERR_FAILED,message:s.message}))}}))}JSCallNativeFunctionSync(e,t){return this.roomEngine[e](t)}JSCallNativeRequestFunctionPromise(e,t){const{requestCallback:n}=t;return new Promise(((o,i)=>{const s=t=>{this.logger.info(`roomEngine.${e} success with request:`,t),o(t)},a=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestAccepted});n(t)},r=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestRejected});n(t)},c=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestCancelled});n(t)},u=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestTimeout});n(t)},l=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestError});i(new Kt(t))};try{this.roomEngine[e](t,a,r,c,u,l,s)}catch(d){_("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`roomEngine.${e} error. `,d.code,d.message),i(new Kt({code:d.code||at.ERR_FAILED,message:d.message}))}}))}static login(t){return wt(this,void 0,void 0,(function*(){const{sdkAppId:n,userId:o,userSig:i,tim:s}=t;e.userId=o,e.sdkAppId=n,Hn.info("TUIRoomEngine.login with options: ",t),yield this.JSCallNativeFunctionPromise("login",t),s?e.tim=s:(e.tim=mn.create({SDKAppID:n}),e.tim.login({userID:o,userSig:i}))}))}static setSelfInfo(e){return wt(this,void 0,void 0,(function*(){Hn.info("TUIRoomEngine.setSelfInfo with options: ",e);const{userName:t,avatarUrl:n,customInfo:o}=e,i={userName:t,avatarUrl:n,customInfo:JSON.stringify(o)};yield this.JSCallNativeFunctionPromise("setSelfInfo",i)}))}static getTIM(){return e.tim}static getSelfInfo(){return wt(this,void 0,void 0,(function*(){return yield this.JSCallNativeFunctionSync("getSelfInfo")}))}static logout(){return wt(this,void 0,void 0,(function*(){Hn.info("TUIRoomEngine.logout."),yield this.JSCallNativeFunctionPromise("logout")}))}createRoom(e){return wt(this,void 0,void 0,(function*(){const{roomId:t,roomName:n,roomType:o,maxSeatCount:i,isSeatEnabled:s=!1,seatMode:a=ht.kFreeToTake,isMicrophoneDisableForAllUser:r,isScreenShareDisableForAllUser:c,isCameraDisableForAllUser:u,isMessageDisableForAllUser:l,password:d=""}=e;this.roomId=t,delete e.password,this.logger.info("roomEngine.createRoom with options: ",e);const p={roomInfo:{roomId:t,roomType:o,roomName:n,isSeatEnabled:s,seatMode:a,isMicrophoneDisableForAllUser:r,isScreenShareDisableForAllUser:c,isCameraDisableForAllUser:u,isMessageDisableForAllUser:l,maxSeatCount:i,password:d}};yield this.JSCallNativeFunctionPromise("createRoom",p)}))}enterRoom(t){return wt(this,void 0,void 0,(function*(){const{roomId:n,roomType:o=pt.kConference,options:i={}}=t;return delete t.options,this.logger.info("roomEngine.enterRoom with options: ",t),this.roomId=n,this.logger.info({sdkAppId:e.sdkAppId,userId:e.userId}),yield this.JSCallNativeFunctionPromise("enterRoom",t)}))}destroyRoom(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.destroyRoom"),yield this.JSCallNativeFunctionPromise("destroyRoom")}))}exitRoom(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.exitRoom"),yield this.JSCallNativeFunctionPromise("exitRoom",{syncWaiting:!1})}))}fetchRoomInfo(e){return wt(this,void 0,void 0,(function*(){return new Promise(((t,n)=>{const o=e=>{const o=jt(e);if(0===o.code){this.logger.info("roomEngine.fetchRoomInfo success",o.data);const e=Object.assign(Object.assign({},o.data),{roomOwner:o.data.ownerId});t(e)}else this.logger.warn("roomEngine.fetchRoomInfo fail. ",o),n(new Kt(o))};try{return e?this.roomEngine.fetchRoomInfoById(e,o):this.roomEngine.fetchRoomInfo(o)}catch(i){this.logger.warn("roomEngine.fetchRoomInfo error. ",i.code,i.message),n(new Kt({code:i.code||at.ERR_FAILED,message:i.message}))}}))}))}updateRoomNameByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.updateRoomNameByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("updateRoomNameByAdmin",e)}))}updateRoomSeatModeByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.updateRoomSeatModeByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("updateRoomSeatModeByAdmin",e)}))}updateRoomPasswordByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.updateRoomPasswordByAdmin"),yield this.JSCallNativeFunctionPromise("updateRoomPasswordByAdmin",e)}))}getUserList(e){return wt(this,void 0,void 0,(function*(){const t={nextSequence:e&&e.nextSequence||0};return yield this.JSCallNativeFunctionPromise("getUserList",t)}))}getUserInfo(e){return wt(this,void 0,void 0,(function*(){return yield this.JSCallNativeFunctionPromise("getUserInfo",e)}))}setCustomInfoForUser(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.setCustomInfoForUser with options: ",e),yield this.JSCallNativeFunctionPromise("setCustomInfoForUser",e)}))}setLocalVideoView(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.setLocalVideoView"),this.JSCallNativeFunctionSync("setLocalVideoView")}))}openLocalCamera(e={isFrontCamera:!0}){return wt(this,void 0,void 0,(function*(){if("android"===uni.getSystemInfoSync().platform&&1!==(yield ln("android.permission.CAMERA")))throw new Kt({code:at.ERR_CAMERA_NOT_AUTHORIZED,message:"permission denied"});this.logger.info("roomEngine.openLocalCamera",e);const{isFrontCamera:t}=e,n={isFront:t?1:0,quality:this.localVideoQuality};yield this.JSCallNativeFunctionPromise("openLocalCamera",n)}))}closeLocalCamera(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.closeLocalCamera"),yield this.JSCallNativeFunctionSync("closeLocalCamera")}))}openLocalMicrophone(){return wt(this,void 0,void 0,(function*(){if("android"===uni.getSystemInfoSync().platform&&1!==(yield ln("android.permission.RECORD_AUDIO")))throw new Kt({code:at.ERR_MICROPHONE_NOT_AUTHORIZED,message:"permission denied"});this.logger.info("roomEngine.openLocalMicrophone");const e={quality:this.localAudioQuality};try{return yield this.JSCallNativeFunctionPromise("openLocalMicrophone",e)}catch(t){if("you have been muted the audio"===t.message||"open microphone need apply to admin"===t.message)return void this.logger.warn(t);throw t}}))}closeLocalMicrophone(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.closeLocalMicrophone"),yield this.JSCallNativeFunctionSync("closeLocalMicrophone")}))}updateVideoQuality(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.updateVideoQuality with options: ",e);const{quality:t}=e;this.localVideoQuality=t,yield this.JSCallNativeFunctionPromise("updateVideoQuality",e)}))}setVideoResolutionMode(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.setVideoResolutionMode with options: ",e),yield this.JSCallNativeFunctionSync("setVideoResolutionMode",e)}))}updateVideoQualityEx(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.updateVideoQualityEx with options: ",e);const{streamType:t,encoderParams:n}=e;n&&n.videoResolution&&t===lt.kCameraStream&&(this.localVideoQuality=n&&n.videoResolution);const o={streamType:t,encoderParams:n};yield this.JSCallNativeFunctionSync("updateVideoQualityEx",o)}))}updateAudioQuality(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.updateAudioQuality with options: ",e);const{quality:t}=e;this.localAudioQuality=t,yield this.JSCallNativeFunctionSync("updateAudioQuality",e)}))}startPushLocalVideo(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.startPushLocalVideo"),yield this.JSCallNativeFunctionSync("startPushLocalVideo")}))}stopPushLocalVideo(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.stopPushLocalVideo"),yield this.JSCallNativeFunctionSync("stopPushLocalVideo")}))}startPushLocalAudio(){return wt(this,void 0,void 0,(function*(){this.logger.warn("roomEngine.startPushLocalAudio is deprecated since v1.5.0, please use roomEngine.muteLocalAudio."),yield this.JSCallNativeFunctionPromise("startPushLocalAudio")}))}stopPushLocalAudio(){return wt(this,void 0,void 0,(function*(){this.logger.warn("roomEngine.stopPushLocalAudio is deprecated since v1.5.0, please use roomEngine.muteLocalAudio."),yield this.JSCallNativeFunctionPromise("stopPushLocalAudio")}))}muteLocalAudio(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.muteLocalAudio"),yield this.JSCallNativeFunctionPromise("muteLocalAudio")}))}unmuteLocalAudio(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.unmuteLocalAudio"),yield this.JSCallNativeFunctionPromise("unmuteLocalAudio")}))}setRemoteVideoView(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.setRemoteVideoView with options: ",e),yield this.JSCallNativeFunctionSync("setRemoteVideoView",e)}))}startPlayRemoteVideo(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.startPlayRemoteVideo with options: ",e);const{userId:t,streamType:n}=e;return new Promise(((e,o)=>{const i={userId:t,streamType:n,playingCallback:t=>{_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine startPlayRemoteVideo playingCallback",t),e()},loadingCallback:e=>{_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine startPlayRemoteVideo loadingCallback",e)},errorCallback:e=>{_("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine startPlayRemoteVideo errorCallback",e),o()}};try{this.roomEngine.startPlayRemoteVideo(i)}catch(s){_("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine.startPlayRemoteVideo error. ",s.code,s.message);const e=new Kt({code:s.code||at.ERR_FAILED,message:s.message});o(e)}}))}))}stopPlayRemoteVideo(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.stopPlayRemoteVideo with options: ",e),yield this.JSCallNativeFunctionSync("stopPlayRemoteVideo",e)}))}muteRemoteAudioStream(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.muteRemoteAudioStream with options",e),yield this.JSCallNativeFunctionSync("muteRemoteAudioStream",e)}))}openRemoteDeviceByAdmin(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.openRemoteDeviceByAdmin with options: ",e),e.requestCallback||(e.requestCallback=()=>{}),yield this.JSCallNativeRequestFunctionPromise("openRemoteDeviceByAdmin",e)}))}applyToAdminToOpenLocalDevice(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.applyToAdminToOpenLocalDevice with options: ",e),e.requestCallback||(e.requestCallback=()=>{}),yield this.JSCallNativeRequestFunctionPromise("applyToAdminToOpenLocalDevice",e)}))}closeRemoteDeviceByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.closeRemoteDeviceByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("closeRemoteDeviceByAdmin",e)}))}cancelRequest(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.cancelRequest with options: ",e),yield this.JSCallNativeFunctionPromise("cancelRequest",e)}))}responseRemoteRequest(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.responseRemoteRequest with options: ",e),yield this.JSCallNativeFunctionPromise("responseRemoteRequest",e)}))}disableDeviceForAllUserByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.disableDeviceForAllUserByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("disableDeviceForAllUserByAdmin",e)}))}disableSendingMessageForAllUser(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.disableSendingMessageForAllUser with options: ",e),yield this.JSCallNativeFunctionPromise("disableSendingMessageForAllUser",e)}))}disableSendingMessageByAdmin(e){return wt(this,void 0,void 0,(function*(){yield this.JSCallNativeFunctionPromise("disableSendingMessageByAdmin",e)}))}changeUserRole(e){return wt(this,void 0,void 0,(function*(){const{userId:t,userRole:n}=e,o={userId:t,role:n};this.logger.info("roomEngine.changeUserRole with options: ",o),yield this.JSCallNativeFunctionPromise("changeUserRole",o)}))}changeUserNameCard(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.changeUserNameCard with options: ",e),yield this.JSCallNativeFunctionPromise("changeUserNameCard",e)}))}kickRemoteUserOutOfRoom(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.kickRemoteUserOutOfRoom with options: ",e),yield this.JSCallNativeFunctionPromise("kickRemoteUserOutOfRoom",e)}))}setMaxSeatCount(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.setMaxSeatCount with options: ",e),yield this.JSCallNativeFunctionPromise("setMaxSeatCount",e)}))}getSeatList(){return wt(this,void 0,void 0,(function*(){return yield this.JSCallNativeFunctionPromise("getSeatList")}))}takeSeat(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.takeSeat with options: ",e),e.requestCallback||(e.requestCallback=()=>{});const{seatIndex:t,timeout:n,requestCallback:o}=e;let i=!0,s={content:"",requestAction:0,requestId:"",timestamp:0,userId:"",userName:"",nameCard:"",avatarUrl:""};return new Promise(((t,n)=>{const a=e=>{""===e.requestId?(i=!1,s=e):(this.logger.info("roomEngine.takeSeat success with requestId:",e),t(e))},r=e=>{const n=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestAccepted});if(o(n),!i)return this.logger.info("roomEngine.takeSeat success without request."),void t(s)},c=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestRejected});o(t)},u=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestCancelled});o(t)},l=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestTimeout});o(t)},d=e=>{const t=Object.assign(Object.assign({},e),{requestCallbackType:yt.kRequestError});n(new Kt(t))};try{this.roomEngine.takeSeat(e,r,c,u,l,d,a)}catch(p){_("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine.takeSeat error. ",p.code,p.message),n(new Kt({code:p.code||at.ERR_FAILED,message:p.message}))}}))}))}moveToSeat(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.moveToSeat with options:",e),yield this.JSCallNativeFunctionPromise("moveToSeat",e)}))}leaveSeat(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.leaveSeat"),yield this.JSCallNativeFunctionPromise("leaveSeat")}))}takeUserOnSeatByAdmin(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.takeUserOnSeatByAdmin with options: ",e),e.requestCallback||(e.requestCallback=()=>{}),yield this.JSCallNativeRequestFunctionPromise("takeUserOnSeatByAdmin",e)}))}kickUserOffSeatByAdmin(e){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.kickUserOffSeatByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("kickUserOffSeatByAdmin",e)}))}lockSeatByAdmin(e){return wt(this,void 0,void 0,(function*(){return this.logger.info("roomEngine.lockSeatByAdmin with options: ",e),yield this.JSCallNativeFunctionPromise("lockSeatByAdmin",e)}))}getSeatApplicationList(){return wt(this,void 0,void 0,(function*(){return yield this.JSCallNativeFunctionPromise("getSeatApplicationList")}))}getMediaDeviceManager(){return this.deviceManager||(this.deviceManager=gn.getInstance({logger:this.logger,Module:this.roomEngine})),this.deviceManager}startScreenSharing(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.startScreenSharing"),yield this.JSCallNativeFunctionSync("startScreenCapture")}))}stopScreenSharing(){return wt(this,void 0,void 0,(function*(){this.logger.info("roomEngine.stopScreenSharing"),yield this.JSCallNativeFunctionSync("stopScreenCapture")}))}getTRTCCloud(){return this.trtcCloud||(this.trtcCloud=_n.getInstance({logger:this.logger,Module:this.roomEngine})),this.trtcCloud}getConferenceListManager(){return this.conferenceListManager||(this.conferenceListManager=Cn.getInstance({logger:this.logger,Module:this.roomEngine,globalEvent:Kn})),this.conferenceListManager}getConferenceInvitationManager(){return this.conferenceInvitationManager||(this.conferenceInvitationManager=In.getInstance({logger:this.logger,Module:this.roomEngine,globalEvent:Kn})),this.conferenceInvitationManager}static callExperimentalAPI(t){return wt(this,void 0,void 0,(function*(){Hn.info("TUIRoomEngine.callExperimentalAPI",t);const n=jt(t);if(n===t)return;const{api:o,params:i}=n;o&&i&&("setFramework"===o?yield e.handleSetFramework(i):yield e.JSCallNativeFunctionPromise("callExperimentalAPI",{jsonStr:t}))}))}static handleSetFramework(t){return wt(this,void 0,void 0,(function*(){const{component:n,language:o}=t,i={TUIRoomEngine:16,TUIRoomKit:18,TIMRoomKit:19,TUILiveKit:21,VoiceRoom:22,EngineLive:23,Classroom:24},s={vue2:5,vue3:6},a={framework:{[cn]:11}[Yn]};if(i[n]&&(a.component=i[n]),s[o]&&(a.language=s[o]),a){const t={jsonStr:JSON.stringify({api:"setFramework",params:a})};yield e.JSCallNativeFunctionPromise("callExperimentalAPI",t)}}))}static once(e,t){"ready"===e&&t()}on(e,t){Wn.on(e,t),this.setObserver(e)}transformParams(e,t){let n={};return e===At.onUserVoiceVolumeChanged?(n.userVolumeList=[],Object.keys(t.volumeMap).forEach((e=>{n.userVolumeList.push({userId:e,volume:t.volumeMap[e]})}))):n=t,n}setObserver(e){this.logger.info(`listen for event: ${e}`),Kn.addEventListener(e,(t=>{if("{}"===JSON.stringify(t))Wn.emit(e);else{const n=this.transformParams(e,t);Wn.emit(e,n)}[At.onUserVoiceVolumeChanged,At.onUserNetworkQualityChanged,At.onReceiveTextMessage,At.onReceiveCustomMessage].includes(e)||(e!==At.onSeatListChanged?this.logger.info(`RoomEngine received event: [${e}] ${JSON.stringify(t)}`):this.logger.info(`RoomEngine received event: [onSeatListChanged] {seatedList: ${JSON.stringify(t)}, leftList: ${JSON.stringify(t)}}`))}))}off(e,t){Wn.off(e,t)}};Gt([Xt(un.createRoom)],Jn.prototype,"createRoom",null),Gt([Xt(un.enterRoom)],Jn.prototype,"enterRoom",null),Gt([Xt(un.updateRoomNameByAdmin)],Jn.prototype,"updateRoomNameByAdmin",null),Gt([Xt(un.updateRoomSeatModeByAdmin)],Jn.prototype,"updateRoomSeatModeByAdmin",null),Gt([Xt(un.updateRoomPasswordByAdmin)],Jn.prototype,"updateRoomPasswordByAdmin",null),Gt([Xt(un.getUserList)],Jn.prototype,"getUserList",null),Gt([Xt(un.getUserInfo)],Jn.prototype,"getUserInfo",null),Gt([Xt(un.setCustomInfoForUser)],Jn.prototype,"setCustomInfoForUser",null),Gt([$t(un.setLocalVideoView)],Jn.prototype,"setLocalVideoView",null),Gt([Xt(un.openLocalCamera)],Jn.prototype,"openLocalCamera",null),Gt([Xt(un.updateVideoQuality)],Jn.prototype,"updateVideoQuality",null),Gt([Xt(un.setVideoResolutionMode)],Jn.prototype,"setVideoResolutionMode",null),Gt([Xt(un.updateVideoQualityEx)],Jn.prototype,"updateVideoQualityEx",null),Gt([Xt(un.updateAudioQuality)],Jn.prototype,"updateAudioQuality",null),Gt([$t(un.setRemoteVideoView)],Jn.prototype,"setRemoteVideoView",null),Gt([$t(un.startPlayRemoteVideo)],Jn.prototype,"startPlayRemoteVideo",null),Gt([Xt(un.stopPlayRemoteVideo)],Jn.prototype,"stopPlayRemoteVideo",null),Gt([$t(un.muteRemoteAudioStream)],Jn.prototype,"muteRemoteAudioStream",null),Gt([Xt(un.openRemoteDeviceByAdmin)],Jn.prototype,"openRemoteDeviceByAdmin",null),Gt([Xt(un.applyToAdminToOpenLocalDevice)],Jn.prototype,"applyToAdminToOpenLocalDevice",null),Gt([Xt(un.closeRemoteDeviceByAdmin)],Jn.prototype,"closeRemoteDeviceByAdmin",null),Gt([Xt(un.cancelRequest)],Jn.prototype,"cancelRequest",null),Gt([Xt(un.responseRemoteRequest)],Jn.prototype,"responseRemoteRequest",null),Gt([Xt(un.disableDeviceForAllUserByAdmin)],Jn.prototype,"disableDeviceForAllUserByAdmin",null),Gt([Xt(un.disableSendingMessageForAllUser)],Jn.prototype,"disableSendingMessageForAllUser",null),Gt([Xt(un.disableSendingMessageByAdmin)],Jn.prototype,"disableSendingMessageByAdmin",null),Gt([Xt(un.changeUserRole)],Jn.prototype,"changeUserRole",null),Gt([Xt(un.changeUserNameCard)],Jn.prototype,"changeUserNameCard",null),Gt([Xt(un.kickRemoteUserOutOfRoom)],Jn.prototype,"kickRemoteUserOutOfRoom",null),Gt([Xt(un.setRoomMaxSeatCount)],Jn.prototype,"setMaxSeatCount",null),Gt([Xt(un.takeSeat)],Jn.prototype,"takeSeat",null),Gt([Xt(un.takeUserOnSeatByAdmin)],Jn.prototype,"takeUserOnSeatByAdmin",null),Gt([Xt(un.kickUserOffSeatByAdmin)],Jn.prototype,"kickUserOffSeatByAdmin",null),Gt([Xt(un.lockSeatByAdmin)],Jn.prototype,"lockSeatByAdmin",null),Gt([Xt(un.startScreenSharing)],Jn.prototype,"startScreenSharing",null),Gt([Xt(un.stopScreenSharing)],Jn.prototype,"stopScreenSharing",null),Gt([Xt(un.login),tn()],Jn,"login",null),Gt([Xt(un.setSelfInfo)],Jn,"setSelfInfo",null),Gt([tn()],Jn,"logout",null),Jn.callExperimentalAPI(JSON.stringify({api:"setFramework",params:{component:"TUIRoomEngine"}}));const $n=/^3\.*/.test(r.version),Xn={instance:null},Zn=$n?"vue3":"vue2";function Qn(){return e.onBeforeMount((()=>{Xn.instance=new Jn})),Xn}Jn.once("ready",(()=>{Jn.callExperimentalAPI(JSON.stringify({api:"setFramework",params:{component:"TUIRoomKit",language:Zn}}))}));const eo=Qn(),to=Te("room",{state:()=>({localUser:{userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,hasScreenStream:!1,userRole:rt.kGeneralUser,onSeat:!1,cameraStreamInfo:{userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,streamType:lt.kCameraStream,isVisible:!0,userRole:rt.kGeneralUser},screenStreamInfo:{userId:"",userName:"",avatarUrl:"",hasScreenStream:!1,streamType:lt.kScreenStream,isVisible:!0,userRole:rt.kGeneralUser}},remoteUserObj:{},userVolumeObj:{},isDefaultOpenCamera:!1,isDefaultOpenMicrophone:!1,canControlSelfAudio:!0,canControlSelfVideo:!0,localVideoQuality:et?ct.kVideoQuality_360p:ct.kVideoQuality_720p,currentCameraId:"",currentMicrophoneId:"",currentSpeakerId:"",cameraList:[],microphoneList:[],speakerList:[],masterUserId:"",isMicrophoneDisableForAllUser:!1,isCameraDisableForAllUser:!1,isMessageDisableForAllUser:!1,isSeatEnabled:!1,seatMode:ht.kFreeToTake,maxMembersCount:5,hasVideoStreamObject:{},currentStreamIdListInVisibleView:[],hasOtherScreenShare:!1,isOnStateTabActive:!0}),getters:{isMaster:e=>e.localUser.userId===e.masterUserId,isAdmin:e=>e.localUser.userRole===rt.kAdministrator,isGeneralUser:e=>e.localUser.userRole===rt.kGeneralUser,isAnchor(e){return!!this.isFreeSpeakMode||(this.isSpeakAfterTakingSeatMode?e.localUser.onSeat:void 0)},isAudience(e){return!this.isFreeSpeakMode&&(this.isSpeakAfterTakingSeatMode?!e.localUser.onSeat:void 0)},isSpeakAfterTakingSeatMode(){return this.isSeatEnabled&&this.seatMode===ht.kApplyToTake},isFreeSpeakMode(){return!this.isSeatEnabled},isLocalAudioIconDisable(){return this.isGeneralUser&&!this.canControlSelfAudio||this.isAudience},isLocalVideoIconDisable(){return this.isGeneralUser&&!this.canControlSelfVideo||this.isAudience},localStream:e=>{const{userId:t,userName:n,avatarUrl:o,hasAudioStream:i,hasVideoStream:s,userRole:a}=e.localUser;return Object.assign(e.localUser.cameraStreamInfo,{userId:t,userName:n,avatarUrl:o,hasAudioStream:i,hasVideoStream:s,userRole:a}),e.localUser.cameraStreamInfo},localScreenStream:e=>{const{userId:t,userName:n,avatarUrl:o,hasScreenStream:i,userRole:s}=e.localUser;return Object.assign(e.localUser.screenStreamInfo,{userId:t,userName:n,avatarUrl:o,hasScreenStream:i,userRole:s}),e.localUser.screenStreamInfo},remoteStreamObj:e=>{const t={};return[...Object.values(e.remoteUserObj)].forEach((e=>{const{userId:n,avatarUrl:o,userName:i,onSeat:s,hasAudioStream:a,hasVideoStream:r,hasScreenStream:c,isVideoVisible:u,isScreenVisible:l,userRole:d}=e;s&&(t[`${n}_${lt.kCameraStream}`]=Object.assign(e.cameraStreamInfo,{userId:n,avatarUrl:o,userName:i,hasAudioStream:a,hasVideoStream:r,userRole:d,streamType:lt.kCameraStream,isVisible:u})),c&&(t[`${n}_${lt.kScreenStream}`]=Object.assign(e.screenStreamInfo,{userId:n,avatarUrl:o,userName:i,hasScreenStream:c,userRole:d,streamType:lt.kScreenStream,isVisible:l}))})),t},remoteStreamList(){return[...Object.values(this.remoteStreamObj)]},streamList(){const e=[this.localStream,...Object.values(this.remoteStreamObj)];return this.localUser.hasScreenStream&&e.unshift(this.localScreenStream),e},streamNumber(){return this.streamList.length},remoteUserList:e=>[...Object.values(e.remoteUserObj)],remoteAnchorList:e=>[...Object.values(e.remoteUserObj)].filter((e=>e.onSeat)),userList:e=>[e.localUser,...Object.values(e.remoteUserObj)],userNumber(){return this.userList.length},anchorUserList:e=>[e.localUser,...Object.values(e.remoteUserObj)].filter((e=>e.onSeat)),applyToAnchorList:e=>[...Object.values(e.remoteUserObj)].filter((e=>e.isUserApplyingToAnchor)).sort(((e,t)=>((null==e?void 0:e.applyToAnchorTimestamp)||0)-((null==t?void 0:t.applyToAnchorTimestamp)||0)))||[],defaultStreamType(){return Object.keys(this.hasVideoStreamObject).length>this.maxMembersCount?lt.kCameraStreamLow:lt.kCameraStream}},actions:{setLocalUser(e){Object.assign(this.localUser,e)},updateLocalStream(e){Object.assign(this.localStream,e)},getUserName(e){var t;return e===this.localUser.userId?this.localUser.userName||e:(null==(t=this.remoteUserObj[e])?void 0:t.userName)||e},getUserRole(e){var t;return e===this.localUser.userId?this.localUser.userRole:null==(t=this.remoteUserObj[e])?void 0:t.userRole},getNewUserInfo(e){return{userId:e,userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,hasScreenStream:!1,isVideoVisible:!1,isScreenVisible:!1,userRole:rt.kGeneralUser,onSeat:!this.isSpeakAfterTakingSeatMode,isChatMutedByMasterOrAdmin:!1,isUserApplyingToAnchor:!1,isInvitingUserToAnchor:!1,cameraStreamInfo:{userId:e,userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,streamType:lt.kCameraStream,isVisible:!1,userRole:rt.kGeneralUser},screenStreamInfo:{userId:e,userName:"",avatarUrl:"",hasScreenStream:!1,streamType:lt.kScreenStream,isVisible:!1,userRole:rt.kGeneralUser}}},updateUserList(e){null==e||e.forEach((e=>{if(e.userId!==this.localUser.userId)if(this.remoteUserObj[e.userId])Object.assign(this.remoteUserObj[e.userId],e);else{const t=Object.assign(this.getNewUserInfo(e.userId),e);$n?this.remoteUserObj[e.userId]=t:r.set(this.remoteUserObj,e.userId,t)}else Object.assign(this.localUser,e)}))},addRemoteUser(e){const{userId:t}=e,n=ot();if(t&&t!==n.userId)if(this.remoteUserObj[t])Object.assign(this.remoteUserObj[t],e);else{const n=Object.assign(this.getNewUserInfo(t),e);$n?this.remoteUserObj[t]=n:r.set(this.remoteUserObj,t,n)}},updateRemoteUser(e,t){const n=this.remoteUserObj[e];if(!n)return;const{nick:o,avatar:i}=t;Object.assign(n,{userName:o,avatarUrl:i})},setSeatList(e){null==e||e.forEach((e=>{const{userId:t}=e;if(t)if(t===this.localUser.userId)Object.assign(this.localUser,{onSeat:!0});else{const e=this.remoteUserObj[t];if(e)Object.assign(e,{onSeat:!0});else{const e=Object.assign(this.getNewUserInfo(t),{onSeat:!0});$n?this.remoteUserObj[t]=e:r.set(this.remoteUserObj,t,e)}}}))},updateOnSeatList(e,t){e.forEach((e=>{const{userId:t}=e;if(t===this.localUser.userId)Object.assign(this.localUser,{onSeat:!0});else{const e=this.remoteUserObj[t];if(e)Object.assign(e,{onSeat:!0});else{const e=Object.assign(this.getNewUserInfo(t),{onSeat:!0});$n?this.remoteUserObj[t]=e:r.set(this.remoteUserObj,t,e)}}})),t.forEach((e=>{if(e.userId===this.localUser.userId){Object.assign(this.localUser,{onSeat:!1});ot().setIsOpenMic(!1)}else{const t=this.remoteUserObj[e.userId];t&&Object.assign(t,{onSeat:!1})}}))},updateUserVideoState(e,t,n){const o=ot();let i=e===o.userId?this.localUser:this.remoteUserObj[e];!i&&n&&(i=this.getNewUserInfo(e),$n?this.remoteUserObj[e]=i:r.set(this.remoteUserObj,e,i)),i&&(this.updatehasVideoStreamObject(i,n,e===o.userId),t===lt.kCameraStream||t===lt.kCameraStreamLow?i.hasVideoStream=n:t===lt.kScreenStream&&(i.hasScreenStream=n))},updatehasVideoStreamObject(e,t,n){if(n)return;const{userId:o,cameraStreamInfo:i,screenStreamInfo:s,hasVideoStream:a}=e,c=`${o}_${a?i.streamType:s.streamType}`;t?$n?this.hasVideoStreamObject[c]=e:r.set(this.hasVideoStreamObject,c,e):$n?delete this.hasVideoStreamObject[c]:r.delete(this.hasVideoStreamObject,c)},updateUserAudioState(e,t){let n=e===ot().userId?this.localUser:this.remoteUserObj[e];!n&&t&&(n=this.getNewUserInfo(e),$n?this.remoteUserObj[e]=n:r.set(this.remoteUserObj,e,n)),n&&(n.hasAudioStream=t)},removeRemoteUser(e){const t=ot();e&&e!==t.userId&&($n?delete this.remoteUserObj[e]:r.delete(this.remoteUserObj,e))},updateUserStreamVisible(e){e.forEach((e=>{const t=e.slice(0,e.length-2),n=Number(e.slice(-1));if(t===this.localUser.userId)return;const o=this.remoteUserObj[t];o&&(n===lt.kCameraStream||n===lt.kCameraStreamLow?o.isVideoVisible=!0:n===lt.kScreenStream&&(o.isScreenVisible=!0))})),this.currentStreamIdListInVisibleView.forEach((t=>{const n=t.slice(0,t.length-2),o=Number(t.slice(-1));if(e.indexOf(t)<0){const e=this.remoteUserObj[n];if(!e)return;o===lt.kCameraStream||o===lt.kCameraStreamLow?e.isVideoVisible=!1:o===lt.kScreenStream&&(e.isScreenVisible=!1)}})),this.currentStreamIdListInVisibleView=e},setAudioVolume(e){const t=ot();null==e||e.forEach((e=>{let{userId:n}=e;const{volume:o}=e;""===n&&(n=t.userId),$n?this.userVolumeObj[n]=o:r.set(this.userVolumeObj,n,o)}))},setCurrentDeviceId(e,t){switch(e){case Ct.kMediaDeviceTypeVideoCamera:this.setCurrentCameraId(t);break;case Ct.kMediaDeviceTypeAudioInput:this.setCurrentMicrophoneId(t);break;case Ct.kMediaDeviceTypeAudioOutput:this.setCurrentSpeakerId(t)}},setCurrentCameraId(e){this.currentCameraId=e},setCurrentMicrophoneId(e){this.currentMicrophoneId=e},setCurrentSpeakerId(e){this.currentSpeakerId=e},setRoomInfo(e){const{roomOwner:t,isMicrophoneDisableForAllUser:n,isCameraDisableForAllUser:o,isMessageDisableForAllUser:i,isSeatEnabled:s,seatMode:a}=e;this.localUser.userId===t&&(this.localUser.userRole=rt.kRoomOwner),this.masterUserId=t,this.isMicrophoneDisableForAllUser=n,this.isCameraDisableForAllUser=o,this.isMessageDisableForAllUser=i,this.isSeatEnabled=s,this.seatMode=a,this.canControlSelfAudio=!this.isMicrophoneDisableForAllUser,this.canControlSelfVideo=!this.isCameraDisableForAllUser},setDisableMicrophoneForAllUserByAdmin(e){this.isMicrophoneDisableForAllUser=e},setDisableCameraForAllUserByAdmin(e){this.isCameraDisableForAllUser=e},setDisableMessageAllUserByAdmin(e){this.isMessageDisableForAllUser=e},setMasterUserId(e){this.masterUserId=e},setRoomParam(e){var t,n,o;if(!e)return;const{isOpenCamera:i,isOpenMicrophone:s,defaultCameraId:a,defaultMicrophoneId:r,defaultSpeakerId:c}=e;a&&(this.setCurrentCameraId(a),null==(t=eo.instance)||t.setCurrentCameraDevice({deviceId:a})),r&&(this.setCurrentMicrophoneId(r),null==(n=eo.instance)||n.setCurrentMicDevice({deviceId:r})),c&&(this.setCurrentSpeakerId(c),null==(o=eo.instance)||o.setCurrentSpeakerDevice({deviceId:c})),(this.isMaster||!this.isMicrophoneDisableForAllUser&&this.isFreeSpeakMode)&&"boolean"==typeof s&&(this.isDefaultOpenMicrophone=s),(this.isMaster||!this.isCameraDisableForAllUser&&this.isFreeSpeakMode)&&"boolean"==typeof i&&(this.isDefaultOpenCamera=i)},setCanControlSelfAudio(e){this.canControlSelfAudio=e},setCanControlSelfVideo(e){this.canControlSelfVideo=e},updateVideoQuality(e){this.localVideoQuality=e},setDeviceList(e,t){switch(e){case Ct.kMediaDeviceTypeVideoCamera:this.setCameraList(t);break;case Ct.kMediaDeviceTypeAudioInput:this.setMicrophoneList(t);break;case Ct.kMediaDeviceTypeAudioOutput:this.setSpeakerList(t)}},setCameraList(e){this.cameraList=e,!this.currentCameraId&&e.length>0&&this.setCurrentCameraId(e[0].deviceId)},setMicrophoneList(e){this.microphoneList=e,!this.currentMicrophoneId&&e.length>0&&this.setCurrentMicrophoneId(e[0].deviceId)},setSpeakerList(e){this.speakerList=e,!this.currentSpeakerId&&e.length>0&&this.setCurrentSpeakerId(e[0].deviceId)},setMicrophoneDisableState(e){this.isMicrophoneDisableForAllUser=e},setCameraDisableState(e){this.isCameraDisableForAllUser=e},setMuteUserChat(e,t){const n=this.remoteUserObj[e];n&&(n.isChatMutedByMasterOrAdmin=t)},setRemoteUserRole(e,t){const n=this.remoteUserObj[e];n&&(n.userRole=t)},setRequestUserOpenMic(e){const{userId:t,isRequesting:n,requestId:o}=e,i=this.remoteUserObj[t];i&&(i.isRequestingUserOpenMic=n,i.requestUserOpenMicRequestId=n?o:"")},setRequestUserOpenCamera(e){const{userId:t,isRequesting:n,requestId:o}=e,i=this.remoteUserObj[t];i&&(i.isRequestingUserOpenCamera=n,i.requestUserOpenCameraRequestId=n?o:"")},addApplyToAnchorUser(e){const{userId:t,requestId:n,timestamp:o}=e,i=this.remoteUserObj[t];i&&(i.isUserApplyingToAnchor=!0,i.applyToAnchorRequestId=n,i.applyToAnchorTimestamp=o)},removeApplyToAnchorUser(e){const t=Object.values(this.remoteUserObj).find((t=>t.isUserApplyingToAnchor&&t.applyToAnchorRequestId===e));t&&(t.isUserApplyingToAnchor=!1,t.applyToAnchorRequestId="",t.applyToAnchorTimestamp=0)},addInviteToAnchorUser(e){const{userId:t,requestId:n}=e,o=this.remoteUserObj[t];o&&(o.isInvitingUserToAnchor=!0,o.inviteToAnchorRequestId=n)},removeInviteToAnchorUser(e){const t=this.remoteUserObj[e];t&&(t.isInvitingUserToAnchor=!1,t.inviteToAnchorRequestId="")},setHasOtherScreenShare(e){this.hasOtherScreenShare=e},setOnStageTabStatus(e){this.isOnStateTabActive=e},reset(){ot().setIsOpenMic(!1),this.localUser={userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,hasScreenStream:!1,userRole:rt.kGeneralUser,onSeat:!1,cameraStreamInfo:{userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,streamType:lt.kCameraStream,isVisible:!0,userRole:rt.kGeneralUser},screenStreamInfo:{userId:"",userName:"",avatarUrl:"",hasScreenStream:!1,streamType:lt.kScreenStream,isVisible:!0,userRole:rt.kGeneralUser}},this.remoteUserObj={},this.userVolumeObj={},this.isDefaultOpenCamera=!1,this.isDefaultOpenMicrophone=!1,this.canControlSelfAudio=!0,this.canControlSelfVideo=!0,this.localVideoQuality=ct.kVideoQuality_720p,this.currentCameraId="",this.currentMicrophoneId="",this.currentSpeakerId="",this.cameraList=[],this.microphoneList=[],this.speakerList=[],this.masterUserId="",this.isMicrophoneDisableForAllUser=!1,this.isCameraDisableForAllUser=!1,this.isMessageDisableForAllUser=!1,this.isSeatEnabled=!1,this.seatMode=ht.kFreeToTake,this.hasVideoStreamObject={},this.hasOtherScreenShare=!1,this.isOnStateTabActive=!0}}});const no=Q(e.defineComponent({__name:"index",props:{userId:{},userName:{},avatarUrl:{}},emits:["log-out"],setup(t){const{userInfoRef:n,showUserControl:o,t:i,handleUserControl:s}=function(){const{t:t}=ae(),n=ot(),{userName:o}=ke(n),i=e.ref(),s=e.ref(!1),a=e.ref(!1),r=e.ref(""),c=to();function u(e){i.value.contains(e.target)||(s.value=!1)}function l(){a.value=!1}return e.onMounted((()=>{null==window||window.addEventListener("click",u)})),e.onUnmounted((()=>{null==window||window.removeEventListener("click",u)})),{t:t,showUserControl:s,showUserNameEdit:a,userInfoRef:i,tempUserName:r,handleUserControl:function(){s.value=!s.value},showEditUserNameDialog:function(){a.value=!0,r.value=o.value},closeEditUserNameDialog:l,handleSaveUserName:async function(e){0!==e.length?(n.setUserName(e),Jn.setSelfInfo({userName:e,avatarUrl:c.localUser.avatarUrl||""}),c.setLocalUser({userName:e}),l()):it({type:"warning",message:t("Username length should be greater than 0"),duration:Ut.NORMAL})}}}();return(t,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"userInfoRef",ref:n,class:"user-info-container"},[e.createElementVNode("div",{onClick:a[0]||(a[0]=(...t)=>e.unref(s)&&e.unref(s)(...t)),class:"user-info-content"},[e.createVNode(ee,{class:"avatar","img-src":t.avatarUrl},null,8,["img-src"]),e.createElementVNode("div",{class:"name"},e.toDisplayString(t.userName||t.userId),1)]),e.unref(o)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"user-control-container"},[e.createElementVNode("div",{class:"logout-mobile"},[e.createElementVNode("div",{class:"logout-mobile-main"},[e.createElementVNode("div",{class:"logout",onClick:a[1]||(a[1]=()=>t.$emit("log-out"))},[e.createElementVNode("i",null,e.toDisplayString(e.unref(i)("Log out")),1)]),e.createElementVNode("div",{class:"close",onClick:a[2]||(a[2]=e.withModifiers((e=>o.value=!1),["stop"]))},[e.createElementVNode("i",null,e.toDisplayString(e.unref(i)("Cancel")),1)])])])])):e.createCommentVNode("",!0)],512))}}),[["__scopeId","data-v-82254c60"]]),oo=e.defineComponent({__name:"SvgIconFile",props:{size:{},responseSize:{},customClass:{},icon:{}},emits:["click"],setup(t,{emit:n}){const o=ot(),{defaultTheme:i}=ke(o),s=t,a=n,r=e.getCurrentInstance(),c=e.ref(),u=e.ref(),l=e.ref({width:"48rpx",height:"48rpx"}),d=plus.io.convertLocalFileSystemURL(s.icon),p=/.{3}$/;function h(e){a("click",e)}return plus.io.resolveLocalFileSystemURL(d,(e=>{e.file((e=>{const t=new plus.io.FileReader;t.onloadend=function(e){const t=e.target.result;let n,o;/width="([0-9]+)"/.test(t)&&([,n]=t.match(/width="([0-9]+)"/)),/height="([0-9]+)"/.test(t)&&([,o]=t.match(/height="([0-9]+)"/)),n&&o&&!s.size&&(l.value.width=ne(n),l.value.height=ne(o)),"svg"===d.match(p)[0]?u.value=`data:image/svg+xml,${encodeURIComponent(t)}`:u.value=s.icon},t.readAsText(e)}))})),e.watch((()=>s.size),(e=>{e&&(l.value.width=ne(e),l.value.height=ne(e))})),e.onMounted((()=>{e.watch(i,(async()=>{await e.nextTick();uni.createSelectorQuery().in(r).select(".svg-icon").fields({computedStyle:["color"]}).exec((e=>{e[0]&&e[0].color&&(c.value=e[0].color)}))}),{immediate:!0})})),(t,n)=>(e.openBlock(),e.createElementBlock("image",{src:u.value,style:e.normalizeStyle(l.value),onClick:h},null,12,["src"]))}}),io=Q(oo,[["__scopeId","data-v-fd2d5c27"]]);const so=Q(e.defineComponent({__name:"Logo",setup(t){const n=ot(),{defaultTheme:o}=ke(n),i=e.computed((()=>!Ze&&"en-US"===se.global.locale.value)),s=e.computed((()=>Ze||"zh-CN"===se.global.locale.value)),a=e.computed((()=>"black"===o.value)),r=e.computed((()=>"white"===o.value));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"logo-container"},[!e.unref(et)&&s.value&&a.value?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/LogoOfPCInChineseBlackIcon.ff970d5c.svg")},null,8,["icon"])])):e.createCommentVNode("",!0),!e.unref(et)&&s.value&&r.value?(e.openBlock(),e.createElementBlock("div",{key:1},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/LogoOfPCInChineseWhiteIcon.f718dead.svg")},null,8,["icon"])])):e.createCommentVNode("",!0),e.unref(et)&&s.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:"mobile-zh-logo"},[e.createElementVNode("span",{class:e.normalizeClass(["logo",r.value?"white":"black"])},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/LogoOfMobileInChinese.3346c097.svg")},null,8,["icon"])],2),e.createElementVNode("span",{class:"title"},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/LogoTitleOfMobileInChinese.d61682c8.svg")},null,8,["icon"])])])):e.createCommentVNode("",!0),i.value?(e.openBlock(),e.createElementBlock("div",{key:3,class:e.normalizeClass(["pc-en-logo",{mobile:e.unref(et)}])},[e.createElementVNode("span",{class:"logo"},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/LogoInEnglish.19b24ef8.svg")},null,8,["icon"])]),e.createElementVNode("span",{class:e.normalizeClass(["title",r.value?"white":"black"])},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/LogoTitleInEnglish.5eb4fb6a.svg")},null,8,["icon"])],2)],2)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-c10fec84"]]),ao=Q(e.defineComponent({__name:"index",props:{userName:{},givenRoomId:{}},emits:["create-room","enter-room","update-user-name"],setup(t,{expose:n,emit:o}){const{t:i}=function(){const t=e.computed((()=>"en-US"===se.global.locale.value)),{t:n}=ae();return{isEN:t,t:n}}(),s=e.ref(),a=to(),r=e.ref(!1),c=e.ref(!1),u=e.ref(!1),l=e.computed((()=>"FreeToSpeak"===h.value?i("Free Speech Room"):i("On-stage Speaking Room"))),d=e.ref(!0),p=e.ref(!0),h=e.ref("FreeToSpeak"),g=e.ref(""),_={isOpenCamera:!0,isOpenMicrophone:!0,defaultCameraId:"",defaultMicrophoneId:"",defaultSpeakerId:""},f=o,m=t;n({getRoomParam:D});const v=e.computed((()=>"string"==typeof m.givenRoomId&&""!==m.givenRoomId));function y(){r.value=!r.value,u.value=!1}function I(){r.value=!r.value,u.value=!0}function M(){c.value=!c.value}function C(e){h.value=e}function T(){c.value=!c.value}function E(){r.value=!1,c.value=!1}function S(e){switch(e){case"isMicOn":d.value=!d.value,_.isOpenMicrophone=d.value;break;case"isCamerOn":p.value=!p.value,_.isOpenCamera=p.value}}function D(){return _.defaultCameraId=a.currentCameraId,_.defaultMicrophoneId=a.currentMicrophoneId,_.defaultSpeakerId=a.currentSpeakerId,_}function k(e){c.value&&!s.value.contains(e.target)&&(c.value=!1)}function R(e){const t=D();switch(e){case"Join":if(!g.value)return void it({type:"error",message:i("Please enter the room number")});f("enter-room",{roomId:String(g.value),roomParam:t});break;case"New":f("create-room",{roomMode:h.value,roomParam:t,isSeatEnabled:Boolean("SpeakAfterTakingSeat"===h.value)})}}return e.watch((()=>m.givenRoomId),(e=>{e&&(g.value=e)}),{immediate:!0}),e.onMounted((()=>{null==document||document.addEventListener("click",k,!0)})),e.onUnmounted((()=>{null==document||document.removeEventListener("click",k,!0)})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"control-container"},[r.value?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:"container-header"},[e.createVNode(so,{class:"container-icon"}),e.createElementVNode("div",{class:"container-bottom"},[e.createElementVNode("div",{class:"join-room",onClick:I},[e.createVNode(io,{style:{display:"flex"},class:"enter-icon",icon:e.unref("/assets/EnterRoomIcon.7cb1c7ca.svg")},null,8,["icon"]),e.createElementVNode("span",{class:"title"},e.toDisplayString(e.unref(i)("Join Room")),1)]),e.createElementVNode("div",{class:"create-room",onClick:y},[e.createVNode(io,{style:{display:"flex"},class:"add-icon",icon:e.unref("/assets/CreateRoomIcon.9f206ef8.svg")},null,8,["icon"]),e.createElementVNode("span",{class:"title"},e.toDisplayString(e.unref(i)("New Room")),1)])])])),r.value||v.value?(e.openBlock(),e.createElementBlock("div",{key:1,class:"room-detail"},[e.createElementVNode("div",{class:"room-detail-header"},[e.createElementVNode("div",{class:"close-icon",onClick:E},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/ArrowStrokeBackIcon.4a1ceb10.svg")},null,8,["icon"])]),u.value||v.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"room-detail-header-title"},e.toDisplayString(e.unref(i)("Join Room")),1)):(e.openBlock(),e.createElementBlock("span",{key:1,class:"room-detail-header-title"},e.toDisplayString(e.unref(i)("New Room")),1))]),e.createElementVNode("div",{class:"room-detail-middle"},[e.createElementVNode("div",{class:"room-detail-info"},[u.value||v.value?(e.openBlock(),e.createElementBlock("div",{key:0,class:"room-detail-info-box"},[e.createElementVNode("span",{class:"room-detail-title"},e.toDisplayString(e.unref(i)("Room ID")),1),e.withDirectives(e.createElementVNode("input",{"onUpdate:modelValue":n[0]||(n[0]=e=>g.value=e),class:"roomid-input",type:"number",placeholder:e.unref(i)("Enter room ID"),maxlength:"10",enterkeyhint:"complete"},null,8,["placeholder"]),[[e.vModelText,g.value]])])):(e.openBlock(),e.createElementBlock("div",{key:1,class:"room-detail-info-box",onClick:M},[e.createElementVNode("span",{class:"room-detail-title"},e.toDisplayString(e.unref(i)("Room Type")),1),e.createElementVNode("div",{class:"room-show-title"},[e.createElementVNode("span",{class:"room-show-title"},e.toDisplayString(l.value),1)]),e.createElementVNode("div",{class:"chevron-down-icon"},[e.createVNode(io,{style:{display:"flex"},icon:e.unref("/assets/ArrowStrokeSelectDownIcon.e0254bfd.svg")},null,8,["icon"])])])),e.createElementVNode("div",{class:"room-detail-info-box"},[e.createElementVNode("span",{class:"room-detail-title"},e.toDisplayString(e.unref(i)("Your Name")),1),e.createElementVNode("span",{class:"roomid-input"},e.toDisplayString(t.userName),1)])]),e.createElementVNode("div",{class:"room-detail-setting"},[e.createElementVNode("div",{class:"room-detail-setting-list"},[e.createTextVNode(e.toDisplayString(e.unref(i)("Turn on the microphone"))+" ",1),e.createElementVNode("div",{class:e.normalizeClass(["slider-box",[d.value&&"slider-open"]]),onClick:n[1]||(n[1]=()=>S("isMicOn"))},[e.createElementVNode("span",{class:"slider-block"})],2)]),e.createElementVNode("div",{class:"room-detail-setting-list"},[e.createTextVNode(e.toDisplayString(e.unref(i)("Turn on the video"))+" ",1),e.createElementVNode("div",{class:e.normalizeClass(["slider-box",[p.value&&"slider-open"]]),onClick:n[2]||(n[2]=()=>S("isCamerOn"))},[e.createElementVNode("span",{class:"slider-block"})],2)])])]),e.createElementVNode("div",{class:"room-detail-bottom"},[u.value||v.value?(e.openBlock(),e.createElementBlock("span",{key:0,class:"button",onClick:n[3]||(n[3]=()=>R("Join"))},e.toDisplayString(e.unref(i)("Join Room")),1)):(e.openBlock(),e.createElementBlock("span",{key:1,class:"button",onClick:n[4]||(n[4]=()=>R("New"))},e.toDisplayString(e.unref(i)("New Room")),1))])])):e.createCommentVNode("",!0),c.value?(e.openBlock(),e.createElementBlock("div",{key:2,class:"room-choose-mobile"},[e.createElementVNode("div",{ref_key:"moreTypeRef",ref:s,class:e.normalizeClass([c.value?"room-type-container":"close-room-type-container"])},[e.createElementVNode("div",{class:"room-choose-button"},[e.createElementVNode("span",{class:"choose-cancel",onClick:n[5]||(n[5]=e=>c.value=!1)},e.toDisplayString(e.unref(i)("Cancel")),1),e.createElementVNode("span",{class:"choose-confirm",onClick:T},e.toDisplayString(e.unref(i)("Sure")),1)]),e.createElementVNode("div",{class:"room-type-hidden"},[e.createElementVNode("span",{class:e.normalizeClass([["FreeToSpeak"===h.value&&"room-current-title"],"room-choose-title"]),onClick:n[6]||(n[6]=()=>C("FreeToSpeak"))},e.toDisplayString(e.unref(i)("Free Speech Room")),3),e.createElementVNode("span",{class:e.normalizeClass([["SpeakAfterTakingSeat"===h.value&&"room-current-title"],"room-choose-title"]),onClick:n[7]||(n[7]=()=>C("SpeakAfterTakingSeat"))},e.toDisplayString(e.unref(i)("On-stage Speaking Room")),3)])],2)])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-252453e5"]]),ro={id:"4545427",name:"TUIRoomKit",font_family:"roomkiticons",css_prefix_text:"roomkit-icon-",description:"",glyphs:[{icon_id:"42361561",name:"EmojiIcon",font_class:"a-EmojiIcon111",unicode:"e60e",unicode_decimal:58894},{icon_id:"41176603",name:"StopScreenShareIcon",font_class:"jieshugongxiang",unicode:"e60a",unicode_decimal:58890},{icon_id:"40923006",name:"ScreenShareIcon",font_class:"ScreenShareIcon",unicode:"e601",unicode_decimal:58881},{icon_id:"40923008",name:"ScreenSharingIcon",font_class:"ScreenSharingIcon",unicode:"e603",unicode_decimal:58883},{icon_id:"40437582",name:"ApplyActiveIcon",font_class:"ApplyActiveIcon",unicode:"e67d",unicode_decimal:59005},{icon_id:"40437367",name:"ApplyTipsIcon",font_class:"ApplyTipsIcon",unicode:"e676",unicode_decimal:58998},{icon_id:"40437368",name:"DenyOnStageIcon",font_class:"DenyOnStageIcon1",unicode:"e677",unicode_decimal:58999},{icon_id:"40437369",name:"KickOutIcon",font_class:"KickOutIcon",unicode:"e679",unicode_decimal:59001},{icon_id:"40437370",name:"InviteOnStageIcon",font_class:"InviteOnStageIcon1",unicode:"e67a",unicode_decimal:59002},{icon_id:"40437371",name:"SearchIcon",font_class:"SearchIcon1",unicode:"e67b",unicode_decimal:59003},{icon_id:"40437372",name:"OffStageIcon",font_class:"OffStageIcon1",unicode:"e67c",unicode_decimal:59004},{icon_id:"40400095",name:"ScreenOpenIcon",font_class:"ScreenOpenIcon",unicode:"e669",unicode_decimal:58985},{icon_id:"40400018",name:"ChatIcon",font_class:"ChatIcon",unicode:"e678",unicode_decimal:59e3},{icon_id:"40399599",name:"CancelStageIcon",font_class:"CancelStageIcon1",unicode:"e675",unicode_decimal:58997},{icon_id:"40399573",name:"ApplyStageIcon",font_class:"ApplyStageIcon2",unicode:"e674",unicode_decimal:58996},{icon_id:"40398369",name:"TransferOwnerIcon",font_class:"TransferOwnerIcon",unicode:"e673",unicode_decimal:58995},{icon_id:"40397092",name:"SetAdminIcon",font_class:"SetAdminIcon",unicode:"e672",unicode_decimal:58994},{icon_id:"40373104",name:"CorrectIcon",font_class:"CorrectIcon",unicode:"e667",unicode_decimal:58983},{icon_id:"40373103",name:"CloseIcon",font_class:"CloseIcon",unicode:"e649",unicode_decimal:58953},{icon_id:"40373102",name:"CopyIcon",font_class:"CopyIcon",unicode:"e668",unicode_decimal:58984},{icon_id:"40373101",name:"ChatForbiddenIcon",font_class:"ChatForbiddenIcon",unicode:"e648",unicode_decimal:58952},{icon_id:"40373099",name:"CameraSwitchIcon",font_class:"CameraSwitchIcon",unicode:"e647",unicode_decimal:58951},{icon_id:"40373098",name:"CameraOnIcon",font_class:"CameraOnIcon1",unicode:"e646",unicode_decimal:58950},{icon_id:"40373097",name:"CameraOffIcon",font_class:"CameraOffIcon",unicode:"e66a",unicode_decimal:58986},{icon_id:"40373096",name:"AudioOpenIcon",font_class:"AudioOpenIcon",unicode:"e66b",unicode_decimal:58987},{icon_id:"40373095",name:"AudioCloseIcon",font_class:"AudioCloseIcon",unicode:"e645",unicode_decimal:58949},{icon_id:"40373094",name:"ArrowStrokeSelectDownIcon",font_class:"ArrowStrokeSelectDownIcon",unicode:"e644",unicode_decimal:58948},{icon_id:"40373092",name:"ArrowStrokeTurnPageIcon",font_class:"ArrowStrokeTurnPageIcon",unicode:"e66c",unicode_decimal:58988},{icon_id:"40373093",name:"ArrowUpIcon",font_class:"ArrowUpIcon",unicode:"e66d",unicode_decimal:58989},{icon_id:"40373091",name:"ArrowStrokeBackIcon",font_class:"ArrowStrokeBackIcon",unicode:"e643",unicode_decimal:58947},{icon_id:"40373090",name:"ArrowStrokeLeftIcon",font_class:"ArrowStrokeLeftIcon",unicode:"e66e",unicode_decimal:58990},{icon_id:"40373087",name:"ApplyManageIcon",font_class:"ApplyManageIcon",unicode:"e66f",unicode_decimal:58991},{icon_id:"40373086",name:"ApplyLittleIcon",font_class:"ApplyLittleIcon",unicode:"e670",unicode_decimal:58992},{icon_id:"40373126",name:"OnStageIcon",font_class:"OnStageIcon",unicode:"e65c",unicode_decimal:58972},{icon_id:"40373125",name:"OffStageIcon",font_class:"OffStageIcon",unicode:"e653",unicode_decimal:58963},{icon_id:"40373124",name:"NextIcon",font_class:"NextIcon",unicode:"e65d",unicode_decimal:58973},{icon_id:"40373123",name:"MoreIcon",font_class:"MoreIcon",unicode:"e652",unicode_decimal:58962},{icon_id:"40373122",name:"MicOffIcon",font_class:"MicOffIcon",unicode:"e65e",unicode_decimal:58974},{icon_id:"40373120",name:"MirrorIcon",font_class:"MirrorIcon",unicode:"e65f",unicode_decimal:58975},{icon_id:"40373121",name:"MicDisabledIcon",font_class:"MicDisabledIcon",unicode:"e660",unicode_decimal:58976},{icon_id:"40373119",name:"MicOnIcon",font_class:"MicOnIcon",unicode:"e661",unicode_decimal:58977},{icon_id:"40373118",name:"ManageMemberIcon",font_class:"ManageMemberIcon1",unicode:"e651",unicode_decimal:58961},{icon_id:"40373117",name:"MailIcon",font_class:"MailIcon",unicode:"e650",unicode_decimal:58960},{icon_id:"40373116",name:"LogoTitleInEnglish",font_class:"LogoTitleInEnglish",unicode:"e64f",unicode_decimal:58959},{icon_id:"40373114",name:"LoginAvatar",font_class:"LoginAvatar",unicode:"e64e",unicode_decimal:58958},{icon_id:"40373113",name:"InviteSolidIcon",font_class:"InviteSolidIcon",unicode:"e64d",unicode_decimal:58957},{icon_id:"40373112",name:"InviteOnStageIcon",font_class:"InviteOnStageIcon",unicode:"e64c",unicode_decimal:58956},{icon_id:"40373111",name:"InviteIcon",font_class:"InviteIcon",unicode:"e662",unicode_decimal:58978},{icon_id:"40373109",name:"EmojiIcon",font_class:"EmojiIcon",unicode:"e64b",unicode_decimal:58955},{icon_id:"40373110",name:"EnterRoomIcon",font_class:"EnterRoomIcon",unicode:"e663",unicode_decimal:58979},{icon_id:"40373107",name:"ExtensionIcon",font_class:"ExtensionIcon",unicode:"e664",unicode_decimal:58980},{icon_id:"40373108",name:"EndRoomIcon",font_class:"EndRoomIcon1",unicode:"e665",unicode_decimal:58981},{icon_id:"40373106",name:"DenyOnStageIcon",font_class:"DenyOnStageIcon",unicode:"e64a",unicode_decimal:58954},{icon_id:"40373105",name:"CreateRoomIcon",font_class:"CreateRoomIcon",unicode:"e666",unicode_decimal:58982},{icon_id:"40373134",name:"VideoOpenIcon",font_class:"VideoOpenIcon",unicode:"e659",unicode_decimal:58969},{icon_id:"40373133",name:"VideoCloseIcon",font_class:"VideoCloseIcon",unicode:"e658",unicode_decimal:58968},{icon_id:"40373132",name:"UserIcon",font_class:"UserIcon",unicode:"e65a",unicode_decimal:58970},{icon_id:"40373131",name:"StepDownIcon",font_class:"StepDownIcon",unicode:"e657",unicode_decimal:58967},{icon_id:"40373130",name:"StageApplicationIcon",font_class:"StageApplicationIcon",unicode:"e65b",unicode_decimal:58971},{icon_id:"40373129",name:"ellipsisIcon",font_class:"ellipsisIcon",unicode:"e656",unicode_decimal:58966},{icon_id:"40373128",name:"RevokeAdminIcon",font_class:"RevokeAdminIcon",unicode:"e655",unicode_decimal:58965},{icon_id:"40373127",name:"PhoneIcon",font_class:"PhoneIcon",unicode:"e654",unicode_decimal:58964},{icon_id:"40373007",name:"ManageMemberIcon",font_class:"ManageMemberIcon",unicode:"e63e",unicode_decimal:58942},{icon_id:"40373005",name:"CameraOnIcon",font_class:"CameraOnIcon",unicode:"e63f",unicode_decimal:58943},{icon_id:"40373004",name:"EndRoomIcon",font_class:"EndRoomIcon",unicode:"e640",unicode_decimal:58944}]};weex.requireModule("dom").addRule("fontFace",{fontFamily:"uniicons",src:"url('/assets/iconfont.24555bcb.ttf')"});const co=Q({name:"SvgIconBack",props:{icon:{type:String,default:""},size:{type:[String,Number],default:""},color:{type:String,default:""},customStyle:{type:Object,default:{}}},data:()=>({icons:ro}),computed:{unicode(){var e,t;let n=null==(t=null==(e=this.icons)?void 0:e.glyphs)?void 0:t.find((e=>e.name===this.icon));return n?String.fromCharCode(n.unicode_decimal):""},styleObj(){const e={};return this.size&&(e.fontSize=`${Number(this.size)}px`,e.lineHeight=`${Number(this.size)}px`),this.color&&(e.color=this.color),e}}},[["render",function(t,n,o,i,s,a){return e.openBlock(),e.createElementBlock("text",{style:e.normalizeStyle(a.styleObj),class:"uni-icons"},e.toDisplayString(a.unicode),5)}],["__scopeId","data-v-5935c137"]]),uo=e.defineComponent({__name:"SvgIcon",props:{size:{},responseSize:{},customClass:{},customStyle:{},icon:{},color:{}},setup(t){const n=t,o=e.computed((()=>n.icon&&".svg"===n.icon.slice(-4)));return(t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[o.value?(e.openBlock(),e.createBlock(io,{key:0,icon:t.icon,size:t.size,customClass:t.customClass},null,8,["icon","size","customClass"])):e.createCommentVNode("",!0),o.value?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(co,{key:1,icon:t.icon,size:t.size,customStyle:t.customStyle,color:t.color},null,8,["icon","size","customStyle","color"]))],64))}});var lo=(e=>(e.VERTICAl="vertical",e.HORIZONTAL="horizontal",e))(lo||{});Tn.TRTCVideoResolution_640_360;const po=Q(e.defineComponent({__name:"IconButton",props:{title:{default:""},hasMore:{type:Boolean,default:!1},hideHoverEffect:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},layout:{default:lo.VERTICAl},icon:{default:null},isNotSupport:{type:Boolean,default:!1}},emits:["click-icon","click-more"],setup(t,{emit:n}){const o=t,i=n,s=e.computed((()=>o.layout===lo.HORIZONTAL?"icon-content-horizontal":"icon-content-vertical")),a=()=>{i("click-icon")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"icon-button-container"},[e.unref(et)?(e.openBlock(),e.createElementBlock("div",{key:0,onClick:a,class:e.normalizeClass(["icon-content",s.value,`${t.disabled&&"disabled"}`])},[e.renderSlot(t.$slots,"default",{},void 0,!0),t.icon?(e.openBlock(),e.createBlock(uo,{key:0,style:{display:"flex"},size:"24",icon:t.icon},null,8,["icon"])):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"title"},e.toDisplayString(t.title),1)],2)):(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["icon-content",s.value,`${t.disabled&&"disabled"}`]),onClick:a},[e.renderSlot(t.$slots,"default",{},void 0,!0),t.icon?(e.openBlock(),e.createBlock(uo,{key:0,style:{display:"flex"},size:"24",icon:t.icon},null,8,["icon"])):e.createCommentVNode("",!0),t.isNotSupport?(e.openBlock(),e.createBlock(uo,{key:1,style:{display:"flex"},class:"unsupport-icon",icon:e.unref("/assets/UnSupportIcon.eb1c5edd.png")},null,8,["icon"])):e.createCommentVNode("",!0),e.createElementVNode("text",{class:"title"},[e.createTextVNode(e.toDisplayString(t.title)+" ",1),e.renderSlot(t.$slots,"title",{},void 0,!0)])],2)),t.hasMore?(e.openBlock(),e.createElementBlock("div",{key:2,ref:"moreSpanRef",class:"icon-arrow",onClick:n[0]||(n[0]=e=>t.$emit("click-more"))},[e.createVNode(uo,{style:{display:"flex"},icon:e.unref("/assets/ArrowUpIcon.f4c7f21f.png")},null,8,["icon"])],512)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-5c17d776"]]);var ho=(e=>(e.SERVICE_READY="ServiceReady",e.ROOM_LOGIN="RoomLogin",e.ROOM_CONTAINER_RESIZE="RoomContainerResize",e.ROOM_NOTICE_MESSAGE="RoomNoticeMessage",e.ROOM_NOTICE_MESSAGE_BOX="RoomNoticeMessageBox",e.ROOM_START="RoomStart",e.ROOM_JOIN="RoomJoin",e.ROOM_LEAVE="RoomLeave",e.ROOM_DISMISS="RoomDestroy",e.ROOM_ERROR="RoomError",e.KICKED_OUT="KickedOut",e.KICKED_OFFLINE="KickedOffline",e.USER_SIG_EXPIRED="UserSigExpired",e.USER_LOGOUT="UserLogout",e))(ho||{});const go=Te("chat",{state:()=>({messageList:[],isMessageDisableByAdmin:!1,unReadCount:0,isCompleted:!1,nextReqMessageId:"",route:""}),getters:{},actions:{updateMessageList(e){-1===this.messageList.map((e=>e.ID)).indexOf(e.ID)&&(this.messageList=this.messageList.concat([e]))},setMessageListInfo(e,t,n){this.messageList=e,this.isCompleted=t,this.nextReqMessageId=n},updateUnReadCount(e){this.unReadCount=e},addHistoryMessages(e){const t=this.messageList.map((e=>e.ID)),n=e.filter((e=>-1===t.indexOf(e.ID)));this.messageList=n.concat(this.messageList).sort(((e,t)=>e.sequence-t.sequence))},setSendMessageDisableChanged(e){this.isMessageDisableByAdmin=e},setCurrentsPage(e){this.route=e},reset(){this.messageList=[],this.unReadCount=0,this.isMessageDisableByAdmin=!1,this.route=""}}});var _o=(e=>(e.ON_CHANGE_LOG_LEVEL="onChangeLogLevel",e))(_o||{});const fo=-1,mo=0,vo=1,yo=2,Io=3,Mo=4;var Co=(e=>(e.MAIN="main-process",e.RENDER="render-process",e))(Co||{});function To(e){const t=new Date;return`${t.toLocaleTimeString("en-US",{hour12:!1})}.${function(e){let t;switch(e.toString().length){case 1:t=`00${e}`;break;case 2:t=`0${e}`;break;default:t=e}return t}(t.getMilliseconds())} [${e}]:`}let Eo=fo;const So={debug(...e){Eo<=fo&&_("debug","at src/roomkit/TUIRoom/utils/common/logger/index.ts:14",`${To(Co.RENDER)}`,...e)},log(...e){Eo<=mo&&_("log","at src/roomkit/TUIRoom/utils/common/logger/index.ts:19",`${To(Co.RENDER)}`,...e)},info(...e){Eo<=vo&&_("info","at src/roomkit/TUIRoom/utils/common/logger/index.ts:24",`${To(Co.RENDER)}`,...e)},warn(...e){Eo<=yo&&_("warn","at src/roomkit/TUIRoom/utils/common/logger/index.ts:29",`${To(Co.RENDER)}`,...e)},error(...e){Eo<=Io&&_("error","at src/roomkit/TUIRoom/utils/common/logger/index.ts:34",`${To(Co.RENDER)}`,...e)},setLevel(e){var t;e>=fo&&e<=Mo?(_("log","at src/roomkit/TUIRoom/utils/common/logger/index.ts:42",`${To(Co.RENDER)} set log level from ${Eo} to ${e}`),Eo=e,(null==(t=window.electron)?void 0:t.ipcRenderer)&&window.electron.ipcRenderer.send(_o.ON_CHANGE_LOG_LEVEL,e)):_("error","at src/roomkit/TUIRoom/utils/common/logger/index.ts:57",`${To(Co.RENDER)} logger.setLevel() invalid params:${e}`)},getLevel:()=>Eo};function Do(e){const{confirmButtonText:t="确定",cancelButtonText:n="取消",callback:o}=e||{};uni.showModal({title:null==e?void 0:e.title,content:null==e?void 0:e.message,showCancel:null==e?void 0:e.showCancel,confirmText:t,cancelText:n,success:o,fail:()=>{throw Error("user cancel")}})}const ko=Qn(),Ro={instance:null};Jn.once("ready",(()=>{var e;Ro.instance=null==(e=ko.instance)?void 0:e.getMediaDeviceManager()}));const Lo="[RoomService:roomActionManager]",Ao=new Bn;Ao.videoResolution=Tn.TRTCVideoResolution_640_360,Ao.videoFps=10,Ao.videoBitrate=550;class Oo{constructor(e){this.service=e}async start(e,t={}){const{roomName:n,isSeatEnabled:o=!1,isOpenCamera:i=!1,isOpenMicrophone:s=!1,defaultCameraId:a,defaultMicrophoneId:r,defaultSpeakerId:c}=t,u=o?"SpeakAfterTakingSeat":"FreeToSpeak";await this.createRoom({roomId:e,roomName:n,roomMode:u,roomParam:{isOpenCamera:i,isOpenMicrophone:s,defaultCameraId:a,defaultMicrophoneId:r,defaultSpeakerId:c}}),await this.enterRoom({roomId:e,roomParam:{isOpenCamera:i,isOpenMicrophone:s,defaultCameraId:a,defaultMicrophoneId:r,defaultSpeakerId:c}}),this.service.emit(ho.ROOM_START)}async join(e,t={}){const{isOpenCamera:n=!1,isOpenMicrophone:o=!1,defaultCameraId:i,defaultMicrophoneId:s,defaultSpeakerId:a}=t;await this.enterRoom({roomId:e,roomParam:{isOpenCamera:n,isOpenMicrophone:o,defaultCameraId:i,defaultMicrophoneId:s,defaultSpeakerId:a}}),this.service.emit(ho.ROOM_JOIN)}async leaveRoom(){var e;try{this.closeMediaBeforeLeave();const t=await(null==(e=this.service.roomEngine.instance)?void 0:e.exitRoom());this.service.resetStore(),So.log(`${Lo}leaveRoom:`,t),this.service.emit(ho.ROOM_LEAVE,t)}catch(t){So.error(`${Lo}leaveRoom error:`,t)}}async dismissRoom(){var e;try{So.log(`${Lo}dismissRoom: enter`),this.closeMediaBeforeLeave(),await(null==(e=this.service.roomEngine.instance)?void 0:e.destroyRoom()),this.service.resetStore(),this.service.emit(ho.ROOM_DISMISS,{})}catch(t){So.error(`${Lo}dismissRoom error:`,t)}}async createRoom(e){try{const{roomId:t,roomName:n,roomMode:o}=e,i={roomId:t,roomName:n,roomType:pt.kConference,isSeatEnabled:"FreeToSpeak"!==o,seatMode:"SpeakAfterTakingSeat"===o?ht.kApplyToTake:void 0};await this.handleRoomCreation(i,e)}catch(t){throw So.error(`${Lo}createRoom error:`,t),this.service.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{title:this.service.t("Note"),message:this.service.t("Failed to initiate meeting"),confirmButtonText:this.service.t("Sure"),callback:async()=>{this.service.emit(ho.ROOM_ERROR,t),this.service.resetStore()}}),t}}async handleRoomCreation(e,t){var n;const{roomEngine:o}=this.service;o.instance&&(this.service.basicStore.setRoomId(e.roomId),So.debug(`${Lo}createRoom:`,e,t),await(null==(n=o.instance)?void 0:n.createRoom(e)))}async enterRoom(e){var t;try{const{roomId:n,roomParam:o}=e,i={roomId:n,roomType:pt.kConference},s=await this.doEnterRoom(i);this.service.roomStore.setRoomInfo(s),await this.getUserList(),await this.syncUserInfo(this.service.basicStore.userId),s.isSeatEnabled&&(await this.getSeatList(),this.service.roomStore.isMaster&&await(null==(t=this.service.roomEngine.instance)?void 0:t.takeSeat({seatIndex:-1,timeout:0}))),this.service.roomStore.setRoomParam(o)}catch(n){throw So.error(`${Lo}enterRoom error:`,n),this.service.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{title:this.service.t("Note"),message:this.service.t("Failed to enter the meeting"),confirmButtonText:this.service.t("Sure"),callback:async()=>{this.service.emit(ho.ROOM_ERROR,n),this.service.roomStore.reset()}}),n}}async doEnterRoom(e){var t,n,o,i,s;const{roomEngine:a}=this.service,{roomId:r,roomType:c}=e;if(this.service.basicStore.setRoomId(r),!Qe){const e=et&&!Ze,n=null==(t=a.instance)?void 0:t.getTRTCCloud();null==n||n.setDefaultStreamRecvMode(!0,!1),null==n||n.enableSmallVideoStream(!e,Ao)}await(null==(n=a.instance)?void 0:n.enterRoom({roomId:r,roomType:c}));const u=await(null==(o=a.instance)?void 0:o.fetchRoomInfo());return null==(i=a.instance)||i.muteLocalAudio(),u.isSeatEnabled||(null==(s=a.instance)||s.openLocalMicrophone(),this.service.basicStore.setIsOpenMic(!0)),u}async getUserList(){var e;const{roomEngine:t}=this.service;let n="";try{do{const o=await(null==(e=t.instance)?void 0:e.getUserList({nextSequence:n}));this.service.roomStore.updateUserList(o.userInfoList),n=o.nextSequence}while("0"!==n)}catch(o){So.error("TUIRoomEngine.getUserList",o.code,o.message)}}async syncUserInfo(e){var t;const{roomEngine:n}=this.service,o=await(null==(t=n.instance)?void 0:t.getUserInfo({userId:e})),{isMessageDisabled:i}=o;this.service.chatStore.setSendMessageDisableChanged(i)}async getSeatList(){var e;const{roomEngine:t}=this.service;try{const n=await(null==(e=t.instance)?void 0:e.getSeatList());this.service.roomStore.setSeatList(n)}catch(n){So.error("TUIRoomEngine.getSeatList",n.code,n.message)}}closeMediaBeforeLeave(){var e,t;const{roomEngine:n}=this.service;this.service.roomStore.localUser.hasAudioStream&&(null==(e=n.instance)||e.closeLocalMicrophone()),this.service.roomStore.localUser.hasVideoStream&&(null==(t=n.instance)||t.closeLocalCamera())}}class No{constructor(e){this.service=e}async setSelfInfo(e){const{avatarUrl:t,userName:n}=await Jn.getSelfInfo(),o={userName:e.userName||n,avatarUrl:e.avatarUrl||t};return this.service.basicStore.setBasicInfo(o),Jn.setSelfInfo(o)}async setCustomInfoForUser(e){const t=this.service.roomEngine.instance;return null==t?void 0:t.setCustomInfoForUser(e)}getDisplayName(e){const{userName:t,userId:n}=e;return t||n}}const{t:Po}=se.global,bo="[RoomService]",Uo=Qn(),Go=new Bn;Go.videoResolution=Tn.TRTCVideoResolution_640_360,Go.videoFps=10,Go.videoBitrate=550;class wo{constructor(){var e;this.emitter={all:e=e||new Map,on:function(t,n){var o=e.get(t);o?o.push(n):e.set(t,[n])},off:function(t,n){var o=e.get(t);o&&(n?o.splice(o.indexOf(n)>>>0,1):e.set(t,[]))},emit:function(t,n){var o=e.get(t);o&&o.slice().map((function(e){e(n)})),(o=e.get("*"))&&o.slice().map((function(e){e(t,n)}))}},this.roomActionManager=new Oo(this),this.userManager=new No(this),this.roomEngine=Uo,this.t=Po,this.initEventCtx(),Jn.once("ready",(()=>{null===Uo.instance&&(Uo.instance=new Jn),this.bindRoomEngineEvents(),this.handleRoomEngineReady()}))}get basicStore(){return ot()}get roomStore(){return to()}get chatStore(){return go()}initEventCtx(){this.onError=this.onError.bind(this),this.onRoomDismissed=this.onRoomDismissed.bind(this),this.onUserVoiceVolumeChanged=this.onUserVoiceVolumeChanged.bind(this),this.onUserNetworkQualityChanged=this.onUserNetworkQualityChanged.bind(this),this.onKickedOutOfRoom=this.onKickedOutOfRoom.bind(this),this.onSendMessageForUserDisableChanged=this.onSendMessageForUserDisableChanged.bind(this),this.onUserSigExpired=this.onUserSigExpired.bind(this),this.onKickedOffLine=this.onKickedOffLine.bind(this),this.onAllUserCameraDisableChanged=this.onAllUserCameraDisableChanged.bind(this),this.onAllUserMicrophoneDisableChanged=this.onAllUserMicrophoneDisableChanged.bind(this),this.onSendMessageForAllUserDisableChanged=this.onSendMessageForAllUserDisableChanged.bind(this),this.onReceiveMessage=this.onReceiveMessage.bind(this)}static getInstance(){return wo.instance||(wo.instance=new wo),wo.instance}static destroyInstance(){wo.instance&&(wo.instance.unBindRoomEngineEvents(),wo.instance=void 0)}useExtension(e){e._bind(this)}getComponentConfig(e){return e.map((e=>this.basicStore.componentConfig[e]||{}))}setComponentConfig(e){try{for(const t in e){const n=e[t];for(const e in n)this.basicStore.componentConfig[t][e]=n[e]}return!0}catch(t){return So.error(t),!1}}getRoomContainer(){return(null==document?void 0:document.fullscreenElement)||(null==document?void 0:document.getElementById("roomContainer"))||(null==document?void 0:document.body)}initMediaDeviceList(){!function(t){const n=to(),{t:o}=se.global;async function i(){var e,t,i,s,a,r;if(!Ro.instance)return;const c=await(null==(e=Ro.instance)?void 0:e.getDevicesList({type:Ct.kMediaDeviceTypeVideoCamera})),u=await(null==(t=Ro.instance)?void 0:t.getDevicesList({type:Ct.kMediaDeviceTypeAudioInput})),l=await(null==(i=Ro.instance)?void 0:i.getDevicesList({type:Ct.kMediaDeviceTypeAudioOutput}));if(!Ze){const e=c&&c.length>0,t=u&&u.length>0;let n="";e&&!t?n="Microphone not detected on current device":!e&&t?n="Camera not detected on current device":e||t||(n="Camera And Microphone not detected on current device"),n&&Do({title:o("Note"),message:o(n),appendToRoomContainer:!0,confirmButtonText:o("Sure")})}c&&n.setCameraList(c),u&&n.setMicrophoneList(u),l&&n.setSpeakerList(l);const d=null==(s=Ro.instance)?void 0:s.getCurrentDevice({type:Ct.kMediaDeviceTypeVideoCamera}),p=null==(a=Ro.instance)?void 0:a.getCurrentDevice({type:Ct.kMediaDeviceTypeAudioInput}),h=null==(r=Ro.instance)?void 0:r.getCurrentDevice({type:Ct.kMediaDeviceTypeAudioOutput});d&&d.deviceId&&n.setCurrentCameraId(d.deviceId),p&&p.deviceId&&n.setCurrentMicrophoneId(p.deviceId),h&&h.deviceId&&n.setCurrentSpeakerId(h.deviceId)}async function s(e){var t;if(!Ro.instance)return;const{deviceId:o,type:i,state:s}=e;So.log(`onDeviceChanged: deviceId: ${o}, type: ${["mic","speaker","camera"][i]}, state: ${["add","remove","active"][s]}`);const a=await(null==(t=Ro.instance)?void 0:t.getDevicesList({type:i}));a&&n.setDeviceList(i,a),s===Tt.kMediaDeviceStateActive&&n.setCurrentDeviceId(i,o)}Jn.once("ready",(()=>{var e;t&&t.listenForDeviceChange&&(i(),null==(e=Ro.instance)||e.on(Ot.onDeviceChanged,s))})),e.onUnmounted((()=>{var e;t&&t.listenForDeviceChange&&(null==(e=Ro.instance)||e.off(Ot.onDeviceChanged,s))}))}({listenForDeviceChange:!0})}bindChatEvents(){this.tim.on(E.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage)}bindRoomEngineEvents(){var e,t,n,o,i,s,a,r,c,u,l;null==(e=Uo.instance)||e.on(At.onError,this.onError),null==(t=Uo.instance)||t.on(At.onRoomDismissed,this.onRoomDismissed),null==(n=Uo.instance)||n.on(At.onUserVoiceVolumeChanged,this.onUserVoiceVolumeChanged),null==(o=Uo.instance)||o.on(At.onUserNetworkQualityChanged,this.onUserNetworkQualityChanged),null==(i=Uo.instance)||i.on(At.onKickedOutOfRoom,this.onKickedOutOfRoom),null==(s=Uo.instance)||s.on(At.onSendMessageForUserDisableChanged,this.onSendMessageForUserDisableChanged),null==(a=Uo.instance)||a.on(At.onUserSigExpired,this.onUserSigExpired),null==(r=Uo.instance)||r.on(At.onKickedOffLine,this.onKickedOffLine),null==(c=Uo.instance)||c.on(At.onAllUserCameraDisableChanged,this.onAllUserCameraDisableChanged),null==(u=Uo.instance)||u.on(At.onAllUserMicrophoneDisableChanged,this.onAllUserMicrophoneDisableChanged),null==(l=Uo.instance)||l.on(At.onSendMessageForAllUserDisableChanged,this.onSendMessageForAllUserDisableChanged)}unBindRoomEngineEvents(){var e,t,n,o,i,s,a,r,c,u;null==(e=Uo.instance)||e.off(At.onError,this.onError),null==(t=Uo.instance)||t.off(At.onUserVoiceVolumeChanged,this.onUserVoiceVolumeChanged),null==(n=Uo.instance)||n.off(At.onUserNetworkQualityChanged,this.onUserNetworkQualityChanged),null==(o=Uo.instance)||o.off(At.onKickedOutOfRoom,this.onKickedOutOfRoom),null==(i=Uo.instance)||i.off(At.onSendMessageForUserDisableChanged,this.onSendMessageForUserDisableChanged),null==(s=Uo.instance)||s.off(At.onUserSigExpired,this.onUserSigExpired),null==(a=Uo.instance)||a.off(At.onKickedOffLine,this.onKickedOffLine),null==(r=Uo.instance)||r.off(At.onAllUserCameraDisableChanged,this.onAllUserCameraDisableChanged),null==(c=Uo.instance)||c.off(At.onAllUserMicrophoneDisableChanged,this.onAllUserMicrophoneDisableChanged),null==(u=Uo.instance)||u.off(At.onSendMessageForAllUserDisableChanged,this.onSendMessageForAllUserDisableChanged),this.tim.off(E.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage)}onError(e){So.error("roomEngine.onError: ",e),"enter trtc room failed , error code : -1"===e.message&&this.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{type:"warning",message:Po("Failed to enter the meeting"),callback:()=>{this.resetStore()}})}onRoomDismissed(e){const{roomId:t}=e;So.log(`${bo}onRoomDismissed:`,t),this.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{title:Po("Note"),message:Po("The host closed the room."),confirmButtonText:Po("Sure"),callback:async()=>{this.emit(ho.ROOM_DISMISS,{}),this.resetStore()}})}onReceiveMessage(e){const t=[E.TYPES.MSG_TEXT,E.TYPES.MSG_IMAGE,E.TYPES.MSG_FILE,E.TYPES.MSG_FACE,E.TYPES.MSG_VIDEO];e&&e.data&&e.data.forEach((e=>{var n,o,i,s;const a=(null==(o=null==(n=getCurrentPages())?void 0:n.slice(-1)[0])?void 0:o.route)===this.chatStore.route;t.includes(e.type)&&!a&&(null==(s=this.chatStore)||s.updateUnReadCount(((null==(i=this.chatStore)?void 0:i.unReadCount)||0)+1))}))}onUserVoiceVolumeChanged(e){const{userVolumeList:t}=e;this.roomStore.setAudioVolume(t)}onUserNetworkQualityChanged(e){this.basicStore.setLocalQuality(e.userNetworkList)}async onKickedOutOfRoom(e){const{roomId:t,reason:n,message:o}=e;try{let e="";switch(n){case mt.kKickedByAdmin:e=Po("kicked out of the room by the host");break;case mt.kKickedByLoggedOnOtherDevice:e=Po("kicked out of the room by other device");break;case mt.kKickedByServer:e=Po("kicked out of the room by serve")}this.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{title:Po("Note"),message:e,confirmButtonText:Po("Sure"),showCancel:!1,appendToRoomContainer:!0,callback:async()=>{this.emit(ho.KICKED_OUT,{roomId:t,reason:n,message:o}),this.resetStore()}})}catch(i){So.error(`${bo}onKickedOutOfRoom error:`,i)}}onSendMessageForUserDisableChanged(e){const{userId:t,isDisable:n}=e;if(t===this.roomStore.localUser.userId){const e=Po(n?"You have been banned from text chat":"You are allowed to text chat");this.emit(ho.ROOM_NOTICE_MESSAGE,{code:-1,type:"warning",message:e,duration:Ut.NORMAL}),this.chatStore.setSendMessageDisableChanged(n)}this.roomStore.setMuteUserChat(t,n)}onUserSigExpired(){this.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{title:Po("Note"),message:Po("userSig 已过期"),showCancel:!1,confirmButtonText:Po("Sure"),appendToRoomContainer:!0,callback:()=>{this.emit(ho.USER_SIG_EXPIRED,{})}})}onKickedOffLine(e){const{message:t}=e;this.emit(ho.ROOM_NOTICE_MESSAGE_BOX,{title:Po("Note"),message:Po("系统检测到您的账号被踢下线"),showCancel:!1,confirmButtonText:Po("Sure"),appendToRoomContainer:!0,callback:async()=>{this.emit(ho.KICKED_OFFLINE,{message:t})}})}async onAllUserCameraDisableChanged(e){const{isDisable:t}=e;t!==this.roomStore.isCameraDisableForAllUser&&this.roomStore.localUser.userRole===rt.kGeneralUser&&this.roomStore.setCanControlSelfVideo(!t),this.handleVideoStateChange(t),this.roomStore.setDisableCameraForAllUserByAdmin(t)}async handleVideoStateChange(e){var t;const n=Po(e?"All videos disabled":"All videos enabled");this.emit(ho.ROOM_NOTICE_MESSAGE,{type:"success",message:n,duration:Ut.NORMAL}),e&&this.roomStore.localUser.userRole===rt.kGeneralUser&&await(null==(t=Uo.instance)?void 0:t.closeLocalCamera())}async onAllUserMicrophoneDisableChanged(e){const{isDisable:t}=e;t!==this.roomStore.isMicrophoneDisableForAllUser&&this.roomStore.localUser.userRole===rt.kGeneralUser&&this.roomStore.setCanControlSelfAudio(!t),this.handleAudioStateChange(t),this.roomStore.setDisableMicrophoneForAllUserByAdmin(t)}async onSendMessageForAllUserDisableChanged(e){const{isDisable:t}=e;t!==this.roomStore.isMessageDisableForAllUser&&this.roomStore.localUser.userRole===rt.kGeneralUser&&this.handleMessageStateChange(t),this.roomStore.setDisableMessageAllUserByAdmin(t)}async handleMessageStateChange(e){const t=Po(e?"Disabling text chat for all is enabled":"Unblocked all text chat");this.emit(ho.ROOM_NOTICE_MESSAGE,{type:"success",message:t,duration:Ut.NORMAL})}async handleAudioStateChange(e){var t;const n=Po(e?"All audios disabled":"All audios enabled");this.emit(ho.ROOM_NOTICE_MESSAGE,{type:"success",message:n,duration:Ut.NORMAL}),e&&this.roomStore.localUser.userRole===rt.kGeneralUser&&await(null==(t=Uo.instance)?void 0:t.muteLocalAudio())}resetStore(){this.basicStore.reset(),this.chatStore.reset(),this.roomStore.reset()}storeInit(e){this.basicStore.setBasicInfo(e),this.roomStore.setLocalUser(e)}async initRoomKit(e){this.storeInit(e);const{sdkAppId:t,userId:n,userSig:o}=e,i={sdkAppId:t,userId:n,userSig:o};uni.$tim&&(i.tim=uni.$tim),await Jn.login(i),this.tim=Jn.getTIM(),this.bindChatEvents(),this.emit(ho.ROOM_LOGIN)}async start(e,t){return this.roomActionManager.start(e,t)}async join(e,t){return this.roomActionManager.join(e,t)}async createRoom(e){await this.roomActionManager.createRoom(e)}async enterRoom(e){await this.roomActionManager.enterRoom(e)}async leaveRoom(){await this.roomActionManager.leaveRoom()}async dismissRoom(){await this.roomActionManager.dismissRoom()}async handleRoomEngineReady(){var e;const t=uni.getStorageSync("tuiRoom-currentTheme");if(t&&this.basicStore.setDefaultTheme(t),Qe)return;const n=null==(e=Uo.instance)?void 0:e.getTRTCCloud(),o=et?Dn.TRTCVideoMirrorType_Auto:this.basicStore.isLocalStreamMirror?Dn.TRTCVideoMirrorType_Enable:Dn.TRTCVideoMirrorType_Disable;await(null==n?void 0:n.setLocalRenderParams({mirrorType:o,rotation:Pn.TRTCVideoRotation0,fillMode:Sn.TRTCVideoFillMode_Fill}))}logOut(){this.resetStore()}on(e,t){this.emitter.on(e,t)}off(e,t){this.emitter.off(e,t)}emit(e,t){this.emitter.emit(e,t)}setSelfInfo(e){return this.userManager.setSelfInfo(e)}}const Fo=wo.getInstance(),xo=e.defineComponent({__name:"SwitchTheme",props:{visible:{type:Boolean,default:!0}},setup(t){const n=ot(),{defaultTheme:o}=ke(n),{t:i}=ae(),[s]=Fo.getComponentConfig(["SwitchTheme"]);function a(){"white"===o.value?n.setDefaultTheme("black"):"black"===o.value&&n.setDefaultTheme("white")}const r=uni.getStorageSync("tuiRoom-currentTheme");return r&&n.setDefaultTheme(r),e.watch(o,(e=>{!function(e){switch(e){case"black":null==document||document.body.classList.remove("tui-theme-white"),null==document||document.body.classList.add("tui-theme-black"),uni.setStorageSync("tuiRoom-currentTheme","black");break;case"white":null==document||document.body.classList.remove("tui-theme-black"),null==document||document.body.classList.add("tui-theme-white"),uni.setStorageSync("tuiRoom-currentTheme","white")}}(e)}),{immediate:!0}),(t,n)=>t.visible&&e.unref(s).visible?(e.openBlock(),e.createBlock(po,{key:0,title:e.unref(i)("Switch Theme"),layout:e.unref(lo).HORIZONTAL,icon:e.unref("/assets/SwitchThemeIcon.39885fa7.svg"),onClickIcon:a},null,8,["title","layout","icon"])):e.createCommentVNode("",!0)}}),Vo=Q(e.defineComponent({__name:"preConference",props:{userInfo:{default:()=>({userId:"",userName:"",avatarUrl:""})},showEditNameInPc:{type:Boolean,default:!1},roomId:{default:""},enableScheduledConference:{type:Boolean,default:!0},isShowLogo:{type:Boolean,default:!0}},emits:["on-create-room","on-enter-room","on-update-user-name","on-logout"],setup(t,{emit:n}){const o=e.ref(),i=t,s=n,a=e.computed((()=>`tui-theme-${Fo.basicStore.defaultTheme}`));async function r(e){s("on-create-room",e)}async function c(e){s("on-enter-room",e)}async function u(){s("on-logout")}const l=e=>{const{message:t,title:n=Fo.t("Note"),cancelButtonText:o,confirmButtonText:i=Fo.t("Sure"),callback:s=()=>{}}=e;Do({title:n,message:t,cancelButtonText:o,confirmButtonText:i,callback:s})},d=e=>{const{type:t,message:n,duration:o}=e;it({type:t,message:n,duration:o})};return e.onMounted((()=>{Fo.on(ho.ROOM_NOTICE_MESSAGE,d),Fo.on(ho.ROOM_NOTICE_MESSAGE_BOX,l)})),e.onUnmounted((()=>{Fo.off(ho.ROOM_NOTICE_MESSAGE,d),Fo.off(ho.ROOM_NOTICE_MESSAGE_BOX,l)})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["home-container",[`tui-theme-${a.value}`]])},[e.createElementVNode("div",{class:"header"},[e.createElementVNode("div",{class:"left-header"},[e.createVNode(xo,{visible:!1,class:"header-item"})]),e.createElementVNode("div",{class:"right-header"},[e.createVNode(no,{class:"header-item user-info","user-id":i.userInfo.userId,"user-name":i.userInfo.userName,"avatar-url":i.userInfo.avatarUrl,onLogOut:u},null,8,["user-id","user-name","avatar-url"])])]),e.createVNode(ao,{ref_key:"roomControlRef",ref:o,"user-name":i.userInfo.userName,onCreateRoom:r,onEnterRoom:c},null,8,["user-name"])],2))}}),[["__scopeId","data-v-53fb1cca"]]);var qo="undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{},Bo=[],Ho=[],jo="undefined"!=typeof Uint8Array?Uint8Array:Array,Ko=!1;function Yo(){Ko=!0;for(var e="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",t=0;t<64;++t)Bo[t]=e[t],Ho[e.charCodeAt(t)]=t;Ho["-".charCodeAt(0)]=62,Ho["_".charCodeAt(0)]=63}function zo(e,t,n){for(var o,i,s=[],a=t;a<n;a+=3)o=(e[a]<<16)+(e[a+1]<<8)+e[a+2],s.push(Bo[(i=o)>>18&63]+Bo[i>>12&63]+Bo[i>>6&63]+Bo[63&i]);return s.join("")}function Wo(e){var t;Ko||Yo();for(var n=e.length,o=n%3,i="",s=[],a=0,r=n-o;a<r;a+=16383)s.push(zo(e,a,a+16383>r?r:a+16383));return 1===o?(t=e[n-1],i+=Bo[t>>2],i+=Bo[t<<4&63],i+="=="):2===o&&(t=(e[n-2]<<8)+e[n-1],i+=Bo[t>>10],i+=Bo[t>>4&63],i+=Bo[t<<2&63],i+="="),s.push(i),s.join("")}function Jo(e,t,n,o,i){var s,a,r=8*i-o-1,c=(1<<r)-1,u=c>>1,l=-7,d=n?i-1:0,p=n?-1:1,h=e[t+d];for(d+=p,s=h&(1<<-l)-1,h>>=-l,l+=r;l>0;s=256*s+e[t+d],d+=p,l-=8);for(a=s&(1<<-l)-1,s>>=-l,l+=o;l>0;a=256*a+e[t+d],d+=p,l-=8);if(0===s)s=1-u;else{if(s===c)return a?NaN:1/0*(h?-1:1);a+=Math.pow(2,o),s-=u}return(h?-1:1)*a*Math.pow(2,s-o)}function $o(e,t,n,o,i,s){var a,r,c,u=8*s-i-1,l=(1<<u)-1,d=l>>1,p=23===i?Math.pow(2,-24)-Math.pow(2,-77):0,h=o?0:s-1,g=o?1:-1,_=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(r=isNaN(t)?1:0,a=l):(a=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-a))<1&&(a--,c*=2),(t+=a+d>=1?p/c:p*Math.pow(2,1-d))*c>=2&&(a++,c/=2),a+d>=l?(r=0,a=l):a+d>=1?(r=(t*c-1)*Math.pow(2,i),a+=d):(r=t*Math.pow(2,d-1)*Math.pow(2,i),a=0));i>=8;e[n+h]=255&r,h+=g,r/=256,i-=8);for(a=a<<i|r,u+=i;u>0;e[n+h]=255&a,h+=g,a/=256,u-=8);e[n+h-g]|=128*_}var Xo={}.toString,Zo=Array.isArray||function(e){return"[object Array]"==Xo.call(e)};function Qo(){return ti.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function ei(e,t){if(Qo()<t)throw new RangeError("Invalid typed array length");return ti.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=ti.prototype:(null===e&&(e=new ti(t)),e.length=t),e}function ti(e,t,n){if(!(ti.TYPED_ARRAY_SUPPORT||this instanceof ti))return new ti(e,t,n);if("number"==typeof e){if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return ii(this,e)}return ni(this,e,t,n)}function ni(e,t,n,o){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,n,o){if(t.byteLength,n<0||t.byteLength<n)throw new RangeError("'offset' is out of bounds");if(t.byteLength<n+(o||0))throw new RangeError("'length' is out of bounds");return t=void 0===n&&void 0===o?new Uint8Array(t):void 0===o?new Uint8Array(t,n):new Uint8Array(t,n,o),ti.TYPED_ARRAY_SUPPORT?(e=t).__proto__=ti.prototype:e=si(e,t),e}(e,t,n,o):"string"==typeof t?function(e,t,n){if("string"==typeof n&&""!==n||(n="utf8"),!ti.isEncoding(n))throw new TypeError('"encoding" must be a valid string encoding');var o=0|ci(t,n),i=(e=ei(e,o)).write(t,n);return i!==o&&(e=e.slice(0,i)),e}(e,t,n):function(e,t){if(ri(t)){var n=0|ai(t.length);return 0===(e=ei(e,n)).length||t.copy(e,0,0,n),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(o=t.length)!=o?ei(e,0):si(e,t);if("Buffer"===t.type&&Zo(t.data))return si(e,t.data)}var o;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function oi(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function ii(e,t){if(oi(t),e=ei(e,t<0?0:0|ai(t)),!ti.TYPED_ARRAY_SUPPORT)for(var n=0;n<t;++n)e[n]=0;return e}function si(e,t){var n=t.length<0?0:0|ai(t.length);e=ei(e,n);for(var o=0;o<n;o+=1)e[o]=255&t[o];return e}function ai(e){if(e>=Qo())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+Qo().toString(16)+" bytes");return 0|e}function ri(e){return!(null==e||!e._isBuffer)}function ci(e,t){if(ri(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var n=e.length;if(0===n)return 0;for(var o=!1;;)switch(t){case"ascii":case"latin1":case"binary":return n;case"utf8":case"utf-8":case void 0:return Ui(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*n;case"hex":return n>>>1;case"base64":return Gi(e).length;default:if(o)return Ui(e).length;t=(""+t).toLowerCase(),o=!0}}function ui(e,t,n){var o=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===n||n>this.length)&&(n=this.length),n<=0)return"";if((n>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return Ei(this,t,n);case"utf8":case"utf-8":return Ii(this,t,n);case"ascii":return Ci(this,t,n);case"latin1":case"binary":return Ti(this,t,n);case"base64":return yi(this,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Si(this,t,n);default:if(o)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),o=!0}}function li(e,t,n){var o=e[t];e[t]=e[n],e[n]=o}function di(e,t,n,o,i){if(0===e.length)return-1;if("string"==typeof n?(o=n,n=0):n>2147483647?n=2147483647:n<-2147483648&&(n=-2147483648),n=+n,isNaN(n)&&(n=i?0:e.length-1),n<0&&(n=e.length+n),n>=e.length){if(i)return-1;n=e.length-1}else if(n<0){if(!i)return-1;n=0}if("string"==typeof t&&(t=ti.from(t,o)),ri(t))return 0===t.length?-1:pi(e,t,n,o,i);if("number"==typeof t)return t&=255,ti.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?i?Uint8Array.prototype.indexOf.call(e,t,n):Uint8Array.prototype.lastIndexOf.call(e,t,n):pi(e,[t],n,o,i);throw new TypeError("val must be string, number or Buffer")}function pi(e,t,n,o,i){var s,a=1,r=e.length,c=t.length;if(void 0!==o&&("ucs2"===(o=String(o).toLowerCase())||"ucs-2"===o||"utf16le"===o||"utf-16le"===o)){if(e.length<2||t.length<2)return-1;a=2,r/=2,c/=2,n/=2}function u(e,t){return 1===a?e[t]:e.readUInt16BE(t*a)}if(i){var l=-1;for(s=n;s<r;s++)if(u(e,s)===u(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*a}else-1!==l&&(s-=s-l),l=-1}else for(n+c>r&&(n=r-c),s=n;s>=0;s--){for(var d=!0,p=0;p<c;p++)if(u(e,s+p)!==u(t,p)){d=!1;break}if(d)return s}return-1}function hi(e,t,n,o){n=Number(n)||0;var i=e.length-n;o?(o=Number(o))>i&&(o=i):o=i;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");o>s/2&&(o=s/2);for(var a=0;a<o;++a){var r=parseInt(t.substr(2*a,2),16);if(isNaN(r))return a;e[n+a]=r}return a}function gi(e,t,n,o){return wi(Ui(t,e.length-n),e,n,o)}function _i(e,t,n,o){return wi(function(e){for(var t=[],n=0;n<e.length;++n)t.push(255&e.charCodeAt(n));return t}(t),e,n,o)}function fi(e,t,n,o){return _i(e,t,n,o)}function mi(e,t,n,o){return wi(Gi(t),e,n,o)}function vi(e,t,n,o){return wi(function(e,t){for(var n,o,i,s=[],a=0;a<e.length&&!((t-=2)<0);++a)o=(n=e.charCodeAt(a))>>8,i=n%256,s.push(i),s.push(o);return s}(t,e.length-n),e,n,o)}function yi(e,t,n){return 0===t&&n===e.length?Wo(e):Wo(e.slice(t,n))}function Ii(e,t,n){n=Math.min(e.length,n);for(var o=[],i=t;i<n;){var s,a,r,c,u=e[i],l=null,d=u>239?4:u>223?3:u>191?2:1;if(i+d<=n)switch(d){case 1:u<128&&(l=u);break;case 2:128==(192&(s=e[i+1]))&&(c=(31&u)<<6|63&s)>127&&(l=c);break;case 3:s=e[i+1],a=e[i+2],128==(192&s)&&128==(192&a)&&(c=(15&u)<<12|(63&s)<<6|63&a)>2047&&(c<55296||c>57343)&&(l=c);break;case 4:s=e[i+1],a=e[i+2],r=e[i+3],128==(192&s)&&128==(192&a)&&128==(192&r)&&(c=(15&u)<<18|(63&s)<<12|(63&a)<<6|63&r)>65535&&c<1114112&&(l=c)}null===l?(l=65533,d=1):l>65535&&(l-=65536,o.push(l>>>10&1023|55296),l=56320|1023&l),o.push(l),i+=d}return function(e){var t=e.length;if(t<=Mi)return String.fromCharCode.apply(String,e);for(var n="",o=0;o<t;)n+=String.fromCharCode.apply(String,e.slice(o,o+=Mi));return n}(o)}ti.TYPED_ARRAY_SUPPORT=void 0===qo.TYPED_ARRAY_SUPPORT||qo.TYPED_ARRAY_SUPPORT,ti.poolSize=8192,ti._augment=function(e){return e.__proto__=ti.prototype,e},ti.from=function(e,t,n){return ni(null,e,t,n)},ti.TYPED_ARRAY_SUPPORT&&(ti.prototype.__proto__=Uint8Array.prototype,ti.__proto__=Uint8Array),ti.alloc=function(e,t,n){return o=null,s=t,a=n,oi(i=e),i<=0?ei(o,i):void 0!==s?"string"==typeof a?ei(o,i).fill(s,a):ei(o,i).fill(s):ei(o,i);var o,i,s,a},ti.allocUnsafe=function(e){return ii(null,e)},ti.allocUnsafeSlow=function(e){return ii(null,e)},ti.isBuffer=Fi,ti.compare=function(e,t){if(!ri(e)||!ri(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var n=e.length,o=t.length,i=0,s=Math.min(n,o);i<s;++i)if(e[i]!==t[i]){n=e[i],o=t[i];break}return n<o?-1:o<n?1:0},ti.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},ti.concat=function(e,t){if(!Zo(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return ti.alloc(0);var n;if(void 0===t)for(t=0,n=0;n<e.length;++n)t+=e[n].length;var o=ti.allocUnsafe(t),i=0;for(n=0;n<e.length;++n){var s=e[n];if(!ri(s))throw new TypeError('"list" argument must be an Array of Buffers');s.copy(o,i),i+=s.length}return o},ti.byteLength=ci,ti.prototype._isBuffer=!0,ti.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)li(this,t,t+1);return this},ti.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)li(this,t,t+3),li(this,t+1,t+2);return this},ti.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)li(this,t,t+7),li(this,t+1,t+6),li(this,t+2,t+5),li(this,t+3,t+4);return this},ti.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?Ii(this,0,e):ui.apply(this,arguments)},ti.prototype.equals=function(e){if(!ri(e))throw new TypeError("Argument must be a Buffer");return this===e||0===ti.compare(this,e)},ti.prototype.inspect=function(){var e="";return this.length>0&&(e=this.toString("hex",0,50).match(/.{2}/g).join(" "),this.length>50&&(e+=" ... ")),"<Buffer "+e+">"},ti.prototype.compare=function(e,t,n,o,i){if(!ri(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===n&&(n=e?e.length:0),void 0===o&&(o=0),void 0===i&&(i=this.length),t<0||n>e.length||o<0||i>this.length)throw new RangeError("out of range index");if(o>=i&&t>=n)return 0;if(o>=i)return-1;if(t>=n)return 1;if(this===e)return 0;for(var s=(i>>>=0)-(o>>>=0),a=(n>>>=0)-(t>>>=0),r=Math.min(s,a),c=this.slice(o,i),u=e.slice(t,n),l=0;l<r;++l)if(c[l]!==u[l]){s=c[l],a=u[l];break}return s<a?-1:a<s?1:0},ti.prototype.includes=function(e,t,n){return-1!==this.indexOf(e,t,n)},ti.prototype.indexOf=function(e,t,n){return di(this,e,t,n,!0)},ti.prototype.lastIndexOf=function(e,t,n){return di(this,e,t,n,!1)},ti.prototype.write=function(e,t,n,o){if(void 0===t)o="utf8",n=this.length,t=0;else if(void 0===n&&"string"==typeof t)o=t,n=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(n)?(n|=0,void 0===o&&(o="utf8")):(o=n,n=void 0)}var i=this.length-t;if((void 0===n||n>i)&&(n=i),e.length>0&&(n<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");o||(o="utf8");for(var s=!1;;)switch(o){case"hex":return hi(this,e,t,n);case"utf8":case"utf-8":return gi(this,e,t,n);case"ascii":return _i(this,e,t,n);case"latin1":case"binary":return fi(this,e,t,n);case"base64":return mi(this,e,t,n);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return vi(this,e,t,n);default:if(s)throw new TypeError("Unknown encoding: "+o);o=(""+o).toLowerCase(),s=!0}},ti.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var Mi=4096;function Ci(e,t,n){var o="";n=Math.min(e.length,n);for(var i=t;i<n;++i)o+=String.fromCharCode(127&e[i]);return o}function Ti(e,t,n){var o="";n=Math.min(e.length,n);for(var i=t;i<n;++i)o+=String.fromCharCode(e[i]);return o}function Ei(e,t,n){var o=e.length;(!t||t<0)&&(t=0),(!n||n<0||n>o)&&(n=o);for(var i="",s=t;s<n;++s)i+=bi(e[s]);return i}function Si(e,t,n){for(var o=e.slice(t,n),i="",s=0;s<o.length;s+=2)i+=String.fromCharCode(o[s]+256*o[s+1]);return i}function Di(e,t,n){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(e+t>n)throw new RangeError("Trying to access beyond buffer length")}function ki(e,t,n,o,i,s){if(!ri(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(t>i||t<s)throw new RangeError('"value" argument is out of bounds');if(n+o>e.length)throw new RangeError("Index out of range")}function Ri(e,t,n,o){t<0&&(t=65535+t+1);for(var i=0,s=Math.min(e.length-n,2);i<s;++i)e[n+i]=(t&255<<8*(o?i:1-i))>>>8*(o?i:1-i)}function Li(e,t,n,o){t<0&&(t=4294967295+t+1);for(var i=0,s=Math.min(e.length-n,4);i<s;++i)e[n+i]=t>>>8*(o?i:3-i)&255}function Ai(e,t,n,o,i,s){if(n+o>e.length)throw new RangeError("Index out of range");if(n<0)throw new RangeError("Index out of range")}function Oi(e,t,n,o,i){return i||Ai(e,0,n,4),$o(e,t,n,o,23,4),n+4}function Ni(e,t,n,o,i){return i||Ai(e,0,n,8),$o(e,t,n,o,52,8),n+8}ti.prototype.slice=function(e,t){var n,o=this.length;if((e=~~e)<0?(e+=o)<0&&(e=0):e>o&&(e=o),(t=void 0===t?o:~~t)<0?(t+=o)<0&&(t=0):t>o&&(t=o),t<e&&(t=e),ti.TYPED_ARRAY_SUPPORT)(n=this.subarray(e,t)).__proto__=ti.prototype;else{var i=t-e;n=new ti(i,void 0);for(var s=0;s<i;++s)n[s]=this[s+e]}return n},ti.prototype.readUIntLE=function(e,t,n){e|=0,t|=0,n||Di(e,t,this.length);for(var o=this[e],i=1,s=0;++s<t&&(i*=256);)o+=this[e+s]*i;return o},ti.prototype.readUIntBE=function(e,t,n){e|=0,t|=0,n||Di(e,t,this.length);for(var o=this[e+--t],i=1;t>0&&(i*=256);)o+=this[e+--t]*i;return o},ti.prototype.readUInt8=function(e,t){return t||Di(e,1,this.length),this[e]},ti.prototype.readUInt16LE=function(e,t){return t||Di(e,2,this.length),this[e]|this[e+1]<<8},ti.prototype.readUInt16BE=function(e,t){return t||Di(e,2,this.length),this[e]<<8|this[e+1]},ti.prototype.readUInt32LE=function(e,t){return t||Di(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},ti.prototype.readUInt32BE=function(e,t){return t||Di(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},ti.prototype.readIntLE=function(e,t,n){e|=0,t|=0,n||Di(e,t,this.length);for(var o=this[e],i=1,s=0;++s<t&&(i*=256);)o+=this[e+s]*i;return o>=(i*=128)&&(o-=Math.pow(2,8*t)),o},ti.prototype.readIntBE=function(e,t,n){e|=0,t|=0,n||Di(e,t,this.length);for(var o=t,i=1,s=this[e+--o];o>0&&(i*=256);)s+=this[e+--o]*i;return s>=(i*=128)&&(s-=Math.pow(2,8*t)),s},ti.prototype.readInt8=function(e,t){return t||Di(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},ti.prototype.readInt16LE=function(e,t){t||Di(e,2,this.length);var n=this[e]|this[e+1]<<8;return 32768&n?4294901760|n:n},ti.prototype.readInt16BE=function(e,t){t||Di(e,2,this.length);var n=this[e+1]|this[e]<<8;return 32768&n?4294901760|n:n},ti.prototype.readInt32LE=function(e,t){return t||Di(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},ti.prototype.readInt32BE=function(e,t){return t||Di(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},ti.prototype.readFloatLE=function(e,t){return t||Di(e,4,this.length),Jo(this,e,!0,23,4)},ti.prototype.readFloatBE=function(e,t){return t||Di(e,4,this.length),Jo(this,e,!1,23,4)},ti.prototype.readDoubleLE=function(e,t){return t||Di(e,8,this.length),Jo(this,e,!0,52,8)},ti.prototype.readDoubleBE=function(e,t){return t||Di(e,8,this.length),Jo(this,e,!1,52,8)},ti.prototype.writeUIntLE=function(e,t,n,o){e=+e,t|=0,n|=0,o||ki(this,e,t,n,Math.pow(2,8*n)-1,0);var i=1,s=0;for(this[t]=255&e;++s<n&&(i*=256);)this[t+s]=e/i&255;return t+n},ti.prototype.writeUIntBE=function(e,t,n,o){e=+e,t|=0,n|=0,o||ki(this,e,t,n,Math.pow(2,8*n)-1,0);var i=n-1,s=1;for(this[t+i]=255&e;--i>=0&&(s*=256);)this[t+i]=e/s&255;return t+n},ti.prototype.writeUInt8=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,1,255,0),ti.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},ti.prototype.writeUInt16LE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,2,65535,0),ti.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ri(this,e,t,!0),t+2},ti.prototype.writeUInt16BE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,2,65535,0),ti.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ri(this,e,t,!1),t+2},ti.prototype.writeUInt32LE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,4,4294967295,0),ti.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):Li(this,e,t,!0),t+4},ti.prototype.writeUInt32BE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,4,4294967295,0),ti.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Li(this,e,t,!1),t+4},ti.prototype.writeIntLE=function(e,t,n,o){if(e=+e,t|=0,!o){var i=Math.pow(2,8*n-1);ki(this,e,t,n,i-1,-i)}var s=0,a=1,r=0;for(this[t]=255&e;++s<n&&(a*=256);)e<0&&0===r&&0!==this[t+s-1]&&(r=1),this[t+s]=(e/a|0)-r&255;return t+n},ti.prototype.writeIntBE=function(e,t,n,o){if(e=+e,t|=0,!o){var i=Math.pow(2,8*n-1);ki(this,e,t,n,i-1,-i)}var s=n-1,a=1,r=0;for(this[t+s]=255&e;--s>=0&&(a*=256);)e<0&&0===r&&0!==this[t+s+1]&&(r=1),this[t+s]=(e/a|0)-r&255;return t+n},ti.prototype.writeInt8=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,1,127,-128),ti.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},ti.prototype.writeInt16LE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,2,32767,-32768),ti.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):Ri(this,e,t,!0),t+2},ti.prototype.writeInt16BE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,2,32767,-32768),ti.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):Ri(this,e,t,!1),t+2},ti.prototype.writeInt32LE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,4,2147483647,-2147483648),ti.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):Li(this,e,t,!0),t+4},ti.prototype.writeInt32BE=function(e,t,n){return e=+e,t|=0,n||ki(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),ti.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):Li(this,e,t,!1),t+4},ti.prototype.writeFloatLE=function(e,t,n){return Oi(this,e,t,!0,n)},ti.prototype.writeFloatBE=function(e,t,n){return Oi(this,e,t,!1,n)},ti.prototype.writeDoubleLE=function(e,t,n){return Ni(this,e,t,!0,n)},ti.prototype.writeDoubleBE=function(e,t,n){return Ni(this,e,t,!1,n)},ti.prototype.copy=function(e,t,n,o){if(n||(n=0),o||0===o||(o=this.length),t>=e.length&&(t=e.length),t||(t=0),o>0&&o<n&&(o=n),o===n)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(n<0||n>=this.length)throw new RangeError("sourceStart out of bounds");if(o<0)throw new RangeError("sourceEnd out of bounds");o>this.length&&(o=this.length),e.length-t<o-n&&(o=e.length-t+n);var i,s=o-n;if(this===e&&n<t&&t<o)for(i=s-1;i>=0;--i)e[i+t]=this[i+n];else if(s<1e3||!ti.TYPED_ARRAY_SUPPORT)for(i=0;i<s;++i)e[i+t]=this[i+n];else Uint8Array.prototype.set.call(e,this.subarray(n,n+s),t);return s},ti.prototype.fill=function(e,t,n,o){if("string"==typeof e){if("string"==typeof t?(o=t,t=0,n=this.length):"string"==typeof n&&(o=n,n=this.length),1===e.length){var i=e.charCodeAt(0);i<256&&(e=i)}if(void 0!==o&&"string"!=typeof o)throw new TypeError("encoding must be a string");if("string"==typeof o&&!ti.isEncoding(o))throw new TypeError("Unknown encoding: "+o)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<n)throw new RangeError("Out of range index");if(n<=t)return this;var s;if(t>>>=0,n=void 0===n?this.length:n>>>0,e||(e=0),"number"==typeof e)for(s=t;s<n;++s)this[s]=e;else{var a=ri(e)?e:Ui(new ti(e,o).toString()),r=a.length;for(s=0;s<n-t;++s)this[s+t]=a[s%r]}return this};var Pi=/[^+\/0-9A-Za-z-_]/g;function bi(e){return e<16?"0"+e.toString(16):e.toString(16)}function Ui(e,t){var n;t=t||1/0;for(var o=e.length,i=null,s=[],a=0;a<o;++a){if((n=e.charCodeAt(a))>55295&&n<57344){if(!i){if(n>56319){(t-=3)>-1&&s.push(239,191,189);continue}if(a+1===o){(t-=3)>-1&&s.push(239,191,189);continue}i=n;continue}if(n<56320){(t-=3)>-1&&s.push(239,191,189),i=n;continue}n=65536+(i-55296<<10|n-56320)}else i&&(t-=3)>-1&&s.push(239,191,189);if(i=null,n<128){if((t-=1)<0)break;s.push(n)}else if(n<2048){if((t-=2)<0)break;s.push(n>>6|192,63&n|128)}else if(n<65536){if((t-=3)<0)break;s.push(n>>12|224,n>>6&63|128,63&n|128)}else{if(!(n<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(n>>18|240,n>>12&63|128,n>>6&63|128,63&n|128)}}return s}function Gi(e){return function(e){var t,n,o,i,s,a;Ko||Yo();var r=e.length;if(r%4>0)throw new Error("Invalid string. Length must be a multiple of 4");s="="===e[r-2]?2:"="===e[r-1]?1:0,a=new jo(3*r/4-s),o=s>0?r-4:r;var c=0;for(t=0,n=0;t<o;t+=4,n+=3)i=Ho[e.charCodeAt(t)]<<18|Ho[e.charCodeAt(t+1)]<<12|Ho[e.charCodeAt(t+2)]<<6|Ho[e.charCodeAt(t+3)],a[c++]=i>>16&255,a[c++]=i>>8&255,a[c++]=255&i;return 2===s?(i=Ho[e.charCodeAt(t)]<<2|Ho[e.charCodeAt(t+1)]>>4,a[c++]=255&i):1===s&&(i=Ho[e.charCodeAt(t)]<<10|Ho[e.charCodeAt(t+1)]<<4|Ho[e.charCodeAt(t+2)]>>2,a[c++]=i>>8&255,a[c++]=255&i),a}(function(e){if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(Pi,"")).length<2)return"";for(var t;e.length%4!=0;)e+="=";return e}(e))}function wi(e,t,n,o){for(var i=0;i<o&&!(i+n>=t.length||i>=e.length);++i)t[i+n]=e[i];return i}function Fi(e){return null!=e&&(!!e._isBuffer||xi(e)||"function"==typeof(t=e).readFloatLE&&"function"==typeof t.slice&&xi(t.slice(0,0)));var t}function xi(e){return!!e.constructor&&"function"==typeof e.constructor.isBuffer&&e.constructor.isBuffer(e)}function Vi(e,t){return e(t={exports:{}},t.exports),t.exports}var qi=Vi((function(e,t){var n,o,i,s,a,r,c,u,l,d,p,h,g;e.exports=(n=n||(o=Math,i=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),a=(s={}).lib={},r=a.Base={extend:function(e){var t=i(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=r.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||l).stringify(this)},concat:function(e){var t=this.words,n=e.words,o=this.sigBytes,i=e.sigBytes;if(this.clamp(),o%4)for(var s=0;s<i;s++){var a=n[s>>>2]>>>24-s%4*8&255;t[o+s>>>2]|=a<<24-(o+s)%4*8}else for(s=0;s<i;s+=4)t[o+s>>>2]=n[s>>>2];return this.sigBytes+=i,this},clamp:function(){var e=this.words,t=this.sigBytes;e[t>>>2]&=4294967295<<32-t%4*8,e.length=o.ceil(t/4)},clone:function(){var e=r.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t,n=[],i=function(e){var t=987654321,n=4294967295;return function(){var i=((t=36969*(65535&t)+(t>>16)&n)<<16)+(e=18e3*(65535&e)+(e>>16)&n)&n;return i/=4294967296,(i+=.5)*(o.random()>.5?1:-1)}},s=0;s<e;s+=4){var a=i(4294967296*(t||o.random()));t=987654071*a(),n.push(4294967296*a()|0)}return new c.init(n,e)}}),u=s.enc={},l=u.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;o.push((s>>>4).toString(16)),o.push((15&s).toString(16))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o+=2)n[o>>>3]|=parseInt(e.substr(o,2),16)<<24-o%8*4;return new c.init(n,t/2)}},d=u.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var t=e.length,n=[],o=0;o<t;o++)n[o>>>2]|=(255&e.charCodeAt(o))<<24-o%4*8;return new c.init(n,t)}},p=u.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(t){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},h=a.BufferedBlockAlgorithm=r.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(e){var t=this._data,n=t.words,i=t.sigBytes,s=this.blockSize,a=i/(4*s),r=(a=e?o.ceil(a):o.max((0|a)-this._minBufferSize,0))*s,u=o.min(4*r,i);if(r){for(var l=0;l<r;l+=s)this._doProcessBlock(n,l);var d=n.splice(0,r);t.sigBytes-=u}return new c.init(d,u)},clone:function(){var e=r.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),a.Hasher=h.extend({cfg:r.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){h.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),g=s.algo={},s),n)})),Bi=(Vi((function(e,t){var n,o,i,s,a,r;e.exports=(i=(o=n=qi).lib,s=i.Base,a=i.WordArray,(r=o.x64={}).Word=s.extend({init:function(e,t){this.high=e,this.low=t}}),r.WordArray=s.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:8*e.length},toX32:function(){for(var e=this.words,t=e.length,n=[],o=0;o<t;o++){var i=e[o];n.push(i.high),n.push(i.low)}return a.create(n,this.sigBytes)},clone:function(){for(var e=s.clone.call(this),t=e.words=this.words.slice(0),n=t.length,o=0;o<n;o++)t[o]=t[o].clone();return e}}),n)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){if("function"==typeof ArrayBuffer){var e=n.lib.WordArray,t=e.init;(e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,o=[],i=0;i<n;i++)o[i>>>2]|=e[i]<<24-i%4*8;t.call(this,o,n)}else t.apply(this,arguments)}).prototype=e}}(),n.lib.WordArray)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib.WordArray,o=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}o.Utf16=o.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],i=0;i<n;i+=2){var s=t[i>>>2]>>>16-i%4*8&65535;o.push(String.fromCharCode(s))}return o.join("")},parse:function(e){for(var n=e.length,o=[],i=0;i<n;i++)o[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return t.create(o,2*n)}},o.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,o=[],s=0;s<n;s+=2){var a=i(t[s>>>2]>>>16-s%4*8&65535);o.push(String.fromCharCode(a))}return o.join("")},parse:function(e){for(var n=e.length,o=[],s=0;s<n;s++)o[s>>>1]|=i(e.charCodeAt(s)<<16-s%2*16);return t.create(o,2*n)}}}(),n.enc.Utf16)})),Vi((function(e,t){var n,o,i;e.exports=(i=(o=n=qi).lib.WordArray,o.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,o=this._map;e.clamp();for(var i=[],s=0;s<n;s+=3)for(var a=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,r=0;r<4&&s+.75*r<n;r++)i.push(o.charAt(a>>>6*(3-r)&63));var c=o.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,o=this._reverseMap;if(!o){o=this._reverseMap=[];for(var s=0;s<n.length;s++)o[n.charCodeAt(s)]=s}var a=n.charAt(64);if(a){var r=e.indexOf(a);-1!==r&&(t=r)}return function(e,t,n){for(var o=[],s=0,a=0;a<t;a++)if(a%4){var r=n[e.charCodeAt(a-1)]<<a%4*2,c=n[e.charCodeAt(a)]>>>6-a%4*2;o[s>>>2]|=(r|c)<<24-s%4*8,s++}return i.create(o,s)}(e,t,o)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},n.enc.Base64)})),Vi((function(e,t){var n;e.exports=(n=qi,function(e){var t=n,o=t.lib,i=o.WordArray,s=o.Hasher,a=t.algo,r=[];!function(){for(var t=0;t<64;t++)r[t]=4294967296*e.abs(e.sin(t+1))|0}();var c=a.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,i=e[o];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,a=e[t+0],c=e[t+1],h=e[t+2],g=e[t+3],_=e[t+4],f=e[t+5],m=e[t+6],v=e[t+7],y=e[t+8],I=e[t+9],M=e[t+10],C=e[t+11],T=e[t+12],E=e[t+13],S=e[t+14],D=e[t+15],k=s[0],R=s[1],L=s[2],A=s[3];k=u(k,R,L,A,a,7,r[0]),A=u(A,k,R,L,c,12,r[1]),L=u(L,A,k,R,h,17,r[2]),R=u(R,L,A,k,g,22,r[3]),k=u(k,R,L,A,_,7,r[4]),A=u(A,k,R,L,f,12,r[5]),L=u(L,A,k,R,m,17,r[6]),R=u(R,L,A,k,v,22,r[7]),k=u(k,R,L,A,y,7,r[8]),A=u(A,k,R,L,I,12,r[9]),L=u(L,A,k,R,M,17,r[10]),R=u(R,L,A,k,C,22,r[11]),k=u(k,R,L,A,T,7,r[12]),A=u(A,k,R,L,E,12,r[13]),L=u(L,A,k,R,S,17,r[14]),k=l(k,R=u(R,L,A,k,D,22,r[15]),L,A,c,5,r[16]),A=l(A,k,R,L,m,9,r[17]),L=l(L,A,k,R,C,14,r[18]),R=l(R,L,A,k,a,20,r[19]),k=l(k,R,L,A,f,5,r[20]),A=l(A,k,R,L,M,9,r[21]),L=l(L,A,k,R,D,14,r[22]),R=l(R,L,A,k,_,20,r[23]),k=l(k,R,L,A,I,5,r[24]),A=l(A,k,R,L,S,9,r[25]),L=l(L,A,k,R,g,14,r[26]),R=l(R,L,A,k,y,20,r[27]),k=l(k,R,L,A,E,5,r[28]),A=l(A,k,R,L,h,9,r[29]),L=l(L,A,k,R,v,14,r[30]),k=d(k,R=l(R,L,A,k,T,20,r[31]),L,A,f,4,r[32]),A=d(A,k,R,L,y,11,r[33]),L=d(L,A,k,R,C,16,r[34]),R=d(R,L,A,k,S,23,r[35]),k=d(k,R,L,A,c,4,r[36]),A=d(A,k,R,L,_,11,r[37]),L=d(L,A,k,R,v,16,r[38]),R=d(R,L,A,k,M,23,r[39]),k=d(k,R,L,A,E,4,r[40]),A=d(A,k,R,L,a,11,r[41]),L=d(L,A,k,R,g,16,r[42]),R=d(R,L,A,k,m,23,r[43]),k=d(k,R,L,A,I,4,r[44]),A=d(A,k,R,L,T,11,r[45]),L=d(L,A,k,R,D,16,r[46]),k=p(k,R=d(R,L,A,k,h,23,r[47]),L,A,a,6,r[48]),A=p(A,k,R,L,v,10,r[49]),L=p(L,A,k,R,S,15,r[50]),R=p(R,L,A,k,f,21,r[51]),k=p(k,R,L,A,T,6,r[52]),A=p(A,k,R,L,g,10,r[53]),L=p(L,A,k,R,M,15,r[54]),R=p(R,L,A,k,c,21,r[55]),k=p(k,R,L,A,y,6,r[56]),A=p(A,k,R,L,D,10,r[57]),L=p(L,A,k,R,m,15,r[58]),R=p(R,L,A,k,E,21,r[59]),k=p(k,R,L,A,_,6,r[60]),A=p(A,k,R,L,C,10,r[61]),L=p(L,A,k,R,h,15,r[62]),R=p(R,L,A,k,I,21,r[63]),s[0]=s[0]+k|0,s[1]=s[1]+R|0,s[2]=s[2]+L|0,s[3]=s[3]+A|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(o/4294967296),a=o;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),t.sigBytes=4*(n.length+1),this._process();for(var r=this._hash,c=r.words,u=0;u<4;u++){var l=c[u];c[u]=16711935&(l<<8|l>>>24)|4278255360&(l<<24|l>>>8)}return r},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function u(e,t,n,o,i,s,a){var r=e+(t&n|~t&o)+i+a;return(r<<s|r>>>32-s)+t}function l(e,t,n,o,i,s,a){var r=e+(t&o|n&~o)+i+a;return(r<<s|r>>>32-s)+t}function d(e,t,n,o,i,s,a){var r=e+(t^n^o)+i+a;return(r<<s|r>>>32-s)+t}function p(e,t,n,o,i,s,a){var r=e+(n^(t|~o))+i+a;return(r<<s|r>>>32-s)+t}t.MD5=s._createHelper(c),t.HmacMD5=s._createHmacHelper(c)}(Math),n.MD5)})),Vi((function(e,t){var n,o,i,s,a,r,c,u;e.exports=(i=(o=n=qi).lib,s=i.WordArray,a=i.Hasher,r=o.algo,c=[],u=r.SHA1=a.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],r=n[4],u=0;u<80;u++){if(u<16)c[u]=0|e[t+u];else{var l=c[u-3]^c[u-8]^c[u-14]^c[u-16];c[u]=l<<1|l>>>31}var d=(o<<5|o>>>27)+r+c[u];d+=u<20?1518500249+(i&s|~i&a):u<40?1859775393+(i^s^a):u<60?(i&s|i&a|s&a)-1894007588:(i^s^a)-899497514,r=a,a=s,s=i<<30|i>>>2,i=o,o=d}n[0]=n[0]+o|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+r|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(o+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=a.clone.call(this);return e._hash=this._hash.clone(),e}}),o.SHA1=a._createHelper(u),o.HmacSHA1=a._createHmacHelper(u),n.SHA1)})),Vi((function(e,t){var n;e.exports=(n=qi,function(e){var t=n,o=t.lib,i=o.WordArray,s=o.Hasher,a=t.algo,r=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),o=2;o<=n;o++)if(!(t%o))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var o=2,i=0;i<64;)t(o)&&(i<8&&(r[i]=n(e.pow(o,.5))),c[i]=n(e.pow(o,1/3)),i++),o++}();var u=[],l=a.SHA256=s.extend({_doReset:function(){this._hash=new i.init(r.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],r=n[4],l=n[5],d=n[6],p=n[7],h=0;h<64;h++){if(h<16)u[h]=0|e[t+h];else{var g=u[h-15],_=(g<<25|g>>>7)^(g<<14|g>>>18)^g>>>3,f=u[h-2],m=(f<<15|f>>>17)^(f<<13|f>>>19)^f>>>10;u[h]=_+u[h-7]+m+u[h-16]}var v=o&i^o&s^i&s,y=(o<<30|o>>>2)^(o<<19|o>>>13)^(o<<10|o>>>22),I=p+((r<<26|r>>>6)^(r<<21|r>>>11)^(r<<7|r>>>25))+(r&l^~r&d)+c[h]+u[h];p=d,d=l,l=r,r=a+I|0,a=s,s=i,i=o,o=I+(y+v)|0}n[0]=n[0]+o|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+a|0,n[4]=n[4]+r|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+p|0},_doFinalize:function(){var t=this._data,n=t.words,o=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(o/4294967296),n[15+(i+64>>>9<<4)]=o,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(l),t.HmacSHA256=s._createHmacHelper(l)}(Math),n.SHA256)})),Vi((function(e,t){var n,o,i,s,a,r;e.exports=(i=(o=n=qi).lib.WordArray,s=o.algo,a=s.SHA256,r=s.SHA224=a.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=a._doFinalize.call(this);return e.sigBytes-=4,e}}),o.SHA224=a._createHelper(r),o.HmacSHA224=a._createHmacHelper(r),n.SHA224)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib.Hasher,o=e.x64,i=o.Word,s=o.WordArray,a=e.algo;function r(){return i.create.apply(i,arguments)}var c=[r(1116352408,3609767458),r(1899447441,602891725),r(3049323471,3964484399),r(3921009573,2173295548),r(961987163,4081628472),r(1508970993,3053834265),r(2453635748,2937671579),r(2870763221,3664609560),r(3624381080,2734883394),r(310598401,1164996542),r(607225278,1323610764),r(1426881987,3590304994),r(1925078388,4068182383),r(2162078206,991336113),r(2614888103,633803317),r(3248222580,3479774868),r(3835390401,2666613458),r(4022224774,944711139),r(264347078,2341262773),r(604807628,2007800933),r(770255983,1495990901),r(1249150122,1856431235),r(1555081692,3175218132),r(1996064986,2198950837),r(2554220882,3999719339),r(2821834349,766784016),r(2952996808,2566594879),r(3210313671,3203337956),r(3336571891,1034457026),r(3584528711,2466948901),r(113926993,3758326383),r(338241895,168717936),r(666307205,1188179964),r(773529912,1546045734),r(1294757372,1522805485),r(1396182291,2643833823),r(1695183700,2343527390),r(1986661051,1014477480),r(2177026350,1206759142),r(2456956037,344077627),r(2730485921,1290863460),r(2820302411,3158454273),r(3259730800,3505952657),r(3345764771,106217008),r(3516065817,3606008344),r(3600352804,1432725776),r(4094571909,1467031594),r(275423344,851169720),r(430227734,3100823752),r(506948616,1363258195),r(659060556,3750685593),r(883997877,3785050280),r(958139571,3318307427),r(1322822218,3812723403),r(1537002063,2003034995),r(1747873779,3602036899),r(1955562222,1575990012),r(2024104815,1125592928),r(2227730452,2716904306),r(2361852424,442776044),r(2428436474,593698344),r(2756734187,3733110249),r(3204031479,2999351573),r(3329325298,3815920427),r(3391569614,3928383900),r(3515267271,566280711),r(3940187606,3454069534),r(4118630271,4000239992),r(116418474,1914138554),r(174292421,2731055270),r(289380356,3203993006),r(460393269,320620315),r(685471733,587496836),r(852142971,1086792851),r(1017036298,365543100),r(1126000580,2618297676),r(1288033470,3409855158),r(1501505948,4234509866),r(1607167915,987167468),r(1816402316,1246189591)],u=[];!function(){for(var e=0;e<80;e++)u[e]=r()}();var l=a.SHA512=t.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,o=n[0],i=n[1],s=n[2],a=n[3],r=n[4],l=n[5],d=n[6],p=n[7],h=o.high,g=o.low,_=i.high,f=i.low,m=s.high,v=s.low,y=a.high,I=a.low,M=r.high,C=r.low,T=l.high,E=l.low,S=d.high,D=d.low,k=p.high,R=p.low,L=h,A=g,O=_,N=f,P=m,b=v,U=y,G=I,w=M,F=C,x=T,V=E,q=S,B=D,H=k,j=R,K=0;K<80;K++){var Y=u[K];if(K<16)var z=Y.high=0|e[t+2*K],W=Y.low=0|e[t+2*K+1];else{var J=u[K-15],$=J.high,X=J.low,Z=($>>>1|X<<31)^($>>>8|X<<24)^$>>>7,Q=(X>>>1|$<<31)^(X>>>8|$<<24)^(X>>>7|$<<25),ee=u[K-2],te=ee.high,ne=ee.low,oe=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ie=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),se=u[K-7],ae=se.high,re=se.low,ce=u[K-16],ue=ce.high,le=ce.low;z=(z=(z=Z+ae+((W=Q+re)>>>0<Q>>>0?1:0))+oe+((W+=ie)>>>0<ie>>>0?1:0))+ue+((W+=le)>>>0<le>>>0?1:0),Y.high=z,Y.low=W}var de,pe=w&x^~w&q,he=F&V^~F&B,ge=L&O^L&P^O&P,_e=A&N^A&b^N&b,fe=(L>>>28|A<<4)^(L<<30|A>>>2)^(L<<25|A>>>7),me=(A>>>28|L<<4)^(A<<30|L>>>2)^(A<<25|L>>>7),ve=(w>>>14|F<<18)^(w>>>18|F<<14)^(w<<23|F>>>9),ye=(F>>>14|w<<18)^(F>>>18|w<<14)^(F<<23|w>>>9),Ie=c[K],Me=Ie.high,Ce=Ie.low,Te=H+ve+((de=j+ye)>>>0<j>>>0?1:0),Ee=me+_e;H=q,j=B,q=x,B=V,x=w,V=F,w=U+(Te=(Te=(Te=Te+pe+((de+=he)>>>0<he>>>0?1:0))+Me+((de+=Ce)>>>0<Ce>>>0?1:0))+z+((de+=W)>>>0<W>>>0?1:0))+((F=G+de|0)>>>0<G>>>0?1:0)|0,U=P,G=b,P=O,b=N,O=L,N=A,L=Te+(fe+ge+(Ee>>>0<me>>>0?1:0))+((A=de+Ee|0)>>>0<de>>>0?1:0)|0}g=o.low=g+A,o.high=h+L+(g>>>0<A>>>0?1:0),f=i.low=f+N,i.high=_+O+(f>>>0<N>>>0?1:0),v=s.low=v+b,s.high=m+P+(v>>>0<b>>>0?1:0),I=a.low=I+G,a.high=y+U+(I>>>0<G>>>0?1:0),C=r.low=C+F,r.high=M+w+(C>>>0<F>>>0?1:0),E=l.low=E+V,l.high=T+x+(E>>>0<V>>>0?1:0),D=d.low=D+B,d.high=S+q+(D>>>0<B>>>0?1:0),R=p.low=R+j,p.high=k+H+(R>>>0<j>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;return t[o>>>5]|=128<<24-o%32,t[30+(o+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(o+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(l),e.HmacSHA512=t._createHmacHelper(l)}(),n.SHA512)})),Vi((function(e,t){var n,o,i,s,a,r,c,u;e.exports=(i=(o=n=qi).x64,s=i.Word,a=i.WordArray,r=o.algo,c=r.SHA512,u=r.SHA384=c.extend({_doReset:function(){this._hash=new a.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=c._doFinalize.call(this);return e.sigBytes-=16,e}}),o.SHA384=c._createHelper(u),o.HmacSHA384=c._createHmacHelper(u),n.SHA384)})),Vi((function(e,t){var n;e.exports=(n=qi,function(e){var t=n,o=t.lib,i=o.WordArray,s=o.Hasher,a=t.x64.Word,r=t.algo,c=[],u=[],l=[];!function(){for(var e=1,t=0,n=0;n<24;n++){c[e+5*t]=(n+1)*(n+2)/2%64;var o=(2*e+3*t)%5;e=t%5,t=o}for(e=0;e<5;e++)for(t=0;t<5;t++)u[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,s=0;s<24;s++){for(var r=0,d=0,p=0;p<7;p++){if(1&i){var h=(1<<p)-1;h<32?d^=1<<h:r^=1<<h-32}128&i?i=i<<1^113:i<<=1}l[s]=a.create(r,d)}}();var d=[];!function(){for(var e=0;e<25;e++)d[e]=a.create()}();var p=r.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new a.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,o=this.blockSize/2,i=0;i<o;i++){var s=e[t+2*i],a=e[t+2*i+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),a=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),(R=n[i]).high^=a,R.low^=s}for(var r=0;r<24;r++){for(var p=0;p<5;p++){for(var h=0,g=0,_=0;_<5;_++)h^=(R=n[p+5*_]).high,g^=R.low;var f=d[p];f.high=h,f.low=g}for(p=0;p<5;p++){var m=d[(p+4)%5],v=d[(p+1)%5],y=v.high,I=v.low;for(h=m.high^(y<<1|I>>>31),g=m.low^(I<<1|y>>>31),_=0;_<5;_++)(R=n[p+5*_]).high^=h,R.low^=g}for(var M=1;M<25;M++){var C=(R=n[M]).high,T=R.low,E=c[M];E<32?(h=C<<E|T>>>32-E,g=T<<E|C>>>32-E):(h=T<<E-32|C>>>64-E,g=C<<E-32|T>>>64-E);var S=d[u[M]];S.high=h,S.low=g}var D=d[0],k=n[0];for(D.high=k.high,D.low=k.low,p=0;p<5;p++)for(_=0;_<5;_++){var R=n[M=p+5*_],L=d[M],A=d[(p+1)%5+5*_],O=d[(p+2)%5+5*_];R.high=L.high^~A.high&O.high,R.low=L.low^~A.low&O.low}R=n[0];var N=l[r];R.high^=N.high,R.low^=N.low}},_doFinalize:function(){var t=this._data,n=t.words,o=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;n[o>>>5]|=1<<24-o%32,n[(e.ceil((o+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var a=this._state,r=this.cfg.outputLength/8,c=r/8,u=[],l=0;l<c;l++){var d=a[l],p=d.high,h=d.low;p=16711935&(p<<8|p>>>24)|4278255360&(p<<24|p>>>8),h=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8),u.push(h),u.push(p)}return new i.init(u,r)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=s._createHelper(p),t.HmacSHA3=s._createHmacHelper(p)}(Math),n.SHA3)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib,o=t.WordArray,i=t.Hasher,s=e.algo,a=o.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),r=o.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),c=o.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),u=o.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),l=o.create([0,1518500249,1859775393,2400959708,2840853838]),d=o.create([1352829926,1548603684,1836072691,2053994217,0]),p=s.RIPEMD160=i.extend({_doReset:function(){this._hash=o.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var o=t+n,i=e[o];e[o]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s,p,y,I,M,C,T,E,S,D,k,R=this._hash.words,L=l.words,A=d.words,O=a.words,N=r.words,P=c.words,b=u.words;for(C=s=R[0],T=p=R[1],E=y=R[2],S=I=R[3],D=M=R[4],n=0;n<80;n+=1)k=s+e[t+O[n]]|0,k+=n<16?h(p,y,I)+L[0]:n<32?g(p,y,I)+L[1]:n<48?_(p,y,I)+L[2]:n<64?f(p,y,I)+L[3]:m(p,y,I)+L[4],k=(k=v(k|=0,P[n]))+M|0,s=M,M=I,I=v(y,10),y=p,p=k,k=C+e[t+N[n]]|0,k+=n<16?m(T,E,S)+A[0]:n<32?f(T,E,S)+A[1]:n<48?_(T,E,S)+A[2]:n<64?g(T,E,S)+A[3]:h(T,E,S)+A[4],k=(k=v(k|=0,b[n]))+D|0,C=D,D=S,S=v(E,10),E=T,T=k;k=R[1]+y+S|0,R[1]=R[2]+I+D|0,R[2]=R[3]+M+C|0,R[3]=R[4]+s+T|0,R[4]=R[0]+p+E|0,R[0]=k},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,o=8*e.sigBytes;t[o>>>5]|=128<<24-o%32,t[14+(o+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,s=i.words,a=0;a<5;a++){var r=s[a];s[a]=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8)}return i},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function h(e,t,n){return e^t^n}function g(e,t,n){return e&t|~e&n}function _(e,t,n){return(e|~t)^n}function f(e,t,n){return e&n|t&~n}function m(e,t,n){return e^(t|~n)}function v(e,t){return e<<t|e>>>32-t}e.RIPEMD160=i._createHelper(p),e.HmacRIPEMD160=i._createHmacHelper(p)}(),n.RIPEMD160)})),Vi((function(e,t){var n,o,i,s;e.exports=(o=(n=qi).lib.Base,i=n.enc,s=i.Utf8,void(n.algo.HMAC=o.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=s.parse(t));var n=e.blockSize,o=4*n;t.sigBytes>o&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),a=this._iKey=t.clone(),r=i.words,c=a.words,u=0;u<n;u++)r[u]^=1549556828,c[u]^=909522486;i.sigBytes=a.sigBytes=o,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))})),Vi((function(e,t){var n,o,i,s,a,r,c,u,l;e.exports=(s=(i=(o=n=qi).lib).Base,a=i.WordArray,c=(r=o.algo).SHA1,u=r.HMAC,l=r.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=u.create(n.hasher,e),i=a.create(),s=a.create([1]),r=i.words,c=s.words,l=n.keySize,d=n.iterations;r.length<l;){var p=o.update(t).finalize(s);o.reset();for(var h=p.words,g=h.length,_=p,f=1;f<d;f++){_=o.finalize(_),o.reset();for(var m=_.words,v=0;v<g;v++)h[v]^=m[v]}i.concat(p),c[0]++}return i.sigBytes=4*l,i}}),o.PBKDF2=function(e,t,n){return l.create(n).compute(e,t)},n.PBKDF2)})),Vi((function(e,t){var n,o,i,s,a,r,c,u;e.exports=(s=(i=(o=n=qi).lib).Base,a=i.WordArray,c=(r=o.algo).MD5,u=r.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:c,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,o=n.hasher.create(),i=a.create(),s=i.words,r=n.keySize,c=n.iterations;s.length<r;){u&&o.update(u);var u=o.update(e).finalize(t);o.reset();for(var l=1;l<c;l++)u=o.finalize(u),o.reset();i.concat(u)}return i.sigBytes=4*r,i}}),o.EvpKDF=function(e,t,n){return u.create(n).compute(e,t)},n.EvpKDF)})),Vi((function(e,t){var n,o,i,s,a,r,c,u,l,d,p,h,g,_,f,m,v,y,I,M,C,T,E;e.exports=void((n=qi).lib.Cipher||(o=n,i=o.lib,s=i.Base,a=i.WordArray,r=i.BufferedBlockAlgorithm,c=o.enc,c.Utf8,u=c.Base64,l=o.algo,d=l.EvpKDF,p=i.Cipher=r.extend({cfg:s.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){r.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?E:M}return function(t){return{encrypt:function(n,o,i){return e(o).encrypt(t,n,o,i)},decrypt:function(n,o,i){return e(o).decrypt(t,n,o,i)}}}}()}),i.StreamCipher=p.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),h=o.mode={},g=i.BlockCipherMode=s.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),_=h.CBC=function(){var e=g.extend();function t(e,t,n){var o=this._iv;if(o){var i=o;this._iv=undefined}else i=this._prevBlock;for(var s=0;s<n;s++)e[t+s]^=i[s]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize;t.call(this,e,n,i),o.encryptBlock(e,n),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize,s=e.slice(n,n+i);o.decryptBlock(e,n),t.call(this,e,n,i),this._prevBlock=s}}),e}(),f=o.pad={},m=f.Pkcs7={pad:function(e,t){for(var n=4*t,o=n-e.sigBytes%n,i=o<<24|o<<16|o<<8|o,s=[],r=0;r<o;r+=4)s.push(i);var c=a.create(s,o);e.concat(c)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},i.BlockCipher=p.extend({cfg:p.cfg.extend({mode:_,padding:m}),reset:function(){p.reset.call(this);var e=this.cfg,t=e.iv,n=e.mode;if(this._xformMode==this._ENC_XFORM_MODE)var o=n.createEncryptor;else{o=n.createDecryptor;this._minBufferSize=1}this._mode&&this._mode.__creator==o?this._mode.init(this,t&&t.words):(this._mode=o.call(n,this,t&&t.words),this._mode.__creator=o)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e=this.cfg.padding;if(this._xformMode==this._ENC_XFORM_MODE){e.pad(this._data,this.blockSize);var t=this._process(!0)}else{t=this._process(!0);e.unpad(t)}return t},blockSize:4}),v=i.CipherParams=s.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}}),y=o.format={},I=y.OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;if(n)var o=a.create([1398893684,1701076831]).concat(n).concat(t);else o=t;return o.toString(u)},parse:function(e){var t=u.parse(e),n=t.words;if(1398893684==n[0]&&1701076831==n[1]){var o=a.create(n.slice(2,4));n.splice(0,4),t.sigBytes-=16}return v.create({ciphertext:t,salt:o})}},M=i.SerializableCipher=s.extend({cfg:s.extend({format:I}),encrypt:function(e,t,n,o){o=this.cfg.extend(o);var i=e.createEncryptor(n,o),s=i.finalize(t),a=i.cfg;return v.create({ciphertext:s,key:n,iv:a.iv,algorithm:e,mode:a.mode,padding:a.padding,blockSize:e.blockSize,formatter:o.format})},decrypt:function(e,t,n,o){return o=this.cfg.extend(o),t=this._parse(t,o.format),e.createDecryptor(n,o).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),C=o.kdf={},T=C.OpenSSL={execute:function(e,t,n,o){o||(o=a.random(8));var i=d.create({keySize:t+n}).compute(e,o),s=a.create(i.words.slice(t),4*n);return i.sigBytes=4*t,v.create({key:i,iv:s,salt:o})}},E=i.PasswordBasedCipher=M.extend({cfg:M.cfg.extend({kdf:T}),encrypt:function(e,t,n,o){var i=(o=this.cfg.extend(o)).kdf.execute(n,e.keySize,e.ivSize);o.iv=i.iv;var s=M.encrypt.call(this,e,t,i.key,o);return s.mixIn(i),s},decrypt:function(e,t,n,o){o=this.cfg.extend(o),t=this._parse(t,o.format);var i=o.kdf.execute(n,e.keySize,e.ivSize,t.salt);return o.iv=i.iv,M.decrypt.call(this,e,t,i.key,o)}})))})),Vi((function(e,t){var n;e.exports=((n=qi).mode.CFB=function(){var e=n.lib.BlockCipherMode.extend();function t(e,t,n,o){var i=this._iv;if(i){var s=i.slice(0);this._iv=void 0}else s=this._prevBlock;o.encryptBlock(s,0);for(var a=0;a<n;a++)e[t+a]^=s[a]}return e.Encryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize;t.call(this,e,n,i,o),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var o=this._cipher,i=o.blockSize,s=e.slice(n,n+i);t.call(this,e,n,i,o),this._prevBlock=s}}),e}(),n.mode.CFB)})),Vi((function(e,t){var n,o,i;e.exports=((n=qi).mode.CTR=(i=(o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0);var a=s.slice(0);n.encryptBlock(a,0),s[o-1]=s[o-1]+1|0;for(var r=0;r<o;r++)e[t+r]^=a[r]}}),o.Decryptor=i,o),n.mode.CTR)})),Vi((function(e,t){var n;e.exports=((n=qi).mode.CTRGladman=function(){var e=n.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,n=e>>8&255,o=255&e;255===t?(t=0,255===n?(n=0,255===o?o=0:++o):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=o}return e}var o=e.Encryptor=e.extend({processBlock:function(e,n){var o,i=this._cipher,s=i.blockSize,a=this._iv,r=this._counter;a&&(r=this._counter=a.slice(0),this._iv=void 0),0===((o=r)[0]=t(o[0]))&&(o[1]=t(o[1]));var c=r.slice(0);i.encryptBlock(c,0);for(var u=0;u<s;u++)e[n+u]^=c[u]}});return e.Decryptor=o,e}(),n.mode.CTRGladman)})),Vi((function(e,t){var n,o,i;e.exports=((n=qi).mode.OFB=(i=(o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){var n=this._cipher,o=n.blockSize,i=this._iv,s=this._keystream;i&&(s=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(s,0);for(var a=0;a<o;a++)e[t+a]^=s[a]}}),o.Decryptor=i,o),n.mode.OFB)})),Vi((function(e,t){var n,o;e.exports=((n=qi).mode.ECB=((o=n.lib.BlockCipherMode.extend()).Encryptor=o.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),o.Decryptor=o.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),o),n.mode.ECB)})),Vi((function(e,t){var n;e.exports=((n=qi).pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,o=4*t,i=o-n%o,s=n+i-1;e.clamp(),e.words[s>>>2]|=i<<24-s%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Ansix923)})),Vi((function(e,t){var n;e.exports=((n=qi).pad.Iso10126={pad:function(e,t){var o=4*t,i=o-e.sigBytes%o;e.concat(n.lib.WordArray.random(i-1)).concat(n.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},n.pad.Iso10126)})),Vi((function(e,t){var n;e.exports=((n=qi).pad.Iso97971={pad:function(e,t){e.concat(n.lib.WordArray.create([2147483648],1)),n.pad.ZeroPadding.pad(e,t)},unpad:function(e){n.pad.ZeroPadding.unpad(e),e.sigBytes--}},n.pad.Iso97971)})),Vi((function(e,t){var n;e.exports=((n=qi).pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){for(var t=e.words,n=e.sigBytes-1;!(t[n>>>2]>>>24-n%4*8&255);)n--;e.sigBytes=n+1}},n.pad.ZeroPadding)})),Vi((function(e,t){var n;e.exports=((n=qi).pad.NoPadding={pad:function(){},unpad:function(){}},n.pad.NoPadding)})),Vi((function(e,t){var n,o,i,s;e.exports=(i=(o=n=qi).lib.CipherParams,s=o.enc.Hex,o.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return i.create({ciphertext:t})}},n.format.Hex)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib.BlockCipher,o=e.algo,i=[],s=[],a=[],r=[],c=[],u=[],l=[],d=[],p=[],h=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,o=0;for(t=0;t<256;t++){var g=o^o<<1^o<<2^o<<3^o<<4;g=g>>>8^255&g^99,i[n]=g,s[g]=n;var _=e[n],f=e[_],m=e[f],v=257*e[g]^16843008*g;a[n]=v<<24|v>>>8,r[n]=v<<16|v>>>16,c[n]=v<<8|v>>>24,u[n]=v,v=16843009*m^65537*f^257*_^16843008*n,l[g]=v<<24|v>>>8,d[g]=v<<16|v>>>16,p[g]=v<<8|v>>>24,h[g]=v,n?(n=_^e[e[e[m^_]]],o^=e[e[o]]):n=o=1}}();var g=[0,1,2,4,8,16,32,64,128,27,54],_=o.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,o=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],a=0;a<o;a++)if(a<n)s[a]=t[a];else{var r=s[a-1];a%n?n>6&&a%n==4&&(r=i[r>>>24]<<24|i[r>>>16&255]<<16|i[r>>>8&255]<<8|i[255&r]):(r=i[(r=r<<8|r>>>24)>>>24]<<24|i[r>>>16&255]<<16|i[r>>>8&255]<<8|i[255&r],r^=g[a/n|0]<<24),s[a]=s[a-n]^r}for(var c=this._invKeySchedule=[],u=0;u<o;u++)a=o-u,r=u%4?s[a]:s[a-4],c[u]=u<4||a<=4?r:l[i[r>>>24]]^d[i[r>>>16&255]]^p[i[r>>>8&255]]^h[i[255&r]]}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,a,r,c,u,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,l,d,p,h,s),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,o,i,s,a,r){for(var c=this._nRounds,u=e[t]^n[0],l=e[t+1]^n[1],d=e[t+2]^n[2],p=e[t+3]^n[3],h=4,g=1;g<c;g++){var _=o[u>>>24]^i[l>>>16&255]^s[d>>>8&255]^a[255&p]^n[h++],f=o[l>>>24]^i[d>>>16&255]^s[p>>>8&255]^a[255&u]^n[h++],m=o[d>>>24]^i[p>>>16&255]^s[u>>>8&255]^a[255&l]^n[h++],v=o[p>>>24]^i[u>>>16&255]^s[l>>>8&255]^a[255&d]^n[h++];u=_,l=f,d=m,p=v}_=(r[u>>>24]<<24|r[l>>>16&255]<<16|r[d>>>8&255]<<8|r[255&p])^n[h++],f=(r[l>>>24]<<24|r[d>>>16&255]<<16|r[p>>>8&255]<<8|r[255&u])^n[h++],m=(r[d>>>24]<<24|r[p>>>16&255]<<16|r[u>>>8&255]<<8|r[255&l])^n[h++],v=(r[p>>>24]<<24|r[u>>>16&255]<<16|r[l>>>8&255]<<8|r[255&d])^n[h++],e[t]=_,e[t+1]=f,e[t+2]=m,e[t+3]=v},keySize:8});e.AES=t._createHelper(_)}(),n.AES)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib,o=t.WordArray,i=t.BlockCipher,s=e.algo,a=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],r=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],c=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],u=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],l=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],d=s.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var o=a[n]-1;t[n]=e[o>>>5]>>>31-o%32&1}for(var i=this._subKeys=[],s=0;s<16;s++){var u=i[s]=[],l=c[s];for(n=0;n<24;n++)u[n/6|0]|=t[(r[n]-1+l)%28]<<31-n%6,u[4+(n/6|0)]|=t[28+(r[n+24]-1+l)%28]<<31-n%6;for(u[0]=u[0]<<1|u[0]>>>31,n=1;n<7;n++)u[n]=u[n]>>>4*(n-1)+3;u[7]=u[7]<<5|u[7]>>>27}var d=this._invSubKeys=[];for(n=0;n<16;n++)d[n]=i[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],p.call(this,4,252645135),p.call(this,16,65535),h.call(this,2,858993459),h.call(this,8,16711935),p.call(this,1,1431655765);for(var o=0;o<16;o++){for(var i=n[o],s=this._lBlock,a=this._rBlock,r=0,c=0;c<8;c++)r|=u[c][((a^i[c])&l[c])>>>0];this._lBlock=a,this._rBlock=s^r}var d=this._lBlock;this._lBlock=this._rBlock,this._rBlock=d,p.call(this,1,1431655765),h.call(this,8,16711935),h.call(this,2,858993459),p.call(this,16,65535),p.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function p(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function h(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=i._createHelper(d);var g=s.TripleDES=i.extend({_doReset:function(){var e=this._key.words;this._des1=d.createEncryptor(o.create(e.slice(0,2))),this._des2=d.createEncryptor(o.create(e.slice(2,4))),this._des3=d.createEncryptor(o.create(e.slice(4,6)))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(g)}(),n.TripleDES)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,i=o.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,o=this._S=[],i=0;i<256;i++)o[i]=i;i=0;for(var s=0;i<256;i++){var a=i%n,r=t[a>>>2]>>>24-a%4*8&255;s=(s+o[i]+r)%256;var c=o[i];o[i]=o[s],o[s]=c}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,n=this._j,o=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[n],e[n]=s,o|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,o}e.RC4=t._createHelper(i);var a=o.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=t._createHelper(a)}(),n.RC4)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,i=[],s=[],a=[],r=o.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var o=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)c.call(this);for(n=0;n<8;n++)i[n]^=o[n+4&7];if(t){var s=t.words,a=s[0],r=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(i[0]^=u,i[1]^=d,i[2]^=l,i[3]^=p,i[4]^=u,i[5]^=d,i[6]^=l,i[7]^=p,n=0;n<4;n++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var o=0;o<4;o++)i[o]=16711935&(i[o]<<8|i[o]>>>24)|4278255360&(i[o]<<24|i[o]>>>8),e[t+o]^=i[o]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],i=65535&o,r=o>>>16,c=((i*i>>>17)+i*r>>>15)+r*r,u=((4294901760&o)*o|0)+((65535&o)*o|0);a[n]=c^u}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.Rabbit=t._createHelper(r)}(),n.Rabbit)})),Vi((function(e,t){var n;e.exports=(n=qi,function(){var e=n,t=e.lib.StreamCipher,o=e.algo,i=[],s=[],a=[],r=o.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],o=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)c.call(this);for(i=0;i<8;i++)o[i]^=n[i+4&7];if(t){var s=t.words,a=s[0],r=s[1],u=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),l=16711935&(r<<8|r>>>24)|4278255360&(r<<24|r>>>8),d=u>>>16|4294901760&l,p=l<<16|65535&u;for(o[0]^=u,o[1]^=d,o[2]^=l,o[3]^=p,o[4]^=u,o[5]^=d,o[6]^=l,o[7]^=p,i=0;i<4;i++)c.call(this)}},_doProcessBlock:function(e,t){var n=this._X;c.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var o=0;o<4;o++)i[o]=16711935&(i[o]<<8|i[o]>>>24)|4278255360&(i[o]<<24|i[o]>>>8),e[t+o]^=i[o]},blockSize:4,ivSize:2});function c(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var o=e[n]+t[n],i=65535&o,r=o>>>16,c=((i*i>>>17)+i*r>>>15)+r*r,u=((4294901760&o)*o|0)+((65535&o)*o|0);a[n]=c^u}e[0]=a[0]+(a[7]<<16|a[7]>>>16)+(a[6]<<16|a[6]>>>16)|0,e[1]=a[1]+(a[0]<<8|a[0]>>>24)+a[7]|0,e[2]=a[2]+(a[1]<<16|a[1]>>>16)+(a[0]<<16|a[0]>>>16)|0,e[3]=a[3]+(a[2]<<8|a[2]>>>24)+a[1]|0,e[4]=a[4]+(a[3]<<16|a[3]>>>16)+(a[2]<<16|a[2]>>>16)|0,e[5]=a[5]+(a[4]<<8|a[4]>>>24)+a[3]|0,e[6]=a[6]+(a[5]<<16|a[5]>>>16)+(a[4]<<16|a[4]>>>16)|0,e[7]=a[7]+(a[6]<<8|a[6]>>>24)+a[5]|0}e.RabbitLegacy=t._createHelper(r)}(),n.RabbitLegacy)})),Vi((function(e,t){e.exports=qi})));function Hi(){throw new Error("setTimeout has not been defined")}function ji(){throw new Error("clearTimeout has not been defined")}var Ki=Hi,Yi=ji;function zi(e){if(Ki===setTimeout)return setTimeout(e,0);if((Ki===Hi||!Ki)&&setTimeout)return Ki=setTimeout,setTimeout(e,0);try{return Ki(e,0)}catch(t){try{return Ki.call(null,e,0)}catch(n){return Ki.call(this,e,0)}}}"function"==typeof qo.setTimeout&&(Ki=setTimeout),"function"==typeof qo.clearTimeout&&(Yi=clearTimeout);var Wi,Ji=[],$i=!1,Xi=-1;function Zi(){$i&&Wi&&($i=!1,Wi.length?Ji=Wi.concat(Ji):Xi=-1,Ji.length&&Qi())}function Qi(){if(!$i){var e=zi(Zi);$i=!0;for(var t=Ji.length;t;){for(Wi=Ji,Ji=[];++Xi<t;)Wi&&Wi[Xi].run();Xi=-1,t=Ji.length}Wi=null,$i=!1,function(e){if(Yi===clearTimeout)return clearTimeout(e);if((Yi===ji||!Yi)&&clearTimeout)return Yi=clearTimeout,clearTimeout(e);try{Yi(e)}catch(t){try{return Yi.call(null,e)}catch(n){return Yi.call(this,e)}}}(e)}}function es(e){var t=new Array(arguments.length-1);if(arguments.length>1)for(var n=1;n<arguments.length;n++)t[n-1]=arguments[n];Ji.push(new ts(e,t)),1!==Ji.length||$i||zi(Qi)}function ts(e,t){this.fun=e,this.array=t}ts.prototype.run=function(){this.fun.apply(null,this.array)};var ns=qo.performance||{};function os(){}function is(){is.init.call(this)}function ss(e){return void 0===e._maxListeners?is.defaultMaxListeners:e._maxListeners}function as(e,t,n,o){var i,s,a,r;if("function"!=typeof n)throw new TypeError('"listener" argument must be a function');if((s=e._events)?(s.newListener&&(e.emit("newListener",t,n.listener?n.listener:n),s=e._events),a=s[t]):(s=e._events=new os,e._eventsCount=0),a){if("function"==typeof a?a=s[t]=o?[n,a]:[a,n]:o?a.unshift(n):a.push(n),!a.warned&&(i=ss(e))&&i>0&&a.length>i){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+t+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=e,c.type=t,c.count=a.length,r=c,"function"==typeof console.warn?_("warn","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2",r):_("log","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2",r)}}else a=s[t]=n,++e._eventsCount;return e}function rs(e,t,n){var o=!1;function i(){e.removeListener(t,i),o||(o=!0,n.apply(e,arguments))}return i.listener=n,i}function cs(e){var t=this._events;if(t){var n=t[e];if("function"==typeof n)return 1;if(n)return n.length}return 0}function us(e,t){for(var n=new Array(t);t--;)n[t]=e[t];return n}ns.now||ns.mozNow||ns.msNow||ns.oNow||ns.webkitNow,os.prototype=Object.create(null),is.EventEmitter=is,is.usingDomains=!1,is.prototype.domain=void 0,is.prototype._events=void 0,is.prototype._maxListeners=void 0,is.defaultMaxListeners=10,is.init=function(){this.domain=null,is.usingDomains&&(void 0).active&&(void 0).Domain,this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=new os,this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},is.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw new TypeError('"n" argument must be a positive number');return this._maxListeners=e,this},is.prototype.getMaxListeners=function(){return ss(this)},is.prototype.emit=function(e){var t,n,o,i,s,a,r,c="error"===e;if(a=this._events)c=c&&null==a.error;else if(!c)return!1;if(r=this.domain,c){if(t=arguments[1],!r){if(t instanceof Error)throw t;var u=new Error('Uncaught, unspecified "error" event. ('+t+")");throw u.context=t,u}return t||(t=new Error('Uncaught, unspecified "error" event')),t.domainEmitter=this,t.domain=r,t.domainThrown=!1,r.emit("error",t),!1}if(!(n=a[e]))return!1;var l="function"==typeof n;switch(o=arguments.length){case 1:!function(e,t,n){if(t)e.call(n);else for(var o=e.length,i=us(e,o),s=0;s<o;++s)i[s].call(n)}(n,l,this);break;case 2:!function(e,t,n,o){if(t)e.call(n,o);else for(var i=e.length,s=us(e,i),a=0;a<i;++a)s[a].call(n,o)}(n,l,this,arguments[1]);break;case 3:!function(e,t,n,o,i){if(t)e.call(n,o,i);else for(var s=e.length,a=us(e,s),r=0;r<s;++r)a[r].call(n,o,i)}(n,l,this,arguments[1],arguments[2]);break;case 4:!function(e,t,n,o,i,s){if(t)e.call(n,o,i,s);else for(var a=e.length,r=us(e,a),c=0;c<a;++c)r[c].call(n,o,i,s)}(n,l,this,arguments[1],arguments[2],arguments[3]);break;default:for(i=new Array(o-1),s=1;s<o;s++)i[s-1]=arguments[s];!function(e,t,n,o){if(t)e.apply(n,o);else for(var i=e.length,s=us(e,i),a=0;a<i;++a)s[a].apply(n,o)}(n,l,this,i)}return!0},is.prototype.addListener=function(e,t){return as(this,e,t,!1)},is.prototype.on=is.prototype.addListener,is.prototype.prependListener=function(e,t){return as(this,e,t,!0)},is.prototype.once=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.on(e,rs(this,e,t)),this},is.prototype.prependOnceListener=function(e,t){if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');return this.prependListener(e,rs(this,e,t)),this},is.prototype.removeListener=function(e,t){var n,o,i,s,a;if("function"!=typeof t)throw new TypeError('"listener" argument must be a function');if(!(o=this._events))return this;if(!(n=o[e]))return this;if(n===t||n.listener&&n.listener===t)0==--this._eventsCount?this._events=new os:(delete o[e],o.removeListener&&this.emit("removeListener",e,n.listener||t));else if("function"!=typeof n){for(i=-1,s=n.length;s-- >0;)if(n[s]===t||n[s].listener&&n[s].listener===t){a=n[s].listener,i=s;break}if(i<0)return this;if(1===n.length){if(n[0]=void 0,0==--this._eventsCount)return this._events=new os,this;delete o[e]}else!function(e,t){for(var n=t,o=n+1,i=e.length;o<i;n+=1,o+=1)e[n]=e[o];e.pop()}(n,i);o.removeListener&&this.emit("removeListener",e,a||t)}return this},is.prototype.removeAllListeners=function(e){var t,n;if(!(n=this._events))return this;if(!n.removeListener)return 0===arguments.length?(this._events=new os,this._eventsCount=0):n[e]&&(0==--this._eventsCount?this._events=new os:delete n[e]),this;if(0===arguments.length){for(var o,i=Object.keys(n),s=0;s<i.length;++s)"removeListener"!==(o=i[s])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=new os,this._eventsCount=0,this}if("function"==typeof(t=n[e]))this.removeListener(e,t);else if(t)do{this.removeListener(e,t[t.length-1])}while(t[0]);return this},is.prototype.listeners=function(e){var t,n=this._events;return n&&(t=n[e])?"function"==typeof t?[t.listener||t]:function(e){for(var t=new Array(e.length),n=0;n<t.length;++n)t[n]=e[n].listener||e[n];return t}(t):[]},is.listenerCount=function(e,t){return"function"==typeof e.listenerCount?e.listenerCount(t):cs.call(e,t)},is.prototype.listenerCount=cs,is.prototype.eventNames=function(){return this._eventsCount>0?Reflect.ownKeys(this._events):[]};var ls="function"==typeof Object.create?function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:function(e,t){e.super_=t;var n=function(){};n.prototype=t.prototype,e.prototype=new n,e.prototype.constructor=e},ds=/%[sdj%]/g;function ps(e){if(!Es(e)){for(var t=[],n=0;n<arguments.length;n++)t.push(fs(arguments[n]));return t.join(" ")}n=1;for(var o=arguments,i=o.length,s=String(e).replace(ds,(function(e){if("%%"===e)return"%";if(n>=i)return e;switch(e){case"%s":return String(o[n++]);case"%d":return Number(o[n++]);case"%j":try{return JSON.stringify(o[n++])}catch(t){return"[Circular]"}default:return e}})),a=o[n];n<i;a=o[++n])Ts(a)||!ks(a)?s+=" "+a:s+=" "+fs(a);return s}function hs(e,t){if(Ss(qo.process))return function(){return hs(e,t).apply(this,arguments)};var n=!1;return function(){return n||(_("error","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2",t),n=!0),e.apply(this,arguments)}}var gs,_s={};function fs(e,t){var n={seen:[],stylize:vs};return arguments.length>=3&&(n.depth=arguments[2]),arguments.length>=4&&(n.colors=arguments[3]),Cs(t)?n.showHidden=t:t&&function(e,t){if(!t||!ks(t))return e;for(var n=Object.keys(t),o=n.length;o--;)e[n[o]]=t[n[o]]}(n,t),Ss(n.showHidden)&&(n.showHidden=!1),Ss(n.depth)&&(n.depth=2),Ss(n.colors)&&(n.colors=!1),Ss(n.customInspect)&&(n.customInspect=!0),n.colors&&(n.stylize=ms),ys(n,e,n.depth)}function ms(e,t){var n=fs.styles[t];return n?"["+fs.colors[n][0]+"m"+e+"["+fs.colors[n][1]+"m":e}function vs(e,t){return e}function ys(e,t,n){if(e.customInspect&&t&&As(t.inspect)&&t.inspect!==fs&&(!t.constructor||t.constructor.prototype!==t)){var o=t.inspect(n,e);return Es(o)||(o=ys(e,o,n)),o}var i=function(e,t){if(Ss(t))return e.stylize("undefined","undefined");if(Es(t)){var n="'"+JSON.stringify(t).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return e.stylize(n,"string")}return"number"==typeof t?e.stylize(""+t,"number"):Cs(t)?e.stylize(""+t,"boolean"):Ts(t)?e.stylize("null","null"):void 0}(e,t);if(i)return i;var s,a=Object.keys(t),r=(s={},a.forEach((function(e,t){s[e]=!0})),s);if(e.showHidden&&(a=Object.getOwnPropertyNames(t)),Ls(t)&&(a.indexOf("message")>=0||a.indexOf("description")>=0))return Is(t);if(0===a.length){if(As(t)){var c=t.name?": "+t.name:"";return e.stylize("[Function"+c+"]","special")}if(Ds(t))return e.stylize(RegExp.prototype.toString.call(t),"regexp");if(Rs(t))return e.stylize(Date.prototype.toString.call(t),"date");if(Ls(t))return Is(t)}var u,l,d="",p=!1,h=["{","}"];return u=t,Array.isArray(u)&&(p=!0,h=["[","]"]),As(t)&&(d=" [Function"+(t.name?": "+t.name:"")+"]"),Ds(t)&&(d=" "+RegExp.prototype.toString.call(t)),Rs(t)&&(d=" "+Date.prototype.toUTCString.call(t)),Ls(t)&&(d=" "+Is(t)),0!==a.length||p&&0!=t.length?n<0?Ds(t)?e.stylize(RegExp.prototype.toString.call(t),"regexp"):e.stylize("[Object]","special"):(e.seen.push(t),l=p?function(e,t,n,o,i){for(var s=[],a=0,r=t.length;a<r;++a)Ns(t,String(a))?s.push(Ms(e,t,n,o,String(a),!0)):s.push("");return i.forEach((function(i){i.match(/^\d+$/)||s.push(Ms(e,t,n,o,i,!0))})),s}(e,t,n,r,a):a.map((function(o){return Ms(e,t,n,r,o,p)})),e.seen.pop(),function(e,t,n){return e.reduce((function(e,t){return t.indexOf("\n"),e+t.replace(/\u001b\[\d\d?m/g,"").length+1}),0)>60?n[0]+(""===t?"":t+"\n ")+" "+e.join(",\n  ")+" "+n[1]:n[0]+t+" "+e.join(", ")+" "+n[1]}(l,d,h)):h[0]+d+h[1]}function Is(e){return"["+Error.prototype.toString.call(e)+"]"}function Ms(e,t,n,o,i,s){var a,r,c;if((c=Object.getOwnPropertyDescriptor(t,i)||{value:t[i]}).get?r=c.set?e.stylize("[Getter/Setter]","special"):e.stylize("[Getter]","special"):c.set&&(r=e.stylize("[Setter]","special")),Ns(o,i)||(a="["+i+"]"),r||(e.seen.indexOf(c.value)<0?(r=Ts(n)?ys(e,c.value,null):ys(e,c.value,n-1)).indexOf("\n")>-1&&(r=s?r.split("\n").map((function(e){return"  "+e})).join("\n").substr(2):"\n"+r.split("\n").map((function(e){return"   "+e})).join("\n")):r=e.stylize("[Circular]","special")),Ss(a)){if(s&&i.match(/^\d+$/))return r;(a=JSON.stringify(""+i)).match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?(a=a.substr(1,a.length-2),a=e.stylize(a,"name")):(a=a.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'"),a=e.stylize(a,"string"))}return a+": "+r}function Cs(e){return"boolean"==typeof e}function Ts(e){return null===e}function Es(e){return"string"==typeof e}function Ss(e){return void 0===e}function Ds(e){return ks(e)&&"[object RegExp]"===Os(e)}function ks(e){return"object"==typeof e&&null!==e}function Rs(e){return ks(e)&&"[object Date]"===Os(e)}function Ls(e){return ks(e)&&("[object Error]"===Os(e)||e instanceof Error)}function As(e){return"function"==typeof e}function Os(e){return Object.prototype.toString.call(e)}function Ns(e,t){return Object.prototype.hasOwnProperty.call(e,t)}function Ps(){this.head=null,this.tail=null,this.length=0}fs.colors={bold:[1,22],italic:[3,23],underline:[4,24],inverse:[7,27],white:[37,39],grey:[90,39],black:[30,39],blue:[34,39],cyan:[36,39],green:[32,39],magenta:[35,39],red:[31,39],yellow:[33,39]},fs.styles={special:"cyan",number:"yellow",boolean:"yellow",undefined:"grey",null:"bold",string:"green",date:"magenta",regexp:"red"},Ps.prototype.push=function(e){var t={data:e,next:null};this.length>0?this.tail.next=t:this.head=t,this.tail=t,++this.length},Ps.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},Ps.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},Ps.prototype.clear=function(){this.head=this.tail=null,this.length=0},Ps.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,n=""+t.data;t=t.next;)n+=e+t.data;return n},Ps.prototype.concat=function(e){if(0===this.length)return ti.alloc(0);if(1===this.length)return this.head.data;for(var t=ti.allocUnsafe(e>>>0),n=this.head,o=0;n;)n.data.copy(t,o),o+=n.data.length,n=n.next;return t};var bs=ti.isEncoding||function(e){switch(e&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function Us(e){switch(this.encoding=(e||"utf8").toLowerCase().replace(/[-_]/,""),function(e){if(e&&!bs(e))throw new Error("Unknown encoding: "+e)}(e),this.encoding){case"utf8":this.surrogateSize=3;break;case"ucs2":case"utf16le":this.surrogateSize=2,this.detectIncompleteChar=ws;break;case"base64":this.surrogateSize=3,this.detectIncompleteChar=Fs;break;default:return void(this.write=Gs)}this.charBuffer=new ti(6),this.charReceived=0,this.charLength=0}function Gs(e){return e.toString(this.encoding)}function ws(e){this.charReceived=e.length%2,this.charLength=this.charReceived?2:0}function Fs(e){this.charReceived=e.length%3,this.charLength=this.charReceived?3:0}Us.prototype.write=function(e){for(var t="";this.charLength;){var n=e.length>=this.charLength-this.charReceived?this.charLength-this.charReceived:e.length;if(e.copy(this.charBuffer,this.charReceived,0,n),this.charReceived+=n,this.charReceived<this.charLength)return"";if(e=e.slice(n,e.length),!((o=(t=this.charBuffer.slice(0,this.charLength).toString(this.encoding)).charCodeAt(t.length-1))>=55296&&o<=56319)){if(this.charReceived=this.charLength=0,0===e.length)return t;break}this.charLength+=this.surrogateSize,t=""}this.detectIncompleteChar(e);var o,i=e.length;if(this.charLength&&(e.copy(this.charBuffer,0,e.length-this.charReceived,i),i-=this.charReceived),i=(t+=e.toString(this.encoding,0,i)).length-1,(o=t.charCodeAt(i))>=55296&&o<=56319){var s=this.surrogateSize;return this.charLength+=s,this.charReceived+=s,this.charBuffer.copy(this.charBuffer,s,0,s),e.copy(this.charBuffer,0,0,s),t.substring(0,i)}return t},Us.prototype.detectIncompleteChar=function(e){for(var t=e.length>=3?3:e.length;t>0;t--){var n=e[e.length-t];if(1==t&&n>>5==6){this.charLength=2;break}if(t<=2&&n>>4==14){this.charLength=3;break}if(t<=3&&n>>3==30){this.charLength=4;break}}this.charReceived=t},Us.prototype.end=function(e){var t="";if(e&&e.length&&(t=this.write(e)),this.charReceived){var n=this.charReceived,o=this.charBuffer,i=this.encoding;t+=o.slice(0,n).toString(i)}return t},qs.ReadableState=Vs;var xs=function(e){return Ss(gs)&&(gs=""),e=e.toUpperCase(),_s[e]||(new RegExp("\\b"+e+"\\b","i").test(gs)?_s[e]=function(){var t=ps.apply(null,arguments);_("error","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","%s %d: %s",e,0,t)}:_s[e]=function(){}),_s[e]}("stream");function Vs(e,t){e=e||{},this.objectMode=!!e.objectMode,t instanceof _a&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var n=e.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=~~this.highWaterMark,this.buffer=new Ps,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.ranOut=!1,this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(this.decoder=new Us(e.encoding),this.encoding=e.encoding)}function qs(e){if(!(this instanceof qs))return new qs(e);this._readableState=new Vs(e,this),this.readable=!0,e&&"function"==typeof e.read&&(this._read=e.read),is.call(this)}function Bs(e,t,n,o,i){var s,a,r,c=(s=t,r=null,Fi(a=n)||"string"==typeof a||null==a||s.objectMode||(r=new TypeError("Invalid non-string/buffer chunk")),r);if(c)e.emit("error",c);else if(null===n)t.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var n=t.decoder.end();n&&n.length&&(t.buffer.push(n),t.length+=t.objectMode?1:n.length)}t.ended=!0,Ks(e)}}(e,t);else if(t.objectMode||n&&n.length>0)if(t.ended&&!i){var u=new Error("stream.push() after EOF");e.emit("error",u)}else if(t.endEmitted&&i){var l=new Error("stream.unshift() after end event");e.emit("error",l)}else{var d;!t.decoder||i||o||(n=t.decoder.write(n),d=!t.objectMode&&0===n.length),i||(t.reading=!1),d||(t.flowing&&0===t.length&&!t.sync?(e.emit("data",n),e.read(0)):(t.length+=t.objectMode?1:n.length,i?t.buffer.unshift(n):t.buffer.push(n),t.needReadable&&Ks(e))),function(e,t){t.readingMore||(t.readingMore=!0,es(zs,e,t))}(e,t)}else i||(t.reading=!1);return function(e){return!e.ended&&(e.needReadable||e.length<e.highWaterMark||0===e.length)}(t)}ls(qs,is),qs.prototype.push=function(e,t){var n=this._readableState;return n.objectMode||"string"!=typeof e||(t=t||n.defaultEncoding)!==n.encoding&&(e=ti.from(e,t),t=""),Bs(this,n,e,t,!1)},qs.prototype.unshift=function(e){return Bs(this,this._readableState,e,"",!0)},qs.prototype.isPaused=function(){return!1===this._readableState.flowing},qs.prototype.setEncoding=function(e){return this._readableState.decoder=new Us(e),this._readableState.encoding=e,this};var Hs=8388608;function js(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=((n=e)>=Hs?n=Hs:(n--,n|=n>>>1,n|=n>>>2,n|=n>>>4,n|=n>>>8,n|=n>>>16,n++),n)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var n}function Ks(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(xs("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?es(Ys,e):Ys(e))}function Ys(e){xs("emit readable"),e.emit("readable"),$s(e)}function zs(e,t){for(var n=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(xs("maybeReadMore read 0"),e.read(0),n!==t.length);)n=t.length;t.readingMore=!1}function Ws(e){xs("readable nexttick read 0"),e.read(0)}function Js(e,t){t.reading||(xs("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),$s(e),t.flowing&&!t.reading&&e.read(0)}function $s(e){var t=e._readableState;for(xs("flow",t.flowing);t.flowing&&null!==e.read(););}function Xs(e,t){return 0===t.length?null:(t.objectMode?a=t.buffer.shift():!e||e>=t.length?(a=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):(n=e,o=t.buffer,i=t.decoder,n<o.head.data.length?(s=o.head.data.slice(0,n),o.head.data=o.head.data.slice(n)):s=n===o.head.data.length?o.shift():i?function(e,t){var n=t.head,o=1,i=n.data;for(e-=i.length;n=n.next;){var s=n.data,a=e>s.length?s.length:e;if(a===s.length?i+=s:i+=s.slice(0,e),0==(e-=a)){a===s.length?(++o,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n,n.data=s.slice(a));break}++o}return t.length-=o,i}(n,o):function(e,t){var n=ti.allocUnsafe(e),o=t.head,i=1;for(o.data.copy(n),e-=o.data.length;o=o.next;){var s=o.data,a=e>s.length?s.length:e;if(s.copy(n,n.length-e,0,a),0==(e-=a)){a===s.length?(++i,o.next?t.head=o.next:t.head=t.tail=null):(t.head=o,o.data=s.slice(a));break}++i}return t.length-=i,n}(n,o),a=s),a);var n,o,i,s,a}function Zs(e){var t=e._readableState;if(t.length>0)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,es(Qs,t,e))}function Qs(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function ea(e,t){for(var n=0,o=e.length;n<o;n++)if(e[n]===t)return n;return-1}function ta(){}function na(e,t,n){this.chunk=e,this.encoding=t,this.callback=n,this.next=null}function oa(e,t){Object.defineProperty(this,"buffer",{get:hs((function(){return this.getBuffer()}),"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.")}),e=e||{},this.objectMode=!!e.objectMode,t instanceof _a&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var n=e.highWaterMark,o=this.objectMode?16:16384;this.highWaterMark=n||0===n?n:o,this.highWaterMark=~~this.highWaterMark,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var i=!1===e.decodeStrings;this.decodeStrings=!i,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var n,o=e._writableState,i=o.sync,s=o.writecb;if((n=o).writing=!1,n.writecb=null,n.length-=n.writelen,n.writelen=0,t)!function(e,t,n,o,i){--t.pendingcb,n?es(i,o):i(o),e._writableState.errorEmitted=!0,e.emit("error",o)}(e,o,i,t,s);else{var a=ca(o);a||o.corked||o.bufferProcessing||!o.bufferedRequest||ra(e,o),i?es(aa,e,o,a,s):aa(e,o,a,s)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new da(this)}function ia(e){if(!(this instanceof ia||this instanceof _a))return new ia(e);this._writableState=new oa(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev)),is.call(this)}function sa(e,t,n,o,i,s,a){t.writelen=o,t.writecb=a,t.writing=!0,t.sync=!0,n?e._writev(i,t.onwrite):e._write(i,s,t.onwrite),t.sync=!1}function aa(e,t,n,o){var i,s;n||(i=e,0===(s=t).length&&s.needDrain&&(s.needDrain=!1,i.emit("drain"))),t.pendingcb--,o(),la(e,t)}function ra(e,t){t.bufferProcessing=!0;var n=t.bufferedRequest;if(e._writev&&n&&n.next){var o=t.bufferedRequestCount,i=new Array(o),s=t.corkedRequestsFree;s.entry=n;for(var a=0;n;)i[a]=n,n=n.next,a+=1;sa(e,t,!0,t.length,i,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new da(t)}else{for(;n;){var r=n.chunk,c=n.encoding,u=n.callback;if(sa(e,t,!1,t.objectMode?1:r.length,r,c,u),n=n.next,t.writing)break}null===n&&(t.lastBufferedRequest=null)}t.bufferedRequestCount=0,t.bufferedRequest=n,t.bufferProcessing=!1}function ca(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function ua(e,t){t.prefinished||(t.prefinished=!0,e.emit("prefinish"))}function la(e,t){var n=ca(t);return n&&(0===t.pendingcb?(ua(e,t),t.finished=!0,e.emit("finish")):ua(e,t)),n}function da(e){var t=this;this.next=null,this.entry=null,this.finish=function(n){var o=t.entry;for(t.entry=null;o;){var i=o.callback;e.pendingcb--,i(n),o=o.next}e.corkedRequestsFree?e.corkedRequestsFree.next=t:e.corkedRequestsFree=t}}qs.prototype.read=function(e){xs("read",e),e=parseInt(e,10);var t=this._readableState,n=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return xs("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?Zs(this):Ks(this),null;if(0===(e=js(e,t))&&t.ended)return 0===t.length&&Zs(this),null;var o,i=t.needReadable;return xs("need readable",i),(0===t.length||t.length-e<t.highWaterMark)&&xs("length less than watermark",i=!0),t.ended||t.reading?xs("reading or ended",i=!1):i&&(xs("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=js(n,t))),null===(o=e>0?Xs(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),n!==e&&t.ended&&Zs(this)),null!==o&&this.emit("data",o),o},qs.prototype._read=function(e){this.emit("error",new Error("not implemented"))},qs.prototype.pipe=function(e,t){var n=this,o=this._readableState;switch(o.pipesCount){case 0:o.pipes=e;break;case 1:o.pipes=[o.pipes,e];break;default:o.pipes.push(e)}o.pipesCount+=1,xs("pipe count=%d opts=%j",o.pipesCount,t);var i=t&&!1===t.end?u:a;function s(e){xs("onunpipe"),e===n&&u()}function a(){xs("onend"),e.end()}o.endEmitted?es(i):n.once("end",i),e.on("unpipe",s);var r=function(e){return function(){var t=e._readableState;xs("pipeOnDrain",t.awaitDrain),t.awaitDrain&&t.awaitDrain--,0===t.awaitDrain&&e.listeners("data").length&&(t.flowing=!0,$s(e))}}(n);e.on("drain",r);var c=!1;function u(){xs("cleanup"),e.removeListener("close",h),e.removeListener("finish",g),e.removeListener("drain",r),e.removeListener("error",p),e.removeListener("unpipe",s),n.removeListener("end",a),n.removeListener("end",u),n.removeListener("data",d),c=!0,!o.awaitDrain||e._writableState&&!e._writableState.needDrain||r()}var l=!1;function d(t){xs("ondata"),l=!1,!1!==e.write(t)||l||((1===o.pipesCount&&o.pipes===e||o.pipesCount>1&&-1!==ea(o.pipes,e))&&!c&&(xs("false write response, pause",n._readableState.awaitDrain),n._readableState.awaitDrain++,l=!0),n.pause())}function p(t){xs("onerror",t),_(),e.removeListener("error",p),0===e.listeners("error").length&&e.emit("error",t)}function h(){e.removeListener("finish",g),_()}function g(){xs("onfinish"),e.removeListener("close",h),_()}function _(){xs("unpipe"),n.unpipe(e)}return n.on("data",d),function(e,t,n){if("function"==typeof e.prependListener)return e.prependListener(t,n);e._events&&e._events[t]?Array.isArray(e._events[t])?e._events[t].unshift(n):e._events[t]=[n,e._events[t]]:e.on(t,n)}(e,"error",p),e.once("close",h),e.once("finish",g),e.emit("pipe",n),o.flowing||(xs("pipe resume"),n.resume()),e},qs.prototype.unpipe=function(e){var t=this._readableState;if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this)),this;if(!e){var n=t.pipes,o=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var i=0;i<o;i++)n[i].emit("unpipe",this);return this}var s=ea(t.pipes,e);return-1===s||(t.pipes.splice(s,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this)),this},qs.prototype.on=function(e,t){var n=is.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var o=this._readableState;o.endEmitted||o.readableListening||(o.readableListening=o.needReadable=!0,o.emittedReadable=!1,o.reading?o.length&&Ks(this):es(Ws,this))}return n},qs.prototype.addListener=qs.prototype.on,qs.prototype.resume=function(){var e,t,n=this._readableState;return n.flowing||(xs("resume"),n.flowing=!0,e=this,(t=n).resumeScheduled||(t.resumeScheduled=!0,es(Js,e,t))),this},qs.prototype.pause=function(){return xs("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(xs("pause"),this._readableState.flowing=!1,this.emit("pause")),this},qs.prototype.wrap=function(e){var t=this._readableState,n=!1,o=this;for(var i in e.on("end",(function(){if(xs("wrapped end"),t.decoder&&!t.ended){var e=t.decoder.end();e&&e.length&&o.push(e)}o.push(null)})),e.on("data",(function(i){xs("wrapped data"),t.decoder&&(i=t.decoder.write(i)),t.objectMode&&null==i||(t.objectMode||i&&i.length)&&(o.push(i)||(n=!0,e.pause()))})),e)void 0===this[i]&&"function"==typeof e[i]&&(this[i]=function(t){return function(){return e[t].apply(e,arguments)}}(i));return function(e,t){for(var n=0,o=e.length;n<o;n++)t(e[n])}(["error","close","destroy","pause","resume"],(function(t){e.on(t,o.emit.bind(o,t))})),o._read=function(t){xs("wrapped _read",t),n&&(n=!1,e.resume())},o},qs._fromList=Xs,ia.WritableState=oa,ls(ia,is),oa.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},ia.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},ia.prototype.write=function(e,t,n){var o,i,s,a=this._writableState,r=!1;return"function"==typeof t&&(n=t,t=null),ti.isBuffer(e)?t="buffer":t||(t=a.defaultEncoding),"function"!=typeof n&&(n=ta),a.ended?(o=this,i=n,s=new Error("write after end"),o.emit("error",s),es(i,s)):function(e,t,n,o){var i=!0,s=!1;return null===n?s=new TypeError("May not write null values to stream"):ti.isBuffer(n)||"string"==typeof n||void 0===n||t.objectMode||(s=new TypeError("Invalid non-string/buffer chunk")),s&&(e.emit("error",s),es(o,s),i=!1),i}(this,a,e,n)&&(a.pendingcb++,r=function(e,t,n,o,i){var s,a,r;a=n,r=o,(s=t).objectMode||!1===s.decodeStrings||"string"!=typeof a||(a=ti.from(a,r)),n=a,ti.isBuffer(n)&&(o="buffer");var c=t.objectMode?1:n.length;t.length+=c;var u=t.length<t.highWaterMark;if(u||(t.needDrain=!0),t.writing||t.corked){var l=t.lastBufferedRequest;t.lastBufferedRequest=new na(n,o,i),l?l.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else sa(e,t,!1,c,n,o,i);return u}(this,a,e,t,n)),r},ia.prototype.cork=function(){this._writableState.corked++},ia.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||ra(this,e))},ia.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())>-1))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},ia.prototype._write=function(e,t,n){n(new Error("not implemented"))},ia.prototype._writev=null,ia.prototype.end=function(e,t,n){var o,i,s,a=this._writableState;"function"==typeof e?(n=e,e=null,t=null):"function"==typeof t&&(n=t,t=null),null!=e&&this.write(e,t),a.corked&&(a.corked=1,this.uncork()),a.ending||a.finished||(o=this,s=n,(i=a).ending=!0,la(o,i),s&&(i.finished?es(s):o.once("finish",s)),i.ended=!0,o.writable=!1)},ls(_a,qs);for(var pa=Object.keys(ia.prototype),ha=0;ha<pa.length;ha++){var ga=pa[ha];_a.prototype[ga]||(_a.prototype[ga]=ia.prototype[ga])}function _a(e){if(!(this instanceof _a))return new _a(e);qs.call(this,e),ia.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",fa)}function fa(){this.allowHalfOpen||this._writableState.ended||es(ma,this)}function ma(e){e.end()}function va(e){this.afterTransform=function(t,n){return function(e,t,n){var o=e._transformState;o.transforming=!1;var i=o.writecb;if(!i)return e.emit("error",new Error("no writecb in Transform class"));o.writechunk=null,o.writecb=null,null!=n&&e.push(n),i(t);var s=e._readableState;s.reading=!1,(s.needReadable||s.length<s.highWaterMark)&&e._read(s.highWaterMark)}(e,t,n)},this.needTransform=!1,this.transforming=!1,this.writecb=null,this.writechunk=null,this.writeencoding=null}function ya(e){if(!(this instanceof ya))return new ya(e);_a.call(this,e),this._transformState=new va(this);var t=this;this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.once("prefinish",(function(){"function"==typeof this._flush?this._flush((function(e){Ia(t,e)})):Ia(t)}))}function Ia(e,t){if(t)return e.emit("error",t);var n=e._writableState,o=e._transformState;if(n.length)throw new Error("Calling transform done when ws.length != 0");if(o.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}function Ma(e){if(!(this instanceof Ma))return new Ma(e);ya.call(this,e)}function Ca(){is.call(this)}ls(ya,_a),ya.prototype.push=function(e,t){return this._transformState.needTransform=!1,_a.prototype.push.call(this,e,t)},ya.prototype._transform=function(e,t,n){throw new Error("Not implemented")},ya.prototype._write=function(e,t,n){var o=this._transformState;if(o.writecb=n,o.writechunk=e,o.writeencoding=t,!o.transforming){var i=this._readableState;(o.needTransform||i.needReadable||i.length<i.highWaterMark)&&this._read(i.highWaterMark)}},ya.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},ls(Ma,ya),Ma.prototype._transform=function(e,t,n){n(null,e)},ls(Ca,is),Ca.Readable=qs,Ca.Writable=ia,Ca.Duplex=_a,Ca.Transform=ya,Ca.PassThrough=Ma,Ca.Stream=Ca,Ca.prototype.pipe=function(e,t){var n=this;function o(t){e.writable&&!1===e.write(t)&&n.pause&&n.pause()}function i(){n.readable&&n.resume&&n.resume()}n.on("data",o),e.on("drain",i),e._isStdio||t&&!1===t.end||(n.on("end",a),n.on("close",r));var s=!1;function a(){s||(s=!0,e.end())}function r(){s||(s=!0,"function"==typeof e.destroy&&e.destroy())}function c(e){if(u(),0===is.listenerCount(this,"error"))throw e}function u(){n.removeListener("data",o),e.removeListener("drain",i),n.removeListener("end",a),n.removeListener("close",r),n.removeListener("error",c),e.removeListener("error",c),n.removeListener("end",u),n.removeListener("close",u),e.removeListener("close",u)}return n.on("error",c),e.on("error",c),n.on("end",u),n.on("close",u),e.on("close",u),e.emit("pipe",n),e};var Ta={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"};function Ea(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Sa(e,t,n,o,i){if(t.subarray&&e.subarray)e.set(t.subarray(n,n+o),i);else for(var s=0;s<o;s++)e[i+s]=t[n+s]}var Da=Uint8Array,ka=Uint16Array,Ra=Int32Array;function La(e){for(var t=e.length;--t>=0;)e[t]=0}var Aa=256,Oa=286,Na=30,Pa=15,ba=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ua=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],Ga=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],wa=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Fa=new Array(576);La(Fa);var xa=new Array(60);La(xa);var Va=new Array(512);La(Va);var qa=new Array(256);La(qa);var Ba=new Array(29);La(Ba);var Ha,ja,Ka,Ya=new Array(Na);function za(e,t,n,o,i){this.static_tree=e,this.extra_bits=t,this.extra_base=n,this.elems=o,this.max_length=i,this.has_stree=e&&e.length}function Wa(e,t){this.dyn_tree=e,this.max_code=0,this.stat_desc=t}function Ja(e){return e<256?Va[e]:Va[256+(e>>>7)]}function $a(e,t){e.pending_buf[e.pending++]=255&t,e.pending_buf[e.pending++]=t>>>8&255}function Xa(e,t,n){e.bi_valid>16-n?(e.bi_buf|=t<<e.bi_valid&65535,$a(e,e.bi_buf),e.bi_buf=t>>16-e.bi_valid,e.bi_valid+=n-16):(e.bi_buf|=t<<e.bi_valid&65535,e.bi_valid+=n)}function Za(e,t,n){Xa(e,n[2*t],n[2*t+1])}function Qa(e,t){var n=0;do{n|=1&e,e>>>=1,n<<=1}while(--t>0);return n>>>1}function er(e,t,n){var o,i,s=new Array(16),a=0;for(o=1;o<=Pa;o++)s[o]=a=a+n[o-1]<<1;for(i=0;i<=t;i++){var r=e[2*i+1];0!==r&&(e[2*i]=Qa(s[r]++,r))}}function tr(e){var t;for(t=0;t<Oa;t++)e.dyn_ltree[2*t]=0;for(t=0;t<Na;t++)e.dyn_dtree[2*t]=0;for(t=0;t<19;t++)e.bl_tree[2*t]=0;e.dyn_ltree[512]=1,e.opt_len=e.static_len=0,e.last_lit=e.matches=0}function nr(e){e.bi_valid>8?$a(e,e.bi_buf):e.bi_valid>0&&(e.pending_buf[e.pending++]=e.bi_buf),e.bi_buf=0,e.bi_valid=0}function or(e,t,n,o){var i=2*t,s=2*n;return e[i]<e[s]||e[i]===e[s]&&o[t]<=o[n]}function ir(e,t,n){for(var o=e.heap[n],i=n<<1;i<=e.heap_len&&(i<e.heap_len&&or(t,e.heap[i+1],e.heap[i],e.depth)&&i++,!or(t,o,e.heap[i],e.depth));)e.heap[n]=e.heap[i],n=i,i<<=1;e.heap[n]=o}function sr(e,t,n){var o,i,s,a,r=0;if(0!==e.last_lit)do{o=e.pending_buf[e.d_buf+2*r]<<8|e.pending_buf[e.d_buf+2*r+1],i=e.pending_buf[e.l_buf+r],r++,0===o?Za(e,i,t):(Za(e,(s=qa[i])+Aa+1,t),0!==(a=ba[s])&&Xa(e,i-=Ba[s],a),Za(e,s=Ja(--o),n),0!==(a=Ua[s])&&Xa(e,o-=Ya[s],a))}while(r<e.last_lit);Za(e,256,t)}function ar(e,t){var n,o,i,s=t.dyn_tree,a=t.stat_desc.static_tree,r=t.stat_desc.has_stree,c=t.stat_desc.elems,u=-1;for(e.heap_len=0,e.heap_max=573,n=0;n<c;n++)0!==s[2*n]?(e.heap[++e.heap_len]=u=n,e.depth[n]=0):s[2*n+1]=0;for(;e.heap_len<2;)s[2*(i=e.heap[++e.heap_len]=u<2?++u:0)]=1,e.depth[i]=0,e.opt_len--,r&&(e.static_len-=a[2*i+1]);for(t.max_code=u,n=e.heap_len>>1;n>=1;n--)ir(e,s,n);i=c;do{n=e.heap[1],e.heap[1]=e.heap[e.heap_len--],ir(e,s,1),o=e.heap[1],e.heap[--e.heap_max]=n,e.heap[--e.heap_max]=o,s[2*i]=s[2*n]+s[2*o],e.depth[i]=(e.depth[n]>=e.depth[o]?e.depth[n]:e.depth[o])+1,s[2*n+1]=s[2*o+1]=i,e.heap[1]=i++,ir(e,s,1)}while(e.heap_len>=2);e.heap[--e.heap_max]=e.heap[1],function(e,t){var n,o,i,s,a,r,c=t.dyn_tree,u=t.max_code,l=t.stat_desc.static_tree,d=t.stat_desc.has_stree,p=t.stat_desc.extra_bits,h=t.stat_desc.extra_base,g=t.stat_desc.max_length,_=0;for(s=0;s<=Pa;s++)e.bl_count[s]=0;for(c[2*e.heap[e.heap_max]+1]=0,n=e.heap_max+1;n<573;n++)(s=c[2*c[2*(o=e.heap[n])+1]+1]+1)>g&&(s=g,_++),c[2*o+1]=s,o>u||(e.bl_count[s]++,a=0,o>=h&&(a=p[o-h]),r=c[2*o],e.opt_len+=r*(s+a),d&&(e.static_len+=r*(l[2*o+1]+a)));if(0!==_){do{for(s=g-1;0===e.bl_count[s];)s--;e.bl_count[s]--,e.bl_count[s+1]+=2,e.bl_count[g]--,_-=2}while(_>0);for(s=g;0!==s;s--)for(o=e.bl_count[s];0!==o;)(i=e.heap[--n])>u||(c[2*i+1]!==s&&(e.opt_len+=(s-c[2*i+1])*c[2*i],c[2*i+1]=s),o--)}}(e,t),er(s,u,e.bl_count)}function rr(e,t,n){var o,i,s=-1,a=t[1],r=0,c=7,u=4;for(0===a&&(c=138,u=3),t[2*(n+1)+1]=65535,o=0;o<=n;o++)i=a,a=t[2*(o+1)+1],++r<c&&i===a||(r<u?e.bl_tree[2*i]+=r:0!==i?(i!==s&&e.bl_tree[2*i]++,e.bl_tree[32]++):r<=10?e.bl_tree[34]++:e.bl_tree[36]++,r=0,s=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4))}function cr(e,t,n){var o,i,s=-1,a=t[1],r=0,c=7,u=4;for(0===a&&(c=138,u=3),o=0;o<=n;o++)if(i=a,a=t[2*(o+1)+1],!(++r<c&&i===a)){if(r<u)do{Za(e,i,e.bl_tree)}while(0!=--r);else 0!==i?(i!==s&&(Za(e,i,e.bl_tree),r--),Za(e,16,e.bl_tree),Xa(e,r-3,2)):r<=10?(Za(e,17,e.bl_tree),Xa(e,r-3,3)):(Za(e,18,e.bl_tree),Xa(e,r-11,7));r=0,s=i,0===a?(c=138,u=3):i===a?(c=6,u=3):(c=7,u=4)}}La(Ya);var ur=!1;function lr(e,t,n,o){var i,s,a;Xa(e,0+(o?1:0),3),s=t,a=n,nr(i=e),$a(i,a),$a(i,~a),Sa(i.pending_buf,i.window,s,a,i.pending),i.pending+=a}function dr(e,t,n){return e.pending_buf[e.d_buf+2*e.last_lit]=t>>>8&255,e.pending_buf[e.d_buf+2*e.last_lit+1]=255&t,e.pending_buf[e.l_buf+e.last_lit]=255&n,e.last_lit++,0===t?e.dyn_ltree[2*n]++:(e.matches++,t--,e.dyn_ltree[2*(qa[n]+Aa+1)]++,e.dyn_dtree[2*Ja(t)]++),e.last_lit===e.lit_bufsize-1}function pr(e,t,n,o){for(var i=65535&e,s=e>>>16&65535,a=0;0!==n;){n-=a=n>2e3?2e3:n;do{s=s+(i=i+t[o++]|0)|0}while(--a);i%=65521,s%=65521}return i|s<<16}var hr=function(){for(var e,t=[],n=0;n<256;n++){e=n;for(var o=0;o<8;o++)e=1&e?3988292384^e>>>1:e>>>1;t[n]=e}return t}();function gr(e,t,n,o){var i=hr,s=o+n;e^=-1;for(var a=o;a<s;a++)e=e>>>8^i[255&(e^t[a])];return~e}var _r,fr=-2,mr=258,vr=262,yr=103,Ir=113,Mr=666;function Cr(e,t){return e.msg=Ta[t],t}function Tr(e){return(e<<1)-(e>4?9:0)}function Er(e){for(var t=e.length;--t>=0;)e[t]=0}function Sr(e){var t=e.state,n=t.pending;n>e.avail_out&&(n=e.avail_out),0!==n&&(Sa(e.output,t.pending_buf,t.pending_out,n,e.next_out),e.next_out+=n,t.pending_out+=n,e.total_out+=n,e.avail_out-=n,t.pending-=n,0===t.pending&&(t.pending_out=0))}function Dr(e,t){(function(e,t,n,o){var i,s,a=0;e.level>0?(2===e.strm.data_type&&(e.strm.data_type=function(e){var t,n=4093624447;for(t=0;t<=31;t++,n>>>=1)if(1&n&&0!==e.dyn_ltree[2*t])return 0;if(0!==e.dyn_ltree[18]||0!==e.dyn_ltree[20]||0!==e.dyn_ltree[26])return 1;for(t=32;t<Aa;t++)if(0!==e.dyn_ltree[2*t])return 1;return 0}(e)),ar(e,e.l_desc),ar(e,e.d_desc),a=function(e){var t;for(rr(e,e.dyn_ltree,e.l_desc.max_code),rr(e,e.dyn_dtree,e.d_desc.max_code),ar(e,e.bl_desc),t=18;t>=3&&0===e.bl_tree[2*wa[t]+1];t--);return e.opt_len+=3*(t+1)+5+5+4,t}(e),i=e.opt_len+3+7>>>3,(s=e.static_len+3+7>>>3)<=i&&(i=s)):i=s=n+5,n+4<=i&&-1!==t?lr(e,t,n,o):4===e.strategy||s===i?(Xa(e,2+(o?1:0),3),sr(e,Fa,xa)):(Xa(e,4+(o?1:0),3),function(e,t,n,o){var i;for(Xa(e,t-257,5),Xa(e,n-1,5),Xa(e,o-4,4),i=0;i<o;i++)Xa(e,e.bl_tree[2*wa[i]+1],3);cr(e,e.dyn_ltree,t-1),cr(e,e.dyn_dtree,n-1)}(e,e.l_desc.max_code+1,e.d_desc.max_code+1,a+1),sr(e,e.dyn_ltree,e.dyn_dtree)),tr(e),o&&nr(e)})(e,e.block_start>=0?e.block_start:-1,e.strstart-e.block_start,t),e.block_start=e.strstart,Sr(e.strm)}function kr(e,t){e.pending_buf[e.pending++]=t}function Rr(e,t){e.pending_buf[e.pending++]=t>>>8&255,e.pending_buf[e.pending++]=255&t}function Lr(e,t){var n,o,i=e.max_chain_length,s=e.strstart,a=e.prev_length,r=e.nice_match,c=e.strstart>e.w_size-vr?e.strstart-(e.w_size-vr):0,u=e.window,l=e.w_mask,d=e.prev,p=e.strstart+mr,h=u[s+a-1],g=u[s+a];e.prev_length>=e.good_match&&(i>>=2),r>e.lookahead&&(r=e.lookahead);do{if(u[(n=t)+a]===g&&u[n+a-1]===h&&u[n]===u[s]&&u[++n]===u[s+1]){s+=2,n++;do{}while(u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&u[++s]===u[++n]&&s<p);if(o=mr-(p-s),s=p-mr,o>a){if(e.match_start=t,a=o,o>=r)break;h=u[s+a-1],g=u[s+a]}}}while((t=d[t&l])>c&&0!=--i);return a<=e.lookahead?a:e.lookahead}function Ar(e){var t,n,o,i,s,a,r,c,u,l,d=e.w_size;do{if(i=e.window_size-e.lookahead-e.strstart,e.strstart>=d+(d-vr)){Sa(e.window,e.window,d,d,0),e.match_start-=d,e.strstart-=d,e.block_start-=d,t=n=e.hash_size;do{o=e.head[--t],e.head[t]=o>=d?o-d:0}while(--n);t=n=d;do{o=e.prev[--t],e.prev[t]=o>=d?o-d:0}while(--n);i+=d}if(0===e.strm.avail_in)break;if(a=e.strm,r=e.window,c=e.strstart+e.lookahead,u=i,l=void 0,(l=a.avail_in)>u&&(l=u),n=0===l?0:(a.avail_in-=l,Sa(r,a.input,a.next_in,l,c),1===a.state.wrap?a.adler=pr(a.adler,r,l,c):2===a.state.wrap&&(a.adler=gr(a.adler,r,l,c)),a.next_in+=l,a.total_in+=l,l),e.lookahead+=n,e.lookahead+e.insert>=3)for(s=e.strstart-e.insert,e.ins_h=e.window[s],e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+1])&e.hash_mask;e.insert&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[s+3-1])&e.hash_mask,e.prev[s&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=s,s++,e.insert--,!(e.lookahead+e.insert<3)););}while(e.lookahead<vr&&0!==e.strm.avail_in)}function Or(e,t){for(var n,o;;){if(e.lookahead<vr){if(Ar(e),e.lookahead<vr&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),0!==n&&e.strstart-n<=e.w_size-vr&&(e.match_length=Lr(e,n)),e.match_length>=3)if(o=dr(e,e.strstart-e.match_start,e.match_length-3),e.lookahead-=e.match_length,e.match_length<=e.max_lazy_match&&e.lookahead>=3){e.match_length--;do{e.strstart++,e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart}while(0!=--e.match_length);e.strstart++}else e.strstart+=e.match_length,e.match_length=0,e.ins_h=e.window[e.strstart],e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+1])&e.hash_mask;else o=dr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++;if(o&&(Dr(e,!1),0===e.strm.avail_out))return 1}return e.insert=e.strstart<2?e.strstart:2,4===t?(Dr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Dr(e,!1),0===e.strm.avail_out)?1:2}function Nr(e,t){for(var n,o,i;;){if(e.lookahead<vr){if(Ar(e),e.lookahead<vr&&0===t)return 1;if(0===e.lookahead)break}if(n=0,e.lookahead>=3&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart),e.prev_length=e.match_length,e.prev_match=e.match_start,e.match_length=2,0!==n&&e.prev_length<e.max_lazy_match&&e.strstart-n<=e.w_size-vr&&(e.match_length=Lr(e,n),e.match_length<=5&&(1===e.strategy||3===e.match_length&&e.strstart-e.match_start>4096)&&(e.match_length=2)),e.prev_length>=3&&e.match_length<=e.prev_length){i=e.strstart+e.lookahead-3,o=dr(e,e.strstart-1-e.prev_match,e.prev_length-3),e.lookahead-=e.prev_length-1,e.prev_length-=2;do{++e.strstart<=i&&(e.ins_h=(e.ins_h<<e.hash_shift^e.window[e.strstart+3-1])&e.hash_mask,n=e.prev[e.strstart&e.w_mask]=e.head[e.ins_h],e.head[e.ins_h]=e.strstart)}while(0!=--e.prev_length);if(e.match_available=0,e.match_length=2,e.strstart++,o&&(Dr(e,!1),0===e.strm.avail_out))return 1}else if(e.match_available){if((o=dr(e,0,e.window[e.strstart-1]))&&Dr(e,!1),e.strstart++,e.lookahead--,0===e.strm.avail_out)return 1}else e.match_available=1,e.strstart++,e.lookahead--}return e.match_available&&(o=dr(e,0,e.window[e.strstart-1]),e.match_available=0),e.insert=e.strstart<2?e.strstart:2,4===t?(Dr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Dr(e,!1),0===e.strm.avail_out)?1:2}function Pr(e,t,n,o,i){this.good_length=e,this.max_lazy=t,this.nice_length=n,this.max_chain=o,this.func=i}function br(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=8,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new ka(1146),this.dyn_dtree=new ka(122),this.bl_tree=new ka(78),Er(this.dyn_ltree),Er(this.dyn_dtree),Er(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new ka(16),this.heap=new ka(573),Er(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new ka(573),Er(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Ur(e){var t,n,o,i=(n=e)&&n.state?(n.total_in=n.total_out=0,n.data_type=2,(o=n.state).pending=0,o.pending_out=0,o.wrap<0&&(o.wrap=-o.wrap),o.status=o.wrap?42:Ir,n.adler=2===o.wrap?0:1,o.last_flush=0,function(e){ur||(function(){var e,t,n,o,i,s=new Array(16);for(n=0,o=0;o<28;o++)for(Ba[o]=n,e=0;e<1<<ba[o];e++)qa[n++]=o;for(qa[n-1]=o,i=0,o=0;o<16;o++)for(Ya[o]=i,e=0;e<1<<Ua[o];e++)Va[i++]=o;for(i>>=7;o<Na;o++)for(Ya[o]=i<<7,e=0;e<1<<Ua[o]-7;e++)Va[256+i++]=o;for(t=0;t<=Pa;t++)s[t]=0;for(e=0;e<=143;)Fa[2*e+1]=8,e++,s[8]++;for(;e<=255;)Fa[2*e+1]=9,e++,s[9]++;for(;e<=279;)Fa[2*e+1]=7,e++,s[7]++;for(;e<=287;)Fa[2*e+1]=8,e++,s[8]++;for(er(Fa,287,s),e=0;e<Na;e++)xa[2*e+1]=5,xa[2*e]=Qa(e,5);Ha=new za(Fa,ba,257,Oa,Pa),ja=new za(xa,Ua,0,Na,Pa),Ka=new za(new Array(0),Ga,0,19,7)}(),ur=!0),e.l_desc=new Wa(e.dyn_ltree,Ha),e.d_desc=new Wa(e.dyn_dtree,ja),e.bl_desc=new Wa(e.bl_tree,Ka),e.bi_buf=0,e.bi_valid=0,tr(e)}(o),0):Cr(n,fr);return 0===i&&((t=e.state).window_size=2*t.w_size,Er(t.head),t.max_lazy_match=_r[t.level].max_lazy,t.good_match=_r[t.level].good_length,t.nice_match=_r[t.level].nice_length,t.max_chain_length=_r[t.level].max_chain,t.strstart=0,t.block_start=0,t.lookahead=0,t.insert=0,t.match_length=t.prev_length=2,t.match_available=0,t.ins_h=0),i}function Gr(e,t){var n,o,i,s;if(!e||!e.state||t>5||t<0)return e?Cr(e,fr):fr;if(o=e.state,!e.output||!e.input&&0!==e.avail_in||o.status===Mr&&4!==t)return Cr(e,0===e.avail_out?-5:fr);if(o.strm=e,n=o.last_flush,o.last_flush=t,42===o.status)if(2===o.wrap)e.adler=0,kr(o,31),kr(o,139),kr(o,8),o.gzhead?(kr(o,(o.gzhead.text?1:0)+(o.gzhead.hcrc?2:0)+(o.gzhead.extra?4:0)+(o.gzhead.name?8:0)+(o.gzhead.comment?16:0)),kr(o,255&o.gzhead.time),kr(o,o.gzhead.time>>8&255),kr(o,o.gzhead.time>>16&255),kr(o,o.gzhead.time>>24&255),kr(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),kr(o,255&o.gzhead.os),o.gzhead.extra&&o.gzhead.extra.length&&(kr(o,255&o.gzhead.extra.length),kr(o,o.gzhead.extra.length>>8&255)),o.gzhead.hcrc&&(e.adler=gr(e.adler,o.pending_buf,o.pending,0)),o.gzindex=0,o.status=69):(kr(o,0),kr(o,0),kr(o,0),kr(o,0),kr(o,0),kr(o,9===o.level?2:o.strategy>=2||o.level<2?4:0),kr(o,3),o.status=Ir);else{var a=8+(o.w_bits-8<<4)<<8;a|=(o.strategy>=2||o.level<2?0:o.level<6?1:6===o.level?2:3)<<6,0!==o.strstart&&(a|=32),a+=31-a%31,o.status=Ir,Rr(o,a),0!==o.strstart&&(Rr(o,e.adler>>>16),Rr(o,65535&e.adler)),e.adler=1}if(69===o.status)if(o.gzhead.extra){for(i=o.pending;o.gzindex<(65535&o.gzhead.extra.length)&&(o.pending!==o.pending_buf_size||(o.gzhead.hcrc&&o.pending>i&&(e.adler=gr(e.adler,o.pending_buf,o.pending-i,i)),Sr(e),i=o.pending,o.pending!==o.pending_buf_size));)kr(o,255&o.gzhead.extra[o.gzindex]),o.gzindex++;o.gzhead.hcrc&&o.pending>i&&(e.adler=gr(e.adler,o.pending_buf,o.pending-i,i)),o.gzindex===o.gzhead.extra.length&&(o.gzindex=0,o.status=73)}else o.status=73;if(73===o.status)if(o.gzhead.name){i=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>i&&(e.adler=gr(e.adler,o.pending_buf,o.pending-i,i)),Sr(e),i=o.pending,o.pending===o.pending_buf_size)){s=1;break}s=o.gzindex<o.gzhead.name.length?255&o.gzhead.name.charCodeAt(o.gzindex++):0,kr(o,s)}while(0!==s);o.gzhead.hcrc&&o.pending>i&&(e.adler=gr(e.adler,o.pending_buf,o.pending-i,i)),0===s&&(o.gzindex=0,o.status=91)}else o.status=91;if(91===o.status)if(o.gzhead.comment){i=o.pending;do{if(o.pending===o.pending_buf_size&&(o.gzhead.hcrc&&o.pending>i&&(e.adler=gr(e.adler,o.pending_buf,o.pending-i,i)),Sr(e),i=o.pending,o.pending===o.pending_buf_size)){s=1;break}s=o.gzindex<o.gzhead.comment.length?255&o.gzhead.comment.charCodeAt(o.gzindex++):0,kr(o,s)}while(0!==s);o.gzhead.hcrc&&o.pending>i&&(e.adler=gr(e.adler,o.pending_buf,o.pending-i,i)),0===s&&(o.status=yr)}else o.status=yr;if(o.status===yr&&(o.gzhead.hcrc?(o.pending+2>o.pending_buf_size&&Sr(e),o.pending+2<=o.pending_buf_size&&(kr(o,255&e.adler),kr(o,e.adler>>8&255),e.adler=0,o.status=Ir)):o.status=Ir),0!==o.pending){if(Sr(e),0===e.avail_out)return o.last_flush=-1,0}else if(0===e.avail_in&&Tr(t)<=Tr(n)&&4!==t)return Cr(e,-5);if(o.status===Mr&&0!==e.avail_in)return Cr(e,-5);if(0!==e.avail_in||0!==o.lookahead||0!==t&&o.status!==Mr){var r=2===o.strategy?function(e,t){for(var n;;){if(0===e.lookahead&&(Ar(e),0===e.lookahead)){if(0===t)return 1;break}if(e.match_length=0,n=dr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++,n&&(Dr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Dr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Dr(e,!1),0===e.strm.avail_out)?1:2}(o,t):3===o.strategy?function(e,t){for(var n,o,i,s,a=e.window;;){if(e.lookahead<=mr){if(Ar(e),e.lookahead<=mr&&0===t)return 1;if(0===e.lookahead)break}if(e.match_length=0,e.lookahead>=3&&e.strstart>0&&(o=a[i=e.strstart-1])===a[++i]&&o===a[++i]&&o===a[++i]){s=e.strstart+mr;do{}while(o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&o===a[++i]&&i<s);e.match_length=mr-(s-i),e.match_length>e.lookahead&&(e.match_length=e.lookahead)}if(e.match_length>=3?(n=dr(e,1,e.match_length-3),e.lookahead-=e.match_length,e.strstart+=e.match_length,e.match_length=0):(n=dr(e,0,e.window[e.strstart]),e.lookahead--,e.strstart++),n&&(Dr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Dr(e,!0),0===e.strm.avail_out?3:4):e.last_lit&&(Dr(e,!1),0===e.strm.avail_out)?1:2}(o,t):_r[o.level].func(o,t);if(3!==r&&4!==r||(o.status=Mr),1===r||3===r)return 0===e.avail_out&&(o.last_flush=-1),0;if(2===r&&(1===t?function(e){var t;Xa(e,2,3),Za(e,256,Fa),16===(t=e).bi_valid?($a(t,t.bi_buf),t.bi_buf=0,t.bi_valid=0):t.bi_valid>=8&&(t.pending_buf[t.pending++]=255&t.bi_buf,t.bi_buf>>=8,t.bi_valid-=8)}(o):5!==t&&(lr(o,0,0,!1),3===t&&(Er(o.head),0===o.lookahead&&(o.strstart=0,o.block_start=0,o.insert=0))),Sr(e),0===e.avail_out))return o.last_flush=-1,0}return 4!==t?0:o.wrap<=0?1:(2===o.wrap?(kr(o,255&e.adler),kr(o,e.adler>>8&255),kr(o,e.adler>>16&255),kr(o,e.adler>>24&255),kr(o,255&e.total_in),kr(o,e.total_in>>8&255),kr(o,e.total_in>>16&255),kr(o,e.total_in>>24&255)):(Rr(o,e.adler>>>16),Rr(o,65535&e.adler)),Sr(e),o.wrap>0&&(o.wrap=-o.wrap),0!==o.pending?0:1)}_r=[new Pr(0,0,0,0,(function(e,t){var n=65535;for(n>e.pending_buf_size-5&&(n=e.pending_buf_size-5);;){if(e.lookahead<=1){if(Ar(e),0===e.lookahead&&0===t)return 1;if(0===e.lookahead)break}e.strstart+=e.lookahead,e.lookahead=0;var o=e.block_start+n;if((0===e.strstart||e.strstart>=o)&&(e.lookahead=e.strstart-o,e.strstart=o,Dr(e,!1),0===e.strm.avail_out))return 1;if(e.strstart-e.block_start>=e.w_size-vr&&(Dr(e,!1),0===e.strm.avail_out))return 1}return e.insert=0,4===t?(Dr(e,!0),0===e.strm.avail_out?3:4):(e.strstart>e.block_start&&(Dr(e,!1),e.strm.avail_out),1)})),new Pr(4,4,8,4,Or),new Pr(4,5,16,8,Or),new Pr(4,6,32,32,Or),new Pr(4,4,16,16,Nr),new Pr(8,16,32,32,Nr),new Pr(8,16,128,128,Nr),new Pr(8,32,128,256,Nr),new Pr(32,128,258,1024,Nr),new Pr(32,258,258,4096,Nr)];function wr(e,t){var n,o,i,s,a,r,c,u,l,d,p,h,g,_,f,m,v,y,I,M,C,T,E,S,D;n=e.state,o=e.next_in,S=e.input,i=o+(e.avail_in-5),s=e.next_out,D=e.output,a=s-(t-e.avail_out),r=s+(e.avail_out-257),c=n.dmax,u=n.wsize,l=n.whave,d=n.wnext,p=n.window,h=n.hold,g=n.bits,_=n.lencode,f=n.distcode,m=(1<<n.lenbits)-1,v=(1<<n.distbits)-1;e:do{g<15&&(h+=S[o++]<<g,g+=8,h+=S[o++]<<g,g+=8),y=_[h&m];t:for(;;){if(h>>>=I=y>>>24,g-=I,0==(I=y>>>16&255))D[s++]=65535&y;else{if(!(16&I)){if(!(64&I)){y=_[(65535&y)+(h&(1<<I)-1)];continue t}if(32&I){n.mode=12;break e}e.msg="invalid literal/length code",n.mode=30;break e}M=65535&y,(I&=15)&&(g<I&&(h+=S[o++]<<g,g+=8),M+=h&(1<<I)-1,h>>>=I,g-=I),g<15&&(h+=S[o++]<<g,g+=8,h+=S[o++]<<g,g+=8),y=f[h&v];n:for(;;){if(h>>>=I=y>>>24,g-=I,!(16&(I=y>>>16&255))){if(!(64&I)){y=f[(65535&y)+(h&(1<<I)-1)];continue n}e.msg="invalid distance code",n.mode=30;break e}if(C=65535&y,g<(I&=15)&&(h+=S[o++]<<g,(g+=8)<I&&(h+=S[o++]<<g,g+=8)),(C+=h&(1<<I)-1)>c){e.msg="invalid distance too far back",n.mode=30;break e}if(h>>>=I,g-=I,C>(I=s-a)){if((I=C-I)>l&&n.sane){e.msg="invalid distance too far back",n.mode=30;break e}if(T=0,E=p,0===d){if(T+=u-I,I<M){M-=I;do{D[s++]=p[T++]}while(--I);T=s-C,E=D}}else if(d<I){if(T+=u+d-I,(I-=d)<M){M-=I;do{D[s++]=p[T++]}while(--I);if(T=0,d<M){M-=I=d;do{D[s++]=p[T++]}while(--I);T=s-C,E=D}}}else if(T+=d-I,I<M){M-=I;do{D[s++]=p[T++]}while(--I);T=s-C,E=D}for(;M>2;)D[s++]=E[T++],D[s++]=E[T++],D[s++]=E[T++],M-=3;M&&(D[s++]=E[T++],M>1&&(D[s++]=E[T++]))}else{T=s-C;do{D[s++]=D[T++],D[s++]=D[T++],D[s++]=D[T++],M-=3}while(M>2);M&&(D[s++]=D[T++],M>1&&(D[s++]=D[T++]))}break}}break}}while(o<i&&s<r);o-=M=g>>3,h&=(1<<(g-=M<<3))-1,e.next_in=o,e.next_out=s,e.avail_in=o<i?i-o+5:5-(o-i),e.avail_out=s<r?r-s+257:257-(s-r),n.hold=h,n.bits=g}var Fr=15,xr=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Vr=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],qr=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Br=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Hr(e,t,n,o,i,s,a,r){var c,u,l,d,p,h,g,_,f,m=r.bits,v=0,y=0,I=0,M=0,C=0,T=0,E=0,S=0,D=0,k=0,R=null,L=0,A=new ka(16),O=new ka(16),N=null,P=0;for(v=0;v<=Fr;v++)A[v]=0;for(y=0;y<o;y++)A[t[n+y]]++;for(C=m,M=Fr;M>=1&&0===A[M];M--);if(C>M&&(C=M),0===M)return i[s++]=20971520,i[s++]=20971520,r.bits=1,0;for(I=1;I<M&&0===A[I];I++);for(C<I&&(C=I),S=1,v=1;v<=Fr;v++)if(S<<=1,(S-=A[v])<0)return-1;if(S>0&&(0===e||1!==M))return-1;for(O[1]=0,v=1;v<Fr;v++)O[v+1]=O[v]+A[v];for(y=0;y<o;y++)0!==t[n+y]&&(a[O[t[n+y]]++]=y);if(0===e?(R=N=a,h=19):1===e?(R=xr,L-=257,N=Vr,P-=257,h=256):(R=qr,N=Br,h=-1),k=0,y=0,v=I,p=s,T=C,E=0,l=-1,d=(D=1<<C)-1,1===e&&D>852||2===e&&D>592)return 1;for(;;){g=v-E,a[y]<h?(_=0,f=a[y]):a[y]>h?(_=N[P+a[y]],f=R[L+a[y]]):(_=96,f=0),c=1<<v-E,I=u=1<<T;do{i[p+(k>>E)+(u-=c)]=g<<24|_<<16|f}while(0!==u);for(c=1<<v-1;k&c;)c>>=1;if(0!==c?(k&=c-1,k+=c):k=0,y++,0==--A[v]){if(v===M)break;v=t[n+a[y]]}if(v>C&&(k&d)!==l){for(0===E&&(E=C),p+=I,S=1<<(T=v-E);T+E<M&&!((S-=A[T+E])<=0);)T++,S<<=1;if(D+=1<<T,1===e&&D>852||2===e&&D>592)return 1;i[l=k&d]=C<<24|T<<16|p-s}}return 0!==k&&(i[p+k]=v-E<<24|64<<16),r.bits=C,0}var jr=-2,Kr=12,Yr=30;function zr(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Wr(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new ka(320),this.work=new ka(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Jr(e){var t,n,o;return e&&e.state?((t=e.state).wsize=0,t.whave=0,t.wnext=0,(n=e)&&n.state?(o=n.state,n.total_in=n.total_out=o.total=0,n.msg="",o.wrap&&(n.adler=1&o.wrap),o.mode=1,o.last=0,o.havedict=0,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new Ra(852),o.distcode=o.distdyn=new Ra(592),o.sane=1,o.back=-1,0):jr):jr}var $r,Xr,Zr=!0;function Qr(e){if(Zr){var t;for($r=new Ra(512),Xr=new Ra(32),t=0;t<144;)e.lens[t++]=8;for(;t<256;)e.lens[t++]=9;for(;t<280;)e.lens[t++]=7;for(;t<288;)e.lens[t++]=8;for(Hr(1,e.lens,0,288,$r,0,e.work,{bits:9}),t=0;t<32;)e.lens[t++]=5;Hr(2,e.lens,0,32,Xr,0,e.work,{bits:5}),Zr=!1}e.lencode=$r,e.lenbits=9,e.distcode=Xr,e.distbits=5}var ec;function tc(e){if(e<1||e>7)throw new TypeError("Bad argument");this.mode=e,this.init_done=!1,this.write_in_progress=!1,this.pending_close=!1,this.windowBits=0,this.level=0,this.memLevel=0,this.strategy=0,this.dictionary=null}function nc(e,t){for(var n=0;n<e.length;n++)this[t+n]=e[n]}tc.prototype.init=function(e,t,n,o,i){var s;switch(this.windowBits=e,this.level=t,this.memLevel=n,this.strategy=o,3!==this.mode&&4!==this.mode||(this.windowBits+=16),7===this.mode&&(this.windowBits+=32),5!==this.mode&&6!==this.mode||(this.windowBits=-this.windowBits),this.strm=new Ea,this.mode){case 1:case 3:case 5:s=function(e,t,n,o,i,s){if(!e)return fr;var a=1;if(-1===t&&(t=6),o<0?(a=0,o=-o):o>15&&(a=2,o-=16),i<1||i>9||o<8||o>15||t<0||t>9||s<0||s>4)return Cr(e,fr);8===o&&(o=9);var r=new br;return e.state=r,r.strm=e,r.wrap=a,r.gzhead=null,r.w_bits=o,r.w_size=1<<r.w_bits,r.w_mask=r.w_size-1,r.hash_bits=i+7,r.hash_size=1<<r.hash_bits,r.hash_mask=r.hash_size-1,r.hash_shift=~~((r.hash_bits+3-1)/3),r.window=new Da(2*r.w_size),r.head=new ka(r.hash_size),r.prev=new ka(r.w_size),r.lit_bufsize=1<<i+6,r.pending_buf_size=4*r.lit_bufsize,r.pending_buf=new Da(r.pending_buf_size),r.d_buf=1*r.lit_bufsize,r.l_buf=3*r.lit_bufsize,r.level=t,r.strategy=s,r.method=8,Ur(e)}(this.strm,this.level,0,this.windowBits,this.memLevel,this.strategy);break;case 2:case 4:case 6:case 7:s=function(e,t){var n,o,i,s,a,r;return e?(o=new Wr,e.state=o,o.window=null,0!==(s=t,n=(i=e)&&i.state?(r=i.state,s<0?(a=0,s=-s):(a=1+(s>>4),s<48&&(s&=15)),s&&(s<8||s>15)?jr:(null!==r.window&&r.wbits!==s&&(r.window=null),r.wrap=a,r.wbits=s,Jr(i))):jr)&&(e.state=null),n):jr}(this.strm,this.windowBits);break;default:throw new Error("Unknown mode "+this.mode)}0===s?(this.write_in_progress=!1,this.init_done=!0):this._error(s)},tc.prototype.params=function(){throw new Error("deflateParams Not supported")},tc.prototype._writeCheck=function(){if(!this.init_done)throw new Error("write before init");if(0===this.mode)throw new Error("already finalized");if(this.write_in_progress)throw new Error("write already in progress");if(this.pending_close)throw new Error("close is pending")},tc.prototype.write=function(e,t,n,o,i,s,a){this._writeCheck(),this.write_in_progress=!0;var r=this;return es((function(){r.write_in_progress=!1;var c=r._write(e,t,n,o,i,s,a);r.callback(c[0],c[1]),r.pending_close&&r.close()})),this},tc.prototype.writeSync=function(e,t,n,o,i,s,a){return this._writeCheck(),this._write(e,t,n,o,i,s,a)},tc.prototype._write=function(e,t,n,o,i,s,a){if(this.write_in_progress=!0,0!==e&&1!==e&&2!==e&&3!==e&&4!==e&&5!==e)throw new Error("Invalid flush value");null==t&&(t=new ti(0),o=0,n=0),i._set?i.set=i._set:i.set=nc;var r,c=this.strm;switch(c.avail_in=o,c.input=t,c.next_in=n,c.avail_out=a,c.output=i,c.next_out=s,this.mode){case 1:case 3:case 5:r=Gr(c,e);break;case 7:case 2:case 4:case 6:r=function(e,t){var n,o,i,s,a,r,c,u,l,d,p,h,g,_,f,m,v,y,I,M,C,T,E,S,D,k,R,L,A,O,N=0,P=new Da(4),b=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&0!==e.avail_in)return jr;(n=e.state).mode===Kr&&(n.mode=13),a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,o=e.input,r=e.avail_in,u=n.hold,l=n.bits,d=r,p=c,T=0;e:for(;;)switch(n.mode){case 1:if(0===n.wrap){n.mode=13;break}for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(2&n.wrap&&35615===u){n.check=0,P[0]=255&u,P[1]=u>>>8&255,n.check=gr(n.check,P,2,0),u=0,l=0,n.mode=2;break}if(n.flags=0,n.head&&(n.head.done=!1),!(1&n.wrap)||(((255&u)<<8)+(u>>8))%31){e.msg="incorrect header check",n.mode=Yr;break}if(8!=(15&u)){e.msg="unknown compression method",n.mode=Yr;break}if(l-=4,C=8+(15&(u>>>=4)),0===n.wbits)n.wbits=C;else if(C>n.wbits){e.msg="invalid window size",n.mode=Yr;break}n.dmax=1<<C,e.adler=n.check=1,n.mode=512&u?10:Kr,u=0,l=0;break;case 2:for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(n.flags=u,8!=(255&n.flags)){e.msg="unknown compression method",n.mode=Yr;break}if(57344&n.flags){e.msg="unknown header flags set",n.mode=Yr;break}n.head&&(n.head.text=u>>8&1),512&n.flags&&(P[0]=255&u,P[1]=u>>>8&255,n.check=gr(n.check,P,2,0)),u=0,l=0,n.mode=3;case 3:for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.head&&(n.head.time=u),512&n.flags&&(P[0]=255&u,P[1]=u>>>8&255,P[2]=u>>>16&255,P[3]=u>>>24&255,n.check=gr(n.check,P,4,0)),u=0,l=0,n.mode=4;case 4:for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.head&&(n.head.xflags=255&u,n.head.os=u>>8),512&n.flags&&(P[0]=255&u,P[1]=u>>>8&255,n.check=gr(n.check,P,2,0)),u=0,l=0,n.mode=5;case 5:if(1024&n.flags){for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.length=u,n.head&&(n.head.extra_len=u),512&n.flags&&(P[0]=255&u,P[1]=u>>>8&255,n.check=gr(n.check,P,2,0)),u=0,l=0}else n.head&&(n.head.extra=null);n.mode=6;case 6:if(1024&n.flags&&((h=n.length)>r&&(h=r),h&&(n.head&&(C=n.head.extra_len-n.length,n.head.extra||(n.head.extra=new Array(n.head.extra_len)),Sa(n.head.extra,o,s,h,C)),512&n.flags&&(n.check=gr(n.check,o,h,s)),r-=h,s+=h,n.length-=h),n.length))break e;n.length=0,n.mode=7;case 7:if(2048&n.flags){if(0===r)break e;h=0;do{C=o[s+h++],n.head&&C&&n.length<65536&&(n.head.name+=String.fromCharCode(C))}while(C&&h<r);if(512&n.flags&&(n.check=gr(n.check,o,h,s)),r-=h,s+=h,C)break e}else n.head&&(n.head.name=null);n.length=0,n.mode=8;case 8:if(4096&n.flags){if(0===r)break e;h=0;do{C=o[s+h++],n.head&&C&&n.length<65536&&(n.head.comment+=String.fromCharCode(C))}while(C&&h<r);if(512&n.flags&&(n.check=gr(n.check,o,h,s)),r-=h,s+=h,C)break e}else n.head&&(n.head.comment=null);n.mode=9;case 9:if(512&n.flags){for(;l<16;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u!==(65535&n.check)){e.msg="header crc mismatch",n.mode=Yr;break}u=0,l=0}n.head&&(n.head.hcrc=n.flags>>9&1,n.head.done=!0),e.adler=n.check=0,n.mode=Kr;break;case 10:for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}e.adler=n.check=zr(u),u=0,l=0,n.mode=11;case 11:if(0===n.havedict)return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,2;e.adler=n.check=1,n.mode=Kr;case Kr:if(5===t||6===t)break e;case 13:if(n.last){u>>>=7&l,l-=7&l,n.mode=27;break}for(;l<3;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}switch(n.last=1&u,l-=1,3&(u>>>=1)){case 0:n.mode=14;break;case 1:if(Qr(n),n.mode=20,6===t){u>>>=2,l-=2;break e}break;case 2:n.mode=17;break;case 3:e.msg="invalid block type",n.mode=Yr}u>>>=2,l-=2;break;case 14:for(u>>>=7&l,l-=7&l;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if((65535&u)!=(u>>>16^65535)){e.msg="invalid stored block lengths",n.mode=Yr;break}if(n.length=65535&u,u=0,l=0,n.mode=15,6===t)break e;case 15:n.mode=16;case 16:if(h=n.length){if(h>r&&(h=r),h>c&&(h=c),0===h)break e;Sa(i,o,s,h,a),r-=h,s+=h,c-=h,a+=h,n.length-=h;break}n.mode=Kr;break;case 17:for(;l<14;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(n.nlen=257+(31&u),u>>>=5,l-=5,n.ndist=1+(31&u),u>>>=5,l-=5,n.ncode=4+(15&u),u>>>=4,l-=4,n.nlen>286||n.ndist>30){e.msg="too many length or distance symbols",n.mode=Yr;break}n.have=0,n.mode=18;case 18:for(;n.have<n.ncode;){for(;l<3;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.lens[b[n.have++]]=7&u,u>>>=3,l-=3}for(;n.have<19;)n.lens[b[n.have++]]=0;if(n.lencode=n.lendyn,n.lenbits=7,E={bits:n.lenbits},T=Hr(0,n.lens,0,19,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid code lengths set",n.mode=Yr;break}n.have=0,n.mode=19;case 19:for(;n.have<n.nlen+n.ndist;){for(;m=(N=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&N,!((f=N>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(v<16)u>>>=f,l-=f,n.lens[n.have++]=v;else{if(16===v){for(S=f+2;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u>>>=f,l-=f,0===n.have){e.msg="invalid bit length repeat",n.mode=Yr;break}C=n.lens[n.have-1],h=3+(3&u),u>>>=2,l-=2}else if(17===v){for(S=f+3;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}l-=f,C=0,h=3+(7&(u>>>=f)),u>>>=3,l-=3}else{for(S=f+7;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}l-=f,C=0,h=11+(127&(u>>>=f)),u>>>=7,l-=7}if(n.have+h>n.nlen+n.ndist){e.msg="invalid bit length repeat",n.mode=Yr;break}for(;h--;)n.lens[n.have++]=C}}if(n.mode===Yr)break;if(0===n.lens[256]){e.msg="invalid code -- missing end-of-block",n.mode=Yr;break}if(n.lenbits=9,E={bits:n.lenbits},T=Hr(1,n.lens,0,n.nlen,n.lencode,0,n.work,E),n.lenbits=E.bits,T){e.msg="invalid literal/lengths set",n.mode=Yr;break}if(n.distbits=6,n.distcode=n.distdyn,E={bits:n.distbits},T=Hr(2,n.lens,n.nlen,n.ndist,n.distcode,0,n.work,E),n.distbits=E.bits,T){e.msg="invalid distances set",n.mode=Yr;break}if(n.mode=20,6===t)break e;case 20:n.mode=21;case 21:if(r>=6&&c>=258){e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,wr(e,p),a=e.next_out,i=e.output,c=e.avail_out,s=e.next_in,o=e.input,r=e.avail_in,u=n.hold,l=n.bits,n.mode===Kr&&(n.back=-1);break}for(n.back=0;m=(N=n.lencode[u&(1<<n.lenbits)-1])>>>16&255,v=65535&N,!((f=N>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(m&&!(240&m)){for(y=f,I=m,M=v;m=(N=n.lencode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,v=65535&N,!(y+(f=N>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=f,l-=f,n.back+=f,n.length=v,0===m){n.mode=26;break}if(32&m){n.back=-1,n.mode=Kr;break}if(64&m){e.msg="invalid literal/length code",n.mode=Yr;break}n.extra=15&m,n.mode=22;case 22:if(n.extra){for(S=n.extra;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.length+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}n.was=n.length,n.mode=23;case 23:for(;m=(N=n.distcode[u&(1<<n.distbits)-1])>>>16&255,v=65535&N,!((f=N>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(!(240&m)){for(y=f,I=m,M=v;m=(N=n.distcode[M+((u&(1<<y+I)-1)>>y)])>>>16&255,v=65535&N,!(y+(f=N>>>24)<=l);){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}u>>>=y,l-=y,n.back+=y}if(u>>>=f,l-=f,n.back+=f,64&m){e.msg="invalid distance code",n.mode=Yr;break}n.offset=v,n.extra=15&m,n.mode=24;case 24:if(n.extra){for(S=n.extra;l<S;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}n.offset+=u&(1<<n.extra)-1,u>>>=n.extra,l-=n.extra,n.back+=n.extra}if(n.offset>n.dmax){e.msg="invalid distance too far back",n.mode=Yr;break}n.mode=25;case 25:if(0===c)break e;if(h=p-c,n.offset>h){if((h=n.offset-h)>n.whave&&n.sane){e.msg="invalid distance too far back",n.mode=Yr;break}h>n.wnext?(h-=n.wnext,g=n.wsize-h):g=n.wnext-h,h>n.length&&(h=n.length),_=n.window}else _=i,g=a-n.offset,h=n.length;h>c&&(h=c),c-=h,n.length-=h;do{i[a++]=_[g++]}while(--h);0===n.length&&(n.mode=21);break;case 26:if(0===c)break e;i[a++]=n.length,c--,n.mode=21;break;case 27:if(n.wrap){for(;l<32;){if(0===r)break e;r--,u|=o[s++]<<l,l+=8}if(p-=c,e.total_out+=p,n.total+=p,p&&(e.adler=n.check=n.flags?gr(n.check,i,p,a-p):pr(n.check,i,p,a-p)),p=c,(n.flags?u:zr(u))!==n.check){e.msg="incorrect data check",n.mode=Yr;break}u=0,l=0}n.mode=28;case 28:if(n.wrap&&n.flags){for(;l<32;){if(0===r)break e;r--,u+=o[s++]<<l,l+=8}if(u!==(4294967295&n.total)){e.msg="incorrect length check",n.mode=Yr;break}u=0,l=0}n.mode=29;case 29:T=1;break e;case Yr:T=-3;break e;case 31:return-4;default:return jr}return e.next_out=a,e.avail_out=c,e.next_in=s,e.avail_in=r,n.hold=u,n.bits=l,(n.wsize||p!==e.avail_out&&n.mode<Yr&&(n.mode<27||4!==t))&&(D=e,k=e.output,R=e.next_out,L=p-e.avail_out,null===(O=D.state).window&&(O.wsize=1<<O.wbits,O.wnext=0,O.whave=0,O.window=new Da(O.wsize)),L>=O.wsize?(Sa(O.window,k,R-O.wsize,O.wsize,0),O.wnext=0,O.whave=O.wsize):((A=O.wsize-O.wnext)>L&&(A=L),Sa(O.window,k,R-L,A,O.wnext),(L-=A)?(Sa(O.window,k,R-L,L,0),O.wnext=L,O.whave=O.wsize):(O.wnext+=A,O.wnext===O.wsize&&(O.wnext=0),O.whave<O.wsize&&(O.whave+=A)))),d-=e.avail_in,p-=e.avail_out,e.total_in+=d,e.total_out+=p,n.total+=p,n.wrap&&p&&(e.adler=n.check=n.flags?gr(n.check,i,p,e.next_out-p):pr(n.check,i,p,e.next_out-p)),e.data_type=n.bits+(n.last?64:0)+(n.mode===Kr?128:0)+(20===n.mode||15===n.mode?256:0),(0===d&&0===p||4===t)&&0===T&&(T=-5),T}(c,e);break;default:throw new Error("Unknown mode "+this.mode)}return 1!==r&&0!==r&&this._error(r),this.write_in_progress=!1,[c.avail_in,c.avail_out]},tc.prototype.close=function(){this.write_in_progress?this.pending_close=!0:(this.pending_close=!1,1===this.mode||3===this.mode||5===this.mode?function(e){var t;e&&e.state&&(42!==(t=e.state.status)&&69!==t&&73!==t&&91!==t&&t!==yr&&t!==Ir&&t!==Mr?Cr(e,fr):(e.state=null,t===Ir&&Cr(e,-3)))}(this.strm):function(e){if(!e||!e.state)return jr;var t=e.state;t.window&&(t.window=null),e.state=null}(this.strm),this.mode=0)},tc.prototype.reset=function(){switch(this.mode){case 1:case 5:ec=Ur(this.strm);break;case 2:case 6:ec=Jr(this.strm)}0!==ec&&this._error(ec)},tc.prototype._error=function(e){this.onerror(Ta[e]+": "+this.strm.msg,e),this.write_in_progress=!1,this.pending_close&&this.close()};var oc=Object.freeze({NONE:0,DEFLATE:1,INFLATE:2,GZIP:3,GUNZIP:4,DEFLATERAW:5,INFLATERAW:6,UNZIP:7,Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8,Zlib:tc}),ic={};Object.keys(oc).forEach((function(e){ic[e]=oc[e]})),ic.Z_MIN_WINDOWBITS=8,ic.Z_MAX_WINDOWBITS=15,ic.Z_DEFAULT_WINDOWBITS=15,ic.Z_MIN_CHUNK=64,ic.Z_MAX_CHUNK=1/0,ic.Z_DEFAULT_CHUNK=16384,ic.Z_MIN_MEMLEVEL=1,ic.Z_MAX_MEMLEVEL=9,ic.Z_DEFAULT_MEMLEVEL=8,ic.Z_MIN_LEVEL=-1,ic.Z_MAX_LEVEL=9,ic.Z_DEFAULT_LEVEL=ic.Z_DEFAULT_COMPRESSION;var sc={Z_OK:ic.Z_OK,Z_STREAM_END:ic.Z_STREAM_END,Z_NEED_DICT:ic.Z_NEED_DICT,Z_ERRNO:ic.Z_ERRNO,Z_STREAM_ERROR:ic.Z_STREAM_ERROR,Z_DATA_ERROR:ic.Z_DATA_ERROR,Z_MEM_ERROR:ic.Z_MEM_ERROR,Z_BUF_ERROR:ic.Z_BUF_ERROR,Z_VERSION_ERROR:ic.Z_VERSION_ERROR};function ac(e,t){if("string"==typeof t&&(t=new ti(t)),!Fi(t))throw new TypeError("Not a string or buffer");var n=ic.Z_FINISH;return e._processChunk(t,n)}function rc(e){if(!(this instanceof rc))return new rc(e);gc.call(this,e,ic.DEFLATE)}function cc(e){if(!(this instanceof cc))return new cc(e);gc.call(this,e,ic.INFLATE)}function uc(e){if(!(this instanceof uc))return new uc(e);gc.call(this,e,ic.GZIP)}function lc(e){if(!(this instanceof lc))return new lc(e);gc.call(this,e,ic.GUNZIP)}function dc(e){if(!(this instanceof dc))return new dc(e);gc.call(this,e,ic.DEFLATERAW)}function pc(e){if(!(this instanceof pc))return new pc(e);gc.call(this,e,ic.INFLATERAW)}function hc(e){if(!(this instanceof hc))return new hc(e);gc.call(this,e,ic.UNZIP)}function gc(e,t){if(this._opts=e=e||{},this._chunkSize=e.chunkSize||ic.Z_DEFAULT_CHUNK,ya.call(this,e),e.flush&&e.flush!==ic.Z_NO_FLUSH&&e.flush!==ic.Z_PARTIAL_FLUSH&&e.flush!==ic.Z_SYNC_FLUSH&&e.flush!==ic.Z_FULL_FLUSH&&e.flush!==ic.Z_FINISH&&e.flush!==ic.Z_BLOCK)throw new Error("Invalid flush flag: "+e.flush);if(this._flushFlag=e.flush||ic.Z_NO_FLUSH,e.chunkSize&&(e.chunkSize<ic.Z_MIN_CHUNK||e.chunkSize>ic.Z_MAX_CHUNK))throw new Error("Invalid chunk size: "+e.chunkSize);if(e.windowBits&&(e.windowBits<ic.Z_MIN_WINDOWBITS||e.windowBits>ic.Z_MAX_WINDOWBITS))throw new Error("Invalid windowBits: "+e.windowBits);if(e.level&&(e.level<ic.Z_MIN_LEVEL||e.level>ic.Z_MAX_LEVEL))throw new Error("Invalid compression level: "+e.level);if(e.memLevel&&(e.memLevel<ic.Z_MIN_MEMLEVEL||e.memLevel>ic.Z_MAX_MEMLEVEL))throw new Error("Invalid memLevel: "+e.memLevel);if(e.strategy&&e.strategy!=ic.Z_FILTERED&&e.strategy!=ic.Z_HUFFMAN_ONLY&&e.strategy!=ic.Z_RLE&&e.strategy!=ic.Z_FIXED&&e.strategy!=ic.Z_DEFAULT_STRATEGY)throw new Error("Invalid strategy: "+e.strategy);if(e.dictionary&&!Fi(e.dictionary))throw new Error("Invalid dictionary: it should be a Buffer instance");this._binding=new ic.Zlib(t);var n=this;this._hadError=!1,this._binding.onerror=function(e,t){n._binding=null,n._hadError=!0;var o=new Error(e);o.errno=t,o.code=ic.codes[t],n.emit("error",o)};var o=ic.Z_DEFAULT_COMPRESSION;"number"==typeof e.level&&(o=e.level);var i=ic.Z_DEFAULT_STRATEGY;"number"==typeof e.strategy&&(i=e.strategy),this._binding.init(e.windowBits||ic.Z_DEFAULT_WINDOWBITS,o,e.memLevel||ic.Z_DEFAULT_MEMLEVEL,i,e.dictionary),this._buffer=new ti(this._chunkSize),this._offset=0,this._closed=!1,this._level=o,this._strategy=i,this.once("end",this.close)}Object.keys(sc).forEach((function(e){sc[sc[e]]=e})),ls(gc,ya),gc.prototype.params=function(e,t,n){if(e<ic.Z_MIN_LEVEL||e>ic.Z_MAX_LEVEL)throw new RangeError("Invalid compression level: "+e);if(t!=ic.Z_FILTERED&&t!=ic.Z_HUFFMAN_ONLY&&t!=ic.Z_RLE&&t!=ic.Z_FIXED&&t!=ic.Z_DEFAULT_STRATEGY)throw new TypeError("Invalid strategy: "+t);if(this._level!==e||this._strategy!==t){var o=this;this.flush(ic.Z_SYNC_FLUSH,(function(){o._binding.params(e,t),o._hadError||(o._level=e,o._strategy=t,n&&n())}))}else es(n)},gc.prototype.reset=function(){return this._binding.reset()},gc.prototype._flush=function(e){this._transform(new ti(0),"",e)},gc.prototype.flush=function(e,t){var n=this._writableState;if(("function"==typeof e||void 0===e&&!t)&&(t=e,e=ic.Z_FULL_FLUSH),n.ended)t&&es(t);else if(n.ending)t&&this.once("end",t);else if(n.needDrain){var o=this;this.once("drain",(function(){o.flush(t)}))}else this._flushFlag=e,this.write(new ti(0),"",t)},gc.prototype.close=function(e){if(e&&es(e),!this._closed){this._closed=!0,this._binding.close();var t=this;es((function(){t.emit("close")}))}},gc.prototype._transform=function(e,t,n){var o,i=this._writableState,s=(i.ending||i.ended)&&(!e||i.length===e.length);if(null===!e&&!Fi(e))return n(new Error("invalid input"));s?o=ic.Z_FINISH:(o=this._flushFlag,e.length>=i.length&&(this._flushFlag=this._opts.flush||ic.Z_NO_FLUSH)),this._processChunk(e,o,n)},gc.prototype._processChunk=function(e,t,n){var o=e&&e.length,i=this._chunkSize-this._offset,s=0,a=this,r="function"==typeof n;if(!r){var c,u=[],l=0;this.on("error",(function(e){c=e}));do{var d=this._binding.writeSync(t,e,s,o,this._buffer,this._offset,i)}while(!this._hadError&&g(d[0],d[1]));if(this._hadError)throw c;var p=ti.concat(u,l);return this.close(),p}var h=this._binding.write(t,e,s,o,this._buffer,this._offset,i);function g(c,d){if(!a._hadError){var p=i-d;if(function(e){if(!e)throw new Error("have should not go down")}(p>=0),p>0){var h=a._buffer.slice(a._offset,a._offset+p);a._offset+=p,r?a.push(h):(u.push(h),l+=h.length)}if((0===d||a._offset>=a._chunkSize)&&(i=a._chunkSize,a._offset=0,a._buffer=new ti(a._chunkSize)),0===d){if(s+=o-c,o=c,!r)return!0;var _=a._binding.write(t,e,s,o,a._buffer,a._offset,a._chunkSize);return _.callback=g,void(_.buffer=e)}if(!r)return!1;n()}}h.buffer=e,h.callback=g},ls(rc,gc),ls(cc,gc),ls(uc,gc),ls(lc,gc),ls(dc,gc),ls(pc,gc),ls(hc,gc);var _c=function(e,t){return ac(new rc(t),e)},fc=function(e,t){return ac(new cc(t),e)};class mc{constructor(e,t,n){this.SDKAPPID=e,this.EXPIRETIME=n,this.PRIVATEKEY=t}genTestUserSig(e){return this._isNumber(this.SDKAPPID)?this._isString(this.PRIVATEKEY)?this._isString(e)?this._isNumber(this.EXPIRETIME)?(_("log","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","sdkAppID="+this.SDKAPPID+" key="+this.PRIVATEKEY+" userID="+e+" expire="+this.EXPIRETIME),this.genSigWithUserbuf(e,this.EXPIRETIME,null)):(_("error","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","expireTime must be a number"),""):(_("error","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","userID must be a string"),""):(_("error","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","privateKey must be a string"),""):(_("error","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","sdkAppID must be a number"),"")}newBuffer(e,t){return ti.from?ti.from(e,t):new ti(e,t)}unescape(e){return e.replace(/_/g,"=").replace(/\-/g,"/").replace(/\*/g,"+")}escape(e){return e.replace(/\+/g,"*").replace(/\//g,"-").replace(/=/g,"_")}encode(e){return this.escape(this.newBuffer(e).toString("base64"))}decode(e){return this.newBuffer(this.unescape(e),"base64")}base64encode(e){return this.newBuffer(e).toString("base64")}base64decode(e){return this.newBuffer(e,"base64").toString()}_hmacsha256(e,t,n,o){let i="TLS.identifier:"+e+"\n";i+="TLS.sdkappid:"+this.SDKAPPID+"\n",i+="TLS.time:"+t+"\n",i+="TLS.expire:"+n+"\n",null!=o&&(i+="TLS.userbuf:"+o+"\n");let s=Bi.HmacSHA256(i,this.PRIVATEKEY);return Bi.enc.Base64.stringify(s)}_utc(){return Math.round(Date.now()/1e3)}_isNumber(e){return null!==e&&("number"==typeof e&&!isNaN(e-0)||"object"==typeof e&&e.constructor===Number)}_isString(e){return"string"==typeof e}genSigWithUserbuf(e,t,n){let o=this._utc(),i={"TLS.ver":"2.0","TLS.identifier":e,"TLS.sdkappid":this.SDKAPPID,"TLS.time":o,"TLS.expire":t},s="";if(null!=n){let a=this.base64encode(n);i["TLS.userbuf"]=a,s=this._hmacsha256(e,o,t,a)}else s=this._hmacsha256(e,o,t,null);i["TLS.sig"]=s;let a=JSON.stringify(i),r=_c(this.newBuffer(a)).toString("base64"),c=this.escape(r);return _("log","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","ret="+c),c}validate(e){let t=this.decode(e);_("log","at src/roomkit/config/lib-generate-test-usersig-es.min.js:2","validate ret="+fc(t))}}const vc=1600073050,yc="e41926aaff5867bc58d21af3b41361f096484bfeadfe721f774dc91ba5c01ac5",Ic={userId:`user_${Math.ceil(1e5*Math.random())}`,userName:`user_${Math.ceil(10*Math.random())}`,avatarUrl:""};function Mc(e,t){var n={};for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.indexOf(o)<0&&(n[o]=e[o]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var i=0;for(o=Object.getOwnPropertySymbols(e);i<o.length;i++)t.indexOf(o[i])<0&&Object.prototype.propertyIsEnumerable.call(e,o[i])&&(n[o[i]]=e[o[i]])}return n}function Cc(e,t,n,o){return new(n||(n=Promise))((function(i,s){function a(e){try{c(o.next(e))}catch(t){s(t)}}function r(e){try{c(o.throw(e))}catch(t){s(t)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,r)}c((o=o.apply(e,t||[])).next())}))}"function"==typeof SuppressedError&&SuppressedError;class Tc{constructor(e){return Tc.instance||(Tc.instance=this,this.engine=e,this.events={},this.bindIMEvents()),Tc.instance}addEvent(e,t){this.events[e]||(this.events[e]=new Map),this.events[e].set(t,1)}removeEvents(){Object.keys(this.events).forEach((e=>{this.events[e].clear()})),this.events={}}dispatch(e,t){if(this.events[e])for(const n of this.events[e].keys())n.call(this,t)}bindIMEvents(){this.engine.chat.on(this.engine.EVENT.SDK_READY,this.onSDKReady,this),this.engine.chat.on(this.engine.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.engine.chat.on(this.engine.EVENT.KICKED_OUT,this.onKickedOut,this),this.engine.chat.on(this.engine.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_MODIFIED,this.onMessageModified,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_REVOKED,this.onMessageRevoked,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.onMessageReadReceiptReceived,this),this.engine.chat.on(this.engine.EVENT.MESSAGE_REACTIONS_UPDATED,this.onMessageReactionsUpdated,this),this.engine.chat.on(this.engine.EVENT.CONVERSATION_LIST_UPDATED,this.onConversationListUpdated,this),this.engine.chat.on(this.engine.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,this.onTotalMessageCountUpdated,this),this.engine.chat.on(this.engine.EVENT.PROFILE_UPDATED,this.onProfileUpdated,this),this.engine.chat.on(this.engine.EVENT.BLACKLIST_UPDATED,this.onBlacklistUpdated,this),this.engine.chat.on(this.engine.EVENT.USER_STATUS_UPDATED,this.onUserStatusUpdated,this),this.engine.chat.on(this.engine.EVENT.GROUP_LIST_UPDATED,this.onGroupListUpdated,this),this.engine.chat.on(this.engine.EVENT.GROUP_ATTRIBUTES_UPDATED,this.onGroupAttributesUpdated,this),this.engine.chat.on(this.engine.EVENT.GROUP_COUNTER_UPDATED,this.onGroupCounterUpdated,this),this.engine.chat.on(this.engine.EVENT.FRIEND_LIST_UPDATED,this.onFriendListUpdated,this),this.engine.chat.on(this.engine.EVENT.FRIEND_APPLICATION_LIST_UPDATED,this.onFriendApplicationListUpdated,this)}unbindIMEvents(){this.engine.chat.off(this.engine.EVENT.SDK_READY,this.onSDKReady,this),this.engine.chat.off(this.engine.EVENT.SDK_NOT_READY,this.onSDKNotReady,this),this.engine.chat.off(this.engine.EVENT.KICKED_OUT,this.onKickedOut,this),this.engine.chat.off(this.engine.EVENT.NET_STATE_CHANGE,this.onNetStateChange,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_MODIFIED,this.onMessageModified,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_REVOKED,this.onMessageRevoked,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.onMessageReadReceiptReceived,this),this.engine.chat.off(this.engine.EVENT.MESSAGE_REACTIONS_UPDATED,this.onMessageReactionsUpdated,this),this.engine.chat.off(this.engine.EVENT.CONVERSATION_LIST_UPDATED,this.onConversationListUpdated,this),this.engine.chat.off(this.engine.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,this.onTotalMessageCountUpdated,this),this.engine.chat.off(this.engine.EVENT.PROFILE_UPDATED,this.onProfileUpdated,this),this.engine.chat.off(this.engine.EVENT.BLACKLIST_UPDATED,this.onBlacklistUpdated,this),this.engine.chat.off(this.engine.EVENT.USER_STATUS_UPDATED,this.onUserStatusUpdated,this),this.engine.chat.off(this.engine.EVENT.GROUP_LIST_UPDATED,this.onGroupListUpdated,this),this.engine.chat.off(this.engine.EVENT.GROUP_ATTRIBUTES_UPDATED,this.onGroupAttributesUpdated,this),this.engine.chat.off(this.engine.EVENT.GROUP_COUNTER_UPDATED,this.onGroupCounterUpdated,this),this.engine.chat.off(this.engine.EVENT.FRIEND_LIST_UPDATED,this.onFriendListUpdated,this),this.engine.chat.off(this.engine.EVENT.FRIEND_APPLICATION_LIST_UPDATED,this.onFriendApplicationListUpdated,this)}onSDKReady(e){this.dispatch(this.engine.EVENT.SDK_READY,e.data)}onSDKNotReady(e){this.dispatch(this.engine.EVENT.SDK_NOT_READY,e.data)}onKickedOut(e){this.dispatch(this.engine.EVENT.KICKED_OUT,e.data)}onNetStateChange(e){this.dispatch(this.engine.EVENT.NET_STATE_CHANGE,e.data)}onReceiveMessage(e){this.dispatch(this.engine.EVENT.MESSAGE_RECEIVED,e.data)}onMessageModified(e){this.dispatch(this.engine.EVENT.MESSAGE_MODIFIED,e.data)}onMessageRevoked(e){this.dispatch(this.engine.EVENT.MESSAGE_REVOKED,e.data)}onMessageReadByPeer(e){this.dispatch(this.engine.EVENT.MESSAGE_READ_BY_PEER,e.data)}onMessageReadReceiptReceived(e){this.dispatch(this.engine.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,e.data)}onMessageReactionsUpdated(e){this.dispatch(this.engine.EVENT.MESSAGE_REACTIONS_UPDATED,e.data)}onConversationListUpdated(e){this.dispatch(this.engine.EVENT.CONVERSATION_LIST_UPDATED,e.data)}onTotalMessageCountUpdated(e){this.dispatch(this.engine.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,e.data)}onProfileUpdated(e){this.dispatch(this.engine.EVENT.PROFILE_UPDATED,e.data)}onBlacklistUpdated(e){this.dispatch(this.engine.EVENT.BLACKLIST_UPDATED,e.data)}onUserStatusUpdated(e){this.dispatch(this.engine.EVENT.USER_STATUS_UPDATED,e.data)}onGroupListUpdated(e){this.dispatch(this.engine.EVENT.GROUP_LIST_UPDATED,e.data)}onGroupAttributesUpdated(e){this.dispatch(this.engine.EVENT.GROUP_ATTRIBUTES_UPDATED,e.data)}onGroupCounterUpdated(e){this.dispatch(this.engine.EVENT.GROUP_COUNTER_UPDATED,e.data)}onFriendListUpdated(e){this.dispatch(this.engine.EVENT.FRIEND_LIST_UPDATED,e.data)}onFriendApplicationListUpdated(e){this.dispatch(this.engine.EVENT.FRIEND_APPLICATION_LIST_UPDATED,e.data)}}var Ec,Sc,Dc,kc,Rc,Lc,Ac,Oc,Nc;!function(e){e.TUIStore="TUIStore",e.TUITranslate="TUITranslate",e.TUIConversation="TUIConversation",e.TUIChat="TUIChat",e.TUIGroup="TUIGroup",e.TUIUser="TUIUser",e.TUIFriend="TUIFriend",e.TUIReport="TUIReport"}(Ec||(Ec={})),function(e){e.APP="application",e.CONV="conversation",e.CHAT="chat",e.GRP="group",e.USER="user",e.FRIEND="friend",e.SEARCH="search",e.CUSTOM="custom"}(Sc||(Sc={})),function(e){e[e.UNSUB_USER=-1]="UNSUB_USER"}(Dc||(Dc={})),function(e){e.BUSINESS_ID="user_typing_status",e[e.STATUS_START=1]="STATUS_START",e[e.STATUS_END=0]="STATUS_END",e[e.VERSION=1]="VERSION",e[e.ACTION_START_ID=14]="ACTION_START_ID",e[e.ACTION_END_ID=0]="ACTION_END_ID",e.ACTION_START="EIMAMSG_InputStatus_Ing",e.ACTION_END="EIMAMSG_InputStatus_End",e[e.NEED_TYPING=1]="NEED_TYPING"}(kc||(kc={})),function(e){e.ADD="add",e.REMOVE="remove"}(Rc||(Rc={})),function(e){e[e.MSG_MODIFY_CONFLICT=2480]="MSG_MODIFY_CONFLICT",e[e.MSG_MODIFY_DISABLED_IN_AVCHATROOM=2481]="MSG_MODIFY_DISABLED_IN_AVCHATROOM",e[e.MODIFY_MESSAGE_NOT_EXIST=20026]="MODIFY_MESSAGE_NOT_EXIST"}(Lc||(Lc={})),function(e){e[e.NOT_INIT=-1e5]="NOT_INIT",e[e.INVALID_CONV_ID=-100001]="INVALID_CONV_ID",e[e.CONV_ID_SAME=-100002]="CONV_ID_SAME",e[e.CONV_NOT_EXIST=-100003]="CONV_NOT_EXIST",e[e.GET_MSG_LIST_ERROR=-100004]="GET_MSG_LIST_ERROR",e[e.MISMATCH_TYPE_AND_PAYLOAD=-100005]="MISMATCH_TYPE_AND_PAYLOAD"}(Ac||(Ac={})),function(e){e.MSG_MODIFY_CONFLICT="MODIFY_MESSAGE_ERROR,修改消息发生冲突, data.message 是最新的消息",e.MSG_MODIFY_DISABLED_IN_AVCHATROOM="MODIFY_MESSAGE_ERROR,不支持修改直播群消息.",e.MODIFY_MESSAGE_NOT_EXIST="MODIFY_MESSAGE_ERROR,消息不存在."}(Oc||(Oc={})),function(e){e.NOT_INIT="TUIChatEngine 初始化未完成，请确认 TUIChatEngine.login 接口调用是否正常。",e.INVALID_CONV_ID="会话 ID 无效",e.CONV_ID_SAME="您切换的是同一个会话 ID",e.CONV_NOT_EXIST="会话不存在",e.GET_MSG_LIST_ERROR="Chat SDK is not ready.",e.MISMATCH_TYPE_AND_PAYLOAD="type 与 payload 不匹配."}(Nc||(Nc={}));const Pc={logout:1,destroy:1},bc=function(e){return void 0===e},Uc=function(e){return e.startsWith("_")},Gc=function(e){return/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(e)},wc=function(e){return e&&function(e){if("string"==typeof e)try{return!!JSON.parse(e)}catch(t){return!1}return!1}(e)?JSON.parse(e):e},Fc=function(e){let t="";return t=e>=1048576?`${(e/1048576).toFixed(2)} Mb`:e>=1024?`${(e/1024).toFixed(2)} Kb`:`${e.toFixed(2)}B`,t},xc={"[TUIEmoji_Expect]":"emoji_0@2x.png","[TUIEmoji_Blink]":"emoji_1@2x.png","[TUIEmoji_Guffaw]":"emoji_2@2x.png","[TUIEmoji_KindSmile]":"emoji_3@2x.png","[TUIEmoji_Haha]":"emoji_4@2x.png","[TUIEmoji_Cheerful]":"emoji_5@2x.png","[TUIEmoji_Smile]":"emoji_6@2x.png","[TUIEmoji_Sorrow]":"emoji_7@2x.png","[TUIEmoji_Speechless]":"emoji_8@2x.png","[TUIEmoji_Amazed]":"emoji_9@2x.png","[TUIEmoji_Complacent]":"emoji_10@2x.png","[TUIEmoji_Lustful]":"emoji_11@2x.png","[TUIEmoji_Stareyes]":"emoji_12@2x.png","[TUIEmoji_Giggle]":"emoji_13@2x.png","[TUIEmoji_Daemon]":"emoji_14@2x.png","[TUIEmoji_Rage]":"emoji_15@2x.png","[TUIEmoji_Yawn]":"emoji_16@2x.png","[TUIEmoji_TearsLaugh]":"emoji_17@2x.png","[TUIEmoji_Silly]":"emoji_18@2x.png","[TUIEmoji_Wail]":"emoji_19@2x.png","[TUIEmoji_Kiss]":"emoji_20@2x.png","[TUIEmoji_Trapped]":"emoji_21@2x.png","[TUIEmoji_Fear]":"emoji_22@2x.png","[TUIEmoji_BareTeeth]":"emoji_23@2x.png","[TUIEmoji_FlareUp]":"emoji_24@2x.png","[TUIEmoji_Tact]":"emoji_25@2x.png","[TUIEmoji_Shit]":"emoji_26@2x.png","[TUIEmoji_ShutUp]":"emoji_27@2x.png","[TUIEmoji_Sigh]":"emoji_28@2x.png","[TUIEmoji_Hehe]":"emoji_29@2x.png","[TUIEmoji_Silent]":"emoji_30@2x.png","[TUIEmoji_Skull]":"emoji_31@2x.png","[TUIEmoji_Mask]":"emoji_32@2x.png","[TUIEmoji_Beer]":"emoji_33@2x.png","[TUIEmoji_Cake]":"emoji_34@2x.png","[TUIEmoji_RedPacket]":"emoji_35@2x.png","[TUIEmoji_Bombs]":"emoji_36@2x.png","[TUIEmoji_Ai]":"emoji_37@2x.png","[TUIEmoji_Celebrate]":"emoji_38@2x.png","[TUIEmoji_Bless]":"emoji_39@2x.png","[TUIEmoji_Flower]":"emoji_40@2x.png","[TUIEmoji_Watermelon]":"emoji_41@2x.png","[TUIEmoji_Cow]":"emoji_42@2x.png","[TUIEmoji_Fool]":"emoji_43@2x.png","[TUIEmoji_Surprised]":"emoji_44@2x.png","[TUIEmoji_Askance]":"emoji_45@2x.png","[TUIEmoji_Monster]":"emoji_46@2x.png","[TUIEmoji_Pig]":"emoji_47@2x.png","[TUIEmoji_Coffee]":"emoji_48@2x.png","[TUIEmoji_Ok]":"emoji_49@2x.png","[TUIEmoji_Heart]":"emoji_50@2x.png","[TUIEmoji_Sun]":"emoji_51@2x.png","[TUIEmoji_Moon]":"emoji_52@2x.png","[TUIEmoji_Star]":"emoji_53@2x.png","[TUIEmoji_Rich]":"emoji_54@2x.png","[TUIEmoji_Fortune]":"emoji_55@2x.png","[TUIEmoji_857]":"emoji_56@2x.png","[TUIEmoji_666]":"emoji_57@2x.png","[TUIEmoji_Prohibit]":"emoji_58@2x.png","[TUIEmoji_Convinced]":"emoji_59@2x.png","[TUIEmoji_Knife]":"emoji_60@2x.png","[TUIEmoji_Like]":"emoji_61@2x.png"},Vc={"[TUIEmoji_Smile]":"[微笑]","[TUIEmoji_Expect]":"[期待]","[TUIEmoji_Blink]":"[眨眼]","[TUIEmoji_Guffaw]":"[大笑]","[TUIEmoji_KindSmile]":"[姨母笑]","[TUIEmoji_Haha]":"[哈哈哈]","[TUIEmoji_Cheerful]":"[愉快]","[TUIEmoji_Speechless]":"[无语]","[TUIEmoji_Amazed]":"[惊讶]","[TUIEmoji_Sorrow]":"[悲伤]","[TUIEmoji_Complacent]":"[得意]","[TUIEmoji_Silly]":"[傻了]","[TUIEmoji_Lustful]":"[色]","[TUIEmoji_Giggle]":"[憨笑]","[TUIEmoji_Kiss]":"[亲亲]","[TUIEmoji_Wail]":"[大哭]","[TUIEmoji_TearsLaugh]":"[哭笑]","[TUIEmoji_Trapped]":"[困]","[TUIEmoji_Mask]":"[口罩]","[TUIEmoji_Fear]":"[恐惧]","[TUIEmoji_BareTeeth]":"[龇牙]","[TUIEmoji_FlareUp]":"[发怒]","[TUIEmoji_Yawn]":"[打哈欠]","[TUIEmoji_Tact]":"[机智]","[TUIEmoji_Stareyes]":"[星星眼]","[TUIEmoji_ShutUp]":"[闭嘴]","[TUIEmoji_Sigh]":"[叹气]","[TUIEmoji_Hehe]":"[呵呵]","[TUIEmoji_Silent]":"[收声]","[TUIEmoji_Surprised]":"[惊喜]","[TUIEmoji_Askance]":"[白眼]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[便便]","[TUIEmoji_Monster]":"[怪兽]","[TUIEmoji_Daemon]":"[恶魔]","[TUIEmoji_Rage]":"[恶魔怒]","[TUIEmoji_Fool]":"[衰]","[TUIEmoji_Pig]":"[猪]","[TUIEmoji_Cow]":"[牛]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[骷髅]","[TUIEmoji_Bombs]":"[炸弹]","[TUIEmoji_Coffee]":"[咖啡]","[TUIEmoji_Cake]":"[蛋糕]","[TUIEmoji_Beer]":"[啤酒]","[TUIEmoji_Flower]":"[花]","[TUIEmoji_Watermelon]":"[瓜]","[TUIEmoji_Rich]":"[壕]","[TUIEmoji_Heart]":"[爱心]","[TUIEmoji_Moon]":"[月亮]","[TUIEmoji_Sun]":"[太阳]","[TUIEmoji_Star]":"[星星]","[TUIEmoji_RedPacket]":"[红包]","[TUIEmoji_Celebrate]":"[庆祝]","[TUIEmoji_Bless]":"[福]","[TUIEmoji_Fortune]":"[发]","[TUIEmoji_Convinced]":"[服]","[TUIEmoji_Prohibit]":"[禁]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[刀]","[TUIEmoji_Like]":"[赞]"},qc={enabledMessageReadReceipt:Math.pow(2,5),enabledEmojiPlugin:Math.pow(2,48),enabledOnlineStatus:Math.pow(2,7),enabledCustomerServicePlugin:Math.pow(2,40),enabledTranslationPlugin:Math.pow(2,38),enabledVoiceToText:Math.pow(2,39)},Bc=["messageList","conversationList","newMessageList"],Hc=["translateTextInfo","voiceToTextInfo"],jc="undefined"!=typeof wx&&"function"==typeof wx.getSystemInfoSync&&Boolean(wx.getSystemInfoSync().fontSizeSetting),Kc="undefined"!=typeof uni&&"undefined"==typeof window,Yc=jc||Kc,zc="undefined"!=typeof uni,Wc=("undefined"!=typeof uni||"undefined"!=typeof window)&&!Yc,Jc=jc?wx:zc?uni:window,$c=Wc&&window&&window.navigator&&window.navigator.userAgent||"",Xc=/Android/i.test($c),Zc=/(?:Windows Phone)/.test($c),Qc=/(?:SymbianOS)/.test($c),eu=/iPad/i.test($c)||/iPhone/i.test($c)||/iPod/i.test($c),tu=Xc||Zc||Qc||eu,nu=Wc&&!tu;class ou{constructor(){this.global=Jc,this.isOfficial=!1}static getInstance(){return ou.instance||(ou.instance=new ou),ou.instance}initOfficial(e){this.isOfficial=e}getPlatform(){let e="";return nu?e="pc":tu?e="h5":jc?e="wechat":Kc&&!jc&&(e="app"),e}}class iu{constructor(){this.EVENT=E.EVENT,this.TYPES=E.TYPES,this.loginStatusPromise=new Map,this.userID="",this.isInited=!1}static getInstance(){return iu.instance||(iu.instance=new iu),iu.instance}mount(e,t){this[e]=t}login(e){const{chat:t,SDKAppID:n,userID:o}=e,i=1400187352===n||1400188366===n;return this.createChat(e),this.userID=o,ou.getInstance().initOfficial(i),this.TUIStore.update(Sc.APP,"isOfficial",i),this.TUIStore.update(Sc.APP,"SDKVersion",E.VERSION),this.eventCenter=new Tc(this),this.eventCenter.removeEvents(),this.resetStore(),this.initService(),t&&t.isReady()?(_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.login ok, from TUICore."),this.TUIUser.getUserProfile(),this.checkCommercialAbility(),Promise.resolve({})):(this.registerPlugin(e),this.eventCenter.addEvent(this.EVENT.SDK_READY,(()=>{this.onSDKReady()})),this.eventCenter.addEvent(this.EVENT.SDK_NOT_READY,(()=>{this.onSDKNotReady()})),this.loginChat(e))}logout(){return this.userID="",this.isInited=!1,this.resetStore(),this.chat.logout()}isReady(){var e;return(null===(e=this.chat)||void 0===e?void 0:e.isReady())||!1}setLogLevel(e){if(this.chat)return this.chat.setLogLevel(e);_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine 初始化未完成，请确认 TUIChatEngine.login 接口调用是否正常。")}destroy(){return this.eventCenter.unbindIMEvents(),this.isInited=!1,this.resetStore(),this.chat.destroy()}getMyUserID(){return this.userID}resetStore(){this.TUIStore.reset(Sc.CHAT),this.TUIStore.reset(Sc.CONV),this.TUIStore.reset(Sc.GRP),this.TUIStore.reset(Sc.USER),this.TUIStore.reset(Sc.SEARCH),this.TUIStore.reset(Sc.FRIEND),this.TUIStore.reset(Sc.CUSTOM),_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.resetStore ok.")}initService(){this.TUIChat.init(),this.TUIConversation.init(),this.TUIUser.init(),this.initOptionalServices(),this.isInited=!0,_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.initService ok.")}initOptionalServices(){const e=E.VERSION.split(".");e[0]>3||3===e[0]&&e[1]>=3&&e[2]>0?(!0===this.chat.callExperimentalAPI("canIUseModule",["group-module"])&&this.TUIGroup.init(),!0===this.chat.callExperimentalAPI("canIUseModule",["relationship-module"])&&this.TUIFriend.init()):(this.TUIGroup.init(),this.TUIFriend.init())}createChat(e){const{chat:t}=e,n=Mc(e,["chat"]);bc(t)?this.chat=E.create(Object.assign(Object.assign({},n),{scene:"chat-uikit-engine"})):this.chat=t}loginChat(e){const{userID:t,userSig:n}=e;return new Promise(((e,o)=>{this.chat.login({userID:t,userSig:n}).then((t=>{_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.loginChat ok."),this.checkCommercialAbility(),t.data.repeatLogin&&this.chat.isReady()&&e(t),this.loginStatusPromise.set("login",{resolve:e,reject:o,imResponse:t})})).catch((e=>{o(e)}))}))}registerPlugin(e){const{useUploadPlugin:t=!1,useProfanityFilterPlugin:n=!1,TIMPush:o,pushConfig:i,TUIOfflinePush:s,offlinePushConfig:a}=e;!0===t&&this.chat.registerPlugin({"tim-upload-plugin":D}),!0===n&&this.chat.registerPlugin({"tim-profanity-filter-plugin":A}),!Kc||jc||bc(o)||bc(i)||this.chat.registerPlugin({"tim-push":o,pushConfig:i}),!Kc||jc||bc(s)||bc(a)||this.chat.registerPlugin({"tim-offline-push-plugin":s,offlinePushConfig:a})}onSDKReady(){if(this.loginStatusPromise.has("login")){const e=this.loginStatusPromise.get("login");e.resolve(e.imResponse),this.TUIUser.getUserProfile()}this.loginStatusPromise.delete("login")}onSDKNotReady(){this.loginStatusPromise.has("login")&&this.loginStatusPromise.get("login").reject(new Error("sdk not ready")),this.loginStatusPromise.delete("login"),this.resetStore()}checkCommercialAbility(){Object.keys(qc).forEach((e=>{const t=qc[e];this.chat.callExperimentalAPI("isCommercialAbilityEnabled",t).then((t=>{const{enabled:n=!1}=t.data;this.TUIStore.update(Sc.APP,e,n)}))}))}}class su{constructor(){this.defaultStore={enabledMessageReadReceipt:!1,enabledEmojiPlugin:!1,enabledOnlineStatus:!1,enabledCustomerServicePlugin:!1,enabledTranslationPlugin:!1,enabledVoiceToText:!1,enableTyping:!0,enableConversationDraft:!0,isOfficial:!1,SDKVersion:"3.0.0",tasks:{sendMessage:!1,revokeMessage:!1,modifyNickName:!1,groupChat:!1,muteGroup:!1,dismissGroup:!1,call:!1,searchCloudMessage:!1,customerService:!1,translateTextMessage:!1}},this.store={enabledEmojiPlugin:!1,enabledMessageReadReceipt:!1,enabledOnlineStatus:!1,enabledCustomerServicePlugin:!1,enabledTranslationPlugin:!1,enabledVoiceToText:!1,enableTyping:!0,enableConversationDraft:!0,isOfficial:!1,SDKVersion:"3.0.0",tasks:{sendMessage:!1,revokeMessage:!1,modifyNickName:!1,groupChat:!1,muteGroup:!1,dismissGroup:!1,call:!1,searchCloudMessage:!1,customerService:!1,translateTextMessage:!1}}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}}class au{constructor(){this.defaultStore={userProfile:{},displayOnlineStatus:!1,displayMessageReadReceipt:!0,userStatusList:new Map,kickedOut:"",netStateChange:"",userBlacklist:[],targetLanguage:"zh"},this.store={userProfile:{},displayOnlineStatus:!1,displayMessageReadReceipt:!0,userStatusList:new Map,kickedOut:"",netStateChange:"",userBlacklist:[],targetLanguage:"zh"}}update(e,t){"userStatusList"===e?this.updateUserStatusList(t):this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateUserStatusList(e){0!==e.length?e.forEach((e=>{const{userID:t,statusType:n=0,customStatus:o=""}=e;n===Dc.UNSUB_USER?this.store.userStatusList.delete(t):this.store.userStatusList.set(t,{statusType:n,customStatus:o})})):this.store.userStatusList.clear()}}class ru{getEngine(){return iu.getInstance()}}const cu=function(e){if(null==e)return!0;if("boolean"==typeof e)return!1;if("number"==typeof e)return 0===e;if("string"==typeof e)return 0===e.length;if("function"==typeof e)return 0===e.length;if(Array.isArray(e))return 0===e.length;if(e instanceof Error)return""===e.message;if(function(e){if("object"!=typeof e||null===e)return!1;const t=Object.getPrototypeOf(e);if(null===t)return!0;let n=t;for(;null!==Object.getPrototypeOf(n);)n=Object.getPrototypeOf(n);return t===n}(e)){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}return!1},uu=["[图片]","[语音]","[视频]","[文件]","[位置]","[地理位置]","[动画表情]","[自定义消息]","[群提示消息]","[聊天记录]"];class lu extends ru{constructor(e){super(),this.initProxy(e),this.isMuted=this.messageRemindType===this.getEngine().TYPES.MSG_REMIND_ACPT_NOT_NOTE||this.messageRemindType===this.getEngine().TYPES.MSG_REMIND_DISCARD,this.operationType=0,this._conversation=e}initProxy(e){Object.keys(e).forEach((t=>{Uc(t)||(this[t]=e[t])}))}updateProperties(e){Object.keys(e).forEach((t=>{Uc(t)||(this[t]=e[t])}))}updateOperationType(e){this.operationType=e}getConversation(){return this._conversation}deleteConversation(){return this.getEngine().TUIConversation.deleteConversation(this.conversationID)}pinConversation(){return this.getEngine().TUIConversation.pinConversation({conversationID:this.conversationID,isPinned:!this.isPinned})}muteConversation(){const e=this.getEngine(),t={messageRemindType:!0===this.isMuted?e.TYPES.MSG_REMIND_ACPT_AND_NOTE:e.TYPES.MSG_REMIND_ACPT_NOT_NOTE};if(this.type===e.TYPES.CONV_C2C){const n=this.conversationID.replace(e.TYPES.CONV_C2C,"");t.userIDList=[n]}else if(this.type===e.TYPES.CONV_GROUP){const n=this.conversationID.replace(e.TYPES.CONV_GROUP,"");t.groupID=n}return e.TUIConversation.muteConversation(t)}getAvatar(){var e,t,n,o,i,s;const a=this.getEngine();let r="";switch(this.type){case a.TYPES.CONV_C2C:r=Gc(null===(e=this.userProfile)||void 0===e?void 0:e.avatar)?null===(t=this.userProfile)||void 0===t?void 0:t.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_16.png";break;case a.TYPES.CONV_GROUP:r=Gc(null===(n=this.groupProfile)||void 0===n?void 0:n.avatar)?null===(o=this.groupProfile)||void 0===o?void 0:o.avatar:"https://web.sdk.qcloud.com/im/demo/TUIkit/web/img/constomer.png";break;case a.TYPES.CONV_SYSTEM:r=Gc(null===(i=this.groupProfile)||void 0===i?void 0:i.avatar)?null===(s=this.groupProfile)||void 0===s?void 0:s.avatar:"https://web.sdk.qcloud.com/component/TUIKit/assets/group_avatar.png"}return r}getShowName(){var e,t,n,o;const i=this.getEngine();let s="";switch(this.type){case i.TYPES.CONV_C2C:s=this.remark||(null===(e=this.userProfile)||void 0===e?void 0:e.nick)||(null===(t=this.userProfile)||void 0===t?void 0:t.userID)||"";break;case i.TYPES.CONV_GROUP:s=(null===(n=this.groupProfile)||void 0===n?void 0:n.name)||(null===(o=this.groupProfile)||void 0===o?void 0:o.groupID)||"";break;case i.TYPES.CONV_SYSTEM:s=i.TUITranslate.t("系统通知")}return s}getGroupAtInfo(){const e=this.getEngine(),t=e.TUITranslate.t.bind(e.TUITranslate),n=[`[${t("TUIConversation.有人@我")}]`,`[${t("TUIConversation.@所有人")}]`,`[${t("TUIConversation.@所有人")}][${t("TUIConversation.有人@我")}]`];let o="";for(let i=0;i<this.groupAtInfoList.length;i++)this.groupAtInfoList[i].atTypeArray[0]&&this.unreadCount>0&&(o=n[this.groupAtInfoList[i].atTypeArray[0]-1]);return o}getLastMessage(e){return"time"===e?this.getLastMessageTime():"text"===e?this.getLastMessageText():(_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`ConversationModel.getLastMessage key:${e} is invalid.`),null)}getLastMessageTime(){var e;const t=this.getEngine();let n="";return(null===(e=this.lastMessage)||void 0===e?void 0:e.lastTime)>0&&(n=function(e,t){const n=36e5,o=24*n,i=7*o,s=(new Date).getTime()-e;let a="";if(s<0)return a;const r=s/6e4,c=s/n,u=s/o,l=s/i;if(l>=1&&l<=4)a=` ${parseInt(`${l}`,10)} ${t("time.周")}${t("time.前")}`;else if(u>=1&&u<=6)a=` ${parseInt(`${u}`,10)} ${t("time.天")}${t("time.前")}`;else if(c>=1&&c<=23)a=` ${parseInt(`${c}`,10)} ${t("time.小时")}${t("time.前")}`;else if(r>=1&&r<=59)a=` ${parseInt(`${r}`,10)} ${t("time.分钟")}${t("time.前")}`;else if(s>=0&&s<=6e4)a=`${t("time.刚刚")}`;else{const t=new Date;t.setTime(e),a=`${t.getFullYear()}-${t.getMonth()+1<10?`0${t.getMonth()+1}`:t.getMonth()+1}-${t.getDate()<10?`0${t.getDate()}`:t.getDate()}`}return a}(1e3*this.lastMessage.lastTime,t.TUITranslate.t.bind(t.TUITranslate))),n}getLastMessageText(){var e;if(this.draftText)return wc(this.draftText).abstract;const t=this.getEngine(),n=t.TUITranslate.t.bind(t.TUITranslate);if(4===this.operationType)return n("TUIConversation.您已被群管理员移出群聊");if(5===this.operationType)return n("TUIConversation.该群聊已被解散");if(8===this.operationType)return n("TUIConversation.您已退出该群聊");const o=this._conversation,i=this.lastMessage;let s="",a="";const r=o.unreadCount>0&&o.messageRemindType===t.TYPES.MSG_REMIND_ACPT_NOT_NOTE?`[${o.unreadCount>99?"99+":o.unreadCount}${n("TUIConversation.条")}]`:"";if(o.type===t.TYPES.CONV_GROUP)if(i.fromAccount===t.getMyUserID())s=n("TUIConversation.我");else{const e=i.fromAccount;s=t.TUIFriend.getFriendRemark([e])[e]||i.nameCard||i.nick||e}if(i.type===t.TYPES.MSG_TEXT)a=this.decodeTextMessage(i.payload.text);else if(i.type===t.TYPES.MSG_CUSTOM){const o=wc(null===(e=null==i?void 0:i.payload)||void 0===e?void 0:e.data);if(1===(null==o?void 0:o.businessID))return a=t.TUIChat.messageHandler.handleCallKitSignaling(i),a;a=uu.includes(i.messageForShow)?n(`TUIChat.${i.messageForShow}`):i.messageForShow}else a=uu.includes(i.messageForShow)?n(`TUIChat.${i.messageForShow}`):i.messageForShow;return i.isRevoked&&(a=n("TUIChat.撤回了一条消息")),o.type===t.TYPES.CONV_GROUP&&i.type===t.TYPES.MSG_GRP_TIP?a:`${r}${s?`${s}:`:""}${a}`}decodeTextMessage(e){if(cu(e))return e;const t=/(\[.+?\])/g;let n=e;if(t.test(e)){const o=this.getEngine(),i=o.TUITranslate.t.bind(o.TUITranslate);n=e.replace(t,(e=>{const t=i(`Emoji.${e}`);return jc||!t||t.startsWith("Emoji.")?Vc[e]||e:t}))}return n}}class du{constructor(){this.defaultStore={currentConversationID:"",totalUnreadCount:0,conversationList:[],currentConversation:null,operationTypeMap:new Map},this.store={currentConversationID:"",totalUnreadCount:0,conversationList:[],currentConversation:null,operationTypeMap:new Map}}update(e,t){switch(e){case"conversationList":this.updateConversationList(t);break;case"operationTypeMap":this.updateOperationTypeMap(t);break;default:this.store[e]=t}}getData(e){return this.store[e]}getModel(e){return this.store.conversationList.find((t=>t.conversationID===e))}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateConversationList(e){const t=[];e.forEach((e=>{let n=e;e instanceof lu?n.updateProperties(e):n=new lu(e);const o=this.getOperationType(e);n.updateOperationType(o),t.push(n)})),this.store.conversationList=t}updateOperationTypeMap(e){const{conversationID:t,operationType:n=0}=e;this.store.operationTypeMap.set(t,n)}getOperationType(e){const{conversationID:t}=e;return this.store.operationTypeMap.get(t)||0}}class pu extends ru{constructor(e){super(),this.messageHandlers={[this.getEngine().TYPES.MSG_TEXT]:e=>this.getEngine().TUIChat.messageHandler.handleTextMessage(e),[this.getEngine().TYPES.MSG_FACE]:e=>this.getEngine().TUIChat.messageHandler.handleFaceMessage(e),[this.getEngine().TYPES.MSG_LOCATION]:e=>this.getEngine().TUIChat.messageHandler.handleLocationMessage(e),[this.getEngine().TYPES.MSG_IMAGE]:e=>this.getEngine().TUIChat.messageHandler.handleImageMessage(e),[this.getEngine().TYPES.MSG_AUDIO]:e=>this.getEngine().TUIChat.messageHandler.handleAudioMessage(e),[this.getEngine().TYPES.MSG_VIDEO]:e=>this.getEngine().TUIChat.messageHandler.handleVideoMessage(e),[this.getEngine().TYPES.MSG_FILE]:e=>this.getEngine().TUIChat.messageHandler.handleFileMessage(e),[this.getEngine().TYPES.MSG_CUSTOM]:e=>this.getEngine().TUIChat.messageHandler.handleCustomMessage(e),[this.getEngine().TYPES.MSG_MERGER]:e=>this.getEngine().TUIChat.messageHandler.handleMergeMessage(e),[this.getEngine().TYPES.MSG_GRP_TIP]:e=>this.getEngine().TUIChat.messageHandler.handleGroupTipsMessage(e)},this._message=e,this._signalingInfo=void 0,this.progress=0,this.reactionList=[],this.initProperties(e)}initProperties(e){Object.keys(e).forEach((t=>{Uc(t)||(this[t]=e[t])}))}updateProperties(e){this._message=e,Object.keys(e).forEach((t=>{Uc(t)||(this[t]=e[t])}))}getMessage(){return this._message}modifyMessage(e){return e.type&&this._message.type!==e.type&&!e.payload?Promise.reject({code:Ac.MISMATCH_TYPE_AND_PAYLOAD,message:Nc.MISMATCH_TYPE_AND_PAYLOAD}):(this._message.type=e.type||this._message.type,this._message.payload=e.payload||this._message.payload,this._message.cloudCustomData=e.cloudCustomData||this._message.cloudCustomData,this.getEngine().TUIChat.modifyMessage(this._message))}revokeMessage(){return this.getEngine().TUIChat.revokeMessage(this._message)}resendMessage(){return this.getEngine().TUIChat.resendMessage(this._message)}deleteMessage(){return this.getEngine().TUIChat.deleteMessage([this._message])}quoteMessage(){return this.getEngine().TUIChat.quoteMessage(this._message)}replyMessage(){return this.getEngine().TUIChat.replyMessage(this._message)}setMessageExtensions(e){return this.getEngine().TUIChat.setMessageExtensions(this._message,e)}getMessageExtensions(){return this.getEngine().TUIChat.getMessageExtensions(this._message)}deleteMessageExtensions(e){return this.getEngine().TUIChat.deleteMessageExtensions(this._message,e)}getSignalingInfo(){return this.type!==this.getEngine().TYPES.MSG_CUSTOM?null:bc(this._signalingInfo)?(this._signalingInfo=this.getEngine().chat.getSignalingInfo(this._message),this._signalingInfo):this._signalingInfo}getMessageContent(){const e=this.messageHandlers[this.type];if(bc(e))return{};if(this.type===this.getEngine().TYPES.MSG_GRP_TIP)return e(this._message);const t=this.getEngine().TUIFriend.getFriendRemark([this.from]);return Object.assign(Object.assign({},e(this._message)),{showName:t[this.from]||this.nameCard||this.nick||this.from})}sendForwardMessage(e){return this.getEngine().TUIChat.sendForwardMessage(e,[this._message])}}class hu{constructor(){this.defaultStore={messageList:[],isCompleted:!1,nextReqMessageID:"",quoteMessage:{},newMessageList:[],typingStatus:!1,messageSource:void 0,translateTextInfo:void 0,voiceToTextInfo:void 0,userInfo:{}},this.store={messageList:[],isCompleted:!1,nextReqMessageID:"",quoteMessage:{},newMessageList:[],typingStatus:!1,messageSource:void 0,translateTextInfo:void 0,voiceToTextInfo:void 0,userInfo:{}}}update(e,t){switch(e){case"messageList":this.updateMessageList(t);break;case"translateTextInfo":this.updateTranslateTextInfo(t);break;case"voiceToTextInfo":this.updateVoiceToTextInfo(t);break;default:this.store[e]=t}}getData(e){return this.store[e]}getModel(e){return this.store.messageList.find((t=>t.ID===e))}reset(e=[]){const t=e.filter((e=>!Hc.includes(e)));this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),null==t?void 0:t.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateMessageList(e){const t=[];e.forEach((e=>{let n=e;e instanceof pu||(n=this.getModel(e.ID),n?n.updateProperties(e):n=new pu(e)),t.push(n)})),this.store.messageList=t}updateTranslateTextInfo(e){this.updateBykey("translateTextInfo",e)}updateVoiceToTextInfo(e){this.updateBykey("voiceToTextInfo",e)}updateBykey(e,t){const{conversationID:n,messageID:o,visible:i=!1}=t;this.store[e]||(this.store[e]=new Map),this.store[e].has(n)||this.store[e].set(n,[]);const s=this.store[e].get(n)||[];let a=!0;for(let r=0;r<s.length;r++)if(s[r].messageID===o){s[r].visible=i,a=!1;break}a&&s.push({messageID:o,visible:i}),this.store[e].set(n,s)}}class gu{constructor(e){this.groupAttributes={},this.groupCounters={},this.initProxy(e)}initProxy(e){Object.keys(e).forEach((t=>{Uc(t)||(this[t]=e[t])}))}}class _u{constructor(){this.defaultStore={currentGroupID:"",currentGroup:{},currentGroupAttributes:{},currentGroupCounters:{},currentGroupMemberList:[],groupList:[],groupSystemNoticeList:[],isCompleted:!1,offset:0},this.store={currentGroupID:"",currentGroup:void 0,currentGroupAttributes:{},currentGroupCounters:{},currentGroupMemberList:[],groupList:[],groupSystemNoticeList:[],isCompleted:!1,offset:0}}update(e,t){switch(e){case"groupList":this.updateGroupList(t);break;case"currentGroup":this.store.currentGroup=t instanceof gu?t:new gu(t);break;default:this.store[e]=t}}getData(e){if("groupSystemNoticeList"===e){const e=[...this.store.groupSystemNoticeList];return this.store.groupSystemNoticeList.length=0,e}return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}updateGroupList(e){this.store.groupList=e.map((e=>e instanceof gu?e:new gu(e)))}}class fu{constructor(){this.store={}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){0===e.length&&(this.store={}),this.store=Object.assign(Object.assign({},this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:void 0})),{}))}}class mu{constructor(){this.defaultStore={friendList:[],friendApplicationList:[],friendApplicationUnreadCount:0},this.store={friendList:[],friendApplicationList:[],friendApplicationUnreadCount:0}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}}class vu{constructor(){this.defaultStore={currentSearchInputValue:{value:"",searchType:"global"},currentSearchMessageType:{value:{key:"",label:"",value:""},searchType:"global"},currentSearchMessageTime:{value:{key:"",label:"",value:{timePosition:0,timePeriod:0}},searchType:"global"},currentSearchingStatus:{isSearching:!1,searchType:"global"},isShowInConversationSearch:!1},this.store={currentSearchInputValue:{value:"",searchType:"global"},currentSearchMessageType:{value:{key:"",label:"",value:""},searchType:"global"},currentSearchMessageTime:{value:{key:"",label:"",value:{timePosition:0,timePeriod:0}},searchType:"global"},currentSearchingStatus:{isSearching:!1,searchType:"global"},isShowInConversationSearch:!1}}update(e,t){this.store[e]=t}getData(e){return this.store[e]}reset(e=[]){this.store=Object.assign(Object.assign(Object.assign({},this.defaultStore),this.store),null==e?void 0:e.reduce(((e,t)=>Object.assign(Object.assign({},e),{[t]:this.defaultStore[t]})),{}))}}class yu{constructor(){this.storeMap={[Sc.APP]:new su,[Sc.USER]:new au,[Sc.CONV]:new du,[Sc.CHAT]:new hu,[Sc.GRP]:new _u,[Sc.FRIEND]:new mu,[Sc.SEARCH]:new vu},this.task={}}static getInstance(){return yu.instance||(yu.instance=new yu),yu.instance}watch(e,t){this.task[e]||(this.task[e]={});const n=this.task[e];Object.keys(t).forEach((o=>{const i=t[o];n[o]||(n[o]=new Map),n[o].set(i,1),this.notifyOnWatch(e,o,i)}))}unwatch(e,t){if(!this.task[e])return;const n=this.task[e];Object.keys(t).forEach((e=>{var o;null===(o=n[e])||void 0===o||o.delete(t[e])}))}update(e,t,n){var o;e!==Sc.CUSTOM||this.storeMap[e]||(this.storeMap[e]=new fu),null===(o=this.storeMap[e])||void 0===o||o.update(t,n),this.notify(e,t)}getData(e,t){var n;return e!==Sc.CUSTOM||this.storeMap[e]||(this.storeMap[e]=new fu),null===(n=this.storeMap[e])||void 0===n?void 0:n.getData(t)}getConversationModel(e){var t;return null===(t=this.storeMap[Sc.CONV])||void 0===t?void 0:t.getModel(e)}getMessageModel(e){var t;return null===(t=this.storeMap[Sc.CHAT])||void 0===t?void 0:t.getModel(e)}reset(e,t=[],n=!1){if(e in this.storeMap){const o=this.storeMap[e];0===t.length&&(t=Object.keys(null==o?void 0:o.store)),o.reset(t),n&&t.forEach((t=>{this.notify(e,t)}))}}notifyOnWatch(e,t,n){const o=this.getData(e,t);Bc.indexOf(t)>-1&&0===o.length||n&&n.call(this,o)}notify(e,t){if(!this.task[e])return;const n=this.task[e];if(n[t]){const o=n[t],i=this.getData(e,t);for(const[e]of o.entries())e.call(this,i)}}}function Iu(e){return(Iu="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function Mu(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function Cu(e){var t=function(e){if("object"!=Iu(e)||!e)return e;var t=e[Symbol.toPrimitive];if(void 0!==t){var n=t.call(e,"string");if("object"!=Iu(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"==Iu(t)?t:t+""}function Tu(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,Cu(o.key),o)}}function Eu(e,t,n){return t&&Tu(e.prototype,t),n&&Tu(e,n),Object.defineProperty(e,"prototype",{writable:!1}),e}function Su(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function Du(e,t){return(Du=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e})(e,t)}function ku(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&Du(e,t)}function Ru(e,t){if(t&&("object"==Iu(t)||"function"==typeof t))return t;if(void 0!==t)throw new TypeError("Derived constructors may only return object or undefined");return Su(e)}function Lu(e){return(Lu=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function Au(e,t,n){return(t=Cu(t))in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ou(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}function Nu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function Pu(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Nu(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Nu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var bu={type:"logger",log:function(e){this.output("log",e)},warn:function(e){this.output("warn",e)},error:function(e){this.output("error",e)},output:function(e,t){console&&console[e]&&console[e].apply(console,t)}},Uu=new(function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Mu(this,e),this.init(t,n)}return Eu(e,[{key:"init",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.prefix=t.prefix||"i18next:",this.logger=e||bu,this.options=t,this.debug=t.debug}},{key:"setDebug",value:function(e){this.debug=e}},{key:"log",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"log","",!0)}},{key:"warn",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","",!0)}},{key:"error",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"error","")}},{key:"deprecate",value:function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this.forward(t,"warn","WARNING DEPRECATED: ",!0)}},{key:"forward",value:function(e,t,n,o){return o&&!this.debug?null:("string"==typeof e[0]&&(e[0]="".concat(n).concat(this.prefix," ").concat(e[0])),this.logger[t](e))}},{key:"create",value:function(t){return new e(this.logger,Pu(Pu({},{prefix:"".concat(this.prefix,":").concat(t,":")}),this.options))}},{key:"clone",value:function(t){return(t=t||this.options).prefix=t.prefix||this.prefix,new e(this.logger,t)}}]),e}()),Gu=function(){function e(){Mu(this,e),this.observers={}}return Eu(e,[{key:"on",value:function(e,t){var n=this;return e.split(" ").forEach((function(e){n.observers[e]=n.observers[e]||[],n.observers[e].push(t)})),this}},{key:"off",value:function(e,t){this.observers[e]&&(t?this.observers[e]=this.observers[e].filter((function(e){return e!==t})):delete this.observers[e])}},{key:"emit",value:function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];this.observers[e]&&[].concat(this.observers[e]).forEach((function(e){e.apply(void 0,n)})),this.observers["*"]&&[].concat(this.observers["*"]).forEach((function(t){t.apply(t,[e].concat(n))}))}}]),e}();function wu(){var e,t,n=new Promise((function(n,o){e=n,t=o}));return n.resolve=e,n.reject=t,n}function Fu(e){return null==e?"":""+e}function xu(e,t,n){function o(e){return e&&e.indexOf("###")>-1?e.replace(/###/g,"."):e}function i(){return!e||"string"==typeof e}for(var s="string"!=typeof t?[].concat(t):t.split(".");s.length>1;){if(i())return{};var a=o(s.shift());!e[a]&&n&&(e[a]=new n),e=Object.prototype.hasOwnProperty.call(e,a)?e[a]:{}}return i()?{}:{obj:e,k:o(s.shift())}}function Vu(e,t,n){var o=xu(e,t,Object);o.obj[o.k]=n}function qu(e,t){var n=xu(e,t),o=n.obj,i=n.k;if(o)return o[i]}function Bu(e,t,n){for(var o in t)"__proto__"!==o&&"constructor"!==o&&(o in e?"string"==typeof e[o]||e[o]instanceof String||"string"==typeof t[o]||t[o]instanceof String?n&&(e[o]=t[o]):Bu(e[o],t[o],n):e[o]=t[o]);return e}function Hu(e){return e.replace(/[\-\[\]\/\{\}\(\)\*\+\?\.\\\^\$\|]/g,"\\$&")}var ju={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;","/":"&#x2F;"};function Ku(e){return"string"==typeof e?e.replace(/[&<>"'\/]/g,(function(e){return ju[e]})):e}var Yu="undefined"!=typeof window&&window.navigator&&void 0===window.navigator.userAgentData&&window.navigator.userAgent&&window.navigator.userAgent.indexOf("MSIE")>-1,zu=[" ",",","?","!",";"];function Wu(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:".";if(e){if(e[t])return e[t];for(var o=t.split(n),i=e,s=0;s<o.length;++s){if(!i)return;if("string"==typeof i[o[s]]&&s+1<o.length)return;if(void 0===i[o[s]]){for(var a=2,r=o.slice(s,s+a).join(n),c=i[r];void 0===c&&o.length>s+a;)a++,c=i[r=o.slice(s,s+a).join(n)];if(void 0===c)return;if(null===c)return null;if(t.endsWith(r)){if("string"==typeof c)return c;if(r&&"string"==typeof c[r])return c[r]}var u=o.slice(s+a).join(n);return u?Wu(c,u,n):void 0}i=i[o[s]]}return i}}function Ju(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function $u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ju(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ju(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Xu=function(){ku(t,Gu);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Lu(e);if(t){var i=Lu(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return Ru(this,n)}}(t);function t(n){var o,i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{ns:["translation"],defaultNS:"translation"};return Mu(this,t),o=e.call(this),Yu&&Gu.call(Su(o)),o.data=n||{},o.options=i,void 0===o.options.keySeparator&&(o.options.keySeparator="."),void 0===o.options.ignoreJSONStructure&&(o.options.ignoreJSONStructure=!0),o}return Eu(t,[{key:"addNamespaces",value:function(e){this.options.ns.indexOf(e)<0&&this.options.ns.push(e)}},{key:"removeNamespaces",value:function(e){var t=this.options.ns.indexOf(e);t>-1&&this.options.ns.splice(t,1)}},{key:"getResource",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=void 0!==o.keySeparator?o.keySeparator:this.options.keySeparator,s=void 0!==o.ignoreJSONStructure?o.ignoreJSONStructure:this.options.ignoreJSONStructure,a=[e,t];n&&"string"!=typeof n&&(a=a.concat(n)),n&&"string"==typeof n&&(a=a.concat(i?n.split(i):n)),e.indexOf(".")>-1&&(a=e.split("."));var r=qu(this.data,a);return r||!s||"string"!=typeof n?r:Wu(this.data&&this.data[e]&&this.data[e][t],n,i)}},{key:"addResource",value:function(e,t,n,o){var i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{silent:!1},s=void 0!==i.keySeparator?i.keySeparator:this.options.keySeparator,a=[e,t];n&&(a=a.concat(s?n.split(s):n)),e.indexOf(".")>-1&&(o=t,t=(a=e.split("."))[1]),this.addNamespaces(t),Vu(this.data,a,o),i.silent||this.emit("added",e,t,n,o)}},{key:"addResources",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{silent:!1};for(var i in n)"string"!=typeof n[i]&&"[object Array]"!==Object.prototype.toString.apply(n[i])||this.addResource(e,t,i,n[i],{silent:!0});o.silent||this.emit("added",e,t,n)}},{key:"addResourceBundle",value:function(e,t,n,o,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{silent:!1},a=[e,t];e.indexOf(".")>-1&&(o=n,n=t,t=(a=e.split("."))[1]),this.addNamespaces(t);var r=qu(this.data,a)||{};o?Bu(r,n,i):r=$u($u({},r),n),Vu(this.data,a,r),s.silent||this.emit("added",e,t,n)}},{key:"removeResourceBundle",value:function(e,t){this.hasResourceBundle(e,t)&&delete this.data[e][t],this.removeNamespaces(t),this.emit("removed",e,t)}},{key:"hasResourceBundle",value:function(e,t){return void 0!==this.getResource(e,t)}},{key:"getResourceBundle",value:function(e,t){return t||(t=this.options.defaultNS),"v1"===this.options.compatibilityAPI?$u($u({},{}),this.getResource(e,t)):this.getResource(e,t)}},{key:"getDataByLanguage",value:function(e){return this.data[e]}},{key:"hasLanguageSomeTranslations",value:function(e){var t=this.getDataByLanguage(e);return!!(t&&Object.keys(t)||[]).find((function(e){return t[e]&&Object.keys(t[e]).length>0}))}},{key:"toJSON",value:function(){return this.data}}]),t}(),Zu={processors:{},addPostProcessor:function(e){this.processors[e.name]=e},handle:function(e,t,n,o,i){var s=this;return e.forEach((function(e){s.processors[e]&&(t=s.processors[e].process(t,n,o,i))})),t}};function Qu(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function el(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Qu(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Qu(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var tl={},nl=function(){ku(t,Gu);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Lu(e);if(t){var i=Lu(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return Ru(this,n)}}(t);function t(n){var o,i,s,a,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return Mu(this,t),o=e.call(this),Yu&&Gu.call(Su(o)),i=["resourceStore","languageUtils","pluralResolver","interpolator","backendConnector","i18nFormat","utils"],s=n,a=Su(o),i.forEach((function(e){s[e]&&(a[e]=s[e])})),o.options=r,void 0===o.options.keySeparator&&(o.options.keySeparator="."),o.logger=Uu.create("translator"),o}return Eu(t,[{key:"changeLanguage",value:function(e){e&&(this.language=e)}},{key:"exists",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}};if(null==e)return!1;var n=this.resolve(e,t);return n&&void 0!==n.res}},{key:"extractFromKey",value:function(e,t){var n=void 0!==t.nsSeparator?t.nsSeparator:this.options.nsSeparator;void 0===n&&(n=":");var o=void 0!==t.keySeparator?t.keySeparator:this.options.keySeparator,i=t.ns||this.options.defaultNS||[],s=n&&e.indexOf(n)>-1,a=!(this.options.userDefinedKeySeparator||t.keySeparator||this.options.userDefinedNsSeparator||t.nsSeparator||function(e,t,n){t=t||"",n=n||"";var o=zu.filter((function(e){return t.indexOf(e)<0&&n.indexOf(e)<0}));if(0===o.length)return!0;var i=new RegExp("(".concat(o.map((function(e){return"?"===e?"\\?":e})).join("|"),")")),s=!i.test(e);if(!s){var a=e.indexOf(n);a>0&&!i.test(e.substring(0,a))&&(s=!0)}return s}(e,n,o));if(s&&!a){var r=e.match(this.interpolator.nestingRegexp);if(r&&r.length>0)return{key:e,namespaces:i};var c=e.split(n);(n!==o||n===o&&this.options.ns.indexOf(c[0])>-1)&&(i=c.shift()),e=c.join(o)}return"string"==typeof i&&(i=[i]),{key:e,namespaces:i}}},{key:"translate",value:function(e,n,o){var i=this;if("object"!==Iu(n)&&this.options.overloadTranslationOptionHandler&&(n=this.options.overloadTranslationOptionHandler(arguments)),"object"===Iu(n)&&(n=el({},n)),n||(n={}),null==e)return"";Array.isArray(e)||(e=[String(e)]);var s=void 0!==n.returnDetails?n.returnDetails:this.options.returnDetails,a=void 0!==n.keySeparator?n.keySeparator:this.options.keySeparator,r=this.extractFromKey(e[e.length-1],n),c=r.key,u=r.namespaces,l=u[u.length-1],d=n.lng||this.language,p=n.appendNamespaceToCIMode||this.options.appendNamespaceToCIMode;if(d&&"cimode"===d.toLowerCase()){if(p){var h=n.nsSeparator||this.options.nsSeparator;return s?{res:"".concat(l).concat(h).concat(c),usedKey:c,exactUsedKey:c,usedLng:d,usedNS:l}:"".concat(l).concat(h).concat(c)}return s?{res:c,usedKey:c,exactUsedKey:c,usedLng:d,usedNS:l}:c}var g=this.resolve(e,n),_=g&&g.res,f=g&&g.usedKey||c,m=g&&g.exactUsedKey||c,v=Object.prototype.toString.apply(_),y=void 0!==n.joinArrays?n.joinArrays:this.options.joinArrays,I=!this.i18nFormat||this.i18nFormat.handleAsObject;if(I&&_&&"string"!=typeof _&&"boolean"!=typeof _&&"number"!=typeof _&&["[object Number]","[object Function]","[object RegExp]"].indexOf(v)<0&&("string"!=typeof y||"[object Array]"!==v)){if(!n.returnObjects&&!this.options.returnObjects){this.options.returnedObjectHandler||this.logger.warn("accessing an object - but returnObjects options is not enabled!");var M=this.options.returnedObjectHandler?this.options.returnedObjectHandler(f,_,el(el({},n),{},{ns:u})):"key '".concat(c," (").concat(this.language,")' returned an object instead of string.");return s?(g.res=M,g):M}if(a){var C="[object Array]"===v,T=C?[]:{},E=C?m:f;for(var S in _)if(Object.prototype.hasOwnProperty.call(_,S)){var D="".concat(E).concat(a).concat(S);T[S]=this.translate(D,el(el({},n),{joinArrays:!1,ns:u})),T[S]===D&&(T[S]=_[S])}_=T}}else if(I&&"string"==typeof y&&"[object Array]"===v)(_=_.join(y))&&(_=this.extendTranslation(_,e,n,o));else{var k=!1,R=!1,L=void 0!==n.count&&"string"!=typeof n.count,A=t.hasDefaultValue(n),O=L?this.pluralResolver.getSuffix(d,n.count,n):"",N=n["defaultValue".concat(O)]||n.defaultValue;!this.isValidLookup(_)&&A&&(k=!0,_=N),this.isValidLookup(_)||(R=!0,_=c);var P=(n.missingKeyNoValueFallbackToKey||this.options.missingKeyNoValueFallbackToKey)&&R?void 0:_,b=A&&N!==_&&this.options.updateMissing;if(R||k||b){if(this.logger.log(b?"updateKey":"missingKey",d,l,c,b?N:_),a){var U=this.resolve(c,el(el({},n),{},{keySeparator:!1}));U&&U.res&&this.logger.warn("Seems the loaded translations were in flat JSON format instead of nested. Either set keySeparator: false on init or make sure your translations are published in nested format.")}var G=[],w=this.languageUtils.getFallbackCodes(this.options.fallbackLng,n.lng||this.language);if("fallback"===this.options.saveMissingTo&&w&&w[0])for(var F=0;F<w.length;F++)G.push(w[F]);else"all"===this.options.saveMissingTo?G=this.languageUtils.toResolveHierarchy(n.lng||this.language):G.push(n.lng||this.language);var x=function(e,t,o){var s=A&&o!==_?o:P;i.options.missingKeyHandler?i.options.missingKeyHandler(e,l,t,s,b,n):i.backendConnector&&i.backendConnector.saveMissing&&i.backendConnector.saveMissing(e,l,t,s,b,n),i.emit("missingKey",e,l,t,_)};this.options.saveMissing&&(this.options.saveMissingPlurals&&L?G.forEach((function(e){i.pluralResolver.getSuffixes(e,n).forEach((function(t){x([e],c+t,n["defaultValue".concat(t)]||N)}))})):x(G,c,N))}_=this.extendTranslation(_,e,n,g,o),R&&_===c&&this.options.appendNamespaceToMissingKey&&(_="".concat(l,":").concat(c)),(R||k)&&this.options.parseMissingKeyHandler&&(_="v1"!==this.options.compatibilityAPI?this.options.parseMissingKeyHandler(this.options.appendNamespaceToMissingKey?"".concat(l,":").concat(c):c,k?_:void 0):this.options.parseMissingKeyHandler(_))}return s?(g.res=_,g):_}},{key:"extendTranslation",value:function(e,t,n,o,i){var s=this;if(this.i18nFormat&&this.i18nFormat.parse)e=this.i18nFormat.parse(e,el(el({},this.options.interpolation.defaultVariables),n),o.usedLng,o.usedNS,o.usedKey,{resolved:o});else if(!n.skipInterpolation){n.interpolation&&this.interpolator.init(el(el({},n),{interpolation:el(el({},this.options.interpolation),n.interpolation)}));var a,r="string"==typeof e&&(n&&n.interpolation&&void 0!==n.interpolation.skipOnVariables?n.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables);if(r){var c=e.match(this.interpolator.nestingRegexp);a=c&&c.length}var u=n.replace&&"string"!=typeof n.replace?n.replace:n;if(this.options.interpolation.defaultVariables&&(u=el(el({},this.options.interpolation.defaultVariables),u)),e=this.interpolator.interpolate(e,u,n.lng||this.language,n),r){var l=e.match(this.interpolator.nestingRegexp);a<(l&&l.length)&&(n.nest=!1)}!n.lng&&"v1"!==this.options.compatibilityAPI&&o&&o.res&&(n.lng=o.usedLng),!1!==n.nest&&(e=this.interpolator.nest(e,(function(){for(var e=arguments.length,o=new Array(e),a=0;a<e;a++)o[a]=arguments[a];return i&&i[0]===o[0]&&!n.context?(s.logger.warn("It seems you are nesting recursively key: ".concat(o[0]," in key: ").concat(t[0])),null):s.translate.apply(s,o.concat([t]))}),n)),n.interpolation&&this.interpolator.reset()}var d=n.postProcess||this.options.postProcess,p="string"==typeof d?[d]:d;return null!=e&&p&&p.length&&!1!==n.applyPostProcessor&&(e=Zu.handle(p,e,t,this.options&&this.options.postProcessPassResolved?el({i18nResolved:o},n):n,this)),e}},{key:"resolve",value:function(e){var t,n,o,i,s,a=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return"string"==typeof e&&(e=[e]),e.forEach((function(e){if(!a.isValidLookup(t)){var c=a.extractFromKey(e,r),u=c.key;n=u;var l=c.namespaces;a.options.fallbackNS&&(l=l.concat(a.options.fallbackNS));var d=void 0!==r.count&&"string"!=typeof r.count,p=d&&!r.ordinal&&0===r.count&&a.pluralResolver.shouldUseIntlApi(),h=void 0!==r.context&&("string"==typeof r.context||"number"==typeof r.context)&&""!==r.context,g=r.lngs?r.lngs:a.languageUtils.toResolveHierarchy(r.lng||a.language,r.fallbackLng);l.forEach((function(e){a.isValidLookup(t)||(s=e,!tl["".concat(g[0],"-").concat(e)]&&a.utils&&a.utils.hasLoadedNamespace&&!a.utils.hasLoadedNamespace(s)&&(tl["".concat(g[0],"-").concat(e)]=!0,a.logger.warn('key "'.concat(n,'" for languages "').concat(g.join(", "),'" won\'t get resolved as namespace "').concat(s,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!")),g.forEach((function(n){if(!a.isValidLookup(t)){i=n;var s,c=[u];if(a.i18nFormat&&a.i18nFormat.addLookupKeys)a.i18nFormat.addLookupKeys(c,u,n,e,r);else{var l;d&&(l=a.pluralResolver.getSuffix(n,r.count,r));var g="".concat(a.options.pluralSeparator,"zero");if(d&&(c.push(u+l),p&&c.push(u+g)),h){var _="".concat(u).concat(a.options.contextSeparator).concat(r.context);c.push(_),d&&(c.push(_+l),p&&c.push(_+g))}}for(;s=c.pop();)a.isValidLookup(t)||(o=s,t=a.getResource(n,e,s,r))}})))}))}})),{res:t,usedKey:n,exactUsedKey:o,usedLng:i,usedNS:s}}},{key:"isValidLookup",value:function(e){return!(void 0===e||!this.options.returnNull&&null===e||!this.options.returnEmptyString&&""===e)}},{key:"getResource",value:function(e,t,n){var o=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this.i18nFormat&&this.i18nFormat.getResource?this.i18nFormat.getResource(e,t,n,o):this.resourceStore.getResource(e,t,n,o)}}],[{key:"hasDefaultValue",value:function(e){for(var t in e)if(Object.prototype.hasOwnProperty.call(e,t)&&"defaultValue"===t.substring(0,12)&&void 0!==e[t])return!0;return!1}}]),t}();function ol(e){return e.charAt(0).toUpperCase()+e.slice(1)}var il=function(){function e(t){Mu(this,e),this.options=t,this.supportedLngs=this.options.supportedLngs||!1,this.logger=Uu.create("languageUtils")}return Eu(e,[{key:"getScriptPartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return null;var t=e.split("-");return 2===t.length?null:(t.pop(),"x"===t[t.length-1].toLowerCase()?null:this.formatLanguageCode(t.join("-")))}},{key:"getLanguagePartFromCode",value:function(e){if(!e||e.indexOf("-")<0)return e;var t=e.split("-");return this.formatLanguageCode(t[0])}},{key:"formatLanguageCode",value:function(e){if("string"==typeof e&&e.indexOf("-")>-1){var t=["hans","hant","latn","cyrl","cans","mong","arab"],n=e.split("-");return this.options.lowerCaseLng?n=n.map((function(e){return e.toLowerCase()})):2===n.length?(n[0]=n[0].toLowerCase(),n[1]=n[1].toUpperCase(),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=ol(n[1].toLowerCase()))):3===n.length&&(n[0]=n[0].toLowerCase(),2===n[1].length&&(n[1]=n[1].toUpperCase()),"sgn"!==n[0]&&2===n[2].length&&(n[2]=n[2].toUpperCase()),t.indexOf(n[1].toLowerCase())>-1&&(n[1]=ol(n[1].toLowerCase())),t.indexOf(n[2].toLowerCase())>-1&&(n[2]=ol(n[2].toLowerCase()))),n.join("-")}return this.options.cleanCode||this.options.lowerCaseLng?e.toLowerCase():e}},{key:"isSupportedCode",value:function(e){return("languageOnly"===this.options.load||this.options.nonExplicitSupportedLngs)&&(e=this.getLanguagePartFromCode(e)),!this.supportedLngs||!this.supportedLngs.length||this.supportedLngs.indexOf(e)>-1}},{key:"getBestMatchFromCodes",value:function(e){var t,n=this;return e?(e.forEach((function(e){if(!t){var o=n.formatLanguageCode(e);n.options.supportedLngs&&!n.isSupportedCode(o)||(t=o)}})),!t&&this.options.supportedLngs&&e.forEach((function(e){if(!t){var o=n.getLanguagePartFromCode(e);if(n.isSupportedCode(o))return t=o;t=n.options.supportedLngs.find((function(e){return e===o?e:e.indexOf("-")<0&&o.indexOf("-")<0?void 0:0===e.indexOf(o)?e:void 0}))}})),t||(t=this.getFallbackCodes(this.options.fallbackLng)[0]),t):null}},{key:"getFallbackCodes",value:function(e,t){if(!e)return[];if("function"==typeof e&&(e=e(t)),"string"==typeof e&&(e=[e]),"[object Array]"===Object.prototype.toString.apply(e))return e;if(!t)return e.default||[];var n=e[t];return n||(n=e[this.getScriptPartFromCode(t)]),n||(n=e[this.formatLanguageCode(t)]),n||(n=e[this.getLanguagePartFromCode(t)]),n||(n=e.default),n||[]}},{key:"toResolveHierarchy",value:function(e,t){var n=this,o=this.getFallbackCodes(t||this.options.fallbackLng||[],e),i=[],s=function(e){e&&(n.isSupportedCode(e)?i.push(e):n.logger.warn("rejecting language code not found in supportedLngs: ".concat(e)))};return"string"==typeof e&&e.indexOf("-")>-1?("languageOnly"!==this.options.load&&s(this.formatLanguageCode(e)),"languageOnly"!==this.options.load&&"currentOnly"!==this.options.load&&s(this.getScriptPartFromCode(e)),"currentOnly"!==this.options.load&&s(this.getLanguagePartFromCode(e))):"string"==typeof e&&s(this.formatLanguageCode(e)),o.forEach((function(e){i.indexOf(e)<0&&s(n.formatLanguageCode(e))})),i}}]),e}(),sl=[{lngs:["ach","ak","am","arn","br","fil","gun","ln","mfe","mg","mi","oc","pt","pt-BR","tg","tl","ti","tr","uz","wa"],nr:[1,2],fc:1},{lngs:["af","an","ast","az","bg","bn","ca","da","de","dev","el","en","eo","es","et","eu","fi","fo","fur","fy","gl","gu","ha","hi","hu","hy","ia","it","kk","kn","ku","lb","mai","ml","mn","mr","nah","nap","nb","ne","nl","nn","no","nso","pa","pap","pms","ps","pt-PT","rm","sco","se","si","so","son","sq","sv","sw","ta","te","tk","ur","yo"],nr:[1,2],fc:2},{lngs:["ay","bo","cgg","fa","ht","id","ja","jbo","ka","km","ko","ky","lo","ms","sah","su","th","tt","ug","vi","wo","zh"],nr:[1],fc:3},{lngs:["be","bs","cnr","dz","hr","ru","sr","uk"],nr:[1,2,5],fc:4},{lngs:["ar"],nr:[0,1,2,3,11,100],fc:5},{lngs:["cs","sk"],nr:[1,2,5],fc:6},{lngs:["csb","pl"],nr:[1,2,5],fc:7},{lngs:["cy"],nr:[1,2,3,8],fc:8},{lngs:["fr"],nr:[1,2],fc:9},{lngs:["ga"],nr:[1,2,3,7,11],fc:10},{lngs:["gd"],nr:[1,2,3,20],fc:11},{lngs:["is"],nr:[1,2],fc:12},{lngs:["jv"],nr:[0,1],fc:13},{lngs:["kw"],nr:[1,2,3,4],fc:14},{lngs:["lt"],nr:[1,2,10],fc:15},{lngs:["lv"],nr:[1,2,0],fc:16},{lngs:["mk"],nr:[1,2],fc:17},{lngs:["mnk"],nr:[0,1,2],fc:18},{lngs:["mt"],nr:[1,2,11,20],fc:19},{lngs:["or"],nr:[2,1],fc:2},{lngs:["ro"],nr:[1,2,20],fc:20},{lngs:["sl"],nr:[5,1,2,3],fc:21},{lngs:["he","iw"],nr:[1,2,20,21],fc:22}],al={1:function(e){return Number(e>1)},2:function(e){return Number(1!=e)},3:function(e){return 0},4:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},5:function(e){return Number(0==e?0:1==e?1:2==e?2:e%100>=3&&e%100<=10?3:e%100>=11?4:5)},6:function(e){return Number(1==e?0:e>=2&&e<=4?1:2)},7:function(e){return Number(1==e?0:e%10>=2&&e%10<=4&&(e%100<10||e%100>=20)?1:2)},8:function(e){return Number(1==e?0:2==e?1:8!=e&&11!=e?2:3)},9:function(e){return Number(e>=2)},10:function(e){return Number(1==e?0:2==e?1:e<7?2:e<11?3:4)},11:function(e){return Number(1==e||11==e?0:2==e||12==e?1:e>2&&e<20?2:3)},12:function(e){return Number(e%10!=1||e%100==11)},13:function(e){return Number(0!==e)},14:function(e){return Number(1==e?0:2==e?1:3==e?2:3)},15:function(e){return Number(e%10==1&&e%100!=11?0:e%10>=2&&(e%100<10||e%100>=20)?1:2)},16:function(e){return Number(e%10==1&&e%100!=11?0:0!==e?1:2)},17:function(e){return Number(1==e||e%10==1&&e%100!=11?0:1)},18:function(e){return Number(0==e?0:1==e?1:2)},19:function(e){return Number(1==e?0:0==e||e%100>1&&e%100<11?1:e%100>10&&e%100<20?2:3)},20:function(e){return Number(1==e?0:0==e||e%100>0&&e%100<20?1:2)},21:function(e){return Number(e%100==1?1:e%100==2?2:e%100==3||e%100==4?3:0)},22:function(e){return Number(1==e?0:2==e?1:(e<0||e>10)&&e%10==0?2:3)}},rl=["v1","v2","v3"],cl={zero:0,one:1,two:2,few:3,many:4,other:5},ul=function(){function e(t){var n,o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Mu(this,e),this.languageUtils=t,this.options=o,this.logger=Uu.create("pluralResolver"),this.options.compatibilityJSON&&"v4"!==this.options.compatibilityJSON||"undefined"!=typeof Intl&&Intl.PluralRules||(this.options.compatibilityJSON="v3",this.logger.error("Your environment seems not to be Intl API compatible, use an Intl.PluralRules polyfill. Will fallback to the compatibilityJSON v3 format handling.")),this.rules=(n={},sl.forEach((function(e){e.lngs.forEach((function(t){n[t]={numbers:e.nr,plurals:al[e.fc]}}))})),n)}return Eu(e,[{key:"addRule",value:function(e,t){this.rules[e]=t}},{key:"getRule",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this.shouldUseIntlApi())try{return new Intl.PluralRules(e,{type:t.ordinal?"ordinal":"cardinal"})}catch(n){return}return this.rules[e]||this.rules[this.languageUtils.getLanguagePartFromCode(e)]}},{key:"needsPlural",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=this.getRule(e,t);return this.shouldUseIntlApi()?n&&n.resolvedOptions().pluralCategories.length>1:n&&n.numbers.length>1}},{key:"getPluralFormsOfKey",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this.getSuffixes(e,n).map((function(e){return"".concat(t).concat(e)}))}},{key:"getSuffixes",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=this.getRule(e,n);return o?this.shouldUseIntlApi()?o.resolvedOptions().pluralCategories.sort((function(e,t){return cl[e]-cl[t]})).map((function(e){return"".concat(t.options.prepend).concat(e)})):o.numbers.map((function(o){return t.getSuffix(e,o,n)})):[]}},{key:"getSuffix",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},o=this.getRule(e,n);return o?this.shouldUseIntlApi()?"".concat(this.options.prepend).concat(o.select(t)):this.getSuffixRetroCompatible(o,t):(this.logger.warn("no plural rule found for: ".concat(e)),"")}},{key:"getSuffixRetroCompatible",value:function(e,t){var n=this,o=e.noAbs?e.plurals(t):e.plurals(Math.abs(t)),i=e.numbers[o];this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]&&(2===i?i="plural":1===i&&(i=""));var s=function(){return n.options.prepend&&i.toString()?n.options.prepend+i.toString():i.toString()};return"v1"===this.options.compatibilityJSON?1===i?"":"number"==typeof i?"_plural_".concat(i.toString()):s():"v2"===this.options.compatibilityJSON||this.options.simplifyPluralSuffix&&2===e.numbers.length&&1===e.numbers[0]?s():this.options.prepend&&o.toString()?this.options.prepend+o.toString():o.toString()}},{key:"shouldUseIntlApi",value:function(){return!rl.includes(this.options.compatibilityJSON)}}]),e}();function ll(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function dl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ll(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ll(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pl(e,t,n){var o,i,s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:".",r=!(arguments.length>4&&void 0!==arguments[4])||arguments[4],c=(o=t,void 0!==(s=qu(e,i=n))?s:qu(o,i));return!c&&r&&"string"==typeof n&&void 0===(c=Wu(e,n,a))&&(c=Wu(t,n,a)),c}var hl=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Mu(this,e),this.logger=Uu.create("interpolator"),this.options=t,this.format=t.interpolation&&t.interpolation.format||function(e){return e},this.init(t)}return Eu(e,[{key:"init",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};e.interpolation||(e.interpolation={escapeValue:!0});var t=e.interpolation;this.escape=void 0!==t.escape?t.escape:Ku,this.escapeValue=void 0===t.escapeValue||t.escapeValue,this.useRawValueToEscape=void 0!==t.useRawValueToEscape&&t.useRawValueToEscape,this.prefix=t.prefix?Hu(t.prefix):t.prefixEscaped||"{{",this.suffix=t.suffix?Hu(t.suffix):t.suffixEscaped||"}}",this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||",",this.unescapePrefix=t.unescapeSuffix?"":t.unescapePrefix||"-",this.unescapeSuffix=this.unescapePrefix?"":t.unescapeSuffix||"",this.nestingPrefix=t.nestingPrefix?Hu(t.nestingPrefix):t.nestingPrefixEscaped||Hu("$t("),this.nestingSuffix=t.nestingSuffix?Hu(t.nestingSuffix):t.nestingSuffixEscaped||Hu(")"),this.nestingOptionsSeparator=t.nestingOptionsSeparator?t.nestingOptionsSeparator:t.nestingOptionsSeparator||",",this.maxReplaces=t.maxReplaces?t.maxReplaces:1e3,this.alwaysFormat=void 0!==t.alwaysFormat&&t.alwaysFormat,this.resetRegExp()}},{key:"reset",value:function(){this.options&&this.init(this.options)}},{key:"resetRegExp",value:function(){var e="".concat(this.prefix,"(.+?)").concat(this.suffix);this.regexp=new RegExp(e,"g");var t="".concat(this.prefix).concat(this.unescapePrefix,"(.+?)").concat(this.unescapeSuffix).concat(this.suffix);this.regexpUnescape=new RegExp(t,"g");var n="".concat(this.nestingPrefix,"(.+?)").concat(this.nestingSuffix);this.nestingRegexp=new RegExp(n,"g")}},{key:"interpolate",value:function(e,t,n,o){var i,s,a,r=this,c=this.options&&this.options.interpolation&&this.options.interpolation.defaultVariables||{};function u(e){return e.replace(/\$/g,"$$$$")}var l=function(e){if(e.indexOf(r.formatSeparator)<0){var i=pl(t,c,e,r.options.keySeparator,r.options.ignoreJSONStructure);return r.alwaysFormat?r.format(i,void 0,n,dl(dl(dl({},o),t),{},{interpolationkey:e})):i}var s=e.split(r.formatSeparator),a=s.shift().trim(),u=s.join(r.formatSeparator).trim();return r.format(pl(t,c,a,r.options.keySeparator,r.options.ignoreJSONStructure),u,n,dl(dl(dl({},o),t),{},{interpolationkey:a}))};this.resetRegExp();var d=o&&o.missingInterpolationHandler||this.options.missingInterpolationHandler,p=o&&o.interpolation&&void 0!==o.interpolation.skipOnVariables?o.interpolation.skipOnVariables:this.options.interpolation.skipOnVariables;return[{regex:this.regexpUnescape,safeValue:function(e){return u(e)}},{regex:this.regexp,safeValue:function(e){return r.escapeValue?u(r.escape(e)):u(e)}}].forEach((function(t){for(a=0;i=t.regex.exec(e);){var n=i[1].trim();if(void 0===(s=l(n)))if("function"==typeof d){var c=d(e,i,o);s="string"==typeof c?c:""}else if(o&&Object.prototype.hasOwnProperty.call(o,n))s="";else{if(p){s=i[0];continue}r.logger.warn("missed to pass in variable ".concat(n," for interpolating ").concat(e)),s=""}else"string"==typeof s||r.useRawValueToEscape||(s=Fu(s));var u=t.safeValue(s);if(e=e.replace(i[0],u),p?(t.regex.lastIndex+=s.length,t.regex.lastIndex-=i[0].length):t.regex.lastIndex=0,++a>=r.maxReplaces)break}})),e}},{key:"nest",value:function(e,t){var n,o,i,s=this,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};function r(e,t){var n=this.nestingOptionsSeparator;if(e.indexOf(n)<0)return e;var o=e.split(new RegExp("".concat(n,"[ ]*{"))),s="{".concat(o[1]);e=o[0];var a=(s=this.interpolate(s,i)).match(/'/g),r=s.match(/"/g);(a&&a.length%2==0&&!r||r.length%2!=0)&&(s=s.replace(/'/g,'"'));try{i=JSON.parse(s),t&&(i=dl(dl({},t),i))}catch(c){return this.logger.warn("failed parsing options string in nesting for key ".concat(e),c),"".concat(e).concat(n).concat(s)}return delete i.defaultValue,e}for(;n=this.nestingRegexp.exec(e);){var c=[];(i=(i=dl({},a)).replace&&"string"!=typeof i.replace?i.replace:i).applyPostProcessor=!1,delete i.defaultValue;var u=!1;if(-1!==n[0].indexOf(this.formatSeparator)&&!/{.*}/.test(n[1])){var l=n[1].split(this.formatSeparator).map((function(e){return e.trim()}));n[1]=l.shift(),c=l,u=!0}if((o=t(r.call(this,n[1].trim(),i),i))&&n[0]===e&&"string"!=typeof o)return o;"string"!=typeof o&&(o=Fu(o)),o||(this.logger.warn("missed to resolve ".concat(n[1]," for nesting ").concat(e)),o=""),u&&(o=c.reduce((function(e,t){return s.format(e,t,a.lng,dl(dl({},a),{},{interpolationkey:n[1].trim()}))}),o.trim())),e=e.replace(n[0],o),this.regexp.lastIndex=0}return e}}]),e}();function gl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function _l(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?gl(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function fl(e){var t={};return function(n,o,i){var s=o+JSON.stringify(i),a=t[s];return a||(a=e(o,i),t[s]=a),a(n)}}var ml=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Mu(this,e),this.logger=Uu.create("formatter"),this.options=t,this.formats={number:fl((function(e,t){var n=new Intl.NumberFormat(e,_l({},t));return function(e){return n.format(e)}})),currency:fl((function(e,t){var n=new Intl.NumberFormat(e,_l(_l({},t),{},{style:"currency"}));return function(e){return n.format(e)}})),datetime:fl((function(e,t){var n=new Intl.DateTimeFormat(e,_l({},t));return function(e){return n.format(e)}})),relativetime:fl((function(e,t){var n=new Intl.RelativeTimeFormat(e,_l({},t));return function(e){return n.format(e,t.range||"day")}})),list:fl((function(e,t){var n=new Intl.ListFormat(e,_l({},t));return function(e){return n.format(e)}}))},this.init(t)}return Eu(e,[{key:"init",value:function(e){var t=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:{interpolation:{}}).interpolation;this.formatSeparator=t.formatSeparator?t.formatSeparator:t.formatSeparator||","}},{key:"add",value:function(e,t){this.formats[e.toLowerCase().trim()]=t}},{key:"addCached",value:function(e,t){this.formats[e.toLowerCase().trim()]=fl(t)}},{key:"format",value:function(e,t,n){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return t.split(this.formatSeparator).reduce((function(e,t){var s=function(e){var t=e.toLowerCase().trim(),n={};if(e.indexOf("(")>-1){var o=e.split("(");t=o[0].toLowerCase().trim();var i=o[1].substring(0,o[1].length-1);"currency"===t&&i.indexOf(":")<0?n.currency||(n.currency=i.trim()):"relativetime"===t&&i.indexOf(":")<0?n.range||(n.range=i.trim()):i.split(";").forEach((function(e){if(e){var t=function(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(e){if("string"==typeof e)return Ou(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ou(e,t):void 0}}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}(e.split(":")),o=t[0],i=t.slice(1).join(":").trim().replace(/^'+|'+$/g,"");n[o.trim()]||(n[o.trim()]=i),"false"===i&&(n[o.trim()]=!1),"true"===i&&(n[o.trim()]=!0),isNaN(i)||(n[o.trim()]=parseInt(i,10))}}))}return{formatName:t,formatOptions:n}}(t),a=s.formatName,r=s.formatOptions;if(o.formats[a]){var c=e;try{var u=i&&i.formatParams&&i.formatParams[i.interpolationkey]||{},l=u.locale||u.lng||i.locale||i.lng||n;c=o.formats[a](e,l,_l(_l(_l({},r),i),u))}catch(d){o.logger.warn(d)}return c}return o.logger.warn("there was no format function for ".concat(a)),e}),e)}}]),e}();function vl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function yl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vl(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Il=function(){ku(t,Gu);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Lu(e);if(t){var i=Lu(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return Ru(this,n)}}(t);function t(n,o,i){var s,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Mu(this,t),s=e.call(this),Yu&&Gu.call(Su(s)),s.backend=n,s.store=o,s.services=i,s.languageUtils=i.languageUtils,s.options=a,s.logger=Uu.create("backendConnector"),s.waitingReads=[],s.maxParallelReads=a.maxParallelReads||10,s.readingCalls=0,s.maxRetries=a.maxRetries>=0?a.maxRetries:5,s.retryTimeout=a.retryTimeout>=1?a.retryTimeout:350,s.state={},s.queue=[],s.backend&&s.backend.init&&s.backend.init(i,a.backend,a),s}return Eu(t,[{key:"queueLoad",value:function(e,t,n,o){var i=this,s={},a={},r={},c={};return e.forEach((function(e){var o=!0;t.forEach((function(t){var r="".concat(e,"|").concat(t);!n.reload&&i.store.hasResourceBundle(e,t)?i.state[r]=2:i.state[r]<0||(1===i.state[r]?void 0===a[r]&&(a[r]=!0):(i.state[r]=1,o=!1,void 0===a[r]&&(a[r]=!0),void 0===s[r]&&(s[r]=!0),void 0===c[t]&&(c[t]=!0)))})),o||(r[e]=!0)})),(Object.keys(s).length||Object.keys(a).length)&&this.queue.push({pending:a,pendingCount:Object.keys(a).length,loaded:{},errors:[],callback:o}),{toLoad:Object.keys(s),pending:Object.keys(a),toLoadLanguages:Object.keys(r),toLoadNamespaces:Object.keys(c)}}},{key:"loaded",value:function(e,t,n){var o=e.split("|"),i=o[0],s=o[1];t&&this.emit("failedLoading",i,s,t),n&&this.store.addResourceBundle(i,s,n),this.state[e]=t?-1:2;var a={};this.queue.forEach((function(n){var o,r,c,u,l,d,p;o=n.loaded,r=s,(u=(c=xu(o,[i],Object)).obj)[l=c.k]=u[l]||[],u[l].push(r),p=e,void 0!==(d=n).pending[p]&&(delete d.pending[p],d.pendingCount--),t&&n.errors.push(t),0!==n.pendingCount||n.done||(Object.keys(n.loaded).forEach((function(e){a[e]||(a[e]={});var t=n.loaded[e];t.length&&t.forEach((function(t){void 0===a[e][t]&&(a[e][t]=!0)}))})),n.done=!0,n.errors.length?n.callback(n.errors):n.callback())})),this.emit("loaded",a),this.queue=this.queue.filter((function(e){return!e.done}))}},{key:"read",value:function(e,t,n){var o=this,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:this.retryTimeout,a=arguments.length>5?arguments[5]:void 0;if(!e.length)return a(null,{});if(this.readingCalls>=this.maxParallelReads)this.waitingReads.push({lng:e,ns:t,fcName:n,tried:i,wait:s,callback:a});else{this.readingCalls++;var r=function(r,c){if(o.readingCalls--,o.waitingReads.length>0){var u=o.waitingReads.shift();o.read(u.lng,u.ns,u.fcName,u.tried,u.wait,u.callback)}r&&c&&i<o.maxRetries?setTimeout((function(){o.read.call(o,e,t,n,i+1,2*s,a)}),s):a(r,c)},c=this.backend[n].bind(this.backend);if(2!==c.length)return c(e,t,r);try{var u=c(e,t);u&&"function"==typeof u.then?u.then((function(e){return r(null,e)})).catch(r):r(null,u)}catch(l){r(l)}}}},{key:"prepareLoading",value:function(e,t){var n=this,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=arguments.length>3?arguments[3]:void 0;if(!this.backend)return this.logger.warn("No backend was added via i18next.use. Will not load resources."),i&&i();"string"==typeof e&&(e=this.languageUtils.toResolveHierarchy(e)),"string"==typeof t&&(t=[t]);var s=this.queueLoad(e,t,o,i);if(!s.toLoad.length)return s.pending.length||i(),null;s.toLoad.forEach((function(e){n.loadOne(e)}))}},{key:"load",value:function(e,t,n){this.prepareLoading(e,t,{},n)}},{key:"reload",value:function(e,t,n){this.prepareLoading(e,t,{reload:!0},n)}},{key:"loadOne",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",o=e.split("|"),i=o[0],s=o[1];this.read(i,s,"read",void 0,void 0,(function(o,a){o&&t.logger.warn("".concat(n,"loading namespace ").concat(s," for language ").concat(i," failed"),o),!o&&a&&t.logger.log("".concat(n,"loaded namespace ").concat(s," for language ").concat(i),a),t.loaded(e,o,a)}))}},{key:"saveMissing",value:function(e,t,n,o,i){var s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{},a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:function(){};if(this.services.utils&&this.services.utils.hasLoadedNamespace&&!this.services.utils.hasLoadedNamespace(t))this.logger.warn('did not save key "'.concat(n,'" as the namespace "').concat(t,'" was not yet loaded'),"This means something IS WRONG in your setup. You access the t function before i18next.init / i18next.loadNamespace / i18next.changeLanguage was done. Wait for the callback or Promise to resolve before accessing it!!!");else if(null!=n&&""!==n){if(this.backend&&this.backend.create){var r=yl(yl({},s),{},{isUpdate:i}),c=this.backend.create.bind(this.backend);if(c.length<6)try{var u;(u=5===c.length?c(e,t,n,o,r):c(e,t,n,o))&&"function"==typeof u.then?u.then((function(e){return a(null,e)})).catch(a):a(null,u)}catch(l){a(l)}else c(e,t,n,o,a,r)}e&&e[0]&&this.store.addResource(e[0],t,n,o)}}}]),t}();function Ml(){return{debug:!1,initImmediate:!0,ns:["translation"],defaultNS:["translation"],fallbackLng:["dev"],fallbackNS:!1,supportedLngs:!1,nonExplicitSupportedLngs:!1,load:"all",preload:!1,simplifyPluralSuffix:!0,keySeparator:".",nsSeparator:":",pluralSeparator:"_",contextSeparator:"_",partialBundledLanguages:!1,saveMissing:!1,updateMissing:!1,saveMissingTo:"fallback",saveMissingPlurals:!0,missingKeyHandler:!1,missingInterpolationHandler:!1,postProcess:!1,postProcessPassResolved:!1,returnNull:!0,returnEmptyString:!0,returnObjects:!1,joinArrays:!1,returnedObjectHandler:!1,parseMissingKeyHandler:!1,appendNamespaceToMissingKey:!1,appendNamespaceToCIMode:!1,overloadTranslationOptionHandler:function(e){var t={};if("object"===Iu(e[1])&&(t=e[1]),"string"==typeof e[1]&&(t.defaultValue=e[1]),"string"==typeof e[2]&&(t.tDescription=e[2]),"object"===Iu(e[2])||"object"===Iu(e[3])){var n=e[3]||e[2];Object.keys(n).forEach((function(e){t[e]=n[e]}))}return t},interpolation:{escapeValue:!0,format:function(e,t,n,o){return e},prefix:"{{",suffix:"}}",formatSeparator:",",unescapePrefix:"-",nestingPrefix:"$t(",nestingSuffix:")",nestingOptionsSeparator:",",maxReplaces:1e3,skipOnVariables:!0}}}function Cl(e){return"string"==typeof e.ns&&(e.ns=[e.ns]),"string"==typeof e.fallbackLng&&(e.fallbackLng=[e.fallbackLng]),"string"==typeof e.fallbackNS&&(e.fallbackNS=[e.fallbackNS]),e.supportedLngs&&e.supportedLngs.indexOf("cimode")<0&&(e.supportedLngs=e.supportedLngs.concat(["cimode"])),e}function Tl(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function El(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tl(Object(n),!0).forEach((function(t){Au(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tl(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Sl(){}var Dl=function(){ku(t,Gu);var e=function(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=Lu(e);if(t){var i=Lu(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return Ru(this,n)}}(t);function t(){var n,o,i=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},s=arguments.length>1?arguments[1]:void 0;if(Mu(this,t),n=e.call(this),Yu&&Gu.call(Su(n)),n.options=Cl(i),n.services={},n.logger=Uu,n.modules={external:[]},o=Su(n),Object.getOwnPropertyNames(Object.getPrototypeOf(o)).forEach((function(e){"function"==typeof o[e]&&(o[e]=o[e].bind(o))})),s&&!n.isInitialized&&!i.isClone){if(!n.options.initImmediate)return n.init(i,s),Ru(n,Su(n));setTimeout((function(){n.init(i,s)}),0)}return n}return Eu(t,[{key:"init",value:function(){var e=this,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=arguments.length>1?arguments[1]:void 0;"function"==typeof t&&(n=t,t={}),!t.defaultNS&&!1!==t.defaultNS&&t.ns&&("string"==typeof t.ns?t.defaultNS=t.ns:t.ns.indexOf("translation")<0&&(t.defaultNS=t.ns[0]));var o=Ml();function i(e){return e?"function"==typeof e?new e:e:null}if(this.options=El(El(El({},o),this.options),Cl(t)),"v1"!==this.options.compatibilityAPI&&(this.options.interpolation=El(El({},o.interpolation),this.options.interpolation)),void 0!==t.keySeparator&&(this.options.userDefinedKeySeparator=t.keySeparator),void 0!==t.nsSeparator&&(this.options.userDefinedNsSeparator=t.nsSeparator),!this.options.isClone){var s;this.modules.logger?Uu.init(i(this.modules.logger),this.options):Uu.init(null,this.options),this.modules.formatter?s=this.modules.formatter:"undefined"!=typeof Intl&&(s=ml);var a=new il(this.options);this.store=new Xu(this.options.resources,this.options);var r=this.services;r.logger=Uu,r.resourceStore=this.store,r.languageUtils=a,r.pluralResolver=new ul(a,{prepend:this.options.pluralSeparator,compatibilityJSON:this.options.compatibilityJSON,simplifyPluralSuffix:this.options.simplifyPluralSuffix}),!s||this.options.interpolation.format&&this.options.interpolation.format!==o.interpolation.format||(r.formatter=i(s),r.formatter.init(r,this.options),this.options.interpolation.format=r.formatter.format.bind(r.formatter)),r.interpolator=new hl(this.options),r.utils={hasLoadedNamespace:this.hasLoadedNamespace.bind(this)},r.backendConnector=new Il(i(this.modules.backend),r.resourceStore,r,this.options),r.backendConnector.on("*",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];e.emit.apply(e,[t].concat(o))})),this.modules.languageDetector&&(r.languageDetector=i(this.modules.languageDetector),r.languageDetector.init&&r.languageDetector.init(r,this.options.detection,this.options)),this.modules.i18nFormat&&(r.i18nFormat=i(this.modules.i18nFormat),r.i18nFormat.init&&r.i18nFormat.init(this)),this.translator=new nl(this.services,this.options),this.translator.on("*",(function(t){for(var n=arguments.length,o=new Array(n>1?n-1:0),i=1;i<n;i++)o[i-1]=arguments[i];e.emit.apply(e,[t].concat(o))})),this.modules.external.forEach((function(t){t.init&&t.init(e)}))}if(this.format=this.options.interpolation.format,n||(n=Sl),this.options.fallbackLng&&!this.services.languageDetector&&!this.options.lng){var c=this.services.languageUtils.getFallbackCodes(this.options.fallbackLng);c.length>0&&"dev"!==c[0]&&(this.options.lng=c[0])}this.services.languageDetector||this.options.lng||this.logger.warn("init: no languageDetector is used and no lng is defined"),["getResource","hasResourceBundle","getResourceBundle","getDataByLanguage"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments)}})),["addResource","addResources","addResourceBundle","removeResourceBundle"].forEach((function(t){e[t]=function(){var n;return(n=e.store)[t].apply(n,arguments),e}}));var u=wu(),l=function(){var t=function(t,o){e.isInitialized&&!e.initializedStoreOnce&&e.logger.warn("init: i18next is already initialized. You should call init just once!"),e.isInitialized=!0,e.options.isClone||e.logger.log("initialized",e.options),e.emit("initialized",e.options),u.resolve(o),n(t,o)};if(e.languages&&"v1"!==e.options.compatibilityAPI&&!e.isInitialized)return t(null,e.t.bind(e));e.changeLanguage(e.options.lng,t)};return this.options.resources||!this.options.initImmediate?l():setTimeout(l,0),u}},{key:"loadResources",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sl,o="string"==typeof e?e:this.language;if("function"==typeof e&&(n=e),!this.options.resources||this.options.partialBundledLanguages){if(o&&"cimode"===o.toLowerCase())return n();var i=[],s=function(e){e&&t.services.languageUtils.toResolveHierarchy(e).forEach((function(e){i.indexOf(e)<0&&i.push(e)}))};o?s(o):this.services.languageUtils.getFallbackCodes(this.options.fallbackLng).forEach((function(e){return s(e)})),this.options.preload&&this.options.preload.forEach((function(e){return s(e)})),this.services.backendConnector.load(i,this.options.ns,(function(e){e||t.resolvedLanguage||!t.language||t.setResolvedLanguage(t.language),n(e)}))}else n(null)}},{key:"reloadResources",value:function(e,t,n){var o=wu();return e||(e=this.languages),t||(t=this.options.ns),n||(n=Sl),this.services.backendConnector.reload(e,t,(function(e){o.resolve(),n(e)})),o}},{key:"use",value:function(e){if(!e)throw new Error("You are passing an undefined module! Please check the object you are passing to i18next.use()");if(!e.type)throw new Error("You are passing a wrong module! Please check the object you are passing to i18next.use()");return"backend"===e.type&&(this.modules.backend=e),("logger"===e.type||e.log&&e.warn&&e.error)&&(this.modules.logger=e),"languageDetector"===e.type&&(this.modules.languageDetector=e),"i18nFormat"===e.type&&(this.modules.i18nFormat=e),"postProcessor"===e.type&&Zu.addPostProcessor(e),"formatter"===e.type&&(this.modules.formatter=e),"3rdParty"===e.type&&this.modules.external.push(e),this}},{key:"setResolvedLanguage",value:function(e){if(e&&this.languages&&!(["cimode","dev"].indexOf(e)>-1))for(var t=0;t<this.languages.length;t++){var n=this.languages[t];if(!(["cimode","dev"].indexOf(n)>-1)&&this.store.hasLanguageSomeTranslations(n)){this.resolvedLanguage=n;break}}}},{key:"changeLanguage",value:function(e,t){var n=this;this.isLanguageChangingTo=e;var o=wu();this.emit("languageChanging",e);var i=function(e){n.language=e,n.languages=n.services.languageUtils.toResolveHierarchy(e),n.resolvedLanguage=void 0,n.setResolvedLanguage(e)},s=function(s){e||s||!n.services.languageDetector||(s=[]);var a="string"==typeof s?s:n.services.languageUtils.getBestMatchFromCodes(s);a&&(n.language||i(a),n.translator.language||n.translator.changeLanguage(a),n.services.languageDetector&&n.services.languageDetector.cacheUserLanguage&&n.services.languageDetector.cacheUserLanguage(a)),n.loadResources(a,(function(e){var s,r;s=e,(r=a)?(i(r),n.translator.changeLanguage(r),n.isLanguageChangingTo=void 0,n.emit("languageChanged",r),n.logger.log("languageChanged",r)):n.isLanguageChangingTo=void 0,o.resolve((function(){return n.t.apply(n,arguments)})),t&&t(s,(function(){return n.t.apply(n,arguments)}))}))};return e||!this.services.languageDetector||this.services.languageDetector.async?!e&&this.services.languageDetector&&this.services.languageDetector.async?0===this.services.languageDetector.detect.length?this.services.languageDetector.detect().then(s):this.services.languageDetector.detect(s):s(e):s(this.services.languageDetector.detect()),o}},{key:"getFixedT",value:function(e,t,n){var o=this,i=function e(t,i){var s;if("object"!==Iu(i)){for(var a=arguments.length,r=new Array(a>2?a-2:0),c=2;c<a;c++)r[c-2]=arguments[c];s=o.options.overloadTranslationOptionHandler([t,i].concat(r))}else s=El({},i);s.lng=s.lng||e.lng,s.lngs=s.lngs||e.lngs,s.ns=s.ns||e.ns,s.keyPrefix=s.keyPrefix||n||e.keyPrefix;var u,l=o.options.keySeparator||".";return u=s.keyPrefix&&Array.isArray(t)?t.map((function(e){return"".concat(s.keyPrefix).concat(l).concat(e)})):s.keyPrefix?"".concat(s.keyPrefix).concat(l).concat(t):t,o.t(u,s)};return"string"==typeof e?i.lng=e:i.lngs=e,i.ns=t,i.keyPrefix=n,i}},{key:"t",value:function(){var e;return this.translator&&(e=this.translator).translate.apply(e,arguments)}},{key:"exists",value:function(){var e;return this.translator&&(e=this.translator).exists.apply(e,arguments)}},{key:"setDefaultNamespace",value:function(e){this.options.defaultNS=e}},{key:"hasLoadedNamespace",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(!this.isInitialized)return this.logger.warn("hasLoadedNamespace: i18next was not initialized",this.languages),!1;if(!this.languages||!this.languages.length)return this.logger.warn("hasLoadedNamespace: i18n.languages were undefined or empty",this.languages),!1;var o=n.lng||this.resolvedLanguage||this.languages[0],i=!!this.options&&this.options.fallbackLng,s=this.languages[this.languages.length-1];if("cimode"===o.toLowerCase())return!0;var a=function(e,n){var o=t.services.backendConnector.state["".concat(e,"|").concat(n)];return-1===o||2===o};if(n.precheck){var r=n.precheck(this,a);if(void 0!==r)return r}return!(!this.hasResourceBundle(o,e)&&this.services.backendConnector.backend&&(!this.options.resources||this.options.partialBundledLanguages)&&(!a(o,e)||i&&!a(s,e)))}},{key:"loadNamespaces",value:function(e,t){var n=this,o=wu();return this.options.ns?("string"==typeof e&&(e=[e]),e.forEach((function(e){n.options.ns.indexOf(e)<0&&n.options.ns.push(e)})),this.loadResources((function(e){o.resolve(),t&&t(e)})),o):(t&&t(),Promise.resolve())}},{key:"loadLanguages",value:function(e,t){var n=wu();"string"==typeof e&&(e=[e]);var o=this.options.preload||[],i=e.filter((function(e){return o.indexOf(e)<0}));return i.length?(this.options.preload=o.concat(i),this.loadResources((function(e){n.resolve(),t&&t(e)})),n):(t&&t(),Promise.resolve())}},{key:"dir",value:function(e){if(e||(e=this.resolvedLanguage||(this.languages&&this.languages.length>0?this.languages[0]:this.language)),!e)return"rtl";var t=this.services&&this.services.languageUtils||new il(Ml());return["ar","shu","sqr","ssh","xaa","yhd","yud","aao","abh","abv","acm","acq","acw","acx","acy","adf","ads","aeb","aec","afb","ajp","apc","apd","arb","arq","ars","ary","arz","auz","avl","ayh","ayl","ayn","ayp","bbz","pga","he","iw","ps","pbt","pbu","pst","prp","prd","ug","ur","ydd","yds","yih","ji","yi","hbo","men","xmn","fa","jpr","peo","pes","prs","dv","sam","ckb"].indexOf(t.getLanguagePartFromCode(e))>-1||e.toLowerCase().indexOf("-arab")>1?"rtl":"ltr"}},{key:"cloneInstance",value:function(){var e=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Sl,i=El(El(El({},this.options),n),{isClone:!0}),s=new t(i);return void 0===n.debug&&void 0===n.prefix||(s.logger=s.logger.clone(n)),["store","services","language"].forEach((function(t){s[t]=e[t]})),s.services=El({},this.services),s.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s.translator=new nl(s.services,s.options),s.translator.on("*",(function(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),o=1;o<t;o++)n[o-1]=arguments[o];s.emit.apply(s,[e].concat(n))})),s.init(i,o),s.translator.options=s.options,s.translator.backendConnector.services.utils={hasLoadedNamespace:s.hasLoadedNamespace.bind(s)},s}},{key:"toJSON",value:function(){return{options:this.options,store:this.store,language:this.language,languages:this.languages,resolvedLanguage:this.resolvedLanguage}}}]),t}();Au(Dl,"createInstance",(function(){return new Dl(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},arguments.length>1?arguments[1]:void 0)}));var kl=Dl.createInstance();kl.createInstance=Dl.createInstance,kl.createInstance,kl.dir,kl.init,kl.loadResources,kl.reloadResources,kl.use,kl.changeLanguage,kl.getFixedT,kl.t,kl.exists,kl.setDefaultNamespace,kl.hasLoadedNamespace,kl.loadNamespaces,kl.loadLanguages;class Rl extends ru{constructor(){super(),this.languages=null,this.keyMap={}}static getInstance(){return Rl.instance||(Rl.instance=new Rl),Rl.instance}provideLanguages(e){var t;jc||(this.languages=e,(null===(t=e["zh-CN"])||void 0===t?void 0:t.Chat)&&this.setKeyMap(e["zh-CN"]),_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUITranslateService.provideLanguages ok."))}useI18n(e){var t;if(jc)return;if(!this.languages)return void _("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUITranslateService.useI18next not have messages.");const n={};for(const[i,s]of Object.entries(this.languages))n["zh_cn"===i?"zh":i]={translation:s};kl.init({compatibilityJSON:"v3",lng:e||"zh",fallbackLng:"zh",detection:{order:["querystring","navigator"],caches:["localStorage","cookie"]},resources:n});let o=this.normalizeLanguageKey(e||"zh");null===(t=this.getEngine().TUIReport)||void 0===t||t.reportFeature(201,o)}changeLanguage(e){let t=this.normalizeLanguageKey(e);return this.getEngine().TUIReport.reportFeature(201,t),kl.changeLanguage(e)}normalizeLanguageKey(e){return e.includes("en")?"en-us":e.includes("tw")?"zh-tw":e.includes("zh")||e.includes("cn")?"zh-cn":e.includes("ko")||e.includes("kr")?"ko-kr":e.includes("ja")||e.includes("jp")?"ja-jp":"other-"+e}t(e){if(!this.languages){let t=e;return!bc(e)&&e.indexOf(".")>-1&&(t=e.split(".").pop()||""),t}const t=this.keyMap[e];return t?kl.t(t):kl.t(e)}setKeyMap(e,t){for(const n in e)if(Object.prototype.hasOwnProperty.call(e,n)){const o=t?`${t}.${n}`:n;if(e[n]&&"object"==typeof e[n]&&!Array.isArray(e[n])&&null!==e[n])this.setKeyMap(e[n],o);else{let o=t?`${t}.${e[n]}`:e[n];o=this.replaceKey(o),this.keyMap[o]=`${t}.${n}`}}}replaceKey(e){return e.startsWith("Chat")?e.replace("Chat","TUIChat"):e.startsWith("Conversation")?e.replace("Conversation","TUIConversation"):e.startsWith("Message")?e.replace("Message","message.tip"):e.startsWith("Call")?e.replace("Call","message.custom"):e}}class Ll extends ru{constructor(){super(),this.serv="TUIConversationService"}static getInstance(){return Ll.instance||(Ll.instance=new Ll),Ll.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.CONVERSATION_LIST_UPDATED,this.onConversationListUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED,this.onTotalUnreadCountUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this)),this.getConversationInitData()}onConversationListUpdated(e){const t=this.filterSystemConversation(e);this.getEngine().TUIStore.update(Sc.CONV,"conversationList",t),this.updateCurrentConversation()}onTotalUnreadCountUpdated(e){this.getEngine().TUIStore.update(Sc.CONV,"totalUnreadCount",e)}onMessageReceived(e){const t=this.getEngine(),n=this.getEngine().TUIStore.getData(Sc.CONV,"conversationList");let o=!1;for(let i=0;i<e.length;i++){if(e[i].type!==t.TYPES.MSG_GRP_SYS_NOTICE)continue;const{operationType:s}=e[i].payload,a=`GROUP${e[i].to}`,r=4===s||5===s||8===s,c=2===s||6===s||7===s;if(r||c)for(let e=0;e<n.length;e++)if(n[e].type!==t.TYPES.CONV_C2C&&n[e].conversationID===a){if(r){this.getEngine().TUIStore.update(Sc.CONV,"operationTypeMap",{conversationID:a,operationType:s}),o=!0;break}if(c&&n[e].operationType>0){this.getEngine().TUIStore.update(Sc.CONV,"operationTypeMap",{conversationID:a,operationType:0}),o=!0;break}}}if(o){this.getEngine().TUIStore.update(Sc.CONV,"conversationList",n);const e=this.getEngine().TUIStore.getData(Sc.CONV,"currentConversationID")||"",t=this.findConversation(e);t&&this.getEngine().TUIStore.update(Sc.CONV,"currentConversation",t)}}getConversationInitData(){const e=this.getEngine();e.chat.isReady()&&e.chat.getConversationList().then((t=>{const{conversationList:n,isSyncCompleted:o}=t.data;if(_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${this.serv}.init, getConversationList count:${n.length} isSyncCompleted:${o}`),n.length>0){this.onConversationListUpdated(n);const t=e.chat.getTotalUnreadMessageCount();this.onTotalUnreadCountUpdated(t)}}))}switchConversation(e){return Cc(this,void 0,void 0,(function*(){const t=`${this.serv}.switchConversation`,n=this.getEngine();if(!e)return n.TUIStore.reset(Sc.CHAT,["messageList","isCompleted","nextReqMessageID"]),n.TUIStore.update(Sc.CONV,"currentConversationID",""),n.TUIStore.update(Sc.CONV,"currentConversation",null),_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} conversationID is empty, conversationID:${e}`),Promise.resolve({});if(!e.startsWith(n.TYPES.CONV_C2C)&&!e.startsWith(n.TYPES.CONV_GROUP))return _("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} conversationID is invalid, conversationID:${e}`),Promise.reject({code:Ac.INVALID_CONV_ID,message:Nc.INVALID_CONV_ID});const o=n.TUIStore.getData(Sc.CONV,"currentConversationID");if(o&&o===e)return this.setMessageRead(o),_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} please check conversationID, conversationID:${e}`),Promise.resolve({code:Ac.CONV_ID_SAME,message:Nc.CONV_ID_SAME});const i=yield this.getConversationModel(e);return bc(i)?(_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${t} target conversation is not exist, conversationID:${e}`),Promise.reject({code:Ac.CONV_NOT_EXIST,message:Nc.CONV_NOT_EXIST})):(o&&this.setMessageRead(o),e&&this.setMessageRead(e),n.TUIStore.reset(Sc.CHAT,["messageList","isCompleted","nextReqMessageID"]),n.TUIStore.update(Sc.CONV,"currentConversationID",e),n.TUIStore.update(Sc.CONV,"currentConversation",i),Promise.resolve(i))}))}getConversationModel(e){return Cc(this,void 0,void 0,(function*(){let t=this.findConversation(e);if(bc(t))try{const n=yield this.getConversationProfile(e);n.data&&n.data.conversation&&(t=new lu(n.data.conversation))}catch(n){t=void 0}return t}))}findConversation(e){let t;const n=this.getEngine().TUIStore.getData(Sc.CONV,"conversationList");for(let o=0;o<n.length;o++)if(n[o].conversationID===e){t=n[o];break}return t}updateCurrentConversation(){const e=this.getEngine(),t=e.TUIStore.getData(Sc.CONV,"currentConversationID"),n=this.findConversation(t);n&&e.TUIStore.update(Sc.CONV,"currentConversation",n)}getConversationList(){return this.getEngine().chat.getConversationList()}getConversationProfile(e){return this.getEngine().chat.getConversationProfile(e)}deleteConversation(e){return this.getEngine().chat.deleteConversation(e).then((t=>{const n=this.getEngine().TUIStore.getData(Sc.CONV,"currentConversationID");return _("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${this.serv}.deleteConversation conversationID:${e} currentConversationID:${n}`),e===n&&(this.getEngine().TUIStore.update(Sc.CONV,"currentConversationID",""),this.getEngine().TUIStore.update(Sc.CONV,"currentConversation",null)),t}))}pinConversation(e){return this.getEngine().chat.pinConversation(e)}muteConversation(e){return this.getEngine().chat.setMessageRemindType(e)}clearHistoryMessage(e){return this.getEngine().chat.clearHistoryMessage(e).then((e=>(this.getEngine().TUIStore.update(Sc.CHAT,"messageList",[]),this.getEngine().TUIStore.update(Sc.CHAT,"nextReqMessageID",""),this.getEngine().TUIStore.update(Sc.CHAT,"isCompleted",!0),e)))}setMessageRead(e){return this.getEngine().chat.setMessageRead({conversationID:e})}setConversationDraft(e){const{conversationID:t,draftInfo:n}=e;let o="";return n&&(o=JSON.stringify(n)),this.getEngine().chat.setConversationDraft({conversationID:t,draftText:o}).then((e=>{const{conversation:t}=e.data;this.updateConversation(t)}))}updateConversation(e){let t=!1;const n=this.getEngine().TUIStore.getData(Sc.CONV,"conversationList");for(let o=0;o<n.length;o++)if(n[o].conversationID===e.conversationID){n[o]=e,t=!0;break}t&&this.getEngine().TUIStore.update(Sc.CONV,"conversationList",n)}filterSystemConversation(e){return e.filter((e=>e.type!==this.getEngine().TYPES.CONV_SYSTEM))}}class Al{constructor(e){this.TUIUserService=e}getEngine(){return this.TUIUserService.getEngine()}init(){this.getEngine().eventCenter.addEvent(this.getEngine().EVENT.PROFILE_UPDATED,this.onProfileUpdated.bind(this)),this.getEngine().eventCenter.addEvent(this.getEngine().EVENT.BLACKLIST_UPDATED,this.onBlacklistUpdated.bind(this)),this.getUserProfileInitData()}onProfileUpdated(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.USER,"userProfile");e.forEach((e=>{e.userID===n.userID&&t.TUIStore.update(Sc.USER,"userProfile",e)}))}onBlacklistUpdated(e){const t=this.getEngine();this.getBlacklistProfile(e).then((e=>{t.TUIStore.update(Sc.USER,"userBlacklist",e)}))}getUserProfileInitData(){const e=this.getEngine();e.chat.isReady()&&e.chat.getBlacklist().then((e=>{const t=e.data||[];_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIUserProfileHandler.init, getBlacklist count:${t.length}`),t.length>0&&this.onBlacklistUpdated(t)}))}getBlacklistProfile(e){const t=[];let n=0;for(;n<e.length;)t.push(e.slice(n,n+=100));const o=[];t.forEach((e=>{o.push(this.TUIUserService.getUserProfile({userIDList:e}))}));const i=[];return Promise.all(o).then((e=>(e.forEach((e=>{const t=e.data.map((e=>{const{userID:t,nick:n,avatar:o}=e;return{userID:t,nick:n,avatar:o}}));i.push(...t)})),i)))}getUserProfile(e){const t=this.getEngine();return bc(e)?t.chat.getMyProfile().then((e=>(t.TUIStore.update(Sc.USER,"userProfile",e.data),e))).catch((e=>Promise.reject(e))):t.chat.getUserProfile(e)}updateMyProfile(e){return this.getEngine().chat.updateMyProfile(e)}addToBlacklist(e){return this.getEngine().chat.addToBlacklist(e)}removeFromBlacklist(e){return this.getEngine().chat.removeFromBlacklist(e)}}function Ol(e,t,n=!0){var o,i;o=n?Pl(e):e,i=t,Yc?Jc.setStorageSync(o,i):bl()&&localStorage.setItem(o,JSON.stringify(i))}function Nl(e,t=!0){try{return function(e){if(Yc)return Jc.getStorageSync(e);if(bl()){const t=localStorage.getItem(e);if("undefined"!==t)return JSON.parse(t)}}(t?Pl(e):e)}catch(n){return void _("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","Storage.getStorageItem error:",n)}}function Pl(e){return`chat_engine_${e}`}function bl(){return navigator&&navigator.cookieEnabled&&localStorage}class Ul{constructor(e){this.TUIUserService=e}getEngine(){return this.TUIUserService.getEngine()}init(){const e=this.getEngine(),t=Nl("displayOnlineStatus")||!1;e.TUIStore.update(Sc.USER,"displayOnlineStatus",t),e.eventCenter.addEvent(e.EVENT.USER_STATUS_UPDATED,this.onUserStatusUpdated.bind(this)),this.onConversationListUpdated()}onConversationListUpdated(){const e=this.getEngine();e.TUIStore.watch(Sc.CONV,{conversationList:()=>{const t=e.TUIStore.getData(Sc.APP,"enabledOnlineStatus"),n=e.TUIStore.getData(Sc.USER,"displayOnlineStatus");t&&n&&this.startToSubscribe()}})}onUserStatusUpdated(e){this.getEngine().TUIStore.update(Sc.USER,"userStatusList",e)}switchUserStatus(e){const t=this.getEngine(),{displayOnlineStatus:n=!1}=e;t.TUIStore.update(Sc.USER,"displayOnlineStatus",n),Ol("displayOnlineStatus",n);const o=t.TUIStore.getData(Sc.APP,"enabledOnlineStatus");o?!0===n?this.startToSubscribe():this.unsubscribeUserStatus():_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`UserStatusHandler.switchUserStatus enabledOnlineStatus:${o} displayOnlineStatus:${n}`)}getUserStatus(e){const t=this.getEngine();return t.chat.getUserStatus(e).then((e=>{const{successUserList:n}=e.data;return n.length>0&&t.TUIStore.update(Sc.USER,"userStatusList",n),e})).catch((e=>Promise.reject(e)))}subscribeUserStatus(e){var t;const n=(null===(t=null==e?void 0:e.userIDList)||void 0===t?void 0:t.length)||0;return 0===n?(_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`UserStatusHandler.subscribeUserStatus userID count:${n}`),Promise.resolve()):this.getEngine().chat.subscribeUserStatus(e)}unsubscribeUserStatus(e){const t=this.getEngine(),{userIDList:n=[]}=e||{};return t.chat.unsubscribeUserStatus({userIDList:n}).then((e=>{const{failureUserList:o}=e.data,i=[];return n.forEach((e=>{o.includes(e)||i.push({userID:e,statusType:Dc.UNSUB_USER})})),t.TUIStore.update(Sc.USER,"userStatusList",i),e})).catch((e=>Promise.reject(e)))}startToSubscribe(){const e=this.getEngine(),t=e.TUIStore.getData(Sc.CONV,"conversationList"),n=e.TUIStore.getData(Sc.USER,"userStatusList"),o=[];t.forEach((t=>{if(t.type===e.TYPES.CONV_C2C){const i=t.conversationID.replace(e.TYPES.CONV_C2C,"");n.has(i)||o.push(i)}})),0!==o.length&&e.chat.isReady()&&(this.subscribeUserStatus({userIDList:o}),this.getUserStatus({userIDList:o}))}}class Gl extends ru{constructor(){super(),this.userProfileHandler=new Al(this),this.userStatusHandler=new Ul(this)}static getInstance(){return Gl.instance||(Gl.instance=new Gl),Gl.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.KICKED_OUT,this.onKickedOut.bind(this)),e.eventCenter.addEvent(e.EVENT.NET_STATE_CHANGE,this.onNetStateChange.bind(this)),this.userProfileHandler.init(),this.userStatusHandler.init(),this.initMessageReadReceipt()}onKickedOut(e){this.getEngine().TUIStore.update(Sc.USER,"kickedOut",e.type)}onNetStateChange(e){this.getEngine().TUIStore.update(Sc.USER,"netStateChange",e.state)}initMessageReadReceipt(){const e=Nl("displayMessageReadReceipt")||!0;this.getEngine().TUIStore.update(Sc.USER,"displayMessageReadReceipt",e)}switchUserStatus(e){return this.userStatusHandler.switchUserStatus(e)}switchMessageReadStatus(e){this.getEngine().TUIStore.update(Sc.USER,"displayMessageReadReceipt",e),Ol("displayMessageReadReceipt",e)}getUserProfile(e){return this.userProfileHandler.getUserProfile(e)}updateMyProfile(e){return this.userProfileHandler.updateMyProfile(e)}addToBlacklist(e){return this.userProfileHandler.addToBlacklist(e)}removeFromBlacklist(e){return this.userProfileHandler.removeFromBlacklist(e)}getUserStatus(e){return this.userStatusHandler.getUserStatus(e)}subscribeUserStatus(e){return this.userStatusHandler.subscribeUserStatus(e)}unsubscribeUserStatus(e){return this.userStatusHandler.unsubscribeUserStatus(e)}}class wl{constructor(e){this.TUIChatService=e,this.userShowNameMap=new Map,this.requestedUserMap=new Map}getEngine(){return this.TUIChatService.getEngine()}t(e){return this.getEngine().TUITranslate.t(e)}handleTextMessage(e){return{text:this.decodeText(e.payload)}}handleFaceMessage(e){const t={name:"",url:"",type:""};return e.payload.data.indexOf("@custom")>-1?(t.name=e.payload.data,t.type="custom",t):(t.name=e.payload.data.indexOf("@2x")<0?`${e.payload.data}@2x`:e.payload.data,t.url=`https://web.sdk.qcloud.com/im/assets/face-elem/${t.name}.png`,t)}handleLocationMessage(e){const t={lon:"",lat:"",href:"",url:"",description:""};return t.lon=e.payload.longitude.toFixed(6),t.lat=e.payload.latitude.toFixed(6),t.href=`https://map.qq.com/?type=marker&isopeninfowin=1&markertype=1&pointx=${t.lon}&pointy=${t.lat}&name=${e.payload.description}`,t.url=`https://apis.map.qq.com/ws/staticmap/v2/?center=${t.lat},${t.lon}&zoom=10&size=300*150&maptype=roadmap&markers=size:large|color:0xFFCCFF|label:k|${t.lat},${t.lon}&key=UBNBZ-PTP3P-TE7DB-LHRTI-Y4YLE-VWBBD`,t.description=e.payload.description,t}handleImageMessage(e){return{url:e.payload.imageInfoArray[0].url,width:e.payload.imageInfoArray[0].width,height:e.payload.imageInfoArray[0].height}}handleAudioMessage(e){return{url:e.payload.url,second:e.payload.second}}handleVideoMessage(e){return{url:e.payload.videoUrl,snapshotUrl:e.payload.snapshotUrl,snapshotWidth:e.payload.snapshotWidth,snapshotHeight:e.payload.snapshotHeight}}handleFileMessage(e){return{url:e.payload.fileUrl,name:e.payload.fileName,size:Fc(e.payload.fileSize)}}handleCustomMessage(e){var t;const n=this.handleCreateGroupCustomMessage(e);return{custom:this.handleCallKitSignaling(e)||n||(null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.extension)||`${this.t("TUIChat.[自定义消息]")}`,businessID:n?"group_create":""}}handleMergeMessage(e){return Object.assign({},e.payload)}handleGroupTipsMessage(e){var t,n,o,i,s,a;const r=this.getEngine(),c={text:""};let u=(null==e?void 0:e.nick)||(null===(n=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.userIDList)||void 0===n?void 0:n.join(","));switch((null===(i=null===(o=null==e?void 0:e.payload)||void 0===o?void 0:o.memberList)||void 0===i?void 0:i.length)>0&&(u="",null===(a=null===(s=null==e?void 0:e.payload)||void 0===s?void 0:s.memberList)||void 0===a||a.map((e=>{const t=(null==e?void 0:e.nick)||(null==e?void 0:e.userID);u+=`${this.substringByLength(t)},`})),u=null==u?void 0:u.slice(0,-1)),e.payload.operationType){case r.TYPES.GRP_TIP_MBR_JOIN:c.text=`${u} ${this.t("message.tip.加入群组")}`;break;case r.TYPES.GRP_TIP_MBR_QUIT:c.text=`${this.t("message.tip.群成员")}：${u} ${this.t("message.tip.退出群组")}`;break;case r.TYPES.GRP_TIP_MBR_KICKED_OUT:c.text=`${this.t("message.tip.群成员")}：${u} ${this.t("message.tip.被")}${this.t("message.tip.踢出群组")}`;break;case r.TYPES.GRP_TIP_MBR_SET_ADMIN:c.text=`${this.t("message.tip.群成员")}：${u} ${this.t("message.tip.成为管理员")}`;break;case r.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:c.text=`${this.t("message.tip.群成员")}：${u} ${this.t("message.tip.被撤销管理员")}`;break;case r.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:c.text=this.handleGroupProfileUpdated(e);break;case r.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:for(const t of e.payload.memberList)t.muteTime>0?c.text=`${this.t("message.tip.群成员")}：${u} ${this.t("message.tip.被禁言")}`:c.text=`${this.t("message.tip.群成员")}：${u} ${this.t("message.tip.被取消禁言")}`;break;default:c.text=`[${this.t("message.tip.群提示消息")}]`}return c}handleGroupSystemMessage(e){const t=e.payload.groupProfile.name||e.payload.groupProfile.groupID,n={text:""};switch(e.payload.operationType){case 1:n.text=`${e.payload.operatorID} ${this.t("message.tip.申请加入群组")}：${t}`;break;case 2:n.text=`${this.t("message.tip.成功加入群组")}：${t}`;break;case 3:n.text=`${this.t("message.tip.申请加入群组")}：${t} ${this.t("message.tip.被拒绝")}`;break;case 4:n.text=`${this.t("message.tip.你被管理员")}${e.payload.operatorID} ${this.t("message.tip.踢出群组")}：${t}`;break;case 5:n.text=`${this.t("message.tip.群")}：${t} ${this.t("message.tip.被")} ${e.payload.operatorID} ${this.t("message.tip.解散")}`;break;case 6:n.text=`${e.payload.operatorID} ${this.t("message.tip.创建群")}：${t}`;break;case 7:case 12:n.text=`${e.payload.operatorID} ${this.t("message.tip.邀请你加群")}：${t}`;break;case 8:n.text=`${this.t("message.tip.你退出群组")}：${t}`;break;case 9:n.text=`${this.t("message.tip.你被")}${e.payload.operatorID} ${this.t("message.tip.设置为群")}：${t} ${this.t("message.tip.的管理员")}`;break;case 10:n.text=`${this.t("message.tip.你被")}${e.payload.operatorID} ${this.t("message.tip.撤销群")}：${t} ${this.t("message.tip.的管理员身份")}`;break;case 13:n.text=`${e.payload.operatorID} ${this.t("message.tip.同意加群")}：${t}`;break;case 14:n.text=`${e.payload.operatorID} ${this.t("message.tip.拒接加群")}：${t}`;break;case 255:n.text=`${this.t("message.tip.自定义群系统通知")}: ${e.payload.userDefinedField}`;break;default:n.text="未解析的群系统通知"}return n}handleCallKitSignaling(e){var t,n,o,i,s,a,r,c,u,l;const d=wc(e.payload.data);if(1!==(null==d?void 0:d.businessID))return"";const p=wc(null==d?void 0:d.data),h=e.fromAccount||e.from,g=this.getEngine().TUIFriend.getFriendRemark([h]),_=this.getEngine().getMyUserID();let f=g[h]||e.nameCard||e.nick||h;switch(f=this.substringByLength(f),null==d?void 0:d.actionType){case 1:return"audioCall"!==(null===(t=null==p?void 0:p.data)||void 0===t?void 0:t.cmd)&&"videoCall"!==(null===(n=null==p?void 0:p.data)||void 0===n?void 0:n.cmd)||!(null==d?void 0:d.groupID)?"hangup"===(null===(o=null==p?void 0:p.data)||void 0===o?void 0:o.cmd)?(null==d?void 0:d.groupID)?`${this.t("message.custom.通话结束")}`:`${this.t("message.custom.通话时长")}：${function(e){const t=e;let n,o,i,s="";return t>=3600?(n=parseInt(""+t/3600,10)<10?`0${parseInt(""+t/3600,10)}`:parseInt(""+t/3600,10),o=parseInt(""+t%60/60,10)<10?`0${parseInt(""+t%60/60,10)}`:parseInt(""+t%60/60,10),i=t%3600<10?"0"+t%3600:t%3600,i>60&&(o=parseInt(""+i/60,10)<10?`0${parseInt(""+i/60,10)}`:parseInt(""+i/60,10),i=i%60<10?"0"+i%60:i%60),s=`${n}:${o}:${i}`):t>=60&&t<3600?(o=parseInt(""+t/60,10)<10?`0${parseInt(""+t/60,10)}`:parseInt(""+t/60,10),i=t%60<10?"0"+t%60:t%60,s=`00:${o}:${i}`):t<60&&(i=t<10?`0${t}`:t,s=`00:00:${i}`),s}(null==p?void 0:p.call_end)}`:"switchToAudio"===(null===(i=null==p?void 0:p.data)||void 0===i?void 0:i.cmd)?`${this.t("message.custom.切换语音通话")}`:"switchToVideo"===(null===(s=null==p?void 0:p.data)||void 0===s?void 0:s.cmd)?`${this.t("message.custom.切换视频通话")}`:`${this.t("message.custom.发起通话")}`:`${f} ${this.t("message.custom.发起通话")}`;case 2:return(null==d?void 0:d.groupID)?`${f} ${this.t("message.custom.取消通话")}`:this.isOldUIKit("message.custom.已取消")?this.t("message.custom.取消通话"):(null==d?void 0:d.inviter)===_?this.t("message.custom.已取消"):this.t("message.custom.对方已取消");case 3:return"switchToAudio"===(null===(a=null==p?void 0:p.data)||void 0===a?void 0:a.cmd)?`${this.t("message.custom.切换语音通话")}`:"switchToVideo"===(null===(r=null==p?void 0:p.data)||void 0===r?void 0:r.cmd)?`${this.t("message.custom.切换视频通话")}`:(null==d?void 0:d.groupID)?`${f} ${this.t("message.custom.已接听")}`:this.t("message.custom.已接听");case 4:return(null==d?void 0:d.groupID)?`${f} ${this.t("message.custom.拒绝通话")}`:this.isOldUIKit("message.custom.已拒绝")?this.t("message.custom.拒绝通话"):"line_busy"===(null==p?void 0:p.line_busy)||"lineBusy"===(null==p?void 0:p.data.message)?(null==d?void 0:d.inviter)===_?this.t("message.custom.对方忙线中"):this.t("message.custom.忙线未接听"):(null==d?void 0:d.inviter)===_?this.t("message.custom.对方已拒绝"):this.t("message.custom.已拒绝");case 5:if("switchToAudio"===(null===(c=null==p?void 0:p.data)||void 0===c?void 0:c.cmd))return`${this.t("message.custom.切换语音通话")}`;if("switchToVideo"===(null===(u=null==p?void 0:p.data)||void 0===u?void 0:u.cmd))return`${this.t("message.custom.切换视频通话")}`;if(null==d?void 0:d.groupID){if(h===(null==d?void 0:d.inviter)){this.handleCallkitTimeoutSignaling(d.inviteeList);let e="";return null===(l=d.inviteeList)||void 0===l||l.forEach((t=>{const n=this.userShowNameMap.get(t)||t;e+=`${this.substringByLength(n)}、`})),e=e.substring(0,e.lastIndexOf("、")),`${e} ${this.t("message.custom.无应答")}`}return`${f} ${this.t("message.custom.无应答")}`}return this.isOldUIKit("message.custom.对方无应答")?this.t("message.custom.无应答"):(null==d?void 0:d.inviter)===_?this.t("message.custom.对方无应答"):this.t("message.custom.超时无应答");default:return""}}handleCreateGroupCustomMessage(e){let t;const n=wc(e.payload.data);return"group_create"===(null==n?void 0:n.businessID)&&(t=`${n.opUser} ${n.content}`),t}decodeText(e){const t=[];let n=e.text,o=-1,i=-1;for(;""!==n;)switch(o=n.indexOf("["),i=n.indexOf("]"),o){case 0:if(-1===i)t.push({name:"text",text:n}),n="";else{const e=n.slice(0,i+1);e.indexOf("@custom")>-1?(t.push({name:"img",src:"",type:"custom",emojiKey:e}),n=n.substring(i+1)):xc[e]?(t.push({name:"img",src:"https://web.sdk.qcloud.com/im/assets/emoji-plugin/"+xc[e],emojiKey:e}),n=n.substring(i+1)):(t.push({name:"text",text:"["}),n=n.slice(1))}break;case-1:t.push({name:"text",text:n}),n="";break;default:t.push({name:"text",text:n.slice(0,o)}),n=n.substring(o)}return t}handleGroupProfileUpdated(e){const{nick:t,payload:n}=e,{newGroupProfile:o,memberList:i,operatorID:s}=n;let a="";const r=t||s,c=Object.keys(o)[0];switch(c){case"muteAllMembers":a=o[c]?`${this.t("message.tip.管理员")} ${r} ${this.t("message.tip.开启全员禁言")}`:`${this.t("message.tip.管理员")} ${r} ${this.t("message.tip.取消全员禁言")}`;break;case"ownerID":a=`${i[0].nick||i[0].userID} ${this.t("message.tip.成为新的群主")}`;break;case"groupName":a=`${r} ${this.t("message.tip.修改群名为")} ${o[c]}`;break;case"notification":a=this.isOldUIKit("message.tip.把群公告修改为")?`${r} ${this.t("message.tip.发布新公告")}`:`${r} ${this.t("message.tip.把群公告修改为")} "${o[c]}"`}return a}handleCallkitTimeoutSignaling(e=[]){if(0===e.length)return;const t=this.getEngine().TUIFriend.getFriendRemark(e),n=[];e.forEach((e=>{const o=t[e];o?this.userShowNameMap.set(e,o):this.requestedUserMap.has(e)||(n.push(e),this.requestedUserMap.set(e,1))})),n.length>0&&this.getEngine().TUIUser.getUserProfile({userIDList:n}).then((e=>{(e.data||[]).forEach((e=>{const{userID:t,nick:n}=e,o=n||t;this.userShowNameMap.set(t,o)}))})).catch((e=>{}))}substringByLength(e,t=12){return e.length>t?`${e.slice(0,t)}...`:e}isOldUIKit(e){var t;const n=e.lastIndexOf("."),o=e.slice(0,n+1);return null===(t=this.t(e))||void 0===t?void 0:t.startsWith(o)}}class Fl{constructor(e){this.TUIChatService=e,this.typingTo="",this.timer=null}getEngine(){return this.TUIChatService.getEngine()}clearTypingStatus(){this.getEngine().TUIStore.getData(Sc.CHAT,"typingStatus")&&this.getEngine().TUIStore.update(Sc.CHAT,"typingStatus",!1),this.timer&&clearTimeout(this.timer),this.timer=null}handleLastMessage(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.CHAT,"typingStatus");if(e.type===this.getEngine().TYPES.MSG_CUSTOM&&"in"===e.flow){const o=wc(e.payload.data);if(o.businessID===kc.BUSINESS_ID){const{typingStatus:e,userAction:i}=o;if(e===kc.STATUS_START||i===kc.ACTION_START_ID)return n?(this.timer&&clearTimeout(this.timer),this.timer=null):t.TUIStore.update(Sc.CHAT,"typingStatus",!0),this.timer=setTimeout((()=>{this.clearTypingStatus()}),3e4),t.TUIStore.getData(Sc.CHAT,"typingStatus");e!==kc.STATUS_END&&i!==kc.ACTION_END_ID||this.clearTypingStatus()}}}filterTypingMessage(e=[]){return 0===e.length?[]:(this.getEngine().TUIStore.getData(Sc.APP,"enableTyping")&&this.handleLastMessage(e[e.length-1]),e.filter((e=>e.type!==this.getEngine().TYPES.MSG_CUSTOM||wc(e.payload.data).businessID!==kc.BUSINESS_ID)))}createTypingMessage(e=kc.STATUS_END,t=""){const{BUSINESS_ID:n,STATUS_START:o,VERSION:i,ACTION_START_ID:s,ACTION_END_ID:a,ACTION_START:r,ACTION_END:c,NEED_TYPING:u}=kc;return{to:t,conversationType:this.getEngine().TYPES.CONV_C2C,payload:{data:JSON.stringify({businessID:n,typingStatus:e,version:i,userAction:e===o?s:a,actionParam:e===o?r:c}),description:"",extension:""},cloudCustomData:JSON.stringify({messageFeature:{needTyping:u,version:i}})}}sendTyping(e=!1,t=""){if(e){this.typingTo=t;const e=this.createTypingMessage(kc.STATUS_START,t);this.getEngine().TUIChat.sendCustomMessage(e,{onlineUserOnly:!0})}else this.sendTypingEnd()}sendTypingEnd(){if(this.typingTo){const e=this.createTypingMessage(kc.STATUS_END,this.typingTo);this.getEngine().TUIChat.sendCustomMessage(e,{onlineUserOnly:!0})}this.typingTo=""}}class xl{constructor(e){this.TUIChatService=e}getEngine(){return this.TUIChatService.getEngine()}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.MESSAGE_READ_RECEIPT_RECEIVED,this.onMessageReadReceiptReceived.bind(this))}onMessageReadReceiptReceived(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.CONV,"currentConversationID"),o=[];e.forEach((e=>{const{messageID:i}=e,s=t.chat.findMessage(i);s&&n===s.conversationID&&o.push(s)})),o.length>0&&t.TUIChat.updateMessageList(o,"edit")}sendMessageReadReceipt(e){const t=[];return e.forEach((e=>{const n=e.getMessage();t.push(n)})),this.getEngine().chat.sendMessageReadReceipt(t)}getGroupMessageReadMemberList(e){const t=e.message.getMessage(),n=Object.assign(Object.assign({},e),{message:t});return this.getEngine().chat.getGroupMessageReadMemberList(n)}getMessageReadReceiptList(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.APP,"enabledMessageReadReceipt"),o=t.TUIStore.getData(Sc.USER,"displayMessageReadReceipt");!n||!o||0===e.length||e[0].conversationType!==t.TYPES.CONV_GROUP||t.chat.getMessageReadReceiptList(e).then((e=>{const{messageList:t}=e.data;this.TUIChatService.updateMessageList(t,"edit")})).catch((e=>{_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`ReadReceiptHandler.getMessageReadReceiptList error:${e.message}`)}))}}class Vl extends ru{constructor(){super(),this.serv="TUIChatService",this.messageHandler=new wl(this),this.typingHandler=new Fl(this),this.readReceiptHandler=new xl(this),this.isSwitching=!0,this.delayGetHoppingFunction=void 0,this.hoppingConfigMap=new Map}static getInstance(){return Vl.instance||(Vl.instance=new Vl),Vl.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_MODIFIED,this.onMessageModified.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_REVOKED,this.onMessageRevoked.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_READ_BY_PEER,this.onMessageReadByPeer.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_REACTIONS_UPDATED,this.onMessageReactionsUpdated.bind(this)),this.onCurrentConversationIDUpdated(),this.onMessageSource(),this.readReceiptHandler.init()}onMessageReceived(e){this.updateMessageList(e,"received"),this.getEngine().TUIStore.update(Sc.CHAT,"newMessageList",e)}onMessageModified(e){this.updateMessageList(e,"edit")}onMessageRevoked(e){this.updateMessageList(e,"edit")}onMessageReadByPeer(e){this.updateMessageList(e,"edit")}onMessageReactionsUpdated(e){this.updateMessageReactionList([e])}onCurrentConversationIDUpdated(){const e=this.getEngine();e.TUIStore.watch(Sc.CONV,{currentConversationID:t=>{this.isSwitching=!0,this.delayGetHoppingFunction=void 0,this.hoppingConfigMap.clear(),e.TUIStore.reset(Sc.CHAT),this.typingHandler.clearTypingStatus(),this.typingHandler.sendTypingEnd(),cu(t)||this.getMessageList().finally((()=>{this.isSwitching=!1,this.delayGetHoppingFunction&&this.delayGetHoppingFunction()}))}})}onMessageSource(){const e=this.getEngine();e.TUIStore.watch(Sc.CHAT,{messageSource:t=>{const n=this.getStoreData(Sc.CONV,"currentConversationID");if(!n||t&&t.conversationID!==n)return;if(bc(t))return this.hoppingConfigMap.clear(),e.TUIStore.update(Sc.CHAT,"messageList",[]),e.TUIStore.update(Sc.CHAT,"nextReqMessageID",""),e.TUIStore.update(Sc.CHAT,"isCompleted",!1),void this.getMessageList();const o=this.getStoreData(Sc.CHAT,"messageList");o&&o.find((e=>t&&e.ID===t.ID))||(this.isSwitching?this.delayGetHoppingFunction=this.getMessageListHoppingForDown:this.getMessageListHoppingForDown())}})}getMessageListHoppingForDown(){const e=this.getStoreData(Sc.CHAT,"messageList"),{conversationID:t,sequence:n,time:o,ID:i}=this.getStoreData(Sc.CHAT,"messageSource");if(e&&e.find((e=>i&&e.ID===i)))return;const s=this.getEngine();s.TUIStore.update(Sc.CHAT,"messageList",[]),s.TUIStore.update(Sc.CHAT,"nextReqMessageID",""),s.TUIStore.update(Sc.CHAT,"isCompleted",!1),this.getMessageListHopping({conversationID:t,sequence:n,time:o,direction:1})}getStoreData(e,t){return this.getEngine().TUIStore.getData(e,t)}sendMessage(e,t){this.updateMessageList([e],"send");const n=this.getEngine().chat.sendMessage(e,t);return this.getResponse(n)}getResponse(e,t=!0,n=!0){return e.then((e=>{const n=e.data.messageList?e.data.messageList:[e.data.message];return t&&this.updateMessageList(n,"edit"),e})).catch((e=>{var t;return n&&(null===(t=null==e?void 0:e.data)||void 0===t?void 0:t.message)&&this.updateMessageList([e.data.message],"edit"),Promise.reject(e)}))}updateMessageList(e,t=""){if(this.getStoreData(Sc.CHAT,"messageSource")&&"unshift"!==t&&"edit"!==t)return;const n=this.getStoreData(Sc.CHAT,"messageList"),o=this.updateTargetMessageList(e,n,t);this.getEngine().TUIStore.update(Sc.CHAT,"messageList",o)}updateTargetMessageList(e,t,n=""){const o=this.getStoreData(Sc.CONV,"currentConversationID");let i=e.filter((e=>e.conversationID===o));if(i=this.handleC2CCallSignaling(i),!n||0===i.length)return t;const s=t||[];let a=[];if("send"===n||"push"===n){const e=this.getStoreData(Sc.CHAT,"userInfo");Object.keys(e).length>0&&this.updateLocalMessage(i,e)}switch(n){case"edit":for(const e of t){const t=i.find((t=>t.ID===e.ID));a.push(t||e)}break;case"resend":a=s.filter((e=>e.ID!==i[0].ID)).concat(i);break;case"send":a=s.concat(this.typingHandler.filterTypingMessage(i));break;case"push":a=s.concat(this.typingHandler.filterTypingMessage(i)),this.getEngine().chat.setMessageRead({conversationID:o});break;case"received":a=s.concat(this.typingHandler.filterTypingMessage(i)),a=this.sortMessageList(a),this.getEngine().chat.setMessageRead({conversationID:o});break;case"unshift":a=i.filter((e=>0===s.length||!s.find((t=>t.ID===e.ID)))),a.push(...s),a=this.sortMessageList(a)}return a}enterTypingState(){this.getStoreData(Sc.APP,"enableTyping")&&this.sendTyping(!0)}leaveTypingState(){this.getStoreData(Sc.APP,"enableTyping")&&this.sendTyping(!1)}sendTyping(e){const t=this.getEngine(),n=this.getStoreData(Sc.CONV,"currentConversationID");if(!n.startsWith(t.TYPES.CONV_C2C))return;const o=n.replace(t.TYPES.CONV_C2C,"");if(e){const e=this.getStoreData(Sc.CHAT,"messageList").filter((e=>"in"===e.flow));if(0===e.length)return;const t=1e3*e[e.length-1].time;if((new Date).getTime()-t>3e4)return}this.typingHandler.sendTyping(e,o)}quoteMessage(e){var t;return this.getEngine().TUIStore.update(Sc.CHAT,"quoteMessage",{message:e,type:"quote"}),null===(t=this.getEngine().TUIReport)||void 0===t||t.reportFeature(205),e}replyMessage(e){return this.getEngine().TUIStore.update(Sc.CHAT,"quoteMessage",{message:e,type:"reply"}),e}getCurrentConvInfo(){const{conversationID:e="",type:t}=this.getStoreData(Sc.CONV,"currentConversation")||{};return{to:e.replace(t,""),conversationType:t}}t(e){return this.getEngine().TUITranslate.t(e)||e}getMessageAbstractAndType(e){var t,n;const o=this.getEngine(),i={abstract:"",type:0};switch(e.type){case o.TYPES.MSG_TEXT:i.abstract=null===(t=null==e?void 0:e.payload)||void 0===t?void 0:t.text,i.type=1;break;case o.TYPES.MSG_CUSTOM:i.abstract="[自定义消息]",i.type=2;break;case o.TYPES.MSG_IMAGE:i.abstract="[图片]",i.type=3;break;case o.TYPES.MSG_AUDIO:i.abstract="[语音]",i.type=4;break;case o.TYPES.MSG_VIDEO:i.abstract="[视频]",i.type=5;break;case o.TYPES.MSG_FILE:i.abstract="[文件]",i.type=6;break;case o.TYPES.MSG_LOCATION:i.type=7;break;case o.TYPES.MSG_FACE:i.abstract="[表情]",i.type=8;break;case o.TYPES.MSG_GRP_TIP:i.type=9;break;case o.TYPES.MSG_MERGER:i.abstract=null===(n=null==e?void 0:e.payload)||void 0===n?void 0:n.title,i.type=10}return i}genMessageReply(e,t){if("reply"!==t&&"quote"!==t)return{};const{abstract:n,type:o}=this.getMessageAbstractAndType(e),i={messageAbstract:n,messageSender:e.nick||e.from,messageID:e.ID},s=Object.assign(Object.assign({},i),{messageType:o,messageTime:null==e?void 0:e.time,messageSequence:null==e?void 0:e.sequence,version:1});if("reply"===t&&(s.messageRootID=e.ID,e.cloudCustomData)){const t=wc(e.cloudCustomData);t.messageReply&&t.messageReply.messageRootID&&(s.messageRootID=t.messageReply.messageRootID)}return{messageReply:s,messageReplyRoot:i}}getMessageInfo(e,t,n){const{messageReply:o,messageReplyRoot:i}=this.genMessageReply(t,n),s=e.cloudCustomData?wc(e.cloudCustomData):{};let a;if(s.messageReply?s.messageReply=Object.assign(Object.assign({},o),s.messageReply):s.messageReply=o,"reply"===n){const{messageRootID:e}=o;a=this.getEngine().chat.findMessage(e);const t=(null==a?void 0:a.cloudCustomData)?wc(a.cloudCustomData):{};t.messageReplies||(t.messageReplies={}),r=t.messageReplies.replies,("function"==typeof Array.isArray?Array.isArray(r):"array"===Object.prototype.toString.call(r).match(/^\[object (.*)\]$/)[1].toLowerCase())||(t.messageReplies.replies=[]),t.messageReplies.replies.push(i),a.cloudCustomData=JSON.stringify(t)}var r;return{cloudCustomData:JSON.stringify(s),rootMessage:a}}sendTextMessage(e,t){const n=this.getEngine(),{message:o,type:i}=this.getStoreData(Sc.CHAT,"quoteMessage");let s={cloudCustomData:e.cloudCustomData||"",rootMessage:void 0};o&&(s=this.getMessageInfo(e,o,i));const a=n.chat.createTextMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{cloudCustomData:s.cloudCustomData}));return this.sendMessage(a,t).then((e=>(s.rootMessage&&this.modifyMessage(s.rootMessage),n.TUIStore.reset(Sc.CHAT,["quoteMessage"],!0),e)))}sendTextAtMessage(e,t){const n=this.getEngine(),{message:o,type:i}=this.getStoreData(Sc.CHAT,"quoteMessage");let s={cloudCustomData:e.cloudCustomData||"",rootMessage:void 0};o&&(s=this.getMessageInfo(e,o,i));const a=n.chat.createTextAtMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{cloudCustomData:s.cloudCustomData}));return this.sendMessage(a,t).then((e=>(s.rootMessage&&this.modifyMessage(s.rootMessage),n.TUIStore.reset(Sc.CHAT,["quoteMessage"],!0),e)))}sendImageMessage(e,t){const n=this.getEngine().chat.createImageMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendAudioMessage(e,t){const n=this.getEngine().chat.createAudioMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendVideoMessage(e,t){const n=this.getEngine().chat.createVideoMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendCustomMessage(e,t){const n=this.getEngine().chat.createCustomMessage(Object.assign(Object.assign({},this.getCurrentConvInfo()),e));return this.sendMessage(n,t)}sendFaceMessage(e,t){const n=this.getEngine().chat.createFaceMessage(Object.assign(Object.assign({},this.getCurrentConvInfo()),e));return this.sendMessage(n,t)}sendFileMessage(e,t){const n=this.getEngine().chat.createFileMessage(Object.assign(Object.assign(Object.assign({},this.getCurrentConvInfo()),e),{onProgress:e=>{this.onProgress(n.ID,e)}}));return this.sendMessage(n,t)}sendLocationMessage(e,t){const n=this.getEngine().chat.createLocationMessage(Object.assign(Object.assign({},this.getCurrentConvInfo()),e));return this.sendMessage(n,t)}onProgress(e,t){const n=this.getEngine().TUIStore.getMessageModel(e);n&&(t-n.progress>=.1||1===t)&&(n.progress=t,this.updateMessageList([n],"edit"))}setAbstractList(e){const t=this.getEngine(),n=e.nick||e.from;let o="";switch(e.type){case t.TYPES.MSG_TEXT:o=e.payload.text||"",o.length>20&&(o=o.slice(0,20));break;case t.TYPES.MSG_MERGER:o=`${this.t("TUIChat.[聊天记录]")}`;break;case t.TYPES.MSG_IMAGE:o=`${this.t("TUIChat.[图片]")}`;break;case t.TYPES.MSG_AUDIO:o=`${this.t("TUIChat.[音频]")}`;break;case t.TYPES.MSG_VIDEO:o=`${this.t("TUIChat.[视频]")}`;break;case t.TYPES.MSG_CUSTOM:o=`${this.t("TUIChat.[自定义消息]")}`;break;case t.TYPES.MSG_FILE:o=`${this.t("TUIChat.[文件]")}`;break;case t.TYPES.MSG_FACE:o=`${this.t("TUIChat.[动画表情]")}`}return`${n}: ${o}`}genMergerForwardPayload(e,t){const{abstractList:n=[],compatibleText:o="",title:i}=t;return 0===n.length&&e.forEach((e=>{n.push(this.setAbstractList(e))})),{messageList:e,title:i,abstractList:n,compatibleText:o||this.t("TUIChat.请升级IMSDK到v2.10.1或更高版本查看此消息")}}genSendMergerForwardMessage(e){const{conversationList:t,messageList:n,params:o,mergeInfo:i,sendMessageOptions:s}=e,a=[];for(let r=0;r<t.length;r++){const{conversationID:e,type:c}=t[r],u=Object.assign({to:e.replace(`${c}`,""),conversationType:c,payload:this.genMergerForwardPayload(n,i)},o),l=this.getEngine().chat.createMergerMessage(u);a.push(this.sendMessage(l,s))}return a}genTitle(e,t){const{nick:n,from:o,to:i}=e;return`${n||o} ${this.t("TUIChat.和")} ${t||i} ${this.t("TUIChat.的聊天记录")}`}genMergeInfo(e){var t;return Cc(this,void 0,void 0,(function*(){const{messageList:n,mergeInfo:o}=e;if(o.title)return o;if(n[0].conversationType===this.getEngine().TYPES.CONV_GROUP)return o.title=this.t("TUIChat.群聊的聊天记录"),o;try{const{data:e=[]}=yield this.getEngine().TUIUser.getUserProfile({userIDList:[n[0].to]});o.title=this.genTitle(n[0],null===(t=e[0])||void 0===t?void 0:t.nick)}catch(i){o.title=this.genTitle(n[0])}return o}))}sendMergerForwardMessage(e){return Cc(this,void 0,void 0,(function*(){return e.mergeInfo=yield this.genMergeInfo(e),Promise.all(this.genSendMergerForwardMessage(e))}))}getOriginMessageList(e){return e.map((e=>e instanceof pu?e.getMessage():e))}sendForwardMessage(e,t,n){t=this.getOriginMessageList(t);const o=n||{},{needMerge:i=!1,params:s={},mergeInfo:a={}}=o,r=Mc(o,["needMerge","params","mergeInfo"]);if(i)return this.sendMergerForwardMessage({conversationList:e,messageList:t,params:s,mergeInfo:a,sendMessageOptions:r});const c=[];for(let u=0;u<e.length;u++){const{conversationID:n,type:o}=e[u],i=Object.assign({to:n.replace(`${o}`,""),conversationType:o},s),a=r[n]||r;for(let e=0;e<t.length;e++){Reflect.set(i,"payload",t[e]);const n=this.getEngine().chat.createForwardMessage(i);c.push(this.sendMessage(n,a))}}return Promise.all(c)}revokeMessage(e){const t=this.getEngine().chat.revokeMessage(e);return this.getResponse(t,!0,!1)}resendMessage(e){e.status="unSend",this.updateMessageList([e],"resend");const t=this.getEngine().chat.resendMessage(e);return this.getResponse(t,!0,!0)}deleteMessage(e){const t=this.getEngine().chat.deleteMessage(e);return this.getResponse(t,!0,!1)}setMessageExtensions(e,t){return this.getEngine().chat.setMessageExtensions(e,t)}getMessageExtensions(e){return this.getEngine().chat.getMessageExtensions(e)}deleteMessageExtensions(e,t){return this.getEngine().chat.deleteMessageExtensions(e,t)}modifyMessage(e){const t=this.getEngine().chat.modifyMessage(e);return this.getResponse(t,!0,!1).catch((e=>{const{code:t=0,data:n={}}=e.code;throw t===Lc.MSG_MODIFY_CONFLICT?_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${Oc.MSG_MODIFY_CONFLICT} data.message: ${null==n?void 0:n.message}`):t===Lc.MSG_MODIFY_DISABLED_IN_AVCHATROOM?_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",Oc.MSG_MODIFY_DISABLED_IN_AVCHATROOM):t===Lc.MODIFY_MESSAGE_NOT_EXIST&&_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",Oc.MODIFY_MESSAGE_NOT_EXIST),e}))}getMessageList(e={conversationID:this.getStoreData(Sc.CONV,"currentConversationID"),nextReqMessageID:this.getStoreData(Sc.CHAT,"nextReqMessageID")}){const t=this.getEngine();if(!t.chat.isReady())return Promise.reject({code:Ac.GET_MSG_LIST_ERROR,message:Nc.GET_MSG_LIST_ERROR});if(this.getStoreData(Sc.CHAT,"isCompleted"))return Promise.resolve({data:{messageList:[],nextReqMessageID:"",isCompleted:!0}});const n=this.getStoreData(Sc.CHAT,"messageSource"),o=this.hoppingConfigMap.get("nextMessageSeq"),i=this.hoppingConfigMap.get("nextMessageTime"),s=o||i;return n&&n.conversationID===(null==e?void 0:e.conversationID)&&s?this.getMessageListHopping():t.chat.getMessageList(e).then((e=>{var n;const{messageList:o,nextReqMessageID:i,isCompleted:s}=e.data,a=this.getStoreData(Sc.CHAT,"userInfo");Object.keys(a).length>0&&this.updateLocalMessage(o,a),this.updateMessageList(o,"unshift"),t.TUIStore.update(Sc.CHAT,"nextReqMessageID",i),t.TUIStore.update(Sc.CHAT,"isCompleted",s);const r=null===(n=o[0])||void 0===n?void 0:n.conversationID,{operationType:c=0}=this.getEngine().TUIStore.getConversationModel(r)||{};return 0===c&&(this.getMessageReactions({messageList:o}),this.readReceiptHandler.getMessageReadReceiptList(o)),e})).catch((e=>Promise.reject(e)))}getMessageListHopping(e){var t;void 0===e&&(e={conversationID:null===(t=this.getStoreData(Sc.CHAT,"messageSource"))||void 0===t?void 0:t.conversationID,sequence:this.hoppingConfigMap.get("nextMessageSeq"),time:this.hoppingConfigMap.get("nextMessageTime")});const n=this.getEngine();return n.chat.getMessageListHopping(e).then((t=>{const{messageList:o,nextMessageSeq:i,nextMessageTime:s,isCompleted:a}=t.data,r=1===e.direction?e.sequence:i,c=1===e.direction?e.time:s;return this.updateMessageList(o,"unshift"),this.delayGetHoppingFunction=void 0,this.hoppingConfigMap.set("nextMessageSeq",r),this.hoppingConfigMap.set("nextMessageTime",c),n.TUIStore.update(Sc.CHAT,"isCompleted",a),t})).catch((e=>Promise.reject(e)))}sendMessageReadReceipt(e){return this.readReceiptHandler.sendMessageReadReceipt(e)}getGroupMessageReadMemberList(e){return this.readReceiptHandler.getGroupMessageReadMemberList(e).then((e=>{const{isCompleted:t,cursor:n,messageID:o,unreadUserIDList:i,readUserIDList:s}=e.data,a={code:0,data:{cursor:n,isCompleted:t,messageID:o,unreadUserInfoList:[],readUserInfoList:[]}},r=[...i,...s];return 0===r.length?a:this.getEngine().TUIUser.getUserProfile({userIDList:r}).then((e=>(i.length>0?e.data.forEach((e=>{const{userID:t,nick:n="",avatar:o=""}=e;a.data.unreadUserInfoList.push({userID:t,nick:n,avatar:o})})):e.data.forEach((e=>{const{userID:t,nick:n="",avatar:o=""}=e;a.data.readUserInfoList.push({userID:t,nick:n,avatar:o})})),a)))}))}downloadMergedMessages(e){return this.getEngine().chat.downloadMergerMessage(e)}setTranslationLanguage(e){this.getEngine().TUIStore.update(Sc.USER,"targetLanguage",e)}translateText(e){const t=this.getStoreData(Sc.USER,"targetLanguage"),n=Object.assign({targetLanguage:t,sourceLanguage:"auto"},e);return this.getEngine().chat.translateText(n)}searchCloudMessages(e){const t=this.getStoreData(Sc.CONV,"conversationList");return this.getEngine().chat.searchCloudMessages(e).then((e=>{const{searchResultList:n}=e.data;return e.data.searchResultList=n.map((e=>{const{messageList:n,conversationID:o}=e,i=Mc(e,["messageList","conversationID"]),s=n.map((e=>new pu(e))),a=t.find((e=>e.conversationID===o));return Object.assign(Object.assign({},i),{messageList:s.sort(((e,t)=>t.time-e.time)),conversation:a})})),e}))}addMessageReaction(e,t){return this.getEngine().chat.addMessageReaction(e.getMessage(),t)}removeMessageReaction(e,t){return this.getEngine().chat.removeMessageReaction(e.getMessage(),t)}getMessageReactions(e){const{messageList:t=[]}=e,n=this.getStoreData(Sc.APP,"enabledEmojiPlugin");_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIChatService.getMessageReactions enabledEmojiPlugin:${n} messageList length:${t.length}`),n&&t.length>0&&this.getEngine().chat.getMessageReactions(e).then((e=>{const t=e.data.resultList||e.data;this.updateMessageReactionList(t)})).catch((e=>{}))}getAllUserListOfMessageReaction(e){var t;return this.getEngine().chat.getAllUserListOfMessageReaction(Object.assign(Object.assign({},e),{message:null===(t=null==e?void 0:e.message)||void 0===t?void 0:t.getMessage()}))}updateMessageReactionList(e){const t=[];e.forEach((e=>{const{messageID:n,reactionList:o}=e,i=this.getEngine().TUIStore.getMessageModel(n);if(i){const e=[];for(let t=0;t<o.length;t++){let n=!0;for(let e=0;e<i.reactionList.length;e++)if(o[t].reactionID===i.reactionList[e].reactionID){i.reactionList[e]=o[t],n=!1;break}n&&e.push(o[t])}i.reactionList.push(...e),e.length=0,t.push(i)}})),t.length>0&&this.updateMessageList(t,"edit")}convertVoiceToText(e){const{message:t,language:n="zh"}=e,o=t.getMessage();return this.getEngine().chat.convertVoiceToText({message:o,language:n})}clearHistoryMessage(e){const t=this.getEngine();return t.chat.clearHistoryMessage(e).then((e=>(t.TUIStore.update(Sc.CHAT,"messageList",[]),t.TUIStore.update(Sc.CHAT,"nextReqMessageID",""),t.TUIStore.update(Sc.CHAT,"isCompleted",!1),e)))}updateMessageInfo(e){const t=this.getStoreData(Sc.CHAT,"userInfo");this.getEngine().TUIStore.update(Sc.CHAT,"userInfo",Object.assign(t,e));const n=this.getStoreData(Sc.CHAT,"messageList");n.length>0&&this.updateLocalMessage(n,e)&&this.getEngine().TUIStore.update(Sc.CHAT,"messageList",n)}updateLocalMessage(e,t){let n=!1;return e.forEach((e=>{if(t[e.from]){const{nick:o,nameCard:i,avatar:s}=t[e.from];o&&(e.nick=o,n=!0),i&&(e.nameCard=i,n=!0),s&&(e.avatar=s,n=!0)}})),n}handleC2CCallSignaling(e){const t=this.getEngine(),n=t.getMyUserID();return e.filter((e=>{var o,i,s,a,r;const{conversationType:c,type:u,payload:l}=e;let d=!0;if(c===t.TYPES.CONV_C2C&&u===t.TYPES.MSG_CUSTOM&&t.chat.getSignalingInfo(e)){const t=wc(l.data);if(1===(null==t?void 0:t.businessID)){const c=wc(t.data);if(d=!(e._isExcludedFromUnreadCount&&e._isExcludedFromLastMessage),d&&!0!==(null===(o=null==c?void 0:c.data)||void 0===o?void 0:o.consumed)){let o=null===(i=null==c?void 0:c.data)||void 0===i?void 0:i.inviter;"line_busy"!==(null==c?void 0:c.line_busy)&&"lineBusy"!==(null===(s=null==c?void 0:c.data)||void 0===s?void 0:s.message)||(o=t.inviter);const{from:u,to:l}=e;if(o!==n&&e.from===n){const t=this.getStoreData(Sc.CONV,"currentConversation");e.from=l,e.to=u,e.flow="in",e.avatar=(null===(a=null==t?void 0:t.userProfile)||void 0===a?void 0:a.avatar)||""}if(o===n&&e.from!==n){const t=this.getStoreData(Sc.USER,"userProfile");e.from=l,e.to=u,e.flow="out",e.avatar=null==t?void 0:t.avatar}_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`${this.serv}.handleC2CCallSignaling myUserID:${n} callSignaling.inviter:${t.inviter} customData.data.inviter:${null===(r=null==c?void 0:c.data)||void 0===r?void 0:r.inviter}`)}}}return d}))}sortMessageList(e){if(e[0].conversationType===this.getEngine().TYPES.CONV_C2C)return e.sort(((e,t)=>e.time-t.time));const t=e.filter((e=>"success"===e.status)).sort(((e,t)=>e.sequence-t.sequence));for(let n=0;n<e.length;n++)"success"!==e[n].status&&t.splice(n,0,e[n]);return t}}class ql extends ru{constructor(){super(),this.groupMap=new Map}static getInstance(){return ql.instance||(ql.instance=new ql),ql.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.GROUP_LIST_UPDATED,this.onGroupListUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.GROUP_ATTRIBUTES_UPDATED,this.onGroupAttributesUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.GROUP_COUNTER_UPDATED,this.onGroupCounterUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.MESSAGE_RECEIVED,this.onMessageReceived.bind(this)),this.getGroupInitData()}onGroupListUpdated(e){const t=this.getEngine();t.TUIStore.update(Sc.GRP,"groupList",e);const n=t.TUIStore.getData(Sc.GRP,"currentGroupID");e.forEach((e=>{e.groupID===n&&t.TUIStore.update(Sc.GRP,"currentGroup",e)}))}onGroupAttributesUpdated(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.GRP,"currentGroupID");let o=t.TUIStore.getData(Sc.GRP,"groupList");const{groupID:i,groupAttributes:s}=e;n===i&&t.TUIStore.update(Sc.GRP,"currentGroupAttributes",s),o=o.map((e=>(e.groupID===i&&(e.groupAttributes=s),e))),t.TUIStore.update(Sc.GRP,"groupList",o)}onGroupCounterUpdated(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.GRP,"currentGroupID"),o=t.TUIStore.getData(Sc.GRP,"currentGroupCounters")||{};let i=t.TUIStore.getData(Sc.GRP,"groupList");const{groupID:s,key:a,value:r}=e;n===s&&(o[a]=r,t.TUIStore.update(Sc.GRP,"currentGroupCounters",o)),i=i.map((e=>(e.groupID===s&&(e.groupCounters=Object.assign(Object.assign({},e.groupCounters),{[a]:r})),e))),t.TUIStore.update(Sc.GRP,"groupList",i)}onMessageReceived(e){const t=this.getEngine(),n=[];e.forEach((e=>{if(e.type===t.TYPES.MSG_GRP_TIP){const{payload:n}=e,{operationType:o,userIDList:i}=n;switch(t.TUIStore.getData(Sc.GRP,"currentGroupID"),o){case t.TYPES.GRP_TIP_MBR_JOIN:this.addMemberList(i);break;case t.TYPES.GRP_TIP_MBR_QUIT:case t.TYPES.GRP_TIP_MBR_KICKED_OUT:this.removeMemberList(i);break;case t.TYPES.GRP_TIP_MBR_SET_ADMIN:case t.TYPES.GRP_TIP_MBR_CANCELED_ADMIN:this.updateGroupMember(i);break;case t.TYPES.GRP_TIP_GRP_PROFILE_UPDATED:break;case t.TYPES.GRP_TIP_MBR_PROFILE_UPDATED:case t.TYPES.GRP_TIP_BAN_AVCHATROOM_MEMBER:case t.TYPES.GRP_TIP_UNBAN_AVCHATROOM_MEMBER:this.updateGroupMember(i)}}e.type===t.TYPES.MSG_GRP_SYS_NOTICE&&n.push(e)})),n.length>0&&t.TUIStore.update(Sc.GRP,"groupSystemNoticeList",n)}getGroupInitData(){const e=this.getEngine();e.chat.isReady()&&e.chat.getGroupList().then((e=>{const{groupList:t=[]}=e.data;_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIGroupService.init, getGroupList count:${t.length}`),t.length>0&&this.onGroupListUpdated(t)}))}updateGroupMember(e){return Cc(this,void 0,void 0,(function*(){const t=this.getEngine().TUIStore.getData(Sc.GRP,"currentGroupID");if(t){const n=yield this.getGroupMemberProfile({groupID:t,userIDList:e}),{memberList:o}=n.data;this.updateMemberList(o)}}))}resetCurrentStore(){this.getEngine().TUIStore.reset(Sc.GRP,["currentGroupID","currentGroup","currentGroupAttributes","currentGroupCounters","currentGroupMemberList"],!0)}switchGroup(e){return Cc(this,void 0,void 0,(function*(){const t=this.getEngine();t.TUIStore.update(Sc.GRP,"offset",0),t.TUIStore.update(Sc.GRP,"isCompleted",!1);const n=t.TUIStore.getConversationModel(`GROUP${e}`);if((null==n?void 0:n.operationType)>0){const e=t.TUIStore.getData(Sc.GRP,"currentGroup");return Promise.resolve(e)}const o=t.TUIStore.getData(Sc.GRP,"currentGroupID");if(!e)return this.resetCurrentStore(),Promise.resolve({});if(o===e){const e=t.TUIStore.getData(Sc.GRP,"currentGroup");return Promise.resolve(e)}this.resetCurrentStore(),t.TUIStore.update(Sc.GRP,"currentGroupID",e);try{yield this.getGroupInfo(e)}catch(a){Promise.reject(a)}const i=setTimeout((()=>{this.groupMap.delete(e),clearTimeout(i)}),5e3),s=t.TUIStore.getData(Sc.GRP,"currentGroup");return Promise.resolve(s)}))}getGroupInfo(e){return Cc(this,void 0,void 0,(function*(){const t=this.getEngine(),n=this.groupMap.get(e);if(n)return this.updateMemberList((null==n?void 0:n.memberList)||[]),t.TUIStore.update(Sc.GRP,"currentGroup",n.group),t.TUIStore.update(Sc.GRP,"currentGroupAttributes",n.groupAttributes||{}),void t.TUIStore.update(Sc.GRP,"currentGroupCounters",n.counters||{});const o={group:{},memberList:[],groupAttributes:void 0,counters:void 0},{data:{group:i}}=yield this.getGroupProfile({groupID:e});o.group=i;const{data:{memberList:s}}=yield this.getGroupMemberList({groupID:e});o.memberList=s;const a=yield this.getGroupAttributes({groupID:e,keyList:[]}),{groupAttributes:r}=a.data;o.groupAttributes=r,t.TUIStore.update(Sc.GRP,"currentGroupAttributes",r);try{const n=yield this.getGroupCounters({groupID:e,keyList:[]}),{counters:i}=n.data;o.counters=i,t.TUIStore.update(Sc.GRP,"currentGroupCounters",i)}catch(c){_("warn","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",null==c?void 0:c.message)}this.groupMap.set(e,o)}))}getGroupProfile(e){const t=this.getEngine();return t.chat.getGroupProfile(e).then((n=>Cc(this,void 0,void 0,(function*(){if(t.TUIStore.getData(Sc.GRP,"currentGroupID")===e.groupID){const{group:e}=n.data;t.TUIStore.update(Sc.GRP,"currentGroup",e)}return n}))))}updateGroupProfile(e){return this.getEngine().chat.updateGroupProfile(e)}createGroup(e){return this.getEngine().chat.createGroup(e)}dismissGroup(e){return this.getEngine().chat.dismissGroup(e)}searchGroupByID(e){const t=this.getEngine();return t.chat.searchGroupByID(e).then((e=>{const{group:n}=e.data,o=t.TUIStore.getData(Sc.GRP,"groupList");return e.data.group.isJoinedGroup=o.some((e=>e.groupID===n.groupID)),e}))}joinGroup(e){return this.getEngine().chat.joinGroup(e)}quitGroup(e){return this.getEngine().chat.quitGroup(e)}getGroupApplicationList(){return this.getEngine().chat.getGroupApplicationList()}handleGroupApplication(e){return this.getEngine().chat.handleGroupApplication(e)}getGroupOnlineMemberCount(e){return this.getEngine().chat.getGroupOnlineMemberCount(e)}changeGroupOwner(e){return this.getEngine().chat.changeGroupOwner(e)}initGroupAttributes(e){return this.getEngine().chat.initGroupAttributes(e)}setGroupAttributes(e){return this.getEngine().chat.setGroupAttributes(e)}deleteGroupAttributes(e){return this.getEngine().chat.deleteGroupAttributes(e)}getGroupAttributes(e){return this.getEngine().chat.getGroupAttributes(e)}setGroupCounters(e){return this.getEngine().chat.setGroupCounters(e)}increaseGroupCounter(e){return this.getEngine().chat.increaseGroupCounter(e)}decreaseGroupCounter(e){return this.getEngine().chat.decreaseGroupCounter(e)}getGroupCounters(e){return this.getEngine().chat.getGroupCounters(e)}updateMemberList(e){const t=this.getEngine(),n=[...(t.TUIStore.getData(Sc.GRP,"currentGroupMemberList")||[]).filter((t=>!e.find((e=>e.userID===t.userID)))),...e];t.TUIStore.update(Sc.GRP,"currentGroupMemberList",n)}addMemberList(e){return Cc(this,void 0,void 0,(function*(){const t=this.getEngine().TUIStore.getData(Sc.GRP,"currentGroupID");if(t)try{const n=yield this.getGroupMemberProfile({groupID:t,userIDList:e}),{memberList:o}=n.data;this.updateMemberList(o)}catch(n){const t=e.map((e=>({userID:e,avatar:"",nick:"",role:"",joinTime:0,nameCard:"",muteUntil:0,memberCustomField:[]})));this.updateMemberList(t)}}))}removeMemberList(e){const t=this.getEngine(),n=t.TUIStore.getData(Sc.GRP,"currentGroupMemberList").filter((t=>-1===e.indexOf(t.userID)));t.TUIStore.update(Sc.GRP,"currentGroupMemberList",n)}getGroupMemberList(e){const t=this.getEngine();if(bc(e.offset)){const n=t.TUIStore.getData(Sc.GRP,"offset");e.offset=n}return t.chat.getGroupMemberList(e).then((n=>{if(t.TUIStore.getData(Sc.GRP,"currentGroupID")===e.groupID){const{memberList:e,offset:o=0}=n.data;this.updateMemberList(e),t.TUIStore.update(Sc.GRP,"offset",o),0===o&&t.TUIStore.update(Sc.GRP,"isCompleted",!0)}return n}))}getGroupMemberProfile(e){return this.getEngine().chat.getGroupMemberProfile(e)}addGroupMember(e){const t=this.getEngine();return t.chat.addGroupMember(e).then((n=>Cc(this,void 0,void 0,(function*(){if(t.TUIStore.getData(Sc.GRP,"currentGroupID")===e.groupID){const{successUserIDList:e,group:o}=n.data;t.TUIStore.update(Sc.GRP,"currentGroup",o),this.addMemberList(e)}return n}))))}deleteGroupMember(e){const t=this.getEngine();return t.chat.deleteGroupMember(e).then((n=>{if(t.TUIStore.getData(Sc.GRP,"currentGroupID")===e.groupID){const{userIDList:e,group:o}=n.data;this.removeMemberList(e),t.TUIStore.update(Sc.GRP,"currentGroup",o)}return n}))}setGroupMemberMuteTime(e){return this.getEngine().chat.setGroupMemberMuteTime(e)}setGroupMemberRole(e){return this.getEngine().chat.setGroupMemberRole(e)}setGroupMemberNameCard(e){return this.getEngine().chat.setGroupMemberNameCard(e)}setGroupMemberCustomField(e){return this.getEngine().chat.setGroupMemberCustomField(e)}markGroupMemberList(e){return this.getEngine().chat.markGroupMemberList(e)}}class Bl extends ru{constructor(){super()}static getInstance(){return Bl.instance||(Bl.instance=new Bl),Bl.instance}init(){const e=this.getEngine();e.eventCenter.addEvent(e.EVENT.FRIEND_LIST_UPDATED,this.onFriendListUpdated.bind(this)),e.eventCenter.addEvent(e.EVENT.FRIEND_APPLICATION_LIST_UPDATED,this.onFriendApplicationListUpdated.bind(this)),this.getFriendInitData()}onFriendListUpdated(e){this.getEngine().TUIStore.update(Sc.FRIEND,"friendList",e)}onFriendApplicationListUpdated(e){const{friendApplicationList:t,unreadCount:n=0}=e,o=this.getEngine();o.TUIStore.update(Sc.FRIEND,"friendApplicationList",t),o.TUIStore.update(Sc.FRIEND,"friendApplicationUnreadCount",n)}getFriendInitData(){const e=this.getEngine();e.chat.isReady()&&(e.chat.getFriendList().then((e=>{const t=e.data||[];_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1",`TUIFriendService.init, getFriendList count:${t.length}`),t.length>0&&this.onFriendListUpdated(t)})),e.chat.getFriendApplicationList().then((e=>{this.onFriendApplicationListUpdated(e.data)})))}getFriendList(){return this.getEngine().chat.getFriendList()}getFriendRemark(e){const t=this.getEngine().TUIStore.getData(Sc.FRIEND,"friendList"),n={};return e.forEach((e=>{for(let o=0;o<t.length;o++)t[o].userID!==e||(n[e]=t[o].remark)})),n}addFriend(e){return this.getEngine().chat.addFriend(e)}deleteFriend(e){return this.getEngine().chat.deleteFriend(e)}checkFriend(e){return this.getEngine().chat.checkFriend(e)}getFriendProfile(e){return this.getEngine().chat.getFriendProfile(e)}updateFriend(e){return this.getEngine().chat.updateFriend(e)}acceptFriendApplication(e){return this.getEngine().chat.acceptFriendApplication(e)}refuseFriendApplication(e){return this.getEngine().chat.refuseFriendApplication({userID:e})}deleteFriendApplication(e){return this.getEngine().chat.deleteFriendApplication(e)}setFriendApplicationRead(){return this.getEngine().chat.setFriendApplicationRead()}}class Hl extends ru{static getInstance(){return Hl.instance||(Hl.instance=new Hl),Hl.instance}reportFeature(e,t){var n;return null===(n=this.getEngine().chat)||void 0===n?void 0:n.callExperimentalAPI("statTUIKeyFeatures",{code:e,msg:t?`${e}-${t}`:""})}}class jl{constructor(){this.cache=[],this.middlewares=[],this.options=null}use(e){return"function"!=typeof e&&_("error","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","middleware must be a function"),this.cache.push(e),this}next(){if(this.middlewares&&this.middlewares.length>0)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}run(e){return this.middlewares=this.cache.map((function(e){return e})),this.options=e,this.next()}}function Kl(e,t,n){const o=Object.create(null);Object.keys(n).forEach((n=>{if(!t[n])return;o[n]=t[n];const i=new jl;t[n]=function(){const s=Array.from(arguments);return i.use((function(t,o){return e.isInited?o():Promise.reject({code:Ac.NOT_INIT,message:`${n} | ${Nc.NOT_INIT}`})})).use((function(e,i){return o[n].apply(t,e)})),i.run(s)}}))}_("log","at node_modules/@tencentcloud/chat-uikit-engine/index.js:1","TUIChatEngine.VERSION:2.4.0");const Yl=iu.getInstance();ou.getInstance();const zl=yu.getInstance(),Wl=Rl.getInstance(),Jl=Ll.getInstance(),$l=Gl.getInstance(),Xl=Vl.getInstance(),Zl=ql.getInstance(),Ql=Bl.getInstance(),ed=Hl.getInstance();Yl.mount(Ec.TUIStore,zl),Yl.mount(Ec.TUITranslate,Wl),Yl.mount(Ec.TUIConversation,Jl),Yl.mount(Ec.TUIUser,$l),Yl.mount(Ec.TUIChat,Xl),Yl.mount(Ec.TUIGroup,Zl),Yl.mount(Ec.TUIFriend,Ql),Yl.mount(Ec.TUIReport,ed),Kl(Yl,Yl,Pc),Kl(Yl,Jl,{deleteConversation:1,pinConversation:1,muteConversation:1,switchConversation:1,getConversationProfile:1,clearHistoryMessage:1}),Kl(Yl,Xl,{modifyMessage:1,revokeMessage:1,resendMessage:1,deleteMessage:1,quoteMessage:1,replyMessage:1,setMessageExtensions:1,deleteMessageExtensions:1,getMessageExtensions:1,sendTextMessage:1,sendTextAtMessage:1,sendImageMessage:1,sendAudioMessage:1,sendVideoMessage:1,sendFileMessage:1,sendCustomMessage:1,sendFaceMessage:1,sendLocationMessage:1,sendForwardMessage:1,enterTypingState:1,leaveTypingState:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageList:1,downloadMergedMessages:1,setTranslationLanguage:1,translateText:1,searchCloudMessages:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1}),Kl(Yl,Zl,{switchGroup:1,getGroupProfile:1,updateGroupProfile:1,createGroup:1,dismissGroup:1,searchGroupByID:1,joinGroup:1,quitGroup:1,getGroupApplicationList:1,handleGroupApplication:1,getGroupOnlineMemberCount:1,changeGroupOwner:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getGroupMemberList:1,getGroupMemberProfile:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberNameCard:1,setGroupMemberCustomField:1,markGroupMemberList:1}),Kl(Yl,$l,{switchUserStatus:1,switchMessageReadStatus:1,getUserProfile:1,updateMyProfile:1,addToBlacklist:1,removeFromBlacklist:1}),Kl(Yl,Ql,{getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,getFriendProfile:1,updateFriend:1,acceptFriendApplication:1,refuseFriendApplication:1,deleteFriendApplication:1,setFriendApplicationRead:1}),Kl(Yl,ed,Pc);const td=e=>"function"==typeof e,nd=e=>/^(https?:\/\/(([a-zA-Z0-9]+-?)+[a-zA-Z0-9]+\.)+[a-zA-Z]+)(:\d+)?(\/.*)?(\?.*)?(#.*)?$/.test(e),od=e=>e&&(e=>{if("string"==typeof e)try{return!!JSON.parse(e)}catch(t){return!1}return!1})(e)?JSON.parse(e):e,id="pc"===Ye(),sd="h5"===Ye(),ad="wechat"===Ye(),rd="app"===Ye(),cd="undefined"!=typeof uni,ud=sd||ad||rd;class ld{constructor(){$.registerEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS,this),$.registerService(b.TUICalling.SERVICE.NAME,this),$.registerExtension(b.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,this)}onNotifyEvent(e,t){if(e===b.TUILogin.EVENT.LOGIN_STATE_CHANGED){let e,n,o,i;if(t===b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS)i=X.getContext(),e=i.SDKAppID,n=i.userID,o=i.userSig,be.$TUICallKit&&be.$TUICallKit.login({SDKAppID:e,userID:n,userSig:o},(e=>{0===e.code?(_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:32","TUICallkit login success!"),be.$TUICallKit.enableFloatWindow(!0)):_("error","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:36",`TUICallkit login failed,${e.msg}`)}))}}onGetExtension(e,t){if(!be.$TUICallKit)return _("warn","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:49","请检查原生插件 TencentCloud-TUICallKit 是否已集成"),[];if(e===b.TUIChat.EXTENSION.INPUT_MORE.EXT_ID){const e=[],n={weight:1e3,text:"语音通话",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/call.png",data:{name:"voiceCall"},listener:{onClicked:e=>{this.setCallExtension(e)}}},o={weight:900,text:"视频通话",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/call-video-reverse.svg",data:{name:"videoCall"},listener:{onClicked:e=>{this.setCallExtension(e)}}};return(null==t?void 0:t.filterVoice)||e.push(n),(null==t?void 0:t.filterVideo)||e.push(o),e}}onCall(e,t){if(be.$TUICallKit){if(e===b.TUICalling.SERVICE.METHOD.START_CALL){const{groupID:e,userIDList:n=[],type:o,callParams:i}=t;e?be.$TUICallKit.groupCall({groupID:e,userIDList:n,callMediaType:o,callParams:i},(e=>{0===e.code?_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:108","TUICallkit groupCall success"):_("error","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:110",`TUICallkit groupCall failed,${e.msg}`)})):1===n.length&&be.$TUICallKit.call({userID:n[0],callMediaType:o,callParams:i},(e=>{0===e.code?_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:122","TUICallkit call success"):_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:124",`TUICallkit call failed,${e.msg}`)}))}}else _("warn","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:95","请检查原生插件 TencentCloud-TUICallKit 是否已集成")}setCallExtension(e){const{groupID:t,userIDList:n=[],type:o,callParams:i}=e;try{t?be.$TUICallKit.groupCall({groupID:t,userIDList:n,callMediaType:o,callParams:i},(e=>{0===e.code?_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:143","TUICallkit groupCall success"):_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:145",`TUICallkit groupCall failed,${e.msg}`)})):1===n.length&&be.$TUICallKit.call({userID:n[0],callMediaType:o,callParams:i},(e=>{0===e.code?_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:158","TUICallkit call success"):_("log","at src/roomkit/TUIKit/plugins/extension-server/callkit.ts:160",`TUICallkit call failed,${e.msg}`)}))}catch(s){be.showToast({title:"拨打失败！",icon:"error"})}}}const dd={"[TUIEmoji_Smile]":"[Smile]","[TUIEmoji_Expect]":"[Expect]","[TUIEmoji_Blink]":"[Blink]","[TUIEmoji_Guffaw]":"[Guffaw]","[TUIEmoji_KindSmile]":"[KindSmile]","[TUIEmoji_Haha]":"[Haha]","[TUIEmoji_Cheerful]":"[Cheerful]","[TUIEmoji_Speechless]":"[Speechless]","[TUIEmoji_Amazed]":"[Amazed]","[TUIEmoji_Sorrow]":"[Sorrow]","[TUIEmoji_Complacent]":"[Complacent]","[TUIEmoji_Silly]":"[Silly]","[TUIEmoji_Lustful]":"[Lustful]","[TUIEmoji_Giggle]":"[Giggle]","[TUIEmoji_Kiss]":"[Kiss]","[TUIEmoji_Wail]":"[Wail]","[TUIEmoji_TearsLaugh]":"[TearsLaugh]","[TUIEmoji_Trapped]":"[Trapped]","[TUIEmoji_Mask]":"[Mask]","[TUIEmoji_Fear]":"[Fear]","[TUIEmoji_BareTeeth]":"[BareTeeth]","[TUIEmoji_FlareUp]":"[FlareUp]","[TUIEmoji_Yawn]":"[Yawn]","[TUIEmoji_Tact]":"[Tact]","[TUIEmoji_Stareyes]":"[StarEyes]","[TUIEmoji_ShutUp]":"[ShutUp]","[TUIEmoji_Sigh]":"[Sigh]","[TUIEmoji_Hehe]":"[Hehe]","[TUIEmoji_Silent]":"[Silent]","[TUIEmoji_Surprised]":"[Surprised]","[TUIEmoji_Askance]":"[Askance]]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[Shit]","[TUIEmoji_Monster]":"[Monster]","[TUIEmoji_Daemon]":"[Daemon]","[TUIEmoji_Rage]":"[Rage]","[TUIEmoji_Fool]":"[Fool]","[TUIEmoji_Pig]":"[Pig]","[TUIEmoji_Cow]":"[Cow]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[Skull]","[TUIEmoji_Bombs]":"[Bombs]","[TUIEmoji_Coffee]":"[Coffee]","[TUIEmoji_Cake]":"[Cake]","[TUIEmoji_Beer]":"[Beer]","[TUIEmoji_Flower]":"[Flower]","[TUIEmoji_Watermelon]":"[Watermelon]","[TUIEmoji_Rich]":"[Rich]","[TUIEmoji_Heart]":"[Heart]","[TUIEmoji_Moon]":"[Moon]","[TUIEmoji_Sun]":"[Sun]","[TUIEmoji_Star]":"[Star]","[TUIEmoji_RedPacket]":"[RedPacket]","[TUIEmoji_Celebrate]":"[Celebrate]","[TUIEmoji_Bless]":"[Bless]","[TUIEmoji_Fortune]":"[Fortune]","[TUIEmoji_Convinced]":"[Convinced]","[TUIEmoji_Prohibit]":"[Prohibit]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[Knife]","[TUIEmoji_Like]":"[Like]"},pd={"[TUIEmoji_Smile]":"[微笑]","[TUIEmoji_Expect]":"[期待]","[TUIEmoji_Blink]":"[眨眼]","[TUIEmoji_Guffaw]":"[大笑]","[TUIEmoji_KindSmile]":"[姨母笑]","[TUIEmoji_Haha]":"[哈哈哈]","[TUIEmoji_Cheerful]":"[愉快]","[TUIEmoji_Speechless]":"[无语]","[TUIEmoji_Amazed]":"[惊讶]","[TUIEmoji_Sorrow]":"[悲伤]","[TUIEmoji_Complacent]":"[得意]","[TUIEmoji_Silly]":"[傻了]","[TUIEmoji_Lustful]":"[色]","[TUIEmoji_Giggle]":"[憨笑]","[TUIEmoji_Kiss]":"[亲亲]","[TUIEmoji_Wail]":"[大哭]","[TUIEmoji_TearsLaugh]":"[哭笑]","[TUIEmoji_Trapped]":"[困]","[TUIEmoji_Mask]":"[口罩]","[TUIEmoji_Fear]":"[恐惧]","[TUIEmoji_BareTeeth]":"[龇牙]","[TUIEmoji_FlareUp]":"[发怒]","[TUIEmoji_Yawn]":"[打哈欠]","[TUIEmoji_Tact]":"[机智]","[TUIEmoji_Stareyes]":"[星星眼]","[TUIEmoji_ShutUp]":"[闭嘴]","[TUIEmoji_Sigh]":"[叹气]","[TUIEmoji_Hehe]":"[呵呵]","[TUIEmoji_Silent]":"[收声]","[TUIEmoji_Surprised]":"[惊喜]","[TUIEmoji_Askance]":"[白眼]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[便便]","[TUIEmoji_Monster]":"[怪兽]","[TUIEmoji_Daemon]":"[恶魔]","[TUIEmoji_Rage]":"[恶魔怒]","[TUIEmoji_Fool]":"[衰]","[TUIEmoji_Pig]":"[猪]","[TUIEmoji_Cow]":"[牛]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[骷髅]","[TUIEmoji_Bombs]":"[炸弹]","[TUIEmoji_Coffee]":"[咖啡]","[TUIEmoji_Cake]":"[蛋糕]","[TUIEmoji_Beer]":"[啤酒]","[TUIEmoji_Flower]":"[花]","[TUIEmoji_Watermelon]":"[瓜]","[TUIEmoji_Rich]":"[壕]","[TUIEmoji_Heart]":"[爱心]","[TUIEmoji_Moon]":"[月亮]","[TUIEmoji_Sun]":"[太阳]","[TUIEmoji_Star]":"[星星]","[TUIEmoji_RedPacket]":"[红包]","[TUIEmoji_Celebrate]":"[庆祝]","[TUIEmoji_Bless]":"[福]","[TUIEmoji_Fortune]":"[发]","[TUIEmoji_Convinced]":"[服]","[TUIEmoji_Prohibit]":"[禁]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[刀]","[TUIEmoji_Like]":"[赞]"},hd={...{en:{"取消":"Cancel","发送":"Send","系统通知":"System notification","关闭":"Close","确定":"Save","开始时间":"Start Date","结束时间":"End Date","消息":"Messages","通讯录":"Contacts","欢迎使用腾讯云即时通信IM":"Welcome to Tencent Cloud Chat",TUIChat:{"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。":"【Security Tips】This APP is only used to experience the functions of Tencent Cloud Instant Messaging products, and cannot be used for business negotiation and expansion. Don't trust money-related information such as remittances and lottery wins, don't make unfamiliar phone calls easily, and beware of being deceived.","按Enter发送，Ctrl+Enter换行":"Press Enter to send a message and Ctrl+Enter to start a new line","表情":"[Face]","查看更多":"View more","撤回":"Recall","撤回了一条消息":" recalled a message","打开":"Open","单击下载":"Click download","点此投诉":"Complain","点击处理":"Click action","对方正在输入":"Typing...","发起群视频":"Make group video call","发起群语音":"Make group voice call","发起通话":"Start Call","发送失败":"send failed","复制":"Copy","复制成功":"Copied to clipboard","该消息不存在":"The message does not exist","关闭阅读状态":"Read status closed","管理员开启全员禁言":"The admin enables Mute All","欢迎使用TUICallKit":"Welcome to TUICallKit","回到最新位置":"Back to the latest location","回复":"Reply","回复详情":"Replies","集成TUICallKit":" Integrate TUICallKit ","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"It is detected that you have not integrated TUI CallKit yet, so you cannot experience the audio and video call. ","结束群聊":"Edit Group Call","进行体验":"to experience.","经度":"Longitude","拒绝":"Reject","拒绝通话":"Decline Call","开通腾讯实时音视频服务":"Integration Tencent Real-Time Communication","聊天记录":"[Chat history]","描述":"Description","内容包含敏感词汇":"Content contains sensitive words","您":"You","您当前购买使用的套餐包暂未开通此功能":"The package you purchased does not support this ability.","您当前购买使用的套餐包暂未开通群消息已读回执功能":"The package you purchased does not support the read receipt of group messages.","您当前购买使用的套餐包暂未开通在线用户列表功能":"The package you purchased does not support the online user list.","您已被管理员禁言":"You have been muted by the admin","您有":"You have","请点击":"Please click","请输入消息":"Enter a message","取消":"Cancel","取消通话":"Cancel Call","全部已读":"All read","确定":"Submit","确认重发该消息？":"Confirm to resend the message?","人关闭阅读状态":" read status closed","人未读":" unread","人已读":" read","删除":"Delete","涉及敏感内容":"Sensitive content","申请加入":"Application for join in","视频":"[video]","视频通话":"Video Call","条回复":"replies","条入群申请":"Item group application","条新消息":" new messages","通话时长":"Duration","同意":"Agree","图片":"[Image]","图片消息失败,无效的图片格式":"Image message failed, invalid image format.","纬度":"Latitude","未读":"Unread","位置":"[Location]","文件":"[File]","文件不存在,请检查文件路径是否正确":"The file does not exist, please check if the file path is correct.","文件大小超出了限制,如果上传文件,最大限制是100MB":"The file size exceeds the limit; if uploading a file, the maximum limit is 100MB.","文件消息失败,禁止发送违规封禁的文件":"File message failed, sending prohibited and banned files is not allowed.","我":"I","无法查看":"unable to view","无法定位到原消息":"Unable to navigate to the original message","无法收听":"unable to listen","正在加载":"Loading...","加载结束":"Load end","无应答":"No Answer","系统消息":"System message","消息":"[message]","消息或者资料中文本存在敏感内容,发送失败":"Sensitive content found in the message or information text, sending failed.","消息详情":"Message Detail","消息长度超出限制,消息长度不要超过12K":"Message length exceeds the limit; please keep the message length under 12K.","消息中图片存在敏感内容,发送失败":" Sensitive content is found in the picture in the message, sending failed.","选择提醒的人":"Select Contact","已读":"Read","已过撤回时限":"Withdrawal deadline has passed","已接听":"Answered","已拒绝":"Rejected","已同意":"Approved","引用":"Reference","引用失败":"quote failed","语音":"[Voice]","语音通话":"Voice Call","重新编辑":"Re-edit","重新发送":"Resend","转发":"Forward","翻译":"Translate","转文字":"Convert","隐藏":"Hidden","转发给":"Forward to","自定义":"[custom message]","自定义消息":"Custom message","腾讯云 IM":"Tencent Cloud Chat","空":"Empty","文本包含本地审核拦截词":"Text contains local moderation blocking words","按住说话":"Hold to speak","抬起发送":"Release to send","抬起取消":"Release to cancel","正在录音":"Recording","继续上滑可取消":"Continue to swipe to cancel","松开手指 取消发送":"Release to cancel","此机型暂不支持复制功能":"This model does not support the copy","请开通翻译功能":"Please open the translation feature","请开通语音转文字功能":"Please open the convert feature","翻译中":"Translating","转换中":"Converting","由IM提供翻译支持":"support by IM","所有人":"All","已达到表情回应上限数量":"You have reached the max reaction limit","等":"and others","人":"users","返回":"Back","关闭":"Close","多选":"Select","合并转发":"Combine Forward","逐条转发":"One-By-One Forward","未选择消息":"No message selected","[草稿]":"[Drafts]","[消息]":"[Message]","[文本]":"[Text]","[自定义消息]":"[Custom Message]","[图片]":"[Image]","[音频]":"[Voice]","[语音]":"[Voice]","[视频]":"[Video]","[文件]":"[File]","[位置]":"[Location]","[地理位置]":"[Location]","[动画表情]":"[Animated Sticker]","[群提示]":"[Group Tip]","[群提示消息]":"[Group Notification]","[聊天记录]":"[Chat History]","[机器人自定义消息]":"[Robot Custom Message]","引用内容已撤回":"The quoted message has been withdrawn","群聊的聊天记录":"Chat history for Group Chat","和":"and","的聊天记录":"chat history","请升级IMSDK到v2.10.1或更高版本查看此消息":"Please upgrade IMSDK to v2.10.1 or higher to view this message","该群聊已被解散":"The group has been dismissed","您已被管理员移出群聊":"You have been removed from the group by the admin.","您已退出该群聊":"You have left the group.","您已被禁止聊天":"you have been forbidden to speak"},TUIConversation:{"发起会话":"Start chat","发起单聊":"New one-to-one chat","发起群聊":"New group chat","请输入userID":"Enter a user ID","删除会话":"Delete","删除后，将清空该聊天的消息记录":"Once deleted, all chat messages will be cleared.","删除后，将清空该群聊的消息记录":"Once deleted, group chat history will be cleared.","系统通知":"System notification","置顶会话":"Pin","取消置顶":"Unpin","消息免打扰":"Mute Notifications","取消免打扰":"Enable Notifications","有人@我":"Someone @ me","@所有人":"@All","条":"strip","我":"me","网络异常，请您检查网络设置":"Network exception, please check the network settings","您已被群管理员移出群聊":"You have been removed from the group chat by the group administrator","该群聊已被解散":"The group chat has been disband","您已退出该群聊":"You have left the group chat"},TUIGroup:{"输入groupID搜索":"Enter groupId search","群名称":"Group name","群ID":"Group ID","加入群聊":"Join","解散群聊":"Dissolution","退出群聊":"Quit","群类型":"Group type","请填写验证信息":"Please fill in the verification information","申请加入":"Apply Join","群公告":"Group notice","群成员":"Group member","群管理":"Manage group","好友工作群":"Work","陌生人社交群":"Public","临时会议群":"Meeting","直播群":"AVChatRoom","社群":"Community","自由加入":"Join freely","需要验证":"Require approval","禁止加群":"Disallow group joining","人":"","确认":"Confirm","群头像":"Group profile photo","加群方式":"Group joining mode","转让群组":"Transfer ownership","退出群组":"Quit group","群管理员":"Group admin","全员禁言":"Mute All","全员禁言开启后，只允许群主和管理员发言。":"If Mute All is enabled, only the group owner and admin can speak.","单独禁言人员":"Mute a member","删除成员":"Remove member","确定从群聊中删除该成员？":"Are you sure you want to remove this member from the group chat?","确定从群聊中删除所选成员？":"Are you sure you want to remove selected member(s) from the group chat?","暂无公告":"No notice","发布":"Post","编辑":"Edit","查看更多":"View more","管理员":"Admin","群主":"Group owner","我":"me","添加成员":"Add member","新增管理员":"Add admin","移除管理员":"Revoke admin","新增禁言用户":"Add muted member","移除禁言用户":"Remove muted member","修改群聊名称":"Edit group name","修改群聊名称后，将在群内通知其他成员":"After modifying the group chat name, other members will be notified in the group","仅限中文、字母、数字和下划线，2-20个字":"Chinese, letters, numbers and underscores only, 2-20 words","请先注册 TUIGroup 模块":"Please register the TUIGroup module first","该用户不存在":"The user does not exist","该用户不在群组内":"The user is not in the group","添加群聊":"Add a group chat","该群组不存在":"The group does not exist","创建群聊，请注册 TUIGroup 模块":"To create a group chat, please register the TUIGroup module","创建成功":"Creation successful","发起多人会话（群聊）":"New group chat","选填":"Optional","取消":"Cancel","创建":"Create","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见":"Similar to a WeChat group. Users can join the group only via invitation by existing members. The invitation does not need to be agreed by the invitee or approved by the group owner. See the documentation for details.","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"Similar to a QQ group. After a public group is created, the group owner can designate group admins. To join the group, a user needs to search the group ID and send a request, which needs to be approved by the group owner or an admin before the user can join the group. See the documentation for details. ","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"After the group is created, a user can join and quit the group freely and can view the messages sent before joining the group. It is suitable for scenarios that integrate Tencent Real-Time Communication (TRTC), such as audio and video conferences and online education. See the documentation for details.","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"After creation, a user can join and quit the group freely. The group can have an unlimited number of members, but it does not store message history. It can be combined with Live Video Broadcasting (LVB) to support on-screen comment scenarios. See the documentation for details. ","创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见":"After creation, you can enter and leave at will, support up to 100,000 people, support historical message storage, and after users search for group ID and initiate a group application, they can join the group without administrator approval. See product documentation for details. ","产品文档":"product documentation","设置群名称":"Group name","请输入群名称":"Enter the group name","设置群ID":"Group ID","请输入群ID":"Enter the group ID","选择群类型":"Group type","陌生人社交群（Public）":"Stranger social group (Public)","临时会议群（Meeting）":"Temporary meeting group (Meeting)","好友工作群（Work）":"Friends work group (Work)","直播群（AVChatroom）":"Live Streaming Group (AVChatroom)","社群（Community）":"Community（Community）","群组创建成功":"Create group success","群组解散成功":"Dismiss group success","禁言设置成功":"Mute all success","取消禁言成功":"Remove mute success","群名称不能为空":"Group name cannot be empty","群名称修改成功":"Group name modified success","群公告字数超出限制，最大长度为150":"The number of characters in the group announcement exceeds the limit, the maximum length is 150"},TUIContact:{"群聊通知":"Group Chat Notifications","系统通知":"System Notifications","我的群聊":"My Group Chats","输入ID":"Enter a groupID/userID","群名称":"Group name","群ID":"Group ID","加入群聊":"Join group chat","解散群聊":"Disband group chat","退出群聊":"Quit group chat","进入群聊":"Enter group chat","群类型":"Group type","请填写验证信息":"Enter the verification info","申请加入":"Request to join","已申请":"Requested","接受":"Accept","拒绝":"Refuse","已处理":"Handled","添加群聊":"add group chat","已加入":"joined","该群组不存在":"The group does not exist","加群":"join","我的好友":"Friend","发送消息":"Send Message","个性签名":"Signature","等待管理员同意":"Successful application, waiting for the administrator to agree to join the group application","加群成功":"Join the group successfully","您已是群成员":"You are already a group member","新的联系人":"New Contacts","黑名单":"Blocked List","无搜索结果":"No Result","客服号":"Customer Service List",ID:"ID","联系人":"User","群聊":"Group","添加好友/群聊":"Add friend/group","备注名":"remark","加入黑名单":"block","删除好友":"Delete friend","等待验证":"waiting for verification","验证信息":"verification info","发送申请":"Send application","加入直播群":"Join AVChatRoom","同意":"Agree","删除好友成功":"Delete friend success","删除好友失败":"Delete friend failed","申请已发送":"Application has been sent","申请发送失败":"Application failed to send","进入会话失败":"Failed to enter session","添加好友成功":"Add friend success","同意好友申请失败":"Failed to agree to friend request","拒绝成功":"Reject friend request success","拒绝好友申请失败":"Failed to reject friend request","解散群聊成功":"Dismissed group success","解散群聊失败":"Dismissed group failed","退出群组成功":"Quit group success","退出群组失败":"Quit group failed","申请入群失败":"Application to join the group failed","加入黑名单失败":"Add to blocklist failed","移除黑名单失败":"Remove from blocklist failed","修改备注失败: 备注长度不得超过 96 字节":"Failed to modify the remark: the length of the remark cannot exceed 96 bytes","修改备注成功":"Remark modified success","修改备注失败":"Remark modified failed"},message:{tip:{"群成员":"group members","加入群组":"joined the group","退出群组":"left the group","被":"by","踢出群组":"was kicked out of the group","成为管理员":"was set as an admin","被撤销管理员":"was revoked","被禁言":" was muted","被取消禁言":"cancel the prohibition","群提示消息":"group prompt message","管理员":"The admin","开启全员禁言":"enabled Mute All","取消全员禁言":"disabled Mute All","成为新的群主":"became the new group owner","修改群名为":"changed the group name to","发布新公告":"posted a new notice","把群公告修改为":"changed the group notice to","申请加入群组":"requested to join the group","成功加入群组":"Successfully joined the group","被拒绝":"The request to join the group was refused","你被管理员":"You","群":"group","解散":"disbanded","创建群":"created the group","邀请你加群":"invite you to join the group","你退出群组":"You left the group","你被":"You were","设置为群":"set as group","的管理员":"as an admin","撤销群":"revoked","的管理员身份":"admin role of the group","同意加群":"agreed to join the group","拒接加群":"refused to join the group","自定义群系统通知":"Custom group system notification"},custom:{"自定义消息":"Custom message","通话时长":"Call duration","通话结束":"Call End","切换语音通话":"Switch voice call","切换视频通话":"Switch video call","发起通话":"Start a call","取消通话":"Cancel","已接听":"Answered","拒绝通话":"Decline","无应答":"No answer","已取消":"Canceled","对方已取消":"Call canceled by caller","已拒绝":"Declined","对方已拒绝":"Call declined by user","对方忙线中":"Line busy","忙线未接听":"\tLine busy. Call not received.","对方无应答":"Call wasn't answered","超时无应答":"Call not answered","对本次服务评价":"Rate this service","查看详情>>":"View details >>"}},component:{"取消":"Cancel","完成":"Done","已选中":"Selected","人":"","保存":"Save","请输入userID":"Enter a userID","请输入groupID":"Enter a groupID","确定":"submit","全选":"All","已在群聊中":"exists","查看更多":"More","图片 url 不存在":"Image url does not exist","已取消":"Cancelled","获取权限失败":"Failed to obtain permission","已保存至相册":"Saved to album","图片下载失败":"Image download failed","暂不支持下载此类型图片":"Downloading this type of pictures is not supported yet"},time:{"周":"week(s) ","天":"day(s)","小时":"hour(s) ","分钟":"minute(s)","刚刚":"Just now","前":" ago","昨天":"Yesterday","星期一":"Monday","星期二":"Tuesday","星期三":"Wednesday","星期四":"Thursday","星期五":"Friday","星期六":"Saturday","星期日":"Sunday","一月":"January","二月":"February","三月":"March","四月":"April","五月":"May","六月":"June","七月":"July","八月":"August","九月":"September","十月":"October","十一月":"November","十二月":"December","一":"Mon","二":"Tues","三":"Wed","四":"Thur","五":"Fri","六":"Sat","日":"Sun"},Evaluate:{"请对本次服务进行评价":"Please rate this service","提交评价":"Feedback","服务评价工具":"Service rate tool","使用":"Build with","自定义消息":"Custom message","搭建":"","星":"Star"},Words:{"请对本次服务进行评价":"Please rate this service","提交评价":"Feedback","常用语-快捷回复工具":"Common Expressions - Quick Reply Tool","使用":"Build with","自定义消息":"Custom message","搭建":"","在吗？在吗？在吗？重要的话说三遍。":"Are you there? ","好久没聊天了，快来和我说说话～":"It’s been a long time. How about you?","好的，就这么说定了。":"Okay. It's a deal.","感恩的心，感谢有你。":"So grateful! ","糟糕！是心动的感觉！":"Oh, no. Flipped.","心疼地抱抱自己，我太难了！":"Give myself a warm hug. ","没关系，别在意，事情过去就过去了。":"Take it easy.","早上好，今天也是让人期待的一天呢！":"Good morning. Have a wonderful day.","熬夜有什么用，又没人陪你聊天，早点休息吧。":"It's better to go to bed early."},TUISearch:{"搜索":"Search","全部":"All","联系人":"Contacts","群聊":"Groups","聊天记录":"Chat History","文本":"Text","文件":"File","其他":"Other","图片/视频":"Image/Video","选择时间":"Select time","今天":"Today","近三天":"Nearly three days","近七天":"Nearly seven days","查看更多":"View more ","条相关":" related ","条与":" related to ","相关的":"keywords","进入聊天":"enter","定位到聊天位置":"Navigate to the chat position","搜索会话内容":"Search in conversation","查看更多历史记录":"View more history message","暂无搜索结果":"No Results","结果":"results","取消":"Cancel","[文本]":"[Text Message]","[图片]":"[Image Message]","[语音]":"[Audio Message]","[视频]":"[Video Message]","[文件]":"[File Message]","[自定义消息]":"[Custom Message]","[系统消息]":"[System Message]","[合并消息]":"[Merged Message]","[位置消息]":"[Position Message]","消息云端搜索失败：":"Message cloud search failed: ","查找联系人失败：":"Failed to find contact: ","查找群聊失败：":"Failed to find group: ","进入会话失败":"Failed to enter conversation"},Emoji:dd}},...{zh_cn:{"取消":"取消","发送":"发送","系统通知":"系统通知","关闭":"关闭","确定":"确定","开始时间":"开始时间","结束时间":"结束时间","消息":"消息","通讯录":"通讯录","欢迎使用腾讯云即时通信IM":"欢迎使用腾讯云即时通信IM",TUIChat:{"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。":"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。","按Enter发送，Ctrl+Enter换行":"按Enter发送，Ctrl+Enter换行","表情":"[表情]","查看更多":"查看更多","撤回":"撤回","撤回了一条消息":"撤回了一条消息","打开":"打开","单击下载":"单击下载","点此投诉":"点此投诉","点击处理":"点击处理","对方正在输入":"对方正在输入...","发起群视频":"发起群视频","发起群语音":"发起群语音","发起通话":"发起通话","发送失败":"发送失败","复制":"复制","复制成功":"文本复制成功","该消息不存在":"该消息不存在","关闭阅读状态":"关闭","管理员开启全员禁言":"管理员开启全员禁言","欢迎使用TUICallKit":"欢迎使用腾讯云音视频通话组件TUICallKit ","回到最新位置":"回到最新位置","回复":"回复","回复详情":"回复详情","集成TUICallKit":"集成 TUICallKit ","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"检测到您暂未集成TUICallKit，无法体验音视频通话功能。","结束群聊":"结束群聊","进行体验":"进行体验。","经度":"经度","拒绝":"拒绝","拒绝通话":"拒绝通话","开通腾讯实时音视频服务":"开通腾讯实时音视频服务","聊天记录":"[聊天记录]","描述":"描述","内容包含敏感词汇":"内容包含敏感词汇","您":"您","您当前购买使用的套餐包暂未开通此功能":"您当前购买使用的套餐包暂未开通此功能。","您当前购买使用的套餐包暂未开通群消息已读回执功能":"您当前购买使用的套餐包暂未开通【群消息已读回执】功能，请升级至旗舰版进行体验","您当前购买使用的套餐包暂未开通在线用户列表功能":"您当前购买使用的套餐包暂未开通【在线用户列表】功能，请升级至旗舰版进行体验","您已被管理员禁言":"您已被管理员禁言","您有":"您有","请点击":"请点击","请输入消息":"请输入消息","取消":"取消","取消通话":"取消通话","全部已读":"全部已读","确定":"确定","确认重发该消息？":"确认重发该消息？","人关闭阅读状态":"人关闭阅读状态","人未读":"人未读","人已读":"人已读","删除":"删除","涉及敏感内容":"涉及敏感内容","申请加入":"申请加入","视频":"[视频]","视频通话":"视频通话","条回复":"条回复","条入群申请":"条入群申请","条新消息":"条新消息","通话时长":"通话时长","同意":"同意","图片":"[图片]","图片消息失败,无效的图片格式":"图片消息失败,无效的图片格式","纬度":"纬度","未读":"未读","位置":"[位置]","文件":"[文件]","文件不存在,请检查文件路径是否正确":"文件不存在,请检查文件路径是否正确","文件大小超出了限制,如果上传文件,最大限制是100MB":"文件大小超出了限制,如果上传文件,最大限制是100MB","文件消息失败,禁止发送违规封禁的文件":"文件消息失败,禁止发送违规封禁的文件","我":"我","无法查看":"无法查看","无法定位到原消息":"无法定位到原消息","无法收听":"无法收听","正在加载":"正在加载...","加载结束":"加载结束","无应答":"无应答","系统消息":"系统消息","消息":"message","消息或者资料中文本存在敏感内容,发送失败":"消息或者资料中文本存在敏感内容,发送失败","消息详情":"消息详情","消息长度超出限制,消息长度不要超过12K":"消息长度超出限制,消息长度不要超过12K","消息中图片存在敏感内容,发送失败":"消息中图片存在敏感内容,发送失败","选择提醒的人":"选择提醒的人","已读":"已读","已过撤回时限":"已过撤回时限","已接听":"已接听","已拒绝":"已拒绝","已同意":"已同意","引用":"引用","引用失败":"引用失败","语音":"[语音]","语音通话":"语音通话","重新编辑":"重新编辑","重新发送":"重新发送","转发":"转发","翻译":"翻译","转文字":"转文字","隐藏":"隐藏","转发给":"转发给","自定义":"[自定义消息]","自定义消息":"自定义消息","腾讯云 IM":"腾讯云 IM","空":"空","文本包含本地审核拦截词":"文本包含本地审核拦截词","按住说话":"按住说话","抬起发送":"抬起发送","抬起取消":"抬起取消","正在录音":"正在录音","继续上滑可取消":"继续上滑可取消","松开手指 取消发送":"松开手指 取消发送","此机型暂不支持复制功能":"此机型暂不支持复制功能","请开通翻译功能":"请开通翻译功能","请开通语音转文字功能":"请开通语音转文字功能","翻译中":"翻译中","转换中":"转换中","由IM提供翻译支持":"由IM提供翻译支持","所有人":"所有人","已达到表情回应上限数量":"已达到表情回应上限数量","等":"等","人":"人","返回":"返回","关闭":"关闭","多选":"多选","合并转发":"合并转发","逐条转发":"逐条转发","未选择消息":"未选择消息","引用内容已撤回":"引用内容已撤回","[草稿]":"[草稿]","[消息]":"[消息]","[文本]":"[文本]","[自定义消息]":"[自定义消息]","[图片]":"[图片]","[音频]":"[音频]","[语音]":"[语音]","[视频]":"[视频]","[文件]":"[文件]","[位置]":"[地理位置]","[地理位置]":"[地理位置]","[动画表情]":"[动画表情]","[群提示]":"[群提示]","[群提示消息]":"[群提示消息]","[聊天记录]":"[聊天记录]","[机器人自定义消息]":"[机器人自定义消息]","群聊的聊天记录":"群聊的聊天记录","和":"和","的聊天记录":"的聊天记录","请升级IMSDK到v2.10.1或更高版本查看此消息":"请升级IMSDK到v2.10.1或更高版本查看此消息","您已被管理员移出群聊":"您已被管理员移出群聊","该群聊已被解散":"该群聊已被解散","您已退出该群聊":"您已退出该群聊","您已被禁止聊天":"您已被禁止聊天"},TUIConversation:{"发起会话":"发起会话","发起单聊":"发起单聊","发起群聊":"发起群聊","请输入userID":"请输入userID","删除会话":"删除会话","删除后，将清空该聊天的消息记录":"删除后，将清空该聊天的消息记录","删除后，将清空该群聊的消息记录":"删除后，将清空该群聊的消息记录","置顶会话":"置顶会话","取消置顶":"取消置顶","消息免打扰":"消息免打扰","取消免打扰":"取消免打扰","系统通知":"系统通知","有人@我":"有人@我","@所有人":"@所有人","条":"条","我":"我","网络异常，请您检查网络设置":"网络异常，请您检查网络设置","您已被群管理员移出群聊":"您已被群管理员移出群聊","该群聊已被解散":"该群聊已被解散","您已退出该群聊":"您已退出该群聊"},TUIGroup:{"输入groupID搜索":"输入groupID搜索","群名称":"群名称","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","群类型":"群类型","请填写验证信息":"请填写验证信息","申请加入":"申请加入","已申请":"已申请","群公告":"群公告","群成员":"群成员","群管理":"群管理","好友工作群":"好友工作群","陌生人社交群":"陌生人社交群","临时会议群":"临时会议群","直播群":"直播群","社群":"社群","自由加入":"自由加入","需要验证":"需要验证","禁止加群":"禁止加群","人":"人","群头像":"群头像","加群方式":"加群方式","转让群组":"转让群组","退出群组":"退出群组","群管理员":"群管理员","全员禁言":"全员禁言","全员禁言开启后，只允许群主和管理员发言。":"全员禁言开启后，只允许群主和管理员发言。","单独禁言人员":"单独禁言人员","删除成员":"删除成员","确定从群聊中删除该成员？":"确定从群聊中删除该成员？","确定从群聊中删除所选成员？":"确定从群聊中删除所选成员？","暂无公告":"暂无公告","发布":"发布","编辑":"编辑","查看更多":"查看更多","管理员":"管理员","群主":"群主","我":"我","确认":"确认","添加成员":"添加成员","新增管理员":"新增管理员","移除管理员":"移除管理员","新增禁言用户":"新增禁言用户","移除禁言用户":"移除禁言用户","修改群聊名称":"修改群聊名称","修改群聊名称后，将在群内通知其他成员":"修改群聊名称后，将在群内通知其他成员","仅限中文、字母、数字和下划线，2-20个字":"仅限中文、字母、数字和下划线，2-20个字","请先注册 TUIGroup 模块":"请先注册 TUIGroup 模块","该用户不存在":"该用户不存在","该用户不在群组内":"该用户不在群组内","添加群聊":"添加群聊","该群组不存在":"该群组不存在","创建群聊，请注册 TUIGroup 模块":"创建群聊，请注册 TUIGroup 模块","创建成功":"创建成功","发起多人会话（群聊）":"发起多人会话（群聊）","选填":"选填","取消":"取消","创建":"创建","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见":"类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见","创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见":"创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见","产品文档":"产品文档","设置群名称":"设置群名称","请输入群名称":"请输入群名称","设置群ID":"设置群ID","请输入群ID":"请输入群ID","选择群类型":"选择群类型","陌生人社交群（Public）":"陌生人社交群（Public）","临时会议群（Meeting）":"临时会议群（Meeting）","好友工作群（Work）":"好友工作群（Work）","直播群（AVChatroom）":"直播群（AVChatroom）","社群（Community）":"社群（Community）","群组创建成功":"群组创建成功","群组解散成功":"群组解散成功","禁言设置成功":"禁言设置成功","取消禁言成功":"取消禁言成功","群名称不能为空":"群名称不能为空","群名称修改成功":"群名称修改成功","群公告字数超出限制，最大长度为150":"群公告字数超出限制，最大长度为150"},TUIContact:{"群聊通知":"群聊通知","系统通知":"系统通知","我的群聊":"我的群聊","输入ID":"请输入用户/群聊 ID，回车搜索","群名称":"群名称","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","进入群聊":"进入群聊","群类型":"群类型","请填写验证信息":"请填写验证信息","申请加入":"申请加入","已申请":"已申请","接受":"接受","拒绝":"拒绝","已处理":"已处理","添加群聊":"添加群聊","已加入":"已加入","该群组不存在":"该群组不存在","加群":"加群","我的好友":"我的好友","发送消息":"发送消息","个性签名":"个性签名","等待管理员同意":"申请成功，等待管理员同意入群申请","加群成功":"加群成功","您已是群成员":"您已是群成员","新的联系人":"新的联系人","黑名单":"黑名单","无搜索结果":"无搜索结果","客服号":"客服号",ID:"ID","联系人":"联系人","群聊":"群聊","添加好友/群聊":"添加好友/群聊","备注名":"备注名","加入黑名单":"加入黑名单","删除好友":"删除好友","等待验证":"等待验证","验证信息":"验证信息","发送申请":"发送申请","加入直播群":"加入直播群","同意":"同意","删除好友成功":"删除好友成功","删除好友失败":"删除好友失败","申请已发送":"申请已发送","申请发送失败":"申请发送失败","进入会话失败":"进入会话失败","添加好友成功":"添加好友成功","同意好友申请失败":"同意好友申请失败","拒绝成功":"拒绝成功","拒绝好友申请失败":"拒绝好友申请失败","解散群聊成功":"解散群聊成功","解散群聊失败":"解散群聊失败","退出群组成功":"退出群组成功","退出群组失败":"退出群组失败","申请入群失败":"申请入群失败","加入黑名单失败":"加入黑名单失败","移除黑名单失败":"移除黑名单失败","修改备注失败: 备注长度不得超过 96 字节":"修改备注失败: 备注长度不得超过 96 字节","修改备注成功":"修改备注成功","修改备注失败":"修改备注失败"},message:{tip:{"群成员":"群成员","加入群组":"加入群组","退出群组":"退出群组","被":"被","踢出群组":"踢出群组","成为管理员":"成为管理员","被撤销管理员":"被撤销管理员","被禁言":"被禁言","被取消禁言":"被取消禁言","群提示消息":"群提示消息","管理员":"管理员","开启全员禁言":"开启全员禁言","取消全员禁言":"取消全员禁言","成为新的群主":"成为新的群主","修改群名为":"修改群名为","发布新公告":"发布新公告","把群公告修改为":"把群公告修改为","申请加入群组":"申请加入群组","成功加入群组":"成功加入群组","被拒绝":"被拒绝","你被管理员":"你被管理员","群":"群","解散":"解散","创建群":"创建群","邀请你加群":"邀请你加群","你退出群组":"你退出群组","你被":"你被","设置为群":"设置为群","的管理员":"的管理员","撤销群":"撤销群","的管理员身份":"的管理员身份","同意加群":"同意加群","拒接加群":"拒接加群","自定义群系统通知":"自定义群系统通知"},custom:{"自定义消息":"自定义消息","通话时长":"通话时长","通话结束":"通话结束","切换语音通话":"切换语音通话","切换视频通话":"切换视频通话","发起通话":"发起通话","取消通话":"取消通话","已接听":"已接听","拒绝通话":"拒绝通话","无应答":"无应答","对本次服务评价":"对本次服务评价","查看详情>>":"查看详情>>","已取消":"已取消","对方已取消":"对方已取消","已拒绝":"已拒绝","对方已拒绝":"对方已拒绝","对方忙线中":"对方忙线中","忙线未接听":"忙线未接听","对方无应答":"对方无应答","超时无应答":"超时无应答"}},component:{"取消":"取消","完成":"完成","已选中":"已选中","人":"人","保存":"保存","请输入userID":"请输入userID","请输入groupID":"请输入groupID","确定":"确定","全选":"全选","已在群聊中":"已在群聊中","查看更多":"查看更多","图片 url 不存在":"图片 url 不存在","已取消":"已取消","获取权限失败":"获取权限失败","已保存至相册":"已保存至相册","图片下载失败":"图片下载失败","暂不支持下载此类型图片":"暂不支持下载此类型图片"},time:{"周":"周","天":"天","小时":"小时","分钟":"分钟","刚刚":"刚刚","前":"前","昨天":"昨天","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日","一月":"一月","二月":"二月","三月":"三月","四月":"四月","五月":"五月","六月":"六月","七月":"七月","八月":"八月","九月":"九月","十月":"十月","十一月":"十一月","十二月":"十二月","一":"一","二":"二","三":"三","四":"四","五":"五","六":"六","日":"日"},Evaluate:{"请对本次服务进行评价":"请对本次服务进行评价","提交评价":"提交评价","服务评价工具":"服务评价工具","使用":"使用","自定义消息":"自定义消息","搭建":"搭建","星":"星"},Words:{"常用语-快捷回复工具":"常用语-快捷回复工具","在吗？在吗？在吗？重要的话说三遍。":"在吗？在吗？在吗？重要的话说三遍。","好久没聊天了，快来和我说说话～":"好久没聊天了，快来和我说说话～","好的，就这么说定了。":"好的，就这么说定了。","感恩的心，感谢有你。":"感恩的心，感谢有你。","糟糕！是心动的感觉！":"糟糕！是心动的感觉！","心疼地抱抱自己，我太难了！":"心疼地抱抱自己，我太难了！","没关系，别在意，事情过去就过去了。":"没关系，别在意，事情过去就过去了。","早上好，今天也是让人期待的一天呢！":"早上好，今天也是让人期待的一天呢！","熬夜有什么用，又没人陪你聊天，早点休息吧。":"熬夜有什么用，又没人陪你聊天，早点休息吧。"},TUISearch:{"搜索":"搜索","全部":"全部","联系人":"联系人","群聊":"群聊","聊天记录":"聊天记录","文本":"文本","文件":"文件","图片/视频":"图片/视频","其他":"其他","选择时间":"选择时间","今天":"今天","近三天":"近三天","近七天":"近七天","查看更多":"查看更多","条相关":"条相关","条与":"条与","相关的":"相关的","进入聊天":"进入聊天","定位到聊天位置":"定位到聊天位置","搜索会话内容":"搜索会话内容","查看更多历史记录":"查看更多历史记录","暂无搜索结果":"暂无搜索结果","结果":"结果","取消":"取消","[文本]":"[文本]","[图片]":"[图片]","[语音]":"[语音]","[视频]":"[视频]","[文件]":"[文件]","[自定义消息]":"[自定义消息]","[系统消息]":"[系统消息]","[合并消息]":"[合并消息]","[位置消息]":"[位置消息]","消息云端搜索失败：":"消息云端搜索失败：","查找联系人失败：":"查找联系人失败：","查找群聊失败：":"查找群聊失败：","进入会话失败":"进入会话失败"},Emoji:pd}},...{zh_tw:{"取消":"取消","发送":"發送","系统通知":"系統通知","关闭":"關閉","确定":"確定","开始时间":"開始時間","结束时间":"結束時間","消息":"消息","通讯录":"通訊錄","欢迎使用腾讯云即时通信IM":"歡迎使用騰訊雲即時通信IM",TUIChat:{"【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。":"【安全提示】本 APP 僅用於體驗騰訊雲即時通信 IM 產品功能，不可用於業務洽談與拓展。請勿輕信匯款、中奖等涉及錢款的信息，勿輕易撥打陌生電話，謹防上當受騙。","按Enter发送，Ctrl+Enter换行":"按Enter發送，Ctrl+Enter換行","表情":"[表情]","查看更多":"查看更多","撤回":"撤回","撤回了一条消息":"撤回了一條消息","打开":"打開","单击下载":"單擊下載","点此投诉":"點此投訴","点击处理":"點擊處理","对方正在输入":"對方正在輸入...","发起群视频":"發起群視頻","发起群语音":"發起群語音","发起通话":"發起通話","发送失败":"發送失敗","复制":"複製","复制成功":"文本複製成功","该消息不存在":"該消息不存在","关闭阅读状态":"關閉","管理员开启全员禁言":"管理員開啟全員禁言","欢迎使用TUICallKit":"歡迎使用騰訊雲音視頻通話組件TUICallKit","回到最新位置":"回到最新位置","回复":"回覆","回复详情":"回覆詳情","集成TUICallKit":"集成 TUICallKit","检测到您暂未集成TUICallKit，无法体验音视频通话功能":"檢測到您暫未集成TUICallKit，無法體驗音視頻通話功能。","结束群聊":"結束群聊","进行体验":"進行體驗。","经度":"經度","拒绝":"拒絕","拒绝通话":"拒絕通話","开通腾讯实时音视频服务":"開通騰訊實時音視頻服務","聊天记录":"[聊天記錄]","描述":"描述","内容包含敏感词汇":"內容包含敏感詞彙","您":"您","您当前购买使用的套餐包暂未开通此功能":"您當前購買使用的套餐包暫未開通此功能。","您当前购买使用的套餐包暂未开通群消息已读回执功能":"您當前購買使用的套餐包暫未開通【群消息已讀回執】功能，請升級至旗艦版進行體驗","您当前购买使用的套餐包暂未开通在线用户列表功能":"您當前購買使用的套餐包暫未開通【在線用戶列表】功能，請升級至旗艦版進行體驗","您已被管理员禁言":"您已被管理員禁言","您有":"您有","请点击":"請點擊","请输入消息":"請輸入消息","取消":"取消","取消通话":"取消通話","全部已读":"全部已讀","确定":"確定","确认重发该消息？":"確認重發該消息？","人关闭阅读状态":"人關閉閱讀狀態","人未读":"人未讀","人已读":"人已讀","删除":"刪除","涉及敏感内容":"涉及敏感內容","申请加入":"申請加入","视频":"[視頻]","视频通话":"視頻通話","条回复":"條回覆","条入群申请":"條入群申請","条新消息":"條新消息","通话时长":"通話時長","同意":"同意","图片":"[圖片]","图片消息失败,无效的图片格式":"圖片消息失敗,無效的圖片格式","纬度":"緯度","未读":"未讀","位置":"[位置]","文件":"[文件]","文件不存在,请检查文件路径是否正确":"文件不存在,請檢查文件路徑是否正確","文件大小超出了限制,如果上传文件,最大限制是100MB":"文件大小超出了限制,如果上傳文件,最大限制是100MB","文件消息失败,禁止发送违规封禁的文件":"文件消息失敗,禁止發送違規封禁的文件","我":"我","无法查看":"無法查看","无法定位到原消息":"無法定位到原消息","无法收听":"無法收聽","正在加载":"正在加載...","加载结束":"加載結束","无应答":"無應答","系统消息":"系統消息","消息":"message","消息或者资料中文本存在敏感内容,发送失败":"消息或者資料中文本存在敏感內容,發送失敗","消息详情":"消息詳情","消息长度超出限制,消息长度不要超过12K":"消息長度超出限制,消息長度不要超過12K","消息中图片存在敏感内容,发送失败":"消息中圖片存在敏感內容,發送失敗","选择提醒的人":"選擇提醒的人","已读":"已讀","已过撤回时限":"已過撤回時限","已接听":"已接聽","已拒绝":"已拒絕","已同意":"已同意","引用":"引用","引用失败":"引用失敗","语音":"[語音]","语音通话":"語音通話","重新编辑":"重新編輯","重新发送":"重新發送","转发":"轉發","翻译":"翻譯","转文字":"轉文字","隐藏":"隱藏","转发给":"轉發給","自定义":"[自定義消息]","自定义消息":"自定義消息","腾讯云 IM":"騰訊雲 IM","空":"空","文本包含本地审核拦截词":"文本包含本地審核攔截詞","按住说话":"按住說話","抬起发送":"抬起發送","抬起取消":"抬起取消","正在录音":"正在錄音","继续上滑可取消":"繼續上滑可取消","松开手指 取消发送":"松開手指 取消發送","此机型暂不支持复制功能":"此機型暫不支持複製功能","请开通翻译功能":"請開通翻譯功能","请开通语音转文字功能":"請開通語音轉文字功能","翻译中":"翻譯中","转换中":"轉換中","由IM提供翻译支持":"由IM提供翻譯支持","所有人":"所有人","已达到表情回应上限数量":"已達到表情回應上限數量","等":"等","人":"人","返回":"返回","关闭":"關閉","多选":"多選","合并转发":"合併轉發","逐条转发":"逐條轉發","未选择消息":"未選擇消息","引用内容已撤回":"引用內容已撤回","[草稿]":"[草稿]","[消息]":"[消息]","[文本]":"[文本]","[自定义消息]":"[自定義消息]","[图片]":"[圖片]","[音频]":"[音頻]","[语音]":"[語音]","[视频]":"[視頻]","[文件]":"[文件]","[位置]":"[地理位置]","[地理位置]":"[地理位置]","[动画表情]":"[動畫表情]","[群提示]":"[群提示]","[群提示消息]":"[群提示消息]","[聊天记录]":"[聊天記錄]","[机器人自定义消息]":"[機器人自訂訊息]","群聊的聊天记录":"群聊的聊天記錄","和":"和","的聊天记录":"的聊天記錄","请升级IMSDK到v2.10.1或更高版本查看此消息":"請升級IMSDK到v2.10.1或更高版本查看此消息","您已被管理员移出群聊":"您已被管理員移出群聊","该群聊已被解散":"該群聊已被解散","您已退出该群聊":"您已退出該群聊","您已被禁止聊天":"您已被禁止聊天"},TUIConversation:{"发起会话":"發起會話","发起单聊":"發起單聊","发起群聊":"發起群聊","请输入userID":"請輸入userID","删除会话":"刪除會話","删除后，将清空该聊天的消息记录":"刪除後，將清空該聊天的消息記錄","删除后，将清空该群聊的消息记录":"刪除後，將清空該群聊的消息記錄","置顶会话":"置頂會話","取消置顶":"取消置頂","消息免打扰":"消息免打擾","取消免打扰":"取消免打擾","系统通知":"系統通知","有人@我":"有人@我","@所有人":"@所有人","条":"條","我":"我","网络异常，请您检查网络设置":"網絡異常，請您檢查網絡設置","您已被群管理员移出群聊":"您已被群管理員移出群聊","该群聊已被解散":"該群聊已被解散","您已退出该群聊":"您已退出該群聊"},TUIGroup:{"输入groupID搜索":"輸入groupID搜索","群名称":"群名稱","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","群类型":"群類型","请填写验证信息":"請填寫驗證信息","申请加入":"申請加入","已申请":"已申請","群公告":"群公告","群成员":"群成員","群管理":"群管理","好友工作群":"好友工作群","陌生人社交群":"陌生人社交群","临时会议群":"臨時會議群","直播群":"直播群","社群":"社群","自由加入":"自由加入","需要验证":"需要驗證","禁止加群":"禁止加群","人":"人","群头像":"群頭像","加群方式":"加群方式","转让群组":"轉讓群組","退出群组":"退出群組","群管理员":"群管理員","全员禁言":"全員禁言","全员禁言开启后，只允许群主和管理员发言。":"全員禁言開啟後，只允許群主和管理員發言。","单独禁言人员":"單獨禁言人員","删除成员":"刪除成員","确定从群聊中删除该成员？":"確定從群聊中刪除該成員？","确定从群聊中删除所选成员？":"確定從群聊中刪除所選成員？","暂无公告":"暫無公告","发布":"發布","编辑":"編輯","查看更多":"查看更多","管理员":"管理員","群主":"群主","我":"我","确认":"確認","添加成员":"添加成員","新增管理员":"新增管理員","移除管理员":"移除管理員","新增禁言用户":"新增禁言用戶","移除禁言用户":"移除禁言用戶","修改群聊名称":"修改群聊名稱","修改群聊名称后，将在群内通知其他成员":"修改群聊名稱後，將在群內通知其他成員","仅限中文、字母、数字和下划线，2-20个字":"僅限中文、字母、數字和下劃線，2-20個字","请先注册 TUIGroup 模块":"請先註冊 TUIGroup 模塊","该用户不存在":"該用戶不存在","该用户不在群组内":"該用戶不在群組內","添加群聊":"添加群聊","该群组不存在":"該群組不存在","创建群聊，请注册 TUIGroup 模块":"創建群聊，請註冊 TUIGroup 模塊","创建成功":"創建成功","发起多人会话（群聊）":"發起多人會話（群聊）","选填":"選填","取消":"取消","创建":"創建","类似普通微信群，创建后仅支持已在群内的好友邀请加群，且无需被邀请方同意或群主审批。详见":"類似普通微信群，創建後僅支持已在群內的好友邀請加群，且無需被邀請方同意或群主審批。詳見","类似 QQ 群，创建后群主可以指定群管理员，用户搜索群 ID 发起加群申请后，需要群主或管理员审批通过才能入群。详见":"類似 QQ 群，創建後群主可以指定群管理員，用戶搜索群 ID 發起加群申請後，需要群主或管理員審批通過才能入群。詳見","创建后可以随意进出，且支持查看入群前消息；适合用于音视频会议场景、在线教育场景等与实时音视频产品结合的场景。详见":"創建後可以隨意進出，且支持查看入群前消息；適合用於音視頻會議場景、在線教育場景等與實時音視頻產品結合的場景。詳見","创建后可以随意进出，没有群成员数量上限，但不支持历史消息存储；适合与直播产品结合，用于弹幕聊天场景。详见":"創建後可以隨意進出，沒有群成員數量上限，但不支持歷史消息存儲；適合與直播產品結合，用於彈幕聊天場景。詳見","创建后可以随意进出，最多支持100000人，支持历史消息存储，用户搜索群 ID 发起加群申请后，无需管理员审批即可进群。详见":"創建後可以隨意進出，最多支持100000人，支持歷史消息存儲，用戶搜索群 ID 發起加群申請後，無需管理員審批即可進群。詳見","产品文档":"產品文檔","设置群名称":"設置群名稱","请输入群名称":"請輸入群名稱","设置群ID":"設置群ID","请输入群ID":"請輸入群ID","选择群类型":"選擇群類型","陌生人社交群（Public）":"陌生人社交群（Public）","临时会议群（Meeting）":"臨時會議群（Meeting）","好友工作群（Work）":"好友工作群（Work）","直播群（AVChatroom）":"直播群（AVChatroom）","社群（Community）":"社群（Community）","群组创建成功":"群組創建成功","群组解散成功":"群組解散成功","禁言设置成功":"禁言設置成功","取消禁言成功":"取消禁言成功","群名称不能为空":"群名稱不能為空","群名称修改成功":"群名稱修改成功","群公告字数超出限制，最大长度为150":"群公告字數超出限制，最大長度為150"},TUIContact:{"群聊通知":"群聊通知","系统通知":"系統通知","我的群聊":"我的群聊","输入ID":"請輸入用戶/群聊 ID，回車搜索","群名称":"群名稱","群ID":"群ID","加入群聊":"加入群聊","解散群聊":"解散群聊","退出群聊":"退出群聊","进入群聊":"進入群聊","群类型":"群類型","请填写验证信息":"請填寫驗證信息","申请加入":"申請加入","已申请":"已申請","接受":"接受","拒绝":"拒絕","已处理":"已處理","添加群聊":"添加群聊","已加入":"已加入","该群组不存在":"該群組不存在","加群":"加群","我的好友":"我的好友","发送消息":"發送消息","个性签名":"個性簽名","等待管理员同意":"申請成功，等待管理員同意入群申請","加群成功":"加群成功","您已是群成员":"您已是群成員","新的联系人":"新的聯繫人","黑名单":"黑名單","无搜索结果":"無搜索結果","客服号":"客服號",ID:"ID","联系人":"聯繫人","群聊":"群聊","添加好友/群聊":"添加好友/群聊","备注名":"備註名","加入黑名单":"加入黑名單","删除好友":"刪除好友","等待验证":"等待驗證","验证信息":"驗證信息","发送申请":"發送申請","加入直播群":"加入直播群","同意":"同意","删除好友成功":"刪除好友成功","删除好友失败":"刪除好友失敗","申请已发送":"申請已發送","申请发送失败":"申請發送失敗","进入会话失败":"進入會話失敗","添加好友成功":"添加好友成功","同意好友申请失败":"同意好友申請失敗","拒绝成功":"拒絕成功","拒绝好友申请失败":"拒絕好友申請失敗","解散群聊成功":"解散群聊成功","解散群聊失败":"解散群聊失敗","退出群组成功":"退出群組成功","退出群组失败":"退出群組失敗","申请入群失败":"申請入群失敗","加入黑名单失败":"加入黑名單失敗","移除黑名单失败":"移除黑名單失敗","修改备注失败: 备注长度不得超过 96 字节":"修改備註失敗: 備註長度不得超過 96 字節","修改备注成功":"修改備註成功","修改备注失败":"修改備註失敗"},message:{tip:{"群成员":"群成員","加入群组":"加入群組","退出群组":"退出群組","被":"被","踢出群组":"踢出群組","成为管理员":"成為管理員","被撤销管理员":"被撤銷管理員","被禁言":"被禁言","被取消禁言":"被取消禁言","群提示消息":"群提示消息","管理员":"管理員","开启全员禁言":"開啟全員禁言","取消全员禁言":"取消全員禁言","成为新的群主":"成為新的群主","修改群名为":"修改群名為","发布新公告":"發布新公告","把群公告修改为":"把群公告修改為","申请加入群组":"申請加入群組","成功加入群组":"成功加入群組","被拒绝":"被拒絕","你被管理员":"你被管理員","群":"群","解散":"解散","创建群":"創建群","邀请你加群":"邀請你加群","你退出群组":"你退出群組","你被":"你被","设置为群":"設置為群","的管理员":"的管理員","撤销群":"撤銷群","的管理员身份":"的管理員身份","同意加群":"同意加群","拒接加群":"拒接加群","自定义群系统通知":"自定義群系統通知"},custom:{"自定义消息":"自定義消息","通话时长":"通話時長","通话结束":"通話結束","切换语音通话":"切換語音通話","切换视频通话":"切換視頻通話","发起通话":"發起通話","取消通话":"取消通話","已接听":"已接聽","拒绝通话":"拒絕通話","无应答":"無應答","对本次服务评价":"對本次服務評價","查看详情>>":"查看詳情>>","已取消":"已取消","对方已取消":"對方已取消","已拒绝":"已拒絕","对方已拒绝":"對方已拒絕","对方忙线中":"對方忙線中","忙线未接听":"忙線未接聽","对方无应答":"對方無應答","超时无应答":"超時無應答"}},component:{"取消":"取消","完成":"完成","已选中":"已選中","人":"人","保存":"保存","请输入userID":"請輸入userID","请输入groupID":"請輸入groupID","确定":"確定","全选":"全選","已在群聊中":"已在群聊中","查看更多":"查看更多","图片 url 不存在":"圖片 url 不存在","已取消":"已取消","获取权限失败":"獲取權限失敗","已保存至相册":"已保存至相冊","图片下载失败":"圖片下載失敗","暂不支持下载此类型图片":"暫不支持下載此類型圖片"},time:{"周":"週","天":"天","小时":"小時","分钟":"分鐘","刚刚":"剛剛","前":"前","昨天":"昨天","星期一":"星期一","星期二":"星期二","星期三":"星期三","星期四":"星期四","星期五":"星期五","星期六":"星期六","星期日":"星期日","一月":"一月","二月":"二月","三月":"三月","四月":"四月","五月":"五月","六月":"六月","七月":"七月","八月":"八月","九月":"九月","十月":"十月","十一月":"十一月","十二月":"十二月","一":"一","二":"二","三":"三","四":"四","五":"五","六":"六","日":"日"},Evaluate:{"请对本次服务进行评价":"請對本次服務進行評價","提交评价":"提交評價","服务评价工具":"服務評價工具","使用":"使用","自定义消息":"自定義消息","搭建":"搭建","星":"星"},Words:{"常用语-快捷回复工具":"常用語-快捷回覆工具","在吗？在吗？在吗？重要的话说三遍。":"在嗎？在嗎？在嗎？重要的話說三遍。","好久没聊天了，快来和我说说话～":"好久沒聊天了，快來和我說說話～","好的，就这么说定了。":"好的，就這麼說定了。","感恩的心，感谢有你。":"感恩的心，感謝有你。","糟糕！是心动的感觉！":"糟糕！是心動的感覺！","心疼地抱抱自己，我太难了！":"心疼地抱抱自己，我太難了！","没关系，别在意，事情过去就过去了。":"沒關係，別在意，事情過去就過去了。","早上好，今天也是让人期待的一天呢！":"早上好，今天也是讓人期待的一天呢！","熬夜有什么用，又没人陪你聊天，早点休息吧。":"熬夜有什麼用，又沒人陪你聊天，早點休息吧。"},TUISearch:{"搜索":"搜索","全部":"全部","联系人":"聯繫人","群聊":"群聊","聊天记录":"聊天記錄","文本":"文本","文件":"文件","图片/视频":"圖片/視頻","其他":"其他","选择时间":"選擇時間","今天":"今天","近三天":"近三天","近七天":"近七天","查看更多":"查看更多","条相关":"條相關","条与":"條與","相关的":"相關的","进入聊天":"進入聊天","定位到聊天位置":"定位到聊天位置","搜索会话内容":"搜索會話內容","查看更多历史记录":"查看更多歷史記錄","暂无搜索结果":"暫無搜索結果","结果":"結果","取消":"取消","[文本]":"[文本]","[图片]":"[圖片]","[语音]":"[語音]","[视频]":"[視頻]","[文件]":"[文件]","[自定义消息]":"[自定義消息]","[系统消息]":"[系統消息]","[合并消息]":"[合併消息]","[位置消息]":"[位置消息]","消息云端搜索失败：":"消息雲端搜索失敗：","查找联系人失败：":"查找聯繫人失敗：","查找群聊失败：":"查找群聊失敗：","进入会话失败":"進入會話失敗"},Emoji:{"[TUIEmoji_Smile]":"[微笑]","[TUIEmoji_Expect]":"[期待]","[TUIEmoji_Blink]":"[眨眼]","[TUIEmoji_Guffaw]":"[大笑]","[TUIEmoji_KindSmile]":"[姨母笑]","[TUIEmoji_Haha]":"[哈哈哈]","[TUIEmoji_Cheerful]":"[愉快]","[TUIEmoji_Speechless]":"[無語]","[TUIEmoji_Amazed]":"[驚訝]","[TUIEmoji_Sorrow]":"[悲傷]","[TUIEmoji_Complacent]":"[得意]","[TUIEmoji_Silly]":"[傻了]","[TUIEmoji_Lustful]":"[色]","[TUIEmoji_Giggle]":"[憨笑]","[TUIEmoji_Kiss]":"[親親]","[TUIEmoji_Wail]":"[大哭]","[TUIEmoji_TearsLaugh]":"[哭笑]","[TUIEmoji_Trapped]":"[困]","[TUIEmoji_Mask]":"[口罩]","[TUIEmoji_Fear]":"[恐懼]","[TUIEmoji_BareTeeth]":"[齜牙]","[TUIEmoji_FlareUp]":"[發怒]","[TUIEmoji_Yawn]":"[打哈欠]","[TUIEmoji_Tact]":"[機智]","[TUIEmoji_Stareyes]":"[星星眼]","[TUIEmoji_ShutUp]":"[閉嘴]","[TUIEmoji_Sigh]":"[嘆氣]","[TUIEmoji_Hehe]":"[呵呵]","[TUIEmoji_Silent]":"[收聲]","[TUIEmoji_Surprised]":"[驚喜]","[TUIEmoji_Askance]":"[白眼]","[TUIEmoji_Ok]":"[OK]","[TUIEmoji_Shit]":"[便便]","[TUIEmoji_Monster]":"[怪獸]","[TUIEmoji_Daemon]":"[惡魔]","[TUIEmoji_Rage]":"[惡魔怒]","[TUIEmoji_Fool]":"[衰]","[TUIEmoji_Pig]":"[豬]","[TUIEmoji_Cow]":"[牛]","[TUIEmoji_Ai]":"[AI]","[TUIEmoji_Skull]":"[骷髏]","[TUIEmoji_Bombs]":"[炸彈]","[TUIEmoji_Coffee]":"[咖啡]","[TUIEmoji_Cake]":"[蛋糕]","[TUIEmoji_Beer]":"[啤酒]","[TUIEmoji_Flower]":"[花]","[TUIEmoji_Watermelon]":"[瓜]","[TUIEmoji_Rich]":"[壕]","[TUIEmoji_Heart]":"[愛心]","[TUIEmoji_Moon]":"[月亮]","[TUIEmoji_Sun]":"[太陽]","[TUIEmoji_Star]":"[星星]","[TUIEmoji_RedPacket]":"[紅包]","[TUIEmoji_Celebrate]":"[慶祝]","[TUIEmoji_Bless]":"[福]","[TUIEmoji_Fortune]":"[發]","[TUIEmoji_Convinced]":"[服]","[TUIEmoji_Prohibit]":"[禁]","[TUIEmoji_666]":"[666]","[TUIEmoji_857]":"[857]","[TUIEmoji_Knife]":"[刀]","[TUIEmoji_Like]":"[讚]"}}}};let gd;gd=3,_("warn","at src/roomkit/TUIKit/adapter-vue.ts:13","[adapter-vue]: vue version is 3");const _d=e.defineComponent({__name:"index",props:["isGroup"],emits:["openGroupManagement"],setup(t,{emit:n}){const o=n,i=t,s=e.ref(),a=e.ref(!1);I((()=>{i.isGroup&&o("openGroupManagement")}));const r=getCurrentPages(),c=r[r.length-1].$getAppWebview();i.isGroup||c.setStyle({titleNView:{...c.getStyle().titleNView,buttons:[]}});const u=e=>{null==be||be.setNavigationBarTitle({title:"聊天"})};function l(e){var t;s.value=e,a.value||u(null==(t=null==s?void 0:s.value)||t.getShowName())}function d(e){var t;a.value=e,a.value?u(Wl.t("TUIChat.对方正在输入")):u(null==(t=s.value)||t.getShowName())}return e.onMounted((()=>{zl.watch(Sc.CONV,{currentConversation:l}),zl.watch(Sc.CHAT,{typingStatus:d})})),e.onUnmounted((()=>{zl.unwatch(Sc.CONV,{currentConversation:l}),zl.unwatch(Sc.CHAT,{typingStatus:d})})),m((()=>{var e;u(null==(e=s.value)||e.getShowName())})),(t,n)=>(e.openBlock(),e.createElementBlock("view",{style:{display:"none"}}))}}),fd={product:{label:"产品文档",url:"https://cloud.tencent.com/document/product/269/1499#.E7.BE.A4.E7.BB.84.E5.8A.9F.E8.83.BD"},customMessage:{label:"自定义消息",url:"https://web.sdk.qcloud.com/im/doc/zh-cn/SDK.html#createCustomMessage"},complaint:{label:"点此投诉",url:"https://cloud.tencent.com/apply/p/xc3oaubi98g"},implement:{label:"集成TUICallKit",url:"https://cloud.tencent.com/document/product/269/79861"},purchase:{label:"开通腾讯实时音视频服务",url:"https://cloud.tencent.com/document/product/1640/79968"}},md="/assets/back.e9626a2e.svg",vd="/assets/video-play.58b451c9.png",yd=e.defineComponent({__name:"Icon",props:{file:{default:""},size:{},width:{default:"20px"},height:{default:"20px"},hotAreaSize:{}},emits:["onClick"],setup(t,{emit:n}){const o=n,i=t,s=e.computed((()=>{if(i.hotAreaSize)return isNaN(Number(i.hotAreaSize))?String(i.hotAreaSize):`${i.hotAreaSize}px`})),a=e.computed((()=>i.size?i.size:i.width)),r=e.computed((()=>i.size?i.size:i.height)),c=e=>{o("onClick",e)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["common-icon-container",!e.unref(id)&&"common-icon-container-mobile"]),style:e.normalizeStyle({padding:e.unref(s)}),onClick:c},[e.unref(rd)?(e.openBlock(),e.createElementBlock("image",{key:0,class:"common-icon",src:i.file,style:e.normalizeStyle({width:e.unref(a),height:e.unref(r)})},null,12,["src"])):(e.openBlock(),e.createElementBlock("img",{key:1,class:"common-icon",src:i.file,style:e.normalizeStyle({width:e.unref(a),height:e.unref(r)})},null,12,["src"]))],6))}}),Id=Q(yd,[["__scopeId","data-v-ba780eed"]]),Md=e.defineComponent({__name:"index",props:{url:{default:"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"},size:{default:"36px"},borderRadius:{default:"5px"},useSkeletonAnimation:{type:Boolean,default:!1}},emits:["onLoad","onError"],setup(t,{emit:n}){const o=e.ref("https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png"),i=n,s=t,{size:a,url:r,borderRadius:c,useSkeletonAnimation:u}=e.toRefs(s);let l=0;const d=e.ref(!1),p=e.ref(!1);function h(e){d.value=!0,i("onLoad",e)}function g(e){l+=1,l>3||(cd?p.value=!0:e.currentTarget.src=o.value,i("onError",e))}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"avatar-container",style:e.normalizeStyle({width:e.unref(a),height:e.unref(a),borderRadius:e.unref(c)})},[e.unref(cd)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(p)?(e.openBlock(),e.createElementBlock("image",{key:1,class:"avatar-image",src:e.unref(o),onLoad:h,onError:g},null,40,["src"])):(e.openBlock(),e.createElementBlock("image",{key:0,class:"avatar-image",src:e.unref(r)||e.unref(o),onLoad:h,onError:g},null,40,["src"]))],64)):(e.openBlock(),e.createElementBlock("img",{key:1,class:"avatar-image",src:e.unref(r)||e.unref(o),onLoad:h,onError:g},null,40,["src"])),e.unref(u)&&!e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:2,class:e.normalizeClass({placeholder:!0,hidden:e.unref(d),"skeleton-animation":e.unref(u)})},null,2)):e.createCommentVNode("",!0)],4))}}),Cd=Q(Md,[["__scopeId","data-v-8eef007a"]]);function Td(e,t=new WeakMap){if("object"!=typeof e||null==e)return e;if(t.has(e))return t.get(e);const n=Object.create(Object.getPrototypeOf(e));return Object.keys(e).forEach((o=>{const i=e[o];"object"!=typeof i||null===i?n[o]=i:Array.isArray(i)?n[o]=[...i]:i instanceof Set?n[o]=new Set([...i]):i instanceof Map?n[o]=new Map([...i]):(t.set(e,e),n[o]=Td(i,t))})),n}const Ed=e=>{var t;return e.type===Yl.TYPES.MSG_CUSTOM&&"group_create"===(null==(t=null==e?void 0:e.getMessageContent())?void 0:t.businessID)};function Sd(){return zl.getData(Sc.USER,"displayMessageReadReceipt")&&zl.getData(Sc.APP,"enabledMessageReadReceipt")}function Dd(e){return Object.assign({},e)}function kd(e){const t=(new Date).setHours(0,0,0,0),n=new Date((new Date).getFullYear(),0,1,0,0,0,0).getTime(),o=new Date(e),i=864e5,s=t-o.getTime();function a(e){return e<10?"0"+e:e.toString()}if(s<=0)return`${a(o.getHours())}:${a(o.getMinutes())}`;if(s<=i)return`${Wl.t("time.昨天")} ${a(o.getHours())}:${a(o.getMinutes())}`;if(s<=5184e5){const e=["星期日","星期一","星期二","星期三","星期四","星期五","星期六"][o.getDay()];return`${Wl.t("time."+e)} ${a(o.getHours())}:${a(o.getMinutes())}`}return o.getTime()>=n?`${o.getMonth()+1}/${o.getDate()} ${a(o.getHours())}:${a(o.getMinutes())}`:`${o.getFullYear()}/${o.getMonth()+1}/${o.getDate()} ${a(o.getHours())}:${a(o.getMinutes())}`}const Rd=Q(e.defineComponent({__name:"message-container",props:{sender:{default:""},avatar:{default:""},type:{},time:{}},setup(t){const n=t,o=Yl.TYPES,i=e.computed((()=>[o.MSG_IMAGE,o.MSG_VIDEO,o.MSG_MERGER].includes(n.type)));return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"simple-message-container"},[e.createElementVNode("div",{class:"simple-message-avatar"},[e.createVNode(Cd,{url:n.avatar},null,8,["url"])]),e.createElementVNode("div",null,[e.createElementVNode("div",{class:"simple-message-sender"},e.toDisplayString(n.sender),1),e.createElementVNode("div",{class:"simple-message-body"},[e.createElementVNode("div",{class:e.normalizeClass({"simple-message-content":!0,"no-padding":e.unref(i)})},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2),e.createElementVNode("div",{class:"timestamp"},e.toDisplayString(e.unref(kd)(1e3*n.time)),1)])])]))}}),[["__scopeId","data-v-52fc7809"]]),Ld=Q(e.defineComponent({__name:"index",props:{visible:{type:Boolean,default:!0},zIndex:{default:9999},useMask:{type:Boolean,default:!0},maskColor:{default:"rgba(0, 0, 0, 0.6)"},isFullScreen:{type:Boolean,default:!0},width:{default:"auto"},height:{default:"auto"}},emits:["onOverlayClick"],setup(t,{expose:n,emit:o}){const i=o,s=t,a=e.ref(),r=e.ref(s.visible);function c(){i("onOverlayClick")}return e.watch((()=>s.visible),(e=>{e?r.value=!0:setTimeout((()=>{r.value=!1}),150)}),{immediate:!0}),n({overlayDomRef:a}),(t,n)=>e.unref(r)?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"overlayDomRef",ref:a,class:"overlay-container",style:e.normalizeStyle({position:s.isFullScreen?"fixed":"absolute",zIndex:s.zIndex})},[s.useMask?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"overlay-mask":!0,"fade-in":s.visible}),style:e.normalizeStyle({backgroundColor:s.maskColor}),onClick:c,onTouchstart:e.withModifiers(c,["prevent","stop"])},null,38)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({"overlay-content":!0,"full-screen":s.isFullScreen})},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2)],4)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-f5da7cd1"]]),Ad=e.defineComponent({__name:"index",props:{visible:{type:Boolean,default:!0},popDirection:{default:"bottom"},useMask:{type:Boolean,default:!0},isFullScreen:{type:Boolean,default:!0},overlayColor:{},drawerStyle:{default:()=>({})}},emits:["onOverlayClick"],setup(t,{expose:n,emit:o}){var i;const s=o,a=t,r=e.ref(),c=e.ref(),u=e.ref(!1),l=e.ref(a.drawerStyle[a.popDirection]||{});function d(e){s("onOverlayClick",e)}return e.watch((()=>a.visible),(e=>{e?u.value=!0:setTimeout((()=>{u.value=!1}),150)}),{immediate:!0}),n({drawerDomRef:r,overlayDomRef:null==(i=c.value)?void 0:i.overlayDomRef}),(t,n)=>(e.openBlock(),e.createBlock(Ld,{ref_key:"overlayDomInstanceRef",ref:c,visible:a.visible,useMask:a.useMask,maskColor:a.overlayColor,isFullScreen:a.isFullScreen,onOnOverlayClick:d},{default:e.withCtx((()=>[e.unref(u)?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"drawerDomRef",ref:r,class:e.normalizeClass({drawer:!0,"origin-bottom":"bottom"===a.popDirection,"origin-right":"right"===a.popDirection,"slide-bottom":t.visible&&"bottom"===a.popDirection,"slide-right":t.visible&&"right"===a.popDirection}),style:e.normalizeStyle({minHeight:e.unref(l).minHeight,maxHeight:e.unref(l).maxHeight,borderRadius:e.unref(l).borderRadius,boxShadow:e.unref(l).boxShadow,width:e.unref(l).width})},[e.createElementVNode("div",{class:"drawer-container"},[e.renderSlot(t.$slots,"default",{},void 0,!0)])],6)):e.createCommentVNode("",!0)])),_:3},8,["visible","useMask","maskColor","isFullScreen"]))}}),Od=Q(Ad,[["__scopeId","data-v-69304cb2"]]),Nd="isC2C",Pd="isGroup",bd={SERVICE:"consultion",EVALUATE:"evaluation",LINK:"text_link",CALL:1,ORDER:"order"},Ud={BASIC:"basic",BIG:"big",CUSTOM:"CUSTOM"},Gd="https://web.sdk.qcloud.com/im/assets/face-elem/",wd=[{emojiGroupID:1,type:Ud.BIG,url:Gd,list:["yz00","yz01","yz02","yz03","yz04","yz05","yz06","yz07","yz08","yz09","yz10","yz11","yz12","yz13","yz14","yz15","yz16","yz17"]},{emojiGroupID:2,type:Ud.BIG,url:Gd,list:["ys00","ys01","ys02","ys03","ys04","ys05","ys06","ys07","ys08","ys09","ys10","ys11","ys12","ys13","ys14","ys15"]},{emojiGroupID:3,type:Ud.BIG,url:Gd,list:["gcs00","gcs01","gcs02","gcs03","gcs04","gcs05","gcs06","gcs07","gcs08","gcs09","gcs10","gcs11","gcs12","gcs13","gcs14","gcs15","gcs16"]}],Fd={...Object.fromEntries(null==(o=Object.entries(pd))?void 0:o.map((([e,t])=>[t,e]))),...Object.fromEntries(null==(i=Object.entries(dd))?void 0:i.map((([e,t])=>[t,e])))},xd="https://web.sdk.qcloud.com/im/assets/emoji-plugin/",Vd={"[TUIEmoji_Expect]":"emoji_0@2x.png","[TUIEmoji_Blink]":"emoji_1@2x.png","[TUIEmoji_Guffaw]":"emoji_2@2x.png","[TUIEmoji_KindSmile]":"emoji_3@2x.png","[TUIEmoji_Haha]":"emoji_4@2x.png","[TUIEmoji_Cheerful]":"emoji_5@2x.png","[TUIEmoji_Smile]":"emoji_6@2x.png","[TUIEmoji_Sorrow]":"emoji_7@2x.png","[TUIEmoji_Speechless]":"emoji_8@2x.png","[TUIEmoji_Amazed]":"emoji_9@2x.png","[TUIEmoji_Complacent]":"emoji_10@2x.png","[TUIEmoji_Lustful]":"emoji_11@2x.png","[TUIEmoji_Stareyes]":"emoji_12@2x.png","[TUIEmoji_Giggle]":"emoji_13@2x.png","[TUIEmoji_Daemon]":"emoji_14@2x.png","[TUIEmoji_Rage]":"emoji_15@2x.png","[TUIEmoji_Yawn]":"emoji_16@2x.png","[TUIEmoji_TearsLaugh]":"emoji_17@2x.png","[TUIEmoji_Silly]":"emoji_18@2x.png","[TUIEmoji_Wail]":"emoji_19@2x.png","[TUIEmoji_Kiss]":"emoji_20@2x.png","[TUIEmoji_Trapped]":"emoji_21@2x.png","[TUIEmoji_Fear]":"emoji_22@2x.png","[TUIEmoji_BareTeeth]":"emoji_23@2x.png","[TUIEmoji_FlareUp]":"emoji_24@2x.png","[TUIEmoji_Tact]":"emoji_25@2x.png","[TUIEmoji_Shit]":"emoji_26@2x.png","[TUIEmoji_ShutUp]":"emoji_27@2x.png","[TUIEmoji_Sigh]":"emoji_28@2x.png","[TUIEmoji_Hehe]":"emoji_29@2x.png","[TUIEmoji_Silent]":"emoji_30@2x.png","[TUIEmoji_Skull]":"emoji_31@2x.png","[TUIEmoji_Mask]":"emoji_32@2x.png","[TUIEmoji_Beer]":"emoji_33@2x.png","[TUIEmoji_Cake]":"emoji_34@2x.png","[TUIEmoji_RedPacket]":"emoji_35@2x.png","[TUIEmoji_Bombs]":"emoji_36@2x.png","[TUIEmoji_Ai]":"emoji_37@2x.png","[TUIEmoji_Celebrate]":"emoji_38@2x.png","[TUIEmoji_Bless]":"emoji_39@2x.png","[TUIEmoji_Flower]":"emoji_40@2x.png","[TUIEmoji_Watermelon]":"emoji_41@2x.png","[TUIEmoji_Cow]":"emoji_42@2x.png","[TUIEmoji_Fool]":"emoji_43@2x.png","[TUIEmoji_Surprised]":"emoji_44@2x.png","[TUIEmoji_Askance]":"emoji_45@2x.png","[TUIEmoji_Monster]":"emoji_46@2x.png","[TUIEmoji_Pig]":"emoji_47@2x.png","[TUIEmoji_Coffee]":"emoji_48@2x.png","[TUIEmoji_Ok]":"emoji_49@2x.png","[TUIEmoji_Heart]":"emoji_50@2x.png","[TUIEmoji_Sun]":"emoji_51@2x.png","[TUIEmoji_Moon]":"emoji_52@2x.png","[TUIEmoji_Star]":"emoji_53@2x.png","[TUIEmoji_Rich]":"emoji_54@2x.png","[TUIEmoji_Fortune]":"emoji_55@2x.png","[TUIEmoji_857]":"emoji_56@2x.png","[TUIEmoji_666]":"emoji_57@2x.png","[TUIEmoji_Prohibit]":"emoji_58@2x.png","[TUIEmoji_Convinced]":"emoji_59@2x.png","[TUIEmoji_Knife]":"emoji_60@2x.png","[TUIEmoji_Like]":"emoji_61@2x.png"},qd=[{emojiGroupID:0,type:Ud.BASIC,url:xd,list:Object.keys(Vd)},...wd],Bd=e=>ad?pd[e]:Wl.t(`Emoji.${e}`),Hd=e=>{if(!e)return"";const t=/(\[.+?\])/g;let n=e;return t.test(e)&&(n=e.replace(t,(e=>Vd[e]?Bd(e):e))),n},Kd=e=>{const t=/\[([^\]]+)\]/g,n=[];let o,i=0;for(;null!==(o=t.exec(e));){const s=o.index,a=t.lastIndex,r=o[0];s>i&&n.push({type:"text",content:e.substring(i,s)});const c=xd+Vd[r];c?n.push({type:"image",content:c,emojiKey:r}):n.push({type:"text",content:r}),i=a,t.lastIndex=i}return i<e.length&&n.push({type:"text",content:e.substring(i)}),n},Yd=Q(e.defineComponent({__name:"index",props:{renderData:{},disabled:{type:Boolean,default:!1},messageItem:{default:()=>({})}},emits:["assignMessageIDInUniapp"],setup(t,{emit:n}){const o=n,i=t,s=e.ref(!1);function a(){i.disabled||(cd?o("assignMessageIDInUniapp",i.messageItem.ID):s.value=!0)}function r(){s.value=!1}return(t,n)=>(e.openBlock(),e.createElementBlock("div",null,[e.createElementVNode("div",{class:"message-record-container",onClick:a},[e.createElementVNode("div",{class:"record-title"},e.toDisplayString(i.renderData.title),1),e.createElementVNode("div",{class:"record-abstract-container"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(i.renderData.abstractList.slice(0,7),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n,class:"record-abstract-item"},e.toDisplayString(e.unref(Hd)(t)),1)))),128))]),e.createElementVNode("div",{class:"record-footer"},e.toDisplayString(e.unref(Wl).t("TUIChat.聊天记录")),1)]),!i.disabled&&e.unref(id)?(e.openBlock(),e.createBlock(Ld,{key:0,visible:e.unref(s),onOnOverlayClick:n[0]||(n[0]=e=>s.value=!1)},{default:e.withCtx((()=>[e.createVNode(Wd,{isMounted:e.unref(s),renderData:i.renderData,messageID:i.messageItem.ID,onCloseOverlay:r},null,8,["isMounted","renderData","messageID"])])),_:1},8,["visible"])):i.disabled||!e.unref(sd)||e.unref(cd)?e.createCommentVNode("",!0):(e.openBlock(),e.createBlock(Od,{key:1,visible:e.unref(s),isFullScreen:!0,overlayColor:"transparent",popDirection:"right"},{default:e.withCtx((()=>[e.createVNode(Wd,{isMounted:e.unref(s),renderData:i.renderData,messageID:i.messageItem.ID,onCloseOverlay:r},null,8,["isMounted","renderData","messageID"])])),_:1},8,["visible"]))]))}}),[["__scopeId","data-v-0a3ed736"]]),zd=e.defineComponent({__name:"index",props:{messageID:{default:""},isMounted:{type:Boolean,default:!1}},emits:["closeOverlay"],setup(t,{emit:n}){const o=n,i=t,s=Yl.TYPES,a=e.ref(!1),r=e.ref([]),c=e.ref({title:"",messageList:[]}),u=e.ref();e.watch((()=>r.value.length),(async e=>{if(a.value=!1,e<1)return;const t=r.value[r.value.length-1];if(t.downloadKey&&0===t.messageList.length)try{const e=await Xl.downloadMergedMessages({payload:t,type:Yl.TYPES.MSG_MERGER});r.value[r.value.length-1]=e.payload}catch(n){a.value=!0}c.value=r.value[r.value.length-1]})),e.watch((()=>i.isMounted),(e=>{if(e){if(!i.messageID)throw new Error("messageID is required when first render of simple-message-list.");const e=zl.getMessageModel(i.messageID).getMessage().payload;r.value=[e]}else r.value=[]}),{immediate:!0});const l=e.computed((()=>r.value.length>1)),d=e.computed((()=>{var e;return!!(null==(e=c.value)?void 0:e.messageList)&&c.value.messageList.length>0}));function p(){r.value.pop(),r.value.length<1&&o("closeOverlay")}function h(e){let t="";return e.indexOf("@custom")>-1?t=""+e:(t=Gd+e,-1===t.indexOf("@2x")?t+="@2x.png":t+=".png"),t}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"simple-message-list-container":!0,"simple-message-list-container-mobile":e.unref(ud)})},[e.createElementVNode("div",{class:"header-container"},[e.createElementVNode("span",{class:"back",onClick:p},[e.createVNode(Id,{class:"close-icon",file:e.unref(md),size:"18px"},null,8,["file"]),e.unref(l)?(e.openBlock(),e.createElementBlock("span",{key:0},e.toDisplayString(e.unref(Wl).t("TUIChat.返回")),1)):(e.openBlock(),e.createElementBlock("span",{key:1},e.toDisplayString(e.unref(Wl).t("TUIChat.关闭")),1))]),e.createElementVNode("span",{class:"title"},e.toDisplayString(e.unref(c).title),1)]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",{key:0}," Load Merge Message Error ")):e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:1,ref_key:"simpleMessageListRef",ref:u,class:"message-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c).messageList,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.ID,class:e.normalizeClass({"message-item":!0})},[e.createVNode(Rd,{sender:t.nick,avatar:t.avatar,type:t.messageBody[0].type,time:t.time},{default:e.withCtx((()=>[t.messageBody[0].type===e.unref(s).MSG_TEXT?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-text"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(Kd)(t.messageBody[0].payload.text),((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n,class:"message-text-container"},["text"===t.type?(e.openBlock(),e.createElementBlock("span",{key:0,class:"text"},e.toDisplayString(t.content),1)):(e.openBlock(),e.createElementBlock("img",{key:1,class:"simple-emoji",src:t.content,alt:"small-face"},null,8,["src"]))])))),128))])):t.messageBody[0].type===e.unref(s).MSG_IMAGE?(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-image"},[e.createElementVNode("img",{class:"image",src:t.messageBody[0].payload.imageInfoArray[2].url,mode:"widthFix",alt:"image"},null,8,["src"])])):t.messageBody[0].type===e.unref(s).MSG_VIDEO?(e.openBlock(),e.createElementBlock("div",{key:2,class:"message-video"},[e.unref(cd)?(e.openBlock(),e.createElementBlock("div",{key:0,onClick:e=>function(e){if(cd){const t=encodeURIComponent(e);uni.navigateTo({url:`/TUIKit/components/TUIChat/video-play?videoUrl=${t}`})}}(t.messageBody[0].payload.remoteVideoUrl)},[e.createElementVNode("image",{class:"image",src:t.messageBody[0].payload.thumbUrl,mode:"widthFix",alt:"image"},null,8,["src"]),e.createVNode(Id,{class:"video-play-icon",file:e.unref(vd)},null,8,["file"])],8,["onClick"])):(e.openBlock(),e.createElementBlock("video",{key:1,class:"video",controls:"",poster:t.messageBody[0].payload.thumbUrl},[e.createElementVNode("source",{src:t.messageBody[0].payload.remoteVideoUrl,type:"video/mp4"},null,8,["src"])],8,["poster"]))])):t.messageBody[0].type===e.unref(s).MSG_AUDIO?(e.openBlock(),e.createElementBlock("div",{key:3,class:"message-audio"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Wl).t("TUIChat.语音"))+" ",1),e.createElementVNode("span",null,e.toDisplayString(t.messageBody[0].payload.second)+"s",1)])):t.messageBody[0].type===e.unref(s).MSG_FACE?(e.openBlock(),e.createElementBlock("div",{key:4,class:"message-face"},[e.createElementVNode("img",{class:"image",src:h(t.messageBody[0].payload.data),alt:"face"},null,8,["src"])])):t.messageBody[0].type===e.unref(s).MSG_FILE?(e.openBlock(),e.createElementBlock("div",{key:5,class:"message-file"},e.toDisplayString(e.unref(Wl).t("TUIChat.[文件]")),1)):t.messageBody[0].type===e.unref(s).MSG_LOCATION?(e.openBlock(),e.createElementBlock("div",{key:6},e.toDisplayString(e.unref(Wl).t("TUIChat.[地理位置]")),1)):t.messageBody[0].type===e.unref(s).MSG_MERGER?(e.openBlock(),e.createElementBlock("div",{key:7,class:"message-merger",onClickCapture:e=>function(e,t){r.value.push(t.messageBody[0].payload),e.stopPropagation()}(e,t)},[e.createVNode(Yd,{disabled:"",renderData:t.messageBody[0].payload},null,8,["renderData"])],40,["onClickCapture"])):t.messageBody[0].type===e.unref(s).MSG_CUSTOM?(e.openBlock(),e.createElementBlock("div",{key:8},e.toDisplayString(e.unref(Wl).t("TUIChat.[自定义消息]")),1)):e.createCommentVNode("",!0)])),_:2},1032,["sender","avatar","type","time"])])))),128))],512)):e.createCommentVNode("",!0)],2))}}),Wd=Q(zd,[["__scopeId","data-v-33e04bb5"]]),Jd=Q(e.defineComponent({__name:"index",props:{groupID:{default:""}},setup(t){const n=t,o=e.ref(),i=e.ref(0),s=e.ref(!1),a=e.ref([]);async function r(){return(await Zl.getGroupApplicationList()).data.applicationList.filter((e=>e.groupID===n.groupID))}function c(){s.value=!s.value}async function u(){const e=await r();if(0===e.length)return[];const t=e.map((e=>0===e.applicationType?e.applicant:e.userID)),{data:n}=await $l.getUserProfile({userIDList:t}),o={};n.forEach((e=>{o[e.userID]=e}));return e.map((e=>{const t=o[0===e.applicationType?e.applicant:e.userID];return{nick:t.nick||t.userID||"anonymous",avatar:t.avatar||"",isRemoved:!1,application:e}}))}function l(e,t,n){Zl.handleGroupApplication({handleAction:t,application:e.application}).then((()=>{a.value[n].isRemoved=!0,setTimeout((()=>{a.value.splice(n,1),i.value-=1}),150)})).catch((()=>{}))}function d(){u().then((e=>{a.value=e,i.value=e.length}))}return e.watch(s,(e=>{e&&u().then((e=>{a.value=e,i.value=e.length}))})),e.watch((()=>a.value.length),((e,t)=>{t>0&&0===e&&(s.value=!1)})),e.onMounted((()=>{r().then((e=>{i.value=e.length})),zl.watch(Sc.GRP,{groupSystemNoticeList:d})})),e.onUnmounted((()=>{zl.unwatch(Sc.GRP,{groupSystemNoticeList:d})})),(t,n)=>(e.openBlock(),e.createElementBlock("div",null,[e.unref(i)>0?(e.openBlock(),e.createElementBlock("div",{key:0,class:"application-tips"},[e.createElementVNode("div",null,e.toDisplayString(e.unref(i))+e.toDisplayString(e.unref(Wl).t("TUIChat.条入群申请")),1),e.createElementVNode("div",{class:"application-tips-btn",onClick:c},e.toDisplayString(e.unref(Wl).t("TUIChat.点击处理")),1)])):e.createCommentVNode("",!0),e.createVNode(Od,{ref_key:"drawerDomInstanceRef",ref:o,visible:e.unref(s),zIndex:998,popDirection:e.unref(ud)?"bottom":"right",isFullScreen:e.unref(ud),overlayColor:e.unref(ud)?void 0:"transparent",drawerStyle:{bottom:{minHeight:"60vh",maxHeight:"80vh",borderRadius:"12px 12px 0 0"},right:{width:"360px",borderRadius:"12px 0 0 12px",boxShadow:"0 0 10px 0 #d0d0d0"}},onOnOverlayClick:c},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass({"application-contaienr":!0})},[e.createElementVNode("header",{class:"application-header"},[e.createElementVNode("div",{onClick:c},[e.unref(id)?(e.openBlock(),e.createBlock(Id,{key:0,file:e.unref("/assets/close-dark.f3809f45.svg"),size:"16px"},null,8,["file"])):(e.openBlock(),e.createElementBlock("div",{key:1},e.toDisplayString(e.unref(Wl).t("关闭")),1))])]),e.createElementVNode("main",null,[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:t.nick,class:e.normalizeClass({"application-item":!0,removed:t.isRemoved})},[e.createVNode(Cd,{style:{flex:"0 0 auto"},url:t.avatar,useSkeletonAnimation:!0},null,8,["url"]),e.createElementVNode("div",{class:"application-item-info"},[e.createElementVNode("div",{class:"application-item-nick"},e.toDisplayString(t.nick),1),e.createElementVNode("div",{class:"application-item-note"},e.toDisplayString(e.unref(Wl).t("TUIChat.申请加入")),1)]),e.createElementVNode("div",{class:"application-item-operation"},[e.createElementVNode("div",{class:"agree",onClick:e=>l(t,"Agree",n)},e.toDisplayString(e.unref(Wl).t("TUIChat.同意")),9,["onClick"]),e.createElementVNode("div",{class:"reject",onClick:e=>l(t,"Reject",n)},e.toDisplayString(e.unref(Wl).t("TUIChat.拒绝")),9,["onClick"])])],2)))),128))])])])),_:1},8,["visible","popDirection","isFullScreen","overlayColor"])]))}}),[["__scopeId","data-v-e6010776"]]),$d=Q(e.defineComponent({__name:"message-text",props:{content:{default:()=>({})}},setup(t){const n=t,o=e.ref();return e.watchEffect((()=>{var e;o.value=n.content,null==(e=o.value.text)||e.forEach((e=>{"img"===e.name&&"custom"===(null==e?void 0:e.type)&&_("warn","at src/roomkit/TUIKit/components/TUIChat/message-list/message-elements/message-text.vue:37","CUSTOM_BASIC_EMOJI_URL is required for custom emoji, please check your CUSTOM_BASIC_EMOJI_URL.")}))})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-text-container",e.unref(id)&&"text-select"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(o).text,((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n},["text"===t.name?(e.openBlock(),e.createElementBlock("span",{key:0,class:"text"},e.toDisplayString(t.text),1)):(e.openBlock(),e.createElementBlock("img",{key:1,class:"emoji",src:t.src,alt:t.emojiKey},null,8,["src","alt"]))])))),128))],2))}}),[["__scopeId","data-v-fcd85917"]]),Xd=155,Zd=Q(e.defineComponent({__name:"message-image",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},emits:["previewImage"],setup(t,{emit:n}){const o=n,i=t,s=e.ref({width:"auto",height:"auto"}),a=e=>{const{width:t,height:n}=e;if(0===t||0===n)return;let o=0,i=0;t>=n?(o=Xd,i=Xd*n/t):(o=Xd*t/n,i=Xd),s.value.width=o+"px",s.value.height=i+"px"};e.watchEffect((()=>{a(i.content)}));const r=e=>{a(e.detail)},c=()=>{var e;"success"!==(null==(e=i.messageItem)?void 0:e.status)&&1!==i.messageItem.progress||o("previewImage")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"image-container",onClick:c},[e.createElementVNode("image",{class:"message-image",mode:"aspectFit",src:i.content.url,style:e.normalizeStyle({width:e.unref(s).width,height:e.unref(s).height}),onLoad:r},null,44,["src"])]))}}),[["__scopeId","data-v-de04ebdb"]]),Qd="success",ep="warning",tp="error",np="normal",op=e=>{be.showToast({title:e.message||"Toast",duration:e.duration||1500,icon:ip(e.type)})},ip=e=>{if(!e)return"none";switch(e){case tp:case ep:return"none";case Qd:return"success";default:return"none"}},sp=Q(e.defineComponent({__name:"message-audio",props:{broadcastNewAudioSrc:{},messageItem:{default:()=>({})},content:{default:()=>({})}},emits:["getGlobalAudioContext","setAudioPlayed"],setup(t,{emit:n}){const o=n,i=t,s=new Map,a=e.ref(!1);function r(){if(o("getGlobalAudioContext",s,{newAudioSrc:i.content.url}),i.messageItem.hasRiskContent||!i.content.url)return void op({message:"暂不支持播放"});h()||(s.set("audio",uni.createInnerAudioContext()),function(){const e=h();if(!e)return;e.src=i.content.url,a.value=!1,e.onPlay(u),e.onStop(l),e.onEnded(d),e.onError(p)}()),a.value?c():function(){const e=h();e&&(e.play(),"in"===i.messageItem.flow&&o("setAudioPlayed",i.messageItem.ID))}()}function c(){const e=h();if(e)try{e.stop()}catch{}}function u(){a.value=!0}function l(){a.value=!1}function d(){a.value=!1}function p(){_("warn","at src/roomkit/TUIKit/components/TUIChat/message-list/message-elements/message-audio.vue:156","audio played error")}function h(){return s.get("audio")}return e.onUnmounted((()=>{var e;const t=h();a.value&&c(),null==(e=null==t?void 0:t.destroy)||e.call(t),s.delete("audio")})),e.watch((()=>i.broadcastNewAudioSrc),(e=>{e!==i.content.url&&a.value&&(c(),a.value=!1)})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-audio":!0,reserve:"out"===i.messageItem.flow}),onClick:r},[e.createElementVNode("div",{class:"audio-icon-container"},[e.createElementVNode("div",{class:e.normalizeClass({mask:!0,play:e.unref(a)})},null,2),e.createVNode(Id,{class:"icon",width:"15px",height:"20px",file:e.unref("/assets/msg-audio.ac2cd1c9.svg")},null,8,["file"])]),e.createElementVNode("div",{class:"time",style:e.normalizeStyle({width:5*i.content.second+"px"})},e.toDisplayString(i.content.second||1)+' " ',5)],2))}}),[["__scopeId","data-v-c826384b"]]),ap=Q(e.defineComponent({__name:"message-file",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},setup(t){const n=t,o=()=>{if(n.messageItem.hasRiskContent)return;const e={mode:"cors",headers:new Headers({"Content-Type":"application/x-www-form-urlencoded"})};if(null==window?void 0:window.fetch)fetch(n.content.url,e).then((e=>e.blob())).then((e=>{const t=document.createElement("a"),o=window.URL.createObjectURL(e);t.href=o,t.download=n.content.name,t.click()}));else{const e=document.createElement("a");e.href=n.content.url,e.target="_blank",e.download=n.content.name,e.click()}};return(t,i)=>(e.openBlock(),e.createElementBlock("div",{class:"file-message-montainer",title:e.unref(Wl).t("TUIChat.单击下载"),onClick:o},[e.createVNode(Id,{file:e.unref("/assets/file-light.7beeea9d.svg"),class:"file-icon"},null,8,["file"]),e.createElementVNode("div",null,[e.createElementVNode("div",null,e.toDisplayString(n.content.name),1),e.createElementVNode("div",null,e.toDisplayString(n.content.size),1)])],8,["title"]))}}),[["__scopeId","data-v-eb166300"]]),rp=Q(e.defineComponent({__name:"message-face",props:{content:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.ref(n.content.url);return e.onMounted((()=>{"custom"===n.content.type&&_("warn","at src/roomkit/TUIKit/components/TUIChat/message-list/message-elements/message-face.vue:29","CUSTOM_BIG_EMOJI_URL is required for custom emoji, please check your CUSTOM_BIG_EMOJI_URL.")})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-image"},[e.createElementVNode("img",{mode:"aspectFit",class:"message-image",src:e.unref(o)},null,8,["src"])]))}}),[["__scopeId","data-v-eccc0a5d"]]),cp="/assets/star-light.d9a7aedf.png",up=Q(e.defineComponent({__name:"message-custom",props:{messageItem:{default:void 0},content:{default:void 0}},setup(t){const n=t,o=e.ref(),i=e.ref(),s=e.ref(),a=e.ref({businessID:""});e.watchEffect((()=>{o.value=n.content,i.value=n.messageItem;const{payload:e}=n.messageItem;a.value=e.data||"",a.value=od(e.data),e.data===bd.SERVICE&&(s.value=od(e.extension))}));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"custom"},[e.unref(a).businessID===e.unref(bd).SERVICE?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createElementVNode("h1",null,[e.createElementVNode("label",null,e.toDisplayString(e.unref(s).title),1),e.unref(s).hyperlinks_text?(e.openBlock(),e.createElementBlock("a",{key:0,href:e.unref(s).hyperlinks_text.value,target:"view_window"},e.toDisplayString(e.unref(s).hyperlinks_text.key),9,["href"])):e.createCommentVNode("",!0)]),e.unref(s).item&&e.unref(s).item.length>0?(e.openBlock(),e.createElementBlock("ul",{key:0},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(s).item,((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n},[e.unref(nd)(t.value)?(e.openBlock(),e.createElementBlock("a",{key:0,href:t.value,target:"view_window"},e.toDisplayString(t.key),9,["href"])):(e.openBlock(),e.createElementBlock("p",{key:1},e.toDisplayString(t.key),1))])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("article",null,e.toDisplayString(e.unref(s).description),1)])):e.unref(a).businessID===e.unref(bd).EVALUATE?(e.openBlock(),e.createElementBlock("div",{key:1,class:"evaluate"},[e.createElementVNode("h1",null,e.toDisplayString(e.unref(Wl).t("message.custom.对本次服务评价")),1),e.createElementVNode("ul",{class:"evaluate-list"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(Math.max(e.unref(a).score,0),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"evaluate-list-item"},[e.createVNode(Id,{file:e.unref(cp),class:"file-icon"},null,8,["file"])])))),128))]),e.createElementVNode("article",null,e.toDisplayString(e.unref(a).comment),1)])):e.unref(a).businessID===e.unref(bd).ORDER?(e.openBlock(),e.createElementBlock("div",{key:2,class:"order",onClick:n[0]||(n[0]=t=>{return n=e.unref(a).link,void window.open(n);var n})},[e.createElementVNode("img",{src:e.unref(a).imageUrl},null,8,["src"]),e.createElementVNode("main",null,[e.createElementVNode("h1",null,e.toDisplayString(e.unref(a).title),1),e.createElementVNode("p",null,e.toDisplayString(e.unref(a).description),1),e.createElementVNode("span",null,e.toDisplayString(e.unref(a).price),1)])])):e.unref(a).businessID===e.unref(bd).LINK?(e.openBlock(),e.createElementBlock("div",{key:3,class:"textLink"},[e.createElementVNode("p",null,e.toDisplayString(e.unref(a).text),1),e.createElementVNode("a",{href:e.unref(a).link,target:"view_window"},e.toDisplayString(e.unref(Wl).t("message.custom.查看详情>>")),9,["href"])])):(e.openBlock(),e.createElementBlock("span",{key:4,innerHTML:t.content.custom},null,8,["innerHTML"]))]))}}),[["__scopeId","data-v-3891f1f1"]]),lp=Q(e.defineComponent({__name:"message-tip",props:{content:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.computed((()=>{var e,t;return(null==(e=n.content)?void 0:e.text)||(null==(t=n.content)?void 0:t.custom)||""}));return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-tip"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(o)),1)]))}}),[["__scopeId","data-v-8fcff1c3"]]);class dp{constructor(){this.chatType="",this.features={DownloadFile:!0,CopyMessage:!0,DeleteMessage:!0,RevokeMessage:!0,QuoteMessage:!1,ForwardMessage:!1,TranslateMessage:!1,VoiceToText:!1,MultiSelection:!1,EmojiReaction:!1,InputEmoji:!0,InputStickers:!1,InputImage:!0,InputVoice:!1,InputVideo:!0,InputFile:!0,InputEvaluation:!1,InputQuickReplies:!1,InputMention:!1,MessageSearch:!1,ReadStatus:!1},this.theme="light"}static getInstance(){return dp.instance||(dp.instance=new dp),dp.instance}setChatType(e){this.chatType=e}getChatType(){return this.chatType}hideTUIChatFeatures(e){e&&e.forEach((e=>{this.features[e]&&(this.features[e]=!1)}))}getFeatureConfig(e){return e?this.features[e]:this.features}setTheme(e){this.theme=e}getTheme(){return this.theme}}const pp=dp.getInstance();pp.hideTUIChatFeatures.bind(pp);const hp=Q(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},emits:["openReadUserPanel"],setup(t,{emit:n}){const o=n,i=t,s=pp.getFeatureConfig("ReadStatus"),a=Yl.TYPES,r=e.ref(zl.getData(Sc.USER,"displayMessageReadReceipt"));e.onMounted((()=>{zl.watch(Sc.USER,{displayMessageReadReceipt:g})})),e.onUnmounted((()=>{zl.unwatch(Sc.USER,{displayMessageReadReceipt:g})}));const c=e.computed((()=>{if(!s)return!1;if(!r.value)return!1;const{ID:e,type:t,flow:n,status:o,hasRiskContent:c,conversationID:u,conversationType:l,needReadReceipt:d=!1}=i.message;if(c)return!1;const{groupProfile:p}=zl.getConversationModel(u)||{};if((null==p?void 0:p.type)===a.GRP_AVCHATROOM||(null==p?void 0:p.type)===a.GRP_COMMUNITY)return!1;if(t===a.MSG_CUSTOM){const t=zl.getMessageModel(e);if(null!==(null==t?void 0:t.getSignalingInfo()))return!1}return"out"===n&&"success"===o&&("GROUP"===l?d:"C2C"===l)})),u=e.computed((()=>{const{conversationType:e,needReadReceipt:t=!1,isPeerRead:n=!1}=i.message,{readCount:o=0,unreadCount:s=0,isPeerRead:a=!1}=i.message.readReceiptInfo;return"C2C"===e?t?a?0:1:n?0:1:"GROUP"===e?t?0===o?1:0===s?2:4:3:1})),l=e.computed((()=>{const{readCount:e=0}=i.message.readReceiptInfo;switch(u.value){case 0:return Wl.t("TUIChat.已读");case 1:return Wl.t("TUIChat.未读");case 2:return Wl.t("TUIChat.全部已读");case 4:return`${e}${Wl.t("TUIChat.人已读")}`;default:return""}})),d=e.computed((()=>{const{conversationType:e}=i.message;return"C2C"===e?0!==u.value:"GROUP"===e&&2!==u.value})),p=e.computed((()=>i.message.needReadReceipt&&"GROUP"===i.message.conversationType&&(4===u.value||1===u.value)));function h(){p.value&&o("openReadUserPanel")}function g(e){r.value=e}return(t,n)=>e.withDirectives((e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-label":!0,unread:e.unref(d),"finger-point":e.unref(p)}),onClick:h},[e.createElementVNode("span",null,e.toDisplayString(e.unref(l)),1)],2)),[[e.vShow,e.unref(c)]])}}),[["__scopeId","data-v-af32c89e"]]);var gp=(e=>(e[e.TYPE_NONE=0]="TYPE_NONE",e[e.TYPE_TEXT=1]="TYPE_TEXT",e[e.TYPE_CUSTOM=2]="TYPE_CUSTOM",e[e.TYPE_IMAGE=3]="TYPE_IMAGE",e[e.TYPE_SOUND=4]="TYPE_SOUND",e[e.TYPE_VIDEO=5]="TYPE_VIDEO",e[e.TYPE_FILE=6]="TYPE_FILE",e[e.TYPE_LOCATION=7]="TYPE_LOCATION",e[e.TYPE_FACE=8]="TYPE_FACE",e[e.TYPE_GROUP_TIPS=9]="TYPE_GROUP_TIPS",e[e.TYPE_MERGER=10]="TYPE_MERGER",e))(gp||{});const _p=Q(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},emits:["scrollTo","blinkMessage"],setup(t,{emit:n}){const o=n,i=t;let s=0;const a=e.ref(""),r=e.ref(!1),c=e.ref({}),u=e.computed((()=>{var e;try{const t=JSON.parse((null==(e=i.message)?void 0:e.cloudCustomData)||"{}"),n=zl.getMessageModel(t.messageReply.messageID);return null==n?void 0:n.isRevoked}catch(t){return!0}}));async function l(){var e;if(u.value)return;const t=null==(e=c.value)?void 0:e.messageID,n=zl.getData(Sc.CHAT,"messageList").some((e=>e.ID===t));if(t&&n)try{const e=await We("#messageScrollList","messageList"),n=await We("#tui-"+t,"messageList"),{scrollTop:i}=await Je("#messageScrollList","messageList"),a=n.top+i-e.top-s++%2,r=n.top<e.top;if(!cd&&window){const e=document.getElementById("messageScrollList");r&&e&&(e.scrollTop=a)}else cd&&r&&o("scrollTo",a);o("blinkMessage",t)}catch(i){_("error","at src/roomkit/TUIKit/components/TUIChat/message-list/message-elements/message-quote/index.vue:154",i)}else op({message:Wl.t("TUIChat.无法定位到原消息"),type:ep})}return e.onMounted((()=>{var e;try{const t=JSON.parse((null==(e=i.message)?void 0:e.cloudCustomData)||"{}");r.value=Boolean(t.messageReply),r.value&&(c.value=t.messageReply,a.value=function(e){let t="",n="";switch(e.messageType){case gp.TYPE_TEXT:t="[文本]";break;case gp.TYPE_CUSTOM:t="[自定义消息]";break;case gp.TYPE_IMAGE:t="[图片]";break;case gp.TYPE_SOUND:t="[音频]";break;case gp.TYPE_VIDEO:t="[视频]";break;case gp.TYPE_FILE:t="[文件]";break;case gp.TYPE_LOCATION:t="[地理位置]";break;case gp.TYPE_FACE:t="[动画表情]";break;case gp.TYPE_GROUP_TIPS:t="[群提示]";break;case gp.TYPE_MERGER:t="[聊天记录]";break;default:t="[消息]"}[gp.TYPE_TEXT,gp.TYPE_MERGER].includes(e.messageType)&&(n=e.messageAbstract);return n||Wl.t(`TUIChat.${t}`)}(c.value))}catch(t){r.value=!1}})),(t,n)=>e.unref(r)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"reference-content":!0,reverse:"out"===t.message.flow}),onClick:l},[e.unref(u)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"revoked-text"},e.toDisplayString(e.unref(Wl).t("TUIChat.引用内容已撤回")),1)):(e.openBlock(),e.createElementBlock("div",{key:1,class:"max-double-line"},e.toDisplayString(e.unref(c).messageSender)+": "+e.toDisplayString(e.unref(Hd)(e.unref(a))),1))],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-aa0c68b8"]]),fp=class e{constructor(){this.isUseCache=!0,this.translationCache=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}async get(e){if(this.isUseCache){const t=this.translationCache.get(e.ID);if(void 0!==t)return t}const t=zl.getMessageModel(e.ID);if(!t)return[];const{text:n}=t.getMessageContent()||{},o=[],i=await this.getNickList(t);for(let r=0;r<n.length;++r){const e=n[r];if("img"===e.name){o.push({type:"face",value:e.src});continue}const{transSplitingList:t,atNickList:s}=this.getSplitResult(e.text,i);for(let n=0;n<t.length;++n)o.push({type:"text",value:t[n]}),n<s.length&&o.push({type:"mention",value:s[n]})}const s=[],a=o.filter(((e,t)=>"text"===e.type&&""!==e.value.trim()&&(s.push(t),!0))).map((e=>e.value));if(0===a.length)return this.translationCache.set(t.ID,o),o;return(await this.getTranslationStandard(a)).forEach(((e,t)=>{o[s[t]].value=e})),this.translationCache.set(t.ID,o),o}clear(){this.translationCache.clear()}disableCache(){this.isUseCache=!1}enableCache(){this.isUseCache=!0}getTranslationStandard(e){return new Promise(((t,n)=>{Xl.translateText({sourceTextList:e,sourceLanguage:"auto"}).then((e=>{const{data:{translatedTextList:n}}=e;t(n)})).catch((e=>{n(e)}))}))}async getNickList(e){const t=[],{atUserList:n=[]}=e,o=Yl.TYPES.MSG_AT_ALL;if(n.includes(o)&&t.push(`@${Wl.t("TUIChat.所有人")}`),n.length>0){const{data:e}=await $l.getUserProfile({userIDList:n});e.forEach((e=>{const n=`@${e.nick||e.userID}`;t.push(n)}))}return[...new Set(t)]}getSplitResult(e,t){let n=0;const o=[],i=[];for(;n<e.length;){const s=e.indexOf("@",n);if(-1===s){o.push(e.substring(n));break}let a=!1;for(let r=0;r<t.length;++r){const c=e.indexOf(t[r],s);if(-1!==c&&c===s){o.push(e.substring(n,c)),i.push(t[r]),n=c+t[r].length,a=!0;break}}if(!a){o.push(e.substring(n));break}}return{transSplitingList:o,atNickList:i}}};fp.instance=void 0;const mp=fp.getInstance(),vp=Q(e.defineComponent({__name:"translation-content",props:{message:{default:()=>({})},translationContentVisible:{type:Boolean},isSingleTranslation:{type:Boolean},translationWrapperRef:{}},setup(t){const n=t,o=e.ref(!1),i=e.ref(""),s=e.ref([]);return e.watch((()=>n.translationContentVisible),(e=>{e&&mp.get(n.message).then((e=>{o.value=!0,s.value=e})).catch((e=>{o.value=!0,emits("toggleErrorStatus",!0),i.value=e.message}))}),{immediate:!0}),(t,a)=>(e.openBlock(),e.createElementBlock("div",{class:"message-translation-container"},[e.unref(o)?(e.openBlock(),e.createElementBlock("div",{key:0,id:`translation-content-${n.message.ID}`,class:e.normalizeClass({"translation-content":!0,occur:!0})},[e.unref(s).length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(e.unref(s),((t,n)=>(e.openBlock(),e.createElementBlock("span",{key:n},["face"===t.type?(e.openBlock(),e.createElementBlock("img",{key:0,class:"text-face",src:t.value},null,8,["src"])):(e.openBlock(),e.createElementBlock("span",{key:1,class:"text-plain"},e.toDisplayString(t.value),1))])))),128)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.createTextVNode(e.toDisplayString(e.unref(i)),1)],64))],8,["id"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({loading:!0,"loading-end":e.unref(o)})},e.toDisplayString(e.unref(Wl).t("TUIChat.翻译中"))+"... ",3)]))}}),[["__scopeId","data-v-4797047c"]]),yp=Q(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},setup(t){const n=t,o=e.ref(!1),i=e.ref(!1),s=e.ref();let a=!0;function r(e){i.value=e}function c(e){if(void 0===e)return;a=!1;const t=e.get(n.message.conversationID)||[];for(let s=0;s<t.length;++s){const{messageID:e,visible:r}=t[s];if(e===n.message.ID&&void 0!==r){1===t.length&&r&&(a=!0),i.value=!1,o.value=r;break}}}return e.onMounted((()=>{zl.watch(Sc.CHAT,{translateTextInfo:c})})),e.onUnmounted((()=>{zl.unwatch(Sc.CHAT,{translateTextInfo:c})})),(t,c)=>e.unref(o)?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"translationWrapperRef",ref:s,class:e.normalizeClass({"message-translation":!0,reverse:"out"===n.message.flow,error:e.unref(i)})},[e.createVNode(vp,{message:n.message,translationContentVisible:e.unref(o),translationWrapperRef:e.unref(s),isSingleTranslation:e.unref(a),onToggleErrorStatus:r},null,8,["message","translationContentVisible","translationWrapperRef","isSingleTranslation"]),e.createElementVNode("div",{class:"copyright"},[e.createVNode(Id,{file:e.unref("/assets/check-sm.bfc05916.svg"),size:"13px"},null,8,["file"]),e.createElementVNode("div",{class:"copyright-text"},e.toDisplayString(e.unref(Wl).t("TUIChat.由IM提供翻译支持")),1)])],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-52b11083"]]),Ip=class e{constructor(){this.isUseCache=!0,this.convertCache=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}async get(e){if(this.isUseCache){const t=this.convertCache.get(e.ID);if(void 0!==t)return t}const t=zl.getMessageModel(e.ID);if(!t)return Promise.reject("message not found");const n=await Xl.convertVoiceToText({message:t});let{data:{result:o}={}}=n;return o?this.convertCache.set(t.ID,o):o="",o}clear(){this.convertCache.clear()}disableCache(){this.isUseCache=!1}enableCache(){this.isUseCache=!0}};Ip.instance=void 0;const Mp=Ip.getInstance(),Cp=Q(e.defineComponent({__name:"convert-content",props:{message:{default:()=>({})},contentVisible:{type:Boolean}},emits:["toggleErrorStatus"],setup(t,{emit:n}){const o=n,i=t,s=e.ref(!1),a=e.ref("");return e.watch((()=>i.contentVisible),(e=>{e&&Mp.get(i.message).then((e=>{s.value=!0,a.value=e})).catch((e=>{s.value=!0,o("toggleErrorStatus",!0),a.value=e.message}))}),{immediate:!0}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-convert-container"},[e.unref(s)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"convert-content":!0,occur:!0})},e.toDisplayString(e.unref(a)),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({loading:!0,"loading-end":e.unref(s)})},e.toDisplayString(e.unref(Wl).t("TUIChat.转换中"))+"... ",3)]))}}),[["__scopeId","data-v-a9fcf307"]]),Tp=Q(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},setup(t){const n=t,o=e.ref(!1),i=e.ref(!1),s=e.ref();let a=!0;function r(e){i.value=e}function c(e){if(void 0===e)return;a=!1;const t=e.get(n.message.conversationID)||[];for(let s=0;s<t.length;++s){const{messageID:e,visible:r}=t[s];if(e===n.message.ID&&void 0!==r){1===t.length&&r&&(a=!0),i.value=!1,o.value=r;break}}}return e.onMounted((()=>{zl.watch(Sc.CHAT,{voiceToTextInfo:c})})),e.onUnmounted((()=>{zl.unwatch(Sc.CHAT,{voiceToTextInfo:c})})),(t,c)=>e.unref(o)?(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"convertWrapperRef",ref:s,class:e.normalizeClass({"message-convert":!0,reverse:"out"===n.message.flow,error:e.unref(i)})},[e.createVNode(Cp,{message:n.message,contentVisible:e.unref(o),isSingleConvert:e.unref(a),convertWrapperRef:e.unref(s),onToggleErrorStatus:r},null,8,["message","contentVisible","isSingleConvert","convertWrapperRef"])],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-622cc2cd"]]),Ep=Q(e.defineComponent({__name:"index",props:{isSelected:{type:Boolean}},emits:["onChange"],setup(t,{emit:n}){const o=n,i=t;function s(){o("onChange",!i.isSelected)}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"radio-select",onClick:s},[i.isSelected?(e.openBlock(),e.createBlock(Id,{key:1,file:e.unref("/assets/radio.0422f0b5.svg"),size:"20px"},null,8,["file"])):(e.openBlock(),e.createElementBlock("div",{key:0,class:"radio-no-select"}))]))}}),[["__scopeId","data-v-673b75bc"]]),Sp=Q(e.defineComponent({__name:"message-bubble",props:{messageItem:{default:()=>({})},content:{default:()=>({})},classNameList:{default:()=>[]},blinkMessageIDList:{default:()=>[]},isMultipleSelectMode:{type:Boolean,default:!1},isAudioPlayed:{type:Boolean,default:!1},multipleSelectedMessageIDList:{default:()=>[]}},emits:["resendMessage","blinkMessage","setReadReceiptPanelVisible","changeSelectMessageIDList","scrollTo"],setup(t,{emit:n}){const o=n,i=t,s=Yl.TYPES,a=[s.MSG_LOCATION,s.MSG_TEXT,s.MSG_CUSTOM,s.MSG_MERGER,s.MSG_FACE],{blinkMessageIDList:r,messageItem:c}=e.toRefs(i),u=e.computed((()=>i.multipleSelectedMessageIDList.includes(c.value.ID))),l=e.computed((()=>"in"===c.value.flow&&"success"===c.value.status&&c.value.type===s.MSG_AUDIO&&!i.isAudioPlayed)),d=e.computed((()=>["message-bubble",u.value?"multiple-selected":"",...i.classNameList])),p=e.computed((()=>[s.MSG_IMAGE,s.MSG_VIDEO,s.MSG_MERGER].includes(c.value.type))),h=e.computed((()=>{let e=Wl.t("TUIChat.涉及敏感内容")+", ";return"out"===c.value.flow?e+=Wl.t("TUIChat.发送失败"):e+=Wl.t(c.value.type===s.MSG_AUDIO?"TUIChat.无法收听":"TUIChat.无法查看"),e})),g=e.computed((()=>{var e,t;return!!(null==(e=c.value)?void 0:e.ID)&&(null==(t=null==r?void 0:r.value)?void 0:t.includes(c.value.ID))}));function _(e){o("changeSelectMessageIDList",{type:e?"add":"remove",messageID:c.value.ID})}function f(e){o("blinkMessage",e)}function m(e){o("scrollTo",e)}function v(){o("setReadReceiptPanelVisible",!0,c.value)}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(e.unref(d))},[i.isMultipleSelectMode?(e.openBlock(),e.createBlock(Ep,{key:0,class:"multiple-select-radio",isSelected:e.unref(u),onOnChange:_},null,8,["isSelected"])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass({"control-reverse":"out"===e.unref(c).flow})},[e.createElementVNode("div",{class:"message-bubble-content"},[e.createElementVNode("div",{class:e.normalizeClass(["message-bubble-main-content",["in"===e.unref(c).flow?"":"reverse"]])},[e.createVNode(Cd,{useSkeletonAnimation:"",url:e.unref(c).avatar||"",style:{flex:"0 0 auto"}},null,8,["url"]),e.createElementVNode("main",{class:"message-body",onClick:n[1]||(n[1]=e.withModifiers((()=>{}),["stop"]))},["in"===e.unref(c).flow&&"GROUP"===e.unref(c).conversationType?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-body-nick-name"},e.toDisplayString(i.content.showName),1)):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["message-body-main","out"===e.unref(c).flow&&"message-body-main-reverse"])},[e.createElementVNode("div",{class:e.normalizeClass(["blink","message-body-content","out"===e.unref(c).flow?"content-out":"content-in",e.unref(c).hasRiskContent&&"content-has-risk",e.unref(p)?"content-no-padding":"",e.unref(p)&&e.unref(g)?"blink-shadow":"",!e.unref(p)&&e.unref(g)?"blink-content":""])},[e.createElementVNode("div",{class:"content-main"},[e.unref(c).type!==e.unref(s).MSG_IMAGE&&e.unref(c).type!==e.unref(s).MSG_VIDEO||!e.unref(c).hasRiskContent?e.renderSlot(t.$slots,"default",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock("img",{key:0,class:e.normalizeClass(["message-risk-replace",!e.unref(id)&&"message-risk-replace-h5"]),src:"https://web.sdk.qcloud.com/component/TUIKit/assets/has_risk_default.png"},null,2))]),e.unref(c).hasRiskContent?(e.openBlock(),e.createElementBlock("div",{key:0,class:"content-has-risk-tips"},e.toDisplayString(e.unref(h)),1)):e.createCommentVNode("",!0)],2),e.unref(l)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"audio-unplay-mark"})):e.createCommentVNode("",!0),"fail"===e.unref(c).status||e.unref(c).hasRiskContent?(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-label fail",onClick:n[0]||(n[0]=e=>{var t;(null==(t=c.value)?void 0:t.hasRiskContent)||o("resendMessage")})}," ! ")):e.createCommentVNode("",!0),"unSend"===e.unref(c).status&&a.includes(e.unref(c).type)?(e.openBlock(),e.createBlock(Id,{key:2,class:"message-label loading-circle",file:e.unref("/assets/loading.2a143778.png"),width:"15px",height:"15px"},null,8,["file"])):e.createCommentVNode("",!0),e.createVNode(hp,{class:"message-label align-self-bottom",message:e.unref(Dd)(e.unref(c)),onOpenReadUserPanel:v},null,8,["message"])],2)])],2),e.createElementVNode("div",{class:"message-bubble-extra-content"},[e.createVNode(yp,{class:e.normalizeClass("out"===e.unref(c).flow?"reverse":"flex-row"),message:e.unref(c)},null,8,["class","message"]),e.createVNode(Tp,{class:e.normalizeClass("out"===e.unref(c).flow?"reverse":"flex-row"),message:e.unref(c)},null,8,["class","message"]),e.createVNode(_p,{class:e.normalizeClass("out"===e.unref(c).flow?"reverse":"flex-row"),message:e.unref(c),onBlinkMessage:f,onScrollTo:m},null,8,["class","message"])])])],2)],2))}}),[["__scopeId","data-v-1d8883e2"]]),Dp=Q(e.defineComponent({__name:"message-location",props:{content:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.ref();return e.watchEffect((()=>{o.value=n.content})),(t,n)=>(e.openBlock(),e.createElementBlock("a",{class:"message-location",href:e.unref(o).href,target:"_blank",title:"点击查看详情"},[e.createElementVNode("span",{class:"el-icon-location-outline"},e.toDisplayString(e.unref(o).description),1),e.createElementVNode("img",{src:e.unref(o).url},null,8,["src"])],8,["href"]))}}),[["__scopeId","data-v-567c76c1"]]),kp=Q(e.defineComponent({__name:"message-timestamp",props:{currTime:{type:Number,default:0},prevTime:{type:Number,default:0}},setup(t){const n=t,{currTime:o,prevTime:i}=e.toRefs(n),s=e.ref(!1),a=e.ref("");return e.watch((()=>[o.value,i.value]),((e,t)=>{var n,r;(null==e?void 0:e.toString())!==(null==t?void 0:t.toString())&&(a.value=(n=o.value,r=i.value,s.value=!1,n<=0?"":!r||r<=0||n-r>=600?(s.value=!0,kd(1e3*n)):""))}),{immediate:!0}),(t,n)=>e.unref(s)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-timestamp"},e.toDisplayString(e.unref(a)),1)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-21d9a435"]]),Rp=Q(e.defineComponent({__name:"message-video",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},setup(t){const n=t;function o(){const e=encodeURIComponent(n.content.url);uni.navigateTo({url:`../../components/TUIChat/video-play?videoUrl=${e}`})}return(t,i)=>(e.openBlock(),e.createElementBlock("div",{class:"message-video"},[e.createElementVNode("div",{class:"message-video-box",onClick:o},[e.createElementVNode("image",{src:n.content.snapshotUrl,class:"message-video-box"},null,8,["src"]),"success"===n.messageItem.status||1===n.messageItem.progress?(e.openBlock(),e.createBlock(Id,{key:0,class:"video-play",file:e.unref(vd)},null,8,["file"])):e.createCommentVNode("",!0)])]))}}),[["__scopeId","data-v-fc790acb"]]),Lp="/assets/msg-copy.91b797d7.svg";function Ap(e){const t=zl.getData(Sc.APP,"tasks");e in t&&!t[e]&&(t[e]=!0,zl.update(Sc.APP,"tasks",t))}const Op=Q(e.defineComponent({__name:"index",props:{messageItem:{default:()=>({})},isMultipleSelectMode:{type:Boolean,default:!1}},emits:["toggleMultipleSelectMode"],setup(t,{expose:n,emit:o}){const i=o,s=t,a=pp.getFeatureConfig(),r=Yl.TYPES,c=e.ref([{key:"open",text:Wl.t("TUIChat.打开"),iconUrl:Lp,renderCondition(){var e;return!(!a.DownloadFile||!u.value)&&(id&&((null==(e=u.value)?void 0:e.type)===r.MSG_FILE||u.value.type===r.MSG_VIDEO||u.value.type===r.MSG_IMAGE))},clickEvent:function(){var e;let t="";switch(null==(e=u.value)?void 0:e.type){case Yl.TYPES.MSG_FILE:t=u.value.payload.fileUrl;break;case Yl.TYPES.MSG_VIDEO:t=u.value.payload.remoteVideoUrl;break;case Yl.TYPES.MSG_IMAGE:t=u.value.payload.imageInfoArray[0].url}null==window||window.open(t,"_blank")}},{key:"copy",text:Wl.t("TUIChat.复制"),iconUrl:Lp,renderCondition:()=>!(!a.CopyMessage||!u.value)&&u.value.type===r.MSG_TEXT,clickEvent:async function(){var e,t;cd&&(null==be||be.setClipboardData({data:Hd(null==(t=null==(e=u.value)?void 0:e.payload)?void 0:t.text)}))}},{key:"revoke",text:Wl.t("TUIChat.撤回"),iconUrl:"/assets/msg-revoke.a0b46d31.svg",renderCondition:()=>!(!a.RevokeMessage||!u.value)&&("out"===u.value.flow&&"success"===u.value.status),clickEvent:function(){if(!u.value)return;zl.getMessageModel(u.value.ID).revokeMessage().then((()=>{Ap("revokeMessage")})).catch((e=>{if(20016===e.code||10031===e.code){const e=Wl.t("TUIChat.已过撤回时限");op({message:e,type:tp})}}))}},{key:"delete",text:Wl.t("TUIChat.删除"),iconUrl:"/assets/msg-del.8e1884b8.svg",renderCondition:()=>!(!a.DeleteMessage||!u.value)&&"success"===u.value.status,clickEvent:function(){if(!u.value)return;zl.getMessageModel(u.value.ID).deleteMessage()}},{key:"forward",text:Wl.t("TUIChat.转发"),iconUrl:"/assets/msg-forward.b9d14da1.svg",renderCondition:()=>!(!a.ForwardMessage||!u.value)&&"success"===u.value.status,clickEvent:function(){if(!u.value)return;zl.update(Sc.CUSTOM,"singleForwardMessageID",u.value.ID)}},{key:"quote",text:Wl.t("TUIChat.引用"),iconUrl:"/assets/msg-quote.6ed4649b.svg",renderCondition(){if(!a.QuoteMessage||!u.value)return!1;const e=zl.getMessageModel(u.value.ID);return"success"===u.value.status&&!e.getSignalingInfo()},clickEvent:function(){if(!u.value)return;u.value.quoteMessage()}},{key:"translate",text:Wl.t("TUIChat.翻译"),visible:!1,iconUrl:"/assets/translate.a0cfa550.svg",renderCondition:()=>!(!a.TranslateMessage||!u.value)&&("success"===u.value.status&&u.value.type===r.MSG_TEXT),clickEvent:function(){if(!zl.getData(Sc.APP,"enabledTranslationPlugin"))return void op({message:Wl.t("TUIChat.请开通翻译功能"),type:ep});if(!u.value)return;const e=c.value.findIndex((e=>"translate"===e.key));zl.update(Sc.CHAT,"translateTextInfo",{conversationID:u.value.conversationID,messageID:u.value.ID,visible:!c.value[e].visible})}},{key:"convert",text:Wl.t("TUIChat.转文字"),visible:!1,iconUrl:"/assets/convertText_zh.ea05cc29.svg",renderCondition:()=>!(!a.VoiceToText||!u.value)&&("success"===u.value.status&&u.value.type===r.MSG_AUDIO),clickEvent:function(){if(!zl.getData(Sc.APP,"enabledVoiceToText"))return void op({message:Wl.t("TUIChat.请开通语音转文字功能")});if(!u.value)return;const e=c.value.findIndex((e=>"convert"===e.key));zl.update(Sc.CHAT,"voiceToTextInfo",{conversationID:u.value.conversationID,messageID:u.value.ID,visible:!c.value[e].visible})}},{key:"multi-select",text:Wl.t("TUIChat.多选"),iconUrl:"/assets/multiple-select.63011d60.svg",renderCondition:()=>!(!a.MultiSelection||!u.value)&&"success"===u.value.status,clickEvent:function(){i("toggleMultipleSelectMode")}}]),u=e.ref(),l=e.ref();e.onMounted((()=>{zl.watch(Sc.CHAT,{translateTextInfo:p,voiceToTextInfo:h})})),e.onUnmounted((()=>{zl.unwatch(Sc.CHAT,{translateTextInfo:p,voiceToTextInfo:h})})),e.watchEffect((()=>{u.value=zl.getMessageModel(s.messageItem.ID)}));const d=e.computed((()=>{for(let e=0;e<c.value.length;++e)if(c.value[e].renderCondition())return!1;return!0}));function p(e){if(void 0===e)return;const t=e.get(s.messageItem.conversationID)||[],n=c.value.findIndex((e=>"translate"===e.key));for(let o=0;o<t.length;++o){const{messageID:e,visible:i}=t[o];if(e===s.messageItem.ID)return c.value[n].text=Wl.t(i?"TUIChat.隐藏":"TUIChat.翻译"),void(c.value[n].visible=!!i)}c.value[n].text=Wl.t("TUIChat.翻译")}function h(e){if(void 0===e)return;const t=e.get(s.messageItem.conversationID)||[],n=c.value.findIndex((e=>"convert"===e.key));for(let o=0;o<t.length;++o){const{messageID:e,visible:i}=t[o];if(e===s.messageItem.ID)return c.value[n].text=Wl.t(i?"TUIChat.隐藏":"TUIChat.转文字"),void(c.value[n].visible=!!i)}c.value[n].text=Wl.t("TUIChat.转文字")}return n({messageToolDom:l}),(t,n)=>e.unref(d)||t.messageItem.hasRiskContent?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,ref_key:"messageToolDom",ref:l,class:e.normalizeClass(["dialog-item",e.unref(id)?"dialog-item-web":"dialog-item-h5"])},[e.unref(a).EmojiReaction?e.renderSlot(t.$slots,"TUIEmojiPlugin",{key:0},void 0,!0):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["dialog-item-list",e.unref(id)?"dialog-item-list-web":"dialog-item-list-h5"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c),((t,n)=>(e.openBlock(),e.createElementBlock(e.Fragment,null,[t.renderCondition()?(e.openBlock(),e.createElementBlock("div",{key:t.key,class:"list-item",onClick:e=>function(e){c.value[e].clickEvent()}(n),onMousedown:e=>{t.key}},[e.createVNode(Id,{file:t.iconUrl,size:"15px"},null,8,["file"]),e.createElementVNode("span",{class:"list-item-text"},e.toDisplayString(t.text),1)],40,["onClick","onMousedown"])):e.createCommentVNode("",!0)],64)))),256))],2)],2))}}),[["__scopeId","data-v-99698281"]]),Np=Q(e.defineComponent({__name:"message-revoked",props:{isEdit:{type:Boolean,default:()=>!1},messageItem:{type:Object,default:()=>({})}},emits:["messageEdit"],setup(t,{emit:n}){const o=t,i=e.ref(),s=e.ref(!1),a=n;e.watchEffect((()=>{i.value=o.messageItem,s.value=o.isEdit}));const r=()=>{a("messageEdit")};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"revoke"},["in"===e.unref(i).flow?(e.openBlock(),e.createElementBlock("span",{key:0},e.toDisplayString(e.unref(i).nick||e.unref(i).from),1)):e.unref(i).from===e.unref(i).revoker?(e.openBlock(),e.createElementBlock("span",{key:1},e.toDisplayString(e.unref(Wl).t("TUIChat.您")),1)):(e.openBlock(),e.createElementBlock("span",{key:2},e.toDisplayString(e.unref(i).revoker),1)),e.createElementVNode("span",null,e.toDisplayString(e.unref(Wl).t("TUIChat.撤回了一条消息")),1),"out"===e.unref(i).flow&&e.unref(s)?(e.openBlock(),e.createElementBlock("span",{key:3,class:"edit",onClick:r},e.toDisplayString(e.unref(Wl).t("TUIChat.重新编辑")),1)):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-f6b0593d"]]);function Pp(e){var t;const n=od(null==(t=null==e?void 0:e.payload)?void 0:t.data);if(1===(null==n?void 0:n.businessID)&&(null==n?void 0:n.data)){if("av_call"===od(n.data).businessID)return!0}return!1}function bp(e){var t;const n=od(null==(t=null==e?void 0:e.payload)?void 0:t.data);return"group_room_message"===(null==n?void 0:n.businessID)}function Up(e){return e.type===Yl.TYPES.MSG_CUSTOM&&(Pp(e)||bp(e)||function(e){var t;const n=od(null==(t=null==e?void 0:e.payload)?void 0:t.data);return"ROOM_INVITE_ACTION"===(null==n?void 0:n.businessID)||"tuikit_engine_room"===(null==n?void 0:n.businessID)}(e))}const Gp=e.defineComponent({__name:"message-plugin-layout",props:{message:{default:()=>({})},showStyle:{default:""},bubbleClassNameList:{default:()=>[]},blinkMessageIDList:{default:()=>[]}},emits:["resendMessage","handleToggleMessageItem","handleH5LongPress"],setup(t,{emit:n}){const o=t,i=n,s=e.computed((()=>{var e;return zl.getMessageModel(null==(e=o.message)?void 0:e.ID)})),a=(e,t,n=!1)=>{i("handleToggleMessageItem",e,t,n)},r=(e,t,n)=>{i("handleH5LongPress",e,t,n)};return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"message-plugin"},["tip"===o.showStyle?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-plugin-tip"},[e.renderSlot(t.$slots,"messageTip",{},void 0,!0)])):"bubble"===o.showStyle?(e.openBlock(),e.createElementBlock("div",{key:1,class:"message-plugin-bubble-content",onLongpress:n[1]||(n[1]=t=>a(t,e.unref(s),!0)),onContextmenu:n[2]||(n[2]=e.withModifiers((t=>a(t,e.unref(s))),["prevent","right"])),onTouchstart:n[3]||(n[3]=t=>r(t,e.unref(s),"touchstart")),onTouchend:n[4]||(n[4]=t=>r(t,e.unref(s),"touchend")),onMouseover:n[5]||(n[5]=t=>r(t,e.unref(s),"touchend"))},[e.createVNode(Sp,{messageItem:e.unref(s),content:e.unref(s).getMessageContent(),blinkMessageIDList:o.blinkMessageIDList,classNameList:o.bubbleClassNameList,onResendMessage:n[0]||(n[0]=t=>{return n=e.unref(s),void i("resendMessage",n);var n})},{messageElement:e.withCtx((()=>[e.unref(cd)?e.createCommentVNode("",!0):e.renderSlot(t.$slots,"messageBubble",{key:0},void 0,!0)])),default:e.withCtx((()=>[e.unref(cd)?e.renderSlot(t.$slots,"messageBubble",{key:0},void 0,!0):e.createCommentVNode("",!0)])),_:3},8,["messageItem","content","blinkMessageIDList","classNameList"])],32)):e.createCommentVNode("",!0)]))}}),wp=Q(Gp,[["__scopeId","data-v-eead6e2c"]]),Fp=Q(e.defineComponent({__name:"message-call-group",props:{message:{default:()=>({})},signalingInfo:{default:()=>({})},customContent:{default:()=>({})},blinkMessageIDList:{default:()=>[]}},setup(t){const n=t,o=Yl.TYPES,i=e.computed((()=>!!n.signalingInfo)),s=e.computed((()=>{var e;return null==(e=n.message)?void 0:e.conversationType})),a=e.computed((()=>{var e;return null==(e=n.customContent)?void 0:e.custom})),r=e.computed((()=>{var e,t;return!!(null==(e=n.message)?void 0:e.ID)&&(null==(t=n.blinkMessageIDList)?void 0:t.includes(n.message.ID))}));return(t,n)=>e.unref(i)&&e.unref(s)===e.unref(o).CONV_GROUP?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"blink-text":e.unref(r)})},e.toDisplayString(e.unref(a)),3)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-c556bced"]]),xp={androidInfo:{sound:"private_ring.mp3",XiaoMiChannelID:"high_custom_1",OPPOChannelID:"tuikit"},apnsInfo:{sound:"01.caf",image:"https://web.sdk.qcloud.com/im/demo/latest/faviconnew.png"}},Vp={title:"call",description:"you have a call",androidSound:"private_ring",androidOPPOChannelID:"tuikit",iOSSound:"01.caf"},qp={[Yl.TYPES.MSG_TEXT]:"[文本]",[Yl.TYPES.MSG_FACE]:"[动画表情]",[Yl.TYPES.MSG_IMAGE]:"[图片]",[Yl.TYPES.MSG_FILE]:"[文件]",[Yl.TYPES.MSG_AUDIO]:"[语音]",[Yl.TYPES.MSG_VIDEO]:"[视频]",[Yl.TYPES.MSG_LOCATION]:"[地理位置]",[Yl.TYPES.MSG_MERGER]:"[聊天记录]",[Yl.TYPES.MSG_CUSTOM]:"[自定义消息]"};var Bp=(e=>(e.CHAT="chat",e.CALL="call",e))(Bp||{});const Hp=((s=class{constructor(){this.name="OfflinePushInfoManager",this.offlinePushInfo={},this.offlinePushInfo={[Bp.CHAT]:xp,[Bp.CALL]:Vp}}static getInstance(){return s.instance||(s.instance=new s),s.instance}getOfflinePushInfo(e){return Object.values(Bp).includes(e)?this.offlinePushInfo[e]:(_("error","at src/roomkit/TUIKit/components/TUIChat/offlinePushInfoManager/offlinePushInfoManager.ts:32",`${this.name} getOfflinePushInfo scene: ${e} is invalid`),null)}genTitle(e,t){let n=null==e?void 0:e.getShowName();return e.type===Yl.TYPES.CONV_C2C&&(n=(null==t?void 0:t.nick)||(null==t?void 0:t.userID)),n}genDesc(e,t){let n="";return e===Yl.TYPES.MSG_TEXT&&(n=Hd(t.text)),e===Yl.TYPES.MSG_CUSTOM&&(n=t.description),n||Wl.t(`TUIChat.${qp[e]}`)}create(e){var t;const{conversation:n,messageType:o="",payload:i={}}=e||{},s=zl.getData(Sc.USER,"userProfile"),a={sender:n.type===Yl.TYPES.CONV_GROUP?null==(t=n.groupProfile)?void 0:t.groupID:null==s?void 0:s.userID,nickName:null==s?void 0:s.nick,chatType:n.type===Yl.TYPES.CONV_GROUP?2:1,version:1,action:1};return{title:this.genTitle(n,s),description:this.genDesc(o,i),extension:JSON.stringify({entity:a}),...this.offlinePushInfo[Bp.CHAT]}}}).instance=null,s).getInstance(),jp=Q(e.defineComponent({__name:"message-call-c2c",props:{message:{type:Object,default:()=>({})},signalingInfo:{type:Object,default:()=>({})},customContent:{type:Object,default:()=>({})}},setup(t){const n=t,o=e.ref(Yl.TYPES),i=e.computed((()=>null!=n.signalingInfo)),s=e.computed((()=>{var e,t;switch(null==(t=od(null==(e=n.signalingInfo)?void 0:e.data))?void 0:t.call_type){case 1:return{type:1,icon:"/assets/call-voice.f8912d47.svg"};case 2:return{type:2,icon:"/assets/call-video.6c7799e9.svg"}}return{type:0,icon:""}})),a=e.computed((()=>{var e;return null==(e=n.message)?void 0:e.conversationType})),r=e.computed((()=>{var e;return null==(e=n.customContent)?void 0:e.custom})),c=()=>{var e,t,o,i;if(a.value===Yl.TYPES.CONV_C2C){const a="out"===(null==(e=n.message)?void 0:e.flow)?null==(t=n.message)?void 0:t.to:null==(o=n.message)?void 0:o.from;$.callService({serviceName:b.TUICalling.SERVICE.NAME,method:b.TUICalling.SERVICE.METHOD.START_CALL,params:{userIDList:[a],type:null==(i=null==s?void 0:s.value)?void 0:i.type,callParams:{offlinePushInfo:Hp.getOfflinePushInfo(Bp.CALL)}}})}};return(n,u)=>e.unref(i)&&e.unref(a)===e.unref(o).CONV_C2C?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["call",["call-"+e.unref(a),"out"===t.message.flow&&"call-reverse"]]),onClick:c},[e.createElementVNode("div",{class:e.normalizeClass(["icon","out"===t.message.flow&&2===e.unref(s).type&&"icon-reverse"])},[e.createVNode(Id,{file:e.unref(s).icon},null,8,["file"])],2),e.createElementVNode("span",{class:"call-content"},e.toDisplayString(e.unref(r)),1)],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-f08ee5af"]]),Kp=Q(e.defineComponent({__name:"message-customer-service",props:{message:{default:()=>({})}},setup:e=>(e,t)=>null}),[["__scopeId","data-v-8f24384c"]]),Yp=Q(e.defineComponent({__name:"message-room-default",props:{message:{default:()=>({})}},setup(t){const n=t;return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["room-default",e.unref(cd)&&"room-default-uni","in"===n.message.flow?"room-default-in":"room-default-out"])},e.toDisplayString(e.unref(Wl).t("message.custom.自定义消息")),3))}}),[["__scopeId","data-v-31feeaed"]]),zp=e.defineComponent({__name:"message-plugin",props:{message:{default:()=>({})},blinkMessageIDList:{default:()=>[]}},emits:["resendMessage","handleToggleMessageItem","handleH5LongPress"],setup(t,{emit:n}){const o=t,i=n,s=e.computed((()=>zl.getMessageModel(o.message.ID))),a=e.computed((()=>{var e;return null==(e=null==s?void 0:s.value)?void 0:e.getSignalingInfo()})),r=e.computed((()=>{var e;return null==(e=null==s?void 0:s.value)?void 0:e.getMessageContent()})),c=e.computed((()=>{var e;let t={pluginType:"",showStyle:""};return Pp(s.value)?t={pluginType:"call",showStyle:(null==(e=s.value)?void 0:e.conversationType)===Yl.TYPES.CONV_GROUP?"tip":"bubble"}:bp(s.value)&&(t={pluginType:"room",showStyle:"bubble"}),t})),u=e=>{i("resendMessage",e)},l=(e,t,n=!1)=>{i("handleToggleMessageItem",e,t,n)},d=(e,t,n)=>{i("handleH5LongPress",e,t,n)};return(t,n)=>(e.openBlock(),e.createBlock(wp,{message:o.message,"show-style":e.unref(c).showStyle,"bubble-class-name-list":["room"===e.unref(c).pluginType?"message-bubble-room":""],onResendMessage:u,onHandleToggleMessageItem:l,onHandleH5LongPress:d},{messageTip:e.withCtx((()=>[e.createVNode(Fp,{message:o.message,"signaling-info":e.unref(a),"custom-content":e.unref(r),"blink-message-i-d-list":o.blinkMessageIDList},null,8,["message","signaling-info","custom-content","blink-message-i-d-list"])])),messageBubble:e.withCtx((()=>["call"===e.unref(c).pluginType?(e.openBlock(),e.createBlock(jp,{key:0,message:o.message,"signaling-info":e.unref(a),"custom-content":e.unref(r)},null,8,["message","signaling-info","custom-content"])):e.createCommentVNode("",!0),"customer"===e.unref(c).pluginType?(e.openBlock(),e.createBlock(Kp,{key:1,message:o.message},null,8,["message"])):e.createCommentVNode("",!0),"room"===e.unref(c).pluginType?(e.openBlock(),e.createBlock(Yp,{key:2,message:o.message},null,8,["message"])):e.createCommentVNode("",!0)])),_:1},8,["message","show-style","bubble-class-name-list"]))}}),Wp=Q(zp,[["__scopeId","data-v-63443820"]]),Jp="/assets/icon-close.00e2ef94.svg",$p=Q(e.defineComponent({__name:"index",props:{isFetching:{type:Boolean,default:!1},isTerminateObserve:{type:Boolean,default:!1}},emits:["onExposed"],setup(t,{emit:n}){var o;const i=n,s=t;let a=null;const r=e.ref(),c=(null==(o=e.getCurrentInstance())?void 0:o.proxy)||e.getCurrentInstance();return e.onMounted((()=>{s.isTerminateObserve||(cd?(a=uni.createIntersectionObserver(c).relativeToViewport(),a.observe(".fetch-more-block",(()=>{i("onExposed")}))):(a=new IntersectionObserver((([e])=>{e.isIntersecting&&i("onExposed")}),{threshold:1}),r.value&&a.observe(r.value)))})),e.onUnmounted((()=>{a&&(a.disconnect(),a=null)})),e.watch((()=>s.isTerminateObserve),(e=>{a&&(e?a.disconnect():r.value&&(a.disconnect(),cd?a.observe(".fetch-more-block",(()=>{i("onExposed")})):a.observe(r.value)))})),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"selfDomRef",ref:r,class:"fetch-more-block"},[s.isFetching?e.renderSlot(t.$slots,"fetching",{key:0},(()=>[e.createElementVNode("div",null,e.toDisplayString(e.unref(Wl).t("TUIChat.正在加载")),1)]),!0):e.renderSlot(t.$slots,"fetchEnd",{key:1},(()=>[e.createElementVNode("div",null,e.toDisplayString(e.unref(Wl).t("TUIChat.加载结束")),1)]),!0)],512))}}),[["__scopeId","data-v-9f7e7505"]]),Xp=Q(e.defineComponent({__name:"index",props:{message:{default:()=>({})}},emits:["setReadReceiptPanelVisible"],setup(t,{emit:n}){const o=n,i=t;let s="",a="";const r=["unread","read"],c={unread:!1,read:!1,close:!1},u=e.ref(!1),l=e.ref(!1),d=e.ref(!1),p=e.ref(!1),h=e.ref("unread"),g=e.ref({read:{tabName:Wl.t("TUIChat.已读"),count:void 0,memberList:[]},unread:{tabName:Wl.t("TUIChat.未读"),count:void 0,memberList:[]},close:{tabName:Wl.t("TUIChat.关闭"),count:void 0,memberList:[]}});async function _(e="all"){const t=zl.getMessageModel(i.message.ID);let n={},o={};"all"!==e&&"unread"!==e||(n=await Xl.getGroupMessageReadMemberList({message:t,filter:1,cursor:s,count:100}),n&&(s=n.data.cursor,n.data.isCompleted&&(c.unread=!0))),"all"!==e&&"read"!==e||(o=await Xl.getGroupMessageReadMemberList({message:t,filter:0,cursor:a,count:100}),o&&(a=o.data.cursor,o.data.isCompleted&&(c.read=!0)));const{unreadCount:r,readCount:u}=t.readReceiptInfo;return{unreadResult:{count:r,...n.data},readResult:{count:u,...o.data}}}async function f(){if(!c[h.value]&&!u.value&&(u.value=!0,"unread"===h.value||"read"===h.value)){const{unreadResult:e,readResult:t}=await _(h.value);v();try{g.value.unread.memberList=g.value.unread.memberList.concat(e.unreadUserInfoList||[]),g.value.read.memberList=g.value.read.memberList.concat(t.readUserInfoList||[])}finally{u.value=!1}}}async function m(){s="",a="",p.value=!1,c.unread=!1,c.read=!1;const{unreadResult:e,readResult:t}=await _("all");v(),y("read",t.count,t.readUserInfoList),y("unread",e.count,e.unreadUserInfoList),y("close")}function v(){c.read&&c.unread&&(p.value=!0)}function y(e,t,n){g.value[e].count=t,g.value[e].memberList=n||[]}function I(){l.value=!0,setTimeout((()=>{o("setReadReceiptPanelVisible",!1)}),200)}return e.onMounted((async()=>{await m(),e.nextTick((()=>{d.value=!0}))})),e.watch((()=>i.message.readReceiptInfo.readCount),(()=>{m()})),(t,n)=>(e.openBlock(),e.createBlock(Ld,{maskColor:"transparent",onOnOverlayClick:I},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass({"read-receipt-panel":!0,"read-receipt-panel-mobile":e.unref(ud),"read-receipt-panel-uni":e.unref(cd),"read-receipt-panel-close-mobile":e.unref(ud)&&e.unref(l)})},[e.createElementVNode("div",{class:"header"},[e.createElementVNode("div",{class:"header-text"},e.toDisplayString(e.unref(Wl).t("TUIChat.消息详情")),1),e.createElementVNode("div",{class:"header-close-icon"},[e.createVNode(Id,{size:"12px",hotAreaSize:"8",file:e.unref(Jp),onOnClick:I},null,8,["file"])])]),e.createElementVNode("div",{class:"read-status-counter-container"},[(e.openBlock(),e.createElementBlock(e.Fragment,null,e.renderList(r,(t=>e.createElementVNode("div",{key:t,class:e.normalizeClass({"read-status-counter":!0,active:t===e.unref(h)}),onClick:e=>function(e){h.value=e}(t)},[e.createElementVNode("div",{class:"status-text"},e.toDisplayString(e.unref(g)[t].tabName),1),e.createElementVNode("div",{class:"status-count"},e.toDisplayString(void 0===e.unref(g)[t].count?"":e.unref(g)[t].count),1)],10,["onClick"]))),64))]),e.createElementVNode("div",{class:"read-status-member-list"},[0===e.unref(g)[e.unref(h)].count&&e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"empty-list-tip"}," - "+e.toDisplayString(e.unref(Wl).t("TUIChat.空"))+" - ",1)):e.unref(d)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},["unread"===e.unref(h)?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:0},e.renderList(e.unref(g)[e.unref(h)].memberList,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.userID,class:"read-status-member-container"},[e.createVNode(Cd,{class:"read-status-avatar",useSkeletonAnimation:"",url:t.avatar||""},null,8,["url"]),e.createElementVNode("div",{class:"username"},e.toDisplayString(t.nick||t.userID),1)])))),128)):e.createCommentVNode("",!0),"read"===e.unref(h)?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:1},e.renderList(e.unref(g)[e.unref(h)].memberList,(t=>(e.openBlock(),e.createElementBlock("div",{key:t.userID,class:"read-status-member-container"},[e.createVNode(Cd,{class:"read-status-avatar",useSkeletonAnimation:"",url:t.avatar},null,8,["url"]),e.createElementVNode("div",{class:"username"},e.toDisplayString(t.nick||t.userID),1)])))),128)):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:2,class:"fetch-more-container"},[e.createVNode($p,{isFetching:e.unref(u),isTerminateObserve:e.unref(p),onOnExposed:f},null,8,["isFetching","isTerminateObserve"])])):e.createCommentVNode("",!0)])],2)])),_:1}))}}),[["__scopeId","data-v-d9ac0a05"]]),Zp=e.defineComponent({__name:"index",emits:["scrollToLatestMessage"],setup(t,{expose:n,emit:o}){const i=o,s=e.ref([]),a=e.ref(""),r=e.ref(0),c=e.ref(0),u=e.ref(!1),l=e.ref(!1),d=e.ref(!1),p=e.computed((()=>c.value?`${c.value}${Wl.t("TUIChat.条新消息")}`:Wl.t("TUIChat.回到最新位置")));function h(e){var t,n;s.value=e||[];const o=null==(n=s.value)?void 0:n[(null==(t=s.value)?void 0:t.length)-1];l.value=!!(o&&(null==o?void 0:o.time)<(null==r?void 0:r.value))}function g(e){Array.isArray(e)&&d.value&&e.forEach((e=>{!e||e.conversationID!==a.value||e.isDeleted||e.isRevoked||function(e){var t,n;return"user_typing_status"===(null==(n=od(null==(t=e.payload)?void 0:t.data))?void 0:n.businessID)}(e)||(c.value+=1)}))}function _(e){var t;(null==e?void 0:e.conversationID)!==a.value&&f(),a.value=(null==e?void 0:e.conversationID)||"",r.value=(null==(t=null==e?void 0:e.lastMessage)?void 0:t.lastTime)||0}function f(){c.value=0}function m(){void 0!==zl.getData(Sc.CHAT,"messageSource")&&zl.update(Sc.CHAT,"messageSource",void 0),f(),i("scrollToLatestMessage")}return e.watch((()=>[u.value,l.value]),(()=>{d.value=u.value||l.value,d.value||f()}),{immediate:!0}),e.onMounted((()=>{zl.watch(Sc.CHAT,{messageList:h,newMessageList:g}),zl.watch(Sc.CONV,{currentConversation:_})})),e.onUnmounted((()=>{zl.unwatch(Sc.CHAT,{messageList:h,newMessageList:g}),zl.unwatch(Sc.CONV,{currentConversation:_})})),n({judgeScrollOverOneScreen:async function(e){var t,n,o,i,s;if(e.target)try{const{height:a}=await We(`#${null==(t=e.target)?void 0:t.id}`,"messageList")||{},r=(null==(n=e.target)?void 0:n.scrollHeight)||(null==(o=e.detail)?void 0:o.scrollHeight);if(r-((null==(i=e.target)?void 0:i.scrollTop)||(null==(s=e.detail)?void 0:s.scrollTop)||0)>2*a)return void(u.value=!0);u.value=!1}catch(a){u.value=!1}},isScrollButtonVisible:d}),(t,n)=>e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"scroll-button",onClick:m},[e.createVNode(Id,{width:"10px",height:"10px",file:e.unref("/assets/double-arrow.a1a15b8b.svg")},null,8,["file"]),e.createElementVNode("div",{class:"scroll-button-text"},e.toDisplayString(e.unref(p)),1)])):e.createCommentVNode("",!0)}}),Qp=Q(Zp,[["__scopeId","data-v-b4319f4a"]]),eh=Q(e.defineComponent({__name:"index",props:{show:{type:Boolean,default:!1},isHeaderShow:{type:Boolean,default:!0},isFooterShow:{type:Boolean,default:!0},background:{type:Boolean,default:!0},title:{type:String,default:""},center:{type:Boolean,default:!1}},emits:["update:show","submit"],setup(t,{emit:n}){const o="outside",i="inside",s=t,a=e.ref(!1),r=e.ref(!0),c=e.ref(!0),u=e.ref(!0),l=e.ref("");e.watchEffect((()=>{a.value=s.show,l.value=s.title,r.value=s.isHeaderShow,c.value=s.isFooterShow,u.value=s.background}));const d=n,p=e=>{e===o&&h()},h=()=>{a.value=!a.value,d("update:show",a.value)},g=()=>{d("submit"),h()};return(n,s)=>e.unref(a)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["dialog",[e.unref(id)?"":"dialog-h5",t.center?"center":""]]),onClick:s[1]||(s[1]=e.withModifiers((e=>p(o)),["stop","prevent"]))},[e.createElementVNode("main",{class:e.normalizeClass(["dialog-main",[e.unref(u)?"":"dialog-main-back"]]),onClick:s[0]||(s[0]=e.withModifiers((e=>p(i)),["stop","prevent"]))},[e.unref(r)?(e.openBlock(),e.createElementBlock("header",{key:0,class:"dialog-main-header"},[e.createElementVNode("h1",{class:"dialog-main-title"},e.toDisplayString(e.unref(l)),1),e.createElementVNode("i",{class:"icon icon-close",onClick:h})])):e.createCommentVNode("",!0),e.createElementVNode("div",{class:e.normalizeClass(["dialog-main-content",[e.unref(cd)&&e.unref(sd)?"dialog-main-content-uniapp":""]])},[e.renderSlot(n.$slots,"default",{},void 0,!0)],2),e.unref(c)?(e.openBlock(),e.createElementBlock("footer",{key:1,class:"dialog-main-footer"},[e.createElementVNode("button",{class:"btn btn-cancel",onClick:h},e.toDisplayString(e.unref(Wl).t("component.取消")),1),e.createElementVNode("button",{class:"btn btn-default",onClick:g},e.toDisplayString(e.unref(Wl).t("component.确定")),1)])):e.createCommentVNode("",!0)],2)],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-b4966d7a"]]),th=Q(e.defineComponent({__name:"index",props:{content:{default:()=>({})},messageItem:{default:()=>({})}},setup(t){const n=t;return(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"progress-message"},[e.renderSlot(t.$slots,"default",{},void 0,!0),"unSend"===n.messageItem.status&&n.messageItem.progress<1?(e.openBlock(),e.createElementBlock("div",{key:0,class:"progress-container"},[e.unref(cd)?(e.openBlock(),e.createElementBlock("progress",{key:1,activeColor:"#006EFF",class:"progress-common",percent:Math.round(100*n.messageItem.progress)},null,8,["percent"])):(e.openBlock(),e.createElementBlock("progress",{key:0,class:"progress",value:n.messageItem.progress,max:"1"},null,8,["value"]))])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-a066045d"]]),nh="Expected a function";function oh(e,t,n){let o=!0,i=!0;if("function"!=typeof e)throw new TypeError(nh);return n&&ih(n)&&(o="leading"in n?!!n.leading:o,i="trailing"in n?!!n.trailing:i),function(e,t,n){let o,i,s,a,r,c,u=0,l=!1,d=!1,p=!0;if("function"!=typeof e)throw new TypeError(nh);t=t||0,n&&ih(n)&&(l=!!n.leading,d="maxWait"in n,s=d?Math.max(n.maxWait||0,t):s,p="trailing"in n?!!n.trailing:p);function h(t){const n=o,s=i;return o=i=void 0,u=t,a=e.apply(s,n),a}function g(e){return u=e,r=setTimeout(m,t),l?h(e):a}function _(e){const n=e-u,o=t-(e-c);return d?Math.min(o,s-n):o}function f(e){const n=e-c;return void 0===c||n>=t||n<0||d&&e-u>=s}function m(){const e=Date.now();if(f(e))return v(e);r=setTimeout(m,_(e))}function v(e){return r=void 0,p&&o?h(e):(o=i=void 0,a)}function y(){void 0!==r&&clearTimeout(r),u=0,o=c=i=r=void 0}function I(){return void 0===r?a:v(Date.now())}function M(){const e=Date.now(),n=f(e);if(o=arguments,i=this,c=e,n){if(void 0===r)return g(c);if(d)return clearTimeout(r),r=setTimeout(m,t),h(c)}return void 0===r&&(r=setTimeout(m,t)),a}return M.cancel=y,M.flush=I,M}(e,t,{leading:o,maxWait:t,trailing:i})}function ih(e){const t=typeof e;return null!=e&&("object"==t||"function"==t)}const sh=class e{constructor(){this.chatStorage=null}static getInstance(){return e.instance||(e.instance=new e),e.instance}getChatStorage(e){if(this.chatStorage||(this.chatStorage=this.getChatStorageFromLocalStorage()),e)return this.chatStorage[e];throw new Error("No key provided")}setChatStorage(t,n){this.chatStorage||(this.chatStorage=this.getChatStorageFromLocalStorage()),this.chatStorage[t]=n;try{cd?be.setStorageSync(e.CHAT_STORAGE_KEY,JSON.stringify(this.chatStorage)):localStorage.setItem(e.CHAT_STORAGE_KEY,JSON.stringify(this.chatStorage))}catch(o){throw new Error("Fail to set chat storage")}}getChatStorageFromLocalStorage(){let t="";if(t=cd?be.getStorageSync(e.CHAT_STORAGE_KEY)||"":localStorage.getItem(e.CHAT_STORAGE_KEY)||"",!t)return{};try{this.chatStorage=JSON.parse(t)}catch(n){this.chatStorage={}}return this.chatStorage}};sh.instance=null,sh.CHAT_STORAGE_KEY="TUI_CHAT_STORAGE";const ah=sh.getInstance(),rh=e.defineComponent({__name:"index",props:{isGroup:{type:Boolean,default:!1},groupID:{default:""},isNotInGroup:{type:Boolean,default:!1},isMultipleSelectMode:{type:Boolean,default:!1}},emits:["closeInputToolBar","handleEditor","toggleMultipleSelectMode"],setup(t,{expose:n,emit:o}){var i;const s=o,a=t;let r,c=0,u=null;const l=new Set,d=zl.getData(Sc.APP,"isOfficial"),p=(null==(i=e.getCurrentInstance())?void 0:i.proxy)||e.getCurrentInstance(),h=e.ref(),g=e.ref([]),_=e.ref(!1),f=e.ref(""),m=e.ref(""),v=e.ref(5e3),y=e.ref(Yl.TYPES),I=e.ref(!1),M=e.ref(!1),C=e.ref([]),T=e.ref(),E=e.ref(),S=e.ref(""),D=e.ref(!1),k=e.ref(),R=e.ref({}),L=e.ref(""),A=e.ref(),O=e.ref(!1),N=e.ref(!1),P=e.ref(),b=()=>{v.value+=300;const e=setTimeout((()=>{v.value+=1,clearTimeout(e)}),300)},U=e=>{if(f.value=e,Sd()){const{groupProfile:t}=zl.getConversationModel(e)||{};r=null==t?void 0:t.type}Object.keys(R.value).length>0&&ah.setChatStorage("audioPlayedMapping",R.value)};e.onMounted((()=>{R.value=ah.getChatStorage("audioPlayedMapping")||{},zl.watch(Sc.CHAT,{messageList:F,messageSource:V,isCompleted:B}),zl.watch(Sc.CONV,{currentConversationID:U}),function(e,t){ze.set(e,t)}("messageList",p),uni.$on("scroll-to-bottom",x)})),e.onUnmounted((()=>{zl.unwatch(Sc.CHAT,{messageList:F,isCompleted:B}),zl.unwatch(Sc.CONV,{currentConversationID:U}),null==u||u.disconnect(),u=null,uni.$off("scroll-to-bottom"),Object.keys(R.value).length>0&&ah.setChatStorage("audioPlayedMapping",R.value)}));const G=oh((function(e){var t;null==(t=E.value)||t.judgeScrollOverOneScreen(e)}),500,{leading:!0});function w(e,t){(null==t?void 0:t.newAudioSrc)&&(L.value=t.newAudioSrc)}async function F(t){var n,o,i;null==u||u.disconnect(),h.value=t.filter((e=>!e.isDeleted)).map((e=>(e.vueForRenderKey=`${e.ID}`,e)));const s=null==(o=h.value)?void 0:o[(null==(n=h.value)?void 0:n.length)-1];T.value?q(T.value):I.value||(null==(i=E.value)?void 0:i.isScrollButtonVisible)&&"in"===(null==s?void 0:s.flow)||e.nextTick((()=>{b()})),Sd()&&e.nextTick((()=>async function(){if(!h.value||0===h.value.length)return;if(r===y.value.GRP_AVCHATROOM||r===y.value.GRP_COMMUNITY)return;null==u||u.disconnect(),u=uni.createIntersectionObserver(p,{threshold:[.7],observeAll:!0}).relativeTo("#messageScrollList",{top:-70}),null==u||u.observe(".message-li.in .message-bubble-container",(e=>{var t;if(l.has(e.id))return;const n=h.value.find((t=>e.id.indexOf(t.ID)>-1));n&&n.needReadReceipt&&"in"===n.flow&&!(null==(t=n.readReceiptInfo)?void 0:t.isPeerRead)&&(Xl.sendMessageReadReceipt([n]),l.add(e.id))}))}()))}async function x(){try{const{scrollHeight:e}=await Je("#messageScrollList","messageList");e?v.value===e?v.value=e+1:v.value=e:b()}catch(e){b()}}async function V(e){T.value=e,q(T.value)}function q(t){var n;(null==(n=h.value)?void 0:n.some((e=>(null==e?void 0:e.ID)===(null==t?void 0:t.ID))))&&e.nextTick((async()=>{await async function(e){const t=e.ID,n=h.value&&h.value.some((e=>e.ID===t));if(t&&n){const e=setTimeout((async()=>{try{const n=await We("#messageScrollList","messageList"),o=await We("#tui-"+t,"messageList"),{scrollTop:i}=await Je("#messageScrollList","messageList");J(o.top+i-n.top-c++%2),clearTimeout(e)}catch(n){}}),500)}else op({message:Wl.t("TUIChat.无法定位到原消息"),type:ep})}(t),await W(null==t?void 0:t.ID),T.value=void 0}))}function B(e){_.value=e}const H=()=>{var t,n;I.value=!0;const o=(null==(n=null==(t=h.value)?void 0:t[0])?void 0:n.ID)||"";Xl.getMessageList().then((()=>{e.nextTick((()=>{S.value=o;const e=setTimeout((()=>{S.value="",I.value=!1,clearTimeout(e)}),500)}))}))},j=(e,t,n,o=!1)=>{a.isMultipleSelectMode||a.isNotInGroup||(o&&(M.value=!0),m.value=t.ID)};let K;const Y=(e,t,n,o)=>{if(!a.isMultipleSelectMode&&!a.isNotInGroup&&sd)switch(o){case"touchstart":K=setTimeout(i,500);break;case"touchend":clearTimeout(K),setTimeout((()=>{M.value=!1}),200)}function i(){clearTimeout(K),j(0,t,0,!0)}},z=e=>{N.value=!0,P.value=e};function W(e){return new Promise((t=>{if(C.value.indexOf(e)<0){C.value.push(e);const n=setTimeout((()=>{C.value.splice(C.value.indexOf(e),1),clearTimeout(n),t()}),3e3)}}))}function J(e){v.value=e}function $(e,t){e&&a.isNotInGroup||(A.value=e?t:void 0,O.value=e)}function X(){s("closeInputToolBar")}function Z({type:e,messageID:t}){"clearAll"===e?g.value=[]:"add"!==e||g.value.includes(t)?"remove"===e&&(g.value=g.value.filter((e=>e!==t))):g.value.push(t)}function Q(e){k.value=e,D.value=!0}function ee(e){R.value[e]=!0}return e.watch((()=>a.isMultipleSelectMode),(e=>{e||Z({type:"clearAll",messageID:""})})),n({oneByOneForwardMessage:function(){zl.update(Sc.CUSTOM,"multipleForwardMessageID",{isMergeForward:!1,messageIDList:g.value})},mergeForwardMessage:function(){zl.update(Sc.CUSTOM,"multipleForwardMessageID",{isMergeForward:!0,messageIDList:g.value})},scrollToLatestMessage:x}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"tui-chat":!0,"tui-chat-h5":e.unref(ud)}),onClick:X},[e.createElementVNode("div",{class:"tui-chat-main"},[e.unref(d)?(e.openBlock(),e.createElementBlock("div",{key:0,class:"tui-chat-safe-tips"},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Wl).t("TUIChat.【安全提示】本 APP 仅用于体验腾讯云即时通信 IM 产品功能，不可用于业务洽谈与拓展。请勿轻信汇款、中奖等涉及钱款的信息，勿轻易拨打陌生电话，谨防上当受骗。")),1),e.createElementVNode("a",{onClick:n[0]||(n[0]=t=>{e.unref(fd).complaint})},e.toDisplayString(e.unref(Wl).t("TUIChat.点此投诉")),1)])):e.createCommentVNode("",!0),t.isGroup?(e.openBlock(),e.createBlock(Jd,{key:a.groupID,groupID:a.groupID},null,8,["groupID"])):e.createCommentVNode("",!0),e.createElementVNode("scroll-view",{id:"messageScrollList",class:"tui-message-list","scroll-y":"true","scroll-top":e.unref(v),"scroll-into-view":`tui-${e.unref(S)}`,onScroll:n[3]||(n[3]=(...t)=>e.unref(G)&&e.unref(G)(...t))},[e.unref(_)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("p",{key:0,class:"message-more",onClick:H},e.toDisplayString(e.unref(Wl).t("TUIChat.查看更多")),1)),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),((o,i)=>(e.openBlock(),e.createElementBlock("li",{id:`tui-${o.ID}`,key:o.vueForRenderKey,class:e.normalizeClass("message-li "+o.flow)},[e.createVNode(kp,{currTime:o.time,prevTime:i>0?e.unref(h)[i-1].time:0},null,8,["currTime","prevTime"]),e.createElementVNode("div",{class:"message-item",onClick:n[2]||(n[2]=e=>m.value="")},[o.type===e.unref(y).MSG_GRP_TIP||e.unref(Ed)(o)?(e.openBlock(),e.createBlock(lp,{key:0,content:o.getMessageContent()},null,8,["content"])):o.isRevoked||e.unref(Up)(o)?!o.isRevoked&&e.unref(Up)(o)?(e.openBlock(),e.createBlock(Wp,{key:2,message:o,onResendMessage:z,onHandleToggleMessageItem:j,onHandleH5LongPress:Y},null,8,["message"])):(e.openBlock(),e.createBlock(Np,{key:3,isEdit:o.type===e.unref(y).MSG_TEXT,messageItem:o,onMessageEdit:e=>{s("handleEditor",o,"reedit")}},null,8,["isEdit","messageItem","onMessageEdit"])):(e.openBlock(),e.createElementBlock("div",{key:1,id:`msg-bubble-${o.ID}`,class:"message-bubble-container",onLongpress:e=>j(0,o,0,!0),onTouchstart:e=>Y(0,o,0,"touchstart"),onTouchend:e=>Y(0,o,0,"touchend"),onMouseover:e=>Y(0,o,0,"touchend")},[e.createVNode(Sp,{messageItem:e.unref(Td)(o),content:o.getMessageContent(),isAudioPlayed:e.unref(R)[o.ID],blinkMessageIDList:e.unref(C),isMultipleSelectMode:t.isMultipleSelectMode,multipleSelectedMessageIDList:e.unref(g),onResendMessage:e=>z(o),onBlinkMessage:W,onScrollTo:J,onChangeSelectMessageIDList:Z,onSetReadReceiptPanelVisible:$},{default:e.withCtx((()=>[o.type===e.unref(y).MSG_TEXT?(e.openBlock(),e.createBlock($d,{key:0,content:o.getMessageContent()},null,8,["content"])):o.type===e.unref(y).MSG_IMAGE?(e.openBlock(),e.createBlock(th,{key:1,content:o.getMessageContent(),messageItem:e.unref(Td)(o)},{default:e.withCtx((()=>[e.createVNode(Zd,{content:o.getMessageContent(),messageItem:o,onPreviewImage:e=>(e=>{if(!h.value)return;const t=[],n=h.value.filter(((e,n)=>!e.isRevoked&&!e.hasRiskContent&&e.type===y.value.MSG_IMAGE&&(t.push(n),!0)));uni.previewImage({current:t.indexOf(e),urls:n.map((e=>{var t;return null==(t=e.payload.imageInfoArray)?void 0:t[2].url})),indicator:"number"})})(i)},null,8,["content","messageItem","onPreviewImage"])])),_:2},1032,["content","messageItem"])):o.type===e.unref(y).MSG_VIDEO?(e.openBlock(),e.createBlock(th,{key:2,content:o.getMessageContent(),messageItem:e.unref(Td)(o)},{default:e.withCtx((()=>[e.createVNode(Rp,{content:o.getMessageContent(),messageItem:o},null,8,["content","messageItem"])])),_:2},1032,["content","messageItem"])):o.type===e.unref(y).MSG_AUDIO?(e.openBlock(),e.createBlock(sp,{key:3,content:o.getMessageContent(),messageItem:o,broadcastNewAudioSrc:e.unref(L),onSetAudioPlayed:ee,onGetGlobalAudioContext:w},null,8,["content","messageItem","broadcastNewAudioSrc"])):o.type===e.unref(y).MSG_MERGER?(e.openBlock(),e.createBlock(Yd,{key:4,renderData:o.payload,messageItem:o,onAssignMessageIDInUniapp:Q},null,8,["renderData","messageItem"])):o.type===e.unref(y).MSG_FILE?(e.openBlock(),e.createBlock(ap,{key:5,content:o.getMessageContent()},null,8,["content"])):o.type===e.unref(y).MSG_FACE?(e.openBlock(),e.createBlock(rp,{key:6,content:o.getMessageContent()},null,8,["content"])):o.type===e.unref(y).MSG_LOCATION?(e.openBlock(),e.createBlock(Dp,{key:7,content:o.getMessageContent()},null,8,["content"])):o.type===e.unref(y).MSG_CUSTOM?(e.openBlock(),e.createBlock(up,{key:8,content:o.getMessageContent(),messageItem:o},null,8,["content","messageItem"])):e.createCommentVNode("",!0)])),_:2},1032,["messageItem","content","isAudioPlayed","blinkMessageIDList","isMultipleSelectMode","multipleSelectedMessageIDList","onResendMessage"])],40,["id","onLongpress","onTouchstart","onTouchend","onMouseover"])),o.ID===e.unref(m)?(e.openBlock(),e.createBlock(Op,{key:4,class:e.normalizeClass({"message-tool":!0,"message-tool-out":"out"===o.flow,"message-tool-in":"in"===o.flow}),messageItem:o,isMultipleSelectMode:t.isMultipleSelectMode,onToggleMultipleSelectMode:n[1]||(n[1]=()=>s("toggleMultipleSelectMode"))},null,8,["class","messageItem","isMultipleSelectMode"])):e.createCommentVNode("",!0)])],10,["id"])))),128))],40,["scroll-top","scroll-into-view"]),e.createVNode(Qp,{ref_key:"scrollButtonInstanceRef",ref:E,onScrollToLatestMessage:x},null,512),e.unref(N)?(e.openBlock(),e.createBlock(eh,{key:2,show:e.unref(N),isH5:!e.unref(id),center:!0,isHeaderShow:e.unref(id),onSubmit:n[4]||(n[4]=e=>(N.value=!N.value,void P.value.resendMessage())),"onUpdate:show":n[5]||(n[5]=e=>N.value=e)},{default:e.withCtx((()=>[e.createElementVNode("p",{class:"delDialog-title"},e.toDisplayString(e.unref(Wl).t("TUIChat.确认重发该消息？")),1)])),_:1},8,["show","isH5","isHeaderShow"])):e.createCommentVNode("",!0),e.unref(O)?(e.openBlock(),e.createBlock(Xp,{key:3,message:Object.assign({},e.unref(A)),onSetReadReceiptPanelVisible:$},null,8,["message"])):e.createCommentVNode("",!0),e.createVNode(Od,{visible:e.unref(D),overlayColor:"transparent",popDirection:"right"},{default:e.withCtx((()=>[e.createVNode(Wd,{style:{height:"100%"},isMounted:e.unref(D),messageID:e.unref(k),onCloseOverlay:n[6]||(n[6]=e=>D.value=!1)},null,8,["isMounted","messageID"])])),_:1},8,["visible"])])],2))}}),ch=Q(rh,[["__scopeId","data-v-59bfdc98"]]),uh=class e{constructor(){this.quoteMessageMap=new Map}static getInstance(){return e.instance||(e.instance=new e),e.instance}setStore(e,t,n,o){var i,s;if(e&&(this.isEditorNotEmpty(t)||(null==(i=null==o?void 0:o.message)?void 0:i.ID))){let i={};(null==(s=null==o?void 0:o.message)?void 0:s.ID)&&(this.quoteMessageMap.set(o.message.ID,o.message),i={messageID:o.message.ID,type:o.type});const a={conversationID:e,draftInfo:{html:t,abstract:n,...i}};Jl.setConversationDraft(a),zl.update(Sc.CHAT,"quoteMessage",{message:void 0,type:"quote"})}}getStore(e,t){const n=zl.getConversationModel(e);if(n){if(n.conversationID&&n.draftText){const e=od(n.draftText);zl.update(Sc.CHAT,"quoteMessage",{message:this.quoteMessageMap.get(e.messageID)||void 0,type:e.type}),t(e.html)}Jl.setConversationDraft({conversationID:n.conversationID})}}generateAbstract(e){let t="";return null==e||e.forEach((e=>{switch(e.type){case"text":t+=Hd(e.payload.text||"");break;case"image":t+=Wl.t("TUIChat.图片");break;case"video":t+=Wl.t("TUIChat.视频");break;case"file":t+=Wl.t("TUIChat.文件")}})),t}isEditorNotEmpty(e){return e&&!e.includes("is-empty")&&"<p></p>"!==e}};uh.instance=null;const lh=uh.getInstance(),dh=new Map([[3123,"文本包含本地审核拦截词"],[4004,"图片消息失败,无效的图片格式"],[4005,"文件消息失败,禁止发送违规封禁的文件"],[7004,"文件不存在,请检查文件路径是否正确"],[7005,"文件大小超出了限制,如果上传文件,最大限制是100MB"],[8001,"消息长度超出限制,消息长度不要超过12K"],[80001,"消息或者资料中文本存在敏感内容,发送失败"],[80004,"消息中图片存在敏感内容,发送失败"],[10017,"您已被禁止聊天"]]),ph=e.defineComponent({__name:"message-input-editor",props:{placeholder:{type:String,default:"this is placeholder"},replayOrReferenceMessage:{type:Object,default:()=>({}),required:!1},isMuted:{type:Boolean,default:!0},muteText:{type:String,default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0},isGroup:{type:Boolean,default:!1}},emits:["onTyping","onFocus","onAt"],setup(t,{expose:n,emit:o}){const i=t,s=o,a=e.ref(""),r=e.ref(),c=e.ref(!0),u=e.ref(!0),l=new Map,d=e.ref(),p=e.ref(""),h=e.ref();e.onMounted((()=>{zl.watch(Sc.CONV,{currentConversation:M}),zl.watch(Sc.CHAT,{quoteMessage:C}),uni.$on("insert-emoji",(e=>{var t;a.value+=null==(t=null==e?void 0:e.emoji)?void 0:t.name})),uni.$on("send-message-in-emoji-picker",(()=>{g()}))})),e.onUnmounted((()=>{p.value&&lh.setStore(p.value,a.value,a.value,h.value),uni.$off("insertEmoji"),uni.$off("send-message-in-emoji-picker"),zl.unwatch(Sc.CONV,{currentConversation:M}),zl.unwatch(Sc.CHAT,{quoteMessage:C}),c.value=!0,d.value=null,p.value="",h.value=null,f()}));const g=()=>{const e=_();f(),(async(e,t)=>{zl.getData(Sc.CHAT,"messageSource")&&zl.update(Sc.CHAT,"messageSource",void 0),null==e||e.forEach((async e=>{var n,o,i,s,a,r,c;try{const u={to:(null==(n=null==t?void 0:t.groupProfile)?void 0:n.groupID)||(null==(o=null==t?void 0:t.userProfile)?void 0:o.userID),conversationType:null==t?void 0:t.type,payload:{},needReadReceipt:Sd()};let l;const d={offlinePushInfo:{}},p={conversation:t,payload:e.payload,messageType:""};switch(null==e?void 0:e.type){case"text":if(l=JSON.parse(JSON.stringify(null==(i=e.payload)?void 0:i.text)),!l)break;u.payload={text:l},p.messageType=Yl.TYPES.MSG_TEXT,d.offlinePushInfo=Hp.create(p),(null==(s=e.payload)?void 0:s.atUserList)?(u.payload.atUserList=e.payload.atUserList,await Xl.sendTextAtMessage(u,d)):await Xl.sendTextMessage(u,d);break;case"image":u.payload={file:null==(a=e.payload)?void 0:a.file},p.messageType=Yl.TYPES.MSG_IMAGE,d.offlinePushInfo=Hp.create(p),await Xl.sendImageMessage(u,d);break;case"video":u.payload={file:null==(r=e.payload)?void 0:r.file},p.messageType=Yl.TYPES.MSG_VIDEO,d.offlinePushInfo=Hp.create(p),await Xl.sendVideoMessage(u,d);break;case"file":u.payload={file:null==(c=e.payload)?void 0:c.file},p.messageType=Yl.TYPES.MSG_FILE,d.offlinePushInfo=Hp.create(p),await Xl.sendFileMessage(u,d)}Ap("sendMessage")}catch(u){op({message:dh.get(null==u?void 0:u.code)?Wl.t(`TUIChat.${dh.get(u.code)}`):null==u?void 0:u.message,type:tp}),zl.getData(Sc.CHAT,"quoteMessage")&&zl.update(Sc.CHAT,"quoteMessage",{})}}))})(e,d.value)},_=()=>{let e=a.value;e=(e=>{if(!e)return"";const t=/(\[.+?\])/g;let n=e;return t.test(e)&&(n=e.replace(t,(e=>Fd[e]||e))),n})(e);const t=[];null==l||l.forEach(((n,o)=>{(null==e?void 0:e.includes("@"+n))&&t.push(o)}));const n={text:e};return(null==t?void 0:t.length)&&(n.atUserList=t),[{type:"text",payload:n}]},f=()=>{a.value="",u.value=!0,null==l||l.clear()},m=e=>{a.value=e},v=()=>{c.value=!0},y=e=>{var t;c.value=!1,s("onFocus",null==(t=null==e?void 0:e.detail)?void 0:t.height)},I=e=>{var t;const n=null==(t=null==e?void 0:e.detail)?void 0:t.value;(()=>{var e;u.value=!(null==(e=null==a?void 0:a.value)?void 0:e.length)})(),i.isGroup&&(n.endsWith("@")||n.endsWith("@\n"))&&(null==be||be.hideKeyboard(),s("onAt",!0))};function M(e){const t=p.value;d.value=e,p.value=null==e?void 0:e.conversationID,t!==p.value&&(t&&lh.setStore(t,a.value,a.value,h.value),f(),p.value&&lh.getStore(p.value,m))}function C(e){h.value=e}return e.watch((()=>[u.value,c.value]),((e,t)=>{e!==t&&s("onTyping",u.value,c.value)}),{immediate:!0,deep:!0}),n({insertAt:e=>{(null==l?void 0:l.has(null==e?void 0:e.id))||null==l||l.set(null==e?void 0:e.id,null==e?void 0:e.label),a.value+=null==e?void 0:e.label},resetEditor:f,setEditorContent:m,getEditorContent:_}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-input-container":!0,"message-input-container-h5":!e.unref(id)})},[i.isMuted?(e.openBlock(),e.createElementBlock("div",{key:0,class:"message-input-mute"},e.toDisplayString(i.muteText),1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("input",{id:"editor",ref_key:"inputRef",ref:r,"onUpdate:modelValue":n[0]||(n[0]=t=>e.isRef(a)?a.value=t:null),"adjust-position":!0,"cursor-spacing":"20","confirm-type":"send","confirm-hold":!0,maxlength:"140",type:"text","placeholder-class":"input-placeholder",class:"message-input-area",placeholder:i.placeholder,"auto-blur":"",onConfirm:g,onInput:I,onBlur:v,onFocus:y},null,40,["placeholder"]),[[e.vModelText,e.unref(a)]])],2))}}),hh=Q(ph,[["__scopeId","data-v-3f5c5644"]]),gh=Q(e.defineComponent({__name:"index",props:{show:{type:Boolean,default:!1},modal:{type:Boolean,default:!0},height:{type:String,default:"fit-content"},closeByClickOutside:{type:Boolean,default:!0},borderRadius:{type:String,default:"0px"},title:{type:String,default:""},showHeaderCloseButton:{type:Boolean,default:!1},showFooterSubmitButton:{type:Boolean,default:!1},submitButtonContent:{type:String,default:()=>Wl.t("确定")}},emits:["onOpen","onClose","onSubmit"],setup(t,{emit:n}){const o=t,i=n,s=e.ref();e.watch((()=>o.show),((t,n)=>{if(t!==n)switch(t){case!0:i("onOpen",s),e.nextTick((()=>{sd&&!cd&&o.closeByClickOutside&&$e.listen({domRefs:s.value,handler:a})}));break;case!1:i("onClose",s)}}));const a=()=>{(cd||sd)&&i("onClose",s)},r=()=>{i("onSubmit"),a()};return(n,i)=>o.show?(e.openBlock(),e.createElementBlock("div",{key:0},[e.unref(id)?e.renderSlot(n.$slots,"default",{key:1},void 0,!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["bottom-popup",!e.unref(id)&&"bottom-popup-h5",!e.unref(id)&&o.modal&&"bottom-popup-modal",e.unref(cd)&&"bottom-popup-uni"]),onClick:a},[e.createElementVNode("div",{ref_key:"dialogRef",ref:s,class:e.normalizeClass(["bottom-popup-main",!e.unref(id)&&"bottom-popup-h5-main"]),style:e.normalizeStyle({height:o.height,borderTopLeftRadius:o.borderRadius,borderTopRightRadius:o.borderRadius}),onClick:i[0]||(i[0]=e.withModifiers((()=>{}),["stop"]))},[t.title||t.showHeaderCloseButton?(e.openBlock(),e.createElementBlock("div",{key:0,class:"header"},[t.title?(e.openBlock(),e.createElementBlock("div",{key:0,class:"header-title"},e.toDisplayString(t.title),1)):e.createCommentVNode("",!0),t.showHeaderCloseButton?(e.openBlock(),e.createElementBlock("div",{key:1,class:"header-close",onClick:a},e.toDisplayString(e.unref(Wl).t("关闭")),1)):e.createCommentVNode("",!0)])):e.createCommentVNode("",!0),e.renderSlot(n.$slots,"default",{},void 0,!0),t.showFooterSubmitButton?(e.openBlock(),e.createElementBlock("div",{key:1,class:"footer"},[e.createElementVNode("div",{class:"footer-submit",onClick:r},e.toDisplayString(t.submitButtonContent),1)])):e.createCommentVNode("",!0)],6)],2))])):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-1091e7a8"]]),_h=Q(e.defineComponent({__name:"index",emits:["onAtListOpen","insertAt"],setup(t,{expose:n,emit:o}){const i=o,s=e.ref(),a=e.ref(),r=e.ref(!1),c=e.ref(),u=e.ref(),l=e.ref(),d=e.ref(!1),p=e.ref({left:0,top:0}),h=e.ref(0),g=e.ref(""),_={userID:Yl.TYPES.MSG_AT_ALL,nick:"所有人",isAll:!0,avatar:"https://web.sdk.qcloud.com/im/assets/images/at.svg"};zl.watch(Sc.CONV,{currentConversationID:e=>{var t,n;if(e!==g.value)if(g.value=e,c.value=[],u.value=[],l.value=[],d.value=!1,zl.update(Sc.CUSTOM,"memberList",c.value),null==(t=null==g?void 0:g.value)?void 0:t.startsWith("GROUP")){d.value=!0;const e=null==(n=null==g?void 0:g.value)?void 0:n.substring(5);Zl.switchGroup(e)}else Zl.switchGroup("")}}),zl.watch(Sc.GRP,{currentGroupMemberList:e=>{c.value=e,u.value=[_,...c.value],l.value=u.value,zl.update(Sc.CUSTOM,"memberList",c.value)}});const f=e=>{d.value&&(r.value=e,r.value&&i("onAtListOpen"))};be.toggleAtList=f,be.handleAtListPosition=e=>{p.value=e},be.setCurrentSelectIndex=e=>{var t,n;h.value=e,null==(n=null==(t=a.value)?void 0:t[h.value])||n.scrollIntoView(!1)},be.setShowMemberList=e=>{l.value=e},n({toggleAtList:f}),e.watch((()=>[p.value,null==s?void 0:s.value]),(()=>{var e;!sd&&(null==s?void 0:s.value)&&(null==(e=null==s?void 0:s.value)?void 0:e.style)&&(s.value.style.left=p.value.left+"px",s.value.style.top=p.value.top-s.value.clientHeight+"px")}));const m=()=>{r.value=!1,l.value=u.value,p.value={left:0,top:0}},v=e=>(null==e?void 0:e.avatar)||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",y=e=>(null==e?void 0:e.nick)?null==e?void 0:e.nick:null==e?void 0:e.userID;return(t,n)=>(e.openBlock(),e.createBlock(gh,{show:e.unref(r),onOnClose:m},{default:e.withCtx((()=>[e.createElementVNode("div",{ref_key:"MessageInputAt",ref:s,class:e.normalizeClass([e.unref(id)?"message-input-at":"message-input-at-h5"])},[e.createElementVNode("div",{ref:"dialog",class:"member-list"},[e.unref(id)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("header",{key:0,class:"member-list-title"},[e.createElementVNode("span",{class:"title"},e.toDisplayString(e.unref(Wl).t("TUIChat.选择提醒的人")),1)])),e.createElementVNode("ul",{class:"member-list-box"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(l),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,ref_for:!0,ref_key:"memberListItems",ref:a,class:e.normalizeClass(["member-list-box-body",[n===e.unref(h)&&"selected"]]),onClick:e=>(e=>{var t;if(id&&be.selectItem)be.selectItem(e);else if(null==(t=null==l?void 0:l.value)?void 0:t.length){const t=null==l?void 0:l.value[e];i("insertAt",{id:null==t?void 0:t.userID,label:(null==t?void 0:t.nick)||(null==t?void 0:t.userID)})}m()})(n)},[e.createElementVNode("img",{class:"member-list-box-body-avatar",src:v(t)},null,8,["src"]),e.createElementVNode("span",{class:"member-list-box-body-name"},e.toDisplayString(y(t)),1)],10,["onClick"])))),128))])],512)],2)])),_:1},8,["show"]))}}),[["__scopeId","data-v-8adfe779"]]),fh=e.defineComponent({__name:"message-input-audio",props:{isEnableAudio:{type:Boolean,default:!1}},emits:["changeDisplayType"],setup(t,{emit:n}){const o=n,i=t;let s,a=0,r=!1,c=-1,u=!1,l=!1;const d=null==be?void 0:be.getRecorderManager(),p=e.ref(!1),h=e.ref("按住说话"),g=e.ref("正在录音"),_=e.ref(!1),f=e.ref(),m={duration:6e4,sampleRate:44100,numberOfChannels:1,encodeBitRate:192e3,format:"mp3"};function v(){o("changeDisplayType",i.isEnableAudio?"editor":"audio")}function y(e){f.value=e}function I(){C(),M()}function M(){p.value=!1,h.value="按住说话",g.value="正在录音"}function C(e){clearInterval(s),s=void 0,a=0,c=-1,r=!1,(null==e?void 0:e.hasError)||d.stop()}function T(){u&&(l=!0)}function E(){u=!0,d.start(m)}e.onMounted((()=>{d.onStart(k),d.onStop(R),d.onError(L),zl.watch(Sc.CONV,{currentConversation:y})})),e.onUnmounted((()=>{zl.unwatch(Sc.CONV,{currentConversation:y})}));const S=oh((function(e){if(p.value){const t=e.changedTouches[e.changedTouches.length-1].pageY;c<0&&(c=t);const n=c-t;n>150?(h.value="抬起取消",g.value="松开手指 取消发送",r=!0):n>50?(h.value="抬起发送",g.value="继续上滑可取消",r=!1):(h.value="抬起发送",g.value="正在录音",r=!1)}}),100);function D(){u=!1,d.stop()}function k(){if(!u)return l=!0,void d.stop();s=setInterval((()=>{a+=1}),1e3),h.value="抬起发送",p.value=!0}function R(e){var t,n,o,i,c;if(l)return l=!1,void I();if(r||!p.value)return void I();clearInterval(s);const u=e.tempFilePath,d=e.duration?e.duration:1e3*a,h=e.fileSize?e.fileSize:48*a/8*1024;if(d<1e3)op({message:"录音时间太短",type:np,duration:1500});else{const e={to:(null==(n=null==(t=null==f?void 0:f.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(i=null==(o=null==f?void 0:f.value)?void 0:o.userProfile)?void 0:i.userID),conversationType:null==(c=null==f?void 0:f.value)?void 0:c.type,payload:{file:{duration:d,tempFilePath:u,fileSize:h}},needReadReceipt:Sd()};null==Xl||Xl.sendAudioMessage(e)}I()}function L(){C({hasError:!0}),M()}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"message-input-audio":!0,"message-input-audio-open":e.unref(_)})},[e.createVNode(Id,{class:"audio-message-icon",file:e.unref("/assets/audio.3e97d529.svg"),size:"23px",hotAreaSize:"3px",onOnClick:v},null,8,["file"]),i.isEnableAudio?(e.openBlock(),e.createElementBlock("view",{key:0,class:"audio-input-touch-bar",onTouchstart:T,onLongpress:E,onTouchmove:n[0]||(n[0]=(...t)=>e.unref(S)&&e.unref(S)(...t)),onTouchend:D},[e.createElementVNode("span",null,e.toDisplayString(e.unref(Wl).t(`TUIChat.${e.unref(h)}`)),1),e.unref(p)?(e.openBlock(),e.createElementBlock("view",{key:0,class:"record-modal"},[e.createElementVNode("div",{class:"red-mask"}),e.createElementVNode("view",{class:"float-element moving-slider"}),e.createElementVNode("view",{class:"float-element modal-title"},e.toDisplayString(e.unref(Wl).t(`TUIChat.${e.unref(g)}`)),1)])):e.createCommentVNode("",!0)],32)):e.createCommentVNode("",!0)],2))}}),mh=Q(fh,[["__scopeId","data-v-f421bb86"]]),vh=Q(e.defineComponent({__name:"index",props:{displayType:{default:"editor"}},setup(t){const n=t,o=Yl.TYPES,i=e.ref();e.onMounted((()=>{zl.watch(Sc.CHAT,{quoteMessage:r})})),e.onUnmounted((()=>{zl.unwatch(Sc.CHAT,{quoteMessage:r})}));const s=e.computed((()=>{var e,t;let n;switch(null==(e=i.value)?void 0:e.type){case o.MSG_TEXT:n=Hd(null==(t=i.value.payload)?void 0:t.text);break;case o.MSG_IMAGE:n=Wl.t("TUIChat.图片");break;case o.MSG_AUDIO:n=Wl.t("TUIChat.语音");break;case o.MSG_VIDEO:n=Wl.t("TUIChat.视频");break;case o.MSG_FILE:n=Wl.t("TUIChat.文件");break;case o.MSG_CUSTOM:n=Wl.t("TUIChat.自定义");break;case o.MSG_FACE:n=Wl.t("TUIChat.表情");break;case o.MSG_MERGER:n=Wl.t("TUIChat.聊天记录");break;default:n=Wl.t("TUIChat.消息")}return n}));function a(){zl.update(Sc.CHAT,"quoteMessage",{message:void 0,type:"quote"})}function r(e){(null==e?void 0:e.message)&&"quote"===(null==e?void 0:e.type)?i.value=e.message:i.value=void 0}return(t,o)=>Boolean(e.unref(i))&&"audio"!==n.displayType?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"input-quote-container":!0,"input-quote-container-uni":e.unref(cd),"input-quote-container-h5":e.unref(sd)})},[e.createElementVNode("div",{class:"input-quote-content"},[e.createElementVNode("div",{class:"max-one-line"},e.toDisplayString(e.unref(i).nick||e.unref(i).from)+": "+e.toDisplayString(e.unref(s)),1),e.createVNode(Id,{class:"input-quote-close-icon",file:e.unref(Jp),width:"11px",height:"11px",onOnClick:a},null,8,["file"])])],2)):e.createCommentVNode("",!0)}}),[["__scopeId","data-v-b4a37b50"]]),yh=Q(e.defineComponent({__name:"index",props:{placeholder:{default:"this is placeholder"},isMuted:{type:Boolean,default:!0},muteText:{default:""},enableInput:{type:Boolean,default:!0},enableAt:{type:Boolean,default:!0},enableTyping:{type:Boolean,default:!0},replyOrReference:{default:()=>({})},inputToolbarDisplayType:{default:"none"}},emits:["changeToolbarDisplayType"],setup(t,{expose:n,emit:o}){const i=o,s=t,a=e.ref(),r=e.ref(),c=e.ref(),u=e.ref(!1),l=e.ref("editor"),d=pp.getFeatureConfig(),p=e.ref(d.InputVoice),h=e.ref(d.InputEmoji||d.InputStickers),g=e.ref(d.InputImage||d.InputVideo||d.InputEvaluation||d.InputQuickReplies);function _(e){l.value=e,"audio"===e&&i("changeToolbarDisplayType","none")}function f(e){i("changeToolbarDisplayType",e)}e.onMounted((()=>{zl.watch(Sc.CONV,{currentConversation:C}),zl.watch(Sc.CHAT,{quoteMessage:T})})),e.onUnmounted((()=>{zl.unwatch(Sc.CONV,{currentConversation:C}),zl.unwatch(Sc.CHAT,{quoteMessage:T})})),e.watch((()=>s.inputToolbarDisplayType),(e=>{"none"!==e&&_("editor")}));const m=(e,t)=>{((e,t)=>{e||t?Xl.leaveTypingState():Xl.enterTypingState()})(e,t)},v=e=>{var t;null==(t=null==r?void 0:r.value)||t.toggleAtList(e)},y=()=>{sd&&i("changeToolbarDisplayType","none")},I=e=>{var t,n;(null==(t=null==a?void 0:a.value)?void 0:t.insertAt)&&(null==(n=null==a?void 0:a.value)||n.insertAt(e))},M=()=>{var e,t;(null==(e=null==a?void 0:a.value)?void 0:e.blur)&&(null==(t=null==a?void 0:a.value)||t.blur())};function C(e){var t;c.value=e,u.value=(null==(t=c.value)?void 0:t.type)===Yl.TYPES.CONV_GROUP}function T(e){(null==e?void 0:e.message)&&"quote"===(null==e?void 0:e.type)&&_("editor")}return n({insertEmoji:e=>{var t,n;(null==(t=null==a?void 0:a.value)?void 0:t.addEmoji)&&(null==(n=null==a?void 0:a.value)||n.addEmoji(e))},reEdit:e=>{var t,n;null==(t=null==a?void 0:a.value)||t.resetEditor(),null==(n=null==a?void 0:a.value)||n.setEditorContent(e)}}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-input",!e.unref(id)&&"message-input-h5"])},[e.createElementVNode("div",{class:"audio-main-content-line"},[(e.unref(ad)||e.unref(rd))&&e.unref(p)?(e.openBlock(),e.createBlock(mh,{key:0,class:e.normalizeClass({"message-input-wx-audio-open":"audio"===e.unref(l)}),isEnableAudio:"audio"===e.unref(l),onChangeDisplayType:_},null,8,["class","isEnableAudio"])):e.createCommentVNode("",!0),e.withDirectives(e.createVNode(hh,{ref_key:"editor",ref:a,class:"message-input-editor",placeholder:s.placeholder,isMuted:s.isMuted,muteText:s.muteText,enableInput:s.enableInput,enableAt:s.enableAt,enableTyping:s.enableTyping,isGroup:e.unref(u),onOnTyping:m,onOnAt:v,onOnFocus:y},null,8,["placeholder","isMuted","muteText","enableInput","enableAt","enableTyping","isGroup"]),[[e.vShow,"editor"===e.unref(l)]]),s.enableAt?(e.openBlock(),e.createBlock(_h,{key:1,ref_key:"messageInputAtRef",ref:r,onInsertAt:I,onOnAtListOpen:M},null,512)):e.createCommentVNode("",!0),e.unref(h)?(e.openBlock(),e.createBlock(Id,{key:2,class:"icon icon-face",file:e.unref("/assets/face-uni.e33f5632.png"),size:"23px",hotAreaSize:"3px",onOnClick:n[0]||(n[0]=e=>f("emojiPicker"))},null,8,["file"])):e.createCommentVNode("",!0),e.unref(g)?(e.openBlock(),e.createBlock(Id,{key:3,class:"icon icon-more",file:e.unref("/assets/more-uni.030c2d9a.png"),size:"23px",hotAreaSize:"3px",onOnClick:n[1]||(n[1]=e=>f("tools"))},null,8,["file"])):e.createCommentVNode("",!0)]),e.createElementVNode("div",null,[e.createVNode(vh,{style:{minWidth:0},displayType:e.unref(l)},null,8,["displayType"])])],2))}}),[["__scopeId","data-v-eaabe75e"]]),Ih=Q(e.defineComponent({__name:"index",emits:["oneByOneForwardMessage","mergeForwardMessage","toggleMultipleSelectMode"],setup(t,{emit:n}){const o=n,i=e.ref(ud?"25px":"30px");function s(){o("oneByOneForwardMessage")}function a(){o("mergeForwardMessage")}function r(){o("toggleMultipleSelectMode")}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass({"mulitple-select-panel":!0,"mulitple-select-panel-mobile":e.unref(ud)})},[e.createElementVNode("div",{class:"forward-button",onClick:s},[e.createVNode(Id,{file:e.unref("/assets/forward-each.9e79e381.svg"),size:e.unref(i)},null,8,["file","size"]),e.createElementVNode("span",{class:e.normalizeClass({"forward-button-text":!0,"forward-button-text-mobile":e.unref(ud)})},e.toDisplayString(e.unref(Wl).t("TUIChat.逐条转发")),3)]),e.createElementVNode("div",{class:"forward-button",onClick:a},[e.createVNode(Id,{file:e.unref("/assets/forward-merge.eef115cf.svg"),size:e.unref(i)},null,8,["file","size"]),e.createElementVNode("span",{class:e.normalizeClass({"forward-button-text":!0,"forward-button-text-mobile":e.unref(ud)})},e.toDisplayString(e.unref(Wl).t("TUIChat.合并转发")),3)]),e.createElementVNode("div",{class:"forward-button",onClick:r},[e.createVNode(Id,{class:"cancel-button-icon",file:e.unref("/assets/add-circle.b2afe9dc.svg"),size:e.unref(i)},null,8,["file","size"]),e.createElementVNode("span",{class:e.normalizeClass({"forward-button-text":!0,"forward-button-text-mobile":e.unref(ud)})},e.toDisplayString(e.unref(Wl).t("TUIChat.取消")),3)])],2))}}),[["__scopeId","data-v-22007d25"]]),Mh="/assets/selected.0a1e59e6.svg",Ch=e.defineComponent({__name:"index",props:{list:{type:Array,default:()=>[]},selectedList:{type:Array,default:()=>[]},isSearch:{type:Boolean,default:!0},isRadio:{type:Boolean,default:!1},isCustomItem:{type:Boolean,default:!1},title:{type:String,default:""},type:{type:String,default:""},resultShow:{type:Boolean,default:!0},total:{type:Number,default:0},isHiddenBackIcon:{type:Boolean,default:!1}},emits:["search","submit","cancel","getMore"],setup(t,{emit:n}){const o=t,i=e.ref([]),s=e.ref(0),a=e.ref([]),r=e.ref(!0),c=e.ref(!1),u=e.ref(""),l=e.ref("");e.watchEffect((()=>{if(o.isCustomItem)for(let e=0;e<o.list.length;e++)o.list[e].conversationID.indexOf("@TIM#SYSTEM")>-1&&o.list.splice(e,1),i.value=o.list;else i.value=o.list;s.value=o.total?o.total:o.list.length,a.value=o.selectedList&&o.selectedList.length>0?o.selectedList:a.value,r.value=o.isSearch,c.value=o.isCustomItem,u.value=o.title}));const d=n,p=e.computed((()=>i.value.filter((e=>!e.isDisabled)))),h=e=>{l.value=e.target.value||e.detail.value,d("search",l.value)},g=e=>{if(e.isDisabled)return;let t=a.value;const n=t.indexOf(e);if(n>-1)return a.value.splice(n,1);o.isRadio&&(t=[]),t.push(e),a.value=t},_=()=>{a.value.length===p.value.length?a.value=[]:a.value=[...p.value]},f=()=>{d("submit",a.value),l.value=""},m=()=>{d("cancel"),l.value=""},v=()=>{d("getMore")};return(n,d)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["transfer",[e.unref(id)?"":"transfer-h5",e.unref(ad)?"transfer-h5-wechat":""]])},[e.unref(id)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("header",{key:0,class:"transfer-header transfer-h5-header"},[o.isHiddenBackIcon?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,onClick:m},[e.createVNode(Id,{class:"icon",file:e.unref(md),width:"18px",height:"18px"},null,8,["file"])])),e.createElementVNode("span",{class:"title"},e.toDisplayString(e.unref(u)),1),e.createElementVNode("span",{class:"space"})])),e.createElementVNode("main",{class:"main"},[e.createElementVNode("div",{class:"left"},[e.createElementVNode("header",{class:"transfer-header"},[e.unref(id)&&e.unref(r)?(e.openBlock(),e.createElementBlock("input",{key:0,type:"text",value:e.unref(l),placeholder:e.unref(Wl).t("component.请输入userID"),enterkeyhint:"search",class:e.normalizeClass([e.unref(cd)?"left-uniapp-input":""]),onKeyup:e.withKeys(h,["enter"])},null,42,["value","placeholder"])):e.createCommentVNode("",!0),!e.unref(id)&&e.unref(r)?(e.openBlock(),e.createElementBlock("input",{key:1,type:"text",placeholder:e.unref(Wl).t("component.请输入userID"),enterkeyhint:"search",value:e.unref(l),class:e.normalizeClass([e.unref(cd)?"left-uniapp-input":""]),onBlur:h,onConfirm:h},null,42,["placeholder","value"])):e.createCommentVNode("",!0)]),e.createElementVNode("main",{class:"transfer-left-main"},[e.createElementVNode("ul",{class:"transfer-list"},[e.unref(p).length>1&&!t.isRadio?(e.openBlock(),e.createElementBlock("li",{key:0,class:"transfer-list-item",onClick:_},[e.unref(a).length===e.unref(p).length?(e.openBlock(),e.createBlock(Id,{key:0,file:e.unref(Mh),width:"18px",height:"18px"},null,8,["file"])):(e.openBlock(),e.createElementBlock("i",{key:1,class:"icon-unselected"})),e.createElementVNode("span",{class:"select-all"},e.toDisplayString(e.unref(Wl).t("component.全选")),1)])):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(i),(t=>(e.openBlock(),e.createElementBlock("li",{key:t.userID,class:"transfer-list-item",onClick:e=>g(t)},[e.unref(a).indexOf(t)>-1?(e.openBlock(),e.createBlock(Id,{key:0,file:e.unref(Mh),class:e.normalizeClass([t.isDisabled&&"disabled"]),width:"18px",height:"18px"},null,8,["file","class"])):(e.openBlock(),e.createElementBlock("i",{key:1,class:e.normalizeClass([t.isDisabled&&"disabled","icon-unselected"])},null,2)),e.unref(c)?e.renderSlot(n.$slots,"left",{key:3,data:t},void 0,!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.createElementVNode("span",{class:"name"},e.toDisplayString(t.nick||t.userID),1),t.isDisabled?(e.openBlock(),e.createElementBlock("span",{key:0},"（"+e.toDisplayString(e.unref(Wl).t("component.已在群中"))+"）",1)):e.createCommentVNode("",!0)],64))],8,["onClick"])))),128)),e.unref(s)>e.unref(i).length?(e.openBlock(),e.createElementBlock("li",{key:1,class:"transfer-list-item more",onClick:v},e.toDisplayString(e.unref(Wl).t("component.查看更多")),1)):e.createCommentVNode("",!0)])])]),e.createElementVNode("div",{class:"right"},[e.unref(id)?(e.openBlock(),e.createElementBlock("header",{key:0,class:"transfer-header"},e.toDisplayString(e.unref(u)),1)):e.createCommentVNode("",!0),t.resultShow?(e.openBlock(),e.createElementBlock("ul",{key:1,class:"transfer-list"},[e.unref(a).length>0&&e.unref(id)?(e.openBlock(),e.createElementBlock("p",{key:0,class:"transfer-text"},e.toDisplayString(e.unref(Wl).t("component.已选中"))+e.toDisplayString(e.unref(a).length)+e.toDisplayString(e.unref(Wl).t("component.人")),1)):e.createCommentVNode("",!0),(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(a),((t,o)=>(e.openBlock(),e.createElementBlock("li",{key:o,class:"transfer-list-item space-between"},[e.createElementVNode("aside",{class:"transfer-list-item-content"},[e.unref(c)?e.renderSlot(n.$slots,"right",{key:1,data:t},void 0,!0):(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.createElementVNode("img",{class:"avatar",src:t.avatar||"https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png",onerror:"this.onerror=null;this.src='https://web.sdk.qcloud.com/component/TUIKit/assets/avatar_21.png'"},null,8,["src"]),e.unref(id)?(e.openBlock(),e.createElementBlock("span",{key:0,class:"name"},e.toDisplayString(t.nick||t.userID),1)):e.createCommentVNode("",!0)],64))]),e.unref(id)?(e.openBlock(),e.createElementBlock("span",{key:0,onClick:e=>g(t)},[e.createVNode(Id,{file:e.unref("/assets/cancel.aba36dc1.svg"),width:"18px",height:"18px"},null,8,["file"])],8,["onClick"])):e.createCommentVNode("",!0)])))),128))])):e.createCommentVNode("",!0),e.createElementVNode("footer",{class:"transfer-right-footer"},[e.createElementVNode("button",{class:"btn btn-cancel",onClick:m},e.toDisplayString(e.unref(Wl).t("component.取消")),1),e.unref(a).length>0?(e.openBlock(),e.createElementBlock("button",{key:0,class:"btn",onClick:f},e.toDisplayString(e.unref(Wl).t("component.完成")),1)):(e.openBlock(),e.createElementBlock("button",{key:1,class:"btn btn-no",onClick:f},e.toDisplayString(e.unref(Wl).t("component.完成")),1))])])])],2))}}),Th=Q(Ch,[["__scopeId","data-v-b1d83770"]]),Eh=e.defineComponent({__name:"index",emits:["toggleMultipleSelectMode"],setup(t,{emit:n}){const o=n;let i=[],s=!1;const a=e.ref(!1),r=e.ref();function c(e){void 0!==e&&(s=!1,i=[e],p())}function u(e){if(!e)return;s=!1;const{isMergeForward:t,messageIDList:n}=e||{};(null==n?void 0:n.length)>0?(s=t,i=n,p()):op({message:Wl.t("TUIChat.未选择消息"),type:tp})}function l(){zl.update(Sc.CUSTOM,"singleForwardMessageID",void 0),zl.update(Sc.CUSTOM,"multipleForwardMessageID",void 0)}function d(){l(),a.value=!1}function p(){!function(){const e=zl.getData(Sc.CONV,"conversationList");r.value=e.map((e=>({userID:e.conversationID,nick:e.getShowName(),avatar:e.getAvatar()})))}(),a.value=!0}function h(e){if(0===(null==e?void 0:e.length))return;const t=e.map((e=>zl.getConversationModel(e.userID))),n=i.map((e=>zl.getMessageModel(e))).sort(((e,t)=>e.time-t.time)),a=t.map((e=>{const t={conversation:e,messageType:Yl.TYPES.MSG_MERGER};return Xl.sendForwardMessage([e],n,{needMerge:s,offlinePushInfo:Hp.create(t),params:{needReadReceipt:Sd()}})}));Promise.allSettled(a).then((e=>{for(const t of e){const{status:e}=t;if("rejected"===e){const e=80001===t.reason.code?Wl.t("TUIChat.内容包含敏感词汇"):t.reason.message;op({message:e,type:tp});break}}})),d(),o("toggleMultipleSelectMode",!1)}return e.onMounted((()=>{zl.watch(Sc.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:u})})),e.onUnmounted((()=>{zl.unwatch(Sc.CUSTOM,{singleForwardMessageID:c,multipleForwardMessageID:u}),l()})),(t,n)=>(e.openBlock(),e.createBlock(Ld,{visible:e.unref(a),useMask:!1},{default:e.withCtx((()=>[e.createVNode(Th,{title:e.unref(Wl).t("TUIChat.转发"),isSearch:!1,isCustomItem:!1,list:e.unref(r),isHiddenBackIcon:e.unref(cd),onCancel:d,onSubmit:h},null,8,["title","list","isHiddenBackIcon"])])),_:1},8,["visible"]))}}),Sh=Q(e.defineComponent({__name:"index",props:{iconFile:{type:String,required:!0},title:{type:String,default:""},needDialog:{type:Boolean,default:!0},iconWidth:{type:String,default:"20px"},iconHeight:{type:String,default:"20px"},needBottomPopup:{type:Boolean,default:!1}},emits:["onIconClick","onDialogClose","onDialogShow"],setup(t,{expose:n,emit:o}){const i=t,s=o,a=e.ref("dark"===pp.getTheme()),r=e.ref(!1),c=e.ref(),u=e.ref(),l=()=>{s("onIconClick",u),id&&$e.listen({domRefs:c.value,handler:d}),i.needDialog&&p(!r.value)},d=()=>{r.value=!1,s("onDialogClose",u)},p=e=>{if(r.value!==e)switch(r.value=e,e){case!0:s("onDialogShow",u);break;case!1:s("onDialogClose",u)}},h=()=>{r.value=!1};return n({toggleDialogDisplay:p}),(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"toolbarItemRef",ref:c,class:e.normalizeClass(["toolbar-item-container",!e.unref(id)&&"toolbar-item-container-h5",e.unref(cd)&&"toolbar-item-container-uni"])},[e.createElementVNode("div",{class:e.normalizeClass(["toolbar-item-container-icon",e.unref(cd)&&"toolbar-item-container-uni-icon"]),onClick:l},[e.createVNode(Id,{file:i.iconFile,class:"icon",width:i.iconWidth,height:i.iconHeight},null,8,["file","width","height"])],2),e.unref(cd)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["toolbar-item-container-uni-title"])},e.toDisplayString(i.title),1)):e.createCommentVNode("",!0),e.withDirectives(e.createElementVNode("div",{ref_key:"dialogRef",ref:u,class:e.normalizeClass(["toolbar-item-container-dialog",e.unref(a)&&"toolbar-item-container-dialog-dark",!e.unref(id)&&"toolbar-item-container-h5-dialog",e.unref(cd)&&"toolbar-item-container-uni-dialog"])},[i.needBottomPopup&&!e.unref(id)?(e.openBlock(),e.createBlock(gh,{key:0,class:"toolbar-bottom-popup",show:e.unref(r),onTouchmove:n[0]||(n[0]=e.withModifiers((()=>{}),["stop","prevent"])),onOnClose:h},{default:e.withCtx((()=>[e.renderSlot(t.$slots,"default",{},void 0,!0)])),_:3},8,["show"])):e.renderSlot(t.$slots,"default",{key:1},void 0,!0)],2),[[e.vShow,e.unref(r)]])],2))}}),[["__scopeId","data-v-99f143d8"]]),Dh="/assets/camera-uni.e7fd6e1a.png",kh=e.defineComponent({__name:"index",props:{imageSourceType:{type:String,default:"album"}},setup(t){const n=t,o=e.ref(),i=e.ref(),s={web_album:{icon:"dark"===pp.getTheme()?"/assets/image-dark.bf322028.svg":"/assets/image-light.3da9cf2c.svg",title:"图片"},uni_album:{icon:"/assets/image-uni.3e951cbb.png",title:"图片"},uni_camera:{icon:Dh,title:"拍照"}};zl.watch(Sc.CONV,{currentConversation:e=>{i.value=e}});const a=e.computed((()=>cd?"camera"===n.imageSourceType?s.uni_camera:s.uni_album:s.web_album)),r=()=>{var e;cd?ad&&(null==be?void 0:be.chooseMedia)?null==be||be.chooseMedia({count:1,mediaType:["image"],sizeType:["original","compressed"],sourceType:[n.imageSourceType],success:function(e){u(e)}}):null==be||be.chooseImage({count:1,sourceType:[n.imageSourceType],success:function(e){u(e)}}):(null==(e=o.value)?void 0:e.click)&&o.value.click()},c=e=>{var t,n;(null==(n=null==(t=null==e?void 0:e.target)?void 0:t.files)?void 0:n.length)<=0||(u(null==e?void 0:e.target),e.target.value="")},u=e=>{var t,n,o,s,a;if(!e)return;const r={to:(null==(n=null==(t=null==i?void 0:i.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(s=null==(o=null==i?void 0:i.value)?void 0:o.userProfile)?void 0:s.userID),conversationType:null==(a=null==i?void 0:i.value)?void 0:a.type,payload:{file:e},needReadReceipt:Sd()},c={conversation:i.value,payload:r.payload,messageType:Yl.TYPES.MSG_IMAGE},u={offlinePushInfo:Hp.create(c)};Xl.sendImageMessage(r,u)};return(t,n)=>(e.openBlock(),e.createBlock(Sh,{iconFile:e.unref(a).icon,title:e.unref(a).title,iconWidth:e.unref(cd)?"32px":"20px",iconHeight:e.unref(cd)?"25px":"18px",needDialog:!1,onOnIconClick:r},{default:e.withCtx((()=>[e.unref(cd)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["image-upload",!e.unref(id)&&"image-upload-h5"])},[e.createElementVNode("input",{ref_key:"inputRef",ref:o,title:"图片",type:"file","data-type":"image",accept:"image/gif,image/jpeg,image/jpg,image/png,image/bmp,image/webp",onChange:c},null,544)],2))])),_:1},8,["iconFile","title","iconWidth","iconHeight"]))}}),Rh=Q(kh,[["__scopeId","data-v-9b719098"]]),Lh="/assets/video-uni.0b4d3e53.png",Ah=e.defineComponent({__name:"index",props:{videoSourceType:{type:String,default:"album"}},setup(t){const n=t,o=e.ref(),i=e.ref();zl.watch(Sc.CONV,{currentConversation:e=>{i.value=e}});const s=()=>{if(!cd){return"dark"===pp.getTheme()?"/assets/video-dark.e7ceead3.svg":"/assets/video-light.48615dd3.svg"}switch(n.videoSourceType){case"album":default:return Lh;case"camera":return Dh}},a=()=>{var e,t;cd?ad&&(null==be?void 0:be.chooseMedia)?null==be||be.chooseMedia({mediaType:["video"],count:1,sourceType:[n.videoSourceType],maxDuration:60,success:function(e){c(e)}}):null==be||be.chooseVideo({count:1,sourceType:[n.videoSourceType],compressed:!1,success:function(e){c(e)}}):(null==(e=null==o?void 0:o.value)?void 0:e.click)&&(null==(t=null==o?void 0:o.value)||t.click())},r=e=>{var t,n;(null==(n=null==(t=null==e?void 0:e.target)?void 0:t.files)?void 0:n.length)<=0||(c(null==e?void 0:e.target),e.target.value="")},c=e=>{var t,n,o,s,a;if(!e)return;const r={to:(null==(n=null==(t=null==i?void 0:i.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(s=null==(o=null==i?void 0:i.value)?void 0:o.userProfile)?void 0:s.userID),conversationType:null==(a=null==i?void 0:i.value)?void 0:a.type,payload:{file:e},needReadReceipt:Sd()},c={conversation:i.value,payload:r.payload,messageType:Yl.TYPES.MSG_VIDEO},u={offlinePushInfo:Hp.create(c)};Xl.sendVideoMessage(r,u)};return(t,i)=>(e.openBlock(),e.createBlock(Sh,{iconFile:s(),title:cd&&"camera"===n.videoSourceType?"录制":"视频",needDialog:!1,iconWidth:e.unref(cd)?"32px":"20px",iconHeight:e.unref(cd)?"album"===n.videoSourceType?"20px":"25px":"18px",onOnIconClick:a},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["video-upload",!e.unref(id)&&"video-upload-h5"])},[e.createElementVNode("input",{ref_key:"inputRef",ref:o,title:"视频",type:"file","data-type":"video",accept:"video/*",onChange:r},null,544)],2)])),_:1},8,["iconFile","title","iconWidth","iconHeight"]))}}),Oh=Q(Ah,[["__scopeId","data-v-2ecf415c"]]),Nh={product:{label:"产品文档",url:"https://cloud.tencent.com/document/product/269/1499#.E7.BE.A4.E7.BB.84.E5.8A.9F.E8.83.BD"},customMessage:{label:"自定义消息",url:"https://web.sdk.qcloud.com/im/doc/v3/zh-cn/SDK.html#createCustomMessage"},complaint:{label:"点此投诉",url:"https://cloud.tencent.com/apply/p/xc3oaubi98g"},implement:{label:"集成TUICallKit",url:"https://cloud.tencent.com/document/product/269/79861"},purchase:{label:"开通腾讯实时音视频服务",url:"https://cloud.tencent.com/document/product/1640/79968"}},Ph=Q(e.defineComponent({__name:"index",props:{starTotal:{type:Number,default:5}},emits:["onDialogPopupShowOrHide"],setup(t,{emit:n}){const o="dark"===pp.getTheme()?"/assets/evalute-dark.e265e635.svg":"/assets/evalute-light.8db79ed8.svg",i=t,s=n,a=e.ref(),r=e.ref(i.starTotal),c=e.ref(-1),u=e.ref(""),l=e.ref();zl.watch(Sc.CONV,{currentConversation:e=>{l.value=e}});const d=e.computed((()=>u.value.length||c.value>=0)),p=()=>{s("onDialogPopupShowOrHide",!0)},h=()=>{_(),s("onDialogPopupShowOrHide",!1)},g=()=>{var e;null==(e=null==a?void 0:a.value)||e.toggleDialogDisplay(!1)},_=()=>{c.value=-1,u.value=""},f=()=>{var e,t,n,o,i,s;if(c.value<0&&!u.value.length)return;const r={data:JSON.stringify({businessID:bd.EVALUATE,version:1,score:c.value+1,comment:u.value}),description:"对本次的服务评价",extension:"对本次的服务评价"},d={to:(null==(t=null==(e=null==l?void 0:l.value)?void 0:e.groupProfile)?void 0:t.groupID)||(null==(o=null==(n=null==l?void 0:l.value)?void 0:n.userProfile)?void 0:o.userID),conversationType:null==(i=null==l?void 0:l.value)?void 0:i.type,payload:r,needReadReceipt:Sd()},p={conversation:l.value,payload:d.payload,messageType:Yl.TYPES.MSG_CUSTOM},h={offlinePushInfo:Hp.create(p)};Xl.sendCustomMessage(d,h),null==(s=null==a?void 0:a.value)||s.toggleDialogDisplay(!1)};return(t,n)=>(e.openBlock(),e.createBlock(Sh,{ref_key:"container",ref:a,iconFile:e.unref(o),title:"评价",needBottomPopup:!0,iconWidth:e.unref(cd)?"26px":"20px",iconHeight:e.unref(cd)?"26px":"20px",onOnDialogShow:p,onOnDialogClose:h},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["evaluate",!e.unref(id)&&"evaluate-h5"])},[e.createElementVNode("div",{class:e.normalizeClass(["evaluate-header",!e.unref(id)&&"evaluate-h5-header"])},[e.createElementVNode("div",{class:e.normalizeClass(["evaluate-header-content",!e.unref(id)&&"evaluate-h5-header-content"])},e.toDisplayString(e.unref(Wl).t("Evaluate.请对本次服务进行评价")),3),e.unref(id)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["evaluate-header-close",!e.unref(id)&&"evaluate-h5-header-close"]),onClick:e.withModifiers(g,["stop"])},e.toDisplayString(e.unref(Wl).t("关闭")),3))],2),e.createElementVNode("div",{class:e.normalizeClass(["evaluate-content",!e.unref(id)&&"evaluate-h5-content"])},[e.createElementVNode("ul",{class:e.normalizeClass(["evaluate-content-list",!e.unref(id)&&"evaluate-h5-content-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(r),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:e.normalizeClass(["evaluate-content-list-item",!e.unref(id)&&"evaluate-h5-content-list-item"]),onClick:e.withModifiers((e=>{return t=n,void(c.value===t?c.value=c.value-1:c.value=t);var t}),["stop"])},[n<=e.unref(c)?(e.openBlock(),e.createBlock(Id,{key:0,file:e.unref(cp),width:e.unref(id)?"20px":"30px",height:e.unref(id)?"20px":"30px"},null,8,["file","width","height"])):(e.openBlock(),e.createBlock(Id,{key:1,file:e.unref("/assets/star.8a9a7e2e.png"),width:e.unref(id)?"20px":"30px",height:e.unref(id)?"20px":"30px"},null,8,["file","width","height"]))],10,["onClick"])))),128))],2),e.withDirectives(e.createElementVNode("textarea",{"onUpdate:modelValue":n[0]||(n[0]=t=>e.isRef(u)?u.value=t:null),class:e.normalizeClass(["evaluate-content-text",!e.unref(id)&&"evaluate-h5-content-text"])},null,2),[[e.vModelText,e.unref(u)]]),e.createElementVNode("div",{class:e.normalizeClass(["evaluate-content-button",!e.unref(id)&&"evaluate-h5-content-button"])},[e.createElementVNode("button",{class:e.normalizeClass(["btn",e.unref(d)?"btn-valid":"btn-invalid"]),onClick:f},e.toDisplayString(e.unref(Wl).t("Evaluate.提交评价")),3)],2)],2),e.createElementVNode("div",{class:e.normalizeClass(["evaluate-adv",!e.unref(id)&&"evaluate-h5-adv"])},[e.createTextVNode(e.toDisplayString(e.unref(Wl).t("Evaluate.服务评价工具"))+" "+e.toDisplayString("("+e.unref(Wl).t("Evaluate.使用"))+" ",1),e.createElementVNode("a",{onClick:n[1]||(n[1]=t=>{return e.unref(Nh).customMessage,void((id||sd)&&window.open(null==(n=null==Nh?void 0:Nh.customMessage)?void 0:n.url));var n})},e.toDisplayString(e.unref(Wl).t(`Evaluate.${e.unref(Nh).customMessage.label}`)),1),e.createTextVNode(" "+e.toDisplayString(e.unref(Wl).t("Evaluate.搭建")+")"),1)],2)],2)])),_:1},8,["iconFile","iconWidth","iconHeight"]))}}),[["__scopeId","data-v-1eea7078"]]),bh=[{value:"在吗？在吗？在吗？重要的话说三遍。"},{value:"好久没聊天了，快来和我说说话～"},{value:"好的，就这么说定了。"},{value:"感恩的心，感谢有你。"},{value:"糟糕！是心动的感觉！"},{value:"心疼地抱抱自己，我太难了！"},{value:"没关系，别在意，事情过去就过去了。"},{value:"早上好，今天也是让人期待的一天呢！"},{value:"熬夜有什么用，又没人陪你聊天，早点休息吧。"}],Uh=Q(e.defineComponent({__name:"index",emits:["onDialogPopupShowOrHide"],setup(t,{emit:n}){const o="dark"===pp.getTheme()?"/assets/words-dark.6a706f9a.svg":"/assets/words-light.c8aec883.svg",i=n,s=e.ref(),a=e.ref();zl.watch(Sc.CONV,{currentConversation:e=>{s.value=e}});const r=()=>{var e;null==(e=null==a?void 0:a.value)||e.toggleDialogDisplay(!1)},c=()=>{i("onDialogPopupShowOrHide",!0)},u=()=>{i("onDialogPopupShowOrHide",!1)};return(t,n)=>(e.openBlock(),e.createBlock(Sh,{ref_key:"container",ref:a,iconFile:e.unref(o),title:"常用语",needBottomPopup:!0,iconWidth:e.unref(cd)?"26px":"20px",iconHeight:e.unref(cd)?"26px":"20px",onOnDialogShow:c,onOnDialogClose:u},{default:e.withCtx((()=>[e.createElementVNode("div",{class:e.normalizeClass(["words",!e.unref(id)&&"words-h5"])},[e.createElementVNode("div",{class:e.normalizeClass(["words-header",!e.unref(id)&&"words-h5-header"])},[e.createElementVNode("span",{class:e.normalizeClass(["words-header-title",!e.unref(id)&&"words-h5-header-title"])},e.toDisplayString(e.unref(Wl).t("Words.常用语-快捷回复工具")),3),e.unref(id)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("span",{key:0,class:e.normalizeClass(["words-header-close",!e.unref(id)&&"words-h5-header-close"]),onClick:r}," 关闭 ",2))],2),e.createElementVNode("ul",{class:e.normalizeClass(["words-list",!e.unref(id)&&"words-h5-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(bh),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:e.normalizeClass(["words-list-item",!e.unref(id)&&"words-h5-list-item"]),onClick:e=>(e=>{var t,n,o,i,r,c;const u={to:(null==(n=null==(t=null==s?void 0:s.value)?void 0:t.groupProfile)?void 0:n.groupID)||(null==(i=null==(o=null==s?void 0:s.value)?void 0:o.userProfile)?void 0:i.userID),conversationType:null==(r=null==s?void 0:s.value)?void 0:r.type,payload:{text:Wl.t(`Words.${e.value}`)},needReadReceipt:Sd()};Xl.sendTextMessage(u),null==(c=null==a?void 0:a.value)||c.toggleDialogDisplay(!1)})(t)},e.toDisplayString(e.unref(Wl).t(`Words.${t.value}`)),11,["onClick"])))),128))],2)],2)])),_:1},8,["iconFile","iconWidth","iconHeight"]))}}),[["__scopeId","data-v-f2d8a7f7"]]),Gh=Q(e.defineComponent({__name:"emoji-picker-dialog",emits:["insertEmoji","onClose","sendMessage"],setup(t,{emit:n}){var o;const i="dark"===pp.getTheme()?"/assets/face-dark.1ce4b9fa.svg":"/assets/face-light.b3a6acfa.svg",s=n,a=e.ref(0),r=e.ref(),c=e.ref(),u=e.ref(),l=pp.getFeatureConfig(),d=e.ref(qd.filter((e=>e.type===Ud.BASIC?l.InputEmoji:e.type===Ud.BIG?l.InputStickers:void 0))),p=e.ref(null==d?void 0:d.value[0]),h=e.ref(null==(o=null==d?void 0:d.value[0])?void 0:o.list);e.onMounted((()=>{zl.watch(Sc.CONV,{currentConversation:f})})),e.onUnmounted((()=>{zl.unwatch(Sc.CONV,{currentConversation:f})}));const g=(e,t)=>{var n,o,i,s,a;const c={to:(null==(o=null==(n=null==r?void 0:r.value)?void 0:n.groupProfile)?void 0:o.groupID)||(null==(s=null==(i=null==r?void 0:r.value)?void 0:i.userProfile)?void 0:s.userID),conversationType:null==(a=null==r?void 0:r.value)?void 0:a.type,payload:{index:t.emojiGroupID,data:t.list[e]},needReadReceipt:Sd()};Xl.sendFaceMessage(c)};function _(){uni.$emit("send-message-in-emoji-picker")}function f(e){r.value=e}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"emojiPickerDialog",ref:c,class:e.normalizeClass({"emoji-picker":!0,"emoji-picker-h5":!e.unref(id)})},[e.createElementVNode("ul",{ref_key:"emojiPickerListRef",ref:u,class:e.normalizeClass(["emoji-picker-list",!e.unref(id)&&"emoji-picker-h5-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(h),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"emoji-picker-list-item",onClick:e=>((e,t)=>{var n,o,i;const a={emoji:{key:e,name:Bd(e)},type:null==(n=null==p?void 0:p.value)?void 0:n.type};switch(null==(o=null==p?void 0:p.value)?void 0:o.type){case Ud.BASIC:a.url=(null==(i=null==p?void 0:p.value)?void 0:i.url)+Vd[e],cd?uni.$emit("insert-emoji",a):s("insertEmoji",a);break;case Ud.BIG:case Ud.CUSTOM:g(t,p.value)}id&&s("onClose")})(t,n)},[e.unref(p).type===e.unref(Ud).BASIC?(e.openBlock(),e.createElementBlock("img",{key:0,class:"emoji",src:e.unref(p).url+e.unref(Vd)[t]},null,8,["src"])):e.unref(p).type===e.unref(Ud).BIG?(e.openBlock(),e.createElementBlock("img",{key:1,class:"emoji-big",src:e.unref(p).url+t+"@2x.png"},null,8,["src"])):(e.openBlock(),e.createElementBlock("img",{key:2,class:"emoji-custom emoji-big",src:e.unref(p).url+t},null,8,["src"]))],8,["onClick"])))),128))],2),e.createElementVNode("ul",{class:"emoji-picker-tab"},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(d),((t,n)=>(e.openBlock(),e.createElementBlock("li",{key:n,class:"emoji-picker-tab-item",onClick:e=>(e=>{var t;a.value=e,p.value=null==d?void 0:d.value[e],h.value=null==(t=null==d?void 0:d.value[e])?void 0:t.list,cd||(null==u?void 0:u.value)&&(u.value.scrollTop=0)})(n)},[t.type===e.unref(Ud).BASIC?(e.openBlock(),e.createBlock(Id,{key:0,class:"icon",file:e.unref(i)},null,8,["file"])):t.type===e.unref(Ud).BIG?(e.openBlock(),e.createElementBlock("img",{key:1,class:"icon-big",src:t.url+t.list[0]+"@2x.png"},null,8,["src"])):(e.openBlock(),e.createElementBlock("img",{key:2,class:"icon-custom icon-big",src:t.url+t.list[0]},null,8,["src"]))],8,["onClick"])))),128)),e.unref(cd)?(e.openBlock(),e.createElementBlock("li",{key:0,class:"send-btn",onClick:_}," 发送 ")):e.createCommentVNode("",!0)])],2))}}),[["__scopeId","data-v-8341650d"]]),wh=e.defineComponent({__name:"index",props:{type:{type:String,default:""},currentConversation:{type:Object,default:()=>({})},isGroup:{type:Boolean,default:!1}},emits:["submit","cancel"],setup(t,{expose:n,emit:o}){const i=t,s=o,a=e.ref(!1),r=e.ref(""),c=e.ref([]),u=e.ref([]),l=e.ref(""),d={voiceCall:"发起群语音",videoCall:"发起群视频"},p=e.computed((()=>d[i.type]?d[i.type]:""));$l.getUserProfile().then((e=>{var t;(null==(t=null==e?void 0:e.data)?void 0:t.userID)&&(l.value=e.data.userID)})),e.watch((()=>{var e;return[null==(e=null==i?void 0:i.currentConversation)?void 0:e.conversationID,a.value]}),((e,t)=>{e&&e!==t&&(i.isGroup&&a.value?(r.value=i.currentConversation.groupProfile.groupID,Zl.getGroupMemberList({groupID:r.value}).then((e=>{var t,n;c.value=null==(n=null==(t=null==e?void 0:e.data)?void 0:t.memberList)?void 0:n.filter((e=>(null==e?void 0:e.userID)!==l.value)),u.value=c.value}))):(r.value="",c.value=[],u.value=c.value))}),{immediate:!0});const h=e=>{var t;const n=null==(t=c.value)?void 0:t.filter((t=>(null==t?void 0:t.userID)===e));u.value=(null==n?void 0:n.length)?n:c.value},g=e=>{const t=[];null==e||e.forEach((e=>{(null==e?void 0:e.userID)&&t.push(e.userID)})),"voiceCall"===i.type?s("submit",{userIDList:t,groupID:r.value,type:1}):"videoCall"===i.type&&s("submit",{userIDList:t,groupID:r.value,type:2}),u.value=c.value,f(!1)},_=()=>{u.value=c.value,s("cancel"),f(!1)},f=e=>{a.value=e};return n({toggleShow:f}),(t,n)=>(e.openBlock(),e.createBlock(eh,{show:e.unref(a),isH5:!e.unref(id),isHeaderShow:!1,isFooterShow:!1,background:!1,"onUpdate:show":f},{default:e.withCtx((()=>[e.createVNode(Th,{isSearch:!0,title:e.unref(p),list:e.unref(u),isH5:!e.unref(id),isRadio:!1,onSearch:h,onSubmit:g,onCancel:_},null,8,["title","list","isH5"])])),_:1},8,["show","isH5"]))}}),Fh=Q(e.defineComponent({options:{styleIsolation:"shared"},__name:"index",props:{displayType:{}},setup(t){const n=t,o=e.ref(),i=e.ref(!1),s=e.ref(""),a=e.ref(),r=e.ref(),c=e.ref([]),u=e.ref(!1),l=pp.getFeatureConfig(),d=e.ref(8),p=e.ref(0);e.onMounted((()=>{zl.watch(Sc.CUSTOM,{activeConversation:h})})),e.onUnmounted((()=>{zl.unwatch(Sc.CUSTOM,{activeConversation:h})}));const h=e=>{var t;e&&e!==(null==(t=o.value)?void 0:t.conversationID)&&(g(),l.InputImage&&l.InputVideo?d.value-=4:(l.InputImage||l.InputVideo)&&(d.value-=2),p.value=d.value,d.value-=c.value.length,1===d.value?u.value=l.InputEvaluation&&l.InputQuickReplies:d.value<1&&(u.value=l.InputEvaluation||l.InputQuickReplies),o.value=zl.getData(Sc.CONV,"currentConversation"),i.value=e.startsWith(Yl.TYPES.CONV_GROUP))},g=()=>{const e=pp.getChatType(),t={chatType:e};e===b.TUIChat.TYPE.CUSTOMER_SERVICE&&(t.filterVoice=!0,t.filterVideo=!0,Ap("customerService")),c.value=[...$.getExtensionList(b.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,t)].filter((e=>{var t;return"search"!==(null==(t=null==e?void 0:e.data)?void 0:t.name)||l.MessageSearch}))},_=e=>{var t,n,o;const i=c.value.find((t=>{var n,o;return(null==(n=null==t?void 0:t.data)?void 0:n.name)===(null==(o=null==e?void 0:e.data)?void 0:o.name)}));switch(null==(t=null==i?void 0:i.data)?void 0:t.name){case"voiceCall":f(i,1);break;case"videoCall":f(i,2);break;case"search":null==(o=null==(n=null==i?void 0:i.listener)?void 0:n.onClicked)||o.call(n)}},f=(e,t)=>{var n,c,u,l,d,p,h;s.value=null==(n=null==e?void 0:e.data)?void 0:n.name,(null==(c=null==o?void 0:o.value)?void 0:c.type)===Yl.TYPES.CONV_C2C?null==(p=null==(u=null==e?void 0:e.listener)?void 0:u.onClicked)||p.call(u,{userIDList:[null==(d=null==(l=null==o?void 0:o.value)?void 0:l.conversationID)?void 0:d.slice(3)],type:t,callParams:{offlinePushInfo:Hp.getOfflinePushInfo(Bp.CALL)}}):i.value&&(r.value=e,(null==(h=null==a?void 0:a.value)?void 0:h.toggleShow)&&a.value.toggleShow(!0))},m=e=>null==e?void 0:e.icon,v=e=>null==e?void 0:e.text,y=e=>{var t,n,o;null==(o=null==(n=null==(t=r.value)?void 0:t.listener)?void 0:n.onClicked)||o.call(n,{...e,callParams:{offlinePushInfo:Hp.getOfflinePushInfo(Bp.CALL)}}),r.value=null},I=()=>{r.value=null},M=e=>{u.value=d.value<=1&&!e};return(t,r)=>(e.openBlock(),e.createElementBlock("div",{class:e.normalizeClass(["message-input-toolbar","message-input-toolbar-h5","message-input-toolbar-uni"])},["emojiPicker"===n.displayType?(e.openBlock(),e.createElementBlock("div",{key:0},[e.createVNode(Gh)])):(e.openBlock(),e.createElementBlock("div",{key:1},[e.createElementVNode("swiper",{class:e.normalizeClass(["message-input-toolbar-swiper"]),"indicator-dots":e.unref(u),autoplay:!1,circular:!1},[e.createElementVNode("swiper-item",{class:e.normalizeClass(["message-input-toolbar-list","message-input-toolbar-h5-list","message-input-toolbar-uni-list"])},[e.unref(l).InputImage?(e.openBlock(),e.createBlock(Rh,{key:0,imageSourceType:"camera"})):e.createCommentVNode("",!0),e.unref(l).InputImage?(e.openBlock(),e.createBlock(Rh,{key:1,imageSourceType:"album"})):e.createCommentVNode("",!0),e.unref(l).InputVideo?(e.openBlock(),e.createBlock(Oh,{key:2,videoSourceType:"album"})):e.createCommentVNode("",!0),e.unref(l).InputVideo?(e.openBlock(),e.createBlock(Oh,{key:3,videoSourceType:"camera"})):e.createCommentVNode("",!0),e.unref(c).length>0?(e.openBlock(!0),e.createElementBlock(e.Fragment,{key:4},e.renderList(e.unref(c).slice(0,e.unref(p)),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n},[t?(e.openBlock(),e.createBlock(Sh,{key:0,iconFile:m(t),title:v(t),iconWidth:"25px",iconHeight:"25px",needDialog:!1,onOnIconClick:e=>_(t)},null,8,["iconFile","title","onOnIconClick"])):e.createCommentVNode("",!0)])))),128)):e.createCommentVNode("",!0),1===e.unref(d)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:5},[e.unref(l).InputEvaluation?(e.openBlock(),e.createBlock(Ph,{key:0,onOnDialogPopupShowOrHide:M})):e.unref(l).InputQuickReplies?(e.openBlock(),e.createBlock(Uh,{key:1,onOnDialogPopupShowOrHide:M})):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0),e.unref(d)>1?(e.openBlock(),e.createElementBlock(e.Fragment,{key:6},[e.unref(l).InputEvaluation?(e.openBlock(),e.createBlock(Ph,{key:0,onOnDialogPopupShowOrHide:M})):e.createCommentVNode("",!0),e.unref(l).InputQuickReplies?(e.openBlock(),e.createBlock(Uh,{key:1,onOnDialogPopupShowOrHide:M})):e.createCommentVNode("",!0)],64)):e.createCommentVNode("",!0)]),e.unref(d)<=1?(e.openBlock(),e.createElementBlock("swiper-item",{key:0,class:e.normalizeClass(["message-input-toolbar-list","message-input-toolbar-h5-list","message-input-toolbar-uni-list"])},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(c).slice(e.unref(p)),((t,n)=>(e.openBlock(),e.createElementBlock("div",{key:n},[t?(e.openBlock(),e.createBlock(Sh,{key:0,iconFile:m(t),title:v(t),iconWidth:"25px",iconHeight:"25px",needDialog:!1,onOnIconClick:e=>_(t)},null,8,["iconFile","title","onOnIconClick"])):e.createCommentVNode("",!0)])))),128)),1===e.unref(d)?(e.openBlock(),e.createElementBlock(e.Fragment,{key:0},[e.unref(l).InputQuickReplies?(e.openBlock(),e.createBlock(Uh,{key:0,onOnDialogPopupShowOrHide:M})):e.createCommentVNode("",!0)],64)):(e.openBlock(),e.createElementBlock(e.Fragment,{key:1},[e.unref(l).InputEvaluation?(e.openBlock(),e.createBlock(Ph,{key:0,onOnDialogPopupShowOrHide:M})):e.createCommentVNode("",!0),e.unref(l).InputQuickReplies?(e.openBlock(),e.createBlock(Uh,{key:1,onOnDialogPopupShowOrHide:M})):e.createCommentVNode("",!0)],64))])):e.createCommentVNode("",!0)],8,["indicator-dots"])])),e.createVNode(wh,{ref_key:"userSelectorRef",ref:a,type:e.unref(s),currentConversation:e.unref(o),isGroup:e.unref(i),onSubmit:y,onCancel:I},null,8,["type","currentConversation","isGroup"])]))}}),[["__scopeId","data-v-56f7f4f0"]]),xh=Q(e.defineComponent({__name:"index",emits:["closeChat"],setup(t,{emit:n}){m((e=>{(e=>{const{chat:t}=X.getContext();if(e&&e.conversationID&&(null==t?void 0:t.isReady())){const{conversationID:t}=e;if(!t.startsWith("C2C")&&!t.startsWith("GROUP"))return void _("warn","at src/roomkit/TUIKit/components/TUIChat/entry-chat-only.ts:22","conversationID from options is invalid.");Jl.switchConversation(t)}})(e)})),y((()=>{var e;(e=!1,e?X.logout():Promise.resolve()).then((()=>{})).catch((()=>{}))}));const o=n,i=e.ref(void 0),s=e.ref(!1),a=e.ref(!1),r=e.ref(),c=e.ref(),u=e.ref(!1),l=e.ref("none"),d=e.ref(),p=e.ref(),h=e.ref([]),g=pp.getFeatureConfig();e.onMounted((()=>{zl.watch(Sc.CONV,{currentConversation:A})})),e.onUnmounted((()=>{zl.unwatch(Sc.CONV,{currentConversation:A}),I()}));const f=e.computed((()=>!cd||"none"!==l.value)),v=e.computed((()=>{let e="";switch(r.value){case 4:e=Wl.t("TUIChat.您已被管理员移出群聊");break;case 5:e=Wl.t("TUIChat.该群聊已被解散");break;default:e=Wl.t("TUIChat.您已退出该群聊")}return e})),I=()=>{Jl.switchConversation("")},M=e=>{o("closeChat",e),I()},C=e=>{var t;null==(t=d.value)||t.insertEmoji(e)},T=(e,t)=>{var n,o,i;if(e&&t)switch(t){case"reference":case"reply":break;case"reedit":(null==(n=null==e?void 0:e.payload)?void 0:n.text)&&(null==(i=null==d?void 0:d.value)||i.reEdit(null==(o=null==e?void 0:e.payload)?void 0:o.text))}},E=()=>{h.value[0].listener.onClicked({groupID:i.value})};function S(e){l.value=l.value===e?"none":e,"none"!==l.value&&cd&&uni.$emit("scroll-to-bottom")}function D(){var e;null==(e=p.value)||e.scrollToLatestMessage()}function k(e){u.value=void 0===e?!u.value:e}function R(){var e;null==(e=p.value)||e.mergeForwardMessage()}function L(){var e;null==(e=p.value)||e.oneByOneForwardMessage()}function A(e){if(function(e){(null==e?void 0:e.operationType)>0?(h.value=[],a.value=!0,r.value=null==e?void 0:e.operationType):(a.value=!1,r.value=void 0)}(e),!e)return;if(c.value===(null==e?void 0:e.conversationID))return;s.value=!1;let t=Yl.TYPES.CONV_C2C;const n=e.conversationID;if(n.startsWith(Yl.TYPES.CONV_GROUP)&&(t=Yl.TYPES.CONV_GROUP,s.value=!0,i.value=n.replace(Yl.TYPES.CONV_GROUP,"")),h.value=[],u.value=!1,pp.setChatType(t),$.notifyEvent(b.TUIChat.EVENT.CHAT_STATE_CHANGED,b.TUIChat.EVENT_SUB_KEY.CHAT_OPENED,{groupID:i.value}),$.callService({serviceName:b.TUICustomerServicePlugin.SERVICE.NAME,method:b.TUICustomerServicePlugin.SERVICE.METHOD.ACTIVE_CONVERSATION,params:{conversationID:n}}),pp.getChatType()===b.TUIChat.TYPE.ROOM&&!0===pp.getFeatureConfig(b.TUIChat.FEATURE.InputVoice))return pp.setTheme("light"),void(c.value="");pp.getChatType()===b.TUIChat.TYPE.GROUP&&(h.value=$.getExtensionList(b.TUIChat.EXTENSION.CHAT_HEADER.EXT_ID)),zl.update(Sc.CUSTOM,"activeConversation",n),c.value=n}return(t,n)=>(e.openBlock(),e.createElementBlock("div",{class:"chat"},[e.createElementVNode("div",{class:e.normalizeClass(["tui-chat",!e.unref(id)&&"tui-chat-h5"])},[e.unref(c)?e.createCommentVNode("",!0):(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass(["tui-chat-default",!e.unref(id)&&"tui-chat-h5-default"])},[e.renderSlot(t.$slots,"default",{},void 0,!0)],2)),e.unref(c)?(e.openBlock(),e.createElementBlock("div",{key:1,class:e.normalizeClass(["tui-chat",!e.unref(id)&&"tui-chat-h5"])},[e.createVNode(_d,{class:e.normalizeClass(["tui-chat-header",!e.unref(id)&&"tui-chat-H5-header",e.unref(cd)&&"tui-chat-uniapp-header"]),isGroup:e.unref(s),headerExtensionList:e.unref(h),onCloseChat:M,onOpenGroupManagement:E},null,8,["class","isGroup","headerExtensionList"]),e.createVNode(Eh,{onToggleMultipleSelectMode:k}),e.createVNode(ch,{ref_key:"messageListRef",ref:p,class:e.normalizeClass(["tui-chat-message-list",!e.unref(id)&&"tui-chat-h5-message-list"]),isGroup:e.unref(s),groupID:e.unref(i),isNotInGroup:e.unref(a),isMultipleSelectMode:e.unref(u),onHandleEditor:T,onCloseInputToolBar:n[0]||(n[0]=()=>S("none")),onToggleMultipleSelectMode:k},null,8,["class","isGroup","groupID","isNotInGroup","isMultipleSelectMode"]),e.unref(a)?(e.openBlock(),e.createElementBlock("div",{key:0,class:e.normalizeClass({"tui-chat-leave-group":!0,"tui-chat-leave-group-mobile":e.unref(ud)})},e.toDisplayString(e.unref(v)),3)):e.unref(u)?(e.openBlock(),e.createBlock(Ih,{key:1,onOneByOneForwardMessage:L,onMergeForwardMessage:R,onToggleMultipleSelectMode:k})):(e.openBlock(),e.createElementBlock(e.Fragment,{key:2},[e.unref(f)?(e.openBlock(),e.createBlock(Fh,{key:0,class:e.normalizeClass(["tui-chat-message-input-toolbar",!e.unref(id)&&"tui-chat-h5-message-input-toolbar",e.unref(cd)&&"tui-chat-uni-message-input-toolbar"]),displayType:e.unref(l),onInsertEmoji:C,onChangeToolbarDisplayType:S,onScrollToLatestMessage:D},null,8,["class","displayType"])):e.createCommentVNode("",!0),e.createVNode(yh,{ref_key:"messageInputRef",ref:d,class:e.normalizeClass(["tui-chat-message-input",!e.unref(id)&&"tui-chat-h5-message-input",e.unref(cd)&&"tui-chat-uni-message-input",e.unref(ad)&&"tui-chat-wx-message-input"]),enableAt:e.unref(g).InputMention,isMuted:!1,muteText:e.unref(Wl).t("TUIChat.您已被管理员禁言"),placeholder:e.unref(Wl).t("TUIChat.请输入消息"),inputToolbarDisplayType:e.unref(l),onChangeToolbarDisplayType:S},null,8,["class","enableAt","muteText","placeholder","inputToolbarDisplayType"])],64))],2)):e.createCommentVNode("",!0),!e.unref(a)&&!e.unref(rd)&&e.unref(cd)&&e.unref(s)&&e.unref(h).length>0?(e.openBlock(),e.createElementBlock("div",{key:2,class:"group-profile",onClick:E},e.toDisplayString(e.unref(h)[0].text),1)):e.createCommentVNode("",!0)],2)]))}}),[["__scopeId","data-v-42573493"]]);new class{constructor(){this.currentConversationID="",this.currentMessageList=[],$.registerService(b.TUIChat.SERVICE.NAME,this),$.registerEvent(b.TUITheme.EVENT.THEME_CHANGED,b.TUITheme.EVENT_SUB_KEY.CHANGE_SUCCESS,this),$.registerEvent(b.TUIChat.EVENT.CHAT_TYPE_CHANGED,b.TUIChat.EVENT_SUB_KEY.CHANGE_SUCCESS,this),zl.watch(Sc.CONV,{currentConversationID:e=>{this.currentConversationID=e}})}onCall(e,t,n){let o;switch(e){case b.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_LIST:o=t.message,(null==o?void 0:o.conversationID)===this.currentConversationID&&Xl.updateMessageList([o],"push");break;case b.TUIChat.SERVICE.METHOD.SEND_CUSTOM_MESSAGE:Xl.sendCustomMessage(t).then((e=>{n&&n(e)}));break;case b.TUIChat.SERVICE.METHOD.SEND_TEXT_MESSAGE:Xl.sendTextMessage(t).then((e=>{n&&n(e)}));break;case b.TUIChat.SERVICE.METHOD.SET_CHAT_TYPE:pp.setChatType(null==t?void 0:t.chatType);break;case b.TUIChat.SERVICE.METHOD.CLOSE_MESSAGE_POP_MENU:zl.update(Sc.CUSTOM,"isShowMessagePopMenu",!1);break;case b.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_INFO:Xl.updateMessageInfo(null==t?void 0:t.userInfo)}}onNotifyEvent(e,t,n){if(e===b.TUITheme.EVENT.THEME_CHANGED&&t===b.TUITheme.EVENT_SUB_KEY.CHANGE_SUCCESS)(null==n?void 0:n.theme)&&pp.setTheme(n.theme.toLowerCase());if(e===b.TUIChat.EVENT.CHAT_TYPE_CHANGED&&t===b.TUIChat.EVENT_SUB_KEY.CHANGE_SUCCESS)(null==n?void 0:n.chatType)&&pp.setChatType(null==n?void 0:n.chatType)}};const Vh={allMessage:{key:"allMessage",label:"全部",value:[Yl.TYPES.MSG_TEXT,Yl.TYPES.MSG_FILE,Yl.TYPES.MSG_IMAGE,Yl.TYPES.MSG_VIDEO,Yl.TYPES.MSG_AUDIO,Yl.TYPES.MSG_LOCATION,Yl.TYPES.MSG_CUSTOM,Yl.TYPES.MSG_MERGER]},textMessage:{key:"textMessage",label:"文本",value:[Yl.TYPES.MSG_TEXT]},fileMessage:{key:"fileMessage",label:"文件",value:[Yl.TYPES.MSG_FILE]},imageMessage:{key:"imageMessage",label:"图片/视频",value:[Yl.TYPES.MSG_IMAGE,Yl.TYPES.MSG_VIDEO]},otherMessage:{key:"otherMessage",label:"其他",value:[Yl.TYPES.MSG_AUDIO,Yl.TYPES.MSG_LOCATION,Yl.TYPES.MSG_CUSTOM,Yl.TYPES.MSG_MERGER]}};Object.keys(Vh).filter((e=>"all"!==e));const qh=["allMessage","textMessage","fileMessage","otherMessage"];Object.keys(Vh).filter((e=>null==qh?void 0:qh.includes(e))).reduce(((e,t)=>(e[t]=Vh[t],e)),{});const Bh=["textMessage","fileMessage","imageMessage","otherMessage"];Object.keys(Vh).filter((e=>null==Bh?void 0:Bh.includes(e))).reduce(((e,t)=>(e[t]=Vh[t],e)),{});var Hh,jh={exports:{}};function Kh(){return Hh||(Hh=1,function(e){e.exports=function(){var e=1e3,t=6e4,n=36e5,o="millisecond",i="second",s="minute",a="hour",r="day",c="week",u="month",l="quarter",d="year",p="date",h="Invalid Date",g=/^(\d{4})[-/]?(\d{1,2})?[-/]?(\d{0,2})[Tt\s]*(\d{1,2})?:?(\d{1,2})?:?(\d{1,2})?[.:]?(\d+)?$/,_=/\[([^\]]+)]|Y{1,4}|M{1,4}|D{1,2}|d{1,4}|H{1,2}|h{1,2}|a|A|m{1,2}|s{1,2}|Z{1,2}|SSS/g,f={name:"en",weekdays:"Sunday_Monday_Tuesday_Wednesday_Thursday_Friday_Saturday".split("_"),months:"January_February_March_April_May_June_July_August_September_October_November_December".split("_"),ordinal:function(e){var t=["th","st","nd","rd"],n=e%100;return"["+e+(t[(n-20)%10]||t[n]||t[0])+"]"}},m=function(e,t,n){var o=String(e);return!o||o.length>=t?e:""+Array(t+1-o.length).join(n)+e},v={s:m,z:function(e){var t=-e.utcOffset(),n=Math.abs(t),o=Math.floor(n/60),i=n%60;return(t<=0?"+":"-")+m(o,2,"0")+":"+m(i,2,"0")},m:function e(t,n){if(t.date()<n.date())return-e(n,t);var o=12*(n.year()-t.year())+(n.month()-t.month()),i=t.clone().add(o,u),s=n-i<0,a=t.clone().add(o+(s?-1:1),u);return+(-(o+(n-i)/(s?i-a:a-i))||0)},a:function(e){return e<0?Math.ceil(e)||0:Math.floor(e)},p:function(e){return{M:u,y:d,w:c,d:r,D:p,h:a,m:s,s:i,ms:o,Q:l}[e]||String(e||"").toLowerCase().replace(/s$/,"")},u:function(e){return void 0===e}},y="en",I={};I[y]=f;var M="$isDayjsObject",C=function(e){return e instanceof D||!(!e||!e[M])},T=function e(t,n,o){var i;if(!t)return y;if("string"==typeof t){var s=t.toLowerCase();I[s]&&(i=s),n&&(I[s]=n,i=s);var a=t.split("-");if(!i&&a.length>1)return e(a[0])}else{var r=t.name;I[r]=t,i=r}return!o&&i&&(y=i),i||!o&&y},E=function(e,t){if(C(e))return e.clone();var n="object"==typeof t?t:{};return n.date=e,n.args=arguments,new D(n)},S=v;S.l=T,S.i=C,S.w=function(e,t){return E(e,{locale:t.$L,utc:t.$u,x:t.$x,$offset:t.$offset})};var D=function(){function f(e){this.$L=T(e.locale,null,!0),this.parse(e),this.$x=this.$x||e.x||{},this[M]=!0}var m=f.prototype;return m.parse=function(e){this.$d=function(e){var t=e.date,n=e.utc;if(null===t)return new Date(NaN);if(S.u(t))return new Date;if(t instanceof Date)return new Date(t);if("string"==typeof t&&!/Z$/i.test(t)){var o=t.match(g);if(o){var i=o[2]-1||0,s=(o[7]||"0").substring(0,3);return n?new Date(Date.UTC(o[1],i,o[3]||1,o[4]||0,o[5]||0,o[6]||0,s)):new Date(o[1],i,o[3]||1,o[4]||0,o[5]||0,o[6]||0,s)}}return new Date(t)}(e),this.init()},m.init=function(){var e=this.$d;this.$y=e.getFullYear(),this.$M=e.getMonth(),this.$D=e.getDate(),this.$W=e.getDay(),this.$H=e.getHours(),this.$m=e.getMinutes(),this.$s=e.getSeconds(),this.$ms=e.getMilliseconds()},m.$utils=function(){return S},m.isValid=function(){return!(this.$d.toString()===h)},m.isSame=function(e,t){var n=E(e);return this.startOf(t)<=n&&n<=this.endOf(t)},m.isAfter=function(e,t){return E(e)<this.startOf(t)},m.isBefore=function(e,t){return this.endOf(t)<E(e)},m.$g=function(e,t,n){return S.u(e)?this[t]:this.set(n,e)},m.unix=function(){return Math.floor(this.valueOf()/1e3)},m.valueOf=function(){return this.$d.getTime()},m.startOf=function(e,t){var n=this,o=!!S.u(t)||t,l=S.p(e),h=function(e,t){var i=S.w(n.$u?Date.UTC(n.$y,t,e):new Date(n.$y,t,e),n);return o?i:i.endOf(r)},g=function(e,t){return S.w(n.toDate()[e].apply(n.toDate("s"),(o?[0,0,0,0]:[23,59,59,999]).slice(t)),n)},_=this.$W,f=this.$M,m=this.$D,v="set"+(this.$u?"UTC":"");switch(l){case d:return o?h(1,0):h(31,11);case u:return o?h(1,f):h(0,f+1);case c:var y=this.$locale().weekStart||0,I=(_<y?_+7:_)-y;return h(o?m-I:m+(6-I),f);case r:case p:return g(v+"Hours",0);case a:return g(v+"Minutes",1);case s:return g(v+"Seconds",2);case i:return g(v+"Milliseconds",3);default:return this.clone()}},m.endOf=function(e){return this.startOf(e,!1)},m.$set=function(e,t){var n,c=S.p(e),l="set"+(this.$u?"UTC":""),h=(n={},n[r]=l+"Date",n[p]=l+"Date",n[u]=l+"Month",n[d]=l+"FullYear",n[a]=l+"Hours",n[s]=l+"Minutes",n[i]=l+"Seconds",n[o]=l+"Milliseconds",n)[c],g=c===r?this.$D+(t-this.$W):t;if(c===u||c===d){var _=this.clone().set(p,1);_.$d[h](g),_.init(),this.$d=_.set(p,Math.min(this.$D,_.daysInMonth())).$d}else h&&this.$d[h](g);return this.init(),this},m.set=function(e,t){return this.clone().$set(e,t)},m.get=function(e){return this[S.p(e)]()},m.add=function(o,l){var p,h=this;o=Number(o);var g=S.p(l),_=function(e){var t=E(h);return S.w(t.date(t.date()+Math.round(e*o)),h)};if(g===u)return this.set(u,this.$M+o);if(g===d)return this.set(d,this.$y+o);if(g===r)return _(1);if(g===c)return _(7);var f=(p={},p[s]=t,p[a]=n,p[i]=e,p)[g]||1,m=this.$d.getTime()+o*f;return S.w(m,this)},m.subtract=function(e,t){return this.add(-1*e,t)},m.format=function(e){var t=this,n=this.$locale();if(!this.isValid())return n.invalidDate||h;var o=e||"YYYY-MM-DDTHH:mm:ssZ",i=S.z(this),s=this.$H,a=this.$m,r=this.$M,c=n.weekdays,u=n.months,l=n.meridiem,d=function(e,n,i,s){return e&&(e[n]||e(t,o))||i[n].slice(0,s)},p=function(e){return S.s(s%12||12,e,"0")},g=l||function(e,t,n){var o=e<12?"AM":"PM";return n?o.toLowerCase():o};return o.replace(_,(function(e,o){return o||function(e){switch(e){case"YY":return String(t.$y).slice(-2);case"YYYY":return S.s(t.$y,4,"0");case"M":return r+1;case"MM":return S.s(r+1,2,"0");case"MMM":return d(n.monthsShort,r,u,3);case"MMMM":return d(u,r);case"D":return t.$D;case"DD":return S.s(t.$D,2,"0");case"d":return String(t.$W);case"dd":return d(n.weekdaysMin,t.$W,c,2);case"ddd":return d(n.weekdaysShort,t.$W,c,3);case"dddd":return c[t.$W];case"H":return String(s);case"HH":return S.s(s,2,"0");case"h":return p(1);case"hh":return p(2);case"a":return g(s,a,!0);case"A":return g(s,a,!1);case"m":return String(a);case"mm":return S.s(a,2,"0");case"s":return String(t.$s);case"ss":return S.s(t.$s,2,"0");case"SSS":return S.s(t.$ms,3,"0");case"Z":return i}return null}(e)||i.replace(":","")}))},m.utcOffset=function(){return 15*-Math.round(this.$d.getTimezoneOffset()/15)},m.diff=function(o,p,h){var g,_=this,f=S.p(p),m=E(o),v=(m.utcOffset()-this.utcOffset())*t,y=this-m,I=function(){return S.m(_,m)};switch(f){case d:g=I()/12;break;case u:g=I();break;case l:g=I()/3;break;case c:g=(y-v)/6048e5;break;case r:g=(y-v)/864e5;break;case a:g=y/n;break;case s:g=y/t;break;case i:g=y/e;break;default:g=y}return h?g:S.a(g)},m.daysInMonth=function(){return this.endOf(u).$D},m.$locale=function(){return I[this.$L]},m.locale=function(e,t){if(!e)return this.$L;var n=this.clone(),o=T(e,t,!0);return o&&(n.$L=o),n},m.clone=function(){return S.w(this.$d,this)},m.toDate=function(){return new Date(this.valueOf())},m.toJSON=function(){return this.isValid()?this.toISOString():null},m.toISOString=function(){return this.$d.toISOString()},m.toString=function(){return this.$d.toUTCString()},f}(),k=D.prototype;return E.prototype=k,[["$ms",o],["$s",i],["$m",s],["$H",a],["$W",r],["$M",u],["$y",d],["$D",p]].forEach((function(e){k[e[1]]=function(t){return this.$g(t,e[0],e[1])}})),E.extend=function(e,t){return e.$i||(e(t,D,E),e.$i=!0),E},E.locale=T,E.isDayjs=C,E.unix=function(e){return E(1e3*e)},E.en=I[y],E.Ls=I,E.p={},E}()}(jh)),jh.exports}Kh();!function(e){e.exports=function(e,t,n){var o=t.prototype,i=function(e){return e&&(e.indexOf?e:e.s)},s=function(e,t,n,o,s){var a=e.name?e:e.$locale(),r=i(a[t]),c=i(a[n]),u=r||c.map((function(e){return e.slice(0,o)}));if(!s)return u;var l=a.weekStart;return u.map((function(e,t){return u[(t+(l||0))%7]}))},a=function(){return n.Ls[n.locale()]},r=function(e,t){return e.formats[t]||e.formats[t.toUpperCase()].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,(function(e,t,n){return t||n.slice(1)}))},c=function(){var e=this;return{months:function(t){return t?t.format("MMMM"):s(e,"months")},monthsShort:function(t){return t?t.format("MMM"):s(e,"monthsShort","months",3)},firstDayOfWeek:function(){return e.$locale().weekStart||0},weekdays:function(t){return t?t.format("dddd"):s(e,"weekdays")},weekdaysMin:function(t){return t?t.format("dd"):s(e,"weekdaysMin","weekdays",2)},weekdaysShort:function(t){return t?t.format("ddd"):s(e,"weekdaysShort","weekdays",3)},longDateFormat:function(t){return r(e.$locale(),t)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};o.localeData=function(){return c.bind(this)()},n.localeData=function(){var e=a();return{firstDayOfWeek:function(){return e.weekStart||0},weekdays:function(){return n.weekdays()},weekdaysShort:function(){return n.weekdaysShort()},weekdaysMin:function(){return n.weekdaysMin()},months:function(){return n.months()},monthsShort:function(){return n.monthsShort()},longDateFormat:function(t){return r(e,t)},meridiem:e.meridiem,ordinal:e.ordinal}},n.months=function(){return s(a(),"months")},n.monthsShort=function(){return s(a(),"monthsShort","months",3)},n.weekdays=function(e){return s(a(),"weekdays",null,null,e)},n.weekdaysShort=function(e){return s(a(),"weekdaysShort","weekdays",3,e)},n.weekdaysMin=function(e){return s(a(),"weekdaysMin","weekdays",2,e)}}}({exports:{}});!function(e){e.exports=function(e,t){t.prototype.isSameOrAfter=function(e,t){return this.isSame(e,t)||this.isAfter(e,t)}}}({exports:{}});!function(e){e.exports=function(e,t){t.prototype.isSameOrBefore=function(e,t){return this.isSame(e,t)||this.isBefore(e,t)}}}({exports:{}});!function(e){e.exports=function(e){function t(e){return e&&"object"==typeof e&&"default"in e?e:{default:e}}var n=t(e),o={name:"zh-cn",weekdays:"星期日_星期一_星期二_星期三_星期四_星期五_星期六".split("_"),weekdaysShort:"周日_周一_周二_周三_周四_周五_周六".split("_"),weekdaysMin:"日_一_二_三_四_五_六".split("_"),months:"一月_二月_三月_四月_五月_六月_七月_八月_九月_十月_十一月_十二月".split("_"),monthsShort:"1月_2月_3月_4月_5月_6月_7月_8月_9月_10月_11月_12月".split("_"),ordinal:function(e,t){return"W"===t?e+"周":e+"日"},weekStart:1,yearStart:4,formats:{LT:"HH:mm",LTS:"HH:mm:ss",L:"YYYY/MM/DD",LL:"YYYY年M月D日",LLL:"YYYY年M月D日Ah点mm分",LLLL:"YYYY年M月D日ddddAh点mm分",l:"YYYY/M/D",ll:"YYYY年M月D日",lll:"YYYY年M月D日 HH:mm",llll:"YYYY年M月D日dddd HH:mm"},relativeTime:{future:"%s内",past:"%s前",s:"几秒",m:"1 分钟",mm:"%d 分钟",h:"1 小时",hh:"%d 小时",d:"1 天",dd:"%d 天",M:"1 个月",MM:"%d 个月",y:"1 年",yy:"%d 年"},meridiem:function(e,t){var n=100*e+t;return n<600?"凌晨":n<900?"早上":n<1100?"上午":n<1300?"中午":n<1800?"下午":"晚上"}};return n.default.locale(o,null,!0),o}(Kh())}({exports:{}}),Yl.TYPES.MSG_TEXT,Yl.TYPES.MSG_IMAGE,Yl.TYPES.MSG_AUDIO,Yl.TYPES.MSG_VIDEO,Yl.TYPES.MSG_FILE,Yl.TYPES.MSG_CUSTOM,Yl.TYPES.MSG_SYSTEM,Yl.TYPES.MSG_MERGER,Yl.TYPES.MSG_LOCATION;class Yh{constructor(){this.hideConversationHeader=()=>{zl.update(Sc.CUSTOM,"isShowConversationHeader",!1)},$.registerService(b.TUIConversation.SERVICE.NAME,this),$.registerExtension(b.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=b}static getInstance(){return Yh.instance||(Yh.instance=new Yh),Yh.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}onCall(e,t,n){switch(this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,n),e){case b.TUIConversation.SERVICE.METHOD.CREATE_CONVERSATION:this.createConversation(t);break;case b.TUIConversation.SERVICE.METHOD.HIDE_CONVERSATION_HEADER:this.hideConversationHeader()}}onGetExtension(e){if(e===b.TUISearch.EXTENSION.SEARCH_MORE.EXT_ID){return[{weight:100,icon:"/assets/icon-c2c.d80299ab.svg",text:Wl.t("TUIConversation.发起单聊"),data:{name:Nd},listener:{onClicked:this.createConversation.bind(this)}},{weight:100,icon:"/assets/start-group.6d6b5fbb.svg",text:Wl.t("TUIConversation.发起群聊"),data:{name:Pd},listener:{onClicked:this.createConversation.bind(this)}}]}}createConversation(e){$.callService({serviceName:b.TUIContact.SERVICE.NAME,method:b.TUIContact.SERVICE.METHOD.SELECT_FRIEND,params:{title:e.text,isRadio:e.data.name!==Pd,isNeedSearch:!zl.getData(Sc.APP,"isOfficial")},callback:async t=>{if(!t||0===t.length)return this.routerForward(null);if(e.data.name===Pd)this.createGroup(t);else{const{userID:e}=t[0];await this.generateConversation(`C2C${e}`),this.routerForward(`C2C${e}`)}}})}createGroup(e){$.callService({serviceName:b.TUIGroup.SERVICE.NAME,method:b.TUIGroup.SERVICE.METHOD.CREATE_GROUP,params:{title:Wl.t("TUIConversation.发起群聊"),memberList:e},callback:async e=>{let t=null;if(e){const{groupID:n}=e;await this.generateConversation(`GROUP${n}`),t=`GROUP${n}`}this.routerForward(t)}})}async routerForward(e){cd&&(await(null==be?void 0:be.reLaunch({url:"/TUIKit/components/TUIConversation/index"})),e&&(null==be||be.navigateTo({url:"/TUIKit/components/TUIChat/index"})))}generateConversation(e){Jl.switchConversation(e).then((()=>{e.startsWith("GROUP")&&Ap("groupChat"),_("warn","at src/roomkit/TUIKit/components/TUIConversation/server.ts:153","打开会话成功")})).catch((e=>{_("warn","at src/roomkit/TUIKit/components/TUIConversation/server.ts:156","打开会话失败",e.code,e.msg)}))}}new Yh;new class{constructor(){$.registerService(b.TUISearch.SERVICE.NAME,this),$.registerExtension(b.TUIChat.EXTENSION.INPUT_MORE.EXT_ID,this)}onCall(e,t){switch(e){case b.TUISearch.SERVICE.METHOD.SEARCH_GROUP:return this.searchGroup(null==t?void 0:t.groupID);case b.TUISearch.SERVICE.METHOD.SEARCH_USER:return this.searchUser(null==t?void 0:t.userID);case b.TUISearch.SERVICE.METHOD.SEARCH_FRIEND:return this.searchFriend(null==t?void 0:t.userID);case b.TUISearch.SERVICE.METHOD.SEARCH_GROUP_MEMBER:return this.searchGroupMember(null==t?void 0:t.groupID,null==t?void 0:t.userID)}}onGetExtension(e){if(e===b.TUIChat.EXTENSION.INPUT_MORE.EXT_ID){const e=[],t={weight:3e3,text:"搜索",icon:"https://web.sdk.qcloud.com/component/TUIKit/assets/message-search.svg",data:{name:"search"},listener:{onClicked:()=>{zl.update(Sc.SEARCH,"isShowInConversationSearch",!0),cd&&(null==be||be.navigateTo({url:"/TUIKit/components/TUISearch/index"}))}}};return e.push(t),e}}async searchFriend(e){return Ql.getFriendProfile({userIDList:[e]})}async searchUser(e){return $l.getUserProfile({userIDList:[e]})}async searchGroup(e){return Zl.searchGroupByID(e)}async searchGroupMember(e,t){return Zl.getGroupMemberProfile({groupID:e,userIDList:[t]})}};class zh{constructor(){$.registerService(b.TUIContact.SERVICE.NAME,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=b}static getInstance(){return zh.instance||(zh.instance=new zh),zh.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}async onCall(e,t,n){this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,n),e===b.TUIContact.SERVICE.METHOD.SELECT_FRIEND&&(zl.update(Sc.CUSTOM,"isShowSelectFriendComponent",!0),cd&&(null==be||be.reLaunch({url:"/TUIKit/components/TUIContact/index"})))}}zh.getInstance(),Yl.TYPES.GRP_PUBLIC,Yl.TYPES.GRP_MEETING,Yl.TYPES.GRP_WORK,Yl.TYPES.GRP_AVCHATROOM,Yl.TYPES.GRP_COMMUNITY;class Wh{constructor(){$.registerService(b.TUIGroup.SERVICE.NAME,this),$.registerExtension(b.TUIChat.EXTENSION.CHAT_HEADER.EXT_ID,this),this.onCallParamsMap=new Map,this.onCallCallbackMap=new Map,this.constants=b}static getInstance(){return Wh.instance||(Wh.instance=new Wh),Wh.instance}getOnCallParams(e){return this.onCallParamsMap.get(e)}getOnCallCallback(e){return this.onCallCallbackMap.get(e)}async onCall(e,t,n){switch(this.onCallParamsMap.set(e,t),this.onCallCallbackMap.set(e,n),e){case b.TUIGroup.SERVICE.METHOD.CREATE_GROUP:zl.update(Sc.GRP,"isShowCreateComponent",!0),cd&&(null==be||be.reLaunch({url:"/TUIKit/components/TUIGroup/index"}));break;case b.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT:Zl.switchGroup(t.groupID),zl.update(Sc.GRP,"isShowManageComponent",!0),cd&&(null==be||be.navigateTo({url:"/TUIKit/components/TUIGroup/index"}));break;case b.TUIGroup.SERVICE.METHOD.SELECT_GROUP_MEMBER:Zl.switchGroup(t.groupID),zl.update(Sc.GRP,"isShowSelectComponent",!0),cd&&(null==be||be.navigateTo({url:"/TUIKit/components/TUIGroup/index"}))}}onGetExtension(e){const t=[];if(e===b.TUIChat.EXTENSION.CHAT_HEADER.EXT_ID)t.push({weight:100,icon:"/assets/setting.a15e5daf.svg",text:"更多",data:{},listener:{onClicked:this.groupManage.bind(this)}});return t}groupManage(e){$.callService({serviceName:b.TUIGroup.SERVICE.NAME,method:b.TUIGroup.SERVICE.METHOD.OPEN_GROUP_MANAGEMENT,params:e,callback:()=>{cd&&(null==be||be.navigateBack())}})}}Wh.getInstance();function Jh(){const{chat:e}=X.getContext();uni.$tim=e;uni.$once("update-message-info",(e=>{(e=>{$.callService({serviceName:b.TUIChat.SERVICE.NAME,method:b.TUIChat.SERVICE.METHOD.UPDATE_MESSAGE_INFO,params:{userInfo:e}})})(e)}))}(new class e{constructor(){this.TUIComponents={},this.TUIPlugins={},this.TUICore=$,this.TUIChatEngine=Yl,this.TUIGlobal=be,this.SDKAppID=0,this.TUIGlobal._isTIMCallKit=!0,$.registerEvent(b.TUILogin.EVENT.LOGIN_STATE_CHANGED,b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS,this),$.registerEvent(b.TUITranslate.EVENT.LANGUAGE_CHANGED,b.TUITranslate.EVENT_SUB_KEY.CHANGE_SUCCESS,this),$.registerService(b.TUITranslatePlugin.SERVICE.NAME,1),$.registerService(b.TUIVoiceToTextPlugin.SERVICE.NAME,1)}onNotifyEvent(e,t,n){if(e===b.TUILogin.EVENT.LOGIN_STATE_CHANGED&&t===b.TUILogin.EVENT_SUB_KEY.USER_LOGIN_SUCCESS)this.login();if(e===b.TUITranslate.EVENT.LANGUAGE_CHANGED&&t===b.TUITranslate.EVENT_SUB_KEY.CHANGE_SUCCESS)(null==n?void 0:n.language)&&Wl.changeLanguage(n.language)}init(){e.isInitialized||(e.isInitialized=!0,rd&&new ld,Wl.provideLanguages({...hd}),Wl.useI18n(),be.TUIComponents=this.TUIComponents,be.TUIPlugins=this.TUIPlugins,_("warn","at src/roomkit/TUIKit/server.ts:79","[TUIChatKit]: init success."))}login(){const{chat:e,SDKAppID:t,userID:n,userSig:o}=X.getContext();return this.SDKAppID=t,this.TUIChatEngine.login({chat:e,SDKAppID:t,userID:n,userSig:o}),this.chat=e,this.TUIChatEngine}component(e,t,n){var o,i;return(null==(o=null==this?void 0:this.TUIComponents)?void 0:o.componentName)?_("warn","at src/roomkit/TUIKit/server.ts:108",`[TUIChatKit]: ${null==(i=null==this?void 0:this.TUIComponents)?void 0:i.componentName} component has already been applied to target TUIChatEngine.`):(this.TUIComponents[e]=t,null==n||n.component(e,t)),n&&!be.Vue&&(be.Vue=n),this.TUIChatEngine}components(e,t){var n,o;return e&&(null!==(o=e)&&"object"==typeof o)?null==(n=null==Object?void 0:Object.keys(e))||n.forEach((n=>{this.component(n,e[n],t)})):_("warn","at src/roomkit/TUIKit/server.ts:130","[TUIChatKit]: components is empty or not object."),this.TUIChatEngine}use(e,t,n){if(this.TUICore)return this.TUIPlugins[e]?_("warn","at src/roomkit/TUIKit/server.ts:154",`[TUIChatKit]: Plugin ${this.TUIPlugins[e]} has already been applied to target TUIChatEngine.`):t&&td(null==t?void 0:t.plugin)?(this.TUIPlugins[e]=t,null==t||t.plugin(this,n)):td(t)?(this.TUIPlugins[e]=t,t(this,n)):_("warn","at src/roomkit/TUIKit/server.ts:164",'[TUIChatKit]: A plugin must either be a function or an object with an "plugin" function.'+this.TUIPlugins[e]+"does not comply with the above rules."),this.TUIChatEngine;_("warn","at src/roomkit/TUIKit/server.ts:148",`[TUIChatKit]: Plugin ${this.TUIPlugins[e]} can't be used before init.`)}}).init();const $h=Q(e.defineComponent({__name:"home",setup(t){const n=e.reactive({userId:"",userName:"",avatarUrl:""}),o=ot();function i(e,t){uni.setStorageSync("tuiRoom-roomInfo",JSON.stringify({action:e,...t}))}async function s(e){i("createRoom",e);const t=await async function(){return String(Math.ceil(1e6*Math.random()))}();p.replace({path:"room",query:{roomId:t}})}async function a(e){i("enterRoom",e),p.replace({path:"room",query:{roomId:e.roomId}})}return async function(){uni.removeStorageSync("tuiRoom-roomInfo"),uni.removeStorageSync("tuiRoom-userInfo");const e=function(){if(vc===Number(0)||yc===String(""))return void alert("Please configure your SDKAPPID in config/basic-info-config.js");const e=new mc(vc,yc,604800).genTestUserSig(Ic.userId),{userId:t,userName:n,avatarUrl:o}=Ic;return{sdkAppId:vc,userId:t,userSig:e,userName:n,avatarUrl:o}}();if(!e)return;uni.setStorageSync("tuiRoom-userInfo",JSON.stringify(e)),o.setBasicInfo(e),n.userName=e.userName,n.avatarUrl=e.avatarUrl,n.userId=e.userId;const{sdkAppId:t,userSig:i}=e;X.login({SDKAppID:t,userID:n.userId,userSig:i,useUploadPlugin:!0}),Jh()}(),(t,o)=>(e.openBlock(),e.createElementBlock("div",{class:"home-container"},[e.createVNode(Vo,{"user-info":n,onOnCreateRoom:s,onOnEnterRoom:a},null,8,["user-info"])]))}}),[["__scopeId","data-v-33b9890b"]]),Xh=Q(e.defineComponent({__name:"video-play",setup(t){const n=e.ref(),o=e.ref(!1),i=e.ref();return m((e=>{const t=decodeURIComponent(null==e?void 0:e.videoUrl);n.value=t,o.value=!0})),v((()=>{o.value=!0,i.value=be.createVideoContext("videoEle")})),(t,i)=>(e.openBlock(),e.createElementBlock("div",{class:"dialog-video"},[e.unref(o)?(e.openBlock(),e.createElementBlock("video",{key:0,id:"videoEle",class:"video-box",src:e.unref(n),controls:"",autoplay:""},null,8,["src"])):e.createCommentVNode("",!0)]))}}),[["__scopeId","data-v-7ade96e3"]]);__definePage("pages/index/index",h),__definePage("src/roomkit/pages/home",$h),__definePage("src/roomkit/TUIKit/components/TUIChat/index",xh),__definePage("src/roomkit/TUIKit/components/TUIChat/video-play",Xh);const Zh={onLaunch(){_("log","at App.vue:4","App Launch")},onShow(){_("log","at App.vue:7","App Show")},onHide(){_("log","at App.vue:10","App Hide")}};const{app:Qh,Vuex:eg,Pinia:tg}=function(){const t=e.createVueApp(Zh);return t.use(ge()),{app:t,Pinia:Re}}();uni.Vuex=eg,uni.Pinia=tg,Qh.provide("__globalStyles",__uniConfig.styles),Qh._component.mpType="app",Qh._component.render=()=>{},Qh.mount("#app")}(Vue);

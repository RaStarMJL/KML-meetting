"use weex:vue";

if (typeof Promise !== 'undefined' && !Promise.prototype.finally) {
  Promise.prototype.finally = function(callback) {
    const promise = this.constructor
    return this.then(
      value => promise.resolve(callback()).then(() => value),
      reason => promise.resolve(callback()).then(() => {
        throw reason
      })
    )
  }
};

if (typeof uni !== 'undefined' && uni && uni.requireGlobal) {
  const global = uni.requireGlobal()
  ArrayBuffer = global.ArrayBuffer
  Int8Array = global.Int8Array
  Uint8Array = global.Uint8Array
  Uint8ClampedArray = global.Uint8ClampedArray
  Int16Array = global.Int16Array
  Uint16Array = global.Uint16Array
  Int32Array = global.Int32Array
  Uint32Array = global.Uint32Array
  Float32Array = global.Float32Array
  Float64Array = global.Float64Array
  BigInt64Array = global.BigInt64Array
  BigUint64Array = global.BigUint64Array
};


(()=>{var dh=Object.create;var $d=Object.defineProperty,ph=Object.defineProperties,gh=Object.getOwnPropertyDescriptor,hh=Object.getOwnPropertyDescriptors,_h=Object.getOwnPropertyNames,Hp=Object.getOwnPropertySymbols,fh=Object.getPrototypeOf,Wp=Object.prototype.hasOwnProperty,mh=Object.prototype.propertyIsEnumerable;var Kp=(f,g,T)=>g in f?$d(f,g,{enumerable:!0,configurable:!0,writable:!0,value:T}):f[g]=T,Xd=(f,g)=>{for(var T in g||(g={}))Wp.call(g,T)&&Kp(f,T,g[T]);if(Hp)for(var T of Hp(g))mh.call(g,T)&&Kp(f,T,g[T]);return f},jp=(f,g)=>ph(f,hh(g));var Yp=(f,g)=>()=>(g||f((g={exports:{}}).exports,g),g.exports);var vh=(f,g,T,v)=>{if(g&&typeof g=="object"||typeof g=="function")for(let w of _h(g))!Wp.call(f,w)&&w!==T&&$d(f,w,{get:()=>g[w],enumerable:!(v=gh(g,w))||v.enumerable});return f};var Qd=(f,g,T)=>(T=f!=null?dh(fh(f)):{},vh(g||!f||!f.__esModule?$d(T,"default",{value:f,enumerable:!0}):T,f));var Oe=(f,g,T)=>new Promise((v,w)=>{var N=H=>{try{V(T.next(H))}catch(z){w(z)}},B=H=>{try{V(T.throw(H))}catch(z){w(z)}},V=H=>H.done?v(H.value):Promise.resolve(H.value).then(N,B);V((T=T.apply(f,g)).next())});var Zd=Yp((ov,zp)=>{zp.exports=Vue});var $p=Yp((iv,Jp)=>{Jp.exports=uni.Pinia});var fo=Qd(Zd()),h=Qd(Zd()),Mt=Qd($p());var Xp,Qp;function Lu(f){return weex.requireModule(f)}function st(f,g,...T){uni.__log__?uni.__log__(f,g,...T):console[f].apply(console,[...T,g])}function xt(f,g,T,v){var w,N=arguments.length,B=N<3?g:v===null?v=Object.getOwnPropertyDescriptor(g,T):v;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")B=Reflect.decorate(f,g,T,v);else for(var V=f.length-1;V>=0;V--)(w=f[V])&&(B=(N<3?w(B):N>3?w(g,T,B):w(g,T))||B);return N>3&&B&&Object.defineProperty(g,T,B),B}function je(f,g,T,v){return new(T||(T=Promise))(function(w,N){function B(z){try{H(v.next(z))}catch(ne){N(ne)}}function V(z){try{H(v.throw(z))}catch(ne){N(ne)}}function H(z){var ne;z.done?w(z.value):(ne=z.value,ne instanceof T?ne:new T(function(ge){ge(ne)})).then(B,V)}H((v=v.apply(f,g||[])).next())})}var Tn,Et,xo,Nl,jt,Zp,ar,ji,qo,eg,bl,Du,Jr,Hn,tg,Pl,Yn,rp,ng,og,ig,ag,sg,rg,it,Gl,cg,ug;typeof SuppressedError=="function"&&SuppressedError,function(f){f[f.ERR_SUCC=0]="ERR_SUCC",f[f.ERR_FAILED=-1]="ERR_FAILED",f[f.ERR_FREQ_LIMIT=-2]="ERR_FREQ_LIMIT",f[f.ERR_REPEAT_OPERATION=-3]="ERR_REPEAT_OPERATION",f[f.ERR_SDKAPPID_NOT_FOUND=-1e3]="ERR_SDKAPPID_NOT_FOUND",f[f.ERR_INVALID_PARAMETER=-1001]="ERR_INVALID_PARAMETER",f[f.ERR_SDK_NOT_INITIALIZED=-1002]="ERR_SDK_NOT_INITIALIZED",f[f.ERR_PERMISSION_DENIED=-1003]="ERR_PERMISSION_DENIED",f[f.ERR_REQUIRE_PAYMENT=-1004]="ERR_REQUIRE_PAYMENT",f[f.ERR_CAMERA_START_FAILED=-1100]="ERR_CAMERA_START_FAILED",f[f.ERR_CAMERA_NOT_AUTHORIZED=-1101]="ERR_CAMERA_NOT_AUTHORIZED",f[f.ERR_CAMERA_OCCUPIED=-1102]="ERR_CAMERA_OCCUPIED",f[f.ERR_CAMERA_DEVICE_EMPTY=-1103]="ERR_CAMERA_DEVICE_EMPTY",f[f.ERR_MICROPHONE_START_FAILED=-1104]="ERR_MICROPHONE_START_FAILED",f[f.ERR_MICROPHONE_NOT_AUTHORIZED=-1105]="ERR_MICROPHONE_NOT_AUTHORIZED",f[f.ERR_MICROPHONE_OCCUPIED=-1106]="ERR_MICROPHONE_OCCUPIED",f[f.ERR_MICROPHONE_DEVICE_EMPTY=-1107]="ERR_MICROPHONE_DEVICE_EMPTY",f[f.ERR_GET_SCREEN_SHARING_TARGET_FAILED=-1108]="ERR_GET_SCREEN_SHARING_TARGET_FAILED",f[f.ERR_START_SCREEN_SHARING_FAILED=-1109]="ERR_START_SCREEN_SHARING_FAILED",f[f.ERR_ROOM_ID_NOT_EXIST=-2100]="ERR_ROOM_ID_NOT_EXIST",f[f.ERR_OPERATION_INVALID_BEFORE_ENTER_ROOM=-2101]="ERR_OPERATION_INVALID_BEFORE_ENTER_ROOM",f[f.ERR_EXIT_NOT_SUPPORTED_FOR_ROOM_OWNER=-2102]="ERR_EXIT_NOT_SUPPORTED_FOR_ROOM_OWNER",f[f.ERR_OPERATION_NOT_SUPPORTED_IN_CURRENT_ROOM_TYPE=-2103]="ERR_OPERATION_NOT_SUPPORTED_IN_CURRENT_ROOM_TYPE",f[f.ERR_ROOM_ID_INVALID=-2105]="ERR_ROOM_ID_INVALID",f[f.ERR_ROOM_ID_OCCUPIED=-2106]="ERR_ROOM_ID_OCCUPIED",f[f.ERR_ROOM_NAME_INVALID=-2107]="ERR_ROOM_NAME_INVALID",f[f.ERR_ALREADY_IN_OTHER_ROOM=-2108]="ERR_ALREADY_IN_OTHER_ROOM",f[f.ERR_NEED_PASSWORD=-2109]="ERR_NEED_PASSWORD",f[f.ERR_WRONG_PASSWORD=-2110]="ERR_WRONG_PASSWORD",f[f.ERR_ROOM_USER_FULL=-2111]="ERR_ROOM_USER_FULL",f[f.ERR_USER_NOT_EXIST=-2200]="ERR_USER_NOT_EXIST",f[f.ERR_USER_NOT_ENTERED=-2201]="ERR_USER_NOT_ENTERED",f[f.ERR_NEED_OWNER_PERMISSION=-2300]="ERR_NEED_OWNER_PERMISSION",f[f.ERR_NEED_ADMIN_PERMISSION=-2301]="ERR_NEED_ADMIN_PERMISSION",f[f.ERR_REQUEST_NO_PERMISSION=-2310]="ERR_REQUEST_NO_PERMISSION",f[f.ERR_REQUEST_ID_INVALID=-2311]="ERR_REQUEST_ID_INVALID",f[f.ERR_REQUEST_ID_REPEAT=-2312]="ERR_REQUEST_ID_REPEAT",f[f.ERR_REQUEST_ID_CONFLICT=-2313]="ERR_REQUEST_ID_CONFLICT",f[f.ERR_MAX_SEAT_COUNT_LIMIT=-2340]="ERR_MAX_SEAT_COUNT_LIMIT",f[f.ERR_ALREADY_IN_SEAT=-2341]="ERR_ALREADY_IN_SEAT",f[f.ERR_SEAT_OCCUPIED=-2342]="ERR_SEAT_OCCUPIED",f[f.ERR_SEAT_LOCKED=-2343]="ERR_SEAT_LOCKED",f[f.ERR_SEAT_INDEX_NOT_EXIST=-2344]="ERR_SEAT_INDEX_NOT_EXIST",f[f.ERR_USER_NOT_IN_SEAT=-2345]="ERR_USER_NOT_IN_SEAT",f[f.ERR_ALL_SEAT_OCCUPIED=-2346]="ERR_ALL_SEAT_OCCUPIED",f[f.ERR_SEAT_NOT_SUPPORT_LINK_MIC=-2347]="ERR_SEAT_NOT_SUPPORT_LINK_MIC",f[f.ERR_OPEN_MICROPHONE_NEED_SEAT_UNLOCK=-2360]="ERR_OPEN_MICROPHONE_NEED_SEAT_UNLOCK",f[f.ERR_OPEN_MICROPHONE_NEED_PERMISSION_FROM_ADMIN=-2361]="ERR_OPEN_MICROPHONE_NEED_PERMISSION_FROM_ADMIN",f[f.ERR_OPEN_CAMERA_NEED_SEAT_UNLOCK=-2370]="ERR_OPEN_CAMERA_NEED_SEAT_UNLOCK",f[f.ERR_OPEN_CAMERA_NEED_PERMISSION_FROM_ADMIN=-2371]="ERR_OPEN_CAMERA_NEED_PERMISSION_FROM_ADMIN",f[f.ERR_OPEN_SCREEN_SHARE_NEED_SEAT_UNLOCK=-2372]="ERR_OPEN_SCREEN_SHARE_NEED_SEAT_UNLOCK",f[f.ERR_OPEN_SCREEN_SHARE_NEED_PERMISSION_FROM_ADMIN=-2373]="ERR_OPEN_SCREEN_SHARE_NEED_PERMISSION_FROM_ADMIN",f[f.ERR_SEND_MESSAGE_DISABLED_FOR_ALL=-2380]="ERR_SEND_MESSAGE_DISABLED_FOR_ALL",f[f.ERR_SEND_MESSAGE_DISABLED_FOR_CURRENT=-2381]="ERR_SEND_MESSAGE_DISABLED_FOR_CURRENT"}(Tn||(Tn={})),function(f){f[f.kRoomOwner=0]="kRoomOwner",f[f.kAdministrator=1]="kAdministrator",f[f.kGeneralUser=2]="kGeneralUser"}(Et||(Et={})),function(f){f[f.kVideoQuality_360p=1]="kVideoQuality_360p",f[f.kVideoQuality_540p=2]="kVideoQuality_540p",f[f.kVideoQuality_720p=3]="kVideoQuality_720p",f[f.kVideoQuality_1080p=4]="kVideoQuality_1080p"}(xo||(xo={})),function(f){f[f.kAudioProfileSpeech=0]="kAudioProfileSpeech",f[f.kAudioProfileDefault=1]="kAudioProfileDefault",f[f.kAudioProfileMusic=2]="kAudioProfileMusic"}(Nl||(Nl={})),function(f){f[f.kCameraStream=0]="kCameraStream",f[f.kScreenStream=1]="kScreenStream",f[f.kCameraStreamLow=2]="kCameraStreamLow"}(jt||(jt={})),function(f){f[f.kQualityUnknown=0]="kQualityUnknown",f[f.kQualityExcellent=1]="kQualityExcellent",f[f.kQualityGood=2]="kQualityGood",f[f.kQualityPoor=3]="kQualityPoor",f[f.kQualityBad=4]="kQualityBad",f[f.kQualityVeryBad=5]="kQualityVeryBad",f[f.kQualityDown=6]="kQualityDown"}(Zp||(Zp={})),function(f){f[f.kConference=1]="kConference",f[f.kLive=2]="kLive"}(ar||(ar={})),function(f){f[f.kFreeToTake=1]="kFreeToTake",f[f.kApplyToTake=2]="kApplyToTake"}(ji||(ji={})),function(f){f[f.kMicrophone=1]="kMicrophone",f[f.kCamera=2]="kCamera",f[f.kScreen=3]="kScreen"}(qo||(qo={})),function(f){f[f.kWindow=0]="kWindow",f[f.kScreen=1]="kScreen"}(eg||(eg={})),function(f){f[f.kChangedBySelf=0]="kChangedBySelf",f[f.kChangedByAdmin=1]="kChangedByAdmin"}(bl||(bl={})),function(f){f[f.kKickedByAdmin=0]="kKickedByAdmin",f[f.kKickedByLoggedOnOtherDevice=1]="kKickedByLoggedOnOtherDevice",f[f.kKickedByServer=2]="kKickedByServer"}(Du||(Du={})),function(f){f[f.kInvalidAction=0]="kInvalidAction",f[f.kRequestToOpenRemoteCamera=1]="kRequestToOpenRemoteCamera",f[f.kRequestToOpenRemoteMicrophone=2]="kRequestToOpenRemoteMicrophone",f[f.kRequestToConnectOtherRoom=3]="kRequestToConnectOtherRoom",f[f.kRequestToTakeSeat=4]="kRequestToTakeSeat",f[f.kRequestRemoteUserOnSeat=5]="kRequestRemoteUserOnSeat",f[f.kApplyToAdminToOpenLocalCamera=6]="kApplyToAdminToOpenLocalCamera",f[f.kApplyToAdminToOpenLocalMicrophone=7]="kApplyToAdminToOpenLocalMicrophone",f[f.kApplyToAdminToOpenLocalScreenShare=8]="kApplyToAdminToOpenLocalScreenShare"}(Jr||(Jr={})),function(f){f[f.kRequestAccepted=0]="kRequestAccepted",f[f.kRequestRejected=1]="kRequestRejected",f[f.kRequestCancelled=2]="kRequestCancelled",f[f.kRequestTimeout=3]="kRequestTimeout",f[f.kRequestError=4]="kRequestError",f[f.kRequestId=5]="kRequestId"}(Hn||(Hn={})),function(f){f[f.kAnchor=0]="kAnchor",f[f.kAudience=1]="kAudience"}(tg||(tg={})),function(f){f[f.kResolutionMode_Landscape=0]="kResolutionMode_Landscape",f[f.kResolutionMode_Portrait=1]="kResolutionMode_Portrait"}(Pl||(Pl={})),function(f){f[f.kMediaDeviceTypeUnknown=-1]="kMediaDeviceTypeUnknown",f[f.kMediaDeviceTypeAudioInput=0]="kMediaDeviceTypeAudioInput",f[f.kMediaDeviceTypeAudioOutput=1]="kMediaDeviceTypeAudioOutput",f[f.kMediaDeviceTypeVideoCamera=2]="kMediaDeviceTypeVideoCamera"}(Yn||(Yn={})),function(f){f[f.kMediaDeviceStateAdd=0]="kMediaDeviceStateAdd",f[f.kMediaDeviceStateRemove=1]="kMediaDeviceStateRemove",f[f.kMediaDeviceStateActive=2]="kMediaDeviceStateActive"}(rp||(rp={})),function(f){f[f.kAudioRouteSpeakerphone=0]="kAudioRouteSpeakerphone",f[f.kAudioRouteEarpiece=1]="kAudioRouteEarpiece"}(ng||(ng={})),function(f){f[f.kConferenceStatusNone=0]="kConferenceStatusNone",f[f.kConferenceStatusNotStarted=1]="kConferenceStatusNotStarted",f[f.kConferenceStatusRunning=2]="kConferenceStatusRunning"}(og||(og={})),function(f){f[f.kConferenceCancelReasonCancelledByAdmin=0]="kConferenceCancelReasonCancelledByAdmin",f[f.kConferenceCancelReasonRemovedFromAttendees=1]="kConferenceCancelReasonRemovedFromAttendees"}(ig||(ig={})),function(f){f[f.kNone=0]="kNone",f[f.kPending=1]="kPending",f[f.kTimeout=2]="kTimeout",f[f.kAccepted=3]="kAccepted",f[f.kRejected=4]="kRejected"}(ag||(ag={})),function(f){f[f.kSuccess=0]="kSuccess",f[f.kAlreadyInInvitationList=1]="kAlreadyInInvitationList",f[f.kAlreadyInConference=2]="kAlreadyInConference"}(sg||(sg={})),function(f){f[f.kRejectToEnter=0]="kRejectToEnter",f[f.kInOtherConference=1]="kInOtherConference"}(rg||(rg={})),function(f){f.onError="onError",f.onKickedOutOfRoom="onKickedOutOfRoom",f.onKickedOffLine="onKickedOffLine",f.onUserSigExpired="onUserSigExpired",f.onRoomDismissed="onRoomDismissed",f.onRoomNameChanged="onRoomNameChanged",f.onRoomSeatModeChanged="onRoomSeatModeChanged",f.onAllUserCameraDisableChanged="onAllUserCameraDisableChanged",f.onAllUserMicrophoneDisableChanged="onAllUserMicrophoneDisableChanged",f.onScreenShareForAllUserDisableChanged="onScreenShareForAllUserDisableChanged",f.onSendMessageForAllUserDisableChanged="onSendMessageForAllUserDisableChanged",f.onRoomMaxSeatCountChanged="onRoomMaxSeatCountChanged",f.onRemoteUserEnterRoom="onRemoteUserEnterRoom",f.onRemoteUserLeaveRoom="onRemoteUserLeaveRoom",f.onUserInfoChanged="onUserInfoChanged",f.onUserRoleChanged="onUserRoleChanged",f.onUserVideoStateChanged="onUserVideoStateChanged",f.onUserAudioStateChanged="onUserAudioStateChanged",f.onSendMessageForUserDisableChanged="onSendMessageForUserDisableChanged",f.onUserVoiceVolumeChanged="onUserVoiceVolumeChanged",f.onUserNetworkQualityChanged="onUserNetworkQualityChanged",f.onSeatListChanged="onSeatListChanged",f.onKickedOffSeat="onKickedOffSeat",f.onRequestReceived="onRequestReceived",f.onRequestCancelled="onRequestCancelled",f.onRequestProcessed="onRequestProcessed",f.onReceiveTextMessage="onReceiveTextMessage",f.onReceiveCustomMessage="onReceiveCustomMessage",f.onDeviceChange="onDeviceChange",f.onUserScreenCaptureStopped="onUserScreenCaptureStopped"}(it||(it={})),function(f){f.onDeviceChanged="onDeviceChanged",f.onTestMicVolume="onTestMicVolume",f.onTestSpeakerVolume="onTestSpeakerVolume"}(Gl||(Gl={})),function(f){f.onConferenceScheduled="onConferenceScheduled",f.onConferenceWillStart="onConferenceWillStart",f.onConferenceCancelled="onConferenceCancelled",f.onConferenceInfoChanged="onConferenceInfoChanged",f.onScheduleAttendeesChanged="onScheduleAttendeesChanged",f.onConferenceStatusChanged="onConferenceStatusChanged"}(cg||(cg={})),function(f){f.onReceiveInvitation="onReceiveInvitation",f.onInvitationHandledByOtherDevice="onInvitationHandledByOtherDevice",f.onInvitationCancelled="onInvitationCancelled",f.onInvitationAccepted="onInvitationAccepted",f.onInvitationRejected="onInvitationRejected",f.onInvitationTimeout="onInvitationTimeout",f.onInvitationRevokedByAdmin="onInvitationRevokedByAdmin",f.onInvitationAdded="onInvitationAdded",f.onInvitationRemoved="onInvitationRemoved",f.onInvitationStatusChanged="onInvitationStatusChanged"}(ug||(ug={}));var cp=f=>typeof f=="function",lg=f=>f===void 0,up=f=>typeof f=="string",dg=f=>typeof f=="number";function Wr(f){return Reflect.apply(Object.prototype.toString,f,[]).replace(/^\[object\s(\w+)\]$/,"$1").toLowerCase()}var pg=function(f){if(!f||typeof f!="object"||Object.prototype.toString.call(f)!="[object Object]")return!1;let g=Object.getPrototypeOf(f);if(g===null)return!0;let T=Object.prototype.hasOwnProperty.call(g,"constructor")&&g.constructor;return typeof T=="function"&&T instanceof T&&Function.prototype.toString.call(T)===Function.prototype.toString.call(Object)};function jr(f){if(typeof f!="string")return f;let g;try{let T=JSON.parse(f);g=typeof T=="object"&&T?T:f}catch(T){g=f}return g}var Ln=class extends Error{constructor(g){let{code:T,message:v,name:w}=g;super(v),this.code=T,this.message=v,this.name=w||""}},yh="INVALID_PARAMETER_REQUIRED",gg="INVALID_PARAMETER_TYPE",Ih="INVALID_PARAMETER_EMPTY",hg="INVALID_PARAMETER_INSTANCE",Mh="INVALID_PARAMETER_RANGE",Ch="CANNOT_LESS_THAN_ZERO",Cu={INVALID_PARAMETER_REQUIRED:f=>{let{key:g,rule:T,fnName:v,value:w}=f;return`'${g||T.name}' is a required param when calling ${v}(), received: ${w}.`},INVALID_PARAMETER_TYPE:f=>{let{key:g,rule:T,fnName:v,value:w}=f,N=`${g||T.name}`,B="";return B=Array.isArray(T.type)?T.type.join("|"):T.type,`'${N}' must be type of ${B} when calling ${v}(), received type: ${Wr(w)}.`},INVALID_PARAMETER_EMPTY:f=>{let{key:g,rule:T,fnName:v,value:w}=f;return`'${g||T.name}' cannot be '${w}' when calling ${v}().`},INVALID_PARAMETER_INSTANCE:f=>{let{key:g,rule:T,fnName:v,value:w}=f;return`'${`${g||T.name}`}' must be instanceof ${`${T.instanceOf.name||T.instanceOf}`} when calling ${v}(), received type: ${Wr(w)}.`},INVALID_PARAMETER_RANGE:f=>{let{key:g,rule:T,fnName:v,value:w}=f;return`'${g||T.name}' must be one of ${T.values.join("|")} when calling ${v}(), received: ${w}.`},CANNOT_LESS_THAN_ZERO:f=>{let{key:g,rule:T,fnName:v,value:w}=f;return`'${g||T.name}' cannot be less than 0 when calling ${v}().`},xxx:"lajfl "};function Da(f){let{key:g,data:T}=f;return Cu[g]?cp(Cu[g])?Cu[g](T):up(Cu[g])?Cu[g]:"":""}function Sl(...f){return function(g,T,v){let w=v.value;return v.value=function(...N){return xg.call(this,f,N,T,this.className),w.apply(this,N)},v}}function en(...f){return function(g,T,v){let w=v.value;return v.value=function(...N){return je(this,void 0,void 0,function*(){return xg.call(this,f,N,T,this.className),w.apply(this,N)})},v}}function xg(f,g,T,v){try{for(let w=0;w<f.length;w++)lp.call(this,{rule:f[w],value:g[w],key:f[w].name,fnName:T,className:v})}catch(w){throw st("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",w,w.code,w.message),w}}function lp(f){let{rule:g,value:T,key:v,fnName:w,className:N}=f;if(lg(T)){if(g.required)throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:yh,data:{key:v,rule:g,fnName:w,value:T}})});return}if(Array.isArray(g.type)){if(!g.type.map(H=>H.toLowerCase()).includes(Wr(T)))throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:gg,data:{key:v,rule:g,fnName:w,value:T}})})}else if(!lg(g.type)&&Wr(T)!==g.type)throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:gg,data:{key:v,rule:g,fnName:w,value:T}})});if(g.allowEmpty===!1){let H=dg(T)&&(T===0||Number.isNaN(T)),z=up(T)&&T.trim()==="";if(H||z)throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:Ih,data:{key:v,rule:g,fnName:w,value:T}})})}if(g.notLessThanZero&&dg(T)&&T<0)throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:Ch,data:{key:v,rule:g,fnName:w,value:T}})});if(up(g.instanceOf)){if(!T||T.name_!==g.instanceOf)throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:hg,data:{key:v,rule:g,fnName:w,value:T}})})}else if(cp(g.instanceOf)&&!(T instanceof g.instanceOf))throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:hg,data:{key:v,rule:g,fnName:w,value:T}})});if(g.values&&!g.values.includes(T))throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:Da({key:Mh,data:{key:v,rule:g,fnName:w,value:T}})});let{properties:B}=g;pg(B)&&Wr(T)==="object"&&Object.keys(B).forEach(H=>{lp.call(this,{rule:B[H],value:T&&T[H],key:`${v}.${H}`,fnName:w,className:N})});let{arrayItem:V}=g;pg(V)&&(H=>Wr(H)==="array")(T)&&T.forEach((H,z)=>{lp.call(this,{rule:V,value:H,key:`${v}[${z}]`,fnName:w,className:N})}),cp(g.validate)&&g.validate.call(this,T,v,w,N,this)}var Dl=new WeakMap;function _g(){return function(f,g,T){let v=T.value,w=N=>{let{fn:B,args:V,context:H,resolve:z,reject:ne}=N;B.apply(H,V).then(z,ne).finally(()=>{let ge=Dl.get(H);ge&&(ge.shift(),ge[0]&&w(Object.assign({},ge[0])))})};return T.value=function(...N){return new Promise((B,V)=>{if(Dl.has(this)){let H=Dl.get(this),{length:z}=H;H.push({fn:v,args:N,context:this,resolve:B,reject:V,name:g}),z===0&&w({fn:v,args:N,context:this,resolve:B,reject:V})}else Dl.set(this,[{fn:v,args:N,context:this,resolve:B,reject:V,name:g}]),w({fn:v,args:N,context:this,resolve:B,reject:V})})},T}}var Ut="string",ho="number",_o="boolean",fg="array",Tt="object",qg="uniapp",mg=1,Wt={login:{name:"options",required:!0,type:Tt,properties:{sdkAppId:{required:!0,type:ho,allowEmpty:!1},userId:{required:!0,type:Ut,allowEmpty:!1},userSig:{required:!0,type:Ut,allowEmpty:!1}}},setSelfInfo:{name:"options",required:!0,type:Tt,properties:{userName:{required:!0,type:Ut},avatarUrl:{required:!0,type:Ut},customInfo:{required:!1,type:Tt,allowEmpty:!1}}},createRoom:{name:"options",required:!0,type:Tt,properties:{roomId:{required:!0,type:Ut,allowEmpty:!1},roomName:{type:Ut,allowEmpty:!1},roomType:{instanceof:ar},isMicrophoneDisableForAllUser:{type:_o},isScreenShareDisableForAllUser:{type:_o},isCameraDisableForAllUser:{type:_o},isMessageDisableForAllUser:{type:_o},maxSeatCount:{type:ho},password:{type:Ut}}},enterRoom:{name:"options",required:!0,type:Tt,properties:{roomId:{required:!0,type:Ut,allowEmpty:!1},roomType:{instanceof:ar},options:{type:Tt,properties:{password:{type:Ut}}}}},updateRoomNameByAdmin:{name:"options",require:!0,type:Tt,properties:{roomName:{require:!0,type:Ut,allowEmpty:!1}}},setRoomMaxSeatCount:{name:"options",require:!0,type:Tt,properties:{maxSeatCount:{require:!0,type:ho}}},getUserList:{name:"options",required:!1,type:Tt,properties:{nextSequence:{type:Ut}}},getUserInfo:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1}}},setCustomInfoForUser:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},customInfo:{required:!0,type:Tt,allowEmpty:!1}}},takeSeat:{name:"options",required:!0,type:Tt,properties:{seatIndex:{required:!0,type:ho},timeout:{required:!0,type:ho},requestCallback:{instanceof:Function}}},getSeatList:{},openRemoteDeviceByAdmin:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},timeout:{required:!0,type:ho},device:{require:!0,instanceof:qo}}},closeRemoteDeviceByAdmin:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},device:{required:!0,instanceof:qo}}},takeUserOnSeatByAdmin:{name:"options",required:!0,type:Tt,properties:{seatIndex:{required:!0,type:ho},userId:{required:!0,type:Ut,allowEmpty:!1},timeout:{required:!0,type:ho},requestCallback:{instanceof:Function}}},kickUserOffSeatByAdmin:{name:"options",required:!0,type:Tt,properties:{seatIndex:{required:!0,type:ho},userId:{required:!0,type:Ut,allowEmpty:!1}}},cancelRequest:{name:"options",required:!0,type:Tt,properties:{requestId:{required:!0,type:Ut,allowEmpty:!1}}},responseRemoteRequest:{name:"options",required:!0,type:Tt,properties:{requestId:{required:!0,type:Ut,allowEmpty:!1},agree:{required:!0,type:_o}}},setLocalVideoView:{name:"options",required:!1,type:Tt,properties:{view:{required:!1,type:[Ut,fg,"null"],allowEmpty:!1,validate:f=>{if(f instanceof Array&&f.some(g=>g===null))throw new Ln({code:Tn.ERR_INVALID_PARAMETER,message:"When calling the setLocalVideoView interface with the view parameter as an array, the array content cannot contain null."})}}}},openLocalCamera:{name:"options",type:Tt,properties:{isFrontCamera:{type:_o,allowEmpty:!1}}},closeLocalCamera:{},openLocalMicrophone:{},closeLocalMicrophone:{},setVideoResolutionMode:{name:"options",required:!0,type:Tt,properties:{streamType:{required:!0,instanceof:jt},resolutionMode:{required:!0,instanceof:Pl}}},updateVideoQuality:{name:"options",required:!0,type:Tt,properties:{quality:{required:!0,instanceof:xo}}},updateVideoQualityEx:{name:"options",required:!0,type:Tt,properties:{streamType:{required:!0,instanceof:jt},encoderParams:{required:!0,properties:{quality:{instanceof:xo},fps:{type:ho},bitrate:{type:ho},resolutionMode:{instanceof:Pl}}}}},updateAudioQuality:{name:"options",required:!0,type:Tt,properties:{quality:{required:!0,instanceof:Nl}}},muteRemoteAudioStream:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},isMute:{required:!0,type:_o}}},startPushLocalVideo:{},stopPushLocalVideo:{},startPushLocalAudio:{},stopPushLocalAudio:{},setRemoteVideoView:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},streamType:{required:!0,instanceof:jt},view:{required:!0,type:[Ut,fg],allowEmpty:!1}}},startPlayRemoteVideo:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},streamType:{required:!0,instanceof:jt}}},stopPlayRemoteVideo:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},streamType:{required:!0,instanceof:jt}}},changeUserRole:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},userRole:{required:!0,instanceof:Et}}},changeUserNameCard:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1},nameCard:{required:!0,type:Ut}}},kickRemoteUserOutOfRoom:{name:"options",required:!0,type:Tt,properties:{userId:{required:!0,type:Ut,allowEmpty:!1}}},sendTextMessage:{name:"options",required:!0,type:Tt,properties:{messageText:{require:!0,type:Ut,allowEmpty:!1}}},sendCustomMessage:{name:"options",required:!0,type:Tt,properties:{messageText:{require:!0,type:Ut,allowEmpty:!1}}},startScreenSharing:{name:"options",type:Tt,properties:{screenAudio:{type:_o},view:{type:Ut}}},stopScreenSharing:{},startScreenSharingElectron:{name:"options",required:!0,type:[Tt,"string"],properties:{targetId:{require:!0,type:Ut},view:{type:Ut}}},selectScreenSharingTarget:{name:"options",required:!0,type:[Tt,"string"],properties:{targetId:{require:!0,type:Ut}}},setCurrentCameraDevice:{name:"options",required:!0,type:Tt,properties:{deviceId:{require:!0,type:Ut}}},setCurrentMicDevice:{name:"options",required:!0,type:Tt,properties:{deviceId:{require:!0,type:Ut}}},setCurrentSpeakerDevice:{name:"options",required:!0,type:Tt,properties:{deviceId:{require:!0,type:Ut}}},disableDeviceForAllUserByAdmin:{name:"options",required:!0,type:Tt,properties:{isDisable:{require:!0,type:_o},device:{require:!0,instanceof:qo}}},disableSendingMessageForAllUser:{name:"options",required:!0,type:Tt,properties:{isDisable:{require:!0,type:_o}}},disableSendingMessageByAdmin:{name:"options",required:!0,type:Tt,properties:{userId:{require:!0,instanceof:Ut},isDisable:{require:!0,type:_o}}},updateRoomSeatModeByAdmin:{name:"options",required:!0,type:Tt,properties:{seatMode:{require:!0,instanceof:ji}}},updateRoomPasswordByAdmin:{name:"options",required:!0,type:Tt,properties:{password:{required:!0,type:Ut,allowEmpty:!1}}},applyToAdminToOpenLocalDevice:{name:"options",required:!0,type:Tt,properties:{timeout:{required:!0,type:ho},device:{require:!0,instanceof:qo}}},setMaxSeatCount:{name:"options",required:!0,type:Tt,properties:{maxSeatCount:{require:!0,type:ho}}},lockSeatByAdmin:{name:"options",required:!0,type:Tt,properties:{seatIndex:{required:!0,type:ho},lockParams:{require:!0,type:Tt,properties:{lockSeat:{require:!0,type:_o},lockVideo:{require:!0,type:_o},lockAudio:{require:!0,type:_o}}}}}},vg=plus.os.name==="iOS",yg={judgeIosPermission:function(f){return f=="location"?function(){let g=!1,T=plus.ios.import("CLLocationManager");return g=T.authorizationStatus()!=2,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u5B9A\u4F4D\u6743\u9650\u5F00\u542F\uFF1A${g}`),plus.ios.deleteObject(T),g}():f=="camera"?function(){let g=!1,T=plus.ios.import("AVCaptureDevice"),v=T.authorizationStatusForMediaType("vide");return st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`authStatus:${v}`),v==3?(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u76F8\u673A\u6743\u9650\u5DF2\u7ECF\u5F00\u542F")):st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u76F8\u673A\u6743\u9650\u6CA1\u6709\u5F00\u542F"),plus.ios.deleteObject(T),g}():f=="photoLibrary"?function(){let g=!1,T=plus.ios.import("PHPhotoLibrary"),v=T.authorizationStatus();return st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`authStatus:${v}`),v==3?(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u76F8\u518C\u6743\u9650\u5DF2\u7ECF\u5F00\u542F")):st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u76F8\u518C\u6743\u9650\u6CA1\u6709\u5F00\u542F"),plus.ios.deleteObject(T),g}():f=="record"?function(){let g=!1,T=plus.ios.import("AVAudioSession"),v=T.sharedInstance().recordPermission();return st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`permissionStatus:${v}`),v==1684369017||v==1970168948?st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u9EA6\u514B\u98CE\u6743\u9650\u6CA1\u6709\u5F00\u542F"):(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u9EA6\u514B\u98CE\u6743\u9650\u5DF2\u7ECF\u5F00\u542F")),plus.ios.deleteObject(T),g}():f=="push"?function(){let g=!1,T=plus.ios.import("UIApplication"),v=T.sharedApplication(),w=0;if(v.currentUserNotificationSettings){let N=v.currentUserNotificationSettings();w=N.plusGetAttribute("types"),st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`enabledTypes1:${w}`),w==0?st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u63A8\u9001\u6743\u9650\u6CA1\u6709\u5F00\u542F"):(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u5DF2\u7ECF\u5F00\u542F\u63A8\u9001\u529F\u80FD!")),plus.ios.deleteObject(N)}else w=v.enabledRemoteNotificationTypes(),w==0?st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u63A8\u9001\u6743\u9650\u6CA1\u6709\u5F00\u542F!"):(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u5DF2\u7ECF\u5F00\u542F\u63A8\u9001\u529F\u80FD!")),st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`enabledTypes2:${w}`);return plus.ios.deleteObject(v),plus.ios.deleteObject(T),g}():f=="contact"?function(){let g=!1,T=plus.ios.import("CNContactStore");return T.authorizationStatusForEntityType(0)==3?(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u901A\u8BAF\u5F55\u6743\u9650\u5DF2\u7ECF\u5F00\u542F")):st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u901A\u8BAF\u5F55\u6743\u9650\u6CA1\u6709\u5F00\u542F"),plus.ios.deleteObject(T),g}():f=="calendar"?function(){let g=!1,T=plus.ios.import("EKEventStore");return T.authorizationStatusForEntityType(0)==3?(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u65E5\u5386\u6743\u9650\u5DF2\u7ECF\u5F00\u542F")):st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u65E5\u5386\u6743\u9650\u6CA1\u6709\u5F00\u542F"),plus.ios.deleteObject(T),g}():f=="memo"&&function(){let g=!1,T=plus.ios.import("EKEventStore");return T.authorizationStatusForEntityType(1)==3?(g=!0,st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u5907\u5FD8\u5F55\u6743\u9650\u5DF2\u7ECF\u5F00\u542F")):st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","\u5907\u5FD8\u5F55\u6743\u9650\u6CA1\u6709\u5F00\u542F"),plus.ios.deleteObject(T),g}()},requestAndroidPermission:function(f){return new Promise((g,T)=>{plus.android.requestPermissions([f],v=>{let w=0;for(let N=0;N<v.granted.length;N++){let B=v.granted[N];st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u5DF2\u83B7\u53D6\u7684\u6743\u9650\uFF1A${B}`),w=1}for(let N=0;N<v.deniedPresent.length;N++){let B=v.deniedPresent[N];st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u62D2\u7EDD\u672C\u6B21\u7533\u8BF7\u7684\u6743\u9650\uFF1A${B}`),w=0}for(let N=0;N<v.deniedAlways.length;N++){let B=v.deniedAlways[N];st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u6C38\u4E45\u62D2\u7EDD\u7533\u8BF7\u7684\u6743\u9650\uFF1A${B}`),w=-1}g(w)},v=>{st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u7533\u8BF7\u6743\u9650\u9519\u8BEF\uFF1A${v.code} = ${v.message}`),g({code:v.code,message:v.message})})})},checkSystemEnableLocation:function(){if(vg){let v=!1,w=plus.ios.import("CLLocationManager");return v=w.locationServicesEnabled(),st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u7CFB\u7EDF\u5B9A\u4F4D\u5F00\u542F:${v}`),plus.ios.deleteObject(w),v}let f=plus.android.importClass("android.content.Context"),g=plus.android.importClass("android.location.LocationManager"),T=plus.android.runtimeMainActivity().getSystemService(f.LOCATION_SERVICE).isProviderEnabled(g.GPS_PROVIDER);return st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`\u7CFB\u7EDF\u5B9A\u4F4D\u5F00\u542F:${T}`),T},gotoAppPermissionSetting:function(){if(vg){let f=plus.ios.import("UIApplication").sharedApplication(),g=plus.ios.import("NSURL"),T=g.URLWithString("app-settings:");f.openURL(T),plus.ios.deleteObject(T),plus.ios.deleteObject(g),plus.ios.deleteObject(f)}else{let f=plus.android.importClass("android.content.Intent"),g=plus.android.importClass("android.provider.Settings"),T=plus.android.importClass("android.net.Uri"),v=plus.android.runtimeMainActivity(),w=new f;w.setAction(g.ACTION_APPLICATION_DETAILS_SETTINGS);let N=T.fromParts("package",v.getPackageName(),null);w.setData(N),v.startActivity(w)}}},Ea=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{},dp={};(function(f){var g=Object.prototype.hasOwnProperty,T="~";function v(){}function w(H,z,ne){this.fn=H,this.context=z,this.once=ne||!1}function N(H,z,ne,ge,pe){if(typeof ne!="function")throw new TypeError("The listener must be a function");var oe=new w(ne,ge||H,pe),de=T?T+z:z;return H._events[de]?H._events[de].fn?H._events[de]=[H._events[de],oe]:H._events[de].push(oe):(H._events[de]=oe,H._eventsCount++),H}function B(H,z){--H._eventsCount==0?H._events=new v:delete H._events[z]}function V(){this._events=new v,this._eventsCount=0}Object.create&&(v.prototype=Object.create(null),new v().__proto__||(T=!1)),V.prototype.eventNames=function(){var H,z,ne=[];if(this._eventsCount===0)return ne;for(z in H=this._events)g.call(H,z)&&ne.push(T?z.slice(1):z);return Object.getOwnPropertySymbols?ne.concat(Object.getOwnPropertySymbols(H)):ne},V.prototype.listeners=function(H){var z=T?T+H:H,ne=this._events[z];if(!ne)return[];if(ne.fn)return[ne.fn];for(var ge=0,pe=ne.length,oe=new Array(pe);ge<pe;ge++)oe[ge]=ne[ge].fn;return oe},V.prototype.listenerCount=function(H){var z=T?T+H:H,ne=this._events[z];return ne?ne.fn?1:ne.length:0},V.prototype.emit=function(H,z,ne,ge,pe,oe){var de=T?T+H:H;if(!this._events[de])return!1;var ae,te,J=this._events[de],Le=arguments.length;if(J.fn){switch(J.once&&this.removeListener(H,J.fn,void 0,!0),Le){case 1:return J.fn.call(J.context),!0;case 2:return J.fn.call(J.context,z),!0;case 3:return J.fn.call(J.context,z,ne),!0;case 4:return J.fn.call(J.context,z,ne,ge),!0;case 5:return J.fn.call(J.context,z,ne,ge,pe),!0;case 6:return J.fn.call(J.context,z,ne,ge,pe,oe),!0}for(te=1,ae=new Array(Le-1);te<Le;te++)ae[te-1]=arguments[te];J.fn.apply(J.context,ae)}else{var re,Be=J.length;for(te=0;te<Be;te++)switch(J[te].once&&this.removeListener(H,J[te].fn,void 0,!0),Le){case 1:J[te].fn.call(J[te].context);break;case 2:J[te].fn.call(J[te].context,z);break;case 3:J[te].fn.call(J[te].context,z,ne);break;case 4:J[te].fn.call(J[te].context,z,ne,ge);break;default:if(!ae)for(re=1,ae=new Array(Le-1);re<Le;re++)ae[re-1]=arguments[re];J[te].fn.apply(J[te].context,ae)}}return!0},V.prototype.on=function(H,z,ne){return N(this,H,z,ne,!1)},V.prototype.once=function(H,z,ne){return N(this,H,z,ne,!0)},V.prototype.removeListener=function(H,z,ne,ge){var pe=T?T+H:H;if(!this._events[pe])return this;if(!z)return B(this,pe),this;var oe=this._events[pe];if(oe.fn)oe.fn!==z||ge&&!oe.once||ne&&oe.context!==ne||B(this,pe);else{for(var de=0,ae=[],te=oe.length;de<te;de++)(oe[de].fn!==z||ge&&!oe[de].once||ne&&oe[de].context!==ne)&&ae.push(oe[de]);ae.length?this._events[pe]=ae.length===1?ae[0]:ae:B(this,pe)}return this},V.prototype.removeAllListeners=function(H){var z;return H?(z=T?T+H:H,this._events[z]&&B(this,z)):(this._events=new v,this._eventsCount=0),this},V.prototype.off=V.prototype.removeListener,V.prototype.addListener=V.prototype.on,V.prefixed=T,V.EventEmitter=V,f.exports=V})({get exports(){return dp},set exports(f){dp=f}});var Ap=dp,pp=class f{constructor(g){let{Module:T,logger:v}=g;this.deviceManager||(this.logger=v,this.deviceManager=T)}static getInstance(g){return f.instance||(f.instance=new f(g)),f.instance}JSCallNativeFunctionSync(g,T){return this.deviceManager[g](T)}switchCamera(g){return je(this,void 0,void 0,function*(){this.logger.info("deviceManager.switchCamera with options: ",g);let{isFrontCamera:T}=g,v={frontCamera:T};yield this.JSCallNativeFunctionSync("switchCamera",v)})}},gp=class f{constructor(g){let{Module:T,logger:v}=g;this.trtcCloud||(this.logger=v,this.trtcCloud=T)}static getInstance(g){return f.instance||(f.instance=new f(g)),f.instance}JSCallNativeFunctionSync(g,T){return this.trtcCloud[g](T)}setLocalRenderParams(g){return je(this,void 0,void 0,function*(){this.logger.info("deviceManager.setLocalRenderParams with options: ",g),yield this.JSCallNativeFunctionSync("setLocalRenderParams",g)})}},hp={};({get exports(){return hp},set exports(f){hp=f}}).exports=function(){function f(e,n){var a,r=Object.keys(e);return Object.getOwnPropertySymbols&&(a=Object.getOwnPropertySymbols(e),n&&(a=a.filter(function(u){return Object.getOwnPropertyDescriptor(e,u).enumerable})),r.push.apply(r,a)),r}function g(e){for(var n=1;n<arguments.length;n++){var a=arguments[n]!=null?arguments[n]:{};n%2?f(Object(a),!0).forEach(function(r){B(e,r,a[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(a)):f(Object(a)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(a,r))})}return e}function T(e){return(T=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(n){return typeof n}:function(n){return n&&typeof Symbol=="function"&&n.constructor===Symbol&&n!==Symbol.prototype?"symbol":typeof n})(e)}function v(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")}function w(e,n){for(var a=0;a<n.length;a++){var r=n[a];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function N(e,n,a){return n&&w(e.prototype,n),a&&w(e,a),Object.defineProperty(e,"prototype",{writable:!1}),e}function B(e,n,a){return n in e?Object.defineProperty(e,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[n]=a,e}function V(e,n){if(typeof n!="function"&&n!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(n&&n.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),n&&z(e,n)}function H(e){return(H=Object.setPrototypeOf?Object.getPrototypeOf:function(n){return n.__proto__||Object.getPrototypeOf(n)})(e)}function z(e,n){return(z=Object.setPrototypeOf||function(a,r){return a.__proto__=r,a})(e,n)}function ne(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function ge(e,n,a){return(ge=ne()?Reflect.construct:function(r,u,d){var _=[null];return _.push.apply(_,u),u=new(Function.bind.apply(r,_)),d&&z(u,d.prototype),u}).apply(null,arguments)}function pe(e){var n=typeof Map=="function"?new Map:void 0;return function(a){if(a===null||Function.toString.call(a).indexOf("[native code]")===-1)return a;if(typeof a!="function")throw new TypeError("Super expression must either be null or a function");if(n!==void 0){if(n.has(a))return n.get(a);n.set(a,r)}function r(){return ge(a,arguments,H(this).constructor)}return r.prototype=Object.create(a.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),z(r,a)}(e)}function oe(e,n){if(e==null)return{};var a,r=function(_,y){if(_==null)return{};for(var M,R={},L=Object.keys(_),F=0;F<L.length;F++)M=L[F],0<=y.indexOf(M)||(R[M]=_[M]);return R}(e,n);if(Object.getOwnPropertySymbols)for(var u=Object.getOwnPropertySymbols(e),d=0;d<u.length;d++)a=u[d],0<=n.indexOf(a)||Object.prototype.propertyIsEnumerable.call(e,a)&&(r[a]=e[a]);return r}function de(e){if(e===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function ae(e){var n=ne();return function(){var a,r=H(e);if(a=n?(a=H(this).constructor,Reflect.construct(r,arguments,a)):r.apply(this,arguments),r=this,a&&(typeof a=="object"||typeof a=="function"))return a;if(a!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return de(r)}}function te(e,n){return Le(e)||function(a,r){var u=a==null?null:typeof Symbol!="undefined"&&a[Symbol.iterator]||a["@@iterator"];if(u!=null){var d,_,y=[],M=!0,R=!1;try{for(u=u.call(a);!(M=(d=u.next()).done)&&(y.push(d.value),!r||y.length!==r);M=!0);}catch(L){R=!0,_=L}finally{try{M||u.return==null||u.return()}finally{if(R)throw _}}return y}}(e,n)||Be(e,n)||Xe()}function J(e){return function(n){if(Array.isArray(n))return Ye(n)}(e)||re(e)||Be(e)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Le(e){if(Array.isArray(e))return e}function re(e){if(typeof Symbol!="undefined"&&e[Symbol.iterator]!=null||e["@@iterator"]!=null)return Array.from(e)}function Be(e,n){if(e){if(typeof e=="string")return Ye(e,n);var a=Object.prototype.toString.call(e).slice(8,-1);return(a=a==="Object"&&e.constructor?e.constructor.name:a)==="Map"||a==="Set"?Array.from(e):a==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(a)?Ye(e,n):void 0}}function Ye(e,n){(n==null||n>e.length)&&(n=e.length);for(var a=0,r=new Array(n);a<n;a++)r[a]=e[a];return r}function Xe(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function Ne(e,n){var a,r=typeof Symbol!="undefined"&&e[Symbol.iterator]||e["@@iterator"];if(!r){if(Array.isArray(e)||(r=Be(e))||n&&e&&typeof e.length=="number")return r&&(e=r),a=0,{s:n=function(){},n:function(){return a>=e.length?{done:!0}:{done:!1,value:e[a++]}},e:function(y){throw y},f:n};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var u,d=!0,_=!1;return{s:function(){r=r.call(e)},n:function(){var y=r.next();return d=y.done,y},e:function(y){_=!0,u=y},f:function(){try{d||r.return==null||r.return()}finally{if(_)throw u}}}}var me={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",ALL_RECEIVE_MESSAGE_OPT_UPDATED:"onAllReceiveMessageOptUpdated"},A={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_LIVE:"Live",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_MSG_EXCEPT_AT:"NotReceiveMsgExceptAt",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3,IOS_OFFLINE_PUSH_NO_SOUND:"push.no_sound",IOS_OFFLINE_PUSH_DEFAULT_SOUND:"default"},Me={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},O=(N(nt,[{key:"use",value:function(e){if(typeof e!="function")throw"middleware must be a function";return this.cache.push(e),this}},{key:"next",value:function(e){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(e){return this.middlewares=this.cache.map(function(n){return n}),this.options=e,this.next()}}]),nt),ze=(N(qn,[{key:"equal",value:function(e){return e!==null&&this.low===e.low&&this.high===e.high}},{key:"toString",value:function(){var e=Number(this.high).toString(16),n=Number(this.low).toString(16);if(n.length<8)for(var a=8-n.length;a;)n="0"+n,a--;return e+n}}]),qn),gn={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT0:"wss://*w4s.my-imcloud.com",DEFAULT:"wss://wsssgp.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT0:"wss://*w4k.my-imcloud.com",DEFAULT:"wss://wsskr.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT0:"wss://*w4g.my-imcloud.com",DEFAULT:"wss://wssger.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT0:"wss://*w4i.my-imcloud.com",DEFAULT:"wss://wssind.my-imcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.18.188"},JPN:{DEFAULT0:"wss://*w4j.my-imcloud.com",DEFAULT:"wss://wssjpn.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT0:"wss://*w4u.my-imcloud.com",DEFAULT:"wss://wssusa.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT0:"wss://*w4y.my-imcloud.com",DEFAULT:"wss://wssidn.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},ct={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19,NS_NATIVE_APP:20,RN_NATIVE_APP:21},pt="1.7.3",dt=537048168,He="CHINA",ee={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=gn.PRODUCTION[0<arguments.length&&arguments[0]!==void 0?arguments[0]:He]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},Qe={SEARCH_GRP_SNS:new ze(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new ze(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new ze(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new ze(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new ze(0,Math.pow(2,6)).toString(),USER_STATUS:new ze(0,Math.pow(2,7)).toString(),CONV_MARK:new ze(0,Math.pow(2,9)).toString(),CONV_GROUP:new ze(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new ze(0,Math.pow(2,11)).toString(),MSG_EXT:new ze(0,Math.pow(2,13)).toString(),GRP_COUNTER:new ze(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new ze(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new ze(Math.pow(2,7)).toString(),PLUGIN_CS:new ze(Math.pow(2,8)).toString(),PLUGIN_PUSH:new ze(Math.pow(2,9)).toString(),PLUGIN_BOT:new ze(Math.pow(2,10)).toString(),MSG_REACTION:new ze(Math.pow(2,16)).toString(),FOLLOW:new ze(Math.pow(2,20)).toString()},se="group_profile",Ue=["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],At=["Role","JoinTime","MsgSeq","MsgFlag"];function qn(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;v(this,qn),this.high=e,this.low=n}function nt(){v(this,nt),this.cache=[],this.options=null}ee.HOST.setCurrent(He);for(var Zt,wt=typeof wx!="undefined"&&typeof wx.getSystemInfoSync=="function"&&!!wx.getSystemInfoSync().fontSizeSetting,sn=wt&&typeof wx.createGamePortal=="function",rn=typeof qq!="undefined"&&typeof qq.getSystemInfoSync=="function"&&!!qq.getSystemInfoSync().fontSizeSetting,gt=typeof tt!="undefined"&&typeof tt.getSystemInfoSync=="function"&&!!tt.getSystemInfoSync().fontSizeSetting,St=typeof swan!="undefined"&&typeof swan.getSystemInfoSync=="function"&&!!swan.getSystemInfoSync().fontSizeSetting,Ft=typeof my!="undefined"&&typeof my.getSystemInfoSync=="function"&&!!my.getSystemInfoSync().fontSizeSetting,Ve=typeof jd!="undefined"&&typeof jd.getSystemInfoSync=="function",Ct=typeof uni!="undefined"&&typeof window=="undefined"&&typeof Lu=="function",Ce=wt&&T(wx.miniapp)==="object",ba=typeof uni!="undefined",qe=wt||rn||gt||St||Ft||Ct||Ve,Ze=typeof window=="undefined"&&!qe&&Ea!==void 0&&Ea.NativeScriptGlobals!==void 0,$t=Ea!==void 0&&(Ea.nativeModuleProxy!==void 0||Ea.ReactNative!==void 0),mt=typeof uni!="undefined"?!qe:typeof window!="undefined"&&!qe&&!$t,vt=rn?qq:gt?tt:St?swan:Ft?my:wt?wx:Ct?uni:Ve?jd:{},xn=mt&&window&&window.navigator&&window.navigator.userAgent||"",rr=(Ve="WEB",/(micromessenger|webbrowser)/i.test(xn)?Ve="WEB":rn?Ve="QQ_MP":gt?Ve="TT_MP":St?Ve="BAIDU_MP":Ft?Ve="ALI_MP":wt?Ve=Ce?"DONUT_NATIVE_APP":"WX_MP":Ct?Ve="UNI_NATIVE_APP":Ze?Ve="NS_NATIVE_APP":$t&&(Ve="RN_NATIVE_APP"),ct[Ve]),nc=(Ce=/iPad/i.test(xn),Ze=/iPhone/i.test(xn)&&!Ce,Ve=/iPod/i.test(xn),Ze||Ce||Ve),oc=(Ze=xn.match(/OS (\d+)_/i))&&Ze[1]?Ze[1]:null,ic=/Android/i.test(xn),ac=function(){var e=xn.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!e)return null;var n=e[1]&&parseFloat(e[1]),a=e[2]&&parseFloat(e[2]);return n&&a?parseFloat(e[1]+"."+e[2]):n||null}(),sc=(Ve=!(Ce=/Edge/i.test(xn))&&/Chrome/i.test(xn),/MSIE/.test(xn)||-1<xn.indexOf("Trident")&&-1<xn.indexOf("rv:11.0")),Wl=Ze=!(Ze=(Ze=/MSIE\s(\d+)\.\d/.exec(xn))&&parseFloat(Ze[1]))&&/Trident\/7.0/i.test(xn)&&/rv:11.0/.test(xn)?11:Ze,jl=/Safari/i.test(xn)&&!Ve&&!ic&&!Ce,Yl=/Windows/i.test(xn),Yi=/MAC OS X/i.test(xn),ti=mt&&typeof Worker!="undefined"&&!sc,cr=ic||nc,rc=mt&&window.tencent_cloud_im_csig_flutter_for_web_25F_cy!==void 0,cc=function(){if(typeof window=="undefined"||window.navigator===void 0)return!1;var e=window.navigator.standalone;return!(!nc||e||jl)}(),Ou=typeof console!="undefined"?console:Ea!==void 0&&Ea.console?Ea.console:typeof window!="undefined"&&window.console?window.console:{},Nu=function(){},uc=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],lc=uc.length;lc--;)Zt=uc[lc],console[Zt]||(Ou[Zt]=Nu);function dc(){var e=new Date;return e.setTime(Vn()),e}function zi(){no=0}function Ji(){return Math.floor(Vn()/1e3)}var $i=Ou,no=0,Vn=function(){return new Date().getTime()+no},Lo=0;function pc(){return Zi()?"%c Chat %c":"Chat"}function E(){var e=dc();return e.toLocaleTimeString("en-US",{hour12:!1})+"."+function(n){var a;switch(n.toString().length){case 1:a="00"+n;break;case 2:a="0"+n;break;default:a=n}return a}(e.getMilliseconds())}var D={arguments2String:function(e){var n="";if(e.length===1)n=e[0];else for(var a=0,r=e.length;a<r;a++){if(Bo(e[a]))try{n+=Jl(e[a])?JSON.stringify(e[a],["message","code"]):JSON.stringify(e[a])}catch(u){n+=u?u.message:"";break}else n+=e[a];n+=" "}return n},_exec:function(e,n){Zi()?$i[e](pc(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",E(),n):$i[e]("".concat(pc()," ").concat(E()," ").concat(n))},d:function(){var e;Lo<=-1&&(e=this.arguments2String(arguments),this._exec("debug",e))},l:function(){var e;Lo<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},log:function(){var e;Lo<=0&&(e=this.arguments2String(arguments),this._exec("log",e))},i:function(){var e;Lo<=1&&(e=this.arguments2String(arguments),this._exec("info",e))},w:function(){var e;Lo<=2&&(e=this.arguments2String(arguments),this._exec("warn",e))},e:function(){var e;Lo<=3&&(e=this.arguments2String(arguments),this._exec("error",e))},setLevel:function(e){e<4&&this._exec("log","set level from "+Lo+" to "+e),Lo=e},getLevel:function(){return Lo}},at={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},Je={NICK:"".concat(Ze="Tag_Profile_IM_","Nick"),GENDER:"".concat(Ze,"Gender"),BIRTHDAY:"".concat(Ze,"BirthDay"),LOCATION:"".concat(Ze,"Location"),SELFSIGNATURE:"".concat(Ze,"SelfSignature"),ALLOWTYPE:"".concat(Ze,"AllowType"),LANGUAGE:"".concat(Ze,"Language"),AVATAR:"".concat(Ze,"Image"),MESSAGESETTINGS:"".concat(Ze,"MsgSettings"),ADMINFORBIDTYPE:"".concat(Ze,"AdminForbidType"),LEVEL:"".concat(Ze,"Level"),ROLE:"".concat(Ze,"Role")},co={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},gc={UNKNOWN:"".concat(Ve="Gender_Type_","Unknown"),FEMALE:"".concat(Ve,"Female"),MALE:"".concat(Ve,"Male")},hc={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},di={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},pi="JoinedSuccess",Pa="WaitAdminApproval",ur="@TOPIC#_",Te=Object.prototype.hasOwnProperty;function Se(e){if(e==null)return!0;if(typeof e=="boolean")return!1;if(typeof e=="number")return e===0;if(typeof e=="string"||typeof e=="function"||Array.isArray(e))return e.length===0;if(e instanceof Error)return e.message==="";if(ye(e)){for(var n in e)if(Te.call(e,n))return!1;return!0}return!!(bu(e)||ko(e)||ut(e))&&e.size===0}function bu(e){return yo(e)==="map"}function ko(e){return yo(e)==="set"}function ut(e){return yo(e)==="file"}function ft(e){return e!==null&&(typeof e=="number"&&!isNaN(+e)||T(e)==="object"&&e.constructor===Number)}function It(e){return e!==null&&T(e)==="object"}function ye(e){if(T(e)==="object"&&e!==null){if((e=Object.getPrototypeOf(e))===null)return 1;for(var n=e;Object.getPrototypeOf(n)!==null;)n=Object.getPrototypeOf(n);return e===n}}function ke(e){return typeof Array.isArray=="function"?Array.isArray(e):yo(e)==="array"}function Ot(e){return typeof e=="function"}function _c(e){return yo(e)==="filelist"}function fc(e){return typeof e=="string"&&(e=e[0],!/[^a-zA-Z0-9]/.test(e))}function Gn(e,n,a,r){if(!Bo(e)||!Bo(n))return 0;for(var u,d=0,_=Object.keys(n),y=0,M=_.length;y<M;y++)if(u=_[y],!(q(n[u])||a&&a.includes(u)))if(Bo(e[u])&&Bo(n[u]))d+=Gn(e[u],n[u],a,r);else{if(r&&r.includes(n[u]))continue;e[u]!==n[u]&&(e[u]=n[u],d+=1)}return d}function Ga(e,n){var a,r=new Map,u=Ne(e.entries());try{for(u.s();!(a=u.n()).done;){var d=te(a.value,2),_=d[0],y=d[1];y&&r.set(_,n?JSON.stringify(y):JSON.parse(JSON.stringify(y)))}}catch(M){u.e(M)}finally{u.f()}return r}function gi(e){if(e.length===0)return 0;for(var n=0,a=0,r=typeof document!="undefined"&&document.characterSet!==void 0?document.characterSet:"UTF-8";e[n]!==void 0;)a+=e[n++].charCodeAt[n]<=255?1:r===!1?3:2;return a}function mn(e){return e=e||99999999,Math.round(Math.random()*e)}function mc(){for(var e="",n=32;0<n;--n)e+=vc[Math.floor(Math.random()*$l)];return e}function vo(e,n){for(var a in e)if(e[a]===n)return 1}function Vo(e){return e.indexOf("http://")===-1||e.indexOf("https://")===-1?"https://"+e:e.replace(/https|http/,"https")}function Ua(e){if(Object.getOwnPropertyNames(e).length===0)return Object.create(null);var n,a,r=Array.isArray(e)?[]:Object.create(null);for(a in e)e[a]!==null?e[a]!==void 0?(n=T(e[a]),0<=["string","number","function","boolean"].indexOf(n)?r[a]=e[a]:r[a]=Ua(e[a])):r[a]=void 0:r[a]=null;return r}var zl=["url"],Ee=function(e){return typeof e=="string"},q=function(e){return e===void 0},Bo=function(e){return ke(e)||It(e)},Jl=function(e){return e instanceof Error},yo=function(e){return Object.prototype.toString.call(e).match(/^\[object (.*)\]$/)[1].toLowerCase()},vc=(Date.now||(Date.now=function(){return new Date().getTime()}),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),$l=vc.length,hi={};function Ho(e,n){if(!ke(e)||!ke(n))return!1;var a=!1;return n.forEach(function(r){var u=r.key,d=(r=r.value,e.find(function(_){return _.key===u}));d?d.value!==r&&(d.value=r,a=!0):(e.push({key:u,value:r}),a=!0)}),a}function wa(e){return Se(e)?[]:e.filter(function(n){return n.isModified===!0})}function lr(e){return Se(e)?[]:e.filter(function(n){return n.isModified===!1})}function Un(e){return e===A.GRP_AVCHATROOM}function Vt(e){var n=e.type;return e=e.groupID,n===A.GRP_COMMUNITY||"".concat(e).startsWith("@TGS#_")&&!"".concat(e).includes(ur)}function bt(e){return"".concat(e).startsWith("@TGS#_")&&"".concat(e).includes(ur)}function Lt(e){return Ee(e)&&e.slice(0,3)===A.CONV_C2C}function Bt(e){return Ee(e)&&e.slice(0,5)===A.CONV_GROUP}function wn(e){return Ee(e)&&e===A.CONV_SYSTEM}function Xi(e,n){var a={};return Object.keys(e).forEach(function(r){a[r]=n(e[r],r)}),a}function _i(e){return $t?Promise.resolve({width:0,height:0}):qe?new Promise(function(n,a){vt.getImageInfo({src:e,success:function(r){n({width:r.width,height:r.height})},fail:function(){n({width:0,height:0})}})}):sc&&Wl===9?Promise.resolve({width:0,height:0}):new Promise(function(n,a){var r=new Image;r.onload=function(){n({width:this.width,height:this.height}),r=null},r.onerror=function(){n({width:0,height:0}),r=null},r.src=e})}function fi(){function e(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(e()+e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e()).concat(e())}function yc(){var e=ic?"android":nc?"ios":Yl?"windows":Yi?"mac":"unknown";if(qe)try{var n=vt.getSystemInfoSync().platform;n!==void 0&&(e=n)}catch(a){}return e}function Ic(e,n){e=e.split("."),n=n.split(".");for(var a=Math.max(e.length,n.length);e.length<a;)e.push("0");for(;n.length<a;)n.push("0");for(var r=0;r<a;r++){var u=parseInt(e[r]),d=parseInt(n[r]);if(d<u)return 1;if(u<d)return-1}return 0}function dr(e){var n=(n=e.originUrl)===void 0?void 0:n,a=e.originWidth,r=e.originHeight,u=(e=(e=e.min)===void 0?198:e,{url:void 0,width:0,height:0});return((a=parseInt(a))<=(r=parseInt(r))?a:r)<=e?(u.url=n,u.width=a,u.height=r):(r<=a?(u.width=Math.ceil(a*e/r),u.height=e):(u.width=e,u.height=Math.ceil(r*e/a)),r=n&&-1<n.indexOf("?")?"".concat(n,"&"):"".concat(n,"?"),u.url="".concat(r,e===198?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),q(n)?(u.url,oe(u,zl)):u}function pr(e){var n=e[2];e[2]=e[1],e[1]=n;for(var a=0;a<e.length;a++)e[a].setType(a)}function gr(e){return(e=e.servcmd).slice(e.indexOf(".")+1)}function ao(e,n){return Math.round(Number(e)*Math.pow(10,n))/Math.pow(10,n)}function uo(e,n){return e.includes(n)}function Mc(e,n){return e.includes(n)}function vn(e){return e.split(ur)[0]}var un=function(e,n,a){if(q(n))return"";switch(e){case A.MSG_TEXT:return n.text;case A.MSG_IMAGE:return a?"[Image]":"[\u56FE\u7247]";case A.MSG_LOCATION:return a?"[Location]":"[\u4F4D\u7F6E]";case A.MSG_AUDIO:return a?"[Voice]":"[\u8BED\u97F3]";case A.MSG_VIDEO:return a?"[Video]":"[\u89C6\u9891]";case A.MSG_FILE:return a?"[File]":"[\u6587\u4EF6]";case A.MSG_CUSTOM:return a?"[Custom Messages]":"[\u81EA\u5B9A\u4E49\u6D88\u606F]";case A.MSG_GRP_TIP:return a?"[Group Notification]":"[\u7FA4\u63D0\u793A\u6D88\u606F]";case A.MSG_GRP_SYS_NOTICE:return a?"[Group System Message]":"[\u7FA4\u7CFB\u7EDF\u901A\u77E5]";case A.MSG_FACE:return a?"[Animated Sticker]":"[\u52A8\u753B\u8868\u60C5]";case A.MSG_MERGER:return a?"[Chat Record]":"[\u804A\u5929\u8BB0\u5F55]";default:return""}};function Qi(e){return e===A.MSG_TEXT||e===A.MSG_CUSTOM||e===A.MSG_LOCATION||e===A.MSG_FACE}function Fa(e){var n=[];if(!Ee(e))return n;var a=e.length;if(a===0)return n;for(var r=a-1;0<=r;r--)e[r]==="1"&&n.push(Math.pow(2,a-r-1));return n}function Zi(){return!sc&&!qe}function Ko(e){return"the length of userIDList cannot exceed ".concat(e)}function ni(e){var n;if(ke(e)&&e.length!==0)return n=0,e.forEach(function(a){n+=a}),n.toFixed(0)}function Cc(e){var n;if(ke(e)&&e.length!==0)return n=0,e.forEach(function(a){n+=a}),(n/e.length).toFixed(0)}function kn(e,n,a){n=!(1<arguments.length&&n!==void 0)||n,a=!(2<arguments.length&&a!==void 0)||a;var r=Date.now();return n?a?"".concat(r-e," ms"):"".concat(Math.round((r-e)/1e3)," s"):a?r-e:Math.round((r-e)/1e3)}function An(e){return!!(e&&1<e)}function Tc(e,n,a,r){if(n===void 0)return 1;var u,d,_=!0;return n.required&&Se(e)&&(D.e("[".concat(a,'] Missing required params: "').concat(r,'".')),_=!1),Se(e)||(u=yo(e))!==(d=n.type.toLowerCase())&&(u==="asyncfunction"&&d==="function"||(D.e("[".concat(a,'] Invalid params: type check failed for "').concat(r,'". Expected ').concat(n.type,".")),_=!1)),n.validator&&!n.validator(e,a,r)&&(D.e("[".concat(a,'] Invalid params: custom validator check failed for "').concat(r,'".')),_=!1),_}function Wo(e){return!(!e||!(Lt(e)||Bt(e)||wn(e))&&((e=Rt("InvalidConversationID",e))&&D.w(e),1))}function Ie(e){e.desc!==""&&Rt("API_REFER")!==""&&D.w("[".concat(e.api,"] | ").concat(e.paramName," | ").concat(e.desc,", ").concat(Rt("API_REFER")).concat(e.api))}function ve(){return Rt("StringRequiredLog")}function Kn(e){return Rt("NonEmptyStringRequiredLog",e)}function Ao(){return Rt("NumberRequiredLog")}function oi(){return Rt("UndefinedNotAllowedLog")}function mi(){return Rt("FileRequiredLog")}function Io(){return Rt("FunctionRequiredLog")}function yn(){return Rt("ArrayRequiredLog")}function En(){return Rt("NonEmptyArrayLog")}function Mo(){return Rt("CallbackMissingLog")}function xa(){return Rt("PositiveIntegerRequiredLog")}function ii(e,n){return Rt("StringNotLongerThanLog",e,n)}function jo(e,n){return Rt("NumberGreaterOrEqualLog",e,n)}function qa(e){return Rt("KeyValueStringRequiredLog",e)}function lo(){return Rt("PlainObjectRequiredLog")}function Va(){return Rt("NonEmptyContentRequiredLog")}function Xn(){return Rt("FileNotSelectedLog")}function Ba(){return Rt("MessageInstanceRequiredLog")}function Oo(){return Rt("NonAnonymousFunctionLog")}function ea(){return Rt("MessageExtensionNotAvailableLog")}function vi(){return Rt("MessageReactionRequiredLog")}function hr(e,n){return Rt("MaximumArrayLengthLog",e,n)}function be(e){return{code:0,data:e||{}}}function Ke(e){return Promise.resolve(be(e))}function j(e){var n=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(e instanceof xe)return n&&dn!==null&&dn.emit(me.ERROR,e),Promise.reject(e);if(e instanceof Error)return a=new xe({code:X.UNCAUGHT_ERROR}),n&&dn!==null&&dn.emit(me.ERROR,a),Promise.reject(a);if(q(e)||q(e.code))return Promise.reject(new xe({code:X.UNCAUGHT_ERROR}));var a=new xe(e);return n&&dn!==null&&dn.emit(me.ERROR,a),Promise.reject(a)}var ta,Ae="unSend",we="success",W="fail",No="notStart",Ha="pending",Jn="resolved",ai="rejected",On={type:"Boolean",required:!0},an={type:"number",required:!0},Rt=null,yi={hookGetAPITips:function(e){Rt=e},login:{userID:Ce={type:"String",required:!0},userSig:Ce},addToBlacklist:{userIDList:Ze={type:"Array",required:!0}},removeFromBlacklist:{userIDList:Ze},on:[{name:"eventName",type:"String",validator:function(e,n,a){return typeof e=="string"&&e.length!==0||(Ie({api:n,paramName:a,desc:Kn(a)}),!1)}},{name:"handler",type:"Function",validator:function(e,n,a){return typeof e!="function"?(Ie({api:n,paramName:a,desc:Io()}),!1):(e.name===""&&Ie({api:n,paramName:a,desc:Oo()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(e,n,a){return typeof e=="string"&&e.length!==0||(Ie({api:n,paramName:a,desc:Kn(a)}),!1)}},{name:"handler",type:"Function",validator:function(e,n,a){return typeof e!="function"?(Ie({api:n,paramName:a,desc:Io()}),!1):(e.name===""&&Ie({api:n,paramName:a,desc:Oo()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(e,n,a){return typeof e=="string"&&e.length!==0||(Ie({api:n,paramName:a,desc:Kn(a)}),!1)}},{name:"handler",type:"Function",validator:function(e,n,a){return typeof e!="function"?(Ie({api:n,paramName:a,desc:Io()}),!1):(e.name===""&&Ie({api:n,paramName:a,desc:Oo()}),!0)}}],sendMessage:[g({name:"message"},Ve={type:"Object",required:!0})],setMessageExtensions:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return e.status===we&&e.isSupportExtension===!0||(Ie({api:n,paramName:a,desc:ea()}),!1)}}),g({name:"extensions"},Ze)],getMessageExtensions:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return e.status===we&&e.isSupportExtension===!0||(Ie({api:n,paramName:a,desc:ea()}),!1)}})],deleteMessageExtensions:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return e.status===we&&e.isSupportExtension===!0||(Ie({api:n,paramName:a,desc:ea()}),!1)}})],addMessageReaction:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return e.status===we||(Ie({api:n,paramName:a,desc:vi()}),!1)}}),g({name:"reactionID"},Ce)],removeMessageReaction:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return e.status===we||(Ie({api:n,paramName:a,desc:vi()}),!1)}}),g({name:"reactionID"},Ce)],getMessageReactions:{messageList:g({},Ze)},getAllUserListOfMessageReaction:{message:g(g({},Ve),{},{validator:function(e,n,a){return e.status===we||(Ie({api:n,paramName:a,desc:vi()}),!1)}}),reactionID:g({},Ce),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:g(g({},Ce),{},{validator:Wo}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(e,n,a){return!(!q(e)&&!/^[1-9][0-9]*$/.test(e)&&(Ie({api:n,paramName:a,desc:xa()}),1))}}},getMessageListHopping:{conversationID:g(g({},Ce),{},{validator:Wo}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(e,n,a){return!(!q(e)&&e!==0&&e!==1&&(Ie({api:n,paramName:a,desc:Rt("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(e,n,a){return!(!q(e)&&!/^[1-9][0-9]*$/.test(e)&&(Ie({api:n,paramName:a,desc:xa}),1))}}},setMessageRead:{conversationID:g(g({},Ce),{},{validator:Wo})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(e,n,a){return!e||[A.READ_ALL_C2C_MSG,A.READ_ALL_GROUP_MSG,A.READ_ALL_MSG].indexOf(e)!==-1||(Ie({api:n,paramName:a,desc:Rt("ValidScopeRequired")}),!1)}}},getConversationProfile:[g(g({name:"conversationID"},Ce),{},{validator:Wo})],clearHistoryMessage:[g(g({name:"conversationID"},Ce),{},{validator:Wo})],pinConversation:{conversationID:g(g({},Ce),{},{validator:Wo}),isPinned:g({},On)},setConversationDraft:{conversationID:g(g({},Ce),{},{validator:Wo}),draftText:{type:"String",validator:function(e,n,a){return!!Ee(e)||(Ie({api:n,paramName:a,desc:ve()}),!1)}}},setConversationCustomData:{conversationIDList:g({},Ze),customData:{type:"String",validator:function(e,n,a){return Ee(e)?!(256<e.length&&(Ie({api:n,paramName:a,desc:ii(a,256)}),1)):(Ie({api:n,paramName:a,desc:ve()}),!1)}}},markConversation:{conversationIDList:g({},Ze),markType:{type:"number",validator:function(e,n,a){return ft(e)?e<=0?(Ie({api:n,paramName:a,desc:Rt("NumberGreaterThanLog",a,0)}),!1):!(e>=Math.pow(2,64)&&(Ie({api:n,paramName:a,desc:Rt("NumberLessThanLog",a,"Math.pow(2,64)")}),1)):(Ie({api:n,paramName:a,desc:Ao()}),!1)}},enableMark:g({},On)},createConversationGroup:{conversationIDList:g({},Ze),groupName:g(g({},Ce),{},{validator:function(e,n,a){return!(!e||32<e.length&&(Ie({api:n,paramName:a,desc:ii(a,32)}),1))}})},deleteConversationGroup:[g({name:"groupName"},Ce)],renameConversationGroup:{oldName:g({},Ce),newName:g(g({},Ce),{},{validator:function(e,n,a){return!(!e||32<e.length&&(Ie({api:n,paramName:a,desc:ii(a,32)}),1))}})},addConversationsToGroup:{conversationIDList:g({},Ze),groupName:g({},Ce)},deleteConversationsFromGroup:{conversationIDList:g({},Ze),groupName:g({},Ce)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:Ce,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:Ze},createGroup:{name:Ce},joinGroup:{groupID:Ce,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[g({name:"groupID"},Ce)],handleApplication:{message:Ve,handleAction:Ce,handleMessage:{type:"String"}},changeGroupOwner:{groupID:Ce,newOwnerID:Ce},updateGroupProfile:{groupID:Ce,muteAllMembers:{type:"Boolean"}},dismissGroup:[g({name:"groupID"},Ce)],searchGroupByID:[g({name:"groupID"},Ce)],getGroupOnlineMemberCount:[g({name:"groupID"},Ce)],initGroupAttributes:{groupID:Ce,groupAttributes:g(g({},Ve),{},{validator:function(e,n,a){var r=!0;return Object.keys(e).forEach(function(u){if(!Ee(e[u]))return Ie({api:n,paramName:a,desc:qa("value")}),r=!1}),r}})},setGroupAttributes:{groupID:Ce,groupAttributes:g(g({},Ve),{},{validator:function(e,n,a){var r=!0;return Object.keys(e).forEach(function(u){if(!Ee(e[u]))return Ie({api:n,paramName:a,desc:qa("value")}),r=!1}),r}})},deleteGroupAttributes:{groupID:Ce,keyList:{type:"Array",validator:function(e,n,a){return q(e)||!ke(e)?(Ie({api:n,paramName:a,desc:yn()}),!1):!!Se(e)||(r=!0,e.forEach(function(u){if(!Ee(u))return Ie({api:n,paramName:a,desc:Rt("StringArrayRequiredLog")}),r=!1}),r);var r}}},getGroupAttributes:{groupID:Ce,keyList:{type:"Array",validator:function(e,n,a){return q(e)||!ke(e)?(Ie({api:n,paramName:a,desc:yn()}),!1):!!Se(e)||(r=!0,e.forEach(function(u){if(!Ee(u))return Ie({api:n,paramName:a,desc:qa("key")}),r=!1}),r);var r}}},setGroupCounters:{groupID:Ce,counters:Ve},increaseGroupCounter:{groupID:Ce,key:Ce,value:an},decreaseGroupCounter:{groupID:Ce,key:Ce,value:an},getGroupCounters:{groupID:Ce},getGroupMemberList:{groupID:Ce,count:{type:"Number"}},getGroupMemberProfile:{groupID:Ce,userIDList:Ze,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:Ce,userIDList:Ze},setGroupMemberRole:{groupID:Ce,userID:Ce,role:Ce},setGroupMemberMuteTime:{groupID:Ce,userID:Ce,muteTime:{type:"Number",validator:function(e){return 0<=e}}},setGroupMemberNameCard:{groupID:Ce,userID:{type:"String"},nameCard:{type:"String",validator:function(e,n,a){return Ee(e)?(e.length,!0):(Ie({api:n,paramName:a,desc:ve()}),!1)}}},setGroupMemberCustomField:{groupID:Ce,userID:{type:"String"},memberCustomField:Ze},deleteGroupMember:{groupID:Ce},markGroupMemberList:{groupID:Ce,markType:{type:"number",validator:function(e,n,a){return ft(e)?!(e<1e3&&(Ie({api:n,paramName:a,desc:jo(a,1e3)}),1)):(Ie({api:n,paramName:a,desc:Ao()}),!1)}},userIDList:g({},Ze),enableMark:g({},On)},createTextMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?Ee(e.text)?e.text.length!==0||(Ie({api:n,paramName:"payload.text",desc:Va()}),!1):(Ie({api:n,paramName:"payload.text",desc:ve()}),!1):(Ie({api:n,paramName:a,desc:lo()}),!1)}})},createTextAtMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?Ee(e.text)?e.text.length===0?(Ie({api:n,paramName:"payload.text",desc:Va()}),!1):!(e.atUserList&&!ke(e.atUserList)&&(Ie({api:n,paramName:"payload.atUserList",desc:yn()}),1)):(Ie({api:n,paramName:"payload.text",desc:ve()}),!1):(Ie({api:n,paramName:a,desc:lo()}),!1)}})},createCustomMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?e.data&&!Ee(e.data)?(Ie({api:n,paramName:"payload.data",desc:ve()}),!1):e.description&&!Ee(e.description)?(Ie({api:n,paramName:"payload.description",desc:ve()}),!1):!(e.extension&&!Ee(e.extension)&&(Ie({api:n,paramName:"payload.extension",desc:ve()}),1)):(Ie({api:n,paramName:"payload",desc:lo()}),!1)}})},createImageMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){if(!ye(e))return Ie({api:n,paramName:a,desc:lo()}),!1;if(q(e.file))return Ie({api:n,paramName:"payload.file",desc:oi()}),!1;if(mt){if(!(e.file instanceof HTMLInputElement||ut(e.file)))return ye(e.file)&&typeof uni!="undefined"?e.file.tempFilePaths.length!==0&&e.file.tempFiles.length!==0||(Ie({api:n,paramName:"payload.file",desc:Xn()}),!1):(Ie({api:n,paramName:"payload.file",desc:mi()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return Ie({api:n,paramName:"payload.file",desc:Xn()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Mo()}),!0}}})},createAudioMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){return!!ye(e)||(Ie({api:n,paramName:a,desc:lo()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Mo()}),!0}}},createVideoMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){if(!ye(e))return Ie({api:n,paramName:a,desc:lo()}),!1;if(q(e.file))return Ie({api:n,paramName:"payload.file",desc:oi()}),!1;if(mt){if(!(e.file instanceof HTMLInputElement||ut(e.file)))return ye(e.file)&&typeof uni!="undefined"?!!ut(e.file.tempFile)||(Ie({api:n,paramName:"payload.file",desc:Xn()}),!1):(Ie({api:n,paramName:"payload.file",desc:mi()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return Ie({api:n,paramName:"payload.file",desc:Xn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Mo()}),!0}}},createFaceMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?ft(e.index)?!!Ee(e.data)||(Ie({api:n,paramName:"payload.data",desc:ve()}),!1):(Ie({api:n,paramName:"payload.index",desc:Ao()}),!1):(Ie({api:n,paramName:a,desc:lo()}),!1)}})},createFileMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){if(!ye(e))return Ie({api:n,paramName:a,desc:lo()}),!1;if(q(e.file))return Ie({api:n,paramName:"payload.file",desc:oi()}),!1;if(mt){if(!(e.file instanceof HTMLInputElement||ut(e.file)))return ye(e.file)&&typeof uni!="undefined"?e.file.tempFilePaths.length!==0&&e.file.tempFiles.length!==0||(Ie({api:n,paramName:"payload.file",desc:Xn()}),!1):(Ie({api:n,paramName:"payload.file",desc:mi()}),!1);if(e.file instanceof HTMLInputElement&&e.file.files.length===0)return Ie({api:n,paramName:"payload.file",desc:Xn()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Mo()}),!0}}},createLocationMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?Ee(e.description)?ft(e.longitude)?!!ft(e.latitude)||(Ie({api:n,paramName:"payload.latitude",desc:Ao()}),!1):(Ie({api:n,paramName:"payload.longitude",desc:Ao()}),!1):(Ie({api:n,paramName:"payload.description",desc:ve()}),!1):(Ie({api:n,paramName:a,desc:lo()}),!1)}})},createMergerMessage:{to:Ce,conversationType:Ce,payload:g(g({},Ve),{},{validator:function(e,n,a){if(Se(e.messageList))return Ie({api:n,paramName:"payload.messageList",desc:En()}),!1;if(Se(e.compatibleText))return Ie({api:n,paramName:"payload.compatibleText",desc:Kn("compatibleText")}),!1;var r=!1;return e.messageList.forEach(function(u){u.status===W&&(r=!0)}),!r||(Ie({api:n,paramName:"payload.messageList",desc:Rt("MergeFailedMessageLog")}),!1)}})},revokeMessage:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return Se(e)?(Ie({api:n,paramName:a,desc:Ba()}),!1):e.conversationType===A.CONV_SYSTEM?(Ie({api:n,paramName:a,desc:Rt("MessageCanBeRevokedDesc")}),!1):e.isRevoked!==!0||(Ie({api:n,paramName:a,desc:Rt("MessageRevokedLog")}),!1)}})],deleteMessage:[g(g({name:"messageList"},Ze),{},{validator:function(e,n,a){return!Se(e)||(Ie({api:n,paramName:a,desc:En()}),!1)}})],translateText:{sourceTextList:Ze,sourceLanguage:Ce,targetLanguage:Ce},convertVoiceToText:{message:g(g({},Ve),{},{validator:function(e,n,a){return Se(e)?(Ie({api:n,paramName:a,desc:Ba()}),!1):e.type===A.MSG_AUDIO&&e.status===we||(Ie({api:n,paramName:a,desc:Rt("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return Se(e)?(Ie({api:n,paramName:a,desc:Ba()}),!1):e.conversationType===A.CONV_SYSTEM?(Ie({api:n,paramName:a,desc:Rt("MessageCanBeModifiedLog")}),!1):e._onlineOnlyFlag!==!0||(Ie({api:n,paramName:a,desc:Rt("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:{type:"Array",required:!1,validator:function(e,n,a){return!(e&&(ke(e)?e.length===0?(Ie({api:n,paramName:a,desc:En()}),1):5<e.length&&(Ie({api:n,paramName:a,desc:hr(a,5)}),1):(Ie({api:n,paramName:a,desc:yn()}),1)))}},keywordListMatchType:{type:"String",required:!1,validator:function(e,n,a){return!e||e==="or"||e==="and"||Ie({api:n,paramName:a,desc:"".concat(e," is invalid match type")})}},senderUserIDList:{type:"Array",required:!1,validator:function(e,n,a){return!(e&&(ke(e)?(e.length===0&&Ie({api:n,paramName:a,desc:En()}),5<e.length&&(Ie({api:n,paramName:a,desc:hr(a,5)}),1)):(Ie({api:n,paramName:a,desc:yn()}),1)))}},messageTypeList:{type:"Array",required:!1,validator:function(e,n,a){if(!e)return!0;if(!ke(e))return Ie({api:n,paramName:a,desc:yn()}),!1;e.length===0&&Ie({api:n,paramName:a,desc:En()});var r=[A.MSG_TEXT,A.MSG_IMAGE,A.MSG_AUDIO,A.MSG_FILE,A.MSG_VIDEO,A.MSG_LOCATION,A.MSG_CUSTOM,A.MSG_MERGER];return!(0<e.filter(function(u){return r.indexOf(u)===-1}).length&&(Ie({api:n,paramName:a,desc:Rt("ContainsUnsupportedMessageTypeLog",a)}),1))}},conversationID:{type:"String",required:!1,validator:function(e){return!e||Wo(e)}},timePosition:{type:"number",required:!1,validator:function(e,n,a){return!(e&&e<0&&(Ie({api:n,paramName:a,desc:jo(a,0)}),1))}},timePeriod:{type:"number",required:!1,validator:function(e,n,a){return!(e&&e<0&&(Ie({api:n,paramName:a,desc:jo(a,0)}),1))}},cursor:{type:"String",required:!1}},getUserProfile:{userIDList:{type:"Array",validator:function(e,n,a){return ke(e)?(e.length===0&&Ie({api:n,paramName:a,desc:En()}),!0):(Ie({api:n,paramName:a,desc:yn()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(e,n,a){return!!q(e)||!!ke(e)||(Ie({api:n,paramName:a,desc:yn()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(e,n,a){return!!Ee(e)||(Ie({api:n,paramName:a,desc:ve()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(e,n,a){return ke(e)?e.length!==0||(Ie({api:n,paramName:a,desc:En()}),!1):(Ie({api:n,paramName:a,desc:yn()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(e,n,a){return ke(e)?e.length!==0||(Ie({api:n,paramName:a,desc:En()}),!1):(Ie({api:n,paramName:a,desc:yn()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(e,n,a){return!e||!!ke(e)||(Ie({api:n,paramName:a,desc:yn()}),!1)}}},addFriend:{to:Ce,source:{type:"String",required:!0,validator:function(e,n,a){return!(!e||(e.startsWith("AddSource_Type_")?8<e.replace("AddSource_Type_","").length&&(Ie({api:n,paramName:a,desc:ii("keyword",8)}),1):(Ie({api:n,paramName:a,desc:Rt("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(e,n,a){return!(Ee(e)&&96<e.length&&(Ie({api:n,paramName:a,desc:ii(a,96)}),1))}}},deleteFriend:{userIDList:Ze},checkFriend:{userIDList:Ze},getFriendProfile:{userIDList:Ze},updateFriend:{userID:Ce,remark:{type:"String",required:!1,validator:function(e,n,a){return!(Ee(e)&&96<e.length&&(Ie({api:n,paramName:a,desc:ii(a,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(e,n,a){if(e){if(!ke(e))return Ie({api:n,paramName:a,desc:yn()}),!1;var r=!0;return e.forEach(function(u){return Ee(u.key)&&u.key.indexOf("Tag_SNS_Custom")!==-1?Ee(u.value)?8<u.key.replace("Tag_SNS_Custom_","").length?(Ie({api:n,paramName:a,desc:ii("keyword",8)}),r=!1):void 0:(Ie({api:n,paramName:a,desc:qa("value")}),r=!1):(Ie({api:n,paramName:a,desc:Rt("FriendCustomFieldPrefixLog")}),r=!1)}),r}return!0}}},acceptFriendApplication:{userID:Ce},refuseFriendApplication:{userID:Ce},deleteFriendApplication:{userID:Ce},createFriendGroup:{name:Ce},deleteFriendGroup:{name:Ce},addToFriendGroup:{name:Ce,userIDList:Ze},removeFromFriendGroup:{name:Ce,userIDList:Ze},renameFriendGroup:{oldName:Ce,newName:Ce},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(e,n,a){return ke(e)?e.length!==0||(Ie({api:n,paramName:a,desc:En()}),!1):(Ie({api:n,paramName:a,desc:yn()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(e,n,a){return ke(e)?e.length!==0||(Ie({api:n,paramName:a,desc:En()}),!1):(Ie({api:n,paramName:a,desc:yn()}),!1)}}],createTopicInCommunity:{groupID:Ce,topicName:Ce},deleteTopicFromCommunity:{groupID:Ce,topicIDList:{type:"Array",validator:function(e,n,a){return!e||!!ke(e)||(Ie({api:n,paramName:a,desc:yn()}),!1)}}},updateTopicProfile:{groupID:Ce,topicID:Ce},getTopicList:{groupID:Ce,topicIDList:{type:"Array",validator:function(e,n,a){return!e||!!ke(e)||(Ie({api:n,paramName:a,desc:yn()}),!1)}}},followUser:[g({name:"userIDList"},Ze)],unfollowUser:[g({name:"userIDList"},Ze)],getMyFollowingList:[g(g({name:"startIndex"},Ce),{},{required:!1})],getMyFollowersList:[g(g({name:"startIndex"},Ce),{},{required:!1})],getMutualFollowersList:[g(g({name:"startIndex"},Ce),{},{required:!1})],getUserFollowInfo:[g(g({name:"userIDList"},Ze),{},{required:!1})],checkFollowType:[g({name:"userIDList"},Ze)],addSignalingListener:[{name:"eventName",type:"String",validator:function(e,n,a){return typeof e=="string"&&e.length!==0||(Ie({api:n,paramName:a,desc:Kn(a)}),!1)}},{name:"handler",type:"Function",validator:function(e,n,a){return typeof e!="function"?(Ie({api:n,paramName:a,desc:Io()}),!1):(e.name===""&&Ie({api:n,paramName:a,desc:Oo()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(e,n,a){return typeof e=="string"&&e.length!==0||(Ie({api:n,paramName:a,desc:Kn(a)}),!1)}},{name:"handler",type:"Function",validator:function(e,n,a){return typeof e!="function"?(Ie({api:n,paramName:a,desc:Io()}),!1):(e.name===""&&Ie({api:n,paramName:a,desc:Oo()}),!0)}}],invite:{userID:Ce},inviteSync:[g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?!!Ee(e.userID)||(Ie({api:n,paramName:"options.userID",desc:ve()}),!1):(Ie({api:n,paramName:"options",desc:lo()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Io()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Io()}),!0}}],inviteInGroup:{groupID:Ce,inviteeList:Ze},inviteInGroupSync:[g(g({},Ve),{},{validator:function(e,n,a){return ye(e)?Ee(e.groupID)?!!ke(e.inviteeList)||(Ie({api:n,paramName:"options.inviteeList",desc:yn()}),!1):(Ie({api:n,paramName:"options.groupID",desc:ve()}),!1):(Ie({api:n,paramName:"options",desc:lo()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Io()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(e,n,a){return q(e)&&Ie({api:n,paramName:a,desc:Io()}),!0}}],accept:{inviteID:Ce},reject:{inviteID:Ce},getSignalingInfo:[g(g({name:"message"},Ve),{},{validator:function(e,n,a){return!Se(e)||(Ie({api:n,paramName:a,desc:Ba()}),!1)}})],modifyInvitation:{inviteID:Ce,data:Ce}},ht={login:1,logout:1,getLoginUser:1,getServerTime:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,searchCloudMessages:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,setMessageRemindType:1,setAllReceiveMessageOpt:1,getAllReceiveMessageOpt:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},xe=(V(Wa,pe(Error)),ta=ae(Wa),N(Wa)),X={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AV:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_ERR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AV:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AV:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AV:2661,CANNOT_JOIN_NON_AV_WITHOUT_LOGIN:2662,NOT_OWNER:2681,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AV:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,NO_PROTOCOL:2997,NO_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,NO_USE:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020,MSG_SEARCH_CURSOR_INVALID:27002,MSG_SEARCH_CURSOR_EXPIRED:27003},dn=null,b=(N(Dc,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){var e=this._m.get(12);return e.isPrivateNetWork()&&!e.getFileDownloadProxy()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getDowloadFileAuthKey",value:function(){return this._m.get(12).getDowloadFileAuthKey()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"getPlatform",value:function(){return rr}},{key:"getCloudConfig",value:function(e){return this._m.get(23).getCloudConfig(e)}},{key:"emitOEvt",value:function(e,n){this._m.getOEmitInst().emit(e,n)}},{key:"emitIEvt",value:function(e,n){this._m.getIEmitInst().emit(e,n)}},{key:"getIEmitInst",value:function(){return this._m.getIEmitInst()}},{key:"req",value:function(e){return this._m.get(20).req(e)}},{key:"canIUse",value:function(e){return this._m.get(27).canIUse(e)}},{key:"getErrMsg",value:function(e,n,a){return this._m.getErrMsg(e,n,a)}},{key:"warn",value:function(e,n,a){(e=this.getErrMsg(e,n,a))&&D.w(e)}},{key:"noUse",value:function(e){var n=X.NO_USE;return j({code:n,message:this.getErrMsg(n,e)})}}]),an=Dc,{LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",SEARCH_CONV_GRP_MARK:"search_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",MSG_CLOUD_SEARCH:"query",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check",SET_ALL_RECEIVE_MSG_OPT:"ws_set_do_not_disturb",GET_ALL_RECEIVE_MSG_OPT:"ws_get_do_not_disturb"}),_r="networkRTT",Sc="messageE2EDelay",Gt="sendMessageC2C",Q="sendMessageGroup",po="sendMessageGroupAV",Ht="sendMessageRichMedia",P="cosUpload",si="messageReceivedGroup",Ii="messageReceivedGroupAVPush",bo="messageReceivedGroupAVPull",na=(B(On={},_r,2),B(On,Sc,3),B(On,Gt,4),B(On,Q,5),B(On,po,6),B(On,Ht,7),B(On,si,8),B(On,Ii,9),B(On,bo,10),B(On,P,11),On),oa={info:4,warning:5,error:6},ri={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},oo={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16},ce=(N(Ka,[{key:"updateTimeStamp",value:function(){this.timestamp=Vn()}},{key:"start",value:function(e){return this._startts=e,this}},{key:"end",value:function(){var e,n=this,a=0<arguments.length&&arguments[0]!==void 0&&arguments[0];this._sentFlag||(this._netMonitorModule&&(e=this._netMonitorModule.getNetworkType(),this.setNetworkType(e)),e=Vn(),this.costTime===0&&(this.costTime=e-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(e)),a?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(function(){n._sentFlag=!0,n._eventStatModule&&n._eventStatModule.pushIn(n)},0))}},{key:"setError",value:function(e){if(!(e instanceof Error))return D.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;var n=!0;return(n=this._netMonitorModule?this._netMonitorModule.isOnline():n)?(e.code&&this.setCode(e.code),e.message&&this.setMoreMessage(e.message)):this.setCode(X.NO_NETWORK),this.setLevel("error"),this}},{key:"setCode",value:function(e){return q(e)||this._sentFlag||(e==="ECONNABORTED"&&(this.code=103),ft(e)?this.code=e:D.w("".concat(this._n,".setCode value not a number, please check!"),e,T(e))),this}},{key:"setMessage",value:function(e){return q(e)||this._sentFlag||(ft(e)&&(this.message=e.toString()),Ee(e)&&(this.message=e)),this}},{key:"setCostTime",value:function(e){return this.costTime=e,this}},{key:"setLevel",value:function(e){return q(e)||this._sentFlag||(this.level=oa[e]),this}},{key:"setMoreMessage",value:function(e){return Se(this.moreMessage)?this.moreMessage="".concat(e):this.moreMessage+=" ".concat(e),this}},{key:"setNetworkType",value:function(e){return q(e)?D.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(e=ri[e.toLowerCase()],q(e)||(this.networkType=e)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(e){return this.uiPlatform=e,this}},{key:"setExtension",value:function(e){return this.extension=e,this}},{key:"setEventType",value:function(e){return this.eventType=e,this}}],[{key:"bindEventStatModule",value:function(e){Ka.prototype._eventStatModule=e}},{key:"bindNetMonitorModule",value:function(e){Ka.prototype._netMonitorModule=e}}]),Ka),Mi=(N(Ci,[{key:"setText",value:function(e){this.content.text=e}},{key:"sendable",value:function(){return this.content.text.length!==0}}]),Ci);function Ci(e){v(this,Ci),this.type=A.MSG_TEXT,this.content={text:e.text||""}}function Ka(e){v(this,Ka),this._n="SSOLogData",this.eventType=oo[e]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=e,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=Vn()}function Dc(e){v(this,Dc),this._m=e,this._n=""}function Wa(e){v(this,Wa),n=ta.call(this);var n,a=e.code,r=e.message;return e=e.data,n.code=a,r?n.message=r:n._getErrMsg&&(n.message=n._getErrMsg(n.code)),n.data=e||{},n}function Qn(e,n,a,r){var u;if(r=3<arguments.length&&r!==void 0?r:[],e)return u=e,n&&(e.startsWith("http://")?u=e.replace(/^http:\/\/[^/]+/,n):e.startsWith("https://")&&(u=e.replace(/^https:\/\/[^/]+/,n))),a&&u.indexOf("authKey=")===-1&&ja(u,r)?(-1<u.indexOf("?")?"".concat(u,"&authKey="):"".concat(u,"?authKey=")).concat(a):u}function ue(e,n,a){return a=2<arguments.length&&a!==void 0?a:[],e===A.MSG_VIDEO?ja((n[0].content||n[0].payload).snapshotUrl,a)&&(n[0].content?(n[0].content.snapshotUrl=ci(n[0].content.snapshotUrl),n[0].content.thumbUrl=ci(n[0].content.thumbUrl)):(n[0].payload.snapshotUrl=ci(n[0].payload.snapshotUrl),n[0].payload.thumbUrl=ci(n[0].payload.thumbUrl))):e===A.MSG_FILE?ja((n[0].content||n[0].payload).fileUrl,a)&&(n[0].content?n[0].content.fileUrl=ci(n[0].content.fileUrl):n[0].payload.fileUrl=ci(n[0].payload.fileUrl)):e===A.MSG_MERGER&&(e=(a=n[0].content||n[0].payload).downloadKey,a=(a=a.messageList)===void 0?[]:a,Se(e===void 0?"":e)&&a.forEach(function(r){ue(r.messageBody[0].type,r.messageBody)})),n}function ci(e){if(!e||e.indexOf("authKey=")===-1)return e;for(var n=(e=e.split("?"))[1].split("&"),a=0,r=0;r<n.length;r++)if(-1<n[r].indexOf("authKey=")){a=r;break}return n.splice(a,1),0<n.length?"".concat(e[0],"?").concat(n.join("&")):e[0]}function ja(e,n){var a=!1;if(e){var r=(e=e.match(/:\/\/([0-9]?\.)?(.[^/:]+)/))&&e[2]||"";if(r.includes("rich-dev"))return 1;for(var u=0;u<n.length;u++)if(r.endsWith(n[u])){a=!0;break}}return a}N(as,[{key:"_initImageInfoModel",value:function(){var e=this;this._ImageInfoModel=function(n){this.instanceID=mn(9999999),this.sizeType=n.type||0,this.type=0,this.size=n.size||0,this.width=n.width||0,this.height=n.height||0,this.imageUrl=n.imageUrl||n.url||"",this.url=Qn(n.url||e._imageMemoryURL,e._fileDownloadProxy,e._authKey,e._fileDNList)},this._ImageInfoModel.prototype={setSizeType:function(n){this.sizeType=n},setType:function(n){this.type=n},setImageUrl:function(n){n&&(this.imageUrl=n)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(e){for(var n,a=0,r=null;a<=2;)n=q(e)||q(e[a])?{type:0,size:0,width:0,height:0,url:""}:e[a],(r=new this._ImageInfoModel(n)).setSizeType(a+1),r.setType(a),this.addImageInfo(r),a++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(e){for(var n,a=this.content.imageInfoArray.length,r=0;r<a;r++)n=this.content.imageInfoArray[r],e[r].size&&(n.size=e[r].size),e[r].url&&n.setImageUrl(e[r].url),e[r].width&&(n.width=e[r].width),e[r].height&&(n.height=e[r].height)}},{key:"_autoFixUrl",value:function(){for(var e=this.content.imageInfoArray.length,n="",a="",r=["http","https"],u=null,d=0;d<e;d++)this.content.imageInfoArray[d].url&&(u=this.content.imageInfoArray[d]).imageUrl!==""&&(a=u.imageUrl.slice(0,u.imageUrl.indexOf("://")+1),n=u.imageUrl.slice(u.imageUrl.indexOf("://")+1),r.indexOf(a)<0&&(a="https:"),this.content.imageInfoArray[d].setImageUrl([a,n].join("")))}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(e){this.content.imageFormat=at[e.toUpperCase()]||at.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(e){e!==void 0&&0<e.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(e.files[0]))}},{key:"createImageDataASURL",value:function(e){e&&e.url&&(this._imageMemoryURL=e.url)}},{key:"replaceImageInfo",value:function(e,n){this.content.imageInfoArray[n]instanceof this._ImageInfoModel||(this.content.imageInfoArray[n]=e)}},{key:"addImageInfo",value:function(e){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(e)}},{key:"updateAccessSideImageInfoArray",value:function(){var e=this.content.imageInfoArray,n=(n=(a=e[0]).width)===void 0?0:n,a=(a=a.height)===void 0?0:a;n!==0&&a!==0&&(pr(e),Object.assign(e[2],dr({originWidth:n,originHeight:a,min:720})))}},{key:"sendable",value:function(){return this.content.imageInfoArray.length!==0&&this.content.imageInfoArray[0].imageUrl!==""&&this.content.imageInfoArray[0].size!==0}}]);var Ti=as,Ya=(N(is,[{key:"sendable",value:function(){return this.content!==null}}]),is),ia=(N(os,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(e){this.content.remoteAudioUrl=e}},{key:"sendable",value:function(){return this.content.remoteAudioUrl!==""}}]),os),Zn={from:!0,groupID:!0,groupName:!0,to:!0},za=(N(ns,[{key:"_initContent",value:function(e){var n=this;Object.keys(e).forEach(function(a){switch(a){case"remarkInfo":case"memberExtraInfo":case"onlineMemberInfo":break;case"groupProfile":n.content.groupProfile={},n._initGroupProfile(e[a]);break;case"operatorInfo":n.content.operatorInfo={},n._initOperatorInfo(e[a]);break;case"memberInfoList":case"msgMemberInfo":n._updateMemberList(e[a]);break;case"memberNum":n.content[a]=e[a],n.content.memberCount=e[a];break;case"newGroupProfile":n.content.newGroupProfile={},n._initNewGroupProfile(e[a]);break;default:n.content[a]=e[a]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(e){for(var n=Object.keys(e),a=0;a<n.length;a++){var r=n[a];Zn[r]&&(this.content.groupProfile[r]=e[r])}}},{key:"_initOperatorInfo",value:function(e){for(var n=Object.keys(e),a=0;a<n.length;a++){var r=n[a];this.content.operatorInfo[r]=e[r]}}},{key:"_updateMemberList",value:function(e){Se(this.content.memberList)?this.content.memberList=e:this.content.memberList.forEach(function(n){e.forEach(function(a){n.userID===a.userID&&Object.assign(n,a)})})}},{key:"_initNewGroupProfile",value:function(e){for(var n=Object.keys(e),a=0;a<n.length;a++){var r=n[a];this.content.newGroupProfile[r]=r!=="muteAllMembers"?e[r]:e[r]===1}}}]),ns),aa={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},fr=(N(Lc,[{key:"_initContent",value:function(e){var n=this;Object.keys(e).forEach(function(a){switch(a){case"memberInfoList":break;case"remarkInfo":n.content.handleMessage=e[a];break;case"groupProfile":n.content.groupProfile={},n._initGroupProfile(e[a]);break;default:n.content[a]=e[a]}})}},{key:"_initGroupProfile",value:function(e){for(var n=Object.keys(e),a=0;a<n.length;a++){var r=n[a];aa[r]&&(r==="groupName"?this.content.groupProfile.name=e[r]:this.content.groupProfile[r]=e[r])}}}]),Lc),Ja=(N(Mn,[{key:"_getFileInfo",value:function(e){return q(e.fileName)||q(e.fileSize)?(e=e.file.files[0],Ct&&(e.path&&e.path.indexOf(".")!==-1&&(n=e.path.slice(e.path.lastIndexOf(".")+1).toLowerCase(),e.type=n,e.name||(e.name="".concat(mn(999999),".").concat(n))),e.name||(e.type="",e.name=e.path.slice(e.path.lastIndexOf("/")+1).toLowerCase()),e.suffix&&(e.type=e.suffix),e.url||(e.url=e.path)),{size:e.size,name:e.name}):{size:e.fileSize,name:e.fileName};var n}},{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(e){this.content.fileUrl=e}},{key:"sendable",value:function(){return this.content.fileUrl!==""&&this.content.fileName!==""&&this.content.fileSize!==0}}]),Mn),$a=(N(ts,[{key:"setData",value:function(e){return this.content.data=e,this}},{key:"setDescription",value:function(e){return this.content.description=e,this}},{key:"setExtension",value:function(e){return this.content.extension=e,this}},{key:"sendable",value:function(){return this.content.data.length!==0||this.content.description.length!==0||this.content.extension.length!==0}}]),ts),Xa=(N(sa,[{key:"updatePercent",value:function(e){this._percent=e,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(e){e&&(this.content.remoteVideoUrl=e)}},{key:"updateSnapshotInfo",value:function(e){var n=e.snapshotUrl,a=e.snapshotWidth;e=e.snapshotHeight,Se(n)||(this.content.thumbUrl=this.content.snapshotUrl=n),Se(a)||(this.content.thumbWidth=this.content.snapshotWidth=Number(a)),Se(e)||(this.content.thumbHeight=this.content.snapshotHeight=Number(e))}},{key:"sendable",value:function(){return this.content.remoteVideoUrl!==""}}]),sa),Ec=(N(yr,[{key:"sendable",value:function(){return!0}}]),yr),Rc=(N(es,[{key:"_patchRichMediaPayload",value:function(e,n){e===A.MSG_IMAGE?n.imageInfoArray.forEach(function(a){!a.imageUrl&&a.url&&(a.imageUrl=a.url,a.sizeType=a.type,a.type===1?a.type=0:a.type===3&&(a.type=1))}):e===A.MSG_VIDEO?!n.remoteVideoUrl&&n.videoUrl&&(n.remoteVideoUrl=n.videoUrl):e===A.MSG_AUDIO?!n.remoteAudioUrl&&n.url&&(n.remoteAudioUrl=n.url):e===A.MSG_FILE&&!n.fileUrl&&n.url&&(n.fileUrl=n.url,n.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(e,n,a,r,u){(a||r)&&(e===A.MSG_IMAGE?n.imageInfoArray.forEach(function(d){d.url=Qn(d.url,a,r,u)}):e===A.MSG_VIDEO?(n.videoUrl=Qn(n.videoUrl,a,r,u),n.snapshotUrl=Qn(n.thumbUrl,a,r,u),n.snapshotHeight=n.thumbHeight,n.snapshotWidth=n.thumbWidth):e===A.MSG_AUDIO?n.url=Qn(n.url,a,r,u):e===A.MSG_FILE&&(n.fileUrl=Qn(n.fileUrl,a,r,u)))}}]),es),mr=(N(Za,[{key:"sendable",value:function(){return!Se(this.content.messageList)||!Se(this.content.downloadKey)}}]),Za),vr={1:A.MSG_PRIORITY_HIGH,2:A.MSG_PRIORITY_NORMAL,3:A.MSG_PRIORITY_LOW,4:A.MSG_PRIORITY_LOWEST},In=(N(Qa,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(e){e!==null&&(Ee(e.nick)&&(this.nick=e.nick),Ee(e.avatar)&&(this.avatar=e.avatar),ye(e=e.messageFromAccountExtraInformation)&&Ee(e.nameCard)&&(this.nameCard=e.nameCard))}},{key:"handleGroupAtInfo",value:function(e){var n=this;e.payload&&e.payload.atUserList&&e.payload.atUserList.forEach(function(a){a!==A.MSG_AT_ALL?(n._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:a}),n.atUserList.push(a)):(n._groupAtInfoList.push({groupAtAllFlag:1}),n.atUserList.push(A.MSG_AT_ALL))}),ke(e.groupAtInfo)&&e.groupAtInfo.forEach(function(a){a.groupAtAllFlag===0?n.atUserList.push(a.groupAtUserID):a.groupAtAllFlag===1&&n.atUserList.push(A.MSG_AT_ALL)})}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(e){e&&(this.status=this.from?we:Ae,this.from||(this.from=e)),this._initFlow(e),this._initSequence(e),this._concatConversationID(e),this.generateMessageID()}},{key:"isSendable",value:function(){return this._elements.length!==0&&(this._relayFlag===!0||typeof this._elements[0].sendable=="function"&&this._elements[0].sendable())}},{key:"_initTo",value:function(e){this.conversationType===A.CONV_GROUP&&(this.to=e.groupID)}},{key:"_initSequence",value:function(e){var n,a,r;this.clientSequence===0&&e&&(this.clientSequence=!!e&&(hi[e]===void 0&&(r=new Date,n="3".concat(r.getHours()).slice(-2),a="0".concat(r.getMinutes()).slice(-2),r="0".concat(r.getSeconds()).slice(-2),hi[e]=parseInt([n,a,r,"0001"].join("")),r=a=n=null,D.l("autoIncrementIndex start index:".concat(hi[e]))),hi[e]++)),this.sequence===0&&this.conversationType===A.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===A.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(e){e!==""&&(e===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(e){var n=this.to,a=this.conversationType;a!==A.CONV_SYSTEM?(e=a===A.CONV_C2C?e===this.from?n:this.from:this.to,this.conversationID=e?"".concat(a).concat(e):null):this.conversationID=A.CONV_SYSTEM}},{key:"isElement",value:function(e){return e instanceof Mi||e instanceof Ti||e instanceof Ya||e instanceof ia||e instanceof Ja||e instanceof Xa||e instanceof za||e instanceof fr||e instanceof $a||e instanceof Ec||e instanceof mr}},{key:"setElement",value:function(e,n,a,r){var u=this;if(this.isElement(e))return this._elements=[e],void this._initProxy();function d(y){if(y.type&&y.content)switch(y.type){case A.MSG_TEXT:u.setTextElement(y.content);break;case A.MSG_IMAGE:u.setImageElement(y.content,n,a,r);break;case A.MSG_AUDIO:u.setAudioElement(y.content,n,a,r);break;case A.MSG_FILE:u.setFileElement(y.content,n,a,r);break;case A.MSG_VIDEO:u.setVideoElement(y.content,n,a,r);break;case A.MSG_CUSTOM:u.setCustomElement(y.content);break;case A.MSG_LOCATION:u.setLocationElement(y.content);break;case A.MSG_GRP_TIP:u.setGroupTipElement(y.content);break;case A.MSG_GRP_SYS_NOTICE:u.setGroupSystemNoticeElement(y.content);break;case A.MSG_FACE:u.setFaceElement(y.content);break;case A.MSG_MERGER:u.setMergerElement(y.content,n,a,r)}}if(ke(e))for(var _=0;_<e.length;_++)d(e[_]);else d(e);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(e){e=typeof e=="string"?e:e.text,e=new Mi({text:e}),this._elements.push(e)}},{key:"setImageElement",value:function(e,n,a,r){e=new Ti(e,n,a,r),this._elements.push(e)}},{key:"setAudioElement",value:function(e,n,a,r){e=new ia(e,n,a,r),this._elements.push(e)}},{key:"setFileElement",value:function(e,n,a,r){e=new Ja(e,n,a,r),this._elements.push(e)}},{key:"setVideoElement",value:function(e,n,a,r){e=new Xa(e,n,a,r),this._elements.push(e)}},{key:"setLocationElement",value:function(e){e=new Ec(e),this._elements.push(e)}},{key:"setCustomElement",value:function(e){e=new $a(e),this._elements.push(e)}},{key:"setGroupTipElement",value:function(e){var n,a={},r=e.operationType;Se(e.memberInfoList)?e.operatorInfo&&(a=e.operatorInfo):r!==A.GRP_TIP_MBR_JOIN&&r!==A.GRP_TIP_MBR_KICKED_OUT&&r!==A.GRP_TIP_MBR_SET_ADMIN&&r!==A.GRP_TIP_MBR_CANCELED_ADMIN||(a=e.memberInfoList[0]),Se(e.memberExtraInfo)||(n=e.memberExtraInfo.reason,e.msgMemberInfo.forEach(function(u){u.reason=n})),r=a.nick,a=a.avatar,Ee(r)&&(this.nick=r),Ee(a)&&(this.avatar=a),r=new za(e),this._elements.push(r)}},{key:"setGroupSystemNoticeElement",value:function(e){e=new fr(e),this._elements.push(e)}},{key:"setFaceElement",value:function(e){e=new Ya(e),this._elements.push(e)}},{key:"setMergerElement",value:function(e,n,a,r){e=new mr(e,n,a,r),this._elements.push(e)}},{key:"setIsRead",value:function(e){this.isRead=e}},{key:"setRelayFlag",value:function(e){this._relayFlag=e}},{key:"_computePriority",value:function(e){return q(e)?A.MSG_PRIORITY_NORMAL:Ee(e)&&Object.values(vr).indexOf(e)!==-1?e:ft(e)&&(e=""+e,Object.keys(vr).indexOf(e)!==-1)?vr[e]:A.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(e){var n=e.nick;e=e.avatar,Ee(n)&&(this.nick=n),Ee(e)&&(this.avatar=e)}},{key:"setNameCard",value:function(e){Ee(e)&&(this.nameCard=e)}},{key:"initC2CReadReceiptInfo",value:function(e){var n=e.readReceiptSentByPeer;e=(e=e.timestamp)===void 0?0:e,this.conversationType===A.CONV_C2C&&this.needReadReceipt===!0&&(this.readReceiptInfo.isPeerRead=(n===void 0?void 0:n)===1,this.readReceiptInfo.timestamp=e)}}]),Qa);function Qa(e){v(this,Qa),this.ID="",this.conversationID=e.conversationID||null,this.conversationType=e.conversationType||A.CONV_C2C,this.conversationSubType=e.conversationSubType,this.time=e.time||Math.ceil(Date.now()/1e3),this.sequence=e.sequence||0,this.clientSequence=e.clientSequence||e.sequence||0,this.random=e.random||e.random===0?e.random:mn(),this.priority=this._computePriority(e.priority),this.nick=e.nick||"",this.avatar=e.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=An(e.checkResult),this._elements=[],this.isPlaceMessage=e.isPlaceMessage||0,this.isRevoked=e.isPlaceMessage===2||e.msgFlagBits===8,this.from=e.from||null,this.to=e.to||null,this.flow="",this.isSystemMessage=e.isSystemMessage||!1,this.protocol=e.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=e.status||we,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=e.cloudCustomData||"",this.isDeleted=!1,this.isModified=!!e.messageVersion,this._isExcludedFromUnreadCount=!(!e.messageControlInfo||e.messageControlInfo.excludedFromUnreadCount!==1),this._isExcludedFromLastMessage=!(!e.messageControlInfo||e.messageControlInfo.excludedFromLastMessage!==1),this.clientTime=e.clientTime||Ji()||0,this.senderTinyID=e.senderTinyID||e.tinyID||"",this.readReceiptInfo=e.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0,timestamp:0},this.needReadReceipt=e.needReadReceipt===!0||e.needReadReceipt===1,this.version=e.messageVersion||0,this.isBroadcastMessage=e.isBroadcastMessage||!1,this._receiverList=e.receiverList||void 0,this.isSupportExtension=e.isSupportExtension===!0||e.isSupportExtension===1,this._cmConfigID=e.customModerationConfigurationID,this.revoker=e.revokerInfo&&e.revokerInfo.revoker||"",this.revokerInfo=e.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=e.revokeReason||"",this.reInitialize(e.currentUser),this.extractGroupInfo(e.groupProfile||null),this.handleGroupAtInfo(e),this.initC2CReadReceiptInfo(e)}function Za(e,n,a,r){var u,d,_,y,M,R,L;v(this,Za),this.type=A.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},e.downloadKey?(d=e.downloadKey,_=e.pbDownloadKey,y=e.title,M=e.abstractList,R=e.compatibleText,u=e.version,this.content.downloadKey=d,this.content.pbDownloadKey=_,this.content.title=y,this.content.abstractList=M,this.content.compatibleText=R,this.content.version=u||0):Se(e.messageList)?e.layersOverLimit===1&&(this.content.layersOverLimit=!0):(d=e.messageList,_=e.title,y=e.abstractList,M=e.compatibleText,R=e.version,L=[],d.forEach(function(F){Se(F)||(F=new Rc(F,n,a,r),L.push(F))}),this.content.messageList=L,this.content.title=_,this.content.abstractList=y,this.content.compatibleText=M,this.content.version=R||0)}function es(e,n,a,r){var u,d;v(this,es),this.from=e.from,this.messageSender=e.from,this.time=e.time,this.messageSequence=e.sequence,this.clientSequence=e.clientSequence||e.sequence,this.messageRandom=e.random,this.cloudCustomData=e.cloudCustomData||"",this.clientTime=e.clientTime||void 0,e.ID?(this.ID=e.ID||"",this.nick=e.nick||"",this.avatar=e.avatar||"",e.messageBody?this.messageBody=JSON.parse(JSON.stringify(e.messageBody)):this.messageBody=[{type:e.type,payload:e.payload}],e.conversationType?e.conversationType.startsWith(A.CONV_C2C)?this.receiverUserID=e.to:e.conversationType.startsWith(A.CONV_GROUP)&&(this.receiverGroupID=e.to):e.receiverGroupID?this.receiverGroupID=e.receiverGroupID:e.receiverUserID&&(this.receiverUserID=e.receiverUserID),this.messageReceiver=e.to||e.messageReceiver):(this.nick=e.nick||"",this.avatar=e.avatar||"",this.messageBody=[],u=e.elements[0].type,d=e.elements[0].content,this._patchRichMediaPayload(u,d),this._updateRichMediaDownloadUrl(u,d,n,a,r),u===A.MSG_MERGER?this.messageBody.push({type:u,payload:new mr(d,n,a,r).content}):this.messageBody.push({type:u,payload:d}),e.groupID&&(this.receiverGroupID=e.groupID,this.messageReceiver=e.groupID),e.to&&(this.receiverUserID=e.to,this.messageReceiver=e.to),this.ID="".concat(e.tinyID,"-").concat(e.clientTime,"-").concat(e.random))}function yr(e){v(this,yr),this.type=A.MSG_LOCATION;var n=e.description,a=e.longitude;e=e.latitude,this.content={description:n,longitude:a,latitude:e}}function sa(e,n,a,r){v(this,sa),this.type=A.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:e.remoteVideoUrl||e.videoUrl||"",videoFormat:e.videoFormat,videoSecond:parseInt(e.videoSecond,10),videoSize:e.videoSize,videoUrl:Qn(e.videoUrl,n,a,r),videoDownloadFlag:2,videoUUID:e.videoUUID,thumbUUID:e.thumbUUID,thumbFormat:e.thumbFormat,thumbWidth:e.thumbWidth,snapshotWidth:e.thumbWidth,thumbHeight:e.thumbHeight,snapshotHeight:e.thumbHeight,thumbSize:e.thumbSize,snapshotSize:e.thumbSize,thumbDownloadFlag:2,thumbUrl:Qn(e.thumbUrl,n,a,r),snapshotUrl:Qn(e.thumbUrl,n,a,r)}}function ts(e){v(this,ts),this.type=A.MSG_CUSTOM,this.content={data:e.data||"",description:e.description||"",extension:e.extension||""}}function Mn(e,n,a,r){v(this,Mn),this.type=A.MSG_FILE,this._percent=0;var u=this._getFileInfo(e);this.content={downloadFlag:2,fileUrl:Qn(e.url||e.fileUrl,n,a,r)||"",uuid:e.uuid,fileName:u.name||"",fileSize:u.size||0}}function Lc(e){v(this,Lc),this.type=A.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(e)}function ns(e){v(this,ns),this.type=A.MSG_GRP_TIP,this.content={},this._initContent(e)}function os(e,n,a,r){v(this,os),this.type=A.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:e.second,size:e.size,url:Qn(e.url,n,a,r),remoteAudioUrl:e.url||"",uuid:e.uuid}}function is(e){v(this,is),this.type=A.MSG_FACE,this.content=e||null}function as(e,n,a,r){v(this,as),this._imageMemoryURL="",this._fileDownloadProxy=n,this._authKey=a,this._fileDNList=r,qe||$t?this.createImageDataASURL(e.file):this.createImageDataASURLInWeb(e.file),this._initImageInfoModel(),this.type=A.MSG_IMAGE,this._percent=0,this.content={imageFormat:e.imageFormat||at.UNKNOWN,uuid:e.uuid,imageInfoArray:[]},this.initImageInfoArray(e.imageInfoArray),this._autoFixUrl()}function ra(e){if(ye(e))return{pushFlag:e.disablePush===!0?1:0,title:e.title||"",desc:e.description||"",ext:e.extension||"",apnsInfo:(a=(a=(n=e).apnsInfo)===void 0?{}:a,r=n.ignoreIOSBadge,n=n.disableVoipPush,r=a.ignoreIOSBadge===!0||(r!==void 0&&r)===!0?1:0,u=void 0,q(n)||(u=n===!1?1:0),q(a.disableVoipPush)||(u=a.disableVoipPush===!1?1:0),g(g({},a),{},{badgeMode:r,isVoipPush:u})),androidInfo:(a=(a=(n=e).androidInfo)===void 0?{}:a,n=n.androidOPPOChannelID,n=a.OPPOChannelID||(n===void 0?"":n),g(g({},a),{},{Sound:(u=(r=a.sound||"").lastIndexOf("."))===-1?r:r.slice(0,u),OPPOChannelID:n,GoogleChannelID:a.FCMChannelID||""}))};var n,a,r,u}V(Si,an),Ir=ae(Si),N(Si,[{key:"onNewMessage",value:function(e){var n=e.dataList,a=e.isInstantMessage,r=e.C2CRemainingUnreadList,u=e.C2CPairUnreadList,d=(e=e.isSyncingEnded,r=(a||D.l("".concat(this._n,".onNewMessage C2CPairUnreadList:"),u,"C2CRemainingUnreadList:",r),n=this._assembly({dataList:n,C2CRemainingUnreadList:r,C2CPairUnreadList:u,isInstantMessage:a})).conversationOptionsList,u=n.messageList,n=n.isUnreadC2CMessage,0<(d=wa(u)).length&&this.emitOEvt(me.MESSAGE_MODIFIED,d),this.get(11).onNewMessage({conversationOptionsList:r,isInstantMessage:a,isUnreadC2CMessage:n,isSyncingEnded:e}),lr(u));a&&0<d.length&&this.emitOEvt(me.MESSAGE_RECEIVED,d),u.length=0}},{key:"_assembly",value:function(e){for(var n=e.dataList,a=e.C2CRemainingUnreadList,r=e.C2CPairUnreadList,u=e.isInstantMessage,d=null,_=[],y=[],M={},R=this.get(26),L=!1,F=this.get(11),x=this.get(4),K=(e=this.get(17),this.getFileDownloadProxy()),le=this.getDowloadFileAuthKey(),he=e.getFileDNList(),fe=0,Fe=n.length;fe<Fe;fe++)if(this._isC2CNotice(n[fe]))this._noticeFromUnreadDBList.push(n[fe].eventArray[0].c2CNotifyMsgArray[0]);else{var Re=n[fe],ie=(Re.currentUser=this.getMyUserID(),Re.conversationType=A.CONV_C2C,Re.isSystemMessage=!!Re.isSystemMessage,(q(Re.nick)||q(Re.avatar))&&(L=!0),(d=new In(Re)).setElement(Re.elements,K,le,he),d.setNickAndAvatar({nick:Re.nick,avatar:Re.avatar}),d.conversationID);if(u){if(this._msgFromUnreadDBMap.get(d.ID))continue;var t,o,i=!1,s=(d.from!==this.getMyUserID()?(o=F.getLatestMessageSentByPeer(ie))&&(t=o.nick,o=o.avatar,L?d.setNickAndAvatar({nick:t,avatar:o}):t===d.nick&&o===d.avatar||(i=!0)):(t=F.getLatestMessageSentByMe(ie))&&(o=t.nick,s=t.avatar,o===d.nick&&s===d.avatar||(F.modifyMessageSentByMe({conversationID:ie,latestNick:d.nick,latestAvatar:d.avatar}),x.mockOnNickAvatarModified(d.nick,d.avatar))),n[fe].isModified===1);if(F.isMessageSentByCurrentInstance(d)?d.isModified=s:s=!1,Re.msgLifeTime===0)d._onlineOnlyFlag=!0,F.isMessageSentByCurrentInstance(d)||y.push(d);else{if(!F.pushIntoMessageList(y,d,s))continue;i&&(F.modifyMessageSentByPeer({conversationID:ie,latestNick:d.nick,latestAvatar:d.avatar}),F.updateUserProfileSpecifiedKey({conversationID:ie,nick:d.nick,avatar:d.avatar}))}u&&0<d.clientTime&&R.addMessageDelay(d.clientTime)}else this._msgFromUnreadDBMap.set(d.ID,d);if(Re.msgLifeTime!==0){if(d._onlineOnlyFlag===!1){if(ft(i=F.getLastMessageTime(ie))&&d.time<i)continue;u&&(q(M[ie])?(Re=0,d.flow==="in"&&(d._isExcludedFromUnreadCount||(Re=1)),M[ie]=_.push({conversationID:ie,unreadCount:Re,type:d.conversationType,subType:d.conversationSubType,lastMessage:d._isExcludedFromLastMessage?"":d})-1):(Re=M[ie],_[Re].type=d.conversationType,_[Re].subType=d.conversationSubType,_[Re].lastMessage=d._isExcludedFromLastMessage?"":d,d.flow==="in"&&(d._isExcludedFromUnreadCount||_[Re].unreadCount++)))}}else d._onlineOnlyFlag=!0}this._handleNoticeFromUnreadDB();var c=!1;if(ke(r)&&0<r.length)for(var l=0,p=r.length;l<p;l++)(function(C){if(r[C].from!==A.CONV_SYSTEM){c=!0;var S=_.find(function(k){return k.conversationID==="".concat(A.CONV_C2C).concat(r[C].from)});S?S.unreadCount=r[C].unreadCount:_.push({conversationID:"".concat(A.CONV_C2C).concat(r[C].from),unreadCount:r[C].unreadCount,type:A.CONV_C2C})}})(l);if(ke(a))for(var m=0,I=a.length;m<I;m++)(function(C){_.find(function(S){return S.conversationID==="".concat(A.CONV_C2C).concat(a[C].from)})||_.push({conversationID:"".concat(A.CONV_C2C).concat(a[C].from),type:A.CONV_C2C,lastMsgTime:a[C].lastMsgTime})})(m);return{conversationOptionsList:_,messageList:y,isUnreadC2CMessage:c}}},{key:"getMessageListFromUnreadDB",value:function(){return J(this._msgFromUnreadDBMap.values())}},{key:"_isC2CNotice",value:function(e){return!(!ke(e=e.eventArray)||e[0].event!==10)}},{key:"_handleNoticeFromUnreadDB",value:function(){var e,n=this._noticeFromUnreadDBList.length;n!==0&&(D.l("".concat(this._n,"._handleNoticeFromUnreadDB count:").concat(n)),e=[],this._noticeFromUnreadDBList.forEach(function(a){a.hasOwnProperty("c2cMessageRevokedNotify")&&e.push(a)}),this.onMsgRevoked({dataList:e}),this._noticeFromUnreadDBList.length=0,e.length=0)}},{key:"onMsgRevoked",value:function(e){var n,a=this,r=this.get(11),u=[];e.dataList.forEach(function(d){d.c2cMessageRevokedNotify&&(d=d.c2cMessageRevokedNotify.revokedInfos,q(d)||d.forEach(function(_){var y=a.getMyUserID()===_.from?"".concat(A.CONV_C2C).concat(_.to):"".concat(A.CONV_C2C).concat(_.from);n=r.revoke(y,_.sequence,_.random);var M,R=_.revokerInfo&&_.revokerInfo.revoker,L=_.revokerInfo&&_.revokerInfo.reason||"";n?M=n:(M={conversationID:y,sequence:_.sequence},_.tinyID&&_.clientTime&&_.random&&(M.ID="".concat(_.tinyID,"-").concat(_.clientTime,"-").concat(_.random)),_.time&&(M.time=_.time)),M&&(M.revoker=R,M.revokeReason=L,M.revokerInfo={userID:R,nick:"",avatar:""},u.push(M))}))}),u.length!==0&&(r.onMessageRevoked(u),D.l("".concat(this._n,".onMsgRevoked count:").concat(u.length)),r.updateRevokerInfo(u).then(function(d){a.emitOEvt(me.MESSAGE_REVOKED,d)}))}},{key:"onMsgReadReceipt",value:function(e){var n=this;e.dataList.forEach(function(a){var r;Se(a.c2cMessageReadReceipt)||(r=a.c2cMessageReadReceipt.to,a.c2cMessageReadReceipt.uinPairReadArray.forEach(function(u){u=u.peerReadTime;var d=(D.l("".concat(n._n,".onMsgReadReceipt to:").concat(r," peerReadTime:").concat(u)),"".concat(A.CONV_C2C).concat(r)),_=n.get(11);_.recordPeerReadTime(d,u),_.updateMsgIsPeerReadProp(d,u)}))})}},{key:"onMsgReadNotice",value:function(e){var n=this;e.dataList.forEach(function(a){var r;Se(a.c2cMessageReadNotice)||(r=n.get(11),a.c2cMessageReadNotice.uinPairReadArray.forEach(function(u){var d=u.from;u=u.peerReadTime,D.l("".concat(n._n,".onMsgReadNotice from:").concat(d," lastReadTime:").concat(u)),d="".concat(A.CONV_C2C).concat(d),r.updateIsReadAfterReadReport({conversationID:d,lastMessageTime:u}),r.updateUnreadCount(d)}))})}},{key:"onMsgModified",value:function(e){D.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach(function(a){n.onMessageModified(g(g({},a),{},{conversationType:A.CONV_C2C}))})}},{key:"onReadReceiptList",value:function(e){D.l("".concat(this._n,".onReadReceiptList options:"),e),this.get(11).updateReadReceiptInfo(e.dataList)}},{key:"sendMessage",value:function(e,n){return e=this._createC2CMessagePack(e,n),this.req(e)}},{key:"_createC2CMessagePack",value:function(e,n){var a=null,r=(n&&(n.offlinePushInfo&&(a=n.offlinePushInfo),n.onlineUserOnly===!0&&(a?a.disablePush=!0:a={disablePush:!0})),""),u=(Ee(e.cloudCustomData)&&0<e.cloudCustomData.length&&(r=e.cloudCustomData),[]),d=(ye(n)&&ye(n.messageControlInfo)&&(d=(y=n.messageControlInfo).excludedFromUnreadCount,_=y.excludedFromLastMessage,y=y.excludedFromContentModeration,d===!0&&u.push("NoUnread"),_===!0&&u.push("NoLastMsg"),y===!0&&u.push("NoMsgCheck")),this.isOnlineMessage(e,n)?0:void 0),_=JSON.parse(JSON.stringify(e.getElements())),y=this.get(17).getFileDNList();return{P:b.SEND_C2C_MSG,data:{fromAccount:this.getMyUserID(),toAccount:e.to,msgBody:ue(e.type,_,y),cloudCustomData:r,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:d,nick:e.nick,avatar:e.avatar,offlinePushInfo:ra(a),messageControlInfo:d!==0?u:void 0,clientTime:e.clientTime,needReadReceipt:e.needReadReceipt===!0?1:0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0,cmConfigID:e._cmConfigID}}}},{key:"isOnlineMessage",value:function(e,n){return!(!n||n.onlineUserOnly!==!0)}},{key:"revokeMessage",value:function(e){return this.req({P:b.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:e.from,toAccount:e.to,msgSeq:e.sequence,msgRandom:e.random,msgTimeStamp:e.time}}})}},{key:"deleteMessage",value:function(e){var n=e.to;return e=e.keyList,D.l("".concat(this._n,".deleteMessage toAccount:").concat(n," count:").concat(e.length)),this.req({P:b.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:n,keyList:e}})}},{key:"modifyRemoteMessage",value:function(e){var n=e.from,a=e.to,r=(r=e.version)===void 0?0:r,u=e.sequence,d=e.random,_=e.time,y=e.payload,M=e.type,R=e.cloudCustomData,L=void(e=e._elements);return Qi(M)&&(1<e.length&&e.splice(0,1,{type:M,content:y}),L=e),this.req({P:b.MODIFY_C2C_MSG,data:{from:n,to:a,version:r,sequence:u,random:d,time:_,elements:L,cloudCustomData:R}})}},{key:"setMessageRead",value:function(e){var n=this,a=e.conversationID,r=e.lastMessageTime,u="".concat(this._n,".").concat("setMessageRead"),d=(e="convID:".concat(a," lastMessageTime:").concat(r),D.l("".concat(u," ").concat(e)),ft(r)||this.warn("DoNotModifyLastTime"),new ce("setMessageRead"));return d.setMessage(e),this.req({P:b.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:a.replace("C2C",""),lastMessageTime:r,receipt:1}]}}}).then(function(){d.end(),D.l("".concat(u," ok"));var _=n.get(11);return _.updateIsReadAfterReadReport({conversationID:a,lastMessageTime:r}),_.updateUnreadCount(a),be()}).catch(function(_){return d.setError(_).end(),D.l("".concat(u," failed. error:"),_),j(_)})}},{key:"getRoamingMessage",value:function(e){var n=this,a="".concat(this._n,".").concat("getRoamingMessage"),r=e.peerAccount,u=e.conversationID,d=e.count,_=e.lastMessageTime,y=(e=e.messageKey,"peerAccount:".concat(r," count:").concat(d||15," lastMessageTime:").concat(_||0," messageKey:").concat(e)),M=(D.l("".concat(a," ").concat(y)),new ce("getRoamingMessage"));return this.req({P:b.GET_C2C_ROAMING_MSG,data:{peerAccount:r,count:d||15,lastMessageTime:_||0,messageKey:e}}).then(function(R){var L=(R=R.data).complete,F=R.messageList,x=R.messageKey,K=(R=R.lastMessageTime,q(F)?D.l("".concat(a," ok. complete:").concat(L," but messageList is undefined!")):D.l("".concat(a," ok. complete:").concat(L," count:").concat(F.length)),M.setMessage("".concat(y," complete:").concat(L," length:").concat(F.length)).end(),n.get(11)),le=((L=L===1)&&K.setCompleted(u),[]);return F=K.onRoamingMessage(F,u,!0,le),K.modifyMessageList(u),K.updateIsRead(u),K.updateRoamingMsgKeyAndTime(u,x,R),x=K.getPeerReadTime(u),D.l("".concat(a," update isPeerRead property. convID:").concat(u," peerReadTime:").concat(x)),x?K.updateMsgIsPeerReadProp(u,x):(R=u.replace(A.CONV_C2C,""),n.getRemotePeerReadTime([R]).then(function(){K.updateMsgIsPeerReadProp(u,K.getPeerReadTime(u))})),x="",0<F.length?x=F[0].ID:(R=K.getLocalOldestMessage(u))&&(x=R.ID),D.l("".concat(a," nextReqID:").concat(x," storedMsgCount:").concat(F.length)),{nextReqID:x,storedMessageList:F,assembledMessageList:le,isPullingCompleted:L}}).catch(function(R){return M.setMessage(y).setError(R).end(),D.w("".concat(a," failed. error:"),R),j(R)})}},{key:"getRoamingMessagesHopping",value:function(e){var n=this,a="".concat(this._n,".").concat("getRoamingMessagesHopping"),r=e.peerAccount,u=(u=e.time)===void 0?0:u,d=e.count,_=e.direction,y="".concat(A.CONV_C2C).concat(r),M="peerAccount:".concat(r," count:").concat(d," time:").concat(u," direction:").concat(_),R=(D.l("".concat(a," ").concat(M)),new ce("getRoamingMessagesHopping"));return this.req({P:b.GET_C2C_ROAMING_MSG,data:{peerAccount:r,count:d+1,lastMessageTime:u,direction:_}}).then(function(L){var F=(L=L.data).complete,x=(x=L.messageList)===void 0?[]:x,K=(L=L.lastMessageTime,"complete:".concat(F," count:").concat(x.length)),le=(D.l("".concat(a," ok. ").concat(K)),R.setMessage("".concat(M," ").concat(K)).end(),F!==1&&(_===1?x.pop():x.shift()),n.get(11));return K=le.onRoamingMessage(x,y,!1),n._modifyMessageList(y,K),x=n._computeResult({complete:F,lastMessageTime:L,resultList:K}),le.storeHoppingMessageList(x.messageList),F=le.getPeerReadTime(y),D.l("".concat(a," update isPeerRead property. convID:").concat(y," peerReadTime:").concat(F)),F?le.updateMsgIsPeerReadProp(y,F):(L=y.replace(A.CONV_C2C,""),n.getRemotePeerReadTime([L]).then(function(){le.updateMsgIsPeerReadProp(y,le.getPeerReadTime(y))})),be(x)}).catch(function(L){return R.setMessage(M).setError(L).end(),D.w("".concat(a," failed. error:"),L),j(L)})}},{key:"_computeResult",value:function(e){var n=(n=e.complete)===void 0?0:n,a=e.lastMessageTime;return e={messageList:J((e=e.resultList)===void 0?[]:e),isCompleted:!1,nextMessageTime:""},n===1?e.isCompleted=!0:e.nextMessageTime=a,e}},{key:"_modifyMessageList",value:function(e,n){if(e=this.get(11).getLocalConversation(e))for(var a=e.userProfile.nick,r=e.userProfile.avatar,u=(e=this.get(4).getNickAndAvatarByUserID(this.getMyUserID())).nick,d=e.avatar,_=n.length-1;0<=_;_--){var y=n[_];y.flow==="in"&&(y.nick!==a&&y.setNickAndAvatar({nick:a}),y.avatar!==r&&y.setNickAndAvatar({avatar:r})),y.flow==="out"&&(y.nick!==u&&y.setNickAndAvatar({nick:u}),y.avatar!==d&&y.setNickAndAvatar({avatar:d}))}}},{key:"getRemotePeerReadTime",value:function(e){var n=this,a="".concat(this._n,".").concat("getRemotePeerReadTime");if(Se(e))return Promise.resolve();var r=new ce("getRemotePeerReadTime");return D.l("".concat(a," userIDList:").concat(e)),this.req({P:b.GET_C2C_PEER_READ_TIME,data:{userIDList:e}}).then(function(u){var d=u.data.peerReadTimeList;D.l("".concat(a," ok. peerReadTimeList:").concat(d));for(var _="",y=n.get(11),M=0;M<e.length;M++)_+="".concat(e[M],"-").concat(d[M]," "),0<d[M]&&y.recordPeerReadTime("".concat(A.CONV_C2C).concat(e[M]),d[M]);r.setMessage(_).end()}).catch(function(u){r.setError(u).end(),D.w("".concat(a," failed. error:"),u)})}},{key:"sendReadReceipt",value:function(e){var n=e[0].conversationID.replace(A.CONV_C2C,""),a=new ce("sendReadReceipt"),r=(a.setMessage("peerAccount:".concat(n)),this.getMyUserID());if((e=e.filter(function(d){return d.from!==r&&d.needReadReceipt===!0}).map(function(d){return{fromAccount:d.from,toAccount:d.to,sequence:d.sequence,random:d.random,time:d.time,clientTime:d.clientTime}})).length===0)return j({code:X.READ_RECEIPT_MSG_LIST_EMPTY});var u="".concat(this._n,".").concat("sendReadReceipt");return D.l("".concat(u,". peerAccount:").concat(n," length:").concat(e.length)),this.req({P:b.SEND_C2C_READ_RECEIPT,data:{peerAccount:n,messageInfoList:e}}).then(function(d){return a.end(),D.l("".concat(u," ok")),be()}).catch(function(d){return a.setError(d).end(),D.w("".concat(u," failed. error:"),d),j(d)})}},{key:"getReadReceiptList",value:function(e){var n=e[0].conversationID.replace(A.CONV_C2C,"");return D.l("".concat(this._n,".getReadReceiptList peerAccount:").concat(n," msgCount:").concat(e.length)),Ke({messageList:e})}},{key:"getMessageExtensions",value:function(e,n){return D.l("".concat(this._n,".getMessageExtensions startSequence:").concat(n)),this.req({P:b.GET_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),startSequence:n}})}},{key:"modifyMsgExts",value:function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return D.l("".concat(this._n,".modifyMsgExts operateType:").concat(a)),this.req({P:b.MODIFY_C2C_MSG_EXT,data:{from:e.from,to:e.to,messageKey:this.getMessageKey(e),extensionList:n,operateType:a}})}},{key:"getMessageKey",value:function(e){var n=e.clientSequence,a=e.random;return e=e.time,"".concat(n,"_").concat(a,"_").concat(e)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._msgFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]);var Ir,kc=Si,Kt={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)},Ac=(N(ss,[{key:"_onCloudConfig",value:function(){var e=this._convM.getCloudConfig("topic_msg_limit");q(e)||(this.TOPIC_MSG_LIMIT=Number(e)),D.l("".concat(this._n,"._onCloudConfig topicMsgLimit:").concat(this.TOPIC_MSG_LIMIT))}},{key:"onCheckTimer",value:function(e){if(e%20==0&&0<this._map.size){var n,a=Ne(this._map);try{for(a.s();!(n=a.n()).done;){var r=te(n.value,2),u=r[0],d=r[1];u.includes(ur)&&d.size>=this.TOPIC_MSG_LIMIT&&this._convM.clearMemMsg(u,!0)}}catch(_){a.e(_)}finally{a.f()}}}},{key:"pushIn",value:function(e){var n=1<arguments.length&&arguments[1]!==void 0&&arguments[1],a=e.conversationID,r=!0,u=(this._map.has(a)||this._map.set(a,new Map),this._getUniqueIDOfMsg(e));if(this._map.get(a).has(u)){var d=this._map.get(a).get(u);if(!n||d.isModified===!0)return!1}return this._map.get(a).set(u,e),this._setLatestMsgSentByPeer(a,e),this._setLatestMsgSentByMe(a,e),r}},{key:"unshift",value:function(e,n){var a;if(ke(e)?0<e.length&&(a=e[0].conversationID,this._unshiftMultipleMsgs(e,n)):(a=e.conversationID,this._unshiftSingleMsg(e,n)),a){var r=Array.from(this._map.get(a).values());if((e=r.length)!==0){for(var u=e-1;0<=u;u--)if(r[u].flow==="out"){this._setLatestMsgSentByMe(a,r[u]);break}if(a.startsWith(A.CONV_C2C)){for(var d=e-1;0<=d;d--)if(r[d].flow==="in"){this._setLatestMsgSentByPeer(a,r[d]);break}}}}}},{key:"_unshiftSingleMsg",value:function(e,n){var a=e.conversationID,r=this._getUniqueIDOfMsg(e);if(!this._map.has(a))return this._map.set(a,new Map),this._map.get(a).set(r,e),void n.push(e);var u=this._map.get(a),d=Array.from(u);u.has(r)||(d.unshift([r,e]),this._map.set(a,new Map(d)),n.push(e))}},{key:"_unshiftMultipleMsgs",value:function(e,n){for(var a=e.length,r=[],u=e[0].conversationID,d=this._map.get(u),_=this._map.has(u)?Array.from(d):[],y=0;y<a;y++){var M=this._getUniqueIDOfMsg(e[y]);d&&d.has(M)||(r.push([M,e[y]]),n.push(e[y]))}this._map.set(u,new Map(r.concat(_)))}},{key:"remove",value:function(e){var n=e.conversationID;e=this._getUniqueIDOfMsg(e),this._map.has(n)&&this._map.get(n).delete(e)}},{key:"revoke",value:function(e,n,a){var r;return this._map.has(e)?(r=this._map.get(e),this._updateMsgIsRevoked(r,n,a)):this._hoppingMsgMap.has(e)?(r=this._hoppingMsgMap.get(e),this._updateMsgIsRevoked(r,n,a)):null}},{key:"_updateMsgIsRevoked",value:function(e,n,a){var r,u=Ne(e);try{for(u.s();!(r=u.n()).done;){var d=te(r.value,2)[1];if(d.sequence===n&&(q(a)||d.random===a))return d.isRevoked||(d.isRevoked=!0),d}}catch(_){u.e(_)}finally{u.f()}}},{key:"removeByConvID",value:function(e){var n=this._map.has(e);D.l("".concat(this._n,".removeByConvID convID:").concat(e," has:").concat(n)),n&&(this._map.delete(e),this._latestMsgSentByPeerMap.delete(e),this._latestMsgSentByMeMap.delete(e))}},{key:"findMessage",value:function(e){var n=null;return(n=this._findMsg(e,this._map))?n:this._findMsg(e,this._hoppingMsgMap)}},{key:"_findMsg",value:function(e,n){var a,r=null,u=Ne(n);try{for(u.s();!(a=u.n()).done;)for(var d=J(te(a.value,2)[1].values()),_=d.length,y=0;y<_;y++)if(d[y].ID===e){r=d[y];break}}catch(M){u.e(M)}finally{u.f()}return r}},{key:"updateMsgIsPeerReadProp",value:function(e,n){var a,r=[];return this._map.has(e)?(a=this._map.get(e),r=this._updateMsgIsPeerReadProp(a,n)):this._hoppingMsgMap.has(e)&&(a=this._hoppingMsgMap.get(e),r=this._updateMsgIsPeerReadProp(a,n)),D.l("".concat(this._n,".updateMsgIsPeerReadProp convID:").concat(e," peerReadTime:").concat(n," count:").concat(r.length)),r}},{key:"_updateMsgIsPeerReadProp",value:function(e,n){var a,r=[],u=Ne(e);try{for(u.s();!(a=u.n()).done;){var d=te(a.value,2)[1];d.time<=n&&!d.isPeerRead&&d.flow==="out"&&(d.isPeerRead=!0,r.push(d))}}catch(_){u.e(_)}finally{u.f()}return r}},{key:"updateMsgIsModifiedProp",value:function(e){var n=e.conversationID;this._map.has(n)&&(e=this._getUniqueIDOfMsg(e),(n=this._map.get(n).get(e))&&(n.isModified=!0))}},{key:"hasLocalMsgList",value:function(e){return this._map.has(e)}},{key:"getLocalMsgList",value:function(e){return this.hasLocalMsgList(e)?J(this._map.get(e).values()):[]}},{key:"getLocalMaxSeq",value:function(e){return this.hasLocalMsgList(e)?(e=J(this._map.get(e).values()).map(function(n){return n.sequence}),Math.max.apply(Math,J(e))):0}},{key:"getLocalMaxTime",value:function(e){return this.hasLocalMsgList(e)?(e=J(this._map.get(e).values()).map(function(n){return n.time}),Math.max.apply(Math,J(e))):0}},{key:"hasLocalMsg",value:function(e,n){for(var a=!1,r=this.getLocalMsgList(e),u=r.length,d=0;d<u;d++)r[d].ID===n&&(a=!0);return a}},{key:"getLocalMsg",value:function(e,n){for(var a=null,r=this.getLocalMsgList(e),u=r.length,d=0;d<u;d++)if(r[d].ID===n){a=r[d];break}return a}},{key:"getLocalLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-1]}},{key:"getLocalSecondLastMsg",value:function(e){return(e=this.getLocalMsgList(e))[e.length-2]}},{key:"getLocalOldestMsg",value:function(e){return this.getLocalMsgList(e)[0]}},{key:"_setLatestMsgSentByPeer",value:function(e,n){e.startsWith(A.CONV_C2C)&&n.flow==="in"&&this._latestMsgSentByPeerMap.set(e,n)}},{key:"_setLatestMsgSentByMe",value:function(e,n){n.flow==="out"&&this._latestMsgSentByMeMap.set(e,n)}},{key:"getLatestMsgSentByPeer",value:function(e){return this._latestMsgSentByPeerMap.get(e)}},{key:"getLatestMsgSentByMe",value:function(e){return this._latestMsgSentByMeMap.get(e)}},{key:"modifyMsgSentByPeer",value:function(e){var n=e.conversationID,a=e.latestNick,r=e.latestAvatar;if(!Se(e=this._map.get(n))){var u=Array.from(e.values());if((e=u.length)!==0){for(var d=null,_=0,y=!1,M=e-1;0<=M;M--)u[M].flow==="in"&&((d=u[M]).nick!==a&&(d.setNickAndAvatar({nick:a}),y=!0),d.avatar!==r&&(d.setNickAndAvatar({avatar:r}),y=!0),y&&(_+=1));D.l("".concat(this._n,".modifyMsgSentByPeer convID:").concat(n," count:").concat(_))}}}},{key:"modifyMsgSentByMe",value:function(e){var n=e.conversationID,a=e.latestNick,r=e.latestAvatar;if(!Se(e=this._map.get(n))){var u=Array.from(e.values());if((e=u.length)!==0){for(var d=null,_=0,y=!1,M=e-1;0<=M;M--)u[M].flow==="out"&&((d=u[M]).nick!==a&&(d.setNickAndAvatar({nick:a}),y=!0),d.avatar!==r&&(d.setNickAndAvatar({avatar:r}),y=!0),y&&(_+=1));D.l("".concat(this._n,".modifyMsgSentByMe convID:").concat(n," count:").concat(_))}}}},{key:"getTopicConvIDList",value:function(e){return J(this._map.keys()).filter(function(n){return n.startsWith("".concat(A.CONV_GROUP).concat(e))})}},{key:"onMsgModified",value:function(e,n){if(!this._map.has(e)&&!this._hoppingMsgMap.has(e))return{isUpdated:!1,message:null};var a="".concat(this._n,".onMsgModified"),r=this._getUniqueIDOfMsg(n),u=this._getTargetMsg(e,r),d=!!u;return D.l("".concat(a," convID:").concat(e," uniqueID:").concat(r," has:").concat(d)),d?(e=n.messageVersion,r=n.elements,d=n.cloudCustomData,n=n.checkResult,D.l("".concat(a," localVersion:").concat(u.version," remoteVersion:").concat(e)),u.version<e?(u.version=e,u._elements=JSON.parse(JSON.stringify(r)),u.payload=u._elements[0].content,u.type=u._elements[0].type,u.cloudCustomData=d,u.isModified=!0,u.hasRiskContent=An(n),{isUpdated:!0,message:u}):{isUpdated:!1,message:u}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMsg",value:function(e){var n=e.from,a=e.to,r=e.random,u=e.sequence;return e=e.time,"".concat(n,"-").concat(a,"-").concat(r,"-").concat(u,"-").concat(e)}},{key:"_getTargetMsg",value:function(e,n){if(this._map.has(e))return this._map.get(e).get(n);var a=void 0;if(this._hoppingMsgMap.has(e)){for(var r=J(this._hoppingMsgMap.get(e).values()),u=0;u<r.length;u++)if(this._getUniqueIDOfMsg(r[u])===n){a=r[u];break}}return a}},{key:"storeHoppingMsgList",value:function(e){if(e.length!==0){var n=e[0].conversationID,a=e.length;this._hoppingMsgMap.has(n)||this._hoppingMsgMap.set(n,new Map);for(var r=this._hoppingMsgMap.get(n),u=0;u<a;u++){var d=e[u];r.has(d.ID)||r.set(d.ID,d)}}}},{key:"getHoppingMsg",value:function(e,n){if(this._hoppingMsgMap.has(e))return this._hoppingMsgMap.get(e).get(n)}},{key:"reset",value:function(){this._map.clear(),this._latestMsgSentByPeerMap.clear(),this._latestMsgSentByMeMap.clear(),this._hoppingMsgMap.clear()}}]),ss);function ss(e){v(this,ss),this._convM=e,this._map=new Map,this._n="MsgListHandler",this._latestMsgSentByPeerMap=new Map,this._latestMsgSentByMeMap=new Map,this._hoppingMsgMap=new Map,this.TOPIC_MSG_LIMIT=1e3,this._convM.getIEmitInst().on(Kt.CLOUD_CONFIG,this._onCloudConfig,this)}function Si(e){return v(this,Si),(e=Ir.call(this,e))._n="C2CModule",e._msgFromUnreadDBMap=new Map,e._noticeFromUnreadDBList=[],e}function rs(e){this.mixin(e)}function cs(e,n,a){return q(e)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:a&&e.ID||e instanceof In?{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",messageForShow:un(e.type,e.payload,n),payload:e.payload||null,type:e.type||null,isRevoked:e.isRevoked||!1,cloudCustomData:e.cloudCustomData||"",onlineOnlyFlag:e._onlineOnlyFlag||!1,nick:e.nick||"",nameCard:e.nameCard||"",version:e.version||0,isPeerRead:e.isPeerRead||!1,revoker:e.revoker||null}:g(g({},e),{},{messageForShow:un(e.type,e.payload,n)})}function Oc(e,n){return Se(e)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:e.time||0,lastSequence:e.sequence||0,fromAccount:e.from||"",payload:e.payload||null,type:e.type||"",messageForShow:un(e.type,e.payload,n),nick:e.nick||"",avatar:e.avatar||"",version:e.version||0,cloudCustomData:e.cloudCustomData||"",isRevoked:e.isRevoked||!1,revoker:e.revoker||null}}function Mr(e){var n=String(e).replace(/[=]+$/,""),a="";if(n.length%4==1)return"";for(var r,u,d=0,_=0;u=n.charAt(_++);~u&&(r=d%4?64*r+u:u,d++%4)&&(a+=String.fromCharCode(255&r>>(-2*d&6))))u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(u);try{return decodeURIComponent(escape(a))}catch(y){return""}}rs.mixin=function(e){(e=e.prototype||e)._isReady=!1,e.ready=function(n){if(n)return this._isReady?void(1<arguments.length&&arguments[1]!==void 0&&arguments[1]?n.call(this):setTimeout(n,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(n))},e.triggerReady=function(){var n=this;this._isReady=!0,setTimeout(function(){var a=n._readyQueue;n._readyQueue=[],a&&0<a.length&&a.forEach(function(r){r.call(this)},n)},1)},e.resetReady=function(){this._isReady=!1,this._readyQueue=[]},e.isReady=function(){return this._isReady}};var Yt,Pu,Cr,ca,Tr,Gu=["jpg","jpeg","gif","png","bmp","image","webp"],Uu=["mp4","quicktime","mov"],ui=(N(Ds,[{key:"validate",value:function(e){var n,a=!0,r="";if(Se(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var u=e.profileCustomField.length,d=null,_=0;_<u;_++){if(d=e.profileCustomField[_],!Ee(d.key)||d.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!Ee(d.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(n==="profileCustomField")continue;if(Se(e[n])&&!Ee(e[n])&&!ft(e[n])){r="key:"+n+", invalid value:"+e[n],a=!1;continue}switch(n){case"nick":Ee(e[n])||(a=!(r="nick must be a string")),500<gi(e[n])&&(r="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(gi(e[n])," bytes"),a=!1);break;case"gender":vo(gc,e.gender)||(r="key:gender, invalid value:"+e.gender,a=!1);break;case"birthday":ft(e.birthday)||(a=!(r="birthday must be a number"));break;case"location":Ee(e.location)||(a=!(r="location must be a string"));break;case"selfSignature":Ee(e.selfSignature)||(a=!(r="selfSignature must be a string"));break;case"allowType":vo(di,e.allowType)||(r="key:allowType, invalid value:"+e.allowType,a=!1);break;case"language":ft(e.language)||(a=!(r="language must be a number"));break;case"avatar":Ee(e.avatar)||(a=!(r="avatar must be a string"));break;case"messageSettings":e.messageSettings!==0&&e.messageSettings!==1&&(a=!(r="messageSettings must be 0 or 1"));break;case"adminForbidType":vo(hc,e.adminForbidType)||(r="key:adminForbidType, invalid value:"+e.adminForbidType,a=!1);break;case"level":ft(e.level)||(a=!(r="level must be a number"));break;case"role":ft(e.role)||(a=!(r="role must be a number"));break;default:r="unknown key:"+n+"  "+e[n],a=!1}}return{valid:a,tips:r}}}]),Ds),Sr=(N(Ss,[{key:"set",value:function(e){var n;this.map.size>=this.MAX_LENGTH&&(n=this.map.entries().next().value[0],this.map.delete(n)),this.map.set(e,1)}},{key:"has",value:function(e){return this.map.has(e)}},{key:"delete",value:function(e){this.has(e)&&this.map.delete(e)}},{key:"reset",value:function(){this.map.clear()}}]),Ss),wu=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],Po=(N(Ts,[{key:"memberNum",get:function(){return this.memberCount},set:function(e){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(e){}},{key:"_initGroup",value:function(e){for(var n in e)wu.indexOf(n)<0||(n!=="selfInfo"?(n==="memberNum"&&(this.memberCount=e[n]),n==="maxMemberNum"&&(this.maxMemberCount=e[n]),n!=="isSupportTopic"?this[n]=e[n]:this.isSupportTopic=e[n]===1):this.updateSelfInfo(e[n]))}},{key:"updateGroup",value:function(e){var n=this;(e.appid=void 0,e.grossTopicNextMsgSeq=void 0,e.selfInfo&&(e.selfInfo.grossTopicReadSeq=void 0),e=JSON.parse(JSON.stringify(e))).lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),q(e.muteAllMembers)||(e.muteAllMembers==="On"?e.muteAllMembers=!0:e.muteAllMembers=!1),e.groupCustomField&&Ho(this.groupCustomField,e.groupCustomField),q(e.memberNum)||(this.memberCount=e.memberNum),q(e.maxMemberNum)||(this.maxMemberCount=e.maxMemberNum),q(e.isSupportTopic)||(this.isSupportTopic=ft(e.isSupportTopic)?e.isSupportTopic===1:e.isSupportTopic),Gn(this,e,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),ke(e.members)&&0<e.members.length&&e.members.forEach(function(a){a.userID===n.selfInfo.userID&&Gn(n.selfInfo,a,["sequence"])})}},{key:"updateSelfInfo",value:function(e){e={nameCard:e.nameCard,joinTime:e.joinTime,role:e.role,messageRemindType:e.messageRemindType,readedSequence:e.readedSequence,excludedUnreadSequenceList:e.excludedUnreadSequenceList},Gn(this.selfInfo,g({},e),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(e){this.selfInfo.nameCard=e}}]),Ts),ua=(N(Cs,[{key:"toAccount",get:function(){return this.conversationID.startsWith(A.CONV_C2C)?this.conversationID.replace(A.CONV_C2C,""):this.conversationID.startsWith(A.CONV_GROUP)?this.conversationID.replace(A.CONV_GROUP,""):""}},{key:"_initProfile",value:function(e){var n=this;Object.keys(e).forEach(function(a){switch(a){case"userProfile":n.userProfile=e.userProfile;break;case"groupProfile":n.groupProfile=e.groupProfile}}),q(this.userProfile)&&this.type===A.CONV_C2C?this.userProfile=new ui({userID:e.conversationID.replace("C2C","")}):q(this.groupProfile)&&this.type===A.CONV_GROUP&&(this.groupProfile=new Po({groupID:e.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(e){var n=e.nextUnreadCount,a=e.isFromGetConversations;e=e.isUnreadC2CMessage,q(n)||(Un(this.subType)?this.unreadCount=0:a&&this.type===A.CONV_GROUP||a&&this.type===A.CONV_TOPIC||e&&this.type===A.CONV_C2C?this.unreadCount=n:this.unreadCount=this.unreadCount+n)}},{key:"updateLastMessage",value:function(e){this.lastMessage=cs(e)}},{key:"updateGroupAtInfoList",value:function(e){var n;this._isNeedMergeGroupAtInfo(e)||((n=(Le(n=e.groupAtType)||re(n)||Be(n)||Xe()).slice(0)).indexOf(A.CONV_AT_ME)!==-1&&n.indexOf(A.CONV_AT_ALL)!==-1&&(n=[A.CONV_AT_ALL_AT_ME]),n={from:e.from,groupID:e.groupID,topicID:e.topicID,messageSequence:e.sequence,atTypeArray:n,__random:e.__random,__sequence:e.__sequence},this.groupAtInfoList.push(n))}},{key:"_isNeedMergeGroupAtInfo",value:function(e){var n=e.groupID,a=e.sequence;if(!Vt({groupID:n}))return!1;var r=!1;return this.groupAtInfoList.forEach(function(u){u.messageSequence===a&&(-1<u.atTypeArray.indexOf(A.CONV_AT_ME)&&-1<e.groupAtType.indexOf(A.CONV_AT_ALL)&&(u.atTypeArray=[A.CONV_AT_ALL_AT_ME]),-1<u.atTypeArray.indexOf(A.CONV_AT_ALL)&&-1<e.groupAtType.indexOf(A.CONV_AT_ME)&&(u.atTypeArray=[A.CONV_AT_ALL_AT_ME],u.__random=e.__random,u.__sequence=e.__sequence),r=!0)}),r}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){var n=e.sequence;return e=e.time,this.type===A.CONV_C2C&&n===this.lastMessage.lastSequence&&e===this.lastMessage.lastTime||this.type===A.CONV_GROUP&&n===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}},{key:"setDraftText",value:function(e){this.draftText=e}}]),Cs),Nc=(B(Ze={},A.MSG_REMIND_ACPT_AND_NOTE,0),B(Ze,A.MSG_REMIND_DISCARD,1),B(Ze,A.MSG_REMIND_ACPT_NOT_NOTE,2),Ze),Xl=(N(Ms,[{key:"onAllRcvMsgOptNotify",value:function(e){e=this._handleResult(e),this._convM.emitOEvt(me.ALL_RECEIVE_MESSAGE_OPT_UPDATED,e)}},{key:"getC2CMsgRemindType",value:function(e){var n=this,a="".concat(this._n,".getC2CMsgRemindType");return this._convM.req({P:b.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:e}}).then(function(r){D.l("".concat(a," ok. userIDList:").concat(e)),r=r.data.muteFlagList,n._convM.onC2CMsgRemindTypeFetched(r)}).catch(function(r){D.e("".concat(a," failed. error:"),r)})}},{key:"set",value:function(e){return e.groupID?this._setGroupMsgRemindType(e):ke(e.userIDList)?this._setC2CMsgRemindType(e):void 0}},{key:"_setGroupMsgRemindType",value:function(e){var n=this,a="".concat(this._n,".").concat("_setGroupMsgRemindType"),r=e.groupID,u=e.messageRemindType,d="groupID:".concat(r," messageRemindType:").concat(u),_=new ce("_setGroupMsgRemindType"),y=(_.setMessage(d),this._get(7));return y?y.modifyGroupMemberInfo({groupID:r,messageRemindType:u,userID:this._convM.getMyUserID()}).then(function(){_.end(),D.l("".concat(a," ok. ").concat(d));var M=n.onGroupMsgRemindTypeUpdated(e);return n._convM.onTotalUnreadCountUpdate(),be(M)}).catch(function(M){return _.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)}):j({code:X.NO_MODULE})}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){var n,a,r=e.groupID,u=(e=e.messageRemindType,D.l("".concat(this._n,".onGroupMsgRemindTypeUpdated groupID:").concat(r," messageRemindType:").concat(e)),this._get(7).getLocalGroupProfile(r));return u&&(u.selfInfo.messageRemindType=e),bt(r)?(n=vn(a=r),(a=this._get(10).getLocalTopic(n,a))&&a.updateSelfInfo({messageRemindType:e})&&this._convM.emitOEvt(me.TOPIC_UPDATED,{groupID:n,topic:a}),{topic:a}):(this._convM.patchMsgRemindType({ID:r,isC2CConversation:!1,messageRemindType:e})&&this._emitConvUpdate(),{group:u})}},{key:"_setC2CMsgRemindType",value:function(e){var n=this,a="".concat(this._n,".").concat("_setC2CMsgRemindType"),r=e.userIDList,u=e.messageRemindType,d=r.slice(0,30),_=(e=Nc[u]||0,"userIDList:".concat(d," messageRemindType:").concat(u)),y=new ce("_setC2CMsgRemindType");return y.setMessage(_),this._convM.req({P:b.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:d,muteFlag:e}}).then(function(M){y.end(),M=M.data.errorList;var R=[],L=[],F=(ke(M)&&M.forEach(function(x){R.push(x.userID),L.push({userID:x.userID,code:x.errorCode})}),M=d.filter(function(x){return R.indexOf(x)===-1}),D.l("".concat(a," ok. ").concat(_," successUserIDList:").concat(M," failureUserIDList:").concat(JSON.stringify(L))),0);return M.forEach(function(x){n._convM.patchMsgRemindType({ID:x,isC2CConversation:!0,messageRemindType:u})&&(F+=1)}),1<=F&&n._emitConvUpdate(),d.length=R.length=0,n._convM.onTotalUnreadCountUpdate(),Ke({successUserIDList:M.map(function(x){return{userID:x}}),failureUserIDList:L})}).catch(function(M){return y.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"_get",value:function(e){return this._convM.get(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"setAllRcvMsgOpt",value:function(e){var n="".concat(this._n,".").concat("setAllRcvMsgOpt"),a=(a=e.messageRemindType)===void 0?A.MSG_REMIND_ACPT_NOT_NOTE:a,r=(r=e.isRepeated)===void 0||r,u=(u=(d=this._calcStartAndEndTime(e)).startTime)===void 0?0:u,d=(d=d.endTime)===void 0?0:d,_=(e=JSON.stringify(e),new ce("setAllRcvMsgOpt"));return _.setMessage(e),D.l("".concat(n," options:").concat(e)),this._convM.req({P:b.SET_ALL_RECEIVE_MSG_OPT,data:{messageRemindType:Nc[a],startTime:u,endTime:d,isRepeated:r?1:0}}).then(function(y){return _.end(),D.l("".concat(n," ok.")),be(y)}).catch(function(y){return _.setError(y).end(),D.e("".concat(n," failed. error:"),y),j(y)})}},{key:"_calcStartAndEndTime",value:function(e){var n=(n=e.startHour)===void 0?0:n,a=(a=e.startMinute)===void 0?0:a,r=(r=e.startSecond)===void 0?0:r,u=(u=e.duration)===void 0?0:u,d=(e=(e=e.isRepeated)===void 0||e,(y=new Date).getFullYear()),_=y.getMonth(),y=y.getDate();return{startTime:d=Math.round(new Date(d,_,y,n,a,r).getTime()/1e3),endTime:e&&86400<=u?d+86400:d+u}}},{key:"getAllRcvMsgOpt",value:function(){var e=this,n="".concat(this._n,".").concat("getAllRcvMsgOpt"),a=new ce("getAllRcvMsgOpt");return this._convM.req({P:b.GET_ALL_RECEIVE_MSG_OPT,data:{toAccount:this._convM.getMyUserID()}}).then(function(r){return r=r.data,a.setMessage(JSON.stringify(r)).end(),D.l("".concat(n," ok. data:").concat(JSON.stringify(r))),be(r=e._handleResult(r))}).catch(function(r){return a.setError(r).end(),D.e("".concat(n," failed. error:"),r),j(r)})}},{key:"_handleResult",value:function(e){var n=e.messageRemindType,a=e.startTime,r=e.endTime,u=(e=e.isRepeated,A.MSG_REMIND_ACPT_AND_NOTE);return n===1&&(u=A.MSG_REMIND_DISCARD),{messageRemindType:u=n===2?A.MSG_REMIND_ACPT_NOT_NOTE:u,startTime:a,endTime:r,isRepeated:e===1}}},{key:"reset",value:function(){D.l("".concat(this._n,".reset"))}}]),Ms),Ql=(N(Is,[{key:"setConvCustomData",value:function(e){var n=this,a="".concat(this._n,".").concat("setConvCustomData"),r=e.conversationIDList,u=e.customData,d=(D.l("".concat(a," options:"),e),new ce("setConvCustomData")),_=(d.setMessage(JSON.stringify(e)),{fromAccount:this._getMyUserID(),itemList:[]}),y=[],M=[];return r.forEach(function(R){if(!n._hasLocalConv(R))return n._onConvNotFound(M,R),!0;if(!Lt(R)&&!Bt(R))return n._onConvIDInvalid(M,R),!0;var L={operationType:2,contactItem:void 0,customMark:u};Lt(R)?L.contactItem={type:1,toAccount:R.replace(A.CONV_C2C,"")}:Bt(R)&&(L.contactItem={type:2,groupID:R.replace(A.CONV_GROUP,"")}),_.itemList.push(L)}),M.length===r.length?Ke({successConversationIDList:y,failureConversationIDList:M}):this._convM.req({P:b.SET_CONV_CUSTOM_DATA,data:_}).then(function(R){var L,F,x;return d.end(),D.l("".concat(a," ok")),ke(R=R.data.resultItem)&&(x=!1,R.forEach(function(K){L=n._concatConvID(K.contactItem),K.resultCode===0?(y.push(L),(F=n._getLocalConv(L))&&F.customData!==u&&(F.customData=u,x=!0)):M.push({conversationID:L,code:K.resultCode,message:K.resultInfo})}),x===!0&&n._emitConvUpdate()),be({successConversationIDList:y,failureConversationIDList:M})}).catch(function(R){return d.setError(R).end(),D.e("".concat(a," failed. error:"),R),j(R)})}},{key:"markConv",value:function(e){var n=this;if(!this._convM.canIUse(Qe.CONV_MARK))return this._convM.noUse("markConv");var a="".concat(this._n,".").concat("markConv"),r=e.conversationIDList,u=e.markType,d=e.enableMark,_=(D.l("".concat(a," options:"),e),new ce("markConv")),y=void _.setMessage(JSON.stringify(e)),M=void 0,R=(e=this._getFlagBit(u),d===!0?M=[e]:y=[e],{fromAccount:this._getMyUserID(),itemList:[]}),L=[],F=[];return r.forEach(function(x){if(!n._hasLocalConv(x))return n._onConvNotFound(F,x),!0;if(!Lt(x)&&!Bt(x))return n._onConvIDInvalid(F,x),!0;var K={operationType:1,contactItem:void 0,clearMark:y,setMark:M};Lt(x)?K.contactItem={type:1,toAccount:x.replace(A.CONV_C2C,"")}:Bt(x)&&(K.contactItem={type:2,groupID:x.replace(A.CONV_GROUP,"")}),R.itemList.push(K)}),F.length===r.length?Ke({successConversationIDList:L,failureConversationIDList:F}):this._convM.req({P:b.MARK_CONV,data:R}).then(function(x){var K,le,he;return _.end(),D.l("".concat(a," ok")),ke(x=x.data.resultItem)&&(he=!1,x.forEach(function(fe){var Fe;K=n._concatConvID(fe.contactItem),fe.resultCode===0?(L.push(K),(le=n._getLocalConv(K))&&(Fe=le.markList.indexOf(u),d===!0?Fe===-1&&(le.markList.push(u),he=!0):Fe!==-1&&(le.markList.splice(Fe,1),he=!0))):F.push({conversationID:K,code:fe.resultCode,message:fe.resultInfo})}),he===!0&&n._emitConvUpdate()),be({successConversationIDList:L,failureConversationIDList:F})}).catch(function(x){return _.setError(x).end(),D.e("".concat(a," failed. error:"),x),j(x)})}},{key:"getLocalConvGroupList",value:function(){var e=this;return D.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===ai?this.getRemoteConvGroupList().then(function(){return be(J(e._convGroupMap.values()))}):Ke(J(this._convGroupMap.values()))}},{key:"searchConvGroupAndMark",value:function(e,n){var a=this,r="".concat(this._n,".searchConvGroupAndMark"),u=[];return e.forEach(function(d){n===1?u.push({type:1,toAccount:d}):n===2&&u.push({type:2,groupID:d})}),D.l("".concat(r," type:").concat(n," list:"),e),this._convM.req({P:b.SEARCH_CONV_GRP_MARK,data:{fromAccount:this._getMyUserID(),contactItem:u}}).then(function(d){var _=(d=d.data).contactItem;d=d.groupItem,D.l("".concat(r," ok. contactItem:"),_,"groupItem:",d),a._fillConvGroupMap(d),a._handleContactItem(_),a._emitConvUpdate()}).catch(function(d){D.w("".concat(r," failed. error:"),d)})}},{key:"_fillConvGroupMap",value:function(e){var n=this;ke(e)&&e.forEach(function(a){var r=a.convGroupID;a=a.groupName,n._convGroupMap.set(r,a)})}},{key:"_handleContactItem",value:function(e){var n,a=this;ke(e)&&e.forEach(function(r){var u=[],d=r.standardMark,_=r.customData,y=r.convGroupIDList;ke(y)&&y.forEach(function(M){a._convGroupMap.has(M)&&u.push(a._convGroupMap.get(M))}),n=a._concatConvID(r),(n=a._getLocalConv(n))&&(n.markList=Fa(d),n.customData=_||"",n.conversationGroupList=[].concat(u))})}},{key:"getRemoteConvGroupList",value:function(){var e=this,n="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=Ha,this._convM.req({P:b.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex}}).then(function(a){var r=(a=a.data).completeFlag,u=a.contactItem,d=(d=a.nextStartIndex)===void 0?0:d;if(a=a.groupItem,e._startIndex=d,D.l("".concat(n," completeFlag:").concat(r," nextStartIndex:").concat(d,", groupItem:"),a,"contactItem:",u),e._fillConvGroupMap(a),e._handleContactItem(u),r===0)return e.getRemoteConvGroupList();r===1&&(e._pagingStatus=Jn,e._emitConvUpdate(),e._emitConvGroupListUpdate())}).catch(function(a){e._pagingStatus=ai,D.w("".concat(n," failed. error:"),a)})}},{key:"createConvGroup",value:function(e){var n=this;if(!this._convM.canIUse(Qe.CONV_GROUP))return this._convM.noUse("createConvGroup");var a="".concat(this._n,".").concat("createConvGroup"),r=(D.l("".concat(a," options:"),e),new ce("createConvGroup")),u=(r.setMessage(JSON.stringify(e)),e.groupName),d=(e=e.conversationIDList,{fromAccount:this._getMyUserID(),itemList:[{groupName:u,contactItem:[]}]}),_=[],y=[];return e.forEach(function(M){return n._hasLocalConv(M)?Lt(M)||Bt(M)?void(Lt(M)?d.itemList[0].contactItem.push({type:1,toAccount:M.replace(A.CONV_C2C,"")}):Bt(M)&&d.itemList[0].contactItem.push({type:2,groupID:M.replace(A.CONV_GROUP,"")})):(n._onConvIDInvalid(y,M),!0):(n._onConvNotFound(y,M),!0)}),y.length===e.length?Ke({successConversationIDList:_,failureConversationIDList:y}):this._convM.req({P:b.CREATE_CONV_GRP,data:d}).then(function(M){r.end(),D.l("".concat(a," ok"));var R,L,F,x=(M=M.data.groupResultItem[0]).groupItem;return M=M.resultItem,ye(x)&&(n._convGroupMap.set(x.convGroupID,x.groupName),n._emitConvGroupListUpdate()),ke(M)&&(F=!1,M.forEach(function(K){R=n._concatConvID(K.contactItem),K.resultCode===0?(_.push(R),(L=n._getLocalConv(R))&&L.conversationGroupList.indexOf(u)===-1&&(L.conversationGroupList.push(u),F=!0)):y.push({conversationID:R,code:K.resultCode,message:K.resultInfo})}),F===!0&&(n._emitConvUpdate(),n._emitConvGroupListUpdate())),be({successConversationIDList:_,failureConversationIDList:y})}).catch(function(M){return r.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"deleteConvGroup",value:function(e){var n=this;if(!this._convM.canIUse(Qe.CONV_GROUP))return this._convM.noUse("deleteConvGroup");var a="".concat(this._n,".").concat("deleteConvGroup"),r=(D.l("".concat(a," groupName:").concat(e)),new ce("deleteConvGroup"));return r.setMessage(e),this._convM.req({P:b.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[e]}}).then(function(u){var d;r.end(),D.l("".concat(a," ok")),ke(u=u.data.groupItem)&&(d=!1,u.forEach(function(_){n._convGroupMap.has(_.convGroupID)&&(n._convGroupMap.delete(_.convGroupID),d=!0)}),d===!0&&n._emitConvGroupListUpdate()),n._eraseFromConversationGroupList([e])}).catch(function(u){return r.setError(u).end(),D.e("".concat(a," failed. error:"),u),j(u)})}},{key:"renameConvGroup",value:function(e){var n=this;if(!this._convM.canIUse(Qe.CONV_GROUP))return this._convM.noUse("renameConvGroup");var a="".concat(this._n,".").concat("renameConvGroup"),r=(D.l("".concat(a," options:"),e),new ce("renameConvGroup")),u=(r.setMessage(JSON.stringify(e)),e.oldName),d=e.newName;return this._convM.req({P:b.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:u,newName:d}}}).then(function(_){r.end(),D.l("".concat(a," ok")),_=_.data.updateGroupResult.convGroupID,n._convGroupMap.set(_,d),n._emitConvGroupListUpdate(),_=n._convM.getLocalConvList();var y,M,R=!1;_.forEach(function(L){y=L.conversationGroupList,(M=y.indexOf(u))!==-1&&(y.splice(M,1,d),R=!0)}),R===!0&&n._emitConvUpdate()}).catch(function(_){return r.setError(_).end(),D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"addConvsToGroup",value:function(e){var n=this;if(!this._convM.canIUse(Qe.CONV_GROUP))return this._convM.noUse("addConvsToGroup");var a="".concat(this._n,".").concat("addConvsToGroup"),r=(D.l("".concat(a," options:"),e),new ce("addConvsToGroup")),u=(r.setMessage(JSON.stringify(e)),e.conversationIDList),d=e.groupName,_={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:d,updateItem:[]}},y=[],M=[];return u.forEach(function(R){return n._hasLocalConv(R)?Lt(R)||Bt(R)?void(Lt(R)?_.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:R.replace(A.CONV_C2C,"")}}):Bt(R)&&_.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:R.replace(A.CONV_GROUP,"")}})):(n._onConvIDInvalid(M,R),!0):(n._onConvNotFound(M,R),!0)}),M.length===u.length?Ke({successConversationIDList:y,failureConversationIDList:M}):this._convM.req({P:b.ADD_CONV_TO_GRP,data:_}).then(function(R){var L,F,x;return r.end(),D.l("".concat(a," ok")),ke(R=R.data.updateGroupResult.contactResultItem)&&(x=!1,R.forEach(function(K){L=n._concatConvID(K.contactItem),K.resultCode===0?(F=n._getLocalConv(L))&&F.conversationGroupList.indexOf(d)===-1&&(F.conversationGroupList.push(d),y.push(L),x=!0):M.push({conversationID:L,code:K.resultCode,message:K.resultInfo})}),x===!0&&(n._emitConvUpdate(),n._emitConvInGroupUpdate(d))),be({successConversationIDList:y,failureConversationIDList:M})}).catch(function(R){return r.setError(R).end(),D.e("".concat(a," failed. error:"),R),j(R)})}},{key:"deleteConvsFromGroup",value:function(e){var n=this,a="deleteConvsFromGroup";if(!this._convM.canIUse(Qe.CONV_GROUP))return this._convM.noUse(a);var r="".concat(this._n,".").concat(a),u=(D.l("".concat(r," options:"),e),new ce(a)),d=(u.setMessage(JSON.stringify(e)),a=e.conversationIDList,e.groupName),_={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:d,updateItem:[]}},y=[],M=[];return a.forEach(function(R){return n._hasLocalConv(R)?Lt(R)||Bt(R)?void(Lt(R)?_.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:R.replace(A.CONV_C2C,"")}}):Bt(R)&&_.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:R.replace(A.CONV_GROUP,"")}})):(n._onConvIDInvalid(M,R),!0):(n._onConvNotFound(M,R),!0)}),M.length===a.length?Ke({successConversationIDList:y,failureConversationIDList:M}):this._convM.req({P:b.DEL_CONV_FROM_GRP,data:_}).then(function(R){var L,F,x;return u.end(),D.l("".concat(r," ok")),ke(R=R.data.updateGroupResult.contactResultItem)&&(x=!1,R.forEach(function(K){var le;L=n._concatConvID(K.contactItem),K.resultCode===0?!(F=n._getLocalConv(L))||(le=F.conversationGroupList.indexOf(d))!==-1&&(F.conversationGroupList.splice(le,1),y.push(L),x=!0):M.push({conversationID:L,code:K.resultCode,message:K.resultInfo})}),x===!0&&(n._emitConvUpdate(),n._emitConvInGroupUpdate(d))),be({successConversationIDList:y,failureConversationIDList:M})}).catch(function(R){return u.setError(R).end(),D.e("".concat(r," failed. error:"),R),j(R)})}},{key:"onConvMarkUpdated",value:function(e){var n,a,r=this;Se(e)||(D.l("".concat(this._n,".onConvMarkUpdated markItemList:"),e),a=!1,e.forEach(function(u){var d=u.recentContactItem,_=u.optType,y=u.standardMark;u=u.customMark,n=r._concatConvID(d),(n=r._getLocalConv(n))&&(_===1?a=r._diffStandardMark(n,y):_===2?a=r._diffCustomMark(n,u):_===3&&(d=r._diffStandardMark(n,y),_=r._diffCustomMark(n,u),a=d||_))}),a===!0&&this._emitConvUpdate())}},{key:"_diffStandardMark",value:function(e,n){n=Fa(n);var a=!1;return function(r,u){if(r===u)return!0;if(!r||!u||r.length!==u.length)return!1;for(var d=0,_=r.length;d<_;d++)if(r[d]!==u[d])return!1;return!0}(e.markList,n)!==!0&&(e.markList=n,a=!0),a}},{key:"_diffCustomMark",value:function(e,n){var a=!1;return e.customData!==n&&n!==void 0&&(e.customData=n,a=!0),a}},{key:"onConvGroupCreated",value:function(e){var n=this,a=(D.l("".concat(this._n,".onConvGroupCreated resultList:"),e),!1),r=!1;ke(e)&&(e.forEach(function(u){var d,_,y=(_=u.msgGroupItem).groupID,M=_.groupName;n._convGroupMap.get(y)!==M&&(n._convGroupMap.set(y,M),r=!0),ke(_=u.msgRecentContactItem)&&_.forEach(function(R){d=n._concatConvID(R),(d=n._getLocalConv(d))&&d.conversationGroupList.indexOf(M)===-1&&(d.conversationGroupList.push(M),a=!0)})}),a===!0&&this._emitConvUpdate(),r===!0&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(e){var n,a=this,r=(D.l("".concat(this._n,".onConvGroupDeleted groupItemList:"),e),[]);ke(e)&&(n=!1,e.forEach(function(u){var d=u.groupID;u=u.groupName,a._convGroupMap.has(d)&&(a._convGroupMap.delete(d),n=!0,r.push(u))}),n===!0&&this._emitConvGroupListUpdate()),this._eraseFromConversationGroupList(r)}},{key:"_eraseFromConversationGroupList",value:function(e){Se(e)||(this._convM.getLocalConvList().forEach(function(n){n.conversationGroupList=n.conversationGroupList.filter(function(a){return!e.includes(a)})}),this._emitConvUpdate())}},{key:"onConvGroupNameUpdated",value:function(e){D.l("".concat(this._n,".onConvGroupNameUpdated options:"),e);var n,a,r,u=e.groupID,d=e.groupName,_=e.oldGroupName;this._convGroupMap.get(u)!==d&&(this._convGroupMap.set(u,d),this._emitConvGroupListUpdate(),e=this._convM.getLocalConvList(),r=!1,e.forEach(function(y){n=y.conversationGroupList,(a=n.indexOf(_))!==-1&&(n.splice(a,1,d),r=!0)}),r===!0&&this._emitConvUpdate())}},{key:"onConvInGroupUpdated",value:function(e){var n,a,r,u=this,d=(D.l("".concat(this._n,".onConvInGroupUpdated options:"),e),e.oldGroupName);ke(e=e.recentContactUpdateGroupItem)&&(r=!1,e.forEach(function(_){var y=_.contactOptType;_=_.recentContactItem,n=u._concatConvID(_),(n=u._getLocalConv(n))&&(a=n.conversationGroupList.indexOf(d),y===1?a===-1&&(n.conversationGroupList.push(d),r=!0):y===2&&a!==-1&&(n.conversationGroupList.splice(a,1),r=!0))}),r===!0&&(this._emitConvUpdate(),this._emitConvInGroupUpdate(d)))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){var n,a,r=this,u=(D.l("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),e),e.msgRecentContactItem),d=(e=e.msgRecentContactUpdateContactItem,u=this._concatConvID(u),this._getLocalConv(u));d&&ke(e)&&(a=!1,e.forEach(function(_){var y=_.groupOptType;_=_.recentContactGroupItem.groupName,n=d.conversationGroupList.indexOf(_),y===1?n===-1&&(d.conversationGroupList.push(_),a=!0):y===2&&n!==-1&&(d.conversationGroupList.splice(n,1),a=!0),a===!0&&r._emitConvInGroupUpdate(_)}),a===!0&&this._emitConvUpdate())}},{key:"onConvGroupListSynced",value:function(e){ke(e)&&e.length!==0&&(D.l("".concat(this._n,".onConvGroupListSynced groupItem:"),e),this._fillConvGroupMap(e))}},{key:"getConvGroupListByID",value:function(e){var n,a=this;if(!Se(e))return n=[],e.forEach(function(r){a._convGroupMap.has(r)&&n.push(a._convGroupMap.get(r))}),n}},{key:"_onConvNotFound",value:function(e,n){e.push({conversationID:n,code:X.CONV_NOT_FOUND,message:this._convM.getErrMsg(X.CONV_NOT_FOUND)})}},{key:"_onConvIDInvalid",value:function(e,n){e.push({conversationID:n,code:X.INVALID_CONV_ID,message:this._convM.getErrMsg(X.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(e){for(var n=e.toString(2),a=n.length,r=a-1;0<=r;r--)if(n[r]==="1")return a-r-1}},{key:"_concatConvID",value:function(e){var n,a=e.type,r=e.to,u=e.groupID;return e=e.userID,a===1?q(e)?q(r)||(n="".concat(A.CONV_C2C).concat(r)):n="".concat(A.CONV_C2C).concat(e):a===2&&(n="".concat(A.CONV_GROUP).concat(u)),n}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_getLocalConv",value:function(e){return this._convM.getLocalConversation(e)}},{key:"_hasLocalConv",value:function(e){return this._convM.hasLocalConversation(e)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOEvt(me.CONVERSATION_GROUP_LIST_UPDATED,J(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(e){var n={groupName:e,conversationList:[]},a=this._convM.getLocalConvList();n.conversationList=a.filter(function(r){return r.conversationGroupList.includes(e)}),this._convM.emitOEvt(me.CONVERSATION_IN_GROUP_UPDATED,n)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=No}}]),Is),us=(V(Li,an),Tr=ae(Li),N(Li,[{key:"_initListeners",value:function(){var e=this.getIEmitInst();e.on(Kt.A2KEY_AND_TINYID_UPDATED,this._init,this),e.on(Kt.PROFILE_UPDATED,this._onProfileUpdated,this),e.on(Kt.CLOUD_CONFIG,this._onCloudConfig,this)}},{key:"_init",value:function(){var e=this,n=(D.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),a=this.isIntl(),r=this.isUsingChatCore();if(n){for(var u=n.length,d=0;d<u;d++){var _=n[d];_&&(this._isNonExistentAccount(_.conversationID)||_.groupProfile&&Un(_.groupProfile.type))||this._convMap.set(_.conversationID,new ua(n[d],a,r))}this.emitConvUpdate(!0,!1)}this.ready(function(){0<e._tmpGroupList.length&&(e.updateConvGroupProfile(e._tmpGroupList),e._tmpGroupList.length=0)}),this.syncConvList()}},{key:"_isNonExistentAccount",value:function(e){var n;return(n=e.startsWith(A.CONV_C2C)?e.replace(A.CONV_C2C,""):n)==="@TLS#ERROR"||n==="@TLS#NOT_FOUND"}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&this._msgListHandler.onCheckTimer(e)}},{key:"onMessageSent",value:function(e){this._onSendOrRcvMsg({conversationOptionsList:e.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(e){this._onSendOrRcvMsg(e)}},{key:"_onSendOrRcvMsg",value:function(e){var n=this,a=e.conversationOptionsList,r=(r=e.isInstantMessage)===void 0||r,u=(u=e.isUnreadC2CMessage)!==void 0&&u,d=(d=e.updateUnreadCount)===void 0||d,_=(_=e.isSyncingEnded)!==void 0&&_;this._isReady?a.length!==0?(r===!0&&this._checkNewConv(a),this._updateLocalConvList({conversationOptionsList:a,isInstantMessage:r,isUnreadC2CMessage:u,isFromGetConversations:!1,updateUnreadCount:d}),r||(this._convIDFromUnreadDBMap=new Map([].concat(J(this._convIDFromUnreadDBMap),J(a.map(function(y){return[y.conversationID,1]})))),this._diffAndDeleteConv(),_&&this.emitIEvt(Kt.C2C_UNREAD_HANDLE_COMPLETED)),0<a.filter(function(y){return!n._isConvNeedShow(y.conversationID)}).length||this.emitConvUpdate()):_&&this.emitIEvt(Kt.C2C_UNREAD_HANDLE_COMPLETED):this.ready(function(){n._onSendOrRcvMsg(e)})}},{key:"updateConvGroupProfile",value:function(e){var n,a=this;ke(e)&&e.length===0||(this._convMap.size!==0?(n=!1,e.forEach(function(r){var u="".concat(A.CONV_GROUP).concat(r.groupID);a._convMap.has(u)&&(n=!0,(u=a._convMap.get(u)).groupProfile=JSON.parse(JSON.stringify(r)),u.lastMessage.lastSequence<r.nextMessageSeq&&(u.lastMessage.lastSequence=r.nextMessageSeq-1),u.subType||(u.subType=r.type))}),n&&this.emitConvUpdate(!0,!1)):this._tmpGroupList=e)}},{key:"onMessageRevoked",value:function(e,n){var a,r,u,d=this;e.length!==0&&(a=null,r=!1,u=[],e.forEach(function(_){(a=d._convMap.get(_.conversationID))&&(n&&a.reduceUnreadCount()&&(r=a.type!==A.CONV_TOPIC),a.type===A.CONV_TOPIC?u.push(_):a.isLastMessageRevoked({sequence:_.sequence,time:_.time})&&(a.setLastMessageRevoked(!0),a.setLastMessageRevoker(_.revoker),r=!0))}),this.get(10).onMessageRevoked(u),r&&this.emitConvUpdate(!0,!1))}},{key:"updateRevokerInfo",value:function(e){for(var n=new Set,a=0;a<e.length;a++){var r=e[a].revoker;n.add(r)}var u=J(n),d=this.get(4);return new Promise(function(_){d.getUserProfile({userIDList:u}).then(function(y){if(!ke(y=y.data)||y.length===0)return _(e);var M,R={},L=Ne(y);try{for(L.s();!(M=L.n()).done;){var F=M.value,x=F.userID,K=F.nick,le=F.avatar;R[x]={nick:K,avatar:le}}}catch(he){L.e(he)}finally{L.f()}e.forEach(function(he){var fe=he.revoker;R[fe]&&(he.revokerInfo.nick=R[fe].nick||"",he.revokerInfo.avatar=R[fe].avatar||"")}),_(e)}).catch(function(){_(e)})})}},{key:"isLastMessageRevoked",value:function(e){var n=!1,a=e.conversationID,r=e.sequence,u=e.time,d=this._convMap.get(a);return d&&(n=d.type===A.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:a.replace(A.CONV_GROUP,""),sequence:r}):d.isLastMessageRevoked({sequence:r,time:u})),D.l("".concat(this._n,".isLastMessageRevoked options:"),e,"ret:".concat(n)),n}},{key:"onMessageDeleted",value:function(e){var n=this;if(e.length!==0){var a=null;e.forEach(function(M){(a=n._msgListHandler.getLocalMsg(M.conversationID,M.ID))&&(a.isDeleted=!0),M!==a&&(M.isDeleted=!0)}),e=e[0].conversationID;for(var r=this._msgListHandler.getLocalMsgList(e),u={},d=r.length-1;0<=d;d--)if(!r[d].isDeleted){u=r[d];break}var _,y=this._convMap.get(e);y&&(_=!1,y.lastMessage.lastSequence===u.sequence&&y.lastMessage.lastTime===u.time||(Se(u)&&(u=void 0),y.updateLastMessage(u),y.type!==A.CONV_TOPIC&&(_=!0),D.l("".concat(this._n,".onMessageDeleted. update convID:").concat(e," with lastMessage:"),y.lastMessage)),e.startsWith(A.CONV_C2C)&&this.updateUnreadCount(e),_&&this.emitConvUpdate(!0,!1))}}},{key:"onMessageModified",value:function(e){var n="".concat(this._n,".onMessageModified"),a=e.conversationType,r=e.from,u=e.to,d=e.time,_=e.sequence,y=e.elements,M=e.cloudCustomData,R=e.messageVersion,L=this.getMyUserID(),F="".concat(a).concat(u),x=(a=(u===L&&a===A.CONV_C2C&&(F="".concat(a).concat(r)),L=this._msgListHandler.onMsgModified(F,e)).isUpdated,L=L.message,a===!0&&this.emitOEvt(me.MESSAGE_MODIFIED,[L]),this._isTopicConv(F));return L===null?D.l("".concat(n," message is null! options:"),e):D.l("".concat(n," isUpdated:").concat(a," isTopicMessage:").concat(x," from:").concat(r," to:").concat(u," sequence:").concat(L.sequence," time:").concat(L.time)),x?this.get(10).onMessageModified(e):!(a=this._convMap.get(F))||(r=a.lastMessage)&&r.lastTime===d&&r.lastSequence===_&&r.version!==R&&(D.l("".concat(n," convID:").concat(F," lastMessage updated")),r.type=y[0].type,r.payload=y[0].content,r.messageForShow=un(r.type,r.payload,this.isIntl()),r.cloudCustomData=M,r.version=R,this.emitConvUpdate(!0,!1)),L}},{key:"onNewGroupAtTips",value:function(e){var n=this,a=(e=e.dataList,null);e.forEach(function(r){r.groupAtTips?a=r.groupAtTips:r.elements?a=g(g({},r.elements),{},{sync:!0}):r.groupAtType&&(a=g(g({},r),{},{sync:!0})),a.__random=r.random,a.__sequence=r.clientSequence,n._tmpGroupAtTipsList.push(a)}),D.l("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var e,n=this;this._tmpGroupAtTipsList.length!==0&&(e=!1,this._tmpGroupAtTipsList.forEach(function(a){var r,u=a.groupID,d=a.from,_=(_=a.topicID)===void 0?void 0:_,y=(y=a.sync)!==void 0&&y;d!==n.getMyUserID()&&(q(_)?(d=n._convMap.get("".concat(A.CONV_GROUP).concat(u)))&&(d.updateGroupAtInfoList(a),e=!0):((u=n._convMap.get("".concat(A.CONV_GROUP).concat(_)))&&(u.updateGroupAtInfoList(a),d=n.get(10),r=u.groupAtInfoList,d.onAtInfoUpdated({topicID:_,groupAtInfoList:r})),Se(u)&&y&&(n.updateTopicConversation([{conversationID:"".concat(A.CONV_GROUP).concat(_),type:A.CONV_TOPIC}]),n._convMap.get("".concat(A.CONV_GROUP).concat(_)).updateGroupAtInfoList(a))))}),e&&this.emitConvUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConv",value:function(e){var n=this,a=[],r=[];e.forEach(function(u){n._convMap.has(u.conversationID)||(u.type===A.CONV_C2C?a.push(u.conversationID.replace(A.CONV_C2C,"")):u.type===A.CONV_GROUP&&r.push(u.conversationID.replace(A.CONV_GROUP,"")))}),0<a.length&&(this._onNewC2CConv(a),a=null),0<r.length&&(this._onNewGroupConv(r),r=null)}},{key:"_onNewC2CConv",value:function(e){var n=this.get(6);return Promise.all([n.getRemotePeerReadTime(e),this._msgRemindHandler.getC2CMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,1)])}},{key:"_onNewGroupConv",value:function(e){var n=this.get(7);return n?Promise.all([n.getMsgRemindType(e),this._convGroupHandler.searchConvGroupAndMark(e,2)]):Promise.resolve()}},{key:"_setStorageConvList",value:function(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],n=this.getLocalConvList().filter(function(a){return a.type===A.CONV_C2C||a.type===A.CONV_GROUP&&a.lastMessage.type!==A.MSG_GRP_TIP}).slice(0,20).map(function(a){return{conversationID:a.conversationID,type:a.type,subType:a.subType,lastMessage:a.lastMessage,groupProfile:a.groupProfile,userProfile:a.userProfile}});this.get(13).setItem("conversationMap",n,e)}},{key:"emitConvUpdate",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],a=this.getLocalConvList();!n||(n=this.get(7))&&n.updateGroupLastMessage(a),e&&(this.get(12).isPartialUpdatedConvs()?(this._diffConvMap(this._convMapForDiff,this._convMap),0<this._partialUpdatedConvMap.size&&(this.emitOEvt(me.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate(),this._convMapForDiff.clear(),this._convMapForDiff=Ga(this._convMap,!0)),this._convMapForDiff.size===0&&(this._convMapForDiff=Ga(this._convMap,!0))):(this.emitOEvt(me.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate()))}},{key:"_diffConvMap",value:function(e,n){var a,r=Ne(n);try{for(r.s();!(a=r.n()).done;){var u=te(a.value,2),d=u[0],_=u[1];e.has(d)&&JSON.stringify(_)===e.get(d)||this._partialUpdatedConvMap.set(d,_)}}catch(y){r.e(y)}finally{r.f()}}},{key:"getPartialUpdatedConvs",value:function(){var e=J(Ga(this._partialUpdatedConvMap,!1).values());return this._partialUpdatedConvMap.clear(),e}},{key:"getLocalConvList",value:function(){var e=this;return J(this._convMap.values()).filter(function(n){return e._isConvNeedShow(n.conversationID)})}},{key:"getLocalConversation",value:function(e){return this._convMap.get(e)}},{key:"hasLocalConversation",value:function(e){return this._convMap.has(e)}},{key:"getLocalOldestMessage",value:function(e){return this._msgListHandler.getLocalOldestMsg(e)}},{key:"syncConvList",value:function(){var e=this,n=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],a="syncConvList",r=new ce(a);return this._pagingStatus===No&&this._convMap.clear(),this._pagingGetConvList(n).then(function(u){var d=Cc(e._pagingGetCostList),_=ni(e._pagingGetCostList);return e._pagingGetCostList.length=0,e._pagingStatus=Jn,e._diffAndDeleteConv(),e.emitConvUpdate(!0,!1),e._setStorageConvList(),e._handleC2CPeerReadTime(),e.emitIEvt(Kt.CONV_SYNC_COMPLETED),_="count:".concat(e._convMap.size," sum:").concat(_," avg:").concat(d),D.l("".concat(e._n,".").concat(a,". ").concat(_)),r.setMessage(_).end(),u}).catch(function(u){return e._pagingStatus=ai,r.setMessage(e._pagingTs).setError(u).end(),j(u)})}},{key:"_diffAndDeleteConv",value:function(){var e,n=this;this._isSyncCompleted()&&(e=[],this._convMap.forEach(function(a,r){!n._pagingConvIDMap.has(r)&&n._convIDFromUnreadDBMap.has(r)&&(n._convMap.delete(r),e.push(r))}),D.l("".concat(this._n,"._diffAndDeleteConv list:").concat(e)),e=null)}},{key:"_pagingGetConvList",value:function(){var e=this,n=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],a="".concat(this._n,"._pagingGetConvList"),r=(D.l("".concat(a," incrementalPullFlag:").concat(n," ts:").concat(this._pagingTs," startIdx:").concat(this._pagingStartIdx)+" pinnedTs:".concat(this._pagingPinnedTs," pinnedStartIdx:").concat(this._pagingPinnedStartIdx)),Date.now());return this._pagingStatus=Ha,this.req({P:b.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:n?this._pagingTs:0,startIndex:n?this._pagingStartIdx:0,pinnedTimeStamp:n?this._pagingPinnedTs:0,pinnedStartIndex:n?this._pagingPinnedStartIdx:0,orderType:1}}).then(function(u){var d=(u=u.data).completeFlag,_=(_=u.conversations)===void 0?[]:_,y=u.timeStamp,M=u.startIndex,R=u.pinnedTimeStamp,L=u.pinnedStartIndex;if(u=u.groupItem,e._pagingGetCostList.push(kn(r,!1)),D.l("".concat(a," ok. completeFlag:").concat(d," count:").concat(_.length," cost:").concat(kn(r))),e._convGroupHandler.onConvGroupListSynced(u),0<_.length&&(u=e._getConvOptions(_),e._pagingConvIDMap=new Map([].concat(J(e._pagingConvIDMap),J(u.map(function(F){return[F.conversationID,1]})))),e._updateLocalConvList({conversationOptionsList:u,isFromGetConversations:!0,updateUnreadCount:!0}),e.isLoggedIn()&&e.emitConvUpdate()),!e._isReady){if(!e.isLoggedIn())return Ke();e.triggerReady()}return e._pagingTs=y,e._pagingStartIdx=M,e._pagingPinnedTs=R,e._pagingPinnedStartIdx=L,d!==1?e._pagingGetConvList():(e._handleGroupAtTipsList(),e._convGroupHandler.getRemoteConvGroupList(),Ke())}).catch(function(u){throw e.isLoggedIn()&&(e._isReady||(D.w("".concat(a," failed. error:"),u),e.triggerReady())),u})}},{key:"_updateLocalConvList",value:function(e){var n=e.isFromGetConversations,a=Date.now();e=this._getTmpConvListMapping(e).newConvList,this._convMap=new Map(this._sortConvList(J(this._convMap))),n||this._updateUserOrGroupProfile(e),D.l("".concat(this._n,"._updateLocalConvList cost:").concat(kn(a)))}},{key:"_getTmpConvListMapping",value:function(e){for(var n=e.conversationOptionsList,a=e.isFromGetConversations,r=e.isInstantMessage,u=e.isUnreadC2CMessage,d=u!==void 0&&u,_=e.updateUnreadCount,y=[],M=[],R=this.get(7),L=this.get(8),F=this.isIntl(),x=this.isUsingChatCore(),K=0,le=n.length;K<le;K++){var he=new ua(n[K],F,x),fe=he.conversationID,Fe=he.type;if(!this._isNonExistentAccount(fe)){if(this._convMap.has(fe)){var Re=this._convMap.get(fe);if(a){this._convMap.set(fe,he),Fe===A.CONV_C2C?he.unreadCount=Re.unreadCount:Fe===A.CONV_GROUP&&(he.groupProfile=JSON.parse(JSON.stringify(Re.groupProfile)));continue}var ie=["unreadCount","allowType","adminForbidType","payload"],t=(r===!1&&ie.push("lastMessage"),typeof r=="boolean"&&ie.push("isPinned"),n[K].lastMessage),o=!q(t);o||n[K].type===A.CONV_TOPIC||this._onLastMsgNotExist(n[K]),q(r)&&o&&Re.lastMessage.payload===null&&(Re.lastMessage.payload=t.payload),Se(Re.lastMessage.revoker)||(Re.lastMessage.revoker=null),Gn(Re,he,ie,[null,void 0,"",0,NaN]),_===!0&&Re.updateUnreadCount({nextUnreadCount:he.unreadCount,isFromGetConversations:a,isUnreadC2CMessage:d}),r&&o&&(t.payload&&(Re.lastMessage.payload=t.payload),Re.type===A.CONV_GROUP&&(Re.lastMessage.nameCard=t.nameCard,Re.lastMessage.nick=t.nick)),o&&Re.lastMessage.cloudCustomData!==t.cloudCustomData&&(Re.lastMessage.cloudCustomData=t.cloudCustomData||"")}else Fe===A.CONV_GROUP&&R?(ie=he.groupProfile.groupID,(o=R.getLocalGroupProfile(ie))&&(he.groupProfile=o,_===!0&&he.updateUnreadCount({nextUnreadCount:0}))):Fe===A.CONV_C2C&&(Re=fe.replace(A.CONV_C2C,""),L&&L.isMyFriend(Re)&&(he.remark=L.getFriendRemark(Re))),y.push(he),this._convMap.set(fe,he);this._convMap.get(fe).type===A.CONV_TOPIC&&M.push(this._convMap.get(fe))}}for(var i=this.get(10),s=0,c=M.length;s<c;s++){var l,p=(l=M[s]).conversationID;Se(l=l.groupAtInfoList)||i.onAtInfoUpdated({topicID:p.replace(A.CONV_GROUP,""),groupAtInfoList:l})}return{newConvList:y}}},{key:"_onLastMsgNotExist",value:function(e){new ce("lastMsgNotExist").setMessage(JSON.stringify(e)).end()}},{key:"_sortConvList",value:function(e){var n=[],a=[],r=[],u=[];return e.forEach(function(d){(d[1].isPinned===!0?Se(d[1].lastMessage.lastTime)?a:n:Se(d[1].lastMessage.lastTime)?u:r).push(d)}),n.sort(function(d,_){return _[1].lastMessage.lastTime-d[1].lastMessage.lastTime}).concat(a).concat(r.sort(function(d,_){return _[1].lastMessage.lastTime-d[1].lastMessage.lastTime})).concat(u)}},{key:"_sortConvListAndEmitEvent",value:function(){this._convMap=new Map(this._sortConvList(J(this._convMap))),this.emitConvUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(e){var n,a,r,u,d=this;e.length!==0&&(n=[],a=[],r=this.get(4),u=this.get(7),e.forEach(function(_){var y;_.type===A.CONV_C2C?n.push(_.toAccount):_.type===A.CONV_GROUP&&(y=_.toAccount,u.hasLocalGroup(y)?_.groupProfile=u.getLocalGroupProfile(y):a.push(y))}),D.l("".concat(this._n,"._updateUserOrGroupProfile userIDList:").concat(n," groupIDList:").concat(a)),0<n.length&&r.getUserProfile({userIDList:n}).then(function(_){ke(_=_.data)?_.forEach(function(y){d._doUpdateUserProfile("".concat(A.CONV_C2C).concat(y.userID),y)}):d._doUpdateUserProfile("".concat(A.CONV_C2C).concat(_.userID),_)}),0<a.length&&u.getGroupProfileAdvance({groupIDList:a,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then(function(_){_=_.data.successGroupList;var y=!1;_.forEach(function(M){var R="".concat(A.CONV_GROUP).concat(M.groupID);d._convMap.has(R)&&(Gn((R=d._convMap.get(R)).groupProfile,M,[],[null,void 0,"",0,NaN]),!R.subType&&M.type&&(R.subType=M.type),y=!0)}),y&&d.emitConvUpdate()}))}},{key:"_doUpdateUserProfile",value:function(e,n){this.hasLocalConversation(e)&&(this.getLocalConversation(e).userProfile=n,this.emitConvUpdate())}},{key:"_getConvOptions",value:function(e){var n=this,a=[],r=(e=e.filter(function(u){var d=u.type;return u=u.userID,d===1&&!n._isNonExistentAccount(u)||d===2}),this.getMyUserID());return e=e.map(function(u){var d;return q(u.lastMsg)&&(u.lastMsg={elements:[]}),u.type===1?(d={userID:u.userID,nick:u.peerNick,avatar:u.peerAvatar},a.push(d),{conversationID:"".concat(A.CONV_C2C).concat(u.userID),type:A.CONV_C2C,lastMessage:{lastTime:u.time,lastSequence:u.sequence,fromAccount:u.lastC2CMsgFromAccount,type:u.lastMsg.elements[0]?u.lastMsg.elements[0].type:null,payload:u.lastMsg.elements[0]?n._amendLayersOverLimitProp(u.lastMsg.elements[0].content):null,cloudCustomData:u.lastMsg.cloudCustomData||"",isRevoked:u.lastMessageFlag===8,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:u.lastC2CMsgFromAccount===r&&u.time<=u.c2cPeerReadTime,revoker:u.lastMsg.revokerInfo?u.lastMsg.revokerInfo.revoker:null},unreadCount:0,userProfile:new ui(d),peerReadTime:u.c2cPeerReadTime,isPinned:u.isPinned===1,customData:u.customMark||"",markList:Fa(u.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(u.contactGroupId),remark:u.friendRemark||"",messageRemindType:n._transMsgRemindType(u.messageRemindType)}):{conversationID:"".concat(A.CONV_GROUP).concat(u.groupID),type:A.CONV_GROUP,lastMessage:g(g({lastTime:u.time,lastSequence:u.sequence,fromAccount:u.msgGroupFromAccount},n._patchTypeAndPayload(u)),{},{cloudCustomData:u.lastMsg.cloudCustomData||"",isRevoked:u.lastMessageFlag===2,onlineOnlyFlag:!1,nick:u.senderNick||"",nameCard:u.senderNameCard||"",revoker:u.lastMsg.revokerInfo?u.lastMsg.revokerInfo.revoker:null}),groupProfile:new Po({groupID:u.groupID,name:u.groupNick,avatar:u.groupImage,type:u.groupType,nextMessageSeq:u.nextMessageSeq}),unreadCount:n._computeGroupUnreadCount(u),peerReadTime:0,isPinned:u.isPinned===1,version:0,customData:u.customMark||"",markList:Fa(u.standardMark),conversationGroupList:n._convGroupHandler.getConvGroupListByID(u.contactGroupId),messageRemindType:n._transMsgRemindType(u.messageRemindType)}}),0<a.length&&this.get(4).onConvProfileUpdated(a),e}},{key:"_transMsgRemindType",value:function(e){var n="";return e===0?n=A.MSG_REMIND_ACPT_AND_NOTE:e===1?n=A.MSG_REMIND_DISCARD:e===2?n=A.MSG_REMIND_ACPT_NOT_NOTE:e===3&&(n=A.NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT),n}},{key:"_computeGroupUnreadCount",value:function(e){var n;return 0<(n=((n=e.unreadCount)===void 0?0:n)-((e=e.noUnreadCount)===void 0?0:e))?n:0}},{key:"_patchTypeAndPayload",value:function(e){var n=(e=e.lastMsg).event,a=(a=e.elements)===void 0?[]:a;return e=(e=e.groupTips)===void 0?{}:e,q(n===void 0?void 0:n)||Se(e)?{type:a[0]?a[0].type:null,payload:a[0]?this._amendLayersOverLimitProp(a[0].content):null}:((n=new In(e)).setElement({type:A.MSG_GRP_TIP,content:g(g({},e.elements),{},{groupProfile:e.groupProfile})}),a=JSON.parse(JSON.stringify(n.payload)),n=null,{type:A.MSG_GRP_TIP,payload:a})}},{key:"_amendLayersOverLimitProp",value:function(e){var n=e.layersOverLimit;return n===0?e.layersOverLimit=!1:n===1&&(e.layersOverLimit=!0),e}},{key:"getLocalMessageList",value:function(e){return this._msgListHandler.getLocalMsgList(e)}},{key:"deleteLocalMessage",value:function(e){e instanceof In&&this._msgListHandler.remove(e)}},{key:"onConvDeleted",value:function(e){ke(e)&&(e=e.map(function(n){var a=n.type,r=n.userID;return n=n.groupID,a===1?"".concat(A.CONV_C2C).concat(r):a===2?"".concat(A.CONV_GROUP).concat(n):void 0}),D.l("".concat(this._n,".onConvDeleted convIDList:").concat(e)),this.deleteLocalConvList(e))}},{key:"onConvPinnedStatus",value:function(e,n){var a,r=this;ke(e)&&(a=!1,e.forEach(function(u){var d,_=u.type,y=u.userID;u=u.groupID,_===1?d=r.getLocalConversation("".concat(A.CONV_C2C).concat(y)):_===2&&(d=r.getLocalConversation("".concat(A.CONV_GROUP).concat(u))),d&&(D.l("".concat(r._n,".onConvPinnedStatus convID:").concat(d.conversationID," localPinned:").concat(d.isPinned," remotePinned:").concat(n)),n?d.isPinned||(d.isPinned=!0,a=!0):d.isPinned&&(d.isPinned=!1,a=!0))}),a&&this._sortConvListAndEmitEvent())}},{key:"getMessageList",value:function(e){var n=this,a=e.conversationID,r=e.nextReqMessageID,u=(e=e.count,"".concat(this._n,".getMessageList")),d="";if((y=this.getLocalConversation(a))&&y.groupProfile&&(d=y.groupProfile.type),Un(d))return D.l("".concat(u," not available in ").concat(d,". convID:").concat(a)),Ke({messageList:[],nextReqMessageID:"",isCompleted:!0});(q(e)||15<e)&&(e=15),r||this._isMeInCommunity(a)||this.clearMemMsg(a);var _=this._computeRemainingCount({conversationID:a,nextReqMessageID:r}),y=this._completedMap.has(a);return D.l("".concat(u," convID:").concat(a," isEverCleared:").concat(this._isEverCleared(a)," nextReqMessageID:").concat(r)+" remainingCount:".concat(_," count:").concat(e," isCompleted:").concat(y)),this._needGetHistory({conversationID:a,remainingCount:_,count:e})?this.getHistoryMessages({conversationID:a,nextReqMessageID:r,count:20}).then(function(M){var R=M.nextReqID,L=M.storedMessageList,F=M.assembledMessageList,x=(M=M.isPullingCompleted,n._completedMap.has(a)),K=L,le=(0<_&&(K=n._msgListHandler.getLocalMsgList(a).slice(0,L.length+_)),{nextReqMessageID:void 0,messageList:void 0,isCompleted:void 0});return n._isEverCleared(a)?(le.nextReqMessageID=R,le.messageList=F,le.isCompleted=M):(le.nextReqMessageID=x?"":R,le.messageList=K,le.isCompleted=x),L=le.messageList.filter(function(he){return he.isRevoked})||[],F=le.messageList.map(function(he){return he.sequence}),D.l("".concat(u," ret.nextReqMessageID:").concat(le.nextReqMessageID," ret.isCompleted:").concat(le.isCompleted," sequenceList:"),F),ke(L)&&L.length!==0?n.updateRevokerInfo(L).then(function(he){return he.forEach(function(fe){var Fe=fe.revokerInfo;le.messageList=le.messageList.map(function(Re){return Re.ID===fe.ID&&Fe&&(Re.revokeReason=Fe.reason||"",Re.revokerInfo={userID:Fe.revoker||Re.revoker,nick:Fe.nick,avatar:Fe.avatar}),Re})}),be(le)}):be(le)}):(this.modifyMessageList(a),Ke(d=this._getMsgListFromMem({conversationID:a,nextReqMessageID:r,count:e})))}},{key:"_isEverCleared",value:function(e){return this._everClearedMap.has(e)}},{key:"_getMsgListFromMem",value:function(e){var n=e.conversationID,a=e.nextReqMessageID,r=(e=e.count,"".concat(this._n,"._getMsgListFromMem")),u=this._msgListHandler.getLocalMsgList(n),d=u.length,_=Lt(n),y=0,M={isCompleted:!1,nextReqMessageID:"",messageList:[]};return a?(y=_?u.findIndex(function(R){return R.ID===a}):u.findIndex(function(R){return R.sequence+""===a}))>e?(M.messageList=u.slice(y-e,y),M.nextReqMessageID=_?u[y-e].ID:u[y-e].sequence+""):(M.messageList=u.slice(0,y),M.isCompleted=!0):e<d?(M.messageList=u.slice(y=d-e,d),M.nextReqMessageID=_?u[y].ID:u[y].sequence+""):(M.messageList=u.slice(0,d),M.isCompleted=!0),e=M.messageList.map(function(R){return R.sequence}),D.l("".concat(r," convID:").concat(n)+" ret.nextReqMessageID:".concat(M.nextReqMessageID," ret.isCompleted:").concat(M.isCompleted," sequenceList:").concat(e)),M}},{key:"getMessageListHopping",value:function(e){var n,a,r=e.conversationID,u=e.sequence,d=e.time,_=e.count;return e=(e=e.direction)===void 0?0:e,(q(_)||15<_)&&(_=15),r.startsWith(A.CONV_C2C)?(n=this.get(6),a=r.replace(A.CONV_C2C,""),n.getRoamingMessagesHopping({peerAccount:a,time:d,count:_,direction:e})):r.startsWith(A.CONV_GROUP)?(n=this.get(7),a=r.replace(A.CONV_GROUP,""),n.getRoamingMessagesHopping({groupID:a,sequence:u,count:_,direction:e})):void 0}},{key:"_computeRemainingCount",value:function(e){var n=e.conversationID,a=e.nextReqMessageID,r=(e=this._msgListHandler.getLocalMsgList(n)).length;return D.l("".concat(this._n,"._computeRemainingCount convID:").concat(n," nextReqMessageID:").concat(a," length:").concat(r)),a?(r=0,Lt(n)?r=e.findIndex(function(u){return u.ID===a}):Bt(n)&&(r=a.indexOf("-")!==-1?e.findIndex(function(u){return u.ID===a}):e.findIndex(function(u){return u.sequence+""===a})),r===-1?0:r):r}},{key:"_needGetHistory",value:function(e){var n=e.conversationID,a=e.remainingCount,r=(e=e.count,this.getLocalConversation(n)),u="";return r&&r.groupProfile&&(u=r.groupProfile.type),!wn(n)&&!Un(u)&&(!!this._isEverCleared(n)||(r=a<=e&&!this._completedMap.has(n),D.l("".concat(this._n,"._needGetHistory convID:").concat(n," ret:").concat(r)),r))}},{key:"_isTopicConv",value:function(e){return bt(e=e.replace(A.CONV_GROUP,""))}},{key:"getHistoryMessages",value:function(e){var n=e.conversationID,a=e.count;if(e=e.nextReqMessageID,n===A.CONV_SYSTEM)return Ke();var r,u,d=15;if(20<a&&(d=20),a=null,Lt(n))return M=0,r="",u=!1,y=this._roamingMsgKeyAndTimeMap.has(n),e&&(u=!0,y?(M=this._roamingMsgKeyAndTimeMap.get(n).lastMessageTime,r=this._roamingMsgKeyAndTimeMap.get(n).messageKey):(_=this._msgListHandler.findMessage(e))&&(M=_.time,D.l("".concat(this._n,".getHistoryMessages convID:").concat(n," isRelayInfoExisted:").concat(y," lastMessageTime:").concat(M)))),(a=this.get(6)).getRoamingMessage({conversationID:n,peerAccount:n.replace(A.CONV_C2C,""),count:d,lastMessageTime:u?M:0,messageKey:u?r:""});if(Bt(n)){if(!(a=this.get(7)))return j({code:X.NO_MODULE});var _=n.replace(A.CONV_GROUP,""),y=null,M=(this._convMap.has(n)&&!bt(_)&&(y=this._convMap.get(n).lastMessage),0);return e?M=Number(e):y&&(M=y.lastSequence),a.getRoamingMessage({conversationID:n,groupID:_,count:d,sequence:M})}return Ke()}},{key:"patchConvLastMessage",value:function(e){var n,a,r=1<arguments.length&&arguments[1]!==void 0&&arguments[1],u=this.getLocalConversation(e);u&&(n=(a=u.lastMessage).messageForShow,a=a.payload,!(Se(n)||Se(a)||r)||(n=this._msgListHandler.getLocalMsgList(e)).length!==0&&(a=n[n.length-1],D.l("".concat(this._n,".patchConvLastMessage bForceUpdate:").concat(r," convID:").concat(e," payload:"),a.payload),u.updateLastMessage(a)))}},{key:"onRoamingMessage",value:function(){var e,n,a=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],r=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],u=3<arguments.length?arguments[3]:void 0,d=(M=1<arguments.length?arguments[1]:void 0).startsWith(A.CONV_C2C)?A.CONV_C2C:A.CONV_GROUP,_=null,y=[],M=[],R=0,L=a.length,F=d===A.CONV_GROUP,x=this.getFileDownloadProxy(),K=this.getDowloadFileAuthKey(),le=ke(u),he=this.get(17).getFileDNList(),fe=function(){F?--R:++R},Fe=function(){return F?L<=R:R<L};for(R=F?a.length-1:0,L=F?0:a.length;Fe();fe())a[R].isPlaceMessage!==1&&((_=new In(a[R])).to=a[R].to,d!==A.CONV_GROUP||q(a[R].topicID)||(_.to=a[R].topicID),_.isSystemMessage=!!a[R].isSystemMessage,_.conversationType=d,e=a[R].event===4?{type:A.MSG_GRP_TIP,content:g(g({},a[R].elements),{},{groupProfile:a[R].groupProfile})}:a[R].elements,F||_.setNickAndAvatar({nick:a[R].nick,avatar:a[R].avatar}),Se(e)?((n=new ce("emptyMessageBody")).setMessage("from:".concat(_.from," to:").concat(_.to," sequence:").concat(_.sequence," event:").concat(a[R].event)),n.setLevel("warning").end()):(_.setElement(e,x,K,he),_.reInitialize(this.getMyUserID()),y.push(_),le&&u.push(_)));return fe=Fe=null,r?(this._msgListHandler.unshift(y,M),y=null,M):(M=null,y)}},{key:"findMessage",value:function(e){return this._msgListHandler.findMessage(e)}},{key:"_isMeInCommunity",value:function(e){var n=!0;return this._isTopicConv(e)&&(e=vn(e.replace(A.CONV_GROUP,"")),this.get(7).hasLocalGroup(e)||(n=!1,D.l("".concat(this._n,"._isMeInCommunity groupID:").concat(e," ret:").concat(n)))),n}},{key:"deleteTopicRoamingInfo",value:function(e){var n=this;Vt({groupID:e})&&this._msgListHandler.getTopicConvIDList(e).forEach(function(a){n.clearMemMsg(a)})}},{key:"deleteGroupRoamingInfo",value:function(e){e="".concat(A.CONV_GROUP).concat(e),0<this._msgListHandler.getLocalMsgList(e).length&&this.clearMemMsg(e)}},{key:"setMessageRead",value:function(e){var n=e.conversationID,a=this.getLocalConversation(n);if(e="".concat(this._n,".setMessageRead"),D.l("".concat(e," convID:").concat(n," unreadCount:").concat(a?a.unreadCount:0)),!a||(a.type!==A.CONV_GROUP&&a.type!==A.CONV_TOPIC||Se(a.groupAtInfoList)||this.deleteGroupAtTips(n),a.unreadCount===0))return Ke();var r=this._msgListHandler.getLocalLastMsg(n),u=a.lastMessage.lastTime,d=(u<(d=this._msgListHandler.getLocalMaxTime(n))&&(D.l("".concat(e," update lastMessageTime from ").concat(u," to ").concat(d)),u=d),this._msgListHandler.getLocalMaxSeq(n)),_=a.lastMessage.lastSequence,y=(_<d&&(D.l("".concat(e," update lastMessageSeq from ").concat(_," to ").concat(d)),_=d),a.type===A.CONV_TOPIC&&q(r)&&(e=this.get(10),r=vn(d=n.replace(A.CONV_GROUP,"")),(e=e.getLocalTopic(r,d))&&(_=e.nextMessageSeq-1)),null);switch(a.type){case A.CONV_C2C:return(y=this.get(6))?y.setMessageRead({conversationID:n,lastMessageTime:u}):j({code:X.NO_MODULE});case A.CONV_GROUP:case A.CONV_TOPIC:return(y=this.get(7))?y.setMessageRead({conversationID:n,lastMessageSeq:_}):j({code:X.NO_MODULE});case A.CONV_SYSTEM:return a.unreadCount=0,this.emitConvUpdate(!0,!1),Ke();default:return Ke()}}},{key:"setAllMessageRead",value:function(){var e=this,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},a="setAllMessageRead",r="".concat(this._n,".").concat(a),u=(n.scope||(n.scope=A.READ_ALL_MSG),D.l("".concat(r," options:"),n),this._createSetAllMessageReadPack(n));if(u.readAllC2CMessage===0&&u.groupMessageReadInfoList.length===0)return Ke();var d=new ce(a);return this.req({P:b.SET_ALL_MSG_READ,data:u}).then(function(_){return _=_.data,_=e._handleAllMsgRead(_),d.setMessage("scope:".concat(n.scope," failureGroups:").concat(JSON.stringify(_))).end(),Ke()}).catch(function(_){return d.setError(_).end(),D.w("".concat(r," failed. error:"),_),j({code:_&&_.code?_.code:X.MSG_UNREAD_ALL_FAIL,message:_&&_.message?_.message:void 0})})}},{key:"setConvCustomData",value:function(e){return this._convGroupHandler.setConvCustomData(e)}},{key:"markConv",value:function(e){return this._convGroupHandler.markConv(e)}},{key:"getConvGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConvGroup",value:function(e){return this._convGroupHandler.createConvGroup(e)}},{key:"deleteConvGroup",value:function(e){return this._convGroupHandler.deleteConvGroup(e)}},{key:"renameConvGroup",value:function(e){return this._convGroupHandler.renameConvGroup(e)}},{key:"addConvsToGroup",value:function(e){return this._convGroupHandler.addConvsToGroup(e)}},{key:"deleteConvsFromGroup",value:function(e){return this._convGroupHandler.deleteConvsFromGroup(e)}},{key:"onConvMarkUpdated",value:function(e){this._convGroupHandler.onConvMarkUpdated(e)}},{key:"onConvGroupCreated",value:function(e){this._convGroupHandler.onConvGroupCreated(e)}},{key:"onConvGroupDeleted",value:function(e){this._convGroupHandler.onConvGroupDeleted(e)}},{key:"onConvGroupNameUpdated",value:function(e){this._convGroupHandler.onConvGroupNameUpdated(e)}},{key:"onConvInGroupUpdated",value:function(e){this._convGroupHandler.onConvInGroupUpdated(e)}},{key:"onConvAddedToOrDeletedFromGroup",value:function(e){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(e)}},{key:"_getConvLastMessageSeq",value:function(e){var n=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastSequence,n&&e<n.sequence?n.sequence:e}},{key:"_getConvLastMessageTime",value:function(e){var n=this._msgListHandler.getLocalLastMsg(e.conversationID);return e=e.lastMessage.lastTime,n&&e<n.time?n.time:e}},{key:"_createSetAllMessageReadPack",value:function(e){var n,a={readAllC2CMessage:0,groupMessageReadInfoList:[]},r=e.scope,u=Ne(this._convMap);try{for(u.s();!(n=u.n()).done;){var d,_=te(n.value,2)[1];if(0<_.unreadCount)if(_.type===A.CONV_C2C&&a.readAllC2CMessage===0){if(r===A.READ_ALL_MSG)a.readAllC2CMessage=1;else if(r===A.READ_ALL_C2C_MSG){a.readAllC2CMessage=1;break}}else _.type!==A.CONV_GROUP||r!==A.READ_ALL_GROUP_MSG&&r!==A.READ_ALL_MSG||(d=this._getConvLastMessageSeq(_),a.groupMessageReadInfoList.push({groupID:_.groupProfile.groupID,messageSequence:d}))}}catch(y){u.e(y)}finally{u.f()}return a}},{key:"onPushedAllMessageRead",value:function(e){this._handleAllMsgRead(e)}},{key:"_handleAllMsgRead",value:function(e){var n=e.groupMessageReadInfoList;return e=e.readAllC2CMessage,n=this._parseGroupReadInfo(n),1<=this._updateAllConvUnreadCount({readAllC2CMessage:e})&&this.emitConvUpdate(!0,!1),n}},{key:"_parseGroupReadInfo",value:function(e){var n=[];if(e&&e.length)for(var a=0,r=e.length;a<r;a++){var u=(y=e[a]).groupID,d=y.sequence,_=y.retCode,y=y.lastMessageSeq;q(_)?this._remoteGroupReadSeqMap.set(u,y):(this._remoteGroupReadSeqMap.set(u,d),_!==0&&n.push("".concat(u,"-").concat(d,"-").concat(_)))}return n}},{key:"_updateAllConvUnreadCount",value:function(e){var n,a=e.readAllC2CMessage,r=0,u=Ne(this._convMap);try{for(u.s();!(n=u.n()).done;){var d,_,y,M,R=te(n.value,2),L=R[0],F=R[1];1<=F.unreadCount&&(a===1&&F.type===A.CONV_C2C?(d=this._getConvLastMessageTime(F),this.updateIsReadAfterReadReport({conversationID:L,lastMessageTime:d})):F.type===A.CONV_GROUP&&(_=L.replace(A.CONV_GROUP,""),this._remoteGroupReadSeqMap.has(_)&&(y=this._remoteGroupReadSeqMap.get(_),M=this._getConvLastMessageSeq(F),this.updateIsReadAfterReadReport({conversationID:L,remoteReadSequence:y}),y<=M&&this._remoteGroupReadSeqMap.delete(_))),this.updateUnreadCount(L,!1)&&(r+=1))}}catch(x){u.e(x)}finally{u.f()}return r}},{key:"isRemoteRead",value:function(e){var n,a=e.conversationID,r=(e=e.sequence,a.replace(A.CONV_GROUP,"")),u=!1;return this._remoteGroupReadSeqMap.has(r)&&(e<=(n=this._remoteGroupReadSeqMap.get(r))&&(u=!0,D.l("".concat(this._n,".isRemoteRead convID:").concat(a," msgSeq:").concat(e," remoteReadSeq:").concat(n))),n+10<=e&&this._remoteGroupReadSeqMap.delete(r)),u}},{key:"updateIsReadAfterReadReport",value:function(e){var n=e.conversationID,a=e.lastMessageSeq,r=e.lastMessageTime,u=this._msgListHandler.getLocalMsgList(n);if(u.length!==0){for(var d,_=u.length-1;0<=_;_--)if(d=u[_],!(r&&d.time>r||a&&d.sequence>a)){if(d.flow==="in"&&d.isRead)break;d.setIsRead(!0)}}}},{key:"updateUnreadCount",value:function(e){var n,a=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],r=!1,u=this.getLocalConversation(e),d=this._msgListHandler.getLocalMsgList(e);if(u)return(n=u.unreadCount)!==(d=d.filter(function(_){return!_.isRead&&!_._onlineOnlyFlag&&!_.isDeleted}).length)&&(u.unreadCount=d,r=!0,D.l("".concat(this._n,".updateUnreadCount from ").concat(n," to ").concat(d,", convID:").concat(e)),a===!0&&this.emitConvUpdate(!0,!1)),r&&u.type===A.CONV_TOPIC&&(n=u.unreadCount,d=this.get(10),a=e.replace(A.CONV_GROUP,""),d.onUnreadCountUpdatedFromConv(a,n)),r}},{key:"clearGroupAtInfoList",value:function(e){var n,a=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],r=this.getLocalConversation(e);r&&0<r.groupAtInfoList.length&&(r.clearGroupAtInfoList(),D.l("".concat(this._n,".clearGroupAtInfoList convID:").concat(e)),r.type===A.CONV_TOPIC&&(r=r.groupAtInfoList,n=this.get(10),e=e.replace(A.CONV_GROUP,""),n.onAtInfoUpdated({topicID:e,groupAtInfoList:r})),a===!0&&this.emitConvUpdate(!0,!1))}},{key:"updateReadReceiptInfo",value:function(e){var n,a,r,u=this,d=(y=e.userID)===void 0?void 0:y,_=(y=e.groupID)===void 0?void 0:y,y=e.readReceiptList,M=(e=e.timestamp)===void 0?0:e;Se(y)||(n=[],q(d)?q(_)||(a="".concat(A.CONV_GROUP).concat(_),y.forEach(function(R){var L=R.tinyID,F=R.clientTime,x=R.random,K=R.readCount;R=R.unreadCount,L="".concat(L,"-").concat(F,"-").concat(x),F=u._msgListHandler.getLocalMsg(a,L)||u._msgListHandler.getHoppingMsg(a,L),x={groupID:_,messageID:L,readCount:0,unreadCount:0},F&&(ft(K)&&(F.readReceiptInfo.readCount=K,x.readCount=K),ft(R)&&(F.readReceiptInfo.unreadCount=R,x.unreadCount=R),n.push(x))})):(r="".concat(A.CONV_C2C).concat(d),y.forEach(function(R){var L=R.tinyID,F=R.clientTime;R=R.random,L="".concat(L,"-").concat(F,"-").concat(R),(F=u._msgListHandler.getLocalMsg(r,L)||u._msgListHandler.getHoppingMsg(r,L))&&!F.readReceiptInfo.isPeerRead&&(F.readReceiptInfo.isPeerRead=!0,F.readReceiptInfo.timestamp=M,n.push({userID:d,messageID:L,isPeerRead:!0,timestamp:M}))})),0<n.length&&this.emitOEvt(me.MESSAGE_READ_RECEIPT_RECEIVED,n))}},{key:"updateIsRead",value:function(e){var n=this.getLocalConversation(e),a=this.getLocalMessageList(e);if(n&&a.length!==0&&!wn(n.type)){for(var r=[],u=0,d=a.length;u<d;u++)a[u].flow!=="in"?a[u].flow!=="out"||a[u].isRead||a[u].setIsRead(!0):r.push(a[u]);var _=0;_=n.type===A.CONV_C2C?(e=r.slice(-n.unreadCount).filter(function(M){return M.isRevoked}).length,r.length-n.unreadCount-e):r.length-n.unreadCount;for(var y=0;y<_&&!r[y].isRead;y++)r[y].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(e){var n=this,a="".concat(this._n,".deleteGroupAtTips");if(D.l("".concat(a)),!(u=this._convMap.get(e)))return Promise.resolve();var r=u.groupAtInfoList;if(r.length===0)return Promise.resolve();var u=void 0,d=(e.startsWith(A.CONV_GROUP)&&(u=e.replace(A.CONV_GROUP,"")),J(r));if((Vt({groupID:u})||bt(u))&&(d=r.filter(function(y){return!y.atTypeArray.includes(A.CONV_AT_ALL)})).length===0)return this.clearGroupAtInfoList(e,!1),Promise.resolve();var _=this.getMyUserID();return this.req({P:b.DEL_GROUP_AT_TIPS,data:{messageListToDelete:d.map(function(y){return{from:y.from,to:_,messageSeq:y.__sequence,messageRandom:y.__random,groupID:q(y.topicID)?y.groupID:y.topicID}})}}).then(function(){return D.l("".concat(a," ok. count:").concat(r.length)),n.clearGroupAtInfoList(e,!1),Promise.resolve()}).catch(function(y){return D.e("".concat(a," failed. error:"),y),j(y)})}},{key:"appendToMessageList",value:function(e){return this._msgListHandler.pushIn(e)}},{key:"setMessageRandom",value:function(e){this._sll.set(e.random)}},{key:"deleteMessageRandom",value:function(e){this._sll.delete(e.random)}},{key:"pushIntoMessageList",value:function(e,n,a){return!(!this._msgListHandler.pushIn(n,a)||this._sll.has(n.random)&&!a||(e.push(n),0))}},{key:"revoke",value:function(e,n,a){return this._msgListHandler.revoke(e,n,a)}},{key:"getPeerReadTime",value:function(e){return this._peerReadTimeMap.get(e)}},{key:"recordPeerReadTime",value:function(e,n){(!this._peerReadTimeMap.has(e)||this._peerReadTimeMap.get(e)<n)&&this._peerReadTimeMap.set(e,n)}},{key:"updateMsgIsPeerReadProp",value:function(e,n){var a;e.startsWith(A.CONV_C2C)&&0<n&&(0<(a=this._msgListHandler.updateMsgIsPeerReadProp(e,n)).length&&this.emitOEvt(me.MESSAGE_READ_BY_PEER,a),this._convMap.has(e)&&(Se(a=this._convMap.get(e).lastMessage)||a.fromAccount===this.getMyUserID()&&a.lastTime<=n&&!a.isPeerRead&&(a.isPeerRead=!0,this.emitConvUpdate(!0,!1))))}},{key:"updateMsgIsModifiedProp",value:function(e){this._msgListHandler.updateMsgIsModifiedProp(e)}},{key:"setCompleted",value:function(e){D.l("".concat(this._n,".setCompleted convID:").concat(e)),this._completedMap.set(e,!0)}},{key:"updateRoamingMsgKeyAndTime",value:function(e,n,a){this._roamingMsgKeyAndTimeMap.set(e,{messageKey:n,lastMessageTime:a})}},{key:"getConvList",value:function(e){var n,a=this,r="".concat(this._n,".").concat("getConvList"),u="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._convMap.size,", options:").concat(JSON.stringify(e));return D.l("".concat(r,". ").concat(u)),this._pagingStatus===ai?((n=new ce("getConvList")).setMessage(u),this.syncConvList().then(function(){return n.end(),be({conversationList:a._getConvList(e),isSyncCompleted:a._isSyncCompleted()})}).catch(function(d){return n.setError(d).end(),D.e("".concat(r," failed. error:"),d),j(d)})):(u=this._getConvList(e),D.l("".concat(r,". returned conversation count:").concat(u.length)),Ke({conversationList:u,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConvList",value:function(e){var n,a,r,u,d,_=this;return q(e)?this.getLocalConvList():ke(e)?e.length===0?[]:this.getLocalConvList().filter(function(y){return e.includes(y.conversationID)}):ye(e)?(n=e.type,a=e.markType,r=e.groupName,u=e.hasUnreadCount,d=e.hasGroupAtInfo,this.getLocalConvList().filter(function(y){return _._filterType(y,n)&&_._filterMarkType(y,a)&&_._filterGroupName(y,r)&&_._filterUnreadCount(y,u)&&_._filterGroupAtInfo(y,d)})):[]}},{key:"_filterType",value:function(e,n){return n!==A.CONV_C2C&&n!==A.CONV_GROUP||e.type===n}},{key:"_filterGroupName",value:function(e,n){return!Ee(n)||(n===""?e.conversationGroupList.length===0:e.conversationGroupList.includes(n))}},{key:"_filterMarkType",value:function(e,n){return!ft(n)||(n===0?e.markList.length===0:e.markList.includes(n))}},{key:"_filterUnreadCount",value:function(e,n){var a=!0;return n===!0?a=1<=e.unreadCount:n===!1&&(a=e.unreadCount===0),a}},{key:"_filterGroupAtInfo",value:function(e,n){var a=!0;return n===!0?a=1<=e.groupAtInfoList.length:n===!1&&(a=e.groupAtInfoList.length===0),a}},{key:"_handleC2CPeerReadTime",value:function(){var e,n=Ne(this._convMap);try{for(n.s();!(e=n.n()).done;){var a=te(e.value,2),r=a[0],u=a[1];u.type===A.CONV_C2C&&this.recordPeerReadTime(r,u.peerReadTime)}}catch(d){n.e(d)}finally{n.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var e=this.get(7);return!e||e.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var e=this.get(7);return e?e.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(e){var n=this.get(7);return!!n&&n.hasLocalGroup(e.replace(A.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(e){var n,a=this,r=!1;if(this._convMap.has(e)?n=this._convMap.get(e):(n=new ua({conversationID:e,type:Lt(e)?A.CONV_C2C:A.CONV_GROUP},this.isIntl(),this.isUsingChatCore()),r=!0),n._isInfoCompleted||n.type===A.CONV_SYSTEM)return Ke({conversation:n});if(Bt(e)){if(!this.get(7))return j({code:X.NO_MODULE});if(!this._hasLocalGroup(e))return Ke({conversation:n})}var u="".concat(this._n,".").concat("getConversationProfile"),d=new ce("getConversationProfile");return D.l("".concat(u,". convID:").concat(e," remark:").concat(n.remark," lastMessage:"),n.lastMessage),this._getUserOrGroupProfile(n).then(function(_){d.setMessage("convID:".concat(e," unreadCount:").concat(_.data.conversation.unreadCount)).end();var y,M=a.get(8);if(M&&n.type===A.CONV_C2C&&(y=e.replace(A.CONV_C2C,""),M.isMyFriend(y)&&(M=M.getFriendRemark(y),n.remark!==M&&(n.remark=M,D.l("".concat(u,". convID:").concat(e," patch remark:").concat(n.remark))))),D.l("".concat(u," ok. isNewConv:").concat(r," convID:").concat(e)),r){if(n.type===A.CONV_C2C)return a._onNewC2CConv([e.replace(A.CONV_C2C,"")]).then(function(){return Ke({conversation:n})});if(n.type===A.CONV_GROUP)return a._onNewGroupConv([e.replace(A.CONV_GROUP,"")]).then(function(){return Ke({conversation:n})})}return _}).catch(function(_){return d.setError(_).setMessage("convID:".concat(e)).end(),D.e("".concat(u," failed. error:"),_),j(_)})}},{key:"_getUserOrGroupProfile",value:function(e){var n=this;return e.type===A.CONV_C2C?this.get(4).getUserProfile({userIDList:[e.toAccount]}).then(function(a){return(a=a.data).length===0?j({code:X.USER_OR_GRP_NOT_FOUND}):(e.userProfile=a[0],e._isInfoCompleted=!0,n._insertConvAfterTopmost(e),Ke({conversation:e}))}):this.get(7).getGroupProfile({groupID:e.toAccount}).then(function(a){return e.groupProfile=a.data.group,e._isInfoCompleted=!0,n._insertConvAfterTopmost(e),Ke({conversation:e})})}},{key:"_insertConvAfterTopmost",value:function(e){var n,a;e instanceof ua&&!this._convMap.has(e.conversationID)&&(a=(n=J(this._convMap)).findIndex(function(r){return r[1].isPinned===!1}),n.splice(a,0,[e.conversationID,e]),this._convMap=new Map(n),this._setStorageConvList(),this.emitConvUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(e){var n=this;e.data.forEach(function(a){var r=a.userID;r===n.getMyUserID()?n._onMyProfileModified({latestNick:a.nick,latestAvatar:a.avatar}):(r=n._convMap.get("".concat(A.CONV_C2C).concat(r)))&&(r.userProfile=a)})}},{key:"_onCloudConfig",value:function(e){this.getCloudConfig("pull_on_invite")==="0"&&(this._bPullOnInvite=!1),D.l("".concat(this._n,"._onCloudConfig bPullOnInvite:").concat(this._bPullOnInvite))}},{key:"disableMsgPullOnInvite",value:function(){this._bPullOnInvite=!1}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===Jn}},{key:"_errorLog",value:function(e,n,a,r){var u=new Error("Params validate failed."),d="".concat(this.getErrMsg("API_REFER")).concat(e);throw D.w("[".concat(e,"] | ").concat(n," | ").concat(this.getErrMsg(a,r),", ").concat(d)),D.e("[".concat(e,"] Invalid ").concat(n,": type check failed for ").concat(n,".")),u}},{key:"_isValidConvID",value:function(e){return Lt(e)||Bt(e)||wn(e)}},{key:"deleteConversation",value:function(e){var n=this,a="deleteConversation";return Ee(e)||It(e)||this._errorLog(a,"options","StringOrObjectRequiredLog"),Ee(e)?(this._isValidConvID(e)||this._errorLog(a,"options","InvalidConversationID",e),D.l("".concat(this._n,".").concat(a," convID:").concat(e)),this.deleteConvList({conversationIDList:[e],flag:1})):(ke(e.conversationIDList)||this._errorLog(a,"conversationIDList","ArrayRequiredLog"),e.conversationIDList.length===0&&this._errorLog(a,"conversationIDList","NonEmptyArrayLog"),e.conversationIDList.forEach(function(r){n._isValidConvID(r)||n._errorLog(a,"conversationIDList","InvalidConversationID",r)}),"clearHistoryMessage"in e&&typeof e.clearHistoryMessage!="boolean"&&this._errorLog(a,"clearHistoryMessage","BooleanRequiredLog"),100<e.conversationIDList.length&&(e.conversationIDList=e.conversationIDList.slice(0,100)),this.deleteConvList(e))}},{key:"deleteConvList",value:function(e){var n=(n=e.conversationIDList)===void 0?[]:n,a=(a=e.clearHistoryMessage)===void 0||a,r=(e=e.flag)===void 0?0:e,u="".concat(this._n,".").concat("deleteConvList"),d=(e="convIDList:".concat(n," clearHistoryMessage:").concat(a),D.l("".concat(u," ").concat(e)),new ce("deleteConvList"));return d.setMessage(e),Promise.all([this.rmLocalOnlyConvList(n),this.rmLocalAndRemoteConvList(n,a)]).then(function(_){return d.end(),(_=[].concat(J(_[0]),J(_[1]))).length===0?j(new xe({code:X.CONV_NOT_FOUND})):(D.l("".concat(u," ok")),Ke(r===1?{conversationID:_[0]}:{conversationIDList:_}))}).catch(function(_){return d.setError(_).end(),D.e("".concat(u," failed. error:"),_),j(_)})}},{key:"rmLocalOnlyConvList",value:function(e){var n=this;return e.filter(function(a){if(!n._convMap.has(a))return!1;var r=n.getLocalConversation(a).type;return r!==A.CONV_GROUP||n._hasLocalGroup(a)?r===A.CONV_SYSTEM&&(n.get(7).deleteGroupSystemNotice({messageList:n._msgListHandler.getLocalMsgList(a)}),n.deleteLocalConv(a),!0):(n.deleteLocalConv(a),!0)})}},{key:"rmLocalAndRemoteConvList",value:function(e,n){var a=this,r={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:n?1:0};return e.forEach(function(u){var d;a._convMap.has(u)&&((d=a.getLocalConversation(u).type)===A.CONV_C2C?r.conversationList.push({toAccount:u.replace(d,""),type:1}):d===A.CONV_GROUP&&a._hasLocalGroup(u)&&r.conversationList.push({toGroupID:u.replace(d,""),type:2}))}),r.conversationList.length===0?[]:this.req({P:b.DEL_CONV,data:r}).then(function(u){var d=[];return 0<u.data.resultList.length&&u.data.resultList.map(function(_){_.code===0&&(_=_.type===1?"".concat(A.CONV_C2C).concat(_.to):"".concat(A.CONV_GROUP).concat(_.groupID),d.push(_))}),a.deleteLocalConvList(d),d})}},{key:"setConvDraft",value:function(e){var n=e.conversationID,a=(e=e.draftText,"".concat(this._n,".").concat("setConvDraft"));return D.l("".concat(a," convID:").concat(n," draftText:").concat(e)),this._convMap.has(n)?((a=this._convMap.get(n)).setDraftText(e),this.emitConvUpdate(),Ke({code:0,conversation:a})):j({code:X.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(e){var n=this,a={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._convMap.has(e))return j({code:X.CONV_NOT_FOUND});var r=this._convMap.get(e).type;if(r===A.CONV_C2C)a.type=1,a.toAccount=e.replace(A.CONV_C2C,"");else{if(r!==A.CONV_GROUP)return r===A.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._msgListHandler.getLocalMsgList(e)}),Ke({conversationID:e})):j({code:X.CONV_UN_RECORDED_TYPE});a.type=2,a.toGroupID=e.replace(A.CONV_GROUP,"")}var u="".concat(this._n,".").concat("clearHistoryMessage"),d=new ce("clearHistoryMessage");return d.setMessage("convID:".concat(e)),D.l("".concat(u,". convID:").concat(e)),this.setMessageRead({conversationID:e}).then(function(){return n.req({P:b.CLEAR_HISTORY_MSG,data:a})}).then(function(){d.end(),D.l("".concat(u," ok")),n.clearMemMsg(e);var _=n.getLocalConversation(e);return _&&(_.updateLastMessage(),n._sortConvListAndEmitEvent()),Ke({conversationID:e})}).catch(function(_){return d.setError(_).end(),D.e("".concat(u," failed. error:"),_),j(_)})}},{key:"pinConversation",value:function(e){var n=this,a=e.conversationID,r=e.isPinned,u=this.getLocalConversation(a);if(u&&u.isPinned===r)return Ke({conversationID:a});if(wn(a))return u&&(u.isPinned=r),this._sortConvListAndEmitEvent(),Ke({conversationID:a});if(e=null,Lt(a)?e={type:1,toAccount:a.replace(A.CONV_C2C,"")}:Bt(a)&&(e={type:2,groupID:a.replace(A.CONV_GROUP,"")}),e===null)return j({code:X.INVALID_CONV_ID});var d="".concat(this._n,".").concat("pinConversation"),_="convID:".concat(a," isPinned:").concat(r),y=new ce("pinConversation");return y.setMessage(_),D.l("".concat(d,". ").concat(_)),this.req({P:b.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:r===!0?1:2,itemList:[e]}}).then(function(){return y.end(),D.l("".concat(d," ok")),u?u.isPinned!==r&&(u.isPinned=r):n._convMap.set(a,new ua({conversationID:a,type:Lt(a)?A.CONV_C2C:A.CONV_GROUP,isPinned:r},n.isIntl(),n.isUsingChatCore())),n._sortConvListAndEmitEvent(),be({conversationID:a})}).catch(function(M){return y.setError(M).end(),D.e("".concat(d," failed. error:"),M),j(M)})}},{key:"setMessageRemindType",value:function(e){return this._msgRemindHandler.set(e)}},{key:"patchMsgRemindType",value:function(e){var n=e.ID,a=e.isC2CConversation,r=e.messageRemindType,u=!1;return(a=this.getLocalConversation("".concat(a?A.CONV_C2C:A.CONV_GROUP).concat(n)))&&a.messageRemindType!==r&&(a.messageRemindType=r,u=!0),D.l("".concat(this._n,".patchMsgRemindType options:"),e,"ret:".concat(u)),u}},{key:"onC2CMsgRemindTypeFetched",value:function(e){var n,a=this;ke(e)&&0<e.length&&(n=0,e.forEach(function(r){var u=r.userID;r=r.muteFlag,r=a._transMsgRemindType(r),a.patchMsgRemindType({ID:u,isC2CConversation:!0,messageRemindType:r})===!0&&(n+=1)}),D.l("".concat(this._n,".onC2CMsgRemindTypeFetched updateCount:").concat(n)),1<=n&&this.emitConvUpdate(!0,!1))}},{key:"onC2CMsgRemindTypeSynced",value:function(e){var n=this,a="".concat(this._n,".onC2CMsgRemindTypeSynced");e.dataList.forEach(function(r){var u;Se(r.muteNotificationsSync)||(u=(r=r.muteNotificationsSync).to,r=r.muteFlag,r=n._transMsgRemindType(r),n.patchMsgRemindType({ID:u,isC2CConversation:!(u=0),messageRemindType:r})&&(u+=1),D.l("".concat(a," updateCount:").concat(u)),1<=u&&n.emitConvUpdate(!0,!1))})}},{key:"onGroupMsgRemindTypeUpdated",value:function(e){this._msgRemindHandler.onGroupMsgRemindTypeUpdated(e)}},{key:"deleteLocalConv",value:function(e){var n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],a=this._convMap.has(e);D.l("".concat(this._n,".deleteLocalConv convID:").concat(e," has:").concat(a)),a&&(this._convMap.delete(e),this._convMapForDiff.delete(e),this.clearMemMsg(e),this._setStorageConvList(!0),n)&&(a=!this._isTopicConv(e),this.emitConvUpdate(a,!1))}},{key:"pullMsgOnInvite",value:function(e){var n,a,r,u,d,_=this.get(7);_&&(n="".concat(this._n,".pullMsgOnInvite"),D.l("".concat(n," flag:").concat(this._bPullOnInvite)),this._bPullOnInvite&&(d=this.getLocalLastMessage(e),a=this.getLocalSecondLastMessage(e),u=r=1,d&&(r=d.sequence),a&&(u=a.sequence),d=_.getGroupRemoteLastSeq(e.replace(A.CONV_GROUP,"")),D.l("".concat(n," convID:").concat(e," localLastSeq:").concat(r," localSecondLastSeq:").concat(u," remoteLastSeq:").concat(d)),this.clearMemMsg(e),1<r-u?this._recursiveGetMsgList([],e,!1,r,u):1<d-r&&this._recursiveGetMsgList([],e,!0,d,r)))}},{key:"_recursiveGetMsgList",value:function(e,n,a,r,u,d){var _=this;this.getMessageList({conversationID:n,nextReqMessageID:d}).then(function(y){var M=(y=y.data).messageList,R=y.isCompleted,L=(y=y.nextReqMessageID,M.filter(function(F){return a?F.sequence>u&&F.sequence<=r:F.sequence>u&&F.sequence<r}));e.unshift.apply(e,J(L)),!R&&0<M.length&&M[0].sequence>u&&e.length<60?_._recursiveGetMsgList(e,n,a,r,u,y):_._emitMsgReceived(n,e)})}},{key:"_emitMsgReceived",value:function(e,n){var a,r,u=this;0<n.length&&(n=n.filter(function(d,_,y){return _===y.findIndex(function(M){return M.sequence===d.sequence})}),a=this.hasLocalConversation(e),r=n.map(function(d){return d.sequence}),D.l("".concat(this._n,"._emitMsgReceived convID:").concat(e," has:").concat(a," count:").concat(r.length," sequenceList:"),r),this.emitOEvt(me.MESSAGE_RECEIVED,n),a?this.patchConvLastMessage(e,!0):this.getConversationProfile(e).then(function(){u.patchConvLastMessage(e,!0)}))}},{key:"deleteLocalConvList",value:function(e){var n=this,a=!1;e.forEach(function(r){n._convMap.has(r)&&(n.deleteLocalConv(r,!1),a=!0)}),D.l("".concat(this._n,".deleteLocalConvList convID:").concat(e," isConvIDExisted:").concat(a)),a&&this.emitConvUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(e){return!(!this._msgListHandler.hasLocalMsg(e.conversationID,e.ID)&&!this._sll.has(e.random))}},{key:"modifyMessageList",value:function(e){var n,a;e.startsWith(A.CONV_C2C)&&this._convMap.has(e)&&(a=this._convMap.get(e),n=Date.now(),this._msgListHandler.modifyMsgSentByPeer({conversationID:e,latestNick:a.userProfile.nick,latestAvatar:a.userProfile.avatar}),a=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._msgListHandler.modifyMsgSentByMe({conversationID:e,latestNick:a.nick,latestAvatar:a.avatar}),D.l("".concat(this._n,".modifyMessageList convID:").concat(e," cost:").concat(kn(n))))}},{key:"updateUserProfileSpecifiedKey",value:function(e){D.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),e);var n=e.conversationID,a=e.nick;e=e.avatar,this._convMap.has(n)&&(n=this._convMap.get(n).userProfile,Ee(a)&&n.nick!==a&&(n.nick=a),Ee(e)&&n.avatar!==e&&(n.avatar=e),this.emitConvUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(e){var n=this,a=this.getLocalConvList(),r=Date.now();a.forEach(function(u){n.modifyMessageSentByMe(g({conversationID:u.conversationID},e))}),D.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(kn(r)))}},{key:"modifyMessageSentByMe",value:function(e){this._msgListHandler.modifyMsgSentByMe(e)}},{key:"getLatestMessageSentByMe",value:function(e){return this._msgListHandler.getLatestMsgSentByMe(e)}},{key:"modifyMessageSentByPeer",value:function(e){this._msgListHandler.modifyMsgSentByPeer(e)}},{key:"getLatestMessageSentByPeer",value:function(e){return this._msgListHandler.getLatestMsgSentByPeer(e)}},{key:"pushIntoNoticeResult",value:function(e,n){return!(!this._msgListHandler.pushIn(n)||this._sll.has(n.random)||(e.push(n),0))}},{key:"getLocalLastMessage",value:function(e){return this._msgListHandler.getLocalLastMsg(e)}},{key:"getLocalSecondLastMessage",value:function(e){return this._msgListHandler.getLocalSecondLastMsg(e)}},{key:"checkAndPatchRemark",value:function(){var e,n,a=this.get(8);this._convMap.size===0||!a||(e=J(this._convMap.values()).filter(function(r){return r.type===A.CONV_C2C})).length!==0&&(n=0,e.forEach(function(r){var u=r.conversationID.replace(A.CONV_C2C,"");a.isMyFriend(u)&&(u=a.getFriendRemark(u),r.remark!==u&&(r.remark=u,n+=1))}),D.l("".concat(this._n,".checkAndPatchRemark. c2cConvCount:").concat(e.length," patchedCount:").concat(n)),0<n&&this.emitConvUpdate(!0,!1))}},{key:"updateTopicConversation",value:function(e){this._updateLocalConvList({conversationOptionsList:e,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(e){var n=e[0],a=null;return n.conversationType===A.CONV_C2C?a=this._m.get(6):n.conversationType===A.CONV_GROUP&&(a=this._m.get(7)),a?a.sendReadReceipt(e):j({code:X.NO_MODULE})}},{key:"getReadReceiptList",value:function(e){var n=e[0],a=null;return n.conversationType===A.CONV_C2C?a=this._m.get(6):n.conversationType===A.CONV_GROUP&&(a=this._m.get(7)),a?a.getReadReceiptList(e):j({code:X.NO_MODULE})}},{key:"getLastMessageTime",value:function(e){return(e=this.getLocalConversation(e))?e.lastMessage.lastTime:0}},{key:"getTotalUnreadCount",value:function(){var e=this.getLocalConvList(),n=0;return e.forEach(function(a){a.type!==A.CONV_SYSTEM&&(a.messageRemindType!==""&&a.messageRemindType!==A.MSG_REMIND_ACPT_AND_NOTE||(n+=a.unreadCount))}),n}},{key:"onTotalUnreadCountUpdate",value:function(){var e=this.getTotalUnreadCount();this._convTotalUnreadCount!==e&&(D.l("".concat(this._n,".onTotalUnreadCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(e)),this._convTotalUnreadCount=e,this.emitOEvt(me.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(e){if(e=this.getLocalConversation(e),q(e))return!0;var n=e.type===A.CONV_TOPIC,a=e.type===A.CONV_GROUP&&e.groupProfile.type===A.GRP_ROOM;return e=e.type===A.CONV_GROUP&&e.groupProfile.type===A.GRP_LIVE,!(n||a||e)}},{key:"setAllRcvMsgOpt",value:function(e){return this._msgRemindHandler.setAllRcvMsgOpt(e)}},{key:"getAllRcvMsgOpt",value:function(){return this._msgRemindHandler.getAllRcvMsgOpt()}},{key:"onAllRcvMsgOptNotify",value:function(e){this._msgRemindHandler.onAllRcvMsgOptNotify(e)}},{key:"clearUnreadCount",value:function(e){(e=this.getLocalConversation(e))&&0<e.unreadCount&&(e.unreadCount=0,this.emitConvUpdate(!0,!1))}},{key:"storeHoppingMessageList",value:function(e){this._msgListHandler.storeHoppingMsgList(e)}},{key:"clearMemMsg",value:function(e){var n=1<arguments.length&&arguments[1]!==void 0&&arguments[1];D.l("".concat(this._n,".clearMemMsg convID:").concat(e," isOverLimit:").concat(n)),this._msgListHandler.removeByConvID(e),this._completedMap.delete(e),this._roamingMsgKeyAndTimeMap.delete(e),this._everClearedMap.set(e,1)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._setStorageConvList(!0),this._pagingStatus=No,this._msgListHandler.reset(),this._msgRemindHandler.reset(),this._roamingMsgKeyAndTimeMap.clear(),this._sll.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._convMap.clear(),this._pagingTs=0,this._pagingStartIdx=0,this._pagingPinnedTs=0,this._pagingPinnedStartIdx=0,this._remoteGroupReadSeqMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this._convMapForDiff.clear(),this._partialUpdatedConvMap.clear(),this._everClearedMap.clear(),this._bPullOnInvite=!0,this._convGroupHandler.reset(),this.resetReady()}}]),Li),bc=(N(ys,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupTipsMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupTipsMap.forEach(function(n,a){var r=e._checkCountMap.get(a),u=e._grpM.hasLocalGroup(a);D.l("".concat(e._n,"._check groupID:").concat(a," hasLocalGroup:").concat(u," checkCount:").concat(r)),u?(e._notifyCachedGroupTips(a),e._checkCountMap.delete(a),e._grpM.deleteUnjoinedAVChatRoom(a)):r>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupTips(a),e._checkCountMap.delete(a)):e._checkCountMap.set(a,++r)})}},{key:"onNewGroupTips",value:function(e){D.l("".concat(this._n,".onNewGroupTips options:").concat(JSON.stringify(e.dataList)));var n=(e=this._assembly(e)).eventDataList,a=e.result;0<(e=e.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(e),0<a.length&&(this._grpM.emitOEvt(me.MESSAGE_RECEIVED,a),this._handleTips(a)),0<n.length&&(this._grpM.updateNextMessageSeq(n),this._grpM.get(11).onNewMessage({conversationOptionsList:n,isInstantMessage:!0}))}},{key:"_assembly",value:function(e){for(var n=e.event,a=e.dataList,r=null,u=[],d=[],_={},y=[],M=0,R=a.length;M<R;M++){var L=Ua(a[M]);if(!(n===6&&(this._grpM.isGroupAttributesUpdatedNotice(L)||this._grpM.isGroupCountersNotice(L)))){var F=(he=L.groupProfile).groupID,x=(x=he.communityType)===void 0?0:x,K=(K=he.topicID)===void 0?void 0:K,le=he.invisible,he=(he=he.groupType)===void 0?void 0:he,fe=void 0;if((Re=this._grpM.isMessageFromTopic(x,K))&&(fe=A.CONV_TOPIC,L.to=K),(Fe=this._grpM.hasLocalGroup(F))||!this._grpM.isUnjoinedAVChatRoom(F))if(Fe||Re)if(this._grpM.isMessageFromOrToAVChatroom(F))L.event=n,y.push(L);else if(L.currentUser=this._grpM.getMyUserID(),L.conversationType=A.CONV_GROUP,(r=new In(L)).setElement({type:A.MSG_GRP_TIP,content:g(g({},L.elements),{},{groupProfile:L.groupProfile})}),r.isSystemMessage=!1,le!==1){var Fe=this._grpM.get(11),Re=(le=(Re=r).conversationID,Re.sequence);if(n===6)r._onlineOnlyFlag=!0,d.push(r);else if(!Fe.pushIntoNoticeResult(d,r))continue;this._grpM.isMessageFromCommunityOfTopic(x,K)||n===6&&Fe.getLocalConversation(le)||(n!==6&&this._qualityStat(r),x=Fe.isRemoteRead({conversationID:le,sequence:Re}),q(_[le])?(K=0,r.flow==="in"&&(r._isExcludedFromUnreadCount||r._onlineOnlyFlag||x||(K=1)),_[le]=u.push({conversationID:le,unreadCount:K,type:q(fe)?r.conversationType:fe,subType:r.conversationSubType,lastMessage:r._isExcludedFromLastMessage?"":r})-1):(u[Fe=_[le]].type=r.conversationType,u[Fe].subType=r.conversationSubType,u[Fe].lastMessage=r._isExcludedFromLastMessage?"":r,r.flow==="in"&&(r._isExcludedFromUnreadCount||r._onlineOnlyFlag||x||u[Fe].unreadCount++)))}else this._qualityStat(r);else this._cacheAndCompare({groupID:F,event:n,item:L,groupType:he})}}return{eventDataList:u,result:d,AVChatRoomMessageList:y}}},{key:"_qualityStat",value:function(e){this._grpM.get(26).addMessageSequence({key:si,message:e})}},{key:"_handleTips",value:function(e){var n=this;e.forEach(function(a){switch(a.payload.operationType){case 1:n._onNewMemberComeIn(a);break;case 2:n._onMemberQuit(a);break;case 3:n._onMemberKickedOut(a);break;case 4:n._onMemberSetAdmin(a);break;case 5:n._onMemberCancelledAdmin(a);break;case 6:n._onGroupProfileModified(a);break;case 7:n._onMemberInfoModified(a);break;case 8:n._onTopicProfileUpdated(a);break;default:D.w("".concat(n._n,"._handleTips unknown operationType:").concat(a.payload.operationType))}})}},{key:"_onNewMemberComeIn",value:function(e){var n=(e=e.payload).memberNum;e=e.groupProfile.groupID,(e=this._grpM.getLocalGroupProfile(e))&&ft(n)&&e.memberCount!==n&&(e.memberCount=n,this._updateConvGroupProfile(e))}},{key:"_onMemberQuit",value:function(e){var n=(a=e.payload).memberNum,a=a.groupProfile.groupID,r=this._grpM.getLocalGroupProfile(a);r&&ft(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConvGroupProfile(r)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(a,e.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(e){var n=(a=e.payload).memberNum,a=a.groupProfile.groupID,r=this._grpM.getLocalGroupProfile(a);r&&ft(n)&&r.memberCount!==n&&(r.memberCount=n,this._updateConvGroupProfile(r)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(a,e.payload.userIDList)}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_onMemberSetAdmin",value:function(e){var n=e.payload.groupProfile.groupID,a=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach(function(r){(r=a.getLocalGroupMemberInfo(n,r))&&r.updateRole(A.GRP_MBR_ROLE_ADMIN)})}},{key:"_onMemberCancelledAdmin",value:function(e){var n=e.payload.groupProfile.groupID,a=(e=e.payload.userIDList,this._grpM.getGroupMemberHandler());e.forEach(function(r){(r=a.getLocalGroupMemberInfo(n,r))&&r.updateRole(A.GRP_MBR_ROLE_MEMBER)})}},{key:"_onGroupProfileModified",value:function(e){var n=this,a=(e=e.payload).newGroupProfile,r=e.groupProfile,u=e.operatorInfo,d=(e=r.groupID,this._grpM.getLocalGroupProfile(e));Object.keys(a).forEach(function(_){switch(_){case"ownerID":n._ownerChanged(d,a);break;case"groupName":d.name=a[_];break;default:d[_]=a[_]}}),q(u)||Object.keys(u).forEach(function(_){var y;_==="nameCard"?d.updateSelfInfo({nameCard:u[_]}):_==="role"&&(y="",u[_]===400?y=A.GRP_MBR_ROLE_OWNER:u[_]===300?y=A.GRP_MBR_ROLE_ADMIN:u[_]===200&&(y=A.GRP_MBR_ROLE_MEMBER),d.updateSelfInfo({role:y}))}),r=!d.isSupportTopic,this._grpM.emitGroupListUpdate(!0,r)}},{key:"_ownerChanged",value:function(e,n){e=e.groupID;var a=this._grpM.getLocalGroupProfile(e),r=this._grpM.getMyUserID();r===n.ownerID&&(a.updateGroup({selfInfo:{role:A.GRP_MBR_ROLE_OWNER}}),a=(n=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(e,r),r=this._grpM.getLocalGroupProfile(e).ownerID,n=n.getLocalGroupMemberInfo(e,r),a&&a.updateRole(A.GRP_MBR_ROLE_OWNER),n&&n.updateRole(A.GRP_MBR_ROLE_MEMBER))}},{key:"_onMemberInfoModified",value:function(e){var n=e.to,a=(r=e.payload).groupProfile,r=r.memberList,u=a.groupID,d=(bt(n)&&this._updateTopicMuteTime(e),this._grpM.getGroupMemberHandler());r.forEach(function(_){var y=d.getLocalGroupMemberInfo(u,_.userID);y&&ft(_.muteTime)&&y.updateMuteUntil(_.muteTime)})}},{key:"_updateTopicMuteTime",value:function(e){var n=e.to,a=(e=e.payload).groupProfile,r=(e=e.memberList)===void 0?[]:e,u=(e=this._grpM.get(10),a=a.groupID,e.getLocalTopic(a,n));if(u){for(var d=!1,_=0;_<r.length;_++){var y=r[_];if(y.userID===this._grpM.getMyUserID()&&0<=y.muteTime){u.updateSelfInfo({muteTime:y.muteTime}),d=!0;break}}d&&this._grpM.emitOEvt(me.TOPIC_UPDATED,{groupID:a,topic:u})}}},{key:"_onTopicProfileUpdated",value:function(e){var n=(a=e.payload).groupProfile.groupID,a=a.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(g({groupID:n,topicID:e.to},a))}},{key:"_cacheGroupTips",value:function(e,n){this._cachedGroupTipsMap.has(e)||this._cachedGroupTipsMap.set(e,[]),this._cachedGroupTipsMap.get(e).push(n)}},{key:"_deleteCachedGroupTips",value:function(e){this._cachedGroupTipsMap.has(e)&&this._cachedGroupTipsMap.delete(e)}},{key:"_notifyCachedGroupTips",value:function(e,n){var a=this,r=this._cachedGroupTipsMap.get(e)||[];D.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(e," groupType:").concat(n," count:").concat(r.length)),r.forEach(function(u){a.onNewGroupTips(u)}),this._deleteCachedGroupTips(e)}},{key:"_cacheAndCompare",value:function(e){var n=e.groupID,a=e.event,r=e.item;e=e.groupType,D.l("".concat(this._n,"._cacheAndCompare groupID:").concat(n," groupType:").concat(e)),this._cacheGroupTips(n,{event:a,dataList:[r]}),a={groupID:n,type:e},e===A.GRP_AVCHATROOM?this._grpM.hasLocalGroup(n)?this._notifyCachedGroupTips(n,e):this._grpM.setUnjoinedAVChatRoom(n):(this._grpM.updateGroupMap([a]),this._notifyCachedGroupTips(n,e)),this._checkCountMap.has(n)||this._checkCountMap.set(n,0)}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),ys),Zl=(N(Ri,[{key:"onCheckTimer",value:function(e){e%1==0&&0<this._cachedGroupMessageMap.size&&this._check()}},{key:"_check",value:function(){var e=this;this._cachedGroupMessageMap.forEach(function(n,a){var r=e._checkCountMap.get(a),u=e._grpM.hasLocalGroup(a);D.l("".concat(e._n,"._check groupID:").concat(a," hasLocalGroup:").concat(u," checkCount:").concat(r)),u?(e._notifyCachedGroupMessage(a),e._checkCountMap.delete(a),e._grpM.deleteUnjoinedAVChatRoom(a)):r>=e.MAX_CHECK_COUNT?(e._deleteCachedGroupMessage(a),e._checkCountMap.delete(a)):e._checkCountMap.set(a,++r)})}},{key:"updateLastMsg",value:function(e){var n="".concat(this._n,".updateLastMsg");if(this._grpM.getGroupMap().size!==0){for(var a,r,u,d,_=!1,y=e.length,M=0;M<y;M++)(a=e[M]).type===A.CONV_GROUP&&a.lastMessage.lastSequence!==0&&a.lastMessage.payload!==null&&(r=a.conversationID.split(/^GROUP/)[1],(r=this._grpM.getLocalGroupProfile(r))&&(u=r.lastMessage,d=a.lastMessage,JSON.stringify(u)!==JSON.stringify(d)&&(r.lastMessage=g({},a.lastMessage),_=!0)));D.l("".concat(n," convCount:").concat(y," groupCount:").concat(this._grpM.getLocalGroupList().length," isUpdated:").concat(_)),_&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=e}},{key:"onNewMessage",value:function(e){var n,a=(n=this._assembly(e)).conversationOptionsList,r=n.messageList;0<(0<(0<(n=n.AVChatRoomMessageList).length&&this._grpM.onAVChatRoomMessage(n),n=wa(r)).length&&this._grpM.emitOEvt(me.MESSAGE_MODIFIED,n),0<a.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:a,isInstantMessage:e.isInstantMessage!==!1,updateUnreadCount:e.updateUnreadCount!==!1}),this._grpM.updateNextMessageSeq(a)),n=lr(r)).length&&this._grpM.emitOEvt(me.MESSAGE_RECEIVED,n),r.length=0}},{key:"_assembly",value:function(e){var n=e.dataList,a=e.event,r=e.isInstantMessage,u=null,d=[],_=[],y=[],M={},R=this._grpM.getFileDownloadProxy(),L=this._grpM.getDowloadFileAuthKey(),F=this._grpM.get(17).getFileDNList(),x=n.length;1<x&&n.sort(function(p,m){return p.sequence-m.sequence});for(var K=this._grpM.get(11),le=this._grpM.get(4),he=0;he<x;he++){var fe,Fe=Ua(n[he]),Re=(i=Fe.groupProfile).groupID,ie=(ie=i.communityType)===void 0?0:ie,t=(t=i.topicID)===void 0?void 0:t,o=i.invisible,i=(i=i.groupType)===void 0?void 0:i,s=void 0,c=this._grpM.isMessageFromTopic(ie,t),l=(c&&(s=A.CONV_TOPIC,Fe.to=t),this._grpM.hasLocalGroup(Re));!l&&this._grpM.isUnjoinedAVChatRoom(Re)||(l||c?this._grpM.isMessageFromOrToAVChatroom(Re)?(Fe.event=a,y.push(Fe)):(Fe.currentUser=this._grpM.getMyUserID(),Fe.conversationType=A.CONV_GROUP,Fe.isSystemMessage=!!Fe.isSystemMessage,(u=new In(Fe)).setElement(Fe.elements,R,L,F),o!==1?(l=n[he].isModified===1,K.isMessageSentByCurrentInstance(u)?u.isModified=l:l=!1,Fe.onlineOnlyFlag===1?(u._onlineOnlyFlag=!0,K.isMessageSentByCurrentInstance(u)||_.push(u)):this._grpM.isMessageFromCommunityOfTopic(ie,t)?_.push(u):(u.from!==this._grpM.getMyUserID()||(c=K.getLatestMessageSentByMe(u.conversationID))&&(o=c.nick,ie=c.avatar,o===u.nick&&ie===u.avatar||(K.modifyMessageSentByMe({conversationID:fe,latestNick:u.nick,latestAvatar:u.avatar}),le.mockOnNickAvatarModified(u.nick,u.avatar))),K.pushIntoMessageList(_,u,l)&&(this._qualityStat(r,u),fe=(t=u).conversationID,c=t.sequence,o=K.isRemoteRead({conversationID:fe,sequence:c}),q(M[fe])?(ie=0,u.flow==="in"&&(u._isExcludedFromUnreadCount||o||(ie=1)),M[fe]=d.push({conversationID:fe,unreadCount:ie,type:q(s)?u.conversationType:s,subType:u.conversationSubType,lastMessage:u._isExcludedFromLastMessage?"":u})-1):(d[l=M[fe]].type=q(s)?u.conversationType:s,d[l].subType=u.conversationSubType,d[l].lastMessage=u._isExcludedFromLastMessage?"":u,u.flow==="in"&&(u._isExcludedFromUnreadCount||o||d[l].unreadCount++))))):this._qualityStat(r,u)):this._cacheAndCompare({groupID:Re,event:a,item:Fe,groupType:i}))}return{conversationOptionsList:d,messageList:_,AVChatRoomMessageList:y}}},{key:"_qualityStat",value:function(e,n){var a=this._grpM.get(26);a.addMessageSequence({key:si,message:n}),e&&0<n.clientTime&&a.addMessageDelay(n.clientTime)}},{key:"onMsgRevoked",value:function(e,n){var a=this,r=this._grpM.get(11),u=[],d=[];e.dataList.forEach(function(_){var y=_.elements.revokedInfos,M=_.revokerInfo,R=_.groupProfile,L=!1;R&&(L=Vt({groupID:R.groupID})||!Se(R.topicID)),q(y)||y.forEach(function(F){var x,K=Se(F.topicID)?"GROUP".concat(F.groupID):"GROUP".concat(F.topicID),le=r.getLocalConversation(K),he=F.revokerInfo&&F.revokerInfo.revoker||M&&M.revoker,fe=M&&M.reason||"";le&&Un(le.type)?x={conversationID:K,sequence:F.sequence,ID:"".concat(F.tinyID,"-").concat(F.clientTime,"-").concat(F.random)}:(le=r.revoke(K,F.sequence,F.random))?x=le:(x={conversationID:K,sequence:F.sequence},F.tinyID&&F.clientTime&&F.random&&(x.ID="".concat(F.tinyID,"-").concat(F.clientTime,"-").concat(F.random)),F.time&&(x.time=F.time)),x&&(x.revoker=he,x.revokeReason=fe,x.revokerInfo={userID:he,nick:"",avatar:""},L?(x.revokerInfo.nick=R.nick,x.revokerInfo.avatar=R.avatar,u.push(x)):d.push(x))})}),d.length===0&&u.length===0||(r.onMessageRevoked([].concat(u,d),n),0<u.length&&this._grpM.emitOEvt(me.MESSAGE_REVOKED,u),0<d.length&&r.updateRevokerInfo(d).then(function(_){a._grpM.emitOEvt(me.MESSAGE_REVOKED,_)}))}},{key:"_groupListTreeShaking",value:function(e){for(var n=new Map(J(this._grpM.getGroupMap())),a=0,r=e.length;a<r;a++)n.delete(e[a].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach(function(y){n.delete(y)}),this._grpM.getGroupMap().forEach(function(y,M){y.isSupportTopic&&n.delete(M)});for(var u=J(n.keys()),d=0,_=u.length;d<_;d++)this._grpM.deleteGroup(u[d])}},{key:"syncGroupList",value:function(){var e=this,n=0<arguments.length&&arguments[0]!==void 0&&arguments[0],a=(this._pagingStatus===No&&this._grpM.clearGroupMap(),J(Ue)),r=this.PAGING_GRP_COUNT_LIMIT,u=[];if(n===!0)return this._pagingGetGroupListWithTopic({limit:r,offset:0,groupBaseInfoFilter:a,groupList:u});n="syncGroupList";var d="".concat(this._n,".").concat(n),_=new ce(n);return this._pagingGetGroupList({limit:r,offset:0,groupBaseInfoFilter:a,groupList:u}).then(function(){var y=Cc(e._pagingGetCostList),M=ni(e._pagingGetCostList),R=(e._pagingGetCostList.length=0,e._pagingStatus=Jn,e._groupListTreeShaking(u),e._grpM.updateGroupMap(u),e._grpM.getLocalGroupList().length);return R="count:".concat(R," sum:").concat(M," avg:").concat(y),D.l("".concat(d," ok. ").concat(R)),_.setMessage(R).end(),e.tempConversationList&&(e.updateLastMsg(e.tempConversationList),e.tempConversationList=null),e._grpM.emitGroupListUpdate(!0,!0),be({groupList:e._grpM.getLocalGroupList()})}).catch(function(y){return e._pagingStatus=ai,_.setError(y).end(),D.e("".concat(d," failed. error:"),y),j(y)})}},{key:"getGroupList",value:function(){var e=this,n="".concat(this._n,".").concat("getGroupList");if(D.l("".concat(n," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===ai||this._pagingStatus===No)return this.syncGroupList().then(function(){return be({groupList:e._grpM.getLocalGroupList(),isSyncCompleted:e.isPagingGetCompleted()})}).catch(function(r){return D.e("".concat(n," failed. error:"),r),j(r)});var a=this._grpM.getLocalGroupList();return D.l("".concat(n,". returned group count:").concat(a.length)),Ke({groupList:a,isSyncCompleted:this.isPagingGetCompleted()})}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===Jn}},{key:"_pagingGetGroupList",value:function(e){var n=this,a="".concat(this._n,".").concat("_pagingGetGroupList"),r=e.isCommunityRelay,u=r!==void 0&&r,d=e.limit,_=e.offset,y=e.groupBaseInfoFilter,M=e.groupList,R=Date.now();return this._grpM.req({P:b.GET_GRP_LIST,data:{type:u?A.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:d,offset:_,responseFilter:{groupBaseInfoFilter:y,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then(function(L){var F=(F=(L=L.data).groups)===void 0?[]:F,x=(L=L.totalCount,M.push.apply(M,J(F)),n._handleGroupAtInfoWithoutTopic(u,F),!((F=_+d)<L));return L="offset:".concat(_," limit:").concat(d," total:").concat(L," isCompleted:").concat(x," ")+"current:".concat(M.length," isCommunityRelay:").concat(u),n._pagingGetCostList.push(kn(R,!1)),D.l("".concat(a," ok. ").concat(L," cost:").concat(kn(R))),u||x?!u&&x?(D.l("".concat(a," start to get community list")),_=0,n._pagingGetGroupList({limit:d,offset:_,groupBaseInfoFilter:y,groupList:M,isCommunityRelay:!0})):u&&!x?(_=F,n._pagingGetGroupList({limit:d,offset:_,groupBaseInfoFilter:y,groupList:M,isCommunityRelay:!0})):be({groupList:M}):(_=F,n._pagingGetGroupList({limit:d,offset:_,groupBaseInfoFilter:y,groupList:M}))}).catch(function(L){return L.code===10018?(D.w("".concat(n.logPrefix," response size exceeds the limit, request count:").concat(d)),d=50,n._pagingGetGroupList({limit:d,offset:_,groupBaseInfoFilter:y,groupList:M,isCommunityRelay:u})):u?(L.code===11e3&&D.l("".concat(a," ok. community unavailable")),Ke({groupList:M})):j(L)})}},{key:"_pagingGetGroupListWithTopic",value:function(e){var n=this,a="".concat(this._n,"._pagingGetGroupListWithTopic"),r=e.limit,u=e.offset,d=e.groupBaseInfoFilter,_=e.groupList,y=Date.now();return this._grpM.req({P:b.GET_GRP_LIST,data:{type:A.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:r,offset:u,responseFilter:{groupBaseInfoFilter:d,selfInfoFilter:J(At)},isSupportTopic:1,needAppDefineData:1}}).then(function(M){var R=(M=M.data).groups,L=(M=M.totalCount,_.push.apply(_,J(R===void 0?[]:R)),!((R=u+r)<M));return D.l("".concat(a," ok. offset:").concat(u," limit:").concat(r," totalCount:").concat(M," isCompleted:").concat(L," currentCount:").concat(_.length," cost:").concat(kn(y))),L?(n._grpM.updateGroupMap(_),n._grpM.emitGroupListUpdate(!0,!1),be({groupList:M=n._grpM.getLocalGroupList().filter(function(F){return F.isSupportTopic===!0})})):(u=R,n._pagingGetGroupListWithTopic({limit:r,offset:u,groupBaseInfoFilter:d,groupList:_}))}).catch(function(M){return M.code===10018?(D.w("".concat(n.logPrefix," response size exceeds the limit, request count:").concat(r)),r=50,n._pagingGetGroupListWithTopic({limit:r,offset:u,groupBaseInfoFilter:d,groupList:_})):j(M)})}},{key:"_cacheGroupMessage",value:function(e,n){this._cachedGroupMessageMap.has(e)||this._cachedGroupMessageMap.set(e,[]),this._cachedGroupMessageMap.get(e).push(n)}},{key:"_deleteCachedGroupMessage",value:function(e){this._cachedGroupMessageMap.has(e)&&this._cachedGroupMessageMap.delete(e)}},{key:"_notifyCachedGroupMessage",value:function(e,n){var a=this,r=this._cachedGroupMessageMap.get(e)||[];D.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(e," groupType:").concat(n," count:").concat(r.length)),r.forEach(function(u){a.onNewMessage(u)}),this._deleteCachedGroupMessage(e)}},{key:"_cacheAndCompare",value:function(e){var n=e.groupID,a=e.event,r=e.item;e=e.groupType,D.l("".concat(this._n,"._cacheAndCompare groupID:").concat(n," groupType:").concat(e)),this._cacheGroupMessage(n,{event:a,dataList:[r]}),a={groupID:n,type:e},e===A.GRP_AVCHATROOM?this._grpM.hasLocalGroup(n)?this._notifyCachedGroupMessage(n,e):this._grpM.setUnjoinedAVChatRoom(n):(this._grpM.updateGroupMap([a]),this._notifyCachedGroupMessage(n,e)),this._checkCountMap.has(n)||this._checkCountMap.set(n,0)}},{key:"_handleGroupAtInfoWithoutTopic",value:function(e,n){var a=this;e&&n.length!==0&&n.forEach(function(r){var u=r.groupID,d=(r=r.groupAtInfoList,[]);q(r)||(r.forEach(function(_){d.push(g(g({},_),{},{groupID:u}))}),a._grpM.get(11).onNewGroupAtTips({dataList:d}))})}},{key:"setPagingGroupCount",value:function(e){q(e)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(e,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=No,this._pagingGetCostList=[]}}]),Ri),Go=(N(vs,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_attr_cache_time");q(e)||(this.CACHE_EXPIRE_TIME=Number(e))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach(function(e){e.localMainSequence=0})}},{key:"isGroupAttributesUpdatedNotice",value:function(e){var n=e.to,a=(e=e.elements.newGroupProfile,!q(e)&&!Se(e.groupAttributeOption));return a&&this._onGroupAttributesUpdated({groupID:n,groupAttributeOption:e.groupAttributeOption}),a}},{key:"_onGroupAttributesUpdated",value:function(e){var n=this,a=e.groupID,r=(e=e.groupAttributeOption).mainSequence,u=e.isWithChangedAttributeInfo,d=(d=e.groupAttributeList)===void 0?[]:d;if(e=e.operationType,D.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(a," isWithChangedAttributeInfo:").concat(u," operationType:").concat(e)),!q(e)){this._groupAttributesCopy=this._getCachedAttributes({groupID:a});var _=r-this._getLocalGroupAttributes(a).localMainSequence;if(_!=0){if(u===1&&_==1)return this._refreshCachedGroupAttributes({groupID:a,remoteMainSequence:r,groupAttributeList:d,operationType:e}),void this._emitGroupAttributesUpdated(a);this._hasLocalGroupAttributes(a)&&(u=this._getLocalGroupAttributes(a).avChatRoomKey,this._getGroupAttributes({groupID:a,avChatRoomKey:u}).then(function(){n._emitGroupAttributesUpdated(a)}))}}}},{key:"initGroupAttributesCache",value:function(e){var n=e.groupID;e=(e=e.avChatRoomKey)===void 0?void 0:e,this._groupAttributesMap.set(n,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:e}),D.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(n," avChatRoomKey:").concat(e))}},{key:"initGroupAttributes",value:function(e){var n=this,a=e.groupID,r=e.groupAttributes,u=(e=this._getLocalGroupAttributes(a)).remoteMainSequence,d=(e=e.avChatRoomKey,new ce("initGroupAttributes"));return d.setMessage("groupID:".concat(a," avChatRoomKey:").concat(e," mainSequence:").concat(u)),this._grpM.req({P:b.SET_GRP_ATTR,data:{groupID:a,avChatRoomKey:e,mainSequence:u,groupAttributeList:this._transformGroupAttributes(r)}}).then(function(_){D.l("".concat(n._n,".").concat("initGroupAttributes"," ok. groupID:").concat(a));var y=(_=_.data).mainSequence;return(_=J(_.groupAttributeList)).forEach(function(M){M.value=r[M.key]}),n._groupAttributesCopy=n._getCachedAttributes({groupID:a}),n._refreshCachedGroupAttributes({groupID:a,remoteMainSequence:y,groupAttributeList:_,operationType:1}),n._emitGroupAttributesUpdated(a),d.end(),be({groupAttributes:r})}).catch(function(_){return d.setError(_).end(),j(_)})}},{key:"setGroupAttributes",value:function(e){var n=this,a="".concat(this._n,".").concat("setGroupAttributes"),r=e.groupID,u=e.groupAttributes,d=(e=this._getLocalGroupAttributes(r)).remoteMainSequence,_=e.avChatRoomKey,y=e.attributes,M=((e=this._transformGroupAttributes(u)).forEach(function(R){var L=R.key;R.sequence=0,y.has(L)&&(R.sequence=y.get(L).sequence)}),new ce("setGroupAttributes"));return M.setMessage("groupID:".concat(r," groupAttributes:").concat(JSON.stringify(u))),D.l("".concat(a,". groupID:").concat(r," mainSequence:").concat(d)),this._grpM.req({P:b.MODIFY_GRP_ATTR,data:{groupID:r,avChatRoomKey:_,mainSequence:d,groupAttributeList:e}}).then(function(R){D.l("".concat(a," ok."));var L=(R=R.data).mainSequence;return(R=J(R.groupAttributeList)).forEach(function(F){F.value=u[F.key]}),n._groupAttributesCopy=n._getCachedAttributes({groupID:r}),n._refreshCachedGroupAttributes({groupID:r,remoteMainSequence:L,groupAttributeList:R,operationType:2}),n._emitGroupAttributesUpdated(r),M.end(),be({groupAttributes:u})}).catch(function(R){return M.setError(R).end(),j(R)})}},{key:"deleteGroupAttributes",value:function(e){var n=this,a=e.groupID,r=(e=(e=e.keyList)===void 0?[]:e,(y=this._getLocalGroupAttributes(a)).remoteMainSequence),u=y.avChatRoomKey,d=y.attributes,_=J(d.keys()),y=b.CLEAR_GRP_ATTR,M=3,R=(u={groupID:a,avChatRoomKey:u,mainSequence:r},[]),L=(0<e.length&&(_=[],y=b.DEL_GRP_ATTR,M=4,e.forEach(function(F){var x=0;d.has(F)&&(x=d.get(F).sequence,_.push(F)),R.push({key:F,sequence:x})}),u.groupAttributeList=R),new ce("deleteGroupAttributes"));return L.setMessage("groupID:".concat(a," mainSequence:").concat(r," keyList:").concat(e," proto:").concat(y)),this._grpM.req({P:y,data:u}).then(function(F){return D.l("".concat(n._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(a)),F=F.data.mainSequence,n._groupAttributesCopy=n._getCachedAttributes({groupID:a}),n._refreshCachedGroupAttributes({groupID:a,remoteMainSequence:F,groupAttributeList:R,operationType:M}),n._emitGroupAttributesUpdated(a),L.end(),be({keyList:_})}).catch(function(F){return L.setError(F).end(),j(F)})}},{key:"getGroupAttributes",value:function(e){var n=this,a="".concat(this._n,".").concat("getGroupAttributes"),r=e.groupID,u=(y=this._getLocalGroupAttributes(r)).avChatRoomKey,d=y.lastUpdateTime,_=y.localMainSequence,y=y.remoteMainSequence,M=new ce("getGroupAttributes");return M.setMessage("groupID:".concat(r," localMainSequence:").concat(_," remoteMainSequence:").concat(y," keyList:").concat(e.keyList)),Date.now()-d>=this.CACHE_EXPIRE_TIME||_<y?this._getGroupAttributes({groupID:r,avChatRoomKey:u}).then(function(R){return M.setMoreMessage("get attributes from remote. count:".concat(R.length)).end(),D.l("".concat(a," from remote. groupID:").concat(r)),be({groupAttributes:R=n._getCachedAttributes(e)})}).catch(function(R){return M.setError(R).end(),j(R)}):(M.setMoreMessage("get attributes from cache").end(),D.l("".concat(a," from cache. groupID:").concat(r)),Ke({groupAttributes:d=this._getCachedAttributes(e)}))}},{key:"_getGroupAttributes",value:function(e){var n=this,a=0;return q(e.avChatRoomKey)||(a=1),this._grpM.req({P:b.GET_GRP_ATTR,data:g(g({},e),{},{groupType:a})}).then(function(r){D.l("".concat(n._n,"._getGroupAttributes ok. groupID:").concat(e.groupID));var u=(r=r.data).mainSequence,d=J(r=r.groupAttributeList);return q(u)||n._refreshCachedGroupAttributes({groupID:e.groupID,remoteMainSequence:u,groupAttributeList:d,operationType:5}),r}).catch(function(r){return j(r)})}},{key:"_refreshCachedGroupAttributes",value:function(e){var n=e.groupID,a=e.remoteMainSequence,r=e.groupAttributeList;if(e=e.operationType,this._hasLocalGroupAttributes(n)){var u=this._getLocalGroupAttributes(n),d=u.localMainSequence;if(e===5||a-d==1)u.remoteMainSequence=a,u.localMainSequence=a,u.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:u,groupAttributeList:r,operationType:e});else{if(d===a)return;u.remoteMainSequence=a}this._groupAttributesMap.set(n,u),r="operationType:".concat(e," localMainSequence:").concat(d," remoteMainSequence:").concat(a),D.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(r))}}},{key:"_getCachedAttributes",value:function(e){var n=e.groupID,a=(e=(e=e.keyList)===void 0?[]:e,{});if(this._hasLocalGroupAttributes(n)){var r=this._getLocalGroupAttributes(n).attributes;if(0<e.length)e.forEach(function(y){r.has(y)&&(a[y]=r.get(y).value)});else{var u,d=Ne(r.keys());try{for(d.s();!(u=d.n()).done;){var _=u.value;a[_]=r.get(_).value}}catch(y){d.e(y)}finally{d.f()}}}return a}},{key:"_updateCachedAttributes",value:function(e){var n=e.groupAttributes,a=e.groupAttributeList;(e=e.operationType)!==3?e!==4?(e===1&&n.attributes.clear(),a.forEach(function(r){var u=r.key,d=r.value;r=r.sequence,n.attributes.set(u,{value:d,sequence:r})})):a.forEach(function(r){n.attributes.delete(r.key)}):n.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(e){return this._groupAttributesMap.has(e)}},{key:"_getLocalGroupAttributes",value:function(e){return this._hasLocalGroupAttributes(e)||this.initGroupAttributesCache({groupID:e}),this._groupAttributesMap.get(e)}},{key:"_transformGroupAttributes",value:function(e){var n=[];return Object.keys(e).forEach(function(a){n.push({key:a,value:e[a]})}),n}},{key:"_emitGroupAttributesUpdated",value:function(e){var n=this._getCachedAttributes({groupID:e}),a=(r=this._computeAttrChangedInfo(n)).updatedKeyList,r=r.deletedKeyList;D.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(a.length,", delete:").concat(r.length)),a.length===0&&r.length===0||this._grpM.emitOEvt(me.GROUP_ATTRIBUTES_UPDATED,{groupID:e,groupAttributes:n,updatedKeyList:a,deletedKeyList:r})}},{key:"_computeAttrChangedInfo",value:function(e){var n=this,a=[],r=[];return Object.keys(e).forEach(function(u){e[u]!==n._groupAttributesCopy[u]&&a.push(u)}),Object.keys(this._groupAttributesCopy).forEach(function(u){q(e[u])&&r.push(u)}),this._groupAttributesCopy={},{updatedKeyList:a,deletedKeyList:r}}},{key:"deleteLocalGroupAttributes",value:function(e){this._hasLocalGroupAttributes(e)&&this._groupAttributesMap.delete(e)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),vs),ls=(N(Ei,[{key:"_onCloudConfig",value:function(){var e=this._grpM.getCloudConfig("grp_counter_expire_time");q(e)||(this.EXPIRE_TIME=Number(e))}},{key:"isGroupCountersNotice",value:function(e){var n=e.to,a=!1;return Se(e=e.elements.groupCounterInfo)||(this._onGroupCountersUpdated({groupID:n,groupCounterInfo:e}),a=!0),a}},{key:"_onGroupCountersUpdated",value:function(e){var n=this,a=e.groupID;e.groupCounterInfo.forEach(function(r){var u=r.type,d=r.groupCounterSeq;r=(r=r.counterList)===void 0?[]:r,u!==0&&u!==2||(n._updateLocalGroupCounters({groupID:a,groupCounterSeq:d,counterList:r}),r.forEach(function(_){n._grpM.emitOEvt(me.GROUP_COUNTER_UPDATED,{groupID:a,key:_.key,value:_.value})})),u===1&&n._deleteLocalGroupCounters({groupID:a,groupCounterSeq:d,counterList:r})}),D.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(a))}},{key:"initGroupCountersCache",value:function(e){var n=e.groupID;e=e.avChatRoomKey,this._groupCountersMap.set(n,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:e}),D.l("".concat(this._n,".initGroupCountersCache groupID:").concat(n," avChatRoomKey:").concat(e))}},{key:"setGroupCounters",value:function(e){if(!this._grpM.canIUse(Qe.GRP_COUNTER))return this._grpM.noUse("setGroupCounters");var n="".concat(this._n,".").concat("setGroupCounters"),a=e.groupID,r=(e=e.counters,e=this._convertObjectToList(e),this._getLocalGroupCounters(a).avChatRoomKey),u="groupID:".concat(a," count:").concat(e.length),d=new ce("setGroupCounters");return d.setMessage("".concat(u)),D.l("".concat(n,". ").concat(u)),this._updateGroupCounters({groupID:a,counterList:e,avChatRoomKey:r,mode:"Set"}).then(function(_){return d.end(),D.l("".concat(n," ok.")),be({counters:_})}).catch(function(_){return d.setError(_).end(),D.e("".concat(n," failed. error:"),_),j(_)})}},{key:"increaseGroupCounter",value:function(e){var n="increaseGroupCounter";if(!this._grpM.canIUse(Qe.GRP_COUNTER))return this._grpM.noUse(n);var a="".concat(this._n,".").concat(n),r=e.groupID,u=e.key,d=(e=e.value,this._getLocalGroupCounters(r).avChatRoomKey),_="groupID:".concat(r," key:").concat(u," value:").concat(e),y=new ce(n);return y.setMessage("".concat(_)),D.l("".concat(a,". ").concat(_)),this._updateGroupCounters({groupID:r,counterList:[{key:u,value:e}],avChatRoomKey:d,mode:"Increase"}).then(function(M){return y.end(),D.l("".concat(a," ok.")),be({counters:M})}).catch(function(M){return y.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"decreaseGroupCounter",value:function(e){var n="decreaseGroupCounter";if(!this._grpM.canIUse(Qe.GRP_COUNTER))return this._grpM.noUse(n);var a="".concat(this._n,".").concat(n),r=e.groupID,u=e.key,d=(e=e.value,this._getLocalGroupCounters(r).avChatRoomKey),_="groupID:".concat(r," key:").concat(u," value:").concat(e),y=new ce(n);return y.setMessage("".concat(_)),D.l("".concat(a,". ").concat(_)),this._updateGroupCounters({groupID:r,counterList:[{key:u,value:e}],avChatRoomKey:d,mode:"Decrease"}).then(function(M){return y.end(),D.l("".concat(a," ok.")),be({counters:M})}).catch(function(M){return y.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"getGroupCounters",value:function(e){var n=this;if(!this._grpM.canIUse(Qe.GRP_COUNTER))return this._grpM.noUse("getGroupCounters");var a="".concat(this._n,".").concat("getGroupCounters"),r=e.groupID,u=(e=e.keyList)===void 0?[]:e,d=(e=this._getLocalGroupCounters(r)).avChatRoomKey,_=(e=e.lastUpdateTime,new ce("getGroupCounters"));return _.setMessage("groupID:".concat(r)),Date.now()-e>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:r,avChatRoomKey:d}).then(function(y){return _.setMoreMessage("from remote. count:".concat(y.length)).end(),D.l("".concat(a," from remote. groupID:").concat(r)),be({counters:y=n._getLocalCounters(r,u)})}).catch(function(y){return _.setError(y).end(),j(y)}):(_.setMoreMessage("from cache").end(),D.l("".concat(a," from cache. groupID:").concat(r)),Ke({counters:e=this._getLocalCounters(r,u)}))}},{key:"_getRemoteGroupCounters",value:function(e){var n=this;return this._grpM.req({P:b.GET_GRP_COUNTER,data:g({},e)}).then(function(a){var r=(r=(a=a.data).counterList)===void 0?[]:r;return a=a.groupCounterSeq,n._updateLocalGroupCounters({groupID:e.groupID,counterList:r,groupCounterSeq:a}),D.l("".concat(n._n,"._getRemoteGroupCounters ok. groupID:").concat(e.groupID)),r}).catch(function(a){return j(a)})}},{key:"_convertObjectToList",value:function(e){var n=[];return Object.keys(e).forEach(function(a){n.push({key:a,value:e[a]})}),n}},{key:"_updateGroupCounters",value:function(e){var n="".concat(this._n,"._updateGroupCounters"),a=e.groupID,r=e.avChatRoomKey,u=e.mode;return D.l("".concat(n,". groupID:").concat(a," avChatRoomKey:").concat(r," mode:").concat(u)),this._grpM.req({P:b.UPDATE_GRP_COUNTER,data:g({},e)}).then(function(d){D.l("".concat(n," ok.")),d=d.data.counterList;var _={};return(d===void 0?[]:d).forEach(function(y){var M=y.key;y=y.value,_[M]=y}),_}).catch(function(d){return j(d)})}},{key:"_hasLocalGroupCounters",value:function(e){return this._groupCountersMap.has(e)}},{key:"_getLocalGroupCounters",value:function(e){return this._hasLocalGroupCounters(e)||this.initGroupCountersCache({groupID:e}),this._groupCountersMap.get(e)}},{key:"_updateLocalGroupCounters",value:function(e){var n,a,r,u=e.groupID,d=(d=e.counterList)===void 0?[]:d;e=e.groupCounterSeq,this._hasLocalGroupCounters(u)&&(r=this._getLocalGroupCounters(u),n=r.counters,a=r.avChatRoomKey,r=r.groupCounterSeq,0<e&&e<r||(d.forEach(function(_){var y=_.key;_=_.value,n.set(y,_)}),this._groupCountersMap.set(u,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:n,avChatRoomKey:a})))}},{key:"_deleteLocalGroupCounters",value:function(e){var n,a,r=e.groupID,u=(u=e.counterList)===void 0?[]:u;e=e.groupCounterSeq,this._hasLocalGroupCounters(r)&&(a=this._getLocalGroupCounters(r),n=a.counters,a=a.avChatRoomKey,u.forEach(function(d){n.delete(d.key)}),this._groupCountersMap.set(r,{lastUpdateTime:Date.now(),groupCounterSeq:e,counters:n,avChatRoomKey:a}))}},{key:"_getLocalCounters",value:function(e,n){var a={};if(!this._hasLocalGroupCounters(e))return a;var r=this._getLocalGroupCounters(e).counters;if(0<n.length)n.forEach(function(y){r.has(y)&&(a[y]=r.get(y))});else{var u,d=Ne(r.keys());try{for(d.s();!(u=d.n()).done;){var _=u.value;a[_]=r.get(_)}}catch(y){d.e(y)}finally{d.f()}}return a}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),Ei),Fu=(N(ms,[{key:"start",value:function(){var e=this._grpM.isLoggedIn();e||(this._proto=b.AV_NOAUTH_POLLING),D.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(e)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var e=this,n=this._onInit(this._groupID);this._grpM.req({P:this._proto,data:n}).then(function(a){e._onSuccess(e._groupID,a),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.getPollingInterval()))}).catch(function(a){e._onFail(e._groupID,a),e.isRunning()&&(clearTimeout(e._timeoutID),e._timeoutID=setTimeout(e._request.bind(e),e._manager.MAX_POLLING_INTERVAL))})}},{key:"stop",value:function(){D.l("".concat(this._n,".stop")),0<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),ms),xu={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0,100:!0},ed=(N(fs,[{key:"hasJoinedAVChatRoom",value:function(){var e=[];return 0<(e=0<this._joinedGroupMap.size?J(this._joinedGroupMap.values()).filter(function(n){return n.type===A.GRP_AVCHATROOM}):e).length}},{key:"getJoinedLiveList",value:function(){var e=[];return 0<this._joinedGroupMap.size?J(this._joinedGroupMap.values()).filter(function(n){return n.type===A.GRP_LIVE}):e}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._joinedGroupMap.has(e)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?J(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(e){var n=this._pollingRequestInfoMap.get(e);return e===J(this._pollingInstanceMap.keys())[0]?g(g({},n),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):g(g({},n),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(e,n){var a,r=(M=n.data).key,u=M.nextSeq,d=M.rspMsgList,_=M.errorCode,y=M.nextBroadcastSeq,M=M.broadcastMessageList;_!==0?(_=this._pollingRequestInfoMap.get(e),a=new ce("longPollingAVError"),_=_?"".concat(_.key,"-").concat(_.startSeq):"requestInfo is undefined",a.setMessage("".concat(e,"-").concat(_,"-").concat(n.errorInfo)).setCode(n.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(e)&&(Ee(r)&&ft(u)&&this._pollingRequestInfoMap.set(e,{key:r,startSeq:u}),ft(y)&&y>this._startBroadcastSeq&&(this._startBroadcastSeq=y),ke(d)&&0<d.length?(d.forEach(function(R){R.to=R.groupID}),this.onMessage(d,e)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(M))}},{key:"_handleFailure",value:function(e,n){}},{key:"onMessage",value:function(e,n){if(ke(e)&&e.length!==0){var a="".concat(this._n,".onMessage"),r=(n&&(a+=" groupID:".concat(n)),this._pollingNoMessageCount!==0&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),u=[],d=this._get(11),_=this._get(26),y=e.length,M=(1<y&&e.sort(function(le,he){return le.sequence-he.sequence}),this._get(12).isUnlimitedAVChatRoom()),R=!1;D.getLevel()<=0&&(n=e.map(function(le){return le.sequence}),D.l("".concat(a," count:").concat(n.length," sequenceList:").concat(n)),n.length=0);for(var L=0;L<y;L++){var F=this.restoreMessageFromSimplified(e[L]);if(xu[F.event]){if(F.event===6&&(this._grpM.isGroupAttributesUpdatedNotice(F)||this._grpM.isGroupCountersNotice(F)))continue;if(F.event!==20)if(F.event!==21)if(F.event!==100){r=this.packMessage(F,F.event);var x=F.isModified===1;if(R=F.isHistoryMessage===1,!M){if(this._seqSll.has(r.sequence))continue;this._seqSll.set(r.sequence)}var K=this._IDSll.has(r.ID);K?D.w("".concat(a," ID:").concat(r.ID," has:").concat(K)):(this._IDSll.set(r.ID),K=!1,!R&&this._isMessageSentByCurrentInstance(r)?x&&(K=!0,r.isModified=x,d.updateMsgIsModifiedProp(r)):K=!0,K&&(r.conversationType===A.CONV_SYSTEM&&r.payload.operationType===5&&this._onGroupDismissed(r.payload.groupProfile.groupID),R||r.conversationType===A.CONV_SYSTEM||(x=r.conversationID.replace(A.CONV_GROUP,""),this._pollingInstanceMap.has(x)?this._grpM.isLoggedIn()&&_.addMessageSequence({key:bo,message:r}):(r.type!==A.MSG_GRP_TIP&&0<r.clientTime&&_.addMessageDelay(r.clientTime),_.addMessageSequence({key:Ii,message:r}))),u.push(r)))}else this.onRoomCustomData(F);else this._get(34).onMessageReactionNotify({event:21,dataList:F.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(F)}else D.w("".concat(a,". unknown event:").concat(F.event))}u.length!==0&&(0<(n=wa(u)).length&&this._grpM.emitOEvt(me.MESSAGE_MODIFIED,n),R||0<(n=this.packConversationOption(u)).length&&d.onNewMessage({conversationOptionsList:n,isInstantMessage:!0}),this._checkMessageStacked(u),0<(n=lr(u)).length&&this._grpM.emitOEvt(me.MESSAGE_RECEIVED,n),u.length=0)}}},{key:"handleMessageRevokedNotice",value:function(e){var n=this,a=e.groupID,r=e.elements.revokeMsgList,u=e.revokerInfo,d=[];r.forEach(function(_){var y=_.tinyID,M=_.clientTime,R=_.random;_=_.sequence,y={conversationID:"".concat(A.CONV_GROUP).concat(a),ID:"".concat(y,"-").concat(M,"-").concat(R),revoker:u.revoker,revokeReason:u.reason||"",revokerInfo:{userID:u.revoker,nick:"",avatar:""},sequence:_},d.push(y)}),d.length!==0&&this._get(11).updateRevokerInfo(d).then(function(_){n._grpM.emitOEvt(me.MESSAGE_REVOKED,_)})}},{key:"isBroadcastOrNormal",value:function(e){return e===3||e===17}},{key:"isGroupTip",value:function(e){return e===4||e===6}},{key:"isGroupSystemNotice",value:function(e){return e===5}},{key:"restoreGroupTipElements",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},n=(n=e.operatorInfo)===void 0?{}:n,a=e.operatorID,r=(r=e.userIDList)===void 0?[]:r,u=e.operationType,d=(ft(e.groupJoinType)||u!==1&&u!==2||(e.groupJoinType=u===2?0:1),u=n.userID,n.avatar);return n=n.nick,e.operatorInfo={userID:u===void 0?a:u,avatar:d===void 0?"":d,nick:n===void 0?"":n},a=r.map(function(_){return{userID:_}}),e.memberInfoList=e.memberInfoList||a,e}},{key:"restoreMessageFromSimplified",value:function(e){var n,a,r,u=e.event;return this.isBroadcastOrNormal(u)&&(e.cloudCustomData=e.cloudCustomData||"",e.elements=e.elements.map(function(d){var _;return d.type===A.MSG_CUSTOM&&(_=d.content,d.content=g({data:"",description:"",extension:""},_===void 0?{}:_)),d})),(this.isGroupTip(u)||this.isGroupSystemNotice(u))&&(e.from=e.from||"@TIM#SYSTEM"),this.isGroupTip(u)&&(e.elements=this.restoreGroupTipElements(e.elements),a=(r=(r=e.elements)===void 0?{}:r).operationType,n=r.operatorInfo,a===1&&(a=[{userID:(n===void 0?{}:n).userID}],r.memberInfoList=r.memberInfoList||a)),this.isGroupSystemNotice(u)&&(r=(n=e.elements).memberInfoList,a=n.operatorInfo,e.elements.memberInfoList=g({userID:e.elements.operatorID,avatar:"",nick:""},r=r||(a===void 0?{}:a)),e.elements=g({authentication:"",remarkInfo:"",messageKey:1e3*e.time},e.elements),u=Object.keys(e.elements).filter(function(d){return d!=="operatorInfo"}).reduce(function(d,_){return g(g({},d),{},B({},_,e.elements[_]))},{}),e.elements=u),e}},{key:"_onGroupDismissed",value:function(e){D.l("".concat(this._n,"._onGroupDismissed groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"_checkMessageStacked",value:function(e){var n="MessageStacked";100<=(e=e.length)&&(this._grpM.warn(n,e),this._reportMessageStackedCount<5&&(new ce(n).setMessage("count:".concat(e," groupID:").concat(J(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(e){return!!this._get(11).isMessageSentByCurrentInstance(e)}},{key:"packMessage",value:function(e,n){e.currentUser=this._grpM.getMyUserID(),e.conversationType=n===5?A.CONV_SYSTEM:A.CONV_GROUP,e.isSystemMessage=!!e.isSystemMessage;var a=new In(e),r=(e=this.packElements(e,n),n=this._grpM.getFileDownloadProxy(),this._grpM.getDowloadFileAuthKey()),u=this._get(17).getFileDNList();return a.setElement(e,n,r,u),a}},{key:"packElements",value:function(e,n){return n===4||n===6?(this._updateMemberCountByGroupTips(e),{type:A.MSG_GRP_TIP,content:g(g({},e.elements),{},{groupProfile:e.groupProfile})}):n===5?{type:A.MSG_GRP_SYS_NOTICE,content:g(g({},e.elements),{},{groupProfile:g(g({},e.groupProfile),{},{groupID:e.groupID})})}:e.elements}},{key:"packConversationOption",value:function(e){for(var n=new Map,a=0;a<e.length;a++){var r,u=e[a],d=u.conversationID;n.has(d)?((r=n.get(d)).lastMessage=u).flow==="in"&&r.unreadCount++:n.set(d,{conversationID:u.conversationID,unreadCount:u.flow==="out"?0:1,type:u.conversationType,subType:u.conversationSubType,lastMessage:u})}return J(n.values())}},{key:"_updateMemberCountByGroupTips",value:function(e){var n,a,r,u=e.groupProfile.groupID;Se(e=(e=e.elements.onlineMemberInfo)===void 0?void 0:e)||(n=(n=e.onlineMemberNum)===void 0?0:n,e=(e=e.expireTime)===void 0?this.DEFAULT_EXPIRE_TIME:e,a=this._onlineMemberCountMap.get(u)||{},r=Date.now(),Se(a)?Object.assign(a,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:r,memberCount:n,expireTime:e}):(a.latestUpdateTime=r,a.memberCount=n),this._onlineMemberCountMap.set(u,a))}},{key:"_onBroadcastMessage",value:function(e){if(!Se(e)){for(var n=[],a=e.length,r=null,u=0;u<a;u++){var d=this.restoreMessageFromSimplified(e[u]);xu[d.event]?((r=this.packMessage(d,d.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(r.ID)||(n.push(r),this._broadcastMessageIDMap.set(r.ID,1))):D.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(d.event))}0<n.length&&this._grpM.emitOEvt(me.MESSAGE_RECEIVED,n)}}},{key:"start",value:function(e){var n;this._pollingInstanceMap.has(e)?(n=this._pollingInstanceMap.get(e)).isRunning()||n.start():((n=new Fu({manager:this,groupID:e,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(e,n),D.l("".concat(this._n,".start groupID:").concat(e)))}},{key:"handleJoinResult",value:function(e){var n=this;return this._preCheck(e.group).then(function(){var a=e.longPollingKey,r=e.group,u=r.groupID;return n._joinedGroupMap.set(u,r),n._grpM.updateGroupMap([r]),n._grpM.deleteUnjoinedAVChatRoom(u),n._grpM.emitGroupListUpdate(!0,!1),q(a)?Ke({status:pi,group:r}):Promise.resolve()})}},{key:"startRunLoop",value:function(e){var n=this;return this.handleJoinResult(e).then(function(){var a=e.longPollingKey,r=e.group,u=e.startSeq,d=r.groupID;return n._pollingRequestInfoMap.set(d,{key:a,startSeq:u===void 0?0:u}),n.start(d),n._grpM.isLoggedIn()?Ke({status:pi,group:r}):Ke({status:pi})})}},{key:"_preCheck",value:function(e){if(this._get(12).isUnlimitedAVChatRoom()||!this.hasJoinedAVChatRoom()||e.type===A.GRP_LIVE)return Promise.resolve();var n=(e=te(this._joinedGroupMap.entries().next().value,2))[0];if(e=e[1],this._grpM.isLoggedIn()){if(e.selfInfo.role!==A.GRP_MBR_ROLE_OWNER&&e.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(n);this._grpM.deleteLocalGroupAndConversation(n)}else this._grpM.deleteLocalGroupAndConversation(n);return this.reset(n),Promise.resolve()}},{key:"joinWithoutAuth",value:function(e){var n=this,a=e.groupID,r="".concat(this._n,".").concat("joinWithoutAuth"),u=new ce("joinWithoutAuth");return this._grpM.req({P:b.APPLY_JOIN_GRP_NOAUTH,data:e}).then(function(d){if(d=d.data.longPollingKey,u.setMessage("groupID:".concat(a," longPollingKey:").concat(d)).end(!0),q(d))return j({code:X.CANNOT_JOIN_NON_AV_WITHOUT_LOGIN});D.l("".concat(r," ok. groupID:").concat(a)),n._get(11).setCompleted("".concat(A.CONV_GROUP).concat(a));var _=new Po({groupID:a});return n.startRunLoop({group:_,longPollingKey:d}),be({status:pi})}).catch(function(d){return D.e("".concat(r," failed. groupID:").concat(a," error:"),d),u.setError(d).setMessage("groupID:".concat(a)).end(!0),j(d)}).finally(function(){n._grpM.get(14).reportAtOnce()})}},{key:"getGroupOnlineMemberCount",value:function(e){var n=this._onlineMemberCountMap.get(e)||{},a=Date.now();return Se(n)||a-n.lastSyncTime>1e3*n.expireTime&&1e4<a-n.latestUpdateTime&&3e3<a-n.lastReqTime?(n.lastReqTime=a,this._onlineMemberCountMap.set(e,n),this._getGroupOnlineMemberCount(e).then(function(r){return be({memberCount:r.memberCount})}).catch(function(r){return j(r)})):Ke({memberCount:n.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(e){var n=this,a="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),r=new ce("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(e).then(function(u){var d=n._onlineMemberCountMap.get(e)||{},_=(_=(u=u.data).memberCount)===void 0?0:_,y=(u=(u=u.expireTime)===void 0?n.DEFAULT_EXPIRE_TIME:u,D.l("".concat(a," ok. groupID:").concat(e," memberCount:").concat(_," expireTime:").concat(u)),Date.now());return Se(d)&&(d.lastReqTime=y),n._onlineMemberCountMap.set(e,Object.assign(d,{lastSyncTime:y,latestUpdateTime:y,memberCount:_,expireTime:u})),{memberCount:_}}).catch(function(u){return D.w("".concat(a," failed. error:"),u),r.setCode(u.code).setMessage("groupID:".concat(e," error:").concat(JSON.stringify(u))).end(),Promise.reject(u)})}},{key:"_get",value:function(e){return this._grpM.get(e)}},{key:"setPollingInterval",value:function(e){q(e)||(ft(e)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=e:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(e,10))}},{key:"setPollingIntervalPlus",value:function(e){q(e)||(ft(e)?this.DEFAULT_POLLING_INTERVAL_PLUS=e:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(e,10))}},{key:"setPollingNoMessageCount",value:function(e){q(e)||(ft(e)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=e:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(e,10))}},{key:"setPollingSimplifiedMessage",value:function(e){q(e)||e!=="0"&&e!=="1"||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(e,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(e){e=e.payload.groupProfile.groupID,D.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(e)),this._grpM.deleteLocalGroupAndConversation(e),this.reset(e)}},{key:"restartPolling",value:function(){D.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var e,n=Ne(this._pollingInstanceMap.values());try{for(n.s();!(e=n.n()).done;){var a=e.value;a.stop(),a.start()}}catch(r){n.e(r)}finally{n.f()}}},{key:"getPollingTimerID",value:function(e){if(!this._pollingInstanceMap.has(e))return-1;var n=this._pollingInstanceMap.get(e).getPollingTimerID();return D.l("".concat(this._n,".getPollingTimerID groupID:").concat(e," timerID:").concat(n)),n}},{key:"hasPollingInstance",value:function(e){return this._pollingInstanceMap.has(e)}},{key:"onRoomCustomData",value:function(e){var n=e.groupID,a=e.sequence,r=e.time;e=(e=e.elements)&&e.content,this._get(30).onRoomCustomDataReceived(e),D.l("".concat(this._n,".onRoomCustomData groupID:").concat(n," sequence:").concat(a," time:").concat(r," data:").concat(e))}},{key:"reset",value:function(e){if(e){D.l("".concat(this._n,".reset groupID:").concat(e));var n=this._pollingInstanceMap.get(e);n&&n.stop(),this._pollingInstanceMap.delete(e),this._joinedGroupMap.delete(e),this._pollingRequestInfoMap.delete(e),this._onlineMemberCountMap.delete(e)}else{D.l("".concat(this._n,".reset all"));var a,r=Ne(this._pollingInstanceMap.values());try{for(r.s();!(a=r.n()).done;)a.value.stop()}catch(u){r.e(u)}finally{r.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this._seqSll.reset(),this._IDSll.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),fs),td=(N(_s,[{key:"updateMember",value:function(e){q(e.onlineStatus)||(this.isOnline=e.onlineStatus==="Online");var n=[null,void 0,"",0,NaN];e.memberCustomField&&Ho(this.memberCustomField,e.memberCustomField),Gn(this,e,["memberCustomField","marks","onlineStatus"],n)}},{key:"updateRole",value:function(e){["Owner","Admin","Member"].indexOf(e)<0||(this.role=e)}},{key:"updateMuteUntil",value:function(e){q(e)||(this.muteUntil=Math.floor((Date.now()+1e3*e)/1e3))}},{key:"updateNameCard",value:function(e){q(e)||(this.nameCard=e)}},{key:"updateMemberCustomField",value:function(e){e&&Ho(this.memberCustomField,e)}}]),_s),nd=(N(Di,[{key:"_onProfileUpdated",value:function(e){for(var n=this,a=e.data,r=0;r<a.length;r++)(function(u){var d=a[u];n.groupMemberListMap.forEach(function(_){_.has(d.userID)&&_.get(d.userID).updateMember({nick:d.nick,avatar:d.avatar})})})(r)}},{key:"deleteGroupMemberList",value:function(e){this.groupMemberListMap.delete(e)}},{key:"getGroupMemberList",value:function(e){var n,a=this,r=e.groupID,u=(u=e.role)===void 0?void 0:u,d=(M=e.offset)===void 0?0:M,_=(M=e.count)===void 0?15:M,y=(e=(M=e.filter)===void 0?void 0:M,"".concat(this._n,".").concat("getGroupMemberList")),M=this._grpM.hasLocalGroup(r);if(D.l("".concat(y," groupID:").concat(r," role:").concat(u," offset:").concat(d," count:").concat(_," hasLocalGroup:").concat(M)),!M)return Ke({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(r).type===A.GRP_AVCHATROOM){if(this._grpM.canIUse(Qe.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:r,offset:d,filter:e});this._grpM.warn("LiveOnlineMember")}u!==A.GRP_MBR_ROLE_ADMIN&&u!==A.GRP_MBR_ROLE_OWNER&&u!==A.GRP_MBR_ROLE_MEMBER||(n=u);var R=new ce("getGroupMemberList"),L=0,F=(M={groupID:r,limit:100<_?100:_,memberRoleFilter:n?[n]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},Vt({groupID:r})?M.next="".concat(d):(M.offset=d,L=d+_),[]);return this._grpM.req({P:b.GET_GRP_MBR_LIST,data:M}).then(function(x){var K=(x=x.data).members,le=x.memberNum;return x=x.next,q(x=x===void 0?void 0:x)||(L=Se(x)?0:x),ke(K)&&K.length!==0?(a._grpM.hasLocalGroup(r)&&(a._grpM.getLocalGroupProfile(r).memberNum=le),F=a._updateLocalGroupMemberMap(r,K),a._grpM.get(4).getUserProfile({userIDList:K.map(function(he){return he.userID}),tagList:[Je.NICK,Je.AVATAR]})):(L=0,Promise.resolve([]))}).then(function(x){return ke(x=x.data)&&x.length!==0?(x=x.map(function(K){return{userID:K.userID,nick:K.nick,avatar:K.avatar}}),a._updateLocalGroupMemberMap(r,x),F.length<_&&(L=0),R.setMessage("groupID:".concat(r," offset:").concat(d," count:").concat(_)).end(),D.l("".concat(y," ok.")),be({memberList:F,offset:L})):Ke({memberList:[],offset:L})}).catch(function(x){return R.setError(x).end(),D.e("".concat(y," failed. error:"),x),j(x)})}},{key:"_getAVChatRoomMemberList",value:function(e){var n=this,a=e.groupID,r=e.offset,u=(e=e.filter,"".concat(this._n,".").concat("_getAVChatRoomMemberList")),d=new ce("_getAVChatRoomMemberList");return d.setMessage("groupID:".concat(a," offset:").concat(r," filter:").concat(e)),this._grpM.req({P:b.GET_AV_MBR_LIST,data:{groupID:a,offset:r,filter:e}}).then(function(_){var y=(y=(_=_.data).memberList)===void 0?[]:y;return _=(_=_.offset)===void 0?0:_,d.end(),D.l("".concat(u," ok. member count:").concat(y.length,", next request timestamp:").concat(_)),y=y.map(function(M){return g(g({},M),{},{onlineStatus:"Online"})}),be({memberList:y=n._updateLocalGroupMemberMap(a,y),offset:_})}).catch(function(_){return d.setError(_).end(),D.e("".concat(u," failed. error:"),_),j(_)})}},{key:"getGroupMemberProfile",value:function(e){var n=this,a="getGroupMemberProfile",r="".concat(this._n,".").concat(a),u="groupID:".concat(e.groupID),d=(5<e.userIDList.length?u+=" userIDList.length:".concat(e.userIDList.length):u+=" userIDList:".concat(e.userIDList),D.l("".concat(r," ").concat(u)),50<e.userIDList.length&&(e.userIDList=e.userIDList.slice(0,50)),e.groupID),_=e.userIDList;if((r=this._grpM.getLocalGroupProfile(d))&&Un(r.type))return j({code:r=X.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(r,a)});var y=new ce(a);return y.setMessage(u),this._getGroupMemberProfileAdvance(g(g({},e),{},{userIDList:_})).then(function(M){return ke(M=M.data.members)&&M.length!==0?(n._updateLocalGroupMemberMap(d,M),n._grpM.get(4).getUserProfile({userIDList:M.map(function(R){return R.userID}),tagList:[Je.NICK,Je.AVATAR]})):Ke([])}).then(function(M){return M=M.data.map(function(R){return{userID:R.userID,nick:R.nick,avatar:R.avatar}}),n._updateLocalGroupMemberMap(d,M),M=_.filter(function(R){return n.hasLocalGroupMember(d,R)}).map(function(R){return n.getLocalGroupMemberInfo(d,R)}),y.end(),be({memberList:M})})}},{key:"addGroupMember",value:function(e){var n=this,a="".concat(this._n,".").concat("addGroupMember"),r=e.groupID,u=this._grpM.getLocalGroupProfile(r),d=u.type,_=new ce("addGroupMember");return _.setMessage("groupID:".concat(r," groupType:").concat(d)),Un(d)?(d=new xe({code:X.CANNOT_ADD_MEMBER_IN_AV}),_.setError(d).end(),j(d)):(e.userIDList=e.userIDList.map(function(y){return{userID:y}}),D.l("".concat(a," groupID:").concat(r)),this._grpM.req({P:b.ADD_GRP_MBR,data:e}).then(function(y){y=y.data.members;var M=(D.l("".concat(a," ok")),y.filter(function(x){return x.result===1}).map(function(x){return x.userID})),R=y.filter(function(x){return x.result===0}).map(function(x){return x.userID}),L=y.filter(function(x){return x.result===2}).map(function(x){return x.userID}),F=(y=y.filter(function(x){return x.result===4}).map(function(x){return x.userID}),"groupID:".concat(e.groupID,", ")+"successUserIDList:".concat(M,", ")+"failureUserIDList:".concat(R,", ")+"existedUserIDList:".concat(L,", ")+"overLimitUserIDList:".concat(y));return _.setMoreMessage(F).end(),M.length===0?be({successUserIDList:M,failureUserIDList:R,existedUserIDList:L,overLimitUserIDList:y}):(n._updateConvGroupProfile(u),be({successUserIDList:M,failureUserIDList:R,existedUserIDList:L,overLimitUserIDList:y,group:u}))}).catch(function(y){return _.setError(y).end(),D.e("".concat(a," failed. error:"),y),j(y)}))}},{key:"deleteGroupMember",value:function(e){var n=this,a="".concat(this._n,".").concat("deleteGroupMember"),r=e.groupID,u=e.userIDList,d=this._grpM.getLocalGroupProfile(r);if(q(d))return j({code:X.CANNOT_FIND_GRP});if(Un(d.type))return this._grpM.canIUse(Qe.AV_BAN_MBR)?this._banAVChatRoomMember(e):this._grpM.noUse("deleteGroupMember");var _="groupID:".concat(r," ").concat(5<u.length?"userIDList.length:".concat(u.length):"userIDList:".concat(u)),y=(D.l("".concat(a," groupID:").concat(r," userIDList:"),u),new ce("deleteGroupMember"));return y.setMessage(_),this._grpM.req({P:b.DEL_GRP_MBR,data:e}).then(function(){return y.end(),D.l("".concat(a," ok")),n._updateConvGroupProfile(d),n.deleteLocalGroupMembers(r,u),be({group:d,userIDList:u})}).catch(function(M){return y.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"_updateConvGroupProfile",value:function(e){this._grpM.get(11).updateConvGroupProfile([e])}},{key:"_banAVChatRoomMember",value:function(e){var n=this,a="".concat(this._n,".").concat("_banAVChatRoomMember"),r=e.groupID,u=e.userIDList,d="groupID:".concat(r," ").concat(5<u.length?"userIDList.length:".concat(u.length):"userIDList:".concat(u)),_=new ce("_banAVChatRoomMember"),y=(_.setMessage(d),D.l("".concat(a," groupID:").concat(r," userIDList:"),u),this._grpM.getLocalGroupProfile(r));return q(e.duration)||e.duration===0?j({code:X.BAN_DURATION_INVALID}):this._grpM.req({P:b.BAN_AV_MBR,data:e}).then(function(){return _.end(),D.l("".concat(a," ok")),n.deleteLocalGroupMembers(r,u),be({group:y,userIDList:u})}).catch(function(M){return _.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"setGroupMemberMuteTime",value:function(e){var n=this,a=e.groupID,r=e.userID,u=(e=e.muteTime,"".concat(this._n,".").concat("setGroupMemberMuteTime"));if(r===this._grpM.getMyUserID())return j({code:X.CANNOT_MUTE_SELF});var d="groupID:".concat(a," userID:").concat(r," muteTime:").concat(e),_=(D.l("".concat(u," ").concat(d)),new ce("setGroupMemberMuteTime"));return _.setMessage(d),this.modifyGroupMemberInfo({groupID:a,userID:r,muteTime:e}).then(function(y){return _.end(),D.l("".concat(u," ok")),be({group:n._grpM.getLocalGroupProfile(a),member:y})}).catch(function(y){return _.setError(y).end(),D.e("".concat(u," failed. error:"),y),j(y)})}},{key:"setGroupMemberRole",value:function(e){var n="".concat(this._n,".").concat("setGroupMemberRole"),a=e.groupID,r=e.userID,u=(e=e.role,"groupID:".concat(a," userID:").concat(r," role:").concat(e)),d=this._grpM.getLocalGroupProfile(a);if(d&&d.selfInfo.role!==A.GRP_MBR_ROLE_OWNER)return j({code:X.NOT_OWNER});var _=[A.GRP_MBR_ROLE_ADMIN,A.GRP_MBR_ROLE_MEMBER];if(Vt({groupID:a})&&_.push(A.GRP_MBR_ROLE_CUSTOM),_.indexOf(e)<0)return j({code:X.INVALID_MEMBER_ROLE});if(r===this._grpM.getMyUserID())return j({code:X.CANNOT_SET_SELF_MEMBER_ROLE});var y=new ce("setGroupMemberRole");return y.setMessage(u),D.l("".concat(n," ").concat(u)),this.modifyGroupMemberInfo({groupID:a,userID:r,role:e}).then(function(M){return y.end(),D.l("".concat(n," ok")),be({group:d,member:M})}).catch(function(M){return y.setError(M).end(),D.e("".concat(n," failed. error:"),M),j(M)})}},{key:"_filterProfanity",value:function(e,n){if(!(r=this._grpM.get(29)))return!0;var a=(r=r.filterText(n[e],"group_member_profile")).isAllowedToSend,r=r.modifiedText;return a===!0&&(n[e]=r,!0)}},{key:"setGroupMemberNameCard",value:function(e){var n=this,a="setGroupMemberNameCard",r="".concat(this._n,".").concat(a);if(e.nameCard&&this._filterProfanity("nameCard",e)===!1)return j({code:X.PROFANITY_FOUND});var u=e.groupID,d=(y=e.userID)===void 0?this._grpM.getMyUserID():y,_=e.nameCard,y="groupID:".concat(u," userID:").concat(d," nameCard:").concat(_);if(D.l("".concat(r," ").concat(y)),(e=this._grpM.getLocalGroupProfile(u))&&Un(e.type))return j({code:e=X.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(e,a)});var M=new ce(a);return M.setMessage(y),this.modifyGroupMemberInfo({groupID:u,userID:d,nameCard:_}).then(function(R){D.l("".concat(r," ok")),M.end();var L=n._grpM.getLocalGroupProfile(u);return d===n._grpM.getMyUserID()&&L&&L.setSelfNameCard(_),be({group:L,member:R})}).catch(function(R){return M.setError(R).end(),D.e("".concat(r," failed. error:"),R),j(R)})}},{key:"setGroupMemberCustomField",value:function(e){var n=this,a="setGroupMemberCustomField",r="".concat(this._n,".").concat(a),u=e.groupID,d=(d=e.userID)===void 0?this._grpM.getMyUserID():d,_=(e=e.memberCustomField,"groupID:".concat(u," userID:").concat(d," memberCustomField:").concat(JSON.stringify(e))),y=(D.l("".concat(r," ").concat(_)),this._grpM.getLocalGroupProfile(u));if(y&&Un(y.type))return j({code:y=X.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(y,a)});var M=new ce(a);return M.setMessage(_),this.modifyGroupMemberInfo({groupID:u,userID:d,memberCustomField:e}).then(function(R){return M.end(),D.l("".concat(r," ok")),be({group:n._grpM.getLocalGroupProfile(u),member:R})}).catch(function(R){return M.setError(R).end(),D.e("".concat(r," failed. error:"),R),j(R)})}},{key:"modifyGroupMemberInfo",value:function(e){var n=this,a=e.groupID,r=e.userID,u=void 0;return bt(a)&&(a=vn(u=a)),this._grpM.req({P:b.MODIFY_GRP_MBR_INFO,data:g(g({},e),{},{groupID:a,topicID:u})}).then(function(){if(n.hasLocalGroupMember(a,r))return d=n.getLocalGroupMemberInfo(a,r),q(e.muteTime)||d.updateMuteUntil(e.muteTime),q(e.role)||d.updateRole(e.role),q(e.nameCard)||d.updateNameCard(e.nameCard),q(e.memberCustomField)||d.updateMemberCustomField(e.memberCustomField),d;var d=n._grpM.getLocalGroupProfile(a);return d&&!Un(d.type)?n.getGroupMemberProfile({groupID:a,userIDList:[r]}).then(function(_){return te(_.data.memberList,1)[0]}):void 0})}},{key:"markGroupMemberList",value:function(e){var n="".concat(this._n,".").concat("markGroupMemberList"),a=e.groupID,r=e.markType,u=e.enableMark,d=(e=e.userIDList)===void 0?[]:e,_=(e="groupID:".concat(a," markType:").concat(r," enableMark:").concat(u," userIDList count:").concat(d.length),D.l("".concat(n," ").concat(e)),2),y=[],M=(u===!0&&(_=1),u=J(d),500<d.length&&(u=d.slice(0,500),D.w("".concat(n," ").concat(Ko(500)))),u.forEach(function(R){y.push({userID:R,markType:[r]})}),u=null,new ce("markGroupMemberList"));return M.setMessage(e),this._grpM.req({P:b.MARK_AV_MBR_INFO,data:{groupID:a,operationType:_,memberList:y}}).then(function(R){R=R.data.memberList;var L=[],F=[];return(R=R===void 0?[]:R).length===d.length?L.push.apply(L,J(d)):(R.forEach(function(x){L.push(x.userID)}),d.forEach(function(x){L.includes(x)||F.push(x)})),R="success count:".concat(L.length," fail count:").concat(F.length),M.setMessage(R).end(),D.l("".concat(n," ok. ").concat(R)),be({successUserIDList:L,failureUserIDList:F})}).catch(function(R){return M.setError(R).end(),D.e("".concat(n," failed. error:"),R),j(R)})}},{key:"_getGroupMemberProfileAdvance",value:function(e){return this._grpM.req({P:b.GET_GRP_MBR_PROFILE,data:g(g({},e),{},{memberInfoFilter:e.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(e,n){var a=this;return ke(n)&&n.length!==0?n.map(function(r){return a.hasLocalGroupMember(e,r.userID)?a.getLocalGroupMemberInfo(e,r.userID).updateMember(r):a.setLocalGroupMember(e,new td(r)),a.getLocalGroupMemberInfo(e,r.userID)}):[]}},{key:"deleteLocalGroupMembers",value:function(e,n){var a=this.groupMemberListMap.get(e);a&&n.forEach(function(r){a.delete(r)})}},{key:"getLocalGroupMemberInfo",value:function(e,n){return this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).get(n):null}},{key:"setLocalGroupMember",value:function(e,n){this.groupMemberListMap.has(e)?this.groupMemberListMap.get(e).set(n.userID,n):(n=new Map().set(n.userID,n),this.groupMemberListMap.set(e,n))}},{key:"getLocalGroupMemberList",value:function(e){return this.groupMemberListMap.get(e)}},{key:"hasLocalGroupMember",value:function(e,n){return this.groupMemberListMap.has(e)&&this.groupMemberListMap.get(e).has(n)}},{key:"hasLocalGroupMemberMap",value:function(e){return this.groupMemberListMap.has(e)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),Di),od=[17,18,20],id=(N(hs,[{key:"onNewGroupSystemNotice",value:function(e){var n=e.dataList,a=e.isSyncingEnded,r=(e=e.isInstantMessage,(D.d("".concat(this._n,".onReceiveSystemNotice count:").concat(n.length)),n=this._assembly({notifiesList:n,isInstantMessage:e})).eventDataList);n=n.result,0<r.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:r,isInstantMessage:e}),this._onReceivedGroupSystemNotice({result:n,isInstantMessage:e})),e?0<n.length&&this._grpM.emitOEvt(me.MESSAGE_RECEIVED,n):a===!0&&this._clearGroupSystemNotice()}},{key:"_assembly",value:function(e){var n=e.notifiesList,a=e.isInstantMessage,r=null,u=n.length,d=0,_=[],y={conversationID:A.CONV_SYSTEM,unreadCount:0,type:A.CONV_SYSTEM,subType:null,lastMessage:null};for(d=0;d<u;d++){var M=n[d],R=(L=M.groupProfile).communityType,L=(L=L.topicID)===void 0?void 0:L,F=(F=(x=M.elements).topicIDList)===void 0?void 0:F,x=x.operationType;if(!((R===void 0?0:R)!==2||Se(L)&&Se(F))){if(od.includes(x)){this._handleTopicSystemNotice(M);continue}Se(L)||(M.to=L)}M.elements.operationType!==15&&(M.currentUser=this._grpM.getMyUserID(),M.conversationType=A.CONV_SYSTEM,M.conversationID=A.CONV_SYSTEM,(r=new In(M)).setElement({type:A.MSG_GRP_SYS_NOTICE,content:g(g({},M.elements),{},{groupProfile:g({},M.groupProfile)})}),r.isSystemMessage=!0,(r.sequence===1&&r.random===1||r.sequence===2&&r.random===2)&&(r.sequence=mn(),r.random=mn(),r.generateMessageID(),D.l("".concat(this._n,"._assembly regenerate ID:").concat(r.ID))),this._grpM.get(11).pushIntoNoticeResult(_,r)&&(a?y.unreadCount++:r.setIsRead(!0),y.subType=r.conversationSubType))}return y.lastMessage=_[_.length-1],{eventDataList:0<_.length?[y]:[],result:_}}},{key:"_clearGroupSystemNotice",value:function(){var e=this;this._getPendencyList().then(function(n){n.forEach(function(r){e.pendencyMap.set("".concat(r.from,"_").concat(r.groupID,"_").concat(r.to),r)}),n=e._grpM.get(11).getLocalMessageList(A.CONV_SYSTEM);var a=[];n.forEach(function(r){var u=(_=r.payload).operatorID,d=_.operationType,_=_.groupProfile;d===1&&(d="".concat(u,"_").concat(_.groupID,"_").concat(_.to),(u=e.pendencyMap.get(d))&&ft(u.handled)&&u.handled!==0&&a.push(r))}),e.deleteGroupSystemNotice({messageList:a})})}},{key:"deleteGroupSystemNotice",value:function(e){var n=this,a="".concat(this._n,".deleteGroupSystemNotice");return ke(e.messageList)&&e.messageList.length!==0?(D.l("".concat(a," ")+e.messageList.map(function(r){return r.ID})),this._grpM.req({P:b.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:e.messageList.map(function(r){return{from:A.CONV_SYSTEM,messageSeq:r.clientSequence,messageRandom:r.random}})}}).then(function(){D.l("".concat(a," ok"));var r=n._grpM.get(11);return e.messageList.forEach(function(u){r.deleteLocalMessage(u)}),be()}).catch(function(r){return D.e("".concat(a," error:"),r),j(r)})):Ke()}},{key:"_getPendencyList",value:function(){var e=this,n=(r=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{}).type,a=r.startTime,r=r.limit;return this._grpM.req({P:b.GET_GRP_PENDENCY,data:{type:n===void 0?void 0:n,startTime:a===void 0?0:a,limit:r===void 0?20:r,handleAccount:this._grpM.getMyUserID()}}).then(function(u){var d=u.data.pendencyList;return u.data.nextStartTime!==0?e._getPendencyList({startTime:u.data.nextStartTime}).then(function(_){return[].concat(J(d),J(_))}):d})}},{key:"getGroupApplicationList",value:function(){var e=this;return this._getPendencyList().then(function(n){return e._getPendencyList({type:A.GRP_COMMUNITY}).then(function(a){return n.push.apply(n,J(a)),e._handlePendencyResult(n)}).catch(function(a){return e._handlePendencyResult(n)})})}},{key:"_handlePendencyResult",value:function(e){var n=this,a=[];return e.forEach(function(r){n.pendencyMap.set("".concat(r.from,"_").concat(r.groupID,"_").concat(r.to),r),r.handled===0&&a.push({applicant:r.from,applicantNick:r.fromUserNickName,groupName:r.groupName,groupID:r.groupID,authentication:r.authentication,messageKey:r.time,applicationType:r.applicationType,userID:r.userID,note:r.note})}),Ke({applicationList:a})}},{key:"_onReceivedGroupSystemNotice",value:function(e){var n=this,a=e.result;e.isInstantMessage&&a.forEach(function(r){switch(r.payload.operationType){case 1:case 3:case 6:case 11:case 12:case 15:break;case 2:n._onApplyJoinGroup(r);break;case 4:n._onMemberKicked(r);break;case 5:n._onGroupDismissed(r);break;case 7:n._onInviteGroup(r);break;case 8:n._onQuitGroup(r);break;case 9:n._onSetManager(r);break;case 10:n._onDeleteManager(r);break;case 20:n._onMessageRemindTypeSynced(r);break;case 21:n._grpM.onAVChatRoomMemberBanned(r)}})}},{key:"_onApplyJoinGroup",value:function(e){var n=this,a=(e=e.payload.groupProfile).groupID,r=(e=e.groupType,this._grpM.hasLocalGroup(a));D.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(a," groupType:").concat(e," hasGroup:").concat(r)),r||Un(e)||this._grpM.getGroupProfile({groupID:a}).then(function(u){(u=u.data.group)&&(n._grpM.updateGroupMap([u]),u=!u.isSupportTopic,n._grpM.emitGroupListUpdate(!0,u))})}},{key:"_onMemberKicked",value:function(e){e=e.payload.groupProfile.groupID,this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e)}},{key:"_onGroupDismissed",value:function(e){e=e.payload.groupProfile.groupID;var n=(this._grpM.hasLocalGroup(e)&&this._grpM.deleteLocalGroupAndConversation(e),this._grpM._AVChatRoomHandler);n&&n.checkJoinedAVChatRoomByID(e)&&n.reset(e)}},{key:"_onInviteGroup",value:function(e){var n=this,a=e.payload.groupProfile.groupID;e=this._grpM.hasLocalGroup(a),D.l("".concat(this._n,"._onInviteGroup groupID:").concat(a," hasGroup:").concat(e)),this._grpM.getGroupProfile({groupID:a}).then(function(){n._grpM.emitGroupListUpdate(),n._grpM.get(11).pullMsgOnInvite("".concat(A.CONV_GROUP).concat(a))})}},{key:"_onQuitGroup",value:function(e){var n=(e=e.payload.groupProfile).groupID,a=(e=e.groupType,this._grpM.hasLocalGroup(n));D.l("".concat(this._n,"._onQuitGroup groupID:").concat(n," groupType:").concat(e," hasGroup:").concat(a)),a&&this._grpM.deleteLocalGroupAndConversation(n)}},{key:"_onSetManager",value:function(e){var n=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,n))&&e.updateRole(A.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(e){var n=(e=e.payload.groupProfile).to;e=e.groupID,(e=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(e,n))&&e.updateRole(A.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(e){var n=e.payload.groupProfile.groupID;e=e.payload.messageRemindType,this._grpM.get(11).onGroupMsgRemindTypeUpdated({groupID:n,messageRemindType:e})}},{key:"_handleTopicSystemNotice",value:function(e){var n=(a=e.groupProfile).groupID,a=a.topicID,r=(e=e.elements).operationType,u=e.topicIDList,d=(e=e.messageRemindType,this._grpM.get(10));r===17?d.onTopicCreated({groupID:n,topicID:a}):r===18?d.onTopicDeleted({groupID:n,topicIDList:u}):r===20&&d.onMessageRemindTypeUpdated({groupID:n,topicID:a,messageRemindType:e})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),hs),ad=["relayFlag"],sd=(V(Yo,an),ca=ae(Yo),N(Yo,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("polling_interval"),n=this.getCloudConfig("polling_interval_plus"),a=this.getCloudConfig("polling_no_msg_count"),r=this.getCloudConfig("polling_simplified_msg"),u=this.getCloudConfig("paging_grp_count");D.l("".concat(this._n,"._onCloudConfig pollingInterval:").concat(e)+" pollingIntervalPlus:".concat(n," pollingNoMessageCount:").concat(a)+" pollingSimplifiedMessage:".concat(r," pagingGroupCount:").concat(u)),this._AVChatRoomHandler.setPollingInterval(e),this._AVChatRoomHandler.setPollingIntervalPlus(n),this._AVChatRoomHandler.setPollingNoMessageCount(a),this._AVChatRoomHandler.setPollingSimplifiedMessage(r),this._commonGroupHandler.setPagingGroupCount(u)}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(e),this._groupTipsHandler.onCheckTimer(e))}},{key:"guardForAVChatRoom",value:function(e){var n,a=this;return e.conversationType===A.CONV_GROUP?(n=bt(e.to)?vn(e.to):e.to,this.hasLocalGroup(n)?Ke():this.getGroupProfile({groupID:n}).then(function(r){return r=r.data.group.type,D.l("".concat(a._n,".guardForAVChatRoom. groupID:").concat(n," type:").concat(r)),r===A.GRP_AVCHATROOM?j(new xe({code:r=X.MSG_SEND_FAIL_NOT_IN_AV,message:a.getErrMsg(r,e.from,n),data:{message:e}})):Ke()})):Ke()}},{key:"checkJoinedAVChatRoomByID",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"onNewMessage",value:function(e){this._commonGroupHandler.onNewMessage(e)}},{key:"updateNextMessageSeq",value:function(e){var n,a=this;ke(e)&&(n=this.get(10),e.forEach(function(r){var u=r.conversationID.replace(A.CONV_GROUP,"");bt(u)&&n.updateUnreadCountAndLastMsg(u,r.lastMessage),a.groupMap.has(u)&&(a.groupMap.get(u).nextMessageSeq=r.lastMessage.sequence+1)}))}},{key:"onNewGroupTips",value:function(e){this._groupTipsHandler.onNewGroupTips(e)}},{key:"onMsgRevoked",value:function(e){this._commonGroupHandler.onMsgRevoked(e,!(1<arguments.length&&arguments[1]!==void 0)||arguments[1])}},{key:"onNewGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.onNewGroupSystemNotice(e)}},{key:"onMsgReadNotice",value:function(e){var n=this;e.dataList.forEach(function(a){var r;a=a.elements.groupMessageReadNotice,q(a)||(r=n.get(11),a.forEach(function(u){var d=u.groupID,_=(_=u.topicID)===void 0?void 0:_,y=(u=u.lastMessageSeq,D.l("".concat(n._n,".onMsgReadNotice groupID:").concat(d," lastMessageSeq:").concat(u)),d="".concat(A.CONV_GROUP).concat(d),!0);Se(_)||(d="".concat(A.CONV_GROUP).concat(_),y=!1),r.updateIsReadAfterReadReport({conversationID:d,lastMessageSeq:u}),r.updateUnreadCount(d,y),r.clearGroupAtInfoList(d,y)}))})}},{key:"onReadReceiptList",value:function(e){var n=this;D.l("".concat(this._n,".onReadReceiptList options:"),e),e.dataList.forEach(function(a){var r=a.groupProfile,u=(a=a.elements,r=r.groupID,n.get(11));a=a.readReceiptList,u.updateReadReceiptInfo({groupID:r,readReceiptList:a})})}},{key:"onMsgModified",value:function(e){D.l("".concat(this._n,".onMsgModified options:"),e);var n=this.get(11);e.dataList.forEach(function(a){n.onMessageModified(g(g({},a),{},{conversationType:A.CONV_GROUP,to:a.topicID||a.groupID}))})}},{key:"deleteGroupSystemNotice",value:function(e){this._groupSystemNoticeHandler.deleteGroupSystemNotice(e)}},{key:"initGroupMap",value:function(e){this.groupMap.set(e.groupID,new Po(e))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(e){this.groupMap.delete(e)}},{key:"updateGroupMap",value:function(e){var n,a=this,r=this.get(11);e.forEach(function(M){n=M.groupID,a.groupMap.has(n)?a.groupMap.get(n).updateGroup(M):(a.groupMap.set(n,new Po(M)),r.deleteGroupRoamingInfo(n))});var u,d=this.getMyUserID(),_=Ne(this.groupMap);try{for(_.s();!(u=_.n()).done;){var y=te(u.value,2)[1];y.selfInfo.userID=d,y.selfInfo.role==="Owner"&&(y.ownerID=d)}}catch(M){_.e(M)}finally{_.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return J(this.groupMap.values()).filter(function(e){return e.type!==A.GRP_ROOM&&e.type!==A.GRP_LIVE})}},{key:"getLocalGroupProfile",value:function(e){return this.groupMap.get(e)}},{key:"sortLocalGroupList",value:function(){var e=J(this.groupMap).filter(function(n){return(n=te(n,2))[0],!Se(n[1].lastMessage)});e.sort(function(n,a){return a[1].lastMessage.lastTime-n[1].lastMessage.lastTime}),this.groupMap=new Map(J(e))}},{key:"updateGroupLastMessage",value:function(e){this._commonGroupHandler.updateLastMsg(e)}},{key:"emitGroupListUpdate",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],a=this.getLocalGroupList();e&&this.emitOEvt(me.GROUP_LIST_UPDATED),n&&(e=JSON.parse(JSON.stringify(a)),this.get(11).updateConvGroupProfile(e))}},{key:"getMyNameCardByGroupID",value:function(e){return(e=this.getLocalGroupProfile(e))?e.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMsgRemindType",value:function(e){var n=this;return ke(e)&&e.length!==0?(e=e.filter(function(a){return!Un(n.getLocalGroupProfile(a).type)})).length===0?Promise.resolve():(D.l("".concat(this._n,".getMsgRemindType groupIDList:").concat(e)),this.getGroupProfileAdvance({groupIDList:e,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then(function(a){a=a.data.successGroupList;var r=n.get(11);a.forEach(function(u){r.onGroupMsgRemindTypeUpdated({groupID:u.groupID,messageRemindType:ke(u.members)?u.members[0].messageRemindType:""})})})):Promise.resolve()}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(e){var n=this,a="".concat(this._n,".").concat("getGroupProfile"),r=new ce("getGroupProfile"),u=e.groupID,d=e.groupCustomFieldFilter;return D.l("".concat(a," groupID:").concat(u)),d={groupIDList:[u],responseFilter:{groupBaseInfoFilter:J(Ue),groupCustomFieldFilter:d,memberInfoFilter:[].concat(J(At),["NameCard"])}},this.getGroupProfileAdvance(d).then(function(_){var y=(_=_.data).successGroupList;return _=_.failureGroupList,D.l("".concat(a," ok")),0<_.length?j(_[0]):((_=Un(y[0].type)&&!n.hasLocalGroup(u)?new Po(y[0]):(n.updateGroupMap(y),n.getLocalGroupProfile(u))).isSupportTopic||n.get(11).updateConvGroupProfile([_]),r.setMessage("groupID:".concat(u," type:").concat(_.type," muteAllMembers:").concat(_.muteAllMembers," ownerID:").concat(_.ownerID)).end(),be({group:_}))}).catch(function(_){return r.setError(_).setMessage("groupID:".concat(e.groupID)).end(),D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"getGroupProfileAdvance",value:function(e){var n,a="".concat(this._n,".getGroupProfileAdvance"),r=(ke(d=e.groupIDList)&&50<d.length&&(this.warn("GetGroupProfileLimit"),d.length=50),[]),u=[],d=(d.forEach(function(_){(Vt({groupID:_})?u:r).push(_)}),[]);return 0<r.length&&(n=this._getGroupProfileAdvance(g(g({},e),{},{groupIDList:r})),d.push(n)),0<u.length&&(n=this._getGroupProfileAdvance(g(g({},e),{},{groupIDList:u,relayFlag:0<r.length})),d.push(n)),Promise.all(d).then(function(_){var y=[],M=[];return _.forEach(function(R){y.push.apply(y,J(R.successGroupList)),M.push.apply(M,J(R.failureGroupList))}),be({successGroupList:y,failureGroupList:M})}).catch(function(_){return D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"_getGroupProfileAdvance",value:function(e){var n=this,a=e.relayFlag,r=a!==void 0&&a,u=oe(e,ad);return this.req({P:b.GET_GRP_PROFILE,data:u}).then(function(d){return D.l("".concat(n._n,"._getGroupProfileAdvance ok. options:"),u),{successGroupList:(d=d.data.groups).filter(function(_){return q(_.errorCode)||_.errorCode===0}),failureGroupList:d.filter(function(_){return _.errorCode&&_.errorCode!==0}).map(function(_){return new xe({code:_.errorCode,message:_.errorInfo,data:{groupID:_.groupID}})})}}).catch(function(d){return r&&Vt({groupID:e.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:j(d)})}},{key:"createGroup",value:function(e){var n=this,a=[A.GRP_PUBLIC,A.GRP_WORK,A.GRP_MEETING,A.GRP_AVCHATROOM,A.GRP_COMMUNITY],r="".concat(this._n,".").concat("createGroup"),u=e.type,d=e.groupID;if(e.name&&this._filterProfanity("name",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return j({code:X.PROFANITY_FOUND});if(!a.includes(u))return j({code:X.ILLEGAL_GRP_TYPE});if(!Vt({type:u})){if(!Se(d)&&Vt({groupID:d}))return j({code:X.ILLEGAL_GRP_ID});e.isSupportTopic=void 0}if(Un(u)&&!q(e.memberList)&&0<e.memberList.length&&(e.memberList=void 0),this._canIUseJoinOption(u)||q(e.joinOption)||(e.joinOption=void 0),Vt({type:u})){if(!Se(d)&&!Vt({groupID:d}))return j({code:X.ILLEGAL_GRP_ID});e.isSupportTopic=e.isSupportTopic===!0?1:0}var _=new ce("createGroup"),y=(D.l("".concat(r," options:"),e),null),M=[];return this.req({P:b.CREATE_GRP,data:g(g({},e),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then(function(R){var L=(R=R.data).groupID,F=(R=R.overLimitUserIDList)===void 0?[]:R;if(y=L,M=F,R="groupType:".concat(e.type," groupID:").concat(L," overLimitUserIDList:").concat(F),_.setMessage(R).end(),D.l("".concat(r," ok. ").concat(R)),e.type===A.GRP_AVCHATROOM)return n.getGroupProfile({groupID:L});if(e.type===A.GRP_COMMUNITY&&e.isSupportTopic===1)return n.getGroupProfile({groupID:L});Se(e.memberList)||Se(F)||(e.memberList=e.memberList.filter(function(he){return F.indexOf(he.userID)===-1})),n.updateGroupMap([g(g({},e),{},{groupID:L})]),R=n.get(2);var x="",K=0,le=(e.type===A.GRP_COMMUNITY?(x=n.isIntl()?"Create Community":"\u521B\u5EFA\u793E\u7FA4",K=1):x=n.isIntl()?"Create Group":"\u521B\u5EFA\u7FA4\u7EC4",n.get(4).getMyNick());return x=R.createCustomMessage({to:L,conversationType:A.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:x,cmd:K,opUser:le||n.getMyUserID(),version:4})}}),R.sendMessageInstance(x),n.emitGroupListUpdate(),n.getGroupProfile({groupID:L})}).then(function(R){var L=(F=(R=R.data.group).selfInfo).nameCard,F=F.joinTime;return R.updateSelfInfo({nameCard:L,joinTime:F,messageRemindType:A.MSG_REMIND_ACPT_AND_NOTE,role:A.GRP_MBR_ROLE_OWNER}),be({group:R,overLimitUserIDList:M})}).catch(function(R){var L;return _.setMessage("groupType:".concat(e.type)).setError(R).end(),R.code===10010||R.code===10007?(n._silentlyGetGroupProfile(R.code,y),n.updateGroupMap([g(g({},e),{},{groupID:y})]),(L=n.getLocalGroupProfile(y)).selfInfo.role=A.GRP_MBR_ROLE_OWNER,be({group:L,overLimitUserIDList:M})):(D.e("".concat(r," failed. error:"),R),j(R))})}},{key:"dismissGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("dismissGroup"),r="groupID:".concat(e),u=new ce("dismissGroup");return u.setMessage(r),D.l("".concat(a," ").concat(r)),this.req({P:b.DISMISS_GRP,data:{groupID:e}}).then(function(){return u.end(),D.l("".concat(a," ok")),n.deleteLocalGroupAndConversation(e),n.checkJoinedAVChatRoomByID(e)&&n._AVChatRoomHandler.reset(e),n._groupAttributesHandler.deleteLocalGroupAttributes(e),be({groupID:e})}).catch(function(d){return u.setError(d).end(),D.e("".concat(a," failed. error:"),d),j(d)})}},{key:"updateGroupProfile",value:function(e){var n,a=this,r="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(e.groupID)&&(n=this.getLocalGroupProfile(e.groupID).type,this._canIUseJoinOption(n)||q(e.joinOption)||(D.w("".concat(r," joinOption is unavailable for Work/Meeting/AVChatRoom")),e.joinOption=void 0)),q(e.muteAllMembers)||(e.muteAllMembers?e.muteAllMembers="On":e.muteAllMembers="Off"),e.name&&this._filterProfanity("name",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return j({code:X.PROFANITY_FOUND});var u=new ce("updateGroupProfile");return u.setMessage(JSON.stringify(e)),D.l("".concat(r," groupID:").concat(e.groupID)),this.req({P:b.UPDATE_GRP_PROFILE,data:e}).then(function(){return u.end(),D.l("".concat(r," ok")),a.hasLocalGroup(e.groupID)&&a.groupMap.get(e.groupID).updateGroup(e),be({group:a.groupMap.get(e.groupID)})}).catch(function(d){return u.setError(d).end(),D.l("".concat(r," failed. error:"),d),j(d)})}},{key:"_filterProfanity",value:function(e,n){if(!(r=this.get(29)))return!0;var a=(r=r.filterText(n[e],se)).isAllowedToSend,r=r.modifiedText;return a===!0&&(n[e]=r,!0)}},{key:"joinGroup",value:function(e){var n=this,a=e.groupID,r="".concat(this._n,".joinGroup");if(this.deleteUnjoinedAVChatRoom(a),this.hasLocalGroup(a)){if(!this.isLoggedIn())return Ke({status:A.JOIN_STATUS_ALREADY_IN_GROUP});var u=new ce("applyJoinGroup");return this.getGroupProfile({groupID:a}).then(function(){return u.setMessage("groupID:".concat(a," joinedStatus:").concat(A.JOIN_STATUS_ALREADY_IN_GROUP)).end(),Ke({status:A.JOIN_STATUS_ALREADY_IN_GROUP})}).catch(function(d){return u.setMessage("groupID:".concat(a," unjoined")).end(),D.w("".concat(r," ").concat(a," was unjoined, now join!")),n.groupMap.delete(a),n.applyJoinGroup(e)})}return D.l("".concat(r," groupID:").concat(a)),this.isLoggedIn()?this.applyJoinGroup(e):this._AVChatRoomHandler.joinWithoutAuth(e)}},{key:"applyJoinGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("applyJoinGroup"),r=e.groupID;if(!Se(e.applyMessage)&&this._filterProfanity("applyMessage",e)===!1)return j({code:X.PROFANITY_FOUND});var u=new ce("applyJoinGroup"),d=(e=g({},e),this.canIUse(Qe.AV_HISTORY_MSG));return d&&(e.historyMessageFlag=1),this.get(11).deleteTopicRoamingInfo(r),this.req({P:b.APPLY_JOIN_GRP,data:e}).then(function(_){var y=(_=_.data).joinedStatus,M=_.longPollingKey,R=_.startSeq,L=_.avChatRoomFlag,F=_.avChatRoomKey,x=_.messageList;switch(_="groupID:".concat(r," joinedStatus:").concat(y," longPollingKey:").concat(M," startSeq:").concat(R)+" avChatRoomFlag:".concat(L," canGetAVChatRoomHistoryMsg:").concat(d,",")+" historyMsgCount:".concat(Se(x)?0:x.length),u.setMessage(_).end(),D.l("".concat(a," ok. ").concat(_)),y){case Pa:return be({status:Pa});case pi:return n.getGroupProfile({groupID:r}).then(function(le){return le=le.data.group,n._handleJoinResult({group:le,avChatRoomFlag:L,longPollingKey:M,startSeq:R,avChatRoomKey:F,messageList:x})}).catch(function(le){var he;return le.code===10010||le.code===10007?(n._silentlyGetGroupProfile(le.code,r),he=new Po({groupID:r}),n.updateGroupMap([he]),n._handleJoinResult({group:he,avChatRoomFlag:L,longPollingKey:M,startSeq:R,avChatRoomKey:F,messageList:x})):(D.e("".concat(a," failed. error:"),le),j(le))});default:var K=new xe({code:X.JOIN_GRP_FAIL});return D.e("".concat(a," failed. error:"),K),j(K)}}).catch(function(_){return u.setMessage("groupID:".concat(r)).setError(_).end(),D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"_handleJoinResult",value:function(e){var n=this,a=e.group,r=e.avChatRoomFlag,u=e.longPollingKey,d=e.startSeq,_=e.avChatRoomKey,y=e.messageList,M=a.groupID;return r===1?(this.get(11).setCompleted("".concat(A.CONV_GROUP).concat(M)),this._groupAttributesHandler.initGroupAttributesCache({groupID:M,avChatRoomKey:_}),this._groupCountersHandler.initGroupCountersCache({groupID:M,avChatRoomKey:_}),(e=q(u)?this._AVChatRoomHandler.handleJoinResult({group:a}):this._AVChatRoomHandler.startRunLoop({group:a,longPollingKey:u,startSeq:d})).then(function(){n._onAVChatRoomHistoryMessage(y,M)}),e):(this.emitGroupListUpdate(!0,!1),be({status:pi,group:a}))}},{key:"quitGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("quitGroup"),r="groupID:".concat(e),u=(D.l("".concat(a," ").concat(r)),this.checkJoinedAVChatRoomByID(e));if(!u&&!this.hasLocalGroup(e))return j({code:X.MEMBER_NOT_IN_GRP});if(u&&!this.isLoggedIn())return D.l("".concat(a," anonymously ok. ").concat(r)),this.deleteLocalGroupAndConversation(e),this._AVChatRoomHandler.reset(e),Ke({groupID:e});var d=new ce("quitGroup");return d.setMessage(r),this.req({P:b.QUIT_GRP,data:{groupID:e}}).then(function(){return d.end(),D.l("".concat(a," ok")),n.deleteLocalGroupAndConversation(e),u&&n._AVChatRoomHandler.reset(e),n._groupAttributesHandler.deleteLocalGroupAttributes(e),be({groupID:e})}).catch(function(_){return d.setError(_).end(),D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"searchGroupByID",value:function(e){var n="".concat(this._n,".").concat("searchGroupByID"),a={groupIDList:[e]},r=new ce("searchGroupByID");return r.setMessage("groupID:".concat(e)),D.l("".concat(n," groupID:").concat(e)),this.req({P:b.SEARCH_GRP,data:a}).then(function(u){if((u=u.data.groupProfile)[0].errorCode!==0)throw new xe({code:u[0].errorCode,message:u[0].errorInfo});return r.end(),D.l("".concat(n," ok")),be({group:new Po(u[0])})}).catch(function(u){return r.setError(u).end(),D.w("".concat(n," failed. error:"),u),j(u)})}},{key:"changeGroupOwner",value:function(e){var n=this,a="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(e.groupID)&&this.getLocalGroupProfile(e.groupID).type===A.GRP_AVCHATROOM)return j({code:X.CANNOT_CHANGE_OWNER_IN_AV});if(e.newOwnerID===this.getMyUserID())return j({code:X.CANNOT_CHANGE_OWNER_TO_SELF});var r=new ce("changeGroupOwner");return r.setMessage("groupID:".concat(e.groupID," newOwnerID:").concat(e.newOwnerID)),D.l("".concat(a," groupID:").concat(e.groupID)),this.req({P:b.CHANGE_GRP_OWNER,data:e}).then(function(){r.end(),D.l("".concat(a," ok"));var u,d=e.groupID,_=e.newOwnerID,y=(n.groupMap.get(d).ownerID=_,n._groupMemberHandler.getLocalGroupMemberList(d));return y instanceof Map&&(u=y.get(n.getMyUserID()),q(u)||(u.updateRole("Member"),n.groupMap.get(d).selfInfo.role="Member"),u=y.get(_),q(u)||u.updateRole("Owner")),n.emitGroupListUpdate(!0,!1),be({group:n.groupMap.get(d)})}).catch(function(u){return r.setError(u).end(),D.e("".concat(a," failed. error:"),u),j(u)})}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(e){var n,a,r,u,d,_=this,y="".concat(this._n,".").concat("handleGroupApplication"),M=e.handleAction,R=e.handleMessage,L=e.message,F=e.application,x=(L?(n=L.payload.operatorID,a=L.payload.groupProfile.groupID,r=L.payload.authentication,u=L.payload.messageKey):F&&(n=F.applicant,a=F.groupID,r=F.authentication,u=F.messageKey),b.HANDLE_GRP_APPLICATION),K=(F&&F.applicationType===2&&(x=b.HANDLE_INVITE_JOIN_GRP,d=F.userID),new ce("handleGroupApplication"));return K.setMessage("groupID:".concat(a)),D.l("".concat(y," groupID:").concat(a)),this.req({P:x,data:{handleAction:M,handleMessage:R,applicant:n,invitee:d,groupID:a,authentication:r,messageKey:u}}).then(function(){return K.end(),D.l("".concat(y," ok")),L&&_._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),be({group:_.getLocalGroupProfile(a)})}).catch(function(le){return K.setError(le).end(),D.e("".concat(y," failed. error"),le),j(le)})}},{key:"handleGroupInvitation",value:function(e){var n=this,a="".concat(this._n,".").concat("handleGroupInvitation"),r=(_=e.message.payload).groupProfile.groupID,u=_.authentication,d=_.messageKey,_=_.operatorID,y=e.handleAction,M=new ce("handleGroupInvitation");return M.setMessage("groupID:".concat(r," inviter:").concat(_," handleAction:").concat(y)),D.l("".concat(a," groupID:").concat(r," inviter:").concat(_," handleAction:").concat(y)),this.req({P:b.HANDLE_GRP_INVITATION,data:g(g({},e),{},{inviter:_,groupID:r,authentication:u,messageKey:d})}).then(function(){return M.end(),D.l("".concat(a," ok")),n._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[e.message]}),be({group:n.getLocalGroupProfile(r)})}).catch(function(R){return M.setError(R).end(),D.e("".concat(a," failed. error"),R),j(R)})}},{key:"getGroupOnlineMemberCount",value:function(e){var n=this,a="".concat(this._n,".getGroupOnlineMemberCount"),r=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e),u=this.hasLocalGroup(e);if(D.l("".concat(a," groupID:").concat(e," isAVChatRoom:").concat(r," has:").concat(u)),r)return this._AVChatRoomHandler.getGroupOnlineMemberCount(e);if(!u)return Ke({memberCount:0});if(r=Date.now(),this._onlineMemberCountMap.has(e)){if(r-(u=this._onlineMemberCountMap.get(e)).lastReqTime<=6e4)return Ke({memberCount:u.memberCount});u.lastReqTime=r}return this.requestOnlineCount(e).then(function(d){return d=(d=d.data.memberCount)===void 0?0:d,n._onlineMemberCountMap.set(e,{lastReqTime:Date.now(),memberCount:d}),D.l("".concat(a," ok. groupID:").concat(e," memberCount:").concat(d)),Ke({memberCount:d})}).catch(function(d){return D.w("".concat(a," failed. error:"),d),Promise.reject(d)})}},{key:"requestOnlineCount",value:function(e){return this.req({P:b.GET_ONLINE_MBR_NUM,data:{groupID:e}})}},{key:"hasLocalGroup",value:function(e){return this.groupMap.has(e)}},{key:"deleteLocalGroupAndConversation",value:function(e){var n,a=this.checkJoinedAVChatRoomByID(e),r=(D.l("".concat(this._n,".deleteLocalGroupAndConversation groupID:").concat(e," isJoinedAVChatRoom:").concat(a)),this.get(11)),u="".concat(A.CONV_GROUP).concat(e);a&&(this.stopMessageLongPolling({groupID:e}),r.deleteLocalConv(u)),Vt({groupID:e})&&(n=this.getLocalGroupProfile(e))&&n.isSupportTopic===!0&&this.get(10).deleteTopicListInCommunity(e),r.clearUnreadCount(u),r.setCompleted(u),this._deleteLocalGroup(e),this._onlineMemberCountMap.delete(e),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(e){this.groupMap.delete(e),this._groupMemberHandler.deleteGroupMemberList(e)}},{key:"sendMessage",value:function(e,n){return ke(e._receiverList)&&0<e._receiverList.length&&!this.canIUse(Qe.MSG_TO_SPECIFIED_GRP_MBR)?this.noUse("Targeted Group Message"):(e=this.createGroupMessagePack(e,n),this.req(e))}},{key:"createGroupMessagePack",value:function(e,n){var a=null,r=(n&&n.offlinePushInfo&&(a=n.offlinePushInfo),""),u=(Ee(e.cloudCustomData)&&0<e.cloudCustomData.length&&(r=e.cloudCustomData),[]),d=void(ye(n)&&ye(n.messageControlInfo)&&(d=(y=n.messageControlInfo).excludedFromUnreadCount,_=y.excludedFromLastMessage,y=y.excludedFromContentModeration,d===!0&&u.push("NoUnread"),_===!0&&u.push("NoLastMsg"),y===!0&&u.push("NoMsgCheck"))),_=(ke(e._receiverList)&&0<e._receiverList.length&&(d=e._receiverList,50<e._receiverList.length&&(d=e._receiverList.slice(0,50),this.warn("ReceiverListLimit"))),this.isOnlineMessage(e,n)?1:0),y=JSON.parse(JSON.stringify(e.getElements())),M=(n=this.get(17).getFileDNList(),e.getGroupAtInfoList());return y={fromAccount:this.getMyUserID(),groupID:e.to,msgBody:ue(e.type,y,n),cloudCustomData:r,random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:e.type!==A.MSG_TEXT||Se(M)?void 0:M,onlineOnlyFlag:_,clientTime:e.clientTime,offlinePushInfo:ra(a),messageControlInfo:_==0?u:void 0,needReadReceipt:e.needReadReceipt!==!0||this.isMessageFromOrToAVChatroom(e.to)?0:1,receiverList:d,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0,cmConfigID:e._cmConfigID},bt(e.to)&&(y.groupID=vn(e.to),y.topicID=e.to),{P:b.SEND_GRP_MSG,data:y}}},{key:"revokeMessage",value:function(e){var n={groupID:e.to,msgSeqList:[{msgSeq:e.sequence}]};return bt(e.to)&&(n.groupID=vn(e.to),n.topicID=e.to),this.req({P:b.REVOKE_GRP_MSG,data:n})}},{key:"deleteMessage",value:function(e){var n=e.to;return e=e.keyList,D.l("".concat(this._n,".deleteMessage groupID:").concat(n," count:").concat(e.length)),e={groupID:n,deleter:this.getMyUserID(),keyList:e},bt(n)&&(e.groupID=vn(n),e.topicID=n),this.req({P:b.DEL_GRP_MSG,data:e})}},{key:"modifyRemoteMessage",value:function(e){var n=e.to,a=e.sequence,r=e.payload,u=e.type,d=(d=e.version)===void 0?0:d,_=e.cloudCustomData,y=(e=e._elements,n),M=void 0;return n=void(bt(n)&&(y=vn(n),M=n)),Qi(u)&&(1<e.length&&e.splice(0,1,{type:u,content:r}),n=e),this.req({P:b.MODIFY_GRP_MSG,data:{groupID:y,topicID:M,sequence:a,version:d,elements:n,cloudCustomData:_}})}},{key:"getRoamingMessage",value:function(e){var n=this,a="".concat(this._n,".").concat("getRoamingMessage"),r=e.conversationID,u=e.groupID,d=(e=e.sequence,new ce("getRoamingMessage")),_=0,y=void 0;return bt(u)&&(u=vn(y=u)),this._computeLastSequence({groupID:u,topicID:y,sequence:e}).then(function(M){return _=M,D.l("".concat(a," groupID:").concat(u," startSequence:").concat(_)),n.req({P:b.GET_GRP_ROAMING_MSG,data:{groupID:u,count:21,sequence:_,topicID:y}})}).then(function(M){var R=(F=M.data).messageList,L=F.complete,F=(F=F.invisibleSequenceList)===void 0?[]:F,x=(M=(M=M.data.nextSequence)===void 0?0:M,q(R)?D.l("".concat(a," ok. complete:").concat(L," nextSequence:").concat(M," but messageList is undefined!")):D.l("".concat(a," ok. complete:").concat(L," nextSequence:").concat(M," count:").concat(R.length)),d.setMessage("groupID:".concat(u," topicID:").concat(y," startSequence:").concat(_," complete:").concat(L," nextSequence:").concat(M)).end(),n.get(11)),K=[],le=[];return Se(R)||(K=x.onRoamingMessage(R,r,!0,le),x.updateIsRead(r),x.patchConvLastMessage(r)),(R=L===2||M<1)&&(x.setCompleted(r),M=""),D.l("".concat(a," isPullingCompleted:").concat(R," nextReqID:").concat(M," storedMsgCount:").concat(K.length)+" invisibleSeqCount:".concat(F.length)),{nextReqID:M+"",storedMessageList:K,assembledMessageList:le,isPullingCompleted:R}}).catch(function(M){return d.setError(M).setMessage("groupID:".concat(u," topicID:").concat(y," startSequence:").concat(_)).end(),D.w("".concat(a," failed. error:"),M),j(M)})}},{key:"_getGroupIDOfMessage",value:function(e){return e.conversationID.replace(A.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(e){var n="".concat(this._n,".").concat("getReadReceiptList"),a=this._getGroupIDOfMessage(e[0]),r=this.getMyUserID(),u=e.filter(function(_){return _.from===r&&_.needReadReceipt===!0}).map(function(_){return{sequence:_.sequence}});if(D.l("".concat(n," groupID:").concat(a," sequenceList:").concat(JSON.stringify(u))),u.length===0)return Ke({messageList:e});var d=new ce("getReadReceiptList");return d.setMessage("groupID:".concat(a)),this.req({P:b.GET_READ_RECEIPT,data:{groupID:a,sequenceList:u}}).then(function(_){return d.end(),D.l("".concat(n," ok")),ke(_=_.data.readReceiptList)&&_.forEach(function(y){e.forEach(function(M){y.code===0&&y.sequence===M.sequence&&(M.readReceiptInfo.readCount=y.readCount,M.readReceiptInfo.unreadCount=y.unreadCount)})}),be({messageList:e})}).catch(function(_){return d.setError(_).end(),D.w("".concat(n," failed. error:"),_),j(_)})}},{key:"sendReadReceipt",value:function(e){var n="".concat(this._n,".").concat("sendReadReceipt"),a=this._getGroupIDOfMessage(e[0]),r=new ce("sendReadReceipt"),u=(r.setMessage("groupID:".concat(a)),this.getMyUserID());return(e=e.filter(function(d){return d.from!==u&&d.needReadReceipt===!0}).map(function(d){return{sequence:d.sequence}})).length===0?j({code:X.READ_RECEIPT_MSG_LIST_EMPTY}):(D.l("".concat(n,". sequenceList:").concat(JSON.stringify(e))),this.req({P:b.SEND_READ_RECEIPT,data:{groupID:a,sequenceList:e}}).then(function(d){return r.end(),D.l("".concat(n," ok")),be()}).catch(function(d){return r.setError(d).end(),D.w("".concat(n," failed. error:"),d),j(d)}))}},{key:"getReadReceiptDetail",value:function(e){var n=this,a=e.message,r=e.filter,u=e.cursor,d=(e=e.count,this._getGroupIDOfMessage(a)),_=a.ID,y=(a=a.sequence,"".concat(this._n,".").concat("getReadReceiptDetail")),M=this._receiptDetailCompleteMap.get(_)||!1,R=r!==0&&r!==1?0:r,L=(r=Ee(u)?u:"",u=!ft(e)||e<=0||100<=e?100:e,e="groupID:".concat(d," sequence:").concat(a," cursor:").concat(r," filter:").concat(R," completeFlag:").concat(M),D.l("".concat(y," ").concat(e)),{cursor:"",isCompleted:!1,messageID:_,unreadUserIDList:[],readUserIDList:[]}),F=new ce("getReadReceiptDetail");return F.setMessage(e),this.req({P:b.GET_READ_RECEIPT_DETAIL,data:{groupID:d,sequence:a,flag:R,cursor:r,count:u}}).then(function(x){F.end();var K=(x=x.data).cursor,le=x.isCompleted,he=x.unreadUserIDList;return x=x.readUserIDList,L.cursor=K,le===1&&(L.isCompleted=!0,n._receiptDetailCompleteMap.set(_,!0)),R===0?L.readUserIDList=x.map(function(fe){return fe.userID}):R===1&&(L.unreadUserIDList=he.map(function(fe){return fe.userID})),D.l("".concat(y," ok")),be(L)}).catch(function(x){return F.setError(x).end(),D.w("".concat(y," failed. error:"),x),j(x)})}},{key:"getRoamingMessagesHopping",value:function(e){var n=this,a="".concat(this._n,".").concat("getRoamingMessagesHopping"),r=e.groupID,u=e.count,d=e.sequence,_=e.direction,y=void 0;return q(d)&&_===1?Ke({messageList:[],isCompleted:!0,nextMessageSeq:""}):(bt(r)&&(r=vn(y=r)),this._computeReqSeqHopping({groupID:r,topicID:y,sequence:d}).then(function(M){q(d)||_!==1||(M=d+u-1);var R="".concat(y?"topicID:".concat(y):"groupID:".concat(r)," sequence:").concat(d," reqSeq:").concat(M," direction:").concat(_),L=(D.l("".concat(a," ").concat(R)),new ce("getRoamingMessagesHopping"));return n.req({P:b.GET_GRP_ROAMING_MSG,data:{groupID:r,topicID:y,count:u,sequence:M}}).then(function(F){var x=(x=(F=F.data).messageList)===void 0?[]:x,K=F.complete,le=(le=F.nextSequence)===void 0?0:le,he=(F=(F=F.invisibleSequenceList)===void 0?[]:F,"complete:".concat(K," nextSequence:").concat(le," remoteMsgCount:").concat(x.length," invisibleSequenceList:").concat(F)),fe=(L.setMessage("".concat(R," ").concat(he)).end(),D.l("".concat(a," ok. ").concat(he)),he="".concat(A.CONV_GROUP).concat(e.groupID),n.get(11));return he=fe.onRoamingMessage(x,he,!1),x=n._computeResult({groupID:e.groupID,direction:_,sequence:d,remoteMessageList:x,processedMessageList:he,complete:K,nextSequence:le,invisibleSequenceList:F}),fe.storeHoppingMessageList(x.messageList),be(x)}).catch(function(F){return L.setError(F).setMessage("groupID:".concat(r," sequence:").concat(d," count:").concat(u)).end(),D.w("".concat(a," failed. error:"),F),j(F)})}))}},{key:"_computeReqSeqHopping",value:function(e){var n=this,a=e.groupID,r=(r=e.topicID)===void 0?void 0:r;return 0<(e=(e=e.sequence)===void 0?void 0:e)?Promise.resolve(e):q(r)?this.getGroupProfileAdvance({groupIDList:[a],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then(function(u){var d=0;return Se(u=u.data.successGroupList)||(d=u[0].nextMessageSeq-1),D.l("".concat(n._n,"._computeReqSeqHopping groupID:").concat(a," lastSequence:").concat(d," from remote")),d}).catch(function(u){return j(u)}):Promise.resolve(0)}},{key:"_computeResult",value:function(e){var n={messageList:[],isCompleted:!1,nextMessageSeq:""},a=e.groupID,r=e.direction,u=e.sequence,d=(d=e.remoteMessageList)===void 0?[]:d,_=(_=e.processedMessageList)===void 0?[]:_,y=e.complete,M=e.nextSequence;if(e=e.invisibleSequenceList,r===0)return n.nextMessageSeq=M,(y===2||M<1)&&(n.isCompleted=!0,n.nextMessageSeq=""),n.messageList=_,n;if(r===1){if(Se(d)){if(Se(e))return n.isCompleted=!0,n.nextMessageSeq="",n;n.nextMessageSeq=e[0]+1}else y=d[0].sequence,M=e[0]||0,n.nextMessageSeq=M<y?y+1:M+1;return _.forEach(function(R){R.sequence>=u&&n.messageList.push(R)}),(Vt({groupID:a})||bt(a))&&n.messageList.length===0&&d[0].sequence<u&&(n.isCompleted=!0,n.nextMessageSeq=""),n}}},{key:"setMessageRead",value:function(e){var n=this,a=e.conversationID,r=e.lastMessageSeq,u="".concat(this._n,".").concat("setMessageRead"),d=(e="convID:".concat(a," lastMessageSeq:").concat(r),D.l("".concat(u," ").concat(e)),ft(r)||this.warn("DoNotModifyLastSeq"),new ce("setMessageRead")),_=(d.setMessage(e),a.replace(A.CONV_GROUP,"")),y=void 0;return bt(_)&&(_=vn(y=_)),this.req({P:b.SET_GRP_MSG_READ,data:{groupID:_,topicID:y,messageReadSeq:r}}).then(function(){d.end(),D.l("".concat(u," ok"));var M,R=n.get(11),L=(R.updateIsReadAfterReadReport({conversationID:a,lastMessageSeq:r}),!0);return q(y)||(L=!1,(M=n.get(10).getLocalTopic(_,y))&&M.updateSelfInfo({readedSequence:r})),R.updateUnreadCount(a,L),be()}).catch(function(M){return d.setError(M).end(),D.l("".concat(u," failed. error:"),M),j(M)})}},{key:"_computeLastSequence",value:function(e){var n=e.groupID,a=(a=e.topicID)===void 0?void 0:a;return 0<(e=e.sequence)?Promise.resolve(e):q(a)?this.getGroupLastSequence(n):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(e){var n="".concat(this._n,".").concat("getGroupLastSequence"),a=new ce("getGroupLastSequence"),r=0,u="",d="groupID:".concat(e);if(this.hasLocalGroup(e)){var _=this.getLocalGroupProfile(e),y=_.lastMessage;if(0<y.lastSequence&&y.onlineOnlyFlag===!1)return r=y.lastSequence,u="".concat(d,", ").concat(r," from group.lastMessage.lastSequence"),D.l("".concat(n," ").concat(u)),a.setMessage(u).end(),Promise.resolve(r);if(1<_.nextMessageSeq)return r=_.nextMessageSeq-1,u="".concat(d,", ").concat(r," from group.nextMessageSeq"),D.l("".concat(n," ").concat(u)),a.setMessage(u).end(),Promise.resolve(r)}return(y=this.get(11).getLocalConversation("GROUP".concat(e)))&&y.lastMessage.lastSequence&&y.lastMessage.onlineOnlyFlag===!1?(r=y.lastMessage.lastSequence,u="".concat(d,", ").concat(r," from conversation.lastMessage.lastSequence"),D.l("".concat(n," ").concat(u)),a.setMessage(u).end(),Promise.resolve(r)):this.getGroupProfileAdvance({groupIDList:[e],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then(function(M){return Se(M=M.data.successGroupList)?D.w("".concat(n," ").concat(d,", empty successGroupList")):(r=M[0].nextMessageSeq-1,u="".concat(d,", ").concat(r," from remote"),D.l("".concat(n," ").concat(u))),a.setMessage(u).end(),r}).catch(function(M){return a.setError(M).setMessage(d).end(),D.w("".concat(n," failed. error:"),M),j(M)})}},{key:"isMessageFromOrToAVChatroom",value:function(e){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(e)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"getGroupRemoteLastSeq",value:function(e){return(e=this.getLocalGroupProfile(e))?e.nextMessageSeq-1:1}},{key:"isOnlineMessage",value:function(e,n){return!(!this._canIUseOnlineOnlyFlag(e)||!n||n.onlineUserOnly!==!0)}},{key:"_canIUseOnlineOnlyFlag",value:function(e){var n=this.getJoinedAVChatRoom();return!n||!n.includes(e.to)||e.conversationType!==A.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(e,n){var a;Se(e)||(D.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(n," count:").concat(e.length)),a=[],e.forEach(function(r){a.push(g(g({},r),{},{isHistoryMessage:1}))}),this.onAVChatRoomMessage(a,n))}},{key:"onAVChatRoomMessage",value:function(e){this._AVChatRoomHandler.onMessage(e,1<arguments.length&&arguments[1]!==void 0?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(e){this._AVChatRoomHandler.onAVChatRoomMemberBanned(e)}},{key:"setUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.set(e,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(e){this._unjoinedAVChatRoomList.has(e)&&this._unjoinedAVChatRoomList.delete(e)}},{key:"isUnjoinedAVChatRoom",value:function(e){return this._unjoinedAVChatRoomList.has(e)}},{key:"isGroupAttributesUpdatedNotice",value:function(e){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(e)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(e){return this._groupAttributesHandler.initGroupAttributes(e)}},{key:"setGroupAttributes",value:function(e){return this._groupAttributesHandler.setGroupAttributes(e)}},{key:"deleteGroupAttributes",value:function(e){return this._groupAttributesHandler.deleteGroupAttributes(e)}},{key:"getGroupAttributes",value:function(e){return this._groupAttributesHandler.getGroupAttributes(e)}},{key:"isMessageFromTopic",value:function(e,n){return e===2&&!Se(n)}},{key:"isMessageFromCommunityOfTopic",value:function(e,n){return e===2&&Se(n)}},{key:"getMessageExtensions",value:function(e,n){return D.l("".concat(this._n,".getMessageExtensions startSequence:").concat(n)),this.req({P:b.GET_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,startSequence:n}})}},{key:"modifyMsgExts",value:function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return D.l("".concat(this._n,".modifyMsgExts operateType:").concat(a)),this.req({P:b.MODIFY_GRP_MSG_EXT,data:{groupID:e.to,messageSequence:e.sequence,extensionList:n,operateType:a}})}},{key:"_genNotifyReqList",value:function(e){for(var n,a,r,u,d=[],_=0,y=e.length;_<y;_++)n=e[_],u=this.getLocalGroupProfile(n).type,a=this._getGroupLastRevokedTime(n),r=1e3*Vn(),u={notifyType:1,limit:20,type:Vt({type:u,groupID:n})?A.GRP_COMMUNITY:void 0,groupID:n,beginTime:a,endTime:r},d.push(u);return d}},{key:"getNotice",value:function(e){var n=this,a="".concat(this._n,".getNotice");e=e.filter(function(r){if(!n.hasLocalGroup(r))return!1;var u=(r=n.getLocalGroupProfile(r)).type;return r=r.isSupportTopic,!Un(u)&&!r}),e.length!==0&&(D.l("".concat(a," list:").concat(e)),this.req({P:b.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(e)}}).then(function(r){r=r.data.notifyRspList;var u,d,_=[];ke(r)&&(u={dataList:[]},d="".concat(a," ok."),r.forEach(function(y){var M=y.nextRevokedTime,R=y.groupID,L=y.notifyList;d+=" groupID:".concat(R," nextRevokedTime:").concat(M," count:").concat(L.length,`
`),u.dataList.push({elements:{revokedInfos:n._genRevokedInfos(y)}}),M!==0?(n._setGroupLastRevokedTime(R,M),_.push(R)):n._setGroupLastRevokedTime(R,1e3*Vn())}),D.l(d),n.onMsgRevoked(u,!1)),0<_.length&&n.getNotice(_)}).catch(function(r){D.e("".concat(a," failed. error:"),r)}))}},{key:"_genRevokedInfos",value:function(e){var n=e.notifyList,a=e.groupID,r=[];return ke(n)&&n.forEach(function(u){r.push({groupID:a,sequence:u.sequence,random:u.random,revokerInfo:g({},u.revokerInfo)})}),r}},{key:"_getGroupLastRevokedTime",value:function(e){return this.hasLocalGroup(e)?this.getLocalGroupProfile(e)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(e,n){this.hasLocalGroup(e)&&(this.getLocalGroupProfile(e)._lastRevokedTime=n)}},{key:"isGroupCountersNotice",value:function(e){return this._groupCountersHandler.isGroupCountersNotice(e)}},{key:"setGroupCounters",value:function(e){return this._groupCountersHandler.setGroupCounters(e)}},{key:"increaseGroupCounter",value:function(e){return this._groupCountersHandler.increaseGroupCounter(e)}},{key:"decreaseGroupCounter",value:function(e){return this._groupCountersHandler.decreaseGroupCounter(e)}},{key:"getGroupCounters",value:function(e){return this._groupCountersHandler.getGroupCounters(e)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(e){return this._groupMemberHandler.getGroupMemberList(e)}},{key:"getGroupMemberProfile",value:function(e){return this._groupMemberHandler.getGroupMemberProfile(e)}},{key:"addGroupMember",value:function(e){return this._groupMemberHandler.addGroupMember(e)}},{key:"deleteGroupMember",value:function(e){return this._groupMemberHandler.deleteGroupMember(e)}},{key:"setGroupMemberMuteTime",value:function(e){return this._groupMemberHandler.setGroupMemberMuteTime(e)}},{key:"setGroupMemberRole",value:function(e){return this._groupMemberHandler.setGroupMemberRole(e)}},{key:"setGroupMemberNameCard",value:function(e){return this._groupMemberHandler.setGroupMemberNameCard(e)}},{key:"setGroupMemberCustomField",value:function(e){return this._groupMemberHandler.setGroupMemberCustomField(e)}},{key:"markGroupMemberList",value:function(e){return this._groupMemberHandler.markGroupMemberList(e)}},{key:"modifyGroupMemberInfo",value:function(e){return this._groupMemberHandler.modifyGroupMemberInfo(e)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(e){if(!e)return-1;var n=this.getLocalGroupProfile(e);return n&&Un(n.type)?this._AVChatRoomHandler.getPollingTimerID(e):-1}},{key:"_canIUseJoinOption",value:function(e){return e===A.GRP_PUBLIC||Vt({type:e})}},{key:"_silentlyGetGroupProfile",value:function(e,n){var a=setTimeout(this.getGroupProfile.bind(this,{groupID:n}),3e3);this._timeoutIDs.push(a),D.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(e," groupID:").concat(n," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach(function(e){clearTimeout(e)}),this._timeoutIDs=[]}},{key:"startMessageLongPolling",value:function(e){var n=e.groupID,a=e.longPollingKey,r=(e=(e=e.longPollingSequence)===void 0?1:e,this.get(12).isUnlimitedAVChatRoom()),u=(this._AVChatRoomHandler.hasPollingInstance(n)&&this.stopMessageLongPolling({groupID:n}),this._AVChatRoomHandler.getJoinedLiveList());return!r&&0<u.length&&this.stopMessageLongPolling({groupID:u[0]}),r=new Po({groupID:n,type:A.GRP_LIVE}),D.l("".concat(this._n,".startMessageLongPolling groupID:").concat(n," longPollingKey:").concat(a," longPollingSequence:").concat(e)),this._AVChatRoomHandler.startRunLoop({group:r,longPollingKey:a,startSeq:e})}},{key:"stopMessageLongPolling",value:function(e){e=e.groupID;var n=this.get(11);return this._AVChatRoomHandler.reset(e),this._deleteLocalGroup(e),n.deleteLocalConv("".concat(A.CONV_GROUP).concat(e)),D.l("".concat(this._n,".stopMessageLongPolling ok, groupID:").concat(e)),Ke({groupID:e})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),Yo),qu=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],rd=(N(wc,[{key:"_initTopic",value:function(e){for(var n in e)qu.indexOf(n)<0||(n==="selfInfo"?this.updateSelfInfo(e[n]):this[n]=n==="muteAllMembers"?e[n]===1:e[n])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(e){this.nextMessageSeq=e}},{key:"updateLastMessage",value:function(e){this.lastMessage=Oc(e)}},{key:"updateGroupAtInfoList",value:function(e){this.groupAtInfoList=JSON.parse(JSON.stringify(e))}},{key:"updateTopic",value:function(e){q(e.selfInfo)||this.updateSelfInfo(e.selfInfo),q(e.muteAllMembers)||(this.muteAllMembers=e.muteAllMembers===1),Gn(this,e,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(e){return Gn(this.selfInfo,e,[],[""])===0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(e){return e.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(e){this.lastMessage.isRevoked=e}},{key:"setLastMessageRevoker",value:function(e){this.lastMessage.revoker=e}}]),wc),cd=(V(gs,an),Cr=ae(gs),N(gs,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("topic_cache_time"),n=this.getCloudConfig("topic_last_active_time");q(e)||(this.TOPIC_CACHE_TIME=Number(e)),q(n)||(this.TOPIC_LAST_ACTIVE_TIME=Number(n))}},{key:"onTopicCreated",value:function(e){var n=e.groupID;this.resetGetTopicTime(n),this.emitOEvt(me.TOPIC_CREATED,e)}},{key:"onTopicDeleted",value:function(e){var n=this,a=e.groupID,r=e.topicIDList;(r===void 0?[]:r).forEach(function(u){n._deleteLocalTopic(a,u)}),this.emitOEvt(me.TOPIC_DELETED,e)}},{key:"onTopicProfileUpdated",value:function(e){var n=e.groupID,a=e.topicID;(a=this.getLocalTopic(n,a))&&(a.updateTopic(e),this.emitOEvt(me.TOPIC_UPDATED,{groupID:n,topic:a}))}},{key:"onTopicLatestMsg",value:function(e){var n,a,r=(e=e||{}).topicLatestMessage;e=e.excludedUnreadSequenceList,Se(r)||(n=r.groupProfile.topicID,r.conversationType=A.CONV_GROUP,r.to=n,(a=new In(r)).setElement(r.elements),this.updateUnreadCountAndLastMsg(n,a,e))}},{key:"onMessageRemindTypeUpdated",value:function(e){var n,a=e.groupID,r=e.topicID,u=(e=e.messageRemindType,this.getLocalTopic(a,r));u&&((n=u.updateSelfInfo({messageRemindType:e}))&&this.emitOEvt(me.TOPIC_UPDATED,{groupID:a,topic:u}),D.l("".concat(this._n,".onMessageRemindTypeUpdated topicID:").concat(r," messageRemindType:").concat(e," isUpdated:").concat(n)))}},{key:"onAtInfoUpdated",value:function(e){var n=e.topicID,a=(e=e.groupAtInfoList,vn(n));(n=this.getLocalTopic(a,n))&&!q(e)&&(n.updateGroupAtInfoList(e),this.emitOEvt(me.TOPIC_UPDATED,{groupID:a,topic:n}))}},{key:"onUnreadCountUpdatedFromConv",value:function(e){var n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,a=vn(e);(e=this.getLocalTopic(a,e))&&e.unreadCount!==n&&(e.updateUnreadCount(n),n===0&&e.updateSelfInfo({readedSequence:e.lastMessage.lastSequence}),this.emitOEvt(me.TOPIC_UPDATED,{groupID:a,topic:e}))}},{key:"onMessageSent",value:function(e){var n,a,r=e.groupID,u=e.topicID;e=e.lastMessage,!(u=this.getLocalTopic(r,u))||(a=(n=(n=e.sequence)===void 0?0:n)+1)>u.nextMessageSeq&&(u.updateNextMessageSeq(a),u.updateLastMessage(e),u.updateSelfInfo({readedSequence:n}),u.updateUnreadCount(0),this.emitOEvt(me.TOPIC_UPDATED,{groupID:r,topic:u}))}},{key:"onMessageModified",value:function(e){var n,a=e.to,r=e.time,u=e.sequence,d=e.elements,_=e.cloudCustomData,y=e.messageVersion,M=vn(a),R=this.getLocalTopic(M,a);R&&(n=R.lastMessage,D.d("".concat(this._n,".onMessageModified topicID:").concat(a," lastMessage:"),JSON.stringify(n),"options:",JSON.stringify(e)),n&&(n.payload===null||n.lastTime===r&&n.lastSequence===u&&n.version!==y)&&(n.type=d[0].type,n.payload=d[0].content,n.messageForShow=un(n.type,n.payload,this.isIntl()),n.cloudCustomData=_,n.version=y,n.lastSequence=u,n.lastTime=r,this.emitOEvt(me.TOPIC_UPDATED,{groupID:M,topic:R})))}},{key:"onMessageRevoked",value:function(e){var n,a,r,u=this;e.length!==0&&(a=n=null,r=!1,e.forEach(function(d){var _=d.to;a=vn(_),(n=u.getLocalTopic(a,_))&&(n.reduceUnreadCount()&&(r=!0),n.isLastMessageRevoked(d)&&(n.setLastMessageRevoked(!0),n.setLastMessageRevoker(d.revoker),r=!0),(_=n.selfInfo.excludedUnreadSequenceList||[]).push(d.sequence),n.updateSelfInfo({excludedUnreadSequenceList:_}))}),r&&this.emitOEvt(me.TOPIC_UPDATED,{groupID:a,topic:n}))}},{key:"isLastMessageRevoked",value:function(e){var n=e.topicID,a=(e=e.sequence,vn(n));return a=this.getLocalTopic(a,n),n=!1,a?a.isLastMessageRevoked({sequence:e}):n}},{key:"updateUnreadCountAndLastMsg",value:function(e,n,a){var r,u=vn(e),d=this.getLocalTopic(u,e);d&&(r=d.selfInfo.excludedUnreadSequenceList||[],q(a)||(r=a),n._isExcludedFromUnreadCount&&r.push(n.sequence),d.updateSelfInfo({excludedUnreadSequenceList:r}),D.l("".concat(this._n,".updateUnreadCountAndLastMsg seq:").concat(n.sequence," lastSeq:").concat(d.lastMessage.lastSequence)),n.sequence>d.lastMessage.lastSequence&&(d.updateLastMessage(n),a=n.sequence+1,d.updateNextMessageSeq(a),r=this._computeUnreadCount(d),d.updateUnreadCount(r),(n=this.get(11).getLocalConversation("".concat(A.CONV_GROUP).concat(e)))&&n.updateUnreadCount({nextUnreadCount:r,isFromGetConversations:!0}),this.emitOEvt(me.TOPIC_UPDATED,{groupID:u,topic:d})))}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(e){var n=this,a="".concat(this._n,".").concat("createTopicInCommunity"),r=e.topicID;if(!q(r)&&!bt(r))return j({code:X.ILLEGAL_TOPIC_ID});if(e.topicName&&this._filterProfanity("topicName",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return j({code:X.PROFANITY_FOUND});var u=new ce("createTopicInCommunity");return this.req({P:b.CREATE_TOPIC,data:g({},e)}).then(function(d){return d=d.data.topicID,u.setMessage("topicID:".concat(d)).end(),D.l("".concat(a," ok. topicID:").concat(d)),n._updateTopicMap([g(g({},e),{},{topicID:d})]),be({topicID:d})}).catch(function(d){return u.setError(d).end(),D.e("".concat(a," failed. error:"),d),j(d)})}},{key:"deleteTopicFromCommunity",value:function(e){var n=this,a="".concat(this._n,".").concat("deleteTopicFromCommunity"),r=e.groupID,u=(e=(e=e.topicIDList)===void 0?[]:e,new ce("deleteTopicFromCommunity"));return u.setMessage("groupID:".concat(r," topicIDList:").concat(e)),this.req({P:b.DEL_TOPIC,data:{groupID:r,topicIDList:e}}).then(function(d){d=d.data.resultList;var _=[],y=[];return(d===void 0?[]:d).forEach(function(M){var R=M.topicID,L=M.errorCode;M=M.errorInfo,L===0?_.push({topicID:R}):y.push({topicID:R,code:L,message:M})}),d="success count:".concat(_.length,", fail count:").concat(y.length),u.setMoreMessage(d).end(),D.l("".concat(a," ok. ").concat(d)),_.forEach(function(M){n._deleteLocalTopic(r,M.topicID)}),be({successTopicList:_,failureTopicList:y})}).catch(function(d){return u.setError(d).end(),D.e("".concat(a," failed. error:"),d),j(d)})}},{key:"updateTopicProfile",value:function(e){var n=this,a="".concat(this._n,".").concat("updateTopicProfile");if(D.l("".concat(a," options:"),e),e.topicName&&this._filterProfanity("topicName",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.introduction&&this._filterProfanity("introduction",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.notification&&this._filterProfanity("notification",e)===!1)return j({code:X.PROFANITY_FOUND});var r=new ce("updateTopicProfile");return r.setMessage("groupID:".concat(e.groupID," topicID:").concat(e.topicID)),q(e.muteAllMembers)||(e.muteAllMembers=e.muteAllMembers===!0?"On":"Off"),this.req({P:b.UPDATE_TOPIC_PROFILE,data:g({},e)}).then(function(){return r.end(),D.l("".concat(a," ok")),n._updateTopicMap([e]),be({topic:n.getLocalTopic(e.groupID,e.topicID)})}).catch(function(u){return r.setError(u).end(),D.e("".concat(a," failed. error:"),u),j(u)})}},{key:"getTopicList",value:function(e){var n=this,a="".concat(this._n,".").concat("getTopicList"),r=e.groupID,u=(e=(e=e.topicIDList)===void 0?[]:e).length===0,d=new ce("getTopicList");if(d.setMessage("groupID:".concat(r)),this._getTopicTimeMap.has(r)){var _=(y=this._getTopicTimeMap.get(r)).isGetAll,y=y.time;if((_||!_&&!u)&&Date.now()-y<1e3*this.TOPIC_CACHE_TIME&&(_=this._getLocalTopicList(r,e),u||_.length===e.length))return d.setMoreMessage("from cache, topic count:".concat(_.length)).end(),D.l("".concat(a," groupID:").concat(r," from cache, topic count:").concat(_.length)),Ke({successTopicList:_,failureTopicList:[]})}return this.req({P:b.GET_TOPIC_LIST,data:{groupID:r,topicIDList:e}}).then(function(M){M=M.data.topicInfoList;var R=[],L=[],F=[];return(M===void 0?[]:M).forEach(function(x){var K=x.topic,le=x.selfInfo,he=x.errorCode,fe=(x=x.errorInfo,K.topicID);he===0?(R.push(g(g({},K),{},{selfInfo:le})),L.push(fe)):F.push({topicID:fe,code:he,message:x})}),n._updateTopicMap(R),n._handleTopicAtInfo(R),M="success count:".concat(L.length,", fail count:").concat(F.length),d.setMoreMessage(M).end(),D.l("".concat(a," groupID:").concat(r," from remote, ").concat(M)),M=[],Se(L)||(n._getTopicTimeMap.set(r,{time:Date.now(),isGetAll:u}),M=n._getLocalTopicList(r,L)),be({successTopicList:M,failureTopicList:F})}).catch(function(M){return d.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"hasLocalTopic",value:function(e,n){return!!this._topicMap.has(e)&&this._topicMap.get(e).has(n)}},{key:"getLocalTopic",value:function(e,n){var a=null;return this._topicMap.has(e)?this._topicMap.get(e).get(n):a}},{key:"_getLocalTopicList",value:function(e){var n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],a=[];return(e=this._topicMap.get(e))&&(a=J(e.values())),n.length===0?a:a.filter(function(r){return n.includes(r.topicID)})}},{key:"_deleteLocalTopic",value:function(e,n){this._topicMap.has(e)&&this._topicMap.get(e).has(n)&&(this._topicMap.get(e).delete(n),D.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(e," topicID:").concat(n)))}},{key:"_updateTopicMap",value:function(e){var n=this,a=[];e.forEach(function(r){var u=r.groupID,d=r.topicID,_=null;n._topicMap.has(u)||n._topicMap.set(u,new Map),n._topicMap.get(u).has(d)?(_=n._topicMap.get(u).get(d)).updateTopic(r):(n._getTopicLastMessage(r),_=new rd(r,n.isIntl()),n._topicMap.get(u).set(d,_)),r=n._computeUnreadCount(_),_.updateUnreadCount(r),a.push({conversationID:"".concat(A.CONV_GROUP).concat(d),type:A.CONV_TOPIC,unreadCount:r})}),0<a.length&&this.get(11).updateTopicConversation(a)}},{key:"resetGetTopicTime",value:function(e){var n=this;q(e)?J(this._getTopicTimeMap.keys()).forEach(function(a){n._getTopicTimeMap.set(a,0)}):this._getTopicTimeMap.set(e,0)}},{key:"getTopicListOnReconnected",value:function(){var e=this,n=J(this._topicMap.keys()),a=[],r=this.get(11);n.forEach(function(u){var d=[],_=e._getLocalTopicList(u);r.deleteTopicRoamingInfo(u),_.forEach(function(y){var M=(M=y.lastMessage.lastTime)===void 0?0:M;Date.now()-1e3*M<1e3*e.TOPIC_LAST_ACTIVE_TIME&&d.push(y.topicID)}),0<d.length&&a.push({groupID:u,topicIDList:d})}),D.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(a.length)),this._relayGetTopicList(a)}},{key:"_relayGetTopicList",value:function(e){var n,a,r,u=this;e.length!==0&&(a=5<(n=e.shift()).topicIDList.length?"topicIDList.length:".concat(n.topicIDList.length):"topicIDList:".concat(n.topicIDList),(r=new ce("relayGetTopicList")).setMessage(a),D.l("".concat(this._n,"._relayGetTopicList. ").concat(a)),this.getTopicList(n).then(function(){r.end(),u._relayGetTopicList(e)}).catch(function(d){r.setError(d).end(),u._relayGetTopicList(e)}))}},{key:"_handleTopicAtInfo",value:function(e){var n=this;e.length!==0&&e.forEach(function(a){var r=a.groupID,u=a.topicID,d=(a=a.groupAtInfoList,[]);q(a)||(a.forEach(function(_){d.push(g(g({},_),{},{groupID:r,topicID:u}))}),n.get(11).onNewGroupAtTips({dataList:d}))})}},{key:"_getTopicLastMessage",value:function(e){var n;q(e.lastMsg)||(n={time:e.lastMsg.time,sequence:e.lastMsg.sequence,from:e.lastMsg.from,payload:e.lastMsg.elements[0]?e.lastMsg.elements[0].content:null,type:e.lastMsg.elements[0]?e.lastMsg.elements[0].type:"",nick:e.lastMsg.nick,avatar:e.lastMsg.avatar,version:e.lastMsg.messageVersion,cloudCustomData:e.lastMsg.cloudCustomData,isRevoked:e.lastMsg.isPlaceMessage===2,revoker:Se(e.lastMsg.revokerInfo)?null:e.lastMsg.revokerInfo.revoker},e.lastMessage=n)}},{key:"deleteTopicListInCommunity",value:function(e){var n=this,a=this._getLocalTopicList(e),r=this.get(11);a.forEach(function(u){u=u.topicID,n._deleteLocalTopic(e,u),n._getTopicTimeMap.delete(e),r.deleteLocalConv("".concat(A.CONV_GROUP).concat(u))})}},{key:"_computeUnreadCount",value:function(e){var n,a=(u=e.selfInfo).excludedUnreadSequenceList,r=u.readedSequence,u=e.nextMessageSeq-e.selfInfo.readedSequence-1;return ke(a)&&(n=0,a.forEach(function(d){r<d&&d<=e.nextMessageSeq-1&&(n+=1)}),1<=n&&(u-=n)),u<0?0:u}},{key:"_filterProfanity",value:function(e,n){if(!(r=this.get(29)))return!0;var a=(r=r.filterText(n[e],se)).isAllowedToSend,r=r.modifiedText;return a===!0&&(n[e]=r,!0)}},{key:"getMessageExtensions",value:function(e,n){D.l("".concat(this._n,".getMessageExtensions startSequence:").concat(n));var a=vn(e.to);return this.req({P:b.GET_GRP_MSG_EXT,data:{groupID:a,topicID:e.to,messageSequence:e.sequence,startSequence:n}})}},{key:"modifyMsgExts",value:function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,r=(D.l("".concat(this._n,".modifyMsgExts operateType:").concat(a)),vn(e.to));return this.req({P:b.MODIFY_GRP_MSG_EXT,data:{groupID:r,topicID:e.to,messageSequence:e.sequence,extensionList:n,operateType:a}})}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),gs),ud=(N(Uc,[{key:"setExpirationTime",value:function(e){this.expirationTime=e}},{key:"getUserProfile",value:function(e){var n=this,a="".concat(this._n,".").concat("getUserProfile"),r=e.userIDList;e.fromAccount=this._userM.getMyAccount(),100<r.length&&(D.w("".concat(a," ").concat(Ko(100))),r.length=100);for(var u,d=[],_=[],y=0,M=r.length;y<M;y++)u=r[y],this._userM.isMyFriend(u)&&this._contains(u)?_.push(this._getProfileFromMap(u)):d.push(u);if(d.length===0)return Ke(_);e.toAccount=d;var R=e.bFromGetMyProfile||!1,L=[],F=(e.toAccount.forEach(function(x){L.push({toAccount:x,standardSequence:0,customSequence:0})}),e.userItem=L,new ce("getUserProfile"));return F.setMessage(5<r.length?"userIDList.length:".concat(r.length):"userIDList:".concat(r)),this._userM.req({P:b.GET_USER_PROFILE,data:e}).then(function(x){return F.end(),D.i("".concat(a," ok")),x=n._handleResponse(x).concat(_),be(R?x[0]:x)}).catch(function(x){return F.setError(x).end(),D.e("".concat(a," failed. error:"),x),j(x)})}},{key:"getMyProfile",value:function(){var e,n=this._userM.getMyAccount(),a="".concat(this._n,".getMyProfile");return D.l("".concat(a," myAccount:").concat(n)),this._fill(),this._contains(n)?(e=this._getProfileFromMap(n),D.d("".concat(a," from cache, myProfile:").concat(JSON.stringify(e))),Ke(e)):this.getUserProfile({fromAccount:n,userIDList:[n],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(e){var n=e.data.userProfileItem;if(!ke(n))return[];for(var a=[],r=(e=Date.now(),0),u=n.length;r<u;r++){var d=(_=n[r]).to,_=_.profileItem;d!=="@TLS#NOT_FOUND"&&d!==""&&(d=this._update(d,this._getLatestProfileFromResponse(d,_)).latestProfile,a.push(d))}return D.l("".concat(this._n,"._handleResponse cost:").concat(kn(e))),a}},{key:"_getLatestProfileFromResponse",value:function(e,n){var a={userID:e,profileCustomField:[]};if(!Se(n))for(var r=0,u=n.length;r<u;r++)if(-1<n[r].tag.indexOf("Tag_Profile_Custom"))a.profileCustomField.push({key:n[r].tag,value:n[r].value});else switch(n[r].tag){case Je.NICK:a.nick=n[r].value;break;case Je.GENDER:a.gender=n[r].value;break;case Je.BIRTHDAY:a.birthday=n[r].value;break;case Je.LOCATION:a.location=n[r].value;break;case Je.SELFSIGNATURE:a.selfSignature=n[r].value;break;case Je.ALLOWTYPE:a.allowType=n[r].value;break;case Je.LANGUAGE:a.language=n[r].value;break;case Je.AVATAR:a.avatar=n[r].value;break;case Je.MESSAGESETTINGS:a.messageSettings=n[r].value;break;case Je.ADMINFORBIDTYPE:a.adminForbidType=n[r].value;break;case Je.LEVEL:a.level=n[r].value;break;case Je.ROLE:a.role=n[r].value;break;default:D.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),n[r].tag,n[r].value)}return a}},{key:"updateMyProfile",value:function(e){var n=this,a="".concat(this._n,".").concat("updateMyProfile");if(e.nick&&this._userM.filterProfanity("nick",e)===!1)return j({code:X.PROFANITY_FOUND});if(e.selfSignature&&this._userM.filterProfanity("selfSignature",e)===!1)return j({code:X.PROFANITY_FOUND});var r=new ce("updateMyProfile"),u=(r.setMessage(JSON.stringify(e)),new ui().validate(e));if(!u.valid)return r.setCode(X.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(u.tips)).end(),D.e("".concat(a," info:").concat(u.tips)),j({code:X.UPDATE_PROFILE_INVALID_PARAM});var d,_=[];for(d in e)Object.prototype.hasOwnProperty.call(e,d)&&(d==="profileCustomField"?e.profileCustomField.forEach(function(M){_.push({tag:M.key,value:M.value})}):_.push({tag:Je[d.toUpperCase()],value:e[d]}));if(_.length===0)return u=new xe({code:X.UPDATE_PROFILE_NO_KEY}),r.setError(u).end(),D.e("".concat(a," failed. error:"),u),j(u);var y=this._userM.getMyAccount();return this._userM.req({P:b.UPDATE_MY_PROFILE,data:{fromAccount:y,profileItem:_}}).then(function(M){r.end(),D.i("".concat(a," ok"));var R=(L=n._update(y,e)).isProfileUpdated,L=L.latestProfile;return R===!0&&n._userM.emitOEvt(me.PROFILE_UPDATED,[L]),Ke(L)}).catch(function(M){return r.setError(M).end(),D.e("".concat(a," failed. error:"),M),j(M)})}},{key:"onProfileModified",value:function(e){var n=e.dataList;if(!Se(n)){var a=n.length;D.d("".concat(this._n,".onProfileModified count:").concat(a," dataList:"),e.dataList);for(var r=[],u=0;u<a;u++){var d=n[u].userID,_=(d=this._update(d,this._getLatestProfileFromResponse(d,n[u].profileList))).isProfileUpdated;d=d.latestProfile,_===!0&&r.push(d)}0<r.length&&(this._userM.emitIEvt(Kt.PROFILE_UPDATED,r),this._userM.emitOEvt(me.PROFILE_UPDATED,r))}}},{key:"_fill",value:function(){if(this.accountProfileMap.size===0){for(var e=this._getCachedProfiles(),n=Date.now(),a=0,r=e.length;a<r;a++)n-e[a].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(e[a].userID,e[a]);D.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(e,n){var a,r=!1,u=Date.now();return this._contains(e)?(a=this._getProfileFromMap(e),n.profileCustomField&&Ho(a.profileCustomField,n.profileCustomField)===!0&&(a.lastUpdatedTime=u,r=!0),0<Gn(a,n,["profileCustomField"])&&(a.lastUpdatedTime=u,r=!0)):(a=new ui(n),!this._userM.isMyFriend(e)&&e!==this._userM.getMyAccount()||(a.lastUpdatedTime=u,r=!0,this.accountProfileMap.set(e,a))),this._flush(e===this._userM.getMyAccount()),r===!0&&D.l("".concat(this._n,"._update account:").concat(e," isUpdated:").concat(r)),{isProfileUpdated:r,latestProfile:a}}},{key:"_flush",value:function(e){var n=J(this.accountProfileMap.values()),a=this._userM.getStorageModule();D.d("".concat(this._n,"._flush length:").concat(n.length," flushAtOnce:").concat(e)),a.setItem(this.TAG,n,e)}},{key:"_contains",value:function(e){return this.accountProfileMap.has(e)}},{key:"_getProfileFromMap",value:function(e){return this.accountProfileMap.get(e)}},{key:"_getCachedProfiles",value:function(){var e=this._userM.getStorageModule().getItem(this.TAG);return Se(e)?[]:e}},{key:"onConvProfileUpdated",value:function(e){for(var n,a,r=[],u=0,d=e.length;u<d;u++)a=(n=e[u]).userID,this._userM.isMyFriend(a)&&(this._contains(a)?0<Gn(this._getProfileFromMap(a),n)&&r.push(a):r.push(n.userID));r.length!==0&&(D.l("".concat(this._n,".onConvProfileUpdated toAccountList:").concat(r)),this.getUserProfile({userIDList:r}))}},{key:"getNickAndAvatarByUserID",value:function(e){return this._contains(e)?{nick:(e=this._getProfileFromMap(e)).nick,avatar:e.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(e){var n=this,a=J(new Set(e)),r=(D.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(e.length," uniqueUserIDList.length:").concat(a.length)),[]);if(e.length===0)return Promise.resolve(r);e=this._createUserIDListGroup(a);var u=[];return e.forEach(function(d){u.push(n.getUserProfile({userIDList:d}))}),Promise.all(u).then(function(d){return d.forEach(function(_){_=_.data.map(function(y){return{userID:y.userID,nick:y.nick,avatar:y.avatar}}),r.push.apply(r,J(_))}),r})}},{key:"_createUserIDListGroup",value:function(e){for(var n=[],a=0;a<e.length;)n.push(e.slice(a,a+=100));return n}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),Uc),Vu=N(function e(n){v(this,e)}),ld=(N(Gc,[{key:"getLocalBlacklist",value:function(){return J(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var e=this,n="".concat(this._n,".getBlacklist"),a={fromAccount:this._userM.getMyAccount(),maxLimited:100,startIndex:this._startIndex},r=new ce("getBlacklist");return this._userM.req({P:b.GET_BL,data:a}).then(function(u){var d=(u=u.data).blackListItem,_=(u=u.startIndex,Se(d)?0:d.length);r.setMessage("count:".concat(_)).end(),D.i("".concat(n," ok")),e._startIndex=u,e._handleResponse(d,!0),e._userM.emitOEvt(me.BLACKLIST_UPDATED,J(e._blacklistMap.keys())),e._startIndex!==0&&e.getBlacklist()}).catch(function(u){return r.setError(u).end(),D.e("".concat(n," failed. error:"),u),j(u)})}},{key:"addBlacklist",value:function(e){var n,a,r=this,u=new ce("addToBlacklist"),d="".concat(this._n,".addBlacklist"),_=this._userM.getMyAccount();return e.userIDList.length===1&&e.userIDList[0]===_?(a=this._userM.getErrMsg(n=X.CANNOT_ADD_SELF_TO_BLACKLIST),u.setCode(n).setMessage(a).end(),a=new xe({code:n}),D.e("".concat(d," failed. error:"),a),j(a)):(e.userIDList.includes(_)&&(e.userIDList=e.userIDList.filter(function(y){return y!==_})),e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:b.ADD_TO_BL,data:e}).then(function(y){return u.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),D.i("".concat(d," ok")),r._handleResponse(y.resultItem,!0),be(J(r._blacklistMap.keys()))}).catch(function(y){return u.setError(y).end(),D.e("".concat(d," failed. error:"),y),j(y)}))}},{key:"_handleResponse",value:function(e,n){if(!Se(e))for(var a,r,u,d=0,_=e.length;d<_;d++)r=e[d].to,u=e[d].resultCode,!q(u)&&u!==0||(n?((a=this._blacklistMap.has(r)?this._blacklistMap.get(r):new Vu).userID=r,Se(e[d].addBlackTimeStamp)||(a.timeStamp=e[d].addBlackTimeStamp),this._blacklistMap.set(r,a)):this._blacklistMap.has(r)&&(a=this._blacklistMap.get(r),this._blacklistMap.delete(r)));D.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(n))}},{key:"deleteBlacklist",value:function(e){var n=this,a="".concat(this._n,".deleteBlacklist"),r=new ce("removeFromBlacklist");return e.fromAccount=this._userM.getMyAccount(),e.toAccount=e.userIDList,this._userM.req({P:b.RM_FROM_BL,data:e}).then(function(u){return r.setMessage(5<e.userIDList.length?"userIDList.length:".concat(e.userIDList.length):"userIDList:".concat(e.userIDList)).end(),D.i("".concat(a," ok")),n._handleResponse(u.data.resultItem,!1),be(J(n._blacklistMap.keys()))}).catch(function(u){return r.setError(u).end(),D.e("".concat(a," failed. error:"),u),j(u)})}},{key:"onAccountDeleted",value:function(e){for(var n=0,a=e.length;n<a;n++){var r=e[n];this._blacklistMap.has(r)&&this._blacklistMap.delete(r)}var u=e.length;0<u&&(D.l("".concat(this._n,".onAccountDeleted count:").concat(u," ").concat(u<30?"userIDList:".concat(e):"")),this._userM.emitOEvt(me.BLACKLIST_UPDATED,J(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(e){for(var n,a=[],r=0,u=e.length;r<u;r++)n=e[r],this._blacklistMap.has(n)||(this._blacklistMap.set(n,new Vu({userID:n})),a.push(n));0<a.length&&(D.l("".concat(this._n,".onAccountAdded count:").concat(a.length," userIDList:"),a),this._userM.emitOEvt(me.BLACKLIST_UPDATED,J(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this._startIndex=0}}]),Gc),dd=(N(Pc,[{key:"_onCloudConfig",value:function(){var e=this._userM.getCloudConfig("status_query_count"),n=this._userM.getCloudConfig("status_sub_count"),a=this._userM.getCloudConfig("status_unsub_count");D.l("".concat(this._n,"._onCloudConfig statusQueryCount:").concat(e," statusSubscribeCount:").concat(n)+" statusUnsubscribeCount:".concat(a)),q(e)||(this.MAX_QUERY_USER_COUNT=parseInt(e,10)),q(e)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(n,10)),q(e)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(a,10))}},{key:"onUserStatusUpdated",value:function(e){e=e.dataList;var n=this._userM.getMyUserID(),a=this._userM.get(12);e=e.map(function(r){var u=r.to,d=r.statusType;return r=Mr(r=r.customStatus),u===n&&a.setCustomStatus(r),{userID:u,statusType:d,customStatus:r}}),D.l("".concat(this._n,".onUserStatusUpdated list:").concat(JSON.stringify(e))),this._userM.emitOEvt(me.USER_STATUS_UPDATED,e)}},{key:"setSelfStatus",value:function(e){var n=this,a="".concat(this._n,".setSelfStatus");if(this._userM.filterProfanity("customStatus",e)===!1)return j({code:X.PROFANITY_FOUND});var r=new ce("setSelfStatus"),u=e.customStatus;return this._userM.req({P:b.SET_SELF_STATUS,data:{customStatus:u}}).then(function(d){return r.setMessage("customStatus:".concat(u)).end(),D.l("".concat(a," ok. customStatus:").concat(u)),n._userM.get(12).setCustomStatus(u),be({userID:n._userM.getMyUserID(),statusType:1,customStatus:u})}).catch(function(d){return r.setError(d).end(),D.e("".concat(a," failed. error:"),d),j(d)})}},{key:"getUserStatus",value:function(e){var n="".concat(this._n,".").concat("getUserStatus"),a=(e=e.userIDList)===void 0?[]:e,r=(e=this._userM.getMyUserID(),J(a)),u=void 0,d=r.indexOf(e);if(-1<d&&(r.splice(d,1),u={userID:e,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),r.length===0)return Ke({successUserList:[u],failureUserList:[]});if(!this._userM.canIUse(Qe.USER_STATUS))return this._userM.noUse("getUserStatus");r.length>this.MAX_QUERY_USER_COUNT&&(D.w("".concat(n," ").concat(Ko(this.MAX_QUERY_USER_COUNT))),r=a.slice(0,this.MAX_QUERY_USER_COUNT));var _=new ce("getUserStatus");return this._userM.req({P:b.GET_USER_STATUS,data:{userIDList:r}}).then(function(y){var M=(M=(y=y.data).successUserList)===void 0?[]:M,R=(y=(y=y.failureUserList)===void 0?[]:y,M=M.map(function(L){return{userID:L.userID,statusType:L.statusType,customStatus:Mr(L=L.customStatus)}}),y=y.map(function(L){var F=L.userID,x=L.invalidUserID,K=L.errorCode;return L=L.errorInfo,{userID:Se(x)?F:x,code:K,message:L}}),q(u)||M.unshift(u),"userID count:".concat(a.length,", success count:").concat(M.length,", fail count:").concat(y.length));return _.setMessage("".concat(R)).end(),D.l("".concat(n," ok. ").concat(R,".")),be({successUserList:M,failureUserList:y})}).catch(function(y){return _.setMessage("userID count:".concat(a.length)).setError(y).end(),D.e("".concat(n," failed. error:"),y),j(y)})}},{key:"subscribeUserStatus",value:function(e){var n="subscribeUserStatus";if(!this._userM.canIUse(Qe.USER_STATUS))return this._userM.noUse(n);var a="".concat(this._n,".").concat(n),r=J(e=(e=e.userIDList)===void 0?[]:e),u=(r.length>this.MAX_SUBSCRIBE_USER_COUNT&&(D.w("".concat(a," ").concat(Ko(this.MAX_SUBSCRIBE_USER_COUNT))),r=e.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),new ce(n)),d="userID count:".concat(e.length);return D.l("".concat(a," ").concat(d)),this._userM.req({P:b.SUB_USER_STATUS,data:{userIDList:r}}).then(function(_){return _=((_=_.data.failureUserList)===void 0?[]:_).map(function(y){var M=y.userID,R=y.invalidUserID,L=y.errorCode;return y=y.errorInfo,{userID:Se(R)?M:R,code:L,message:y}}),u.setMessage("".concat(d," fail count:").concat(_.length)).end(),D.l("".concat(a," ok. fail count:").concat(_.length,".")),be({failureUserList:_})}).catch(function(_){return u.setMessage(d).setError(_).end(),D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"unsubscribeUserStatus",value:function(e){var n="unsubscribeUserStatus";if(!this._userM.canIUse(Qe.USER_STATUS))return this._userM.noUse(n);var a="".concat(this._n,".").concat(n),r=J(e=(e=(e||{}).userIDList)===void 0?[]:e),u=(e.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(D.w("".concat(a," ").concat(Ko(this.MAX_UNSUBSCRIBE_USER_COUNT))),r=e.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),new ce(n)),d="userID count:".concat(e.length);return D.l("".concat(a," ").concat(d)),n={userIDList:r},r.length===0&&(n.userIDList=void 0,n.unsubscribeAll=1),this._userM.req({P:b.UNSUB_USER_STATUS,data:n}).then(function(_){return _=((_=_.data.failureUserList)===void 0?[]:_).map(function(y){var M=y.userID,R=y.invalidUserID,L=y.errorCode;return y=y.errorInfo,{userID:Se(R)?M:R,code:L,message:y}}),u.setMessage("".concat(d," fail count:").concat(_.length)).end(),D.l("".concat(a," ok. fail count:").concat(_.length,".")),be({failureUserList:_})}).catch(function(_){return u.setMessage("".concat(d)).setError(_).end(),D.e("".concat(a," failed. error:"),_),j(_)})}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),Pc),pd=(V(ps,an),Pu=ae(ps),N(ps,[{key:"onContextUpdated",value:function(e){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(e,n){D.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(e," avatar:").concat(n)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:Je.NICK,value:e},{tag:Je.AVATAR,value:n}]}]})}},{key:"onProfileModified",value:function(e){this._profileHandler.onProfileModified(e)}},{key:"onRelationChainModified",value:function(e){var n,a;Se(e=e.dataList)||(n=[],e.forEach(function(r){r.blackListDelAccount&&n.push.apply(n,J(r.blackListDelAccount))}),0<n.length&&this._blacklistHandler.onAccountDeleted(n),a=[],e.forEach(function(r){r.blackListAddAccount&&a.push.apply(a,J(r.blackListAddAccount))}),0<a.length&&this._blacklistHandler.onAccountAdded(a))}},{key:"onConvProfileUpdated",value:function(e){this._profileHandler.onConvProfileUpdated(e)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(e,n){if(!(r=this.get(29)))return!0;var a=(r=r.filterText(n[e],"user_profile")).isAllowedToSend,r=r.modifiedText;return a===!0&&(n[e]=r,!0)}},{key:"isMyFriend",value:function(e){var n=this.get(8);return!!n&&n.isMyFriend(e)}},{key:"getUserProfile",value:function(e){return this._profileHandler.getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._profileHandler.updateMyProfile(e)}},{key:"getNickAndAvatarByUserID",value:function(e){return this._profileHandler.getNickAndAvatarByUserID(e)}},{key:"getUserNickAndAvatar",value:function(e){return this._profileHandler.getUserNickAndAvatar(e)}},{key:"getLocalBlacklist",value:function(){return Ke(this._blacklistHandler.getLocalBlacklist())}},{key:"addBlacklist",value:function(e){return this._blacklistHandler.addBlacklist(e)}},{key:"deleteBlacklist",value:function(e){return this._blacklistHandler.deleteBlacklist(e)}},{key:"onUserStatusUpdated",value:function(e){this._userStatusHandler.onUserStatusUpdated(e)}},{key:"setSelfStatus",value:function(e){return this._userStatusHandler.setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._userStatusHandler.getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._userStatusHandler.subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._userStatusHandler.unsubscribeUserStatus(e)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),ps),gd=(N(Dr,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isPartialUpdatedConvs",value:function(){return this._isPartialUpdatedConvs}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return(e=this._SDKAppID)===0||2e7<=e&&e<9e7||172e7<=e&&e<179e7;var e}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(e){this._isUsingChatCore=e}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(e){this._uiPlatform=e}},{key:"setUserID",value:function(e){this._userID=e}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(e){this._userSig=e}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(e){this._tinyID=e,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(e){this._customStatus=e}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return rc?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(e){this._statusInstanceID=e}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(e){this._a2Key=e}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(e){this._applicationID=e}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"setDowloadFileAuthKey",value:function(e){this._authKey=e}},{key:"getDowloadFileAuthKey",value:function(){return this._authKey}},{key:"setCustomLoginInfo",value:function(e){this._customLoginInfo=e}},{key:"getCustomLoginInfo",value:function(){return this._customLoginInfo}},{key:"_isTUIKit",value:function(){var e=!1,n=!1,a=!1,r=!1,u=[];qe&&(u=Object.keys(vt));for(var d=0,_=(u=mt?Object.keys(ba?uni:window):u).length;d<_;d++)if(u[d].toLowerCase().includes("uikit")){e=!0;break}u=null;var y,M=(qe&&!Ot(vt.createGamePortal)&&Ot(getApp)&&!q(getApp())&&ye(y=getApp().globalData)&&y.isTUIKit===!0&&(n=!0),this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))===!0&&(a=!0),null);if(wt&&!gt&&typeof uni=="undefined"&&__wxConfig&&(M=__wxConfig.pages),rn&&typeof uni=="undefined"&&__qqConfig&&(M=__qqConfig.pages),ke(M)&&0<M.length){for(var R=0,L=M.length;R<L;R++)if(M[R].toLowerCase().includes("tui")){r=!0;break}M=null}return e||n||a||r}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),Dr),hd={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12,"k-rn":13},_d=(V(ds,an),Yt=ae(ds),N(ds,[{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var e=void 0,n=this.get(36),a=this.get(28);return n.canIUseTIMPush()?e=n:a.canIUseOfflinePush()&&(e=a),e}},{key:"login",value:function(e){if(this.isLoggedIn())return n=this.getMyUserID(),(n=this.getErrMsg("RepeatLogin",n))&&D.w(n),Ke({actionStatus:"OK",errorCode:0,errorInfo:n,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.warn("LoggingIn",e.userID),j({code:X.REPEAT_LOGIN});if(D.l("".concat(this._n,".login userID:").concat(e.userID)),(n=this._checkLoginInfo(e)).code!==0)return j(n);var n=this.get(12),a=e.userID;return e=e.userSig,n.setUserID(a),n.setUserSig(e),this.get(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var e=this,n=this.get(12),a=n.getScene(),r=0,u=a,d=(a&&a.startsWith("k-")&&(u=hd[a],a="tuikit"),new ce("login")),_=(d.setMessage("".concat(u)).setMoreMessage("identifier:".concat(this.getMyUserID())),a==="tuikit"),y=0,M=(ba?y=_?u===3||u===4||u===5||u===6?31:u===9||u===10||u===11||u===12?32:4:3:qe?y=sn?36:a==="tuikit"?12:11:mt?y=rc?a==="flutter_web_uikit"?21:20:this._isReactUIKit()?cr?25:24:_?u===1||u===2?29:u===7||u===8?30:cr?17:14:cr?16:13:u===13&&(y=38),d.setUIPlatform(y),n.setUIPlatform(y),(_=this.getPushModule())&&(this._isWebUniapp=_.getUniAppPlatform(),u=this._getStatusInstanceID(),n.setStatusInstanceID(u),this.get(20).updateProtocolConfig(),r=_.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({P:b.LOGIN,data:{deviceBrand:r,isWebUniapp:this._isWebUniapp,customInfo:n.getCustomLoginInfo()}}).then(function(R){e._lastLoginTs=0;var L=Date.now(),F=null,x=(ie=R.data).a2Key,K=ie.tinyID,le=ie.helloInterval,he=ie.instanceID,fe=ie.timeStamp,Fe=(Fe=ie.customStatus)===void 0?"":Fe,Re=ie.purchaseBits,ie=(ie=ie.authKey)===void 0?"":ie,t=1e3*fe,o=L-d.getStartTs();if(o=t+parseInt(o/2)-L,L=d.getStartTs()+o,d.start(L),L=t,no=o,(t=new Date).setTime(L),D.i("baseTime from server:".concat(t," offset:").concat(no)),!K)throw F=new xe({code:X.NO_TINYID}),d.setError(F).end(),F;if(!x)throw F=new xe({code:X.NO_A2KEY}),d.setError(F).end(),F;return L=e.get(21).getSocketID(),t=Mr(Fe),F="socketID:".concat(L," scene:").concat(a," helloInterval:").concat(le," instanceID:").concat(he," timeStamp:").concat(fe)+" offset:".concat(o," customStatus:").concat(t," isWebUniapp:").concat(e._isWebUniapp),D.l("".concat(M," ok. ").concat(F)),Fe="",L="",wt&&Ot(vt.getAccountInfoSync)&&(fe=vt.getAccountInfoSync().miniProgram)&&(Fe=fe.appId,L=fe.envVersion),d.setMoreMessage("".concat(F," href:").concat(mt?window.location.href:""," mpAppId:").concat(Fe," envVersion:").concat(L," authKey:").concat(ie)).end(),n.setA2Key(x),n.setTinyID(K),n.setStatusInstanceID(he),n.setCustomStatus(t),n.setDowloadFileAuthKey(ie),Re&&e.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:Re}),e.get(20).updateProtocolConfig(),e.emitIEvt(Kt.A2KEY_AND_TINYID_UPDATED),e._helloInterval=le,e.triggerReady(),(o=e.getPushModule())&&(uni.setStorageSync("timUniAppInstanceID",he),o.init()),e._fetchCloudControlConfig(),e.get(29).init(),R}).catch(function(R){return d.setError(R).end(!0),e._m.setNotReadyReason(X.LOGIN_FAILED),D.e("".concat(M," failed. error:"),R),e._lastLoginTs=0,e._m.onLoginFailed(),j(R)})}},{key:"logout",value:function(){var e=this,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,a="".concat(this._n,".logout"),r=this.isLoggedIn();return D.i("".concat(a," type:").concat(n," isLoggedIn:").concat(r," isWebUniapp:").concat(this._isWebUniapp)),r?(new ce("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0),n===0&&this._m.setNotReadyReason(X.LOGGED_OUT),this.req({P:b.LOGOUT,data:{type:n,isWebUniapp:this._isWebUniapp}}).then(function(){return e.resetReady(),Ke({})}).catch(function(u){return D.e("".concat(a," error:"),u),e.resetReady(),Ke({})})):j({code:X.USER_NOT_LOGGED_IN})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")||0}},{key:"_hello",value:function(){var e=this;this._lastWsHelloTs=Date.now(),this.req({P:b.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch(function(n){D.w("".concat(e._n,"._hello error:"),n)})}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(e){var n=0;return Se(this.get(12).getSDKAppID())?n=X.NO_SDKAPPID:Se(e.userID)?n=X.NO_IDENTIFIER:Se(e.userSig)&&(n=X.NO_USERSIG),{code:n}}},{key:"_isReactUIKit",value:function(){return mt&&window.tencent_cloud_im_csig_react_uikit_23F_xa!==void 0}},{key:"onMultipleAccountKickedOut",value:function(e){var n=this;new ce("kickedOut").setMessage("type:".concat(A.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),D.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){n.emitOEvt(me.KICKED_OUT,{type:A.KICKED_OUT_MULT_ACCOUNT}),n._m.setNotReadyReason(X.KICKED_OUT_MULT_ACCOUNT),n._m.reset()})}},{key:"onMultipleDeviceKickedOut",value:function(e){var n=this;new ce("kickedOut").setMessage("type:".concat(A.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),D.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.logout(1).then(function(){n.emitOEvt(me.KICKED_OUT,{type:A.KICKED_OUT_MULT_DEVICE}),n._m.setNotReadyReason(X.KICKED_OUT_MULT_DEVICE),n._m.reset()})}},{key:"onUserSigExpired",value:function(){new ce("kickedOut").setMessage(A.KICKED_OUT_USERSIG_EXPIRED).end(!0),D.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),this.get(12).getStatusInstanceID()!==0&&(this.emitOEvt(me.KICKED_OUT,{type:A.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(X.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(e){new ce("kickedOut").setMessage("type:".concat(A.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(e))).end(!0),D.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),e),this.get(12).getStatusInstanceID()!==0&&(this.emitOEvt(me.KICKED_OUT,{type:A.KICKED_OUT_REST_API}),this._m.setNotReadyReason(X.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),ds);function ds(e){return v(this,ds),(e=Yt.call(this,e))._n="SignModule",e._helloInterval=120,e._lastLoginTs=0,e._lastWsHelloTs=0,e._isWebUniapp=0,rs.mixin(de(e)),e}function Dr(e,n){v(this,Dr),this._m=e,this._isLoggedIn=!1,this._SDKAppID=n.SDKAppID,this._userID=n.userID||"",this._userSig=n.userSig||"",this._version="3.4.8",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=n.unlimitedAVChatRoom,this._scene=n.scene||"",this._oversea=n.oversea,this._instanceID=n.instanceID,this._statusInstanceID=0,this._isDevMode=n.devMode,this._isTestEnv=n.testEnv,this._proxyServer=n.proxyServer,this._fileUploadProxy=n.fileUploadProxy,this._fileDownloadProxy=n.fileDownloadProxy,this._applicationID=0,this._isPartialUpdatedConvs=n.partialUpdatedConversations,this._isUsingChatCore=!1,this._uiPlatform=0,this._authKey="",this._customLoginInfo=""}function ps(e){return v(this,ps),(e=Pu.call(this,e))._n="UserModule",e._profileHandler=new ud(de(e)),e._blacklistHandler=new ld(de(e)),e._userStatusHandler=new dd(de(e)),e.getIEmitInst().on(Kt.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,de(e)),e}function Pc(e){v(this,Pc),this._userM=e,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getIEmitInst().on(Kt.CLOUD_CONFIG,this._onCloudConfig,this)}function Gc(e){v(this,Gc),this._userM=e,this._n="BlacklistHandler",this._blacklistMap=new Map,this._startIndex=0}function Uc(e){v(this,Uc),this._userM=e,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function gs(e){return v(this,gs),(e=Cr.call(this,e))._n="TopicModule",e._topicMap=new Map,e._getTopicTimeMap=new Map,e.TOPIC_CACHE_TIME=300,e.TOPIC_LAST_ACTIVE_TIME=3600,e.getIEmitInst().on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function wc(e,n){v(this,wc),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=Oc(e.lastMessage,n),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(e)}function Yo(e){return v(this,Yo),(e=ca.call(this,e))._n="GroupModule",e._commonGroupHandler=new Zl(de(e)),e._groupAttributesHandler=new Go(de(e)),e._groupCountersHandler=new ls(de(e)),e._AVChatRoomHandler=new ed(de(e)),e._groupTipsHandler=new bc(de(e)),e._groupSystemNoticeHandler=new id(de(e)),e._groupMemberHandler=new nd(de(e)),e.groupMap=new Map,e._unjoinedAVChatRoomList=new Map,e._receiptDetailCompleteMap=new Map,e._onlineMemberCountMap=new Map,e._timeoutIDs=[],e.getIEmitInst().on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function hs(e){v(this,hs),this._grpM=e,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function Di(e){v(this,Di),this._grpM=e,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getIEmitInst().on(Kt.PROFILE_UPDATED,this._onProfileUpdated,this)}function _s(e){v(this,_s),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(e)}function fs(e){v(this,fs),this._grpM=e,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this._seqSll=new Sr(200),this._IDSll=new Sr(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function ms(e){v(this,ms);var n=e.manager,a=e.groupID,r=e.onInit,u=e.onSuccess;e=e.onFail,this._n="Polling",this._manager=n,this._grpM=n._grpM,this._onInit=r,this._onSuccess=u,this._onFail=e,this._groupID=a,this._timeoutID=-1,this._isRunning=!1,this._proto=b.AV_POLLING}function Ei(e){v(this,Ei),this._grpM=e,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Kt.CLOUD_CONFIG,this._onCloudConfig,this)}function vs(e){v(this,vs),this._grpM=e,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Kt.CLOUD_CONFIG,this._onCloudConfig,this)}function Ri(e){v(this,Ri),this._grpM=e,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=No,this._pagingGetCostList=[],e.getIEmitInst().on(Kt.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function ys(e){v(this,ys),this._grpM=e,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function Li(e){return v(this,Li),(e=Tr.call(this,e))._n="ConvModule",rs.mixin(de(e)),e._msgListHandler=new Ac(de(e)),e._msgRemindHandler=new Xl(de(e)),e._convGroupHandler=new Ql(de(e)),e._sll=new Sr(100),e._pagingStatus=No,e._pagingTs=0,e._pagingStartIdx=0,e._pagingPinnedTs=0,e._pagingPinnedStartIdx=0,e._pagingConvIDMap=new Map,e._convIDFromUnreadDBMap=new Map,e._convMap=new Map,e._tmpGroupList=[],e._tmpGroupAtTipsList=[],e._peerReadTimeMap=new Map,e._completedMap=new Map,e._roamingMsgKeyAndTimeMap=new Map,e._remoteGroupReadSeqMap=new Map,e._convTotalUnreadCount=0,e._pagingGetCostList=[],e._convMapForDiff=new Map,e._partialUpdatedConvMap=new Map,e._everClearedMap=new Map,e._bPullOnInvite=!0,e._initListeners(),e}function Is(e){v(this,Is),this._convM=e,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=No}function Ms(e){v(this,Ms),this._convM=e,this._n="MsgRemindHandler"}function Cs(e,n){var a=2<arguments.length&&arguments[2]!==void 0&&arguments[2];v(this,Cs),this.conversationID=e.conversationID||"",this.unreadCount=e.unreadCount||0,this.type=e.type||"",this.lastMessage=cs(e.lastMessage,n,a),e.lastMsgTime&&(this.lastMessage.lastTime=e.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=e.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=e.isPinned||!1,this.messageRemindType=e.messageRemindType,this.markList=e.markList||[],this.customData=e.customData||"",this.conversationGroupList=e.conversationGroupList||[],this.draftText=e.draftText||"",this._initProfile(e),this.subType=this.groupProfile?this.groupProfile.type:""}function Ts(e){v(this,Ts),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(e)}function Ss(e){v(this,Ss),this.MAX_LENGTH=e,this.map=new Map}function Ds(e){var n=this;v(this,Ds),Se(e)||(this.userID=e.userID||"",this.nick=e.nick||"",this.gender=e.gender||"",this.birthday=e.birthday||0,this.location=e.location||"",this.selfSignature=e.selfSignature||"",this.allowType=e.allowType||A.ALLOW_TYPE_ALLOW_ANY,this.language=e.language||0,this.avatar=e.avatar||"",this.messageSettings=e.messageSettings||0,this.adminForbidType=e.adminForbidType||A.FORBID_TYPE_NONE,this.level=e.level||0,this.role=e.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Se(e.profileCustomField)||e.profileCustomField.forEach(function(a){n.profileCustomField.push({key:a.key,value:a.value})}))}function la(){return null}function da(e){var n=e.get(12);return{SDKType:10,SDKAppID:n.getSDKAppID(),SDKVersion:n.getVersion(),tinyID:Number(n.getTinyID()),userID:n.getUserID(),platform:e.getPlatform(),instanceID:n.getInstanceID(),traceID:Vn()}}N(Bc,[{key:"_errorTolerantHandle",value:function(){qe||typeof window!="undefined"&&this._canIUseCookies()||(this.getItem=la,this.setItem=la,this.removeItem=la,this.clear=la)}},{key:"onCheckTimer",value:function(e){e%20==0&&this._storageQueue.size!==0&&this._doFlush()}},{key:"_doFlush",value:function(){try{var e,n=Ne(this._storageQueue);try{for(n.s();!(e=n.n()).done;){var a=te(e.value,2),r=a[0],u=a[1];this._setStorageSync(this._getKey(r),u)}}catch(d){n.e(d)}finally{n.f()}this._storageQueue.clear()}catch(d){D.w("".concat(this._n,"._doFlush error:"),d)}}},{key:"_getPrefix",value:function(){var e=this._m.get(12);return"TIM_".concat(e.getSDKAppID(),"_").concat(e.getUserID(),"_")}},{key:"_getKey",value:function(e){return"".concat(this._getPrefix()).concat(e)}},{key:"getItem",value:function(e){var n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var a=n?this._getKey(e):e;return this.getStorageSync(a)}catch(r){return D.w("".concat(this._n,".getItem error:"),r),{}}}},{key:"setItem",value:function(e,n){var a;2<arguments.length&&arguments[2]!==void 0&&arguments[2]?(a=3<arguments.length&&arguments[3]!==void 0&&!arguments[3]?e:this._getKey(e),this._setStorageSync(a,n)):this._storageQueue.set(e,n)}},{key:"clear",value:function(){try{qe?vt.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(e){D.w("".concat(this._n,".clear error:"),e)}}},{key:"removeItem",value:function(e){var n=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var a=n?this._getKey(e):e;this._removeStorageSync(a)}catch(r){D.w("".concat(this._n,".removeItem error:"),r)}}},{key:"getSize",value:function(e){var n=this,a=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"b";try{var r={size:0,limitSize:5242880,unit:a};if(Object.defineProperty(r,"leftSize",{enumerable:!0,get:function(){return r.limitSize-r.size}}),qe&&(r.limitSize=1024*vt.getStorageInfoSync().limitSize),e)r.size=JSON.stringify(this.getItem(e)).length+this._getKey(e).length;else if(qe)vt.getStorageInfoSync().keys.forEach(function(d){r.size+=JSON.stringify(n.getStorageSync(d)).length+n._getKey(d).length});else if(this._canIUseCookies())for(var u in localStorage)localStorage.hasOwnProperty(u)&&(r.size+=localStorage.getItem(u).length+u.length);return this._convertUnit(r)}catch(d){D.w("".concat(this._n," error:"),d)}}},{key:"_convertUnit",value:function(e){var n,a={},r=e.unit;for(n in a.unit=r,e)typeof e[n]=="number"&&(r.toLowerCase()==="kb"?a[n]=Math.round(e[n]/1024):r.toLowerCase()==="mb"?a[n]=Math.round(e[n]/1024/1024):a[n]=e[n]);return a}},{key:"_setStorageSync",value:function(e,n){qe?Ft?my.setStorageSync({key:e,data:n}):vt.setStorageSync(e,n):this._canIUseCookies()&&localStorage.setItem(e,JSON.stringify(n))}},{key:"getStorageSync",value:function(e){return qe?Ft?my.getStorageSync({key:e}).data:vt.getStorageSync(e):this._canIUseCookies()?JSON.parse(localStorage.getItem(e)):{}}},{key:"_removeStorageSync",value:function(e){qe?Ft?my.removeStorageSync({key:e}):vt.removeStorageSync(e):this._canIUseCookies()&&localStorage.removeItem(e)}},{key:"_canIUseCookies",value:function(){return typeof window!="undefined"&&navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._doFlush()}}]);var Er,Fc=Bc,xc=(N(Vc,[{key:"pushIn",value:function(e){D.d("".concat(this._n,".pushIn"),this._report.length,e),this._report.push(e)}},{key:"backfill",value:function(e){var n;ke(e)&&e.length!==0&&(D.d("".concat(this._n,".backfill"),this._report.length,e.length),(n=this._report).unshift.apply(n,J(e)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return this._report.length===0}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var e=this._report.slice();return this._reset(),e}}]),Vc),qc=(V(pa,an),Er=ae(pa),N(pa,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var e=this,n=this.get(13),a=n.getItem(this.TAG,!1);!Se(a)&&Ot(a.forEach)&&(D.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(a.length)),a.forEach(function(r){e._reportBody.pushIn(r)}),n.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("evt_rpt_threshold"),n=this.getCloudConfig("evt_rpt_waiting"),a=this.getCloudConfig("evt_rpt_level"),r=this.getCloudConfig("evt_rpt_sdkappid_bl"),u=this.getCloudConfig("evt_rpt_tinyid_wl");q(e)||(this.MIN_THRESHOLD=Number(e)),q(n)||(this.WAITING_TIME=Number(n)),q(a)||(this.REPORT_LEVEL=a.split(",").map(function(d){return Number(d)})),q(r)||(this.REPORT_SDKAPPID_BLACKLIST=r.split(",").map(function(d){return Number(d)})),q(u)||(this.REPORT_TINYID_WHITELIST=u.split(","))}},{key:"pushIn",value:function(e){e instanceof ce&&(e.updateTimeStamp(),this._reportBody.pushIn(e),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(e){var n=this,a=(r=this.get(12)).getSDKAppID(),r=r.getTinyID();return uo(this.REPORT_SDKAPPID_BLACKLIST,a)&&!Mc(this.REPORT_TINYID_WHITELIST,r)?[]:e.filter(function(u){return n.REPORT_LEVEL.includes(u.level)})}},{key:"_report",value:function(){var e,n,a=this;this._reportBody.isEmpty()||(e=this._reportBody.getLogsInMemory(),(n=this._filterLogs(e)).length!==0?(n={header:da(this),event:n},this.req({P:b.SSO_STAT,data:g({},n)}).then(function(){a._lastReportTime=Date.now()}).catch(function(r){D.w("".concat(a._n,"._report failed. error:"),r),a._lastReportTime=Date.now(),a._reportBody.backfill(e),a._reportBody.getLogsNumInMemory()>a.MAX_THRESHOLD&&a._flushAtOnce()})):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var e=this.get(13),n=e.getItem(this.TAG,!1),a=this._reportBody.getLogsInMemory(),r="".concat(this._n,"._flushAtOnce");Se(n)?(D.l("".concat(r," count:").concat(a.length)),e.setItem(this.TAG,a,!0,!1)):((a=a.concat(n)).length>this.MAX_THRESHOLD&&(a=a.slice(0,this.MAX_THRESHOLD)),D.l("".concat(r," count:").concat(a.length)),e.setItem(this.TAG,a,!0,!1))}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),pa),Es="none",Rs="online",Rr=(N(Lr,[{key:"_startRN",value:function(){var e,n=this;!$t||(e=this._m.get(18).getPlugin("chat-network-monitor"))&&(this._removeListener=e.addEventListener(function(a){var r=a.isConnected;a=a.type,n._networkType!==a&&n._onNetworkStatusChange({isConnected:r!==void 0&&r,networkType:a})}))}},{key:"start",value:function(){var e=this,n="".concat(this._n,".start");qe?(vt.getNetworkType({success:function(a){e._networkType=a.networkType||a.subtype||"",a.networkType===Es?D.w("".concat(n," no network, please check!")):D.i("".concat(n," networkType:").concat(a.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),vt.onNetworkStatusChange(this._mpNetworkStatusCallback)):mt&&(this._networkType=Rs,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:Rs})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:Es})}},{key:"_onNetworkStatusChange",value:function(e){var n=e.isConnected,a=(e=e.networkType,"".concat(this._n,"._onNetworkStatusChange")),r=!1,u="previous:".concat(this._networkType," current:").concat(e);n?(D.i("".concat(a," ").concat(u)),this._networkType!==e&&(r=!0,this._networkType=e,this._m.get(21).reConnect(!0))):this._networkType!==e&&(r=!0,this._networkType=e,D.w("".concat(a," no network, please check!")),this._m.get(21).offline()),r&&new ce("networkChange").setMessage("isConnected:".concat(n," ").concat(u)).end()}},{key:"isOnline",value:function(){return this._networkType!==Es}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),qe?this._mpNetworkStatusCallback!==null&&(vt.offNetworkStatusChange&&vt.offNetworkStatusChange(this._mpNetworkStatusCallback),this._mpNetworkStatusCallback=null):mt?(this._webOnlineCallback!==null&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),this._onWebOffline!==null&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null)):$t&&this._removeListener&&(this._removeListener(),this._removeListener=null)}}]),Lr);function Lr(e){v(this,Lr),this._m=e,this._networkType=Rs,this._n="NetMonitorModule",this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null,this._removeListener=null,this._m.getIEmitInst().on(Kt.A2KEY_AND_TINYID_UPDATED,this._startRN,this)}function pa(e){v(this,pa),(e=Er.call(this,e))._n="EventStatModule",e.TAG="im-ssolog-event",e._reportBody=new xc,e.MIN_THRESHOLD=20,e.MAX_THRESHOLD=100,e.WAITING_TIME=6e4,e.REPORT_LEVEL=[4,5,6],e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._lastReportTime=Date.now();var n=e.getIEmitInst();return n.on(Kt.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,de(e)),n.on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function Vc(e){v(this,Vc),this._n="SSOLogBody",this._report=[]}function Bc(e){v(this,Bc),this._m=e,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}function Bu(e,n){return e(n={exports:{}},n.exports),n.exports}var kr,Ar=Bu(function(e){var n=Object.prototype.hasOwnProperty,a="~";function r(){}function u(M,R,L){this.fn=M,this.context=R,this.once=L||!1}function d(M,R,L,F,x){if(typeof L!="function")throw new TypeError("The listener must be a function");return L=new u(L,F||M,x),F=a?a+R:R,M._events[F]?M._events[F].fn?M._events[F]=[M._events[F],L]:M._events[F].push(L):(M._events[F]=L,M._eventsCount++),M}function _(M,R){--M._eventsCount==0?M._events=new r:delete M._events[R]}function y(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),new r().__proto__||(a=!1)),y.prototype.eventNames=function(){var M,R,L=[];if(this._eventsCount===0)return L;for(R in M=this._events)n.call(M,R)&&L.push(a?R.slice(1):R);return Object.getOwnPropertySymbols?L.concat(Object.getOwnPropertySymbols(M)):L},y.prototype.listeners=function(M){M=a?a+M:M;var R=this._events[M];if(!R)return[];if(R.fn)return[R.fn];for(var L=0,F=R.length,x=new Array(F);L<F;L++)x[L]=R[L].fn;return x},y.prototype.listenerCount=function(M){return M=a?a+M:M,(M=this._events[M])?M.fn?1:M.length:0},y.prototype.emit=function(M,R,L,F,x,K){var le=a?a+M:M;if(!this._events[le])return!1;var he,fe=this._events[le],Fe=arguments.length;if(fe.fn){switch(fe.once&&this.removeListener(M,fe.fn,void 0,!0),Fe){case 1:return fe.fn.call(fe.context),!0;case 2:return fe.fn.call(fe.context,R),!0;case 3:return fe.fn.call(fe.context,R,L),!0;case 4:return fe.fn.call(fe.context,R,L,F),!0;case 5:return fe.fn.call(fe.context,R,L,F,x),!0;case 6:return fe.fn.call(fe.context,R,L,F,x,K),!0}for(t=1,he=new Array(Fe-1);t<Fe;t++)he[t-1]=arguments[t];fe.fn.apply(fe.context,he)}else for(var Re,ie=fe.length,t=0;t<ie;t++)switch(fe[t].once&&this.removeListener(M,fe[t].fn,void 0,!0),Fe){case 1:fe[t].fn.call(fe[t].context);break;case 2:fe[t].fn.call(fe[t].context,R);break;case 3:fe[t].fn.call(fe[t].context,R,L);break;case 4:fe[t].fn.call(fe[t].context,R,L,F);break;default:if(!he)for(Re=1,he=new Array(Fe-1);Re<Fe;Re++)he[Re-1]=arguments[Re];fe[t].fn.apply(fe[t].context,he)}return!0},y.prototype.on=function(M,R,L){return d(this,M,R,L,!1)},y.prototype.once=function(M,R,L){return d(this,M,R,L,!0)},y.prototype.removeListener=function(M,R,L,F){if(M=a?a+M:M,!this._events[M])return this;if(!R)return _(this,M),this;var x=this._events[M];if(x.fn)x.fn!==R||F&&!x.once||L&&x.context!==L||_(this,M);else{for(var K=0,le=[],he=x.length;K<he;K++)(x[K].fn!==R||F&&!x[K].once||L&&x[K].context!==L)&&le.push(x[K]);le.length?this._events[M]=le.length===1?le[0]:le:_(this,M)}return this},y.prototype.removeAllListeners=function(M){return M?(M=a?a+M:M,this._events[M]&&_(this,M)):(this._events=new r,this._eventsCount=0),this},y.prototype.off=y.prototype.removeListener,y.prototype.addListener=y.prototype.on,y.prefixed=a,e.exports=y.EventEmitter=y}),fd=["rich.my-imcloud.com","imrich.qcloud.com"],Hc=["requestSnapshotUrl"],Ls=(V(ks,an),kr=ae(ks),N(ks,[{key:"_init",value:function(){this._fileDownloadProxy=this.getFileDownloadProxy(),this._authKey=this.getDowloadFileAuthKey();var e=this.get(18);this.TIMUploadPlugin=e.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=e.getPlugin(e=qe?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.warn("CosReplacement",e)):this.warn("PluginUndetected"))}},{key:"_onCloudConfig",value:function(){var e=this,n="".concat(this._n,"._onCloudConfig"),a=this.getCloudConfig("upload_size_limit"),r=this.getCloudConfig("simple_cos"),u=this.getCloudConfig("file_dn_list");if(D.l("".concat(n," uploadSizeLimit:").concat(a," simpleCos:").concat(r)),!q(a))try{var d=JSON.parse(a);this.UPLOAD_SIZE_LIMIT={A:d.a?1048576*parseInt(d.a):this.UPLOAD_SIZE_LIMIT.A,F:d.f?1048576*parseInt(d.f):this.UPLOAD_SIZE_LIMIT.F,I:d.i?1048576*parseInt(d.i):this.UPLOAD_SIZE_LIMIT.I,V:d.v?1048576*parseInt(d.v):this.UPLOAD_SIZE_LIMIT.V}}catch(_){}if(q(r)||(this.isSimpleCos=r==="1"),!q(u))try{JSON.parse(u).forEach(function(_){e._fileDNList.includes(_)||e._fileDNList.push(_)})}catch(_){}}},{key:"_getAuthorizationKey",value:function(){var e=this,n="".concat(this._n,".").concat("_getAuthorizationKey"),a=new ce("_getAuthorizationKey"),r=Math.ceil(Date.now()/1e3);this.req({P:b.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then(function(u){u=u.data;var d=(D.l("".concat(n," ok. data:"),u),u.expiredTime-r);a.setMessage("requestId:".concat(u.requestId," requestTime:").concat(r," expiredTime:").concat(u.expiredTime," diff:").concat(d,"s")).end(),!qe&&u.region&&(e.region=u.region),e.appid=u.appid,e.bucketName=u.bucketName,e.ciUrl=u.ciUrl,e.directory=u.directory,e.downloadUrl=u.downloadUrl,e.uploadUrl=u.uploadUrl,e.cosOptions={secretId:u.secretId,secretKey:u.secretKey,sessionToken:u.sessionToken,expiredTime:u.expiredTime},D.l("".concat(n," ok. region:").concat(e.region," bucketName:").concat(e.bucketName)),e._initUploaderMethod()}).catch(function(u){a.setError(u).end(),D.w("".concat(n," failed. error:"),u)})}},{key:"_getCosPreSigUrl",value:function(e){var n=this,a="".concat(this._n,".").concat("_getCosPreSigUrl"),r=Math.ceil(Date.now()/1e3),u=new ce("_getCosPreSigUrl"),d={uploadMethod:e.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:e.userID,conversationType:e.conversationType,uploadConfig:[{fileID:1,fileType:e.fileType,fileName:e.fileName}]},_=b.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(d={fileType:e.fileType,fileName:e.fileName,uploadMethod:e.uploadMethod,duration:e.duration},_=b.COS_PRE_SIG),this.req({P:_,data:d}).then(function(y){n.tryCount=0,y=y.data||{};var M,R,L=(D.l("".concat(a," ok. isSimpleCos:").concat(n.isSimpleCos," data:"),y),"");return L=n.isSimpleCos?(M=(R=y.preSig[0]).uploadUrl,R=R.fileKey,"uploadIP:".concat(y.uploadIP," uploadUrl:").concat(M," fileKey:").concat(R," cost:").concat(kn(r))):"requestId:".concat(y.requestId," expiredTime:").concat(y.expiredTime," diff:").concat(y.expiredTime-r,"s"),u.setMessage(L).end(),y}).catch(function(y){return y.code===-1&&(y.code=X.COS_GET_SIG_FAIL),u.setError(y).end(),D.w("".concat(a," failed. error:"),y),n.tryCount<1?(n.tryCount++,n._getCosPreSigUrl(e)):(n.tryCount=0,j({code:X.COS_GET_SIG_FAIL}))})}},{key:"_initUploaderMethod",value:function(){var e=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(n,a){e.timUploadPlugin.uploadFile(n,a)});this.appid&&(this.cos=qe?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=qe?function(n,a){e.cos.postObject(n,a)}:function(n,a){e.cos.uploadFiles(n,a)})}},{key:"onCheckTimer",value:function(e){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&e%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"getFileDNList",value:function(){return this._fileDNList}},{key:"_getAuthorization",value:function(e,n){n({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(e){if(e._relayFlag===!0)return Promise.resolve();var n=this.get(26);switch(e.type){case A.MSG_IMAGE:return n.addTotalCount(P),this._uploadImage(e);case A.MSG_FILE:return n.addTotalCount(P),this._uploadFile(e);case A.MSG_AUDIO:return n.addTotalCount(P),this._uploadAudio(e);case A.MSG_VIDEO:return n.addTotalCount(P),this._uploadVideo(e);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(e){var n=this,a=this.get(2),r=e.getElements()[0],u=a.getMessageOption(e.clientSequence);return this.doUploadImage({file:u.payload.file,to:u.to,message:e,onProgress:function(d){if(r.updatePercent(d),Ot(u.onProgress))try{u.onProgress(d)}catch(_){return j({code:X.MSG_ONPROGRESS_ERR})}}}).then(function(d){var _=d.location,y=d.fileType,M=d.fileSize,R=d.width,L=d.height,F=d.smallImageUrl,x=d.smallImageWidth,K=d.smallImageHeight,le=d.largeImageUrl,he=d.largeImageWidth,fe=d.largeImageHeight,Fe=d.imageInfoArray;d=n.isPrivateNetWork()?_:Vo(_),r.updateImageFormat(y);var Re,ie,t={size:M,url:d,width:R,height:L};if(Fe&&0<Fe.length)for(var o=0;o<Fe.length;o++){var i=Fe[o];i.type===1?Re=i:i.type===2?ie=i:t=g(g({},t),i)}else ie=F&&le?(Re={url:F,width:x,height:K},{url:le,width:he,height:fe}):(Re=dr({originUrl:d,originWidth:R,originHeight:L,min:198}),dr({originUrl:d,originWidth:R,originHeight:L,min:720}));return r.updateImageInfoArray([g({},t),g({},ie),g({},Re)]),e})}},{key:"_uploadFile",value:function(e){var n=this,a=this.get(2),r=e.getElements()[0],u=a.getMessageOption(e.clientSequence);return this.doUploadFile({file:u.payload.file,to:u.to,message:e,onProgress:function(d){if(r.updatePercent(d),Ot(u.onProgress))try{u.onProgress(d)}catch(_){return j({code:X.MSG_ONPROGRESS_ERR})}}}).then(function(d){var _=d=d.location;return n.isPrivateNetWork()||(_=Qn(_=Vo(d),n._fileDownloadProxy,n._authKey,n._fileDNList)),r.updateFileUrl(_),e})}},{key:"_uploadAudio",value:function(e){var n=this,a=this.get(2),r=e.getElements()[0],u=a.getMessageOption(e.clientSequence);return this.doUploadAudio({file:u.payload.file,to:u.to,message:e,onProgress:function(d){if(r.updatePercent(d),Ot(u.onProgress))try{u.onProgress(d)}catch(_){return j({code:X.MSG_ONPROGRESS_ERR})}}}).then(function(d){return d=d.location,d=n.isPrivateNetWork()?d:Vo(d),r.updateAudioUrl(d),e})}},{key:"_uploadVideo",value:function(e){var n=this,a=this.get(2),r=e.getElements()[0],u=a.getMessageOption(e.clientSequence);return this.doUploadVideo({file:u.payload.file,to:u.to,message:e,onProgress:function(d){if(r.updatePercent(d),Ot(u.onProgress))try{u.onProgress(d)}catch(_){return j({code:X.MSG_ONPROGRESS_ERR})}}}).then(function(d){var _=d.location;return d=d.snapshotInfo,_=n.isPrivateNetWork()?_:Vo(_),r.updateVideoUrl(_),Se(d)||r.updateSnapshotInfo(d),e})}},{key:"_checkSizeError",value:function(e){var n="";return e==="A"?n="audio":e==="I"?n="image":e==="V"?n="video":e==="F"&&(n="file"),j({code:X["MSG_".concat(e,"_SIZE_LIMIT")],message:this.getErrMsg("UploadSizeLimit",n,"".concat(this.UPLOAD_SIZE_LIMIT[e]/1048576,"MB"))})}},{key:"doUploadImage",value:function(e){var n=this;if(!e.file||this._isEmptyFileList(e.file.files))return j({code:X.MSG_I_SELECT_F_FIRST});var a=this._checkImageType(e.file);if(a!==!0||(a=this._checkImageSize(e.file))!==!0)return a;var r=null;return this._setUploadFileType(1),this.uploadByCOS(e).then(function(u){if(r=u,n.isPrivateNetWork())return _i(_);if(ke(r.imageInfoArray)){var d=r.imageInfoArray.find(function(y){return y.type===3});if(d)return d}if($t)return{width:e.file.width,height:e.file.height};var _=Vo(u.location);return n.COSSDK?_i(_):_i(_=Qn(_,n._fileDownloadProxy,n._authKey,n._fileDNList))}).then(function(u){return r.width=u.width,r.height=u.height,Promise.resolve(r)})}},{key:"_checkImageType",value:function(e){var n="";return n=qe?e.url.slice(e.url.lastIndexOf(".")+1):$t?e.type.split("/")[1]:e.files[0].name.slice(e.files[0].name.lastIndexOf(".")+1),0<=Gu.indexOf(n.toLowerCase())||j({code:X.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(e){return(e=(qe||$t?e:e.files[0]).size)===0?j({code:X.MSG_F_IS_EMPTY}):e<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(e){return!e.file||this._isEmptyFileList(e.file.files)?j({code:X.MSG_F_SELECT_F_FIRST}):e.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):e.file.files[0].size===0?j({code:X.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(e))}},{key:"doUploadVideo",value:function(e){return e.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):e.file.videoFile.size===0?j({code:X.MSG_F_IS_EMPTY}):Uu.indexOf(e.file.videoFile.type)===-1?j({code:X.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),qe||$t?this.handleVideoUpload(g(g({},e),{},{file:e.file.videoFile})):mt?this.handleVideoUpload(e):void 0)}},{key:"handleVideoUpload",value:function(e){var n=this;return new Promise(function(a,r){n.uploadByCOS(e).then(function(u){a(u)}).catch(function(){n.uploadByCOS(e).then(function(u){a(u)}).catch(function(){r(new xe({code:X.MSG_V_UPLOAD_FAIL}))})})})}},{key:"doUploadAudio",value:function(e){return e.file?e.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):e.file.size===0?j({code:X.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(e)):j({code:X.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(e){var n=this;if(!Ot(this._cosUploadMethod))return this.warn("PluginUndetected"),j({code:X.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(e);var a=new ce("upload"),r="".concat(this._n,".uploadByCOS"),u=Date.now(),d=this._getFile(e);return new Promise(function(_,y){var M=qe?n._createCosOptionsWXMiniApp(e):n._createCosOptionsWeb(e),R=n;n._cosUploadMethod(M,function(L,F){var x=Object.create(null);if(F){if(L||ke(F.files)&&F.files[0].error)return K=new xe({code:X.MSG_F_UPLOAD_FAIL}),a.setError(K).end(),D.l("".concat(r," failed. error:"),F.files[0].error),F.files[0].error.statusCode===403&&n._getAuthorizationKey(),void y(K);x.fileName=d.name,x.fileSize=d.size,x.fileType=d.type.slice(d.type.indexOf("/")+1).toLowerCase(),x.location=(qe?F:F.files[0].data).Location;var K=Date.now()-u,le=(F=R._formatFileSize(d.size),R._formatSpeed(1e3*d.size/K));return F="size:".concat(F," time:").concat(K,"ms speed:").concat(le),(D.l("".concat(r," success. name:").concat(d.name," ").concat(F)),_(x),le=n.get(26)).addCost(P,K),le.addFileSize(P,d.size),void a.setMessage(F).end()}x=new xe({code:X.MSG_F_UPLOAD_FAIL}),a.setError(x).end(),D.w("".concat(r," failed. error:"),L),L.statusCode===403&&n._getAuthorizationKey(),y(x)})})}},{key:"_uploadWithPreSigUrl",value:function(e){var n=this,a="".concat(this._n,"._uploadWithPreSigUrl"),r=this._getFile(e);return this._createCosOptionsPreSigUrl(e).then(function(u){return new Promise(function(d,_){var y=new ce("upload"),M=u.requestSnapshotUrl,R=M===void 0?void 0:M,L=oe(u,Hc),F=Date.now();n._cosUploadMethod(L,function(x,K){var le,he,fe;return x||K.statusCode===403?(y.setError(new xe(x)).end(),he={HttpStatusCode:9999,CostTime:kn(F,!1),error:x,url:u.url},K.data&&K.data.uploadIP&&(he.uploadIP=K.data.uploadIP),n._uploadSSOLog(he),D.l("".concat(a," failed, error:"),x),void _(new xe({code:X.MSG_F_UPLOAD_FAIL}))):(le=Object.create(null),he=K.data.location||"",n.isPrivateNetWork()||he.indexOf("https://")!==0&&he.indexOf("http://")!==0||(he=he.split("//")[1]),le.fileName=r.name,le.fileSize=r.size,le.fileType=r.type.slice(r.type.indexOf("/")+1).toLowerCase(),le.location=he,x=kn(F,!1),he=n._formatFileSize(r.size),fe=n._formatSpeed(1e3*r.size/x),he="size:".concat(he," time:").concat(x,"ms speed:").concat(fe," res:").concat(JSON.stringify(K.data)),D.l("".concat(a," ok. name:").concat(r.name," ").concat(he)),y.setMessage(he).end(),fe={HttpStatusCode:K.statusCode,FileSize:r.size,CostTime:x,url:u.url},K.data&&K.data.uploadIP&&(fe.uploadIP=K.data.uploadIP),n._uploadSSOLog(fe),(he=n.get(26)).addCost(P,x),he.addFileSize(P,r.size),fe=[],L.thumbUrl&&L.largeUrl&&fe.push.apply(fe,[n._getSmallImageInfoByUrl(L.thumbUrl,le),n._getLargeImageInfoByUrl(L.largeUrl,le)]),n.uploadFileType===1&&n.isSimpleCos&&!n.isPrivateNetWork()&&(fe.push(n._getImageInfoArray(L.downloadUrl,le)),K.data.uploadIP&&fe.push(n._getDownloadIP(L.downloadUrl.split("//")[1].split("/")[0],le))),R&&fe.push(n._getSnapshotInfoByUrl(R,le)),0<fe.length?Promise.all(fe).then(function(){d(le)}):void d(le))})})})}},{key:"_getDownloadIP",value:function(e,n){var a="".concat(this._n,"._getDownloadIP"),r=Date.now();return this.req({P:b.GET_IP,data:{domainName:e}}).then(function(u){var d;u.data&&u.data.ip&&(D.l("".concat(a," ok. downloadIP:").concat(u.data.ip," cost:").concat(kn(r))),(d=n.location.split("/"))[0]=u.data.ip,n.location=d.join("/"))}).catch(function(u){})}},{key:"_getImageInfoArray",value:function(e,n){var a=this,r="".concat(this._n,"._getImageInfoArray"),u=Date.now();return this.req({P:b.GET_IMAGE_INFO,data:{imageUrl:e}}).then(function(d){return d=d.data||{},D.l("".concat(r," ok. data: ").concat(JSON.stringify(d)," cost:").concat(kn(u))),n.imageInfoArray=d.imageInfoArray,d}).catch(function(d){n.imageInfoArray=void 0,a._uploadSSOLog({HttpStatusCode:1e4,CostTime:kn(u,!1),url:e})})}},{key:"_uploadSSOLog",value:function(e){var n,a;this.isSimpleCos&&((n=new ce).setEventType(18),e.error&&n.setError(new xe(e.error)),a="HttpStatusCode:".concat(e.HttpStatusCode,"|CosRequestId:").concat(e.CosRequestId||"","|")+"FileAlreadyExist:".concat(e.FileAlreadyExist||0,"|FileSize:").concat(e.FileSize||0,"|CostTime:").concat(e.CostTime),e.uploadIP&&(a+="|FinalIP:".concat(e.uploadIP)),n.setMessage("OK").setMoreMessage(e.url).setExtension(a).end())}},{key:"_getRawOrUploadProxyUrl",value:function(e){var n=this.get(12).getFileUploadProxy(),a=e;return n?e.replace(/^https:\/\/[^/]+/,n):a}},{key:"_getFile",value:function(e){return ke(e.file.files)||_c(e.file.files)?e.file.files[0]:e.file}},{key:"_formatFileSize",value:function(e){return e<1024?e+"B":e<1048576?Math.floor(e/1024)+"KB":Math.floor(e/1048576)+"MB"}},{key:"_formatSpeed",value:function(e){return e<=1048576?ao(e/1024,1)+"KB/s":ao(e/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(e){var n=this._getFile(e),a=(a=n.name).slice(a.lastIndexOf("."));return a=this._genFileName("".concat(mn(999999)).concat(a)),{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(a),Body:n}],SliceSize:1048576,onProgress:function(r){if(typeof e.onProgress=="function")try{e.onProgress(r.percent)}catch(u){D.w("onProgress callback error:",u)}},onFileFinish:function(r,u,d){}}}},{key:"_createCosOptionsWXMiniApp",value:function(e){var n=this._getFile(e),a=this._genFileName(n.name);return n=n.url,{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(a),FilePath:n,onProgress:function(r){if(D.l(JSON.stringify(r)),typeof e.onProgress=="function")try{e.onProgress(r.percent)}catch(u){D.w("onProgress callback error:",u)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(e){var n,a=this,r="",u="",d=0,_=this._getFile(e);return d=qe||$t?(r=e.message.type===A.MSG_FILE?(n=(n=_.name).slice(n.lastIndexOf(".")),this._genFileName("".concat(mn(999999)).concat(n))):this._genFileName(_.name),u=_.url,1):(n=(n=_.name).slice(n.lastIndexOf(".")),r=this._genFileName("".concat(mn(999999)).concat(n)),u=_,0),this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:r,uploadMethod:d,duration:this.duration,userID:e.message.from,conversationType:Lt(e.message.conversationID)?1:2}).then(function(y){var M=(K=a.isSimpleCos?y.preSig[0]:y).uploadUrl,R=K.downloadUrl,L=(L=K.requestSnapshotUrl)===void 0?void 0:L,F=K.thumbUrl,x=K.largeUrl,K=K.fileKey;return y=(y=y.uploadIP)===void 0?"":y,{url:a._getRawOrUploadProxyUrl(M),fileType:a.uploadFileType,fileName:r,resources:u,downloadUrl:R,requestSnapshotUrl:L,thumbUrl:F,largeUrl:x,fileKey:K,uploadIP:!a.isPrivateNetWork()&&y,onProgress:function(le){if(typeof e.onProgress=="function")try{e.onProgress(le.percent)}catch(he){D.w("onProgress callback error:",he),D.e(he)}}}})}},{key:"_genFileName",value:function(e){return"".concat(fi(),"-").concat(e)}},{key:"_setUploadFileType",value:function(e){this.uploadFileType=e}},{key:"_getSnapshotInfoByUrl",value:function(e,n){var a=this,r="_getSnapshotInfoByUrl",u=new ce(r);return this.req({P:b.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(mn(99999)),requestSnapshotUrl:e}}).then(function(d){if(d=(d.data||{}).snapshotUrl,D.l("".concat(a._n,".").concat(r," ok. snapshotUrl:").concat(d)),u.setMessage("snapshotUrl:".concat(d)).end(),Se(d))return{};var _=Qn(d,a._fileDownloadProxy,a._authKey,a._fileDNList);return _i(_).then(function(y){n.snapshotInfo={snapshotUrl:_,snapshotWidth:y.width,snapshotHeight:y.height}})}).catch(function(d){return D.w("".concat(a._n,".").concat(r," failed. error:"),d),u.setCode(d.errorCode).setMessage(d.errorInfo).end(),{}})}},{key:"_getSmallImageInfoByUrl",value:function(e,n){return _i(Qn(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then(function(a){n.smallImageUrl=e,n.smallImageWidth=a.width,n.smallImageHeight=a.height})}},{key:"_getLargeImageInfoByUrl",value:function(e,n){return _i(Qn(e,this._fileDownloadProxy,this._authKey,this._fileDNList)).then(function(a){n.largeImageUrl=e,n.largeImageWidth=a.width,n.largeImageHeight=a.height})}},{key:"_isEmptyFileList",value:function(e){return!(!_c(e)||e.length!==0)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset"))}}]),ks),Kc=["downloadKey","pbDownloadKey","messageList"],Wc=(N(Or,[{key:"uploadMergerMessage",value:function(e,n){var a="".concat(this._n,".").concat("uploadMergerMessage"),r=(D.d("".concat(a," message:"),e,"messageBytes:".concat(n)),e=JSON.parse(JSON.stringify(e.payload)).messageList).length,u=this._msgM.get(17).getFileDNList(),d=new ce("uploadMergerMessage");return e.forEach(function(_){ue(_.messageBody[0].type,_.messageBody,u)}),this._msgM.req({P:b.UPLOAD_MERGER_MSG,data:{messageList:e}}).then(function(_){D.d("".concat(a," ok. response:"),_.data);var y={pbDownloadKey:y=(_=_.data).pbDownloadKey,downloadKey:_=_.downloadKey,messageNumber:r};return d.setMessage("".concat(r,"-").concat(n,"-").concat(_)).end(),y}).catch(function(_){throw D.w("".concat(a," failed. error:"),_),d.setError(_).end(),_})}},{key:"downloadMergerMessage",value:function(e){var n=this,a="".concat(this._n,".").concat("downloadMergerMessage"),r=(D.d("".concat(a," message:"),e),e.payload.downloadKey),u=this._msgM.getFileDownloadProxy(),d=this._msgM.getDowloadFileAuthKey(),_=new ce("downloadMergerMessage");return _.setMessage("downloadKey:".concat(r)),this._msgM.req({P:b.DOWNLOAD_MERGER_MSG,data:{downloadKey:r}}).then(function(y){D.d("".concat(a," ok. response:"),y.data);var M,R,L=n._msgM.get(17).getFileDNList();return Ot(e.clearElement)?((M=e.payload).downloadKey,M.pbDownloadKey,M.messageList,M=oe(M,Kc),e.clearElement(),e.setElement({type:e.type,content:g({messageList:y.data.messageList},M)},u,d,L)):(R=[],y.data.messageList.forEach(function(F){Se(F)||(F=new Rc(F,u,d,L),R.push(F))}),e.payload.messageList=R,e.payload.downloadKey="",e.payload.pbDownloadKey=""),_.end(),e}).catch(function(y){throw D.w("".concat(a," failed. key:").concat(r," error:"),y),_.setError(y).end(),y})}},{key:"createMergerMessagePack",value:function(e,n,a){return e.conversationType===A.CONV_C2C?this._createC2CMergerMessagePack(e,n,a):this._createGroupMergerMessagePack(e,n,a)}},{key:"_createC2CMergerMessagePack",value:function(e,n,a){var r=null,u=(n&&(n.offlinePushInfo&&(r=n.offlinePushInfo),n.onlineUserOnly===!0&&(r?r.disablePush=!0:r={disablePush:!0})),[]),d=(ye(n)&&ye(n.messageControlInfo)&&(d=(y=n.messageControlInfo).excludedFromUnreadCount,_=y.excludedFromLastMessage,y=y.excludedFromContentModeration,d===!0&&u.push("NoUnread"),_===!0&&u.push("NoLastMsg"),y===!0&&u.push("NoMsgCheck")),""),_=(Ee(e.cloudCustomData)&&0<e.cloudCustomData.length&&(d=e.cloudCustomData),a.pbDownloadKey),y=a.downloadKey,M=(a=a.messageNumber,(L=e.payload).title),R=L.abstractList,L=L.compatibleText,F=(F=this._msgM.get(6))&&F.isOnlineMessage(e,n)?0:void 0;return{P:b.SEND_C2C_MSG,data:{fromAccount:this._msgM.getMyUserID(),toAccount:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:_,downloadKey:y,title:M,abstractList:R,compatibleText:L,messageNumber:a}}],cloudCustomData:d,clientTime:e.clientTime,msgSeq:e.sequence,msgRandom:e.random,msgLifeTime:F,offlinePushInfo:ra(r),messageControlInfo:F!==0?u:void 0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(e,n,a){var r=null,u=(n&&n.offlinePushInfo&&(r=n.offlinePushInfo),[]),d=(ye(n)&&ye(n.messageControlInfo)&&(d=(y=n.messageControlInfo).excludedFromUnreadCount,_=y.excludedFromLastMessage,y=y.excludedFromContentModeration,d===!0&&u.push("NoUnread"),_===!0&&u.push("NoLastMsg"),y===!0&&u.push("NoMsgCheck")),""),_=(Ee(e.cloudCustomData)&&0<e.cloudCustomData.length&&(d=e.cloudCustomData),a.pbDownloadKey),y=a.downloadKey,M=(a=a.messageNumber,(L=e.payload).title),R=L.abstractList,L=L.compatibleText,F=this._msgM.get(7);return n=F&&F.isOnlineMessage(e,n)?1:0,{P:b.SEND_GRP_MSG,data:{fromAccount:this._msgM.getMyUserID(),groupID:e.to,msgBody:[{msgType:e.type,msgContent:{pbDownloadKey:_,downloadKey:y,title:M,abstractList:R,compatibleText:L,messageNumber:a}}],random:e.random,priority:e.priority,clientSequence:e.clientSequence,groupAtInfo:void 0,cloudCustomData:d,onlineOnlyFlag:n,offlinePushInfo:ra(r),clientTime:e.clientTime,needReadReceipt:e.needReadReceipt!==!0||F.isMessageFromOrToAVChatroom(e.to)?0:1,messageControlInfo:n==0?u:void 0,isSupportExtension:e.isSupportExtension===!0?1:0,isRelayMessage:e._relayFlag===!0?1:0}}}}]),Or),Hu={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},Ku=[X.MSG_ONPROGRESS_ERR,X.MSG_I_SELECT_F_FIRST,X.MSG_I_TYPES_LIMIT,X.MSG_F_IS_EMPTY,X.MSG_I_SIZE_LIMIT,X.MSG_F_SELECT_F_FIRST,X.MSG_F_SIZE_LIMIT,X.MSG_V_SIZE_LIMIT,X.MSG_V_TYPES_LIMIT,X.MSG_A_UPLOAD_FAIL,X.MSG_A_SIZE_LIMIT,X.COS_UNDETECTED];function Or(e){v(this,Or),this._n="MergerMessageHandler",this._msgM=e}function ks(e){v(this,ks),(e=kr.call(this,e))._n="UploadModule",e.TIMUploadPlugin=null,e.timUploadPlugin=null,e.COSSDK=null,e._cosUploadMethod=null,e.expiredTimeLimit=600,e.appid=0,e.bucketName="",e.ciUrl="",e.directory="",e.downloadUrl="",e.uploadUrl="",e.region="ap-shanghai",e.cos=null,e.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},e.uploadFileType="",e.duration=900,e.tryCount=0,e.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},e.isSimpleCos=!1,e._fileDownloadProxy="",e._authKey="",e._fileDNList=fd;var n=e.getIEmitInst();return n.on(Kt.A2KEY_AND_TINYID_UPDATED,e._init,de(e)),n.on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function Wu(e){var n=!1;return Object.values(Hu).includes(e)&&(n=!0),120001<=e&&e<=13e4||10100<=e&&e<=10200||n}var ju,Yu,zu,Ju,$u,Nr,As=["conversationID","timePosition","timePeriod"],Xu=(V(ws,an),Nr=ae(ws),N(ws,[{key:"createTextMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new In(e));return e=Ee(e.payload)?e.payload:e.payload.text,e=new Mi({text:e}),n=this._getNickAndAvatarByUserID(n),a.setElement(e),a.setNickAndAvatar(n),a.setNameCard(this._getNameCardByGroupID(a)),a}},{key:"createImageMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new In(e));if(qe){if(ut(u=e.payload.file))return void this.warn("FileUnsupportedInMP","createImageMessage");var r=u.tempFiles[0].path||u.tempFiles[0].tempFilePath,u={url:r,name:r.slice(r.lastIndexOf("/")+1),size:u.tempFiles&&u.tempFiles[0].size||1,type:r.slice(r.lastIndexOf(".")+1).toLowerCase()};e.payload.file=u}else $t?(u={url:(r=e.payload.file).uri,name:r.fileName,size:r.fileSize||1,type:r.type,width:r.width,height:r.height},e.payload.file=u):mt&&(ut(e.payload.file)?(r=e.payload.file,e.payload.file={files:[r]}):ye(e.payload.file)&&typeof uni!="undefined"&&(u=e.payload.file.tempFiles[0],e.payload.file={files:[u]}));return r=new Ti({imageFormat:at.UNKNOWN,uuid:this._generateUUID(e.payload.file),file:e.payload.file}),u=this._getNickAndAvatarByUserID(n),a.setElement(r),a.setNickAndAvatar(u),a.setNameCard(this._getNameCardByGroupID(a)),this._messageOptionsMap.set(a.clientSequence,e),a}},{key:"createAudioMessage",value:function(e){var n=e.payload.file,a=(qe&&(a={url:n.tempFilePath,name:n.tempFilePath.slice(n.tempFilePath.lastIndexOf("/")+1),size:n.fileSize,second:parseInt(n.duration)/1e3,type:n.tempFilePath.slice(n.tempFilePath.lastIndexOf(".")+1).toLowerCase()},e.payload.file=a),$t&&(a={url:n.uri,name:n.uri.slice(n.uri.lastIndexOf("/")+1),size:n.fileSize||1,second:Math.floor(n.duration/1e3),type:n.uri.slice(n.uri.lastIndexOf(".")+1).toLowerCase()},e.payload.file=a),this.getMyUserID()),r=(e.currentUser=a,e.senderTinyID=this.getMyTinyID(),new In(e));return n=new ia({second:Math.floor(n.duration/1e3),size:n.fileSize||n.size||1,url:n.tempFilePath,uuid:this._generateUUID(e.payload.file)}),a=this._getNickAndAvatarByUserID(a),r.setElement(n),r.setNickAndAvatar(a),r.setNameCard(this._getNameCardByGroupID(r)),this._messageOptionsMap.set(r.clientSequence,e),r}},{key:"createVideoMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),e.payload.file.thumbUrl="",e.payload.file.thumbSize=0,{});if(qe){if(Ft)return void this.warn("VideoUnsupportedInAlipay");if(ut(e.payload.file))return void this.warn("FileUnsupportedInMP","createVideoMessage");var r=e.payload.file;ke(r.tempFiles)&&(r=r.tempFiles[0]),a.url=r.tempFilePath,a.name=r.tempFilePath.slice(r.tempFilePath.lastIndexOf("/")+1),a.size=r.size||1,a.second=r.duration||0,a.type=r.tempFilePath.slice(r.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else $t?(r=e.payload.file,a.url=r.uri,a.name=r.fileName,a.size=r.fileSize||1,a.second=r.duration||0,a.type=r.type.split("/")[1]):mt&&(ut(e.payload.file)?(r=e.payload.file,e.payload.file.files=[r]):ye(e.payload.file)&&typeof uni!="undefined"&&(r=e.payload.file.tempFile,e.payload.file.files=[r]),r=e.payload.file,a.url=window.URL.createObjectURL(r.files[0]),a.name=r.files[0].name,a.size=r.files[0].size||1,a.second=r.files[0].duration||0,a.type=r.files[0].type.split("/")[1]);return e.payload.file.videoFile=a,r=new In(e),a=new Xa({videoFormat:a.type,videoSecond:ao(a.second,0),videoSize:a.size,remoteVideoUrl:"",videoUrl:a.url,videoUUID:this._generateUUID(e.payload.file.videoFile),thumbUUID:this._generateUUID(e.payload.file.videoFile),thumbWidth:e.payload.file.width||200,thumbHeight:e.payload.file.height||200,thumbUrl:e.payload.file.thumbUrl,thumbSize:e.payload.file.thumbSize,thumbFormat:e.payload.file.thumbUrl.slice(e.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),n=this._getNickAndAvatarByUserID(n),r.setElement(a),r.setNickAndAvatar(n),r.setNameCard(this._getNameCardByGroupID(r)),this._messageOptionsMap.set(r.clientSequence,e),r}},{key:"createCustomMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new In(e));return e=new $a({data:e.payload.data,description:e.payload.description,extension:e.payload.extension}),n=this._getNickAndAvatarByUserID(n),a.setElement(e),a.setNickAndAvatar(n),a.setNameCard(this._getNameCardByGroupID(a)),a}},{key:"createFaceMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new In(e));return e=new Ya(e.payload),n=this._getNickAndAvatarByUserID(n),a.setElement(e),a.setNickAndAvatar(n),a.setNameCard(this._getNameCardByGroupID(a)),a}},{key:"createMergerMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),n=this._getNickAndAvatarByUserID(n),new In(e));return e=new mr(e.payload),a.setElement(e),a.setNickAndAvatar(n),a.setNameCard(this._getNameCardByGroupID(a)),a.setRelayFlag(!0),a}},{key:"createForwardMessage",value:function(e){var n=e.to,a=e.conversationType,r=e.priority,u=e.payload,d=e.needReadReceipt,_=e.receiverList;if(!ke(u._elements))return j({code:X.MSG_FORWARD_INVALID_ELEMENTS});var y=this.getMyUserID(),M=this._getNickAndAvatarByUserID(y);return u.type===A.MSG_GRP_TIP?j({code:X.MSG_FORWARD_TYPE_INVALID}):(a={to:n,conversationType:a,conversationID:"".concat(a).concat(n),priority:r,isPlaceMessage:0,status:Ae,currentUser:y,senderTinyID:this.getMyTinyID(),cloudCustomData:e.cloudCustomData||u.cloudCustomData||"",needReadReceipt:d,receiverList:_,isSupportExtension:e.isSupportExtension||!1},(n=new In(a)).setElement(u._elements[0]),n.setNickAndAvatar(M),n.setNameCard(this._getNameCardByGroupID(u)),n.setRelayFlag(!0),n)}},{key:"downloadMergerMessage",value:function(e){return this._mergerMessageHandler.downloadMergerMessage(e)}},{key:"createFileMessage",value:function(e){if(qe){if(!wt&&!rn&&!Ct)return;var n=vt.getSystemInfoSync().SDKVersion;if(wt&&Ic(n,"2.5.0")<0)return void this.warn("WXChooseMessageFile");if(rn&&Ic(n,"1.18.0")<0)return void this.warn("QQChooseMessageFile")}mt||Ct?ut(e.payload.file)?(n=e.payload.file,e.payload.file={files:[n]}):ye(e.payload.file)&&typeof uni!="undefined"&&(r=(n=e.payload.file).tempFiles,n=n.files,a=null,ke(r)?a=r[0]:ke(n)&&(a=n[0]),e.payload.file={files:[a]}):wt||rn?(n=g(g({},(r=e.payload.file.tempFiles)[0]),{},{url:r[0].path}),e.payload.file={files:[n]}):$t&&(r=g(g({},a=e.payload.file),{},{url:a.uri}),e.payload.file={files:[r]}),n=this.getMyUserID();var a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new In(e)),r=new Ja({uuid:this._generateUUID(e.payload.file),file:e.payload.file});return n=this._getNickAndAvatarByUserID(n),a.setElement(r),a.setNickAndAvatar(n),a.setNameCard(this._getNameCardByGroupID(a)),this._messageOptionsMap.set(a.clientSequence,e),a}},{key:"createLocationMessage",value:function(e){var n=this.getMyUserID(),a=(e.currentUser=n,e.senderTinyID=this.getMyTinyID(),new In(e));return e=new Ec(e.payload),n=this._getNickAndAvatarByUserID(n),a.setElement(e),a.setNickAndAvatar(n),a.setNameCard(this._getNameCardByGroupID(a)),a}},{key:"_onNoModule",value:function(){return j({code:X.NO_MODULE})}},{key:"sendMessageInstance",value:function(e,n){var a=this;if(this.get(29).filterMessage(e,n)===!1)return e.hasRiskContent=!0,this._onSendMessageFailed(e,new xe({code:X.PROFANITY_FOUND}));var r=null;if(e.conversationType===A.CONV_C2C)r=this.get(6);else{if(e.conversationType!==A.CONV_GROUP)return j({code:X.MSG_INVALID_CONV_TYPE});r=this.get(7)}if(!r)return this._onNoModule();var u,d="".concat(this._n,".sendMessageInstance"),_=this.get(11),y=r.isOnlineMessage(e,n);return this.get(17).upload(e).then(function(){return a._getSendMessageSpecifiedKey(e)===Ht&&a.get(26).addSuccessCount(P),a._guardForGroup(e).then(function(){if(!e.isSendable())return j({code:X.MSG_F_URL_IS_EMPTY});a._addSendMessageTotalCount(e),u=Date.now();var M=function(R){var L="utf-8";mt&&document&&(L=document.charset.toLowerCase());var F,x=0,K=R.length;if(L==="utf-8"||L==="utf8")for(var le=0;le<K;le++)(F=R.codePointAt(le))<=127?x+=1:F<=2047?x+=2:F<=65535?x+=3:(x+=4,le++);else if(L==="utf-16"||L==="utf16")for(var he=0;he<K;he++)(F=R.codePointAt(he))<=65535?x+=2:(x+=4,he++);else x=R.replace(/[^\x00-\xff]/g,"aa").length;return x}(JSON.stringify(e));return e.type===A.MSG_MERGER&&11264<M?a._mergerMessageHandler.uploadMergerMessage(e,M).then(function(R){return R=a._mergerMessageHandler.createMergerMessagePack(e,n,R),a.req(R)}):(_.setMessageRandom(e),r.sendMessage(e,n))}).then(function(M){var R,L=(M=M.data).time,F=M.sequence,x=M.readReceiptCode;return M=M.messageDropReason,ft(x)&&x!==0&&(new ce("sendMessageWithReceipt").setMessage("from:".concat(e.from," to:").concat(e.to," sequence:").concat(F," readReceiptCode:").concat(x)).end(),D.w("".concat(d," readReceiptCode:").concat(x," message:").concat(a.getErrMsg(x)))),M&&(x=new ce("messageDropReason"),M="from:".concat(e.from," to:").concat(e.to," sequence:").concat(F," messageDropReason:").concat(M),x.setMessage(M).end(),D.w("".concat(d," ").concat(M))),a._addSendMessageSuccessCount(e,u),a._messageOptionsMap.delete(e.clientSequence),e.isResend===!0&&(R=_.findMessage(e.ID))&&(D.l("".concat(d," resend ok. ID:").concat(R.ID)),_.deleteLocalMessage(R)),e.status=we,e.time=L,x=!1,e.conversationType===A.CONV_GROUP?e.sequence=F:e.conversationType!==A.CONV_C2C||(M=_.getLatestMessageSentByMe(e.conversationID))&&(R=M.nick,L=M.avatar,R===e.nick&&L===e.avatar||(x=!0)),x&&_.modifyMessageSentByMe({conversationID:e.conversationID,latestNick:e.nick,latestAvatar:e.avatar}),y===!0?e._onlineOnlyFlag=!0:(_.appendToMessageList(e),F=e,ye(n)&&ye(n.messageControlInfo)&&(n.messageControlInfo.excludedFromLastMessage===!0&&(e._isExcludedFromLastMessage=!0,F=""),n.messageControlInfo.excludedFromUnreadCount===!0&&(e._isExcludedFromUnreadCount=!0)),M=e.conversationType,bt(e.to)&&(M=A.CONV_TOPIC,a.get(10).onMessageSent({groupID:vn(e.to),topicID:e.to,lastMessage:F})),_.onMessageSent({conversationOptionsList:[{conversationID:e.conversationID,unreadCount:0,type:M,subType:e.conversationSubType,lastMessage:F}]})),e._relayFlag||e.type!=="TIMImageElem"||pr(e.payload.imageInfoArray),be({message:e})})}).catch(function(M){return a._onSendMessageFailed(e,M,y)})}},{key:"_guardForGroup",value:function(e){if(e.conversationType!==A.CONV_GROUP)return Promise.resolve();var n=this.get(7);if(!n)return this._onNoModule();if(Vt({groupID:e.to})){var a=n.getLocalGroupProfile(e.to);if(a&&a.isSupportTopic)return j({code:X.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return n.guardForAVChatRoom(e)}},{key:"_onSendMessageFailed",value:function(e,n){var a=2<arguments.length&&arguments[2]!==void 0&&arguments[2],r="".concat(this._n,"._onSendMessageFailed"),u=(e.status=W,n.code!==80001&&n.code!==80004||(e.hasRiskContent=!0),this.get(11)),d=(u.deleteMessageRandom(e),10100<=n.code&&n.code<=10200||120001<=n.code&&n.code<=13e4);return a||d||u.appendToMessageList(e)===!0&&D.l("".concat(r," message stored, ID:").concat(e.ID)),this._addSendMessageFailCountOnUser(e,n),a=new ce("sendMessage"),d="head.seq:".concat(n.data.headSeq," type:").concat(e.type," from:").concat(e.from," to:").concat(e.to),mt&&("connection"in navigator&&(u=navigator.connection,d+=" downlink:".concat(u.downlink," effectiveType:").concat(u.effectiveType," rtt:").concat(u.rtt)),"memory"in window.performance&&(u=window.performance.memory,d+=" usedJSHeapSize:".concat(u.usedJSHeapSize," totalJSHeapSize:").concat(u.totalJSHeapSize," jsHeapSizeLimit:").concat(u.jsHeapSizeLimit))),a.setMessage(d).setError(n).end(),D.e("".concat(r," ").concat(d," error:"),n),j(new xe({code:n&&n.code?n.code:X.MSG_SEND_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){if([A.MSG_IMAGE,A.MSG_AUDIO,A.MSG_VIDEO,A.MSG_FILE].includes(e.type))return Ht;if(e.conversationType===A.CONV_C2C)return Gt;if(e.conversationType===A.CONV_GROUP){var n=this.get(7);if(n&&(n=n.getLocalGroupProfile(e.to)))return Un(e=n.type)?po:Q}}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,n){var a;(e=this._getSendMessageSpecifiedKey(e))&&((a=this.get(26)).addSuccessCount(e),a.addCost(e,kn(n,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,n){n=(n=n.code)===void 0?-1:n;var a,r=this.get(26);(e=this._getSendMessageSpecifiedKey(e))===Ht&&(a=!1,a=!!Ku.includes(n)||a)?r.addFailedCountOfUserSide(P):Wu(n)&&e&&r.addFailedCountOfUserSide(e)}},{key:"resendMessage",value:function(e,n){return e.isResend=!0,e.status=Ae,this.sendMessageInstance(e,n)}},{key:"revokeMessage",value:function(e){var n=this,a=null;if(e.conversationType===A.CONV_C2C?a=this.get(6):e.conversationType===A.CONV_GROUP&&(a=this.get(7)),!a)return this._onNoModule();var r=new ce("revokeMessage"),u=(r.setMessage("type:".concat(e.type," from:").concat(e.from," to:").concat(e.to)),"".concat(this._n,".").concat("revokeMessage"));return a.revokeMessage(e).then(function(d){return Se(d=d.data.recallRetList)||d[0].retCode===0?(D.i("".concat(u," ok. ID:").concat(e.ID)),e.isRevoked=!0,r.end(),n.get(11).onMessageRevoked([e]),be({message:e})):(d=new xe({code:d[0].retCode,data:{message:e}}),r.setCode(d.code).setMoreMessage(d.message).end(),j(d))}).catch(function(d){r.setError(d).end();var _=new xe({code:d&&d.code?d.code:X.MSG_REVOKE_FAIL,message:d&&d.message?d.message:void 0,data:{message:e}});return D.w("".concat(u," failed. error:"),d),j(_)})}},{key:"deleteMessage",value:function(e){var n=this,a=null,r=e[0],u=r.conversationID,d="",_=[],y=[];if(r.conversationType===A.CONV_C2C)a=this.get(6),d=u.replace(A.CONV_C2C,""),e.forEach(function(L){L&&L.status===we&&L.conversationID===u&&(L._onlineOnlyFlag||_.push("".concat(L.sequence,"_").concat(L.random,"_").concat(L.time)),y.push(L))});else if(r.conversationType===A.CONV_GROUP)a=this.get(7),d=u.replace(A.CONV_GROUP,""),e.forEach(function(L){L&&L.status===we&&L.conversationID===u&&(L._onlineOnlyFlag||_.push("".concat(L.sequence)),y.push(L))});else if(r.conversationType===A.CONV_SYSTEM)return j({code:X.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!a)return this._onNoModule();if(_.length===0)return this._onMessageDeleted(y);30<_.length&&(_=_.slice(0,30),y=y.slice(0,30));var M=new ce("deleteMessage"),R=(M.setMessage("to:".concat(d," count:").concat(_.length)),"".concat(this._n,".").concat("deleteMessage"));return a.deleteMessage({to:d,keyList:_}).then(function(L){return M.end(),D.i("".concat(R," ok")),n._onMessageDeleted(y)}).catch(function(L){return M.setError(L).end(),D.w("".concat(R," failed. error:"),L),j(L=new xe({code:L&&L.code?L.code:X.MSG_DELETE_FAIL,message:L&&L.message?L.message:void 0}))})}},{key:"_onMessageDeleted",value:function(e){return this.get(11).onMessageDeleted(e),Ke({messageList:e})}},{key:"translateText",value:function(e){var n="".concat(this._n,".").concat("translateText"),a=e.sourceTextList,r=e.sourceLanguage,u=(e=e.targetLanguage,new ce("translateText"));return u.setMessage("sourceLanguage:".concat(r," targetLanguage:").concat(e)),this.req({P:b.TRANSLATE_TEXT,data:{sourceTextList:a,source:r||"auto",target:e,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then(function(d){var _=(d=d.data).error,y=d.requestID;if(d=d.translatedTextList,_.code===0)return u.end(),D.i("".concat(n," ok. requestID:").concat(y)),be({translatedTextList:d});throw g(g({},_),{},{requestID:y})}).catch(function(d){return u.setCode(d.code).setMoreMessage(d.requestID).end(),D.w("".concat(n," failed. error:"),d),j({code:X.TRANSLATE_TEXT_FAIL})})}},{key:"convertVoiceToText",value:function(e){var n=e.message,a=(e=e.language,n.payload.url);if(!(n.from===this.getMyUserID()&&n.flow==="out"&&(a=n.payload.remoteAudioUrl),n=/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/).test(a))return j({code:X.UNSUPPORTED_VOICE_FORMAT});n=n.exec(a)[1]||"mp3";var r="16k_zh-PY",u=(e?e==="zh (cmn-Hans-CN)"?r="16k_zh":e==="en-US"?r="16k_en":e==="yue-Hant-HK"?r="16k_yue":e==="ja-JP"&&(r="16k_ja"):r="16k_zh-PY",e="serviceType:".concat(r," url:").concat(a),"".concat(this._n,".").concat("convertVoiceToText")),d=(D.i("".concat(u," ").concat(e)),new ce("convertVoiceToText"));return d.setMessage(e),this.req({P:b.VOICE_TO_TEXT,data:{url:a,language:r,SDKAppID:this.getSDKAppID(),format:n}}).then(function(_){var y=(_=_.data).error,M=_.requestID;if(_=_.result,y.code===0)return d.end(),D.i("".concat(u," ok. requestID:").concat(M)),be({result:_});throw g(g({},y),{},{requestID:M})}).catch(function(_){return d.setCode(_.code).setMoreMessage(_.requestID||"").end(),D.w("".concat(u," failed. error:"),_),j({code:X.VOICE_TO_TEXT_FAIL})})}},{key:"modifyRemoteMessage",value:function(e){var n=this;if(this.get(29).filterMessage(e)===!1)return e.hasRiskContent=!0,j({code:X.PROFANITY_FOUND,data:{message:e}});var a=null,r=e.conversationType,u=e.to;if(r===A.CONV_C2C)a=this.get(6);else if(r===A.CONV_GROUP){if(!(a=this.get(7)))return this._onNoModule();if(a.isMessageFromOrToAVChatroom(u))return j({code:X.MSG_MODIFY_DISABLED_IN_AV,data:{message:e}})}var d=new ce("modifyMessage"),_=(d.setMessage("to:".concat(u)),"".concat(this._n,".modifyRemoteMessage"));return a.modifyRemoteMessage(e).then(function(y){return d.end(),D.i("".concat(_," ok")),be({message:y=n._onModifyRemoteMessageResp(e,y.data)})}).catch(function(y){var M;return d.setCode(y.code).setMoreMessage(y.message).end(),D.w("".concat(_," failed. error:"),y),y.code===20027?(M=n._onModifyRemoteMessageResp(e,y.data),j({code:X.MSG_MODIFY_CONFLICT,data:{message:M}})):j({code:y.code,message:y.message,data:{message:e}})})}},{key:"_generateSearchdata",value:function(e){var n=e.conversationID,a=e.timePosition,r=e.timePeriod;return e=oe(e,As),q(n)||(Lt(n)&&(e.account=n.replace(A.CONV_C2C,"")),Bt(n)&&(e.groupID=n.replace(A.CONV_GROUP,""))),ft(r)&&0<r&&(ft(a)&&0<a?e.startTime=a-r:e.startTime=Ji()-r),e.startTime&&e.startTime<0&&(e.startTime=void 0),ft(a)&&0<a&&(e.endTime=a),e}},{key:"searchCloudMessages",value:function(e){var n=this,a="searchCloudMessages",r="".concat(this._n,".").concat(a);if(!e)return j({code:X.OPTIONS_IS_EMPTY,message:this.getErrMsg(X.OPTIONS_IS_EMPTY,a)});var u=e.keywordList,d=e.keywordListMatchType,_=e.conversationID,y=e.cursor,M=ke(e.senderUserIDList)&&0<e.senderUserIDList.length,R=ke(e.messageTypeList)&&0<e.messageTypeList.length;if(!u&&!M&&!R)throw D.e("[".concat(a,'] Missing required params: "keywordList".')),new Error("Params validate failed.");var L=Date.now(),F=new ce(a),x="keywordList:".concat(u," keywordListMatchType:").concat(d," ")+"convID:".concat(_," cursor:").concat(y);return D.l("".concat(r," ").concat(x)),this.req({P:b.MSG_CLOUD_SEARCH,data:this._generateSearchdata(e)}).then(function(K){var le=(he=K.data).code,he=he.message;if(le!==0)return he=n.getErrMsg(le===60020?"SearchCloudMessagesUnavailable":le)||he,le=new xe({code:le,message:he}),F.setMessage(x).setError(le).end(),j(le);n.get(27).isSearchCloudMessagesEnabled(),le=(he=K.data).cursor,K=he.totalCount,he=he.searchResult;var fe="totalCount:".concat(K," cost:").concat(kn(L));return be({searchResultList:(D.l("".concat(r," ok. cursor:").concat(le," ").concat(fe)),F.setMessage("".concat(x," ").concat(fe)).end(),fe=n._handleSearchResults(he,!e.conversationID)),cursor:le,totalCount:K})}).catch(function(K){return F.setMessage(x).setError(K).end(),j(K)})}},{key:"_handleSearchResults",value:function(e,n){var a=this.get(11);return ke(e)&&e.length!==0?e.map(function(r){var u=r.groupID,d=r.userID,_=r.messageCount,y=(r=(r=r.messageList)===void 0?[]:r,{conversationID:d=u?"".concat(A.CONV_GROUP).concat(u):"".concat(A.CONV_C2C).concat(d),messageCount:_,messageList:[]});return n&&1<_||0<(_=r.filter(function(M){return!!M})).length&&(r=a.onRoamingMessage(_,d,!1),u&&r.reverse(),y.messageList=r,y.messageCount=r.length),y}):[]}},{key:"_onModifyRemoteMessageResp",value:function(e,n){D.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),n);var a=e.conversationType,r=e.from,u=e.to,d=e.random,_=e.sequence,y=(e=e.time,n.elements),M=n.messageVersion;return n=(n=n.cloudCustomData)===void 0?"":n,this.get(11).onMessageModified({conversationType:a,from:r,to:u,time:e,random:d,sequence:_,elements:y,cloudCustomData:n,messageVersion:M})}},{key:"_generateUUID",value:function(e){var n=this.get(12);return n="".concat(n.getSDKAppID(),"-").concat(n.getUserID(),"-").concat(mc()),(e=(e=e.name||e.value||e.url||e.tempFilePath)&&e.slice(e.lastIndexOf(".")+1))?"".concat(n,".").concat(e):n}},{key:"getMessageOption",value:function(e){return this._messageOptionsMap.get(e)}},{key:"_getNickAndAvatarByUserID",value:function(e){return this.get(4).getNickAndAvatarByUserID(e)}},{key:"_getNameCardByGroupID",value:function(e){if(e.conversationType===A.CONV_GROUP){var n=this.get(7);if(n)return n.getMyNameCardByGroupID(e.to)}return""}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]),ws),Qu=(V(Us,an),$u=ae(Us),N(Us,[{key:"onMsgExtNotify",value:function(e){var n=this,a=(e=e.dataList).messageInfo,r=e.operateType,u=e.operateResultList,d=e.tinyID,_=(e=e.globalSequence,a.clientTime),y=(a=a.random,"".concat(d,"-").concat(_,"-").concat(a)),M=[],R=[],L=(D.l("".concat(this._n,".onMsgExtNotify messageID:").concat(y," operateType:").concat(r," globalSequence:").concat(e)),this._updateGlobalSeq(y,e),!1),F=!1;u.forEach(function(x){var K=(K=x.extensions)===void 0?[]:K,le=x.clearSequence;r===1?(L=!0,K.forEach(function(he){M.push({key:he.key,value:he.value})}),n._updateLocalExt(y,K)):r===2?(F=!0,K.forEach(function(he){R.push(he.key)}),n._updateLocalExt(y,K)):r===3&&(F=!0,n._hasLocalExt(y)&&n._getLocalExt(y).forEach(function(he,fe){he.seq<=le&&!Se(he.value)&&R.push(fe)}),n._clearLocalExt(y,le))}),L&&this.emitOEvt(me.MESSAGE_EXTENSIONS_UPDATED,{messageID:y,extensions:M}),F&&this.emitOEvt(me.MESSAGE_EXTENSIONS_DELETED,{messageID:y,keyList:R})}},{key:"setMessageExtensions",value:function(e,n){var a="setMessageExtensions";if(!this.canIUse(Qe.MSG_EXT))return this.noUse(a);var r="".concat(this._n,".").concat(a),u=e.ID,d=e.conversationID,_=e.sequence,y=e.time,M=J(n),R=(20<n.length&&(M=n.slice(0,20),D.w("".concat(r,". the length of extensions cannot exceed 20."))),n="convID:".concat(d," messageID:").concat(u," sequence:").concat(_," time:").concat(y," count:").concat(M.length),new ce(a));return R.setMessage(n),D.l("".concat(r," ").concat(n)),this._modifyMsgExts(e,M).then(function(L){var F=L.resultList,x=L.successCount;return L=L.failureCount,x="successCount:".concat(x," failCount:").concat(L),R.setMoreMessage(x).end(),D.l("".concat(r," ok. ").concat(x)),be({extensions:F})}).catch(function(L){return R.setError(L).end(),D.e("".concat(r," failed. error:"),L),j(L)})}},{key:"getMessageExtensions",value:function(e){var n=this,a="getMessageExtensions";if(!this.canIUse(Qe.MSG_EXT))return this.noUse(a);var r="".concat(this._n,".").concat(a),u=e.ID,d=e.conversationID,_=e.sequence,y=e.time,M=(d="convID:".concat(d," messageID:").concat(u," sequence:").concat(_," time:").concat(y),new ce(a)),R=(M.setMessage(d),void D.l("".concat(r," ").concat(d)));return this.getMsgExtsMap.has(u)&&(R=this._getGlobalSeq(u)),this._getMsgExts(e,R).then(function(L){return M.end(),D.l("".concat(r," ok. extCount:").concat(L.length)),q(R)&&0<L.length&&n.getMsgExtsMap.set(u,1),be({extensions:L})}).catch(function(L){return M.setError(L).end(),D.e("".concat(r," failed. error:"),L),j(L)})}},{key:"deleteMessageExtensions",value:function(e,n){var a="deleteMessageExtensions";if(!this.canIUse(Qe.MSG_EXT))return this.noUse(a);var r="".concat(this._n,".").concat(a),u=[],d=3,_=(Se(n)||(d=2,n.forEach(function(L){u.push({key:L,value:"",seq:0})})),n=e.ID,e.conversationID),y=e.sequence,M=e.time,R=(_="convID:".concat(_," messageID:").concat(n," sequence:").concat(y," time:").concat(M," operateType:").concat(d),new ce(a));return R.setMessage(_),D.l("".concat(r," ").concat(_)),this._modifyMsgExts(e,u,d).then(function(L){var F=L.resultList,x=L.successCount,K=(L=L.failureCount,"");return d===2&&(K="success count:".concat(x," fail count:").concat(L)),R.setMoreMessage("".concat(K)).end(),D.l("".concat(r," ok. ").concat(K)),be({extensions:F})}).catch(function(L){return R.setError(L).end(),D.e("".concat(r," failed. error:"),L),j(L)})}},{key:"_modifyMsgExts",value:function(e,n){var a=this,r=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,u=bt(e.to)?A.CONV_TOPIC:e.conversationType,d=void 0,_=(r!==3&&(d=this._getReqExts(e,n)),null);switch(u){case A.CONV_C2C:_=this.get(6);break;case A.CONV_GROUP:_=this.get(7);break;case A.CONV_TOPIC:_=this.get(10);break;default:return j({code:X.NO_MODULE})}return _.modifyMsgExts(e,d,r).then(function(y){var M=(y=y.data).extensions,R=(y=y.seq,[]),L=0,F=0,x=[];return(M=Se(M)?[]:M).forEach(function(K){var le=K.errorCode,he=(K=K.extension).key,fe=K.value;K=K.seq,R.push({code:le,key:he,value:fe}),le===0?L++:F++,x.push({key:he,value:fe,seq:K})}),a._updateGlobalSeq(e.ID,y),0<x.length&&(a._updateLocalExt(e.ID,x),x=null),{resultList:R,successCount:L,failureCount:F}}).catch(function(y){return j(y)})}},{key:"_getReqExts",value:function(e,n){var a,r=[];return this._hasLocalExt(e.ID)?(a=this._getLocalExt(e.ID),n.forEach(function(u){var d=u.key,_=(u=u.value,0);a.has(d)&&(_=a.get(d).seq),r.push({key:d,value:u,seq:_})})):n.forEach(function(u){var d=u.key;u=u.value,r.push({key:d,value:u,seq:0})}),r}},{key:"_getMsgExts",value:function(e,n){var a=this,r="".concat(this._n,"._getMsgExts"),u=e.ID,d=null;switch(bt(e.to)?A.CONV_TOPIC:e.conversationType){case A.CONV_C2C:d=this.get(6);break;case A.CONV_GROUP:d=this.get(7);break;case A.CONV_TOPIC:d=this.get(10);break;default:return j({code:X.NO_MODULE})}return d.getMessageExtensions(e,n).then(function(_){var y=(_=_.data).extensions,M=_.completeFlag,R=_.globalSequence;return _=_.clearSequence,y=Se(y)?[]:y,D.l("".concat(r," ok. completeFlag:").concat(M," globalSequence:").concat(R," clearSequence:").concat(_," count:").concat(y.length)),a._updateLocalExt(u,y),a._clearLocalExt(u,_),a._updateGlobalSeq(u,R),M!==1?(_=y.slice(-1)[0].seq+1,a._getMsgExts(e,_)):a._getLocalExtList(u)}).catch(function(_){return j(_)})}},{key:"_hasLocalExt",value:function(e){return this.msgExtMap.has(e)}},{key:"_getLocalExt",value:function(e){return this.msgExtMap.get(e)}},{key:"_updateLocalExt",value:function(e,n){this._hasLocalExt(e)||this.msgExtMap.set(e,new Map);var a=this._getLocalExt(e);n.forEach(function(r){var u=r.key,d=r.value;r=r.seq,a.set(u,{value:d===void 0?"":d,seq:r})})}},{key:"_clearLocalExt",value:function(e,n){var a;n<=0||!this._hasLocalExt(e)||(a=this._getLocalExt(e)).forEach(function(r,u){r.seq<=n&&a.delete(u)})}},{key:"_getLocalExtList",value:function(e){var n=[];return this._hasLocalExt(e)&&this._getLocalExt(e).forEach(function(a,r){Se(a=a.value)||n.push({key:r,value:a})}),n}},{key:"_getGlobalSeq",value:function(e){return this.globalSeqMap.get(e)}},{key:"_updateGlobalSeq",value:function(e,n){this.globalSeqMap.set(e,n)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this.msgExtMap.clear(),this.globalSeqMap.clear(),this.getMsgExtsMap.clear()}}]),Us),Zu=(V(Gs,an),Ju=ae(Gs),N(Gs,[{key:"onReactionNotifyList",value:function(e){var n=this;((e=(e||{}).dataList)===void 0?[]:e).forEach(function(a){var r=a.C2CMessageInfo,u=(u=a.groupMessageInfo)===void 0?{}:u,d=(a=(a=a.reactionList)===void 0?[]:a,u=(r=g(g({},r===void 0?{}:r),u)).tinyID,r.clientTime),_=(r=r.random,u="".concat(u,"-").concat(d,"-").concat(r),[]);a.forEach(function(y){q(y.userIDList)&&(y.userIDList=[],y.count=0),_.push.apply(_,J(y.userIDList))}),D.l("".concat(n._n,".onReactionNotifyList messageID:").concat(u," reactionList:").concat(a.length)),n._handleReactionSummary([{messageID:u,reactionList:a}],_).then(function(y){n.emitOEvt(me.MESSAGE_REACTIONS_UPDATED,g({},y[0]))})})}},{key:"onReactionNotify",value:function(e){var n=(e=e.dataList||{}).C2CMessageInfo,a=(a=e.groupMessageInfo)===void 0?{}:a,r=e.reactionID,u=(e=e.operateType,a=(n=g(g({},n===void 0?{}:n),a)).tinyID,n.clientTime);n=n.random,a="".concat(a,"-").concat(u,"-").concat(n),D.l("".concat(this._n,".onReactionNotify messageID:").concat(a," reactionID:").concat(r," operateType:").concat(e)),e===1?this._addReactedByMyselfMap(a,r):this._removeReactedByMyselfMap(a,r),u="".concat(a,"-").concat(r),this._reactionInfoMap.has(u)&&((n=this._reactionInfoMap.get(u)).reactedByMyself=e===1,this.emitOEvt(me.MESSAGE_REACTIONS_UPDATED,{messageID:a,reactionList:[n]}))}},{key:"addMessageReaction",value:function(e,n){var a=this,r="addMessageReaction";if(!this.canIUse(Qe.MSG_REACTION))return this.noUse(r);var u="".concat(this._n,".").concat(r),d=e.ID,_=e.conversationID,y=(_="convID:".concat(_," messageID:").concat(d," reactionID:").concat(n),new ce(r));return y.setMessage(_),D.l("".concat(u," ").concat(_)),d=this._createReactionOperationPack(e,n,1),this._addReactedByMyselfMap(e.ID,n),this.req(d).then(function(){return y.end(),D.l("".concat(u," ok.")),be()}).catch(function(M){return a._removeReactedByMyselfMap(e.ID,n),y.setError(M).end(),D.e("".concat(u," failed. error:"),M),j(M)})}},{key:"removeMessageReaction",value:function(e,n){var a="removeMessageReaction";if(!this.canIUse(Qe.MSG_REACTION))return this.noUse(a);var r="".concat(this._n,".").concat(a),u=e.ID,d=e.conversationID,_=(d="convID:".concat(d," messageID:").concat(u," reactionID:").concat(n),new ce(a));return _.setMessage(d),D.l("".concat(r," ").concat(d)),u=this._createReactionOperationPack(e,n,2),this._removeReactedByMyselfMap(e.ID,n),this.req(u).then(function(){return _.end(),D.l("".concat(r," ok.")),be()}).catch(function(y){return _.setError(y).end(),D.e("".concat(r," failed. error:"),y),j(y)})}},{key:"getMessageReactions",value:function(e){var n=this,a="getMessageReactions";if(!this.canIUse(Qe.MSG_REACTION))return this.noUse(a);var r="".concat(this._n,".").concat(a),u=e.messageList,d=e.maxUserCountPerReaction,_=u[0].conversationID,y=(_="convID:".concat(_," maxUserCountPerReaction:").concat(d," msgCount:").concat(u.length),new ce(a)),M=(y.setMessage(_),D.l("".concat(r," ").concat(_)),new Map);return d=this._createReactionSummaryPack(g(g({},e),{},{messageIDMap:M})),this.req(d).then(function(R){R=R.data.resultList;var L=[],F=[];return(R===void 0?[]:R).forEach(function(x){var K=(K=x.messageKey)===void 0?void 0:K,le=(le=x.messageSequence)===void 0?void 0:le;x=(x=x.reactionList)===void 0?[]:x,le=q(K)?M.get(le):M.get(K),L.push({messageID:le,reactionList:x}),x.forEach(function(he){F.push.apply(F,J(he.userIDList))})}),n._handleReactionSummary(L,F)}).then(function(R){return y.end(),D.l("".concat(r," ok.")),M.clear(),be({resultList:R})}).catch(function(R){return y.setError(R).end(),D.e("".concat(r," failed. error:"),R),j(R)})}},{key:"getAllUserListOfMessageReaction",value:function(e){var n=this,a="getAllUserListOfMessageReaction";if(!this.canIUse(Qe.MSG_REACTION))return this.noUse(a);var r="".concat(this._n,".").concat(a),u=e.message,d=e.reactionID,_=e.nextSeq,y=e.count,M=u.ID,R=(u=u.conversationID,u="convID:".concat(u," messageID:").concat(M," reactionID:").concat(d," nextSeq:").concat(_," count:").concat(y),new ce(a)),L=(R.setMessage(u),D.l("".concat(r," ").concat(u)),{userList:[],nextSeq:0,isCompleted:!1});return M=this._createReactionUserListPack(e),this.req(M).then(function(F){var x=(x=(F=F.data).userIDList)===void 0?[]:x;return F=(F=F.nextSeq)===void 0?0:F,L.nextSeq=F,L.isCompleted=F===0,n.get(4).getUserNickAndAvatar(x)}).then(function(F){return L.userList=F,R.end(),D.l("".concat(r," ok.")),be(L)}).catch(function(F){return R.setError(F).end(),D.e("".concat(r," failed. error:"),F),j(F)})}},{key:"_createReactionOperationPack",value:function(e,n,a){var r,u,d=void 0;return n={reactionID:n,userIDList:[this.getMyUserID()]},e.conversationType===A.CONV_C2C&&(r=this.get(6),d=a===1?b.ADD_C2C_MSG_REACTION:b.RM_C2C_MSG_REACTION,n.from=e.from,n.to=e.to,n.messageKey=r.getMessageKey(e)),e.conversationType===A.CONV_GROUP&&(r=void 0,u=e.to,bt(e.to)&&(u=vn(r=e.to)),d=a===1?b.ADD_GRP_MSG_REACTION:b.RM_GRP_MSG_REACTION,n.groupID=u,n.topicID=r,n.messageSequence=e.sequence),{P:d,data:n}}},{key:"_createReactionSummaryPack",value:function(e){var n,a,r,u=e.messageList,d=(d=e.maxUserCountPerReaction)===void 0?10:d,_=e.messageIDMap,y=void 0,M=void 0;return(e=u[0]).conversationType===A.CONV_C2C&&(n=this.get(6),a=u.map(function(R){var L=n.getMessageKey(R);return _.set(L,R.ID),L}),y=b.GET_C2C_MSG_REACTIONS,M={from:e.from,to:e.to,messageKeyList:a,count:d}),e.conversationType===A.CONV_GROUP&&(a=void 0,r=e.to,bt(e.to)&&(r=vn(a=e.to)),e=u.map(function(R){return _.set(R.sequence,R.ID),R.sequence}),y=b.GET_GRP_MSG_REACTIONS,M={groupID:r,topicID:a,messageSequenceList:e,count:d}),{P:y,data:M}}},{key:"_createReactionUserListPack",value:function(e){var n=e.message,a=e.reactionID,r=e.nextSeq,u=void 0;return a={reactionID:a,nextSeq:r===void 0?0:r,count:100<(e=(e=e.count)===void 0?100:e)?100:e},n.conversationType===A.CONV_C2C&&(r=this.get(6),u=b.GET_C2C_MSG_REACTION_USER_LIST,a.from=n.from,a.to=n.to,a.messageKey=r.getMessageKey(n)),n.conversationType===A.CONV_GROUP&&(e=void 0,r=n.to,bt(n.to)&&(r=vn(e=n.to)),u=b.GET_GRP_MSG_REACTION_USER_LIST,a.groupID=r,a.topicID=e,a.messageSequence=n.sequence),{P:u,data:a}}},{key:"_handleReactionSummary",value:function(e,n){var a=this;return this.get(4).getUserNickAndAvatar(n).then(function(r){var u=[];return e.forEach(function(d){var _=[];d.reactionList.forEach(function(y){var M=y.reactionID,R=y.count,L=y.userIDList,F=(y=(y=y.reactedByMyself)===void 0?void 0:y,[]);L.forEach(function(x){r.forEach(function(K){x===K.userID&&F.push(K)})}),L={reactionID:M,totalUserCount:R,partialUserList:F,reactedByMyself:a._computeReactedByMyself({reactedByMyself:y,messageID:d.messageID,reactionID:M})},_.push(L),q(y)&&!a._reactedByMyselfMap.has(d.messageID)&&(R="".concat(d.messageID,"-").concat(M),a._reactionInfoMap.set(R,L))}),u.push({messageID:d.messageID,reactionList:_})}),u})}},{key:"_addReactedByMyselfMap",value:function(e,n){this._reactedByMyselfMap.has(e)||this._reactedByMyselfMap.set(e,[]),(e=this._reactedByMyselfMap.get(e)).indexOf(n)===-1&&e.push(n)}},{key:"_removeReactedByMyselfMap",value:function(e,n){!this._reactedByMyselfMap.has(e)||-1<(n=(e=this._reactedByMyselfMap.get(e)).indexOf(n))&&e.splice(n,1)}},{key:"_computeReactedByMyself",value:function(e){var n=e.reactedByMyself,a=e.messageID;return e=e.reactionID,q(n)?!!this._reactedByMyselfMap.has(a)&&this._reactedByMyselfMap.get(a).includes(e):n===1}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),Gs),el=(V(Ps,an),zu=ae(Ps),N(Ps,[{key:"sendMessage",value:function(e){var n=this,a=this._createMsg(e);if(a===null)return j({code:X.MSG_SEND_FAIL});this._addSendMessageTotalCount(a);var r=Date.now();return this.get(11).setMessageRandom(a),this._sendComboMessage(a,e).then(function(u){var d=(u=u.data).time,_=u.sequence;return ft(u=u.readReceiptCode)&&u!==0&&(new ce("sendMessageWithReceipt").setMessage("from:".concat(a.from," to:").concat(a.to," sequence:").concat(_," readReceiptCode:").concat(u)).end(),D.w("".concat(n._n,".sendMessage readReceiptCode:").concat(u," message:").concat(n.getErrMsg(u)))),n._addSendMessageSuccessCount(a,r),u=n.get(11),a.status=we,a.time=d,a.conversationType===A.CONV_GROUP&&(a.sequence=_),u.appendToMessageList(a),d=a,a._isExcludedFromLastMessage===!0&&(d=""),u.onMessageSent({conversationOptionsList:[{conversationID:a.conversationID,unreadCount:0,type:a.conversationType,subType:a.conversationSubType,lastMessage:d}]}),be({message:a})}).catch(function(u){return n._onSendMessageFailed(a,u)})}},{key:"_sendComboMessage",value:function(e,n){var a=this._m.get(20),r="";return e.conversationType===A.CONV_C2C&&(r="".concat(ee.NAME.OPEN_IM,".").concat(b.SEND_C2C_MSG)),e.conversationType===A.CONV_GROUP&&(r="".concat(ee.NAME.GRP,".").concat(b.SEND_GRP_MSG)),a.sendComboMessage({servcmd:r,data:n})}},{key:"_createMsg",value:function(e){var n="".concat(this._n,"._createMsg"),a=null;try{var r,u=this.getMyUserID(),d={};d.senderTinyID=this.getMyTinyID(),d.currentUser=u,d.from=e.From_Account||u,e.GroupId?(d.conversationID="".concat(A.CONV_GROUP).concat(e.GroupId),d.conversationType=A.CONV_GROUP,d.to=e.GroupId):e.To_Account&&(d.conversationID="".concat(A.CONV_C2C).concat(e.To_Account),d.conversationType=A.CONV_C2C,d.to=e.To_Account),d.time=e.MsgTimeStamp||0,d.random=e.Random||e.MsgRandom||0,d.priority=e.MsgPriority,Ee(e.CloudCustomData)&&0<e.CloudCustomData.length&&(d.cloudCustomData=e.CloudCustomData),ke(e.SendMsgControl)&&(d.messageControlInfo={},e.SendMsgControl.includes("NoUnread")&&(d.messageControlInfo.excludedFromUnreadCount=1),e.SendMsgControl.includes("NoLastMsg")&&(d.messageControlInfo.excludedFromLastMessage=1)),d.conversationType===A.CONV_GROUP&&ke(e.To_Account)&&0<e.To_Account.length&&(r=e.To_Account,50<e.To_Account.length&&(r=e.To_Account.slice(0,50),D.w("".concat(n," To_Account must be less than or equal to 50."))),d.receiverList=J(r),e.To_Account=J(r)),e.IsNeedReadReceipt!==1&&e.NeedReadReceipt!==1||(d.needReadReceipt=!0),e.SupportMessageExtension===1&&(d.isSupportExtension=!0),(a=new In(d)).status=Ae,e.MsgClientTime=a.clientTime,a.conversationType===A.CONV_C2C&&(e.MsgSeq=a.sequence);for(var _,y=e.MsgBody.length,M=0;M<y;M++)(_=e.MsgBody[M]).MsgType==="TIMTextElem"?a.setTextElement(_.MsgContent.Text):_.MsgType==="TIMCustomElem"?a.setCustomElement({data:_.MsgContent.Data||"",description:_.MsgContent.Desc||"",extension:_.MsgContent.Ext||""}):_.MsgType==="TIMFaceElem"&&a.setFaceElement({index:_.MsgContent.Index,data:_.MsgContent.Data});var R=a.getElements();a.payload=R[0].content,a.type=R[0].type}catch(L){a=null,D.e("".concat(n," failed. error:"),L)}return a}},{key:"_onSendMessageFailed",value:function(e,n){e.status=W,this.get(11).deleteMessageRandom(e),this._addSendMessageFailCountOnUser(e,n);var a=new ce("sendMessage"),r="head.seq:".concat(n.data.headSeq,"  type:").concat(e.type," from:").concat(e.from," to:").concat(e.to);return a.setMessage(r).setError(n).end(),D.e("".concat(this._n,"._onSendMessageFailed ").concat(r," error:"),n),j(new xe({code:n&&n.code?n.code:X.MSG_SEND_FAIL,message:n&&n.message?n.message:void 0,data:{message:e}}))}},{key:"_getSendMessageSpecifiedKey",value:function(e){return e.conversationType===A.CONV_C2C?Gt:e.conversationType===A.CONV_GROUP&&(e=this.get(7).getLocalGroupProfile(e.to))?Un(e=e.type)?po:Q:void 0}},{key:"_addSendMessageTotalCount",value:function(e){(e=this._getSendMessageSpecifiedKey(e))&&this.get(26).addTotalCount(e)}},{key:"_addSendMessageSuccessCount",value:function(e,n){var a;(e=this._getSendMessageSpecifiedKey(e))&&((a=this.get(26)).addSuccessCount(e),a.addCost(e,kn(n,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(e,n){n=(n=n.code)===void 0?-1:n;var a=this.get(26);e=this._getSendMessageSpecifiedKey(e),Wu(n)&&e&&a.addFailedCountOfUserSide(e)}}]),Ps),tl=(V(bs,an),Yu=ae(bs),N(bs,[{key:"registerPlugin",value:function(e){var n=this,a="0";Object.keys(e).forEach(function(r){n.plugins[r]=e[r],r==="tim-upload-plugin"&&typeof e[r].getVersion=="function"&&(a=e[r].getVersion())}),new ce("registerPlugin").setMessage("".concat(Object.keys(e))).setMoreMessage("version:".concat(a)).end()}},{key:"getPlugin",value:function(e){return this.plugins[e]}},{key:"reset",value:function(){}}]),bs),nl=(V(Ns,an),ju=ae(Ns),N(Ns,[{key:"_init",value:function(){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(e){var n=this,a=e.cookie,r=e.syncFlag,u=e.isOnlineSync,d="".concat(this._n,"._startSync"),_=(D.l("".concat(d," options:"),e),new ce("syncUnread"));_.setMessage(JSON.stringify(e)),this.req({P:b.SYNC_UNREAD_MSG,data:{cookie:a,syncFlag:r,isOnlineSync:u}}).then(function(y){var M=(R=y.data).cookie,R=R.syncFlag,L="$cookie:".concat(M," syncFlag:").concat(R);D.l("".concat(d," ok. ").concat(L)),n._cookie=M,_.setMoreMessage(L).end(),Se(M)||(R===0||R===1?(n._dispatch(g(g({},y.data),{},{isSyncingEnded:!1})),n._startSync({cookie:M,syncFlag:R,isOnlineSync:0})):R===2&&n._dispatch(g(g({},y.data),{},{isSyncingEnded:!0})))}).catch(function(y){_.setError(y).end(),D.e("".concat(d," failed. error:"),y)})}},{key:"_dispatch",value:function(e){e.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:e.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:e.isSyncingEnded}}),this.get(6).onNewMessage({dataList:e.messageList,isInstantMessage:!!e.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:e.C2CRemainingUnreadList,C2CPairUnreadList:e.C2CPairUnreadList,isSyncingEnded:e.isSyncingEnded})}},{key:"syncOnNeed",value:function(){D.l("".concat(this._n,".syncOnNeed cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"syncOnReconnected",value:function(){D.l("".concat(this._n,".syncOnReconnected cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),Ns),Os={req:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList",cmConfigID:"CustomModerationConfigID"},res:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself",Level:"messageRemindType",PeerReadTime:"timestamp",NoUnreadSeqList:"excludedUnreadSequenceList",NewMsg:"topicLatestMessage"},ignoreKeyWord:["C2C","ID","USP"]};function Ns(e){return v(this,Ns),(e=ju.call(this,e))._n="SyncUnreadMsgModule",e._cookie="",e._onlineSyncFlag=!1,e.getIEmitInst().on(Kt.A2KEY_AND_TINYID_UPDATED,e._init,de(e)),e}function bs(e){return v(this,bs),(e=Yu.call(this,e))._n="PluginModule",e.plugins={},e}function Ps(e){return v(this,Ps),(e=zu.call(this,e))._n="ComboMsgModule",e}function Gs(e){return v(this,Gs),(e=Ju.call(this,e))._n="MsgReactionModule",e._reactedByMyselfMap=new Map,e._reactionInfoMap=new Map,e}function Us(e){return v(this,Us),(e=$u.call(this,e))._n="MsgExtModule",e.msgExtMap=new Map,e.globalSeqMap=new Map,e.getMsgExtsMap=new Map,e}function ws(e){return v(this,ws),(e=Nr.call(this,e))._n="MessageModule",e._messageOptionsMap=new Map,e._mergerMessageHandler=new Wc(de(e)),e}function ga(e,n){if(typeof e!="string"&&!Array.isArray(e))throw new TypeError("Expected the input to be `string | string[]`");return n=Object.assign({pascalCase:!1},n),(e=Array.isArray(e)?e.map(function(a){return a.trim()}).filter(function(a){return a.length}).join("-"):e.trim()).length===0?"":e.length===1?n.pascalCase?e.toUpperCase():e.toLowerCase():(e=e=(e=e!==e.toLowerCase()?Fs(e):e).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(a,r){return r.toUpperCase()}).replace(/\d+(\w|$)/g,function(a){return a.toUpperCase()}),n.pascalCase?e.charAt(0).toUpperCase()+e.slice(1):e)}var Fs=function(e){for(var n=!1,a=!1,r=!1,u=0;u<e.length;u++){var d=e[u];n&&/[a-zA-Z]/.test(d)&&d.toUpperCase()===d?(e=e.slice(0,u)+"-"+e.slice(u),r=a,a=!(n=!1),u++):a&&r&&/[a-zA-Z]/.test(d)&&d.toLowerCase()===d?(e=e.slice(0,u-1)+"-"+e.slice(u-1),r=a,n=!(a=!1)):(n=d.toLowerCase()===d&&d.toUpperCase()!==d,r=a,a=d.toUpperCase()===d&&d.toLowerCase()!==d)}return e};function xs(e,n){var a=0;return function r(u,d){return 100<++a?(a--,u):ke(u)?(_=u.map(function(L){return It(L)?r(L,d):L}),a--,_):It(u)?(y=u,M=function(L,F){if(!fc(F))return!1;if(F!==ga(F))for(var x=0;x<Os.ignoreKeyWord.length&&!F.includes(Os.ignoreKeyWord[x]);x++);var K;return q(d[F])?(K=F)==="OPPOChannelID"?K:K[0].toUpperCase()+ga(K).slice(1):d[F]},R=Object.create(null),Object.keys(y).forEach(function(L){var F=M(y[L],L);F&&(R[F]=y[L])}),_=Xi(_=R,function(L,F){return ke(L)||It(L)?r(L,d):L}),a--,_):void 0;var _,y,M,R}(e,n)}for(var ha,ki=String.fromCharCode,qs=function(e){var n=0|e.charCodeAt(0);if(55296<=n)if(n<56320)if(56320<=(e=0|e.charCodeAt(1))&&e<=57343){if(65535<(n=(n<<10)+e-56613888|0))return ki(240|n>>>18,128|n>>>12&63,128|n>>>6&63,128|63&n)}else n=65533;else n<=57343&&(n=65533);return n<=2047?ki(192|n>>>6,128|63&n):ki(224|n>>>12,128|n>>>6&63,128|63&n)},li=function(e){for(var n=e===void 0?"":(""+e).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,qs),a=0|n.length,r=new Uint8Array(a),u=0;u<a;u=u+1|0)r[u]=0|n.charCodeAt(u);return r},jc=(N(Ur,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(e){this._handler.onOpen({id:this._id,res:JSON.stringify(e)})}},{key:"_onClose",value:function(e){this._handler.onClose({id:this._id,e})}},{key:"_onMessage",value:function(e){e=this._canIUseBinaryFrame?this._isAppCompressedData(e.data)?this._handler.inflate(e.data):function(n){for(var a=new Uint8Array(n),r="",u=0,d=a.length;u<d;){var _=a[u],y=0,M=0;if(_<=127?(y=0,M=255&_):_<=223?(y=1,M=31&_):_<=239?(y=2,M=15&_):_<=244&&(y=3,M=7&_),0<d-u-y)for(var R=0;R<y;)M=M<<6|63&(_=a[u+R+1]),R+=1;else M=65533,y=d-u;r+=String.fromCodePoint(M),u+=y+1}return r}(e.data):e.data,this._handler.onMessage({data:e})}},{key:"_isAppCompressedData",value:function(e){return(e=new Uint8Array(e))[0]===67&&e[1]===79&&e[2]===77&&e[3]===80}},{key:"_onError",value:function(e){this._handler.onError({id:this._id,e})}},{key:"setIsWorkerEnabled",value:function(e){this._isWorkerEnabled=!0}},{key:"close",value:function(e){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:e}),this._workerSocket.terminate(),this._workerSocket=null),Ft)return vt.offSocketClose(),vt.offSocketMessage(),vt.offSocketOpen(),vt.offSocketError(),void vt.closeSocket();this._socket&&(qe?(this._socket.onClose(function(){}),this._socket.onOpen(function(){}),this._socket.onMessage(function(){}),this._socket.onError(function(){})):(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),St?this._socket.close({code:e}):this._socket.close(e),this._socket=null)}},{key:"send",value:function(e){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?li(e.data).buffer:e.data}):Ft?vt.sendSocketMessage({data:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket&&(qe?this._socket.send({data:this._canIUseBinaryFrame?li(e.data).buffer:e.data,fail:function(){e.fail&&e.requestID&&e.fail(e.requestID)}}):this._socket.send(this._canIUseBinaryFrame?li(e.data):e.data))}}]),Ur),md=["keyMap"],vd=["keyMap"],Ai="connected",Vs="connecting",_a="disconnected",br=(N(Bs,[{key:"_setWebsocketHost",value:function(){var e=this._chM.get(12);this._currentSite=He,this._chM.isOversea()&&(this._currentSite="OVERSEA"),e.isSingaporeSite()?this._currentSite="SINGAPORE":e.isKoreaSite()?this._currentSite="KOREA":e.isGermanySite()?this._currentSite="GERMANY":e.isIndiaSite()?this._currentSite="IND":e.isJapanSite()?this._currentSite="JPN":e.isUSASite()?this._currentSite="USA":e.isIndonesiaSite()&&(this._currentSite="INDONESIA"),ee.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){var e=this._chM.get(12).getSDKAppID()+"",n=(q(ee.HOST.CURRENT.BACKUP)?this._url=ee.HOST.CURRENT.DEFAULT:this._url===""?this._url=ee.HOST.CURRENT.DEFAULT0.replace("*",e):-1<this._url.indexOf(e)?this._url=ee.HOST.CURRENT.DEFAULT:this._url===ee.HOST.CURRENT.DEFAULT?this._url=ee.HOST.CURRENT.BACKUP:this._url===ee.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?ee.HOST.CURRENT.ANYCAST:ee.HOST.CURRENT.DEFAULT:this._url===ee.HOST.CURRENT.ANYCAST&&(ee.HOST.CURRENT.ANYCAST="",this._url=ee.HOST.CURRENT.DEFAULT),e=this._chM.get(12)).getProxyServer();Se(n)||(this._url=n),e.isTestEnv()&&(this._url=gn.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return mt&&ee.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(e){e%1==0&&(this._checkPromiseMap(),this._checkNativeAppWS())}},{key:"_checkPromiseMap",value:function(){var e=this;this._promiseMap.size!==0&&this._promiseMap.forEach(function(n,a){var r=n.reject,u=n.timestamp,d=(n=n.headSeq,15e3);a.indexOf(b.LOGIN)!==-1?d=9e4:a.indexOf(b.PING)!==-1&&(d=3e3),Date.now()-u>=d&&(D.l("".concat(e._n,"._checkPromiseMap request timeout, delete requestID:").concat(a)),e._promiseMap.delete(a),r(new xe({code:X.NETWORK_TIMEOUT,data:{headSeq:n}})),e._chM.onRequestTimeout())})}},{key:"_checkNativeAppWS",value:function(){Ct&&!this.isConnected()&&this._reConnect()}},{key:"onOpen",value:function(e){var n,a;this._readyState!==_a&&(this._onOpenTs=Date.now(),a=e.id,e=e.res,this._socketID=a,n=kn(this._startTs,!1),a="socketID:".concat(a," res:").concat(e),D.l("".concat(this._n,"._onOpen cost:").concat(n," ms. ").concat(a)),new ce("wsOnOpen").setMessage(n).setCostTime(n).setMoreMessage(a).end(),this._readyState=Ai,this._reConnectCount=0,this._resend(),this._reConnectFlag===!0&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen())}},{key:"onClose",value:function(e){var n=new ce("wsOnClose"),a=e.id,r=(e=e.e,"sourceSocketID:".concat(a," currentSocketID:").concat(this._socketID," code:").concat(e.code," reason:").concat(e.reason)),u=0;this._onOpenTs!==0&&(u=Date.now()-this._onOpenTs),n.setMessage(u).setCostTime(u).setMoreMessage(r).setCode(e.code).end(!0),D.l("".concat(this._n,"._onClose ").concat(r," onlineTime:").concat(u)),a===this._socketID&&(this._readyState=_a,u<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(e){var n=e.id,a=(e=e.e,"sourceSocketID:".concat(n," currentSocketID:").concat(this._socketID));new ce("wsOnError").setMessage(e.errMsg||JSON.stringify(e,["message","code"])).setMoreMessage(a).setLevel("error").end(!0),D.w("".concat(this._n,"._onError"),e,a),n===this._socketID&&(this._readyState=_a,this._chM.onError())}},{key:"onMessage",value:function(e){var n;try{n=JSON.parse(e.data)}catch(y){new ce("jsonParseError").setMessage(e.data).end()}if(n&&n.head){e=this._getRequestIDFromHead(n.head);var a,r,u,d,_=n.body;if(this._chM.get(30).isTRTCCommand(e)||(d=gr(n.head),_=function y(M,R){return ke(M)?M.map(function(K){return It(K)?y(K,R):K}):It(M)?(L=M,F=function(K,le){return q(R[le])?ga(le):R[le]},x={},Object.keys(L).forEach(function(K){x[F(L[K],K)]=L[K]}),Xi(x,function(K){return ke(K)||It(K)?y(K,R):K})):void 0;var L,F,x}(n.body,this._getResKeyMap(d))),D.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(_)," requestID:").concat(e," has:").concat(this._promiseMap.has(e))),this._setNextPingTs(),this._promiseMap.has(e))return a=(d=this._promiseMap.get(e)).resolve,r=d.reject,u=d.timestamp,d=d.headSeq,this._promiseMap.delete(e),this._calcRTT(u),void(_.errorCode&&_.errorCode!==0?(this._chM.onErrorCodeNotZero(_),r(new xe({code:_.errorCode,message:_.errorInfo||"",data:e.includes(b.MODIFY_C2C_MSG)||e.includes(b.MODIFY_GRP_MSG)?{elements:_.elements,messageVersion:_.messageVersion,cloudCustomData:_.cloudCustomData,headSeq:d}:{headSeq:d}}))):a(be(_)));this._chM.onMessage({head:n.head,body:_})}}},{key:"_calcRTT",value:function(e){e=Date.now()-e,this._chM.get(26).addRTT(e)}},{key:"_connect",value:function(){this._readyState!==Vs&&this._readyState!==Ai&&(this._startTs=Date.now(),this._onOpenTs=0,this._readyState=Vs,this._socket=new jc(this),this._socketID=this._socket.getID(),D.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new ce("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end())}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var e=yc(),n=((Ft||wt&&e==="windows"||Ct)&&(this._canIUseBinaryFrame=!1),-1),a=(e==="ios"?n=oc||-1:e==="android"&&(n=ac||-1),this._chM.get(12)),r=this._chM.getPlatform(),u=a.getSDKAppID();return a=a.getInstanceID(),u="sdkappid=".concat(u,"&instanceid=").concat(a,"&random=").concat(this._getRandom(),"&platform=").concat(r,"&host=").concat(e)+"&version=".concat(n,"&sdkversion=").concat("3.4.8"),sn&&(u+="&isminigame=1"),this._chM.canIUseInflate()&&(u+="&compress=gzip"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(u)}},{key:"_closeConnection",value:function(e){D.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(e),this._socketID=-1,this._socket=null,this._readyState=_a)}},{key:"_resend",value:function(){var e=this;if(D.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach(function(_,y){var M=_.uplinkData,R=_.resolve;_=_.reject,y.indexOf(b.AV_POLLING)!==-1?e._promiseMap.delete(y):(e._promiseMap.set(y,{resolve:R,reject:_,timestamp:Date.now(),uplinkData:M}),e._execute(y,M))}),0<this._simpleRequestMap.size){var n,a=Ne(this._simpleRequestMap);try{for(a.s();!(n=a.n()).done;){var r=te(n.value,2),u=r[0],d=r[1];this._execute(u,d)}}catch(_){a.e(_)}finally{a.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(e){var n=this,a=(e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.head.cs=this._calcCheckSum(e.head.servcmd,e.body),e.keyMap,oe(e,md)),r=this._getRequestIDFromHead(e.head),u=JSON.stringify(a);return new Promise(function(d,_){n._promiseMap.set(r,{resolve:d,reject:_,timestamp:Date.now(),uplinkData:u,headSeq:e.head.seq}),D.d("".concat(n._n,".send uplinkData:").concat(JSON.stringify(a)," requestID:").concat(r," readyState:").concat(n._readyState)),n._readyState!==Ai?n._reConnect():(n._execute(r,u),n._chM.get(26).addRequestCount())})}},{key:"simplySend",value:function(e){e.head.seq=this._getSequence(),e.head.reqtime=Math.floor(Date.now()/1e3),e.keyMap;var n=oe(e,vd);e=this._getRequestIDFromHead(e.head),n=JSON.stringify(n),this._readyState!==Ai?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(e,n):D.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(e,n)}},{key:"_execute",value:function(e,n){this._socket.send({data:n,fail:qe?this._onSendFail.bind(this):void 0,requestID:e})}},{key:"_onSendFail",value:function(e){D.l("".concat(this._n,"._onSendFail requestID:").concat(e)),this._chM.onSendFail()}},{key:"_getSequence",value:function(){var e;if(this._startSequence<2415919103)return e=this._startSequence,this._startSequence+=1,this._startSequence===2415919103&&(this._startSequence=mn()),e}},{key:"_getRequestIDFromHead",value:function(e){return e.servcmd+e.seq}},{key:"_getResKeyMap",value:function(e){return e=this._chM.getKeyMap(e),g(g({},Os.res),e.res)}},{key:"_reConnect",value:function(){this._readyState!==Ai&&this._readyState!==Vs&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var e="".concat(this._n,".forcedReconnect");D.l("".concat(e," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(D.w("".concat(e," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Ct?Date.now()+5e3:Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===Ai}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"getSocketID",value:function(){return this._socketID}},{key:"inflate",value:function(e){if(this._chM.canIUseInflate())return this._chM.get(37).inflate(e)}},{key:"setIsWorkerEnabled",value:function(e){D.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(e)),this._isWorkerEnabled=e}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&ti}},{key:"_getRandom",value:function(){return this._random===0&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"_calcCheckSum",value:function(e,n){if(e.indexOf(b.PING)!==-1||e.indexOf(b.LOGIN)!==-1||e.indexOf(b.LOGOUT)!==-1||e.indexOf(b.AV_POLLING)!==-1||e.indexOf(b.AV_NOAUTH_POLLING)!==-1)return 0;for(var a=li(JSON.stringify(n)),r=4294967295,u=0,d=a.length;u<d;u++){r^=a[u];for(var _=0;_<8;_++)1&~r?r>>>=1:r=r>>>1^3988292384}return(4294967295^r)>>>0}},{key:"close",value:function(){D.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=mn(),this._readyState=_a,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),Bs),Yc=function(e,n,a){return new Promise(function(r,u){var d,_,y="application/x-www-form-urlencoded;charset=UTF-8";qe?vt.request({url:n,data:a,method:e,timeout:3e3,header:{"content-type":y},success:function(M){M&&M.data&&M.data.NetCheckInfo&&D.l("".concat("getconninfo ok in"," miniapp. ret:"),M.data),r()},fail:function(){u(new xe({code:X.NETWORK_ERROR}))}}):(d=new XMLHttpRequest,_=setTimeout(function(){d.abort(),u(new xe({code:X.NETWORK_TIMEOUT}))},3e3),d.onreadystatechange=function(){d.readyState===4&&(clearTimeout(_),d.status===200||d.status===304?(d.responseText&&-1<d.responseText.indexOf("NetCheckInfo")&&D.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(d.responseText)),r()):u(new xe({code:X.NETWORK_ERROR})))},d.open(e,n,!0),d.setRequestHeader("Content-type",y),a?d.send(a):d.send())})},yd=(V(va,an),ha=ae(va),N(va,[{key:"onCheckTimer",value:function(e){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(e)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(e){this.get(20).onErrorCodeNotZero(e)}},{key:"onMessage",value:function(e){this.get(20).onMessage(e)}},{key:"send",value:function(e){return this._socketHandler?this._previousState!==A.NET_STATE_CONNECTED&&e.head.servcmd.includes(b.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(e)):this._socketHandler.send(e):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(e){var n=ee.HOST.CURRENT.STAT;return n="".concat(n,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(e.head.sdkappid,"&reqtime=").concat(Date.now()),e=JSON.stringify(e.body),Yc("POST",n,e)}},{key:"simplySend",value:function(e){return this._socketHandler?this._socketHandler.simplySend(e):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){qe&&!Ct&&this.warn("DomainNameInMP"),this._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(e){return this.get(20).getKeyMap(e)}},{key:"onRequestTimeout",value:function(){3e4<=Date.now()-this._lastDiagnoseTS&&this.diagnose()}},{key:"onSendFail",value:function(){this._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED)}},{key:"onReconnected",value:function(){D.l("".concat(this._n,".onReconnected cost:").concat(kn(this._disconnectedTS,!0,!0))),this._m.restartTimer(),this.get(20).onReconnected(kn(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(A.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){D.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(e){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var e=0<arguments.length&&arguments[0]!==void 0&&arguments[0],n=!1,a=(this._socketHandler&&(n=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(e," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(n));if(D.l("".concat(this._n,".reConnect ").concat(a)),!this._fatalErrorFlag&&this._socketHandler){if(e===!0)this._socketHandler.forcedReconnect();else{if(this._previousState===A.NET_STATE_CONNECTING&&n)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(A.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(e){this._previousState!==e&&(D.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(e)),e===A.NET_STATE_DISCONNECTED&&this._disconnectedTS===0&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=e,this.emitOEvt(me.NET_STATE_CHANGE,{state:e}))}},{key:"_ping",value:function(){var e,n=this;this._probing!==!0&&(this._probing=!0,e=this.get(20).getProtocolData({P:b.PING}),this.send(e).then(function(){n._probing=!1}).catch(function(a){n._probing=!1;var r=n.get(15).isOnline();if(D.w("".concat(n._n,"._ping failed. bOnline:").concat(r," error:"),a),a&&a.code===60002)return new ce("error").setMessage("code:".concat(a.code," message:").concat(a.message)).end(),n._fatalErrorFlag=!0,void n._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED);r?n.reConnect():n._emitNetStateChangeEvent(A.NET_STATE_DISCONNECTED)}))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"canIUseInflate",value:function(){return this._m.canIUseInflate()}},{key:"getSocketID",value:function(){if(this._socketHandler)return this._socketHandler.getSocketID()}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._lastDiagnoseTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var e=this,n=this._socketHandler.getURL(),a=n.split("/")[2];a.startsWith("ws")&&(n=n.slice(n.indexOf("info?")+5),a="https://".concat(a,"/v3/netcheck/getconninfo?").concat(n,"&reqtime=").concat(Date.now()),Yc("GET",a).catch(function(r){D.w("".concat(e._n,"._diagnoseBySSO failed. error:"),r)}))}},{key:"_diagnoseByCDN",value:function(){var e=this,n=(n=this._socketHandler.getURL()).slice(n.indexOf("info?")+5);n="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(n,"&reqtime=").concat(Date.now()),Yc("GET",n).catch(function(a){D.w("".concat(e._n,"._diagnoseByCDN failed. error:"),a)})}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._previousState=A.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0,this._lastDiagnoseTS=0}}]),va),Id=["a2","tinyid"],fa=["a2","tinyid"],zc=(N(Xc,[{key:"_fillMap",value:function(){this._map.clear();var e=this._sessionM.genCommonHead(),n=this._sessionM.genCosSpecifiedHead(),a=this._sessionM.genSSOReportHead();this._map.set(b.LOGIN,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0,customInfo:""},keyMap:{req:{deviceBrand:"InstType"},res:{InstId:"instanceID",HelloInterval:"helloInterval",RichMsgAuthKey:"authKey"}}}),this._map.set(b.LOGOUT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.LOGOUT)}),body:{type:0,isWebUniapp:0},keyMap:{req:{type:"wslogout_type"}}}),this._map.set(b.HELLO,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.HELLO)}),body:{isWebUniapp:0},keyMap:{res:{NewInstInfo:"newInstanceInfo"}}}),this._map.set(b.KICK_OTHER,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.STAT_SERVICE,".").concat(b.KICK_OTHER)}),body:{}}),this._map.set(b.COS_SIGN,{head:g(g({},n),{},{servcmd:"".concat(ee.NAME.IM_COS_SIGN,".").concat(b.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{req:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},res:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._map.set(b.COS_PRE_SIG,{head:g(g({},n),{},{servcmd:"".concat(ee.NAME.CUSTOM_UPLOAD,".").concat(b.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{req:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},res:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._map.set(b.SIMPLE_COS_PRE_SIG,{head:g(g({},n),{},{servcmd:"".concat(ee.NAME.CUSTOM_UPLOAD,".").concat(b.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{req:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},res:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._map.set(b.GET_IMAGE_INFO,{head:g(g({},n),{},{servcmd:"".concat(ee.NAME.CUSTOM_UPLOAD,".").concat(b.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{req:{imageUrl:"str_image_url"},res:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._map.set(b.GET_IP,{head:g(g({},n),{},{servcmd:"".concat(ee.NAME.CUSTOM_UPLOAD,".").concat(b.GET_IP)}),body:{domainName:""},keyMap:{req:{domainName:"str_domain"},res:{str_final_ip:"ip"}}}),this._map.set(b.VIDEO_COVER,{head:g(g({},n),{},{servcmd:"".concat(ee.NAME.CUSTOM_UPLOAD,".").concat(b.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{req:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},res:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._map.set(b.FETCH_COMMERCIAL_CONFIG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_CONFIG_MANAGER,".").concat(b.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{req:{SDKAppID:"uint32_sdkappid"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(b.PUSHED_COMMERCIAL_CONFIG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_CONFIG_MANAGER,".").concat(b.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(b.FETCH_CLOUD_CTRL_CONFIG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_CONFIG_MANAGER,".").concat(b.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{req:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(b.PUSHED_CLOUD_CTRL_CONFIG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_CONFIG_MANAGER,".").concat(b.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(b.OVERLOAD_NOTIFY,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OVERLOAD_PUSH,".").concat(b.OVERLOAD_NOTIFY)}),body:{},keyMap:{res:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._map.set(b.SYNC_UNREAD_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1,needCachedMsg:1},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},res:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._map.set(b.GET_PROFANITY_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_MSG_AUDIT_MGR,".").concat(b.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{req:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},res:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._map.set(b.SEND_C2C_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"}}}),this._map.set(b.SEND_GRP_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0},keyMap:{req:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID"},res:{MsgTime:"time",MsgSeq:"sequence"}}}),this._map.set(b.REVOKE_C2C_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{req:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._map.set(b.REVOKE_GRP_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{req:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._map.set(b.GET_C2C_ROAMING_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{req:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},res:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._map.set(b.MODIFY_C2C_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(b.GET_GRP_ROAMING_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{req:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},res:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._map.set(b.SET_C2C_MSG_READ,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{req:{lastMessageTime:"LastedMsgTime"}}}),this._map.set(b.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{req:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._map.set(b.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Peer_Account"},res:{MuteNotificationsList:"muteFlagList"}}}),this._map.set(b.SET_GRP_MSG_READ,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{req:{messageReadSeq:"MsgReadedSeq"}}}),this._map.set(b.SET_ALL_MSG_READ,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{req:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},res:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._map.set(b.DEL_C2C_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{req:{keyList:"MsgKeyList"}}}),this._map.set(b.DEL_GRP_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{req:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._map.set(b.TRANSLATE_TEXT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_TRANSLATE,".").concat(b.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{req:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},res:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(b.VOICE_TO_TEXT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_SPEECH,".").concat(b.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{req:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},res:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(b.MODIFY_GRP_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(b.GET_READ_RECEIPT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequence:"MsgSeq"}}}),this._map.set(b.SEND_C2C_READ_RECEIPT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{req:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._map.set(b.SEND_READ_RECEIPT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._map.set(b.GET_READ_RECEIPT_DETAIL,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{req:{sequence:"MsgSeq",count:"Num"},res:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._map.set(b.MODIFY_C2C_MSG_EXT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(b.GET_C2C_MSG_EXT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._map.set(b.MODIFY_GRP_MSG_EXT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(b.GET_GRP_MSG_EXT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._map.set(b.MSG_CLOUD_SEARCH,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.MSG_SEARCH,".").concat(b.MSG_CLOUD_SEARCH)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{req:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList"},res:{GroupID:"groupID",UserID:"userID",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(b.ADD_C2C_MSG_REACTION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(b.RM_C2C_MSG_REACTION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(b.GET_C2C_MSG_REACTIONS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._map.set(b.GET_C2C_MSG_REACTION_USER_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._map.set(b.ADD_GRP_MSG_REACTION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(b.RM_GRP_MSG_REACTION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(b.GET_GRP_MSG_REACTIONS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{res:{MsgSeq:"messageSequence"}}}),this._map.set(b.GET_GRP_MSG_REACTION_USER_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM_MSG_EXT,".").concat(b.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._map.set(b.GET_C2C_PEER_READ_TIME,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{req:{userIDList:"To_Account"},res:{ReadTime:"peerReadTimeList"}}}),this._map.set(b.PAGING_GET_CONV_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{req:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},res:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._map.set(b.DEL_CONV,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{req:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},res:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._map.set(b.CLEAR_HISTORY_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{req:{toGroupID:"ToGroupid"}}}),this._map.set(b.PIN_CONV,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{req:{itemList:"RecentContactItem"}}}),this._map.set(b.DEL_GROUP_AT_TIPS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(b.SET_CONV_CUSTOM_DATA,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(b.MARK_CONV,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(b.CREATE_CONV_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"GroupContactItem",groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(b.DEL_CONV_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{res:{GroupId:"convGroupID"}}}),this._map.set(b.RENAME_CONV_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{req:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},res:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._map.set(b.ADD_CONV_TO_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}}}),this._map.set(b.DEL_CONV_FROM_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0}}),this._map.set(b.GET_CONV_GRP_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startIndex:void 0},keyMap:{res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._map.set(b.SEARCH_CONV_GRP_MARK,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.RECENT_CONTACT,".").concat(b.SEARCH_CONV_GRP_MARK)}),body:{fromAccount:"",contactItem:void 0},keyMap:{req:{groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList",ContactResultItem:"contactItem"}}}),this._map.set(b.GET_USER_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.PROFILE,".").concat(b.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(b.UPDATE_MY_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.PROFILE,".").concat(b.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:Je.NICK,value:""},{tag:Je.GENDER,value:""},{tag:Je.ALLOWTYPE,value:""},{tag:Je.AVATAR,value:""}]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(b.GET_BL,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30}}),this._map.set(b.ADD_TO_BL,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(b.RM_FROM_BL,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(b.SET_SELF_STATUS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.SET_SELF_STATUS)}),body:{customStatus:""}}),this._map.set(b.GET_USER_STATUS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._map.set(b.SUB_USER_STATUS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(b.UNSUB_USER_STATUS,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(b.GET_FD_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{res:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._map.set(b.ADD_FD,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{req:{source:"AddSource",wording:"AddWording",type:"AddType"},res:{ResultItem:"resultList"}}}),this._map.set(b.UPDATE_FD,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{req:{snsItem:"SnsItem"},res:{ResultItem:"resultList"}}}),this._map.set(b.DEL_FD,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"DeleteType"},res:{ResultItem:"resultList"}}}),this._map.set(b.GET_FD_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{res:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._map.set(b.CHECK_FD,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"CheckType"},res:{InfoItem:"resultList"}}}),this._map.set(b.GET_FD_APPLICATION_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{res:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._map.set(b.RESPOND_FD_APPLICATION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{req:{tag:"TagName",action:"ResponseAction"},res:{ResultItem:"resultList"}}}),this._map.set(b.DEL_FD_APPLICATION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{req:{type:"PendencyType",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(b.REPORT_FD_APPLICATION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{req:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._map.set(b.CREATE_FD_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{req:{groupName:"GroupName",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(b.DEL_FD_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{req:{nameList:"GroupName"}}}),this._map.set(b.GET_FD_GRP_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{res:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._map.set(b.UPDATE_FD_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FD,".").concat(b.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{req:{oldName:"GroupOldName",newName:"GroupNewName"},res:{UpdateType:"type",ResultItem:"resultList"}}}),this._map.set(b.GET_GRP_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0,needAppDefineData:1},keyMap:{req:{memberAccount:"Member_Account"},res:{GroupIdList:"groups",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime",AppDefinedData:"groupCustomField"}}}),this._map.set(b.GET_GRP_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{req:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(b.CREATE_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{req:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},res:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._map.set(b.DISMISS_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.DISMISS_GRP)}),body:{groupID:void 0}}),this._map.set(b.UPDATE_GRP_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{req:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},res:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(b.APPLY_JOIN_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{req:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},res:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._map.set(b.APPLY_JOIN_GRP_NOAUTH,(e.a2,e.tinyid,{head:g(g({},oe(e,Id)),{},{servcmd:"".concat(ee.NAME.BIG_GRP_NO_AUTH,".").concat(b.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{req:{applyMessage:"ApplyMsg"},res:{HugeGroupFlag:"avChatRoomFlag"}}})),this._map.set(b.QUIT_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.QUIT_GRP)}),body:{groupID:void 0}}),this._map.set(b.SEARCH_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}}}),this._map.set(b.CHANGE_GRP_OWNER,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{req:{newOwnerID:"NewOwner_Account"}}}),this._map.set(b.HANDLE_GRP_APPLICATION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(b.HANDLE_INVITE_JOIN_GRP,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._map.set(b.HANDLE_GRP_INVITATION,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(b.GET_GRP_PENDENCY,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{req:{handleAccount:"Handle_Account"},res:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._map.set(b.DEL_GRP_SYSTEM_NOTICE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(b.AV_POLLING,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.BIG_GRP_POLLING,".").concat(b.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._map.set(b.AV_NOAUTH_POLLING,(e.a2,e.tinyid,{head:g(g({},oe(e,fa)),{},{servcmd:"".concat(ee.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(b.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._map.set(b.GET_ONLINE_MBR_NUM,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{res:{OnlineMemberNum:"memberCount"}}}),this._map.set(b.SET_GRP_ATTR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(b.MODIFY_GRP_ATTR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(b.DEL_GRP_ATTR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key"}}}),this._map.set(b.CLEAR_GRP_ATTR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._map.set(b.GET_GRP_ATTR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_ATTR,".").concat(b.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{req:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._map.set(b.GET_GRP_NOTIFY,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{req:{notifyReqList:"NotifyReqList"},res:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._map.set(b.UPDATE_GRP_COUNTER,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{req:{counterList:"GroupCounter"}}}),this._map.set(b.GET_GRP_COUNTER,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{req:{keyList:"GroupCounterKeys"}}}),this._map.set(b.CREATE_TOPIC,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_COMMUNITY,".").concat(b.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{req:{avatar:"FaceUrl"}}}),this._map.set(b.DEL_TOPIC,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_COMMUNITY,".").concat(b.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{req:{topicIDList:"TopicIdList"},res:{DestroyResultItem:"resultList"}}}),this._map.set(b.UPDATE_TOPIC_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_COMMUNITY,".").concat(b.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{req:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._map.set(b.GET_TOPIC_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_COMMUNITY,".").concat(b.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{req:{topicIDList:"TopicIdList"},res:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence"}}}),this._map.set(b.GET_GRP_MBR_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._map.set(b.GET_AV_MBR_LIST,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_AV,".").concat(b.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{req:{offset:"Timestamp",filter:"Mark"},res:{NextTimestamp:"offset"}}}),this._map.set(b.GET_GRP_MBR_PROFILE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._map.set(b.ADD_GRP_MBR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{req:{userID:"Member_Account",userIDList:"MemberList"},res:{MemberList:"members"}}}),this._map.set(b.DEL_GRP_MBR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{req:{userIDList:"MemberToDel_Account"}}}),this._map.set(b.BAN_AV_MBR,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{req:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._map.set(b.MODIFY_GRP_MBR_INFO,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP,".").concat(b.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{req:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._map.set(b.MARK_AV_MBR_INFO,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.GRP_AV,".").concat(b.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{req:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},res:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._map.set(b.SSO_STAT,{head:g(g({},a),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STAT,".").concat(b.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{req:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._map.set(b.PING,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.HEARTBEAT,".").concat(b.PING)}),body:{}}),this._map.set(b.MSG_PUSH,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_PUSH,".").concat(b.MSG_PUSH)}),body:{},keyMap:{res:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}),this._map.set(b.MULTI_MSG_PUSH,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_PUSH,".").concat(b.MULTI_MSG_PUSH)}),body:{},keyMap:{res:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._map.set(b.MSG_PUSH_ACK,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OPEN_IM,".").concat(b.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{req:{sessionData:"SessionData"}}}),this._map.set(b.STATUS_FORCE_OFFLINE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{res:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._map.set(b.DOWNLOAD_MERGER_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_LONG_MSG,".").concat(b.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{res:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._map.set(b.UPLOAD_MERGER_MSG,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_LONG_MSG,".").concat(b.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._map.set(b.FOLLOW,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FOLLOW,".").concat(b.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"FollowItem"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(b.UNFOLLOW,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FOLLOW,".").concat(b.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(b.GET_FOLLOW_INFO,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FOLLOW,".").concat(b.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._map.set(b.GET_FOLLOW,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FOLLOW,".").concat(b.GET_FOLLOW)}),body:{fromAccount:"",type:1,nextCursor:"",count:500},keyMap:{req:{type:"FollowType",nextCursor:"StartCursor",count:"WantNum"},res:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._map.set(b.CHECK_FOLLOW_TYPE,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.FOLLOW,".").concat(b.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(b.SET_TOKEN,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{req:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._map.set(b.STAT_FOREGROUND,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._map.set(b.STAT_BACKGROUND,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_OPEN_STATUS,".").concat(b.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{req:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._map.set(b.PUSH_REPORT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.OFFLINE_PUSH_REPORT,".").concat(b.PUSH_REPORT)}),body:{eventList:[]},keyMap:{req:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}}),this._map.set(b.SET_ALL_RECEIVE_MSG_OPT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_MSG_LOGIC,".").concat(b.SET_ALL_RECEIVE_MSG_OPT)}),body:{startTime:0,endTime:0,isRepeated:0,messageRemindType:0},keyMap:{req:{messageRemindType:"Level"}}}),this._map.set(b.GET_ALL_RECEIVE_MSG_OPT,{head:g(g({},e),{},{servcmd:"".concat(ee.NAME.IM_MSG_LOGIC,".").concat(b.GET_ALL_RECEIVE_MSG_OPT)}),body:{toAccount:void 0}})}},{key:"has",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"update",value:function(){this._fillMap()}},{key:"getKeyMap",value:function(e){return this.has(e)?this.get(e).keyMap||{}:(D.w("".concat(this._n,".getKeyMap unknown P:").concat(e)),{})}},{key:"getProtocolData",value:function(e){var n=e.P,a=e.data;if(e=this.get(n),n=null,a){var r,u=this._simpleDeepCopy(e),d=(u=this._updateService(a,u)).body,_=Object.create(null);for(r in d)if(Object.prototype.hasOwnProperty.call(d,r)){if(_[r]=d[r],a[r]===void 0)continue;_[r]=a[r]}u.body=_,n=this._getUplinkData(u)}else n=this._getUplinkData(e);return n}},{key:"_getUplinkData",value:function(e){var n=gr((e=this._dataCleaner(e)).head);return n=xs(e.body,this._getReqKeyMap(n)),e.body=n,e}},{key:"_updateService",value:function(e,n){var a,r,u=gr(n.head);return this._isFromGroupRequest(n)&&(a=e.type,r=e.groupID,e=(e=e.groupIDList)===void 0?[]:e,q(r=r===void 0?void 0:r)&&(r=e[0]||""),Vt({type:a,groupID:r})&&(n.head.servcmd="".concat(ee.NAME.GRP_COMMUNITY,".").concat(u))),n}},{key:"_isFromGroupRequest",value:function(e){return e.head.servcmd.includes(ee.NAME.GRP)||e.head.servcmd.includes(ee.NAME.GRP_ATTR)}},{key:"_getReqKeyMap",value:function(e){return e=this.getKeyMap(e),g(g({},Os.req),e.req)}},{key:"_dataCleaner",value:function(e){var n,a=Array.isArray(e)?[]:Object.create(null);for(n in e)Object.prototype.hasOwnProperty.call(e,n)&&fc(n)&&e[n]!==null&&e[n]!==void 0&&(T(e[n])!=="object"?a[n]=e[n]:a[n]=this._dataCleaner.bind(this)(e[n]));return a}},{key:"_simpleDeepCopy",value:function(e){for(var n,a=Object.keys(e),r={},u=0,d=a.length;u<d;u++)ke(e[n=a[u]])?r[n]=Array.from(e[n]):It(e[n])?r[n]=this._simpleDeepCopy(e[n]):r[n]=e[n];return r}}]),Xc),ma=[b.MSG_PUSH_ACK],Md=(N($c,[{key:"_onC2CMsgArray",value:function(e){var n=this._sessionM.get(6);e.dataList.forEach(function(a){var r;a.isSyncMessage===1&&(r=a.from,a.from=a.to,a.to=r)}),e.needSync===1&&this._sessionM.get(19).syncOnNeed(),n.onNewMessage({dataList:e.dataList,isInstantMessage:!0})}},{key:"_onC2CMsgModified",value:function(e){this._sessionM.get(6).onMsgModified(e)}},{key:"_onGroupMsgArray",value:function(e){var n=this._sessionM.get(7);n&&n.onNewMessage({event:e.event,dataList:e.dataList,isInstantMessage:!0})}},{key:"_onGroupMsgModified",value:function(e){var n=this._sessionM.get(7);n&&n.onMsgModified(e)}},{key:"_onGroupTips",value:function(e){var n=this._sessionM.get(7);if(n){var a=e.event,r=e.dataList,u=e.isInstantMessage,d=u===void 0||u,_=e.isSyncingEnded;switch(a){case 4:case 6:n.onNewGroupTips({event:a,dataList:r});break;case 5:for(var y=0;y<r.length;y++)if(ke(r[y].elements.revokedInfos))n.onMsgRevoked({dataList:r});else if(ke(r[y].elements.groupMessageReadNotice))n.onMsgReadNotice({dataList:r});else{if(!ke(r[y].elements.readReceiptList)){n.onNewGroupSystemNotice({dataList:r,isInstantMessage:d,isSyncingEnded:_});break}n.onReadReceiptList({dataList:r})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:r});break;default:D.l("".concat(this._n,"._onGroupTips unknown event:").concat(a," dataList:"),r)}}}},{key:"_onC2CNotifyMsgArray",value:function(e){var n,a=this,r=e.dataList;ke(r)&&(n=this._sessionM.get(6),r.forEach(function(u){var d,_;ye(u)&&(u.hasOwnProperty("kickoutMsgNotify")?(d=(_=u.kickoutMsgNotify).kickType,_=(_=_.newInstanceInfo)===void 0?{}:_,d===1?a._sessionM.onMultipleAccountKickedOut(_):d===2?a._sessionM.onMultipleDeviceKickedOut(_):d===3&&a._sessionM.onRestApiKickedOut(_)):u.hasOwnProperty("c2cMessageRevokedNotify")?n&&n.onMsgRevoked({dataList:r}):u.hasOwnProperty("c2cMessageReadReceipt")?n&&n.onMsgReadReceipt({dataList:r}):u.hasOwnProperty("c2cMessageReadNotice")?n&&n.onMsgReadNotice({dataList:r}):u.hasOwnProperty("muteNotificationsSync")&&a._sessionM.get(11).onC2CMsgRemindTypeSynced({dataList:r}))}))}},{key:"_onC2CReadReceiptArray",value:function(e){this._sessionM.get(6).onReadReceiptList(e)}},{key:"_onProfileModified",value:function(e){this._sessionM.get(4).onProfileModified({dataList:e.dataList});var n=this._sessionM.get(8);n&&n.onFriendProfileModified({dataList:e.dataList})}},{key:"_onRelationChainModified",value:function(e){this._sessionM.get(4).onRelationChainModified({dataList:e.dataList});var n=this._sessionM.get(8);n&&n.onRelationChainModified({dataList:e.dataList})}},{key:"_onRecentContact",value:function(e){var n;!ke(e=e.dataList)||(n=this._sessionM.get(11))&&e.forEach(function(a){var r,u,d=a.pushType;d===1?(r=a.recentContactDeleteItem,n.onConvDeleted(r.recentContactList)):d===2?(r=a.recentContactTopItem,n.onConvPinnedStatus(r.recentContactList,!0)):d===3?(r=a.recentContactTopItem,n.onConvPinnedStatus(r.recentContactList,!1)):d===4?(r=a.recentContactMarkContact,n.onConvMarkUpdated(r.recentContactMarkContactItem)):d===5?(r=a.recentContactCreateContactGroup,n.onConvGroupCreated(r.msgContactGroupContactItem)):d===6?(r=a.recentContactDelContactGroup,n.onConvGroupDeleted(r.msgGroupItem)):d===7&&(d=(r=a.recentContactUpdateContactGroup).updateType,a=r.msgUpdateGroup,r=r.msgUpdateContact,d===1?(u=a.updateGroupType)===1?n.onConvGroupNameUpdated(a):u===2&&n.onConvInGroupUpdated(a):d===2&&n.onConvAddedToOrDeletedFromGroup(r))})}},{key:"_onAllMsgRead",value:function(e){e=e.dataList;var n=this._sessionM.get(11);n&&n.onPushedAllMessageRead(e)}},{key:"_onUserStatusList",value:function(e){this._sessionM.get(4).onUserStatusUpdated(e)}},{key:"_onMsgExtNotify",value:function(e){this._sessionM.get(3).onMsgExtNotify(e)}},{key:"_onMsgReactionNotifyList",value:function(e){this._sessionM.get(34).onReactionNotifyList(e)}},{key:"_onMsgReactionNotify",value:function(e){this._sessionM.get(34).onReactionNotify(e)}},{key:"_onFollowNotify",value:function(e){this._sessionM.get(35).onFollowNotify(e)}},{key:"_onTopicLatestMsg",value:function(e){this._sessionM.get(10).onTopicLatestMsg(e)}},{key:"onMessage",value:function(e){var n=this,a=e.body;if(this._filterMsgFromIMOpenPush(e)){var r,u=a.eventArray,d=a.isInstantMessage,_=a.isSyncingEnded,y=a.needSync;if(ke(u))for(var M,R,L,F=0,x=u.length;F<x;F++)(L=(M=u[F]).event)!==100?L!==24?L!==26?(r=Object.keys(M).find(function(K){return n._keys.indexOf(K)!==-1}))?(R=L===14?{readAllC2CMessage:M[r],groupMessageReadInfoList:M.groupMessageReadNotice||[]}:L===16?{userID:M.userID,timestamp:M.timestamp,readReceiptList:M[r]}:M[r],this._eventHandlerMap.get(r)({event:L,dataList:R,isInstantMessage:d,isSyncingEnded:_,needSync:y})):D.l("".concat(this._n,".onMessage unknown eventItem:"),M):this._onTopicLatestMsg(M):this._onAllRcvMsgOptNotify(M):this._onRoomCustomData(M.content)}}},{key:"_onRoomCustomData",value:function(e){this._sessionM.get(30).onRoomCustomDataReceived(e),D.l("".concat(this._n,"._onRoomCustomData data:").concat(e))}},{key:"_onAllRcvMsgOptNotify",value:function(e){this._sessionM.get(11).onAllRcvMsgOptNotify(e)}},{key:"_filterMsgFromIMOpenPush",value:function(e){var n=e.head,a=(e=e.body,n=n.servcmd,!1);return!(a=q(n)?a:n.includes(ee.NAME.IM_CONFIG_MANAGER)||n.includes(ee.NAME.OVERLOAD_PUSH)||n.includes(ee.NAME.STAT_SERVICE))||(n.includes(b.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedConfig(e):n.includes(b.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(e):n.includes(b.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(e):n.includes(b.KICK_OTHER)&&(a=Date.now(),this._sessionM.reLoginOnKickOther(),e=new ce("kickOther"),a-=n=this._sessionM.get(1).getLastWsHelloTs(),e.setMessage("last wshello time:".concat(n," diff:").concat(a,"ms")).end()),!1)}}]),$c),Pr=[{cmd:b.GET_GRP_PROFILE,interval:1,count:8},{cmd:b.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:b.GET_AV_MBR_LIST,interval:3,count:1},{cmd:b.GET_GRP_PENDENCY,interval:1,count:15},{cmd:b.GET_TOPIC_LIST,interval:1,count:10},{cmd:b.SET_GRP_ATTR,interval:5,count:10},{cmd:b.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:b.DEL_GRP_ATTR,interval:5,count:10},{cmd:b.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:b.GET_GRP_ATTR,interval:5,count:20},{cmd:b.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:b.GET_GRP_COUNTER,interval:5,count:20},{cmd:b.SET_ALL_MSG_READ,interval:1,count:1},{cmd:b.GET_USER_STATUS,interval:5,count:20},{cmd:b.SUB_USER_STATUS,interval:5,count:20},{cmd:b.UNSUB_USER_STATUS,interval:5,count:20},{cmd:b.MSG_CLOUD_SEARCH,interval:1,count:2},{cmd:b.CHECK_FOLLOW_TYPE,interval:5,count:20},{cmd:b.GET_GRP_ROAMING_MSG,interval:1,count:20},{cmd:b.GET_C2C_ROAMING_MSG,interval:1,count:20}],Jc=new Map,ol=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],Gr=0,Cd=ol.length;Gr<Cd;Gr++)Jc.set(Gr,ol[Gr]);function $c(e){v(this,$c),this._sessionM=e,this._n="MsgDispatcher",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._onC2CMsgArray.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._onGroupMsgArray.bind(this)),this._eventHandlerMap.set("groupTips",this._onGroupTips.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._onC2CNotifyMsgArray.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._onC2CReadReceiptArray.bind(this)),this._eventHandlerMap.set("profileModify",this._onProfileModified.bind(this)),this._eventHandlerMap.set("friendListMod",this._onRelationChainModified.bind(this)),this._eventHandlerMap.set("recentContactMod",this._onRecentContact.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._onAllMsgRead.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._onC2CMsgModified.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._onGroupMsgModified.bind(this)),this._eventHandlerMap.set("userStatusList",this._onUserStatusList.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._onMsgExtNotify.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._onMsgReactionNotifyList.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._onMsgReactionNotify.bind(this)),this._eventHandlerMap.set("followChangeList",this._onFollowNotify.bind(this)),this._keys=J(this._eventHandlerMap.keys())}function Xc(e){v(this,Xc),this._n="PHandler",this._sessionM=e,this._map=new Map,this._fillMap()}function va(e){return v(this,va),(e=ha.call(this,e))._n="ChannelModule",e._socketHandler=new br(de(e)),e._probing=!1,e._isAppShowing=!0,e._previousState=A.NET_STATE_CONNECTED,e._timerForNotLoggedIn=-1,e._timerForNotLoggedIn=setInterval(e.onCheckTimer.bind(de(e)),1e3),e._fatalErrorFlag=!1,e._disconnectedTS=0,e._lastDiagnoseTS=0,e}function Bs(e){v(this,Bs),this._chM=e,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=_a,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=mn(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=He,this._setWebsocketHost(),this._initConnection()}function Ur(e){v(this,Ur);var n,a,r=(this._handler=e).getURL();this._socket=null,this._workerSocket=null,this._id=mn(),this._handler.getIsWorkerEnabled()?(n=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen", extensions: _socket.extensions });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(n),(a=this)._workerSocket.onmessage=function(u){var d=(y=u.data).callback,_=y.e,y=y.extensions;d==="onOpen"?a._onOpen(y):d==="onClose"?a._onClose(_):d==="onError"?a._onError(_):d==="onMessage"&&a._onMessage(u.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:r})):qe?Ft?(vt.connectSocket({url:r,header:{"content-type":"application/json"}}),vt.onSocketClose(this._onClose.bind(this)),vt.onSocketOpen(this._onOpen.bind(this)),vt.onSocketMessage(this._onMessage.bind(this)),vt.onSocketError(this._onError.bind(this))):(this._socket=vt.connectSocket({url:r,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):(this._socket=new WebSocket(r),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this,this._socket.extensions),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=e.canIUseBinaryFrame()}function ya(e){for(var n,a,r=e,u="",d=0,_=(r=e.length%8!=0?"0".repeat(8-e.length%8)+e:r).length;d<_;d+=8)n=parseInt(r.slice(d,d+4),2),a=parseInt(r.slice(d+4,d+8),2),u+=Jc.get(n)+Jc.get(a);return u}function Td(e){if(e<0||53<e)return NaN;var n=0|1073741824*Math.random();return 30<e?n+1073741824*(0|Math.random()*(1<<e-30)):n>>>30-e}function Qc(e,n){for(var a=e.toString(16),r=n-a.length,u="0";0<r;r>>>=1,u+=u)1&r&&(a=u+a);return a}V(Vi,an),nu=ae(Vi),N(Vi,[{key:"_init",value:function(){this._updateCmdFreqLimitMap(Pr)}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("cmd_frequency_limit");q(e)||(e=JSON.parse(e),this._updateCmdFreqLimitMap(e))}},{key:"_updateCmdFreqLimitMap",value:function(e){var n=this;e.forEach(function(a){n._cmdFreqLimitMap.set(a.cmd,{interval:a.interval,count:a.count})})}},{key:"updateProtocolConfig",value:function(){this._pHandler.update()}},{key:"req",value:function(e){D.d("".concat(this._n,".req options:"),e);var n=e.P;if(!this._pHandler.has(n))return D.w("".concat(this._n,".req unknown P:").concat(n)),j({code:X.NO_PROTOCOL});var a=(e=this.getProtocolData(e)).head.servcmd;if(this._isFreqOverLimit(a))return j({code:r=X.OVER_FREQUENCY_LIMIT,message:this.getErrMsg(r,this._getCmd(a))});if(this._isServerOverload(a))return j({code:r=X.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrMsg(r,this._getCmd(a))});var r=this.get(21);return ma.includes(n)?r.simplySend(e):r.send(e)}},{key:"getKeyMap",value:function(e){return this._pHandler.getKeyMap(e)}},{key:"genCommonHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:dt,websdkversion:pt,a2:e.getA2Key()||void 0,tinyid:e.getTinyID()||void 0,status_instid:e.getStatusInstanceID(),sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getA2Key()?void 0:e.getUserID(),usersig:e.getA2Key()?void 0:e.getUserSig(),sdkability:12775283,sdkability_ext:ya(""),cappid:e.getApplicationID(),cs:0}}},{key:"genCosSpecifiedHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:dt,websdkversion:pt,sdkappid:e.getSDKAppID(),contenttype:e.getContentType(),reqtime:0,identifier:e.getUserID(),usersig:e.getUserSig(),status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:ya(""),cappid:e.getApplicationID(),cs:0}}},{key:"genSSOReportHead",value:function(){var e=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:dt,websdkversion:pt,sdkappid:e.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:e.getStatusInstanceID(),sdkability:12775283,sdkability_ext:ya(""),cappid:e.getApplicationID(),cs:0}}},{key:"getProtocolData",value:function(e){return this._pHandler.getProtocolData(e)}},{key:"trans",value:function(e){var n=e.servcmd;return e=e.data,n={head:g(g({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"sendComboMessage",value:function(e){var n=e.servcmd;return e=e.data,n={head:g(g({},this.genCommonHead()),{},{servcmd:n}),body:e},this.get(21).send(n)}},{key:"onErrorCodeNotZero",value:function(e){var n,a=e.errorCode;a===X.HELLO_ANSWER_KICKED_OUT&&(n=e.kickType,e=(e=e.newInstanceInfo)===void 0?{}:e,n===1?this.onMultipleAccountKickedOut(e):n===2?this.onMultipleDeviceKickedOut(e):n===3&&this.onRestApiKickedOut(e)),a!==X.MSG_A2KEY_EXPIRED&&a!==X.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(e){var n=(a=e.body).needAck,a=a.sessionData;(n===void 0?0:n)===1&&this._sendACK(a),this._msgDispatcher.onMessage(e)}},{key:"onReconnected",value:function(e){this._incrementalPullContactFlag=e<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){D.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){D.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var e,n,a,r=this,u="".concat(this._n,"._reLogin");this.isLoggedIn()&&(e=0,(n=this.get(1).getPushModule())&&(e=n.getUniAppPlatform()),a=new ce("reLogin"),this.req({P:b.LOGIN,data:{isWebUniapp:e,customInfo:this.get(12).getCustomLoginInfo()}}).then(function(d){var _=(d=d.data).instanceID,y=(d=d.customStatus,r.get(12)),M=Mr(d),R=(y.setStatusInstanceID(_),r.get(21)),L=R.getSocketID();L="socketID:".concat(L," instanceID:").concat(_," customStatus:").concat(M),a.setMessage(L).end(!0),D.l("".concat(u," ok. ").concat(L)),y.getCustomStatus()!==M&&r.get(4).onUserStatusUpdated({dataList:[{to:r.getMyUserID(),statusType:A.USER_STATUS_ONLINE,customStatus:d}]}),R.diagnose(),r.get(11).syncConvList(r._incrementalPullContactFlag).then(function(){D.l("".concat(u,", sync conv list ok.")),r.get(25).start()}),((_=r.get(7))&&_.updateLocalMainSequenceOnReconnected(),L=r.get(10)).resetGetTopicTime(),L.getTopicListOnReconnected(),(y=r.get(35))&&y.clearCacheOnReconnected()}))}},{key:"onMultipleAccountKickedOut",value:function(e){this.get(1).onMultipleAccountKickedOut(e)}},{key:"onMultipleDeviceKickedOut",value:function(e){this.get(1).onMultipleDeviceKickedOut(e)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(e){this.get(1).onRestApiKickedOut(e)}},{key:"_sendACK",value:function(e){this.req({P:b.MSG_PUSH_ACK,data:{sessionData:e}})}},{key:"_isFreqOverLimit",value:function(e){if(e=e.split(".")[1],!this._cmdFreqLimitMap.has(e))return!1;if(!this._cmdReqInfoMap.has(e))return this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1;var n=(a=this._cmdFreqLimitMap.get(e)).count,a=a.interval,r=(u=this._cmdReqInfoMap.get(e)).startTime,u=u.requestCount;return Date.now()-r>1e3*a?(this._cmdReqInfoMap.set(e,{startTime:Date.now(),requestCount:1}),!1):(this._cmdReqInfoMap.set(e,{startTime:r,requestCount:u+=1}),n<u)}},{key:"_isServerOverload",value:function(e){if(!this._serverOverloadInfoMap.has(e))return!1;var n=(a=this._serverOverloadInfoMap.get(e)).overloadTime,a=a.waitingTime;return Date.now()-n<=1e3*a||(this._serverOverloadInfoMap.delete(e),!1)}},{key:"_getCmd",value:function(e){var n="";if(!e.includes("."))return n;var a,r=e.split(".")[1];for(a in b)if(b[a]===r){n=a;break}return n}},{key:"onPushedServerOverload",value:function(e){var n=e.overloadCommand;e=e.waitingTime,this._serverOverloadInfoMap.set(n,{overloadTime:Date.now(),waitingTime:e}),D.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(e,"s cmd:").concat(this._getCmd(n)))}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._updateCmdFreqLimitMap(Pr),this._cmdReqInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var wr,Ia,Fr,xr,qr,il,al,Zc,eu,tu,nu,sl=Vi,rl=(V(qi,an),tu=ae(qi),N(qi,[{key:"getCloudConfig",value:function(e){return q(e)?this._cloudConfig:this._cloudConfig.has(e)?this._cloudConfig.get(e):void 0}},{key:"getServerConfig",value:function(e){var n={code:0,data:""};return!q(e)&&this._cloudConfig.has(e)&&(n.data=this._cloudConfig.get(e)),Promise.resolve(n)}},{key:"_canFetch",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var e,n=this,a="".concat(this._n,".fetchConfig"),r=this._canFetch();D.l("".concat(a," canFetch:").concat(r)),r&&(e=new ce("fetchCloudCtrlConfig"),r=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({P:b.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:r,version:this._version}}).then(function(u){n._isFetching=!1;var d=(_=u.data).version,_=_.cloudControlConfig;e.setMessage("version:".concat(n._version," newVersion:").concat(d," config:").concat(_)).end(),D.l("".concat(a," ok")),n._parse(u.data)}).catch(function(u){n._isFetching=!1,e.setError(u).end(),D.l("".concat(a," failed. error:"),u),n._setExpiredTime(12e4)}))}},{key:"onPushedConfig",value:function(e){D.l("".concat(this._n,".onPushedConfig config:"),e),new ce("pushedCloudCtrlConfig").setMessage("newVersion:".concat(e.version," config:").concat(e.cloudControlConfig)).end(),this._parse(e)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"_parse",value:function(e){var n=this,a="".concat(this._n,"._parse"),r=e.errorCode,u=e.errorMessage,d=e.cloudControlConfig,_=e.version,y=e.expiredTime;if(r===0){if(this._version!==_){var M=null;try{M=JSON.parse(d)}catch(R){this.isPrivateNetWork()||D.e("".concat(a," failed. config:"),d)}M&&(this._cloudConfig.clear(),Object.keys(M).forEach(function(R){n._cloudConfig.set(R,M[R])}),this._version=_,this.emitIEvt(Kt.CLOUD_CONFIG))}this._setExpiredTime(1e3*y)}else q(r)?(D.l("".concat(a," failed. Invalid message format:"),e),this._setExpiredTime(36e5)):(D.e("".concat(a," errorCode:").concat(r," errorMessage:").concat(u)),this._setExpiredTime(12e4))}},{key:"_setExpiredTime",value:function(e){this._expiredTime=Date.now()+e}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),qi),cl=(V(xi,an),eu=ae(xi),N(xi,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var e,n,a,r,u=this,d=this._getLocalConvList().filter(function(M){return M.type===A.CONV_GROUP&&M.groupProfile.type!==A.GRP_AVCHATROOM}),_=this.get(11),y=[];d.forEach(function(M){var R=M.conversationID;M=M.lastMessage,e=R.replace(A.CONV_GROUP,""),n=_.getLocalLastMessage(R),M&&M.lastSequence!==0&&n?(a=M.lastSequence,n=n.sequence,r=a-n,0<n&&1<=r&&r<300?u._recoverGroupMsg({groupID:e,localLastMessageSequence:n,remoteLastMessageSequence:a}):y.push(e)):y.push(e)}),this._getGroupNotice(y)}},{key:"_recoverC2CChat",value:function(){var e,n,a,r=this,u=this._getLocalConvList().filter(function(y){return y.type===A.CONV_C2C}),d=this.get(11),_=[Promise.resolve()];u.forEach(function(y){var M=y.conversationID;y=y.lastMessage,e=d.getLocalLastMessage(M),y&&y.lastTime!==0&&e&&(n=y.lastTime,e=e.time,a=n-e,0<e&&1<=a&&a<=600&&_.push(r._recoverC2CMsg({conversationID:M,localLastMessageTime:e,remoteLastMessageTime:n})))}),Promise.all(_).then(function(){D.l("".concat(r._n,"._recoverC2CChat all done")),r.get(19).syncOnReconnected()})}},{key:"_getLocalConvList",value:function(){return this.get(11).getLocalConvList()}},{key:"_recoverGroupMsg",value:function(e){var n=this,a="".concat(this._n,".").concat("_recoverGroupMsg"),r=(D.l("".concat(a," options:"),e),e.groupID),u=e.localLastMessageSequence,d=e.remoteLastMessageSequence,_=JSON.stringify(e),y=new ce("_recoverGroupMsg");y.setMessage(_),this._getGroupRoamingMsg({groupID:r,sequence:u}).then(function(M){var R=(M=M.data).complete,L=M.messageList;if(!q(L)){M=L[0].sequence;var F=L.map(function(ie){return ie.sequence}),x=(F="".concat(_," complete:").concat(R," sequenceList:").concat(F),D.l("".concat(a," ").concat(F)),M!==u&&M<d&&R!==2&&n._recoverGroupMsg({groupID:r,localLastMessageSequence:M,remoteLastMessageSequence:d}),y.setMessage(F).end(),n.get(7));1<L.length&&L.sort(function(ie,t){return ie.sequence-t.sequence});for(var K=!1,le=0,he=L.length;le<he;le++)if(L[le].from===A.CONV_SYSTEM){K=!0;break}if(K)for(var fe=0,Fe=L.length;fe<Fe;fe++){var Re=L[fe];Re.from!==A.CONV_SYSTEM?x.onNewMessage({dataList:[Re],isInstantMessage:!1,updateUnreadCount:!1}):x.onNewGroupTips({event:Re.event,dataList:[Re]})}else x.onNewMessage({dataList:L,isInstantMessage:!1,updateUnreadCount:!1})}}).catch(function(M){y.setError(M).end(),D.w("".concat(a," failed. error:"),M)})}},{key:"_getGroupNotice",value:function(e){var n=e.length;if(D.l("".concat(this._n,"._getGroupNotice length:").concat(n)),n!==0){var a=this.get(7);if(n<=10)a.getNotice(e);else{var r=Math.floor(n/10);5<=r&&(r=5);for(var u=0;u<=r;u++)a.getNotice(e.slice(10*u,10*(u+1)))}}}},{key:"_getGroupRoamingMsg",value:function(e){var n=e.groupID;return e=e.sequence,this.req({P:b.GET_GRP_ROAMING_MSG,data:{groupID:n,count:this.PULL_LIMIT_COUNT,sequence:e+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMsg",value:function(e){var n=this,a="".concat(this._n,".").concat("_recoverC2CMsg"),r=(D.l("".concat(a," options:"),e),e.conversationID),u=e.localLastMessageTime,d=e.remoteLastMessageTime,_=JSON.stringify(e),y=new ce("_recoverC2CMsg");return y.setMessage(_),this._getC2CRoamingMsg({conversationID:r,time:u}).then(function(M){var R=(M=M.data).complete;if(M=M.messageList,!q(M)){var L=M.length;if(n.get(6).onNewMessage({dataList:M,isInstantMessage:!0}),L=M[L-1].time,M=M.map(function(F){return F.random}),M="".concat(_," complete:").concat(R," randomList:").concat(M),D.l("".concat(a," ").concat(M)),y.setMessage(M).end(),L<d&&R!==1)return n._recoverC2CMsg({conversationID:r,localLastMessageTime:L,remoteLastMessageTime:d})}}).catch(function(M){y.setError(M).end(),D.w("".concat(a," failed. error:"),M)})}},{key:"_getC2CRoamingMsg",value:function(e){var n=e.conversationID;return e=e.time,this.req({P:b.GET_C2C_ROAMING_MSG,data:{peerAccount:n.replace(A.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:e,direction:1}})}},{key:"reset",value:function(){D.l("".concat(this._n,".reset"))}}]),xi),ul=(N($s,[{key:"addMessageDelay",value:function(e){0<=(e=Ji()-e)&&this._e2eDelayArray.push(e)}},{key:"_calcAvg",value:function(e,n){if(n===0)return 0;var a=0;return e.forEach(function(r){a+=r}),ao(a/n,1)}},{key:"_calcCountWithLimit",value:function(e){var n=e.e2eDelayArray,a=e.min,r=e.max;return n.filter(function(u){return a<=u&&u<r}).length}},{key:"_calcPercent",value:function(e,n){return 100<(e=ao(e/n*100,2))?100:e}},{key:"_checkE2EDelayException",value:function(e,n){var a,r,u,d=e.filter(function(_){return n<_});0<d.length&&(a=d.length,r=Math.min.apply(Math,J(d)),u=Math.max.apply(Math,J(d)),d=this._calcAvg(d,a),50<(e=ao(a/e.length*100,2))&&new ce("messageE2EDelayException").setMessage("count:".concat(a," min:").concat(r," max:").concat(u," avg:").concat(d," percent:").concat(e)).setLevel("warning").end())}},{key:"getStatResult",value:function(){var e=this._e2eDelayArray.length;if(e===0)return null;var n=J(this._e2eDelayArray),a=this._calcCountWithLimit({e2eDelayArray:n,min:0,max:1}),r=this._calcCountWithLimit({e2eDelayArray:n,min:1,max:3}),u=this._calcPercent(a,e),d=this._calcPercent(r,e),_=this._calcAvg(n,e);return this._checkE2EDelayException(n,3),n.length=0,this.reset(),{totalCount:e,countLessThan1Second:a,percentOfCountLessThan1Second:u,countLessThan3Second:r,percentOfCountLessThan3Second:d,avgDelay:_}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),$s),ll=(N(Js,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(e){this._rttArray.push(e)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(e){return e.length}},{key:"_calcSuccessRateOfRequest",value:function(e,n){return n===0?0:100<(e=ao(e/n*100,2))?100:e}},{key:"_calcAvg",value:function(e,n){if(n===0)return 0;var a=0;return e.forEach(function(r){a+=r}),parseInt(a/n)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,J(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,J(this._rttArray))}},{key:"getStatResult",value:function(){var e=this._calcTotalCount(),n=J(this._rttArray);if(e===0)return null;var a=this._calcRTTCount(n),r=this._calcSuccessRateOfRequest(a,e);return n=this._calcAvg(n,a),D.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(n)),this.reset(),{totalCount:e,rttCount:a,successRateOfRequest:r,avgRTT:n}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),Js),dl=(N(Fi,[{key:"initMap",value:function(e){var n=this;e.forEach(function(a){n._map.set(a,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})})}},{key:"addTotalCount",value:function(e){return!(q(e)||!this._map.has(e)||(this._map.get(e).totalCount+=1,0))}},{key:"addSuccessCount",value:function(e){return!(q(e)||!this._map.has(e)||(this._map.get(e).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(e){return!(q(e)||!this._map.has(e)||(this._map.get(e).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(e,n){return!(q(e)||!this._map.has(e)||(this._map.get(e).costArray.push(n),0))}},{key:"addFileSize",value:function(e,n){return!(q(e)||!this._map.has(e)||(this._map.get(e).fileSizeArray.push(n),0))}},{key:"_calcSuccessRateOfBusiness",value:function(e){return q(e)||!this._map.has(e)?-1:100<(e=ao((e=this._map.get(e)).successCount/e.totalCount*100,2))?100:e}},{key:"_calcSuccessRateOfPlatform",value:function(e){if(q(e)||!this._map.has(e))return-1;var n=this._map.get(e);return 100<(e=ao(e=this._calcSuccessCountOfPlatform(e)/n.totalCount*100,2))?100:e}},{key:"_calcTotalCount",value:function(e){return q(e)||!this._map.has(e)?-1:this._map.get(e).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(e){return q(e)||!this._map.has(e)?-1:this._map.get(e).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(e){return q(e)||!this._map.has(e)?-1:(e=this._map.get(e)).successCount+e.failedCountOfUserSide}},{key:"_calcAvg",value:function(e){return q(e)||!this._map.has(e)?-1:e===P?this._calcAvgSpeed(e):this._calcAvgCost(e)}},{key:"_calcAvgCost",value:function(e){var n=this._map.get(e).costArray.length;if(n===0)return 0;var a=0;return this._map.get(e).costArray.forEach(function(r){a+=r}),parseInt(a/n)}},{key:"_calcAvgSpeed",value:function(e){var n=0,a=0;return this._map.get(e).costArray.forEach(function(r){n+=r}),this._map.get(e).fileSizeArray.forEach(function(r){a+=r}),parseInt(1e3*a/n)}},{key:"getStatResult",value:function(e){var n=this._calcTotalCount(e);if(n===0)return null;var a=this._calcSuccessCountOfBusiness(e),r=this._calcSuccessRateOfBusiness(e),u=this._calcSuccessCountOfPlatform(e),d=this._calcSuccessRateOfPlatform(e),_=this._calcAvg(e);return this.reset(e),{totalCount:n,successCountOfBusiness:a,successRateOfBusiness:r,successCountOfPlatform:u,successRateOfPlatform:d,avgValue:_}}},{key:"reset",value:function(e){q(e)?this._map.clear():this._map.set(e,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),Fi),pl=(N(wi,[{key:"initMap",value:function(e){var n=this;e.forEach(function(a){n._lastMap.set(a,new Map),n._currentMap.set(a,new Map)})}},{key:"addMessageSequence",value:function(e){var n=e.key,a=e.message;if(q(n)||!this._lastMap.has(n)||!this._currentMap.has(n))return!1;var r,u,d=a.conversationID;return a=a.sequence,d=d.replace(A.CONV_GROUP,""),this._lastMap.get(n).size!==0&&this._lastMap.get(n).has(d)?(u=(r=this._lastMap.get(n).get(d)).length-1,a>r[0]&&a<r[u]?(r.push(a),r.sort(),this._lastMap.get(n).set(d,r)):this._addCurrentMap(e)):this._addCurrentMap(e),!0}},{key:"_addCurrentMap",value:function(e){var n=e.key,a=(e=e.message).conversationID;e=e.sequence,a=a.replace(A.CONV_GROUP,""),this._currentMap.get(n).has(a)||this._currentMap.get(n).set(a,[]),this._currentMap.get(n).get(a).push(e)}},{key:"_copyData",value:function(e){if(!q(e)){this._lastMap.set(e,new Map);var n,a=this._lastMap.get(e),r=Ne(this._currentMap.get(e));try{for(r.s();!(n=r.n()).done;){var u=te(n.value,2),d=u[0],_=u[1];a.set(d,_)}}catch(y){r.e(y)}finally{r.f()}a=null,this._currentMap.set(e,new Map)}}},{key:"getStatResult",value:function(e){if(q(this._currentMap.get(e))||q(this._lastMap.get(e)))return null;if(this._lastMap.get(e).size===0)return this._copyData(e),null;var n=0,a=0;if(this._lastMap.get(e).forEach(function(u,d){var _=(u=J(u.values())).length;u=u[_-1]-u[0]+1,n+=u,a+=_}),n===0)return null;var r=ao(a/n*100,2);return 100<r&&(r=100),this._copyData(e),{totalCount:n,successCountOfMessageReceived:a,successRateOfMessageReceived:r}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),wi),Sd=(V(Ui,an),Zc=ae(Ui),N(Ui,[{key:"_onLoginSuccess",value:function(){var e=this,n=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),a=n.getItem(this.TAG,!1);!Se(a)&&Ot(a.forEach)&&(D.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(a.length)),a.forEach(function(r){e._statInfoArr.push(r)}),n.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("q_rpt_interval"),n=this.getCloudConfig("q_rpt_sdkappid_bl"),a=this.getCloudConfig("q_rpt_tinyid_wl");q(e)||(this.REPORT_INTERVAL=Number(e)),q(n)||(this.REPORT_SDKAPPID_BLACKLIST=n.split(",").map(function(r){return Number(r)})),q(a)||(this.REPORT_TINYID_WHITELIST=a.split(","))}},{key:"onCheckTimer",value:function(e){this.isLoggedIn()&&e%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(e){this._avgRTT.addRTT(e)}},{key:"addMessageDelay",value:function(e){this._avgE2EDelay.addMessageDelay(e)}},{key:"addTotalCount",value:function(e){this._rateMessageSent.addTotalCount(e)||D.w("".concat(this._n,".addTotalCount invalid key:"),e)}},{key:"addSuccessCount",value:function(e){this._rateMessageSent.addSuccessCount(e)||D.w("".concat(this._n,".addSuccessCount invalid key:"),e)}},{key:"addFailedCountOfUserSide",value:function(e){this._rateMessageSent.addFailedCountOfUserSide(e)||D.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),e)}},{key:"addCost",value:function(e,n){this._rateMessageSent.addCost(e,n)||D.w("".concat(this._n,".addCost invalid key or cost:"),e,n)}},{key:"addFileSize",value:function(e,n){this._rateMessageSent.addFileSize(e,n)||D.w("".concat(this._n,".addFileSize invalid key or size:"),e,n)}},{key:"addMessageSequence",value:function(e){this._rateMessageReceived.addMessageSequence(e)||D.w("".concat(this._n,".addMessageSequence invalid key:"),e.key)}},{key:"_getQualityItem",value:function(e){var n={},a=ri[this.get(15).getNetworkType()];switch(q(a)&&(a=8),a={qualityType:na[e],timestamp:Vn(),networkType:a,extension:""},e){case _r:n=this._avgRTT.getStatResult();break;case Sc:n=this._avgE2EDelay.getStatResult();break;case Gt:case Q:case po:case Ht:case P:n=this._rateMessageSent.getStatResult(e);break;case si:case Ii:case bo:n=this._rateMessageReceived.getStatResult(e)}return n===null?null:g(g({},a),n)}},{key:"_report",value:function(e){var n=this,a=[],r=null,u=(q(e)?this._qualityItems.forEach(function(d){(r=n._getQualityItem(d))!==null&&(r.reportIndex=n.reportIndex,r.wholePeriod=n.wholePeriod,a.push(r))}):(r=this._getQualityItem(e))!==null&&(r.reportIndex=this.reportIndex,r.wholePeriod=this.wholePeriod,a.push(r)),D.d("".concat(this._n,"._report"),a),0<this._statInfoArr.length&&(a=a.concat(this._statInfoArr),this._statInfoArr=[]),e=this.get(12)).getSDKAppID();e=e.getTinyID(),0<(a=uo(this.REPORT_SDKAPPID_BLACKLIST,u)&&!Mc(this.REPORT_TINYID_WHITELIST,e)?[]:a).length&&this._doReport(a)}},{key:"_doReport",value:function(e){var n=this,a={header:da(this),quality:e};this.req({P:b.SSO_STAT,data:g({},a)}).then(function(){n.reportIndex++,n.wholePeriod=!1}).catch(function(r){D.w("".concat(n._n,"._doReport failed. error:"),r),n._statInfoArr=n._statInfoArr.concat(e),n._flushAtOnce()})}},{key:"_flushAtOnce",value:function(){var e=this.get(13),n=e.getItem(this.TAG,!1),a=this._statInfoArr,r="".concat(this._n,"._flushAtOnce");Se(n)?(D.l("".concat(r," count:").concat(a.length)),e.setItem(this.TAG,a,!0,!1)):(10<(a=a.concat(n)).length&&(a=a.slice(0,10)),D.l("".concat(r," count:").concat(a.length)),e.setItem(this.TAG,a,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),Ui),gl=N(function e(n){v(this,e),Se(n)||(this.userID=n.userID||"",this.nick=n.nick||"",this.avatar=n.avatar||"",this.time=n.time||0,this.source=n.source||"",this.wording=n.wording||"",this.type=n.type||"")}),Dd=(N(zs,[{key:"getLocalApplicationList",value:function(){return{friendApplicationList:J(this._map.values()),unreadCount:this._unreadCount}}},{key:"_onApplicationListUpdated",value:function(){this._snsM.emitOEvt(me.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:J(this._map.values()),unreadCount:this._unreadCount})}},{key:"onApplicationRead",value:function(){this._unreadCount=0,this._onApplicationListUpdated()}},{key:"onApplicationAdded",value:function(e,n){var a,r,u=this;Se(e)||(a="",a=n===this._snsM.getMyUserID()?A.SNS_APPLICATION_SENT_BY_ME:A.SNS_APPLICATION_SENT_TO_ME,r=!1,e.forEach(function(d){var _="".concat(d.userID,"_").concat(a);a!==A.SNS_APPLICATION_SENT_TO_ME||u._map.has(_)||(u._unreadCount+=1),u._map.set(_,new gl(g(g({},d),{},{type:a}))),r=!0}),r&&this._onApplicationListUpdated())}},{key:"onApplicationDeleted",value:function(e){Se(e)||(this._startTime=0,this._currentSeq=0,this.getApplicationList())}},{key:"getApplicationList",value:function(){var e=this,n="".concat(this._n,".").concat("getApplicationList"),a=new ce("getApplicationList");return this._snsM.req({P:b.GET_FD_APPLICATION_LIST,data:{applicationType:A.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSeq}}).then(function(r){var u=(r=r.data).resultList,d=r.unreadCount,_=r.startTime,y=(r=r.currentSequence,e._startTime=_,e._currentSeq=r,e._unreadCount=d,ke(u)?u.length:0);y="applicationCount:".concat(y," unreadCount:").concat(d," startTime:").concat(_," currentSequence:").concat(r),a.setMessage(y).end(),D.i("".concat(n," ok. ").concat(y)),e._map.clear(),ke(u)&&u.forEach(function(M){var R=M.userID,L=M.type;M=new gl(M),e._map.set("".concat(R,"_").concat(L),M)}),e._onApplicationListUpdated()}).catch(function(r){return a.setError(r).end(),D.w("".concat(n," failed. error:"),r),j(r)})}},{key:"deleteApplication",value:function(e){var n="".concat(this._n,".").concat("deleteApplication"),a=e.userID,r=e.type;if(r&&(r===A.SNS_APPLICATION_SENT_BY_ME||r===A.SNS_APPLICATION_SENT_TO_ME)||(r=A.SNS_APPLICATION_SENT_TO_ME),!this._map.has("".concat(a,"_").concat(r)))return j({code:X.FRIEND_APPLICATION_NOT_EXIST});var u=new ce("deleteApplication");return u.setMessage("userID:".concat(a," type:").concat(r)),this._snsM.req({P:b.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[a],type:r}}).then(function(d){var _=(M=(d=d.data.resultList)[0]).to,y=M.resultCode,M=M.resultInfo;return u.setMoreMessage("resultList:".concat(JSON.stringify(d))).end(),D.i("".concat(n," ok. userID:").concat(a," type:").concat(r)),y===0?be():j({userID:_,code:y,message:M})}).catch(function(d){return u.setError(d).end(),D.w("".concat(n," failed. error:"),d),j(d)})}},{key:"acceptApplication",value:function(e){var n="".concat(this._n,".").concat("acceptApplication"),a=e.userID,r=e.remark,u=e.tag,d=e.type,_=(d&&(d===A.SNS_APPLICATION_AGREE||d===A.SNS_APPLICATION_AGREE_AND_ADD)||(d=A.SNS_APPLICATION_AGREE_AND_ADD),new ce("acceptApplication"));return _.setMessage("userID:".concat(a," type:").concat(d)),this._snsM.req({P:b.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:a,remark:r,tag:u,action:d}]}}).then(function(y){_.end();var M=(y=y.data.resultList[0]).resultCode;if(y=y.resultInfo,M!==0)return j({code:M,message:y});D.i("".concat(n," ok. userID:").concat(a," type:").concat(d))}).catch(function(y){return _.setError(y).end(),D.w("".concat(n," failed. error:"),y),j(y)})}},{key:"refuseApplication",value:function(e){var n="".concat(this._n,".").concat("refuseApplication"),a=e.userID,r=new ce("refuseApplication");return r.setMessage("userID:".concat(a)),this._snsM.req({P:b.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:a,action:"Response_Action_Reject"}]}}).then(function(u){r.end();var d=(u=u.data.resultList[0]).resultCode;if(u=u.resultInfo,d!==0)return j({code:d,message:u});D.i("".concat(n," ok. userID:").concat(a))}).catch(function(u){return r.setError(u).end(),D.w("".concat(n," failed. error:"),u),j(u)})}},{key:"setApplicationRead",value:function(){var e=this,n="".concat(this._n,".").concat("setApplicationRead"),a=new ce("setApplicationRead");return this._snsM.req({P:b.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:ao(Vn()/1e3,0)}}).then(function(r){a.end(),D.i("".concat(n," ok")),e._unreadCount=0}).catch(function(r){return a.setError(r).end(),D.w("".concat(n," failed. error:"),r),j(r)})}},{key:"reset",value:function(){this._maxLimited=100,this._currentSeq=0,this._unreadCount=0,this._map.clear()}}]),zs),ou=(N(Gi,[{key:"validate",value:function(e){var n,a=!0,r="";if(Se(e))return{valid:!1,tips:"empty options"};if(e.profileCustomField)for(var u=e.profileCustomField.length,d=null,_=0;_<u;_++){if(d=e.profileCustomField[_],!Ee(d.key)||d.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!Ee(d.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(n==="profileCustomField")continue;if(Se(e[n])&&!Ee(e[n])&&!ft(e[n])){r="key:"+n+", invalid value:"+e[n],a=!1;continue}switch(n){case"nick":Ee(e[n])||(a=!(r="nick must be a string")),500<gi(e[n])&&(r="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(gi(e[n])," bytes"),a=!1);break;case"gender":vo(gc,e.gender)||(r="key:gender, invalid value:"+e.gender,a=!1);break;case"birthday":ft(e.birthday)||(a=!(r="birthday must be a number"));break;case"location":Ee(e.location)||(a=!(r="location must be a string"));break;case"selfSignature":Ee(e.selfSignature)||(a=!(r="selfSignature must be a string"));break;case"allowType":vo(di,e.allowType)||(r="key:allowType, invalid value:"+e.allowType,a=!1);break;case"language":ft(e.language)||(a=!(r="language must be a number"));break;case"avatar":Ee(e.avatar)||(a=!(r="avatar must be a string"));break;case"messageSettings":e.messageSettings!==0&&e.messageSettings!==1&&(a=!(r="messageSettings must be 0 or 1"));break;case"adminForbidType":vo(hc,e.adminForbidType)||(r="key:adminForbidType, invalid value:"+e.adminForbidType,a=!1);break;case"level":ft(e.level)||(a=!(r="level must be a number"));break;case"role":ft(e.role)||(a=!(r="role must be a number"));break;default:r="unknown key:"+n+"  "+e[n],a=!1}}return{valid:a,tips:r}}},{key:"update",value:function(e){var n,a="",r=[];this.friendCustomField.forEach(function(y){r.push(y.key)});for(var u=0,d=e.length;u<d;u++)if(a=e[u].tag,n=e[u].value,-1<a.indexOf("Tag_SNS_Custom"))-1<r.indexOf(a)?this.friendCustomField.forEach(function(y){y.key===a&&(y.value=n)}):this.friendCustomField.push({key:a,value:n});else if(-1<a.indexOf("Tag_Profile_Custom")){var _=!1;this.profile.profileCustomField.forEach(function(y){y.key===a&&(y.value=n,_=!0)}),_||this.profile.profileCustomField.push({key:a,value:n})}else switch(a){case Je.NICK:this.profile.nick=n;break;case Je.GENDER:this.profile.gender=n;break;case Je.BIRTHDAY:this.profile.birthday=n;break;case Je.LOCATION:this.profile.location=n;break;case Je.SELFSIGNATURE:this.profile.selfSignature=n;break;case Je.ALLOWTYPE:this.profile.allowType=n;break;case Je.LANGUAGE:this.profile.language=n;break;case Je.AVATAR:this.profile.avatar=n;break;case Je.MESSAGESETTINGS:this.profile.messageSettings=n;break;case Je.ADMINFORBIDTYPE:this.profile.adminForbidType=n;break;case Je.LEVEL:this.profile.level=n;break;case Je.ROLE:this.profile.role=n;break;case co.REMARK:this.remark=n;break;case co.ADDTIME:this.addTime=n;break;case co.GROUP:this.groupList=JSON.parse(JSON.stringify(n));break;case co.ADDSOURCE:this.source=n;break;case co.ADDWORDING:break;default:D.d("snsProfileItem unkown tag->",e[u].tag)}this.timestamp=Date.now(),r.length=0}},{key:"updateProfile",value:function(e){this.profile=JSON.parse(JSON.stringify(e)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(e){this.groupList.indexOf(e)===-1&&(this.groupList.push(e),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(e){-1<(e=this.groupList.indexOf(e))&&(this.groupList.splice(e,1),this.count=this.groupList.length)}}]),Gi),Ed=(N(Pi,[{key:"getLocalFriendList",value:function(){return J(this._map.values())}},{key:"getFriendRemark",value:function(e){return this._map.has(e)?this._map.get(e).remark:""}},{key:"onFriendProfileModified",value:function(e){var n,a=this;Se(e=e.dataList)||(n=this._snsM.get(11),e.forEach(function(r){var u,d=r.userID;r=r.profileList,a.isMyFriend(d)&&(D.l("".concat(a._n,".onFriendProfileModified. friend account:").concat(d,", profileList:").concat(JSON.stringify(r))),(u=a._map.get(d)).update(r),n.modifyMessageSentByPeer({conversationID:"".concat(A.CONV_C2C).concat(d),latestNick:u.profile.nick,latestAvatar:u.profile.avatar}))}),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(e){var n=this;e.length!==0&&(D.l("".concat(this._n,".onFriendAdded userIDList:").concat(e)),e.forEach(function(a){n._map.set(a,new ou(a))}),this.getFriendProfile({userIDList:e}).then(function(a){e.forEach(function(r){var u=n._map.get(r);0<u.groupList.length&&n._snsM.updateWhenFriendAdded({nameList:u.groupList,userID:r})}),n._onFriendListUpdated()}))}},{key:"onFriendDeleted",value:function(e){var n=this;e.length!==0&&(D.l("".concat(this._n,".onFriendDeleted userIDList:").concat(e)),e.forEach(function(a){var r=n._map.get(a);0<r.groupList.length&&n._snsM.updateWhenFriendDeleted({nameList:r.groupList,userID:a}),n._map.delete(a)}),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOEvt(me.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(e){var n=this,a="".concat(this._n,".").concat("getFriendProfile"),r=(e=e.userIDList,[]),u=[],d=[];if(e.forEach(function(y){var M;n._map.has(y)?(M=n._map.get(y),Date.now()-M.timestamp<n._expirationTime?u.push(M):d.push(y)):r.push({userID:y,code:X.NOT_MY_FRIEND,message:n._snsM.getErrMsg(X.NOT_MY_FRIEND)})}),d.length===0)return D.i("".concat(a," newUserIDList is empty")),Ke({friendList:u,failureUserIDList:r});var _=new ce("getFriendProfile");return _.setMessage("userIDList:".concat(d)),D.i("".concat(a," userIDList:").concat(d)),this._snsM.req({P:b.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:d}}).then(function(y){return _.end(),D.i("".concat(a," ok")),y.data.resultList.forEach(function(M){var R,L=M.to,F=M.resultCode,x=M.resultInfo;M=M.tagValueList,q(F)||F===0?(n._map.has(L)?(R=n._map.get(L)).update(M):(R=new ou(L,M),n._map.set(L,R)),u.push(R)):r.push({userID:L,code:F,message:x})}),be({friendList:u,failureUserIDList:r})}).catch(function(y){return _.setError(y).end(),D.w("".concat(a," failed. error:"),y),j(y)})}},{key:"isMyFriend",value:function(e){return this._map.has(e)}},{key:"pagingGetFriendList",value:function(){var e=this,n="".concat(this._n,".").concat("getFriendList"),a=new ce("getFriendList"),r=Date.now();this._snsM.req({P:b.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIdx,standardSequence:this._standardSeq,customSequence:this._customSeq}}).then(function(u){var d=(u=u.data).friendCount,_=u.resultList,y=u.nextStartIndex,M=u.standardSequence,R=u.customSequence;u=u.completeFlag,e._startIdx=y,e._standardSeq=M,e._customSeq=R,d="friendCount:".concat(d," nextStartIndex:").concat(y," standardSequence:").concat(M," ")+"customSequence:".concat(R," completeFlag:").concat(u," cost:").concat(kn(r)),a.setMessage(d).end(),D.i("".concat(n," ok."),d),Se(_)||_.forEach(function(L){var F=L.to;L=L.tagValueList,e._map.set(F,new ou(F,L))}),u===0?e.pagingGetFriendList():(e._snsM.emitOEvt(me.FRIEND_LIST_UPDATED),e._pagingGetFriendProfile())}).catch(function(u){return a.setError(u).end(),D.w("".concat(n," failed. error:"),u),j(u)})}},{key:"_pagingGetFriendProfile",value:function(){var e=this,n=J(this._map.keys()),a=this._snsM.get(4),r=n.length,u=r<=100?1:Math.ceil(r/100);D.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(r," pageCount:").concat(u));for(var d=0;d<u;d++)a.getUserProfile({userIDList:n.slice(100*d,100*(d+1))}).then(function(_){_.data.forEach(function(y){var M=e._map.get(y.userID);M&&M.updateProfile(y)}),e._onFriendListUpdated()})}},{key:"addFriend",value:function(e){var n=this,a="".concat(this._n,".").concat("addFriend");if(this._map.has(e.to))return j({code:X.ALREADY_MY_FRIEND});if(e.wording&&this._snsM.filterProfanity("wording",e)===!1)return j({code:X.PROFANITY_FOUND});var r=e.to,u=e.source,d=e.type,_=e.wording,y=e.remark,M=(e=e.groupName,d),R=(M&&(M===A.SNS_ADD_TYPE_SINGLE||M===A.SNS_ADD_TYPE_BOTH)||(M=A.SNS_ADD_TYPE_BOTH),new ce("addFriend"));return R.setMessage("to:".concat(r," source:").concat(u," type:").concat(M)),this._snsM.req({P:b.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:r,source:u,wording:_,remark:y,groupName:e}],type:M}}).then(function(L){L=L.data.resultList;var F=(R.setMoreMessage("resultList:".concat(JSON.stringify(L))).end(),L=L[0]).to,x=L.resultCode;return L=L.resultInfo,D.i("".concat(a," ok. to:").concat(F," type:").concat(M," code:").concat(x)),q(x)||x===0?be({userID:F,code:0}):x===30539?be({userID:F,code:x,message:n._snsM.getErrMsg(x)}):j({userID:F,code:x,message:n._snsM.getErrMsg(x)||L})}).catch(function(L){return R.setError(L).end(),D.w("".concat(a," failed. error:"),L),j(L)})}},{key:"deleteFriend",value:function(e){var n=this,a="".concat(this._n,".").concat("deleteFriend"),r=e.userIDList,u=(e=e.type,1e3<r.length&&(D.w("".concat(a," ").concat(Ko(1e3))),r.length=1e3),[]),d=[],_=[];if(r.forEach(function(M){n._map.has(M)?_.push(M):u.push({userID:M,code:X.NOT_MY_FRIEND,message:n._snsM.getErrMsg(X.NOT_MY_FRIEND)})}),_.length===0)return Ke({successUserIDList:d,failureUserIDList:u});var y=((r=e)&&(r===A.SNS_DELETE_TYPE_SINGLE||r===A.SNS_DELETE_TYPE_BOTH)||(r=A.SNS_DELETE_TYPE_BOTH),new ce("deleteFriend"));return y.setMessage("userIDList:".concat(_," type:").concat(r)),this._snsM.req({P:b.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:_,type:r}}).then(function(M){return y.end(),D.i("".concat(a," ok")),Se(M=M.data.resultList)||M.forEach(function(R){var L=R.to,F=R.resultCode;R=R.resultInfo,q(F)||F===0?d.push({userID:L}):u.push({userID:L,code:F,message:R})}),be({successUserIDList:d,failureUserIDList:u})}).catch(function(M){return y.setError(M).end(),D.w("".concat(a," error:"),M),j(M)})}},{key:"updateFriend",value:function(e){var n=this,a=e.userID,r=e.remark,u=e.friendCustomField;if(!this._map.has(a))return j({code:X.NOT_MY_FRIEND});var d="".concat(this._n,".").concat("updateFriend"),_=new ce("updateFriend"),y=(_.setMessage("userID:".concat(a," remark:").concat(r," friendCustomField:").concat(u)),[]);return q(r)||y.push({tag:co.REMARK,value:r}),ke(u)&&0<u.length&&u.forEach(function(M){y.push({tag:M.key,value:M.value})}),this._snsM.req({P:b.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:a,snsItem:y}]}}).then(function(M){_.end(),D.i("".concat(d," ok"));var R=(M=M.data.resultList[0]).to,L=M.resultCode;return M=M.resultInfo,q(L)||L===0?((R=n._map.get(R))&&(q(r)||(R.remark=r),ke(u)&&0<u.length&&Ho(R.friendCustomField,u),n._onFriendListUpdated()),be(R)):j({code:L,message:M})}).catch(function(M){return _.setError(M).end(),D.w("".concat(d," failed. error:"),M),j(M)})}},{key:"checkFriend",value:function(e){var n="".concat(this._n,".").concat("checkFriend"),a=e.userIDList,r=e.type,u=(r&&(r===A.SNS_CHECK_TYPE_SINGLE||r===A.SNS_CHECK_TYPE_BOTH)||(r=A.SNS_CHECK_TYPE_BOTH),new ce("checkFriend"));return u.setMessage("userIDList:".concat(a," type:").concat(r)),this._snsM.req({P:b.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:a,type:r}}).then(function(d){u.end(),D.i("".concat(n," ok. userIDList:").concat(a," type:").concat(r));var _=[],y=[];return ke(d=d.data.resultList)&&d.forEach(function(M){var R=M.to,L=M.relation,F=M.resultCode;M=M.resultInfo,q(F)||F===0?_.push({userID:R,code:0,relation:L}):y.push({userID:R,code:F,message:M})}),be({successUserIDList:_,failureUserIDList:y})}).catch(function(d){return u.setError(d).end(),D.w("".concat(n," failed. error:"),d),j(d)})}},{key:"onAddedToFriendGroup",value:function(e){var n=this,a=e.name;e=e.userIDList,D.l("".concat(this._n,".onAddedToFriendGroup groupName:").concat(a," userIDList:").concat(e)),a&&!Se(e)&&e.forEach(function(r){n._map.has(r)&&n._map.get(r).addToGroupList(a)})}},{key:"onRemovedFromFriendGroup",value:function(e){var n=this,a=e.name;e=e.userIDList,D.l("".concat(this._n,".onRemovedFromFriendGroup groupName:").concat(a," userIDList:").concat(e)),a&&!Se(e)&&e.forEach(function(r){n._map.has(r)&&n._map.get(r).removeFromGroupList(a)})}},{key:"reset",value:function(){this._map.clear(),this._startIdx=0,this._standardSeq=0,this._customSeq=0}}]),Pi),hl=(N(bi,[{key:"addToUserIDList",value:function(e){this.userIDList.indexOf(e)===-1&&(this.userIDList.push(e),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(e){-1<(e=this.userIDList.indexOf(e))&&(this.userIDList.splice(e,1),this.count=this.userIDList.length)}}]),bi),Rd=(N(Ys,[{key:"getLocalGroupList",value:function(){return J(this._map.values())}},{key:"_onGroupListUpdated",value:function(){var e=J(this._map.values());this._snsM.emitOEvt(me.FRIEND_GROUP_LIST_UPDATED,e)}},{key:"getGroupList",value:function(){var e=this,n="".concat(this._n,".").concat("getGroupList"),a=new ce("getGroupList");return this._snsM.req({P:b.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then(function(r){a.end(),Se(r=r.data.resultList)?D.i("".concat(n," ok. count:0")):(D.i("".concat(n," ok. count:").concat(r.length)),e._map.clear(),r.forEach(function(u){var d=new hl(u);e._map.set(u.name,d)}),e._onGroupListUpdated())}).catch(function(r){return a.setError(r).end(),D.w("".concat(n," error:"),r),j(r)})}},{key:"createGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("createGroup"),r=e.name;if(e=e.userIDList,this._map.has(r))return j({code:X.FRIEND_GRP_EXISTED});var u="name:".concat(r," userIDList:").concat(e),d=new ce("createGroup");return d.setMessage(u),this._snsM.req({P:b.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[r],userIDList:ke(e)?e:void 0}}).then(function(_){d.end(),D.l("".concat(a," ok. ").concat(u)),_=_.data.resultList;var y=[],M=[];return _&&_.forEach(function(R){var L=R.to,F=R.resultCode,x=R.resultInfo;q(F)||F===0?y.push(L):(L={userID:R.to,code:F,message:x},M.push(L))}),_=new hl({name:r,userIDList:y}),n._map.set(r,_),n._snsM.onAddedToFriendGroup({name:r,userIDList:y}),n._onGroupListUpdated(),be({friendGroup:_,failureUserIDList:M})}).catch(function(_){return d.setError(_).end(),D.w("".concat(a," failed. error:"),_),j(_)})}},{key:"deleteGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("deleteGroup"),r=e.name;if(!this._map.has(r))return this._onGroupNotExist();var u="name:".concat(r),d=new ce("deleteGroup");return d.setMessage(u),this._snsM.req({P:b.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[r]}}).then(function(_){d.end(),D.l("".concat(a," ok. ").concat(u));var y=n._map.get(r);return y&&(n._snsM.onRemovedFromFriendGroup({name:r,userIDList:y.userIDList}),n._map.delete(r),y.userIDList.length=0),n._onGroupListUpdated(),be(y)}).catch(function(_){return d.setError(_).end(),D.w("".concat(a," failed. error:"),_),j(_)})}},{key:"renameGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("renameGroup"),r=e.oldName,u=e.newName;if(!this._map.has(r))return this._onGroupNotExist();var d="oldName:".concat(r," newName:").concat(u),_=new ce("renameGroup");return _.setMessage(d),this._snsM.req({P:b.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:r,newName:u}}).then(function(){var y;return _.end(),D.l("".concat(a," ok. ").concat(d)),n._map.has(r)?((y=n._map.get(r)).name=u,n._map.delete(r),n._map.set(u,y),n._snsM.onRemovedFromFriendGroup({name:r,userIDList:y.userIDList}),n._snsM.onAddedToFriendGroup({name:u,userIDList:y.userIDList}),n._onGroupListUpdated(),be(y)):be()}).catch(function(y){return _.setError(y).end(),D.w("".concat(a," failed. error:"),y),j(y)})}},{key:"addToGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("addToGroup"),r=e.name;if(e=e.userIDList,!this._map.has(r))return this._onGroupNotExist();var u="name:".concat(r," userIDList:").concat(e),d=new ce("addToGroup");return d.setMessage(u),this._snsM.req({P:b.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:r,updateGroupItem:e.filter(function(_){return n._snsM.isMyFriend(_)}).map(function(_){return{to:_,updateType:"Update_Type_Add"}})}}).then(function(_){return d.end(),D.l("".concat(a," ok. ").concat(u)),n._onGroupUpdated(r,_)}).catch(function(_){return d.setError(_).end(),D.w("".concat(a," failed. error:"),_),j(_)})}},{key:"removeFromGroup",value:function(e){var n=this,a="".concat(this._n,".").concat("removeFromGroup"),r=e.name;if(e=e.userIDList,!this._map.has(r))return this._onGroupNotExist();var u="name:".concat(r," userIDList:").concat(e),d=new ce("removeFromGroup");return d.setMessage(u),this._snsM.req({P:b.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:r,updateGroupItem:e.filter(function(_){return n._snsM.isMyFriend(_)}).map(function(_){return{to:_,updateType:"Update_Type_Delete"}})}}).then(function(_){return d.end(),D.l("".concat(a," ok. ").concat(u)),n._onGroupUpdated(r,_)}).catch(function(_){return d.setError(_).end(),D.w("".concat(a," failed. error:"),_),j(_)})}},{key:"_onGroupUpdated",value:function(e,n){n=n.data.resultList;var a=this._map.get(e),r=[],u=[],d=[];return ke(n)&&n.forEach(function(_){var y=_.to,M=_.resultCode,R=_.resultInfo,L=_.type;M===0?L==="Update_Type_Add"?a&&(a.addToUserIDList(y),u.push(y)):L==="Update_Type_Delete"&&a&&(a.removeFromUserIDList(y),d.push(y)):r.push({to:_.to,code:M,message:R})}),D.l("".concat(this._n,"._onGroupUpdated name:").concat(e," userIDList:").concat(a.userIDList)),0<u.length&&this._snsM.onAddedToFriendGroup({name:e,userIDList:u}),0<d.length&&this._snsM.onRemovedFromFriendGroup({name:e,userIDList:d}),be({friendGroup:a,failureUserIDList:r})}},{key:"updateWhenFriendAdded",value:function(e){var n=this,a=e.nameList,r=e.userID;D.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(r," nameList:").concat(a)),Se(a)||a.forEach(function(u){n._map.has(u)&&n._map.get(u).addToUserIDList(r)})}},{key:"updateWhenFriendDeleted",value:function(e){var n=this,a=e.nameList,r=e.userID;D.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(r," nameList:").concat(a)),Se(a)||a.forEach(function(u){n._map.has(u)&&n._map.get(u).removeFromUserIDList(r)})}},{key:"_onGroupNotExist",value:function(e){return j({code:X.FRIEND_GRP_NOT_EXIST})}},{key:"reset",value:function(){this._map.clear()}}]),Ys),Ld=(V(Ni,an),al=ae(Ni),N(Ni,[{key:"onContextUpdated",value:function(e){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getGroupList(),this._friendApplicationHandler.getApplicationList()}},{key:"onRelationChainModified",value:function(e){var n,a,r,u,d,_,y=this;Se(e=e.dataList)||(n=[],a=[],r=[],d=!(u=[]),_="",e.forEach(function(M){var R;M.pushType!==3&&M.pushType!==4||!M.from||(_=M.from),M.friendAddAccount&&(n.push.apply(n,J(M.friendAddAccount)),u.push.apply(u,J(M.friendAddAccount))),M.friendDelAccount&&a.push.apply(a,J(M.friendDelAccount)),M.friendApplicationAdded&&r.push.apply(r,J(M.friendApplicationAdded)),M.friendApplicationDeletedUserIDList&&u.push.apply(u,J(M.friendApplicationDeletedUserIDList)),M.reportTime&&M.pushType===7&&(d=!0),M.friendUpInfo&&(R={dataList:[]},M.friendUpInfo.forEach(function(L){R.dataList.push({userID:L.friendAccount,profileList:J(L.sns)})}),y.onFriendProfileModified(R))}),d&&this._friendApplicationHandler.onApplicationRead(),this._friendApplicationHandler.onApplicationAdded(r,_),this._friendApplicationHandler.onApplicationDeleted(u),this._friendHandler.onFriendAdded(n),this._friendHandler.onFriendDeleted(a))}},{key:"isMyFriend",value:function(e){return this._friendHandler.isMyFriend(e)}},{key:"filterProfanity",value:function(e,n){if(!(r=this.get(29)))return!0;var a=(r=r.filterText(n[e],"sns")).isAllowedToSend,r=r.modifiedText;return a===!0&&(n[e]=r,!0)}},{key:"onFriendProfileModified",value:function(e){this._friendHandler.onFriendProfileModified(e)}},{key:"getLocalFriendList",value:function(){var e=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],n=this._friendHandler.getLocalFriendList();return e?Ke(n):n}},{key:"getFriendRemark",value:function(e){return this._friendHandler.getFriendRemark(e)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(e){return this._friendHandler.addFriend(e)}},{key:"deleteFriend",value:function(e){return this._friendHandler.deleteFriend(e)}},{key:"checkFriend",value:function(e){return this._friendHandler.checkFriend(e)}},{key:"getFriendProfile",value:function(e){return this._friendHandler.getFriendProfile(e)}},{key:"updateFriend",value:function(e){return this._friendHandler.updateFriend(e)}},{key:"onAddedToFriendGroup",value:function(e){this._friendHandler.onAddedToFriendGroup(e)}},{key:"onRemovedFromFriendGroup",value:function(e){this._friendHandler.onRemovedFromFriendGroup(e)}},{key:"getLocalFriendApplicationList",value:function(){return Ke(this._friendApplicationHandler.getLocalApplicationList())}},{key:"deleteFriendApplication",value:function(e){return this._friendApplicationHandler.deleteApplication(e)}},{key:"refuseFriendApplication",value:function(e){return this._friendApplicationHandler.refuseApplication(e)}},{key:"acceptFriendApplication",value:function(e){return this._friendApplicationHandler.acceptApplication(e)}},{key:"setFriendApplicationRead",value:function(e){return this._friendApplicationHandler.setApplicationRead(e)}},{key:"getLocalFriendGroupList",value:function(){return Ke(this._friendGroupHandler.getLocalGroupList())}},{key:"createFriendGroup",value:function(e){return this._friendGroupHandler.createGroup(e)}},{key:"deleteFriendGroup",value:function(e){return this._friendGroupHandler.deleteGroup(e)}},{key:"addToFriendGroup",value:function(e){return this._friendGroupHandler.addToGroup(e)}},{key:"removeFromFriendGroup",value:function(e){return this._friendGroupHandler.removeFromGroup(e)}},{key:"renameFriendGroup",value:function(e){return this._friendGroupHandler.renameGroup(e)}},{key:"updateWhenFriendAdded",value:function(e){this._friendGroupHandler.updateWhenFriendAdded(e)}},{key:"updateWhenFriendDeleted",value:function(e){this._friendGroupHandler.updateWhenFriendDeleted(e)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Ni),_l=(V(Oi,an),il=ae(Oi),N(Oi,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&ti}},{key:"startWorkerTimer",value:function(){D.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){D.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var e,n;ti&&(e=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(e),(n=this)._workerTimer.onmessage=function(a){a.data?(n._timerID=a.data,D.l("".concat(n._n,"._init seed:").concat(n._timerID))):n._m.onCheckTimer()})}},{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("enable_worker");D.l("".concat(this._n,"._onCloudConfig enableWorker:").concat(e)),q(e)||e==="1"?!this._isWorkerEnabled&&ti&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&ti&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){D.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){D.l("".concat(this._n,".reset"))}}]),Oi),kd=(N(js,[{key:"isValidPurchaseBits",value:function(e){return e&&typeof e=="string"&&1<=e.length&&e.length<=64&&/[01]{1,64}/.test(e)}},{key:"parsePurchaseBits",value:function(e){if(this.isValidPurchaseBits(e)){this._featureMap.clear();for(var n,a=e.length-1,r=0;0<=a;a--,r++)n=(r<32?new ze(0,Math.pow(2,r)):new ze(Math.pow(2,r-32),0)).toString(),e[a]==="1"?this._featureMap.set(n,!0):this._featureMap.set(n,!1)}else D.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(e))}},{key:"hasPurchasedFeature",value:function(e){return!!this._featureMap.get(e)}},{key:"isFeatureEnabled",value:function(e){for(var n=parseInt(e).toString(2),a=void 0,r=!0,u=n.length-1,d=0;0<=u;u--,d++)if(n.charAt(u)==="1"&&(a=(d<32?new ze(0,Math.pow(2,d)):new ze(Math.pow(2,d-32),0)).toString(),!this._featureMap.get(a))){r=!1;break}return D.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(e," key:").concat(a," ret:").concat(r)),Ke({enabled:r})}},{key:"isFeatureEnabledForStat",value:function(e){for(var n=parseInt(e).toString(2),a=n.length-1,r=0;0<=a;a--,r++)if(n.charAt(a)==="1"){if(u=(r<32?new ze(0,Math.pow(2,r)):new ze(Math.pow(2,r-32),0)).toString(),!this._featureMap.get(u))break;var u,d="",_=0;u===Qe.PLUGIN_TRANSLATE?(d="plugin_translate",_=16):u===Qe.PLUGIN_VOICE_TO_TEXT?(d="plugin_voice_to_text",_=17):u===Qe.PLUGIN_CS?(d="plugin_cs",_=14):u===Qe.PLUGIN_PUSH?(d="plugin_push",_=13):u===Qe.PLUGIN_BOT?(d="plugin_bot",_=15):u===Qe.MSG_REACTION&&(d="plugin_emoji_reaction",_=18),d!==""&&(u=this._commercialConfigM.get(12).getUIPlatform(),new ce(d).setCode(_).setUIPlatform(u).end(),D.l("".concat(this._n,".isFeatureEnabledForStat ").concat(d," code:").concat(_," uiPlatform:").concat(u)))}}},{key:"isSearchCloudMessagesEnabled",value:function(){var e;this._isSCMReported||(e=this._commercialConfigM.get(12).getUIPlatform(),new ce("plugin_search").setCode(6).setUIPlatform(e).end(),this._isSCMReported=!0)}},{key:"clear",value:function(){this._featureMap.clear(),this._isSCMReported=!1}}]),js),iu=(N(Ws,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(e){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var e,n,a=this,r=this._canFetch(),u="".concat(this._n,".fetchConfig");D.l("".concat(u," canFetch:").concat(r)),r&&(e=new ce("fetchCommercialConfig"),r=this.get(12).getSDKAppID(),n=this.get(20),this._isFetching=!0,n.req({P:b.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:r}}).then(function(d){e.setMessage("purchaseBits:".concat(d.data.purchaseBits)).end(),D.l("".concat(u," ok.")),a._parseConfig(d.data),a._isFetching=!1}).catch(function(d){e.setError(d).end(),a._isFetching=!1}))}},{key:"onPushedConfig",value:function(e){var n="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(e));D.l("".concat(n)),new ce("pushedCommercialConfig").setMessage("purchaseBits:".concat(e.purchaseBits)).end(),this._parseConfig(e)}},{key:"_parseConfig",value:function(e){var n="".concat(this._n,"._parseConfig"),a=e.errorCode,r=e.errorMessage,u=e.purchaseBits,d=e.expiredTime;a===0?(this._purchasedFeatureHandler.parsePurchaseBits(u),this._expiredTime=Date.now()+1e3*d):q(a)?(D.l("".concat(n," failed. Invalid message format:"),e),this._setExpiredTimeOnResponseError(36e5)):(D.e("".concat(n," errorCode:").concat(a," errorMessage:").concat(r)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(e){this._expiredTime=Date.now()+e}},{key:"canIUse",value:function(e){return this._purchasedFeatureHandler.hasPurchasedFeature(e)}},{key:"isFeatureEnabled",value:function(e){return this._purchasedFeatureHandler.isFeatureEnabled(e)}},{key:"isFeatureEnabledForStat",value:function(e){this._purchasedFeatureHandler.isFeatureEnabledForStat(e)}},{key:"isSearchCloudMessagesEnabled",value:function(){this._purchasedFeatureHandler.isSearchCloudMessagesEnabled()}},{key:"get",value:function(e){return this._m.get(e)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),Ws),Ad=(V(Jo,an),qr=ae(Jo),N(Jo,[{key:"registerPlugin",value:function(e){var n,a,r,u,d,_,y,M,R,L,F,x,K;Ct?(this._offlinePushPlugin=e["tim-offline-push-plugin"],n=(K=e.offlinePushConfig||{}).huaweiBusinessID,a=K.xiaomiBusinessID,r=K.xiaomiAppID,u=K.xiaomiAppKey,d=K.meizuBusinessID,_=K.meizuAppID,y=K.meizuAppKey,M=K.vivoBusinessID,R=K.oppoBusinessID,L=K.oppoAppKey,F=K.oppoAppSecret,x=K.honorBusinessID,K=K.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=n,this._androidPushConfig.xiaomiPushBussinessId=a,this._androidPushConfig.xiaomiPushAppId=r,this._androidPushConfig.xiaomiPushAppKey=u,this._androidPushConfig.meizuPushBussinessId=d,this._androidPushConfig.meizuPushAppId=_,this._androidPushConfig.meizuPushAppKey=y,this._androidPushConfig.vivoPushBussinessId=M,this._androidPushConfig.oppoPushBussinessId=R,this._androidPushConfig.oppoPushAppKey=L,this._androidPushConfig.oppoPushAppSecret=F,this._androidPushConfig.honorPushBussinessId=x,new ce("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!q(this._offlinePushPlugin))).end(!0),D.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(e.offlinePushConfig))),this._iosBusinessID=K,this._setAppShowListener()):this.warn("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var e,n=this,a="".concat(this._n,".").concat("_getDeviceToken");Ot(this._offlinePushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),D.l("".concat(a," start. ").concat(e)),new ce("_getDeviceToken").setMessage("".concat(e)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,function(r){var u,d,_,y,M=new ce("getDeviceTokenRes"),R=r.code,L=r.msg;R===0?(u=(y=r.data).deviceToken,d=y.deviceBrand,_=y.deviceType,y=y.bussinessId,n._deviceToken=u,n._businessID=y||n._iosBusinessID,e="deviceToken:".concat(u,", deviceBrand:").concat(d||_,", businessID:").concat(n._businessID),D.l("".concat(a," ok. ").concat(e)),M.setMessage(e).end(!0),n._setToken()):(M.setMessage("code:".concat(R,", msg:").concat(L)).end(!0),D.e("".concat(a," failed. error:"),r))})):D.e("".concat(a," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return Ct&&!q(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,n="".concat(this._n,".").concat("_setAppShowListener");q(this._offlinePushPlugin)?D.e("".concat(n," offlinePushPlugin is undefined")):Ot(this._offlinePushPlugin.setAppShowListener)?(new ce("_setAppShowListener").end(!0),D.l("".concat(n," start")),this._offlinePushPlugin.setAppShowListener(function(a){a=(a||{}).appShow,new ce("setAppShowListenerRes").setMessage("appShow:".concat(a)).end(!0),D.l("".concat(n," ok. appShow:").concat(a)),e._m.isReady()&&(a===0?(e._getConvUnreadCount(),e._onBackground()):a===1&&e._onForeground())})):D.e("".concat(n," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!q(this._offlinePushPlugin)&&Ot(this._offlinePushPlugin.getDeviceType))return e=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,D.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,"._setToken"),n=this.get(12),a=1,r="",u="",d=(Se(this._deviceToken)&&(a=0),this.getUniAppPlatform()),_=this.getDeviceBrand(),y=(d===ct.IOS||d===ct.IPAD||d===ct.MAC?u=this._deviceToken:d===ct.ANDROID&&(r=this._deviceToken),new ce("offlinePushSetToken"));return d="deviceToken:".concat(u||r,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(_,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(a,", platform:").concat(d),y.setMessage("".concat(d)),D.l("".concat(e," ").concat(d)),this.req({P:b.SET_TOKEN,data:{tokenID:r,pushMsg:a,sdkAppID:n.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:_,deviceToken:u,isWebUniapp:this._isWebUniapp}}).then(function(M){return y.end(),D.l("".concat(e," ok")),M}).catch(function(M){return y.setError(M).end(),D.e("".concat(e," failed. error:"),M),j(M)})}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach(function(n){n.type===A.CONV_C2C&&(e._c2cUnreadCount+=n.unreadCount),n.type===A.CONV_GROUP&&(e._groupUnreadCount+=n.unreadCount)})}},{key:"_onBackground",value:function(){var e=this,n="".concat(this._n,".").concat("_onBackground"),a=new ce("_onBackground");this.req({P:b.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(r){return a.setMessage("c2cUnreadCount: ".concat(e._c2cUnreadCount,", groupUnreadCount: ").concat(e._groupUnreadCount)).end(),D.l("".concat(n," ok")),r}).catch(function(r){a.setError(r).end(),D.e("".concat(n," failed. error:"),r)})}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),n=new ce("_onForeground");this.req({P:b.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(a){return n.end(),D.l("".concat(e," ok")),a}).catch(function(a){n.setError(a).end(),D.e("".concat(e," failed. error:"),a)})}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,n=this.getDeviceBrand();return e==="ios"?ct.IOS:e==="android"?ct.ANDROID:n===1002?ct.IPAD:n===1001?ct.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,D.l("".concat(this._n,".reset"))}}]),Jo),fl=(V(zo,an),xr=ae(zo),N(zo,[{key:"registerPlugin",value:function(e){var n,a,r;Ct?(n="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=e["tim-push"],this._getDeviceInfo(),a=(r=e.pushConfig||{}).androidConfig,r=r.iOSConfig,It(a)&&(this._androidPushConfig=a[this._deviceInfo.packageName]),a=(r||{}).iOSBusinessID,this._iOSBusinessID=a,r=!q(this._pushPlugin),new ce("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(r)).end(!0),D.l("".concat(n," ok. pushConfig:").concat(JSON.stringify(e.pushConfig))),r?(this._setAppShowListener(),this._setPushEventReportListener()):D.e("".concat(n," ").concat(this._pluginName," is undefined"))):this.warn("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var e=this,n="".concat(this._n,".").concat("_reportEventCacheList");Ot(this._pushPlugin.getPushEventCacheList)?(new ce("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList(function(a){var r=a.code,u=a.data.eventList,d=new ce("getPushEventCacheListRes");if(d.setCode(r),r!==0)d.setMessage("res:".concat(JSON.stringify(a))).end(!0),D.e("".concat(n," failed. error:").concat(JSON.stringify(a)));else{r=u.length<10?"eventList:".concat(JSON.stringify(u)):"eventList.length:".concat(u.length),D.l("".concat(n," ok. ").concat(r)),d.setMessage(r).end(!0);for(var _=g(g({},a.data),{},{eventList:[]});0<u.length;)_.eventList=u.splice(0,40),e._pushReport(_)}})):D.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var e,n=this,a="".concat(this._n,".").concat("_getDeviceToken");Ot(this._pushPlugin.getDeviceToken)?(e="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),D.l("".concat(a," start. ").concat(e)),new ce("_getDeviceToken").setMessage("".concat(e)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,function(r){var u,d,_,y=r.code,M=r.msg,R=new ce("getDeviceTokenRes");if(R.setCode(y),y===0)return u=(y=r.data).deviceToken,d=y.deviceBrand,_=y.deviceType,y=y.bussinessId,n._deviceToken=u,n._businessID=y||n._iOSBusinessID,e="deviceToken:".concat(u," deviceBrand:").concat(d||_," businessID:").concat(n._businessID),D.l("".concat(a," ok. ").concat(e)),R.setMessage(e).end(!0),void n._setToken();R.setMessage(M).end(!0),D.e("".concat(a," failed. error:").concat(JSON.stringify(r)))})):D.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var e="".concat(this._n,".").concat("_getDeviceInfo");if(Ot(this._pushPlugin.getDeviceInfo)){var n=this._pushPlugin.getDeviceInfo(),a=n.code,r=n.data,u=new ce("_getDeviceInfo");if(u.setCode(a),a===0)return this._deviceInfo=g(g({},this._deviceInfo),r),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),a="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),D.l("".concat(e," ok. ").concat(a)),void u.setMessage(a).end(!0);u.setMessage("deviceInfoRes:".concat(JSON.stringify(n))).end(!0),D.e("".concat(e," failed. error:").concat(JSON.stringify(n)))}else D.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return Ct&&!q(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var e=this,n="".concat(this._n,".").concat("_setAppShowListener");Ot(this._pushPlugin.setAppShowListener)?(new ce("_setAppShowListener").end(!0),D.l("".concat(n," start")),this._pushPlugin.setAppShowListener(function(a){a=(a||{}).appShow,new ce("setAppShowListenerRes").setMessage("appShow:".concat(a)).end(!0),D.l("".concat(n," ok. appShow:").concat(a)),e._m.isReady()&&(a===0?(e._getConvUnreadCount(),e._onBackground()):a===1&&e._onForeground())})):D.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var e=this,n="".concat(this._n,".").concat("_setPushEventReportListener");Ot(this._pushPlugin.setPushEventReportListener)?(new ce("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener(function(a){var r=a.code,u=a.data,d=u.eventList,_=new ce("setPushEventReportListenerRes");if(_.setCode(r),r===0)return r="eventList:".concat(JSON.stringify(d)),D.l("".concat(n," ok. ").concat(r)),_.setMessage(r).end(!0),void(e._m.isReady()&&ke(d)&&0<d.length&&e._pushReport(u));_.setMessage("res:".concat(JSON.stringify(a))).end(!0),D.e("".concat(n," failed. error:").concat(JSON.stringify(a)))})):D.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var e;if(!q(this._pushPlugin)&&Ot(this._pushPlugin.getDeviceType))return e=(this._pushPlugin.getDeviceType()||{}).deviceType,D.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(e)),e}},{key:"_setToken",value:function(){var e="".concat(this._n,".").concat("_setToken"),n=this.get(12),a=1,r="",u="",d=(Se(this._deviceToken)&&(a=0),this.getUniAppPlatform()),_=this.getDeviceBrand(),y=(d===ct.IOS||d===ct.IPAD||d===ct.MAC?u=this._deviceToken:d===ct.ANDROID&&(r=this._deviceToken),d=g({tokenID:r,pushMsg:a,sdkAppID:n.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:_,deviceToken:u,isWebUniapp:this._isWebUniapp},this._deviceInfo),new ce("_setToken"));r="data:".concat(JSON.stringify(d)),y.setMessage("".concat(r)),D.l("".concat(e," ").concat(r)),this.req({P:b.SET_TOKEN,data:d}).then(function(){y.end(),D.w("".concat(e," ok"))}).catch(function(M){y.setError(M).end(),D.e("".concat(e," failed. error:"),M),j(M)})}},{key:"_getConvUnreadCount",value:function(){var e=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach(function(n){n.type===A.CONV_C2C&&(e._c2cUnreadCount+=n.unreadCount),n.type===A.CONV_GROUP&&(e._groupUnreadCount+=n.unreadCount)})}},{key:"_onBackground",value:function(){var e=this,n="".concat(this._n,".").concat("_onBackground"),a=new ce("_onBackground");this.req({P:b.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(){a.setMessage("c2cUnreadCount:".concat(e._c2cUnreadCount," groupUnreadCount:").concat(e._groupUnreadCount)).end(),D.l("".concat(n," ok"))}).catch(function(r){a.setError(r).end(),D.e("".concat(n," failed. error:"),r)})}},{key:"_onForeground",value:function(){var e="".concat(this._n,".").concat("_onForeground"),n=new ce("_onForeground");this.req({P:b.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(){n.end(),D.l("".concat(e," ok"))}).catch(function(a){n.setError(a).end(),D.e("".concat(e," failed. error:"),a)})}},{key:"_pushReport",value:function(e){var n=this,a="".concat(this._n,".").concat("_pushReport"),r=new ce("_pushReport");this.req({P:b.PUSH_REPORT,data:{eventList:e.eventList}}).then(function(){r.end(),n._notifyReportSuccess(e)}).catch(function(u){r.setError(u).end(),D.e("".concat(a," failed. error:"),u)})}},{key:"_notifyReportSuccess",value:function(e){!q(this._pushPlugin)&&Ot(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(e),D.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var e=uni.getSystemInfoSync().platform,n=this.getDeviceBrand();return e==="ios"?ct.IOS:e==="android"?ct.ANDROID:n===1002?ct.IPAD:n===1001?ct.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,D.l("".concat(this._n,".reset"))}}]),zo),Od=(V(zt,an),Fr=ae(zt),N(zt,[{key:"init",value:function(){var e=this.get(18).getPlugin("tim-profanity-filter-plugin");e&&(this._plugin=new e({logger:D,isArray:ke,isMap:bu,isDevMode:this.isDevMode()}),this._getLexicon())}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(e,n){var a=!0;if(!this._plugin||!this._canIUseLexicon||n&&n.messageControlInfo&&n.messageControlInfo.excludedFromContentModeration===!0)return a;n=e.type;var r=e.conversationType;if(n!==A.MSG_TEXT&&n!==A.MSG_CUSTOM)return a;var u,d="".concat(this._n,".filterMessage");if(D.l("".concat(d)),n===A.MSG_TEXT){if(r===A.CONV_C2C?u="c2c_text_message":r===A.CONV_GROUP&&(u="group_text_message"),!this._isConfigOn(u))return a;var _=(y=this._plugin.filter(e.payload.text)).type,y=y.modifiedText;_===1?a=!1:_===2&&(e.payload.text=y)}else if(n===A.MSG_CUSTOM){if(r===A.CONV_C2C?u="c2c_custom_message":r===A.CONV_GROUP&&(u="group_custom_message"),!this._isConfigOn(u))return a;_=this._plugin.filter(e.payload.data),y=this._plugin.filter(e.payload.description),n=this._plugin.filter(e.payload.extension),_.type===1||y.type===1||n.type===1?a=!1:(_.type===2&&(e.payload.data=_.modifiedText),y.type===2&&(e.payload.description=y.modifiedText),n.type===2&&(e.payload.extension=n.modifiedText))}return D.l("".concat(d," done. isAllowedToSend:").concat(a)),a}},{key:"filterText",value:function(e,n){var a="".concat(this._n,".filterText"),r={isAllowedToSend:!0,modifiedText:e};return this._plugin&&this._canIUseLexicon&&this._isConfigOn(n)&&(D.l("".concat(a)),e=(n=this._plugin.filter(e)).type,n=n.modifiedText,e===1?r.isAllowedToSend=!1:e===2&&(r.modifiedText=n),D.l("".concat(a," done. ret:"),r)),r}},{key:"_getLexicon",value:function(){var e=this,n=new ce("profanityFilter"),a="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({P:b.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then(function(r){var u=(r=r.data).errorInfo,d=r.filterConfig,_=r.lexicon,y=r.strToken,M=r.completeFlag,R=r.nextStartIndex,L=r.version,F=(r=r.expiredTime,u.errorCode),x=u.errorMessage;return F!==0?(e._isFetching=!1,D.w("".concat(a," failed. error:"),u),void n.setCode(F).setMessage(x).end()):(e._onFilterConfig(d),e._getToken(y),M===1?(D.l("".concat(a," done. version:").concat(L," expiredTime:").concat(r)),e._version=L,e._canIUseLexicon=!0,e._isFetching=!1,e._expiredTime=Date.now()+1e3*r,void e._plugin.onLexiconCompleted(_)):(e._startIndex=R,e._plugin.onLexiconSliced(_),void e._getLexicon()))}).catch(function(r){n.setError(r).end(),e._isFetching=!1,D.l("".concat(a," failed. error:"),r)})}},{key:"_onFilterConfig",value:function(e){var n=this;Se(e)||(this._filterConfigMap.clear(),Object.keys(e).forEach(function(a){n._filterConfigMap.set(a,e[a])}),D.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(e){return this._filterConfigMap.get(e)===1}},{key:"_getToken",value:function(e){if(Ee(e)){var n=e.length,a="";if(n%2==0)for(var r=0;r<=n-1;r+=2)a=(a+=e[r+1])+e[r];else{for(var u=0;u<n-1;u+=2)a=(a+=e[u+1])+e[u];a+=e[n-1]}this._plugin.onToken(a)}}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),zt),Nd=(N(cu,[{key:"_onCloudConfig",value:function(){var e=this,n=this._m.get(23).getCloudConfig("rtc_cmd");q(n)||((n=JSON.parse(n)).forEach(function(a){e._TRTCCommandList.includes(a)||e._TRTCCommandList.push(a)}),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var e,n=0,a=this._TRTCCommandList.length;n<a;n++)e=this._TRTCCommandList[n].split(".")[0],this._TRTCCommandMap.set(e,1)}},{key:"onRoomCustomDataReceived",value:function(e){this._m.getOEmitInst().emit(me.ROOM_CUSTOM_DATA_RECEIVED,e)}},{key:"sendTRTCCustomData",value:function(e){var n=e.serviceCommand,a=(e=e.data,"".concat(ee.NAME.TUIROOM_SVR,".*"));return q(n)||(a=n),this._isValidServiceCommand(a)?this._trans({servcmd:a,data:e}):j({code:X.INVALID_TRTC_CMD})}},{key:"_trans",value:function(e){D.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(e)));var n=e.servcmd;return e=e.data,this._m.get(20).trans({servcmd:n,data:Ee(e)?JSON.parse(e):e})}},{key:"_isValidServiceCommand",value:function(e){return e.endsWith(".*")?this._TRTCCommandList.includes(e):(e=e.split(".")[0],this._TRTCCommandMap.has(e))}},{key:"isTRTCCommand",value:function(e){return e=e.split(".")[0],this._TRTCCommandMap.has(e)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset"))}}]),cu),bd=(N(eo,[{key:"_init",value:function(){var e,n=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(n){try{e=JSON.parse(n)}catch(a){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),D.w("".concat(this._n,"._init error:"),a)}e&&(this._needToUpdate(e)?this._fetch():this._fillMap(e.message))}else this._fetch()}},{key:"_needToUpdate",value:function(e){var n=e.localSavedTime;return e=e.localSavedVersion,n=n&&new Date().getTime()-n>=this.STORAGE_EXPIRES_TIME,e=!e||e!=="3.4.8",D.l("".concat(this._n,"._needToUpdate isTimeout:").concat(n," isDifferentVersion:").concat(e)),n||e}},{key:"_fetch",value:function(){var e,n,a,r,u,d;this._m.get(12).isPrivateNetWork()||(e="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.6/tim-error-message.txt",n="application/x-www-form-urlencoded;charset=UTF-8",a="".concat(this._n,"._fetch ok in"),r=this,qe?vt.request({url:e,method:"GET",timeout:3e3,header:{"content-type":n},dataType:"text",success:function(_){r._fillAndSave(_.data),D.l("".concat(a," mini program"))},fail:function(){}}):(u=new XMLHttpRequest,d=setTimeout(function(){u.abort()},3e3),u.onreadystatechange=function(){u.readyState===4&&(clearTimeout(d),u.status!==200&&u.status!==304||(D.l("".concat(a," browser")),r._fillAndSave(u.responseText)))},u.open("GET",e,!0),u.setRequestHeader("Content-type",n),u.send()))}},{key:"_fillAndSave",value:function(e){this._fillMap(e),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:e,localSavedTime:new Date().getTime(),localSavedVersion:"3.4.8"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(e){this._map.clear();for(var n,a,r=e.split(`;
`),u=r.length,d=new RegExp(/'/g),_=0;_<u;_++)if(a=r[_].indexOf(":"),n=r[_].slice(0,a),a=r[_].slice(a+1,r[_].length),!n.startsWith("//")){if(q(a))continue;this._map.set(n,a.replace(d,""))}}},{key:"get",value:function(e){var n=e.isIntl,a=e.key,r=e.replacement1;return e=e.replacement2,n="".concat(a,n?"_en":"_cn"),!this._map.has(n)&&this._map.has(a)&&(n=a),a="",this._map.has(n)&&(a=this._map.get(n),q(r)||(a=a.replace("$replacement1",r)),q(e)||(a=a.replace("$replacement2",e))),a}},{key:"reset",value:function(){D.l("".concat(this._n,".reset"))}}]),eo),Pd=(N(ru,[{key:"onNewMessageList",value:function(e){var n=this;e.forEach(function(a){var r=n.getPayloadData(a);r&&n._handleActionType(r,a)})}},{key:"onMessageModified",value:function(e){var n=this;e.forEach(function(a){var r=n.getPayloadData(a);r&&n._onInvitationModified(r,a)})}},{key:"getPayloadData",value:function(e){var n="".concat(this._n,".getPayloadData");e=e.payload.data;try{return JSON.parse(e)}catch(a){return D.e("".concat(n," JSON parse error. signalingData:").concat(e)),null}}},{key:"_handleActionType",value:function(e,n){switch(e.actionType){case Me.ACTION_TYPE_INVITE:this._onNewInvitationReceived(e,n);break;case Me.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(e);break;case Me.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(e);break;case Me.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(e);break;case Me.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(e)}}},{key:"_genBaseEmitData",value:function(e){return{inviteID:e.inviteID,inviter:e.inviter,groupID:e.groupID,data:e.data||""}}},{key:"_onNewInvitationReceived",value:function(e,n){var a="".concat(this._n,"._onNewInvitationReceived"),r=e.inviteID,u=e.inviteeList,d=e.groupID,_=e.inviter,y=this._sigM.getMyUserID(),M=u.includes(y),R=e.timeout,L=(dc().getTime()-1e3*n.time)/1e3;0<R&&0<L&&L<R&&(R-=L),a="".concat(a," myselfIncluded:").concat(M," groupID:").concat(d," signalObj:").concat(JSON.stringify(e)),D.l("".concat(a," timeout:").concat(R,"s delta:").concat(L,"s")),(d&&M||!d)&&((a=this._sigM.getInviteInfo(r))&&a===e||(a||this._sigM.setInviteInfo(r,g(g({},e),{},{message:n})),this._sigM.emitEvent(Me.NEW_INVITATION_RECEIVED,g(g({},this._genBaseEmitData(e)),{},{inviteeList:u})),_!==y&&this._sigM.startTimer(g(g({},e),{},{timeout:R}))))}},{key:"_onInviteeRejected",value:function(e){var n="".concat(this._n,"._onInviteeRejected"),a=e.inviteID,r=e.inviter,u=e.groupID,d=this._sigM.hasInviteInfo(a);D.l("".concat(n," inviteID:").concat(a," hasInviteID:").concat(d," inviter:").concat(r," groupID:").concat(u)),d&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITEE_REJECTED,g(g({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(e){var n="".concat(this._n,"._onInviteeAccepted"),a=e.inviteID,r=e.inviter,u=e.groupID,d=this._sigM.hasInviteInfo(a);D.l("".concat(n," inviteID:").concat(a," hasInviteID:").concat(d," inviter:").concat(r," groupID:").concat(u)),d&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITEE_ACCEPTED,g(g({},this._genBaseEmitData(e)),{},{invitee:e.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(e){var n="".concat(this._n,"._onInvitationCancelled"),a=e.inviteID,r=e.inviter,u=e.groupID,d=this._sigM.hasInviteInfo(a);D.l("".concat(n," inviteID:").concat(a," hasInviteID:").concat(d," inviter:").concat(r," groupID:").concat(u)),d&&(this._sigM.deleteInviteInfo(a),this._sigM.emitEvent(Me.INVITATION_CANCELLED,this._genBaseEmitData(e)))}},{key:"_onInvitationTimeout",value:function(e){var n="".concat(this._n,"._onInvitationTimeout"),a=e.inviteID,r=e.inviter,u=e.groupID,d=e.inviteeList,_=this._sigM.hasInviteInfo(a);D.l("".concat(n," inviteID:").concat(a," hasInviteID:").concat(_," inviter:").concat(r," groupID:").concat(u,"  data:").concat(e.data)),_&&(this._sigM.updateInviteInfo(e),this._sigM.emitEvent(Me.INVITATION_TIMEOUT,g(g({},this._genBaseEmitData(e)),{},{inviteeList:d,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(e,n){var a="".concat(this._n,"._onInvitationModified"),r=e.inviteID,u=e.data;D.l("".concat(a," inviteID:").concat(r," data:").concat(u)),this._sigM.setInviteInfo(r,g(g({},e),{},{message:n})),this._sigM.emitEvent(Me.INVITATION_MODIFIED,{inviteID:r,data:u})}}]),ru),Gd=(N(su,[{key:"generateInviteID",value:function(){var e,n=(n=Qc)((e=Td)(32),8)+"-"+n(e(16),4)+"-"+n(16384|e(12),4)+"-"+n(32768|e(14),4)+"-"+n(e(48),12);return D.l("".concat(this._n,".generateInviteID inviteID:").concat(n)),n}},{key:"createInviteInfo",value:function(e){var n=this.generateInviteID(),a=(e=this.createInviteCustomData(g(g({},e),{},{inviteID:n}))).groupID,r=e.inviteeList;return a=a||r[0],{customData:e,message:this._sigM.createSignaling(e,a),inviteID:n}}},{key:"_genBaseCustomData",value:function(e){var n=e.data,a=e.inviteID;return{businessID:1,timeout:0,data:n===void 0?"":n,inviteID:a===void 0?"":a,groupID:(e=e.groupID)===void 0?"":e}}},{key:"createInviteCustomData",value:function(e){var n=e.userID,a=(a=e.timeout)===void 0?0:a,r=(r=e.groupID)===void 0?"":r,u=this._sigM.getMyUserID();return u=g(g({},this._genBaseCustomData(e)),{},{actionType:Me.ACTION_TYPE_INVITE,inviter:u,inviteeList:r?e.inviteeList:[n],timeout:a}),D.l("".concat(this._n,".createInviteCustomData customData:"),u),u}},{key:"createCancelCustomData",value:function(e){var n,a="".concat(this._n,".createCancelCustomData"),r=e.inviteID,u=this._sigM.getMyUserID(),d=(r=this._sigM.getInviteInfo(r)).inviteeList,_=r.groupID;return(r=r.inviter)===u?n=g(g({},this._genBaseCustomData(e)),{},{actionType:Me.ACTION_TYPE_CANCEL_INVITE,groupID:_,inviter:u,inviteeList:d}):D.e("".concat(a," unmatched inviter:").concat(r," and my userID:").concat(u)),D.l("".concat(a," customData:"),n),n}},{key:"createAcceptCustomData",value:function(e){var n,a="".concat(this._n,".createAcceptCustomData"),r=e.inviteID,u=this._sigM.getMyUserID(),d=this._sigM.getInviteInfo(r),_=d.inviter,y=d.groupID;return d.inviteeList.includes(u)?n=g(g({},this._genBaseCustomData(e)),{},{actionType:Me.ACTION_TYPE_ACCEPT_INVITE,groupID:y,inviter:_,inviteeList:[u]}):D.e("".concat(a," userID:").concat(u," not in inviteeList. inviteID:").concat(r," groupID:").concat(y)),D.l("".concat(a," customData:"),n),n}},{key:"createRejectCustomData",value:function(e){var n,a="".concat(this._n,".createRejectCustomData"),r=e.inviteID,u=this._sigM.getMyUserID(),d=this._sigM.getInviteInfo(r),_=d.inviter,y=d.groupID;return d.inviteeList.includes(u)?n=g(g({},this._genBaseCustomData(e)),{},{actionType:Me.ACTION_TYPE_REJECT_INVITE,groupID:y,inviter:_,inviteeList:[u]}):D.e("".concat(a," userID:").concat(u," not in inviteeList. inviteID:").concat(r," groupID:").concat(y)),D.l("".concat(a," customData:"),n),n}},{key:"createTimeoutCustomData",value:function(e){var n="".concat(this._n,".createTimeoutCustomData"),a=e.inviteeList,r=e.inviter,u=(u=e.isInviter)!==void 0&&u,d=this._sigM.getMyUserID();return e=g(g({},this._genBaseCustomData(e)),{},{actionType:Me.ACTION_TYPE_INVITE_TIMEOUT,inviter:r,inviteeList:u?a:[d]}),D.l("".concat(n," customData:"),e),e}}]),su),Ud=(N(au,[{key:"setCloudConfig",value:function(){var e=0<arguments.length&&arguments[0]!==void 0?arguments[0]:20,n=1<arguments.length&&arguments[1]!==void 0?arguments[1]:300;this.COUNT=e,this.EXPIRED_TIME=n,D.l("".concat(this._n,".setCloudConfig count:").concat(e,", time:").concat(n))}},{key:"getHistorySignaling",value:function(){var e=this,n=this._sigM.get(11).getLocalConvList();Se(n)||(this._getC2CSignalingList(),n=this._getValidGroupConvList(n),this._getGroupSignalingList(n).then(function(a){e._handleSignalingList(a)}))}},{key:"_getC2CSignalingList",value:function(){var e=this._sigM.get(6).getMessageListFromUnreadDB();e=this._sigM.filterMessageList(e),this._getRelatedToMeMap(e)}},{key:"_getGroupSignalingList",value:function(e){var n=this;return(e=this._createPromiseList(e)).length===0?Promise.resolve(this._sortSignaling(this._relatedToMeMap)):this._concurrentGetMessageList(e).then(function(a){var r=new Map;return a.forEach(function(u){u=u.list,u=n._getRelatedToMeMap(u),r=new Map([].concat(J(r),J(u)))}),n._sortSignaling(r)})}},{key:"_handleSignalingList",value:function(e){Se(e)||this._sigM.onNewMessageList(e)}},{key:"_getValidGroupConvList",value:function(e){for(var n=[],a=0,r=e.length;a<r;a++){var u=(_=e[a]).type,d=_.unreadCount,_=_.lastMessage;u=u===A.CONV_GROUP,_=this._isNotExpired(_),u&&d&&_&&n.push(e[a])}return n}},{key:"_isNotExpired",value:function(e){return!(!e||!e.lastTime)&&e.lastTime>Ji()-this.EXPIRED_TIME}},{key:"_createPromiseList",value:function(e){for(var n=[],a=0;a<e.length;a++){var r=(u=e[a]).conversationID,u=(u=u.unreadCount)<this.COUNT?u:this.COUNT;this._map.set(r,{msgCount:u,list:[]}),u=this._sigM.get(11).getMessageList({conversationID:r}),n.push(u)}return n}},{key:"_concurrentGetMessageList",value:function(e){var n=this,a=[];return Promise.all(e).then(function(r){for(var u=0;u<r.length;u++){var d=(_=r[u]).code,_=_.data;d===0&&_.messageList.length!==0&&(n._handleMessageList(_.messageList),(d=n._relayGetMessageList(_))&&a.push(d))}return 0<a.length?n._concurrentGetMessageList(a):n._map})}},{key:"_relayGetMessageList",value:function(e){var n=e.messageList,a=e.nextReqMessageID;if(e=e.isCompleted,n.length===0)return null;n=n[0].conversationID;var r=this._map.get(n).msgCount;return r===0||e?null:this._sigM.get(11).getMessageList({conversationID:n,nextReqMessageID:a,count:r})}},{key:"_handleMessageList",value:function(e){var n=e.length,a=e[0].conversationID,r=(u=this._map.get(a)).msgCount,u=u.list;this._map.set(a,{msgCount:0<r-n?r-n:0,list:u.concat(this._sigM.filterMessageList(e))})}},{key:"_getRelatedToMeMap",value:function(e){for(var n=0;n<e.length;n++){var a=e[n];this._saveRelatedToMe(a)}return this._relatedToMeMap}},{key:"_saveRelatedToMe",value:function(e){var n,a=(n=this._sigM.getPayloadData(e)||{}).actionType,r=(n=n.inviteID)===void 0?"":n;switch(a===void 0?"":a){case Me.ACTION_TYPE_INVITE:this._setHistoryInvite(e);break;case Me.ACTION_TYPE_REJECT_INVITE:case Me.ACTION_TYPE_ACCEPT_INVITE:this._updateHistoryInvite(e);break;case Me.ACTION_TYPE_CANCEL_INVITE:this._delHistoryInvite(r);break;case Me.ACTION_TYPE_INVITE_TIMEOUT:this._updateHistoryInvite(e)}}},{key:"_setHistoryInvite",value:function(e){var n=this._sigM.getPayloadData(e)||{},a=(a=n.inviteID)===void 0?"":a,r=(r=n.inviteeList)===void 0?[]:r,u=(u=n.timeout)===void 0?0:u,d=this._sigM.getMyUserID();r.includes(d)&&(r=Ji()-e.time,0<u&&u<r&&u!==0||this._relatedToMeMap.set(a,g(g({},n),{},{messageList:[e]})))}},{key:"_delHistoryInvite",value:function(e){this._relatedToMeMap.has(e)&&this._relatedToMeMap.delete(e)}},{key:"_updateHistoryInvite",value:function(e){var n=(n=(u=this._sigM.getPayloadData(e)||{}).inviteID)===void 0?"":n,a=(u=u.inviteeList)===void 0?[]:u;if(this._relatedToMeMap.has(n)){for(var r=(u=this._relatedToMeMap.get(n)).inviteeList,u=u.messageList,d=0;d<a.length;d++){var _=a[d];r.includes(_)&&r.splice(r.indexOf(_),1)}r.length===0?this._delHistoryInvite(n):u.push(e)}else this._delHistoryInvite(n)}},{key:"_sortSignaling",value:function(e){var n=[];return e.forEach(function(a){n=[].concat(J(n),J(a.messageList))}),n.sort(function(a,r){return a.time-r.time})}},{key:"reset",value:function(){this._map.clear(),this._relatedToMeMap.clear()}}]),au),wd=N(function e(n,a){v(this,e),this.businessID=n.businessID||1,this.inviteID=n.inviteID,this.groupID=n.groupID||"",this.inviter=n.inviter||"",this.inviteeList=n.inviteeList||[],this.data=n.data||"",this.actionType=n.actionType||Me.ACTION_TYPE_INVITE,this.timeout=n.timeout||0}),Fd=["message"],xd=["message"],qd=(V(Ks,an),Ia=ae(Ks),N(Ks,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isCloudConfigCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isCloudConfigCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onCloudConfig",value:function(){this._isCloudConfigCompleted=!0;var e=this.getCloudConfig("history_s_count"),n=this.getCloudConfig("history_s_time");q(e)||(e=Number(e)),q(n)||(n=Number(n)),this._historySignalingHandler.setCloudConfig(e,n),this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"_isListenerExisted",value:function(){return-1<this._m.getOEmitInst().eventNames().indexOf(Me.NEW_INVITATION_RECEIVED)}},{key:"onReady",value:function(){this._isSyncCompleted=!0;var e=this._isListenerExisted();D.l("".concat(this._n,".onReady. isListenerExisted: ").concat(e)),e&&this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onNewMessageList(e)}},{key:"onMessageModified",value:function(e){if(0<(e=this.filterMessageList(e)).length)return this._remoteSignalingHandler.onMessageModified(e)}},{key:"hasInviteInfo",value:function(e){return this._inviteInfoMap.has(e)}},{key:"getInviteInfo",value:function(e){return this._inviteInfoMap.get(e)}},{key:"setInviteInfo",value:function(e,n){var a=n.message;n=oe(n,Fd),D.l("".concat(this._n,".setInviteInfo inviteID:").concat(e," data:"),n),this._inviteInfoMap.set(e,g(g({},n),{},{message:a}))}},{key:"deleteInviteInfo",value:function(e){this.hasInviteInfo(e)&&(D.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(e,".")),this._inviteInfoMap.delete(e))}},{key:"updateInviteInfo",value:function(e){var n="".concat(this._n,".updateInviteInfo"),a=e.inviteID,r=e.inviter,u=e.inviteeList;e=e.groupID,D.l("".concat(n," inviteID:").concat(a," inviter:").concat(r," groupID:").concat(e)),e&&this.hasInviteInfo(a)?(r=u[0],(e=this.getInviteInfo(a).inviteeList).includes(r)&&(e.splice(e.indexOf(r),1),D.l("".concat(n," remove ").concat(r,". localInviteeList.length:").concat(e.length))),e.length===0&&this.deleteInviteInfo(a)):this.deleteInviteInfo(a)}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(e,n){this.emitOEvt(e,n)}},{key:"addSignalingListener",value:function(e,n,a){this._canIUseSignaling||(this._canIUseSignaling=!0),this._m.getOEmitInst().on(e,n,a)}},{key:"removeSignalingListener",value:function(e,n,a){this._m.getOEmitInst().off(e,n,a),this._isListenerExisted()||(this._canIUseSignaling=!1)}},{key:"invite",value:function(e){var n=this,a="".concat(this._n,".").concat("invite"),r=this._localSignalingHandler.createInviteInfo(e),u=r.message,d=r.customData,_=r.inviteID;return D.l("".concat(a," options:").concat(JSON.stringify(e)," inviteID:").concat(_)),this.sendSignaling(u,e).then(function(y){return y&&y.code===0?(n.setInviteInfo(_,g(g({},d),{},{message:u})),n.startTimer(g(g({},d),{},{inviteID:_})),g(g({},y),{},{inviteID:_})):y}).catch(function(y){return j(y)})}},{key:"inviteSync",value:function(e,n,a){var r=this,u="".concat(this._n,".").concat("inviteSync"),d=this._localSignalingHandler.createInviteInfo(e),_=d.message,y=d.customData,M=d.inviteID;return D.l("".concat(u," options:").concat(JSON.stringify(e)," inviteID:").concat(M)),this.sendSignaling(_,e).then(function(R){if(R&&R.code===0)return r.setInviteInfo(M,g(g({},y),{},{message:_})),r.startTimer(g(g({},y),{},{inviteID:M})),n&&n({inviteID:M}),{inviteID:M};a&&a(R.code===0,R.message||"")}).catch(function(R){return a&&a(R.code,R.message),j(R)}),M}},{key:"_handleImResponse",value:function(e,n,a){n&&n.code===0&&(this._isHandling=!1,a?this.deleteInviteInfo(e.inviteID):this.updateInviteInfo(e))}},{key:"cancel",value:function(e){var n=this,a="".concat(this._n,".").concat("cancel");if(D.l("".concat(a," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return j({code:X.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var r=this._localSignalingHandler.createCancelCustomData(e);if(!r)return this._isHandling=!1,j({code:X.SIGNALING_NO_PERMISSION});a=r.groupID;var u=r.inviteeList;return a=a||u[0],u=this.createSignaling(r,a),this.sendSignaling(u,e).then(function(d){return n._handleImResponse(r,d,!0),d.code===0?g(g({},d),{},{inviteID:e.inviteID}):d}).catch(function(d){return j(d)})}},{key:"accept",value:function(e){var n=this,a="".concat(this._n,".").concat("accept");if(D.l("".concat(a," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return j({code:X.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var r=this._localSignalingHandler.createAcceptCustomData(e);return r?(a=this.createSignaling(r),this.sendSignaling(a,e).then(function(u){return n._handleImResponse(r,u),u.code===0?g(g({},u),{},{inviteID:e.inviteID}):u}).catch(function(u){return j(u)})):(this._isHandling=!1,j({code:X.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(e){var n=this,a="".concat(this._n,".").concat("reject");if(D.l("".concat(a," options:").concat(JSON.stringify(e))),!this.hasInviteInfo(e.inviteID)||this._isHandling)return j({code:X.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var r=this._localSignalingHandler.createRejectCustomData(e);return r?(a=this.createSignaling(r),this.sendSignaling(a,e).then(function(u){return n._handleImResponse(r,u,!0),u.code===0?g(g({},u),{},{inviteID:e.inviteID}):u}).catch(function(u){return j(u)})):(this._isHandling=!1,j({code:X.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(e){var n="".concat(this._n,".getSignalingInfo"),a=e.ID,r=e.from,u=e.to,d=this._filterSignaling(e),_=null;return d&&(e=this.getPayloadData(e),_=new wd(e)),e=d?"actionType:".concat(_.actionType):"",D.l("".concat(n," messageID:").concat(a," from:").concat(r," to:").concat(u," ")+"".concat(e," isSignaling:").concat(d)),_}},{key:"modifyInvitation",value:function(e){var n=this,a=e.inviteID,r=e.data;if(!this.hasInviteInfo(e.inviteID)||this._isHandling)return j({code:X.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var u=(e=this.getInviteInfo(a)).message,d=oe(e,xd),_=u.payload.data;return d.data=r,u.payload.data=JSON.stringify(d),this.get(2).modifyRemoteMessage(u).then(function(y){return n.setInviteInfo(a,g(g({},d),{},{message:u})),n._isHandling=!1,y}).catch(function(y){return n._isHandling=!1,u.payload.data=_,j(y)})}},{key:"_genMsgCtrlInfo",value:function(){var e=(e=(u=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{}).data)===void 0?"":e,n=u.onlineUserOnly,a=(a=u.inviteID)===void 0?"":a,r=u.offlinePushInfo,u=u.actionType,d={_onlineOnlyFlag:!1};return a={onlineUserOnly:(d=a&&this.getInviteInfo(a)?this.getInviteInfo(a).message:d)._onlineOnlyFlag||n||!1,offlinePushInfo:r,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}},u===Me.ACTION_TYPE_INVITE_TIMEOUT?(d=!!e.match(/excludeTimeoutSignalingFromHistoryMessage/),a.messageControlInfo.excludedFromUnreadCount=d,a.messageControlInfo.excludedFromLastMessage=d,a):(n=!!e.match(/excludeFromHistoryMessage/),r=!!e.match(/excludeOriginalSignalingFromHistoryMessage/),a.messageControlInfo.excludedFromUnreadCount=n||r,a.messageControlInfo.excludedFromLastMessage=n||r,a)}},{key:"sendSignaling",value:function(e,n){var a=this;return this.get(2).sendMessageInstance(e,this._genMsgCtrlInfo(n)).catch(function(r){return a._isHandling=!1,j(r)})}},{key:"filterMessageList",value:function(e){var n=this;return e.filter(function(a){return n._filterSignaling(a)})}},{key:"getPayloadData",value:function(e){return this._remoteSignalingHandler.getPayloadData(e)}},{key:"createSignaling",value:function(e,n){var a=e.groupID,r=e.inviter;return n={to:n||a||r,conversationType:a?A.CONV_GROUP:A.CONV_C2C,priority:A.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(e)}},r=this.get(2).createCustomMessage(n),D.l("".concat(this._n,".createSignaling. message:"),r),r}},{key:"_filterSignaling",value:function(e){var n,a,r=!1;return e.type&&e.type===A.MSG_CUSTOM&&(n=e.cloudCustomData,e=(e=e.payload.data)===void 0?"":e,n=(n===void 0?"":n).match(/"type":"tsignaling"/),a=e.match(/inviteID/),e=e.match(/actionType/),r=n||a&&e),!!r}},{key:"startTimer",value:function(e){var n,a,r,u=this,d="".concat(this._n,".startTimer"),_=e.timeout,y=e.inviteID,M=e.inviter,R=e.groupID,L=M===this.getMyUserID();D.l("".concat(d," timeout:").concat(_," isInviter:").concat(L," groupID:").concat(R)),_<=0||(n=L?_+5:_,a=1,r=setInterval(function(){var F=u._hasLocalInviteInfo(e,L);a<n&&F?++a:(F&&u._sendTimeoutNotice(y,L),D.l("".concat(d," end.")),clearInterval(r))},1e3))}},{key:"_hasLocalInviteInfo",value:function(e,n){var a=e.inviteID;if(e=e.groupID,!this.hasInviteInfo(a))return!1;var r="".concat(this._n,"._hasLocalInviteInfo"),u=this.getInviteInfo(a).inviteeList;return D.l("".concat(r," inviteID:").concat(a," inviteeList:").concat(u," groupID:").concat(e)),!e||(n?0<u.length:0<u.length&&u.includes(this.getMyUserID()))}},{key:"_getReceiver",value:function(e,n){var a=n.groupID,r=n.inviteeList;return n=n.inviter,e?a||r[0]:a||n}},{key:"_sendTimeoutNotice",value:function(e,n){var a=this,r=this.getInviteInfo(e),u=this._getReceiver(n,r),d=(D.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(e," to:").concat(u," isInviter:").concat(n)),this._localSignalingHandler.createTimeoutCustomData(g(g({},r),{},{isInviter:n}))),_=this.createSignaling(d,u);return this.sendSignaling(_,d).then(function(y){var M,R,L;y&&y.code===0&&(y=d.data,M=d.groupID,R=d.inviteeList,L=d.inviter,a.emitEvent(Me.INVITATION_TIMEOUT,{data:y,groupID:M,inviteID:e,inviteeList:R,inviter:L,isSelfTimeout:!0,message:_}),n?a.deleteInviteInfo(e):a.updateInviteInfo(d))})}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1,this._isCloudConfigCompleted=!1}}]),Ks),Vd=["followDiffList"],io={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},Bd=(V(Hs,an),wr=ae(Hs),N(Hs,[{key:"_onCloudConfig",value:function(){var e=this.getCloudConfig("follow_req_count");q(e)||(e=Number(e),this.DEFAULT_COUNT=e>this.MAX_COUNT?this.MAX_COUNT:e,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList(),this._followType.clear()}},{key:"onFollowNotify",value:function(e){var n=this;e=e.dataList||[],D.l("".concat(this._n,".onFollowNotify followChangeList:").concat(e.length)),e.forEach(function(a){var r=(r=a.followDiffList)===void 0?[]:r,u=oe(a,Vd);r.forEach(function(d){var _=d.isAdd,y=(d=(d=d.followType)===void 0?[]:d,n._initFollowInfo());y[d].userInfoList.push(u),y[d].isAdd=_===1,n._emitEvent(y)})})}},{key:"_initFollowInfo",value:function(){var e={};return Object.values(io).forEach(function(n){n!==io.NONE&&(e[n]={userInfoList:[],isAdd:!1})}),e}},{key:"_emitEvent",value:function(e){var n=this;Object.keys(e).forEach(function(a){a=Number(a);var r=e[a];0<r.userInfoList.length&&(a===io.FOLLOWERS&&(n._clearFollowList(io.FOLLOWERS),n.emitOEvt(me.MY_FOLLOWERS_LIST_UPDATED,r)),a===io.FOLLOWING&&(n._clearFollowList(io.FOLLOWING),n.emitOEvt(me.MY_FOLLOWING_LIST_UPDATED,r)),a===io.MUTUAL&&(n._clearFollowList(io.MUTUAL),n.emitOEvt(me.MUTUAL_FOLLOWERS_LIST_UPDATED,r)))})}},{key:"followUser",value:function(e){if(!this.canIUse(Qe.FOLLOW))return this.noUse("followUser");var n="".concat(this._n,".").concat("followUser"),a="userIDList:".concat(e.length),r=new ce("followUser");return r.setMessage(a),D.l("".concat(n," ").concat(a)),this.req({P:b.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e.map(function(u){return{userID:u}})}}).then(function(u){return r.end(),D.l("".concat(n," ok.")),be(u.data.resultList)}).catch(function(u){return r.setError(u).end(),D.e("".concat(n," failed. error:"),u),j(u)})}},{key:"unfollowUser",value:function(e){if(!this.canIUse(Qe.FOLLOW))return this.noUse("unfollowUser");var n="".concat(this._n,".").concat("unfollowUser"),a="userIDList:".concat(e.length),r=new ce("unfollowUser");return r.setMessage(a),D.l("".concat(n," ").concat(a)),this.req({P:b.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:e}}).then(function(u){return r.end(),D.l("".concat(n," ok.")),be(u.data.resultList)}).catch(function(u){return r.setError(u).end(),D.e("".concat(n," failed. error:"),u),j(u)})}},{key:"getMyFollowersList",value:function(){var e=this,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",a="getMyFollowersList";if(!this.canIUse(Qe.FOLLOW))return this.noUse(a);var r=n||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(r)){var u=(_=this._myFollowersList.get(r)).resultList,d=_.nextCursor,_=_.lastUpdateTime;if(Date.now()-_<this.MAX_CATCH_TIME&&0<u.length)return D.l("".concat(this._n,".").concat(a," nextCursor:").concat(n," from local.")),Ke({resultList:u,nextCursor:d})}return this._getFollowList(n,io.FOLLOWERS).then(function(y){return e._myFollowersList.set(r,g(g({},y),{},{lastUpdateTime:Date.now()})),D.l("".concat(e._n,".").concat(a," nextCursor:").concat(n," from remote.")),be(y)})}},{key:"getMyFollowingList",value:function(){var e=this,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",a="getMyFollowingList";if(!this.canIUse(Qe.FOLLOW))return this.noUse(a);var r=n||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(r)){var u=(_=this._myFollowingList.get(r)).resultList,d=_.nextCursor,_=_.lastUpdateTime;if(Date.now()-_<this.MAX_CATCH_TIME&&0<u.length)return D.l("".concat(this._n,".").concat(a," nextCursor:").concat(n," from local.")),Ke({resultList:u,nextCursor:d})}return this._getFollowList(n,io.FOLLOWING).then(function(y){return e._myFollowingList.set(r,g(g({},y),{},{lastUpdateTime:Date.now()})),D.l("".concat(e._n,".").concat(a," nextCursor:").concat(n," from remote.")),be(y)})}},{key:"getMutualFollowersList",value:function(){var e=this,n=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",a="getMutualFollowersList";if(!this.canIUse(Qe.FOLLOW))return this.noUse(a);var r=n||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(r)){var u=(_=this._myMutualFollowersList.get(r)).resultList,d=_.nextCursor,_=_.lastUpdateTime;if(Date.now()-_<this.MAX_CATCH_TIME&&0<u.length)return D.l("".concat(this._n,".").concat(a," nextCursor:").concat(n," from local.")),Ke({resultList:u,nextCursor:d})}return this._getFollowList(n,io.MUTUAL).then(function(y){return e._myMutualFollowersList.set(r,g(g({},y),{},{lastUpdateTime:Date.now()})),D.l("".concat(e._n,".").concat(a," nextCursor:").concat(n," from remote.")),be(y)})}},{key:"_getFollowList",value:function(e,n){var a=this,r=new ce("_getFollowList");return r.setMessage("nextCursor:".concat(e," type:").concat(n)),this.req({P:b.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:e,type:n}}).then(function(u){r.end();var d=(d=(u=u.data).resultList)===void 0?[]:d,_=(u=(u=u.nextCursor)===void 0?"":u,[]);return d.forEach(function(y){var M=y.userID,R=y.followTime;y=y.profileList,_.push(g({userID:M,followTime:R},a._handleProfileItem(y===void 0?[]:y)))}),{resultList:_,nextCursor:u}}).catch(function(u){return r.setError(u).end(),D.e("".concat(a._n,"._getFollowList failed. error:"),u),j(u)})}},{key:"_handleProfileItem",value:function(e){var n={};return e.forEach(function(a){switch(a.tag){case Je.NICK:n.nick=a.value;break;case Je.GENDER:n.gender=a.value;break;case Je.BIRTHDAY:n.birthday=a.value;break;case Je.LOCATION:n.location=a.value;break;case Je.SELFSIGNATURE:n.selfSignature=a.value;break;case Je.ALLOWTYPE:n.allowType=a.value;break;case Je.LANGUAGE:n.language=a.value;break;case Je.AVATAR:n.avatar=a.value;break;case Je.MESSAGESETTINGS:n.messageSettings=a.value;break;case Je.ADMINFORBIDTYPE:n.adminForbidType=a.value;break;case Je.LEVEL:n.level=a.value;break;case Je.ROLE:n.role=a.value;break;default:n[a.tag]=a.value}}),n}},{key:"getUserFollowInfo",value:function(e){if(!this.canIUse(Qe.FOLLOW))return this.noUse("getUserFollowInfo");var n=e,a=!1,r=(q(e)&&(n=[this.getMyUserID()],a=!0),"".concat(this._n,".").concat("getUserFollowInfo")),u=(e="userIDList:".concat(n.length," isGetMyFollowInfo:").concat(a),new ce("getUserFollowInfo"));return u.setMessage(e),D.l("".concat(r," ").concat(e)),this.req({P:b.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:n}}).then(function(d){u.end(),D.l("".concat(r," ok.")),d=d.data.followInfoList;var _=[];return(d===void 0?[]:d).forEach(function(y){var M=y.followersCount,R=y.followingCount;y=y.mutualFollowersCount,_.push({followersCount:M,followingCount:R,mutualFollowersCount:y})}),be(_)}).catch(function(d){return u.setError(d).end(),D.e("".concat(r," failed. error:"),d),j(d)})}},{key:"checkFollowType",value:function(e){var n=this;if(!this.canIUse(Qe.FOLLOW))return this.noUse("checkFollowType");100<e.length&&(e=e.slice(0,100),D.w("".concat(a," ").concat(Ko(100))));var a="".concat(this._n,".").concat("checkFollowType"),r="userIDList length:".concat(e.length," "),u=new ce("checkFollowType"),d=(u.setMessage(r),D.l("".concat(a," ").concat(r)),[]),_=[];return e.forEach(function(y){var M;n._followType.has(y)?(M=n._followType.get(y),d.push({userID:y,followType:M})):_.push(y)}),D.l("".concat(a," from local count:").concat(d.length,", from remote count:").concat(_.length,".")),_.length===0?Ke(d):this.req({P:b.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:_}}).then(function(y){return u.end(),D.l("".concat(a," ok.")),((y=y.data.resultList)===void 0?[]:y).forEach(function(M){var R=M.userID;M=M.followType,n._setFollowType(R,M),d.push({userID:R,followType:M})}),be(d)}).catch(function(y){return u.setError(y).end(),D.e("".concat(a," failed. error:"),y),j(y)})}},{key:"_setFollowType",value:function(e,n){this._followType.set(e,n)}},{key:"_clearFollowList",value:function(e){if(q(e))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();e!==io.FOLLOWERS?e!==io.FOLLOWING?e!==io.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._clearFollowList(),this._followType.clear()}}]),Hs),tn=Bu(function(e,n){var a=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";n.assign=function(d){for(var _,y,M=Array.prototype.slice.call(arguments,1);M.length;){var R=M.shift();if(R){if(T(R)!=="object")throw new TypeError(R+"must be non-object");for(var L in R)_=R,y=L,Object.prototype.hasOwnProperty.call(_,y)&&(d[L]=R[L])}}return d},n.shrinkBuf=function(d,_){return d.length===_?d:d.subarray?d.subarray(0,_):(d.length=_,d)};var r={arraySet:function(d,_,y,M,R){if(_.subarray&&d.subarray)d.set(_.subarray(y,y+M),R);else for(var L=0;L<M;L++)d[R+L]=_[y+L]},flattenChunks:function(d){for(var _,y,M,R=0,L=0,F=d.length;L<F;L++)R+=d[L].length;for(M=new Uint8Array(R),L=_=0,F=d.length;L<F;L++)y=d[L],M.set(y,_),_+=y.length;return M}},u={arraySet:function(d,_,y,M,R){for(var L=0;L<M;L++)d[R+L]=_[y+L]},flattenChunks:function(d){return[].concat.apply([],d)}};n.setTyped=function(d){d?(n.Buf8=Uint8Array,n.Buf16=Uint16Array,n.Buf32=Int32Array,n.assign(n,r)):(n.Buf8=Array,n.Buf16=Array,n.Buf32=Array,n.assign(n,u))},n.setTyped(a)});function Hs(e){return v(this,Hs),(e=wr.call(this,e))._n="FollowModule",e._myFollowersList=new Map,e._myFollowingList=new Map,e._myMutualFollowersList=new Map,e._followType=new Map,e.MAX_CATCH_TIME=6e5,e.FIRST_PAGE_INDEX=mc(),e.DEFAULT_COUNT=500,e.MAX_COUNT=1e3,e.getIEmitInst().on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function Ks(e){v(this,Ks),(e=Ia.call(this,e))._n="SignalingModule",e._inviteInfoMap=new Map,e._canIUseSignaling=!1,e._isHandling=!1,e._remoteSignalingHandler=new Pd(de(e)),e._localSignalingHandler=new Gd(de(e)),e._historySignalingHandler=new Ud(de(e)),e._isC2CUnreadHandleCompleted=!1,e._isConvSyncCompleted=!1,e._isSyncCompleted=!1,e._isCloudConfigCompleted=!1;var n=e.getIEmitInst();return n.on(Kt.C2C_UNREAD_HANDLE_COMPLETED,e.onC2CUnreadHandleCompleted,de(e)),n.on(Kt.CONV_SYNC_COMPLETED,e.onConvSyncCompleted,de(e)),n.on(Kt.CLOUD_CONFIG,e.onCloudConfig,de(e)),e}function au(e){v(this,au),this._n="HistorySignalingHandler",this._sigM=e,this.COUNT=20,this.EXPIRED_TIME=300,this._map=new Map,this._relatedToMeMap=new Map}function su(e){v(this,su),this._n="LocalSignalingHandler",this._sigM=e}function ru(e){v(this,ru),this._n="RemoteSignalingHandler",this._sigM=e}function eo(e){v(this,eo),this._m=e,this._n="ErrMsgModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function cu(e){v(this,cu),this._m=e,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*","live_engine_pk.*","trtc_ai_service.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getIEmitInst().on(Kt.CLOUD_CONFIG,this._onCloudConfig,this)}function zt(e){return v(this,zt),(e=Fr.call(this,e))._n="ProfanityFilterModule",e._plugin=null,e._filterConfigMap=new Map,e._startIndex=0,e._version=0,e._canIUseLexicon=!1,e._isFetching=!1,e._expiredTime=0,e}function zo(e){var n;return v(this,zo),(n=xr.call(this,e))._m=e,n._n="TIMPushModule",n._pluginName="TIMPush",n._pushPlugin=void 0,n._androidPushConfig={},n._deviceToken="",n._businessID=0,n._iOSBusinessID=0,n._c2cUnreadCount=0,n._groupUnreadCount=0,n._isWebUniapp=0,n._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},n}function Jo(e){var n;return v(this,Jo),(n=qr.call(this,e))._m=e,n._n="OfflinePushModule",n._offlinePushPlugin=void 0,n._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},n._deviceToken="",n._businessID=0,n._iosBusinessID=0,n._c2cUnreadCount=0,n._groupUnreadCount=0,n._isWebUniapp=0,n}function Ws(e){v(this,Ws),this._m=e,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new kd(this)}function js(e){v(this,js),this._commercialConfigM=e,this._n="PurchasedFeatureHandler",this._isSCMReported=!1,this._featureMap=new Map}function Oi(e){return v(this,Oi),(e=il.call(this,e))._n="WorkerTimerModule",e._isWorkerEnabled=!0,e._workerTimer=null,e._timerID=-1,e._init(),e.getIEmitInst().on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function Ni(e){return v(this,Ni),(e=al.call(this,e))._n="SnsModule",e._friendHandler=new Ed(de(e)),e._friendApplicationHandler=new Dd(de(e)),e._friendGroupHandler=new Rd(de(e)),e.getIEmitInst().on(Kt.A2KEY_AND_TINYID_UPDATED,e.onContextUpdated,de(e)),e}function Ys(e){v(this,Ys),this._snsM=e,this._n="FriendGroupHandler",this._map=new Map}function bi(e){v(this,bi),Se(e)||(this.name=e.name||"",this.userIDList=e.userIDList||[],this.count=this.userIDList.length||0)}function Pi(e){v(this,Pi),this._snsM=e,this._n="FriendHandler",this._map=new Map,this._startIdx=0,this._standardSeq=0,this._customSeq=0,this._expirationTime=18e4}function Gi(e,n){v(this,Gi),this.userID=e,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var a={},r=[];if(a.userID=e,!Se(n))for(var u,d="",_=0,y=n.length;_<y;_++)if(d=n[_].tag,u=n[_].value,-1<d.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:d,value:u});else if(-1<d.indexOf("Tag_Profile_Custom"))r.push({key:d,value:u});else switch(d){case Je.NICK:a.nick=u;break;case Je.GENDER:a.gender=u;break;case Je.BIRTHDAY:a.birthday=u;break;case Je.LOCATION:a.location=u;break;case Je.SELFSIGNATURE:a.selfSignature=u;break;case Je.ALLOWTYPE:a.allowType=u;break;case Je.LANGUAGE:a.language=u;break;case Je.AVATAR:a.avatar=u;break;case Je.MESSAGESETTINGS:a.messageSettings=u;break;case Je.ADMINFORBIDTYPE:a.adminForbidType=u;break;case Je.LEVEL:a.level=u;break;case Je.ROLE:a.role=u;break;case co.REMARK:this.remark=u;break;case co.ADDTIME:this.addTime=u;break;case co.GROUP:this.groupList=JSON.parse(JSON.stringify(u));break;case co.ADDSOURCE:this.source=u;break;case co.ADDWORDING:break;default:D.l("snsProfileItem unknown tag->",n[_].tag)}this.profile=new ui(g(g({},a),{},{profileCustomField:r}))}function zs(e){v(this,zs),this._snsM=e,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSeq=0,this._map=new Map,this._unreadCount=0}function Ui(e){v(this,Ui),(e=Zc.call(this,e))._n="QualityStatModule",e.TAG="im-ssolog-quality-stat",e.reportIndex=0,e.wholePeriod=!1,e._qualityItems=[_r,Sc,Gt,Q,po,Ht,P,si,Ii,bo],e._messageSentItems=[Gt,Q,po,Ht,P],e._messageReceivedItems=[si,Ii,bo],e.REPORT_INTERVAL=120,e.REPORT_SDKAPPID_BLACKLIST=[],e.REPORT_TINYID_WHITELIST=[],e._statInfoArr=[],e._avgRTT=new ll,e._avgE2EDelay=new ul,e._rateMessageSent=new dl,e._rateMessageReceived=new pl;var n=e.getIEmitInst();return n.on(Kt.A2KEY_AND_TINYID_UPDATED,e._onLoginSuccess,de(e)),n.on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function wi(){v(this,wi),this._lastMap=new Map,this._currentMap=new Map}function Fi(){v(this,Fi),this._map=new Map}function Js(){v(this,Js),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function $s(){v(this,$s),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function xi(e){return v(this,xi),(e=eu.call(this,e))._n="RecoverMsgModule",e.PULL_LIMIT_COUNT=15,e}function qi(e){return v(this,qi),(e=tu.call(this,e))._n="CloudControlModule",e._cloudConfig=new Map,e._expiredTime=0,e._version=0,e._isFetching=!1,e}function Vi(e){return v(this,Vi),(e=nu.call(this,e))._n="SessionModule",e._platform=e.getPlatform(),e._pHandler=new zc(de(e)),e._msgDispatcher=new Md(de(e)),e._cmdFreqLimitMap=new Map,e._cmdReqInfoMap=new Map,e._serverOverloadInfoMap=new Map,e._incrementalPullContactFlag=!0,e._init(),e.getIEmitInst().on(Kt.CLOUD_CONFIG,e._onCloudConfig,de(e)),e}function Bi(e,n,a,r){for(var u=65535&e,d=e>>>16&65535,_=0;a!==0;){for(a-=_=2e3<a?2e3:a;d=d+(u=u+n[r++]|0)|0,--_;);u%=65521,d%=65521}return u|d<<16}function go(e,n,a,r){var u=uu,d=r+a;e^=-1;for(var _=r;_<d;_++)e=e>>>8^u[255&(e^n[_])];return~e}function Hi(e,n,a,r,u,d,_,y){var M,R,L,F,x,K,le,he,fe,Fe=y.bits,Re=0,ie=0,t=0,o=0,i=0,s=0,c=0,l=0,p=0,m=0,I=null,C=0,S=new tn.Buf16(16),k=new tn.Buf16(16),G=null,U=0;for(Re=0;Re<=15;Re++)S[Re]=0;for(ie=0;ie<r;ie++)S[n[a+ie]]++;for(i=Fe,o=15;1<=o&&S[o]===0;o--);if(o<i&&(i=o),o===0)return u[d++]=20971520,u[d++]=20971520,y.bits=1,0;for(t=1;t<o&&S[t]===0;t++);for(i<t&&(i=t),Re=l=1;Re<=15;Re++)if((l=(l<<1)-S[Re])<0)return-1;if(0<l&&(e===0||o!==1))return-1;for(k[1]=0,Re=1;Re<15;Re++)k[Re+1]=k[Re]+S[Re];for(ie=0;ie<r;ie++)n[a+ie]!==0&&(_[k[n[a+ie]]++]=ie);if(K=e===0?(I=G=_,19):e===1?(I=lu,C-=257,G=Xs,U-=257,256):(I=Qs,G=Zs,-1),Re=t,x=d,c=ie=m=0,L=-1,F=(p=1<<(s=i))-1,e===1&&852<p||e===2&&592<p)return 1;for(;;){for(fe=_[ie]<K?(he=0,_[ie]):_[ie]>K?(he=G[U+_[ie]],I[C+_[ie]]):(he=96,0),M=1<<(le=Re-c),t=R=1<<s;u[x+(m>>c)+(R-=M)]=le<<24|he<<16|fe,R!==0;);for(M=1<<Re-1;m&M;)M>>=1;if(m=M!==0?(m&M-1)+M:0,ie++,--S[Re]==0){if(Re===o)break;Re=n[a+_[ie]]}if(i<Re&&(m&F)!==L){for(x+=t,l=1<<(s=Re-(c=c===0?i:c));s+c<o&&!((l-=S[s+c])<=0);)s++,l<<=1;if(p+=1<<s,e===1&&852<p||e===2&&592<p)return 1;u[L=m&F]=i<<24|s<<16|x-d}}return m!==0&&(u[x+m]=Re-c<<24|64<<16),y.bits=i,0}tn.assign,tn.shrinkBuf,tn.setTyped,tn.Buf8,tn.Buf16,tn.Buf32;var uu=function(){for(var e=[],n=0;n<256;n++){for(var a=n,r=0;r<8;r++)a=1&a?3988292384^a>>>1:a>>>1;e[n]=a}return e}(),lu=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],Xs=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],Qs=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],Zs=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function Vr(e){return(e>>>24&255)+(e>>>8&65280)+((65280&e)<<8)+((255&e)<<24)}function Uo(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new tn.Buf16(320),this.work=new tn.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ma(e){var n;return e&&e.state?(n=e.state,e.total_in=e.total_out=n.total=0,e.msg="",n.wrap&&(e.adler=1&n.wrap),n.mode=1,n.last=0,n.havedict=0,n.dmax=32768,n.head=null,n.hold=0,n.bits=0,n.lencode=n.lendyn=new tn.Buf32(852),n.distcode=n.distdyn=new tn.Buf32(592),n.sane=1,n.back=-1,0):-2}function ml(e){var n;return e&&e.state?((n=e.state).wsize=0,n.whave=0,n.wnext=0,Ma(e)):-2}function vl(e,n){var a,r;return e&&e.state?(r=e.state,n<0?(a=0,n=-n):(a=1+(n>>4),n<48&&(n&=15)),n&&(n<8||15<n)?-2:(r.window!==null&&r.wbits!==n&&(r.window=null),r.wrap=a,r.wbits=n,ml(e))):-2}function yl(e,n){var a;return e?(a=new Uo,(e.state=a).window=null,(a=vl(e,n))!==0&&(e.state=null),a):-2}var du,pu,gu=!0;function Il(e,n,a,r){var u;return(e=e.state).window===null&&(e.wsize=1<<e.wbits,e.wnext=0,e.whave=0,e.window=new tn.Buf8(e.wsize)),r>=e.wsize?(tn.arraySet(e.window,n,a-e.wsize,e.wsize,0),e.wnext=0,e.whave=e.wsize):((u=e.wsize-e.wnext)>r&&(u=r),tn.arraySet(e.window,n,a-r,u,e.wnext),(r-=u)?(tn.arraySet(e.window,n,a-r,r,0),e.wnext=r,e.whave=e.wsize):(e.wnext+=u,e.wnext===e.wsize&&(e.wnext=0),e.whave<e.wsize&&(e.whave+=u))),0}var Ki={inflateReset:ml,inflateReset2:vl,inflateResetKeep:Ma,inflateInit:function(e){return yl(e,15)},inflateInit2:yl,inflate:function(e,n){var a,r,u,d,_,y,M,R,L,F,x,K,le,he,fe,Fe,Re,ie,t,o,i,s,c,l,p=0,m=new tn.Buf8(4),I=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!e||!e.state||!e.output||!e.input&&e.avail_in!==0)return-2;(a=e.state).mode===12&&(a.mode=13),_=e.next_out,u=e.output,M=e.avail_out,d=e.next_in,r=e.input,y=e.avail_in,R=a.hold,L=a.bits,F=y,x=M,s=0;e:for(;;)switch(a.mode){case 1:if(a.wrap===0){a.mode=13;break}for(;L<16;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(2&a.wrap&&R===35615){m[a.check=0]=255&R,m[1]=R>>>8&255,a.check=go(a.check,m,2,0),L=R=0,a.mode=2;break}if(a.flags=0,a.head&&(a.head.done=!1),!(1&a.wrap)||(((255&R)<<8)+(R>>8))%31){e.msg="incorrect header check",a.mode=30;break}if((15&R)!=8){e.msg="unknown compression method",a.mode=30;break}if(L-=4,i=8+(15&(R>>>=4)),a.wbits===0)a.wbits=i;else if(i>a.wbits){e.msg="invalid window size",a.mode=30;break}a.dmax=1<<i,e.adler=a.check=1,a.mode=512&R?10:12,L=R=0;break;case 2:for(;L<16;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(a.flags=R,(255&a.flags)!=8){e.msg="unknown compression method",a.mode=30;break}if(57344&a.flags){e.msg="unknown header flags set",a.mode=30;break}a.head&&(a.head.text=R>>8&1),512&a.flags&&(m[0]=255&R,m[1]=R>>>8&255,a.check=go(a.check,m,2,0)),L=R=0,a.mode=3;case 3:for(;L<32;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}a.head&&(a.head.time=R),512&a.flags&&(m[0]=255&R,m[1]=R>>>8&255,m[2]=R>>>16&255,m[3]=R>>>24&255,a.check=go(a.check,m,4,0)),L=R=0,a.mode=4;case 4:for(;L<16;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}a.head&&(a.head.xflags=255&R,a.head.os=R>>8),512&a.flags&&(m[0]=255&R,m[1]=R>>>8&255,a.check=go(a.check,m,2,0)),L=R=0,a.mode=5;case 5:if(1024&a.flags){for(;L<16;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}a.length=R,a.head&&(a.head.extra_len=R),512&a.flags&&(m[0]=255&R,m[1]=R>>>8&255,a.check=go(a.check,m,2,0)),L=R=0}else a.head&&(a.head.extra=null);a.mode=6;case 6:if(1024&a.flags&&((K=(K=a.length)>y?y:K)&&(a.head&&(i=a.head.extra_len-a.length,a.head.extra||(a.head.extra=new Array(a.head.extra_len)),tn.arraySet(a.head.extra,r,d,K,i)),512&a.flags&&(a.check=go(a.check,r,K,d)),y-=K,d+=K,a.length-=K),a.length))break e;a.length=0,a.mode=7;case 7:if(2048&a.flags){if(y===0)break e;for(K=0;i=r[d+K++],a.head&&i&&a.length<65536&&(a.head.name+=String.fromCharCode(i)),i&&K<y;);if(512&a.flags&&(a.check=go(a.check,r,K,d)),y-=K,d+=K,i)break e}else a.head&&(a.head.name=null);a.length=0,a.mode=8;case 8:if(4096&a.flags){if(y===0)break e;for(K=0;i=r[d+K++],a.head&&i&&a.length<65536&&(a.head.comment+=String.fromCharCode(i)),i&&K<y;);if(512&a.flags&&(a.check=go(a.check,r,K,d)),y-=K,d+=K,i)break e}else a.head&&(a.head.comment=null);a.mode=9;case 9:if(512&a.flags){for(;L<16;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(R!==(65535&a.check)){e.msg="header crc mismatch",a.mode=30;break}L=R=0}a.head&&(a.head.hcrc=a.flags>>9&1,a.head.done=!0),e.adler=a.check=0,a.mode=12;break;case 10:for(;L<32;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}e.adler=a.check=Vr(R),L=R=0,a.mode=11;case 11:if(a.havedict===0)return e.next_out=_,e.avail_out=M,e.next_in=d,e.avail_in=y,a.hold=R,a.bits=L,2;e.adler=a.check=1,a.mode=12;case 12:if(n===5||n===6)break e;case 13:if(a.last){R>>>=7&L,L-=7&L,a.mode=27;break}for(;L<3;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}switch(a.last=1&R,--L,3&(R>>>=1)){case 0:a.mode=14;break;case 1:C=S=void 0;var C,S=a;if(gu){for(du=new tn.Buf32(512),pu=new tn.Buf32(32),C=0;C<144;)S.lens[C++]=8;for(;C<256;)S.lens[C++]=9;for(;C<280;)S.lens[C++]=7;for(;C<288;)S.lens[C++]=8;for(Hi(1,S.lens,0,288,du,0,S.work,{bits:9}),C=0;C<32;)S.lens[C++]=5;Hi(2,S.lens,0,32,pu,0,S.work,{bits:5}),gu=!1}if(S.lencode=du,S.lenbits=9,S.distcode=pu,S.distbits=5,a.mode=20,n!==6)break;R>>>=2,L-=2;break e;case 2:a.mode=17;break;case 3:e.msg="invalid block type",a.mode=30}R>>>=2,L-=2;break;case 14:for(R>>>=7&L,L-=7&L;L<32;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if((65535&R)!=(R>>>16^65535)){e.msg="invalid stored block lengths",a.mode=30;break}if(a.length=65535&R,L=R=0,a.mode=15,n===6)break e;case 15:a.mode=16;case 16:if(K=a.length){if((K=M<(K=y<K?y:K)?M:K)===0)break e;tn.arraySet(u,r,d,K,_),y-=K,d+=K,M-=K,_+=K,a.length-=K;break}a.mode=12;break;case 17:for(;L<14;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(a.nlen=257+(31&R),R>>>=5,L-=5,a.ndist=1+(31&R),R>>>=5,L-=5,a.ncode=4+(15&R),R>>>=4,L-=4,286<a.nlen||30<a.ndist){e.msg="too many length or distance symbols",a.mode=30;break}a.have=0,a.mode=18;case 18:for(;a.have<a.ncode;){for(;L<3;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}a.lens[I[a.have++]]=7&R,R>>>=3,L-=3}for(;a.have<19;)a.lens[I[a.have++]]=0;if(a.lencode=a.lendyn,a.lenbits=7,c={bits:a.lenbits},s=Hi(0,a.lens,0,19,a.lencode,0,a.work,c),a.lenbits=c.bits,s){e.msg="invalid code lengths set",a.mode=30;break}a.have=0,a.mode=19;case 19:for(;a.have<a.nlen+a.ndist;){for(;Fe=(p=a.lencode[R&(1<<a.lenbits)-1])>>>16&255,Re=65535&p,!((fe=p>>>24)<=L);){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(Re<16)R>>>=fe,L-=fe,a.lens[a.have++]=Re;else{if(Re===16){for(l=fe+2;L<l;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(R>>>=fe,L-=fe,a.have===0){e.msg="invalid bit length repeat",a.mode=30;break}i=a.lens[a.have-1],K=3+(3&R),R>>>=2,L-=2}else if(Re===17){for(l=fe+3;L<l;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}i=0,K=3+(7&(R>>>=fe)),R>>>=3,L=L-fe-3}else{for(l=fe+7;L<l;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}i=0,K=11+(127&(R>>>=fe)),R>>>=7,L=L-fe-7}if(a.have+K>a.nlen+a.ndist){e.msg="invalid bit length repeat",a.mode=30;break}for(;K--;)a.lens[a.have++]=i}}if(a.mode===30)break;if(a.lens[256]===0){e.msg="invalid code -- missing end-of-block",a.mode=30;break}if(a.lenbits=9,c={bits:a.lenbits},s=Hi(1,a.lens,0,a.nlen,a.lencode,0,a.work,c),a.lenbits=c.bits,s){e.msg="invalid literal/lengths set",a.mode=30;break}if(a.distbits=6,a.distcode=a.distdyn,c={bits:a.distbits},s=Hi(2,a.lens,a.nlen,a.ndist,a.distcode,0,a.work,c),a.distbits=c.bits,s){e.msg="invalid distances set",a.mode=30;break}if(a.mode=20,n===6)break e;case 20:a.mode=21;case 21:if(6<=y&&258<=M){e.next_out=_,e.avail_out=M,e.next_in=d,e.avail_in=y,a.hold=R,a.bits=L,_t=et=$=Z=Y=U=G=k=$n=So=_n=To=$e=ot=hn=nn=Xt=Xo=cn=Pt=Jt=We=lt=Ge=Pe=void 0;var k,G,U,Y,Z,$,De=e,_e=x,Pe=De.state,Ge=De.next_in,et=De.input,lt=Ge+(De.avail_in-5),We=De.next_out,_t=De.output,Jt=We-(_e-De.avail_out),Pt=We+(De.avail_out-257),cn=Pe.dmax,Xo=Pe.wsize,Xt=Pe.whave,nn=Pe.wnext,hn=Pe.window,ot=Pe.hold,$e=Pe.bits,To=Pe.lencode,_n=Pe.distcode,So=(1<<Pe.lenbits)-1,$n=(1<<Pe.distbits)-1;t:do for($e<15&&(ot+=et[Ge++]<<$e,$e+=8,ot+=et[Ge++]<<$e,$e+=8),k=To[ot&So];;){if(ot>>>=G=k>>>24,$e-=G,(G=k>>>16&255)==0)_t[We++]=65535&k;else{if(!(16&G)){if(!(64&G)){k=To[(65535&k)+(ot&(1<<G)-1)];continue}if(32&G){Pe.mode=12;break t}De.msg="invalid literal/length code",Pe.mode=30;break t}for(U=65535&k,(G&=15)&&($e<G&&(ot+=et[Ge++]<<$e,$e+=8),U+=ot&(1<<G)-1,ot>>>=G,$e-=G),$e<15&&(ot+=et[Ge++]<<$e,$e+=8,ot+=et[Ge++]<<$e,$e+=8),k=_n[ot&$n];;){if(ot>>>=G=k>>>24,$e-=G,!(16&(G=k>>>16&255))){if(!(64&G)){k=_n[(65535&k)+(ot&(1<<G)-1)];continue}De.msg="invalid distance code",Pe.mode=30;break t}if(Y=65535&k,$e<(G&=15)&&(ot+=et[Ge++]<<$e,($e+=8)<G&&(ot+=et[Ge++]<<$e,$e+=8)),(Y+=ot&(1<<G)-1)>cn){De.msg="invalid distance too far back",Pe.mode=30;break t}if(ot>>>=G,$e-=G,Y>(G=We-Jt)){if((G=Y-G)>Xt&&Pe.sane){De.msg="invalid distance too far back",Pe.mode=30;break t}if($=hn,(Z=0)===nn){if(Z+=Xo-G,G<U){for(U-=G;_t[We++]=hn[Z++],--G;);Z=We-Y,$=_t}}else if(nn<G){if(Z+=Xo+nn-G,(G-=nn)<U){for(U-=G;_t[We++]=hn[Z++],--G;);if(Z=0,nn<U){for(U-=G=nn;_t[We++]=hn[Z++],--G;);Z=We-Y,$=_t}}}else if(Z+=nn-G,G<U){for(U-=G;_t[We++]=hn[Z++],--G;);Z=We-Y,$=_t}for(;2<U;)_t[We++]=$[Z++],_t[We++]=$[Z++],_t[We++]=$[Z++],U-=3;U&&(_t[We++]=$[Z++],1<U&&(_t[We++]=$[Z++]))}else{for(Z=We-Y;_t[We++]=_t[Z++],_t[We++]=_t[Z++],_t[We++]=_t[Z++],2<(U-=3););U&&(_t[We++]=_t[Z++],1<U&&(_t[We++]=_t[Z++]))}break}}break}while(Ge<lt&&We<Pt);Ge-=U=$e>>3,ot&=(1<<($e-=U<<3))-1,De.next_in=Ge,De.next_out=We,De.avail_in=Ge<lt?lt-Ge+5:5-(Ge-lt),De.avail_out=We<Pt?Pt-We+257:257-(We-Pt),Pe.hold=ot,Pe.bits=$e,_=e.next_out,u=e.output,M=e.avail_out,d=e.next_in,r=e.input,y=e.avail_in,R=a.hold,L=a.bits,a.mode===12&&(a.back=-1);break}for(a.back=0;Fe=(p=a.lencode[R&(1<<a.lenbits)-1])>>>16&255,Re=65535&p,!((fe=p>>>24)<=L);){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(Fe&&!(240&Fe)){for(ie=fe,t=Fe,o=Re;Fe=(p=a.lencode[o+((R&(1<<ie+t)-1)>>ie)])>>>16&255,Re=65535&p,!(ie+(fe=p>>>24)<=L);){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}R>>>=ie,L-=ie,a.back+=ie}if(R>>>=fe,L-=fe,a.back+=fe,a.length=Re,Fe===0){a.mode=26;break}if(32&Fe){a.back=-1,a.mode=12;break}if(64&Fe){e.msg="invalid literal/length code",a.mode=30;break}a.extra=15&Fe,a.mode=22;case 22:if(a.extra){for(l=a.extra;L<l;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}a.length+=R&(1<<a.extra)-1,R>>>=a.extra,L-=a.extra,a.back+=a.extra}a.was=a.length,a.mode=23;case 23:for(;Fe=(p=a.distcode[R&(1<<a.distbits)-1])>>>16&255,Re=65535&p,!((fe=p>>>24)<=L);){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(!(240&Fe)){for(ie=fe,t=Fe,o=Re;Fe=(p=a.distcode[o+((R&(1<<ie+t)-1)>>ie)])>>>16&255,Re=65535&p,!(ie+(fe=p>>>24)<=L);){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}R>>>=ie,L-=ie,a.back+=ie}if(R>>>=fe,L-=fe,a.back+=fe,64&Fe){e.msg="invalid distance code",a.mode=30;break}a.offset=Re,a.extra=15&Fe,a.mode=24;case 24:if(a.extra){for(l=a.extra;L<l;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}a.offset+=R&(1<<a.extra)-1,R>>>=a.extra,L-=a.extra,a.back+=a.extra}if(a.offset>a.dmax){e.msg="invalid distance too far back",a.mode=30;break}a.mode=25;case 25:if(M===0)break e;if(a.offset>(K=x-M)){if((K=a.offset-K)>a.whave&&a.sane){e.msg="invalid distance too far back",a.mode=30;break}le=K>a.wnext?(K-=a.wnext,a.wsize-K):a.wnext-K,K>a.length&&(K=a.length),he=a.window}else he=u,le=_-a.offset,K=a.length;for(M-=K=M<K?M:K,a.length-=K;u[_++]=he[le++],--K;);a.length===0&&(a.mode=21);break;case 26:if(M===0)break e;u[_++]=a.length,M--,a.mode=21;break;case 27:if(a.wrap){for(;L<32;){if(y===0)break e;y--,R|=r[d++]<<L,L+=8}if(x-=M,e.total_out+=x,a.total+=x,x&&(e.adler=a.check=(a.flags?go:Bi)(a.check,u,x,_-x)),x=M,(a.flags?R:Vr(R))!==a.check){e.msg="incorrect data check",a.mode=30;break}L=R=0}a.mode=28;case 28:if(a.wrap&&a.flags){for(;L<32;){if(y===0)break e;y--,R+=r[d++]<<L,L+=8}if(R!==(4294967295&a.total)){e.msg="incorrect length check",a.mode=30;break}L=R=0}a.mode=29;case 29:s=1;break e;case 30:s=-3;break e;case 31:return-4;default:return-2}return e.next_out=_,e.avail_out=M,e.next_in=d,e.avail_in=y,a.hold=R,a.bits=L,(a.wsize||x!==e.avail_out&&a.mode<30&&(a.mode<27||n!==4))&&Il(e,e.output,e.next_out,x-e.avail_out),F-=e.avail_in,x-=e.avail_out,e.total_in+=F,e.total_out+=x,a.total+=x,a.wrap&&x&&(e.adler=a.check=(a.flags?go:Bi)(a.check,u,x,e.next_out-x)),e.data_type=a.bits+(a.last?64:0)+(a.mode===12?128:0)+(a.mode===20||a.mode===15?256:0),(F==0&&x===0||n===4)&&s===0?-5:s},inflateEnd:function(e){if(!e||!e.state)return-2;var n=e.state;return n.window&&(n.window=null),e.state=null,0},inflateGetHeader:function(e,n){var a;return e&&e.state&&2&(a=e.state).wrap?((a.head=n).done=!1,0):-2},inflateSetDictionary:function(e,n){var a,r=n.length;return!e||!e.state||(a=e.state).wrap!==0&&a.mode!==11?-2:a.mode===11&&Bi(1,n,r,0)!==a.check?-3:Il(e,n,r,r)?(a.mode=31,-4):(a.havedict=1,0)},inflateInfo:"pako inflate (from Nodeca project)"},hu=!0,_u=!0;try{String.fromCharCode.apply(null,[0])}catch(e){hu=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(e){_u=!1}for(var Ca=new tn.Buf8(256),wo=0;wo<256;wo++)Ca[wo]=252<=wo?6:248<=wo?5:240<=wo?4:224<=wo?3:192<=wo?2:1;function fu(e,n){for(var a,r,u=n||e.length,d=new Array(2*u),_=0,y=0;y<u;)if((a=e[y++])<128)d[_++]=a;else if(4<(r=Ca[a]))d[_++]=65533,y+=r-1;else{for(a&=r===2?31:r===3?15:7;1<r&&y<u;)a=a<<6|63&e[y++],r--;1<r?d[_++]=65533:a<65536?d[_++]=a:(a-=65536,d[_++]=55296|a>>10&1023,d[_++]=56320|1023&a)}var M=d,R=_;if(R<65534&&(M.subarray&&_u||!M.subarray&&hu))return String.fromCharCode.apply(null,tn.shrinkBuf(M,R));for(var L="",F=0;F<R;F++)L+=String.fromCharCode(M[F]);return L}function Ml(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Cl(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}Ca[254]=Ca[254]=1;var pn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},Br={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},mu=Object.prototype.toString;function Co(e){if(!(this instanceof Co))return new Co(e);this.options=tn.assign({chunkSize:16384,windowBits:0,to:""},e||{});var n=this.options;if(n.raw&&0<=n.windowBits&&n.windowBits<16&&(n.windowBits=-n.windowBits,n.windowBits===0&&(n.windowBits=-15)),!(0<=n.windowBits&&n.windowBits<16)||e&&e.windowBits||(n.windowBits+=32),15<n.windowBits&&n.windowBits<48&&!(15&n.windowBits)&&(n.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Ml,this.strm.avail_out=0,(e=Ki.inflateInit2(this.strm,n.windowBits))!==pn.Z_OK)throw new Error(Br[e]);if(this.header=new Cl,Ki.inflateGetHeader(this.strm,this.header),n.dictionary&&(typeof n.dictionary=="string"?n.dictionary=function(a){for(var r,u,d,_,y=a.length,M=0,R=0;R<y;R++)(64512&(u=a.charCodeAt(R)))==55296&&R+1<y&&(64512&(d=a.charCodeAt(R+1)))==56320&&(u=65536+(u-55296<<10)+(d-56320),R++),M+=u<128?1:u<2048?2:u<65536?3:4;for(r=new tn.Buf8(M),R=_=0;_<M;R++)(64512&(u=a.charCodeAt(R)))==55296&&R+1<y&&(64512&(d=a.charCodeAt(R+1)))==56320&&(u=65536+(u-55296<<10)+(d-56320),R++),u<128?r[_++]=u:(u<2048?r[_++]=192|u>>>6:(u<65536?r[_++]=224|u>>>12:(r[_++]=240|u>>>18,r[_++]=128|u>>>12&63),r[_++]=128|u>>>6&63),r[_++]=128|63&u);return r}(n.dictionary):mu.call(n.dictionary)==="[object ArrayBuffer]"&&(n.dictionary=new Uint8Array(n.dictionary)),n.raw&&(e=Ki.inflateSetDictionary(this.strm,n.dictionary))!==pn.Z_OK))throw new Error(Br[e])}function Fo(e,n){if((n=new Co(n)).push(e,!0),n.err)throw n.msg||Br[n.err];return n.result}Co.prototype.push=function(e,n){var a,r,u,d,_,y=this.strm,M=this.options.chunkSize,R=this.options.dictionary,L=!1;if(this.ended)return!1;r=n===~~n?n:n===!0?pn.Z_FINISH:pn.Z_NO_FLUSH,typeof e=="string"?y.input=function(F){for(var x=new tn.Buf8(F.length),K=0,le=x.length;K<le;K++)x[K]=F.charCodeAt(K);return x}(e):mu.call(e)==="[object ArrayBuffer]"?y.input=new Uint8Array(e):y.input=e,y.next_in=0,y.avail_in=y.input.length;do{if(y.avail_out===0&&(y.output=new tn.Buf8(M),y.next_out=0,y.avail_out=M),(a=(a=Ki.inflate(y,pn.Z_NO_FLUSH))===pn.Z_NEED_DICT&&R?Ki.inflateSetDictionary(this.strm,R):a)===pn.Z_BUF_ERROR&&L===!0&&(a=pn.Z_OK,L=!1),a!==pn.Z_STREAM_END&&a!==pn.Z_OK)return this.onEnd(a),!(this.ended=!0);y.next_out&&(y.avail_out!==0&&a!==pn.Z_STREAM_END&&(y.avail_in!==0||r!==pn.Z_FINISH&&r!==pn.Z_SYNC_FLUSH)||(this.options.to==="string"?(u=function(F,x){for(var K=(x=(x=x||F.length)>F.length?F.length:x)-1;0<=K&&(192&F[K])==128;)K--;return!(K<0||K===0)&&K+Ca[F[K]]>x?K:x}(y.output,y.next_out),d=y.next_out-u,_=fu(y.output,u),y.next_out=d,y.avail_out=M-d,d&&tn.arraySet(y.output,y.output,u,d,0),this.onData(_)):this.onData(tn.shrinkBuf(y.output,y.next_out)))),y.avail_in===0&&y.avail_out===0&&(L=!0)}while((0<y.avail_in||y.avail_out===0)&&a!==pn.Z_STREAM_END);return(r=a===pn.Z_STREAM_END?pn.Z_FINISH:r)===pn.Z_FINISH?(a=Ki.inflateEnd(this.strm),this.onEnd(a),this.ended=!0,a===pn.Z_OK):r!==pn.Z_SYNC_FLUSH||(this.onEnd(pn.Z_OK),!(y.avail_out=0))},Co.prototype.onData=function(e){this.chunks.push(e)},Co.prototype.onEnd=function(e){e===pn.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=tn.flattenChunks(this.chunks)),this.chunks=[],this.err=e,this.msg=this.strm.msg},Ve={};var Hd=((0,tn.assign)(Ve,{Inflate:Co,inflate:Fo,inflateRaw:function(e,n){return(n=n||{}).raw=!0,Fo(e,n)},ungzip:Fo},pn),Ve),Kd=(N(yu,[{key:"inflate",value:function(e){e=new Uint8Array(e).slice(4);var n,a=Date.now();try{n=Hd.inflate(e,{to:"string"}),this._bLogForInflateOK||(this._bLogForInflateOK=!0,new ce("inflateOK").end())}catch(u){return this._bLogForInflateError?void 0:(this._bLogForInflateError=!0,void new ce("inflateError").setMessage(u).end())}e=e.length+4;var r=n.length;return D.d("inflate ok. zipped:".concat(e," unzipped:").concat(r)+" compression ratio:".concat(Math.round(100*(r-e)/r),"% cost:").concat(Date.now()-a)),n}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._bLogForInflateOK=!1,this._bLogForInflateError=!1}}]),yu),Wd=(N(Hr,[{key:"_startTimer",value:function(){var e=this._map.get(24),n=e.isWorkerEnabled();D.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(n," seed:").concat(this._checkTimer)),n?e.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),D.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var e=this._map.get(24),n=e.isWorkerEnabled();D.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(n," seed:").concat(this._checkTimer)),n?e.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){D.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){D.l("".concat(this._n,"._stopMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!0),e.reConnect()}},{key:"_startMainThreadSocket",value:function(){D.l("".concat(this._n,"._startMainThreadSocket"));var e=this._map.get(21);e.setIsWorkerEnabled(!1),e.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){D.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){D.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var e,n=Ne(this._map);try{for(n.s();!(e=n.n()).done;){var a=te(e.value,2)[1];a.onCheckTimer&&a.onCheckTimer(this._checkCount)}}catch(r){n.e(r)}finally{n.f()}}},{key:"_initReadyList",value:function(){var e=this;this._readyList=[this._map.get(1)],this._readyList.forEach(function(n){n.ready(function(){return e._onModuleReady()})})}},{key:"_onModuleReady",value:function(){var e,n,a=!0;this._readyList.forEach(function(r){r.isReady()||(a=!1)}),a&&!this._isReady&&(this._isReady=!0,this._oEmitter.emit(me.SDK_READY),e=Date.now()-this._startLoginTs,D.w("SDK is ready. cost ".concat(e," ms")),this._startLoginTs=Date.now(),n=this._ssoLogForReady.getStartTs()+no,this._ssoLogForReady.setMessage(e).start(n).end())}},{key:"login",value:function(){this._startLoginTs===0&&(zi(),this._startLoginTs=Date.now(),this._startTimer(),this._map.get(15).start(),this._ssoLogForReady=new ce("sdkReady"),this._reason=X.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOEmitInst",value:function(){return this._oEmitter===null&&(this._oEmitter=new Ar,e=this._oEmitter,dn=e,this._oEmitter._emit=this._oEmitter.emit,this._oEmitter.emit=function(n,a){var r,u,d=this;this._canIUseSignaling()&&(n===me.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(a),n===me.MESSAGE_MODIFIED&&this.get(33).onMessageModified(a)),n===me.CONVERSATION_LIST_UPDATED||n===me.FRIEND_LIST_UPDATED||n===me.GROUP_LIST_UPDATED||n===me.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._eventThrottling!==!1?this._eventThrottleMap.has(n)?(r=Date.now())-(u=this._eventThrottleMap.get(n)).last<=1e3?(u.timeoutID&&clearTimeout(u.timeoutID),u.timeoutID=setTimeout(function(){u.last=Date.now(),d._oEmitter._emit.apply(d._oEmitter,[n,{name:n,data:d._getEventData(n)}])},1e3)):(u.last=r,this._oEmitter._emit.apply(this._oEmitter,[n,{name:n,data:this._getEventData(n)}])):(this._eventThrottleMap.set(n,{last:Date.now(),timeoutID:-1}),this._oEmitter._emit.apply(this._oEmitter,[n,{name:n,data:this._getEventData(n)}])):this._oEmitter._emit.apply(this._oEmitter,[n,{name:n,data:this._getEventData(n)}]):this._oEmitter._emit.apply(this._oEmitter,[n,{name:n,data:a}])}.bind(this)),this._oEmitter;var e}},{key:"_canIUseSignaling",value:function(){var e=this.get(33);return!!e&&e.canIUseSignaling()}},{key:"_getEventData",value:function(e){return e===me.CONVERSATION_LIST_UPDATED?this._map.get(12).isPartialUpdatedConvs()?this._map.get(11).getPartialUpdatedConvs():this._map.get(11).getLocalConvList():e===me.FRIEND_LIST_UPDATED?this._map.get(8).getLocalFriendList(!1):e===me.GROUP_LIST_UPDATED?this._map.get(7).getLocalGroupList():e===me.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._map.get(11).getTotalUnreadCount():e===me.CONVERSATION_ID_LIST_UPDATED?this._map.get(11).getUpdatedConvIDList():void 0}},{key:"getIEmitInst",value:function(){return this._iEmitter===null&&(this._iEmitter=new Ar,this._iEmitter._emit=this._iEmitter.emit,this._iEmitter.emit=function(e,n){e=ye(n)&&n.data?[e,{name:e,data:n.data}]:[e,{name:e,data:n}],this._iEmitter._emit.apply(this._iEmitter,e)}.bind(this)),this._iEmitter}},{key:"hasModule",value:function(e){return this._map.has(e)}},{key:"get",value:function(e){return this._map.get(e)}},{key:"canIUseModule",value:function(e){return!this._map.get(12).isUsingChatCore()||this._optionalModuleMap.has(e)}},{key:"canIUseInflate",value:function(){return!!this._map.get(37)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(e){this._reason=e}},{key:"getErrMsg",value:function(e,n,a){return this._map.get(32).get({key:e,replacement1:n,replacement2:a,isIntl:this.isIntl()})}},{key:"warn",value:function(e,n,a){(e=this.getErrMsg(e,n,a))&&D.w(e)}},{key:"onError",value:function(e){var n="code:".concat(e.code," message:").concat(e.message);D.w("Oops! ".concat(n)),new ce("error").setMessage(n).setLevel("error").end(),this.getOEmitInst().emit(me.ERROR,e)}},{key:"restartTimer",value:function(){D.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var e=this.get(7);e&&e.restartPolling()}},{key:"getTimerID",value:function(){var e=this._map.get(24);return e.isWorkerEnabled()?e.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(e){return this._map.get(7).getPollingTimerID(e)}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),zi();var e,n=Ne(this._map);try{for(n.s();!(e=n.n()).done;){var a=te(e.value,2)[1];a.reset&&a.reset()}}catch(_){n.e(_)}finally{n.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._oEmitter.emit(me.SDK_NOT_READY);var r,u=Ne(this._eventThrottleMap);try{for(u.s();!(r=u.n()).done;){var d=te(r.value,2)[1];d.timeoutID&&clearTimeout(d.timeoutID)}}catch(_){u.e(_)}finally{u.f()}this._eventThrottleMap.clear()}}]),Hr),Nn=(N(er,[{key:"defense",value:function(e,n){var a=2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0;if(typeof e!="string"||e.length===0||typeof n!="function")return null;if(this._funcMap.has(e)&&this._funcMap.get(e).has(n))return this._funcMap.get(e).get(n);this._funcMap.has(e)||this._funcMap.set(e,new Map);var r=null;return this._funcMap.get(e).has(n)?r=this._funcMap.get(e).get(n):(r=this._pack(e,n,a),this._funcMap.get(e).set(n,r)),r}},{key:"defenseOnce",value:function(e,n){return typeof n!="function"?null:this._pack(e,n,2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0)}},{key:"find",value:function(e,n){return typeof e!="string"||e.length===0||typeof n!="function"?null:this._funcMap.has(e)&&this._funcMap.get(e).has(n)?this._funcMap.get(e).get(n):(this._m.warn("ListenerFnNotFound",e),null)}},{key:"delete",value:function(e,n){return typeof n=="function"&&!!this._funcMap.has(e)&&!!this._funcMap.get(e).has(n)&&(this._funcMap.get(e).delete(n),this._funcMap.get(e).size===0&&this._funcMap.delete(e),!0)}},{key:"_pack",value:function(e,n,a){var r=this;return function(){try{n.apply(a,Array.from(arguments))}catch(_){var u=Object.values(me).indexOf(e),d="CallbackError";u!==-1&&(u=Object.keys(me)[u],r._m.warn(d,u,_)),r._reportCount<5&&(new ce(d).setMessage("eventName:".concat(e)).setMoreMessage(_.message).end(),r._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){D.l("".concat(this._n,".reset")),this._reportCount=0}}]),er),vu=(N($o,[{key:"onError",value:function(e){this._m.onError(e)}},{key:"login",value:function(e){return this._m.login(),this._get(1).login(e)}},{key:"logout",value:function(){var e=this;return this._get(1).logout().then(function(n){return e._safetyCallbackFactory.reset(),e._m.reset(),n})}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"getServerTime",value:function(){return Vn()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrMsg",value:function(e,n,a){return this._m.getErrMsg(e,n,a)}},{key:"_get",value:function(e){return this._m.get(e)}},{key:"destroy",value:function(){var e=this,n=this._get(12),a=n.getSDKAppID();return D.w("destroy ".concat(a," ").concat(n.getInstanceID())),this.logout().finally(function(){e._safetyCallbackFactory.destroy(),e._m.stopTimer(),e._get(24).terminate(),e._get(21).dealloc(),e._m.getOEmitInst().emit(me.SDK_DESTROY,{SDKAppID:a})})}},{key:"on",value:function(e,n,a){D.d("on","eventName:".concat(e)),this._m.getOEmitInst().on(e,this._safetyCallbackFactory.defense(e,n,a),a)}},{key:"once",value:function(e,n,a){D.d("once","eventName:".concat(e)),this._m.getOEmitInst().once(e,this._safetyCallbackFactory.defenseOnce(e,n,a),a||this)}},{key:"off",value:function(e,n,a,r){D.d("off","eventName:".concat(e));var u=this._safetyCallbackFactory.find(e,n);u!==null&&(this._m.getOEmitInst().off(e,u,a,r),this._safetyCallbackFactory.delete(e,n))}},{key:"registerPlugin",value:function(e){(q(e["tim-push"])?q(e["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(e)}},{key:"setLogLevel",value:function(e){var n;e<=0&&((n=this.getErrMsg("TIM_ASCII_ART"))&&st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",n),(n=this.getErrMsg("API_REFER"))&&(Zi()?st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",n):st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","IM SDK API ->",n)),(n=this.getErrMsg("DOCS_GUIDE"))&&st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",n),n=this.getErrMsg("IOS_WEBVIEW_WARNING"),cc&&n&&st("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",n)),D.setLevel(e)}},{key:"createTextMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createTextAtMessage",value:function(e){return this._get(2).createTextMessage(e)}},{key:"createImageMessage",value:function(e){return this._get(2).createImageMessage(e)}},{key:"createAudioMessage",value:function(e){return this._get(2).createAudioMessage(e)}},{key:"createVideoMessage",value:function(e){return this._get(2).createVideoMessage(e)}},{key:"createCustomMessage",value:function(e){return this._get(2).createCustomMessage(e)}},{key:"createFaceMessage",value:function(e){return this._get(2).createFaceMessage(e)}},{key:"createFileMessage",value:function(e){return this._get(2).createFileMessage(e)}},{key:"createLocationMessage",value:function(e){return this._get(2).createLocationMessage(e)}},{key:"createMergerMessage",value:function(e){return this._get(2).createMergerMessage(e)}},{key:"downloadMergerMessage",value:function(e){return e.type!==A.MSG_MERGER?j({code:X.MSG_MERGER_TYPE_INVALID}):Se(e.payload.downloadKey)?j({code:X.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(e).catch(function(n){return j({code:X.MSG_MERGER_DOWNLOAD_FAIL})})}},{key:"createForwardMessage",value:function(e){return this._get(2).createForwardMessage(e)}},{key:"sendMessage",value:function(e,n){return e instanceof In?this._get(2).sendMessageInstance(e,n):j({code:X.MSG_INSTANCE_REQUIRED})}},{key:"searchCloudMessages",value:function(e){return this._get(2).searchCloudMessages(e)}},{key:"callExperimentalAPI",value:function(e,n){return e==="sendComboMessage"?this._get(31).sendMessage(n):e==="handleGroupInvitation"?this._get(7).handleGroupInvitation(n):e==="isCommercialAbilityEnabled"?this._get(27).isFeatureEnabled(n):e==="isFeatureEnabledForStat"?this._get(27).isFeatureEnabledForStat(n):e==="isIntl"?this.isIntl():e==="sendTRTCCustomData"||e==="sendRoomCustomData"?this._get(30).sendTRTCCustomData(n):e==="getTimerID"?this._m.getTimerID():e==="getPollingTimerID"?this._m.getPollingTimerID(n):e==="setApplicationID"?(this._get(12).setApplicationID(n),void this._get(20).updateProtocolConfig()):e==="getServerConfig"?this._get(23).getServerConfig(n):e==="canIUseModule"?this._m.canIUseModule(n):e==="startMessageLongPolling"?this._get(7).startMessageLongPolling(n):e==="stopMessageLongPolling"?this._get(7).stopMessageLongPolling(n):e==="disableMessagePullOnInvite"?this._get(11).disableMsgPullOnInvite(n):e==="clearLocalMessage"?this._get(11).clearMemMsg(n,!1):e==="setCustomLoginInfo"?this._get(12).setCustomLoginInfo(n):j({code:X.INVALID_OPERATION})}},{key:"revokeMessage",value:function(e){return this._get(2).revokeMessage(e)}},{key:"resendMessage",value:function(e,n){return e instanceof In?this._get(2).resendMessage(e,n):j({code:X.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(e){return this._get(2).deleteMessage(e)}},{key:"translateText",value:function(e){return this._get(2).translateText(e)}},{key:"convertVoiceToText",value:function(e){return this._get(2).convertVoiceToText(e)}},{key:"setMessageExtensions",value:function(e,n){return this._get(3).setMessageExtensions(e,n)}},{key:"getMessageExtensions",value:function(e){return this._get(3).getMessageExtensions(e)}},{key:"deleteMessageExtensions",value:function(e,n){return this._get(3).deleteMessageExtensions(e,n)}},{key:"addMessageReaction",value:function(e,n){return this._get(34).addMessageReaction(e,n)}},{key:"removeMessageReaction",value:function(e,n){return this._get(34).removeMessageReaction(e,n)}},{key:"getMessageReactions",value:function(e){return this._get(34).getMessageReactions(e)}},{key:"getAllUserListOfMessageReaction",value:function(e){return this._get(34).getAllUserListOfMessageReaction(e)}},{key:"modifyMessage",value:function(e){return this._get(2).modifyRemoteMessage(e)}},{key:"getMessageList",value:function(e){return this._get(11).getMessageList(e)}},{key:"getMessageListHopping",value:function(e){return this._get(11).getMessageListHopping(e)}},{key:"sendMessageReadReceipt",value:function(e){return this._get(11).sendReadReceipt(e)}},{key:"getMessageReadReceiptList",value:function(e){return this._get(11).getReadReceiptList(e)}},{key:"getGroupMessageReadMemberList",value:function(e){var n=this._get(7);return n?n.getReadReceiptDetail(e):j({code:X.NO_MODULE})}},{key:"findMessage",value:function(e){return this._get(11).findMessage(e)}},{key:"setMessageRead",value:function(e){return this._get(11).setMessageRead(e)}},{key:"getConversationList",value:function(e){return this._get(11).getConvList(e)}},{key:"getConversationProfile",value:function(e){return this._get(11).getConversationProfile(e)}},{key:"deleteConversation",value:function(e){return this._get(11).deleteConversation(e)}},{key:"setConversationDraft",value:function(e){return this._get(11).setConvDraft(e)}},{key:"clearHistoryMessage",value:function(e){return this._get(11).clearHistoryMessage(e)}},{key:"pinConversation",value:function(e){return this._get(11).pinConversation(e)}},{key:"setAllMessageRead",value:function(e){return this._get(11).setAllMessageRead(e)}},{key:"setMessageRemindType",value:function(e){return this._get(11).setMessageRemindType(e)}},{key:"setAllReceiveMessageOpt",value:function(e){return this._get(11).setAllRcvMsgOpt(e)}},{key:"getAllReceiveMessageOpt",value:function(){return this._get(11).getAllRcvMsgOpt()}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadCount()}},{key:"setConversationCustomData",value:function(e){return this._get(11).setConvCustomData(e)}},{key:"markConversation",value:function(e){return this._get(11).markConv(e)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConvGroupList()}},{key:"createConversationGroup",value:function(e){return this._get(11).createConvGroup(e)}},{key:"deleteConversationGroup",value:function(e){return this._get(11).deleteConvGroup(e)}},{key:"renameConversationGroup",value:function(e){return this._get(11).renameConvGroup(e)}},{key:"addConversationsToGroup",value:function(e){return this._get(11).addConvsToGroup(e)}},{key:"deleteConversationsFromGroup",value:function(e){return this._get(11).deleteConvsFromGroup(e)}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(e){return this._get(4).getUserProfile(e)}},{key:"updateMyProfile",value:function(e){return this._get(4).updateMyProfile(e)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(e){return this._get(4).addBlacklist(e)}},{key:"removeFromBlacklist",value:function(e){return this._get(4).deleteBlacklist(e)}},{key:"setSelfStatus",value:function(e){return this._get(4).setSelfStatus(e)}},{key:"getUserStatus",value:function(e){return this._get(4).getUserStatus(e)}},{key:"subscribeUserStatus",value:function(e){return this._get(4).subscribeUserStatus(e)}},{key:"unsubscribeUserStatus",value:function(e){return this._get(4).unsubscribeUserStatus(e)}},{key:"getFriendList",value:function(){var e=this._get(8);return e?e.getLocalFriendList():j({code:X.NO_MODULE})}},{key:"addFriend",value:function(e){var n=this._get(8);return n?n.addFriend(e):j({code:X.NO_MODULE})}},{key:"deleteFriend",value:function(e){var n=this._get(8);return n?n.deleteFriend(e):j({code:X.NO_MODULE})}},{key:"checkFriend",value:function(e){var n=this._get(8);return n?n.checkFriend(e):j({code:X.NO_MODULE})}},{key:"getFriendProfile",value:function(e){var n=this._get(8);return n?n.getFriendProfile(e):j({code:X.NO_MODULE})}},{key:"updateFriend",value:function(e){var n=this._get(8);return n?n.updateFriend(e):j({code:X.NO_MODULE})}},{key:"getFriendApplicationList",value:function(){var e=this._get(8);return e?e.getLocalFriendApplicationList():j({code:X.NO_MODULE})}},{key:"acceptFriendApplication",value:function(e){var n=this._get(8);return n?n.acceptFriendApplication(e):j({code:X.NO_MODULE})}},{key:"refuseFriendApplication",value:function(e){var n=this._get(8);return n?n.refuseFriendApplication(e):j({code:X.NO_MODULE})}},{key:"deleteFriendApplication",value:function(e){var n=this._get(8);return n?n.deleteFriendApplication(e):j({code:X.NO_MODULE})}},{key:"setFriendApplicationRead",value:function(){var e=this._get(8);return e?e.setFriendApplicationRead():j({code:X.NO_MODULE})}},{key:"getFriendGroupList",value:function(){var e=this._get(8);return e?e.getLocalFriendGroupList():j({code:X.NO_MODULE})}},{key:"createFriendGroup",value:function(e){var n=this._get(8);return n?n.createFriendGroup(e):j({code:X.NO_MODULE})}},{key:"deleteFriendGroup",value:function(e){var n=this._get(8);return n?n.deleteFriendGroup(e):j({code:X.NO_MODULE})}},{key:"addToFriendGroup",value:function(e){var n=this._get(8);return n?n.addToFriendGroup(e):j({code:X.NO_MODULE})}},{key:"removeFromFriendGroup",value:function(e){var n=this._get(8);return n?n.removeFromFriendGroup(e):j({code:X.NO_MODULE})}},{key:"renameFriendGroup",value:function(e){var n=this._get(8);return n?n.renameFriendGroup(e):j({code:X.NO_MODULE})}},{key:"followUser",value:function(e){var n=this._get(35);return n?n.followUser(e):j({code:X.NO_MODULE})}},{key:"unfollowUser",value:function(e){var n=this._get(35);return n?n.unfollowUser(e):j({code:X.NO_MODULE})}},{key:"getMyFollowersList",value:function(e){var n=this._get(35);return n?n.getMyFollowersList(e):j({code:X.NO_MODULE})}},{key:"getMyFollowingList",value:function(e){var n=this._get(35);return n?n.getMyFollowingList(e):j({code:X.NO_MODULE})}},{key:"getMutualFollowersList",value:function(e){var n=this._get(35);return n?n.getMutualFollowersList(e):j({code:X.NO_MODULE})}},{key:"getUserFollowInfo",value:function(e){var n=this._get(35);return n?n.getUserFollowInfo(e):j({code:X.NO_MODULE})}},{key:"checkFollowType",value:function(e){var n=this._get(35);return n?n.checkFollowType(e):j({code:X.NO_MODULE})}},{key:"getGroupList",value:function(){var e=this._get(7);return e?e.getGroupList():j({code:X.NO_MODULE})}},{key:"getGroupProfile",value:function(e){var n=this._get(7);return n?n.getGroupProfile(e):j({code:X.NO_MODULE})}},{key:"createGroup",value:function(e){var n=this._get(7);return n?n.createGroup(e):j({code:X.NO_MODULE})}},{key:"dismissGroup",value:function(e){var n=this._get(7);return n?n.dismissGroup(e):j({code:X.NO_MODULE})}},{key:"updateGroupProfile",value:function(e){var n=this._get(7);return n?n.updateGroupProfile(e):j({code:X.NO_MODULE})}},{key:"joinGroup",value:function(e){var n=this._get(7);return n?n.joinGroup(e):j({code:X.NO_MODULE})}},{key:"quitGroup",value:function(e){var n=this._get(7);return n?n.quitGroup(e):j({code:X.NO_MODULE})}},{key:"searchGroupByID",value:function(e){var n=this._get(7);return n?n.searchGroupByID(e):j({code:X.NO_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(e){var n=this._get(7);return n?n.getGroupOnlineMemberCount(e):j({code:X.NO_MODULE})}},{key:"changeGroupOwner",value:function(e){var n=this._get(7);return n?n.changeGroupOwner(e):j({code:X.NO_MODULE})}},{key:"getGroupApplicationList",value:function(){var e=this._get(7);return e?e.getGroupApplicationList():j({code:X.NO_MODULE})}},{key:"handleGroupApplication",value:function(e){var n=this._get(7);return n?n.handleGroupApplication(e):j({code:X.NO_MODULE})}},{key:"initGroupAttributes",value:function(e){var n=this._get(7);return n?n.initGroupAttributes(e):j({code:X.NO_MODULE})}},{key:"setGroupAttributes",value:function(e){var n=this._get(7);return n?n.setGroupAttributes(e):j({code:X.NO_MODULE})}},{key:"deleteGroupAttributes",value:function(e){var n=this._get(7);return n?n.deleteGroupAttributes(e):j({code:X.NO_MODULE})}},{key:"getGroupAttributes",value:function(e){var n=this._get(7);return n?n.getGroupAttributes(e):j({code:X.NO_MODULE})}},{key:"setGroupCounters",value:function(e){var n=this._get(7);return n?n.setGroupCounters(e):j({code:X.NO_MODULE})}},{key:"increaseGroupCounter",value:function(e){var n=this._get(7);return n?n.increaseGroupCounter(e):j({code:X.NO_MODULE})}},{key:"decreaseGroupCounter",value:function(e){var n=this._get(7);return n?n.decreaseGroupCounter(e):j({code:X.NO_MODULE})}},{key:"getGroupCounters",value:function(e){var n=this._get(7);return n?n.getGroupCounters(e):j({code:X.NO_MODULE})}},{key:"getGroupMemberList",value:function(e){var n=this._get(7);return n?n.getGroupMemberList(e):j({code:X.NO_MODULE})}},{key:"getGroupMemberProfile",value:function(e){var n=this._get(7);return n?n.getGroupMemberProfile(e):j({code:X.NO_MODULE})}},{key:"addGroupMember",value:function(e){var n=this._get(7);return n?n.addGroupMember(e):j({code:X.NO_MODULE})}},{key:"deleteGroupMember",value:function(e){var n=this._get(7);return n?n.deleteGroupMember(e):j({code:X.NO_MODULE})}},{key:"setGroupMemberMuteTime",value:function(e){var n=this._get(7);return n?n.setGroupMemberMuteTime(e):j({code:X.NO_MODULE})}},{key:"setGroupMemberRole",value:function(e){var n=this._get(7);return n?n.setGroupMemberRole(e):j({code:X.NO_MODULE})}},{key:"setGroupMemberNameCard",value:function(e){var n=this._get(7);return n?n.setGroupMemberNameCard(e):j({code:X.NO_MODULE})}},{key:"setGroupMemberCustomField",value:function(e){var n=this._get(7);return n?n.setGroupMemberCustomField(e):j({code:X.NO_MODULE})}},{key:"markGroupMemberList",value:function(e){var n=this._get(7);return n?n.markGroupMemberList(e):j({code:X.NO_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(e){return this._get(10).createTopicInCommunity(e)}},{key:"deleteTopicFromCommunity",value:function(e){return this._get(10).deleteTopicFromCommunity(e)}},{key:"updateTopicProfile",value:function(e){return this._get(10).updateTopicProfile(e)}},{key:"getTopicList",value:function(e){return this._get(10).getTopicList(e)}},{key:"addSignalingListener",value:function(e,n,a){var r=this._get(33);r&&r.addSignalingListener(e,this._safetyCallbackFactory.defense(e,n,a),a)}},{key:"removeSignalingListener",value:function(e,n,a){var r,u=this._safetyCallbackFactory.find(e,n);u===null||(r=this._get(33))&&(r.removeSignalingListener(e,u,a),this._safetyCallbackFactory.delete(e,n))}},{key:"invite",value:function(e){var n=this._get(33);return n?n.invite(e):j({code:X.NO_MODULE})}},{key:"inviteSync",value:function(e,n,a){var r=this._get(33);return r?r.inviteSync(e,n,a):""}},{key:"inviteInGroup",value:function(e){var n=this._get(33);return n?n.invite(e):j({code:X.NO_MODULE})}},{key:"inviteInGroupSync",value:function(e,n,a){var r=this._get(33);return r?r.inviteSync(e,n,a):""}},{key:"cancel",value:function(e){var n=this._get(33);return n?n.cancel(e):j({code:X.NO_MODULE})}},{key:"accept",value:function(e){var n=this._get(33);return n?n.accept(e):j({code:X.NO_MODULE})}},{key:"reject",value:function(e){var n=this._get(33);return n?n.reject(e):j({code:X.NO_MODULE})}},{key:"getSignalingInfo",value:function(e){var n=this._get(33);return n?n.getSignalingInfo(e):null}},{key:"modifyInvitation",value:function(e){var n=this._get(33);return n?n.modifyInvitation(e):j({code:X.NO_MODULE})}}]),$o),Tl={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function $o(e){v(this,$o),e={SDKAppID:e.SDKAppID,unlimitedAVChatRoom:e.unlimitedAVChatRoom||!1,scene:e.scene||"",oversea:e.oversea||!1,instanceID:fi(),devMode:e.devMode||!1,testEnv:e.testEnv||!1,proxyServer:e.proxyServer||void 0,fileUploadProxy:e.fileUploadProxy||void 0,fileDownloadProxy:e.fileDownloadProxy||e.fileUploadProxy||void 0,eventThrottling:e.eventThrottling!==!1,partialUpdatedConversations:e.partialUpdatedConversations===!0,modules:e.modules||void 0},this._m=new Wd(e),this._safetyCallbackFactory=new Nn(this._m)}function er(e){v(this,er),this._funcMap=new Map,this._m=e,this._n="SafetyCallback",this._reportCount=0}function Hr(e){var n=this;v(this,Hr);var a,r=new ce("sdkConstruct"),u=(this._n="ModuleManager",this._isReady=!1,this._reason=X.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._map=new Map,this._optionalModuleMap=new Map,this._iEmitter=null,this._oEmitter=null,this._checkCount=0,this._checkTimer=-1,this._map.set(12,new gd(this,e)),this._map.set(37,new Kd(this)),this._map.set(15,new Rr(this)),this._map.set(27,new iu(this)),this._map.set(23,new rl(this)),this._map.set(24,new _l(this)),this._map.set(26,new Sd(this)),this._map.set(21,new yd(this)),this._map.set(20,new sl(this)),this._map.set(1,new _d(this)),this._map.set(2,new Xu(this)),this._map.set(3,new Qu(this)),this._map.set(34,new Zu(this)),this._map.set(31,new el(this)),this._map.set(4,new pd(this)),this._map.set(6,new kc(this)),this._map.set(11,new us(this)),this._map.set(7,new sd(this)),this._map.set(10,new cd(this)),this._map.set(13,new Fc(this)),this._map.set(32,new bd(this)),this._map.set(14,new qc(this)),this._map.set(17,new Ls(this)),this._map.set(18,new tl(this)),this._map.set(19,new nl(this)),this._map.set(25,new cl(this)),this._map.set(8,new Ld(this)),this._map.set(28,new Ad(this)),this._map.set(36,new fl(this)),this._map.set(29,new Od(this)),this._map.set(30,new Nd(this)),this._map.set(33,new qd(this)),this._map.set(35,new Bd(this)),this._eventThrottleMap=new Map,this._eventThrottling=e.eventThrottling,this._map.get(12).isPartialUpdatedConvs()&&(this._eventThrottling=!1),ye(e.modules)?(Object.keys(e.modules).forEach(function(M){a=e.modules[M],M==="group-module"?n._map.set(7,new a(n)):M==="relationship-module"?n._map.set(8,new a(n)):M==="signaling-module"?n._map.set(33,new a(n)):M==="follow-module"&&n._map.set(35,new a(n)),n._optionalModuleMap.set(M,1)}),this._map.get(12).setUsingChatCore(!0)):this._map.has(7)||this._map.get(12).setUsingChatCore(!0),e.instanceID),d=e.SDKAppID,_=this._map.get(12).isIntl(),y=this._map.get(12).isUsingChatCore();u="instanceID:".concat(u," SDKAppID:").concat(d," isIntl:").concat(_," isUsingChatCore:").concat(y," host:").concat(yc())+" isIOSWebView:".concat(cc," platform:").concat(rr," canIUseInflate:").concat(this.canIUseInflate())+" workerAvailable:".concat(ti," eventThrottling:").concat(this._eventThrottling," UserAgent:").concat(xn),ce.bindEventStatModule(this._map.get(14)),ce.bindNetMonitorModule(this._map.get(15)),r.setMessage("".concat(u," ").concat(function(){var M="";if(qe)try{var R=vt.getSystemInfoSync(),L=R.model,F=R.version,x=R.system,K=R.platform,le=R.SDKVersion;M="model:".concat(L," version:").concat(F," system:").concat(x," platform:").concat(K," SDKVersion:").concat(le)}catch(he){M=""}return M}())).end(),D.i("SDK ".concat(u)),xe.prototype._getErrMsg=this.getErrMsg.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function yu(e){v(this,yu),this._m=e,this._n="InflateModule",this._bLogForInflateOK=!1,this._bLogForInflateError=!1}var tr={};return(Ce={}).create=function(e){var n,a,r,u="TencentCloudChat.create",d=0;if(ft(r=e.SDKAppID))d=r;else if(d=parseInt(r),isNaN(r))return D.e("".concat(u," failed. Failed to parse the SDKAppID, please check the arguments")),null;return d&&tr[d]?tr[d]:(D.l("".concat(u)),(r=new vu(g(g({},e),{},{SDKAppID:d}))).on(me.SDK_DESTROY,function(_){tr[_.data.SDKAppID]=null,delete tr[_.data.SDKAppID]}),n=r,a=Object.create(null),Object.keys(ht).forEach(function(_){var y;n[_]&&(y=new O,a[_]=function(){var M=Array.from(arguments);return y.use(function(R,L){var F=function(x,K){if(x.isReady()||Tl[K]===1)return!0;var le={code:le=x.getNotReadyReason(),message:"".concat(x.getErrMsg(le)," | ").concat(K," | ").concat(x.getErrMsg(X.SDK_IS_NOT_READY))};return x.onError(le),le}(n,_);return F===!0?L():j(F)}).use(function(R,L){if(function(F,x,K){if(x===void 0)return!0;var le=!0;if(ye(x))Object.keys(x).forEach(function(fe){var Fe=F.length===1?F[0][fe]:void 0;le=!!Tc(Fe,x[fe],K,fe)&&le});else if(ke(x))for(var he=0;he<x.length;he++)le=!!Tc(F[he],x[he],K,x[he].name)&&le;if(le)return le;throw new Error("Params validate failed.")}(R,yi[_],_)===!0)return L()}).use(function(R,L){return n[_].apply(n,R)}),y.run(M)})}),e=a,tr[d]=e,yi.hookGetAPITips(r.getErrMsg.bind(r)),D.l("".concat(u," ok")),e)},Ce.TYPES=A,Ce.EVENT=me,Ce.TSignaling=Me,Ce.VERSION="3.4.8",D.l("TencentCloudChat.VERSION:".concat(Ce.VERSION)),Ce}();var Th=hp,Ul=class{constructor(g,T){if(this.trtcCloud=g,T){let{userId:v,sdkAppId:w,seq:N}=T;this.seq=N,g._log&&(this.logger=g._log.createLogger({id:`roomEngine${N}`,userId:v,sdkAppId:w}))}else this.logger=g._log;this.logger||(this.logger={debug:v=>{g.logger&&g.logger.debug?g.logger.debug(v):st("debug","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),v)},info:v=>{g.logger&&g.logger.info?g.logger.info(v):st("info","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),v)},warn:v=>{g.logger&&g.logger.warn?g.logger.warn(v):st("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),v)},error:v=>{g.logger&&g.logger.error?g.logger.error(v):st("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",this.getTime(),v)}})}getLogMessage(g){try{return g.map(T=>typeof T!="string"?JSON.stringify(T):T).join(" ")}catch(T){return g}}update(g){let{userId:T,sdkAppId:v}=g;this.trtcCloud._log&&this.trtcCloud._log.createLogger&&(this.logger=this.trtcCloud._log.createLogger({id:`roomEngine${this.seq}`,userId:T,sdkAppId:v}))}debug(...g){let T=this.getLogMessage(g);this.logger.debug(T)}info(...g){let T=this.getLogMessage(g);this.logger&&this.logger.info&&this.logger.info(T)}warn(...g){let T=this.getLogMessage(g);this.logger&&this.logger.warn&&this.logger.warn(T)}error(...g){let T=this.getLogMessage(g);this.logger&&this.logger.error&&this.logger.error(T)}getTime(){let g=new Date;return`${g.toLocaleTimeString("en-US",{hour12:!1})}.${function(T){let v;switch(T.toString().length){case 1:v=`00${T}`;break;case 2:v=`0${T}`;break;default:v=T}return v}(g.getMilliseconds())}`}},El=new Ap,_p=class f{constructor(g){let{Module:T,logger:v,globalEvent:w}=g;this.conferenceInvitationManager||(this.logger=v,this.conferenceInvitationManager=T,this.globalEvent=w)}static getInstance(g){return f.instance||(f.instance=new f(g)),f.instance}JSCallNativeFunctionPromise(g,T){return new Promise((v,w)=>{let N=B=>{let V=jr(B);V.code===0?(this.logger.info(`conferenceInvitationManager.${g} success`,V.data),v(V.data)):(this.logger.warn(`conferenceInvitationManager.${g} fail. `,V),w(new Ln(V)))};try{if(!T)return this.conferenceInvitationManager[g](N);this.conferenceInvitationManager[g](T,N)}catch(B){this.logger.warn(`conferenceInvitationManager.${g} error. `,B.code,B.message),w(new Ln({code:B.code||Tn.ERR_FAILED,message:B.message}))}})}JSCallNativeFunctionSync(g,T){return this.conferenceInvitationManager[g](T)}inviteUsers(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceInvitationManager.inviteUsers with options: ",g),yield this.JSCallNativeFunctionPromise("inviteUsers",g)})}cancelInvitation(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceInvitationManager.cancelInvitation with options: ",g),yield this.JSCallNativeFunctionPromise("cancelInvitation",g)})}accept(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceInvitationManager.accept with options: ",g),yield this.JSCallNativeFunctionPromise("accept",g)})}reject(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceInvitationManager.reject with options: ",g),yield this.JSCallNativeFunctionPromise("reject",g)})}getInvitationList(g){return je(this,void 0,void 0,function*(){return this.logger.info("conferenceInvitationManager.getInvitationList with options: ",g),yield this.JSCallNativeFunctionPromise("getInvitationList",g)})}static once(g,T){g==="ready"&&T()}on(g,T){El.on(g,T),this.setObserver(g)}setObserver(g){this.logger.info(`listen for event: ${g}`),this.globalEvent.addEventListener(g,T=>{JSON.stringify(T)==="{}"?El.emit(g):El.emit(g,T),this.logger.info(`conferenceInvitationManager received event: [${g}] ${JSON.stringify(T)}`)})}off(g,T){El.off(g,T)}},Rl=new Ap,zr=class f{constructor(g){let{Module:T,logger:v,globalEvent:w}=g;this.conferenceListManager||(this.logger=v,this.conferenceListManager=T,this.globalEvent=w)}static getInstance(g){return f.instance||(f.instance=new f(g)),f.instance}JSCallNativeFunctionPromise(g,T){return new Promise((v,w)=>{let N=B=>{let V=jr(B);V.code===0?(this.logger.info(`conferenceInvitationManager.${g} success`,V.data),v(V.data)):(this.logger.warn(`conferenceInvitationManager.${g} fail. `,V),w(new Ln(V)))};try{if(!T)return this.conferenceListManager[g](N);this.conferenceListManager[g](T,N)}catch(B){this.logger.warn(`conferenceInvitationManager.${g} error. `,B.code,B.message),w(new Ln({code:B.code||Tn.ERR_FAILED,message:B.message}))}})}JSCallNativeFunctionSync(g,T){return this.conferenceListManager[g](T)}scheduleConference(g){return je(this,void 0,void 0,function*(){let{scheduleStartTime:T,scheduleEndTime:v,scheduleAttendees:w=[],reminderSecondsBeforeStart:N=0,roomId:B,roomName:V,roomType:H,maxSeatCount:z,isSeatEnabled:ne=!1,seatMode:ge=ji.kFreeToTake,isMicrophoneDisableForAllUser:pe,isScreenShareDisableForAllUser:oe,isCameraDisableForAllUser:de,isMessageDisableForAllUser:ae,password:te=""}=g;delete g.password,this.logger.info("conferenceListManager.scheduleConference with options: ",g);let J={conferenceInfo:{basicRoomInfo:{roomId:B,roomType:H,name:V,isSeatEnabled:ne,seatMode:ge,isMicrophoneDisableForAllUser:pe,isScreenShareDisableForAllUser:oe,isCameraDisableForAllUser:de,isMessageDisableForAllUser:ae,maxSeatCount:z,password:te},scheduleStartTime:T,scheduleEndTime:v,scheduleAttendees:w,reminderSecondsBeforeStart:N}};yield this.JSCallNativeFunctionPromise("scheduleConference",J)})}cancelConference(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceListManager.cancelConference with options: ",g),yield this.JSCallNativeFunctionPromise("cancelConference",g)})}updateConferenceInfo(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceListManager.updateConferenceInfo with options: ",g),yield this.JSCallNativeFunctionPromise("updateConferenceInfo",g)})}fetchScheduledConferenceList(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceListManager.fetchScheduledConferenceList with options: ",g);let{cursor:T,count:v,statusArray:w}=g,N={cursor:T,count:v,status:w};return st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",N),yield this.JSCallNativeFunctionPromise("fetchScheduledConferenceList",N)})}fetchAttendeeList(g){return je(this,void 0,void 0,function*(){return this.logger.info("conferenceListManager.fetchAttendeeList with options: ",g),yield this.JSCallNativeFunctionPromise("fetchAttendeeList",g)})}addAttendeesByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceListManager.addAttendeesByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("addAttendeesByAdmin",g)})}removeAttendeesByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("conferenceListManager.removeAttendeesByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("removeAttendeesByAdmin",g)})}static once(g,T){g==="ready"&&T()}on(g,T){Rl.on(g,T),this.setObserver(g)}setObserver(g){this.logger.info(`listen for event: ${g}`),this.globalEvent.addEventListener(g,T=>{JSON.stringify(T)==="{}"?Rl.emit(g):Rl.emit(g,T),this.logger.info(`conferenceInvitationManager received event: [${g}] ${JSON.stringify(T)}`)})}off(g,T){Rl.off(g,T)}},$r,Ig,Xr,Zo,Mg,Cg,Tg,Sg,Dg,Eg,Qr,Rg,Lg,kg,Ag,Og,Ng,bg,Pg;zr.ROOM_NAME=1,zr.SCHEDULED_START_TIME=65536,zr.SCHEDULED_END_TIME=1<<17,function(f){f[f.TRTCVideoResolution_120_120=1]="TRTCVideoResolution_120_120",f[f.TRTCVideoResolution_160_160=3]="TRTCVideoResolution_160_160",f[f.TRTCVideoResolution_270_270=5]="TRTCVideoResolution_270_270",f[f.TRTCVideoResolution_480_480=7]="TRTCVideoResolution_480_480",f[f.TRTCVideoResolution_160_120=50]="TRTCVideoResolution_160_120",f[f.TRTCVideoResolution_240_180=52]="TRTCVideoResolution_240_180",f[f.TRTCVideoResolution_280_210=54]="TRTCVideoResolution_280_210",f[f.TRTCVideoResolution_320_240=56]="TRTCVideoResolution_320_240",f[f.TRTCVideoResolution_400_300=58]="TRTCVideoResolution_400_300",f[f.TRTCVideoResolution_480_360=60]="TRTCVideoResolution_480_360",f[f.TRTCVideoResolution_640_480=62]="TRTCVideoResolution_640_480",f[f.TRTCVideoResolution_960_720=64]="TRTCVideoResolution_960_720",f[f.TRTCVideoResolution_160_90=100]="TRTCVideoResolution_160_90",f[f.TRTCVideoResolution_256_144=102]="TRTCVideoResolution_256_144",f[f.TRTCVideoResolution_320_180=104]="TRTCVideoResolution_320_180",f[f.TRTCVideoResolution_480_270=106]="TRTCVideoResolution_480_270",f[f.TRTCVideoResolution_640_360=108]="TRTCVideoResolution_640_360",f[f.TRTCVideoResolution_960_540=110]="TRTCVideoResolution_960_540",f[f.TRTCVideoResolution_1280_720=112]="TRTCVideoResolution_1280_720",f[f.TRTCVideoResolution_1920_1080=114]="TRTCVideoResolution_1920_1080"}($r||($r={})),function(f){f[f.TRTCVideoStreamTypeBig=0]="TRTCVideoStreamTypeBig",f[f.TRTCVideoStreamTypeSmall=1]="TRTCVideoStreamTypeSmall",f[f.TRTCVideoStreamTypeSub=2]="TRTCVideoStreamTypeSub"}(Ig||(Ig={})),function(f){f[f.TRTCVideoFillMode_Fill=0]="TRTCVideoFillMode_Fill",f[f.TRTCVideoFillMode_Fit=1]="TRTCVideoFillMode_Fit"}(Xr||(Xr={})),function(f){f[f.TRTCVideoMirrorType_Auto=0]="TRTCVideoMirrorType_Auto",f[f.TRTCVideoMirrorType_Enable=1]="TRTCVideoMirrorType_Enable",f[f.TRTCVideoMirrorType_Disable=2]="TRTCVideoMirrorType_Disable"}(Zo||(Zo={})),function(f){f[f.TRTCBeautyStyleSmooth=0]="TRTCBeautyStyleSmooth",f[f.TRTCBeautyStyleNature=1]="TRTCBeautyStyleNature"}(Mg||(Mg={})),function(f){f[f.TRTCAppSceneVideoCall=0]="TRTCAppSceneVideoCall",f[f.TRTCAppSceneLIVE=1]="TRTCAppSceneLIVE",f[f.TRTCAppSceneAudioCall=2]="TRTCAppSceneAudioCall",f[f.TRTCAppSceneVoiceChatRoom=3]="TRTCAppSceneVoiceChatRoom"}(Cg||(Cg={})),function(f){f[f.TRTCRoleAnchor=20]="TRTCRoleAnchor",f[f.TRTCRoleAudience=21]="TRTCRoleAudience"}(Tg||(Tg={})),function(f){f[f.TRTCAudioQualityDefault=0]="TRTCAudioQualityDefault",f[f.TRTCAudioQualitySpeech=1]="TRTCAudioQualitySpeech",f[f.TRTCAudioQualityMusic=3]="TRTCAudioQualityMusic"}(Sg||(Sg={}));(function(f){f[f.TRTCDeviceStateAdd=0]="TRTCDeviceStateAdd",f[f.TRTCDeviceStateRemove=1]="TRTCDeviceStateRemove",f[f.TRTCDeviceStateActive=2]="TRTCDeviceStateActive"})(Dg||(Dg={})),function(f){f[f.TRTCDeviceTypeUnknow=-1]="TRTCDeviceTypeUnknow",f[f.TRTCDeviceTypeMic=0]="TRTCDeviceTypeMic",f[f.TRTCDeviceTypeSpeaker=1]="TRTCDeviceTypeSpeaker",f[f.TRTCDeviceTypeCamera=2]="TRTCDeviceTypeCamera"}(Eg||(Eg={}));var wl=class{constructor(g=$r.TRTCVideoResolution_640_360,T=15,v=550){this.videoResolution=g,this.videoFps=T,this.videoBitrate=v}};(function(f){f[f.TRTCVideoRotation0=0]="TRTCVideoRotation0",f[f.TRTCVideoRotation90=1]="TRTCVideoRotation90",f[f.TRTCVideoRotation180=2]="TRTCVideoRotation180",f[f.TRTCVideoRotation270=3]="TRTCVideoRotation270"})(Qr||(Qr={}));(function(f){f[f.TRTCQuality_Unknown=0]="TRTCQuality_Unknown",f[f.TRTCQuality_Excellent=1]="TRTCQuality_Excellent",f[f.TRTCQuality_Good=2]="TRTCQuality_Good",f[f.TRTCQuality_Poor=3]="TRTCQuality_Poor",f[f.TRTCQuality_Bad=4]="TRTCQuality_Bad",f[f.TRTCQuality_Vbad=5]="TRTCQuality_Vbad",f[f.TRTCQuality_Down=6]="TRTCQuality_Down"})(Rg||(Rg={}));(function(f){f[f.TRTCVideoResolutionModeLandscape=0]="TRTCVideoResolutionModeLandscape",f[f.TRTCVideoResolutionModePortrait=1]="TRTCVideoResolutionModePortrait"})(Lg||(Lg={})),function(f){f[f.TRTCVideoQosPreferenceSmooth=1]="TRTCVideoQosPreferenceSmooth",f[f.TRTCVideoQosPreferenceClear=2]="TRTCVideoQosPreferenceClear"}(kg||(kg={})),function(f){f[f.TRTCQosControlModeClient=0]="TRTCQosControlModeClient",f[f.TRTCQosControlModeServer=1]="TRTCQosControlModeServer"}(Ag||(Ag={}));(function(f){f[f.TRTCLogLevelVerbose=0]="TRTCLogLevelVerbose",f[f.TRTCLogLevelDebug=1]="TRTCLogLevelDebug",f[f.TRTCLogLevelInfo=2]="TRTCLogLevelInfo",f[f.TRTCLogLevelWarn=3]="TRTCLogLevelWarn",f[f.TRTCLogLevelError=4]="TRTCLogLevelError",f[f.TRTCLogLevelFatal=5]="TRTCLogLevelFatal",f[f.TRTCLogLevelNone=6]="TRTCLogLevelNone"})(Og||(Og={})),function(f){f[f.TRTCScreenCaptureSourceTypeUnknown=-1]="TRTCScreenCaptureSourceTypeUnknown",f[f.TRTCScreenCaptureSourceTypeWindow=0]="TRTCScreenCaptureSourceTypeWindow",f[f.TRTCScreenCaptureSourceTypeScreen=1]="TRTCScreenCaptureSourceTypeScreen",f[f.TRTCScreenCaptureSourceTypeCustom=2]="TRTCScreenCaptureSourceTypeCustom"}(Ng||(Ng={}));(function(f){f[f.TRTCTranscodingConfigMode_Unknown=0]="TRTCTranscodingConfigMode_Unknown",f[f.TRTCTranscodingConfigMode_Manual=1]="TRTCTranscodingConfigMode_Manual",f[f.TRTCTranscodingConfigMode_Template_PureAudio=2]="TRTCTranscodingConfigMode_Template_PureAudio",f[f.TRTCTranscodingConfigMode_Template_PresetLayout=3]="TRTCTranscodingConfigMode_Template_PresetLayout",f[f.TRTCTranscodingConfigMode_Template_ScreenSharing=4]="TRTCTranscodingConfigMode_Template_ScreenSharing",f[f.TRTC_TranscodingConfigMode_Unknown=5]="TRTC_TranscodingConfigMode_Unknown",f[f.TRTC_TranscodingConfigMode_Manual=6]="TRTC_TranscodingConfigMode_Manual",f[f.TRTC_TranscodingConfigMode_Template_PureAudio=7]="TRTC_TranscodingConfigMode_Template_PureAudio",f[f.TRTC_TranscodingConfigMode_Template_PresetLayout=8]="TRTC_TranscodingConfigMode_Template_PresetLayout",f[f.TRTC_TranscodingConfigMode_Template_ScreenSharing=9]="TRTC_TranscodingConfigMode_Template_ScreenSharing"})(bg||(bg={}));(function(f){f[f.TRTCMixInputTypeUndefined=0]="TRTCMixInputTypeUndefined",f[f.TRTCMixInputTypeAudioVideo=1]="TRTCMixInputTypeAudioVideo",f[f.TRTCMixInputTypePureVideo=2]="TRTCMixInputTypePureVideo",f[f.TRTCMixInputTypePureAudio=3]="TRTCMixInputTypePureAudio"})(Pg||(Pg={}));var Tu=new Ul({}),Ll=Lu("TencentCloud-TUIRoomEngine"),ep=Lu("globalEvent"),Sh=qg,Gg=1,kl=new Ap,rt=class f{constructor(){this.roomId="",this.localVideoQuality=xo.kVideoQuality_720p,this.localAudioQuality=Nl.kAudioProfileDefault,this.roomEngine||(this.roomEngine=Ll,this.logger=new Ul({},{sdkAppId:f.sdkAppId,userId:f.userId,seq:Gg}),Gg+=1)}static JSCallNativeFunctionPromise(g,T){return new Promise((v,w)=>{let N=B=>{let V=jr(B);V.code===0?(Tu.info(`roomEngine.${g} success`,V),v(V)):(st("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`roomEngine.${g} fail. `,V),w(new Ln(V)))};try{T?Ll[g](T,N):Ll[g](N)}catch(B){st("warn","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`roomEngine.${g} error. `,B.code,B.message),w(new Ln({code:B.code||Tn.ERR_FAILED,message:B.message}))}})}static JSCallNativeFunctionSync(g,T){return Ll[g](T)}JSCallNativeFunctionPromise(g,T){return new Promise((v,w)=>{let N=B=>{let V=jr(B);V.code===0?(this.logger.info(`roomEngine.${g} success`,V.data),v(V.data)):(this.logger.warn(`roomEngine.${g} fail. `,V),w(new Ln(V)))};try{if(!T)return this.roomEngine[g](N);this.roomEngine[g](T,N)}catch(B){this.logger.warn(`roomEngine.${g} error. `,B.code,B.message),w(new Ln({code:B.code||Tn.ERR_FAILED,message:B.message}))}})}JSCallNativeFunctionSync(g,T){return this.roomEngine[g](T)}JSCallNativeRequestFunctionPromise(g,T){let{requestCallback:v}=T;return new Promise((w,N)=>{let B=pe=>{this.logger.info(`roomEngine.${g} success with request:`,pe),w(pe)},V=pe=>{let oe=Object.assign(Object.assign({},pe),{requestCallbackType:Hn.kRequestAccepted});v(oe)},H=pe=>{let oe=Object.assign(Object.assign({},pe),{requestCallbackType:Hn.kRequestRejected});v(oe)},z=pe=>{let oe=Object.assign(Object.assign({},pe),{requestCallbackType:Hn.kRequestCancelled});v(oe)},ne=pe=>{let oe=Object.assign(Object.assign({},pe),{requestCallbackType:Hn.kRequestTimeout});v(oe)},ge=pe=>{let oe=Object.assign(Object.assign({},pe),{requestCallbackType:Hn.kRequestError});N(new Ln(oe))};try{this.roomEngine[g](T,V,H,z,ne,ge,B)}catch(pe){st("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1",`roomEngine.${g} error. `,pe.code,pe.message),N(new Ln({code:pe.code||Tn.ERR_FAILED,message:pe.message}))}})}static login(g){return je(this,void 0,void 0,function*(){let{sdkAppId:T,userId:v,userSig:w,tim:N}=g;f.userId=v,f.sdkAppId=T,Tu.info("TUIRoomEngine.login with options: ",g),yield this.JSCallNativeFunctionPromise("login",g),N?f.tim=N:(f.tim=Th.create({SDKAppID:T}),f.tim.login({userID:v,userSig:w}))})}static setSelfInfo(g){return je(this,void 0,void 0,function*(){Tu.info("TUIRoomEngine.setSelfInfo with options: ",g);let{userName:T,avatarUrl:v,customInfo:w}=g,N={userName:T,avatarUrl:v,customInfo:JSON.stringify(w)};yield this.JSCallNativeFunctionPromise("setSelfInfo",N)})}static getTIM(){return f.tim}static getSelfInfo(){return je(this,void 0,void 0,function*(){return yield this.JSCallNativeFunctionSync("getSelfInfo")})}static logout(){return je(this,void 0,void 0,function*(){Tu.info("TUIRoomEngine.logout."),yield this.JSCallNativeFunctionPromise("logout")})}createRoom(g){return je(this,void 0,void 0,function*(){let{roomId:T,roomName:v,roomType:w,maxSeatCount:N,isSeatEnabled:B=!1,seatMode:V=ji.kFreeToTake,isMicrophoneDisableForAllUser:H,isScreenShareDisableForAllUser:z,isCameraDisableForAllUser:ne,isMessageDisableForAllUser:ge,password:pe=""}=g;this.roomId=T,delete g.password,this.logger.info("roomEngine.createRoom with options: ",g);let oe={roomInfo:{roomId:T,roomType:w,roomName:v,isSeatEnabled:B,seatMode:V,isMicrophoneDisableForAllUser:H,isScreenShareDisableForAllUser:z,isCameraDisableForAllUser:ne,isMessageDisableForAllUser:ge,maxSeatCount:N,password:pe}};yield this.JSCallNativeFunctionPromise("createRoom",oe)})}enterRoom(g){return je(this,void 0,void 0,function*(){let{roomId:T,roomType:v=ar.kConference,options:w={}}=g;return delete g.options,this.logger.info("roomEngine.enterRoom with options: ",g),this.roomId=T,this.logger.info({sdkAppId:f.sdkAppId,userId:f.userId}),yield this.JSCallNativeFunctionPromise("enterRoom",g)})}destroyRoom(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.destroyRoom"),yield this.JSCallNativeFunctionPromise("destroyRoom")})}exitRoom(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.exitRoom"),yield this.JSCallNativeFunctionPromise("exitRoom",{syncWaiting:!1})})}fetchRoomInfo(g){return je(this,void 0,void 0,function*(){return new Promise((T,v)=>{let w=N=>{let B=jr(N);if(B.code===0){this.logger.info("roomEngine.fetchRoomInfo success",B.data);let V=Object.assign(Object.assign({},B.data),{roomOwner:B.data.ownerId});T(V)}else this.logger.warn("roomEngine.fetchRoomInfo fail. ",B),v(new Ln(B))};try{return g?this.roomEngine.fetchRoomInfoById(g,w):this.roomEngine.fetchRoomInfo(w)}catch(N){this.logger.warn("roomEngine.fetchRoomInfo error. ",N.code,N.message),v(new Ln({code:N.code||Tn.ERR_FAILED,message:N.message}))}})})}updateRoomNameByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.updateRoomNameByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("updateRoomNameByAdmin",g)})}updateRoomSeatModeByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.updateRoomSeatModeByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("updateRoomSeatModeByAdmin",g)})}updateRoomPasswordByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.updateRoomPasswordByAdmin"),yield this.JSCallNativeFunctionPromise("updateRoomPasswordByAdmin",g)})}getUserList(g){return je(this,void 0,void 0,function*(){let T={nextSequence:g&&g.nextSequence||0};return yield this.JSCallNativeFunctionPromise("getUserList",T)})}getUserInfo(g){return je(this,void 0,void 0,function*(){return yield this.JSCallNativeFunctionPromise("getUserInfo",g)})}setCustomInfoForUser(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.setCustomInfoForUser with options: ",g),yield this.JSCallNativeFunctionPromise("setCustomInfoForUser",g)})}setLocalVideoView(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.setLocalVideoView"),this.JSCallNativeFunctionSync("setLocalVideoView")})}openLocalCamera(g={isFrontCamera:!0}){return je(this,void 0,void 0,function*(){if(uni.getSystemInfoSync().platform==="android"&&(yield yg.requestAndroidPermission("android.permission.CAMERA"))!==mg)throw new Ln({code:Tn.ERR_CAMERA_NOT_AUTHORIZED,message:"permission denied"});this.logger.info("roomEngine.openLocalCamera",g);let{isFrontCamera:T}=g,v={isFront:T?1:0,quality:this.localVideoQuality};yield this.JSCallNativeFunctionPromise("openLocalCamera",v)})}closeLocalCamera(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.closeLocalCamera"),yield this.JSCallNativeFunctionSync("closeLocalCamera")})}openLocalMicrophone(){return je(this,void 0,void 0,function*(){if(uni.getSystemInfoSync().platform==="android"&&(yield yg.requestAndroidPermission("android.permission.RECORD_AUDIO"))!==mg)throw new Ln({code:Tn.ERR_MICROPHONE_NOT_AUTHORIZED,message:"permission denied"});this.logger.info("roomEngine.openLocalMicrophone");let g={quality:this.localAudioQuality};try{return yield this.JSCallNativeFunctionPromise("openLocalMicrophone",g)}catch(T){if(T.message==="you have been muted the audio"||T.message==="open microphone need apply to admin")return void this.logger.warn(T);throw T}})}closeLocalMicrophone(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.closeLocalMicrophone"),yield this.JSCallNativeFunctionSync("closeLocalMicrophone")})}updateVideoQuality(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.updateVideoQuality with options: ",g);let{quality:T}=g;this.localVideoQuality=T,yield this.JSCallNativeFunctionPromise("updateVideoQuality",g)})}setVideoResolutionMode(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.setVideoResolutionMode with options: ",g),yield this.JSCallNativeFunctionSync("setVideoResolutionMode",g)})}updateVideoQualityEx(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.updateVideoQualityEx with options: ",g);let{streamType:T,encoderParams:v}=g;v&&v.videoResolution&&T===jt.kCameraStream&&(this.localVideoQuality=v&&v.videoResolution);let w={streamType:T,encoderParams:v};yield this.JSCallNativeFunctionSync("updateVideoQualityEx",w)})}updateAudioQuality(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.updateAudioQuality with options: ",g);let{quality:T}=g;this.localAudioQuality=T,yield this.JSCallNativeFunctionSync("updateAudioQuality",g)})}startPushLocalVideo(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.startPushLocalVideo"),yield this.JSCallNativeFunctionSync("startPushLocalVideo")})}stopPushLocalVideo(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.stopPushLocalVideo"),yield this.JSCallNativeFunctionSync("stopPushLocalVideo")})}startPushLocalAudio(){return je(this,void 0,void 0,function*(){this.logger.warn("roomEngine.startPushLocalAudio is deprecated since v1.5.0, please use roomEngine.muteLocalAudio."),yield this.JSCallNativeFunctionPromise("startPushLocalAudio")})}stopPushLocalAudio(){return je(this,void 0,void 0,function*(){this.logger.warn("roomEngine.stopPushLocalAudio is deprecated since v1.5.0, please use roomEngine.muteLocalAudio."),yield this.JSCallNativeFunctionPromise("stopPushLocalAudio")})}muteLocalAudio(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.muteLocalAudio"),yield this.JSCallNativeFunctionPromise("muteLocalAudio")})}unmuteLocalAudio(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.unmuteLocalAudio"),yield this.JSCallNativeFunctionPromise("unmuteLocalAudio")})}setRemoteVideoView(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.setRemoteVideoView with options: ",g),yield this.JSCallNativeFunctionSync("setRemoteVideoView",g)})}startPlayRemoteVideo(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.startPlayRemoteVideo with options: ",g);let{userId:T,streamType:v}=g;return new Promise((w,N)=>{let B={userId:T,streamType:v,playingCallback:V=>{st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine startPlayRemoteVideo playingCallback",V),w()},loadingCallback:V=>{st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine startPlayRemoteVideo loadingCallback",V)},errorCallback:V=>{st("log","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine startPlayRemoteVideo errorCallback",V),N()}};try{this.roomEngine.startPlayRemoteVideo(B)}catch(V){st("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine.startPlayRemoteVideo error. ",V.code,V.message);let H=new Ln({code:V.code||Tn.ERR_FAILED,message:V.message});N(H)}})})}stopPlayRemoteVideo(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.stopPlayRemoteVideo with options: ",g),yield this.JSCallNativeFunctionSync("stopPlayRemoteVideo",g)})}muteRemoteAudioStream(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.muteRemoteAudioStream with options",g),yield this.JSCallNativeFunctionSync("muteRemoteAudioStream",g)})}openRemoteDeviceByAdmin(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.openRemoteDeviceByAdmin with options: ",g),g.requestCallback||(g.requestCallback=()=>{}),yield this.JSCallNativeRequestFunctionPromise("openRemoteDeviceByAdmin",g)})}applyToAdminToOpenLocalDevice(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.applyToAdminToOpenLocalDevice with options: ",g),g.requestCallback||(g.requestCallback=()=>{}),yield this.JSCallNativeRequestFunctionPromise("applyToAdminToOpenLocalDevice",g)})}closeRemoteDeviceByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.closeRemoteDeviceByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("closeRemoteDeviceByAdmin",g)})}cancelRequest(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.cancelRequest with options: ",g),yield this.JSCallNativeFunctionPromise("cancelRequest",g)})}responseRemoteRequest(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.responseRemoteRequest with options: ",g),yield this.JSCallNativeFunctionPromise("responseRemoteRequest",g)})}disableDeviceForAllUserByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.disableDeviceForAllUserByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("disableDeviceForAllUserByAdmin",g)})}disableSendingMessageForAllUser(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.disableSendingMessageForAllUser with options: ",g),yield this.JSCallNativeFunctionPromise("disableSendingMessageForAllUser",g)})}disableSendingMessageByAdmin(g){return je(this,void 0,void 0,function*(){yield this.JSCallNativeFunctionPromise("disableSendingMessageByAdmin",g)})}changeUserRole(g){return je(this,void 0,void 0,function*(){let{userId:T,userRole:v}=g,w={userId:T,role:v};this.logger.info("roomEngine.changeUserRole with options: ",w),yield this.JSCallNativeFunctionPromise("changeUserRole",w)})}changeUserNameCard(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.changeUserNameCard with options: ",g),yield this.JSCallNativeFunctionPromise("changeUserNameCard",g)})}kickRemoteUserOutOfRoom(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.kickRemoteUserOutOfRoom with options: ",g),yield this.JSCallNativeFunctionPromise("kickRemoteUserOutOfRoom",g)})}setMaxSeatCount(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.setMaxSeatCount with options: ",g),yield this.JSCallNativeFunctionPromise("setMaxSeatCount",g)})}getSeatList(){return je(this,void 0,void 0,function*(){return yield this.JSCallNativeFunctionPromise("getSeatList")})}takeSeat(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.takeSeat with options: ",g),g.requestCallback||(g.requestCallback=()=>{});let{seatIndex:T,timeout:v,requestCallback:w}=g,N=!0,B={content:"",requestAction:0,requestId:"",timestamp:0,userId:"",userName:"",nameCard:"",avatarUrl:""};return new Promise((V,H)=>{let z=ae=>{ae.requestId===""?(N=!1,B=ae):(this.logger.info("roomEngine.takeSeat success with requestId:",ae),V(ae))},ne=ae=>{let te=Object.assign(Object.assign({},ae),{requestCallbackType:Hn.kRequestAccepted});if(w(te),!N)return this.logger.info("roomEngine.takeSeat success without request."),void V(B)},ge=ae=>{let te=Object.assign(Object.assign({},ae),{requestCallbackType:Hn.kRequestRejected});w(te)},pe=ae=>{let te=Object.assign(Object.assign({},ae),{requestCallbackType:Hn.kRequestCancelled});w(te)},oe=ae=>{let te=Object.assign(Object.assign({},ae),{requestCallbackType:Hn.kRequestTimeout});w(te)},de=ae=>{let te=Object.assign(Object.assign({},ae),{requestCallbackType:Hn.kRequestError});H(new Ln(te))};try{this.roomEngine.takeSeat(g,ne,ge,pe,oe,de,z)}catch(ae){st("error","at node_modules/@tencentcloud/tuiroom-engine-uniapp-app/index.esm.js:1","roomEngine.takeSeat error. ",ae.code,ae.message),H(new Ln({code:ae.code||Tn.ERR_FAILED,message:ae.message}))}})})}moveToSeat(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.moveToSeat with options:",g),yield this.JSCallNativeFunctionPromise("moveToSeat",g)})}leaveSeat(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.leaveSeat"),yield this.JSCallNativeFunctionPromise("leaveSeat")})}takeUserOnSeatByAdmin(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.takeUserOnSeatByAdmin with options: ",g),g.requestCallback||(g.requestCallback=()=>{}),yield this.JSCallNativeRequestFunctionPromise("takeUserOnSeatByAdmin",g)})}kickUserOffSeatByAdmin(g){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.kickUserOffSeatByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("kickUserOffSeatByAdmin",g)})}lockSeatByAdmin(g){return je(this,void 0,void 0,function*(){return this.logger.info("roomEngine.lockSeatByAdmin with options: ",g),yield this.JSCallNativeFunctionPromise("lockSeatByAdmin",g)})}getSeatApplicationList(){return je(this,void 0,void 0,function*(){return yield this.JSCallNativeFunctionPromise("getSeatApplicationList")})}getMediaDeviceManager(){return this.deviceManager||(this.deviceManager=pp.getInstance({logger:this.logger,Module:this.roomEngine})),this.deviceManager}startScreenSharing(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.startScreenSharing"),yield this.JSCallNativeFunctionSync("startScreenCapture")})}stopScreenSharing(){return je(this,void 0,void 0,function*(){this.logger.info("roomEngine.stopScreenSharing"),yield this.JSCallNativeFunctionSync("stopScreenCapture")})}getTRTCCloud(){return this.trtcCloud||(this.trtcCloud=gp.getInstance({logger:this.logger,Module:this.roomEngine})),this.trtcCloud}getConferenceListManager(){return this.conferenceListManager||(this.conferenceListManager=zr.getInstance({logger:this.logger,Module:this.roomEngine,globalEvent:ep})),this.conferenceListManager}getConferenceInvitationManager(){return this.conferenceInvitationManager||(this.conferenceInvitationManager=_p.getInstance({logger:this.logger,Module:this.roomEngine,globalEvent:ep})),this.conferenceInvitationManager}static callExperimentalAPI(g){return je(this,void 0,void 0,function*(){Tu.info("TUIRoomEngine.callExperimentalAPI",g);let T=jr(g);if(T===g)return;let{api:v,params:w}=T;v&&w&&(v==="setFramework"?yield f.handleSetFramework(w):yield f.JSCallNativeFunctionPromise("callExperimentalAPI",{jsonStr:g}))})}static handleSetFramework(g){return je(this,void 0,void 0,function*(){let{component:T,language:v}=g,w={TUIRoomEngine:16,TUIRoomKit:18,TIMRoomKit:19,TUILiveKit:21,VoiceRoom:22,EngineLive:23,Classroom:24},N={vue2:5,vue3:6},B={framework:{[qg]:11}[Sh]};if(w[T]&&(B.component=w[T]),N[v]&&(B.language=N[v]),B){let V={jsonStr:JSON.stringify({api:"setFramework",params:B})};yield f.JSCallNativeFunctionPromise("callExperimentalAPI",V)}})}static once(g,T){g==="ready"&&T()}on(g,T){kl.on(g,T),this.setObserver(g)}transformParams(g,T){let v={};return g===it.onUserVoiceVolumeChanged?(v.userVolumeList=[],Object.keys(T.volumeMap).forEach(w=>{v.userVolumeList.push({userId:w,volume:T.volumeMap[w]})})):v=T,v}setObserver(g){this.logger.info(`listen for event: ${g}`),ep.addEventListener(g,T=>{if(JSON.stringify(T)==="{}")kl.emit(g);else{let v=this.transformParams(g,T);kl.emit(g,v)}[it.onUserVoiceVolumeChanged,it.onUserNetworkQualityChanged,it.onReceiveTextMessage,it.onReceiveCustomMessage].includes(g)||(g!==it.onSeatListChanged?this.logger.info(`RoomEngine received event: [${g}] ${JSON.stringify(T)}`):this.logger.info(`RoomEngine received event: [onSeatListChanged] {seatedList: ${JSON.stringify(T)}, leftList: ${JSON.stringify(T)}}`))})}off(g,T){kl.off(g,T)}};xt([en(Wt.createRoom)],rt.prototype,"createRoom",null),xt([en(Wt.enterRoom)],rt.prototype,"enterRoom",null),xt([en(Wt.updateRoomNameByAdmin)],rt.prototype,"updateRoomNameByAdmin",null),xt([en(Wt.updateRoomSeatModeByAdmin)],rt.prototype,"updateRoomSeatModeByAdmin",null),xt([en(Wt.updateRoomPasswordByAdmin)],rt.prototype,"updateRoomPasswordByAdmin",null),xt([en(Wt.getUserList)],rt.prototype,"getUserList",null),xt([en(Wt.getUserInfo)],rt.prototype,"getUserInfo",null),xt([en(Wt.setCustomInfoForUser)],rt.prototype,"setCustomInfoForUser",null),xt([Sl(Wt.setLocalVideoView)],rt.prototype,"setLocalVideoView",null),xt([en(Wt.openLocalCamera)],rt.prototype,"openLocalCamera",null),xt([en(Wt.updateVideoQuality)],rt.prototype,"updateVideoQuality",null),xt([en(Wt.setVideoResolutionMode)],rt.prototype,"setVideoResolutionMode",null),xt([en(Wt.updateVideoQualityEx)],rt.prototype,"updateVideoQualityEx",null),xt([en(Wt.updateAudioQuality)],rt.prototype,"updateAudioQuality",null),xt([Sl(Wt.setRemoteVideoView)],rt.prototype,"setRemoteVideoView",null),xt([Sl(Wt.startPlayRemoteVideo)],rt.prototype,"startPlayRemoteVideo",null),xt([en(Wt.stopPlayRemoteVideo)],rt.prototype,"stopPlayRemoteVideo",null),xt([Sl(Wt.muteRemoteAudioStream)],rt.prototype,"muteRemoteAudioStream",null),xt([en(Wt.openRemoteDeviceByAdmin)],rt.prototype,"openRemoteDeviceByAdmin",null),xt([en(Wt.applyToAdminToOpenLocalDevice)],rt.prototype,"applyToAdminToOpenLocalDevice",null),xt([en(Wt.closeRemoteDeviceByAdmin)],rt.prototype,"closeRemoteDeviceByAdmin",null),xt([en(Wt.cancelRequest)],rt.prototype,"cancelRequest",null),xt([en(Wt.responseRemoteRequest)],rt.prototype,"responseRemoteRequest",null),xt([en(Wt.disableDeviceForAllUserByAdmin)],rt.prototype,"disableDeviceForAllUserByAdmin",null),xt([en(Wt.disableSendingMessageForAllUser)],rt.prototype,"disableSendingMessageForAllUser",null),xt([en(Wt.disableSendingMessageByAdmin)],rt.prototype,"disableSendingMessageByAdmin",null),xt([en(Wt.changeUserRole)],rt.prototype,"changeUserRole",null),xt([en(Wt.changeUserNameCard)],rt.prototype,"changeUserNameCard",null),xt([en(Wt.kickRemoteUserOutOfRoom)],rt.prototype,"kickRemoteUserOutOfRoom",null),xt([en(Wt.setRoomMaxSeatCount)],rt.prototype,"setMaxSeatCount",null),xt([en(Wt.takeSeat)],rt.prototype,"takeSeat",null),xt([en(Wt.takeUserOnSeatByAdmin)],rt.prototype,"takeUserOnSeatByAdmin",null),xt([en(Wt.kickUserOffSeatByAdmin)],rt.prototype,"kickUserOffSeatByAdmin",null),xt([en(Wt.lockSeatByAdmin)],rt.prototype,"lockSeatByAdmin",null),xt([en(Wt.startScreenSharing)],rt.prototype,"startScreenSharing",null),xt([en(Wt.stopScreenSharing)],rt.prototype,"stopScreenSharing",null),xt([en(Wt.login),_g()],rt,"login",null),xt([en(Wt.setSelfInfo)],rt,"setSelfInfo",null),xt([_g()],rt,"logout",null),rt.callExperimentalAPI(JSON.stringify({api:"setFramework",params:{component:"TUIRoomEngine"}}));var Op=f=>new Promise((g,T)=>{uni.setClipboardData({data:f,success(){g({code:0,data:f})},fail(v){T({code:-1,err:v})}})});function Dh(f,g){let T;return function(...v){T>0&&clearTimeout(T),T=window==null?void 0:window.setTimeout(()=>{f.apply(this,v),T=-1},g)}}function Vg(f,g){let T=0;return function(...v){let w=Date.now();w-T>g&&(f.apply(this,v),T=w)}}function Eh(f){var g;let T=(g=window==null?void 0:window.location)==null?void 0:g.href.replace(/^[^?]*\?/,""),v=new RegExp(`(^|&)${f}=([^&#]*)(&|$|)`,"i"),w=T==null?void 0:T.match(v);return w?w[2]:null}var Ol=f=>typeof f=="undefined",Rh=f=>typeof f=="number",Lh=f=>typeof f=="string"&&!isNaN(Number(f)),Np=f=>typeof f=="function";function Al(f,g="px"){return Rh(f)||Lh(f)?f+g:f}function Bg(){let f=Eh("lang")||uni.getStorageSync("tuiRoom-language")||(navigator==null?void 0:navigator.language)||"zh";return f=f.replace(/_/,"-").toLowerCase(),f==="zh-cn"||f==="zh"?f="zh-CN":(f==="en"||f==="en-us"||f==="en-GB")&&(f="en-US"),f}var Bn=(f=>(f.SIX_EQUAL_POINTS="six_equal_points",f.NINE_EQUAL_POINTS="nine_equal_points",f.TWENTY_FIVE_EQUAL_POINTS="twenty_five_equal_points",f.RIGHT_SIDE_LIST="right_side_list",f.TOP_SIDE_LIST="top_side_list",f.LARGE_SMALL_WINDOW="large_small_window",f.GRID_VIEW="grid_view",f))(Bn||{}),Yr=(f=>(f.SIMPLE="simple",f.DETAIL="detail",f))(Yr||{}),ql=typeof wx!="undefined"&&typeof wx.getSystemInfoSync=="function"&&!!wx.getSystemInfoSync().fontSizeSetting,Hg=typeof uni!="undefined"&&typeof window=="undefined",kh=ql||Hg,Ah=typeof uni!="undefined",Zr=(typeof uni!="undefined"||typeof window!="undefined")&&!kh;ql?wx:Ah&&uni;var sr=Zr&&window&&window.navigator&&window.navigator.userAgent||"",Oh=/Android/i.test(sr),Nh=/(?:Windows Phone)/.test(sr),bh=/(?:SymbianOS)/.test(sr),Ph=/OpenHarmony/i.test(sr),Gh=Zr&&("ontouchstart"in window||navigator.maxTouchPoints>0)&&function(){if(Zr){if(/Tablet|Pad/i.test(sr))return!0;if(window.orientation===180||window.orientation===0)return window.innerWidth>=768&&window.innerHeight>=1024;if(window.orientation===90||window.orientation===-90)return window.innerWidth>=1024&&window.innerHeight>=768}return!1}(),Uh=/iPhone/i.test(sr)||/iPod/i.test(sr),wh=ql,Kg=Oh||Nh||bh||Uh||Gh||Ph,Fh=Zr&&!Kg,xh=Hg&&!ql;function Vl(){let f="";return Fh?f="pc":Kg?f="h5":wh?f="wechat":xh&&(f="app"),f}var fp=class f{constructor(){if(f.instance)return f.instance;f.instance=this,this.eventCallback=null,this.listener=null,this.button=0,this.init()}init(){Zr&&(this.eventCallback=g=>{this.listener&&this.listener(g)},document.addEventListener("mousedown",this.eventCallback))}listen(g){if(Zr){let{domRefs:T,ignoreDomRefs:v,handler:w,button:N=0}=g;this.button=N,this.listener=B=>{let V=Array.isArray(v)?v:[v];for(let z of V)if(z&&z.contains(B.target))return;let H=Array.isArray(T)?T:[T];for(let z of H)if(z&&z.contains(B.target)&&this.button===B.button)return;w(B),this.remove()}}}remove(){this.listener=null,this.button=-1}};st("log","at node_modules/@tencentcloud/universal-api/index.js:1","UniversalAPI.VERSION:2.4.0");new fp;Vl();var Bl=Vl()==="h5",mo=Vl()==="wechat",Ro=Vl()==="app",Fn=Bl||mo||Ro,Aa=((Xp=navigator==null?void 0:navigator.userAgent)==null?void 0:Xp.toLowerCase().indexOf(" electron/"))>-1;navigator&&((Qp=navigator==null?void 0:navigator.userAgent)==null?void 0:Qp.toLocaleLowerCase().indexOf("micromessenger"))>-1;var qt=(0,Mt.defineStore)("basic",{state:()=>({sdkAppId:0,userId:"",userSig:"",userName:"",avatarUrl:"",useStringRoomId:!1,roomId:"",roomMode:"FreeSpeech",isSidebarOpen:!1,layout:mo||Ro?Bn.SIX_EQUAL_POINTS:Bn.NINE_EQUAL_POINTS,showSettingDialog:!1,showApplyUserList:!1,activeSettingTab:"audio",isLocalStreamMirror:!0,isFrontCamera:!0,sidebarName:"",masterUserId:"",localQuality:0,networkInfo:{userId:"",downLoss:0,quality:0,upLoss:0,delay:0},lang:Bg(),defaultTheme:Ro?"white":"black",isSupportSwitchTheme:!0,showHeaderTool:!0,shareLink:"",isRoomLinkVisible:!Aa&&!mo,isSchemeLinkVisible:!Fn,isShowScreenShareAntiFraud:!1,isOpenMic:!1,componentConfig:{SwitchTheme:{visible:!0},InviteControl:{visible:!0},RoomLink:{visible:!0}}}),getters:{},actions:{setSdkAppId(f){this.sdkAppId=f},setUserId(f){this.userId=f},setUserSig(f){this.userSig=f},setUserName(f){this.userName=f},setAvatarUrl(f){this.avatarUrl=f},setRoomId(f){this.roomId=f,this.useStringRoomId=typeof f=="string"},setSidebarOpenStatus(f){this.isSidebarOpen=f},setSidebarName(f){this.sidebarName=f},setLayout(f){this.layout=f},setShowSettingDialog(f){this.showSettingDialog=f},setShowApplyUserList(f){this.showApplyUserList=f},setActiveSettingTab(f){this.activeSettingTab=f},setIsLocalStreamMirror(f){this.isLocalStreamMirror=f},setIsFrontCamera(f){this.isFrontCamera=f},setDefaultTheme(f){this.defaultTheme=f},setIsSupportSwitchTheme(f){this.isSupportSwitchTheme=f},setShowHeaderTool(f){this.showHeaderTool=f},setShareLink(f){this.shareLink=f},setIsRoomLinkVisible(f){this.isRoomLinkVisible=f},setIsSchemeLinkVisible(f){this.isSchemeLinkVisible=f},setIsShowScreenShareAntiFraud(f){this.isShowScreenShareAntiFraud=f},setBasicInfo(f){if(!f)return;let{sdkAppId:g,userId:T,userSig:v,userName:w,avatarUrl:N,roomId:B,theme:V,showHeaderTool:H}=f;g&&this.setSdkAppId(g),T&&this.setUserId(T),v&&this.setUserSig(v),w&&this.setUserName(w),N&&this.setAvatarUrl(N),B&&this.setRoomId(B),V&&!Ol(V.defaultTheme)&&this.setDefaultTheme(V.defaultTheme),V&&!Ol(V.isSupportSwitchTheme)&&this.setIsSupportSwitchTheme(V.isSupportSwitchTheme),!Ol(H)&&this.setShowHeaderTool(H)},setMasterUserId(f){this.masterUserId=f},setLocalQuality(f){let g=f==null?void 0:f.find(T=>T.userId===this.userId);this.localQuality=g==null?void 0:g.quality},setNetworkInfo(f){f.userId===this.userId&&(this.networkInfo=f)},setLang(f){this.lang=f},setIsOpenMic(f){this.isOpenMic=f},reset(){this.isSidebarOpen=!1,this.layout=mo||Ro?Bn.SIX_EQUAL_POINTS:Bn.NINE_EQUAL_POINTS,this.showSettingDialog=!1,this.activeSettingTab="audio",this.isLocalStreamMirror=!0,this.sidebarName="",this.masterUserId="",this.localQuality=0,this.roomId="",this.useStringRoomId=!1,this.roomMode="FreeSpeech",this.showApplyUserList=!1,this.isFrontCamera=!0,this.showHeaderTool=!0,this.shareLink="",this.isOpenMic=!1}}}),Qo=/^3\.*/.test(fo.version),Ug={instance:null},qh=Qo?"vue3":"vue2";function zn(){function f(){Ug.instance=new rt}return(0,h.onBeforeMount)(()=>{f()}),Ug}rt.once("ready",()=>{rt.callExperimentalAPI(JSON.stringify({api:"setFramework",params:{component:"TUIRoomKit",language:qh}}))});var tp=zn(),Dn=(0,Mt.defineStore)("room",{state:()=>({localUser:{userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,hasScreenStream:!1,userRole:Et.kGeneralUser,onSeat:!1,cameraStreamInfo:{userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,streamType:jt.kCameraStream,isVisible:!0,userRole:Et.kGeneralUser},screenStreamInfo:{userId:"",userName:"",avatarUrl:"",hasScreenStream:!1,streamType:jt.kScreenStream,isVisible:!0,userRole:Et.kGeneralUser}},remoteUserObj:{},userVolumeObj:{},isDefaultOpenCamera:!1,isDefaultOpenMicrophone:!1,canControlSelfAudio:!0,canControlSelfVideo:!0,localVideoQuality:Fn?xo.kVideoQuality_360p:xo.kVideoQuality_720p,currentCameraId:"",currentMicrophoneId:"",currentSpeakerId:"",cameraList:[],microphoneList:[],speakerList:[],masterUserId:"",isMicrophoneDisableForAllUser:!1,isCameraDisableForAllUser:!1,isMessageDisableForAllUser:!1,isSeatEnabled:!1,seatMode:ji.kFreeToTake,maxMembersCount:5,hasVideoStreamObject:{},currentStreamIdListInVisibleView:[],hasOtherScreenShare:!1,isOnStateTabActive:!0}),getters:{isMaster(f){return f.localUser.userId===f.masterUserId},isAdmin(f){return f.localUser.userRole===Et.kAdministrator},isGeneralUser(f){return f.localUser.userRole===Et.kGeneralUser},isAnchor(f){if(this.isFreeSpeakMode)return!0;if(this.isSpeakAfterTakingSeatMode)return f.localUser.onSeat},isAudience(f){if(this.isFreeSpeakMode)return!1;if(this.isSpeakAfterTakingSeatMode)return!f.localUser.onSeat},isSpeakAfterTakingSeatMode(){return this.isSeatEnabled&&this.seatMode===ji.kApplyToTake},isFreeSpeakMode(){return!this.isSeatEnabled},isLocalAudioIconDisable(){return this.isGeneralUser&&!this.canControlSelfAudio||this.isAudience},isLocalVideoIconDisable(){return this.isGeneralUser&&!this.canControlSelfVideo||this.isAudience},localStream:f=>{let{userId:g,userName:T,avatarUrl:v,hasAudioStream:w,hasVideoStream:N,userRole:B}=f.localUser;return Object.assign(f.localUser.cameraStreamInfo,{userId:g,userName:T,avatarUrl:v,hasAudioStream:w,hasVideoStream:N,userRole:B}),f.localUser.cameraStreamInfo},localScreenStream:f=>{let{userId:g,userName:T,avatarUrl:v,hasScreenStream:w,userRole:N}=f.localUser;return Object.assign(f.localUser.screenStreamInfo,{userId:g,userName:T,avatarUrl:v,hasScreenStream:w,userRole:N}),f.localUser.screenStreamInfo},remoteStreamObj:f=>{let g={};return[...Object.values(f.remoteUserObj)].forEach(T=>{let{userId:v,avatarUrl:w,userName:N,onSeat:B,hasAudioStream:V,hasVideoStream:H,hasScreenStream:z,isVideoVisible:ne,isScreenVisible:ge,userRole:pe}=T;B&&(g[`${v}_${jt.kCameraStream}`]=Object.assign(T.cameraStreamInfo,{userId:v,avatarUrl:w,userName:N,hasAudioStream:V,hasVideoStream:H,userRole:pe,streamType:jt.kCameraStream,isVisible:ne})),z&&(g[`${v}_${jt.kScreenStream}`]=Object.assign(T.screenStreamInfo,{userId:v,avatarUrl:w,userName:N,hasScreenStream:z,userRole:pe,streamType:jt.kScreenStream,isVisible:ge}))}),g},remoteStreamList(){return[...Object.values(this.remoteStreamObj)]},streamList(){let f=[this.localStream,...Object.values(this.remoteStreamObj)];return this.localUser.hasScreenStream&&f.unshift(this.localScreenStream),f},streamNumber(){return this.streamList.length},remoteUserList:f=>[...Object.values(f.remoteUserObj)],remoteAnchorList:f=>[...Object.values(f.remoteUserObj)].filter(g=>g.onSeat),userList:f=>[f.localUser,...Object.values(f.remoteUserObj)],userNumber(){return this.userList.length},anchorUserList:f=>[f.localUser,...Object.values(f.remoteUserObj)].filter(g=>g.onSeat),applyToAnchorList:f=>[...Object.values(f.remoteUserObj)].filter(g=>g.isUserApplyingToAnchor).sort((g,T)=>((g==null?void 0:g.applyToAnchorTimestamp)||0)-((T==null?void 0:T.applyToAnchorTimestamp)||0))||[],defaultStreamType(){return Object.keys(this.hasVideoStreamObject).length>this.maxMembersCount?jt.kCameraStreamLow:jt.kCameraStream}},actions:{setLocalUser(f){Object.assign(this.localUser,f)},updateLocalStream(f){Object.assign(this.localStream,f)},getUserName(f){var g;return f===this.localUser.userId?this.localUser.userName||f:((g=this.remoteUserObj[f])==null?void 0:g.userName)||f},getUserRole(f){var g;return f===this.localUser.userId?this.localUser.userRole:(g=this.remoteUserObj[f])==null?void 0:g.userRole},getNewUserInfo(f){return{userId:f,userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,hasScreenStream:!1,isVideoVisible:!1,isScreenVisible:!1,userRole:Et.kGeneralUser,onSeat:!this.isSpeakAfterTakingSeatMode,isChatMutedByMasterOrAdmin:!1,isUserApplyingToAnchor:!1,isInvitingUserToAnchor:!1,cameraStreamInfo:{userId:f,userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,streamType:jt.kCameraStream,isVisible:!1,userRole:Et.kGeneralUser},screenStreamInfo:{userId:f,userName:"",avatarUrl:"",hasScreenStream:!1,streamType:jt.kScreenStream,isVisible:!1,userRole:Et.kGeneralUser}}},updateUserList(f){f==null||f.forEach(g=>{if(g.userId===this.localUser.userId){Object.assign(this.localUser,g);return}if(this.remoteUserObj[g.userId])Object.assign(this.remoteUserObj[g.userId],g);else{let T=Object.assign(this.getNewUserInfo(g.userId),g);Qo?this.remoteUserObj[g.userId]=T:fo.set(this.remoteUserObj,g.userId,T)}})},addRemoteUser(f){let{userId:g}=f,T=qt();if(!(!g||g===T.userId))if(this.remoteUserObj[g])Object.assign(this.remoteUserObj[g],f);else{let v=Object.assign(this.getNewUserInfo(g),f);Qo?this.remoteUserObj[g]=v:fo.set(this.remoteUserObj,g,v)}},updateRemoteUser(f,g){let T=this.remoteUserObj[f];if(!T)return;let{nick:v,avatar:w}=g;Object.assign(T,{userName:v,avatarUrl:w})},setSeatList(f){f==null||f.forEach(g=>{let{userId:T}=g;if(T)if(T===this.localUser.userId)Object.assign(this.localUser,{onSeat:!0});else{let v=this.remoteUserObj[T];if(v)Object.assign(v,{onSeat:!0});else{let w=Object.assign(this.getNewUserInfo(T),{onSeat:!0});Qo?this.remoteUserObj[T]=w:fo.set(this.remoteUserObj,T,w)}}})},updateOnSeatList(f,g){f.forEach(T=>{let{userId:v}=T;if(v===this.localUser.userId)Object.assign(this.localUser,{onSeat:!0});else{let w=this.remoteUserObj[v];if(w)Object.assign(w,{onSeat:!0});else{let N=Object.assign(this.getNewUserInfo(v),{onSeat:!0});Qo?this.remoteUserObj[v]=N:fo.set(this.remoteUserObj,v,N)}}}),g.forEach(T=>{if(T.userId===this.localUser.userId)Object.assign(this.localUser,{onSeat:!1}),qt().setIsOpenMic(!1);else{let v=this.remoteUserObj[T.userId];v&&Object.assign(v,{onSeat:!1})}})},updateUserVideoState(f,g,T){let v=qt(),w=f===v.userId?this.localUser:this.remoteUserObj[f];!w&&T&&(w=this.getNewUserInfo(f),Qo?this.remoteUserObj[f]=w:fo.set(this.remoteUserObj,f,w)),w&&(this.updatehasVideoStreamObject(w,T,f===v.userId),g===jt.kCameraStream||g===jt.kCameraStreamLow?w.hasVideoStream=T:g===jt.kScreenStream&&(w.hasScreenStream=T))},updatehasVideoStreamObject(f,g,T){if(T)return;let{userId:v,cameraStreamInfo:w,screenStreamInfo:N,hasVideoStream:B}=f,V=`${v}_${B?w.streamType:N.streamType}`;g?Qo?this.hasVideoStreamObject[V]=f:fo.set(this.hasVideoStreamObject,V,f):Qo?delete this.hasVideoStreamObject[V]:fo.delete(this.hasVideoStreamObject,V)},updateUserAudioState(f,g){let T=qt(),v=f===T.userId?this.localUser:this.remoteUserObj[f];!v&&g&&(v=this.getNewUserInfo(f),Qo?this.remoteUserObj[f]=v:fo.set(this.remoteUserObj,f,v)),v&&(v.hasAudioStream=g)},removeRemoteUser(f){let g=qt();!f||f===g.userId||(Qo?delete this.remoteUserObj[f]:fo.delete(this.remoteUserObj,f))},updateUserStreamVisible(f){f.forEach(g=>{let T=g.slice(0,g.length-2),v=Number(g.slice(-1));if(T===this.localUser.userId)return;let w=this.remoteUserObj[T];w&&(v===jt.kCameraStream||v===jt.kCameraStreamLow?w.isVideoVisible=!0:v===jt.kScreenStream&&(w.isScreenVisible=!0))}),this.currentStreamIdListInVisibleView.forEach(g=>{let T=g.slice(0,g.length-2),v=Number(g.slice(-1));if(f.indexOf(g)<0){let w=this.remoteUserObj[T];if(!w)return;v===jt.kCameraStream||v===jt.kCameraStreamLow?w.isVideoVisible=!1:v===jt.kScreenStream&&(w.isScreenVisible=!1)}}),this.currentStreamIdListInVisibleView=f},setAudioVolume(f){let g=qt();f==null||f.forEach(T=>{let{userId:v}=T,{volume:w}=T;v===""&&(v=g.userId),Qo?this.userVolumeObj[v]=w:fo.set(this.userVolumeObj,v,w)})},setCurrentDeviceId(f,g){switch(f){case Yn.kMediaDeviceTypeVideoCamera:this.setCurrentCameraId(g);break;case Yn.kMediaDeviceTypeAudioInput:this.setCurrentMicrophoneId(g);break;case Yn.kMediaDeviceTypeAudioOutput:this.setCurrentSpeakerId(g);break}},setCurrentCameraId(f){this.currentCameraId=f},setCurrentMicrophoneId(f){this.currentMicrophoneId=f},setCurrentSpeakerId(f){this.currentSpeakerId=f},setRoomInfo(f){let{roomOwner:g,isMicrophoneDisableForAllUser:T,isCameraDisableForAllUser:v,isMessageDisableForAllUser:w,isSeatEnabled:N,seatMode:B}=f;this.localUser.userId===g&&(this.localUser.userRole=Et.kRoomOwner),this.masterUserId=g,this.isMicrophoneDisableForAllUser=T,this.isCameraDisableForAllUser=v,this.isMessageDisableForAllUser=w,this.isSeatEnabled=N,this.seatMode=B,this.canControlSelfAudio=!this.isMicrophoneDisableForAllUser,this.canControlSelfVideo=!this.isCameraDisableForAllUser},setDisableMicrophoneForAllUserByAdmin(f){this.isMicrophoneDisableForAllUser=f},setDisableCameraForAllUserByAdmin(f){this.isCameraDisableForAllUser=f},setDisableMessageAllUserByAdmin(f){this.isMessageDisableForAllUser=f},setMasterUserId(f){this.masterUserId=f},setRoomParam(f){var g,T,v;if(!f)return;let{isOpenCamera:w,isOpenMicrophone:N,defaultCameraId:B,defaultMicrophoneId:V,defaultSpeakerId:H}=f;B&&(this.setCurrentCameraId(B),(g=tp.instance)==null||g.setCurrentCameraDevice({deviceId:B})),V&&(this.setCurrentMicrophoneId(V),(T=tp.instance)==null||T.setCurrentMicDevice({deviceId:V})),H&&(this.setCurrentSpeakerId(H),(v=tp.instance)==null||v.setCurrentSpeakerDevice({deviceId:H})),(this.isMaster||!this.isMicrophoneDisableForAllUser&&this.isFreeSpeakMode)&&typeof N=="boolean"&&(this.isDefaultOpenMicrophone=N),(this.isMaster||!this.isCameraDisableForAllUser&&this.isFreeSpeakMode)&&typeof w=="boolean"&&(this.isDefaultOpenCamera=w)},setCanControlSelfAudio(f){this.canControlSelfAudio=f},setCanControlSelfVideo(f){this.canControlSelfVideo=f},updateVideoQuality(f){this.localVideoQuality=f},setDeviceList(f,g){switch(f){case Yn.kMediaDeviceTypeVideoCamera:this.setCameraList(g);break;case Yn.kMediaDeviceTypeAudioInput:this.setMicrophoneList(g);break;case Yn.kMediaDeviceTypeAudioOutput:this.setSpeakerList(g);break}},setCameraList(f){this.cameraList=f,!this.currentCameraId&&f.length>0&&this.setCurrentCameraId(f[0].deviceId)},setMicrophoneList(f){this.microphoneList=f,!this.currentMicrophoneId&&f.length>0&&this.setCurrentMicrophoneId(f[0].deviceId)},setSpeakerList(f){this.speakerList=f,!this.currentSpeakerId&&f.length>0&&this.setCurrentSpeakerId(f[0].deviceId)},setMicrophoneDisableState(f){this.isMicrophoneDisableForAllUser=f},setCameraDisableState(f){this.isCameraDisableForAllUser=f},setMuteUserChat(f,g){let T=this.remoteUserObj[f];T&&(T.isChatMutedByMasterOrAdmin=g)},setRemoteUserRole(f,g){let T=this.remoteUserObj[f];T&&(T.userRole=g)},setRequestUserOpenMic(f){let{userId:g,isRequesting:T,requestId:v}=f,w=this.remoteUserObj[g];w&&(w.isRequestingUserOpenMic=T,w.requestUserOpenMicRequestId=T?v:"")},setRequestUserOpenCamera(f){let{userId:g,isRequesting:T,requestId:v}=f,w=this.remoteUserObj[g];w&&(w.isRequestingUserOpenCamera=T,w.requestUserOpenCameraRequestId=T?v:"")},addApplyToAnchorUser(f){let{userId:g,requestId:T,timestamp:v}=f,w=this.remoteUserObj[g];w&&(w.isUserApplyingToAnchor=!0,w.applyToAnchorRequestId=T,w.applyToAnchorTimestamp=v)},removeApplyToAnchorUser(f){let g=Object.values(this.remoteUserObj).find(T=>T.isUserApplyingToAnchor&&T.applyToAnchorRequestId===f);g&&(g.isUserApplyingToAnchor=!1,g.applyToAnchorRequestId="",g.applyToAnchorTimestamp=0)},addInviteToAnchorUser(f){let{userId:g,requestId:T}=f,v=this.remoteUserObj[g];v&&(v.isInvitingUserToAnchor=!0,v.inviteToAnchorRequestId=T)},removeInviteToAnchorUser(f){let g=this.remoteUserObj[f];g&&(g.isInvitingUserToAnchor=!1,g.inviteToAnchorRequestId="")},setHasOtherScreenShare(f){this.hasOtherScreenShare=f},setOnStageTabStatus(f){this.isOnStateTabActive=f},reset(){qt().setIsOpenMic(!1),this.localUser={userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,hasScreenStream:!1,userRole:Et.kGeneralUser,onSeat:!1,cameraStreamInfo:{userId:"",userName:"",avatarUrl:"",hasAudioStream:!1,hasVideoStream:!1,streamType:jt.kCameraStream,isVisible:!0,userRole:Et.kGeneralUser},screenStreamInfo:{userId:"",userName:"",avatarUrl:"",hasScreenStream:!1,streamType:jt.kScreenStream,isVisible:!0,userRole:Et.kGeneralUser}},this.remoteUserObj={},this.userVolumeObj={},this.isDefaultOpenCamera=!1,this.isDefaultOpenMicrophone=!1,this.canControlSelfAudio=!0,this.canControlSelfVideo=!0,this.localVideoQuality=xo.kVideoQuality_720p,this.currentCameraId="",this.currentMicrophoneId="",this.currentSpeakerId="",this.cameraList=[],this.microphoneList=[],this.speakerList=[],this.masterUserId="",this.isMicrophoneDisableForAllUser=!1,this.isCameraDisableForAllUser=!1,this.isMessageDisableForAllUser=!1,this.isSeatEnabled=!1,this.seatMode=ji.kFreeToTake,this.hasVideoStreamObject={},this.hasOtherScreenShare=!1,this.isOnStateTabActive=!0}}}),bp=(0,Mt.defineStore)("chat",{state:()=>({messageList:[],isMessageDisableByAdmin:!1,unReadCount:0,isCompleted:!1,nextReqMessageId:"",route:""}),getters:{},actions:{updateMessageList(f){this.messageList.map(T=>T.ID).indexOf(f.ID)===-1&&(this.messageList=this.messageList.concat([f]))},setMessageListInfo(f,g,T){this.messageList=f,this.isCompleted=g,this.nextReqMessageId=T},updateUnReadCount(f){this.unReadCount=f},addHistoryMessages(f){let g=this.messageList.map(v=>v.ID),T=f.filter(v=>g.indexOf(v.ID)===-1);this.messageList=T.concat(this.messageList).sort((v,w)=>v.sequence-w.sequence)},setSendMessageDisableChanged(f){this.isMessageDisableByAdmin=f},setCurrentsPage(f){this.route=f},reset(){this.messageList=[],this.unReadCount=0,this.isMessageDisableByAdmin=!1,this.route=""}}}),Vh={"":"","Sign in":"\u8BF7\u767B\u5F55","Phone Login":"\u624B\u673A\u767B\u5F55","Email Login":"\u90AE\u7BB1\u767B\u5F55","I have read and agree to the":"\u6211\u5DF2\u9605\u8BFB\u5E76\u540C\u610F","Privacy Policy":"\u9690\u79C1\u534F\u8BAE",and:"\u548C","Terms of Use":"\u7528\u6237\u534F\u8BAE",Login:"\u767B\u5F55","Mobile number":"\u8BF7\u8F93\u5165\u60A8\u7684\u624B\u673A\u53F7","Verification code":"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801","Email address":"\u8BF7\u8F93\u5165\u90AE\u7BB1","Please enter a valid phone number!":"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u624B\u673A\u53F7\uFF01","Please enter a valid email address!":"\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u90AE\u7BB1\u5730\u5740\uFF01","Please enter your phone number!":"\u8BF7\u8F93\u5165\u624B\u673A\u53F7\uFF01","Please enter your email address!":"\u8BF7\u8F93\u5165\u90AE\u7BB1\u5730\u5740\uFF01","Please enter the verification code!":"\u8BF7\u8F93\u5165\u9A8C\u8BC1\u7801\uFF01","Please accept the privacy policy and user agreement!":"\u8BF7\u540C\u610F\u9690\u79C1\u534F\u8BAE\u53CA\u7528\u6237\u534F\u8BAE\uFF01","Incorrect verification code, please check the code!":"\u9A8C\u8BC1\u7801\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u9A8C\u8BC1\u7801\uFF01","The verification code has expired, please retrieve a new one!":"\u9A8C\u8BC1\u7801\u5DF2\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u83B7\u53D6\u9A8C\u8BC1\u7801\uFF01","The verification code has been used, please retrieve a new one!":"\u9A8C\u8BC1\u7801\u5DF2\u4F7F\u7528\uFF0C\u8BF7\u91CD\u65B0\u83B7\u53D6\u9A8C\u8BC1\u7801\uFF01","Login failed, please try again.":"\u767B\u5F55\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5",SEND:"\u83B7\u53D6\u9A8C\u8BC1\u7801"," ":"\u5012\u8BA1\u65F6","The room does not exist, please confirm the room number or create a room!":"\u623F\u95F4\u4E0D\u5B58\u5728\uFF0C\u8BF7\u786E\u8BA4\u623F\u95F4\u53F7\u6216\u521B\u5EFA\u623F\u95F4\uFF01","Log out":"\u9000\u51FA\u767B\u5F55","Edit profile":"\u7F16\u8F91\u8D44\u6599","User Name":"\u7528\u6237\u540D","Please input user name":"\u8BF7\u8F93\u5165\u7528\u6237\u540D","Username length should be greater than 0":"\u6635\u79F0\u957F\u5EA6\u5E94\u8BE5\u5927\u4E8E0",Save:"\u4FDD\u5B58",Camera:"\u6444\u50CF\u5934",Mic:"\u9EA6\u514B\u98CE","Off Camera":"\u6444\u50CF\u5934\u5DF2\u5173\u95ED","Mic settings":"\u9EA6\u514B\u98CE\u8BBE\u7F6E",Output:"\u8F93\u51FA",Speaker:"\u626C\u58F0\u5668",Test:"\u6D4B\u8BD5",Stop:"\u505C\u6B62\u6D4B\u8BD5",Preview:"\u89C6\u9891\u753B\u9762",Mirror:"\u89C6\u9891\u955C\u50CF",Resolution:"\u5206\u8FA8\u7387","More Camera Settings":"\u66F4\u591A\u6444\u50CF\u5934\u8BBE\u7F6E","Join the room ?":"\u662F\u5426\u8FDB\u5165\u623F\u95F4?","You are invited to room ":"\u60A8\u88AB\u9080\u8BF7\u8FDB\u5165 ",Room:"\u623F\u95F4",Join:"\u786E\u5B9A\u8FDB\u5165","Switch Theme":"\u6362\u80A4",Layout:"\u5E03\u5C40","New Room":"\u65B0\u5EFA\u623F\u95F4","Room Type":"\u623F\u95F4\u7C7B\u578B","Your Name":"\u60A8\u7684\u540D\u5B57","Turn on the microphone":"\u5F00\u542F\u9EA6\u514B\u98CE","Turn on the speaker":"\u5F00\u542F\u626C\u58F0\u5668","Turn on the video":"\u5F00\u542F\u89C6\u9891","Free Speech Room":"\u81EA\u7531\u53D1\u8A00\u623F\u95F4","On-stage Speaking Room":"\u4E0A\u53F0\u53D1\u8A00\u623F\u95F4","Join Room":"\u8FDB\u5165\u623F\u95F4","Enter room ID":"\u8F93\u5165\u623F\u95F4\u53F7","video conferencing":" \u7684\u89C6\u9891\u4F1A\u8BAE","Quick Meeting":"\u7684\u5FEB\u901F\u4F1A\u8BAE","Room ID":"\u623F\u95F4\u53F7","Low Definition":"\u6D41\u7545","Standard Definition":"\u6807\u6E05","High Definition":"\u9AD8\u6E05","Super Definition":"\u8D85\u6E05","End sharing":"\u7ED3\u675F\u5171\u4EAB","Stop sharing?":"\u662F\u5426\u505C\u6B62\u5C4F\u5E55\u5171\u4EAB\uFF1F","Stop sharing":"\u505C\u6B62\u5171\u4EAB","You are sharing the screen...":"\u4F60\u6B63\u5728\u5171\u4EAB\u5C4F\u5E55...",Sure:"\u786E\u5B9A",Sharing:"\u5C4F\u5E55\u5171\u4EAB\u4E2D","Share screen":"\u5171\u4EAB\u5C4F\u5E55","Grant permission to screen recording":"\u6253\u5F00\u5C4F\u5E55\u5F55\u5236\u6743\u9650","Open the system preferences settings":"\u6253\u5F00\u7CFB\u7EDF\u4FBF\u597D\u8BBE\u7F6E",'Due to macOS 10.15 system requirements, please check the current application in "System Preferences - Security & Privacy - Screen Recording".':'\u7531\u4E8Emacos 10.15 \u7CFB\u7EDF\u8981\u6C42\uFF0C\u8BF7\u5728"\u7CFB\u7EDF\u504F\u597D\u8BBE\u7F6E-\u5B89\u5168\u6027\u4E0E\u9690\u79C1-\u5C4F\u5E55\u5F55\u5236"\u4E2D\u52FE\u9009\u5F53\u524D\u5E94\u7528\u7A0B\u5E8F\u3002',"Others will no longer see your screen after you stop sharing. Are you sure you want to stop?":"\u662F\u5426\u7ED3\u675F\u5F53\u524D\u7684\u5171\u4EAB\u5C4F\u5E55\uFF0C\u505C\u6B62\u540E\u6240\u6709\u4EBA\u5C06\u65E0\u6CD5\u7EE7\u7EED\u89C2\u770B\u5C4F\u5E55\u5185\u5BB9","Others will no longer see your screen after you stop sharing.":"\u505C\u6B62\u540E\u6240\u6709\u4EBA\u5C06\u65E0\u6CD5\u7EE7\u7EED\u89C2\u770B\u5C4F\u5E55\u5185\u5BB9","You currently do not have sharing permission, please raise your hand to apply for sharing permission first":"\u60A8\u5F53\u524D\u6CA1\u6709\u5171\u4EAB\u6743\u9650\uFF0C\u8BF7\u5148\u4E3E\u624B\u7533\u8BF7\u4E0A\u53F0\u83B7\u53D6\u5171\u4EAB\u6743\u9650",Host:"\u623F\u4E3B",Me:"\u6211",me:"\u6211",Admin:"\u7BA1\u7406\u5458",RoomOwner:"\u4E3B\u6301\u4EBA",More:"\u66F4\u591A","Raise hand":"\u4E3E\u624B",Agree:"\u540C\u610F",Chat:"\u804A\u5929",Cancel:"\u53D6\u6D88",Exit:"\u9000\u51FA\u5168\u5C4F","Full screen":"\u5168\u5C4F",Members:"\u6210\u5458","Search Member":"\u641C\u7D22\u6210\u5458","Transfer owner":"\u8F6C\u4EA4\u623F\u4E3B","Set as administrator":"\u8BBE\u4E3A\u7BA1\u7406\u5458","Revoke administrator":"\u64A4\u9500\u7BA1\u7406\u5458","The administrator status of sb has been withdrawn":({named:f})=>`\u5DF2\u5C06 ${f("name")} \u7684\u7BA1\u7406\u5458\u8EAB\u4EFD\u64A4\u56DE`,"sb has been set as administrator":({named:f})=>`\u5DF2\u5C06 ${f("name")} \u8BBE\u4E3A\u7BA1\u7406\u5458`,"You have been invited by the administrator to step down, please raise your hand if you need to speak":"\u60A8\u5DF2\u88AB\u7BA1\u7406\u5458\u9080\u8BF7\u4E0B\u53F0\uFF0C\u9700\u8981\u53D1\u8A00\u8BF7\u5148\u4E3E\u624B",Invite:"\u9080\u8BF7",Settings:"\u8BBE\u7F6E",EndPC:"\u7ED3\u675F\u623F\u95F4",EndH5:"\u7ED3\u675F",Tips:"\u63D0\u793A",'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.':"\u60A8\u5F53\u524D\u662F\u623F\u95F4\u4E3B\u6301\u4EBA\uFF0C\u8BF7\u9009\u62E9\u76F8\u5E94\u64CD\u4F5C\u3002\u82E5\u9009\u62E9\u201C\u7ED3\u675F\u623F\u95F4\u201D\uFF0C\u5C06\u89E3\u6563\u5F53\u524D\u623F\u95F4\u5E76\u5C06\u5168\u4F53\u6210\u5458\u79FB\u51FA\u3002\u82E5\u9009\u62E9\u201C\u79BB\u5F00\u623F\u95F4\u201D\uFF0C\u5F53\u524D\u623F\u95F4\u4E0D\u4F1A\u89E3\u6563\uFF0C\u60A8\u7684\u4E3B\u6301\u4EBA\u6743\u9650\u5C06\u79FB\u4EA4\u7ED9\u5176\u4ED6\u6210\u5458\u3002",'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.':"\u60A8\u5F53\u524D\u662F\u623F\u95F4\u4E3B\u6301\u4EBA\uFF0C\u8BF7\u9009\u62E9\u76F8\u5E94\u64CD\u4F5C\u3002\u82E5\u9009\u62E9\u201C\u7ED3\u675F\u623F\u95F4\u201D\uFF0C\u5C06\u89E3\u6563\u5F53\u524D\u623F\u95F4\u5E76\u5C06\u5168\u4F53\u6210\u5458\u79FB\u51FA\u3002","If you do not want to end the meeting, please designate a new host before leaving the meeting.":"\u5982\u679C\u60A8\u4E0D\u60F3\u7ED3\u675F\u4F1A\u8BAE\uFF0C\u8BF7\u5728\u79BB\u5F00\u4F1A\u8BAE\u524D\u6307\u5B9A\u65B0\u7684\u4E3B\u6301\u4EBA\u3002","Are you sure you want to leave this room?":"\u786E\u5B9A\u79BB\u5F00\u623F\u95F4\u5417\uFF1F","New host":"\u9009\u62E9\u4E3B\u6301\u4EBA","Transfer and leave":"\u79FB\u4EA4\u5E76\u79BB\u5F00","Leave room?":"\u662F\u5426\u8981\u79BB\u5F00\u623F\u95F4","Select a new host":"\u8BF7\u9009\u62E9\u65B0\u7684\u623F\u95F4\u4E3B\u6301\u4EBA","Appoint a new host":"\u6307\u5B9A\u4E00\u4F4D\u65B0\u7684\u4E3B\u6301\u4EBA","The host closed the room.":"\u4E3B\u6301\u4EBA\u7ED3\u675F\u4F1A\u8BAE\uFF0C\u5DF2\u89E3\u6563\u623F\u95F4",Note:"\u901A\u77E5",Confirm:"\u786E\u8BA4",Leave:"\u79BB\u5F00\u623F\u95F4",Dismiss:"\u7ED3\u675F\u623F\u95F4","The administrator has been changed to ":"\u7BA1\u7406\u5458\u5DF2\u53D8\u66F4\u4E3A","Muted by the moderator":"\u5DF2\u88AB\u4E3B\u6301\u4EBA\u7981\u8A00","Type a message":"\u8BF4\u70B9\u4EC0\u4E48...",Send:"\u53D1\u9001","Failed to send the message":"\u53D1\u9001\u6D88\u606F\u5931\u8D25","Applying for the stage":"\u6B63\u5728\u7533\u8BF7\u4E0A\u53F0","Apply for the stage":"\u7533\u8BF7\u4E0A\u53F0","Cancel Apply":"\u53D6\u6D88\u7533\u8BF7","Are you sure you want to step down":"\u786E\u5B9A\u8981\u4E0B\u53F0\u5417",Check:"\u67E5\u770B",Neglect:"\u5FFD\u7565","Disable all audios":"\u5168\u4F53\u9759\u97F3","Enable all audios":"\u89E3\u9664\u5168\u4F53\u9759\u97F3","Disable all videos":"\u5168\u4F53\u9759\u753B","Enable all videos":"\u89E3\u9664\u5168\u4F53\u9759\u753B","All mute":"\u5168\u4F53\u9759\u97F3","All current and new members will be muted":"\u6240\u6709\u53CA\u65B0\u52A0\u5165\u7684\u6210\u5458\u5C06\u88AB\u9759\u97F3","All and new members will be banned from the camera":"\u6240\u6709\u53CA\u65B0\u52A0\u5165\u7684\u6210\u5458\u5C06\u88AB\u7981\u6B62\u89C6\u9891","All stop video":"\u5168\u4F53\u7981\u753B","Lift all mute":"\u53D6\u6D88\u5168\u4F53\u9759\u97F3","Lift stop all video":"\u53D6\u6D88\u5168\u4F53\u7981\u753B","No relevant user found.":"\u672A\u627E\u5230\u76F8\u5173\u7528\u6237","Member List":"\u6210\u5458\u5217\u8868",Unmute:"\u89E3\u9664\u9759\u97F3","Cancel Unmute":"\u53D6\u6D88\u89E3\u9664\u7981\u8A00",Mute:"\u9759\u97F3",members:"\u4EBA","Failed to get chat message":"\u83B7\u53D6\u804A\u5929\u6D88\u606F\u5931\u8D25","Agree to the stage":"\u540C\u610F\u4E0A\u53F0","Take the stage now":"\u7ACB\u5373\u4E0A\u53F0","Stay off the stage":"\u6682\u4E0D\u4E0A\u53F0","Cancel stage":"\u53D6\u6D88\u9080\u8BF7\u4E0A\u53F0","Invite stage":"\u9080\u8BF7\u4E0A\u53F0","Refuse stage":"\u62D2\u7EDD\u4E0A\u53F0","Members applying on stage":"\u6210\u5458\u4E0A\u53F0\u7533\u8BF7","Enable video":"\u8BF7\u6C42\u5F00\u542F\u89C6\u9891","Cancel Enable video":"\u53D6\u6D88\u89E3\u9664\u7981\u753B","Disable video":"\u5173\u95ED\u89C6\u9891","Enable chat":"\u89E3\u9664\u7981\u8A00","Disable chat":"\u7981\u8A00","Kick out":"\u8E22\u51FA\u623F\u95F4","is sharing their screen":"\u7684\u5C4F\u5E55\u5206\u4EAB","Apply to stage":"\u4E0A\u53F0\u7533\u8BF7","Apply to stage application":"\u8BF7\u6C42\u4E0A\u53F0\u7533\u8BF7","Member Onstage Application":"\u6210\u5458\u4E0A\u53F0\u7533\u8BF7",Reject:"\u62D2\u7EDD","Reject All":"\u5168\u90E8\u62D2\u7EDD","Agree All":"\u5168\u90E8\u540C\u610F","Please raise your hand to apply":"\u5982\u679C\u60A8\u60F3\u53D1\u8A00\u8BF7\u5148\u4E3E\u624B\u7533\u8BF7\u4E0A\u9EA6","You can turn on the microphone and camera once you are on stage":"\u4E0A\u53F0\u540E\u53EF\u4EE5\u6253\u5F00\u9EA6\u514B\u98CE\u548C\u6444\u50CF\u5934","Sb invites you to speak on stage":({named:f})=>`${f("role")}\u9080\u8BF7\u60A8\u4E0A\u53F0\u53D1\u8A00`,"After agreeing to go on stage, you can turn on the camera and microphone. Do you agree to go on stage?":"\u540C\u610F\u4E0A\u53F0\u540E\u53EF\u6253\u5F00\u6444\u50CF\u5934\u548C\u9EA6\u514B\u98CE\uFF0C\u662F\u5426\u540C\u610F\u4E0A\u53F0\uFF1F","Hand down":"\u624B\u653E\u4E0B","Step down(Master)":"\u9080\u8BF7\u4E0B\u53F0","Step down":"\u4E0B\u53F0","sb has rejected your application for the stage":({named:f})=>`${f("role")}\u62D2\u7EDD\u4E86\u4F60\u7684\u4E0A\u53F0\u7533\u8BF7`,"You have been invited by the host to step down, please raise your hand if you need to speak":"\u60A8\u5DF2\u88AB\u4E3B\u6301\u4EBA\u9080\u8BF7\u4E0B\u53F0\uFF0C\u9700\u8981\u53D1\u8A00\u8BF7\u5148\u4E3E\u624B","Select a screen/window":"\u9009\u62E9\u5C4F\u5E55/\u7A97\u53E3",Screen:"\u5C4F\u5E55",Window:"\u7A97\u53E3",Share:"\u5F00\u59CB\u5206\u4EAB","Safety Reminder":"\u5B89\u5168\u63D0\u9192","Continue sharing":"\u7EE7\u7EED\u5171\u4EAB","Select a screen or window first":"\u8BF7\u9009\u62E9\u8981\u5206\u4EAB\u7684\u5C4F\u5E55\u6216\u8005\u7A97\u53E3",Grid:"\u4E00\u5C4F\u4E5D\u7B49\u5206","Gallery on right":"\u53F3\u4FA7\u6210\u5458\u5217\u8868","Gallery at top":"\u9876\u90E8\u6210\u5458\u5217\u8868","Network ":"\u7F51\u7EDC",Latency:"\u5EF6\u8FDF",Stability:"\u7A33\u5B9A",Fluctuation:"\u6CE2\u52A8",Lag:"\u5361\u987F",Disconnected:"\u5DF2\u65AD\u5F00","Packet loss":"\u4E22\u5305\u7387","Share the room ID or invite link":"\u60A8\u53EF\u4EE5\u901A\u8FC7\u590D\u5236\u623F\u95F4\u53F7\u6216\u8005\u9080\u8BF7\u94FE\u63A5\u7684\u65B9\u5F0F\u9080\u8BF7\u66F4\u591A\u4EBA\u52A0\u5165\u623F\u95F4","Invite by room number":"\u901A\u8FC7\u623F\u95F4\u53F7\u9080\u8BF7","Invite via room link":"\u901A\u8FC7\u623F\u95F4\u94FE\u63A5\u9080\u8BF7","Room Link":"\u623F\u95F4\u94FE\u63A5","You can share the room number or link to invite more people to join the room.":"\u60A8\u53EF\u4EE5\u5206\u4EAB\u623F\u95F4\u53F7\u6216\u94FE\u63A5\u9080\u8BF7\u66F4\u591A\u4EBA\u52A0\u5165\u623F\u95F4\u3002","You can share the room number to invite more people to join the room":"\u60A8\u53EF\u4EE5\u5206\u4EAB\u623F\u95F4\u53F7\u9080\u8BF7\u66F4\u591A\u4EBA\u52A0\u5165\u623F\u95F4","If you have any questions, please feel free to join our QQ group or send an email":"\u5982\u679C\u6709\u4EFB\u4F55\u95EE\u9898\u6B22\u8FCE\u52A0\u5165\u6211\u4EEC\u7684QQ\u7FA4\u6216\u8005\u53D1\u9001\u90AE\u4EF6\u3002","If you have any questions, please email us.":"\u5982\u679C\u6709\u4EFB\u4F55\u95EE\u9898\u6B22\u8FCE\u52A0\u5165\u6211\u4EEC\u7684\u4EA4\u6D41\u7FA4\u6216\u8005\u53D1\u9001\u90AE\u4EF6\u3002","Join our product discussion group":"\u52A0\u5165\u4EA7\u54C1\u4EA4\u6D41\u7FA4","Our email address":"\u6211\u4EEC\u7684\u90AE\u4EF6\u5730\u5740","Join now":"\u7ACB\u5373\u52A0\u5165","Room QR code":"\u623F\u95F4\u4E8C\u7EF4\u7801","Search for conference attendees":"\u641C\u7D22\u53C2\u4F1A\u6210\u5458","Invite via client scheme":"\u901A\u8FC7\u5BA2\u6237\u7AEF scheme \u9080\u8BF7","Contact us":"\u8054\u7CFB\u6211\u4EEC","Member management":"\u6210\u5458\u7BA1\u7406","Grid view":"\u5BAB\u683C\u89C6\u56FE","Join our QQ group chat or email us.":"\u5982\u679C\u6709\u4EFB\u4F55\u95EE\u9898\u6B22\u8FCE\u52A0\u5165\u6211\u4EEC\u7684QQ\u7FA4\u6216\u8005\u53D1\u9001\u90AE\u4EF6","group chat":"QQ \u7FA4",Email:"\u90AE\u7BB1\u5730\u5740","Audio settings":"\u58F0\u97F3\u8BBE\u7F6E","Camera settings":"\u6444\u50CF\u5934\u8BBE\u7F6E",Copy:"\u590D\u5236","Copied successfully":"\u590D\u5236\u6210\u529F","accepted the invitation to the stage":"\u63A5\u53D7\u4E86\u4E0A\u53F0\u9080\u8BF7","declined the invitation to the stage":"\u62D2\u7EDD\u4E86\u4E0A\u53F0\u9080\u8BF7","All audios disabled":"\u5DF2\u5F00\u542F\u5168\u4F53\u9759\u97F3","All audios enabled":"\u5DF2\u89E3\u9664\u5168\u4F53\u9759\u97F3","Your microphone has been turned off":"\u5DF2\u5173\u95ED\u60A8\u7684\u9EA6\u514B\u98CE","Sb invites you to turn on the microphone":({named:f})=>`${f("role")}\u9080\u8BF7\u4F60\u6253\u5F00\u9EA6\u514B\u98CE`,"All videos disabled":"\u5DF2\u5F00\u542F\u5168\u4F53\u7981\u753B","All videos enabled":"\u5DF2\u89E3\u9664\u5168\u4F53\u7981\u753B","Disabling text chat for all is enabled":"\u5DF2\u5F00\u542F\u5168\u4F53\u7981\u6B62\u6587\u5B57\u804A\u5929","Unblocked all text chat":"\u5DF2\u89E3\u9664\u5168\u4F53\u7981\u6B62\u6587\u5B57\u804A\u5929","Your camera has been turned off":"\u5DF2\u5173\u95ED\u60A8\u7684\u6444\u50CF\u5934","Sb invites you to turn on the camera":({named:f})=>`${f("role")}\u9080\u8BF7\u4F60\u6253\u5F00\u6444\u50CF\u5934`,"The host has turned off your screen sharing":"\u4E3B\u6301\u4EBA\u5DF2\u5173\u95ED\u60A8\u7684\u5C4F\u5E55\u5206\u4EAB","Turn on the camera":"\u6253\u5F00\u6444\u50CF\u5934","Keep it closed":"\u4FDD\u6301\u5173\u95ED","You have been banned from text chat":"\u60A8\u88AB\u7981\u6B62\u6587\u5B57\u804A\u5929","You are allowed to text chat":"\u60A8\u88AB\u5141\u8BB8\u6587\u5B57\u804A\u5929","kicked out of the room by the host":"\u88AB\u4E3B\u6301\u4EBA\u8E22\u51FA\u623F\u95F4","kicked out of the room by other device":"\u76F8\u540C\u8D26\u53F7\u5728\u5176\u4ED6\u5BA2\u6237\u7AEF\u8FDB\u5165\u623F\u95F4","kicked out of the room by serve":"\u88AB\u670D\u52A1\u7AEF\u8E22\u51FA\u623F\u95F4","Reject on Stage failed, please retry":({named:f})=>`\u62D2\u7EDD ${f("name")} \u4E0A\u53F0\u5931\u8D25, \u8BF7\u91CD\u8BD5`,"Agree on Stage failed, please retry":({named:f})=>`\u540C\u610F ${f("name")} \u4E0A\u53F0\u5931\u8D25, \u8BF7\u91CD\u8BD5`,"Has been fully muted and cannot open the microphone":"\u5DF2\u88AB\u5168\u5458\u9759\u97F3\uFF0C\u65E0\u6CD5\u6253\u5F00\u9EA6\u514B\u98CE","Has been muted by the host and cannot open the microphone":"\u5DF2\u88AB\u4E3B\u6301\u4EBA\u9759\u97F3\uFF0C\u65E0\u6CD5\u6253\u5F00\u9EA6\u514B\u98CE","To apply to speak in the room, please raise your hand first to apply for the microphone":"\u7533\u8BF7\u53D1\u8A00\u623F\u95F4\uFF0C\u8BF7\u5148\u4E3E\u624B\u7533\u8BF7\u4E0A\u9EA6","Has been full static painting, can not open the video":"\u5DF2\u88AB\u5168\u5458\u9759\u753B\uFF0C\u65E0\u6CD5\u6253\u5F00\u89C6\u9891","It has been stilled by the host and cannot open the video":"\u5DF2\u88AB\u4E3B\u6301\u4EBA\u9759\u753B\uFF0C\u65E0\u6CD5\u6253\u5F00\u89C6\u9891","Failed to enter the room.":"\u8FDB\u5165\u623F\u95F4\u5931\u8D25\uFF01","Has been full static painting, can not share your screen":"\u5DF2\u88AB\u5168\u5458\u9759\u753B\uFF0C\u65E0\u6CD5\u6253\u5F00\u5C4F\u5E55\u5206\u4EAB","Microphone not detected on current device":"\u5F53\u524D\u8BBE\u5907\u672A\u68C0\u6D4B\u5230\u9EA6\u514B\u98CE","Camera not detected on current device":"\u5F53\u524D\u8BBE\u5907\u672A\u68C0\u6D4B\u5230\u6444\u50CF\u5934","Camera And Microphone not detected on current device":"\u5F53\u524D\u8BBE\u5907\u672A\u68C0\u6D4B\u5230\u6444\u50CF\u5934\u548C\u9EA6\u514B\u98CE","Another user is currently sharing the screen, screen sharing is not possible.":"\u5F53\u524D\u6709\u5176\u4ED6\u7528\u6237\u6B63\u5728\u5C4F\u5E55\u5171\u4EAB\uFF0C\u65E0\u6CD5\u8FDB\u884C\u5C4F\u5E55\u5171\u4EAB","This action causes the room to be exited, does it continue?":"\u8BE5\u64CD\u4F5C\u4F1A\u5BFC\u81F4\u9000\u51FA\u623F\u95F4\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F","This action causes the room to be disbanded, does it continue?":"\u8BE5\u64CD\u4F5C\u4F1A\u5BFC\u81F4\u89E3\u6563\u623F\u95F4\uFF0C\u662F\u5426\u7EE7\u7EED\uFF1F","Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.":"\u5171\u4EAB\u5C4F\u5E55\u65F6\u53EF\u80FD\u4F1A\u6CC4\u9732\u77ED\u4FE1\u9A8C\u8BC1\u7801\u3001\u5BC6\u7801\u7B49\u9690\u79C1\u4FE1\u606F\uFF0C\u9020\u6210\u8D22\u4EA7\u635F\u5931\uFF0C\u8BF7\u8B66\u60D5\u5404\u79CD\u8BC8\u9A97\u884C\u4E3A","Please enter the room number":"\u8BF7\u8F93\u5165\u623F\u95F4\u53F7","The current browser does not support capturing audio and video":"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u91C7\u96C6\u97F3\u9891\u548C\u89C6\u9891","The current browser does not support getting microphone and camera list":"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u83B7\u53D6\u9EA6\u514B\u98CE\u548C\u6444\u50CF\u5934\u5217\u8868","The current browser does not support screen sharing":"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u5C4F\u5E55\u5206\u4EAB","The current browser does not support capturing audio":"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u91C7\u96C6\u97F3\u9891","The current browser does not support capturing video":"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u91C7\u96C6\u89C6\u9891","The current browser does not support audio and video communication capabilities":"\u5F53\u524D\u6D4F\u89C8\u5668\u4E0D\u652F\u6301\u97F3\u89C6\u9891\u901A\u4FE1\u80FD\u529B","whether to kick sb off the room":({named:f})=>`\u662F\u5426\u5C06 ${f("name")} \u79FB\u51FA\u623F\u95F4`,"An invitation to open the microphone has been sent to sb.":({named:f})=>`\u5DF2\u5411 ${f("name")} \u53D1\u51FA\u5F00\u542F\u9EA6\u514B\u98CE\u9080\u8BF7`,"An invitation to open the camera has been sent to sb.":({named:f})=>`\u5DF2\u5411 ${f("name")} \u53D1\u51FA\u5F00\u542F\u6444\u50CF\u5934\u9080\u8BF7`,"Transfer owner failed, please try again.":"\u8F6C\u4EA4\u623F\u4E3B\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5","Sb has been set as an administrator":({named:f})=>`\u5DF2\u5C06 ${f("name")} \u8BBE\u4E3A\u7BA1\u7406\u5458`,"Succeed on stage":"\u4E0A\u53F0\u6210\u529F","After unlocking, users can freely turn on the microphone":"\u89E3\u9664\u540E\u7528\u6237\u53EF\u4EE5\u81EA\u7531\u5F00\u542F\u9EA6\u514B\u98CE","Members will not be able to open the microphone":"\u6210\u5458\u5C06\u65E0\u6CD5\u5F00\u542F\u9EA6\u514B\u98CE","After unlocking, users can freely turn on the camera":"\u89E3\u9664\u540E\u7528\u6237\u53EF\u4EE5\u81EA\u7531\u5F00\u542F\u89C6\u9891","Members will not be able to open the camera":"\u6210\u5458\u5C06\u65E0\u6CD5\u5F00\u542F\u89C6\u9891\u753B\u9762","You have become a administrator":"\u60A8\u5DF2\u6210\u4E3A\u7BA1\u7406\u5458","You are now a room owner":"\u60A8\u5DF2\u6210\u4E3A\u623F\u4E3B","Your administrator status has been revoked":"\u60A8\u7684\u7BA1\u7406\u5458\u8EAB\u4EFD\u88AB\u6536\u56DE","After transfer the room owner, you will become a general user":"\u8F6C\u4EA4\u623F\u4E3B\u540E\u5C06\u6210\u4E3A\u666E\u901A\u6210\u5458","Transfer the roomOwner to sb":({named:f})=>`\u5C06\u623F\u4E3B\u8F6C\u79FB\u7ED9${f("name")}`,"Confirm transfer":"\u786E\u8BA4\u8F6C\u4EA4","The room owner has been transferred to sb":({named:f})=>`\u5DF2\u5C06\u623F\u4E3B\u8F6C\u4EA4\u7ED9${f("name")}`,"Application to go on stage was rejected":"\u4E0A\u53F0\u7533\u8BF7\u88AB\u62D2\u7EDD","You are now an administrator":"\u60A8\u5DF2\u6210\u4E3A\u7BA1\u7406\u5458","The RoomOwner has withdrawn your administrator privileges":"\u623F\u4E3B\u5DF2\u6536\u56DE\u60A8\u7684\u7BA1\u7406\u5458\u6743\u9650","This member has already received the same request, please try again later":"\u8BE5\u6210\u5458\u5DF2\u6536\u5230\u76F8\u540C\u8BF7\u6C42\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5","Failed to go on stage, invitation has timed out":"\u4E0A\u53F0\u5931\u8D25\uFF0C\u9080\u8BF7\u5DF2\u8D85\u65F6","The current number of people on stage has reached the limit":"\u5F53\u524D\u4E0A\u53F0\u4EBA\u6570\u5DF2\u8FBE\u4E0A\u9650","The invitation to sb to go on stage has timed out":({named:f})=>`\u5BF9${f("name")}\u7684\u4E0A\u53F0\u9080\u8BF7\u5DF2\u8D85\u65F6`,"Currently no member has applied to go on stage":"\u6682\u65E0\u6210\u5458\u7533\u8BF7\u4E0A\u53F0",Operate:"\u64CD\u4F5C","Stage management":"\u4E0A\u53F0\u7BA1\u7406","Already on stage":"\u5DF2\u4E0A\u53F0","Not on stage":"\u672A\u4E0A\u53F0","To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve":"\u518D\u6B21\u4E0A\u53F0\u9700\u91CD\u65B0\u53D1\u8D77\u7533\u8BF7\uFF0C\u5E76\u7B49\u5F85\u623F\u4E3B/\u7BA1\u7406\u5458\u901A\u8FC7","To go on stage again, a new application needs to be initiated":"\u518D\u6B21\u4E0A\u53F0\u9700\u91CD\u65B0\u53D1\u8D77\u7533\u8BF7","The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it":"\u4E0A\u53F0\u7533\u8BF7\u5DF2\u53D1\u51FA\uFF0C\u8BF7\u7B49\u5F85\u623F\u4E3B/\u7BA1\u7406\u5458\u901A\u8FC7","Cancellation request has been sent, please wait for the roomOwner/administrator to approve it":"\u53D6\u6D88\u4E0A\u53F0\u7533\u8BF7\u5DF2\u53D1\u51FA\uFF0C\u8BF7\u7B49\u5F85\u623F\u4E3B/\u7BA1\u7406\u5458\u901A\u8FC7","Canceled application to go on stage":"\u5DF2\u53D6\u6D88\u4E0A\u53F0\u7533\u8BF7","and so on":"\u7B49","people applying to stage":"\u4EBA\u6B63\u5728\u7533\u8BF7\u4E0A\u53F0","and so on number people applying to stage":({named:f})=>`\u7B49 ${f("number")} \u4EBA\u6B63\u5728\u7533\u8BF7\u4E0A\u53F0`,"quick meeting":"\u5FEB\u901F\u4F1A\u8BAE",Meeting:"\u4F1A\u8BAE","Meeting in progress":"\u4F1A\u8BAE \u8FDB\u884C\u4E2D",Initiating:"\u6B63\u5728\u53D1\u8D77","X people have joined":({values:f})=>`${f==null?void 0:f.number} \u4EBA\u5DF2\u5165\u4F1A`,"Waiting for members to join the meeting":"\u7B49\u5F85\u6210\u5458\u5165\u4F1A","X people are in the meeting":({values:f})=>`${f==null?void 0:f.number} \u4EBA\u5728\u4F1A\u8BAE\u4E2D`,"Already joined":"\u5DF2\u5165\u4F1A","Enter the meeting":"\u8FDB\u5165\u4F1A\u8BAE","Ending meeting":"\u6B63\u5728\u7ED3\u675F\u4F1A\u8BAE","The meeting has ended":"\u4F1A\u8BAE\u5DF2\u7ED3\u675F","Currently in a meeting, please exit the current meeting before proceeding.":"\u6B63\u5728\u4F1A\u8BAE\u4E2D\uFF0C\u8BF7\u5148\u9000\u51FA\u5F53\u524D\u4F1A\u8BAE\u540E\u518D\u8FDB\u884C\u64CD\u4F5C","Failed to initiate meeting":"\u53D1\u8D77\u4F1A\u8BAE\u5931\u8D25","Failed to enter the meeting":"\u8FDB\u5165\u4F1A\u8BAE\u5931\u8D25"},Bh={"":"","Sign in":"Sign in","Phone Login":"Phone Login","Email Login":"Email Login","I have read and agree to the":"I have read and agree to the","Privacy Policy":"Privacy Policy",and:"and","Terms of Use":"Terms of Use",Login:"Login","Mobile number":"Mobile number","Verification code":"Verification code","Email address":"Email address","Please enter a valid phone number!":"Please enter a valid phone number!","Please enter a valid email address!":"Please enter a valid email address!","Please enter your phone number!":"Please enter your phone number!","Please enter your email address!":"Please enter your email address!","Please enter the verification code!":"Please enter the verification code!","Please accept the privacy policy and user agreement!":"Please accept the privacy policy and user agreement!","Incorrect verification code, please check the code!":"Incorrect verification code, please check the code!","The verification code has expired, please retrieve a new one!":"The verification code has expired, please retrieve a new one!","The verification code has been used, please retrieve a new one!":"The verification code has been used, please retrieve a new one!","Login failed, please try again.":"Login failed, please try again.",SEND:"SEND"," ":" ","The room does not exist, please confirm the room number or create a room!":"The room does not exist, please confirm the room number or create a room!","Log out":"Log out","Edit profile":"Edit profile","User Name":"User Name","Please input user name":"Please input user name","Username length should be greater than 0":"Username length should be greater than 0",Save:"Save",Camera:"Camera",Mic:"Mic","Off Camera":"Off Camera","Mic settings":"Mic settings",Output:"Output",Speaker:"Speaker",Test:"Test",Stop:"Stop",Preview:"Preview",Mirror:"Mirror",Resolution:"Resolution","More Camera Settings":"More Camera Settings","Join the room ?":"Join the room ?","You are invited to room ":"You are invited to room ",Room:"Room",Join:"Join",Sure:"Sure","Switch Theme":"Switch Theme",Layout:"Layout","New Room":"New Room","Room Type":"Room Type","Your Name":"Your Name","Grid view":"Grid view","Speaker view":"Speaker view","Turn on the microphone":"Turn on the microphone","Turn on the speaker":"Turn on the speaker","Turn on the video":"Turn on the video","Free Speech Room":"Free Speech Room","On-stage Speaking Room":"On-stage Speaking Room","Join Room":"Join Room","Enter room ID":"Enter room ID","video conferencing":" 's video conferencing","Quick Meeting":" 's Quick Meeting","Room ID":"Room ID","Low Definition":"Low Definition","Standard Definition":"Standard Definition","High Definition":"High Definition","Super Definition":"Super Definition","End sharing":"End sharing","Stop sharing?":"Stop sharing?","Stop sharing":"Stop sharing","You are sharing the screen...":"You are sharing the screen...",Sharing:"Sharing","Safety Reminder":"Safety Reminder","Share screen":"Share screen","Grant permission to screen recording":"Grant permission to screen recording","Open the system preferences settings":"Open the system preferences settings",'Due to macOS 10.15 system requirements, please check the current application in "System Preferences - Security & Privacy - Screen Recording".':'Due to macOS 10.15 system requirements, please check the current application in "System Preferences - Security & Privacy - Screen Recording".',"Others will no longer see your screen after you stop sharing. Are you sure you want to stop?":"Others will no longer see your screen after you stop sharing. Are you sure you want to stop?","Others will no longer see your screen after you stop sharing.":"Others will no longer see your screen after you stop sharing.","You currently do not have sharing permission, please raise your hand to apply for sharing permission first":"You currently do not have sharing permission, please raise your hand to apply for sharing permission first",Host:"Host",Admin:"Admin",RoomOwner:"RoomOwner",Me:"Me",me:"me",More:"More","Raise hand":"Raise hand",Agree:"Agree",Chat:"Chat",Cancel:"Cancel",Exit:"Exit full screen","Full screen":"Full screen",Members:"Members","Search Member":"Search Member","Transfer owner":"Transfer owner","Set as administrator":"Set as administrator","Revoke administrator":"Revoke administrator","The administrator status of sb has been withdrawn":({named:f})=>`The administrator status of ${f("name")} has been withdrawn`,"sb has been set as administrator":({named:f})=>`${f("name")} has been set as administrator`,"You have been invited by the administrator to step down, please raise your hand if you need to speak":"You have been invited by the administrator to step down, please raise your hand if you need to speak",Invite:"Invite",Settings:"Settings",EndPC:"End",EndH5:"End",'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.':'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.','You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.':'You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.',"If you do not want to end the meeting, please designate a new host before leaving the meeting.":"If you do not want to end the meeting, please designate a new host before leaving the meeting.","Are you sure you want to leave this room?":"Are you sure you want to leave this room?","New host":"New host","Transfer and leave":"Transfer and leave","Leave room?":"Leave room?","Select a new host":"Select a new host","Appoint a new host":"Appoint a new host","The host closed the room.":"The host closed the room.",Note:"Note",Confirm:"Confirm",Leave:"Leave",Dismiss:"Dismiss","The administrator has been changed to ":"The administrator has been changed to ","Muted by the moderator":"Muted by the moderator","Type a message":"Type a message",Send:"Send","Failed to send the message":"Failed to send the message","Applying for the stage":"Applying for the stage","Apply for the stage":"Apply for the stage","Cancel Apply":"Cancel Apply","Are you sure you want to step down":"Are you sure you want to step down",Check:"Check",Neglect:"Neglect","Disable all audios":"Disable all audios","Enable all audios":"Enable all audios","Disable all videos":"Disable all videos","Enable all videos":"Enable all videos","Member List":"Member List","All mute":"All mute","All stop video":"All stop video","Lift all mute":"Lift all mute","Lift stop all video":"Lift stop all video",Unmute:"Unmute","Cancel Unmute":"Cancel Unmute",Mute:"Mute",members:"members","Failed to get chat message":"Failed to get chat message","Agree to the stage":"Agree to the stage","Take the stage now":"Take the stage now","Stay off the stage":"Stay off the stage","Cancel stage":"Cancel stage","Invite stage":"Invite stage","Refuse stage":"Refuse stage","Members applying on stage":"Members applying on stage","Step down":"Step down","Step down(Master)":"Step down","Enable video":"Enable video","Disable video":"Disable video","Enable chat":"Enable chat","Disable chat":"Disable chat","Kick out":"Kick out","is sharing their screen":"is sharing their screen","Apply to stage":"Apply to stage","Apply to stage application":"Apply to stage application","Member Onstage Application":"Member Onstage Application",Reject:"Reject","Reject All":"Reject All","Agree All":"Agree All","Please raise your hand to apply":"Please raise your hand to apply","You can turn on the microphone and camera once you are on stage":"You can turn on the microphone and camera once you are on stage","Sb invites you to speak on stage":({named:f})=>`${f("role")} invites you to speak on stage`,"After agreeing to go on stage, you can turn on the camera and microphone. Do you agree to go on stage?":"After agreeing to go on stage, you can turn on the camera and microphone. Do you agree to go on stage?","Hand down":"Hand down","sb has rejected your application for the stage":({named:f})=>`${f("role")} has rejected your application for the stage`,"You have been invited by the host to step down, please raise your hand if you need to speak":"You have been invited by the host to step down, please raise your hand if you need to speak","If you have any questions, please email us.":"If you have any questions, please email us.","Join our product discussion group":"Join our product discussion group","Our email address":"Our email address","Join now":"Join now","Select a screen/window":"Select a screen/window",Screen:"Screen",Window:"Window",Share:"Share","Continue sharing":"Continue sharing","Select a screen or window first":"Select a screen or window first",Grid:"Grid",Tips:"Tips","Gallery on right":"Gallery on right","Gallery at top":"Gallery at top","Network ":"Network ",Latency:"Latency",Stability:"Stability",Fluctuation:"Fluctuation",Lag:"Lag",Disconnected:"Disconnected","Packet loss":"Packet loss","Share the room ID or invite link":"Share the room ID or invite link","Invite by room number":"Invite by room number","Invite via room link":"Invite via room link","Room Link":"Room Link","You can share the room number or link to invite more people to join the room.":"You can share the room number or link to invite more people to join the room.","You can share the room number to invite more people to join the room":"You can share the room number to invite more people to join the room","If you have any questions, please feel free to join our QQ group or send an email":"If you have any questions, please feel free to join our QQ group or send an email","Room QR code":"Room QR code","Search for conference attendees":"Search for conference attendees","Invite via client scheme":"Invite via client scheme","All current and new members will be muted":"All current and new members will be muted","All and new members will be banned from the camera":"All and new members will be banned from the camera","No relevant user found.":"No relevant user found.","Contact us":"Contact us","Member management":"Member management","Join our QQ group chat or email us.":"Join our QQ group chat or email us.","group chat":"group chat",Email:"Email","Audio settings":"Audio settings","Camera settings":"Camera settings",Copy:"Copy","Copied successfully":"Copied successfully","accepted the invitation to the stage":"accepted the invitation to the stage","declined the invitation to the stage":"declined the invitation to the stage","All audios disabled":"All audios disabled","All audios enabled":"All audios enabled","Your microphone has been turned off":"Your microphone has been turned off","Sb invites you to turn on the microphone":({named:f})=>`${f("role")} invites you to turn on the microphone`,"All videos disabled":"All videos disabled","All videos enabled":"All videos enabled","Disabling text chat for all is enabled":"Disabling text chat for all is enabled","Unblocked all text chat":"Unblocked all text chat","Your camera has been turned off":"Your camera has been turned off","Sb invites you to turn on the camera":({named:f})=>`${f("role")} invites you to turn on the camera`,"The host has turned off your screen sharing":"The host has turned off your screen sharing","Turn on the camera":"Turn on the camera","Keep it closed":"Keep it closed","You have been banned from text chat":"You have been banned from text chat","You are allowed to text chat":"You are allowed to text chat","kicked out of the room by the host":"kicked out of the room by the host","kicked out of the room by other device":"kicked out of the room by other device","kicked out of the room by serve":"kicked out of the room by serve","Reject on Stage failed, please retry":({named:f})=>`Reject ${f("name")} on Stage failed, please retry`,"Agree on Stage failed, please retry":({named:f})=>`Agree ${f("name")} on Stage failed, please retry`,"Has been fully muted and cannot open the microphone":"Has been fully muted and cannot open the microphone","Has been muted by the host and cannot open the microphone":"Has been muted by the host and cannot open the microphone","To apply to speak in the room, please raise your hand first to apply for the microphone":"To apply to speak in the room, please raise your hand first to apply for the microphone","Has been full static painting, can not open the video":"Has been full static painting, can not open the video","It has been stilled by the host and cannot open the video":"It has been stilled by the host and cannot open the video","Failed to enter the room.":"Failed to enter the room.","Has been full static painting, can not share your screen":"Has been full static painting, can not share your screen.","Microphone not detected on current device":"Microphone not detected on current device","Camera not detected on current device":"Camera not detected on current device","Camera And Microphone not detected on current device":"Camera And Microphone not detected on current device","Another user is currently sharing the screen, screen sharing is not possible.":"Another user is currently sharing the screen, screen sharing is not possible.","This action causes the room to be disbanded, does it continue?":"This action causes the room to be disbanded, does it continue?","This action causes the room to be exited, does it continue?":"This action causes the room to be exited, does it continue?","Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.":"Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.","Please enter the room number":"Please enter the room number","whether to kick sb off the room":({named:f})=>`whether to kick ${f("name")} off the room`,"The current browser does not support capturing audio and video":"The current browser does not support capturing audio and video","The current browser does not support getting microphone and camera list":"The current browser does not support getting audio/video device list","The current browser does not support screen sharing":"The current browser does not support screen sharing","The current browser does not support capturing audio":"The current browser does not support capture audio","The current browser does not support capturing video":"The current browser does not support capture video","The current browser does not support audio and video communication capabilities":"The current browser does not support audio and video communication capabilities","An invitation to open the microphone has been sent to sb.":({named:f})=>`An invitation to open the microphone has been sent to ${f("name")}`,"An invitation to open the camera has been sent to sb.":({named:f})=>`An invitation to open the camera has been sent to ${f("name")}`,"Transfer owner failed, please try again.":"Transfer owner failed, please try again.","Sb has been set as an administrator":({named:f})=>`${f("name")} has been set as an administrator.`,"Succeed on stage":"Succeed on stage","After unlocking, users can freely turn on the microphone":"After unlocking, users can freely turn on the microphone","Members will not be able to open the microphone":"Members will not be able to open the microphone","After unlocking, users can freely turn on the camera":"After unlocking, users can freely turn on the camera","Members will not be able to open the camera":"Members will not be able to open the camera","You have become a administrator":"You have become a administrator","You are now a room owner":"You are now a room owner","Your administrator status has been revoked":"Your administrator status has been revoked","After transfer the room owner, you will become a general user":"After transfer the room owner, you will become a general user","Transfer the roomOwner to sb":({named:f})=>`Transfer the roomOwner to ${f("name")}`,"Confirm transfer":"Confirm transfer","The room owner has been transferred to sb":({named:f})=>`The room owner has been transferred to ${f("name")}`,"Application to go on stage was rejected":"Application to go on stage was rejected","You are now an administrator":"You are now an administrator","The RoomOwner has withdrawn your administrator privileges":"The RoomOwner has withdrawn your administrator privileges","This member has already received the same request, please try again later":"This member has already received the same request, please try again later","Failed to go on stage, invitation has timed out":"Failed to go on stage, invitation has timed out","The current number of people on stage has reached the limit":"The current number of people on stage has reached the limit","The invitation to sb to go on stage has timed out":({named:f})=>`The invitation to ${f("name")} to go on stage has timed out`,"Currently no member has applied to go on stage":"Currently no member has applied to go on stage",Operate:"Operate","Stage management":"Stage management","Already on stage":"Already on stage","Not on stage":"Not on stage","To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve":"To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve","To go on stage again, a new application needs to be initiated":"To go on stage again, a new application needs to be initiated","The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it":"The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it","Cancellation request has been sent, please wait for the roomOwner/administrator to approve it":"Cancellation request has been sent, please wait for the roomOwner/administrator to approve it","Canceled application to go on stage":"Canceled application to go on stage","and so on":"and so on","people applying to stage":"people applying to stage","and so on number people applying to stage":({named:f})=>`and so on ${f("number")} people applying to stage`,"quick meeting":"quick meeting",Meeting:"Meeting","Meeting in progress":"Meeting in progress",Initiating:"Initiating","X people have joined":({values:f})=>`${f==null?void 0:f.number} people have joined`,"Waiting for members to join the meeting":"Waiting for members to join the meeting","X people are in the meeting":({values:f})=>`${f==null?void 0:f.number} people are in the meeting`,"Already joined":"Already joined","Enter the meeting":"Enter the meeting","Ending meeting":"Ending meeting","The meeting has ended":"The meeting has ended","Currently in a meeting, please exit the current meeting before proceeding.":"Currently in a meeting, please exit the current meeting before proceeding.","Failed to initiate meeting":"Failed to initiate meeting","Failed to enter the meeting":"Failed to enter the meeting"},np=(0,h.ref)(""),mp=class{constructor(g){this.messages=g.messages,np.value=g.locale,this.global={},this.global.locale=np,this.global.t=this.t.bind(this)}getNamed(g){return T=>g[T]||T}t(g,T){let v=this.messages[np.value];if(!v[g])return g;if(typeof v[g]=="function"){let w=this.getNamed(T||{});return v[g]({named:w})}return v[g]}install(){}},vp=new mp({locale:Bg()||"zh-CN",messages:{"zh-CN":Vh,"en-US":Bh}}),Pp=vp;function on(){return{t:vp.global.t.bind(vp)}}var Wg=(f=>(f.ON_CHANGE_LOG_LEVEL="onChangeLogLevel",f))(Wg||{}),La={LOG_LEVEL_DEBUG:-1,LOG_LEVEL_LOG:0,LOG_LEVEL_INFO:1,LOG_LEVEL_WARN:2,LOG_LEVEL_ERROR:3,LOG_LEVEL_NON_LOGGING:4},ka=(f=>(f.MAIN="main-process",f.RENDER="render-process",f))(ka||{});function Hh(f){let g=f.toString().length,T;switch(g){case 1:T=`00${f}`;break;case 2:T=`0${f}`;break;default:T=f;break}return T}function nr(f){let g=new Date;return`${g.toLocaleTimeString("en-US",{hour12:!1})}.${Hh(g.getMilliseconds())} [${f}]:`}var Ra=La.LOG_LEVEL_DEBUG,Kh={debug(...f){Ra<=La.LOG_LEVEL_DEBUG&&st("debug","at src/roomkit/TUIRoom/utils/common/logger/index.ts:14",`${nr(ka.RENDER)}`,...f)},log(...f){Ra<=La.LOG_LEVEL_LOG&&st("log","at src/roomkit/TUIRoom/utils/common/logger/index.ts:19",`${nr(ka.RENDER)}`,...f)},info(...f){Ra<=La.LOG_LEVEL_INFO&&st("info","at src/roomkit/TUIRoom/utils/common/logger/index.ts:24",`${nr(ka.RENDER)}`,...f)},warn(...f){Ra<=La.LOG_LEVEL_WARN&&st("warn","at src/roomkit/TUIRoom/utils/common/logger/index.ts:29",`${nr(ka.RENDER)}`,...f)},error(...f){Ra<=La.LOG_LEVEL_ERROR&&st("error","at src/roomkit/TUIRoom/utils/common/logger/index.ts:34",`${nr(ka.RENDER)}`,...f)},setLevel(f){var g;f>=La.LOG_LEVEL_DEBUG&&f<=La.LOG_LEVEL_NON_LOGGING?(st("log","at src/roomkit/TUIRoom/utils/common/logger/index.ts:42",`${nr(ka.RENDER)} set log level from ${Ra} to ${f}`),Ra=f,(g=window.electron)!=null&&g.ipcRenderer&&window.electron.ipcRenderer.send(Wg.ON_CHANGE_LOG_LEVEL,f)):st("error","at src/roomkit/TUIRoom/utils/common/logger/index.ts:57",`${nr(ka.RENDER)} logger.setLevel() invalid params:${f}`)},getLevel(){return Ra}},Qt=Kh,Wh=f=>{let{type:g="",message:T="",duration:v=2e3}=f;return uni.showToast({title:T,icon:Ro?"none":jh(g),image:"",duration:v,mask:!1})},jh=(f="")=>{switch(f){case"success":case"error":case"loading":return f;case"info":return"none";default:return"none"}},kt=Wh;function Yh(){let{t:f}=on(),g;(He=>{He[He.BasicDialog=0]="BasicDialog",He[He.TransferDialog=1]="TransferDialog"})(g||(g={}));let T=(0,h.ref)(0),v="[EndControl]",w=zn(),N=(0,h.ref)(!1),B=qt(),V=bp();Qt.log(`${v} basicStore:`,B);let H=Dn(),{localUser:z,remoteUserList:ne}=(0,Mt.storeToRefs)(H),ge=(0,h.computed)(()=>T.value===0?f("Leave room?"):f("Select a new host")),pe=(0,h.computed)(()=>H.isMaster&&ne.value.length>0||!H.isMaster),{isSidebarOpen:oe,sidebarName:de}=(0,Mt.storeToRefs)(B),ae=(0,h.computed)(()=>oe.value&&de.value==="transfer-leave"),te=(0,h.ref)(""),J=(0,h.ref)(!1),Le=(0,h.ref)(""),re=(0,h.computed)(()=>ne.value.filter(He=>{var ee;return He.userId.includes(Le.value)||((ee=He.userName)==null?void 0:ee.includes(Le.value))})),Be=(0,h.computed)(()=>re.value.length===0),Ye=(0,h.computed)(()=>ne.value.length===1),Xe=(0,h.computed)(()=>ne.value.length>0),Ne=(0,h.computed)(()=>H.isMaster&&ne.value.length===0),me=(0,h.computed)(()=>H.isMaster?f("EndPC"):f("Leave")),A=(0,h.computed)(()=>H.isMaster?Ne.value?f('You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed.'):f('You are currently the host of the room, please choose the corresponding operation. If you choose "End Room", the current room will be disbanded and all members will be removed. If you choose "Leave Room", the current room will not be disbanded, and your hosting privileges will be transferred to other members.'):f("Are you sure you want to leave this room?"));function Me(){if(B.setSidebarOpenStatus&&de.value==="transfer-leave"){B.setSidebarOpenStatus(!1),B.setSidebarName("");return}B.setSidebarOpenStatus(!0),B.setSidebarName("transfer-leave")}function O(He){te.value=He}function ze(){N.value=!1,T.value=0}function gn(){N.value||(N.value=!0)}function ct(){ze()}function pt(){var He,ee;z.value.hasAudioStream&&((He=w.instance)==null||He.closeLocalMicrophone()),z.value.hasVideoStream&&((ee=w.instance)==null||ee.closeLocalCamera())}let dt=He=>Oe(this,null,function*(){var ee,Qe,se;let{userId:Ue,userRole:At}=He.userInfo,qn=H.localUser.userId===Ue,nt=H.getUserRole(Ue);switch(qn?H.setLocalUser({userRole:At}):H.setRemoteUserRole(Ue,At),At){case Et.kGeneralUser:qn&&(H!=null&&H.isMicrophoneDisableForAllUser&&!H.localStream.hasAudioStream&&H.setCanControlSelfAudio(!1),H!=null&&H.isCameraDisableForAllUser&&!H.localStream.hasVideoStream&&H.setCanControlSelfVideo(!1),nt===Et.kAdministrator&&kt({type:"warning",message:f("Your administrator status has been revoked")}));break;case Et.kAdministrator:qn&&(kt({type:"success",message:f("You have become a administrator")}),H.setCanControlSelfAudio(!0),H.setCanControlSelfVideo(!0));break;case Et.kRoomOwner:{if(H.setMasterUserId(Ue),qn){if(kt({type:"success",message:`${f("You are now a room owner")}`}),H.isSpeakAfterTakingSeatMode){H.isAnchor||(yield(ee=w.instance)==null?void 0:ee.takeSeat({seatIndex:-1,timeout:0}));let Zt=yield(Qe=w.instance)==null?void 0:Qe.getSeatApplicationList();if(Zt)for(let wt of Zt){let{userId:sn,requestId:rn,timestamp:gt}=wt;H.addApplyToAnchorUser({userId:sn,requestId:rn,timestamp:gt})}}V.isMessageDisableByAdmin&&((se=w.instance)==null||se.disableSendingMessageByAdmin({userId:Ue,isDisable:!1}))}break}}});return rt.once("ready",()=>{var He;(He=w.instance)==null||He.on(it.onUserInfoChanged,dt)}),(0,h.onUnmounted)(()=>{var He;(He=w.instance)==null||He.off(it.onUserInfoChanged,dt)}),{t:f,basicStore:B,isShowLeaveRoomDialog:pe,roomStore:H,roomEngine:w,localUser:z,stopMeeting:gn,cancel:ct,selectedUser:te,showEndButtonContent:me,DialogType:g,showEndDialogContent:A,logPrefix:v,title:ge,currentDialogType:T,visible:N,closeMediaBeforeLeave:pt,resetState:ze,searchName:Le,hasNoData:Be,handleShowMemberControl:O,filteredList:re,toggleMangeMemberSidebar:Me,showTransfer:J,sidebarName:de,showSideBar:ae,isMasterWithOneRemoteUser:Ye,isMasterWithRemoteUser:Xe,remoteUserList:ne}}var zh=(0,h.defineComponent)({__name:"SvgIconFile",props:{size:{type:[String,Number]},responseSize:{type:[String,Number]},customClass:{type:String},icon:{type:String}},emits:["click"],setup(f,{emit:g}){let T=qt(),{defaultTheme:v}=(0,Mt.storeToRefs)(T),w=f,N=g,B=(0,h.getCurrentInstance)(),V=(0,h.ref)(),H=(0,h.ref)(),z=(0,h.ref)({width:"48rpx",height:"48rpx"}),ne=plus.io.convertLocalFileSystemURL(w.icon),ge=/.{3}$/;plus.io.resolveLocalFileSystemURL(ne,oe=>{oe.file(de=>{let ae=new plus.io.FileReader;ae.onloadend=function(te){let J=te.target.result,Le,re;/width="([0-9]+)"/.test(J)&&([,Le]=J.match(/width="([0-9]+)"/)),/height="([0-9]+)"/.test(J)&&([,re]=J.match(/height="([0-9]+)"/)),Le&&re&&!w.size&&(z.value.width=Al(Le),z.value.height=Al(re)),ne.match(ge)[0]==="svg"?H.value=`data:image/svg+xml,${encodeURIComponent(J)}`:H.value=w.icon},ae.readAsText(de)})}),(0,h.watch)(()=>w.size,oe=>{oe&&(z.value.width=Al(oe),z.value.height=Al(oe))}),(0,h.onMounted)(()=>{(0,h.watch)(v,()=>Oe(this,null,function*(){yield(0,h.nextTick)(),uni.createSelectorQuery().in(B).select(".svg-icon").fields({computedStyle:["color"]}).exec(de=>{de[0]&&de[0].color&&(V.value=de[0].color)})}),{immediate:!0})});function pe(oe){N("click",oe)}return(oe,de)=>((0,h.openBlock)(),(0,h.createElementBlock)("u-image",{src:H.value,style:(0,h.normalizeStyle)(z.value),onClick:pe},null,12,["src"]))}}),Jh={"svg-icon":{"":{overflow:"hidden",alignItems:"center",justifyContent:"center"}}},Dt=(f,g)=>{let T=f.__vccOpts||f;for(let[v,w]of g)T[v]=w;return T},$h=Dt(zh,[["styles",[Jh]]]),Xh={id:"4545427",name:"TUIRoomKit",font_family:"roomkiticons",css_prefix_text:"roomkit-icon-",description:"",glyphs:[{icon_id:"42361561",name:"EmojiIcon",font_class:"a-EmojiIcon111",unicode:"e60e",unicode_decimal:58894},{icon_id:"41176603",name:"StopScreenShareIcon",font_class:"jieshugongxiang",unicode:"e60a",unicode_decimal:58890},{icon_id:"40923006",name:"ScreenShareIcon",font_class:"ScreenShareIcon",unicode:"e601",unicode_decimal:58881},{icon_id:"40923008",name:"ScreenSharingIcon",font_class:"ScreenSharingIcon",unicode:"e603",unicode_decimal:58883},{icon_id:"40437582",name:"ApplyActiveIcon",font_class:"ApplyActiveIcon",unicode:"e67d",unicode_decimal:59005},{icon_id:"40437367",name:"ApplyTipsIcon",font_class:"ApplyTipsIcon",unicode:"e676",unicode_decimal:58998},{icon_id:"40437368",name:"DenyOnStageIcon",font_class:"DenyOnStageIcon1",unicode:"e677",unicode_decimal:58999},{icon_id:"40437369",name:"KickOutIcon",font_class:"KickOutIcon",unicode:"e679",unicode_decimal:59001},{icon_id:"40437370",name:"InviteOnStageIcon",font_class:"InviteOnStageIcon1",unicode:"e67a",unicode_decimal:59002},{icon_id:"40437371",name:"SearchIcon",font_class:"SearchIcon1",unicode:"e67b",unicode_decimal:59003},{icon_id:"40437372",name:"OffStageIcon",font_class:"OffStageIcon1",unicode:"e67c",unicode_decimal:59004},{icon_id:"40400095",name:"ScreenOpenIcon",font_class:"ScreenOpenIcon",unicode:"e669",unicode_decimal:58985},{icon_id:"40400018",name:"ChatIcon",font_class:"ChatIcon",unicode:"e678",unicode_decimal:59e3},{icon_id:"40399599",name:"CancelStageIcon",font_class:"CancelStageIcon1",unicode:"e675",unicode_decimal:58997},{icon_id:"40399573",name:"ApplyStageIcon",font_class:"ApplyStageIcon2",unicode:"e674",unicode_decimal:58996},{icon_id:"40398369",name:"TransferOwnerIcon",font_class:"TransferOwnerIcon",unicode:"e673",unicode_decimal:58995},{icon_id:"40397092",name:"SetAdminIcon",font_class:"SetAdminIcon",unicode:"e672",unicode_decimal:58994},{icon_id:"40373104",name:"CorrectIcon",font_class:"CorrectIcon",unicode:"e667",unicode_decimal:58983},{icon_id:"40373103",name:"CloseIcon",font_class:"CloseIcon",unicode:"e649",unicode_decimal:58953},{icon_id:"40373102",name:"CopyIcon",font_class:"CopyIcon",unicode:"e668",unicode_decimal:58984},{icon_id:"40373101",name:"ChatForbiddenIcon",font_class:"ChatForbiddenIcon",unicode:"e648",unicode_decimal:58952},{icon_id:"40373099",name:"CameraSwitchIcon",font_class:"CameraSwitchIcon",unicode:"e647",unicode_decimal:58951},{icon_id:"40373098",name:"CameraOnIcon",font_class:"CameraOnIcon1",unicode:"e646",unicode_decimal:58950},{icon_id:"40373097",name:"CameraOffIcon",font_class:"CameraOffIcon",unicode:"e66a",unicode_decimal:58986},{icon_id:"40373096",name:"AudioOpenIcon",font_class:"AudioOpenIcon",unicode:"e66b",unicode_decimal:58987},{icon_id:"40373095",name:"AudioCloseIcon",font_class:"AudioCloseIcon",unicode:"e645",unicode_decimal:58949},{icon_id:"40373094",name:"ArrowStrokeSelectDownIcon",font_class:"ArrowStrokeSelectDownIcon",unicode:"e644",unicode_decimal:58948},{icon_id:"40373092",name:"ArrowStrokeTurnPageIcon",font_class:"ArrowStrokeTurnPageIcon",unicode:"e66c",unicode_decimal:58988},{icon_id:"40373093",name:"ArrowUpIcon",font_class:"ArrowUpIcon",unicode:"e66d",unicode_decimal:58989},{icon_id:"40373091",name:"ArrowStrokeBackIcon",font_class:"ArrowStrokeBackIcon",unicode:"e643",unicode_decimal:58947},{icon_id:"40373090",name:"ArrowStrokeLeftIcon",font_class:"ArrowStrokeLeftIcon",unicode:"e66e",unicode_decimal:58990},{icon_id:"40373087",name:"ApplyManageIcon",font_class:"ApplyManageIcon",unicode:"e66f",unicode_decimal:58991},{icon_id:"40373086",name:"ApplyLittleIcon",font_class:"ApplyLittleIcon",unicode:"e670",unicode_decimal:58992},{icon_id:"40373126",name:"OnStageIcon",font_class:"OnStageIcon",unicode:"e65c",unicode_decimal:58972},{icon_id:"40373125",name:"OffStageIcon",font_class:"OffStageIcon",unicode:"e653",unicode_decimal:58963},{icon_id:"40373124",name:"NextIcon",font_class:"NextIcon",unicode:"e65d",unicode_decimal:58973},{icon_id:"40373123",name:"MoreIcon",font_class:"MoreIcon",unicode:"e652",unicode_decimal:58962},{icon_id:"40373122",name:"MicOffIcon",font_class:"MicOffIcon",unicode:"e65e",unicode_decimal:58974},{icon_id:"40373120",name:"MirrorIcon",font_class:"MirrorIcon",unicode:"e65f",unicode_decimal:58975},{icon_id:"40373121",name:"MicDisabledIcon",font_class:"MicDisabledIcon",unicode:"e660",unicode_decimal:58976},{icon_id:"40373119",name:"MicOnIcon",font_class:"MicOnIcon",unicode:"e661",unicode_decimal:58977},{icon_id:"40373118",name:"ManageMemberIcon",font_class:"ManageMemberIcon1",unicode:"e651",unicode_decimal:58961},{icon_id:"40373117",name:"MailIcon",font_class:"MailIcon",unicode:"e650",unicode_decimal:58960},{icon_id:"40373116",name:"LogoTitleInEnglish",font_class:"LogoTitleInEnglish",unicode:"e64f",unicode_decimal:58959},{icon_id:"40373114",name:"LoginAvatar",font_class:"LoginAvatar",unicode:"e64e",unicode_decimal:58958},{icon_id:"40373113",name:"InviteSolidIcon",font_class:"InviteSolidIcon",unicode:"e64d",unicode_decimal:58957},{icon_id:"40373112",name:"InviteOnStageIcon",font_class:"InviteOnStageIcon",unicode:"e64c",unicode_decimal:58956},{icon_id:"40373111",name:"InviteIcon",font_class:"InviteIcon",unicode:"e662",unicode_decimal:58978},{icon_id:"40373109",name:"EmojiIcon",font_class:"EmojiIcon",unicode:"e64b",unicode_decimal:58955},{icon_id:"40373110",name:"EnterRoomIcon",font_class:"EnterRoomIcon",unicode:"e663",unicode_decimal:58979},{icon_id:"40373107",name:"ExtensionIcon",font_class:"ExtensionIcon",unicode:"e664",unicode_decimal:58980},{icon_id:"40373108",name:"EndRoomIcon",font_class:"EndRoomIcon1",unicode:"e665",unicode_decimal:58981},{icon_id:"40373106",name:"DenyOnStageIcon",font_class:"DenyOnStageIcon",unicode:"e64a",unicode_decimal:58954},{icon_id:"40373105",name:"CreateRoomIcon",font_class:"CreateRoomIcon",unicode:"e666",unicode_decimal:58982},{icon_id:"40373134",name:"VideoOpenIcon",font_class:"VideoOpenIcon",unicode:"e659",unicode_decimal:58969},{icon_id:"40373133",name:"VideoCloseIcon",font_class:"VideoCloseIcon",unicode:"e658",unicode_decimal:58968},{icon_id:"40373132",name:"UserIcon",font_class:"UserIcon",unicode:"e65a",unicode_decimal:58970},{icon_id:"40373131",name:"StepDownIcon",font_class:"StepDownIcon",unicode:"e657",unicode_decimal:58967},{icon_id:"40373130",name:"StageApplicationIcon",font_class:"StageApplicationIcon",unicode:"e65b",unicode_decimal:58971},{icon_id:"40373129",name:"ellipsisIcon",font_class:"ellipsisIcon",unicode:"e656",unicode_decimal:58966},{icon_id:"40373128",name:"RevokeAdminIcon",font_class:"RevokeAdminIcon",unicode:"e655",unicode_decimal:58965},{icon_id:"40373127",name:"PhoneIcon",font_class:"PhoneIcon",unicode:"e654",unicode_decimal:58964},{icon_id:"40373007",name:"ManageMemberIcon",font_class:"ManageMemberIcon",unicode:"e63e",unicode_decimal:58942},{icon_id:"40373005",name:"CameraOnIcon",font_class:"CameraOnIcon",unicode:"e63f",unicode_decimal:58943},{icon_id:"40373004",name:"EndRoomIcon",font_class:"EndRoomIcon",unicode:"e640",unicode_decimal:58944}]},Qh="/assets/iconfont.24555bcb.ttf",Zh=weex.requireModule("dom");Zh.addRule("fontFace",{fontFamily:"uniicons",src:"url('"+Qh+"')"});var e_={name:"SvgIconBack",props:{icon:{type:String,default:""},size:{type:[String,Number],default:""},color:{type:String,default:""},customStyle:{type:Object,default:{}}},data(){return{icons:Xh}},computed:{unicode(){var f,g;let T=(g=(f=this.icons)==null?void 0:f.glyphs)==null?void 0:g.find(v=>v.name===this.icon);return T?String.fromCharCode(T.unicode_decimal):""},styleObj(){let f={};return this.size&&(f.fontSize=`${Number(this.size)}px`,f.lineHeight=`${Number(this.size)}px`),this.color&&(f.color=this.color),f}}},t_={"uni-icons":{"":{fontFamily:"uniicons",textDecoration:"none",textAlign:"center"}}};function n_(f,g,T,v,w,N){return(0,h.openBlock)(),(0,h.createElementBlock)("u-text",{style:(0,h.normalizeStyle)(N.styleObj),class:"uni-icons"},(0,h.toDisplayString)(N.unicode),5)}var o_=Dt(e_,[["render",n_],["styles",[t_]]]),Sn=(0,h.defineComponent)({__name:"SvgIcon",props:{size:{type:[String,Number]},responseSize:{type:[String,Number]},customClass:{type:String},customStyle:{type:Object},icon:{type:String},color:{type:String}},setup(f){let g=f,T=(0,h.computed)(()=>g.icon&&g.icon.slice(-4)===".svg");return(v,w)=>((0,h.openBlock)(),(0,h.createElementBlock)(h.Fragment,null,[T.value?((0,h.openBlock)(),(0,h.createBlock)($h,{key:0,icon:v.icon,size:v.size,customClass:v.customClass},null,8,["icon","size","customClass"])):(0,h.createCommentVNode)("",!0),T.value?(0,h.createCommentVNode)("",!0):((0,h.openBlock)(),(0,h.createBlock)(o_,{key:1,icon:v.icon,size:v.size,customStyle:v.customStyle,color:v.color},null,8,["icon","size","customStyle","color"]))],64))}}),i_=(0,h.defineComponent)({__name:"PopUpH5",props:{title:{type:String}},setup(f){let g=qt();function T(){g.setSidebarOpenStatus(!1),g.setSidebarName("")}return(v,w)=>{let N=(0,h.resolveComponent)("main"),B=(0,h.resolveComponent)("footer");return(0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"popup-container",onTouchmove:(0,h.withModifiers)(()=>{},["stop","prevent"])},[(0,h.createElementVNode)("header",{class:"popup-main-header"},[(0,h.createElementVNode)("div",{class:"icon-container",onClick:T},[(0,h.createElementVNode)("div",{class:"close-icon"},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:"ArrowStrokeBackIcon"})])]),(0,h.createElementVNode)("u-text",{class:"sidebar-title"},(0,h.toDisplayString)(v.title),1)]),(0,h.createVNode)(N,{class:"popup-main-content"},{default:(0,h.withCtx)(()=>[(0,h.renderSlot)(v.$slots,"sidebarContent")]),_:3}),(0,h.createVNode)(B,{class:"popup-main-footer"},{default:(0,h.withCtx)(()=>[(0,h.renderSlot)(v.$slots,"sidebarFooter")]),_:3})],32)}}}),a_={"popup-container":{"":{width:"750rpx",height:"1640rpx",backgroundColor:"#FFFFFF",position:"fixed",top:40,right:0,bottom:0,left:0,flex:1}},"popup-main-header":{".popup-container ":{width:"750rpx",height:60,display:"flex",justifyContent:"center",alignItems:"center",position:"relative"}},"icon-container":{".popup-container .popup-main-header ":{position:"absolute",left:0,top:0,width:68,height:58,display:"flex",justifyContent:"center",alignItems:"center"}},"sidebar-title":{".popup-container .popup-main-header ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:16,lineHeight:22,textAlign:"center",color:"#000000"}},"close-icon":{".popup-container .popup-main-header ":{width:10,height:18}},"popup-main-content":{".popup-container ":{width:"750rpx",overflow:"hidden"}},"popup-main-footer":{".popup-container ":{width:"750rpx",position:"sticky",bottom:0,paddingTop:10}}},jg=Dt(i_,[["styles",[a_]]]),yp="/assets/avatar.00b7c7aa.png",s_=(0,h.defineComponent)({__name:"Avatar",props:{imgSrc:{type:null},size:{type:Number}},setup(f){let g=f,T=(0,h.computed)(()=>v.value?yp:g.imgSrc||yp),v=(0,h.ref)(!1);function w(){v.value=!0}return(N,B)=>((0,h.openBlock)(),(0,h.createElementBlock)("u-image",{class:"avatar",src:T.value,onError:w},null,40,["src"]))}}),r_={avatar:{"":{flex:1,borderRadius:100}}},ku=Dt(s_,[["styles",[r_]]]);function tc(f){let{confirmButtonText:g="\u786E\u5B9A",cancelButtonText:T="\u53D6\u6D88",callback:v}=f||{};uni.showModal({title:f==null?void 0:f.title,content:f==null?void 0:f.message,showCancel:f==null?void 0:f.showCancel,confirmText:g,cancelText:T,success:v,fail:()=>{throw Error("user cancel")}})}function Yg(f){return{all:f=f||new Map,on:function(g,T){var v=f.get(g);v?v.push(T):f.set(g,[T])},off:function(g,T){var v=f.get(g);v&&(T?v.splice(v.indexOf(T)>>>0,1):f.set(g,[]))},emit:function(g,T){var v=f.get(g);v&&v.slice().map(function(w){w(T)}),(v=f.get("*"))&&v.slice().map(function(w){w(g,T)})}}}var Nt=(f=>(f.SERVICE_READY="ServiceReady",f.ROOM_LOGIN="RoomLogin",f.ROOM_CONTAINER_RESIZE="RoomContainerResize",f.ROOM_NOTICE_MESSAGE="RoomNoticeMessage",f.ROOM_NOTICE_MESSAGE_BOX="RoomNoticeMessageBox",f.ROOM_START="RoomStart",f.ROOM_JOIN="RoomJoin",f.ROOM_LEAVE="RoomLeave",f.ROOM_DISMISS="RoomDestroy",f.ROOM_ERROR="RoomError",f.KICKED_OUT="KickedOut",f.KICKED_OFFLINE="KickedOffline",f.USER_SIG_EXPIRED="UserSigExpired",f.USER_LOGOUT="UserLogout",f))(Nt||{}),Wi=typeof globalThis!="undefined"?globalThis:typeof window!="undefined"?window:typeof global!="undefined"?global:typeof self!="undefined"?self:{};function c_(f){return f&&f.__esModule&&Object.prototype.hasOwnProperty.call(f,"default")?f.default:f}var zg={exports:{}};(function(f,g){(function(T,v){f.exports=v()})(Wi,function(){function T(t,o){var i,s=Object.keys(t);return Object.getOwnPropertySymbols&&(i=Object.getOwnPropertySymbols(t),o&&(i=i.filter(function(c){return Object.getOwnPropertyDescriptor(t,c).enumerable})),s.push.apply(s,i)),s}function v(t){for(var o=1;o<arguments.length;o++){var i=arguments[o]!=null?arguments[o]:{};o%2?T(Object(i),!0).forEach(function(s){H(t,s,i[s])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(i)):T(Object(i)).forEach(function(s){Object.defineProperty(t,s,Object.getOwnPropertyDescriptor(i,s))})}return t}function w(t){return(w=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(o){return typeof o}:function(o){return o&&typeof Symbol=="function"&&o.constructor===Symbol&&o!==Symbol.prototype?"symbol":typeof o})(t)}function N(t,o){if(!(t instanceof o))throw new TypeError("Cannot call a class as a function")}function B(t,o){for(var i=0;i<o.length;i++){var s=o[i];s.enumerable=s.enumerable||!1,s.configurable=!0,"value"in s&&(s.writable=!0),Object.defineProperty(t,s.key,s)}}function V(t,o,i){return o&&B(t.prototype,o),i&&B(t,i),Object.defineProperty(t,"prototype",{writable:!1}),t}function H(t,o,i){return o in t?Object.defineProperty(t,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):t[o]=i,t}function z(t,o){if(typeof o!="function"&&o!==null)throw new TypeError("Super expression must either be null or a function");t.prototype=Object.create(o&&o.prototype,{constructor:{value:t,writable:!0,configurable:!0}}),Object.defineProperty(t,"prototype",{writable:!1}),o&&ge(t,o)}function ne(t){return(ne=Object.setPrototypeOf?Object.getPrototypeOf:function(o){return o.__proto__||Object.getPrototypeOf(o)})(t)}function ge(t,o){return(ge=Object.setPrototypeOf||function(i,s){return i.__proto__=s,i})(t,o)}function pe(){if(typeof Reflect=="undefined"||!Reflect.construct||Reflect.construct.sham)return!1;if(typeof Proxy=="function")return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(t){return!1}}function oe(t,o,i){return(oe=pe()?Reflect.construct:function(s,m,l){var p=[null],m=(p.push.apply(p,m),new(Function.bind.apply(s,p)));return l&&ge(m,l.prototype),m}).apply(null,arguments)}function de(t){var o=typeof Map=="function"?new Map:void 0;return function(i){if(i===null||Function.toString.call(i).indexOf("[native code]")===-1)return i;if(typeof i!="function")throw new TypeError("Super expression must either be null or a function");if(o!==void 0){if(o.has(i))return o.get(i);o.set(i,s)}function s(){return oe(i,arguments,ne(this).constructor)}return s.prototype=Object.create(i.prototype,{constructor:{value:s,enumerable:!1,writable:!0,configurable:!0}}),ge(s,i)}(t)}function ae(t,o){if(t==null)return{};var i,s=function(p,m){if(p==null)return{};for(var I,C={},S=Object.keys(p),k=0;k<S.length;k++)I=S[k],0<=m.indexOf(I)||(C[I]=p[I]);return C}(t,o);if(Object.getOwnPropertySymbols)for(var c=Object.getOwnPropertySymbols(t),l=0;l<c.length;l++)i=c[l],0<=o.indexOf(i)||Object.prototype.propertyIsEnumerable.call(t,i)&&(s[i]=t[i]);return s}function te(t){if(t===void 0)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return t}function J(t){var o=pe();return function(){var i,s=ne(t),s=(i=o?(i=ne(this).constructor,Reflect.construct(s,arguments,i)):s.apply(this,arguments),this);if(i&&(typeof i=="object"||typeof i=="function"))return i;if(i!==void 0)throw new TypeError("Derived constructors may only return object or undefined");return te(s)}}function Le(t,o){return Be(t)||function(i,s){var c=i==null?null:typeof Symbol!="undefined"&&i[Symbol.iterator]||i["@@iterator"];if(c!=null){var l,p,m=[],I=!0,C=!1;try{for(c=c.call(i);!(I=(l=c.next()).done)&&(m.push(l.value),!s||m.length!==s);I=!0);}catch(S){C=!0,p=S}finally{try{I||c.return==null||c.return()}finally{if(C)throw p}}return m}}(t,o)||Xe(t,o)||me()}function re(t){return function(o){if(Array.isArray(o))return Ne(o)}(t)||Ye(t)||Xe(t)||function(){throw new TypeError(`Invalid attempt to spread non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}()}function Be(t){if(Array.isArray(t))return t}function Ye(t){if(typeof Symbol!="undefined"&&t[Symbol.iterator]!=null||t["@@iterator"]!=null)return Array.from(t)}function Xe(t,o){if(t){if(typeof t=="string")return Ne(t,o);var i=Object.prototype.toString.call(t).slice(8,-1);return(i=i==="Object"&&t.constructor?t.constructor.name:i)==="Map"||i==="Set"?Array.from(t):i==="Arguments"||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i)?Ne(t,o):void 0}}function Ne(t,o){(o==null||o>t.length)&&(o=t.length);for(var i=0,s=new Array(o);i<o;i++)s[i]=t[i];return s}function me(){throw new TypeError(`Invalid attempt to destructure non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}function A(t,o){var i,s=typeof Symbol!="undefined"&&t[Symbol.iterator]||t["@@iterator"];if(!s){if(Array.isArray(t)||(s=Xe(t))||o&&t&&typeof t.length=="number")return s&&(t=s),i=0,{s:o=function(){},n:function(){return i>=t.length?{done:!0}:{done:!1,value:t[i++]}},e:function(m){throw m},f:o};throw new TypeError(`Invalid attempt to iterate non-iterable instance.
In order to be iterable, non-array objects must have a [Symbol.iterator]() method.`)}var c,l=!0,p=!1;return{s:function(){s=s.call(t)},n:function(){var m=s.next();return l=m.done,m},e:function(m){p=!0,c=m},f:function(){try{l||s.return==null||s.return()}finally{if(p)throw c}}}}var Me={SDK_READY:"sdkStateReady",SDK_NOT_READY:"sdkStateNotReady",SDK_DESTROY:"sdkDestroy",MESSAGE_RECEIVED:"onMessageReceived",ROOM_CUSTOM_DATA_RECEIVED:"onRoomCustomDataReceived",MESSAGE_MODIFIED:"onMessageModified",MESSAGE_REVOKED:"onMessageRevoked",MESSAGE_READ_BY_PEER:"onMessageReadByPeer",MESSAGE_READ_RECEIPT_RECEIVED:"onMessageReadReceiptReceived",MESSAGE_EXTENSIONS_UPDATED:"onMessageExtensionsUpdated",MESSAGE_EXTENSIONS_DELETED:"onMessageExtensionsDeleted",MESSAGE_REACTIONS_UPDATED:"onMessageReactionsUpdated",CONVERSATION_LIST_UPDATED:"onConversationListUpdated",TOTAL_UNREAD_MESSAGE_COUNT_UPDATED:"onTotalUnreadMessageCountUpdated",CONVERSATION_GROUP_LIST_UPDATED:"onConversationGroupListUpdated",CONVERSATION_IN_GROUP_UPDATED:"onConversationInGroupUpdated",GROUP_LIST_UPDATED:"onGroupListUpdated",GROUP_ATTRIBUTES_UPDATED:"groupAttributesUpdated",GROUP_COUNTER_UPDATED:"onGroupCounterUpdated",TOPIC_CREATED:"onTopicCreated",TOPIC_DELETED:"onTopicDeleted",TOPIC_UPDATED:"onTopicUpdated",PROFILE_UPDATED:"onProfileUpdated",USER_STATUS_UPDATED:"onUserStatusUpdated",BLACKLIST_UPDATED:"blacklistUpdated",FRIEND_LIST_UPDATED:"onFriendListUpdated",FRIEND_GROUP_LIST_UPDATED:"onFriendGroupListUpdated",FRIEND_APPLICATION_LIST_UPDATED:"onFriendApplicationListUpdated",MY_FOLLOWERS_LIST_UPDATED:"onMyFollowersListUpdated",MY_FOLLOWING_LIST_UPDATED:"onMyFollowingListUpdated",MUTUAL_FOLLOWERS_LIST_UPDATED:"onMutualFollowersListUpdated",KICKED_OUT:"kickedOut",ERROR:"error",NET_STATE_CHANGE:"netStateChange",ALL_RECEIVE_MESSAGE_OPT_UPDATED:"onAllReceiveMessageOptUpdated"},O={MSG_TEXT:"TIMTextElem",MSG_IMAGE:"TIMImageElem",MSG_SOUND:"TIMSoundElem",MSG_AUDIO:"TIMSoundElem",MSG_FILE:"TIMFileElem",MSG_FACE:"TIMFaceElem",MSG_VIDEO:"TIMVideoFileElem",MSG_GEO:"TIMLocationElem",MSG_LOCATION:"TIMLocationElem",MSG_GRP_TIP:"TIMGroupTipElem",MSG_GRP_SYS_NOTICE:"TIMGroupSystemNoticeElem",MSG_CUSTOM:"TIMCustomElem",MSG_MERGER:"TIMRelayElem",MSG_PRIORITY_HIGH:"High",MSG_PRIORITY_NORMAL:"Normal",MSG_PRIORITY_LOW:"Low",MSG_PRIORITY_LOWEST:"Lowest",CONV_C2C:"C2C",CONV_GROUP:"GROUP",CONV_TOPIC:"TOPIC",CONV_SYSTEM:"@TIM#SYSTEM",CONV_AT_ME:1,CONV_AT_ALL:2,CONV_AT_ALL_AT_ME:3,CONV_MARK_TYPE_STAR:1,CONV_MARK_TYPE_UNREAD:2,CONV_MARK_TYPE_FOLD:4,CONV_MARK_TYPE_HIDE:8,GRP_PRIVATE:"Private",GRP_WORK:"Private",GRP_PUBLIC:"Public",GRP_CHATROOM:"ChatRoom",GRP_MEETING:"ChatRoom",GRP_AVCHATROOM:"AVChatRoom",GRP_COMMUNITY:"Community",GRP_ROOM:"Room",GRP_LIVE:"Live",GRP_MBR_ROLE_OWNER:"Owner",GRP_MBR_ROLE_ADMIN:"Admin",GRP_MBR_ROLE_MEMBER:"Member",GRP_MBR_ROLE_CUSTOM:"Custom",GRP_TIP_MBR_JOIN:1,GRP_TIP_MBR_QUIT:2,GRP_TIP_MBR_KICKED_OUT:3,GRP_TIP_MBR_SET_ADMIN:4,GRP_TIP_MBR_CANCELED_ADMIN:5,GRP_TIP_GRP_PROFILE_UPDATED:6,GRP_TIP_MBR_PROFILE_UPDATED:7,GRP_TIP_BAN_AVCHATROOM_MEMBER:10,GRP_TIP_UNBAN_AVCHATROOM_MEMBER:11,MSG_REMIND_ACPT_AND_NOTE:"AcceptAndNotify",MSG_REMIND_ACPT_NOT_NOTE:"AcceptNotNotify",MSG_REMIND_DISCARD:"Discard",RECEIVE_WITH_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT:"AcceptNotNotifyExceptAt",NOT_RECEIVE_MSG_EXCEPT_AT:"NotReceiveMsgExceptAt",GENDER_UNKNOWN:"Gender_Type_Unknown",GENDER_FEMALE:"Gender_Type_Female",GENDER_MALE:"Gender_Type_Male",KICKED_OUT_MULT_ACCOUNT:"multipleAccount",KICKED_OUT_MULT_DEVICE:"multipleDevice",KICKED_OUT_USERSIG_EXPIRED:"userSigExpired",KICKED_OUT_REST_API:"REST_API_Kick",ALLOW_TYPE_ALLOW_ANY:"AllowType_Type_AllowAny",ALLOW_TYPE_NEED_CONFIRM:"AllowType_Type_NeedConfirm",ALLOW_TYPE_DENY_ANY:"AllowType_Type_DenyAny",FORBID_TYPE_NONE:"AdminForbid_Type_None",FORBID_TYPE_SEND_OUT:"AdminForbid_Type_SendOut",JOIN_OPTIONS_FREE_ACCESS:"FreeAccess",JOIN_OPTIONS_NEED_PERMISSION:"NeedPermission",JOIN_OPTIONS_DISABLE_APPLY:"DisableApply",JOIN_STATUS_SUCCESS:"JoinedSuccess",JOIN_STATUS_ALREADY_IN_GROUP:"AlreadyInGroup",JOIN_STATUS_WAIT_APPROVAL:"WaitAdminApproval",INVITE_OPTIONS_DISABLE_INVITE:"DisableInvite",INVITE_OPTIONS_NEED_PERMISSION:"NeedPermission",INVITE_OPTIONS_FREE_ACCESS:"FreeAccess",GRP_PROFILE_OWNER_ID:"ownerID",GRP_PROFILE_CREATE_TIME:"createTime",GRP_PROFILE_LAST_INFO_TIME:"lastInfoTime",GRP_PROFILE_MEMBER_NUM:"memberNum",GRP_PROFILE_MAX_MEMBER_NUM:"maxMemberNum",GRP_PROFILE_JOIN_OPTION:"joinOption",GRP_PROFILE_INVITE_OPTION:"inviteOption",GRP_PROFILE_INTRODUCTION:"introduction",GRP_PROFILE_NOTIFICATION:"notification",GRP_PROFILE_MUTE_ALL_MBRS:"muteAllMembers",SNS_ADD_TYPE_SINGLE:"Add_Type_Single",SNS_ADD_TYPE_BOTH:"Add_Type_Both",SNS_DELETE_TYPE_SINGLE:"Delete_Type_Single",SNS_DELETE_TYPE_BOTH:"Delete_Type_Both",SNS_APPLICATION_TYPE_BOTH:"Pendency_Type_Both",SNS_APPLICATION_SENT_TO_ME:"Pendency_Type_ComeIn",SNS_APPLICATION_SENT_BY_ME:"Pendency_Type_SendOut",SNS_APPLICATION_AGREE:"Response_Action_Agree",SNS_APPLICATION_AGREE_AND_ADD:"Response_Action_AgreeAndAdd",SNS_CHECK_TYPE_BOTH:"CheckResult_Type_Both",SNS_CHECK_TYPE_SINGLE:"CheckResult_Type_Single",SNS_TYPE_NO_RELATION:"CheckResult_Type_NoRelation",SNS_TYPE_A_WITH_B:"CheckResult_Type_AWithB",SNS_TYPE_B_WITH_A:"CheckResult_Type_BWithA",SNS_TYPE_BOTH_WAY:"CheckResult_Type_BothWay",NET_STATE_CONNECTED:"connected",NET_STATE_CONNECTING:"connecting",NET_STATE_DISCONNECTED:"disconnected",MSG_AT_ALL:"__kImSDK_MesssageAtALL__",READ_ALL_C2C_MSG:"readAllC2CMessage",READ_ALL_GROUP_MSG:"readAllGroupMessage",READ_ALL_MSG:"readAllMessage",USER_STATUS_UNKNOWN:0,USER_STATUS_ONLINE:1,USER_STATUS_OFFLINE:2,USER_STATUS_UNLOGINED:3,IOS_OFFLINE_PUSH_NO_SOUND:"push.no_sound",IOS_OFFLINE_PUSH_DEFAULT_SOUND:"default"},ze={NEW_INVITATION_RECEIVED:"newInvitationReceived",INVITEE_ACCEPTED:"ts_invitee_accepted",INVITEE_REJECTED:"ts_invitee_rejected",INVITATION_CANCELLED:"ts_invitation_cancelled",INVITATION_TIMEOUT:"ts_invitation_timeout",INVITATION_MODIFIED:"ts_invitation_modified",ACTION_TYPE_UNKNOWN:0,ACTION_TYPE_INVITE:1,ACTION_TYPE_CANCEL_INVITE:2,ACTION_TYPE_ACCEPT_INVITE:3,ACTION_TYPE_REJECT_INVITE:4,ACTION_TYPE_INVITE_TIMEOUT:5},gn=(V(wt,[{key:"use",value:function(t){if(typeof t!="function")throw"middleware must be a function";return this.cache.push(t),this}},{key:"next",value:function(t){if(this.middlewares&&0<this.middlewares.length)return this.middlewares.shift().call(this,this.options,this.next.bind(this))}},{key:"run",value:function(t){return this.middlewares=this.cache.map(function(o){return o}),this.options=t,this.next()}}]),wt),ct=(V(Zt,[{key:"equal",value:function(t){return t!==null&&this.low===t.low&&this.high===t.high}},{key:"toString",value:function(){var t=Number(this.high).toString(16),o=Number(this.low).toString(16);if(o.length<8)for(var i=8-o.length;i;)o="0"+o,i--;return t+o}}]),Zt),pt={TEST:{CHINA:{DEFAULT:"wss://wss-dev.tim.qq.com"},OVERSEA:{DEFAULT:"wss://wss-dev.tim.qq.com"},SINGAPORE:{DEFAULT:"wss://wsssgp-dev.im.qcloud.com"},KOREA:{DEFAULT:"wss://wsskr-dev.im.qcloud.com"},GERMANY:{DEFAULT:"wss://wssger-dev.im.qcloud.com"},IND:{DEFAULT:"wss://wssind-dev.im.qcloud.com"},JPN:{DEFAULT:"wss://wssjpn-dev.im.qcloud.com"},USA:{DEFAULT:"wss://wssusa-dev.im.qcloud.com"},INDONESIA:{DEFAULT:"wss://wssidn-dev.im.qcloud.com"}},PRODUCTION:{CHINA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",IPV6:"wss://wssv6.im.qcloud.com",BACKUP:"wss://wss.tim.qq.com",STAT:"https://events.im.qcloud.com",ANYCAST:"wss://162.14.13.203"},OVERSEA:{DEFAULT0:"wss://*w4c.my-imcloud.com",DEFAULT:"wss://wss.im.qcloud.com",BACKUP:"wss://wss.my-imcloud.com",STAT:"https://api.my-imcloud.com"},SINGAPORE:{DEFAULT0:"wss://*w4s.my-imcloud.com",DEFAULT:"wss://wsssgp.im.qcloud.com",IPV6:"wss://wsssgpv6.im.qcloud.com",BACKUP:"wss://wsssgp.my-imcloud.com",STAT:"https://apisgp.my-imcloud.com",ANYCAST:"wss://162.14.19.159"},KOREA:{DEFAULT0:"wss://*w4k.my-imcloud.com",DEFAULT:"wss://wsskr.im.qcloud.com",IPV6:"wss://wsskrv6.im.qcloud.com",BACKUP:"wss://wsskr.my-imcloud.com",STAT:"https://apikr.my-imcloud.com",ANYCAST:"wss://162.14.13.104"},GERMANY:{DEFAULT0:"wss://*w4g.my-imcloud.com",DEFAULT:"wss://wssger.im.qcloud.com",IPV6:"wss://wssgerv6.im.qcloud.com",BACKUP:"wss://wssger.my-imcloud.com",STAT:"https://apiger.my-imcloud.com",ANYCAST:"wss://162.14.3.17"},IND:{DEFAULT0:"wss://*w4i.my-imcloud.com",DEFAULT:"wss://wssind.my-imcloud.com",IPV6:"wss://wssindv6.im.qcloud.com",BACKUP:"wss://wssind.im.qcloud.com",STAT:"https://apiind.my-imcloud.com",ANYCAST:"wss://162.14.19.46"},JPN:{DEFAULT0:"wss://*w4j.my-imcloud.com",DEFAULT:"wss://wssjpn.im.qcloud.com",IPV6:"wss://wssjpnv6.im.qcloud.com",BACKUP:"wss://wssjpn.my-imcloud.com",STAT:"https://apijpn.my-imcloud.com"},USA:{DEFAULT0:"wss://*w4u.my-imcloud.com",DEFAULT:"wss://wssusa.im.qcloud.com",IPV6:"wss://wssusav6.im.qcloud.com",BACKUP:"wss://wssusa.my-imcloud.com",STAT:"https://apiusa.my-imcloud.com",ANYCAST:"wss://162.14.10.42"},INDONESIA:{DEFAULT0:"wss://*w4y.my-imcloud.com",DEFAULT:"wss://wssidn.im.qcloud.com",IPV6:"wss://wssidnv6.im.qcloud.com",BACKUP:"wss://wssidn.my-imcloud.com",STAT:"https://apiidn.my-imcloud.com",ANYCAST:"wss://43.129.34.169"}}},dt={ANDROID:2,IOS:3,MAC:4,WEB:7,WX_MP:8,QQ_MP:9,TT_MP:10,BAIDU_MP:11,ALI_MP:12,IPAD:13,UNI_NATIVE_APP:15,DONUT_NATIVE_APP:19,NS_NATIVE_APP:20,RN_NATIVE_APP:21},He="1.7.3",ee=537048168,Qe="CHINA",se={HOST:{CURRENT:{DEFAULT:"wss://wss.im.qcloud.com",STAT:"https://events.im.qcloud.com"},setCurrent:function(){this.CURRENT=pt.PRODUCTION[0<arguments.length&&arguments[0]!==void 0?arguments[0]:Qe]}},NAME:{OPEN_IM:"openim",OPEN_IM_MSG_EXT:"openim_msg_ext_http_svc",GRP:"group_open_http_svc",GRP_AV:"group_open_avchatroom_http_svc",GRP_COMMUNITY:"million_group_open_http_svc",GRP_ATTR:"group_open_attr_http_svc",FD:"sns",PROFILE:"profile",RECENT_CONTACT:"recentcontact",PIC:"openpic",BIG_GRP_NO_AUTH:"group_open_http_noauth_svc",BIG_GRP_POLLING:"group_open_long_polling_http_svc",BIG_GRP_POLLING_NO_AUTH:"group_open_long_polling_http_noauth_svc",IM_OPEN_STAT:"imopenstat",WEB_IM:"webim",IM_COS_SIGN:"im_cos_sign_svr",CUSTOM_UPLOAD:"im_cos_msg",HEARTBEAT:"heartbeat",IM_OPEN_PUSH:"im_open_push",IM_OPEN_STATUS:"im_open_status",IM_LONG_MSG:"im_long_msg",IM_CONFIG_MANAGER:"im_sdk_config_mgr",STAT_SERVICE:"StatSvc",OVERLOAD_PUSH:"OverLoadPush",IM_MSG_AUDIT_MGR:"im_msg_audit_mgr",TUIROOM_SVR:"tui_room_svr",IM_OPEN_TRANSLATE:"im_open_translate",IM_OPEN_SPEECH:"im_open_speech",MSG_SEARCH:"message_search",GRP_SEARCH:"group_search",GRP_MEMBER_SEARCH:"group_member_search",USER_SEARCH:"user_search",FOLLOW:"follow",OFFLINE_PUSH_REPORT:"offline_push_report",IM_MSG_LOGIC:"im_msg_db_logic"}},Ue={SEARCH_GRP_SNS:new ct(0,Math.pow(2,1)).toString(),AV_HISTORY_MSG:new ct(0,Math.pow(2,2)).toString(),GRP_COMMUNITY:new ct(0,Math.pow(2,3)).toString(),MSG_TO_SPECIFIED_GRP_MBR:new ct(0,Math.pow(2,4)).toString(),AV_MBR_LIST:new ct(0,Math.pow(2,6)).toString(),USER_STATUS:new ct(0,Math.pow(2,7)).toString(),CONV_MARK:new ct(0,Math.pow(2,9)).toString(),CONV_GROUP:new ct(0,Math.pow(2,10)).toString(),AV_BAN_MBR:new ct(0,Math.pow(2,11)).toString(),MSG_EXT:new ct(0,Math.pow(2,13)).toString(),GRP_COUNTER:new ct(0,Math.pow(2,15)).toString(),PLUGIN_TRANSLATE:new ct(Math.pow(2,6)).toString(),PLUGIN_VOICE_TO_TEXT:new ct(Math.pow(2,7)).toString(),PLUGIN_CS:new ct(Math.pow(2,8)).toString(),PLUGIN_PUSH:new ct(Math.pow(2,9)).toString(),PLUGIN_BOT:new ct(Math.pow(2,10)).toString(),MSG_REACTION:new ct(Math.pow(2,16)).toString(),FOLLOW:new ct(Math.pow(2,20)).toString()},At="group_profile",qn=["Type","Name","Introduction","Notification","FaceUrl","Owner_Account","CreateTime","InfoSeq","LastInfoTime","LastMsgTime","MemberNum","MaxMemberNum","ApplyJoinOption","NextMsgSeq","ShutUpAllMember","InviteJoinOption"],nt=["Role","JoinTime","MsgSeq","MsgFlag"];function Zt(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0;N(this,Zt),this.high=t,this.low=o}function wt(){N(this,wt),this.cache=[],this.options=null}se.HOST.setCurrent(Qe);for(var sn,rn=typeof wx!="undefined"&&typeof wx.getSystemInfoSync=="function"&&!!wx.getSystemInfoSync().fontSizeSetting,gt=rn&&typeof wx.createGamePortal=="function",St=typeof qq!="undefined"&&typeof qq.getSystemInfoSync=="function"&&!!qq.getSystemInfoSync().fontSizeSetting,Ft=typeof tt!="undefined"&&typeof tt.getSystemInfoSync=="function"&&!!tt.getSystemInfoSync().fontSizeSetting,Ve=typeof swan!="undefined"&&typeof swan.getSystemInfoSync=="function"&&!!swan.getSystemInfoSync().fontSizeSetting,Ct=typeof my!="undefined"&&typeof my.getSystemInfoSync=="function"&&!!my.getSystemInfoSync().fontSizeSetting,xe=typeof jd!="undefined"&&typeof jd.getSystemInfoSync=="function",Ce=typeof uni!="undefined"&&typeof window=="undefined"&&typeof Lu=="function",ie=rn&&w(wx.miniapp)==="object",ba=typeof uni!="undefined",qe=rn||St||Ft||Ve||Ct||Ce||xe,ht=typeof window=="undefined"&&!qe&&typeof Wi!="undefined"&&Wi.NativeScriptGlobals!==void 0,Ze=typeof Wi!="undefined"&&(Wi.nativeModuleProxy!==void 0||Wi.ReactNative!==void 0),$t=typeof uni!="undefined"?!qe:typeof window!="undefined"&&!qe&&!Ze,mt=St?qq:Ft?tt:Ve?swan:Ct?my:rn?wx:Ce?uni:xe?jd:{},vt=$t&&window&&window.navigator&&window.navigator.userAgent||"",xn=(xe="WEB",/(micromessenger|webbrowser)/i.test(vt)?xe="WEB":St?xe="QQ_MP":Ft?xe="TT_MP":Ve?xe="BAIDU_MP":Ct?xe="ALI_MP":rn?xe=ie?"DONUT_NATIVE_APP":"WX_MP":Ce?xe="UNI_NATIVE_APP":ht?xe="NS_NATIVE_APP":Ze&&(xe="RN_NATIVE_APP"),dt[xe]),ie=/iPad/i.test(vt),ht=/iPhone/i.test(vt)&&!ie,xe=/iPod/i.test(vt),rr=ht||ie||xe,nc=(ht=vt.match(/OS (\d+)_/i))&&ht[1]?ht[1]:null,oc=/Android/i.test(vt),ic=function(){var s=vt.match(/Android (\d+)(?:\.(\d+))?(?:\.(\d+))*/i);if(!s)return null;var c=s[1]&&parseFloat(s[1]),l=s[2]&&parseFloat(s[2]);return c&&l?parseFloat(s[1]+"."+s[2]):c||null}(),ie=/Edge/i.test(vt),xe=!ie&&/Chrome/i.test(vt),ac=/MSIE/.test(vt)||-1<vt.indexOf("Trident")&&-1<vt.indexOf("rv:11.0"),sc=ht=!(ht=(ht=/MSIE\s(\d+)\.\d/.exec(vt))&&parseFloat(ht[1]))&&/Trident\/7.0/i.test(vt)&&/rv:11.0/.test(vt)?11:ht,Wl=/Safari/i.test(vt)&&!xe&&!oc&&!ie,jl=/Windows/i.test(vt),Yl=/MAC OS X/i.test(vt),Yi=$t&&typeof Worker!="undefined"&&!ac,ti=oc||rr,cr=$t&&window.tencent_cloud_im_csig_flutter_for_web_25F_cy!==void 0,rc=function(){if(typeof window=="undefined"||window.navigator===void 0)return!1;var s=window.navigator.standalone;return!(!rr||s||Wl)}(),cc=typeof console!="undefined"?console:typeof Wi!="undefined"&&Wi.console?Wi.console:typeof window!="undefined"&&window.console?window.console:{},Ou=function(){},Nu=["assert","clear","count","debug","dir","dirxml","error","group","groupCollapsed","groupEnd","info","log","profile","profileEnd","table","time","timeEnd","timeStamp","trace","warn"],uc=Nu.length;uc--;)sn=Nu[uc],console[sn]||(cc[sn]=Ou);function lc(){var t=new Date;return t.setTime(no()),t}function dc(){$i=0}function zi(){return Math.floor(no()/1e3)}var Ji=cc,$i=0,no=function(){return new Date().getTime()+$i},Vn=0;function Lo(){return Ko()?"%c Chat %c":"Chat"}function pc(){var t=lc();return t.toLocaleTimeString("en-US",{hour12:!1})+"."+function(o){var i;switch(o.toString().length){case 1:i="00"+o;break;case 2:i="0"+o;break;default:i=o}return i}(t.getMilliseconds())}var E={arguments2String:function(t){var o="";if(t.length===1)o=t[0];else for(var i=0,s=t.length;i<s;i++){if(Bo(t[i]))try{o+=Jl(t[i])?JSON.stringify(t[i],["message","code"]):JSON.stringify(t[i])}catch(c){o+=c?c.message:"";break}else o+=t[i];o+=" "}return o},_exec:function(t,o){Ko()?Ji[t](Lo(),"background:#0abf5b; padding:1px; border-radius:3px; color: #fff","background:transparent",pc(),o):Ji[t]("".concat(Lo()," ").concat(pc()," ").concat(o))},d:function(){var t;Vn<=-1&&(t=this.arguments2String(arguments),this._exec("debug",t))},l:function(){var t;Vn<=0&&(t=this.arguments2String(arguments),this._exec("log",t))},log:function(){var t;Vn<=0&&(t=this.arguments2String(arguments),this._exec("log",t))},i:function(){var t;Vn<=1&&(t=this.arguments2String(arguments),this._exec("info",t))},w:function(){var t;Vn<=2&&(t=this.arguments2String(arguments),this._exec("warn",t))},e:function(){var t;Vn<=3&&(t=this.arguments2String(arguments),this._exec("error",t))},setLevel:function(t){t<4&&this._exec("log","set level from "+Vn+" to "+t),Vn=t},getLevel:function(){return Vn}},D={JPG:1,JPEG:1,GIF:2,PNG:3,BMP:4,UNKNOWN:255},ht="Tag_Profile_IM_",at={NICK:"".concat(ht,"Nick"),GENDER:"".concat(ht,"Gender"),BIRTHDAY:"".concat(ht,"BirthDay"),LOCATION:"".concat(ht,"Location"),SELFSIGNATURE:"".concat(ht,"SelfSignature"),ALLOWTYPE:"".concat(ht,"AllowType"),LANGUAGE:"".concat(ht,"Language"),AVATAR:"".concat(ht,"Image"),MESSAGESETTINGS:"".concat(ht,"MsgSettings"),ADMINFORBIDTYPE:"".concat(ht,"AdminForbidType"),LEVEL:"".concat(ht,"Level"),ROLE:"".concat(ht,"Role")},Je={GROUP:"".concat("Tag_SNS_IM_","Group"),REMARK:"".concat("Tag_SNS_IM_","Remark"),ADDSOURCE:"".concat("Tag_SNS_IM_","AddSource"),ADDWORDING:"".concat("Tag_SNS_IM_","Wording"),ADDTIME:"".concat("Tag_SNS_IM_","AddTime")},xe="Gender_Type_",co={UNKNOWN:"".concat(xe,"Unknown"),FEMALE:"".concat(xe,"Female"),MALE:"".concat(xe,"Male")},gc={NONE:"".concat("AdminForbid_Type_","None"),SEND_OUT:"".concat("AdminForbid_Type_","SendOut")},hc={NEED_CONFIRM:"".concat("AllowType_Type_","NeedConfirm"),ALLOW_ANY:"".concat("AllowType_Type_","AllowAny"),DENY_ANY:"".concat("AllowType_Type_","DenyAny")},di="JoinedSuccess",pi="WaitAdminApproval",Pa="@TOPIC#_",ur=Object.prototype.hasOwnProperty;function Te(t){if(t==null)return!0;if(typeof t=="boolean")return!1;if(typeof t=="number")return t===0;if(typeof t=="string"||typeof t=="function"||Array.isArray(t))return t.length===0;if(t instanceof Error)return t.message==="";if(It(t)){for(var o in t)if(ur.call(t,o))return!1;return!0}return!!(Se(t)||bu(t)||ko(t))&&t.size===0}function Se(t){return yo(t)==="map"}function bu(t){return yo(t)==="set"}function ko(t){return yo(t)==="file"}function ut(t){return t!==null&&(typeof t=="number"&&!isNaN(+t)||w(t)==="object"&&t.constructor===Number)}function ft(t){return t!==null&&w(t)==="object"}function It(t){if(w(t)==="object"&&t!==null){if((t=Object.getPrototypeOf(t))===null)return 1;for(var o=t;Object.getPrototypeOf(o)!==null;)o=Object.getPrototypeOf(o);return t===o}}function ye(t){return typeof Array.isArray=="function"?Array.isArray(t):yo(t)==="array"}function ke(t){return ye(t)&&0<t.length}function Ot(t){return typeof t=="function"}function _c(t){return yo(t)==="filelist"}function fc(t){return typeof t=="string"&&(t=t[0],!/[^a-zA-Z0-9]/.test(t))}function Gn(t,o,i,s){if(!Bo(t)||!Bo(o))return 0;for(var c,l=0,p=Object.keys(o),m=0,I=p.length;m<I;m++)if(c=p[m],!(q(o[c])||i&&i.includes(c)))if(Bo(t[c])&&Bo(o[c]))l+=Gn(t[c],o[c],i,s);else{if(s&&s.includes(o[c]))continue;t[c]!==o[c]&&(t[c]=o[c],l+=1)}return l}function Ga(t,o){var i,s=new Map,c=A(t.entries());try{for(c.s();!(i=c.n()).done;){var l=Le(i.value,2),p=l[0],m=l[1];m&&s.set(p,o?JSON.stringify(m):JSON.parse(JSON.stringify(m)))}}catch(I){c.e(I)}finally{c.f()}return s}function gi(t){if(t.length===0)return 0;for(var o=0,i=0,s=typeof document!="undefined"&&document.characterSet!==void 0?document.characterSet:"UTF-8";t[o]!==void 0;)i+=t[o++].charCodeAt[o]<=255?1:s===!1?3:2;return i}function mn(t){return t=t||99999999,Math.round(Math.random()*t)}function mc(){for(var t="",o=32;0<o;--o)t+=vc[Math.floor(Math.random()*$l)];return t}function vo(t,o){for(var i in t)if(t[i]===o)return 1}function Vo(t){return t.indexOf("http://")===-1||t.indexOf("https://")===-1?"https://"+t:t.replace(/https|http/,"https")}function Ua(t){if(Object.getOwnPropertyNames(t).length===0)return Object.create(null);var o,i,s=Array.isArray(t)?[]:Object.create(null);for(i in t)t[i]!==null?t[i]!==void 0?(o=w(t[i]),0<=["string","number","function","boolean"].indexOf(o)?s[i]=t[i]:s[i]=Ua(t[i])):s[i]=void 0:s[i]=null;return s}var zl=["url"],Ee=function(t){return typeof t=="string"},q=function(t){return t===void 0},Bo=function(t){return ye(t)||ft(t)},Jl=function(t){return t instanceof Error},yo=function(t){return Object.prototype.toString.call(t).match(/^\[object (.*)\]$/)[1].toLowerCase()},vc=(Date.now||(Date.now=function(){return new Date().getTime()}),"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"),$l=vc.length,hi={};function Ho(t,o){if(!ye(t)||!ye(o))return!1;var i=!1;return o.forEach(function(l){var c=l.key,l=l.value,p=t.find(function(m){return m.key===c});p?p.value!==l&&(p.value=l,i=!0):(t.push({key:c,value:l}),i=!0)}),i}function wa(t){return Te(t)?[]:t.filter(function(o){return o.isModified===!0})}function lr(t){if(It(t)&&It(t.webhookInfo)){var o=[];if(t.webhookInfo.disableCloudMessagePreHook&&o.push("ForbidBeforeSendMsgCallback"),t.webhookInfo.disableCloudMessagePostHook&&o.push("ForbidAfterSendMsgCallback"),o.length!==0)return o}}function Un(t){return Te(t)?[]:t.filter(function(o){return o.isModified===!1})}function Vt(t){return t===O.GRP_AVCHATROOM}function bt(i){var o=i.type,i=i.groupID;return o===O.GRP_COMMUNITY||"".concat(i).startsWith("@TGS#_")&&!"".concat(i).includes(Pa)}function Lt(t){return"".concat(t).startsWith("@TGS#_")&&"".concat(t).includes(Pa)}function Bt(t){return Ee(t)&&t.slice(0,3)===O.CONV_C2C}function wn(t){return Ee(t)&&t.slice(0,5)===O.CONV_GROUP}function Xi(t){return Ee(t)&&t===O.CONV_SYSTEM}function _i(t,o){var i={};return Object.keys(t).forEach(function(s){i[s]=o(t[s],s)}),i}function fi(t){return Ze?Promise.resolve({width:0,height:0}):qe?new Promise(function(o,i){mt.getImageInfo({src:t,success:function(s){o({width:s.width,height:s.height})},fail:function(){o({width:0,height:0})}})}):ac&&sc===9?Promise.resolve({width:0,height:0}):new Promise(function(o,i){var s=new Image;s.onload=function(){o({width:this.width,height:this.height}),s=null},s.onerror=function(){o({width:0,height:0}),s=null},s.src=t})}function yc(){function t(){return(65536*(1+Math.random())|0).toString(16).substring(1)}return"".concat(t()+t()).concat(t()).concat(t()).concat(t()).concat(t()).concat(t()).concat(t())}function Ic(){var t=oc?"android":rr?"ios":jl?"windows":Yl?"mac":"unknown";if(qe)try{var o=mt.getSystemInfoSync().platform;o!==void 0&&(t=o)}catch(i){}return t}function dr(t,o){t=t.split("."),o=o.split(".");for(var i=Math.max(t.length,o.length);t.length<i;)t.push("0");for(;o.length<i;)o.push("0");for(var s=0;s<i;s++){var c=parseInt(t[s]),l=parseInt(o[s]);if(l<c)return 1;if(c<l)return-1}return 0}function pr(i){var o=i.originUrl,o=o===void 0?void 0:o,s=i.originWidth,c=i.originHeight,i=i.min,i=i===void 0?198:i,s=parseInt(s),c=parseInt(c),l={url:void 0,width:0,height:0};return(s<=c?s:c)<=i?(l.url=o,l.width=s,l.height=c):(c<=s?(l.width=Math.ceil(s*i/c),l.height=i):(l.width=i,l.height=Math.ceil(c*i/s)),c=o&&-1<o.indexOf("?")?"".concat(o,"&"):"".concat(o,"?"),l.url="".concat(c,i===198?"imageView2/3/w/198/h/198":"imageView2/3/w/720/h/720")),q(o)?(l.url,ae(l,zl)):l}function gr(t){var o=t[2];t[2]=t[1],t[1]=o;for(var i=0;i<t.length;i++)t[i].setType(i)}function ao(t){return t=t.servcmd,t.slice(t.indexOf(".")+1)}function uo(t,o){return Math.round(Number(t)*Math.pow(10,o))/Math.pow(10,o)}function Mc(t,o){return t.includes(o)}function vn(t,o){return t.includes(o)}function un(t){return t.split(Pa)[0]}var Qi=function(t,o,i){if(q(o))return"";switch(t){case O.MSG_TEXT:return o.text;case O.MSG_IMAGE:return i?"[Image]":"[\u56FE\u7247]";case O.MSG_LOCATION:return i?"[Location]":"[\u4F4D\u7F6E]";case O.MSG_AUDIO:return i?"[Voice]":"[\u8BED\u97F3]";case O.MSG_VIDEO:return i?"[Video]":"[\u89C6\u9891]";case O.MSG_FILE:return i?"[File]":"[\u6587\u4EF6]";case O.MSG_CUSTOM:return i?"[Custom Messages]":"[\u81EA\u5B9A\u4E49\u6D88\u606F]";case O.MSG_GRP_TIP:return i?"[Group Notification]":"[\u7FA4\u63D0\u793A\u6D88\u606F]";case O.MSG_GRP_SYS_NOTICE:return i?"[Group System Message]":"[\u7FA4\u7CFB\u7EDF\u901A\u77E5]";case O.MSG_FACE:return i?"[Animated Sticker]":"[\u52A8\u753B\u8868\u60C5]";case O.MSG_MERGER:return i?"[Chat Record]":"[\u804A\u5929\u8BB0\u5F55]";default:return""}};function Fa(t){return t===O.MSG_TEXT||t===O.MSG_CUSTOM||t===O.MSG_LOCATION||t===O.MSG_FACE}function Zi(t){var o=[];if(!Ee(t))return o;var i=t.length;if(i===0)return o;for(var s=i-1;0<=s;s--)t[s]==="1"&&o.push(Math.pow(2,i-s-1));return o}function Ko(){return!ac&&!qe}function ni(t){return"the length of userIDList cannot exceed ".concat(t)}function Cc(t){var o;if(ye(t)&&t.length!==0)return o=0,t.forEach(function(i){o+=i}),o.toFixed(0)}function kn(t){var o;if(ye(t)&&t.length!==0)return o=0,t.forEach(function(i){o+=i}),(o/t.length).toFixed(0)}function An(t,s,c){var s=!(1<arguments.length&&s!==void 0)||s,c=!(2<arguments.length&&c!==void 0)||c,l=Date.now();return s?c?"".concat(l-t," ms"):"".concat(Math.round((l-t)/1e3)," s"):c?l-t:Math.round((l-t)/1e3)}function Tc(t){return!!(t&&1<t)}function Wo(t,o,i,s){if(o===void 0)return 1;var c,l,p=!0;return o.required&&Te(t)&&(E.e("[".concat(i,'] Missing required params: "').concat(s,'".')),p=!1),Te(t)||(c=yo(t))!==(l=o.type.toLowerCase())&&(c==="asyncfunction"&&l==="function"||(E.e("[".concat(i,'] Invalid params: type check failed for "').concat(s,'". Expected ').concat(o.type,".")),p=!1)),o.validator&&!o.validator(t,i,s)&&(E.e("[".concat(i,'] Invalid params: custom validator check failed for "').concat(s,'".')),p=!1),p}function Ie(t){return!!t&&(!!(Bt(t)||wn(t)||Xi(t))||((t=b("InvalidConversationID",t))&&E.w(t),!1))}function ve(t){t.desc!==""&&b("API_REFER")!==""&&E.w("[".concat(t.api,"] | ").concat(t.paramName," | ").concat(t.desc,", ").concat(b("API_REFER")).concat(t.api))}function Kn(){return b("StringRequiredLog")}function Ao(t){return b("NonEmptyStringRequiredLog",t)}function oi(){return b("NumberRequiredLog")}function mi(){return b("UndefinedNotAllowedLog")}function Io(){return b("FileRequiredLog")}function yn(){return b("FunctionRequiredLog")}function En(){return b("ArrayRequiredLog")}function Mo(){return b("NonEmptyArrayLog")}function xa(){return b("CallbackMissingLog")}function ii(){return b("PositiveIntegerRequiredLog")}function jo(t,o){return b("StringNotLongerThanLog",t,o)}function qa(t,o){return b("NumberGreaterThanLog",t,o)}function lo(t,o){return b("NumberGreaterOrEqualLog",t,o)}function Va(t){return b("KeyValueStringRequiredLog",t)}function Xn(){return b("PlainObjectRequiredLog")}function Ba(){return b("NonEmptyContentRequiredLog")}function Oo(){return b("FileNotSelectedLog")}function ea(){return b("MessageInstanceRequiredLog")}function vi(){return b("NonAnonymousFunctionLog")}function hr(){return b("MessageExtensionNotAvailableLog")}function be(){return b("MessageReactionRequiredLog")}function Ke(t,o){return b("ContainsUnsupportedTypeLog",t,o)}function j(t,o,i,p){var c=p.allowUndefined,l=p.allowEmpty,p=p.maxLength;return q(t)?!!c||(ve({api:o,paramName:i,desc:mi()}),!1):ye(t)?!(t.length===0&&(ve({api:o,paramName:i,desc:Mo()}),!l)||p&&t.length>p&&(ve({api:o,paramName:i,desc:b("MaximumArrayLengthLog",i,p)}),1)):(ve({api:o,paramName:i,desc:En()}),!1)}function ta(t,o,i,p){var c=p.allowUndefined,l=p.min,p=p.max;return q(t)?!!c||(ve({api:o,paramName:i,desc:mi()}),!1):ut(t)?ut(l)&&t<l?(ve({api:o,paramName:i,desc:l===0?lo(i,l):qa(i,l-1)}),!1):!(ut(p)&&p<t&&(ve({api:o,paramName:i,desc:b("MaximumNumberLog",i,p)}),1)):(ve({api:o,paramName:i,desc:oi()}),!1)}function Ae(t){return{code:0,data:t||{}}}function we(t){return Promise.resolve(Ae(t))}function W(t){var o=1<arguments.length&&arguments[1]!==void 0&&arguments[1];if(t instanceof Gt)return o&&po!==null&&po.emit(Me.ERROR,t),Promise.reject(t);if(t instanceof Error)return i=new Gt({code:Q.UNCAUGHT_ERROR}),o&&po!==null&&po.emit(Me.ERROR,i),Promise.reject(i);if(q(t)||q(t.code))return Promise.reject(new Gt({code:Q.UNCAUGHT_ERROR}));var i=new Gt(t);return o&&po!==null&&po.emit(Me.ERROR,i),Promise.reject(i)}var No,Ha="unSend",Jn="success",ai="fail",On="notStart",an="pending",Rt="resolved",yi="rejected",ie={type:"String",required:!0},ht={type:"Array",required:!0},xe={type:"Object",required:!0},X={type:"Boolean",required:!0},Ht={type:"number",required:!0},dn={keywordListForMsg:{type:"Array",required:!1,validator:function(t,o,i){return j(t,o,i,{allowUndefined:!0,allowEmpty:!0,maxLength:5})}},keywordListExceptMsg:{type:"Array",required:!0,validator:function(t,o,i){return j(t,o,i,{allowUndefined:!1,allowEmpty:!1,maxLength:5})}},keywordListMatchType:{type:"String",required:!1,validator:function(t,o,i){return!t||t==="or"||t==="and"||ve({api:o,paramName:i,desc:"".concat(t," is invalid match type")})}},cursor:{type:"String",required:!1},count:{type:"Number",required:!1,validator:function(t,o,i){return ta(t,o,i,{allowUndefined:!0,min:1,max:100})}},groupTypeList:{type:"Array",required:!1,validator:function(t,o,i){if(!t)return!0;if(!j(t,o,i,{allowUndefined:!0,allowEmpty:!0}))return!1;var s=[O.GRP_PUBLIC,O.GRP_COMMUNITY,O.GRP_WORK,O.GRP_MEETING];return!(0<t.filter(function(c){return s.indexOf(c)===-1}).length&&(ve({api:o,paramName:i,desc:Ke(i,"group")}),1))}}},b=null,_r={hookGetAPITips:function(t){b=t},login:{userID:ie,userSig:ie},addToBlacklist:{userIDList:ht},removeFromBlacklist:{userIDList:ht},on:[{name:"eventName",type:"String",validator:function(t,o,i){return typeof t=="string"&&t.length!==0||(ve({api:o,paramName:i,desc:Ao(i)}),!1)}},{name:"handler",type:"Function",validator:function(t,o,i){return typeof t!="function"?(ve({api:o,paramName:i,desc:yn()}),!1):(t.name===""&&ve({api:o,paramName:i,desc:vi()}),!0)}}],once:[{name:"eventName",type:"String",validator:function(t,o,i){return typeof t=="string"&&t.length!==0||(ve({api:o,paramName:i,desc:Ao(i)}),!1)}},{name:"handler",type:"Function",validator:function(t,o,i){return typeof t!="function"?(ve({api:o,paramName:i,desc:yn()}),!1):(t.name===""&&ve({api:o,paramName:i,desc:vi()}),!0)}}],off:[{name:"eventName",type:"String",validator:function(t,o,i){return typeof t=="string"&&t.length!==0||(ve({api:o,paramName:i,desc:Ao(i)}),!1)}},{name:"handler",type:"Function",validator:function(t,o,i){return typeof t!="function"?(ve({api:o,paramName:i,desc:yn()}),!1):(t.name===""&&ve({api:o,paramName:i,desc:vi()}),!0)}}],sendMessage:[v({name:"message"},xe)],setMessageExtensions:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return t.status===Jn&&t.isSupportExtension===!0||(ve({api:o,paramName:i,desc:hr()}),!1)}}),v({name:"extensions"},ht)],getMessageExtensions:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return t.status===Jn&&t.isSupportExtension===!0||(ve({api:o,paramName:i,desc:hr()}),!1)}})],deleteMessageExtensions:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return t.status===Jn&&t.isSupportExtension===!0||(ve({api:o,paramName:i,desc:hr()}),!1)}})],addMessageReaction:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return t.status===Jn||(ve({api:o,paramName:i,desc:be()}),!1)}}),v({name:"reactionID"},ie)],removeMessageReaction:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return t.status===Jn||(ve({api:o,paramName:i,desc:be()}),!1)}}),v({name:"reactionID"},ie)],getMessageReactions:{messageList:v({},ht)},getAllUserListOfMessageReaction:{message:v(v({},xe),{},{validator:function(t,o,i){return t.status===Jn||(ve({api:o,paramName:i,desc:be()}),!1)}}),reactionID:v({},ie),nextSeq:{type:"Number"},count:{type:"Number"}},getMessageList:{conversationID:v(v({},ie),{},{validator:Ie}),nextReqMessageID:{type:"String"},count:{type:"Number",validator:function(t,o,i){return!(!q(t)&&!/^[1-9][0-9]*$/.test(t)&&(ve({api:o,paramName:i,desc:ii()}),1))}}},getMessageListHopping:{conversationID:v(v({},ie),{},{validator:Ie}),sequence:{type:"Number"},time:{type:"Number"},direction:{type:"Number",validator:function(t,o,i){return!(!q(t)&&t!==0&&t!==1&&(ve({api:o,paramName:i,desc:b("0Or1RequiredLog")}),1))}},count:{type:"Number",validator:function(t,o,i){return!(!q(t)&&!/^[1-9][0-9]*$/.test(t)&&(ve({api:o,paramName:i,desc:ii}),1))}}},setMessageRead:{conversationID:v(v({},ie),{},{validator:Ie})},setAllMessageRead:{scope:{type:"String",required:!1,validator:function(t,o,i){return!t||[O.READ_ALL_C2C_MSG,O.READ_ALL_GROUP_MSG,O.READ_ALL_MSG].indexOf(t)!==-1||(ve({api:o,paramName:i,desc:b("ValidScopeRequired")}),!1)}}},getConversationProfile:[v(v({name:"conversationID"},ie),{},{validator:Ie})],clearHistoryMessage:[v(v({name:"conversationID"},ie),{},{validator:Ie})],pinConversation:{conversationID:v(v({},ie),{},{validator:Ie}),isPinned:v({},X)},setConversationDraft:{conversationID:v(v({},ie),{},{validator:Ie}),draftText:{type:"String",validator:function(t,o,i){return!!Ee(t)||(ve({api:o,paramName:i,desc:Kn()}),!1)}}},setConversationCustomData:{conversationIDList:v({},ht),customData:{type:"String",validator:function(t,o,i){return Ee(t)?!(256<t.length&&(ve({api:o,paramName:i,desc:jo(i,256)}),1)):(ve({api:o,paramName:i,desc:Kn()}),!1)}}},markConversation:{conversationIDList:v({},ht),markType:{type:"number",validator:function(t,o,i){return ut(t)?t<=0?(ve({api:o,paramName:i,desc:qa(i,0)}),!1):!(t>=Math.pow(2,64)&&(ve({api:o,paramName:i,desc:b("NumberLessThanLog",i,"Math.pow(2,64)")}),1)):(ve({api:o,paramName:i,desc:oi()}),!1)}},enableMark:v({},X)},createConversationGroup:{conversationIDList:v({},ht),groupName:v(v({},ie),{},{validator:function(t,o,i){return!(!t||32<t.length&&(ve({api:o,paramName:i,desc:jo(i,32)}),1))}})},deleteConversationGroup:[v({name:"groupName"},ie)],renameConversationGroup:{oldName:v({},ie),newName:v(v({},ie),{},{validator:function(t,o,i){return!(!t||32<t.length&&(ve({api:o,paramName:i,desc:jo(i,32)}),1))}})},addConversationsToGroup:{conversationIDList:v({},ht),groupName:v({},ie)},deleteConversationsFromGroup:{conversationIDList:v({},ht),groupName:v({},ie)},getGroupList:{groupProfileFilter:{type:"Array"}},getGroupProfile:{groupID:ie,groupCustomFieldFilter:{type:"Array"},memberCustomFieldFilter:{type:"Array"}},getGroupProfileAdvance:{groupIDList:ht},createGroup:{name:ie},joinGroup:{groupID:ie,type:{type:"String"},applyMessage:{type:"String"}},quitGroup:[v({name:"groupID"},ie)],handleApplication:{message:xe,handleAction:ie,handleMessage:{type:"String"}},changeGroupOwner:{groupID:ie,newOwnerID:ie},updateGroupProfile:{groupID:ie,muteAllMembers:{type:"Boolean"}},dismissGroup:[v({name:"groupID"},ie)],searchGroupByID:[v({name:"groupID"},ie)],getGroupOnlineMemberCount:[v({name:"groupID"},ie)],initGroupAttributes:{groupID:ie,groupAttributes:v(v({},xe),{},{validator:function(t,o,i){var s=!0;return Object.keys(t).forEach(function(c){if(!Ee(t[c]))return ve({api:o,paramName:i,desc:Va("value")}),s=!1}),s}})},setGroupAttributes:{groupID:ie,groupAttributes:v(v({},xe),{},{validator:function(t,o,i){var s=!0;return Object.keys(t).forEach(function(c){if(!Ee(t[c]))return ve({api:o,paramName:i,desc:Va("value")}),s=!1}),s}})},deleteGroupAttributes:{groupID:ie,keyList:{type:"Array",validator:function(t,o,i){return q(t)||!ye(t)?(ve({api:o,paramName:i,desc:En()}),!1):!!Te(t)||(s=!0,t.forEach(function(c){if(!Ee(c))return ve({api:o,paramName:i,desc:b("StringArrayRequiredLog")}),s=!1}),s);var s}}},getGroupAttributes:{groupID:ie,keyList:{type:"Array",validator:function(t,o,i){return q(t)||!ye(t)?(ve({api:o,paramName:i,desc:En()}),!1):!!Te(t)||(s=!0,t.forEach(function(c){if(!Ee(c))return ve({api:o,paramName:i,desc:Va("key")}),s=!1}),s);var s}}},setGroupCounters:{groupID:ie,counters:xe},increaseGroupCounter:{groupID:ie,key:ie,value:Ht},decreaseGroupCounter:{groupID:ie,key:ie,value:Ht},getGroupCounters:{groupID:ie},getGroupMemberList:{groupID:ie,count:{type:"Number"}},getGroupMemberProfile:{groupID:ie,userIDList:ht,memberCustomFieldFilter:{type:"Array"}},addGroupMember:{groupID:ie,userIDList:ht},setGroupMemberRole:{groupID:ie,userID:ie,role:ie},setGroupMemberMuteTime:{groupID:ie,userID:ie,muteTime:{type:"Number",validator:function(t){return 0<=t}}},setGroupMemberNameCard:{groupID:ie,userID:{type:"String"},nameCard:{type:"String",validator:function(t,o,i){return Ee(t)?(t.length,!0):(ve({api:o,paramName:i,desc:Kn()}),!1)}}},setGroupMemberCustomField:{groupID:ie,userID:{type:"String"},memberCustomField:ht},deleteGroupMember:{groupID:ie},markGroupMemberList:{groupID:ie,markType:{type:"number",validator:function(t,o,i){return ut(t)?!(t<1e3&&(ve({api:o,paramName:i,desc:lo(i,1e3)}),1)):(ve({api:o,paramName:i,desc:oi()}),!1)}},userIDList:v({},ht),enableMark:v({},X)},createTextMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){return It(t)?Ee(t.text)?t.text.length!==0||(ve({api:o,paramName:"payload.text",desc:Ba()}),!1):(ve({api:o,paramName:"payload.text",desc:Kn()}),!1):(ve({api:o,paramName:i,desc:Xn()}),!1)}})},createTextAtMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){return It(t)?Ee(t.text)?t.text.length===0?(ve({api:o,paramName:"payload.text",desc:Ba()}),!1):!(t.atUserList&&!ye(t.atUserList)&&(ve({api:o,paramName:"payload.atUserList",desc:En()}),1)):(ve({api:o,paramName:"payload.text",desc:Kn()}),!1):(ve({api:o,paramName:i,desc:Xn()}),!1)}})},createCustomMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){return It(t)?t.data&&!Ee(t.data)?(ve({api:o,paramName:"payload.data",desc:Kn()}),!1):t.description&&!Ee(t.description)?(ve({api:o,paramName:"payload.description",desc:Kn()}),!1):!(t.extension&&!Ee(t.extension)&&(ve({api:o,paramName:"payload.extension",desc:Kn()}),1)):(ve({api:o,paramName:"payload",desc:Xn()}),!1)}})},createImageMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){if(!It(t))return ve({api:o,paramName:i,desc:Xn()}),!1;if(q(t.file))return ve({api:o,paramName:"payload.file",desc:mi()}),!1;if($t){if(!(t.file instanceof HTMLInputElement||ko(t.file)))return It(t.file)&&typeof uni!="undefined"?t.file.tempFilePaths.length!==0&&t.file.tempFiles.length!==0||(ve({api:o,paramName:"payload.file",desc:Oo()}),!1):(ve({api:o,paramName:"payload.file",desc:Io()}),!1);if(t.file instanceof HTMLInputElement&&t.file.files.length===0)return ve({api:o,paramName:"payload.file",desc:Oo()}),!1}return!0},onProgress:{type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:xa()}),!0}}})},createAudioMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){return!!It(t)||(ve({api:o,paramName:i,desc:Xn()}),!1)}}),onProgress:{type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:xa()}),!0}}},createVideoMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){if(!It(t))return ve({api:o,paramName:i,desc:Xn()}),!1;if(q(t.file))return ve({api:o,paramName:"payload.file",desc:mi()}),!1;if($t){if(!(t.file instanceof HTMLInputElement||ko(t.file)))return It(t.file)&&typeof uni!="undefined"?!!ko(t.file.tempFile)||(ve({api:o,paramName:"payload.file",desc:Oo()}),!1):(ve({api:o,paramName:"payload.file",desc:Io()}),!1);if(t.file instanceof HTMLInputElement&&t.file.files.length===0)return ve({api:o,paramName:"payload.file",desc:Oo()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:xa()}),!0}}},createFaceMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){return It(t)?ut(t.index)?!!Ee(t.data)||(ve({api:o,paramName:"payload.data",desc:Kn()}),!1):(ve({api:o,paramName:"payload.index",desc:oi()}),!1):(ve({api:o,paramName:i,desc:Xn()}),!1)}})},createFileMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){if(!It(t))return ve({api:o,paramName:i,desc:Xn()}),!1;if(q(t.file))return ve({api:o,paramName:"payload.file",desc:mi()}),!1;if($t){if(!(t.file instanceof HTMLInputElement||ko(t.file)))return It(t.file)&&typeof uni!="undefined"?t.file.tempFilePaths.length!==0&&t.file.tempFiles.length!==0||(ve({api:o,paramName:"payload.file",desc:Oo()}),!1):(ve({api:o,paramName:"payload.file",desc:Io()}),!1);if(t.file instanceof HTMLInputElement&&t.file.files.length===0)return ve({api:o,paramName:"payload.file",desc:Oo()}),!1}return!0}}),onProgress:{type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:xa()}),!0}}},createLocationMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){return It(t)?Ee(t.description)?ut(t.longitude)?!!ut(t.latitude)||(ve({api:o,paramName:"payload.latitude",desc:oi()}),!1):(ve({api:o,paramName:"payload.longitude",desc:oi()}),!1):(ve({api:o,paramName:"payload.description",desc:Kn()}),!1):(ve({api:o,paramName:i,desc:Xn()}),!1)}})},createMergerMessage:{to:ie,conversationType:ie,payload:v(v({},xe),{},{validator:function(t,o,i){if(Te(t.messageList))return ve({api:o,paramName:"payload.messageList",desc:Mo()}),!1;if(Te(t.compatibleText))return ve({api:o,paramName:"payload.compatibleText",desc:Ao("compatibleText")}),!1;var s=!1;return t.messageList.forEach(function(c){c.status===ai&&(s=!0)}),!s||(ve({api:o,paramName:"payload.messageList",desc:b("MergeFailedMessageLog")}),!1)}})},revokeMessage:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return Te(t)?(ve({api:o,paramName:i,desc:ea()}),!1):t.conversationType===O.CONV_SYSTEM?(ve({api:o,paramName:i,desc:b("MessageCanBeRevokedDesc")}),!1):t.isRevoked!==!0||(ve({api:o,paramName:i,desc:b("MessageRevokedLog")}),!1)}})],deleteMessage:[v(v({name:"messageList"},ht),{},{validator:function(t,o,i){return!Te(t)||(ve({api:o,paramName:i,desc:Mo()}),!1)}})],translateText:{sourceTextList:ht,sourceLanguage:ie,targetLanguage:ie},convertVoiceToText:{message:v(v({},xe),{},{validator:function(t,o,i){return Te(t)?(ve({api:o,paramName:i,desc:ea()}),!1):t.type===O.MSG_AUDIO&&t.status===Jn||(ve({api:o,paramName:i,desc:b("AudioMessageRequiredLog")}),!1)}})},modifyMessage:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return Te(t)?(ve({api:o,paramName:i,desc:ea()}),!1):t.conversationType===O.CONV_SYSTEM?(ve({api:o,paramName:i,desc:b("MessageCanBeModifiedLog")}),!1):t._onlineOnlyFlag!==!0||(ve({api:o,paramName:i,desc:b("OnlineMessageNotSupportLog")}),!1)}})],searchCloudMessages:{keywordList:dn.keywordListForMsg,keywordListMatchType:dn.keywordListMatchType,cursor:dn.cursor,senderUserIDList:{type:"Array",required:!1,validator:function(t,o,i){return j(t,o,i,{allowUndefined:!0,allowEmpty:!0,maxLength:5})}},messageTypeList:{type:"Array",required:!1,validator:function(t,o,i){if(!t)return!0;if(!j(t,o,i,{allowUndefined:!0,allowEmpty:!0}))return!1;var s=[O.MSG_TEXT,O.MSG_IMAGE,O.MSG_AUDIO,O.MSG_FILE,O.MSG_VIDEO,O.MSG_LOCATION,O.MSG_CUSTOM,O.MSG_MERGER];return!(0<t.filter(function(c){return s.indexOf(c)===-1}).length&&(ve({api:o,paramName:i,desc:Ke(i,"message")}),1))}},conversationID:{type:"String",required:!1,validator:function(t){return!t||Ie(t)}},timePosition:{type:"number",required:!1,validator:function(t,o,i){return ta(t,o,i,{allowUndefined:!0,min:0})}},timePeriod:{type:"number",required:!1,validator:function(t,o,i){return ta(t,o,i,{allowUndefined:!0,min:0})}}},searchCloudUsers:{keywordList:dn.keywordListExceptMsg,keywordListMatchType:dn.keywordListMatchType,cursor:dn.cursor,count:dn.count,miniBirthday:{type:"Number",required:!1,validator:function(t,o,i){return ta(t,o,i,{allowUndefined:!0,min:0})}},maxBirthday:{type:"Number",required:!1,validator:function(t,o,i){return ta(t,o,i,{allowUndefined:!0,min:0})}},gender:{type:"String",required:!1,validator:function(t,o,i){return!t||t===O.GENDER_FEMALE||t===O.GENDER_MALE||ve({api:o,paramName:i,desc:"".concat(t," is invalid match type")})}}},searchCloudGroups:{keywordList:dn.keywordListExceptMsg,keywordListMatchType:dn.keywordListMatchType,cursor:dn.cursor,count:dn.count,groupTypeList:dn.groupTypeList},searchCloudGroupMembers:{keywordList:dn.keywordListExceptMsg,keywordListMatchType:dn.keywordListMatchType,cursor:dn.cursor,count:dn.count,groupTypeList:dn.groupTypeList,groupIDList:{type:"Array",required:!1,validator:function(t,o,i){return j(t,o,i,{allowUndefined:!0,allowEmpty:!0})}}},getUserProfile:{userIDList:{type:"Array",validator:function(t,o,i){return ye(t)?(t.length===0&&ve({api:o,paramName:i,desc:Mo()}),!0):(ve({api:o,paramName:i,desc:En()}),!1)}}},updateMyProfile:{profileCustomField:{type:"Array",validator:function(t,o,i){return!!q(t)||!!ye(t)||(ve({api:o,paramName:i,desc:En()}),!1)}}},setSelfStatus:{customStatus:{type:"String",validator:function(t,o,i){return!!Ee(t)||(ve({api:o,paramName:i,desc:Kn()}),!1)}}},getUserStatus:{userIDList:{type:"Array",validator:function(t,o,i){return ye(t)?t.length!==0||(ve({api:o,paramName:i,desc:Mo()}),!1):(ve({api:o,paramName:i,desc:En()}),!1)}}},subscribeUserStatus:{userIDList:{type:"Array",validator:function(t,o,i){return ye(t)?t.length!==0||(ve({api:o,paramName:i,desc:Mo()}),!1):(ve({api:o,paramName:i,desc:En()}),!1)}}},unsubscribeUserStatus:{userIDList:{type:"Array",validator:function(t,o,i){return!t||!!ye(t)||(ve({api:o,paramName:i,desc:En()}),!1)}}},addFriend:{to:ie,source:{type:"String",required:!0,validator:function(t,o,i){return!(!t||(t.startsWith("AddSource_Type_")?8<t.replace("AddSource_Type_","").length&&(ve({api:o,paramName:i,desc:jo("keyword",8)}),1):(ve({api:o,paramName:i,desc:b("SourcePrefixLog")}),1)))}},remark:{type:"String",required:!1,validator:function(t,o,i){return!(Ee(t)&&96<t.length&&(ve({api:o,paramName:i,desc:jo(i,96)}),1))}}},deleteFriend:{userIDList:ht},checkFriend:{userIDList:ht},getFriendProfile:{userIDList:ht},updateFriend:{userID:ie,remark:{type:"String",required:!1,validator:function(t,o,i){return!(Ee(t)&&96<t.length&&(ve({api:o,paramName:i,desc:jo(i,96)}),1))}},friendCustomField:{type:"Array",required:!1,validator:function(t,o,i){if(t){if(!ye(t))return ve({api:o,paramName:i,desc:En()}),!1;var s=!0;return t.forEach(function(c){return Ee(c.key)&&c.key.indexOf("Tag_SNS_Custom")!==-1?Ee(c.value)?8<c.key.replace("Tag_SNS_Custom_","").length?(ve({api:o,paramName:i,desc:jo("keyword",8)}),s=!1):void 0:(ve({api:o,paramName:i,desc:Va("value")}),s=!1):(ve({api:o,paramName:i,desc:b("FriendCustomFieldPrefixLog")}),s=!1)}),s}return!0}}},acceptFriendApplication:{userID:ie},refuseFriendApplication:{userID:ie},deleteFriendApplication:{userID:ie},createFriendGroup:{name:ie},deleteFriendGroup:{name:ie},addToFriendGroup:{name:ie,userIDList:ht},removeFromFriendGroup:{name:ie,userIDList:ht},renameFriendGroup:{oldName:ie,newName:ie},sendMessageReadReceipt:[{name:"messageList",type:"Array",validator:function(t,o,i){return ye(t)?t.length!==0||(ve({api:o,paramName:i,desc:Mo()}),!1):(ve({api:o,paramName:i,desc:En()}),!1)}}],getMessageReadReceiptList:[{name:"messageList",type:"Array",validator:function(t,o,i){return ye(t)?t.length!==0||(ve({api:o,paramName:i,desc:Mo()}),!1):(ve({api:o,paramName:i,desc:En()}),!1)}}],createTopicInCommunity:{groupID:ie,topicName:ie},deleteTopicFromCommunity:{groupID:ie,topicIDList:{type:"Array",validator:function(t,o,i){return!t||!!ye(t)||(ve({api:o,paramName:i,desc:En()}),!1)}}},updateTopicProfile:{groupID:ie,topicID:ie},getTopicList:{groupID:ie,topicIDList:{type:"Array",validator:function(t,o,i){return!t||!!ye(t)||(ve({api:o,paramName:i,desc:En()}),!1)}}},followUser:[v({name:"userIDList"},ht)],unfollowUser:[v({name:"userIDList"},ht)],getMyFollowingList:[v(v({name:"startIndex"},ie),{},{required:!1})],getMyFollowersList:[v(v({name:"startIndex"},ie),{},{required:!1})],getMutualFollowersList:[v(v({name:"startIndex"},ie),{},{required:!1})],getUserFollowInfo:[v(v({name:"userIDList"},ht),{},{required:!1})],checkFollowType:[v({name:"userIDList"},ht)],addSignalingListener:[{name:"eventName",type:"String",validator:function(t,o,i){return typeof t=="string"&&t.length!==0||(ve({api:o,paramName:i,desc:Ao(i)}),!1)}},{name:"handler",type:"Function",validator:function(t,o,i){return typeof t!="function"?(ve({api:o,paramName:i,desc:yn()}),!1):(t.name===""&&ve({api:o,paramName:i,desc:vi()}),!0)}}],removeSignalingListener:[{name:"eventName",type:"String",validator:function(t,o,i){return typeof t=="string"&&t.length!==0||(ve({api:o,paramName:i,desc:Ao(i)}),!1)}},{name:"handler",type:"Function",validator:function(t,o,i){return typeof t!="function"?(ve({api:o,paramName:i,desc:yn()}),!1):(t.name===""&&ve({api:o,paramName:i,desc:vi()}),!0)}}],invite:{userID:ie},inviteSync:[v(v({},xe),{},{validator:function(t,o,i){return It(t)?!!Ee(t.userID)||(ve({api:o,paramName:"options.userID",desc:Kn()}),!1):(ve({api:o,paramName:"options",desc:Xn()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:yn()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:yn()}),!0}}],inviteInGroup:{groupID:ie,inviteeList:ht},inviteInGroupSync:[v(v({},xe),{},{validator:function(t,o,i){return It(t)?Ee(t.groupID)?!!ye(t.inviteeList)||(ve({api:o,paramName:"options.inviteeList",desc:En()}),!1):(ve({api:o,paramName:"options.groupID",desc:Kn()}),!1):(ve({api:o,paramName:"options",desc:Xn()}),!1)}}),{name:"successCb",type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:yn()}),!0}},{name:"errorCb",type:"Function",required:!1,validator:function(t,o,i){return q(t)&&ve({api:o,paramName:i,desc:yn()}),!0}}],accept:{inviteID:ie},reject:{inviteID:ie},getSignalingInfo:[v(v({name:"message"},xe),{},{validator:function(t,o,i){return!Te(t)||(ve({api:o,paramName:i,desc:ea()}),!1)}})],modifyInvitation:{inviteID:ie,data:ie}},Sc={login:1,logout:1,getLoginUser:1,getServerTime:1,on:1,once:1,off:1,setLogLevel:1,registerPlugin:1,destroy:1,isReady:1,createTextMessage:1,createTextAtMessage:1,createImageMessage:1,createAudioMessage:1,createVideoMessage:1,createCustomMessage:1,createFaceMessage:1,createFileMessage:1,createLocationMessage:1,createMergerMessage:1,downloadMergerMessage:1,createForwardMessage:1,sendMessage:1,resendMessage:1,revokeMessage:1,deleteMessage:1,translateText:1,convertVoiceToText:1,modifyMessage:1,sendMessageReadReceipt:1,getGroupMessageReadMemberList:1,getMessageReadReceiptList:1,setMessageExtensions:1,getMessageExtensions:1,deleteMessageExtensions:1,addMessageReaction:1,removeMessageReaction:1,getMessageReactions:1,getAllUserListOfMessageReaction:1,getMessageList:1,findMessage:1,getMessageListHopping:1,setMessageRead:1,setAllMessageRead:1,getConversationList:1,getConversationProfile:1,deleteConversation:1,setConversationDraft:1,pinConversation:1,getTotalUnreadMessageCount:1,setConversationCustomData:1,markConversation:1,createConversationGroup:1,getConversationGroupList:1,deleteConversationGroup:1,renameConversationGroup:1,addConversationsToGroup:1,deleteConversationsFromGroup:1,clearHistoryMessage:1,setMessageRemindType:1,setAllReceiveMessageOpt:1,getAllReceiveMessageOpt:1,getGroupList:1,getGroupProfile:1,createGroup:1,joinGroup:1,updateGroupProfile:1,quitGroup:1,dismissGroup:1,changeGroupOwner:1,searchGroupByID:1,getGroupApplicationList:1,handleGroupApplication:1,initGroupAttributes:1,setGroupAttributes:1,deleteGroupAttributes:1,getGroupAttributes:1,setGroupCounters:1,increaseGroupCounter:1,decreaseGroupCounter:1,getGroupCounters:1,getJoinedCommunityList:1,createTopicInCommunity:1,deleteTopicFromCommunity:1,updateTopicProfile:1,getTopicList:1,getGroupMemberProfile:1,getGroupMemberList:1,addGroupMember:1,deleteGroupMember:1,setGroupMemberNameCard:1,setGroupMemberMuteTime:1,setGroupMemberRole:1,setGroupMemberCustomField:1,getGroupOnlineMemberCount:1,markGroupMemberList:1,getMyProfile:1,getUserProfile:1,updateMyProfile:1,setSelfStatus:1,getUserStatus:1,subscribeUserStatus:1,unsubscribeUserStatus:1,getBlacklist:1,addToBlacklist:1,removeFromBlacklist:1,searchCloudMessages:1,searchCloudUsers:1,searchCloudGroups:1,searchCloudGroupMembers:1,getFriendList:1,addFriend:1,deleteFriend:1,checkFriend:1,updateFriend:1,getFriendProfile:1,getFriendApplicationList:1,refuseFriendApplication:1,deleteFriendApplication:1,acceptFriendApplication:1,setFriendApplicationRead:1,getFriendGroupList:1,createFriendGroup:1,renameFriendGroup:1,deleteFriendGroup:1,addToFriendGroup:1,removeFromFriendGroup:1,followUser:1,unfollowUser:1,getMyFollowingList:1,getMyFollowersList:1,getMutualFollowersList:1,getUserFollowInfo:1,checkFollowType:1,callExperimentalAPI:1,addSignalingListener:1,removeSignalingListener:1,invite:1,inviteSync:1,inviteInGroup:1,inviteInGroupSync:1,cancel:1,accept:1,reject:1,getSignalingInfo:1,modifyInvitation:1},Gt=(z(ia,de(Error)),No=J(ia),V(ia)),Q={NO_SDKAPPID:2e3,NO_ACCOUNT_TYPE:2001,NO_IDENTIFIER:2002,NO_USERSIG:2003,NO_TINYID:2022,NO_A2KEY:2023,USER_NOT_LOGGED_IN:2024,REPEAT_LOGIN:2025,COS_UNDETECTED:2040,COS_GET_SIG_FAIL:2041,MSG_SEND_FAIL:2100,MSG_SEND_FAIL_NOT_IN_AV:2101,MSG_INSTANCE_REQUIRED:2105,MSG_INVALID_CONV_TYPE:2106,MSG_F_IS_EMPTY:2108,MSG_ONPROGRESS_ERR:2109,MSG_REVOKE_FAIL:2110,MSG_DELETE_FAIL:2111,MSG_UNREAD_ALL_FAIL:2112,READ_RECEIPT_MSG_LIST_EMPTY:2114,MSG_SEND_GRP_WITH_TOPIC_FAIL:2115,CANNOT_DELETE_GRP_SYSTEM_NOTICE:2116,TRANSLATE_TEXT_FAIL:2117,VOICE_TO_TEXT_FAIL:2118,UNSUPPORTED_VOICE_FORMAT:2119,MSG_I_SELECT_F_FIRST:2251,MSG_I_TYPES_LIMIT:2252,MSG_I_SIZE_LIMIT:2253,MSG_A_UPLOAD_FAIL:2300,MSG_A_SIZE_LIMIT:2301,MSG_V_UPLOAD_FAIL:2350,MSG_V_SIZE_LIMIT:2351,MSG_V_TYPES_LIMIT:2352,MSG_F_UPLOAD_FAIL:2400,MSG_F_SELECT_F_FIRST:2401,MSG_F_SIZE_LIMIT:2402,MSG_F_URL_IS_EMPTY:2403,MSG_MERGER_TYPE_INVALID:2450,MSG_MERGER_KEY_INVALID:2451,MSG_MERGER_DOWNLOAD_FAIL:2452,MSG_FORWARD_TYPE_INVALID:2453,MSG_FORWARD_INVALID_ELEMENTS:2454,MSG_MODIFY_CONFLICT:2480,MSG_MODIFY_DISABLED_IN_AV:2481,CONV_NOT_FOUND:2500,USER_OR_GRP_NOT_FOUND:2501,CONV_UN_RECORDED_TYPE:2502,INVALID_CONV_ID:2503,ILLEGAL_GRP_TYPE:2600,ILLEGAL_GRP_ID:2602,CANNOT_FIND_GRP:2603,CANNOT_CHANGE_OWNER_IN_AV:2620,CANNOT_CHANGE_OWNER_TO_SELF:2621,MEMBER_NOT_IN_GRP:2623,JOIN_GRP_FAIL:2660,CANNOT_ADD_MEMBER_IN_AV:2661,CANNOT_JOIN_NON_AV_WITHOUT_LOGIN:2662,NOT_OWNER:2681,INVALID_MEMBER_ROLE:2683,CANNOT_SET_SELF_MEMBER_ROLE:2684,CANNOT_MUTE_SELF:2685,BAN_DURATION_INVALID:2686,OPERATION_NOT_SUPPORTED_IN_AV:2687,NOT_MY_FRIEND:2700,ALREADY_MY_FRIEND:2701,FRIEND_GRP_EXISTED:2710,FRIEND_GRP_NOT_EXIST:2711,FRIEND_APPLICATION_NOT_EXIST:2716,UPDATE_PROFILE_INVALID_PARAM:2721,UPDATE_PROFILE_NO_KEY:2722,CANNOT_ADD_SELF_TO_BLACKLIST:2742,NETWORK_ERROR:2800,NETWORK_TIMEOUT:2801,NO_NETWORK:2805,UNCAUGHT_ERROR:2903,INVALID_OPERATION:2905,INVALID_TRTC_CMD:2995,OVER_FREQUENCY_LIMIT:2996,NO_PROTOCOL:2997,NO_MODULE:2998,SDK_IS_NOT_READY:2999,LOGGING_IN:3e3,LOGIN_FAILED:3001,KICKED_OUT_MULT_DEVICE:3002,KICKED_OUT_MULT_ACCOUNT:3003,KICKED_OUT_USERSIG_EXPIRED:3004,LOGGED_OUT:3005,KICKED_OUT_REST_API:3006,ILLEGAL_TOPIC_ID:3021,NO_USE:3122,PROFANITY_FOUND:3123,OPTIONS_IS_EMPTY:3153,MSG_A2KEY_EXPIRED:20002,ACCOUNT_A2KEY_EXPIRED:70001,HELLO_ANSWER_KICKED_OUT:1002,OPEN_SERVICE_OVERLOAD_ERROR:60022,SIGNALING_INVALID_INVITE_ID:8010,SIGNALING_NO_PERMISSION:8011,SIGNALING_ALREADY_EXISTS:8012,INVALID_CANCEL_MESSAGE:8020},po=null,Ht=(V(Ya,[{key:"isLoggedIn",value:function(){return this._m.get(12).isLoggedIn()}},{key:"isOversea",value:function(){return this._m.get(12).isOversea()}},{key:"isPrivateNetWork",value:function(){var t=this._m.get(12);return t.isPrivateNetWork()&&!t.getFileDownloadProxy()}},{key:"getFileDownloadProxy",value:function(){return this._m.get(12).getFileDownloadProxy()}},{key:"getDowloadFileAuthKey",value:function(){return this._m.get(12).getDowloadFileAuthKey()}},{key:"getMyUserID",value:function(){return this._m.get(12).getUserID()}},{key:"getMyTinyID",value:function(){return this._m.get(12).getTinyID()}},{key:"getSDKAppID",value:function(){return this._m.get(12).getSDKAppID()}},{key:"isIntl",value:function(){return this._m.get(12).isIntl()}},{key:"isUsingChatCore",value:function(){return this._m.get(12).isUsingChatCore()}},{key:"isDevMode",value:function(){return this._m.get(12).isDevMode()}},{key:"get",value:function(t){return this._m.get(t)}},{key:"getPlatform",value:function(){return xn}},{key:"getCloudConfig",value:function(t){return this._m.get(23).getCloudConfig(t)}},{key:"emitOEvt",value:function(t,o){this._m.getOEmitInst().emit(t,o)}},{key:"emitIEvt",value:function(t,o){this._m.getIEmitInst().emit(t,o)}},{key:"getIEmitInst",value:function(){return this._m.getIEmitInst()}},{key:"req",value:function(t){return this._m.get(20).req(t)}},{key:"canIUse",value:function(t){return this._m.get(27).canIUse(t)}},{key:"getErrMsg",value:function(t,o,i){return this._m.getErrMsg(t,o,i)}},{key:"warn",value:function(t,o,i){t=this.getErrMsg(t,o,i),t&&E.w(t)}},{key:"noUse",value:function(t){var o=Q.NO_USE;return W({code:o,message:this.getErrMsg(o,t)})}}]),Ya),P={LOGIN:"wslogin",LOGOUT:"wslogout",HELLO:"wshello",KICK_OTHER:"KickOther",SYNC_UNREAD_MSG:"getmsg",SEND_C2C_MSG:"sendmsg",SEND_GRP_MSG:"send_group_msg",GET_USER_PROFILE:"portrait_get_all",UPDATE_MY_PROFILE:"portrait_set",GET_BL:"black_list_get",ADD_TO_BL:"black_list_add",RM_FROM_BL:"black_list_delete",GET_FD_LIST:"friend_get",GET_FD_PROFILE:"friend_get_specified",CHECK_FD:"friend_check",DEL_FD:"friend_delete",ADD_FD:"friend_add",UPDATE_FD:"friend_update",RESPOND_FD_APPLICATION:"friend_response",GET_FD_APPLICATION_LIST:"pendency_get",DEL_FD_APPLICATION:"pendency_delete",REFUSE_FD_APPLICATION:"pendency_refuse",REPORT_FD_APPLICATION:"pendency_report",GET_FD_GRP_LIST:"group_get",CREATE_FD_GRP:"group_add",DEL_FD_GRP:"group_delete",UPDATE_FD_GRP:"group_update",REVOKE_C2C_MSG:"msgwithdraw",SET_C2C_MSG_READ:"msgreaded",SET_C2C_PEER_MUTE_NOTIFICATIONS:"set_c2c_peer_mute_notifications",GET_C2C_PEER_MUTE_NOTIFICATIONS:"get_c2c_peer_mute_notifications",GET_C2C_ROAMING_MSG:"getroammsg",GET_C2C_PEER_READ_TIME:"get_peer_read_time",DEL_C2C_MSG:"delete_c2c_msg_ramble",MODIFY_C2C_MSG:"modify_c2c_msg",MODIFY_C2C_MSG_EXT:"set_key_values",GET_C2C_MSG_EXT:"get_key_values",ADD_C2C_MSG_REACTION:"reaction_add",RM_C2C_MSG_REACTION:"reaction_del",GET_C2C_MSG_REACTIONS:"reaction_multi_stat",GET_C2C_MSG_REACTION_USER_LIST:"reaction_iterate",PAGING_GET_CONV_LIST:"page_get",DEL_CONV:"batch_delete",CLEAR_HISTORY_MSG:"clear_msg",PIN_CONV:"top",DEL_GROUP_AT_TIPS:"deletemsg",SET_CONV_CUSTOM_DATA:"set_conv_custom_data",MARK_CONV:"mark_contact",CREATE_CONV_GRP:"create_contact_group",DEL_CONV_GRP:"del_contact_group",RENAME_CONV_GRP:"update_contact_group",ADD_CONV_TO_GRP:"add_conv_to_group",DEL_CONV_FROM_GRP:"del_conv_from_group",GET_CONV_GRP_LIST:"get_contact_group",SEARCH_CONV_GRP_MARK:"search_contact_group",GET_GRP_LIST:"get_joined_group_list",GET_GRP_PROFILE:"get_group_self_member_info",CREATE_GRP:"create_group",DISMISS_GRP:"destroy_group",UPDATE_GRP_PROFILE:"modify_group_base_info",APPLY_JOIN_GRP:"apply_join_group",APPLY_JOIN_GRP_NOAUTH:"apply_join_group_noauth",QUIT_GRP:"quit_group",SEARCH_GRP:"get_group_public_info",CHANGE_GRP_OWNER:"change_group_owner",HANDLE_GRP_APPLICATION:"handle_apply_join_group",HANDLE_INVITE_JOIN_GRP:"handle_invite_join_permission_group",HANDLE_GRP_INVITATION:"handle_invite_join_group",REVOKE_GRP_MSG:"group_msg_recall",SET_GRP_MSG_READ:"msg_read_report",SET_ALL_MSG_READ:"read_all_unread_msg",GET_GRP_ROAMING_MSG:"group_msg_get",GET_READ_RECEIPT:"get_group_msg_receipt",SEND_READ_RECEIPT:"group_msg_receipt",SEND_C2C_READ_RECEIPT:"c2c_msg_read_receipt",GET_READ_RECEIPT_DETAIL:"get_group_msg_receipt_detail",GET_GRP_PENDENCY:"get_pendency",DEL_GRP_SYSTEM_NOTICE:"deletemsg",AV_POLLING:"get_msg",AV_NOAUTH_POLLING:"get_msg_noauth",GET_ONLINE_MBR_NUM:"get_online_member_num",DEL_GRP_MSG:"delete_group_ramble_msg_by_seq",MODIFY_GRP_MSG:"modify_group_msg",SET_GRP_ATTR:"set_group_attr",MODIFY_GRP_ATTR:"modify_group_attr",DEL_GRP_ATTR:"delete_group_attr",CLEAR_GRP_ATTR:"clear_group_attr",GET_GRP_ATTR:"get_group_attr",MODIFY_GRP_MSG_EXT:"group_set_key_values",GET_GRP_MSG_EXT:"group_get_key_values",GET_GRP_NOTIFY:"batch_get_group_notify",UPDATE_GRP_COUNTER:"update_group_counter",GET_GRP_COUNTER:"get_group_counter",ADD_GRP_MSG_REACTION:"group_reaction_add",RM_GRP_MSG_REACTION:"group_reaction_del",GET_GRP_MSG_REACTIONS:"group_reaction_multi_stat",GET_GRP_MSG_REACTION_USER_LIST:"group_reaction_iterate",GET_GRP_MBR_LIST:"get_group_member_info",GET_AV_MBR_LIST:"get_members",GET_GRP_MBR_PROFILE:"get_specified_group_member_info",ADD_GRP_MBR:"add_group_member",DEL_GRP_MBR:"delete_group_member",BAN_AV_MBR:"ban_group_member",MODIFY_GRP_MBR_INFO:"modify_group_member_info",MARK_AV_MBR_INFO:"modify_user_info",COS_SIGN:"cos",COS_PRE_SIG:"pre_sig",SIMPLE_COS_PRE_SIG:"simple_sig",GET_IMAGE_INFO:"get_imageinfo",GET_IP:"get_final_ip",VIDEO_COVER:"video_cover",SSO_STAT:"tim_web_report_v2",PING:"alive",MSG_PUSH:"msg_push",CS:"query",GRP_CS:"query_grp",MBR_CS:"query_grp_member",USER_CS:"query_user",MULTI_MSG_PUSH:"multi_msg_push_ws",MSG_PUSH_ACK:"ws_msg_push_ack",STATUS_FORCE_OFFLINE:"stat_forceoffline",UPLOAD_MERGER_MSG:"save_relay_json_msg",DOWNLOAD_MERGER_MSG:"get_relay_json_msg",FETCH_CLOUD_CTRL_CONFIG:"fetch_config",PUSHED_CLOUD_CTRL_CONFIG:"push_configv2",FETCH_COMMERCIAL_CONFIG:"fetch_imsdk_purchase_bitsv2",PUSHED_COMMERCIAL_CONFIG:"push_imsdk_purchase_bitsv2",OVERLOAD_NOTIFY:"notify2",CREATE_TOPIC:"create_topic",DEL_TOPIC:"destroy_topic",UPDATE_TOPIC_PROFILE:"modify_topic",GET_TOPIC_LIST:"get_topic",SET_SELF_STATUS:"ws_set_custom_status",GET_USER_STATUS:"ws_get_user_status",SUB_USER_STATUS:"ws_status_subscribe",UNSUB_USER_STATUS:"ws_status_unsubscribe",STAT_BACKGROUND:"ws_stat_background",STAT_FOREGROUND:"ws_stat_foreground",SET_TOKEN:"ws_stat_settoken",PUSH_REPORT:"uniapp_sdk_report",GET_PROFANITY_LIST:"get_local_words",TRANSLATE_TEXT:"ws_batch_trans_text",VOICE_TO_TEXT:"ws_sentence_recognition",FOLLOW:"follow_add",UNFOLLOW:"follow_delete",GET_FOLLOW:"follow_get",GET_FOLLOW_INFO:"follow_get_info",CHECK_FOLLOW_TYPE:"follow_check",SET_ALL_RECEIVE_MSG_OPT:"ws_set_do_not_disturb",GET_ALL_RECEIVE_MSG_OPT:"ws_get_do_not_disturb"},si="networkRTT",Ii="messageE2EDelay",bo="sendMessageC2C",na="sendMessageGroup",oa="sendMessageGroupAV",ri="sendMessageRichMedia",oo="cosUpload",ce="messageReceivedGroup",Mi="messageReceivedGroupAVPush",Ci="messageReceivedGroupAVPull",Ka=(H(X={},si,2),H(X,Ii,3),H(X,bo,4),H(X,na,5),H(X,oa,6),H(X,ri,7),H(X,ce,8),H(X,Mi,9),H(X,Ci,10),H(X,oo,11),X),Dc={info:4,warning:5,error:6},Wa={wifi:1,"2g":2,"3g":3,"4g":4,"5g":5,unknown:6,none:7,online:8},Qn={login:4,plugin_search:16,plugin_translate:16,plugin_voice_to_text:16,plugin_cs:16,plugin_push:16,plugin_bot:16,plugin_emoji_reaction:16,tui_key_features:16},ue=(V(Ti,[{key:"updateTimeStamp",value:function(){this.timestamp=no()}},{key:"start",value:function(t){return this._startts=t,this}},{key:"end",value:function(){var t,o=this,i=0<arguments.length&&arguments[0]!==void 0&&arguments[0];this._sentFlag||(this._netMonitorModule&&(t=this._netMonitorModule.getNetworkType(),this.setNetworkType(t)),t=no(),this.costTime===0&&(this.costTime=t-this._startts),this.setMoreMessage("startts:".concat(this._startts," endts:").concat(t)),i?(this._sentFlag=!0,this._eventStatModule&&this._eventStatModule.pushIn(this)):setTimeout(function(){o._sentFlag=!0,o._eventStatModule&&o._eventStatModule.pushIn(o)},0))}},{key:"setError",value:function(t){if(!(t instanceof Error))return E.w("".concat(this._n,".setError value not instanceof Error, please check!")),this;if(this._sentFlag)return this;var o=!0;return(o=this._netMonitorModule?this._netMonitorModule.isOnline():o)?(t.code&&this.setCode(t.code),t.message&&this.setMoreMessage(t.message)):this.setCode(Q.NO_NETWORK),this.setLevel("error"),this}},{key:"setCode",value:function(t){return q(t)||this._sentFlag||(t==="ECONNABORTED"&&(this.code=103),ut(t)?this.code=t:E.w("".concat(this._n,".setCode value not a number, please check!"),t,w(t))),this}},{key:"setMessage",value:function(t){return q(t)||this._sentFlag||(ut(t)&&(this.message=t.toString()),Ee(t)&&(this.message=t)),this}},{key:"setCostTime",value:function(t){return this.costTime=t,this}},{key:"setLevel",value:function(t){return q(t)||this._sentFlag||(this.level=Dc[t]),this}},{key:"setMoreMessage",value:function(t){return Te(this.moreMessage)?this.moreMessage="".concat(t):this.moreMessage+=" ".concat(t),this}},{key:"setNetworkType",value:function(t){return q(t)?E.w("".concat(this._n,".setNetworkType value is undefined, please check!")):(t=Wa[t.toLowerCase()],q(t)||(this.networkType=t)),this}},{key:"getStartTs",value:function(){return this._startts}},{key:"setUIPlatform",value:function(t){return this.uiPlatform=t,this}},{key:"setExtension",value:function(t){return this.extension=t,this}},{key:"setEventType",value:function(t){return this.eventType=t,this}}],[{key:"bindEventStatModule",value:function(t){Ti.prototype._eventStatModule=t}},{key:"bindNetMonitorModule",value:function(t){Ti.prototype._netMonitorModule=t}}]),Ti),ci=(V(ja,[{key:"setText",value:function(t){this.content.text=t}},{key:"sendable",value:function(){return this.content.text.length!==0}}]),ja);function ja(t){N(this,ja),this.type=O.MSG_TEXT,this.content={text:t.text||""}}function Ti(t){N(this,Ti),this._n="SSOLogData",this.eventType=Qn[t]||0,this.timestamp=0,this.networkType=8,this.code=0,this.message="",this.moreMessage="",this.extension=t,this.costTime=0,this.duplicate=!1,this.level=4,this.uiPlatform=void 0,this._sentFlag=!1,this._startts=no()}function Ya(t){N(this,Ya),this._m=t,this._n=""}function ia(c){N(this,ia),o=No.call(this);var o,i=c.code,s=c.message,c=c.data;return o.code=i,s?o.message=s:o._getErrMsg&&(o.message=o._getErrMsg(o.code)),o.data=c||{},o}function Zn(t,o,i,l){var c,l=3<arguments.length&&l!==void 0?l:[];if(t)return c=t,o&&(t.startsWith("http://")?c=t.replace(/^http:\/\/[^/]+/,o):t.startsWith("https://")&&(c=t.replace(/^https:\/\/[^/]+/,o))),i&&c.indexOf("authKey=")===-1&&fr(c,l)?(-1<c.indexOf("?")?"".concat(c,"&authKey="):"".concat(c,"?authKey=")).concat(i):c}function za(t,o,s){var s=2<arguments.length&&s!==void 0?s:[];return t===O.MSG_VIDEO?fr((o[0].content||o[0].payload).snapshotUrl,s)&&(o[0].content?(o[0].content.snapshotUrl=aa(o[0].content.snapshotUrl),o[0].content.thumbUrl=aa(o[0].content.thumbUrl)):(o[0].payload.snapshotUrl=aa(o[0].payload.snapshotUrl),o[0].payload.thumbUrl=aa(o[0].payload.thumbUrl))):t===O.MSG_FILE?fr((o[0].content||o[0].payload).fileUrl,s)&&(o[0].content?o[0].content.fileUrl=aa(o[0].content.fileUrl):o[0].payload.fileUrl=aa(o[0].payload.fileUrl)):t===O.MSG_MERGER&&(t=(s=o[0].content||o[0].payload).downloadKey,s=(s=s.messageList)===void 0?[]:s,Te(t===void 0?"":t)&&s.forEach(function(c){za(c.messageBody[0].type,c.messageBody)})),o}function aa(t){if(!t||t.indexOf("authKey=")===-1)return t;for(var t=t.split("?"),o=t[1].split("&"),i=0,s=0;s<o.length;s++)if(-1<o[s].indexOf("authKey=")){i=s;break}return o.splice(i,1),0<o.length?"".concat(t[0],"?").concat(o.join("&")):t[0]}function fr(t,o){var i=!1;if(t){var t=t.match(/:\/\/([0-9]?\.)?(.[^/:]+)/),s=t&&t[2]||"";if(s.includes("rich-dev"))return 1;for(var c=0;c<o.length;c++)if(s.endsWith(o[c])){i=!0;break}}return i}V(rs,[{key:"_initImageInfoModel",value:function(){var t=this;this._ImageInfoModel=function(o){this.instanceID=mn(9999999),this.sizeType=o.type||0,this.type=0,this.size=o.size||0,this.width=o.width||0,this.height=o.height||0,this.imageUrl=o.imageUrl||o.url||"",this.url=Zn(o.url||t._imageMemoryURL,t._fileDownloadProxy,t._authKey,t._fileDNList)},this._ImageInfoModel.prototype={setSizeType:function(o){this.sizeType=o},setType:function(o){this.type=o},setImageUrl:function(o){o&&(this.imageUrl=o)},getImageUrl:function(){return this.imageUrl}}}},{key:"initImageInfoArray",value:function(t){for(var o,i=0,s=null;i<=2;)o=q(t)||q(t[i])?{type:0,size:0,width:0,height:0,url:""}:t[i],(s=new this._ImageInfoModel(o)).setSizeType(i+1),s.setType(i),this.addImageInfo(s),i++;this.updateAccessSideImageInfoArray()}},{key:"updateImageInfoArray",value:function(t){for(var o,i=this.content.imageInfoArray.length,s=0;s<i;s++)o=this.content.imageInfoArray[s],t[s].size&&(o.size=t[s].size),t[s].url&&o.setImageUrl(t[s].url),t[s].width&&(o.width=t[s].width),t[s].height&&(o.height=t[s].height)}},{key:"_autoFixUrl",value:function(){for(var t=this.content.imageInfoArray.length,o="",i="",s=["http","https"],c=null,l=0;l<t;l++)this.content.imageInfoArray[l].url&&(c=this.content.imageInfoArray[l]).imageUrl!==""&&(i=c.imageUrl.slice(0,c.imageUrl.indexOf("://")+1),o=c.imageUrl.slice(c.imageUrl.indexOf("://")+1),s.indexOf(i)<0&&(i="https:"),this.content.imageInfoArray[l].setImageUrl([i,o].join("")))}},{key:"updatePercent",value:function(t){this._percent=t,1<this._percent&&(this._percent=1)}},{key:"updateImageFormat",value:function(t){this.content.imageFormat=D[t.toUpperCase()]||D.UNKNOWN}},{key:"createImageDataASURLInWeb",value:function(t){t!==void 0&&0<t.files.length&&(this._imageMemoryURL=window.URL.createObjectURL(t.files[0]))}},{key:"createImageDataASURL",value:function(t){t&&t.url&&(this._imageMemoryURL=t.url)}},{key:"replaceImageInfo",value:function(t,o){this.content.imageInfoArray[o]instanceof this._ImageInfoModel||(this.content.imageInfoArray[o]=t)}},{key:"addImageInfo",value:function(t){3<=this.content.imageInfoArray.length||this.content.imageInfoArray.push(t)}},{key:"updateAccessSideImageInfoArray",value:function(){var t=this.content.imageInfoArray,i=t[0],o=i.width,o=o===void 0?0:o,i=i.height,i=i===void 0?0:i;o!==0&&i!==0&&(gr(t),Object.assign(t[2],pr({originWidth:o,originHeight:i,min:720})))}},{key:"sendable",value:function(){return this.content.imageInfoArray.length!==0&&this.content.imageInfoArray[0].imageUrl!==""&&this.content.imageInfoArray[0].size!==0}}]);var Ja=rs,$a=(V(Si,[{key:"sendable",value:function(){return this.content!==null}}]),Si),Xa=(V(ss,[{key:"updatePercent",value:function(t){this._percent=t,1<this._percent&&(this._percent=1)}},{key:"updateAudioUrl",value:function(t){this.content.remoteAudioUrl=t}},{key:"sendable",value:function(){return this.content.remoteAudioUrl!==""}}]),ss),Ec={from:!0,groupID:!0,groupName:!0,to:!0},Rc=(V(Ac,[{key:"_initContent",value:function(t){var o=this;Object.keys(t).forEach(function(i){switch(i){case"remarkInfo":break;case"groupProfile":o.content.groupProfile={},o._initGroupProfile(t[i]);break;case"operatorInfo":o.content.operatorInfo={},o._initOperatorInfo(t[i]);break;case"memberInfoList":case"msgMemberInfo":o._updateMemberList(t[i]);break;case"memberExtraInfo":case"onlineMemberInfo":break;case"memberNum":o.content[i]=t[i],o.content.memberCount=t[i];break;case"newGroupProfile":o.content.newGroupProfile={},o._initNewGroupProfile(t[i]);break;default:o.content[i]=t[i]}}),this.content.userIDList||(this.content.userIDList=[this.content.operatorID])}},{key:"_initGroupProfile",value:function(t){for(var o=Object.keys(t),i=0;i<o.length;i++){var s=o[i];Ec[s]&&(this.content.groupProfile[s]=t[s])}}},{key:"_initOperatorInfo",value:function(t){for(var o=Object.keys(t),i=0;i<o.length;i++){var s=o[i];this.content.operatorInfo[s]=t[s]}}},{key:"_updateMemberList",value:function(t){Te(this.content.memberList)?this.content.memberList=t:this.content.memberList.forEach(function(o){t.forEach(function(i){o.userID===i.userID&&Object.assign(o,i)})})}},{key:"_initNewGroupProfile",value:function(t){for(var o=Object.keys(t),i=0;i<o.length;i++){var s=o[i];this.content.newGroupProfile[s]=s!=="muteAllMembers"?t[s]:t[s]===1}}}]),Ac),mr={from:!0,groupID:!0,groupName:!0,to:!0,groupType:!0},vr=(V(Kt,[{key:"_initContent",value:function(t){var o=this;Object.keys(t).forEach(function(i){switch(i){case"memberInfoList":break;case"remarkInfo":o.content.handleMessage=t[i];break;case"groupProfile":o.content.groupProfile={},o._initGroupProfile(t[i]);break;default:o.content[i]=t[i]}})}},{key:"_initGroupProfile",value:function(t){for(var o=Object.keys(t),i=0;i<o.length;i++){var s=o[i];mr[s]&&(s==="groupName"?this.content.groupProfile.name=t[s]:this.content.groupProfile[s]=t[s])}}}]),Kt),In=(V(kc,[{key:"_getFileInfo",value:function(i){if(!q(i.fileName)&&!q(i.fileSize))return{size:i.fileSize,name:i.fileName};var o,i=i.file.files[0];return Ce&&(i.path&&i.path.indexOf(".")!==-1&&(o=i.path.slice(i.path.lastIndexOf(".")+1).toLowerCase(),i.type=o,i.name||(i.name="".concat(mn(999999),".").concat(o))),i.name||(i.type="",i.name=i.path.slice(i.path.lastIndexOf("/")+1).toLowerCase()),i.suffix&&(i.type=i.suffix),i.url||(i.url=i.path)),{size:i.size,name:i.name}}},{key:"updatePercent",value:function(t){this._percent=t,1<this._percent&&(this._percent=1)}},{key:"updateFileUrl",value:function(t){this.content.fileUrl=t}},{key:"sendable",value:function(){return this.content.fileUrl!==""&&this.content.fileName!==""&&this.content.fileSize!==0}}]),kc),Qa=(V(Ir,[{key:"setData",value:function(t){return this.content.data=t,this}},{key:"setDescription",value:function(t){return this.content.description=t,this}},{key:"setExtension",value:function(t){return this.content.extension=t,this}},{key:"sendable",value:function(){return this.content.data.length!==0||this.content.description.length!==0||this.content.extension.length!==0}}]),Ir),Za=(V(ra,[{key:"updatePercent",value:function(t){this._percent=t,1<this._percent&&(this._percent=1)}},{key:"updateVideoUrl",value:function(t){t&&(this.content.remoteVideoUrl=t)}},{key:"updateSnapshotInfo",value:function(s){var o=s.snapshotUrl,i=s.snapshotWidth,s=s.snapshotHeight;Te(o)||(this.content.thumbUrl=this.content.snapshotUrl=o),Te(i)||(this.content.thumbWidth=this.content.snapshotWidth=Number(i)),Te(s)||(this.content.thumbHeight=this.content.snapshotHeight=Number(s))}},{key:"sendable",value:function(){return this.content.remoteVideoUrl!==""}}]),ra),es=(V(as,[{key:"sendable",value:function(){return!0}}]),as),yr=(V(is,[{key:"_patchRichMediaPayload",value:function(t,o){t===O.MSG_IMAGE?o.imageInfoArray.forEach(function(i){!i.imageUrl&&i.url&&(i.imageUrl=i.url,i.sizeType=i.type,i.type===1?i.type=0:i.type===3&&(i.type=1))}):t===O.MSG_VIDEO?!o.remoteVideoUrl&&o.videoUrl&&(o.remoteVideoUrl=o.videoUrl):t===O.MSG_AUDIO?!o.remoteAudioUrl&&o.url&&(o.remoteAudioUrl=o.url):t===O.MSG_FILE&&!o.fileUrl&&o.url&&(o.fileUrl=o.url,o.url=void 0)}},{key:"_updateRichMediaDownloadUrl",value:function(t,o,i,s,c){(i||s)&&(t===O.MSG_IMAGE?o.imageInfoArray.forEach(function(l){l.url=Zn(l.url,i,s,c)}):t===O.MSG_VIDEO?(o.videoUrl=Zn(o.videoUrl,i,s,c),o.snapshotUrl=Zn(o.thumbUrl,i,s,c),o.snapshotHeight=o.thumbHeight,o.snapshotWidth=o.thumbWidth):t===O.MSG_AUDIO?o.url=Zn(o.url,i,s,c):t===O.MSG_FILE&&(o.fileUrl=Zn(o.fileUrl,i,s,c)))}}]),is),sa=(V(os,[{key:"sendable",value:function(){return!Te(this.content.messageList)||!Te(this.content.downloadKey)}}]),os),ts={1:O.MSG_PRIORITY_HIGH,2:O.MSG_PRIORITY_NORMAL,3:O.MSG_PRIORITY_LOW,4:O.MSG_PRIORITY_LOWEST},Mn=(V(ns,[{key:"elements",get:function(){return this._elements}},{key:"getElements",value:function(){return this._elements}},{key:"extractGroupInfo",value:function(t){t!==null&&(Ee(t.nick)&&(this.nick=t.nick),Ee(t.avatar)&&(this.avatar=t.avatar),t=t.messageFromAccountExtraInformation,It(t)&&Ee(t.nameCard)&&(this.nameCard=t.nameCard))}},{key:"handleGroupAtInfo",value:function(t){var o=this;t.payload&&t.payload.atUserList&&t.payload.atUserList.forEach(function(i){i!==O.MSG_AT_ALL?(o._groupAtInfoList.push({groupAtAllFlag:0,groupAtUserID:i}),o.atUserList.push(i)):(o._groupAtInfoList.push({groupAtAllFlag:1}),o.atUserList.push(O.MSG_AT_ALL))}),ye(t.groupAtInfo)&&t.groupAtInfo.forEach(function(i){i.groupAtAllFlag===0?o.atUserList.push(i.groupAtUserID):i.groupAtAllFlag===1&&o.atUserList.push(O.MSG_AT_ALL)})}},{key:"getGroupAtInfoList",value:function(){return this._groupAtInfoList}},{key:"_initProxy",value:function(){this._elements[0]&&(this.payload=this._elements[0].content,this.type=this._elements[0].type)}},{key:"reInitialize",value:function(t){t&&(this.status=this.from?Jn:Ha,this.from||(this.from=t)),this._initFlow(t),this._initSequence(t),this._concatConversationID(t),this.generateMessageID()}},{key:"isSendable",value:function(){return this._elements.length!==0&&(this._relayFlag===!0||typeof this._elements[0].sendable=="function"&&this._elements[0].sendable())}},{key:"_initTo",value:function(t){this.conversationType===O.CONV_GROUP&&(this.to=t.groupID)}},{key:"_initSequence",value:function(t){var o,i,s;this.clientSequence===0&&t&&(this.clientSequence=!!(t=t)&&(hi[t]===void 0&&(s=new Date,o="3".concat(s.getHours()).slice(-2),i="0".concat(s.getMinutes()).slice(-2),s="0".concat(s.getSeconds()).slice(-2),hi[t]=parseInt([o,i,s,"0001"].join("")),s=i=o=null,E.l("autoIncrementIndex start index:".concat(hi[t]))),hi[t]++)),this.sequence===0&&this.conversationType===O.CONV_C2C&&(this.sequence=this.clientSequence)}},{key:"generateMessageID",value:function(){this.from===O.CONV_SYSTEM&&(this.senderTinyID="144115198244471703"),this.ID="".concat(this.senderTinyID,"-").concat(this.clientTime,"-").concat(this.random)}},{key:"_initFlow",value:function(t){t!==""&&(t===this.from?(this.flow="out",this.isRead=!0):this.flow="in")}},{key:"_concatConversationID",value:function(t){var o=this.to,i=this.conversationType;i!==O.CONV_SYSTEM?(t=i===O.CONV_C2C?t===this.from?o:this.from:this.to,this.conversationID=t?"".concat(i).concat(t):null):this.conversationID=O.CONV_SYSTEM}},{key:"isElement",value:function(t){return t instanceof ci||t instanceof Ja||t instanceof $a||t instanceof Xa||t instanceof In||t instanceof Za||t instanceof Rc||t instanceof vr||t instanceof Qa||t instanceof es||t instanceof sa}},{key:"setElement",value:function(t,o,i,s){var c=this;if(this.isElement(t))return this._elements=[t],void this._initProxy();function l(m){if(m.type&&m.content)switch(m.type){case O.MSG_TEXT:c.setTextElement(m.content);break;case O.MSG_IMAGE:c.setImageElement(m.content,o,i,s);break;case O.MSG_AUDIO:c.setAudioElement(m.content,o,i,s);break;case O.MSG_FILE:c.setFileElement(m.content,o,i,s);break;case O.MSG_VIDEO:c.setVideoElement(m.content,o,i,s);break;case O.MSG_CUSTOM:c.setCustomElement(m.content);break;case O.MSG_LOCATION:c.setLocationElement(m.content);break;case O.MSG_GRP_TIP:c.setGroupTipElement(m.content);break;case O.MSG_GRP_SYS_NOTICE:c.setGroupSystemNoticeElement(m.content);break;case O.MSG_FACE:c.setFaceElement(m.content);break;case O.MSG_MERGER:c.setMergerElement(m.content,o,i,s)}}if(ye(t))for(var p=0;p<t.length;p++)l(t[p]);else l(t);this._initProxy()}},{key:"clearElement",value:function(){this._elements.length=0}},{key:"setTextElement",value:function(t){t=typeof t=="string"?t:t.text,t=new ci({text:t}),this._elements.push(t)}},{key:"setImageElement",value:function(t,o,i,s){t=new Ja(t,o,i,s),this._elements.push(t)}},{key:"setAudioElement",value:function(t,o,i,s){t=new Xa(t,o,i,s),this._elements.push(t)}},{key:"setFileElement",value:function(t,o,i,s){t=new In(t,o,i,s),this._elements.push(t)}},{key:"setVideoElement",value:function(t,o,i,s){t=new Za(t,o,i,s),this._elements.push(t)}},{key:"setLocationElement",value:function(t){t=new es(t),this._elements.push(t)}},{key:"setCustomElement",value:function(t){t=new Qa(t),this._elements.push(t)}},{key:"setGroupTipElement",value:function(t){var o,i={},s=t.operationType;Te(t.memberInfoList)?t.operatorInfo&&(i=t.operatorInfo):s!==O.GRP_TIP_MBR_JOIN&&s!==O.GRP_TIP_MBR_KICKED_OUT&&s!==O.GRP_TIP_MBR_SET_ADMIN&&s!==O.GRP_TIP_MBR_CANCELED_ADMIN||(i=t.memberInfoList[0]),Te(t.memberExtraInfo)||(o=t.memberExtraInfo.reason,t.msgMemberInfo.forEach(function(c){c.reason=o})),s=i.nick,i=i.avatar,Ee(s)&&(this.nick=s),Ee(i)&&(this.avatar=i),s=new Rc(t),this._elements.push(s)}},{key:"setGroupSystemNoticeElement",value:function(t){t=new vr(t),this._elements.push(t)}},{key:"setFaceElement",value:function(t){t=new $a(t),this._elements.push(t)}},{key:"setMergerElement",value:function(t,o,i,s){t=new sa(t,o,i,s),this._elements.push(t)}},{key:"setIsRead",value:function(t){this.isRead=t}},{key:"setRelayFlag",value:function(t){this._relayFlag=t}},{key:"_computePriority",value:function(t){return q(t)?O.MSG_PRIORITY_NORMAL:Ee(t)&&Object.values(ts).indexOf(t)!==-1?t:ut(t)&&(t=""+t,Object.keys(ts).indexOf(t)!==-1)?ts[t]:O.MSG_PRIORITY_NORMAL}},{key:"setNickAndAvatar",value:function(i){var o=i.nick,i=i.avatar;Ee(o)&&(this.nick=o),Ee(i)&&(this.avatar=i)}},{key:"setNameCard",value:function(t){Ee(t)&&(this.nameCard=t)}},{key:"initC2CReadReceiptInfo",value:function(i){var o=i.readReceiptSentByPeer,i=i.timestamp,i=i===void 0?0:i;this.conversationType===O.CONV_C2C&&this.needReadReceipt===!0&&(this.readReceiptInfo.isPeerRead=(o===void 0?void 0:o)===1,this.readReceiptInfo.timestamp=i)}}]),ns),Lc=["sound","FCMChannelID"];function ns(t){N(this,ns),this.ID="",this.conversationID=t.conversationID||null,this.conversationType=t.conversationType||O.CONV_C2C,this.conversationSubType=t.conversationSubType,this.time=t.time||Math.ceil(Date.now()/1e3),this.sequence=t.sequence||0,this.clientSequence=t.clientSequence||t.sequence||0,this.random=t.random||t.random===0?t.random:mn(),this.priority=this._computePriority(t.priority),this.nick=t.nick||"",this.avatar=t.avatar||"",this.isPeerRead=!1,this.nameCard="",this.hasRiskContent=Tc(t.checkResult),this._elements=[],this.isPlaceMessage=t.isPlaceMessage||0,this.isRevoked=t.isPlaceMessage===2||t.msgFlagBits===8,this.from=t.from||null,this.to=t.to||null,this.flow="",this.isSystemMessage=t.isSystemMessage||!1,this.protocol=t.protocol||"JSON",this.isResend=!1,this.isRead=!1,this.status=t.status||Jn,this._onlineOnlyFlag=!1,this._groupAtInfoList=[],this._relayFlag=!1,this.atUserList=[],this.cloudCustomData=t.cloudCustomData||"",this.isDeleted=!1,this.isModified=!!t.messageVersion,this._isExcludedFromUnreadCount=!(!t.messageControlInfo||t.messageControlInfo.excludedFromUnreadCount!==1),this._isExcludedFromLastMessage=!(!t.messageControlInfo||t.messageControlInfo.excludedFromLastMessage!==1),this.clientTime=t.clientTime||zi()||0,this.senderTinyID=t.senderTinyID||t.tinyID||"",this.readReceiptInfo=t.readReceiptInfo||{readCount:void 0,unreadCount:void 0,isPeerRead:void 0,timestamp:0},this.needReadReceipt=t.needReadReceipt===!0||t.needReadReceipt===1,this.version=t.messageVersion||0,this.isBroadcastMessage=t.isBroadcastMessage||!1,this._receiverList=t.receiverList||void 0,this.isSupportExtension=t.isSupportExtension===!0||t.isSupportExtension===1,this._cmConfigID=t.customModerationConfigurationID,this.revoker=t.revokerInfo&&t.revokerInfo.revoker||"",this.revokerInfo=t.revokerInfo||{userID:"",nick:"",avatar:""},this.revokeReason=t.revokeReason||"",this.reInitialize(t.currentUser),this.extractGroupInfo(t.groupProfile||null),this.handleGroupAtInfo(t),this.initC2CReadReceiptInfo(t)}function os(t,o,i,s){var c,l,p,m,I,C,S;N(this,os),this.type=O.MSG_MERGER,this.content={downloadKey:"",pbDownloadKey:"",messageList:[],title:"",abstractList:[],compatibleText:"",version:0,layersOverLimit:!1},t.downloadKey?(l=t.downloadKey,p=t.pbDownloadKey,m=t.title,I=t.abstractList,C=t.compatibleText,c=t.version,this.content.downloadKey=l,this.content.pbDownloadKey=p,this.content.title=m,this.content.abstractList=I,this.content.compatibleText=C,this.content.version=c||0):Te(t.messageList)?t.layersOverLimit===1&&(this.content.layersOverLimit=!0):(l=t.messageList,p=t.title,m=t.abstractList,I=t.compatibleText,C=t.version,S=[],l.forEach(function(k){Te(k)||(k=new yr(k,o,i,s),S.push(k))}),this.content.messageList=S,this.content.title=p,this.content.abstractList=m,this.content.compatibleText=I,this.content.version=C||0)}function is(t,o,i,s){var c,l;N(this,is),this.from=t.from,this.messageSender=t.from,this.time=t.time,this.messageSequence=t.sequence,this.clientSequence=t.clientSequence||t.sequence,this.messageRandom=t.random,this.cloudCustomData=t.cloudCustomData||"",this.clientTime=t.clientTime||void 0,t.ID?(this.ID=t.ID||"",this.nick=t.nick||"",this.avatar=t.avatar||"",t.messageBody?this.messageBody=JSON.parse(JSON.stringify(t.messageBody)):this.messageBody=[{type:t.type,payload:t.payload}],t.conversationType?t.conversationType.startsWith(O.CONV_C2C)?this.receiverUserID=t.to:t.conversationType.startsWith(O.CONV_GROUP)&&(this.receiverGroupID=t.to):t.receiverGroupID?this.receiverGroupID=t.receiverGroupID:t.receiverUserID&&(this.receiverUserID=t.receiverUserID),this.messageReceiver=t.to||t.messageReceiver):(this.nick=t.nick||"",this.avatar=t.avatar||"",this.messageBody=[],c=t.elements[0].type,l=t.elements[0].content,this._patchRichMediaPayload(c,l),this._updateRichMediaDownloadUrl(c,l,o,i,s),c===O.MSG_MERGER?this.messageBody.push({type:c,payload:new sa(l,o,i,s).content}):this.messageBody.push({type:c,payload:l}),t.groupID&&(this.receiverGroupID=t.groupID,this.messageReceiver=t.groupID),t.to&&(this.receiverUserID=t.to,this.messageReceiver=t.to),this.ID="".concat(t.tinyID,"-").concat(t.clientTime,"-").concat(t.random))}function as(s){N(this,as),this.type=O.MSG_LOCATION;var o=s.description,i=s.longitude,s=s.latitude;this.content={description:o,longitude:i,latitude:s}}function ra(t,o,i,s){N(this,ra),this.type=O.MSG_VIDEO,this._percent=0,this.content={remoteVideoUrl:t.remoteVideoUrl||t.videoUrl||"",videoFormat:t.videoFormat,videoSecond:parseInt(t.videoSecond,10),videoSize:t.videoSize,videoUrl:Zn(t.videoUrl,o,i,s),videoDownloadFlag:2,videoUUID:t.videoUUID,thumbUUID:t.thumbUUID,thumbFormat:t.thumbFormat,thumbWidth:t.thumbWidth,snapshotWidth:t.thumbWidth,thumbHeight:t.thumbHeight,snapshotHeight:t.thumbHeight,thumbSize:t.thumbSize,snapshotSize:t.thumbSize,thumbDownloadFlag:2,thumbUrl:Zn(t.thumbUrl,o,i,s),snapshotUrl:Zn(t.thumbUrl,o,i,s)}}function Ir(t){N(this,Ir),this.type=O.MSG_CUSTOM,this.content={data:t.data||"",description:t.description||"",extension:t.extension||""}}function kc(t,o,i,s){N(this,kc),this.type=O.MSG_FILE,this._percent=0;var c=this._getFileInfo(t);this.content={downloadFlag:2,fileUrl:Zn(t.url||t.fileUrl,o,i,s)||"",uuid:t.uuid,fileName:c.name||"",fileSize:c.size||0}}function Kt(t){N(this,Kt),this.type=O.MSG_GRP_SYS_NOTICE,this.content={},this._initContent(t)}function Ac(t){N(this,Ac),this.type=O.MSG_GRP_TIP,this.content={},this._initContent(t)}function ss(t,o,i,s){N(this,ss),this.type=O.MSG_AUDIO,this._percent=0,this.content={downloadFlag:2,second:t.second,size:t.size,url:Zn(t.url,o,i,s),remoteAudioUrl:t.url||"",uuid:t.uuid}}function Si(t){N(this,Si),this.type=O.MSG_FACE,this.content=t||null}function rs(t,o,i,s){N(this,rs),this._imageMemoryURL="",this._fileDownloadProxy=o,this._authKey=i,this._fileDNList=s,qe||Ze?this.createImageDataASURL(t.file):this.createImageDataASURLInWeb(t.file),this._initImageInfoModel(),this.type=O.MSG_IMAGE,this._percent=0,this.content={imageFormat:t.imageFormat||D.UNKNOWN,uuid:t.uuid,imageInfoArray:[]},this.initImageInfoArray(t.imageInfoArray),this._autoFixUrl()}function cs(t){if(It(t))return{pushFlag:t.disablePush===!0?1:0,title:t.title||"",desc:t.description||"",ext:t.extension||"",apnsInfo:(i=(i=(o=t).apnsInfo)===void 0?{}:i,s=o.ignoreIOSBadge,o=o.disableVoipPush,s=i.ignoreIOSBadge===!0||(s!==void 0&&s)===!0?1:0,c=void 0,q(o)||(c=o===!1?1:0),q(i.disableVoipPush)||(c=i.disableVoipPush===!1?1:0),v(v({},i),{},{badgeMode:s,isVoipPush:c})),androidInfo:(i=(i=(o=t).androidInfo)===void 0?{}:i,o=o.androidOPPOChannelID,o=i.OPPOChannelID||(o===void 0?"":o),s=(s=i.sound)===void 0?"":s,c=(c=i.FCMChannelID)===void 0?"":c,v(v({},ae(i,Lc)),{},{Sound:(s=(i=s).lastIndexOf("."))===-1?i:i.slice(0,s),OPPOChannelID:o,GoogleChannelID:c}))};var o,i,s,c}z(ca,Ht),Oc=J(ca),V(ca,[{key:"onNewMessage",value:function(i){var l=i.dataList,o=i.isInstantMessage,s=i.C2CRemainingUnreadList,c=i.C2CPairUnreadList,i=i.isSyncingEnded,l=(o||E.l("".concat(this._n,".onNewMessage C2CPairUnreadList:"),c,"C2CRemainingUnreadList:",s),this._assembly({dataList:l,C2CRemainingUnreadList:s,C2CPairUnreadList:c,isInstantMessage:o})),s=l.conversationOptionsList,c=l.messageList,l=l.isUnreadC2CMessage,p=wa(c),p=(0<p.length&&this.emitOEvt(Me.MESSAGE_MODIFIED,p),this.get(11).onNewMessage({conversationOptionsList:s,isInstantMessage:o,isUnreadC2CMessage:l,isSyncingEnded:i}),Un(c));o&&0<p.length&&this.emitOEvt(Me.MESSAGE_RECEIVED,p),c.length=0}},{key:"_assembly",value:function(t){for(var o=t.dataList,i=t.C2CRemainingUnreadList,s=t.C2CPairUnreadList,c=t.isInstantMessage,l=null,p=[],m=[],I={},C=this.get(26),S=!1,k=this.get(11),G=this.get(4),t=this.get(17),U=this.getFileDownloadProxy(),Y=this.getDowloadFileAuthKey(),Z=t.getFileDNList(),$=0,De=o.length;$<De;$++)if(this._isC2CNotice(o[$]))this._noticeFromUnreadDBList.push(o[$].eventArray[0].c2CNotifyMsgArray[0]);else{var _e=o[$],Pe=(_e.currentUser=this.getMyUserID(),_e.conversationType=O.CONV_C2C,_e.isSystemMessage=!!_e.isSystemMessage,(q(_e.nick)||q(_e.avatar))&&(S=!0),(l=new Mn(_e)).setElement(_e.elements,U,Y,Z),l.setNickAndAvatar({nick:_e.nick,avatar:_e.avatar}),l.conversationID);if(c){if(this._msgFromUnreadDBMap.get(l.ID))continue;var Ge,et,lt=!1,We=(l.from!==this.getMyUserID()?(et=k.getLatestMessageSentByPeer(Pe))&&(Ge=et.nick,et=et.avatar,S?l.setNickAndAvatar({nick:Ge,avatar:et}):Ge===l.nick&&et===l.avatar||(lt=!0)):(Ge=k.getLatestMessageSentByMe(Pe))&&(et=Ge.nick,We=Ge.avatar,et===l.nick&&We===l.avatar||(k.modifyMessageSentByMe({conversationID:Pe,latestNick:l.nick,latestAvatar:l.avatar}),G.mockOnNickAvatarModified(l.nick,l.avatar))),o[$].isModified===1);if(k.isMessageSentByCurrentInstance(l)?l.isModified=We:We=!1,_e.msgLifeTime===0)l._onlineOnlyFlag=!0,k.isMessageSentByCurrentInstance(l)||m.push(l);else{if(!k.pushIntoMessageList(m,l,We))continue;lt&&(k.modifyMessageSentByPeer({conversationID:Pe,latestNick:l.nick,latestAvatar:l.avatar}),k.updateUserProfileSpecifiedKey({conversationID:Pe,nick:l.nick,avatar:l.avatar}))}c&&0<l.clientTime&&C.addMessageDelay(l.clientTime)}else this._msgFromUnreadDBMap.set(l.ID,l);if(_e.msgLifeTime!==0){if(l._onlineOnlyFlag===!1){if(lt=k.getLastMessageTime(Pe),ut(lt)&&l.time<lt)continue;c&&(q(I[Pe])?(_e=0,l.flow==="in"&&(l._isExcludedFromUnreadCount||(_e=1)),I[Pe]=p.push({conversationID:Pe,unreadCount:_e,type:l.conversationType,subType:l.conversationSubType,lastMessage:l._isExcludedFromLastMessage?"":l})-1):(_e=I[Pe],p[_e].type=l.conversationType,p[_e].subType=l.conversationSubType,p[_e].lastMessage=l._isExcludedFromLastMessage?"":l,l.flow==="in"&&(l._isExcludedFromUnreadCount||p[_e].unreadCount++)))}}else l._onlineOnlyFlag=!0}this._handleNoticeFromUnreadDB();var _t=!1;if(ye(s)&&0<s.length)for(var Jt=0,Pt=s.length;Jt<Pt;Jt++)(function(Xt){if(s[Xt].from!==O.CONV_SYSTEM){_t=!0;var nn=p.find(function(hn){return hn.conversationID==="".concat(O.CONV_C2C).concat(s[Xt].from)});nn?nn.unreadCount=s[Xt].unreadCount:p.push({conversationID:"".concat(O.CONV_C2C).concat(s[Xt].from),unreadCount:s[Xt].unreadCount,type:O.CONV_C2C})}})(Jt);if(ye(i))for(var cn=0,Xo=i.length;cn<Xo;cn++)(function(Xt){p.find(function(nn){return nn.conversationID==="".concat(O.CONV_C2C).concat(i[Xt].from)})||p.push({conversationID:"".concat(O.CONV_C2C).concat(i[Xt].from),type:O.CONV_C2C,lastMsgTime:i[Xt].lastMsgTime})})(cn);return{conversationOptionsList:p,messageList:m,isUnreadC2CMessage:_t}}},{key:"getMessageListFromUnreadDB",value:function(){return re(this._msgFromUnreadDBMap.values())}},{key:"_isC2CNotice",value:function(t){return t=t.eventArray,!(!ye(t)||t[0].event!==10)}},{key:"_handleNoticeFromUnreadDB",value:function(){var t,o=this._noticeFromUnreadDBList.length;o!==0&&(E.l("".concat(this._n,"._handleNoticeFromUnreadDB count:").concat(o)),t=[],this._noticeFromUnreadDBList.forEach(function(i){i.hasOwnProperty("c2cMessageRevokedNotify")&&t.push(i)}),this.onMsgRevoked({dataList:t}),this._noticeFromUnreadDBList.length=0,t.length=0)}},{key:"onMsgRevoked",value:function(t,o){var i,s=this,c=this.get(11),l=[];t.dataList.forEach(function(p){p.c2cMessageRevokedNotify&&(p=p.c2cMessageRevokedNotify.revokedInfos,q(p)||p.forEach(function(m){var I=s.getMyUserID()===m.from?"".concat(O.CONV_C2C).concat(m.to):"".concat(O.CONV_C2C).concat(m.from);i=c.revoke(I,m.sequence,m.random);var C,S=m.revokerInfo&&m.revokerInfo.revoker,k=m.revokerInfo&&m.revokerInfo.reason||"";i?C=i:(C={conversationID:I,sequence:m.sequence},m.tinyID&&m.clientTime&&m.random&&(C.ID="".concat(m.tinyID,"-").concat(m.clientTime,"-").concat(m.random)),m.time&&(C.time=m.time)),C&&(C.revoker=S,C.revokeReason=k,C.revokerInfo={userID:S,nick:"",avatar:""},l.push(C))}))}),l.length!==0&&(E.l("".concat(this._n,".onMsgRevoked count:").concat(l.length," updateUnreadCount:").concat(o)),c.onMessageRevoked(l,o),c.updateRevokerInfo(l).then(function(p){s.emitOEvt(Me.MESSAGE_REVOKED,p)}))}},{key:"onMsgReadReceipt",value:function(t){var o=this;t.dataList.forEach(function(i){var s;Te(i.c2cMessageReadReceipt)||(s=i.c2cMessageReadReceipt.to,i.c2cMessageReadReceipt.uinPairReadArray.forEach(function(l){var l=l.peerReadTime,p=(E.l("".concat(o._n,".onMsgReadReceipt to:").concat(s," peerReadTime:").concat(l)),"".concat(O.CONV_C2C).concat(s)),m=o.get(11);m.recordPeerReadTime(p,l),m.updateMsgIsPeerReadProp(p,l)}))})}},{key:"onMsgReadNotice",value:function(t){var o=this;t.dataList.forEach(function(i){var s;Te(i.c2cMessageReadNotice)||(s=o.get(11),i.c2cMessageReadNotice.uinPairReadArray.forEach(function(l){var p=l.from,l=l.peerReadTime,p=(E.l("".concat(o._n,".onMsgReadNotice from:").concat(p," lastReadTime:").concat(l)),"".concat(O.CONV_C2C).concat(p));s.updateIsReadAfterReadReport({conversationID:p,lastMessageTime:l}),s.updateUnreadCount(p)}))})}},{key:"onMsgModified",value:function(t){E.l("".concat(this._n,".onMsgModified options:"),t);var o=this.get(11);t.dataList.forEach(function(i){o.onMessageModified(v(v({},i),{},{conversationType:O.CONV_C2C}))})}},{key:"onReadReceiptList",value:function(t){E.l("".concat(this._n,".onReadReceiptList options:"),t),this.get(11).updateReadReceiptInfo(t.dataList)}},{key:"sendMessage",value:function(t,o){return t=this._createC2CMessagePack(t,o),this.req(t)}},{key:"_createC2CMessagePack",value:function(t,o){var i=null,s=(o&&(o.offlinePushInfo&&(i=o.offlinePushInfo),o.onlineUserOnly===!0&&(i?i.disablePush=!0:i={disablePush:!0})),""),c=(Ee(t.cloudCustomData)&&0<t.cloudCustomData.length&&(s=t.cloudCustomData),[]),l=(It(o)&&It(o.messageControlInfo)&&(l=(m=o.messageControlInfo).excludedFromUnreadCount,p=m.excludedFromLastMessage,m=m.excludedFromContentModeration,l===!0&&c.push("NoUnread"),p===!0&&c.push("NoLastMsg"),m===!0&&c.push("NoMsgCheck")),this.isOnlineMessage(t,o)?0:void 0),p=JSON.parse(JSON.stringify(t.getElements())),m=this.get(17).getFileDNList();return{P:P.SEND_C2C_MSG,data:{fromAccount:this.getMyUserID(),toAccount:t.to,msgBody:za(t.type,p,m),cloudCustomData:s,msgSeq:t.sequence,msgRandom:t.random,msgLifeTime:l,nick:t.nick,avatar:t.avatar,offlinePushInfo:cs(i),messageControlInfo:l!==0?c:void 0,clientTime:t.clientTime,needReadReceipt:t.needReadReceipt===!0?1:0,isSupportExtension:t.isSupportExtension===!0?1:0,isRelayMessage:t._relayFlag===!0?1:0,cmConfigID:t._cmConfigID,forbidCallbackControl:lr(o)}}}},{key:"isOnlineMessage",value:function(t,o){return!(!o||o.onlineUserOnly!==!0)}},{key:"revokeMessage",value:function(t){return this.req({P:P.REVOKE_C2C_MSG,data:{msgInfo:{fromAccount:t.from,toAccount:t.to,msgSeq:t.sequence,msgRandom:t.random,msgTimeStamp:t.time}}})}},{key:"deleteMessage",value:function(i){var o=i.to,i=i.keyList;return E.l("".concat(this._n,".deleteMessage toAccount:").concat(o," count:").concat(i.length)),this.req({P:P.DEL_C2C_MSG,data:{fromAccount:this.getMyUserID(),to:o,keyList:i}})}},{key:"modifyRemoteMessage",value:function(S){var o=S.from,i=S.to,s=S.version,s=s===void 0?0:s,c=S.sequence,l=S.random,p=S.time,m=S.payload,I=S.type,C=S.cloudCustomData,S=S._elements,k=void 0;return Fa(I)&&(1<S.length&&S.splice(0,1,{type:I,content:m}),k=S),this.req({P:P.MODIFY_C2C_MSG,data:{from:o,to:i,version:s,sequence:c,random:l,time:p,elements:k,cloudCustomData:C}})}},{key:"setMessageRead",value:function(l){var o=this,i=l.conversationID,s=l.lastMessageTime,c="".concat(this._n,".").concat("setMessageRead"),l="convID:".concat(i," lastMessageTime:").concat(s),p=(E.l("".concat(c," ").concat(l)),ut(s)||this.warn("DoNotModifyLastTime"),new ue("setMessageRead"));return p.setMessage(l),this.req({P:P.SET_C2C_MSG_READ,data:{C2CMsgReaded:{cookie:"",C2CMsgReadedItem:[{toAccount:i.replace("C2C",""),lastMessageTime:s,receipt:1}]}}}).then(function(){p.end(),E.l("".concat(c," ok"));var m=o.get(11);return m.updateIsReadAfterReadReport({conversationID:i,lastMessageTime:s}),m.updateUnreadCount(i),Ae()}).catch(function(m){return p.setError(m).end(),E.l("".concat(c," failed. error:"),m),W(m)})}},{key:"getRoamingMessage",value:function(m){var o=this,i="".concat(this._n,".").concat("getRoamingMessage"),s=m.peerAccount,c=m.conversationID,l=m.count,p=m.lastMessageTime,m=m.messageKey,I="peerAccount:".concat(s," count:").concat(l||15," lastMessageTime:").concat(p||0," messageKey:").concat(m),C=(E.l("".concat(i," ").concat(I)),new ue("getRoamingMessage"));return this.req({P:P.GET_C2C_ROAMING_MSG,data:{peerAccount:s,count:l||15,lastMessageTime:p||0,messageKey:m}}).then(function(k){var k=k.data,U=k.complete,Z=k.messageList,$=k.messageKey,k=k.lastMessageTime,G=(q(Z)?E.l("".concat(i," ok. complete:").concat(U," but messageList is undefined!")):E.l("".concat(i," ok. complete:").concat(U," count:").concat(Z.length)),C.setMessage("".concat(I," complete:").concat(U," length:").concat(Z.length)).end(),o.get(11)),U=U===1,Y=(U&&G.setCompleted(c),[]),Z=G.onRoamingMessage(Z,c,!0,Y),$=(G.modifyMessageList(c),G.updateIsRead(c),G.updateRoamingMsgKeyAndTime(c,$,k),G.getPeerReadTime(c)),$=(E.l("".concat(i," update isPeerRead property. convID:").concat(c," peerReadTime:").concat($)),$?G.updateMsgIsPeerReadProp(c,$):(k=c.replace(O.CONV_C2C,""),o.getRemotePeerReadTime([k]).then(function(){G.updateMsgIsPeerReadProp(c,G.getPeerReadTime(c))})),"");return 0<Z.length?$=Z[0].ID:(k=G.getLocalOldestMessage(c))&&($=k.ID),E.l("".concat(i," nextReqID:").concat($," storedMsgCount:").concat(Z.length)),{nextReqID:$,storedMessageList:Z,assembledMessageList:Y,isPullingCompleted:U}}).catch(function(S){return C.setMessage(I).setError(S).end(),E.w("".concat(i," failed. error:"),S),W(S)})}},{key:"getRoamingMessagesHopping",value:function(t){var o=this,i="".concat(this._n,".").concat("getRoamingMessagesHopping"),s=t.peerAccount,c=t.time,c=c===void 0?0:c,l=t.count,p=t.direction,m="".concat(O.CONV_C2C).concat(s),I="peerAccount:".concat(s," count:").concat(l," time:").concat(c," direction:").concat(p),C=(E.l("".concat(i," ").concat(I)),new ue("getRoamingMessagesHopping"));return this.req({P:P.GET_C2C_ROAMING_MSG,data:{peerAccount:s,count:l+1,lastMessageTime:c,direction:p}}).then(function(k){var k=k.data,Z=k.complete,Y=k.messageList,Y=Y===void 0?[]:Y,k=k.lastMessageTime,U="complete:".concat(Z," count:").concat(Y.length),G=(E.l("".concat(i," ok. ").concat(U)),C.setMessage("".concat(I," ").concat(U)).end(),Z!==1&&(p===1?Y.pop():Y.shift()),o.get(11)),U=G.onRoamingMessage(Y,m,!1),Y=(o._modifyMessageList(m,U),o._computeResult({complete:Z,lastMessageTime:k,resultList:U})),Z=(G.storeHoppingMessageList(Y.messageList),G.getPeerReadTime(m));return E.l("".concat(i," update isPeerRead property. convID:").concat(m," peerReadTime:").concat(Z)),Z?G.updateMsgIsPeerReadProp(m,Z):(k=m.replace(O.CONV_C2C,""),o.getRemotePeerReadTime([k]).then(function(){G.updateMsgIsPeerReadProp(m,G.getPeerReadTime(m))})),Ae(Y)}).catch(function(S){return C.setMessage(I).setError(S).end(),E.w("".concat(i," failed. error:"),S),W(S)})}},{key:"_computeResult",value:function(s){var o=s.complete,o=o===void 0?0:o,i=s.lastMessageTime,s=s.resultList,s={messageList:re(s===void 0?[]:s),isCompleted:!1,nextMessageTime:""};return o===1?s.isCompleted=!0:s.nextMessageTime=i,s}},{key:"_modifyMessageList",value:function(t,o){if(t=this.get(11).getLocalConversation(t),t)for(var i=t.userProfile.nick,s=t.userProfile.avatar,t=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),c=t.nick,l=t.avatar,p=o.length-1;0<=p;p--){var m=o[p];m.flow==="in"&&(m.nick!==i&&m.setNickAndAvatar({nick:i}),m.avatar!==s&&m.setNickAndAvatar({avatar:s})),m.flow==="out"&&(m.nick!==c&&m.setNickAndAvatar({nick:c}),m.avatar!==l&&m.setNickAndAvatar({avatar:l}))}}},{key:"getRemotePeerReadTime",value:function(t){var o=this,i="".concat(this._n,".").concat("getRemotePeerReadTime");if(Te(t))return Promise.resolve();var s=new ue("getRemotePeerReadTime");return E.l("".concat(i," userIDList:").concat(t)),this.req({P:P.GET_C2C_PEER_READ_TIME,data:{userIDList:t}}).then(function(c){var l=c.data.peerReadTimeList;E.l("".concat(i," ok. peerReadTimeList:").concat(l));for(var p="",m=o.get(11),I=0;I<t.length;I++)p+="".concat(t[I],"-").concat(l[I]," "),0<l[I]&&m.recordPeerReadTime("".concat(O.CONV_C2C).concat(t[I]),l[I]);s.setMessage(p).end()}).catch(function(c){s.setError(c).end(),E.w("".concat(i," failed. error:"),c)})}},{key:"sendReadReceipt",value:function(c){var o=c[0].conversationID.replace(O.CONV_C2C,""),i=new ue("sendReadReceipt"),s=(i.setMessage("peerAccount:".concat(o)),this.getMyUserID()),c=c.filter(function(p){return p.from!==s&&p.needReadReceipt===!0}).map(function(p){return{fromAccount:p.from,toAccount:p.to,sequence:p.sequence,random:p.random,time:p.time,clientTime:p.clientTime}});if(c.length===0)return W({code:Q.READ_RECEIPT_MSG_LIST_EMPTY});var l="".concat(this._n,".").concat("sendReadReceipt");return E.l("".concat(l,". peerAccount:").concat(o," length:").concat(c.length)),this.req({P:P.SEND_C2C_READ_RECEIPT,data:{peerAccount:o,messageInfoList:c}}).then(function(p){return i.end(),E.l("".concat(l," ok")),Ae()}).catch(function(p){return i.setError(p).end(),E.w("".concat(l," failed. error:"),p),W(p)})}},{key:"getReadReceiptList",value:function(t){var o=t[0].conversationID.replace(O.CONV_C2C,"");return E.l("".concat(this._n,".getReadReceiptList peerAccount:").concat(o," msgCount:").concat(t.length)),we({messageList:t})}},{key:"getMessageExtensions",value:function(t,o){return E.l("".concat(this._n,".getMessageExtensions startSequence:").concat(o)),this.req({P:P.GET_C2C_MSG_EXT,data:{from:t.from,to:t.to,messageKey:this.getMessageKey(t),startSequence:o}})}},{key:"modifyMsgExts",value:function(t,o){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return E.l("".concat(this._n,".modifyMsgExts operateType:").concat(i)),this.req({P:P.MODIFY_C2C_MSG_EXT,data:{from:t.from,to:t.to,messageKey:this.getMessageKey(t),extensionList:o,operateType:i}})}},{key:"getMessageKey",value:function(s){var o=s.clientSequence,i=s.random,s=s.time;return"".concat(o,"_").concat(i,"_").concat(s)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._msgFromUnreadDBMap.clear(),this._noticeFromUnreadDBList.length=0}}]);var Oc,Mr=ca,Yt={A2KEY_AND_TINYID_UPDATED:"_inner".concat(1),CLOUD_CONFIG:"_inner".concat(2),PROFILE_UPDATED:"_inner".concat(3),CONV_SYNC_COMPLETED:"_inner".concat(4),C2C_UNREAD_HANDLE_COMPLETED:"_inner".concat(5)},Pu=(V(Cr,[{key:"_onCloudConfig",value:function(){var t=this._convM.getCloudConfig("topic_msg_limit");q(t)||(this.TOPIC_MSG_LIMIT=Number(t)),E.l("".concat(this._n,"._onCloudConfig topicMsgLimit:").concat(this.TOPIC_MSG_LIMIT))}},{key:"onCheckTimer",value:function(t){if(t%20==0&&0<this._map.size){var o,i=A(this._map);try{for(i.s();!(o=i.n()).done;){var s=Le(o.value,2),c=s[0],l=s[1];c.includes(Pa)&&l.size>=this.TOPIC_MSG_LIMIT&&this._convM.clearMemMsg(c,!0)}}catch(p){i.e(p)}finally{i.f()}}}},{key:"pushIn",value:function(t){var o=1<arguments.length&&arguments[1]!==void 0&&arguments[1],i=t.conversationID,s=!0,c=(this._map.has(i)||this._map.set(i,new Map),this._getUniqueIDOfMsg(t));if(this._map.get(i).has(c)){var l=this._map.get(i).get(c);if(!o||l.isModified===!0)return!1}return this._map.get(i).set(c,t),this._setLatestMsgSentByPeer(i,t),this._setLatestMsgSentByMe(i,t),s}},{key:"unshift",value:function(t,o){var i;if(ye(t)?0<t.length&&(i=t[0].conversationID,this._unshiftMultipleMsgs(t,o)):(i=t.conversationID,this._unshiftSingleMsg(t,o)),i){var s=Array.from(this._map.get(i).values()),t=s.length;if(t!==0){for(var c=t-1;0<=c;c--)if(s[c].flow==="out"){this._setLatestMsgSentByMe(i,s[c]);break}if(i.startsWith(O.CONV_C2C)){for(var l=t-1;0<=l;l--)if(s[l].flow==="in"){this._setLatestMsgSentByPeer(i,s[l]);break}}}}}},{key:"_unshiftSingleMsg",value:function(t,o){var i=t.conversationID,s=this._getUniqueIDOfMsg(t);if(!this._map.has(i))return this._map.set(i,new Map),this._map.get(i).set(s,t),void o.push(t);var c=this._map.get(i),l=Array.from(c);c.has(s)||(l.unshift([s,t]),this._map.set(i,new Map(l)),o.push(t))}},{key:"_unshiftMultipleMsgs",value:function(t,o){for(var i=t.length,s=[],c=t[0].conversationID,l=this._map.get(c),p=this._map.has(c)?Array.from(l):[],m=0;m<i;m++){var I=this._getUniqueIDOfMsg(t[m]);l&&l.has(I)||(s.push([I,t[m]]),o.push(t[m]))}this._map.set(c,new Map(s.concat(p)))}},{key:"remove",value:function(i){var o=i.conversationID,i=this._getUniqueIDOfMsg(i);this._map.has(o)&&this._map.get(o).delete(i)}},{key:"revoke",value:function(t,o,i){var s;return this._map.has(t)?(s=this._map.get(t),this._updateMsgIsRevoked(s,o,i)):this._hoppingMsgMap.has(t)?(s=this._hoppingMsgMap.get(t),this._updateMsgIsRevoked(s,o,i)):null}},{key:"_updateMsgIsRevoked",value:function(t,o,i){var s,c=A(t);try{for(c.s();!(s=c.n()).done;){var l=Le(s.value,2)[1];if(l.sequence===o&&(q(i)||l.random===i))return l.isRevoked||(l.isRevoked=!0),l}}catch(p){c.e(p)}finally{c.f()}}},{key:"removeByConvID",value:function(t){var o=this._map.has(t);E.l("".concat(this._n,".removeByConvID convID:").concat(t," has:").concat(o)),o&&(this._map.delete(t),this._latestMsgSentByPeerMap.delete(t),this._latestMsgSentByMeMap.delete(t))}},{key:"findMessage",value:function(t){var o=null;return o=(o=this._findMsg(t,this._map))?o:this._findMsg(t,this._hoppingMsgMap)}},{key:"_findMsg",value:function(t,o){var i,s=null,c=A(o);try{for(c.s();!(i=c.n()).done;)for(var l=re(Le(i.value,2)[1].values()),p=l.length,m=0;m<p;m++)if(l[m].ID===t){s=l[m];break}}catch(I){c.e(I)}finally{c.f()}return s}},{key:"updateMsgIsPeerReadProp",value:function(t,o){var i,s=[];return this._map.has(t)?(i=this._map.get(t),s=this._updateMsgIsPeerReadProp(i,o)):this._hoppingMsgMap.has(t)&&(i=this._hoppingMsgMap.get(t),s=this._updateMsgIsPeerReadProp(i,o)),E.l("".concat(this._n,".updateMsgIsPeerReadProp convID:").concat(t," peerReadTime:").concat(o," count:").concat(s.length)),s}},{key:"_updateMsgIsPeerReadProp",value:function(t,o){var i,s=[],c=A(t);try{for(c.s();!(i=c.n()).done;){var l=Le(i.value,2)[1];l.time<=o&&!l.isPeerRead&&l.flow==="out"&&(l.isPeerRead=!0,s.push(l))}}catch(p){c.e(p)}finally{c.f()}return s}},{key:"updateMsgIsModifiedProp",value:function(t){var o=t.conversationID;this._map.has(o)&&(t=this._getUniqueIDOfMsg(t),(o=this._map.get(o).get(t))&&(o.isModified=!0))}},{key:"hasLocalMsgList",value:function(t){return this._map.has(t)}},{key:"getLocalMsgList",value:function(t){return this.hasLocalMsgList(t)?re(this._map.get(t).values()):[]}},{key:"getLocalMaxSeq",value:function(t){return this.hasLocalMsgList(t)?(t=re(this._map.get(t).values()).map(function(o){return o.sequence}),Math.max.apply(Math,re(t))):0}},{key:"getLocalMaxTime",value:function(t){return this.hasLocalMsgList(t)?(t=re(this._map.get(t).values()).map(function(o){return o.time}),Math.max.apply(Math,re(t))):0}},{key:"hasLocalMsg",value:function(t,o){for(var i=!1,s=this.getLocalMsgList(t),c=s.length,l=0;l<c;l++)s[l].ID===o&&(i=!0);return i}},{key:"getLocalMsg",value:function(t,o){for(var i=null,s=this.getLocalMsgList(t),c=s.length,l=0;l<c;l++)if(s[l].ID===o){i=s[l];break}return i}},{key:"getLocalLastMsg",value:function(t){return t=this.getLocalMsgList(t),t[t.length-1]}},{key:"getLocalSecondLastMsg",value:function(t){return t=this.getLocalMsgList(t),t[t.length-2]}},{key:"getLocalOldestMsg",value:function(t){return this.getLocalMsgList(t)[0]}},{key:"_setLatestMsgSentByPeer",value:function(t,o){t.startsWith(O.CONV_C2C)&&o.flow==="in"&&this._latestMsgSentByPeerMap.set(t,o)}},{key:"_setLatestMsgSentByMe",value:function(t,o){o.flow==="out"&&this._latestMsgSentByMeMap.set(t,o)}},{key:"getLatestMsgSentByPeer",value:function(t){return this._latestMsgSentByPeerMap.get(t)}},{key:"getLatestMsgSentByMe",value:function(t){return this._latestMsgSentByMeMap.get(t)}},{key:"modifyMsgSentByPeer",value:function(c){var o=c.conversationID,i=c.latestNick,s=c.latestAvatar,c=this._map.get(o);if(!Te(c)){var l=Array.from(c.values()),c=l.length;if(c!==0){for(var p=null,m=0,I=!1,C=c-1;0<=C;C--)l[C].flow==="in"&&((p=l[C]).nick!==i&&(p.setNickAndAvatar({nick:i}),I=!0),p.avatar!==s&&(p.setNickAndAvatar({avatar:s}),I=!0),I&&(m+=1));E.l("".concat(this._n,".modifyMsgSentByPeer convID:").concat(o," count:").concat(m))}}}},{key:"modifyMsgSentByMe",value:function(c){var o=c.conversationID,i=c.latestNick,s=c.latestAvatar,c=this._map.get(o);if(!Te(c)){var l=Array.from(c.values()),c=l.length;if(c!==0){for(var p=null,m=0,I=!1,C=c-1;0<=C;C--)l[C].flow==="out"&&((p=l[C]).nick!==i&&(p.setNickAndAvatar({nick:i}),I=!0),p.avatar!==s&&(p.setNickAndAvatar({avatar:s}),I=!0),I&&(m+=1));E.l("".concat(this._n,".modifyMsgSentByMe convID:").concat(o," count:").concat(m))}}}},{key:"getTopicConvIDList",value:function(t){return re(this._map.keys()).filter(function(o){return o.startsWith("".concat(O.CONV_GROUP).concat(t))})}},{key:"onMsgModified",value:function(t,o){if(!this._map.has(t)&&!this._hoppingMsgMap.has(t))return{isUpdated:!1,message:null};var i="".concat(this._n,".onMsgModified"),s=this._getUniqueIDOfMsg(o),c=this._getTargetMsg(t,s),l=!!c;return E.l("".concat(i," convID:").concat(t," uniqueID:").concat(s," has:").concat(l)),l?(t=o.messageVersion,s=o.elements,l=o.cloudCustomData,o=o.checkResult,E.l("".concat(i," localVersion:").concat(c.version," remoteVersion:").concat(t)),c.version<t?(c.version=t,c._elements=JSON.parse(JSON.stringify(s)),c.payload=c._elements[0].content,c.type=c._elements[0].type,c.cloudCustomData=l,c.isModified=!0,c.hasRiskContent=Tc(o),{isUpdated:!0,message:c}):{isUpdated:!1,message:c}):{isUpdated:!1,message:null}}},{key:"_getUniqueIDOfMsg",value:function(l){var o=l.from,i=l.to,s=l.random,c=l.sequence,l=l.time;return"".concat(o,"-").concat(i,"-").concat(s,"-").concat(c,"-").concat(l)}},{key:"_getTargetMsg",value:function(t,o){if(this._map.has(t))return this._map.get(t).get(o);var i=void 0;if(this._hoppingMsgMap.has(t)){for(var s=re(this._hoppingMsgMap.get(t).values()),c=0;c<s.length;c++)if(this._getUniqueIDOfMsg(s[c])===o){i=s[c];break}}return i}},{key:"storeHoppingMsgList",value:function(t){if(t.length!==0){var o=t[0].conversationID,i=t.length;this._hoppingMsgMap.has(o)||this._hoppingMsgMap.set(o,new Map);for(var s=this._hoppingMsgMap.get(o),c=0;c<i;c++){var l=t[c];s.has(l.ID)||s.set(l.ID,l)}}}},{key:"getHoppingMsg",value:function(t,o){if(this._hoppingMsgMap.has(t))return this._hoppingMsgMap.get(t).get(o)}},{key:"reset",value:function(){this._map.clear(),this._latestMsgSentByPeerMap.clear(),this._latestMsgSentByMeMap.clear(),this._hoppingMsgMap.clear()}}]),Cr);function Cr(t){N(this,Cr),this._convM=t,this._map=new Map,this._n="MsgListHandler",this._latestMsgSentByPeerMap=new Map,this._latestMsgSentByMeMap=new Map,this._hoppingMsgMap=new Map,this.TOPIC_MSG_LIMIT=1e3,this._convM.getIEmitInst().on(Yt.CLOUD_CONFIG,this._onCloudConfig,this)}function ca(t){return N(this,ca),(t=Oc.call(this,t))._n="C2CModule",t._msgFromUnreadDBMap=new Map,t._noticeFromUnreadDBList=[],t}function Tr(t){this.mixin(t)}Tr.mixin=function(t){t=t.prototype||t,t._isReady=!1,t.ready=function(o){if(o)return this._isReady?void(1<arguments.length&&arguments[1]!==void 0&&arguments[1]?o.call(this):setTimeout(o,1)):(this._readyQueue=this._readyQueue||[],void this._readyQueue.push(o))},t.triggerReady=function(){var o=this;this._isReady=!0,setTimeout(function(){var i=o._readyQueue;o._readyQueue=[],i&&0<i.length&&i.forEach(function(s){s.call(this)},o)},1)},t.resetReady=function(){this._isReady=!1,this._readyQueue=[]},t.isReady=function(){return this._isReady}};function Gu(t,o,i){return q(t)?{lastTime:0,lastSequence:0,fromAccount:"",messageForShow:"",payload:null,type:"",isRevoked:!1,cloudCustomData:"",onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:!1,revoker:null}:i&&t.ID||t instanceof Mn?{lastTime:t.time||0,lastSequence:t.sequence||0,fromAccount:t.from||"",messageForShow:Qi(t.type,t.payload,o),payload:t.payload||null,type:t.type||null,isRevoked:t.isRevoked||!1,cloudCustomData:t.cloudCustomData||"",onlineOnlyFlag:t._onlineOnlyFlag||!1,nick:t.nick||"",nameCard:t.nameCard||"",version:t.version||0,isPeerRead:t.isPeerRead||!1,revoker:t.revoker||null}:v(v({},t),{},{messageForShow:Qi(t.type,t.payload,o)})}function Uu(t,o){return Te(t)?{lastTime:0,lastSequence:0,fromAccount:"",payload:null,type:"",messageForShow:"",nick:"",avatar:"",version:0,cloudCustomData:"",isRevoked:!1,revoker:null}:{lastTime:t.time||0,lastSequence:t.sequence||0,fromAccount:t.from||"",payload:t.payload||null,type:t.type||"",messageForShow:Qi(t.type,t.payload,o),nick:t.nick||"",avatar:t.avatar||"",version:t.version||0,cloudCustomData:t.cloudCustomData||"",isRevoked:t.isRevoked||!1,revoker:t.revoker||null}}function ui(t){var o=String(t).replace(/[=]+$/,""),i="";if(o.length%4==1)return"";for(var s,c,l=0,p=0;c=o.charAt(p++);~c&&(s=l%4?64*s+c:c,l++%4)&&(i+=String.fromCharCode(255&s>>(-2*l&6))))c="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(c);try{return decodeURIComponent(escape(i))}catch(m){return""}}var Sr,wu,Po,ua,Nc,Xl=["jpg","jpeg","gif","png","bmp","image","webp"],Ql=["mp4","quicktime","mov"],us=(V(Rs,[{key:"validate",value:function(t){var o,i=!0,s="";if(Te(t))return{valid:!1,tips:"empty options"};if(t.profileCustomField)for(var c=t.profileCustomField.length,l=null,p=0;p<c;p++){if(l=t.profileCustomField[p],!Ee(l.key)||l.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!Ee(l.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(o==="profileCustomField")continue;if(Te(t[o])&&!Ee(t[o])&&!ut(t[o])){s="key:"+o+", invalid value:"+t[o],i=!1;continue}switch(o){case"nick":Ee(t[o])||(i=!(s="nick must be a string")),500<gi(t[o])&&(s="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(gi(t[o])," bytes"),i=!1);break;case"gender":vo(co,t.gender)||(s="key:gender, invalid value:"+t.gender,i=!1);break;case"birthday":ut(t.birthday)||(i=!(s="birthday must be a number"));break;case"location":Ee(t.location)||(i=!(s="location must be a string"));break;case"selfSignature":Ee(t.selfSignature)||(i=!(s="selfSignature must be a string"));break;case"allowType":vo(hc,t.allowType)||(s="key:allowType, invalid value:"+t.allowType,i=!1);break;case"language":ut(t.language)||(i=!(s="language must be a number"));break;case"avatar":Ee(t.avatar)||(i=!(s="avatar must be a string"));break;case"messageSettings":t.messageSettings!==0&&t.messageSettings!==1&&(i=!(s="messageSettings must be 0 or 1"));break;case"adminForbidType":vo(gc,t.adminForbidType)||(s="key:adminForbidType, invalid value:"+t.adminForbidType,i=!1);break;case"level":ut(t.level)||(i=!(s="level must be a number"));break;case"role":ut(t.role)||(i=!(s="role must be a number"));break;default:s="unknown key:"+o+"  "+t[o],i=!1}}return{valid:i,tips:s}}}]),Rs),bc=(V(Es,[{key:"set",value:function(t){var o;this.map.size>=this.MAX_LENGTH&&(o=this.map.entries().next().value[0],this.map.delete(o)),this.map.set(t,1)}},{key:"has",value:function(t){return this.map.has(t)}},{key:"delete",value:function(t){this.has(t)&&this.map.delete(t)}},{key:"reset",value:function(){this.map.clear()}}]),Es),Zl=["groupID","name","avatar","type","introduction","notification","ownerID","selfInfo","createTime","infoSequence","lastInfoTime","lastMessage","nextMessageSeq","memberNum","maxMemberNum","memberList","joinOption","groupCustomField","muteAllMembers","isSupportTopic","inviteOption","_lastRevokedTime"],Go=(V(qc,[{key:"memberNum",get:function(){return this.memberCount},set:function(t){}},{key:"maxMemberNum",get:function(){return this.maxMemberCount},set:function(t){}},{key:"_initGroup",value:function(t){for(var o in t)Zl.indexOf(o)<0||(o!=="selfInfo"?(o==="memberNum"&&(this.memberCount=t[o]),o==="maxMemberNum"&&(this.maxMemberCount=t[o]),o!=="isSupportTopic"?this[o]=t[o]:this.isSupportTopic=t[o]===1):this.updateSelfInfo(t[o]))}},{key:"updateGroup",value:function(i){var o=this,i=(i.appid=void 0,i.grossTopicNextMsgSeq=void 0,i.selfInfo&&(i.selfInfo.grossTopicReadSeq=void 0),JSON.parse(JSON.stringify(i)));i.lastMsgTime&&(this.lastMessage.lastTime=i.lastMsgTime),q(i.muteAllMembers)||(i.muteAllMembers==="On"?i.muteAllMembers=!0:i.muteAllMembers=!1),i.groupCustomField&&Ho(this.groupCustomField,i.groupCustomField),q(i.memberNum)||(this.memberCount=i.memberNum),q(i.maxMemberNum)||(this.maxMemberCount=i.maxMemberNum),q(i.isSupportTopic)||(this.isSupportTopic=ut(i.isSupportTopic)?i.isSupportTopic===1:i.isSupportTopic),Gn(this,i,["members","errorCode","lastMsgTime","groupCustomField","memberNum","maxMemberNum","isSupportTopic"]),ye(i.members)&&0<i.members.length&&i.members.forEach(function(s){s.userID===o.selfInfo.userID&&Gn(o.selfInfo,s,["sequence"])})}},{key:"updateSelfInfo",value:function(t){t={nameCard:t.nameCard,joinTime:t.joinTime,role:t.role,messageRemindType:t.messageRemindType,readedSequence:t.readedSequence,excludedUnreadSequenceList:t.excludedUnreadSequenceList},Gn(this.selfInfo,v({},t),[],["",null,void 0,0,NaN])}},{key:"setSelfNameCard",value:function(t){this.selfInfo.nameCard=t}}]),qc),ls=(V(xc,[{key:"toAccount",get:function(){return this.conversationID.startsWith(O.CONV_C2C)?this.conversationID.replace(O.CONV_C2C,""):this.conversationID.startsWith(O.CONV_GROUP)?this.conversationID.replace(O.CONV_GROUP,""):""}},{key:"_initProfile",value:function(t){var o=this;Object.keys(t).forEach(function(i){switch(i){case"userProfile":o.userProfile=t.userProfile;break;case"groupProfile":o.groupProfile=t.groupProfile}}),q(this.userProfile)&&this.type===O.CONV_C2C?this.userProfile=new us({userID:t.conversationID.replace("C2C","")}):q(this.groupProfile)&&this.type===O.CONV_GROUP&&(this.groupProfile=new Go({groupID:t.conversationID.replace("GROUP","")}))}},{key:"updateUnreadCount",value:function(s){var o=s.nextUnreadCount,i=s.isFromGetConversations,s=s.isUnreadC2CMessage;q(o)||(Vt(this.subType)?this.unreadCount=0:i&&this.type===O.CONV_GROUP||i&&this.type===O.CONV_TOPIC||s&&this.type===O.CONV_C2C?this.unreadCount=o:this.unreadCount=this.unreadCount+o)}},{key:"updateLastMessage",value:function(t){this.lastMessage=Gu(t)}},{key:"updateGroupAtInfoList",value:function(t){var o;this._isNeedMergeGroupAtInfo(t)||((o=(Be(o=t.groupAtType)||Ye(o)||Xe(o)||me()).slice(0)).indexOf(O.CONV_AT_ME)!==-1&&o.indexOf(O.CONV_AT_ALL)!==-1&&(o=[O.CONV_AT_ALL_AT_ME]),o={from:t.from,groupID:t.groupID,topicID:t.topicID,messageSequence:t.sequence,atTypeArray:o,__random:t.__random,__sequence:t.__sequence},this.groupAtInfoList.push(o))}},{key:"_isNeedMergeGroupAtInfo",value:function(t){var o=t.groupID,i=t.sequence;if(!bt({groupID:o}))return!1;var s=!1;return this.groupAtInfoList.forEach(function(c){c.messageSequence===i&&(-1<c.atTypeArray.indexOf(O.CONV_AT_ME)&&-1<t.groupAtType.indexOf(O.CONV_AT_ALL)&&(c.atTypeArray=[O.CONV_AT_ALL_AT_ME]),-1<c.atTypeArray.indexOf(O.CONV_AT_ALL)&&-1<t.groupAtType.indexOf(O.CONV_AT_ME)&&(c.atTypeArray=[O.CONV_AT_ALL_AT_ME],c.__random=t.__random,c.__sequence=t.__sequence),s=!0)}),s}},{key:"clearGroupAtInfoList",value:function(){this.groupAtInfoList.length=0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(i){var o=i.sequence,i=i.time;return this.type===O.CONV_C2C&&o===this.lastMessage.lastSequence&&i===this.lastMessage.lastTime||this.type===O.CONV_GROUP&&o===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(t){this.lastMessage.isRevoked=t}},{key:"setLastMessageRevoker",value:function(t){this.lastMessage.revoker=t}},{key:"setDraftText",value:function(t){this.draftText=t}}]),xc),Fu=(H(dn={},O.MSG_REMIND_ACPT_AND_NOTE,0),H(dn,O.MSG_REMIND_DISCARD,1),H(dn,O.MSG_REMIND_ACPT_NOT_NOTE,2),dn),xu=(V(Fc,[{key:"onAllRcvMsgOptNotify",value:function(t){t=this._handleResult(t),this._convM.emitOEvt(Me.ALL_RECEIVE_MESSAGE_OPT_UPDATED,t)}},{key:"getC2CMsgRemindType",value:function(t){var o=this,i="".concat(this._n,".getC2CMsgRemindType");return this._convM.req({P:P.GET_C2C_PEER_MUTE_NOTIFICATIONS,data:{toAccount:this._convM.getMyUserID(),userIDList:t}}).then(function(s){E.l("".concat(i," ok. userIDList:").concat(t)),s=s.data.muteFlagList,o._convM.onC2CMsgRemindTypeFetched(s)}).catch(function(s){E.e("".concat(i," failed. error:"),s)})}},{key:"set",value:function(t){return t.groupID?this._setGroupMsgRemindType(t):ye(t.userIDList)?this._setC2CMsgRemindType(t):void 0}},{key:"_setGroupMsgRemindType",value:function(t){var o=this,i="".concat(this._n,".").concat("_setGroupMsgRemindType"),s=t.groupID,c=t.messageRemindType,l="groupID:".concat(s," messageRemindType:").concat(c),p=new ue("_setGroupMsgRemindType"),m=(p.setMessage(l),this._get(7));return m?m.modifyGroupMemberInfo({groupID:s,messageRemindType:c,userID:this._convM.getMyUserID()}).then(function(){p.end(),E.l("".concat(i," ok. ").concat(l));var I=o.onGroupMsgRemindTypeUpdated(t);return o._convM.onTotalUnreadCountUpdate(),Ae(I)}).catch(function(I){return p.setError(I).end(),E.e("".concat(i," failed. error:"),I),W(I)}):W({code:Q.NO_MODULE})}},{key:"onGroupMsgRemindTypeUpdated",value:function(c){var o,i,s=c.groupID,c=c.messageRemindType,l=(E.l("".concat(this._n,".onGroupMsgRemindTypeUpdated groupID:").concat(s," messageRemindType:").concat(c)),this._get(7).getLocalGroupProfile(s));return l&&(l.selfInfo.messageRemindType=c),Lt(s)?(o=un(i=s),(i=this._get(10).getLocalTopic(o,i))&&i.updateSelfInfo({messageRemindType:c})&&this._convM.emitOEvt(Me.TOPIC_UPDATED,{groupID:o,topic:i}),{topic:i}):(this._convM.patchMsgRemindType({ID:s,isC2CConversation:!1,messageRemindType:c})&&this._emitConvUpdate(),{group:l})}},{key:"_setC2CMsgRemindType",value:function(p){var o=this,i="".concat(this._n,".").concat("_setC2CMsgRemindType"),s=p.userIDList,c=p.messageRemindType,l=s.slice(0,30),p=Fu[c]||0,m="userIDList:".concat(l," messageRemindType:").concat(c),I=new ue("_setC2CMsgRemindType");return I.setMessage(m),this._convM.req({P:P.SET_C2C_PEER_MUTE_NOTIFICATIONS,data:{userIDList:l,muteFlag:p}}).then(function(G){I.end();var G=G.data.errorList,S=[],k=[],G=(ye(G)&&G.forEach(function(Y){S.push(Y.userID),k.push({userID:Y.userID,code:Y.errorCode})}),l.filter(function(Y){return S.indexOf(Y)===-1})),U=(E.l("".concat(i," ok. ").concat(m," successUserIDList:").concat(G," failureUserIDList:").concat(JSON.stringify(k))),0);return G.forEach(function(Y){o._convM.patchMsgRemindType({ID:Y,isC2CConversation:!0,messageRemindType:c})&&(U+=1)}),1<=U&&o._emitConvUpdate(),l.length=S.length=0,o._convM.onTotalUnreadCountUpdate(),we({successUserIDList:G.map(function(Y){return{userID:Y}}),failureUserIDList:k})}).catch(function(C){return I.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"_get",value:function(t){return this._convM.get(t)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"setAllRcvMsgOpt",value:function(p){var o="".concat(this._n,".").concat("setAllRcvMsgOpt"),i=p.messageRemindType,i=i===void 0?O.MSG_REMIND_ACPT_NOT_NOTE:i,s=p.isRepeated,s=s===void 0||s,l=this._calcStartAndEndTime(p),c=l.startTime,c=c===void 0?0:c,l=l.endTime,l=l===void 0?0:l,p=JSON.stringify(p),m=new ue("setAllRcvMsgOpt");return m.setMessage(p),E.l("".concat(o," options:").concat(p)),this._convM.req({P:P.SET_ALL_RECEIVE_MSG_OPT,data:{messageRemindType:Fu[i],startTime:c,endTime:l,isRepeated:s?1:0}}).then(function(I){return m.end(),E.l("".concat(o," ok.")),Ae(I)}).catch(function(I){return m.setError(I).end(),E.e("".concat(o," failed. error:"),I),W(I)})}},{key:"_calcStartAndEndTime",value:function(l){var o=l.startHour,o=o===void 0?0:o,i=l.startMinute,i=i===void 0?0:i,s=l.startSecond,s=s===void 0?0:s,c=l.duration,c=c===void 0?0:c,l=l.isRepeated,l=l===void 0||l,m=new Date,I=m.getFullYear(),p=m.getMonth(),m=m.getDate(),I=Math.round(new Date(I,p,m,o,i,s).getTime()/1e3);return{startTime:I,endTime:l&&86400<=c?I+86400:I+c}}},{key:"getAllRcvMsgOpt",value:function(){var t=this,o="".concat(this._n,".").concat("getAllRcvMsgOpt"),i=new ue("getAllRcvMsgOpt");return this._convM.req({P:P.GET_ALL_RECEIVE_MSG_OPT,data:{toAccount:this._convM.getMyUserID()}}).then(function(s){return s=s.data,i.setMessage(JSON.stringify(s)).end(),E.l("".concat(o," ok. data:").concat(JSON.stringify(s))),s=t._handleResult(s),Ae(s)}).catch(function(s){return i.setError(s).end(),E.e("".concat(o," failed. error:"),s),W(s)})}},{key:"_handleResult",value:function(c){var o=c.messageRemindType,i=c.startTime,s=c.endTime,c=c.isRepeated,l=O.MSG_REMIND_ACPT_AND_NOTE;return o===1&&(l=O.MSG_REMIND_DISCARD),{messageRemindType:l=o===2?O.MSG_REMIND_ACPT_NOT_NOTE:l,startTime:i,endTime:s,isRepeated:c===1}}},{key:"reset",value:function(){E.l("".concat(this._n,".reset"))}}]),Fc),ed=(V(Er,[{key:"setConvCustomData",value:function(t){var o=this,i="".concat(this._n,".").concat("setConvCustomData"),s=t.conversationIDList,c=t.customData,l=(E.l("".concat(i," options:"),t),new ue("setConvCustomData")),p=(l.setMessage(JSON.stringify(t)),{fromAccount:this._getMyUserID(),itemList:[]}),m=[],I=[];return s.forEach(function(C){if(!o._hasLocalConv(C))return o._onConvNotFound(I,C),!0;if(!Bt(C)&&!wn(C))return o._onConvIDInvalid(I,C),!0;var S={operationType:2,contactItem:void 0,customMark:c};Bt(C)?S.contactItem={type:1,toAccount:C.replace(O.CONV_C2C,"")}:wn(C)&&(S.contactItem={type:2,groupID:C.replace(O.CONV_GROUP,"")}),p.itemList.push(S)}),I.length===s.length?we({successConversationIDList:m,failureConversationIDList:I}):this._convM.req({P:P.SET_CONV_CUSTOM_DATA,data:p}).then(function(U){l.end(),E.l("".concat(i," ok"));var S,k,G,U=U.data.resultItem;return ye(U)&&(G=!1,U.forEach(function(Y){S=o._concatConvID(Y.contactItem),Y.resultCode===0?(m.push(S),(k=o._getLocalConv(S))&&k.customData!==c&&(k.customData=c,G=!0)):I.push({conversationID:S,code:Y.resultCode,message:Y.resultInfo})}),G===!0&&o._emitConvUpdate()),Ae({successConversationIDList:m,failureConversationIDList:I})}).catch(function(C){return l.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"markConv",value:function(C){var o=this;if(!this._convM.canIUse(Ue.CONV_MARK))return this._convM.noUse("markConv");var i="".concat(this._n,".").concat("markConv"),s=C.conversationIDList,c=C.markType,l=C.enableMark,p=(E.l("".concat(i," options:"),C),new ue("markConv")),m=(p.setMessage(JSON.stringify(C)),void 0),I=void 0,C=this._getFlagBit(c),S=(l===!0?I=[C]:m=[C],{fromAccount:this._getMyUserID(),itemList:[]}),k=[],G=[];return s.forEach(function(U){if(!o._hasLocalConv(U))return o._onConvNotFound(G,U),!0;if(!Bt(U)&&!wn(U))return o._onConvIDInvalid(G,U),!0;var Y={operationType:1,contactItem:void 0,clearMark:m,setMark:I};Bt(U)?Y.contactItem={type:1,toAccount:U.replace(O.CONV_C2C,"")}:wn(U)&&(Y.contactItem={type:2,groupID:U.replace(O.CONV_GROUP,"")}),S.itemList.push(Y)}),G.length===s.length?we({successConversationIDList:k,failureConversationIDList:G}):this._convM.req({P:P.MARK_CONV,data:S}).then(function(De){p.end(),E.l("".concat(i," ok"));var Y,Z,$,De=De.data.resultItem;return ye(De)&&($=!1,De.forEach(function(_e){var Pe;Y=o._concatConvID(_e.contactItem),_e.resultCode===0?(k.push(Y),(Z=o._getLocalConv(Y))&&(Pe=Z.markList.indexOf(c),l===!0?Pe===-1&&(Z.markList.push(c),$=!0):Pe!==-1&&(Z.markList.splice(Pe,1),$=!0))):G.push({conversationID:Y,code:_e.resultCode,message:_e.resultInfo})}),$===!0&&o._emitConvUpdate()),Ae({successConversationIDList:k,failureConversationIDList:G})}).catch(function(U){return p.setError(U).end(),E.e("".concat(i," failed. error:"),U),W(U)})}},{key:"getLocalConvGroupList",value:function(){var t=this;return E.l("".concat(this._n,".getLocalConvGroupList pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===yi?this.getRemoteConvGroupList().then(function(){return Ae(re(t._convGroupMap.values()))}):we(re(this._convGroupMap.values()))}},{key:"searchConvGroupAndMark",value:function(t,o){var i=this,s="".concat(this._n,".searchConvGroupAndMark"),c=[];return t.forEach(function(l){o===1?c.push({type:1,toAccount:l}):o===2&&c.push({type:2,groupID:l})}),E.l("".concat(s," type:").concat(o," list:"),t),this._convM.req({P:P.SEARCH_CONV_GRP_MARK,data:{fromAccount:this._getMyUserID(),contactItem:c}}).then(function(m){var m=m.data,p=m.contactItem,m=m.groupItem;E.l("".concat(s," ok. contactItem:"),p,"groupItem:",m),i._fillConvGroupMap(m),i._handleContactItem(p),i._emitConvUpdate()}).catch(function(l){E.w("".concat(s," failed. error:"),l)})}},{key:"_fillConvGroupMap",value:function(t){var o=this;ye(t)&&t.forEach(function(c){var s=c.convGroupID,c=c.groupName;o._convGroupMap.set(s,c)})}},{key:"_handleContactItem",value:function(t){var o,i=this;ye(t)&&t.forEach(function(s){var c=[],l=s.standardMark,p=s.customData,m=s.convGroupIDList;ye(m)&&m.forEach(function(I){i._convGroupMap.has(I)&&c.push(i._convGroupMap.get(I))}),o=i._concatConvID(s),(o=i._getLocalConv(o))&&(o.markList=Zi(l),o.customData=p||"",o.conversationGroupList=[].concat(c))})}},{key:"getRemoteConvGroupList",value:function(){var t=this,o="".concat(this._n,".getRemoteConvGroupList");return this._pagingStatus=an,this._convM.req({P:P.GET_CONV_GRP_LIST,data:{fromAccount:this._getMyUserID(),startIndex:this._startIndex}}).then(function(p){var p=p.data,s=p.completeFlag,c=p.contactItem,l=p.nextStartIndex,l=l===void 0?0:l,p=p.groupItem;if(t._startIndex=l,E.l("".concat(o," completeFlag:").concat(s," nextStartIndex:").concat(l,", groupItem:"),p,"contactItem:",c),t._fillConvGroupMap(p),t._handleContactItem(c),s===0)return t.getRemoteConvGroupList();s===1&&(t._pagingStatus=Rt,t._emitConvUpdate(),t._emitConvGroupListUpdate())}).catch(function(i){t._pagingStatus=yi,E.w("".concat(o," failed. error:"),i)})}},{key:"createConvGroup",value:function(l){var o=this;if(!this._convM.canIUse(Ue.CONV_GROUP))return this._convM.noUse("createConvGroup");var i="".concat(this._n,".").concat("createConvGroup"),s=(E.l("".concat(i," options:"),l),new ue("createConvGroup")),c=(s.setMessage(JSON.stringify(l)),l.groupName),l=l.conversationIDList,p={fromAccount:this._getMyUserID(),itemList:[{groupName:c,contactItem:[]}]},m=[],I=[];return l.forEach(function(C){return o._hasLocalConv(C)?Bt(C)||wn(C)?void(Bt(C)?p.itemList[0].contactItem.push({type:1,toAccount:C.replace(O.CONV_C2C,"")}):wn(C)&&p.itemList[0].contactItem.push({type:2,groupID:C.replace(O.CONV_GROUP,"")})):(o._onConvIDInvalid(I,C),!0):(o._onConvNotFound(I,C),!0)}),I.length===l.length?we({successConversationIDList:m,failureConversationIDList:I}):this._convM.req({P:P.CREATE_CONV_GRP,data:p}).then(function(Y){s.end(),E.l("".concat(i," ok"));var S,k,G,Y=Y.data.groupResultItem[0],U=Y.groupItem,Y=Y.resultItem;return It(U)&&(o._convGroupMap.set(U.convGroupID,U.groupName),o._emitConvGroupListUpdate()),ye(Y)&&(G=!1,Y.forEach(function(Z){S=o._concatConvID(Z.contactItem),Z.resultCode===0?(m.push(S),(k=o._getLocalConv(S))&&k.conversationGroupList.indexOf(c)===-1&&(k.conversationGroupList.push(c),G=!0)):I.push({conversationID:S,code:Z.resultCode,message:Z.resultInfo})}),G===!0&&(o._emitConvUpdate(),o._emitConvGroupListUpdate())),Ae({successConversationIDList:m,failureConversationIDList:I})}).catch(function(C){return s.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"deleteConvGroup",value:function(t){var o=this;if(!this._convM.canIUse(Ue.CONV_GROUP))return this._convM.noUse("deleteConvGroup");var i="".concat(this._n,".").concat("deleteConvGroup"),s=(E.l("".concat(i," groupName:").concat(t)),new ue("deleteConvGroup"));return s.setMessage(t),this._convM.req({P:P.DEL_CONV_GRP,data:{fromAccount:this._getMyUserID(),groupName:[t]}}).then(function(p){s.end(),E.l("".concat(i," ok"));var l,p=p.data.groupItem;ye(p)&&(l=!1,p.forEach(function(m){o._convGroupMap.has(m.convGroupID)&&(o._convGroupMap.delete(m.convGroupID),l=!0)}),l===!0&&o._emitConvGroupListUpdate()),o._eraseFromConversationGroupList([t])}).catch(function(c){return s.setError(c).end(),E.e("".concat(i," failed. error:"),c),W(c)})}},{key:"renameConvGroup",value:function(t){var o=this;if(!this._convM.canIUse(Ue.CONV_GROUP))return this._convM.noUse("renameConvGroup");var i="".concat(this._n,".").concat("renameConvGroup"),s=(E.l("".concat(i," options:"),t),new ue("renameConvGroup")),c=(s.setMessage(JSON.stringify(t)),t.oldName),l=t.newName;return this._convM.req({P:P.RENAME_CONV_GRP,data:{fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:1,oldName:c,newName:l}}}).then(function(C){s.end(),E.l("".concat(i," ok")),C=C.data.updateGroupResult.convGroupID,o._convGroupMap.set(C,l),o._emitConvGroupListUpdate();var m,I,C=o._convM.getLocalConvList(),S=!1;C.forEach(function(k){m=k.conversationGroupList,(I=m.indexOf(c))!==-1&&(m.splice(I,1,l),S=!0)}),S===!0&&o._emitConvUpdate()}).catch(function(p){return s.setError(p).end(),E.e("".concat(i," failed. error:"),p),W(p)})}},{key:"addConvsToGroup",value:function(t){var o=this;if(!this._convM.canIUse(Ue.CONV_GROUP))return this._convM.noUse("addConvsToGroup");var i="".concat(this._n,".").concat("addConvsToGroup"),s=(E.l("".concat(i," options:"),t),new ue("addConvsToGroup")),c=(s.setMessage(JSON.stringify(t)),t.conversationIDList),l=t.groupName,p={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:l,updateItem:[]}},m=[],I=[];return c.forEach(function(C){return o._hasLocalConv(C)?Bt(C)||wn(C)?void(Bt(C)?p.updateGroup.updateItem.push({operationType:1,contactItem:{type:1,toAccount:C.replace(O.CONV_C2C,"")}}):wn(C)&&p.updateGroup.updateItem.push({operationType:1,contactItem:{type:2,groupID:C.replace(O.CONV_GROUP,"")}})):(o._onConvIDInvalid(I,C),!0):(o._onConvNotFound(I,C),!0)}),I.length===c.length?we({successConversationIDList:m,failureConversationIDList:I}):this._convM.req({P:P.ADD_CONV_TO_GRP,data:p}).then(function(U){s.end(),E.l("".concat(i," ok"));var S,k,G,U=U.data.updateGroupResult.contactResultItem;return ye(U)&&(G=!1,U.forEach(function(Y){S=o._concatConvID(Y.contactItem),Y.resultCode===0?(k=o._getLocalConv(S))&&k.conversationGroupList.indexOf(l)===-1&&(k.conversationGroupList.push(l),m.push(S),G=!0):I.push({conversationID:S,code:Y.resultCode,message:Y.resultInfo})}),G===!0&&(o._emitConvUpdate(),o._emitConvInGroupUpdate(l))),Ae({successConversationIDList:m,failureConversationIDList:I})}).catch(function(C){return s.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"deleteConvsFromGroup",value:function(t){var o=this,c="deleteConvsFromGroup";if(!this._convM.canIUse(Ue.CONV_GROUP))return this._convM.noUse(c);var i="".concat(this._n,".").concat(c),s=(E.l("".concat(i," options:"),t),new ue(c)),c=(s.setMessage(JSON.stringify(t)),t.conversationIDList),l=t.groupName,p={fromAccount:this._getMyUserID(),updateType:1,updateGroup:{updateGroupType:2,groupName:l,updateItem:[]}},m=[],I=[];return c.forEach(function(C){return o._hasLocalConv(C)?Bt(C)||wn(C)?void(Bt(C)?p.updateGroup.updateItem.push({operationType:2,contactItem:{type:1,toAccount:C.replace(O.CONV_C2C,"")}}):wn(C)&&p.updateGroup.updateItem.push({operationType:2,contactItem:{type:2,groupID:C.replace(O.CONV_GROUP,"")}})):(o._onConvIDInvalid(I,C),!0):(o._onConvNotFound(I,C),!0)}),I.length===c.length?we({successConversationIDList:m,failureConversationIDList:I}):this._convM.req({P:P.DEL_CONV_FROM_GRP,data:p}).then(function(U){s.end(),E.l("".concat(i," ok"));var S,k,G,U=U.data.updateGroupResult.contactResultItem;return ye(U)&&(G=!1,U.forEach(function(Y){var Z;S=o._concatConvID(Y.contactItem),Y.resultCode===0?!(k=o._getLocalConv(S))||(Z=k.conversationGroupList.indexOf(l))!==-1&&(k.conversationGroupList.splice(Z,1),m.push(S),G=!0):I.push({conversationID:S,code:Y.resultCode,message:Y.resultInfo})}),G===!0&&(o._emitConvUpdate(),o._emitConvInGroupUpdate(l))),Ae({successConversationIDList:m,failureConversationIDList:I})}).catch(function(C){return s.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"onConvMarkUpdated",value:function(t){var o,i,s=this;Te(t)||(E.l("".concat(this._n,".onConvMarkUpdated markItemList:"),t),i=!1,t.forEach(function(I){var l=I.recentContactItem,p=I.optType,m=I.standardMark,I=I.customMark;o=s._concatConvID(l),(o=s._getLocalConv(o))&&(p===1?i=s._diffStandardMark(o,m):p===2?i=s._diffCustomMark(o,I):p===3&&(l=s._diffStandardMark(o,m),p=s._diffCustomMark(o,I),i=l||p))}),i===!0&&this._emitConvUpdate())}},{key:"_diffStandardMark",value:function(t,i){var i=Zi(i),s=!1;return function(c,l){if(c===l)return!0;if(!c||!l||c.length!==l.length)return!1;for(var p=0,m=c.length;p<m;p++)if(c[p]!==l[p])return!1;return!0}(t.markList,i)!==!0&&(t.markList=i,s=!0),s}},{key:"_diffCustomMark",value:function(t,o){var i=!1;return t.customData!==o&&o!==void 0&&(t.customData=o,i=!0),i}},{key:"onConvGroupCreated",value:function(t){var o=this,i=(E.l("".concat(this._n,".onConvGroupCreated resultList:"),t),!1),s=!1;ye(t)&&(t.forEach(function(c){var I=c.msgGroupItem,l=I.groupID,p=I.groupName;o._convGroupMap.get(l)!==p&&(o._convGroupMap.set(l,p),s=!0);var m,I=c.msgRecentContactItem;ye(I)&&I.forEach(function(C){m=o._concatConvID(C),(m=o._getLocalConv(m))&&m.conversationGroupList.indexOf(p)===-1&&(m.conversationGroupList.push(p),i=!0)})}),i===!0&&this._emitConvUpdate(),s===!0&&this._emitConvGroupListUpdate())}},{key:"onConvGroupDeleted",value:function(t){var o,i=this,s=(E.l("".concat(this._n,".onConvGroupDeleted groupItemList:"),t),[]);ye(t)&&(o=!1,t.forEach(function(p){var l=p.groupID,p=p.groupName;i._convGroupMap.has(l)&&(i._convGroupMap.delete(l),o=!0,s.push(p))}),o===!0&&this._emitConvGroupListUpdate()),this._eraseFromConversationGroupList(s)}},{key:"_eraseFromConversationGroupList",value:function(t){Te(t)||(this._convM.getLocalConvList().forEach(function(o){o.conversationGroupList=o.conversationGroupList.filter(function(i){return!t.includes(i)})}),this._emitConvUpdate())}},{key:"onConvGroupNameUpdated",value:function(t){E.l("".concat(this._n,".onConvGroupNameUpdated options:"),t);var o,i,s,c=t.groupID,l=t.groupName,p=t.oldGroupName;this._convGroupMap.get(c)!==l&&(this._convGroupMap.set(c,l),this._emitConvGroupListUpdate(),t=this._convM.getLocalConvList(),s=!1,t.forEach(function(m){o=m.conversationGroupList,(i=o.indexOf(p))!==-1&&(o.splice(i,1,l),s=!0)}),s===!0&&this._emitConvUpdate())}},{key:"onConvInGroupUpdated",value:function(p){var o,i,s,c=this,l=(E.l("".concat(this._n,".onConvInGroupUpdated options:"),p),p.oldGroupName),p=p.recentContactUpdateGroupItem;ye(p)&&(s=!1,p.forEach(function(C){var I=C.contactOptType,C=C.recentContactItem;o=c._concatConvID(C),(o=c._getLocalConv(o))&&(i=o.conversationGroupList.indexOf(l),I===1?i===-1&&(o.conversationGroupList.push(l),s=!0):I===2&&i!==-1&&(o.conversationGroupList.splice(i,1),s=!0))}),s===!0&&(this._emitConvUpdate(),this._emitConvInGroupUpdate(l)))}},{key:"onConvAddedToOrDeletedFromGroup",value:function(c){var o,i,s=this,l=(E.l("".concat(this._n,".onConvAddedToOrDeletedFromGroup options:"),c),c.msgRecentContactItem),c=c.msgRecentContactUpdateContactItem,l=this._concatConvID(l),p=this._getLocalConv(l);p&&ye(c)&&(i=!1,c.forEach(function(C){var I=C.groupOptType,C=C.recentContactGroupItem.groupName;o=p.conversationGroupList.indexOf(C),I===1?o===-1&&(p.conversationGroupList.push(C),i=!0):I===2&&o!==-1&&(p.conversationGroupList.splice(o,1),i=!0),i===!0&&s._emitConvInGroupUpdate(C)}),i===!0&&this._emitConvUpdate())}},{key:"onConvGroupListSynced",value:function(t){ye(t)&&t.length!==0&&(E.l("".concat(this._n,".onConvGroupListSynced groupItem:"),t),this._fillConvGroupMap(t))}},{key:"getConvGroupListByID",value:function(t){var o,i=this;if(!Te(t))return o=[],t.forEach(function(s){i._convGroupMap.has(s)&&o.push(i._convGroupMap.get(s))}),o}},{key:"_onConvNotFound",value:function(t,o){t.push({conversationID:o,code:Q.CONV_NOT_FOUND,message:this._convM.getErrMsg(Q.CONV_NOT_FOUND)})}},{key:"_onConvIDInvalid",value:function(t,o){t.push({conversationID:o,code:Q.INVALID_CONV_ID,message:this._convM.getErrMsg(Q.INVALID_CONV_ID)})}},{key:"_getFlagBit",value:function(t){for(var o=t.toString(2),i=o.length,s=i-1;0<=s;s--)if(o[s]==="1")return i-s-1}},{key:"_concatConvID",value:function(l){var o,i=l.type,s=l.to,c=l.groupID,l=l.userID;return i===1?q(l)?q(s)||(o="".concat(O.CONV_C2C).concat(s)):o="".concat(O.CONV_C2C).concat(l):i===2&&(o="".concat(O.CONV_GROUP).concat(c)),o}},{key:"_getMyUserID",value:function(){return this._convM.getMyUserID()}},{key:"_getLocalConv",value:function(t){return this._convM.getLocalConversation(t)}},{key:"_hasLocalConv",value:function(t){return this._convM.hasLocalConversation(t)}},{key:"_emitConvUpdate",value:function(){this._convM.emitConvUpdate(!0,!1)}},{key:"_emitConvGroupListUpdate",value:function(){this._convM.emitOEvt(Me.CONVERSATION_GROUP_LIST_UPDATED,re(this._convGroupMap.values()))}},{key:"_emitConvInGroupUpdate",value:function(t){var o={groupName:t,conversationList:[]},i=this._convM.getLocalConvList();o.conversationList=i.filter(function(s){return s.conversationGroupList.includes(t)}),this._convM.emitOEvt(Me.CONVERSATION_IN_GROUP_UPDATED,o)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._convGroupMap.clear(),this._startIndex=0,this._pagingStatus=On}}]),Er),td=(z(da,Ht),Nc=J(da),V(da,[{key:"_initListeners",value:function(){var t=this.getIEmitInst();t.on(Yt.A2KEY_AND_TINYID_UPDATED,this._init,this),t.on(Yt.PROFILE_UPDATED,this._onProfileUpdated,this),t.on(Yt.CLOUD_CONFIG,this._onCloudConfig,this)}},{key:"_init",value:function(){var t=this,o=(E.l("".concat(this._n,"._init")),this.get(13).getItem("conversationMap")),i=this.isIntl(),s=this.isUsingChatCore();if(o){for(var c=o.length,l=0;l<c;l++){var p=o[l];p&&(this._isNonExistentAccount(p.conversationID)||p.groupProfile&&Vt(p.groupProfile.type))||this._convMap.set(p.conversationID,new ls(o[l],i,s))}this.emitConvUpdate(!0,!1)}this.ready(function(){0<t._tmpGroupList.length&&(t.updateConvGroupProfile(t._tmpGroupList),t._tmpGroupList.length=0)}),this.syncConvList()}},{key:"_isNonExistentAccount",value:function(t){var o;return(o=t.startsWith(O.CONV_C2C)?t.replace(O.CONV_C2C,""):o)==="@TLS#ERROR"||o==="@TLS#NOT_FOUND"}},{key:"onCheckTimer",value:function(t){this.isLoggedIn()&&this._msgListHandler.onCheckTimer(t)}},{key:"onMessageSent",value:function(t){this._onSendOrRcvMsg({conversationOptionsList:t.conversationOptionsList,isInstantMessage:!0})}},{key:"onNewMessage",value:function(t){this._onSendOrRcvMsg(t)}},{key:"_onSendOrRcvMsg",value:function(t){var o=this,i=t.conversationOptionsList,s=t.isInstantMessage,s=s===void 0||s,c=t.isUnreadC2CMessage,c=c!==void 0&&c,l=t.updateUnreadCount,l=l===void 0||l,p=t.isSyncingEnded,p=p!==void 0&&p;this._isReady?i.length!==0?(s===!0&&this._checkNewConv(i),this._updateLocalConvList({conversationOptionsList:i,isInstantMessage:s,isUnreadC2CMessage:c,isFromGetConversations:!1,updateUnreadCount:l}),s||(this._convIDFromUnreadDBMap=new Map([].concat(re(this._convIDFromUnreadDBMap),re(i.map(function(m){return[m.conversationID,1]})))),this._diffAndDeleteConv(),p&&this.emitIEvt(Yt.C2C_UNREAD_HANDLE_COMPLETED)),0<i.filter(function(m){return!o._isConvNeedShow(m.conversationID)}).length||this.emitConvUpdate()):p&&this.emitIEvt(Yt.C2C_UNREAD_HANDLE_COMPLETED):this.ready(function(){o._onSendOrRcvMsg(t)})}},{key:"updateConvGroupProfile",value:function(t){var o,i=this;ye(t)&&t.length===0||(this._convMap.size!==0?(o=!1,t.forEach(function(s){var c="".concat(O.CONV_GROUP).concat(s.groupID);i._convMap.has(c)&&(o=!0,(c=i._convMap.get(c)).groupProfile=JSON.parse(JSON.stringify(s)),c.lastMessage.lastSequence<s.nextMessageSeq&&(c.lastMessage.lastSequence=s.nextMessageSeq-1),c.subType||(c.subType=s.type))}),o&&this.emitConvUpdate(!0,!1)):this._tmpGroupList=t)}},{key:"onMessageRevoked",value:function(t,o){var i,s,c,l=this;t.length!==0&&(i=null,s=!1,c=[],t.forEach(function(p){(i=l._convMap.get(p.conversationID))&&(o&&i.reduceUnreadCount()&&(s=i.type!==O.CONV_TOPIC),i.type===O.CONV_TOPIC?c.push(p):i.isLastMessageRevoked({sequence:p.sequence,time:p.time})&&(i.setLastMessageRevoked(!0),i.setLastMessageRevoker(p.revoker),s=!0))}),this.get(10).onMessageRevoked(c),s&&this.emitConvUpdate(!0,!1))}},{key:"updateRevokerInfo",value:function(t){for(var o=new Set,i=0;i<t.length;i++){var s=t[i].revoker;o.add(s)}var c=re(o),l=this.get(4);return new Promise(function(p){l.getUserProfile({userIDList:c}).then(function(m){if(m=m.data,!ye(m)||m.length===0)return p(t);var I,C={},S=A(m);try{for(S.s();!(I=S.n()).done;){var k=I.value,G=k.userID,U=k.nick,Y=k.avatar;C[G]={nick:U,avatar:Y}}}catch(Z){S.e(Z)}finally{S.f()}t.forEach(function(Z){var $=Z.revoker;C[$]&&(Z.revokerInfo.nick=C[$].nick||"",Z.revokerInfo.avatar=C[$].avatar||"")}),p(t)}).catch(function(){p(t)})})}},{key:"isLastMessageRevoked",value:function(t){var o=!1,i=t.conversationID,s=t.sequence,c=t.time,l=this._convMap.get(i);return l&&(o=l.type===O.CONV_TOPIC?this.get(10).isLastMessageRevoked({topicID:i.replace(O.CONV_GROUP,""),sequence:s}):l.isLastMessageRevoked({sequence:s,time:c})),E.l("".concat(this._n,".isLastMessageRevoked options:"),t,"ret:".concat(o)),o}},{key:"onMessageDeleted",value:function(t){var o=this;if(t.length!==0){var i=null;t.forEach(function(I){(i=o._msgListHandler.getLocalMsg(I.conversationID,I.ID))&&(i.isDeleted=!0),I!==i&&(I.isDeleted=!0)});for(var t=t[0].conversationID,s=this._msgListHandler.getLocalMsgList(t),c={},l=s.length-1;0<=l;l--)if(!s[l].isDeleted){c=s[l];break}var p,m=this._convMap.get(t);m&&(p=!1,m.lastMessage.lastSequence===c.sequence&&m.lastMessage.lastTime===c.time||(Te(c)&&(c=void 0),m.updateLastMessage(c),m.type!==O.CONV_TOPIC&&(p=!0),E.l("".concat(this._n,".onMessageDeleted. update convID:").concat(t," with lastMessage:"),m.lastMessage)),t.startsWith(O.CONV_C2C)&&this.updateUnreadCount(t),p&&this.emitConvUpdate(!0,!1))}}},{key:"onMessageModified",value:function(t){var o="".concat(this._n,".onMessageModified"),S=t.conversationType,i=t.from,s=t.to,c=t.time,l=t.sequence,p=t.elements,m=t.cloudCustomData,I=t.messageVersion,k=this.getMyUserID(),C="".concat(S).concat(s),k=(s===k&&S===O.CONV_C2C&&(C="".concat(S).concat(i)),this._msgListHandler.onMsgModified(C,t)),S=k.isUpdated,k=k.message,G=(S===!0&&this.emitOEvt(Me.MESSAGE_MODIFIED,[k]),this._isTopicConv(C));return k===null?E.l("".concat(o," message is null! options:"),t):E.l("".concat(o," isUpdated:").concat(S," isTopicMessage:").concat(G," from:").concat(i," to:").concat(s," sequence:").concat(k.sequence," time:").concat(k.time)),G?this.get(10).onMessageModified(t):!(S=this._convMap.get(C))||(i=S.lastMessage)&&i.lastTime===c&&i.lastSequence===l&&i.version!==I&&(E.l("".concat(o," convID:").concat(C," lastMessage updated")),i.type=p[0].type,i.payload=p[0].content,i.messageForShow=Qi(i.type,i.payload,this.isIntl()),i.cloudCustomData=m,i.version=I,this.emitConvUpdate(!0,!1)),k}},{key:"onNewGroupAtTips",value:function(i){var o=this,i=i.dataList,s=null;i.forEach(function(c){c.groupAtTips?s=c.groupAtTips:c.elements?s=v(v({},c.elements),{},{sync:!0}):c.groupAtType&&(s=v(v({},c),{},{sync:!0})),s.__random=c.random,s.__sequence=c.clientSequence,o._tmpGroupAtTipsList.push(s)}),E.l("".concat(this._n,".onNewGroupAtTips isReady:").concat(this._isReady),this._tmpGroupAtTipsList),this._isReady&&this._handleGroupAtTipsList()}},{key:"_handleGroupAtTipsList",value:function(){var t,o=this;this._tmpGroupAtTipsList.length!==0&&(t=!1,this._tmpGroupAtTipsList.forEach(function(i){var s=i.groupID,c=i.from,l=i.topicID,l=l===void 0?void 0:l,p=i.sync,p=p!==void 0&&p;c!==o.getMyUserID()&&(q(l)?(c=o._convMap.get("".concat(O.CONV_GROUP).concat(s)))&&(c.updateGroupAtInfoList(i),t=!0):((s=o._convMap.get("".concat(O.CONV_GROUP).concat(l)))&&(s.updateGroupAtInfoList(i),o.get(10).onAtInfoUpdated({topicID:l,groupAtInfoList:s.groupAtInfoList})),Te(s)&&p&&(o.updateTopicConversation([{conversationID:"".concat(O.CONV_GROUP).concat(l),type:O.CONV_TOPIC}]),o._convMap.get("".concat(O.CONV_GROUP).concat(l)).updateGroupAtInfoList(i))))}),t&&this.emitConvUpdate(!0,!1),this._tmpGroupAtTipsList.length=0)}},{key:"_checkNewConv",value:function(t){var o=this,i=[],s=[];t.forEach(function(c){o._convMap.has(c.conversationID)||(c.type===O.CONV_C2C?i.push(c.conversationID.replace(O.CONV_C2C,"")):c.type===O.CONV_GROUP&&s.push(c.conversationID.replace(O.CONV_GROUP,"")))}),0<i.length&&(this._onNewC2CConv(i),i=null),0<s.length&&(this._onNewGroupConv(s),s=null)}},{key:"_onNewC2CConv",value:function(t){var o=this.get(6);return Promise.all([o.getRemotePeerReadTime(t),this._msgRemindHandler.getC2CMsgRemindType(t),this._convGroupHandler.searchConvGroupAndMark(t,1)])}},{key:"_onNewGroupConv",value:function(t){var o=this.get(7);return o?Promise.all([o.getMsgRemindType(t),this._convGroupHandler.searchConvGroupAndMark(t,2)]):Promise.resolve()}},{key:"_setStorageConvList",value:function(){var t=0<arguments.length&&arguments[0]!==void 0&&arguments[0],o=this.getLocalConvList().filter(function(i){return i.type===O.CONV_C2C||i.type===O.CONV_GROUP&&i.lastMessage.type!==O.MSG_GRP_TIP}).slice(0,20).map(function(i){return{conversationID:i.conversationID,type:i.type,subType:i.subType,lastMessage:i.lastMessage,groupProfile:i.groupProfile,userProfile:i.userProfile}});this.get(13).setItem("conversationMap",o,t)}},{key:"emitConvUpdate",value:function(){var t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],o=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],i=this.getLocalConvList();!o||(o=this.get(7))&&o.updateGroupLastMessage(i),t&&(this.get(12).isPartialUpdatedConvs()?(this._diffConvMap(this._convMapForDiff,this._convMap),0<this._partialUpdatedConvMap.size&&(this.emitOEvt(Me.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate(),this._convMapForDiff.clear(),this._convMapForDiff=Ga(this._convMap,!0)),this._convMapForDiff.size===0&&(this._convMapForDiff=Ga(this._convMap,!0))):(this.emitOEvt(Me.CONVERSATION_LIST_UPDATED),this.onTotalUnreadCountUpdate()))}},{key:"_diffConvMap",value:function(t,o){var i,s=A(o);try{for(s.s();!(i=s.n()).done;){var c=Le(i.value,2),l=c[0],p=c[1];t.has(l)&&JSON.stringify(p)===t.get(l)||this._partialUpdatedConvMap.set(l,p)}}catch(m){s.e(m)}finally{s.f()}}},{key:"getPartialUpdatedConvs",value:function(){var t=re(Ga(this._partialUpdatedConvMap,!1).values());return this._partialUpdatedConvMap.clear(),t}},{key:"getLocalConvList",value:function(){var t=this;return re(this._convMap.values()).filter(function(o){return t._isConvNeedShow(o.conversationID)})}},{key:"getLocalConversation",value:function(t){return this._convMap.get(t)}},{key:"hasLocalConversation",value:function(t){return this._convMap.has(t)}},{key:"getLocalOldestMessage",value:function(t){return this._msgListHandler.getLocalOldestMsg(t)}},{key:"syncConvList",value:function(){var t=this,o=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],i="syncConvList",s=new ue(i);return this._pagingStatus===On&&this._convMap.clear(),this._pagingGetConvList(o).then(function(c){var l=kn(t._pagingGetCostList),p=Cc(t._pagingGetCostList),p=(t._pagingGetCostList.length=0,t._pagingStatus=Rt,t._diffAndDeleteConv(),t.emitConvUpdate(!0,!1),t._setStorageConvList(),t._handleC2CPeerReadTime(),t.emitIEvt(Yt.CONV_SYNC_COMPLETED),"count:".concat(t._convMap.size," sum:").concat(p," avg:").concat(l));return E.l("".concat(t._n,".").concat(i,". ").concat(p)),s.setMessage(p).end(),c}).catch(function(c){return t._pagingStatus=yi,s.setMessage(t._pagingTs).setError(c).end(),W(c)})}},{key:"_diffAndDeleteConv",value:function(){var t,o=this;this._isSyncCompleted()&&(t=[],this._convMap.forEach(function(i,s){!o._pagingConvIDMap.has(s)&&o._convIDFromUnreadDBMap.has(s)&&(o._convMap.delete(s),t.push(s))}),E.l("".concat(this._n,"._diffAndDeleteConv list:").concat(t)),t=null)}},{key:"_pagingGetConvList",value:function(){var t=this,o=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],i="".concat(this._n,"._pagingGetConvList"),s=(E.l("".concat(i," incrementalPullFlag:").concat(o," ts:").concat(this._pagingTs," startIdx:").concat(this._pagingStartIdx)+" pinnedTs:".concat(this._pagingPinnedTs," pinnedStartIdx:").concat(this._pagingPinnedStartIdx)),Date.now());return this._pagingStatus=an,this.req({P:P.PAGING_GET_CONV_LIST,data:{fromAccount:this.getMyUserID(),timeStamp:o?this._pagingTs:0,startIndex:o?this._pagingStartIdx:0,pinnedTimeStamp:o?this._pagingPinnedTs:0,pinnedStartIndex:o?this._pagingPinnedStartIdx:0,orderType:1}}).then(function(k){var k=k.data,l=k.completeFlag,p=k.conversations,p=p===void 0?[]:p,m=k.timeStamp,I=k.startIndex,C=k.pinnedTimeStamp,S=k.pinnedStartIndex,k=k.groupItem;if(t._pagingGetCostList.push(An(s,!1)),E.l("".concat(i," ok. completeFlag:").concat(l," count:").concat(p.length," cost:").concat(An(s))),t._convGroupHandler.onConvGroupListSynced(k),0<p.length&&(k=t._getConvOptions(p),t._pagingConvIDMap=new Map([].concat(re(t._pagingConvIDMap),re(k.map(function(G){return[G.conversationID,1]})))),t._updateLocalConvList({conversationOptionsList:k,isFromGetConversations:!0,updateUnreadCount:!0}),t.isLoggedIn()&&t.emitConvUpdate()),!t._isReady){if(!t.isLoggedIn())return we();t.triggerReady()}return t._pagingTs=m,t._pagingStartIdx=I,t._pagingPinnedTs=C,t._pagingPinnedStartIdx=S,l!==1?t._pagingGetConvList():(t._handleGroupAtTipsList(),t._convGroupHandler.getRemoteConvGroupList(),we())}).catch(function(c){throw t.isLoggedIn()&&(t._isReady||(E.w("".concat(i," failed. error:"),c),t.triggerReady())),c})}},{key:"_updateLocalConvList",value:function(s){var o=s.isFromGetConversations,i=Date.now(),s=this._getTmpConvListMapping(s).newConvList;this._convMap=new Map(this._sortConvList(re(this._convMap))),o||this._updateUserOrGroupProfile(s),E.l("".concat(this._n,"._updateLocalConvList cost:").concat(An(i)))}},{key:"_getTmpConvListMapping",value:function(t){for(var o=t.conversationOptionsList,i=t.isFromGetConversations,s=t.isInstantMessage,c=t.isUnreadC2CMessage,l=c!==void 0&&c,p=t.updateUnreadCount,m=[],I=[],C=this.get(7),S=this.get(8),k=this.isIntl(),G=this.isUsingChatCore(),U=0,Y=o.length;U<Y;U++){var Z=new ls(o[U],k,G),$=Z.conversationID,De=Z.type;if(!this._isNonExistentAccount($)){if(this._convMap.has($)){var _e=this._convMap.get($);if(i&&De!==O.CONV_TOPIC){this._convMap.set($,Z),De===O.CONV_C2C?Z.unreadCount=_e.unreadCount:De===O.CONV_GROUP&&(Z.groupProfile=JSON.parse(JSON.stringify(_e.groupProfile)));continue}var Pe=["unreadCount","allowType","adminForbidType","payload"],Ge=(s===!1&&Pe.push("lastMessage"),typeof s=="boolean"&&Pe.push("isPinned"),o[U].lastMessage),et=!q(Ge);et||o[U].type===O.CONV_TOPIC||this._onLastMsgNotExist(o[U]),q(s)&&et&&_e.lastMessage.payload===null&&(_e.lastMessage.payload=Ge.payload),Te(_e.lastMessage.revoker)||(_e.lastMessage.revoker=null),Gn(_e,Z,Pe,[null,void 0,"",0,NaN]),p===!0&&_e.updateUnreadCount({nextUnreadCount:Z.unreadCount,isFromGetConversations:i,isUnreadC2CMessage:l}),s&&et&&(Ge.payload&&(_e.lastMessage.payload=Ge.payload),_e.type===O.CONV_GROUP&&(_e.lastMessage.nameCard=Ge.nameCard,_e.lastMessage.nick=Ge.nick)),et&&_e.lastMessage.cloudCustomData!==Ge.cloudCustomData&&(_e.lastMessage.cloudCustomData=Ge.cloudCustomData||"")}else De===O.CONV_GROUP&&C?(Pe=Z.groupProfile.groupID,(et=C.getLocalGroupProfile(Pe))&&(Z.groupProfile=et,p===!0&&Z.updateUnreadCount({nextUnreadCount:0}))):De===O.CONV_C2C&&(_e=$.replace(O.CONV_C2C,""),S&&S.isMyFriend(_e)&&(Z.remark=S.getFriendRemark(_e))),m.push(Z),this._convMap.set($,Z);this._convMap.get($).type===O.CONV_TOPIC&&I.push(this._convMap.get($))}}for(var lt=this.get(10),We=0,_t=I.length;We<_t;We++){var Pt=I[We],Jt=Pt.conversationID,Pt=Pt.groupAtInfoList;Te(Pt)||lt.onAtInfoUpdated({topicID:Jt.replace(O.CONV_GROUP,""),groupAtInfoList:Pt})}return{newConvList:m}}},{key:"_onLastMsgNotExist",value:function(t){new ue("lastMsgNotExist").setMessage(JSON.stringify(t)).end()}},{key:"_sortConvList",value:function(t){var o=[],i=[],s=[],c=[];return t.forEach(function(l){(l[1].isPinned===!0?Te(l[1].lastMessage.lastTime)?i:o:Te(l[1].lastMessage.lastTime)?c:s).push(l)}),o.sort(function(l,p){return p[1].lastMessage.lastTime-l[1].lastMessage.lastTime}).concat(i).concat(s.sort(function(l,p){return p[1].lastMessage.lastTime-l[1].lastMessage.lastTime})).concat(c)}},{key:"_sortConvListAndEmitEvent",value:function(){this._convMap=new Map(this._sortConvList(re(this._convMap))),this.emitConvUpdate(!0,!1)}},{key:"_updateUserOrGroupProfile",value:function(t){var o,i,s,c,l=this;t.length!==0&&(o=[],i=[],s=this.get(4),c=this.get(7),t.forEach(function(p){var m;p.type===O.CONV_C2C?o.push(p.toAccount):p.type===O.CONV_GROUP&&(m=p.toAccount,c.hasLocalGroup(m)?p.groupProfile=c.getLocalGroupProfile(m):i.push(m))}),E.l("".concat(this._n,"._updateUserOrGroupProfile userIDList:").concat(o," groupIDList:").concat(i)),0<o.length&&s.getUserProfile({userIDList:o}).then(function(p){p=p.data,ye(p)?p.forEach(function(m){l._doUpdateUserProfile("".concat(O.CONV_C2C).concat(m.userID),m)}):l._doUpdateUserProfile("".concat(O.CONV_C2C).concat(p.userID),p)}),0<i.length&&c.getGroupProfileAdvance({groupIDList:i,responseFilter:{groupBaseInfoFilter:["Type","Name","FaceUrl"]}}).then(function(m){var m=m.data.successGroupList,I=!1;m.forEach(function(C){var S="".concat(O.CONV_GROUP).concat(C.groupID);l._convMap.has(S)&&(S=l._convMap.get(S),Gn(S.groupProfile,C,[],[null,void 0,"",0,NaN]),!S.subType&&C.type&&(S.subType=C.type),I=!0)}),I&&l.emitConvUpdate()}))}},{key:"_doUpdateUserProfile",value:function(t,o){this.hasLocalConversation(t)&&(this.getLocalConversation(t).userProfile=o,this.emitConvUpdate())}},{key:"_getConvOptions",value:function(c){var o=this,i=[],c=c.filter(function(m){var p=m.type,m=m.userID;return p===1&&!o._isNonExistentAccount(m)||p===2}),s=this.getMyUserID(),c=c.map(function(l){var p;return q(l.lastMsg)&&(l.lastMsg={elements:[]}),l.type===1?(p={userID:l.userID,nick:l.peerNick,avatar:l.peerAvatar},i.push(p),{conversationID:"".concat(O.CONV_C2C).concat(l.userID),type:O.CONV_C2C,lastMessage:{lastTime:l.time,lastSequence:l.sequence,fromAccount:l.lastC2CMsgFromAccount,type:l.lastMsg.elements[0]?l.lastMsg.elements[0].type:null,payload:l.lastMsg.elements[0]?o._amendLayersOverLimitProp(l.lastMsg.elements[0].content):null,cloudCustomData:l.lastMsg.cloudCustomData||"",isRevoked:l.lastMessageFlag===8,onlineOnlyFlag:!1,nick:"",nameCard:"",version:0,isPeerRead:l.lastC2CMsgFromAccount===s&&l.time<=l.c2cPeerReadTime,revoker:l.lastMsg.revokerInfo?l.lastMsg.revokerInfo.revoker:null},unreadCount:0,userProfile:new us(p),peerReadTime:l.c2cPeerReadTime,isPinned:l.isPinned===1,customData:l.customMark||"",markList:Zi(l.standardMark),conversationGroupList:o._convGroupHandler.getConvGroupListByID(l.contactGroupId),remark:l.friendRemark||"",messageRemindType:o._transMsgRemindType(l.messageRemindType)}):{conversationID:"".concat(O.CONV_GROUP).concat(l.groupID),type:O.CONV_GROUP,lastMessage:v(v({lastTime:l.time,lastSequence:l.sequence,fromAccount:l.msgGroupFromAccount},o._patchTypeAndPayload(l)),{},{cloudCustomData:l.lastMsg.cloudCustomData||"",isRevoked:l.lastMessageFlag===2,onlineOnlyFlag:!1,nick:l.senderNick||"",nameCard:l.senderNameCard||"",revoker:l.lastMsg.revokerInfo?l.lastMsg.revokerInfo.revoker:null}),groupProfile:new Go({groupID:l.groupID,name:l.groupNick,avatar:l.groupImage,type:l.groupType,nextMessageSeq:l.nextMessageSeq}),unreadCount:o._computeGroupUnreadCount(l),peerReadTime:0,isPinned:l.isPinned===1,version:0,customData:l.customMark||"",markList:Zi(l.standardMark),conversationGroupList:o._convGroupHandler.getConvGroupListByID(l.contactGroupId),messageRemindType:o._transMsgRemindType(l.messageRemindType)}});return 0<i.length&&this.get(4).onConvProfileUpdated(i),c}},{key:"_transMsgRemindType",value:function(t){var o="";return t===0?o=O.MSG_REMIND_ACPT_AND_NOTE:t===1?o=O.MSG_REMIND_DISCARD:t===2?o=O.MSG_REMIND_ACPT_NOT_NOTE:t===3&&(o=O.NOT_RECEIVE_OFFLINE_PUSH_EXCEPT_AT),o}},{key:"_computeGroupUnreadCount",value:function(o){var i=o.unreadCount,o=o.noUnreadCount,i=(i===void 0?0:i)-(o===void 0?0:o);return 0<i?i:0}},{key:"_patchTypeAndPayload",value:function(s){var s=s.lastMsg,o=s.event,i=s.elements,i=i===void 0?[]:i,s=s.groupTips,s=s===void 0?{}:s;return q(o===void 0?void 0:o)||Te(s)?{type:i[0]?i[0].type:null,payload:i[0]?this._amendLayersOverLimitProp(i[0].content):null}:((o=new Mn(s)).setElement({type:O.MSG_GRP_TIP,content:v(v({},s.elements),{},{groupProfile:s.groupProfile})}),i=JSON.parse(JSON.stringify(o.payload)),o=null,{type:O.MSG_GRP_TIP,payload:i})}},{key:"_amendLayersOverLimitProp",value:function(t){var o=t.layersOverLimit;return o===0?t.layersOverLimit=!1:o===1&&(t.layersOverLimit=!0),t}},{key:"getLocalMessageList",value:function(t){return this._msgListHandler.getLocalMsgList(t)}},{key:"deleteLocalMessage",value:function(t){t instanceof Mn&&this._msgListHandler.remove(t)}},{key:"onConvDeleted",value:function(t){ye(t)&&(t=t.map(function(c){var i=c.type,s=c.userID,c=c.groupID;return i===1?"".concat(O.CONV_C2C).concat(s):i===2?"".concat(O.CONV_GROUP).concat(c):void 0}),E.l("".concat(this._n,".onConvDeleted convIDList:").concat(t)),this.deleteLocalConvList(t))}},{key:"onConvPinnedStatus",value:function(t,o){var i,s=this;ye(t)&&(i=!1,t.forEach(function(I){var l,p=I.type,m=I.userID,I=I.groupID;p===1?l=s.getLocalConversation("".concat(O.CONV_C2C).concat(m)):p===2&&(l=s.getLocalConversation("".concat(O.CONV_GROUP).concat(I))),l&&(E.l("".concat(s._n,".onConvPinnedStatus convID:").concat(l.conversationID," localPinned:").concat(l.isPinned," remotePinned:").concat(o)),o?l.isPinned||(l.isPinned=!0,i=!0):l.isPinned&&(l.isPinned=!1,i=!0))}),i&&this._sortConvListAndEmitEvent())}},{key:"getMessageList",value:function(c){var o=this,i=c.conversationID,s=c.nextReqMessageID,c=c.count,l="".concat(this._n,".getMessageList"),I=this.getLocalConversation(i),p="";if(I&&I.groupProfile&&(p=I.groupProfile.type),Vt(p))return E.l("".concat(l," not available in ").concat(p,". convID:").concat(i)),we({messageList:[],nextReqMessageID:"",isCompleted:!0});(q(c)||15<c)&&(c=15),s||this._isMeInCommunity(i)||this.clearMemMsg(i);var m=this._computeRemainingCount({conversationID:i,nextReqMessageID:s}),I=this._completedMap.has(i);return E.l("".concat(l," convID:").concat(i," isEverCleared:").concat(this._isEverCleared(i)," nextReqMessageID:").concat(s)+" remainingCount:".concat(m," count:").concat(c," isCompleted:").concat(I)),this._needGetHistory({conversationID:i,remainingCount:m,count:c})?this.getHistoryMessages({conversationID:i,nextReqMessageID:s,count:20}).then(function(k){var S=k.nextReqID,Z=k.storedMessageList,$=k.assembledMessageList,k=k.isPullingCompleted,G=o._completedMap.has(i),U=Z,Y=(0<m&&(U=o._msgListHandler.getLocalMsgList(i).slice(0,Z.length+m)),{nextReqMessageID:void 0,messageList:void 0,isCompleted:void 0}),Z=(o._isEverCleared(i)?(Y.nextReqMessageID=S,Y.messageList=$,Y.isCompleted=k):(Y.nextReqMessageID=G?"":S,Y.messageList=U,Y.isCompleted=G),Y.messageList.filter(function(De){return De.isRevoked})||[]),$=Y.messageList.map(function(De){return De.sequence});return E.l("".concat(l," ret.nextReqMessageID:").concat(Y.nextReqMessageID," ret.isCompleted:").concat(Y.isCompleted," sequenceList:"),$),ye(Z)&&Z.length!==0?o.updateRevokerInfo(Z).then(function(De){return De.forEach(function(_e){var Pe=_e.revokerInfo;Y.messageList=Y.messageList.map(function(Ge){return Ge.ID===_e.ID&&Pe&&(Ge.revokeReason=Pe.reason||"",Ge.revokerInfo={userID:Pe.revoker||Ge.revoker,nick:Pe.nick,avatar:Pe.avatar}),Ge})}),Ae(Y)}):Ae(Y)}):(this.modifyMessageList(i),p=this._getMsgListFromMem({conversationID:i,nextReqMessageID:s,count:c}),we(p))}},{key:"_isEverCleared",value:function(t){return this._everClearedMap.has(t)}},{key:"_getMsgListFromMem",value:function(C){var o=C.conversationID,i=C.nextReqMessageID,C=C.count,s="".concat(this._n,"._getMsgListFromMem"),c=this._msgListHandler.getLocalMsgList(o),l=c.length,p=Bt(o),m=0,I={isCompleted:!1,nextReqMessageID:"",messageList:[]},C=(i?(m=p?c.findIndex(function(S){return S.ID===i}):c.findIndex(function(S){return S.sequence+""===i}))>C?(I.messageList=c.slice(m-C,m),I.nextReqMessageID=p?c[m-C].ID:c[m-C].sequence+""):(I.messageList=c.slice(0,m),I.isCompleted=!0):C<l?(I.messageList=c.slice(m=l-C,l),I.nextReqMessageID=p?c[m].ID:c[m].sequence+""):(I.messageList=c.slice(0,l),I.isCompleted=!0),I.messageList.map(function(S){return S.sequence}));return E.l("".concat(s," convID:").concat(o)+" ret.nextReqMessageID:".concat(I.nextReqMessageID," ret.isCompleted:").concat(I.isCompleted," sequenceList:").concat(C)),I}},{key:"getMessageListHopping",value:function(m){var o,i,s=m.conversationID,c=m.sequence,l=m.time,p=m.count,m=m.direction,m=m===void 0?0:m;return(q(p)||15<p)&&(p=15),s.startsWith(O.CONV_C2C)?(o=this.get(6),i=s.replace(O.CONV_C2C,""),o.getRoamingMessagesHopping({peerAccount:i,time:l,count:p,direction:m})):s.startsWith(O.CONV_GROUP)?(o=this.get(7),i=s.replace(O.CONV_GROUP,""),o.getRoamingMessagesHopping({groupID:i,sequence:c,count:p,direction:m})):void 0}},{key:"_computeRemainingCount",value:function(s){var o=s.conversationID,i=s.nextReqMessageID,s=this._msgListHandler.getLocalMsgList(o),c=s.length;return E.l("".concat(this._n,"._computeRemainingCount convID:").concat(o," nextReqMessageID:").concat(i," length:").concat(c)),i?(c=0,Bt(o)?c=s.findIndex(function(l){return l.ID===i}):wn(o)&&(c=i.indexOf("-")!==-1?s.findIndex(function(l){return l.ID===i}):s.findIndex(function(l){return l.sequence+""===i})),c=c===-1?0:c):c}},{key:"_needGetHistory",value:function(s){var o=s.conversationID,i=s.remainingCount,s=s.count,c=this.getLocalConversation(o),l="";return c&&c.groupProfile&&(l=c.groupProfile.type),Xi(o)||Vt(l)?!1:this._isEverCleared(o)?!0:(c=i<=s&&!this._completedMap.has(o),E.l("".concat(this._n,"._needGetHistory convID:").concat(o," ret:").concat(c)),c)}},{key:"_isTopicConv",value:function(t){return t=t.replace(O.CONV_GROUP,""),Lt(t)}},{key:"getHistoryMessages",value:function(i){var o=i.conversationID,p=i.count,i=i.nextReqMessageID;if(o===O.CONV_SYSTEM)return we();var s,c,l=15,p=(20<p&&(l=20),null);if(Bt(o))return C=0,s="",c=!1,I=this._roamingMsgKeyAndTimeMap.has(o),i&&(c=!0,I?(C=this._roamingMsgKeyAndTimeMap.get(o).lastMessageTime,s=this._roamingMsgKeyAndTimeMap.get(o).messageKey):(m=this._msgListHandler.findMessage(i))&&(C=m.time,E.l("".concat(this._n,".getHistoryMessages convID:").concat(o," isRelayInfoExisted:").concat(I," lastMessageTime:").concat(C)))),(p=this.get(6)).getRoamingMessage({conversationID:o,peerAccount:o.replace(O.CONV_C2C,""),count:l,lastMessageTime:c?C:0,messageKey:c?s:""});if(wn(o)){if(!(p=this.get(7)))return W({code:Q.NO_MODULE});var m=o.replace(O.CONV_GROUP,""),I=null,C=(this._convMap.has(o)&&!Lt(m)&&(I=this._convMap.get(o).lastMessage),0);return i?C=Number(i):I&&(C=I.lastSequence),p.getRoamingMessage({conversationID:o,groupID:m,count:l,sequence:C})}return we()}},{key:"patchConvLastMessage",value:function(t){var o,i,s=1<arguments.length&&arguments[1]!==void 0&&arguments[1],c=this.getLocalConversation(t);c&&(o=(i=c.lastMessage).messageForShow,i=i.payload,!(Te(o)||Te(i)||s)||(o=this._msgListHandler.getLocalMsgList(t)).length!==0&&(i=o[o.length-1],E.l("".concat(this._n,".patchConvLastMessage bForceUpdate:").concat(s," convID:").concat(t," payload:"),i.payload),c.updateLastMessage(i)))}},{key:"onRoamingMessage",value:function(){for(var t,o,i=0<arguments.length&&arguments[0]!==void 0?arguments[0]:[],I=1<arguments.length?arguments[1]:void 0,s=!(2<arguments.length&&arguments[2]!==void 0)||arguments[2],c=3<arguments.length?arguments[3]:void 0,l=I.startsWith(O.CONV_C2C)?O.CONV_C2C:O.CONV_GROUP,p=null,m=[],I=[],$=0,De=i.length,C=l===O.CONV_GROUP,S=this.getFileDownloadProxy(),k=this.getDowloadFileAuthKey(),G=ye(c),U=this.get(17).getFileDNList(),Y=function(){C?--$:++$},Z=function(){return C?De<=$:$<De},$=C?i.length-1:0,De=C?0:i.length;Z();Y())i[$].isPlaceMessage!==1&&((p=new Mn(i[$])).to=i[$].to,l!==O.CONV_GROUP||q(i[$].topicID)||(p.to=i[$].topicID),p.isSystemMessage=!!i[$].isSystemMessage,p.conversationType=l,t=i[$].event===4?{type:O.MSG_GRP_TIP,content:v(v({},i[$].elements),{},{groupProfile:i[$].groupProfile})}:i[$].elements,C||p.setNickAndAvatar({nick:i[$].nick,avatar:i[$].avatar}),Te(t)?((o=new ue("emptyMessageBody")).setMessage("from:".concat(p.from," to:").concat(p.to," sequence:").concat(p.sequence," event:").concat(i[$].event)),o.setLevel("warning").end()):(p.setElement(t,S,k,U),p.reInitialize(this.getMyUserID()),m.push(p),G&&c.push(p)));return Y=Z=null,s?(this._msgListHandler.unshift(m,I),m=null,I):(I=null,m)}},{key:"findMessage",value:function(t){return this._msgListHandler.findMessage(t)}},{key:"_isMeInCommunity",value:function(t){var o=!0;return this._isTopicConv(t)&&(t=un(t.replace(O.CONV_GROUP,"")),this.get(7).hasLocalGroup(t)||(o=!1,E.l("".concat(this._n,"._isMeInCommunity groupID:").concat(t," ret:").concat(o)))),o}},{key:"deleteTopicRoamingInfo",value:function(t){var o=this;bt({groupID:t})&&this._msgListHandler.getTopicConvIDList(t).forEach(function(i){o.clearMemMsg(i)})}},{key:"deleteGroupRoamingInfo",value:function(t){t="".concat(O.CONV_GROUP).concat(t),0<this._msgListHandler.getLocalMsgList(t).length&&this.clearMemMsg(t)}},{key:"setMessageRead",value:function(s){var o=s.conversationID,i=this.getLocalConversation(o),s="".concat(this._n,".setMessageRead");if(E.l("".concat(s," convID:").concat(o," unreadCount:").concat(i?i.unreadCount:0)),!i||(i.type!==O.CONV_GROUP&&i.type!==O.CONV_TOPIC||Te(i.groupAtInfoList)||this.deleteGroupAtTips(o),i.unreadCount===0))return we();var c=this._msgListHandler.getLocalLastMsg(o),l=i.lastMessage.lastTime,p=this._msgListHandler.getLocalMaxTime(o),p=(l<p&&(E.l("".concat(s," update lastMessageTime from ").concat(l," to ").concat(p)),l=p),this._msgListHandler.getLocalMaxSeq(o)),m=i.lastMessage.lastSequence,I=(m<p&&(E.l("".concat(s," update lastMessageSeq from ").concat(m," to ").concat(p)),m=p),i.type===O.CONV_TOPIC&&q(c)&&(s=this.get(10),c=un(p=o.replace(O.CONV_GROUP,"")),(s=s.getLocalTopic(c,p))&&(m=s.nextMessageSeq-1)),null);switch(i.type){case O.CONV_C2C:return(I=this.get(6))?I.setMessageRead({conversationID:o,lastMessageTime:l}):W({code:Q.NO_MODULE});case O.CONV_GROUP:case O.CONV_TOPIC:return(I=this.get(7))?I.setMessageRead({conversationID:o,lastMessageSeq:m}):W({code:Q.NO_MODULE});case O.CONV_SYSTEM:return i.unreadCount=0,this.emitConvUpdate(!0,!1),we();default:return we()}}},{key:"setAllMessageRead",value:function(){var t=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},i="setAllMessageRead",s="".concat(this._n,".").concat(i),c=(o.scope||(o.scope=O.READ_ALL_MSG),E.l("".concat(s," options:"),o),this._createSetAllMessageReadPack(o));if(c.readAllC2CMessage===0&&c.groupMessageReadInfoList.length===0)return we();var l=new ue(i);return this.req({P:P.SET_ALL_MSG_READ,data:c}).then(function(p){return p=p.data,p=t._handleAllMsgRead(p),l.setMessage("scope:".concat(o.scope," failureGroups:").concat(JSON.stringify(p))).end(),we()}).catch(function(p){return l.setError(p).end(),E.w("".concat(s," failed. error:"),p),W({code:p&&p.code?p.code:Q.MSG_UNREAD_ALL_FAIL,message:p&&p.message?p.message:void 0})})}},{key:"setConvCustomData",value:function(t){return this._convGroupHandler.setConvCustomData(t)}},{key:"markConv",value:function(t){return this._convGroupHandler.markConv(t)}},{key:"getConvGroupList",value:function(){return this._convGroupHandler.getLocalConvGroupList()}},{key:"createConvGroup",value:function(t){return this._convGroupHandler.createConvGroup(t)}},{key:"deleteConvGroup",value:function(t){return this._convGroupHandler.deleteConvGroup(t)}},{key:"renameConvGroup",value:function(t){return this._convGroupHandler.renameConvGroup(t)}},{key:"addConvsToGroup",value:function(t){return this._convGroupHandler.addConvsToGroup(t)}},{key:"deleteConvsFromGroup",value:function(t){return this._convGroupHandler.deleteConvsFromGroup(t)}},{key:"onConvMarkUpdated",value:function(t){this._convGroupHandler.onConvMarkUpdated(t)}},{key:"onConvGroupCreated",value:function(t){this._convGroupHandler.onConvGroupCreated(t)}},{key:"onConvGroupDeleted",value:function(t){this._convGroupHandler.onConvGroupDeleted(t)}},{key:"onConvGroupNameUpdated",value:function(t){this._convGroupHandler.onConvGroupNameUpdated(t)}},{key:"onConvInGroupUpdated",value:function(t){this._convGroupHandler.onConvInGroupUpdated(t)}},{key:"onConvAddedToOrDeletedFromGroup",value:function(t){this._convGroupHandler.onConvAddedToOrDeletedFromGroup(t)}},{key:"_getConvLastMessageSeq",value:function(i){var o=this._msgListHandler.getLocalLastMsg(i.conversationID),i=i.lastMessage.lastSequence;return i=o&&i<o.sequence?o.sequence:i}},{key:"_getConvLastMessageTime",value:function(i){var o=this._msgListHandler.getLocalLastMsg(i.conversationID),i=i.lastMessage.lastTime;return i=o&&i<o.time?o.time:i}},{key:"_createSetAllMessageReadPack",value:function(t){var o,i={readAllC2CMessage:0,groupMessageReadInfoList:[]},s=t.scope,c=A(this._convMap);try{for(c.s();!(o=c.n()).done;){var l,p=Le(o.value,2)[1];if(0<p.unreadCount)if(p.type===O.CONV_C2C&&i.readAllC2CMessage===0){if(s===O.READ_ALL_MSG)i.readAllC2CMessage=1;else if(s===O.READ_ALL_C2C_MSG){i.readAllC2CMessage=1;break}}else p.type!==O.CONV_GROUP||s!==O.READ_ALL_GROUP_MSG&&s!==O.READ_ALL_MSG||(l=this._getConvLastMessageSeq(p),i.groupMessageReadInfoList.push({groupID:p.groupProfile.groupID,messageSequence:l}))}}catch(m){c.e(m)}finally{c.f()}return i}},{key:"onPushedAllMessageRead",value:function(t){this._handleAllMsgRead(t)}},{key:"_handleAllMsgRead",value:function(o){var i=o.groupMessageReadInfoList,o=o.readAllC2CMessage,i=this._parseGroupReadInfo(i);return 1<=this._updateAllConvUnreadCount({readAllC2CMessage:o})&&this.emitConvUpdate(!0,!1),i}},{key:"_parseGroupReadInfo",value:function(t){var o=[];if(t&&t.length)for(var i=0,s=t.length;i<s;i++){var m=t[i],c=m.groupID,l=m.sequence,p=m.retCode,m=m.lastMessageSeq;q(p)?this._remoteGroupReadSeqMap.set(c,m):(this._remoteGroupReadSeqMap.set(c,l),p!==0&&o.push("".concat(c,"-").concat(l,"-").concat(p)))}return o}},{key:"_updateAllConvUnreadCount",value:function(t){var o,i=t.readAllC2CMessage,s=0,c=A(this._convMap);try{for(c.s();!(o=c.n()).done;){var l,p,m,I,C=Le(o.value,2),S=C[0],k=C[1];1<=k.unreadCount&&(i===1&&k.type===O.CONV_C2C?(l=this._getConvLastMessageTime(k),this.updateIsReadAfterReadReport({conversationID:S,lastMessageTime:l})):k.type===O.CONV_GROUP&&(p=S.replace(O.CONV_GROUP,""),this._remoteGroupReadSeqMap.has(p)&&(m=this._remoteGroupReadSeqMap.get(p),I=this._getConvLastMessageSeq(k),this.updateIsReadAfterReadReport({conversationID:S,remoteReadSequence:m}),m<=I&&this._remoteGroupReadSeqMap.delete(p))),this.updateUnreadCount(S,!1)&&(s+=1))}}catch(G){c.e(G)}finally{c.f()}return s}},{key:"isRemoteRead",value:function(s){var o,i=s.conversationID,s=s.sequence,c=i.replace(O.CONV_GROUP,""),l=!1;return this._remoteGroupReadSeqMap.has(c)&&(s<=(o=this._remoteGroupReadSeqMap.get(c))&&(l=!0,E.l("".concat(this._n,".isRemoteRead convID:").concat(i," msgSeq:").concat(s," remoteReadSeq:").concat(o))),o+10<=s&&this._remoteGroupReadSeqMap.delete(c)),l}},{key:"updateIsReadAfterReadReport",value:function(t){var o=t.conversationID,i=t.lastMessageSeq,s=t.lastMessageTime,c=this._msgListHandler.getLocalMsgList(o);if(c.length!==0){for(var l,p=c.length-1;0<=p;p--)if(l=c[p],!(s&&l.time>s||i&&l.sequence>i)){if(l.flow==="in"&&l.isRead)break;l.setIsRead(!0)}}}},{key:"updateUnreadCount",value:function(t){var o,i=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],s=!1,c=this.getLocalConversation(t),l=this._msgListHandler.getLocalMsgList(t);if(c)return(o=c.unreadCount)!==(l=l.filter(function(p){return!p.isRead&&!p._onlineOnlyFlag&&!p.isDeleted}).length)&&(c.unreadCount=l,s=!0,E.l("".concat(this._n,".updateUnreadCount from ").concat(o," to ").concat(l,", convID:").concat(t)),i===!0&&this.emitConvUpdate(!0,!1)),s&&c.type===O.CONV_TOPIC&&(o=c.unreadCount,l=this.get(10),i=t.replace(O.CONV_GROUP,""),l.onUnreadCountUpdatedFromConv(i,o)),s}},{key:"clearGroupAtInfoList",value:function(t){var o,i=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],s=this.getLocalConversation(t);s&&0<s.groupAtInfoList.length&&(s.clearGroupAtInfoList(),E.l("".concat(this._n,".clearGroupAtInfoList convID:").concat(t)),s.type===O.CONV_TOPIC&&(s=s.groupAtInfoList,o=this.get(10),t=t.replace(O.CONV_GROUP,""),o.onAtInfoUpdated({topicID:t,groupAtInfoList:s})),i===!0&&this.emitConvUpdate(!0,!1))}},{key:"updateReadReceiptInfo",value:function(I){var o,i,s,c=this,m=I.userID,l=m===void 0?void 0:m,m=I.groupID,p=m===void 0?void 0:m,m=I.readReceiptList,I=I.timestamp,C=I===void 0?0:I;Te(m)||(o=[],q(l)?q(p)||(i="".concat(O.CONV_GROUP).concat(p),m.forEach(function(G){var U=G.tinyID,Y=G.clientTime,Z=G.random,k=G.readCount,G=G.unreadCount,U="".concat(U,"-").concat(Y,"-").concat(Z),Y=c._msgListHandler.getLocalMsg(i,U)||c._msgListHandler.getHoppingMsg(i,U),Z={groupID:p,messageID:U,readCount:0,unreadCount:0};Y&&(ut(k)&&(Y.readReceiptInfo.readCount=k,Z.readCount=k),ut(G)&&(Y.readReceiptInfo.unreadCount=G,Z.unreadCount=G),o.push(Z))})):(s="".concat(O.CONV_C2C).concat(l),m.forEach(function(k){var G=k.tinyID,U=k.clientTime,k=k.random,G="".concat(G,"-").concat(U,"-").concat(k),U=c._msgListHandler.getLocalMsg(s,G)||c._msgListHandler.getHoppingMsg(s,G);U&&!U.readReceiptInfo.isPeerRead&&(U.readReceiptInfo.isPeerRead=!0,U.readReceiptInfo.timestamp=C,o.push({userID:l,messageID:G,isPeerRead:!0,timestamp:C}))})),0<o.length&&this.emitOEvt(Me.MESSAGE_READ_RECEIPT_RECEIVED,o))}},{key:"updateIsRead",value:function(t){var o=this.getLocalConversation(t),i=this.getLocalMessageList(t);if(o&&i.length!==0&&!Xi(o.type)){for(var s=[],c=0,l=i.length;c<l;c++)i[c].flow!=="in"?i[c].flow!=="out"||i[c].isRead||i[c].setIsRead(!0):s.push(i[c]);var p=0;p=o.type===O.CONV_C2C?(t=s.slice(-o.unreadCount).filter(function(I){return I.isRevoked}).length,s.length-o.unreadCount-t):s.length-o.unreadCount;for(var m=0;m<p&&!s[m].isRead;m++)s[m].setIsRead(!0)}}},{key:"deleteGroupAtTips",value:function(t){var o=this,i="".concat(this._n,".deleteGroupAtTips"),c=(E.l("".concat(i)),this._convMap.get(t));if(!c)return Promise.resolve();var s=c.groupAtInfoList;if(s.length===0)return Promise.resolve();var c=void 0,l=(t.startsWith(O.CONV_GROUP)&&(c=t.replace(O.CONV_GROUP,"")),re(s));if((bt({groupID:c})||Lt(c))&&(l=s.filter(function(m){return!m.atTypeArray.includes(O.CONV_AT_ALL)})).length===0)return this.clearGroupAtInfoList(t,!1),Promise.resolve();var p=this.getMyUserID();return this.req({P:P.DEL_GROUP_AT_TIPS,data:{messageListToDelete:l.map(function(m){return{from:m.from,to:p,messageSeq:m.__sequence,messageRandom:m.__random,groupID:q(m.topicID)?m.groupID:m.topicID}})}}).then(function(){return E.l("".concat(i," ok. count:").concat(s.length)),o.clearGroupAtInfoList(t,!1),Promise.resolve()}).catch(function(m){return E.e("".concat(i," failed. error:"),m),W(m)})}},{key:"appendToMessageList",value:function(t){return this._msgListHandler.pushIn(t)}},{key:"setMessageRandom",value:function(t){this._sll.set(t.random)}},{key:"deleteMessageRandom",value:function(t){this._sll.delete(t.random)}},{key:"pushIntoMessageList",value:function(t,o,i){return!(!this._msgListHandler.pushIn(o,i)||this._sll.has(o.random)&&!i||(t.push(o),0))}},{key:"revoke",value:function(t,o,i){return this._msgListHandler.revoke(t,o,i)}},{key:"getPeerReadTime",value:function(t){return this._peerReadTimeMap.get(t)}},{key:"recordPeerReadTime",value:function(t,o){(!this._peerReadTimeMap.has(t)||this._peerReadTimeMap.get(t)<o)&&this._peerReadTimeMap.set(t,o)}},{key:"updateMsgIsPeerReadProp",value:function(t,o){var i;t.startsWith(O.CONV_C2C)&&0<o&&(0<(i=this._msgListHandler.updateMsgIsPeerReadProp(t,o)).length&&this.emitOEvt(Me.MESSAGE_READ_BY_PEER,i),this._convMap.has(t)&&(Te(i=this._convMap.get(t).lastMessage)||i.fromAccount===this.getMyUserID()&&i.lastTime<=o&&!i.isPeerRead&&(i.isPeerRead=!0,this.emitConvUpdate(!0,!1))))}},{key:"updateMsgIsModifiedProp",value:function(t){this._msgListHandler.updateMsgIsModifiedProp(t)}},{key:"setCompleted",value:function(t){E.l("".concat(this._n,".setCompleted convID:").concat(t)),this._completedMap.set(t,!0)}},{key:"updateRoamingMsgKeyAndTime",value:function(t,o,i){this._roamingMsgKeyAndTimeMap.set(t,{messageKey:o,lastMessageTime:i})}},{key:"getConvList",value:function(t){var o,i=this,s="".concat(this._n,".").concat("getConvList"),c="pagingStatus:".concat(this._pagingStatus,", local conversation count:").concat(this._convMap.size,", options:").concat(JSON.stringify(t));return E.l("".concat(s,". ").concat(c)),this._pagingStatus===yi?((o=new ue("getConvList")).setMessage(c),this.syncConvList().then(function(){o.end();var l=i._getConvList(t);return Ae({conversationList:l,isSyncCompleted:i._isSyncCompleted()})}).catch(function(l){return o.setError(l).end(),E.e("".concat(s," failed. error:"),l),W(l)})):(c=this._getConvList(t),E.l("".concat(s,". returned conversation count:").concat(c.length)),we({conversationList:c,isSyncCompleted:this._isSyncCompleted()}))}},{key:"_getConvList",value:function(t){var o,i,s,c,l,p=this;return q(t)?this.getLocalConvList():ye(t)?t.length===0?[]:this.getLocalConvList().filter(function(m){return t.includes(m.conversationID)}):It(t)?(o=t.type,i=t.markType,s=t.groupName,c=t.hasUnreadCount,l=t.hasGroupAtInfo,this.getLocalConvList().filter(function(m){return p._filterType(m,o)&&p._filterMarkType(m,i)&&p._filterGroupName(m,s)&&p._filterUnreadCount(m,c)&&p._filterGroupAtInfo(m,l)})):[]}},{key:"_filterType",value:function(t,o){return o!==O.CONV_C2C&&o!==O.CONV_GROUP||t.type===o}},{key:"_filterGroupName",value:function(t,o){return!Ee(o)||(o===""?t.conversationGroupList.length===0:t.conversationGroupList.includes(o))}},{key:"_filterMarkType",value:function(t,o){return!ut(o)||(o===0?t.markList.length===0:t.markList.includes(o))}},{key:"_filterUnreadCount",value:function(t,o){var i=!0;return o===!0?i=1<=t.unreadCount:o===!1&&(i=t.unreadCount===0),i}},{key:"_filterGroupAtInfo",value:function(t,o){var i=!0;return o===!0?i=1<=t.groupAtInfoList.length:o===!1&&(i=t.groupAtInfoList.length===0),i}},{key:"_handleC2CPeerReadTime",value:function(){var t,o=A(this._convMap);try{for(o.s();!(t=o.n()).done;){var i=Le(t.value,2),s=i[0],c=i[1];c.type===O.CONV_C2C&&this.recordPeerReadTime(s,c.peerReadTime)}}catch(l){o.e(l)}finally{o.f()}}},{key:"_isPagingGetGroupListCompleted",value:function(){var t=this.get(7);return!t||t.isPagingGetCompleted()}},{key:"_getLocalGroupCount",value:function(){var t=this.get(7);return t?t.getLocalGroupList().length:0}},{key:"_hasLocalGroup",value:function(t){var o=this.get(7);return!!o&&o.hasLocalGroup(t.replace(O.CONV_GROUP,""))}},{key:"getConversationProfile",value:function(t){var o,i=this,s=!1;if(this._convMap.has(t)?o=this._convMap.get(t):(o=new ls({conversationID:t,type:Bt(t)?O.CONV_C2C:O.CONV_GROUP},this.isIntl(),this.isUsingChatCore()),s=!0),o._isInfoCompleted||o.type===O.CONV_SYSTEM)return we({conversation:o});if(wn(t)){if(!this.get(7))return W({code:Q.NO_MODULE});if(!this._hasLocalGroup(t))return we({conversation:o})}var c="".concat(this._n,".").concat("getConversationProfile"),l=new ue("getConversationProfile");return E.l("".concat(c,". convID:").concat(t," remark:").concat(o.remark," lastMessage:"),o.lastMessage),this._getUserOrGroupProfile(o).then(function(p){l.setMessage("convID:".concat(t," unreadCount:").concat(p.data.conversation.unreadCount)).end();var m,I=i.get(8);if(I&&o.type===O.CONV_C2C&&(m=t.replace(O.CONV_C2C,""),I.isMyFriend(m)&&(I=I.getFriendRemark(m),o.remark!==I&&(o.remark=I,E.l("".concat(c,". convID:").concat(t," patch remark:").concat(o.remark))))),E.l("".concat(c," ok. isNewConv:").concat(s," convID:").concat(t)),s){if(o.type===O.CONV_C2C)return i._onNewC2CConv([t.replace(O.CONV_C2C,"")]).then(function(){return we({conversation:o})});if(o.type===O.CONV_GROUP)return i._onNewGroupConv([t.replace(O.CONV_GROUP,"")]).then(function(){return we({conversation:o})})}return p}).catch(function(p){return l.setError(p).setMessage("convID:".concat(t)).end(),E.e("".concat(c," failed. error:"),p),W(p)})}},{key:"_getUserOrGroupProfile",value:function(t){var o=this;return t.type===O.CONV_C2C?this.get(4).getUserProfile({userIDList:[t.toAccount]}).then(function(i){return i=i.data,i.length===0?W({code:Q.USER_OR_GRP_NOT_FOUND}):(t.userProfile=i[0],t._isInfoCompleted=!0,o._insertConvAfterTopmost(t),we({conversation:t}))}):this.get(7).getGroupProfile({groupID:t.toAccount}).then(function(i){return t.groupProfile=i.data.group,t._isInfoCompleted=!0,o._insertConvAfterTopmost(t),we({conversation:t})})}},{key:"_insertConvAfterTopmost",value:function(t){var o,i;t instanceof ls&&!this._convMap.has(t.conversationID)&&(i=(o=re(this._convMap)).findIndex(function(s){return s[1].isPinned===!1}),o.splice(i,0,[t.conversationID,t]),this._convMap=new Map(o),this._setStorageConvList(),this.emitConvUpdate(!0,!1))}},{key:"_onProfileUpdated",value:function(t){var o=this;t.data.forEach(function(i){var s=i.userID;s===o.getMyUserID()?o._onMyProfileModified({latestNick:i.nick,latestAvatar:i.avatar}):(s=o._convMap.get("".concat(O.CONV_C2C).concat(s)))&&(s.userProfile=i)})}},{key:"_onCloudConfig",value:function(t){this.getCloudConfig("pull_on_invite")==="0"&&(this._bPullOnInvite=!1),E.l("".concat(this._n,"._onCloudConfig bPullOnInvite:").concat(this._bPullOnInvite))}},{key:"disableMsgPullOnInvite",value:function(){this._bPullOnInvite=!1}},{key:"_isSyncCompleted",value:function(){return this._pagingStatus===Rt}},{key:"_errorLog",value:function(t,o,i,s){var c=new Error("Params validate failed."),l="".concat(this.getErrMsg("API_REFER")).concat(t);throw E.w("[".concat(t,"] | ").concat(o," | ").concat(this.getErrMsg(i,s),", ").concat(l)),E.e("[".concat(t,"] Invalid ").concat(o,": type check failed for ").concat(o,".")),c}},{key:"_isValidConvID",value:function(t){return Bt(t)||wn(t)||Xi(t)}},{key:"deleteConversation",value:function(t){var o=this,i="deleteConversation";return Ee(t)||ft(t)||this._errorLog(i,"options","StringOrObjectRequiredLog"),Ee(t)?(this._isValidConvID(t)||this._errorLog(i,"options","InvalidConversationID",t),E.l("".concat(this._n,".").concat(i," convID:").concat(t)),this.deleteConvList({conversationIDList:[t],flag:1})):(ye(t.conversationIDList)||this._errorLog(i,"conversationIDList","ArrayRequiredLog"),t.conversationIDList.length===0&&this._errorLog(i,"conversationIDList","NonEmptyArrayLog"),t.conversationIDList.forEach(function(s){o._isValidConvID(s)||o._errorLog(i,"conversationIDList","InvalidConversationID",s)}),"clearHistoryMessage"in t&&typeof t.clearHistoryMessage!="boolean"&&this._errorLog(i,"clearHistoryMessage","BooleanRequiredLog"),100<t.conversationIDList.length&&(t.conversationIDList=t.conversationIDList.slice(0,100)),this.deleteConvList(t))}},{key:"deleteConvList",value:function(l){var o=l.conversationIDList,o=o===void 0?[]:o,i=l.clearHistoryMessage,i=i===void 0||i,l=l.flag,s=l===void 0?0:l,c="".concat(this._n,".").concat("deleteConvList"),l="convIDList:".concat(o," clearHistoryMessage:").concat(i),p=(E.l("".concat(c," ").concat(l)),new ue("deleteConvList"));return p.setMessage(l),Promise.all([this.rmLocalOnlyConvList(o),this.rmLocalAndRemoteConvList(o,i)]).then(function(m){return p.end(),m=[].concat(re(m[0]),re(m[1])),m.length===0?W(new Gt({code:Q.CONV_NOT_FOUND})):(E.l("".concat(c," ok")),we(s===1?{conversationID:m[0]}:{conversationIDList:m}))}).catch(function(m){return p.setError(m).end(),E.e("".concat(c," failed. error:"),m),W(m)})}},{key:"rmLocalOnlyConvList",value:function(t){var o=this;return t.filter(function(i){if(!o._convMap.has(i))return!1;var s=o.getLocalConversation(i).type;return s!==O.CONV_GROUP||o._hasLocalGroup(i)?s===O.CONV_SYSTEM&&(o.get(7).deleteGroupSystemNotice({messageList:o._msgListHandler.getLocalMsgList(i)}),o.deleteLocalConv(i),!0):(o.deleteLocalConv(i),!0)})}},{key:"rmLocalAndRemoteConvList",value:function(t,o){var i=this,s={fromAccount:this.getMyUserID(),conversationList:[],clearHistoryMessage:o?1:0};return t.forEach(function(c){var l;i._convMap.has(c)&&((l=i.getLocalConversation(c).type)===O.CONV_C2C?s.conversationList.push({toAccount:c.replace(l,""),type:1}):l===O.CONV_GROUP&&i._hasLocalGroup(c)&&s.conversationList.push({toGroupID:c.replace(l,""),type:2}))}),s.conversationList.length===0?[]:this.req({P:P.DEL_CONV,data:s}).then(function(c){var l=[];return 0<c.data.resultList.length&&c.data.resultList.map(function(p){p.code===0&&(p=p.type===1?"".concat(O.CONV_C2C).concat(p.to):"".concat(O.CONV_GROUP).concat(p.groupID),l.push(p))}),i.deleteLocalConvList(l),l})}},{key:"setConvDraft",value:function(i){var o=i.conversationID,i=i.draftText,s="".concat(this._n,".").concat("setConvDraft");return E.l("".concat(s," convID:").concat(o," draftText:").concat(i)),this._convMap.has(o)?(s=this._convMap.get(o),s.setDraftText(i),this.emitConvUpdate(),we({code:0,conversation:s})):W({code:Q.CONV_NOT_FOUND})}},{key:"clearHistoryMessage",value:function(t){var o=this,i={fromAccount:this.getMyUserID(),toAccount:void 0,type:void 0,toGroupID:void 0};if(!this._convMap.has(t))return W({code:Q.CONV_NOT_FOUND});var s=this._convMap.get(t).type;if(s===O.CONV_C2C)i.type=1,i.toAccount=t.replace(O.CONV_C2C,"");else{if(s!==O.CONV_GROUP)return s===O.CONV_SYSTEM?(this.get(7).deleteGroupSystemNotice({messageList:this._msgListHandler.getLocalMsgList(t)}),we({conversationID:t})):W({code:Q.CONV_UN_RECORDED_TYPE});i.type=2,i.toGroupID=t.replace(O.CONV_GROUP,"")}var c="".concat(this._n,".").concat("clearHistoryMessage"),l=new ue("clearHistoryMessage");return l.setMessage("convID:".concat(t)),E.l("".concat(c,". convID:").concat(t)),this.setMessageRead({conversationID:t}).then(function(){return o.req({P:P.CLEAR_HISTORY_MSG,data:i})}).then(function(){l.end(),E.l("".concat(c," ok")),o.clearMemMsg(t);var p=o.getLocalConversation(t);return p&&(p.updateLastMessage(),o._sortConvListAndEmitEvent()),we({conversationID:t})}).catch(function(p){return l.setError(p).end(),E.e("".concat(c," failed. error:"),p),W(p)})}},{key:"pinConversation",value:function(t){var o=this,i=t.conversationID,s=t.isPinned,c=this.getLocalConversation(i);if(c&&c.isPinned===s)return we({conversationID:i});if(Xi(i))return c&&(c.isPinned=s),this._sortConvListAndEmitEvent(),we({conversationID:i});if(t=null,Bt(i)?t={type:1,toAccount:i.replace(O.CONV_C2C,"")}:wn(i)&&(t={type:2,groupID:i.replace(O.CONV_GROUP,"")}),t===null)return W({code:Q.INVALID_CONV_ID});var l="".concat(this._n,".").concat("pinConversation"),p="convID:".concat(i," isPinned:").concat(s),m=new ue("pinConversation");return m.setMessage(p),E.l("".concat(l,". ").concat(p)),this.req({P:P.PIN_CONV,data:{fromAccount:this.getMyUserID(),operationType:s===!0?1:2,itemList:[t]}}).then(function(){return m.end(),E.l("".concat(l," ok")),c?c.isPinned!==s&&(c.isPinned=s):o._convMap.set(i,new ls({conversationID:i,type:Bt(i)?O.CONV_C2C:O.CONV_GROUP,isPinned:s},o.isIntl(),o.isUsingChatCore())),o._sortConvListAndEmitEvent(),Ae({conversationID:i})}).catch(function(I){return m.setError(I).end(),E.e("".concat(l," failed. error:"),I),W(I)})}},{key:"setMessageRemindType",value:function(t){return this._msgRemindHandler.set(t)}},{key:"patchMsgRemindType",value:function(t){var o=t.ID,c=t.isC2CConversation,i=t.messageRemindType,s=!1,c=this.getLocalConversation("".concat(c?O.CONV_C2C:O.CONV_GROUP).concat(o));return c&&c.messageRemindType!==i&&(c.messageRemindType=i,s=!0),E.l("".concat(this._n,".patchMsgRemindType options:"),t,"ret:".concat(s)),s}},{key:"onC2CMsgRemindTypeFetched",value:function(t){var o,i=this;ye(t)&&0<t.length&&(o=0,t.forEach(function(l){var c=l.userID,l=l.muteFlag,l=i._transMsgRemindType(l);i.patchMsgRemindType({ID:c,isC2CConversation:!0,messageRemindType:l})===!0&&(o+=1)}),E.l("".concat(this._n,".onC2CMsgRemindTypeFetched updateCount:").concat(o)),1<=o&&this.emitConvUpdate(!0,!1))}},{key:"onC2CMsgRemindTypeSynced",value:function(t){var o=this,i="".concat(this._n,".onC2CMsgRemindTypeSynced");t.dataList.forEach(function(s){var c;Te(s.muteNotificationsSync)||(c=(s=s.muteNotificationsSync).to,s=s.muteFlag,s=o._transMsgRemindType(s),o.patchMsgRemindType({ID:c,isC2CConversation:!(c=0),messageRemindType:s})&&(c+=1),E.l("".concat(i," updateCount:").concat(c)),1<=c&&o.emitConvUpdate(!0,!1))})}},{key:"onGroupMsgRemindTypeUpdated",value:function(t){this._msgRemindHandler.onGroupMsgRemindTypeUpdated(t)}},{key:"deleteLocalConv",value:function(t){var o=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],i=this._convMap.has(t);E.l("".concat(this._n,".deleteLocalConv convID:").concat(t," has:").concat(i)),i&&(this._convMap.delete(t),this._convMapForDiff.delete(t),this.clearMemMsg(t),this._setStorageConvList(!0),o)&&(i=!this._isTopicConv(t),this.emitConvUpdate(i,!1))}},{key:"pullMsgOnInvite",value:function(t){var o,i,s,c,l,p=this.get(7);p&&(o="".concat(this._n,".pullMsgOnInvite"),E.l("".concat(o," flag:").concat(this._bPullOnInvite)),this._bPullOnInvite&&(l=this.getLocalLastMessage(t),i=this.getLocalSecondLastMessage(t),c=s=1,l&&(s=l.sequence),i&&(c=i.sequence),l=p.getGroupRemoteLastSeq(t.replace(O.CONV_GROUP,"")),E.l("".concat(o," convID:").concat(t," localLastSeq:").concat(s," localSecondLastSeq:").concat(c," remoteLastSeq:").concat(l)),this.clearMemMsg(t),1<s-c?this._recursiveGetMsgList([],t,!1,s,c):1<l-s&&this._recursiveGetMsgList([],t,!0,l,s)))}},{key:"_recursiveGetMsgList",value:function(t,o,i,s,c,l){var p=this;this.getMessageList({conversationID:o,nextReqMessageID:l}).then(function(S){var S=S.data,I=S.messageList,C=S.isCompleted,S=S.nextReqMessageID,k=I.filter(function(G){return i?G.sequence>c&&G.sequence<=s:G.sequence>c&&G.sequence<s});t.unshift.apply(t,re(k)),!C&&0<I.length&&I[0].sequence>c&&t.length<60?p._recursiveGetMsgList(t,o,i,s,c,S):p._emitMsgReceived(o,t)})}},{key:"_emitMsgReceived",value:function(t,o){var i,s,c=this;0<o.length&&(o=o.filter(function(l,p,m){return p===m.findIndex(function(I){return I.sequence===l.sequence})}),i=this.hasLocalConversation(t),s=o.map(function(l){return l.sequence}),E.l("".concat(this._n,"._emitMsgReceived convID:").concat(t," has:").concat(i," count:").concat(s.length," sequenceList:"),s),this.emitOEvt(Me.MESSAGE_RECEIVED,o),i?this.patchConvLastMessage(t,!0):this.getConversationProfile(t).then(function(){c.patchConvLastMessage(t,!0)}))}},{key:"deleteLocalConvList",value:function(t){var o=this,i=!1;t.forEach(function(s){o._convMap.has(s)&&(o.deleteLocalConv(s,!1),i=!0)}),E.l("".concat(this._n,".deleteLocalConvList convID:").concat(t," isConvIDExisted:").concat(i)),i&&this.emitConvUpdate(!0,!1)}},{key:"isMessageSentByCurrentInstance",value:function(t){return!(!this._msgListHandler.hasLocalMsg(t.conversationID,t.ID)&&!this._sll.has(t.random))}},{key:"modifyMessageList",value:function(t){var o,i;t.startsWith(O.CONV_C2C)&&this._convMap.has(t)&&(i=this._convMap.get(t),o=Date.now(),this._msgListHandler.modifyMsgSentByPeer({conversationID:t,latestNick:i.userProfile.nick,latestAvatar:i.userProfile.avatar}),i=this.get(4).getNickAndAvatarByUserID(this.getMyUserID()),this._msgListHandler.modifyMsgSentByMe({conversationID:t,latestNick:i.nick,latestAvatar:i.avatar}),E.l("".concat(this._n,".modifyMessageList convID:").concat(t," cost:").concat(An(o))))}},{key:"updateUserProfileSpecifiedKey",value:function(s){E.l("".concat(this._n,".updateUserProfileSpecifiedKey options:"),s);var o=s.conversationID,i=s.nick,s=s.avatar;this._convMap.has(o)&&(o=this._convMap.get(o).userProfile,Ee(i)&&o.nick!==i&&(o.nick=i),Ee(s)&&o.avatar!==s&&(o.avatar=s),this.emitConvUpdate(!0,!1))}},{key:"_onMyProfileModified",value:function(t){var o=this,i=this.getLocalConvList(),s=Date.now();i.forEach(function(c){o.modifyMessageSentByMe(v({conversationID:c.conversationID},t))}),E.l("".concat(this._n,"._onMyProfileModified. modify all messages sent by me, cost:").concat(An(s)))}},{key:"modifyMessageSentByMe",value:function(t){this._msgListHandler.modifyMsgSentByMe(t)}},{key:"getLatestMessageSentByMe",value:function(t){return this._msgListHandler.getLatestMsgSentByMe(t)}},{key:"modifyMessageSentByPeer",value:function(t){this._msgListHandler.modifyMsgSentByPeer(t)}},{key:"getLatestMessageSentByPeer",value:function(t){return this._msgListHandler.getLatestMsgSentByPeer(t)}},{key:"pushIntoNoticeResult",value:function(t,o){return!(!this._msgListHandler.pushIn(o)||this._sll.has(o.random)||(t.push(o),0))}},{key:"getLocalLastMessage",value:function(t){return this._msgListHandler.getLocalLastMsg(t)}},{key:"getLocalSecondLastMessage",value:function(t){return this._msgListHandler.getLocalSecondLastMsg(t)}},{key:"checkAndPatchRemark",value:function(){var t,o,i=this.get(8);this._convMap.size===0||!i||(t=re(this._convMap.values()).filter(function(s){return s.type===O.CONV_C2C})).length!==0&&(o=0,t.forEach(function(s){var c=s.conversationID.replace(O.CONV_C2C,"");i.isMyFriend(c)&&(c=i.getFriendRemark(c),s.remark!==c&&(s.remark=c,o+=1))}),E.l("".concat(this._n,".checkAndPatchRemark. c2cConvCount:").concat(t.length," patchedCount:").concat(o)),0<o&&this.emitConvUpdate(!0,!1))}},{key:"updateTopicConversation",value:function(t){this._updateLocalConvList({conversationOptionsList:t,isFromGetConversations:!0,updateUnreadCount:!0})}},{key:"sendReadReceipt",value:function(t){var o=t[0],i=null;return o.conversationType===O.CONV_C2C?i=this._m.get(6):o.conversationType===O.CONV_GROUP&&(i=this._m.get(7)),i?i.sendReadReceipt(t):W({code:Q.NO_MODULE})}},{key:"getReadReceiptList",value:function(t){var o=t[0],i=null;return o.conversationType===O.CONV_C2C?i=this._m.get(6):o.conversationType===O.CONV_GROUP&&(i=this._m.get(7)),i?i.getReadReceiptList(t):W({code:Q.NO_MODULE})}},{key:"getLastMessageTime",value:function(t){return t=this.getLocalConversation(t),t?t.lastMessage.lastTime:0}},{key:"getTotalUnreadCount",value:function(){var t=this.getLocalConvList(),o=0;return t.forEach(function(i){i.type!==O.CONV_SYSTEM&&(i.messageRemindType!==""&&i.messageRemindType!==O.MSG_REMIND_ACPT_AND_NOTE||(o+=i.unreadCount))}),o}},{key:"onTotalUnreadCountUpdate",value:function(){var t=this.getTotalUnreadCount();this._convTotalUnreadCount!==t&&(E.l("".concat(this._n,".onTotalUnreadCountUpdate from ").concat(this._convTotalUnreadCount," to ").concat(t)),this._convTotalUnreadCount=t,this.emitOEvt(Me.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED))}},{key:"_isConvNeedShow",value:function(s){if(s=this.getLocalConversation(s),q(s))return!0;var o=s.type===O.CONV_TOPIC,i=s.type===O.CONV_GROUP&&s.groupProfile.type===O.GRP_ROOM,s=s.type===O.CONV_GROUP&&s.groupProfile.type===O.GRP_LIVE;return!(o||i||s)}},{key:"setAllRcvMsgOpt",value:function(t){return this._msgRemindHandler.setAllRcvMsgOpt(t)}},{key:"getAllRcvMsgOpt",value:function(){return this._msgRemindHandler.getAllRcvMsgOpt()}},{key:"onAllRcvMsgOptNotify",value:function(t){this._msgRemindHandler.onAllRcvMsgOptNotify(t)}},{key:"clearUnreadCount",value:function(t){t=this.getLocalConversation(t),t&&0<t.unreadCount&&(t.unreadCount=0,this.emitConvUpdate(!0,!1))}},{key:"storeHoppingMessageList",value:function(t){this._msgListHandler.storeHoppingMsgList(t)}},{key:"clearMemMsg",value:function(t){var o=1<arguments.length&&arguments[1]!==void 0&&arguments[1];E.l("".concat(this._n,".clearMemMsg convID:").concat(t," isOverLimit:").concat(o)),this._msgListHandler.removeByConvID(t),this._completedMap.delete(t),this._roamingMsgKeyAndTimeMap.delete(t),this._everClearedMap.set(t,1)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._setStorageConvList(!0),this._pagingStatus=On,this._msgListHandler.reset(),this._msgRemindHandler.reset(),this._roamingMsgKeyAndTimeMap.clear(),this._sll.reset(),this._peerReadTimeMap.clear(),this._completedMap.clear(),this._convMap.clear(),this._pagingTs=0,this._pagingStartIdx=0,this._pagingPinnedTs=0,this._pagingPinnedStartIdx=0,this._remoteGroupReadSeqMap.clear(),this._convTotalUnreadCount=0,this._pagingGetCostList.length=0,this._pagingConvIDMap.clear(),this._convIDFromUnreadDBMap.clear(),this._pagingGetCostList.length=0,this._convMapForDiff.clear(),this._partialUpdatedConvMap.clear(),this._everClearedMap.clear(),this._bPullOnInvite=!0,this._convGroupHandler.reset(),this.resetReady()}}]),da),nd=(V(la,[{key:"onCheckTimer",value:function(t){t%1==0&&0<this._cachedGroupTipsMap.size&&this._check()}},{key:"_check",value:function(){var t=this;this._cachedGroupTipsMap.forEach(function(o,i){var s=t._checkCountMap.get(i),c=t._grpM.hasLocalGroup(i);E.l("".concat(t._n,"._check groupID:").concat(i," hasLocalGroup:").concat(c," checkCount:").concat(s)),c?(t._notifyCachedGroupTips(i),t._checkCountMap.delete(i),t._grpM.deleteUnjoinedAVChatRoom(i)):s>=t.MAX_CHECK_COUNT?(t._deleteCachedGroupTips(i),t._checkCountMap.delete(i)):t._checkCountMap.set(i,++s)})}},{key:"onNewGroupTips",value:function(s){E.l("".concat(this._n,".onNewGroupTips options:").concat(JSON.stringify(s.dataList)));var s=this._assembly(s),o=s.eventDataList,i=s.result,s=s.AVChatRoomMessageList;0<s.length&&this._grpM.onAVChatRoomMessage(s),0<i.length&&(this._grpM.emitOEvt(Me.MESSAGE_RECEIVED,i),this._handleTips(i)),0<o.length&&(this._grpM.updateNextMessageSeq(o),this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:!0}))}},{key:"_assembly",value:function(t){for(var o=t.event,i=t.dataList,s=null,c=[],l=[],p={},m=[],I=0,C=i.length;I<C;I++){var S=Ua(i[I]);if(!(o===6&&(this._grpM.isGroupAttributesUpdatedNotice(S)||this._grpM.isGroupCountersNotice(S)))){var Z=S.groupProfile,k=Z.groupID,G=Z.communityType,G=G===void 0?0:G,U=Z.topicID,U=U===void 0?void 0:U,Y=Z.invisible,Z=Z.groupType,Z=Z===void 0?void 0:Z,$=void 0,De=this._grpM.isMessageFromTopic(G,U),_e=(De&&($=O.CONV_TOPIC,S.to=U),this._grpM.hasLocalGroup(k));if(_e||!this._grpM.isUnjoinedAVChatRoom(k))if(_e||De)if(this._grpM.isMessageFromOrToAVChatroom(k))S.event=o,m.push(S);else if(S.currentUser=this._grpM.getMyUserID(),S.conversationType=O.CONV_GROUP,(s=new Mn(S)).setElement({type:O.MSG_GRP_TIP,content:v(v({},S.elements),{},{groupProfile:S.groupProfile})}),s.isSystemMessage=!1,Y!==1){var _e=this._grpM.get(11),De=s,Y=De.conversationID,De=De.sequence;if(o===6)s._onlineOnlyFlag=!0,l.push(s);else if(!_e.pushIntoNoticeResult(l,s))continue;this._grpM.isMessageFromCommunityOfTopic(G,U)||o===6&&_e.getLocalConversation(Y)||(o!==6&&this._qualityStat(s),G=_e.isRemoteRead({conversationID:Y,sequence:De}),q(p[Y])?(U=0,s.flow==="in"&&(s._isExcludedFromUnreadCount||s._onlineOnlyFlag||G||(U=1)),p[Y]=c.push({conversationID:Y,unreadCount:U,type:q($)?s.conversationType:$,subType:s.conversationSubType,lastMessage:s._isExcludedFromLastMessage?"":s})-1):(c[_e=p[Y]].type=s.conversationType,c[_e].subType=s.conversationSubType,c[_e].lastMessage=s._isExcludedFromLastMessage?"":s,s.flow==="in"&&(s._isExcludedFromUnreadCount||s._onlineOnlyFlag||G||c[_e].unreadCount++)))}else this._qualityStat(s);else this._cacheAndCompare({groupID:k,event:o,item:S,groupType:Z})}}return{eventDataList:c,result:l,AVChatRoomMessageList:m}}},{key:"_qualityStat",value:function(t){this._grpM.get(26).addMessageSequence({key:ce,message:t})}},{key:"_handleTips",value:function(t){var o=this;t.forEach(function(i){switch(i.payload.operationType){case 1:o._onNewMemberComeIn(i);break;case 2:o._onMemberQuit(i);break;case 3:o._onMemberKickedOut(i);break;case 4:o._onMemberSetAdmin(i);break;case 5:o._onMemberCancelledAdmin(i);break;case 6:o._onGroupProfileModified(i);break;case 7:o._onMemberInfoModified(i);break;case 8:o._onTopicProfileUpdated(i);break;default:E.w("".concat(o._n,"._handleTips unknown operationType:").concat(i.payload.operationType))}})}},{key:"_onNewMemberComeIn",value:function(i){var i=i.payload,o=i.memberNum,i=i.groupProfile.groupID,i=this._grpM.getLocalGroupProfile(i);i&&ut(o)&&i.memberCount!==o&&(i.memberCount=o,this._updateConvGroupProfile(i))}},{key:"_onMemberQuit",value:function(t){var i=t.payload,o=i.memberNum,i=i.groupProfile.groupID,s=this._grpM.getLocalGroupProfile(i);s&&ut(o)&&s.memberCount!==o&&(s.memberCount=o,this._updateConvGroupProfile(s)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(i,t.payload.userIDList)}},{key:"_onMemberKickedOut",value:function(t){var i=t.payload,o=i.memberNum,i=i.groupProfile.groupID,s=this._grpM.getLocalGroupProfile(i);s&&ut(o)&&s.memberCount!==o&&(s.memberCount=o,this._updateConvGroupProfile(s)),this._grpM.getGroupMemberHandler().deleteLocalGroupMembers(i,t.payload.userIDList)}},{key:"_updateConvGroupProfile",value:function(t){this._grpM.get(11).updateConvGroupProfile([t])}},{key:"_onMemberSetAdmin",value:function(i){var o=i.payload.groupProfile.groupID,i=i.payload.userIDList,s=this._grpM.getGroupMemberHandler();i.forEach(function(c){c=s.getLocalGroupMemberInfo(o,c),c&&c.updateRole(O.GRP_MBR_ROLE_ADMIN)})}},{key:"_onMemberCancelledAdmin",value:function(i){var o=i.payload.groupProfile.groupID,i=i.payload.userIDList,s=this._grpM.getGroupMemberHandler();i.forEach(function(c){c=s.getLocalGroupMemberInfo(o,c),c&&c.updateRole(O.GRP_MBR_ROLE_MEMBER)})}},{key:"_onGroupProfileModified",value:function(c){var o=this,c=c.payload,i=c.newGroupProfile,p=c.groupProfile,s=c.operatorInfo,c=p.groupID,l=this._grpM.getLocalGroupProfile(c),p=(Object.keys(i).forEach(function(m){switch(m){case"ownerID":o._ownerChanged(l,i);break;case"groupName":l.name=i[m];break;default:l[m]=i[m]}}),q(s)||Object.keys(s).forEach(function(m){var I;m==="nameCard"?l.updateSelfInfo({nameCard:s[m]}):m==="role"&&(I="",s[m]===400?I=O.GRP_MBR_ROLE_OWNER:s[m]===300?I=O.GRP_MBR_ROLE_ADMIN:s[m]===200&&(I=O.GRP_MBR_ROLE_MEMBER),l.updateSelfInfo({role:I}))}),!l.isSupportTopic);this._grpM.emitGroupListUpdate(!0,p)}},{key:"_ownerChanged",value:function(i,o){var i=i.groupID,s=this._grpM.getLocalGroupProfile(i),c=this._grpM.getMyUserID();c===o.ownerID&&(s.updateGroup({selfInfo:{role:O.GRP_MBR_ROLE_OWNER}}),s=(o=this._grpM.getGroupMemberHandler()).getLocalGroupMemberInfo(i,c),c=this._grpM.getLocalGroupProfile(i).ownerID,o=o.getLocalGroupMemberInfo(i,c),s&&s.updateRole(O.GRP_MBR_ROLE_OWNER),o&&o.updateRole(O.GRP_MBR_ROLE_MEMBER))}},{key:"_onMemberInfoModified",value:function(t){var o=t.to,s=t.payload,i=s.groupProfile,s=s.memberList,c=i.groupID,l=(Lt(o)&&this._updateTopicMuteTime(t),this._grpM.getGroupMemberHandler());s.forEach(function(p){var m=l.getLocalGroupMemberInfo(c,p.userID);m&&ut(p.muteTime)&&m.updateMuteUntil(p.muteTime)})}},{key:"_updateTopicMuteTime",value:function(s){var o=s.to,s=s.payload,c=s.groupProfile,s=s.memberList,i=s===void 0?[]:s,s=this._grpM.get(10),c=c.groupID,l=s.getLocalTopic(c,o);if(l){for(var p=!1,m=0;m<i.length;m++){var I=i[m];if(I.userID===this._grpM.getMyUserID()&&0<=I.muteTime){l.updateSelfInfo({muteTime:I.muteTime}),p=!0;break}}p&&this._grpM.emitOEvt(Me.TOPIC_UPDATED,{groupID:c,topic:l})}}},{key:"_onTopicProfileUpdated",value:function(t){var i=t.payload,o=i.groupProfile.groupID,i=i.newTopicInfo;this._grpM.get(10).onTopicProfileUpdated(v({groupID:o,topicID:t.to},i))}},{key:"_cacheGroupTips",value:function(t,o){this._cachedGroupTipsMap.has(t)||this._cachedGroupTipsMap.set(t,[]),this._cachedGroupTipsMap.get(t).push(o)}},{key:"_deleteCachedGroupTips",value:function(t){this._cachedGroupTipsMap.has(t)&&this._cachedGroupTipsMap.delete(t)}},{key:"_notifyCachedGroupTips",value:function(t,o){var i=this,s=this._cachedGroupTipsMap.get(t)||[];E.l("".concat(this._n,"._notifyCachedGroupTips groupID:").concat(t," groupType:").concat(o," count:").concat(s.length)),s.forEach(function(c){i.onNewGroupTips(c)}),this._deleteCachedGroupTips(t)}},{key:"_cacheAndCompare",value:function(s){var o=s.groupID,c=s.event,i=s.item,s=s.groupType,c=(E.l("".concat(this._n,"._cacheAndCompare groupID:").concat(o," groupType:").concat(s)),this._cacheGroupTips(o,{event:c,dataList:[i]}),{groupID:o,type:s});s===O.GRP_AVCHATROOM?this._grpM.hasLocalGroup(o)?this._notifyCachedGroupTips(o,s):this._grpM.setUnjoinedAVChatRoom(o):(this._grpM.updateGroupMap([c]),this._notifyCachedGroupTips(o,s)),this._checkCountMap.has(o)||this._checkCountMap.set(o,0)}},{key:"reset",value:function(){this._cachedGroupTipsMap.clear(),this._checkCountMap.clear()}}]),la),od=(V(Ds,[{key:"onCheckTimer",value:function(t){t%1==0&&0<this._cachedGroupMessageMap.size&&this._check()}},{key:"_check",value:function(){var t=this;this._cachedGroupMessageMap.forEach(function(o,i){var s=t._checkCountMap.get(i),c=t._grpM.hasLocalGroup(i);E.l("".concat(t._n,"._check groupID:").concat(i," hasLocalGroup:").concat(c," checkCount:").concat(s)),c?(t._notifyCachedGroupMessage(i),t._checkCountMap.delete(i),t._grpM.deleteUnjoinedAVChatRoom(i)):s>=t.MAX_CHECK_COUNT?(t._deleteCachedGroupMessage(i),t._checkCountMap.delete(i)):t._checkCountMap.set(i,++s)})}},{key:"updateLastMsg",value:function(t){var o="".concat(this._n,".updateLastMsg");if(this._grpM.getGroupMap().size!==0){for(var i,s,c,l,p=!1,m=t.length,I=0;I<m;I++)(i=t[I]).type===O.CONV_GROUP&&i.lastMessage.lastSequence!==0&&i.lastMessage.payload!==null&&(s=i.conversationID.split(/^GROUP/)[1],(s=this._grpM.getLocalGroupProfile(s))&&(c=s.lastMessage,l=i.lastMessage,JSON.stringify(c)!==JSON.stringify(l)&&(s.lastMessage=v({},i.lastMessage),p=!0)));E.l("".concat(o," convCount:").concat(m," groupCount:").concat(this._grpM.getLocalGroupList().length," isUpdated:").concat(p)),p&&(this._grpM.sortLocalGroupList(),this._grpM.emitGroupListUpdate(!0,!1))}else this.tempConversationList=t}},{key:"onNewMessage",value:function(t){var s=this._assembly(t),o=s.conversationOptionsList,i=s.messageList,s=s.AVChatRoomMessageList,s=(0<s.length&&this._grpM.onAVChatRoomMessage(s),wa(i)),s=(0<s.length&&this._grpM.emitOEvt(Me.MESSAGE_MODIFIED,s),0<o.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:o,isInstantMessage:t.isInstantMessage!==!1,updateUnreadCount:t.updateUnreadCount!==!1}),this._grpM.updateNextMessageSeq(o)),Un(i));0<s.length&&this._grpM.emitOEvt(Me.MESSAGE_RECEIVED,s),i.length=0}},{key:"_assembly",value:function(t){var o=t.dataList,i=t.event,s=t.isInstantMessage,c=null,l=[],p=[],m=[],I={},C=this._grpM.getFileDownloadProxy(),S=this._grpM.getDowloadFileAuthKey(),k=this._grpM.get(17).getFileDNList(),G=o.length;1<G&&o.sort(function(Pt,cn){return Pt.sequence-cn.sequence});for(var U=this._grpM.get(11),Y=this._grpM.get(4),Z=0;Z<G;Z++){var $,De=Ua(o[Z]),lt=De.groupProfile,_e=lt.groupID,Pe=lt.communityType,Pe=Pe===void 0?0:Pe,Ge=lt.topicID,Ge=Ge===void 0?void 0:Ge,et=lt.invisible,lt=lt.groupType,lt=lt===void 0?void 0:lt,We=void 0,_t=this._grpM.isMessageFromTopic(Pe,Ge),Jt=(_t&&(We=O.CONV_TOPIC,De.to=Ge),this._grpM.hasLocalGroup(_e));!Jt&&this._grpM.isUnjoinedAVChatRoom(_e)||(Jt||_t?this._grpM.isMessageFromOrToAVChatroom(_e)?(De.event=i,m.push(De)):(De.currentUser=this._grpM.getMyUserID(),De.conversationType=O.CONV_GROUP,De.isSystemMessage=!!De.isSystemMessage,(c=new Mn(De)).setElement(De.elements,C,S,k),et!==1?(Jt=o[Z].isModified===1,U.isMessageSentByCurrentInstance(c)?c.isModified=Jt:Jt=!1,De.onlineOnlyFlag===1?(c._onlineOnlyFlag=!0,U.isMessageSentByCurrentInstance(c)||p.push(c)):this._grpM.isMessageFromCommunityOfTopic(Pe,Ge)?p.push(c):(c.from!==this._grpM.getMyUserID()||(_t=U.getLatestMessageSentByMe(c.conversationID))&&(et=_t.nick,Pe=_t.avatar,et===c.nick&&Pe===c.avatar||(U.modifyMessageSentByMe({conversationID:$,latestNick:c.nick,latestAvatar:c.avatar}),Y.mockOnNickAvatarModified(c.nick,c.avatar))),U.pushIntoMessageList(p,c,Jt)&&(this._qualityStat(s,c),$=(Ge=c).conversationID,_t=Ge.sequence,et=U.isRemoteRead({conversationID:$,sequence:_t}),q(I[$])?(Pe=0,c.flow==="in"&&(c._isExcludedFromUnreadCount||et||(Pe=1)),I[$]=l.push({conversationID:$,unreadCount:Pe,type:q(We)?c.conversationType:We,subType:c.conversationSubType,lastMessage:c._isExcludedFromLastMessage?"":c})-1):(l[Jt=I[$]].type=q(We)?c.conversationType:We,l[Jt].subType=c.conversationSubType,l[Jt].lastMessage=c._isExcludedFromLastMessage?"":c,c.flow==="in"&&(c._isExcludedFromUnreadCount||et||l[Jt].unreadCount++))))):this._qualityStat(s,c)):this._cacheAndCompare({groupID:_e,event:i,item:De,groupType:lt}))}return{conversationOptionsList:l,messageList:p,AVChatRoomMessageList:m}}},{key:"_qualityStat",value:function(t,o){var i=this._grpM.get(26);i.addMessageSequence({key:ce,message:o}),t&&0<o.clientTime&&i.addMessageDelay(o.clientTime)}},{key:"onMsgRevoked",value:function(t,o){var i=this,s=this._grpM.get(11),c=[],l=[];t.dataList.forEach(function(p){var m=p.elements.revokedInfos,I=p.revokerInfo,C=p.groupProfile,S=!1;C&&(S=bt({groupID:C.groupID})||!Te(C.topicID)),q(m)||m.forEach(function(k){var G,U=Te(k.topicID)?"GROUP".concat(k.groupID):"GROUP".concat(k.topicID),Y=s.getLocalConversation(U),Z=k.revokerInfo&&k.revokerInfo.revoker||I&&I.revoker,$=I&&I.reason||"";Y&&Vt(Y.type)?G={conversationID:U,sequence:k.sequence,ID:"".concat(k.tinyID,"-").concat(k.clientTime,"-").concat(k.random)}:(Y=s.revoke(U,k.sequence,k.random))?G=Y:(G={conversationID:U,sequence:k.sequence},k.tinyID&&k.clientTime&&k.random&&(G.ID="".concat(k.tinyID,"-").concat(k.clientTime,"-").concat(k.random)),k.time&&(G.time=k.time)),G&&(G.revoker=Z,G.revokeReason=$,G.revokerInfo={userID:Z,nick:"",avatar:""},S?(G.revokerInfo.nick=C.nick,G.revokerInfo.avatar=C.avatar,c.push(G)):l.push(G))})}),l.length===0&&c.length===0||(s.onMessageRevoked([].concat(c,l),o),0<c.length&&this._grpM.emitOEvt(Me.MESSAGE_REVOKED,c),0<l.length&&s.updateRevokerInfo(l).then(function(p){i._grpM.emitOEvt(Me.MESSAGE_REVOKED,p)}))}},{key:"_groupListTreeShaking",value:function(t){for(var o=new Map(re(this._grpM.getGroupMap())),i=0,s=t.length;i<s;i++)o.delete(t[i].groupID);this._grpM.hasJoinedAVChatRoom()&&this._grpM.getJoinedAVChatRoom().forEach(function(m){o.delete(m)}),this._grpM.getGroupMap().forEach(function(m,I){m.isSupportTopic&&o.delete(I)});for(var c=re(o.keys()),l=0,p=c.length;l<p;l++)this._grpM.deleteGroup(c[l])}},{key:"syncGroupList",value:function(){var t=this,c=0<arguments.length&&arguments[0]!==void 0&&arguments[0],o=(this._pagingStatus===On&&this._grpM.clearGroupMap(),re(qn)),i=this.PAGING_GRP_COUNT_LIMIT,s=[];if(c===!0)return this._pagingGetGroupListWithTopic({limit:i,offset:0,groupBaseInfoFilter:o,groupList:s});var c="syncGroupList",l="".concat(this._n,".").concat(c),p=new ue(c);return this._pagingGetGroupList({limit:i,offset:0,groupBaseInfoFilter:o,groupList:s}).then(function(){var m=kn(t._pagingGetCostList),I=Cc(t._pagingGetCostList),C=(t._pagingGetCostList.length=0,t._pagingStatus=Rt,t._groupListTreeShaking(s),t._grpM.updateGroupMap(s),t._grpM.getLocalGroupList().length),C="count:".concat(C," sum:").concat(I," avg:").concat(m);return E.l("".concat(l," ok. ").concat(C)),p.setMessage(C).end(),t.tempConversationList&&(t.updateLastMsg(t.tempConversationList),t.tempConversationList=null),t._grpM.emitGroupListUpdate(!0,!0),Ae({groupList:t._grpM.getLocalGroupList()})}).catch(function(m){return t._pagingStatus=yi,p.setError(m).end(),E.e("".concat(l," failed. error:"),m),W(m)})}},{key:"getGroupList",value:function(){var t=this,o="".concat(this._n,".").concat("getGroupList");if(E.l("".concat(o," pagingStatus:").concat(this._pagingStatus)),this._pagingStatus===yi||this._pagingStatus===On)return this.syncGroupList().then(function(){var s=t._grpM.getLocalGroupList();return Ae({groupList:s,isSyncCompleted:t.isPagingGetCompleted()})}).catch(function(s){return E.e("".concat(o," failed. error:"),s),W(s)});var i=this._grpM.getLocalGroupList();return E.l("".concat(o,". returned group count:").concat(i.length)),we({groupList:i,isSyncCompleted:this.isPagingGetCompleted()})}},{key:"isPagingGetCompleted",value:function(){return this._pagingStatus===Rt}},{key:"_pagingGetGroupList",value:function(t){var o=this,i="".concat(this._n,".").concat("_pagingGetGroupList"),s=t.isCommunityRelay,c=s!==void 0&&s,l=t.limit,p=t.offset,m=t.groupBaseInfoFilter,I=t.groupList,C=Date.now();return this._grpM.req({P:P.GET_GRP_LIST,data:{type:c?O.GRP_COMMUNITY:void 0,memberAccount:this._grpM.getMyUserID(),limit:l,offset:p,responseFilter:{groupBaseInfoFilter:m,selfInfoFilter:["Role","JoinTime","MsgFlag","MsgSeq"]}}}).then(function(U){var U=U.data,k=U.groups,k=k===void 0?[]:k,U=U.totalCount,k=(I.push.apply(I,re(k)),o._handleGroupAtInfoWithoutTopic(c,k),p+l),G=!(k<U),U="offset:".concat(p," limit:").concat(l," total:").concat(U," isCompleted:").concat(G," ")+"current:".concat(I.length," isCommunityRelay:").concat(c);return o._pagingGetCostList.push(An(C,!1)),E.l("".concat(i," ok. ").concat(U," cost:").concat(An(C))),c||G?!c&&G?(E.l("".concat(i," start to get community list")),p=0,o._pagingGetGroupList({limit:l,offset:p,groupBaseInfoFilter:m,groupList:I,isCommunityRelay:!0})):c&&!G?(p=k,o._pagingGetGroupList({limit:l,offset:p,groupBaseInfoFilter:m,groupList:I,isCommunityRelay:!0})):Ae({groupList:I}):(p=k,o._pagingGetGroupList({limit:l,offset:p,groupBaseInfoFilter:m,groupList:I}))}).catch(function(S){return S.code===10018?(E.w("".concat(o.logPrefix," response size exceeds the limit, request count:").concat(l)),l=50,o._pagingGetGroupList({limit:l,offset:p,groupBaseInfoFilter:m,groupList:I,isCommunityRelay:c})):c?(S.code===11e3&&E.l("".concat(i," ok. community unavailable")),we({groupList:I})):W(S)})}},{key:"_pagingGetGroupListWithTopic",value:function(t){var o=this,i="".concat(this._n,"._pagingGetGroupListWithTopic"),s=t.limit,c=t.offset,l=t.groupBaseInfoFilter,p=t.groupList,m=Date.now();return this._grpM.req({P:P.GET_GRP_LIST,data:{type:O.GRP_COMMUNITY,memberAccount:this._grpM.getMyUserID(),limit:s,offset:c,responseFilter:{groupBaseInfoFilter:l,selfInfoFilter:re(nt)},isSupportTopic:1,needAppDefineData:1}}).then(function(C){var C=C.data,S=C.groups,C=C.totalCount,S=(p.push.apply(p,re(S===void 0?[]:S)),c+s),k=!(S<C);return E.l("".concat(i," ok. offset:").concat(c," limit:").concat(s," totalCount:").concat(C," isCompleted:").concat(k," currentCount:").concat(p.length," cost:").concat(An(m))),k?(o._grpM.updateGroupMap(p),o._grpM.emitGroupListUpdate(!0,!1),C=o._grpM.getLocalGroupList().filter(function(G){return G.isSupportTopic===!0}),Ae({groupList:C})):(c=S,o._pagingGetGroupListWithTopic({limit:s,offset:c,groupBaseInfoFilter:l,groupList:p}))}).catch(function(I){return I.code===10018?(E.w("".concat(o.logPrefix," response size exceeds the limit, request count:").concat(s)),s=50,o._pagingGetGroupListWithTopic({limit:s,offset:c,groupBaseInfoFilter:l,groupList:p})):W(I)})}},{key:"_cacheGroupMessage",value:function(t,o){this._cachedGroupMessageMap.has(t)||this._cachedGroupMessageMap.set(t,[]),this._cachedGroupMessageMap.get(t).push(o)}},{key:"_deleteCachedGroupMessage",value:function(t){this._cachedGroupMessageMap.has(t)&&this._cachedGroupMessageMap.delete(t)}},{key:"_notifyCachedGroupMessage",value:function(t,o){var i=this,s=this._cachedGroupMessageMap.get(t)||[];E.l("".concat(this._n,"._notifyCachedGroupMessage groupID:").concat(t," groupType:").concat(o," count:").concat(s.length)),s.forEach(function(c){i.onNewMessage(c)}),this._deleteCachedGroupMessage(t)}},{key:"_cacheAndCompare",value:function(s){var o=s.groupID,c=s.event,i=s.item,s=s.groupType,c=(E.l("".concat(this._n,"._cacheAndCompare groupID:").concat(o," groupType:").concat(s)),this._cacheGroupMessage(o,{event:c,dataList:[i]}),{groupID:o,type:s});s===O.GRP_AVCHATROOM?this._grpM.hasLocalGroup(o)?this._notifyCachedGroupMessage(o,s):this._grpM.setUnjoinedAVChatRoom(o):(this._grpM.updateGroupMap([c]),this._notifyCachedGroupMessage(o,s)),this._checkCountMap.has(o)||this._checkCountMap.set(o,0)}},{key:"_handleGroupAtInfoWithoutTopic",value:function(t,o){var i=this;t&&o.length!==0&&o.forEach(function(l){var c=l.groupID,l=l.groupAtInfoList,p=[];q(l)||(l.forEach(function(m){p.push(v(v({},m),{},{groupID:c}))}),i._grpM.get(11).onNewGroupAtTips({dataList:p}))})}},{key:"setPagingGroupCount",value:function(t){q(t)||(this.PAGING_GRP_COUNT_LIMIT=parseInt(t,10))}},{key:"reset",value:function(){this.PAGING_GRP_COUNT_LIMIT=200,this._cachedGroupMessageMap.clear(),this._checkCountMap.clear(),this._pagingStatus=On,this._pagingGetCostList=[]}}]),Ds),id=(V(Ss,[{key:"_onCloudConfig",value:function(){var t=this._grpM.getCloudConfig("grp_attr_cache_time");q(t)||(this.CACHE_EXPIRE_TIME=Number(t))}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesMap.forEach(function(t){t.localMainSequence=0})}},{key:"isGroupAttributesUpdatedNotice",value:function(i){var o=i.to,i=i.elements.newGroupProfile,s=!q(i)&&!Te(i.groupAttributeOption);return s&&this._onGroupAttributesUpdated({groupID:o,groupAttributeOption:i.groupAttributeOption}),s}},{key:"_onGroupAttributesUpdated",value:function(p){var o=this,i=p.groupID,p=p.groupAttributeOption,s=p.mainSequence,c=p.isWithChangedAttributeInfo,l=p.groupAttributeList,l=l===void 0?[]:l,p=p.operationType;if(E.l("".concat(this._n,".onGroupAttributesUpdated. ")+"groupID:".concat(i," isWithChangedAttributeInfo:").concat(c," operationType:").concat(p)),!q(p)){this._groupAttributesCopy=this._getCachedAttributes({groupID:i});var m=s-this._getLocalGroupAttributes(i).localMainSequence;if(m!=0){if(c===1&&m==1)return this._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:s,groupAttributeList:l,operationType:p}),void this._emitGroupAttributesUpdated(i);this._hasLocalGroupAttributes(i)&&(c=this._getLocalGroupAttributes(i).avChatRoomKey,this._getGroupAttributes({groupID:i,avChatRoomKey:c}).then(function(){o._emitGroupAttributesUpdated(i)}))}}}},{key:"initGroupAttributesCache",value:function(i){var o=i.groupID,i=i.avChatRoomKey,i=i===void 0?void 0:i;this._groupAttributesMap.set(o,{lastUpdateTime:0,localMainSequence:0,remoteMainSequence:0,attributes:new Map,avChatRoomKey:i}),E.l("".concat(this._n,".initGroupAttributesCache groupID:").concat(o," avChatRoomKey:").concat(i))}},{key:"initGroupAttributes",value:function(l){var o=this,i=l.groupID,s=l.groupAttributes,l=this._getLocalGroupAttributes(i),c=l.remoteMainSequence,l=l.avChatRoomKey,p=new ue("initGroupAttributes");return p.setMessage("groupID:".concat(i," avChatRoomKey:").concat(l," mainSequence:").concat(c)),this._grpM.req({P:P.SET_GRP_ATTR,data:{groupID:i,avChatRoomKey:l,mainSequence:c,groupAttributeList:this._transformGroupAttributes(s)}}).then(function(C){E.l("".concat(o._n,".").concat("initGroupAttributes"," ok. groupID:").concat(i));var C=C.data,I=C.mainSequence,C=re(C.groupAttributeList);return C.forEach(function(S){S.value=s[S.key]}),o._groupAttributesCopy=o._getCachedAttributes({groupID:i}),o._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:I,groupAttributeList:C,operationType:1}),o._emitGroupAttributesUpdated(i),p.end(),Ae({groupAttributes:s})}).catch(function(m){return p.setError(m).end(),W(m)})}},{key:"setGroupAttributes",value:function(I){var o=this,i="".concat(this._n,".").concat("setGroupAttributes"),s=I.groupID,c=I.groupAttributes,I=this._getLocalGroupAttributes(s),l=I.remoteMainSequence,p=I.avChatRoomKey,m=I.attributes,I=this._transformGroupAttributes(c),C=(I.forEach(function(S){var k=S.key;S.sequence=0,m.has(k)&&(S.sequence=m.get(k).sequence)}),new ue("setGroupAttributes"));return C.setMessage("groupID:".concat(s," groupAttributes:").concat(JSON.stringify(c))),E.l("".concat(i,". groupID:").concat(s," mainSequence:").concat(l)),this._grpM.req({P:P.MODIFY_GRP_ATTR,data:{groupID:s,avChatRoomKey:p,mainSequence:l,groupAttributeList:I}}).then(function(G){E.l("".concat(i," ok."));var G=G.data,k=G.mainSequence,G=re(G.groupAttributeList);return G.forEach(function(U){U.value=c[U.key]}),o._groupAttributesCopy=o._getCachedAttributes({groupID:s}),o._refreshCachedGroupAttributes({groupID:s,remoteMainSequence:k,groupAttributeList:G,operationType:2}),o._emitGroupAttributesUpdated(s),C.end(),Ae({groupAttributes:c})}).catch(function(S){return C.setError(S).end(),W(S)})}},{key:"deleteGroupAttributes",value:function(s){var o=this,i=s.groupID,s=s.keyList,s=s===void 0?[]:s,m=this._getLocalGroupAttributes(i),c=m.remoteMainSequence,C=m.avChatRoomKey,l=m.attributes,p=re(l.keys()),m=P.CLEAR_GRP_ATTR,I=3,C={groupID:i,avChatRoomKey:C,mainSequence:c},S=[],k=(0<s.length&&(p=[],m=P.DEL_GRP_ATTR,I=4,s.forEach(function(G){var U=0;l.has(G)&&(U=l.get(G).sequence,p.push(G)),S.push({key:G,sequence:U})}),C.groupAttributeList=S),new ue("deleteGroupAttributes"));return k.setMessage("groupID:".concat(i," mainSequence:").concat(c," keyList:").concat(s," proto:").concat(m)),this._grpM.req({P:m,data:C}).then(function(G){return E.l("".concat(o._n,".").concat("deleteGroupAttributes"," ok. groupID:").concat(i)),G=G.data.mainSequence,o._groupAttributesCopy=o._getCachedAttributes({groupID:i}),o._refreshCachedGroupAttributes({groupID:i,remoteMainSequence:G,groupAttributeList:S,operationType:I}),o._emitGroupAttributesUpdated(i),k.end(),Ae({keyList:p})}).catch(function(G){return k.setError(G).end(),W(G)})}},{key:"getGroupAttributes",value:function(t){var o=this,i="".concat(this._n,".").concat("getGroupAttributes"),s=t.groupID,m=this._getLocalGroupAttributes(s),c=m.avChatRoomKey,l=m.lastUpdateTime,p=m.localMainSequence,m=m.remoteMainSequence,I=new ue("getGroupAttributes");return I.setMessage("groupID:".concat(s," localMainSequence:").concat(p," remoteMainSequence:").concat(m," keyList:").concat(t.keyList)),Date.now()-l>=this.CACHE_EXPIRE_TIME||p<m?this._getGroupAttributes({groupID:s,avChatRoomKey:c}).then(function(C){return I.setMoreMessage("get attributes from remote. count:".concat(C.length)).end(),E.l("".concat(i," from remote. groupID:").concat(s)),C=o._getCachedAttributes(t),Ae({groupAttributes:C})}).catch(function(C){return I.setError(C).end(),W(C)}):(I.setMoreMessage("get attributes from cache").end(),E.l("".concat(i," from cache. groupID:").concat(s)),l=this._getCachedAttributes(t),we({groupAttributes:l}))}},{key:"_getGroupAttributes",value:function(t){var o=this,i=0;return q(t.avChatRoomKey)||(i=1),this._grpM.req({P:P.GET_GRP_ATTR,data:v(v({},t),{},{groupType:i})}).then(function(l){E.l("".concat(o._n,"._getGroupAttributes ok. groupID:").concat(t.groupID));var l=l.data,c=l.mainSequence,l=l.groupAttributeList,p=re(l);return q(c)||o._refreshCachedGroupAttributes({groupID:t.groupID,remoteMainSequence:c,groupAttributeList:p,operationType:5}),l}).catch(function(s){return W(s)})}},{key:"_refreshCachedGroupAttributes",value:function(c){var o=c.groupID,i=c.remoteMainSequence,s=c.groupAttributeList,c=c.operationType;if(this._hasLocalGroupAttributes(o)){var l=this._getLocalGroupAttributes(o),p=l.localMainSequence;if(c===5||i-p==1)l.remoteMainSequence=i,l.localMainSequence=i,l.lastUpdateTime=Date.now(),this._updateCachedAttributes({groupAttributes:l,groupAttributeList:s,operationType:c});else{if(p===i)return;l.remoteMainSequence=i}this._groupAttributesMap.set(o,l),s="operationType:".concat(c," localMainSequence:").concat(p," remoteMainSequence:").concat(i),E.l("".concat(this._n,"._refreshCachedGroupAttributes. ").concat(s))}}},{key:"_getCachedAttributes",value:function(i){var o=i.groupID,i=i.keyList,i=i===void 0?[]:i,s={};if(this._hasLocalGroupAttributes(o)){var c=this._getLocalGroupAttributes(o).attributes;if(0<i.length)i.forEach(function(I){c.has(I)&&(s[I]=c.get(I).value)});else{var l,p=A(c.keys());try{for(p.s();!(l=p.n()).done;){var m=l.value;s[m]=c.get(m).value}}catch(I){p.e(I)}finally{p.f()}}}return s}},{key:"_updateCachedAttributes",value:function(s){var o=s.groupAttributes,i=s.groupAttributeList,s=s.operationType;s!==3?s!==4?(s===1&&o.attributes.clear(),i.forEach(function(m){var l=m.key,p=m.value,m=m.sequence;o.attributes.set(l,{value:p,sequence:m})})):i.forEach(function(c){o.attributes.delete(c.key)}):o.attributes.clear()}},{key:"_hasLocalGroupAttributes",value:function(t){return this._groupAttributesMap.has(t)}},{key:"_getLocalGroupAttributes",value:function(t){return this._hasLocalGroupAttributes(t)||this.initGroupAttributesCache({groupID:t}),this._groupAttributesMap.get(t)}},{key:"_transformGroupAttributes",value:function(t){var o=[];return Object.keys(t).forEach(function(i){o.push({key:i,value:t[i]})}),o}},{key:"_emitGroupAttributesUpdated",value:function(t){var o=this._getCachedAttributes({groupID:t}),s=this._computeAttrChangedInfo(o),i=s.updatedKeyList,s=s.deletedKeyList;E.l("".concat(this._n,"._emitGroupAttributesUpdated update:").concat(i.length,", delete:").concat(s.length)),i.length===0&&s.length===0||this._grpM.emitOEvt(Me.GROUP_ATTRIBUTES_UPDATED,{groupID:t,groupAttributes:o,updatedKeyList:i,deletedKeyList:s})}},{key:"_computeAttrChangedInfo",value:function(t){var o=this,i=[],s=[];return Object.keys(t).forEach(function(c){t[c]!==o._groupAttributesCopy[c]&&i.push(c)}),Object.keys(this._groupAttributesCopy).forEach(function(c){q(t[c])&&s.push(c)}),this._groupAttributesCopy={},{updatedKeyList:i,deletedKeyList:s}}},{key:"deleteLocalGroupAttributes",value:function(t){this._hasLocalGroupAttributes(t)&&this._groupAttributesMap.delete(t)}},{key:"reset",value:function(){this._groupAttributesMap.clear(),this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4}}]),Ss),ad=(V(Ts,[{key:"_onCloudConfig",value:function(){var t=this._grpM.getCloudConfig("grp_counter_expire_time");q(t)||(this.EXPIRE_TIME=Number(t))}},{key:"isGroupCountersNotice",value:function(i){var o=i.to,i=i.elements.groupCounterInfo,s=!1;return Te(i)||(this._onGroupCountersUpdated({groupID:o,groupCounterInfo:i}),s=!0),s}},{key:"_onGroupCountersUpdated",value:function(t){var o=this,i=t.groupID;t.groupCounterInfo.forEach(function(p){var c=p.type,l=p.groupCounterSeq,p=p.counterList,p=p===void 0?[]:p;c!==0&&c!==2||(o._updateLocalGroupCounters({groupID:i,groupCounterSeq:l,counterList:p}),p.forEach(function(m){o._grpM.emitOEvt(Me.GROUP_COUNTER_UPDATED,{groupID:i,key:m.key,value:m.value})})),c===1&&o._deleteLocalGroupCounters({groupID:i,groupCounterSeq:l,counterList:p})}),E.l("".concat(this._n,"._onGroupCountersUpdated groupID:").concat(i))}},{key:"initGroupCountersCache",value:function(i){var o=i.groupID,i=i.avChatRoomKey;this._groupCountersMap.set(o,{lastUpdateTime:0,groupCounterSeq:0,counters:new Map,avChatRoomKey:i}),E.l("".concat(this._n,".initGroupCountersCache groupID:").concat(o," avChatRoomKey:").concat(i))}},{key:"setGroupCounters",value:function(s){if(!this._grpM.canIUse(Ue.GRP_COUNTER))return this._grpM.noUse("setGroupCounters");var o="".concat(this._n,".").concat("setGroupCounters"),i=s.groupID,s=s.counters,s=this._convertObjectToList(s),c=this._getLocalGroupCounters(i).avChatRoomKey,l="groupID:".concat(i," count:").concat(s.length),p=new ue("setGroupCounters");return p.setMessage("".concat(l)),E.l("".concat(o,". ").concat(l)),this._updateGroupCounters({groupID:i,counterList:s,avChatRoomKey:c,mode:"Set"}).then(function(m){return p.end(),E.l("".concat(o," ok.")),Ae({counters:m})}).catch(function(m){return p.setError(m).end(),E.e("".concat(o," failed. error:"),m),W(m)})}},{key:"increaseGroupCounter",value:function(l){var o="increaseGroupCounter";if(!this._grpM.canIUse(Ue.GRP_COUNTER))return this._grpM.noUse(o);var i="".concat(this._n,".").concat(o),s=l.groupID,c=l.key,l=l.value,p=this._getLocalGroupCounters(s).avChatRoomKey,m="groupID:".concat(s," key:").concat(c," value:").concat(l),I=new ue(o);return I.setMessage("".concat(m)),E.l("".concat(i,". ").concat(m)),this._updateGroupCounters({groupID:s,counterList:[{key:c,value:l}],avChatRoomKey:p,mode:"Increase"}).then(function(C){return I.end(),E.l("".concat(i," ok.")),Ae({counters:C})}).catch(function(C){return I.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"decreaseGroupCounter",value:function(l){var o="decreaseGroupCounter";if(!this._grpM.canIUse(Ue.GRP_COUNTER))return this._grpM.noUse(o);var i="".concat(this._n,".").concat(o),s=l.groupID,c=l.key,l=l.value,p=this._getLocalGroupCounters(s).avChatRoomKey,m="groupID:".concat(s," key:").concat(c," value:").concat(l),I=new ue(o);return I.setMessage("".concat(m)),E.l("".concat(i,". ").concat(m)),this._updateGroupCounters({groupID:s,counterList:[{key:c,value:l}],avChatRoomKey:p,mode:"Decrease"}).then(function(C){return I.end(),E.l("".concat(i," ok.")),Ae({counters:C})}).catch(function(C){return I.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"getGroupCounters",value:function(p){var o=this;if(!this._grpM.canIUse(Ue.GRP_COUNTER))return this._grpM.noUse("getGroupCounters");var i="".concat(this._n,".").concat("getGroupCounters"),s=p.groupID,p=p.keyList,c=p===void 0?[]:p,p=this._getLocalGroupCounters(s),l=p.avChatRoomKey,p=p.lastUpdateTime,m=new ue("getGroupCounters");return m.setMessage("groupID:".concat(s)),Date.now()-p>=this.EXPIRE_TIME?this._getRemoteGroupCounters({groupID:s,avChatRoomKey:l}).then(function(I){return m.setMoreMessage("from remote. count:".concat(I.length)).end(),E.l("".concat(i," from remote. groupID:").concat(s)),I=o._getLocalCounters(s,c),Ae({counters:I})}).catch(function(I){return m.setError(I).end(),W(I)}):(m.setMoreMessage("from cache").end(),E.l("".concat(i," from cache. groupID:").concat(s)),p=this._getLocalCounters(s,c),we({counters:p}))}},{key:"_getRemoteGroupCounters",value:function(t){var o=this;return this._grpM.req({P:P.GET_GRP_COUNTER,data:v({},t)}).then(function(c){var c=c.data,s=c.counterList,s=s===void 0?[]:s,c=c.groupCounterSeq;return o._updateLocalGroupCounters({groupID:t.groupID,counterList:s,groupCounterSeq:c}),E.l("".concat(o._n,"._getRemoteGroupCounters ok. groupID:").concat(t.groupID)),s}).catch(function(i){return W(i)})}},{key:"_convertObjectToList",value:function(t){var o=[];return Object.keys(t).forEach(function(i){o.push({key:i,value:t[i]})}),o}},{key:"_updateGroupCounters",value:function(t){var o="".concat(this._n,"._updateGroupCounters"),i=t.groupID,s=t.avChatRoomKey,c=t.mode;return E.l("".concat(o,". groupID:").concat(i," avChatRoomKey:").concat(s," mode:").concat(c)),this._grpM.req({P:P.UPDATE_GRP_COUNTER,data:v({},t)}).then(function(p){E.l("".concat(o," ok."));var p=p.data.counterList,m={};return(p===void 0?[]:p).forEach(function(S){var C=S.key,S=S.value;m[C]=S}),m}).catch(function(l){return W(l)})}},{key:"_hasLocalGroupCounters",value:function(t){return this._groupCountersMap.has(t)}},{key:"_getLocalGroupCounters",value:function(t){return this._hasLocalGroupCounters(t)||this.initGroupCountersCache({groupID:t}),this._groupCountersMap.get(t)}},{key:"_updateLocalGroupCounters",value:function(p){var o,i,s,c=p.groupID,l=p.counterList,l=l===void 0?[]:l,p=p.groupCounterSeq;this._hasLocalGroupCounters(c)&&(s=this._getLocalGroupCounters(c),o=s.counters,i=s.avChatRoomKey,s=s.groupCounterSeq,0<p&&p<s||(l.forEach(function(C){var I=C.key,C=C.value;o.set(I,C)}),this._groupCountersMap.set(c,{lastUpdateTime:Date.now(),groupCounterSeq:p,counters:o,avChatRoomKey:i})))}},{key:"_deleteLocalGroupCounters",value:function(l){var o,i,s=l.groupID,c=l.counterList,c=c===void 0?[]:c,l=l.groupCounterSeq;this._hasLocalGroupCounters(s)&&(i=this._getLocalGroupCounters(s),o=i.counters,i=i.avChatRoomKey,c.forEach(function(p){o.delete(p.key)}),this._groupCountersMap.set(s,{lastUpdateTime:Date.now(),groupCounterSeq:l,counters:o,avChatRoomKey:i}))}},{key:"_getLocalCounters",value:function(t,o){var i={};if(!this._hasLocalGroupCounters(t))return i;var s=this._getLocalGroupCounters(t).counters;if(0<o.length)o.forEach(function(m){s.has(m)&&(i[m]=s.get(m))});else{var c,l=A(s.keys());try{for(l.s();!(c=l.n()).done;){var p=c.value;i[p]=s.get(p)}}catch(m){l.e(m)}finally{l.f()}}return i}},{key:"reset",value:function(){this._groupCountersMap.clear(),this.EXPIRE_TIME=3e4}}]),Ts),sd=(V(Cs,[{key:"start",value:function(){var t=this._grpM.isLoggedIn();t||(this._proto=P.AV_NOAUTH_POLLING),E.l("".concat(this._n,".start pollingInterval:").concat(this._manager.getPollingInterval()," isLoggedIn:").concat(t)),this._isRunning=!0,this._request()}},{key:"isRunning",value:function(){return this._isRunning}},{key:"_request",value:function(){var t=this,o=this._onInit(this._groupID);this._grpM.req({P:this._proto,data:o}).then(function(i){t._onSuccess(t._groupID,i),t.isRunning()&&(-1<t._timeoutID&&clearTimeout(t._timeoutID),t._timeoutID=setTimeout(t._request.bind(t),t._manager.getPollingInterval()))}).catch(function(i){t._onFail(t._groupID,i),t.isRunning()&&(-1<t._timeoutID&&clearTimeout(t._timeoutID),t._timeoutID=setTimeout(t._request.bind(t),t._manager.MAX_POLLING_INTERVAL))})}},{key:"stop",value:function(){E.l("".concat(this._n,".stop")),-1<this._timeoutID&&(clearTimeout(this._timeoutID),this._timeoutID=-1),this._isRunning=!1}},{key:"getPollingTimerID",value:function(){return this._timeoutID}}]),Cs),qu={3:!0,4:!0,5:!0,6:!0,17:!0,20:!0,21:!0,100:!0},rd=(V(Ms,[{key:"hasJoinedAVChatRoom",value:function(){var t=[];return 0<(t=0<this._joinedGroupMap.size?re(this._joinedGroupMap.values()).filter(function(o){return o.type===O.GRP_AVCHATROOM}):t).length}},{key:"getJoinedLiveList",value:function(){var t=[];return t=0<this._joinedGroupMap.size?re(this._joinedGroupMap.values()).filter(function(o){return o.type===O.GRP_LIVE}):t}},{key:"checkJoinedAVChatRoomByID",value:function(t){return this._joinedGroupMap.has(t)}},{key:"getJoinedAVChatRoom",value:function(){return 0<this._joinedGroupMap.size?re(this._joinedGroupMap.keys()):[]}},{key:"_updatedata",value:function(t){var o=this._pollingRequestInfoMap.get(t);return t===re(this._pollingInstanceMap.keys())[0]?v(v({},o),{},{startBroadcastSeq:this._startBroadcastSeq,simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG}):v(v({},o),{},{simplifiedMessage:this.DEFAULT_POLLING_SIMPLIFIED_MSG})}},{key:"_handleSuccess",value:function(t,o){var i,I=o.data,s=I.key,c=I.nextSeq,l=I.rspMsgList,p=I.errorCode,m=I.nextBroadcastSeq,I=I.broadcastMessageList;p!==0?(p=this._pollingRequestInfoMap.get(t),i=new ue("longPollingAVError"),p=p?"".concat(p.key,"-").concat(p.startSeq):"requestInfo is undefined",i.setMessage("".concat(t,"-").concat(p,"-").concat(o.errorInfo)).setCode(o.errorCode).end(!0)):this.checkJoinedAVChatRoomByID(t)&&(Ee(s)&&ut(c)&&this._pollingRequestInfoMap.set(t,{key:s,startSeq:c}),ut(m)&&m>this._startBroadcastSeq&&(this._startBroadcastSeq=m),ye(l)&&0<l.length?(l.forEach(function(C){C.to=C.groupID}),this.onMessage(l,t)):(this._pollingNoMessageCount+=1,this._pollingNoMessageCount===this.DEFAULT_POLLING_NO_MESSAGE_COUNT&&(this._pollingInterval=this.DEFAULT_POLLING_INTERVAL+this.DEFAULT_POLLING_INTERVAL_PLUS)),this._onBroadcastMessage(I))}},{key:"_handleFailure",value:function(t,o){}},{key:"onMessage",value:function(t,o){if(ye(t)&&t.length!==0){var i="".concat(this._n,".onMessage"),s=(o&&(i+=" groupID:".concat(o)),this._pollingNoMessageCount!==0&&(this._pollingNoMessageCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL),null),c=[],l=this._get(11),p=this._get(26),m=t.length,I=(1<m&&t.sort(function(Y,Z){return Y.sequence-Z.sequence}),this._get(12).isUnlimitedAVChatRoom()),C=!1;E.getLevel()<=0&&(o=t.map(function(Y){return Y.sequence}),E.l("".concat(i," count:").concat(o.length," sequenceList:").concat(o)),o.length=0);for(var S=0;S<m;S++){var k=this.restoreMessageFromSimplified(t[S]);if(qu[k.event]){if(k.event===6&&(this._grpM.isGroupAttributesUpdatedNotice(k)||this._grpM.isGroupCountersNotice(k)))continue;if(k.event!==20)if(k.event!==21)if(k.event!==100){var s=this.packMessage(k,k.event),G=k.isModified===1,C=k.isHistoryMessage===1;if(!I){if(this._seqSll.has(s.sequence))continue;this._seqSll.set(s.sequence)}var U=this._IDSll.has(s.ID);U?E.w("".concat(i," ID:").concat(s.ID," has:").concat(U)):(this._IDSll.set(s.ID),U=!1,!C&&this._isMessageSentByCurrentInstance(s)?G&&(U=!0,s.isModified=G,l.updateMsgIsModifiedProp(s)):U=!0,U&&(s.conversationType===O.CONV_SYSTEM&&s.payload.operationType===5&&this._onGroupDismissed(s.payload.groupProfile.groupID),C||s.conversationType===O.CONV_SYSTEM||(G=s.conversationID.replace(O.CONV_GROUP,""),this._pollingInstanceMap.has(G)?this._grpM.isLoggedIn()&&p.addMessageSequence({key:Ci,message:s}):(s.type!==O.MSG_GRP_TIP&&0<s.clientTime&&p.addMessageDelay(s.clientTime),p.addMessageSequence({key:Mi,message:s}))),c.push(s)))}else this.onRoomCustomData(k);else this._get(34).onMessageReactionNotify({event:21,dataList:k.elements.messageReactionNotifyList});else this.handleMessageRevokedNotice(k)}else E.w("".concat(i,". unknown event:").concat(k.event))}c.length!==0&&(0<(o=wa(c)).length&&this._grpM.emitOEvt(Me.MESSAGE_MODIFIED,o),C||0<(o=this.packConversationOption(c)).length&&l.onNewMessage({conversationOptionsList:o,isInstantMessage:!0}),this._checkMessageStacked(c),0<(o=Un(c)).length&&this._grpM.emitOEvt(Me.MESSAGE_RECEIVED,o),c.length=0)}}},{key:"handleMessageRevokedNotice",value:function(t){var o=this,i=t.groupID,s=t.elements.revokeMsgList,c=t.revokerInfo,l=[];s.forEach(function(C){var S=C.tinyID,m=C.clientTime,I=C.random,C=C.sequence,S={conversationID:"".concat(O.CONV_GROUP).concat(i),ID:"".concat(S,"-").concat(m,"-").concat(I),revoker:c.revoker,revokeReason:c.reason||"",revokerInfo:{userID:c.revoker,nick:"",avatar:""},sequence:C};l.push(S)}),l.length!==0&&this._get(11).updateRevokerInfo(l).then(function(p){o._grpM.emitOEvt(Me.MESSAGE_REVOKED,p)})}},{key:"isBroadcastOrNormal",value:function(t){return t===3||t===17}},{key:"isGroupTip",value:function(t){return t===4||t===6}},{key:"isGroupSystemNotice",value:function(t){return t===5}},{key:"restoreGroupTipElements",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},c=t.operatorInfo,c=c===void 0?{}:c,l=t.operatorID,o=t.userIDList,o=o===void 0?[]:o,i=t.operationType,i=(ut(t.groupJoinType)||i!==1&&i!==2||(t.groupJoinType=i===2?0:1),c.userID),s=c.avatar,c=c.nick,l=(t.operatorInfo={userID:i===void 0?l:i,avatar:s===void 0?"":s,nick:c===void 0?"":c},o.map(function(p){return{userID:p}}));return t.memberInfoList=t.memberInfoList||l,t}},{key:"restoreMessageFromSimplified",value:function(t){var o,i,s,c=t.event;return this.isBroadcastOrNormal(c)&&(t.cloudCustomData=t.cloudCustomData||"",t.elements=t.elements.map(function(l){var p;return l.type===O.MSG_CUSTOM&&(p=l.content,l.content=v({data:"",description:"",extension:""},p===void 0?{}:p)),l})),(this.isGroupTip(c)||this.isGroupSystemNotice(c))&&(t.from=t.from||"@TIM#SYSTEM"),this.isGroupTip(c)&&(t.elements=this.restoreGroupTipElements(t.elements),i=(s=(s=t.elements)===void 0?{}:s).operationType,o=s.operatorInfo,i===1&&(i=[{userID:(o===void 0?{}:o).userID}],s.memberInfoList=s.memberInfoList||i)),this.isGroupSystemNotice(c)&&(s=(o=t.elements).memberInfoList,i=o.operatorInfo,t.elements.memberInfoList=v({userID:t.elements.operatorID,avatar:"",nick:""},s=s||(i===void 0?{}:i)),t.elements=v({authentication:"",remarkInfo:"",messageKey:1e3*t.time},t.elements),c=Object.keys(t.elements).filter(function(l){return l!=="operatorInfo"}).reduce(function(l,p){return v(v({},l),{},H({},p,t.elements[p]))},{}),t.elements=c),t}},{key:"_onGroupDismissed",value:function(t){E.l("".concat(this._n,"._onGroupDismissed groupID:").concat(t)),this._grpM.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"_checkMessageStacked",value:function(i){var o="MessageStacked",i=i.length;100<=i&&(this._grpM.warn(o,i),this._reportMessageStackedCount<5&&(new ue(o).setMessage("count:".concat(i," groupID:").concat(re(this._joinedGroupMap.keys()))).setLevel("warning").end(),this._reportMessageStackedCount+=1))}},{key:"_isMessageSentByCurrentInstance",value:function(t){return!!this._get(11).isMessageSentByCurrentInstance(t)}},{key:"packMessage",value:function(s,c){s.currentUser=this._grpM.getMyUserID(),s.conversationType=c===5?O.CONV_SYSTEM:O.CONV_GROUP,s.isSystemMessage=!!s.isSystemMessage;var i=new Mn(s),s=this.packElements(s,c),c=this._grpM.getFileDownloadProxy(),l=this._grpM.getDowloadFileAuthKey(),p=this._get(17).getFileDNList();return i.setElement(s,c,l,p),i}},{key:"packElements",value:function(t,o){return o===4||o===6?(this._updateMemberCountByGroupTips(t),{type:O.MSG_GRP_TIP,content:v(v({},t.elements),{},{groupProfile:t.groupProfile})}):o===5?{type:O.MSG_GRP_SYS_NOTICE,content:v(v({},t.elements),{},{groupProfile:v(v({},t.groupProfile),{},{groupID:t.groupID})})}:t.elements}},{key:"packConversationOption",value:function(t){for(var o=new Map,i=0;i<t.length;i++){var s,c=t[i],l=c.conversationID;o.has(l)?((s=o.get(l)).lastMessage=c).flow==="in"&&s.unreadCount++:o.set(l,{conversationID:c.conversationID,unreadCount:c.flow==="out"?0:1,type:c.conversationType,subType:c.conversationSubType,lastMessage:c})}return re(o.values())}},{key:"_updateMemberCountByGroupTips",value:function(l){var o,i,s,c=l.groupProfile.groupID,l=l.elements.onlineMemberInfo,l=l===void 0?void 0:l;Te(l)||(o=(o=l.onlineMemberNum)===void 0?0:o,l=(l=l.expireTime)===void 0?this.DEFAULT_EXPIRE_TIME:l,i=this._onlineMemberCountMap.get(c)||{},s=Date.now(),Te(i)?Object.assign(i,{lastReqTime:0,lastSyncTime:0,latestUpdateTime:s,memberCount:o,expireTime:l}):(i.latestUpdateTime=s,i.memberCount=o),this._onlineMemberCountMap.set(c,i))}},{key:"_onBroadcastMessage",value:function(t){if(!Te(t)){for(var o=[],i=t.length,s=null,c=0;c<i;c++){var l=this.restoreMessageFromSimplified(t[c]);qu[l.event]?((s=this.packMessage(l,l.event)).isBroadcastMessage=!0,this._broadcastMessageIDMap.has(s.ID)||(o.push(s),this._broadcastMessageIDMap.set(s.ID,1))):E.w("".concat(this._n,"._onBroadcastMessage unknown event:").concat(l.event))}0<o.length&&this._grpM.emitOEvt(Me.MESSAGE_RECEIVED,o)}}},{key:"start",value:function(t){var o;this._pollingInstanceMap.has(t)?(o=this._pollingInstanceMap.get(t)).isRunning()||o.start():((o=new sd({manager:this,groupID:t,onInit:this._updatedata.bind(this),onSuccess:this._handleSuccess.bind(this),onFail:this._handleFailure.bind(this)})).start(),this._pollingInstanceMap.set(t,o),E.l("".concat(this._n,".start groupID:").concat(t)))}},{key:"handleJoinResult",value:function(t){var o=this;return this._preCheck(t.group).then(function(){var i=t.longPollingKey,s=t.group,c=s.groupID;return o._joinedGroupMap.set(c,s),o._grpM.updateGroupMap([s]),o._grpM.deleteUnjoinedAVChatRoom(c),o._grpM.emitGroupListUpdate(!0,!1),q(i)?we({status:di,group:s}):Promise.resolve()})}},{key:"startRunLoop",value:function(t){var o=this;return this.handleJoinResult(t).then(function(){var i=t.longPollingKey,s=t.group,c=t.startSeq,l=s.groupID;return o._pollingRequestInfoMap.set(l,{key:i,startSeq:c===void 0?0:c}),o.start(l),o._grpM.isLoggedIn()?we({status:di,group:s}):we({status:di})})}},{key:"_preCheck",value:function(i){if(this._get(12).isUnlimitedAVChatRoom()||!this.hasJoinedAVChatRoom()||i.type===O.GRP_LIVE)return Promise.resolve();var i=Le(this._joinedGroupMap.entries().next().value,2),o=i[0],i=i[1];if(this._grpM.isLoggedIn()){if(i.selfInfo.role!==O.GRP_MBR_ROLE_OWNER&&i.ownerID!==this._grpM.getMyUserID())return this._grpM.quitGroup(o);this._grpM.deleteLocalGroupAndConversation(o)}else this._grpM.deleteLocalGroupAndConversation(o);return this.reset(o),Promise.resolve()}},{key:"joinWithoutAuth",value:function(t){var o=this,i=t.groupID,s="".concat(this._n,".").concat("joinWithoutAuth"),c=new ue("joinWithoutAuth");return this._grpM.req({P:P.APPLY_JOIN_GRP_NOAUTH,data:t}).then(function(l){if(l=l.data.longPollingKey,c.setMessage("groupID:".concat(i," longPollingKey:").concat(l)).end(!0),q(l))return W({code:Q.CANNOT_JOIN_NON_AV_WITHOUT_LOGIN});E.l("".concat(s," ok. groupID:").concat(i)),o._get(11).setCompleted("".concat(O.CONV_GROUP).concat(i));var p=new Go({groupID:i});return o.startRunLoop({group:p,longPollingKey:l}),Ae({status:di})}).catch(function(l){return E.e("".concat(s," failed. groupID:").concat(i," error:"),l),c.setError(l).setMessage("groupID:".concat(i)).end(!0),W(l)}).finally(function(){o._grpM.get(14).reportAtOnce()})}},{key:"getGroupOnlineMemberCount",value:function(t){var o=this._onlineMemberCountMap.get(t)||{},i=Date.now();return Te(o)||i-o.lastSyncTime>1e3*o.expireTime&&1e4<i-o.latestUpdateTime&&3e3<i-o.lastReqTime?(o.lastReqTime=i,this._onlineMemberCountMap.set(t,o),this._getGroupOnlineMemberCount(t).then(function(s){return Ae({memberCount:s.memberCount})}).catch(function(s){return W(s)})):we({memberCount:o.memberCount})}},{key:"_getGroupOnlineMemberCount",value:function(t){var o=this,i="".concat(this._n,".").concat("_getGroupOnlineMemberCount"),s=new ue("_getGroupOnlineMemberCount");return this._grpM.requestOnlineCount(t).then(function(m){var l=o._onlineMemberCountMap.get(t)||{},m=m.data,p=m.memberCount,p=p===void 0?0:p,m=m.expireTime,m=m===void 0?o.DEFAULT_EXPIRE_TIME:m,I=(E.l("".concat(i," ok. groupID:").concat(t," memberCount:").concat(p," expireTime:").concat(m)),Date.now());return Te(l)&&(l.lastReqTime=I),o._onlineMemberCountMap.set(t,Object.assign(l,{lastSyncTime:I,latestUpdateTime:I,memberCount:p,expireTime:m})),{memberCount:p}}).catch(function(c){return E.w("".concat(i," failed. error:"),c),s.setCode(c.code).setMessage("groupID:".concat(t," error:").concat(JSON.stringify(c))).end(),Promise.reject(c)})}},{key:"_get",value:function(t){return this._grpM.get(t)}},{key:"setPollingInterval",value:function(t){q(t)||(ut(t)?this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=t:this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=parseInt(t,10))}},{key:"setPollingIntervalPlus",value:function(t){q(t)||(ut(t)?this.DEFAULT_POLLING_INTERVAL_PLUS=t:this.DEFAULT_POLLING_INTERVAL_PLUS=parseInt(t,10))}},{key:"setPollingNoMessageCount",value:function(t){q(t)||(ut(t)?this.DEFAULT_POLLING_NO_MESSAGE_COUNT=t:this.DEFAULT_POLLING_NO_MESSAGE_COUNT=parseInt(t,10))}},{key:"setPollingSimplifiedMessage",value:function(t){q(t)||t!=="0"&&t!=="1"||(this.DEFAULT_POLLING_SIMPLIFIED_MSG=parseInt(t,10))}},{key:"getPollingInterval",value:function(){return this._pollingInterval}},{key:"onAVChatRoomMemberBanned",value:function(t){t=t.payload.groupProfile.groupID,E.l("".concat(this._n,".onAVChatRoomMemberBanned groupID:").concat(t)),this._grpM.deleteLocalGroupAndConversation(t),this.reset(t)}},{key:"restartPolling",value:function(){E.l("".concat(this._n,".restartPolling count:").concat(this._pollingInstanceMap.size));var t,o=A(this._pollingInstanceMap.values());try{for(o.s();!(t=o.n()).done;){var i=t.value;i.stop(),i.start()}}catch(s){o.e(s)}finally{o.f()}}},{key:"getPollingTimerID",value:function(t){if(!this._pollingInstanceMap.has(t))return-1;var o=this._pollingInstanceMap.get(t).getPollingTimerID();return E.l("".concat(this._n,".getPollingTimerID groupID:").concat(t," timerID:").concat(o)),o}},{key:"hasPollingInstance",value:function(t){return this._pollingInstanceMap.has(t)}},{key:"onRoomCustomData",value:function(c){var o=c.groupID,i=c.sequence,s=c.time,c=c.elements,c=c&&c.content;this._get(30).onRoomCustomDataReceived(c),E.l("".concat(this._n,".onRoomCustomData groupID:").concat(o," sequence:").concat(i," time:").concat(s," data:").concat(c))}},{key:"reset",value:function(t){if(t){E.l("".concat(this._n,".reset groupID:").concat(t));var o=this._pollingInstanceMap.get(t);o&&o.stop(),this._pollingInstanceMap.delete(t),this._joinedGroupMap.delete(t),this._pollingRequestInfoMap.delete(t),this._onlineMemberCountMap.delete(t)}else{E.l("".concat(this._n,".reset all"));var i,s=A(this._pollingInstanceMap.values());try{for(s.s();!(i=s.n()).done;)i.value.stop()}catch(c){s.e(c)}finally{s.f()}this._pollingInstanceMap.clear(),this._joinedGroupMap.clear(),this._pollingRequestInfoMap.clear(),this._onlineMemberCountMap.clear(),this._broadcastMessageIDMap.clear()}this._seqSll.reset(),this._IDSll.reset(),this._reportMessageStackedCount=0,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL=300,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0}}]),Ms),cd=(V(Is,[{key:"updateMember",value:function(t){q(t.onlineStatus)||(this.isOnline=t.onlineStatus==="Online");var o=[null,void 0,"",0,NaN];t.memberCustomField&&Ho(this.memberCustomField,t.memberCustomField),Gn(this,t,["memberCustomField","marks","onlineStatus"],o)}},{key:"updateRole",value:function(t){["Owner","Admin","Member"].indexOf(t)<0||(this.role=t)}},{key:"updateMuteUntil",value:function(t){q(t)||(this.muteUntil=Math.floor((Date.now()+1e3*t)/1e3))}},{key:"updateNameCard",value:function(t){q(t)||(this.nameCard=t)}},{key:"updateMemberCustomField",value:function(t){t&&Ho(this.memberCustomField,t)}}]),Is),ud=(V(Li,[{key:"_onProfileUpdated",value:function(t){for(var o=this,i=t.data,s=0;s<i.length;s++)(function(c){var l=i[c];o.groupMemberListMap.forEach(function(p){p.has(l.userID)&&p.get(l.userID).updateMember({nick:l.nick,avatar:l.avatar})})})(s)}},{key:"deleteGroupMemberList",value:function(t){this.groupMemberListMap.delete(t)}},{key:"getGroupMemberList",value:function(m){var o,i=this,s=m.groupID,c=m.role,c=c===void 0?void 0:c,k=m.offset,l=k===void 0?0:k,k=m.count,p=k===void 0?15:k,k=m.filter,m=k===void 0?void 0:k,I="".concat(this._n,".").concat("getGroupMemberList"),k=this._grpM.hasLocalGroup(s);if(E.l("".concat(I," groupID:").concat(s," role:").concat(c," offset:").concat(l," count:").concat(p," hasLocalGroup:").concat(k)),!k)return we({memberList:[],offset:0});if(this._grpM.getLocalGroupProfile(s).type===O.GRP_AVCHATROOM){if(this._grpM.canIUse(Ue.AV_MBR_LIST))return this._getAVChatRoomMemberList({groupID:s,offset:l,filter:m});this._grpM.warn("LiveOnlineMember")}c!==O.GRP_MBR_ROLE_ADMIN&&c!==O.GRP_MBR_ROLE_OWNER&&c!==O.GRP_MBR_ROLE_MEMBER||(o=c);var C=new ue("getGroupMemberList"),S=0,k={groupID:s,limit:100<p?100:p,memberRoleFilter:o?[o]:void 0,memberInfoFilter:this.DEFAULT_MEMBER_INFO_FILTER},G=(bt({groupID:s})?k.next="".concat(l):(k.offset=l,S=l+p),[]);return this._grpM.req({P:P.GET_GRP_MBR_LIST,data:k}).then(function($){var $=$.data,Y=$.members,Z=$.memberNum,$=$.next,$=$===void 0?void 0:$;return q($)||(S=Te($)?0:$),ye(Y)&&Y.length!==0?(i._grpM.hasLocalGroup(s)&&(i._grpM.getLocalGroupProfile(s).memberNum=Z),G=i._updateLocalGroupMemberMap(s,Y),i._grpM.get(4).getUserProfile({userIDList:Y.map(function(De){return De.userID}),tagList:[at.NICK,at.AVATAR]})):(S=0,Promise.resolve([]))}).then(function(U){return U=U.data,!ye(U)||U.length===0?we({memberList:[],offset:S}):(U=U.map(function(Y){return{userID:Y.userID,nick:Y.nick,avatar:Y.avatar}}),i._updateLocalGroupMemberMap(s,U),G.length<p&&(S=0),C.setMessage("groupID:".concat(s," offset:").concat(l," count:").concat(p)).end(),E.l("".concat(I," ok.")),Ae({memberList:G,offset:S}))}).catch(function(U){return C.setError(U).end(),E.e("".concat(I," failed. error:"),U),W(U)})}},{key:"_getAVChatRoomMemberList",value:function(c){var o=this,i=c.groupID,s=c.offset,c=c.filter,l="".concat(this._n,".").concat("_getAVChatRoomMemberList"),p=new ue("_getAVChatRoomMemberList");return p.setMessage("groupID:".concat(i," offset:").concat(s," filter:").concat(c)),this._grpM.req({P:P.GET_AV_MBR_LIST,data:{groupID:i,offset:s,filter:c}}).then(function(I){var I=I.data,C=I.memberList,C=C===void 0?[]:C,I=I.offset,I=I===void 0?0:I,C=(p.end(),E.l("".concat(l," ok. member count:").concat(C.length,", next request timestamp:").concat(I)),C.map(function(S){return v(v({},S),{},{onlineStatus:"Online"})})),C=o._updateLocalGroupMemberMap(i,C);return Ae({memberList:C,offset:I})}).catch(function(m){return p.setError(m).end(),E.e("".concat(l," failed. error:"),m),W(m)})}},{key:"getGroupMemberProfile",value:function(t){var o=this,i="getGroupMemberProfile",p="".concat(this._n,".").concat(i),s="groupID:".concat(t.groupID),c=(5<t.userIDList.length?s+=" userIDList.length:".concat(t.userIDList.length):s+=" userIDList:".concat(t.userIDList),E.l("".concat(p," ").concat(s)),50<t.userIDList.length&&(t.userIDList=t.userIDList.slice(0,50)),t.groupID),l=t.userIDList,p=this._grpM.getLocalGroupProfile(c);if(p&&Vt(p.type))return W({code:p=Q.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(p,i)});var m=new ue(i);return m.setMessage(s),this._getGroupMemberProfileAdvance(v(v({},t),{},{userIDList:l})).then(function(I){return I=I.data.members,ye(I)&&I.length!==0?(o._updateLocalGroupMemberMap(c,I),o._grpM.get(4).getUserProfile({userIDList:I.map(function(C){return C.userID}),tagList:[at.NICK,at.AVATAR]})):we([])}).then(function(I){return I=I.data.map(function(C){return{userID:C.userID,nick:C.nick,avatar:C.avatar}}),o._updateLocalGroupMemberMap(c,I),I=l.filter(function(C){return o.hasLocalGroupMember(c,C)}).map(function(C){return o.getLocalGroupMemberInfo(c,C)}),m.end(),Ae({memberList:I})})}},{key:"addGroupMember",value:function(t){var o=this,i="".concat(this._n,".").concat("addGroupMember"),s=t.groupID,c=this._grpM.getLocalGroupProfile(s),l=c.type,p=new ue("addGroupMember");return p.setMessage("groupID:".concat(s," groupType:").concat(l)),Vt(l)?(l=new Gt({code:Q.CANNOT_ADD_MEMBER_IN_AV}),p.setError(l).end(),W(l)):(t.userIDList=t.userIDList.map(function(m){return{userID:m}}),E.l("".concat(i," groupID:").concat(s)),this._grpM.req({P:P.ADD_GRP_MBR,data:t}).then(function(k){var k=k.data.members,I=(E.l("".concat(i," ok")),k.filter(function(U){return U.result===1}).map(function(U){return U.userID})),C=k.filter(function(U){return U.result===0}).map(function(U){return U.userID}),S=k.filter(function(U){return U.result===2}).map(function(U){return U.userID}),k=k.filter(function(U){return U.result===4}).map(function(U){return U.userID}),G="groupID:".concat(t.groupID,", ")+"successUserIDList:".concat(I,", ")+"failureUserIDList:".concat(C,", ")+"existedUserIDList:".concat(S,", ")+"overLimitUserIDList:".concat(k);return p.setMoreMessage(G).end(),I.length===0?Ae({successUserIDList:I,failureUserIDList:C,existedUserIDList:S,overLimitUserIDList:k}):(o._updateConvGroupProfile(c),Ae({successUserIDList:I,failureUserIDList:C,existedUserIDList:S,overLimitUserIDList:k,group:c}))}).catch(function(m){return p.setError(m).end(),E.e("".concat(i," failed. error:"),m),W(m)}))}},{key:"deleteGroupMember",value:function(t){var o=this,i="".concat(this._n,".").concat("deleteGroupMember"),s=t.groupID,c=t.userIDList,l=this._grpM.getLocalGroupProfile(s);if(q(l))return W({code:Q.CANNOT_FIND_GRP});if(Vt(l.type))return this._grpM.canIUse(Ue.AV_BAN_MBR)?this._banAVChatRoomMember(t):this._grpM.noUse("deleteGroupMember");var p="groupID:".concat(s," ").concat(5<c.length?"userIDList.length:".concat(c.length):"userIDList:".concat(c)),m=(E.l("".concat(i," groupID:").concat(s," userIDList:"),c),new ue("deleteGroupMember"));return m.setMessage(p),this._grpM.req({P:P.DEL_GRP_MBR,data:t}).then(function(){return m.end(),E.l("".concat(i," ok")),o._updateConvGroupProfile(l),o.deleteLocalGroupMembers(s,c),Ae({group:l,userIDList:c})}).catch(function(I){return m.setError(I).end(),E.e("".concat(i," failed. error:"),I),W(I)})}},{key:"_updateConvGroupProfile",value:function(t){this._grpM.get(11).updateConvGroupProfile([t])}},{key:"_banAVChatRoomMember",value:function(t){var o=this,i="".concat(this._n,".").concat("_banAVChatRoomMember"),s=t.groupID,c=t.userIDList,l="groupID:".concat(s," ").concat(5<c.length?"userIDList.length:".concat(c.length):"userIDList:".concat(c)),p=new ue("_banAVChatRoomMember"),m=(p.setMessage(l),E.l("".concat(i," groupID:").concat(s," userIDList:"),c),this._grpM.getLocalGroupProfile(s));return q(t.duration)||t.duration===0?W({code:Q.BAN_DURATION_INVALID}):this._grpM.req({P:P.BAN_AV_MBR,data:t}).then(function(){return p.end(),E.l("".concat(i," ok")),o.deleteLocalGroupMembers(s,c),Ae({group:m,userIDList:c})}).catch(function(I){return p.setError(I).end(),E.e("".concat(i," failed. error:"),I),W(I)})}},{key:"setGroupMemberMuteTime",value:function(c){var o=this,i=c.groupID,s=c.userID,c=c.muteTime,l="".concat(this._n,".").concat("setGroupMemberMuteTime");if(s===this._grpM.getMyUserID())return W({code:Q.CANNOT_MUTE_SELF});var p="groupID:".concat(i," userID:").concat(s," muteTime:").concat(c),m=(E.l("".concat(l," ").concat(p)),new ue("setGroupMemberMuteTime"));return m.setMessage(p),this.modifyGroupMemberInfo({groupID:i,userID:s,muteTime:c}).then(function(I){m.end(),E.l("".concat(l," ok"));var C=o._grpM.getLocalGroupProfile(i);return Ae({group:C,member:I})}).catch(function(I){return m.setError(I).end(),E.e("".concat(l," failed. error:"),I),W(I)})}},{key:"setGroupMemberRole",value:function(c){var o="".concat(this._n,".").concat("setGroupMemberRole"),i=c.groupID,s=c.userID,c=c.role,l="groupID:".concat(i," userID:").concat(s," role:").concat(c),p=this._grpM.getLocalGroupProfile(i);if(p&&p.selfInfo.role!==O.GRP_MBR_ROLE_OWNER)return W({code:Q.NOT_OWNER});var m=[O.GRP_MBR_ROLE_ADMIN,O.GRP_MBR_ROLE_MEMBER];if(bt({groupID:i})&&m.push(O.GRP_MBR_ROLE_CUSTOM),m.indexOf(c)<0)return W({code:Q.INVALID_MEMBER_ROLE});if(s===this._grpM.getMyUserID())return W({code:Q.CANNOT_SET_SELF_MEMBER_ROLE});var I=new ue("setGroupMemberRole");return I.setMessage(l),E.l("".concat(o," ").concat(l)),this.modifyGroupMemberInfo({groupID:i,userID:s,role:c}).then(function(C){return I.end(),E.l("".concat(o," ok")),Ae({group:p,member:C})}).catch(function(C){return I.setError(C).end(),E.e("".concat(o," failed. error:"),C),W(C)})}},{key:"_filterProfanity",value:function(t,o){var s=this._grpM.get(29);if(!s)return!0;var s=s.filterText(o[t],"group_member_profile"),i=s.isAllowedToSend,s=s.modifiedText;return i===!0&&(o[t]=s,!0)}},{key:"setGroupMemberNameCard",value:function(I){var o=this,i="setGroupMemberNameCard",s="".concat(this._n,".").concat(i);if(I.nameCard&&this._filterProfanity("nameCard",I)===!1)return W({code:Q.PROFANITY_FOUND});var c=I.groupID,m=I.userID,l=m===void 0?this._grpM.getMyUserID():m,p=I.nameCard,m="groupID:".concat(c," userID:").concat(l," nameCard:").concat(p),I=(E.l("".concat(s," ").concat(m)),this._grpM.getLocalGroupProfile(c));if(I&&Vt(I.type))return W({code:I=Q.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(I,i)});var C=new ue(i);return C.setMessage(m),this.modifyGroupMemberInfo({groupID:c,userID:l,nameCard:p}).then(function(S){E.l("".concat(s," ok")),C.end();var k=o._grpM.getLocalGroupProfile(c);return l===o._grpM.getMyUserID()&&k&&k.setSelfNameCard(p),Ae({group:k,member:S})}).catch(function(S){return C.setError(S).end(),E.e("".concat(s," failed. error:"),S),W(S)})}},{key:"setGroupMemberCustomField",value:function(p){var o=this,i="setGroupMemberCustomField",s="".concat(this._n,".").concat(i),c=p.groupID,l=p.userID,l=l===void 0?this._grpM.getMyUserID():l,p=p.memberCustomField,m="groupID:".concat(c," userID:").concat(l," memberCustomField:").concat(JSON.stringify(p)),I=(E.l("".concat(s," ").concat(m)),this._grpM.getLocalGroupProfile(c));if(I&&Vt(I.type))return W({code:I=Q.OPERATION_NOT_SUPPORTED_IN_AV,message:this._grpM.getErrMsg(I,i)});var C=new ue(i);return C.setMessage(m),this.modifyGroupMemberInfo({groupID:c,userID:l,memberCustomField:p}).then(function(S){C.end(),E.l("".concat(s," ok"));var k=o._grpM.getLocalGroupProfile(c);return Ae({group:k,member:S})}).catch(function(S){return C.setError(S).end(),E.e("".concat(s," failed. error:"),S),W(S)})}},{key:"modifyGroupMemberInfo",value:function(t){var o=this,i=t.groupID,s=t.userID,c=void 0;return Lt(i)&&(i=un(c=i)),this._grpM.req({P:P.MODIFY_GRP_MBR_INFO,data:v(v({},t),{},{groupID:i,topicID:c})}).then(function(){if(o.hasLocalGroupMember(i,s))return l=o.getLocalGroupMemberInfo(i,s),q(t.muteTime)||l.updateMuteUntil(t.muteTime),q(t.role)||l.updateRole(t.role),q(t.nameCard)||l.updateNameCard(t.nameCard),q(t.memberCustomField)||l.updateMemberCustomField(t.memberCustomField),l;var l=o._grpM.getLocalGroupProfile(i);return l&&!Vt(l.type)?o.getGroupMemberProfile({groupID:i,userIDList:[s]}).then(function(p){return Le(p.data.memberList,1)[0]}):void 0})}},{key:"markGroupMemberList",value:function(l){var o="".concat(this._n,".").concat("markGroupMemberList"),i=l.groupID,s=l.markType,I=l.enableMark,l=l.userIDList,c=l===void 0?[]:l,l="groupID:".concat(i," markType:").concat(s," enableMark:").concat(I," userIDList count:").concat(c.length),p=(E.l("".concat(o," ").concat(l)),2),m=[],I=(I===!0&&(p=1),re(c)),C=(500<c.length&&(I=c.slice(0,500),E.w("".concat(o," ").concat(ni(500)))),I.forEach(function(S){m.push({userID:S,markType:[s]})}),I=null,new ue("markGroupMemberList"));return C.setMessage(l),this._grpM.req({P:P.MARK_AV_MBR_INFO,data:{groupID:i,operationType:p,memberList:m}}).then(function(U){var U=U.data.memberList,U=U===void 0?[]:U,k=[],G=[],U=(U.length===c.length?k.push.apply(k,re(c)):(U.forEach(function(Y){k.push(Y.userID)}),c.forEach(function(Y){k.includes(Y)||G.push(Y)})),"success count:".concat(k.length," fail count:").concat(G.length));return C.setMessage(U).end(),E.l("".concat(o," ok. ").concat(U)),Ae({successUserIDList:k,failureUserIDList:G})}).catch(function(S){return C.setError(S).end(),E.e("".concat(o," failed. error:"),S),W(S)})}},{key:"_getGroupMemberProfileAdvance",value:function(t){return this._grpM.req({P:P.GET_GRP_MBR_PROFILE,data:v(v({},t),{},{memberInfoFilter:t.memberInfoFilter||this.DEFAULT_MEMBER_INFO_FILTER})})}},{key:"_updateLocalGroupMemberMap",value:function(t,o){var i=this;return ye(o)&&o.length!==0?o.map(function(s){return i.hasLocalGroupMember(t,s.userID)?i.getLocalGroupMemberInfo(t,s.userID).updateMember(s):i.setLocalGroupMember(t,new cd(s)),i.getLocalGroupMemberInfo(t,s.userID)}):[]}},{key:"deleteLocalGroupMembers",value:function(t,o){var i=this.groupMemberListMap.get(t);i&&o.forEach(function(s){i.delete(s)})}},{key:"getLocalGroupMemberInfo",value:function(t,o){return this.groupMemberListMap.has(t)?this.groupMemberListMap.get(t).get(o):null}},{key:"setLocalGroupMember",value:function(t,o){this.groupMemberListMap.has(t)?this.groupMemberListMap.get(t).set(o.userID,o):(o=new Map().set(o.userID,o),this.groupMemberListMap.set(t,o))}},{key:"getLocalGroupMemberList",value:function(t){return this.groupMemberListMap.get(t)}},{key:"hasLocalGroupMember",value:function(t,o){return this.groupMemberListMap.has(t)&&this.groupMemberListMap.get(t).has(o)}},{key:"hasLocalGroupMemberMap",value:function(t){return this.groupMemberListMap.has(t)}},{key:"reset",value:function(){this.groupMemberListMap.clear()}}]),Li),Vu=[17,18,20],ld=(V(ys,[{key:"onNewGroupSystemNotice",value:function(i){var c=i.dataList,o=i.isSyncingEnded,i=i.isInstantMessage,c=(E.d("".concat(this._n,".onReceiveSystemNotice count:").concat(c.length)),this._assembly({notifiesList:c,isInstantMessage:i})),s=c.eventDataList,c=c.result;0<s.length&&(this._grpM.get(11).onNewMessage({conversationOptionsList:s,isInstantMessage:i}),this._onReceivedGroupSystemNotice({result:c,isInstantMessage:i})),i?0<c.length&&this._grpM.emitOEvt(Me.MESSAGE_RECEIVED,c):o===!0&&this._clearGroupSystemNotice()}},{key:"_assembly",value:function(t){for(var o=t.notifiesList,i=t.isInstantMessage,s=null,c=o.length,m=0,l=[],p={conversationID:O.CONV_SYSTEM,unreadCount:0,type:O.CONV_SYSTEM,subType:null,lastMessage:null},m=0;m<c;m++){var I=o[m],S=I.groupProfile,C=S.communityType,S=S.topicID,S=S===void 0?void 0:S,G=I.elements,k=G.topicIDList,k=k===void 0?void 0:k,G=G.operationType;if(!((C===void 0?0:C)!==2||Te(S)&&Te(k))){if(Vu.includes(G)){this._handleTopicSystemNotice(I);continue}Te(S)||(I.to=S)}I.elements.operationType!==15&&(I.currentUser=this._grpM.getMyUserID(),I.conversationType=O.CONV_SYSTEM,I.conversationID=O.CONV_SYSTEM,(s=new Mn(I)).setElement({type:O.MSG_GRP_SYS_NOTICE,content:v(v({},I.elements),{},{groupProfile:v({},I.groupProfile)})}),s.isSystemMessage=!0,(s.sequence===1&&s.random===1||s.sequence===2&&s.random===2)&&(s.sequence=mn(),s.random=mn(),s.generateMessageID(),E.l("".concat(this._n,"._assembly regenerate ID:").concat(s.ID))),this._grpM.get(11).pushIntoNoticeResult(l,s)&&(i?p.unreadCount++:s.setIsRead(!0),p.subType=s.conversationSubType))}return p.lastMessage=l[l.length-1],{eventDataList:0<l.length?[p]:[],result:l}}},{key:"_clearGroupSystemNotice",value:function(){var t=this;this._getPendencyList().then(function(i){i.forEach(function(c){t.pendencyMap.set("".concat(c.from,"_").concat(c.groupID,"_").concat(c.to),c)});var i=t._grpM.get(11).getLocalMessageList(O.CONV_SYSTEM),s=[];i.forEach(function(c){var m=c.payload,l=m.operatorID,p=m.operationType,m=m.groupProfile;p===1&&(p="".concat(l,"_").concat(m.groupID,"_").concat(m.to),(l=t.pendencyMap.get(p))&&ut(l.handled)&&l.handled!==0&&s.push(c))}),t.deleteGroupSystemNotice({messageList:s})})}},{key:"deleteGroupSystemNotice",value:function(t){var o=this,i="".concat(this._n,".deleteGroupSystemNotice");return ye(t.messageList)&&t.messageList.length!==0?(E.l("".concat(i," ")+t.messageList.map(function(s){return s.ID})),this._grpM.req({P:P.DEL_GRP_SYSTEM_NOTICE,data:{messageListToDelete:t.messageList.map(function(s){return{from:O.CONV_SYSTEM,messageSeq:s.clientSequence,messageRandom:s.random}})}}).then(function(){E.l("".concat(i," ok"));var s=o._grpM.get(11);return t.messageList.forEach(function(c){s.deleteLocalMessage(c)}),Ae()}).catch(function(s){return E.e("".concat(i," error:"),s),W(s)})):we()}},{key:"_getPendencyList",value:function(){var t=this,s=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},o=s.type,i=s.startTime,s=s.limit;return this._grpM.req({P:P.GET_GRP_PENDENCY,data:{type:o===void 0?void 0:o,startTime:i===void 0?0:i,limit:s===void 0?20:s,handleAccount:this._grpM.getMyUserID()}}).then(function(c){var l=c.data.pendencyList;return c.data.nextStartTime!==0?t._getPendencyList({startTime:c.data.nextStartTime}).then(function(p){return[].concat(re(l),re(p))}):l})}},{key:"getGroupApplicationList",value:function(){var t=this;return this._getPendencyList().then(function(o){return t._getPendencyList({type:O.GRP_COMMUNITY}).then(function(i){return o.push.apply(o,re(i)),t._handlePendencyResult(o)}).catch(function(i){return t._handlePendencyResult(o)})})}},{key:"_handlePendencyResult",value:function(t){var o=this,i=[];return t.forEach(function(s){o.pendencyMap.set("".concat(s.from,"_").concat(s.groupID,"_").concat(s.to),s),s.handled===0&&i.push({applicant:s.from,applicantNick:s.fromUserNickName,groupName:s.groupName,groupID:s.groupID,authentication:s.authentication,messageKey:s.time,applicationType:s.applicationType,userID:s.userID,note:s.note})}),we({applicationList:i})}},{key:"_onReceivedGroupSystemNotice",value:function(t){var o=this,i=t.result;t.isInstantMessage&&i.forEach(function(s){switch(s.payload.operationType){case 1:break;case 2:o._onApplyJoinGroup(s);break;case 3:break;case 4:o._onMemberKicked(s);break;case 5:o._onGroupDismissed(s);break;case 6:break;case 7:o._onInviteGroup(s);break;case 8:o._onQuitGroup(s);break;case 9:o._onSetManager(s);break;case 10:o._onDeleteManager(s);break;case 11:case 12:case 15:break;case 20:o._onMessageRemindTypeSynced(s);break;case 21:o._grpM.onAVChatRoomMemberBanned(s)}})}},{key:"_onApplyJoinGroup",value:function(s){var o=this,s=s.payload.groupProfile,i=s.groupID,s=s.groupType,c=this._grpM.hasLocalGroup(i);E.l("".concat(this._n,"._onApplyJoinGroup groupID:").concat(i," groupType:").concat(s," hasGroup:").concat(c)),c||Vt(s)||this._grpM.getGroupProfile({groupID:i}).then(function(p){var p=p.data.group;p&&(o._grpM.updateGroupMap([p]),p=!p.isSupportTopic,o._grpM.emitGroupListUpdate(!0,p))})}},{key:"_onMemberKicked",value:function(t){t=t.payload.groupProfile.groupID,this._grpM.hasLocalGroup(t)&&this._grpM.deleteLocalGroupAndConversation(t)}},{key:"_onGroupDismissed",value:function(o){var o=o.payload.groupProfile.groupID,i=(this._grpM.hasLocalGroup(o)&&this._grpM.deleteLocalGroupAndConversation(o),this._grpM._AVChatRoomHandler);i&&i.checkJoinedAVChatRoomByID(o)&&i.reset(o)}},{key:"_onInviteGroup",value:function(s){var o=this,i=s.payload.groupProfile.groupID,s=this._grpM.hasLocalGroup(i);E.l("".concat(this._n,"._onInviteGroup groupID:").concat(i," hasGroup:").concat(s)),this._grpM.getGroupProfile({groupID:i}).then(function(){o._grpM.emitGroupListUpdate(),o._grpM.get(11).pullMsgOnInvite("".concat(O.CONV_GROUP).concat(i))})}},{key:"_onQuitGroup",value:function(i){var i=i.payload.groupProfile,o=i.groupID,i=i.groupType,s=this._grpM.hasLocalGroup(o);E.l("".concat(this._n,"._onQuitGroup groupID:").concat(o," groupType:").concat(i," hasGroup:").concat(s)),s&&this._grpM.deleteLocalGroupAndConversation(o)}},{key:"_onSetManager",value:function(i){var i=i.payload.groupProfile,o=i.to,i=i.groupID,i=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(i,o);i&&i.updateRole(O.GRP_MBR_ROLE_ADMIN)}},{key:"_onDeleteManager",value:function(i){var i=i.payload.groupProfile,o=i.to,i=i.groupID,i=this._grpM.getGroupMemberHandler().getLocalGroupMemberInfo(i,o);i&&i.updateRole(O.GRP_MBR_ROLE_MEMBER)}},{key:"_onMessageRemindTypeSynced",value:function(i){var o=i.payload.groupProfile.groupID,i=i.payload.messageRemindType;this._grpM.get(11).onGroupMsgRemindTypeUpdated({groupID:o,messageRemindType:i})}},{key:"_handleTopicSystemNotice",value:function(l){var i=l.groupProfile,o=i.groupID,i=i.topicID,l=l.elements,s=l.operationType,c=l.topicIDList,l=l.messageRemindType,p=this._grpM.get(10);s===17?p.onTopicCreated({groupID:o,topicID:i}):s===18?p.onTopicDeleted({groupID:o,topicIDList:c}):s===20&&p.onMessageRemindTypeUpdated({groupID:o,topicID:i,messageRemindType:l})}},{key:"reset",value:function(){this.pendencyMap.clear()}}]),ys),dd=["relayFlag"],pd=(z(Ri,Ht),ua=J(Ri),V(Ri,[{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("polling_interval"),o=this.getCloudConfig("polling_interval_plus"),i=this.getCloudConfig("polling_no_msg_count"),s=this.getCloudConfig("polling_simplified_msg"),c=this.getCloudConfig("paging_grp_count");E.l("".concat(this._n,"._onCloudConfig pollingInterval:").concat(t)+" pollingIntervalPlus:".concat(o," pollingNoMessageCount:").concat(i)+" pollingSimplifiedMessage:".concat(s," pagingGroupCount:").concat(c)),this._AVChatRoomHandler.setPollingInterval(t),this._AVChatRoomHandler.setPollingIntervalPlus(o),this._AVChatRoomHandler.setPollingNoMessageCount(i),this._AVChatRoomHandler.setPollingSimplifiedMessage(s),this._commonGroupHandler.setPagingGroupCount(c)}},{key:"onCheckTimer",value:function(t){this.isLoggedIn()&&(this._commonGroupHandler.onCheckTimer(t),this._groupTipsHandler.onCheckTimer(t))}},{key:"guardForAVChatRoom",value:function(t){var o,i=this;return t.conversationType===O.CONV_GROUP?(o=Lt(t.to)?un(t.to):t.to,this.hasLocalGroup(o)?we():this.getGroupProfile({groupID:o}).then(function(c){var c=c.data.group.type;return E.l("".concat(i._n,".guardForAVChatRoom. groupID:").concat(o," type:").concat(c)),c===O.GRP_AVCHATROOM?W(new Gt({code:c=Q.MSG_SEND_FAIL_NOT_IN_AV,message:i.getErrMsg(c,t.from,o),data:{message:t}})):we()})):we()}},{key:"checkJoinedAVChatRoomByID",value:function(t){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(t)}},{key:"onNewMessage",value:function(t){this._commonGroupHandler.onNewMessage(t)}},{key:"updateNextMessageSeq",value:function(t){var o,i=this;ye(t)&&(o=this.get(10),t.forEach(function(s){var c=s.conversationID.replace(O.CONV_GROUP,"");Lt(c)&&o.updateUnreadCountAndLastMsg(c,s.lastMessage),i.groupMap.has(c)&&(i.groupMap.get(c).nextMessageSeq=s.lastMessage.sequence+1)}))}},{key:"onNewGroupTips",value:function(t){this._groupTipsHandler.onNewGroupTips(t)}},{key:"onMsgRevoked",value:function(t){this._commonGroupHandler.onMsgRevoked(t,!(1<arguments.length&&arguments[1]!==void 0)||arguments[1])}},{key:"onNewGroupSystemNotice",value:function(t){this._groupSystemNoticeHandler.onNewGroupSystemNotice(t)}},{key:"onMsgReadNotice",value:function(t){var o=this;t.dataList.forEach(function(c){var s,c=c.elements.groupMessageReadNotice;q(c)||(s=o.get(11),c.forEach(function(m){var I=m.groupID,p=m.topicID,p=p===void 0?void 0:p,m=m.lastMessageSeq,I=(E.l("".concat(o._n,".onMsgReadNotice groupID:").concat(I," lastMessageSeq:").concat(m)),"".concat(O.CONV_GROUP).concat(I)),C=!0;Te(p)||(I="".concat(O.CONV_GROUP).concat(p),C=!1),s.updateIsReadAfterReadReport({conversationID:I,lastMessageSeq:m}),s.updateUnreadCount(I,C),s.clearGroupAtInfoList(I,C)}))})}},{key:"onReadReceiptList",value:function(t){var o=this;E.l("".concat(this._n,".onReadReceiptList options:"),t),t.dataList.forEach(function(l){var s=l.groupProfile,l=l.elements,s=s.groupID,c=o.get(11),l=l.readReceiptList;c.updateReadReceiptInfo({groupID:s,readReceiptList:l})})}},{key:"onMsgModified",value:function(t){E.l("".concat(this._n,".onMsgModified options:"),t);var o=this.get(11);t.dataList.forEach(function(i){o.onMessageModified(v(v({},i),{},{conversationType:O.CONV_GROUP,to:i.topicID||i.groupID}))})}},{key:"deleteGroupSystemNotice",value:function(t){this._groupSystemNoticeHandler.deleteGroupSystemNotice(t)}},{key:"initGroupMap",value:function(t){this.groupMap.set(t.groupID,new Go(t))}},{key:"clearGroupMap",value:function(){this.groupMap.clear()}},{key:"deleteGroup",value:function(t){this.groupMap.delete(t)}},{key:"updateGroupMap",value:function(t){var o,i=this,s=this.get(11);t.forEach(function(I){o=I.groupID,i.groupMap.has(o)?i.groupMap.get(o).updateGroup(I):(i.groupMap.set(o,new Go(I)),s.deleteGroupRoamingInfo(o))});var c,l=this.getMyUserID(),p=A(this.groupMap);try{for(p.s();!(c=p.n()).done;){var m=Le(c.value,2)[1];m.selfInfo.userID=l,m.selfInfo.role==="Owner"&&(m.ownerID=l)}}catch(I){p.e(I)}finally{p.f()}}},{key:"getGroupMap",value:function(){return this.groupMap}},{key:"getLocalGroupList",value:function(){return re(this.groupMap.values()).filter(function(t){return t.type!==O.GRP_ROOM&&t.type!==O.GRP_LIVE})}},{key:"getLocalGroupProfile",value:function(t){return this.groupMap.get(t)}},{key:"sortLocalGroupList",value:function(){var t=re(this.groupMap).filter(function(o){return o=Le(o,2),o[0],!Te(o[1].lastMessage)});t.sort(function(o,i){return i[1].lastMessage.lastTime-o[1].lastMessage.lastTime}),this.groupMap=new Map(re(t))}},{key:"updateGroupLastMessage",value:function(t){this._commonGroupHandler.updateLastMsg(t)}},{key:"emitGroupListUpdate",value:function(){var t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],o=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1],i=this.getLocalGroupList();t&&this.emitOEvt(Me.GROUP_LIST_UPDATED),o&&(t=JSON.parse(JSON.stringify(i)),this.get(11).updateConvGroupProfile(t))}},{key:"getMyNameCardByGroupID",value:function(t){return t=this.getLocalGroupProfile(t),t?t.selfInfo.nameCard:""}},{key:"isPagingGetCompleted",value:function(){return this._commonGroupHandler.isPagingGetCompleted()}},{key:"getMsgRemindType",value:function(t){var o=this;return!ye(t)||t.length===0?Promise.resolve():(t=t.filter(function(i){return!Vt(o.getLocalGroupProfile(i).type)}),t.length===0?Promise.resolve():(E.l("".concat(this._n,".getMsgRemindType groupIDList:").concat(t)),this.getGroupProfileAdvance({groupIDList:t,responseFilter:{memberInfoFilter:["MsgFlag"]}}).then(function(s){var s=s.data.successGroupList,c=o.get(11);s.forEach(function(l){c.onGroupMsgRemindTypeUpdated({groupID:l.groupID,messageRemindType:ye(l.members)?l.members[0].messageRemindType:""})})})))}},{key:"getGroupList",value:function(){return this._commonGroupHandler.getGroupList()}},{key:"syncCommunityWithTopic",value:function(){return this._commonGroupHandler.syncGroupList(!0)}},{key:"getGroupProfile",value:function(t){var o=this,i="".concat(this._n,".").concat("getGroupProfile"),s=new ue("getGroupProfile"),c=t.groupID,l=t.groupCustomFieldFilter,l=(E.l("".concat(i," groupID:").concat(c)),{groupIDList:[c],responseFilter:{groupBaseInfoFilter:re(qn),groupCustomFieldFilter:l,memberInfoFilter:[].concat(re(nt),["NameCard"])}});return this.getGroupProfileAdvance(l).then(function(I){var I=I.data,m=I.successGroupList,I=I.failureGroupList;return E.l("".concat(i," ok")),0<I.length?W(I[0]):((I=Vt(m[0].type)&&!o.hasLocalGroup(c)?new Go(m[0]):(o.updateGroupMap(m),o.getLocalGroupProfile(c))).isSupportTopic||o.get(11).updateConvGroupProfile([I]),s.setMessage("groupID:".concat(c," type:").concat(I.type," muteAllMembers:").concat(I.muteAllMembers," ownerID:").concat(I.ownerID)).end(),Ae({group:I}))}).catch(function(p){return s.setError(p).setMessage("groupID:".concat(t.groupID)).end(),E.e("".concat(i," failed. error:"),p),W(p)})}},{key:"getGroupProfileAdvance",value:function(t){var o,i="".concat(this._n,".getGroupProfileAdvance"),l=t.groupIDList,s=(ye(l)&&50<l.length&&(this.warn("GetGroupProfileLimit"),l.length=50),[]),c=[],l=(l.forEach(function(p){(bt({groupID:p})?c:s).push(p)}),[]);return 0<s.length&&(o=this._getGroupProfileAdvance(v(v({},t),{},{groupIDList:s})),l.push(o)),0<c.length&&(o=this._getGroupProfileAdvance(v(v({},t),{},{groupIDList:c,relayFlag:0<s.length})),l.push(o)),Promise.all(l).then(function(p){var m=[],I=[];return p.forEach(function(C){m.push.apply(m,re(C.successGroupList)),I.push.apply(I,re(C.failureGroupList))}),Ae({successGroupList:m,failureGroupList:I})}).catch(function(p){return E.e("".concat(i," failed. error:"),p),W(p)})}},{key:"_getGroupProfileAdvance",value:function(t){var o=this,i=t.relayFlag,s=i!==void 0&&i,c=ae(t,dd);return this.req({P:P.GET_GRP_PROFILE,data:c}).then(function(l){return E.l("".concat(o._n,"._getGroupProfileAdvance ok. options:"),c),l=l.data.groups,{successGroupList:l.filter(function(p){return q(p.errorCode)||p.errorCode===0}),failureGroupList:l.filter(function(p){return p.errorCode&&p.errorCode!==0}).map(function(p){return new Gt({code:p.errorCode,message:p.errorInfo,data:{groupID:p.groupID}})})}}).catch(function(l){return s&&bt({groupID:t.groupIDList[0]})?{successGroupList:[],failureGroupList:[]}:W(l)})}},{key:"createGroup",value:function(t){var o=this,i=[O.GRP_PUBLIC,O.GRP_WORK,O.GRP_MEETING,O.GRP_AVCHATROOM,O.GRP_COMMUNITY],s="".concat(this._n,".").concat("createGroup"),c=t.type,l=t.groupID;if(t.name&&this._filterProfanity("name",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.introduction&&this._filterProfanity("introduction",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.notification&&this._filterProfanity("notification",t)===!1)return W({code:Q.PROFANITY_FOUND});if(!i.includes(c))return W({code:Q.ILLEGAL_GRP_TYPE});if(!bt({type:c})){if(!Te(l)&&bt({groupID:l}))return W({code:Q.ILLEGAL_GRP_ID});t.isSupportTopic=void 0}if(Vt(c)&&!q(t.memberList)&&0<t.memberList.length&&(t.memberList=void 0),this._canIUseJoinOption(c)||q(t.joinOption)||(t.joinOption=void 0),bt({type:c})){if(!Te(l)&&!bt({groupID:l}))return W({code:Q.ILLEGAL_GRP_ID});t.isSupportTopic=t.isSupportTopic===!0?1:0}var p=new ue("createGroup"),m=(E.l("".concat(s," options:"),t),null),I=[];return this.req({P:P.CREATE_GRP,data:v(v({},t),{},{ownerID:this.getMyUserID(),webPushFlag:1})}).then(function(G){var G=G.data,S=G.groupID,G=G.overLimitUserIDList,k=G===void 0?[]:G,G=(m=S,I=k,"groupType:".concat(t.type," groupID:").concat(S," overLimitUserIDList:").concat(k));if(p.setMessage(G).end(),E.l("".concat(s," ok. ").concat(G)),t.type===O.GRP_AVCHATROOM)return o.getGroupProfile({groupID:S});if(t.type===O.GRP_COMMUNITY&&t.isSupportTopic===1)return o.getGroupProfile({groupID:S});Te(t.memberList)||Te(k)||(t.memberList=t.memberList.filter(function($){return k.indexOf($.userID)===-1})),o.updateGroupMap([v(v({},t),{},{groupID:S})]);var G=o.get(2),Z="",U=0,Y=(t.type===O.GRP_COMMUNITY?(Z=o.isIntl()?"Create Community":"\u521B\u5EFA\u793E\u7FA4",U=1):Z=o.isIntl()?"Create Group":"\u521B\u5EFA\u7FA4\u7EC4",o.get(4).getMyNick()),Z=G.createCustomMessage({to:S,conversationType:O.CONV_GROUP,payload:{data:JSON.stringify({businessID:"group_create",content:Z,cmd:U,opUser:Y||o.getMyUserID(),version:4})}});return G.sendMessageInstance(Z),o.emitGroupListUpdate(),o.getGroupProfile({groupID:S})}).then(function(S){var S=S.data.group,G=S.selfInfo,k=G.nameCard,G=G.joinTime;return S.updateSelfInfo({nameCard:k,joinTime:G,messageRemindType:O.MSG_REMIND_ACPT_AND_NOTE,role:O.GRP_MBR_ROLE_OWNER}),Ae({group:S,overLimitUserIDList:I})}).catch(function(C){var S;return p.setMessage("groupType:".concat(t.type)).setError(C).end(),C.code===10010||C.code===10007?(o._silentlyGetGroupProfile(C.code,m),o.updateGroupMap([v(v({},t),{},{groupID:m})]),(S=o.getLocalGroupProfile(m)).selfInfo.role=O.GRP_MBR_ROLE_OWNER,Ae({group:S,overLimitUserIDList:I})):(E.e("".concat(s," failed. error:"),C),W(C))})}},{key:"dismissGroup",value:function(t){var o=this,i="".concat(this._n,".").concat("dismissGroup"),s="groupID:".concat(t),c=new ue("dismissGroup");return c.setMessage(s),E.l("".concat(i," ").concat(s)),this.req({P:P.DISMISS_GRP,data:{groupID:t}}).then(function(){return c.end(),E.l("".concat(i," ok")),o.deleteLocalGroupAndConversation(t),o.checkJoinedAVChatRoomByID(t)&&o._AVChatRoomHandler.reset(t),o._groupAttributesHandler.deleteLocalGroupAttributes(t),Ae({groupID:t})}).catch(function(l){return c.setError(l).end(),E.e("".concat(i," failed. error:"),l),W(l)})}},{key:"updateGroupProfile",value:function(t){var o,i=this,s="".concat(this._n,".").concat("updateGroupProfile");if(this.hasLocalGroup(t.groupID)&&(o=this.getLocalGroupProfile(t.groupID).type,this._canIUseJoinOption(o)||q(t.joinOption)||(E.w("".concat(s," joinOption is unavailable for Work/Meeting/AVChatRoom")),t.joinOption=void 0)),q(t.muteAllMembers)||(t.muteAllMembers?t.muteAllMembers="On":t.muteAllMembers="Off"),t.name&&this._filterProfanity("name",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.introduction&&this._filterProfanity("introduction",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.notification&&this._filterProfanity("notification",t)===!1)return W({code:Q.PROFANITY_FOUND});var c=new ue("updateGroupProfile");return c.setMessage(JSON.stringify(t)),E.l("".concat(s," groupID:").concat(t.groupID)),this.req({P:P.UPDATE_GRP_PROFILE,data:t}).then(function(){return c.end(),E.l("".concat(s," ok")),i.hasLocalGroup(t.groupID)&&i.groupMap.get(t.groupID).updateGroup(t),Ae({group:i.groupMap.get(t.groupID)})}).catch(function(l){return c.setError(l).end(),E.l("".concat(s," failed. error:"),l),W(l)})}},{key:"_filterProfanity",value:function(t,o){var s=this.get(29);if(!s)return!0;var s=s.filterText(o[t],At),i=s.isAllowedToSend,s=s.modifiedText;return i===!0&&(o[t]=s,!0)}},{key:"joinGroup",value:function(t){var o=this,i=t.groupID,s="".concat(this._n,".joinGroup");if(this.deleteUnjoinedAVChatRoom(i),this.hasLocalGroup(i)){if(!this.isLoggedIn())return we({status:O.JOIN_STATUS_ALREADY_IN_GROUP});var c=new ue("applyJoinGroup");return this.getGroupProfile({groupID:i}).then(function(){return c.setMessage("groupID:".concat(i," joinedStatus:").concat(O.JOIN_STATUS_ALREADY_IN_GROUP)).end(),we({status:O.JOIN_STATUS_ALREADY_IN_GROUP})}).catch(function(l){return c.setMessage("groupID:".concat(i," unjoined")).end(),E.w("".concat(s," ").concat(i," was unjoined, now join!")),o.groupMap.delete(i),o.applyJoinGroup(t)})}return E.l("".concat(s," groupID:").concat(i)),this.isLoggedIn()?this.applyJoinGroup(t):this._AVChatRoomHandler.joinWithoutAuth(t)}},{key:"applyJoinGroup",value:function(l){var o=this,i="".concat(this._n,".").concat("applyJoinGroup"),s=l.groupID;if(!Te(l.applyMessage)&&this._filterProfanity("applyMessage",l)===!1)return W({code:Q.PROFANITY_FOUND});var c=new ue("applyJoinGroup"),l=v({},l),p=this.canIUse(Ue.AV_HISTORY_MSG);return p&&(l.historyMessageFlag=1),this.get(11).deleteTopicRoamingInfo(s),this.req({P:P.APPLY_JOIN_GRP,data:l}).then(function(Y){var Y=Y.data,I=Y.joinedStatus,C=Y.longPollingKey,S=Y.startSeq,k=Y.avChatRoomFlag,G=Y.avChatRoomKey,U=Y.messageList,Y="groupID:".concat(s," joinedStatus:").concat(I," longPollingKey:").concat(C," startSeq:").concat(S)+" avChatRoomFlag:".concat(k," canGetAVChatRoomHistoryMsg:").concat(p,",")+" historyMsgCount:".concat(Te(U)?0:U.length);switch(c.setMessage(Y).end(),E.l("".concat(i," ok. ").concat(Y)),I){case pi:return Ae({status:pi});case di:return o.getGroupProfile({groupID:s}).then(function($){return $=$.data.group,o._handleJoinResult({group:$,avChatRoomFlag:k,longPollingKey:C,startSeq:S,avChatRoomKey:G,messageList:U})}).catch(function($){var De;return $.code===10010||$.code===10007?(o._silentlyGetGroupProfile($.code,s),De=new Go({groupID:s}),o.updateGroupMap([De]),o._handleJoinResult({group:De,avChatRoomFlag:k,longPollingKey:C,startSeq:S,avChatRoomKey:G,messageList:U})):(E.e("".concat(i," failed. error:"),$),W($))});default:var Z=new Gt({code:Q.JOIN_GRP_FAIL});return E.e("".concat(i," failed. error:"),Z),W(Z)}}).catch(function(m){return c.setMessage("groupID:".concat(s)).setError(m).end(),E.e("".concat(i," failed. error:"),m),W(m)})}},{key:"_handleJoinResult",value:function(t){var o=this,i=t.group,s=t.avChatRoomFlag,c=t.longPollingKey,l=t.startSeq,p=t.avChatRoomKey,m=t.messageList,I=i.groupID;return s===1?(this.get(11).setCompleted("".concat(O.CONV_GROUP).concat(I)),this._groupAttributesHandler.initGroupAttributesCache({groupID:I,avChatRoomKey:p}),this._groupCountersHandler.initGroupCountersCache({groupID:I,avChatRoomKey:p}),(t=q(c)?this._AVChatRoomHandler.handleJoinResult({group:i}):this._AVChatRoomHandler.startRunLoop({group:i,longPollingKey:c,startSeq:l})).then(function(){o._onAVChatRoomHistoryMessage(m,I)}),t):(this.emitGroupListUpdate(!0,!1),Ae({status:di,group:i}))}},{key:"quitGroup",value:function(t){var o=this,i="".concat(this._n,".").concat("quitGroup"),s="groupID:".concat(t),c=(E.l("".concat(i," ").concat(s)),this.checkJoinedAVChatRoomByID(t));if(!c&&!this.hasLocalGroup(t))return W({code:Q.MEMBER_NOT_IN_GRP});if(c&&!this.isLoggedIn())return E.l("".concat(i," anonymously ok. ").concat(s)),this.deleteLocalGroupAndConversation(t),this._AVChatRoomHandler.reset(t),we({groupID:t});var l=new ue("quitGroup");return l.setMessage(s),this.req({P:P.QUIT_GRP,data:{groupID:t}}).then(function(){return l.end(),E.l("".concat(i," ok")),o.deleteLocalGroupAndConversation(t),c&&o._AVChatRoomHandler.reset(t),o._groupAttributesHandler.deleteLocalGroupAttributes(t),Ae({groupID:t})}).catch(function(p){return l.setError(p).end(),E.e("".concat(i," failed. error:"),p),W(p)})}},{key:"searchGroupByID",value:function(t){var o="".concat(this._n,".").concat("searchGroupByID"),i={groupIDList:[t]},s=new ue("searchGroupByID");return s.setMessage("groupID:".concat(t)),E.l("".concat(o," groupID:").concat(t)),this.req({P:P.SEARCH_GRP,data:i}).then(function(c){if(c=c.data.groupProfile,c[0].errorCode!==0)throw new Gt({code:c[0].errorCode,message:c[0].errorInfo});return s.end(),E.l("".concat(o," ok")),Ae({group:new Go(c[0])})}).catch(function(c){return s.setError(c).end(),E.w("".concat(o," failed. error:"),c),W(c)})}},{key:"changeGroupOwner",value:function(t){var o=this,i="".concat(this._n,".").concat("changeGroupOwner");if(this.hasLocalGroup(t.groupID)&&this.getLocalGroupProfile(t.groupID).type===O.GRP_AVCHATROOM)return W({code:Q.CANNOT_CHANGE_OWNER_IN_AV});if(t.newOwnerID===this.getMyUserID())return W({code:Q.CANNOT_CHANGE_OWNER_TO_SELF});var s=new ue("changeGroupOwner");return s.setMessage("groupID:".concat(t.groupID," newOwnerID:").concat(t.newOwnerID)),E.l("".concat(i," groupID:").concat(t.groupID)),this.req({P:P.CHANGE_GRP_OWNER,data:t}).then(function(){s.end(),E.l("".concat(i," ok"));var c,l=t.groupID,p=t.newOwnerID,m=(o.groupMap.get(l).ownerID=p,o._groupMemberHandler.getLocalGroupMemberList(l));return m instanceof Map&&(c=m.get(o.getMyUserID()),q(c)||(c.updateRole("Member"),o.groupMap.get(l).selfInfo.role="Member"),c=m.get(p),q(c)||c.updateRole("Owner")),o.emitGroupListUpdate(!0,!1),Ae({group:o.groupMap.get(l)})}).catch(function(c){return s.setError(c).end(),E.e("".concat(i," failed. error:"),c),W(c)})}},{key:"getGroupApplicationList",value:function(){return this._groupSystemNoticeHandler.getGroupApplicationList()}},{key:"handleGroupApplication",value:function(t){var o,i,s,c,l,p=this,m="".concat(this._n,".").concat("handleGroupApplication"),I=t.handleAction,C=t.handleMessage,S=t.message,k=t.application,G=(S?(o=S.payload.operatorID,i=S.payload.groupProfile.groupID,s=S.payload.authentication,c=S.payload.messageKey):k&&(o=k.applicant,i=k.groupID,s=k.authentication,c=k.messageKey),P.HANDLE_GRP_APPLICATION),U=(k&&k.applicationType===2&&(G=P.HANDLE_INVITE_JOIN_GRP,l=k.userID),new ue("handleGroupApplication"));return U.setMessage("groupID:".concat(i)),E.l("".concat(m," groupID:").concat(i)),this.req({P:G,data:{handleAction:I,handleMessage:C,applicant:o,invitee:l,groupID:i,authentication:s,messageKey:c}}).then(function(){return U.end(),E.l("".concat(m," ok")),S&&p._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[t.message]}),Ae({group:p.getLocalGroupProfile(i)})}).catch(function(Y){return U.setError(Y).end(),E.e("".concat(m," failed. error"),Y),W(Y)})}},{key:"handleGroupInvitation",value:function(t){var o=this,i="".concat(this._n,".").concat("handleGroupInvitation"),p=t.message.payload,s=p.groupProfile.groupID,c=p.authentication,l=p.messageKey,p=p.operatorID,m=t.handleAction,I=new ue("handleGroupInvitation");return I.setMessage("groupID:".concat(s," inviter:").concat(p," handleAction:").concat(m)),E.l("".concat(i," groupID:").concat(s," inviter:").concat(p," handleAction:").concat(m)),this.req({P:P.HANDLE_GRP_INVITATION,data:v(v({},t),{},{inviter:p,groupID:s,authentication:c,messageKey:l})}).then(function(){return I.end(),E.l("".concat(i," ok")),o._groupSystemNoticeHandler.deleteGroupSystemNotice({messageList:[t.message]}),Ae({group:o.getLocalGroupProfile(s)})}).catch(function(C){return I.setError(C).end(),E.e("".concat(i," failed. error"),C),W(C)})}},{key:"getGroupOnlineMemberCount",value:function(t){var o=this,i="".concat(this._n,".getGroupOnlineMemberCount"),s=this._AVChatRoomHandler.checkJoinedAVChatRoomByID(t),c=this.hasLocalGroup(t);if(E.l("".concat(i," groupID:").concat(t," isAVChatRoom:").concat(s," has:").concat(c)),s)return this._AVChatRoomHandler.getGroupOnlineMemberCount(t);if(!c)return we({memberCount:0});if(s=Date.now(),this._onlineMemberCountMap.has(t)){if(c=this._onlineMemberCountMap.get(t),s-c.lastReqTime<=6e4)return we({memberCount:c.memberCount});c.lastReqTime=s}return this.requestOnlineCount(t).then(function(l){return l=l.data.memberCount,l=l===void 0?0:l,o._onlineMemberCountMap.set(t,{lastReqTime:Date.now(),memberCount:l}),E.l("".concat(i," ok. groupID:").concat(t," memberCount:").concat(l)),we({memberCount:l})}).catch(function(l){return E.w("".concat(i," failed. error:"),l),Promise.reject(l)})}},{key:"requestOnlineCount",value:function(t){return this.req({P:P.GET_ONLINE_MBR_NUM,data:{groupID:t}})}},{key:"hasLocalGroup",value:function(t){return this.groupMap.has(t)}},{key:"deleteLocalGroupAndConversation",value:function(t){var o,i=this.checkJoinedAVChatRoomByID(t),s=(E.l("".concat(this._n,".deleteLocalGroupAndConversation groupID:").concat(t," isJoinedAVChatRoom:").concat(i)),this.get(11)),c="".concat(O.CONV_GROUP).concat(t);i&&(this.stopMessageLongPolling({groupID:t}),s.deleteLocalConv(c)),bt({groupID:t})&&(o=this.getLocalGroupProfile(t))&&o.isSupportTopic===!0&&this.get(10).deleteTopicListInCommunity(t),s.clearUnreadCount(c),s.setCompleted(c),this._deleteLocalGroup(t),this._onlineMemberCountMap.delete(t),this.emitGroupListUpdate(!0,!1)}},{key:"_deleteLocalGroup",value:function(t){this.groupMap.delete(t),this._groupMemberHandler.deleteGroupMemberList(t)}},{key:"sendMessage",value:function(t,o){return ye(t._receiverList)&&0<t._receiverList.length&&!this.canIUse(Ue.MSG_TO_SPECIFIED_GRP_MBR)?this.noUse("Targeted Group Message"):(t=this.createGroupMessagePack(t,o),this.req(t))}},{key:"createGroupMessagePack",value:function(t,o){var i=null,s=(o&&o.offlinePushInfo&&(i=o.offlinePushInfo),""),c=(Ee(t.cloudCustomData)&&0<t.cloudCustomData.length&&(s=t.cloudCustomData),[]),l=(It(o)&&It(o.messageControlInfo)&&(l=(C=o.messageControlInfo).excludedFromUnreadCount,p=C.excludedFromLastMessage,C=C.excludedFromContentModeration,l===!0&&c.push("NoUnread"),p===!0&&c.push("NoLastMsg"),C===!0&&c.push("NoMsgCheck")),void 0),p=(ye(t._receiverList)&&0<t._receiverList.length&&(l=t._receiverList,50<t._receiverList.length&&(l=t._receiverList.slice(0,50),this.warn("ReceiverListLimit"))),this.isOnlineMessage(t,o)?1:0),C=JSON.parse(JSON.stringify(t.getElements())),m=this.get(17).getFileDNList(),I=t.getGroupAtInfoList(),C={fromAccount:this.getMyUserID(),groupID:t.to,msgBody:za(t.type,C,m),cloudCustomData:s,random:t.random,priority:t.priority,clientSequence:t.clientSequence,groupAtInfo:t.type!==O.MSG_TEXT||Te(I)?void 0:I,onlineOnlyFlag:p,clientTime:t.clientTime,offlinePushInfo:cs(i),messageControlInfo:p==0?c:void 0,needReadReceipt:t.needReadReceipt!==!0||this.isMessageFromOrToAVChatroom(t.to)?0:1,receiverList:l,isSupportExtension:t.isSupportExtension===!0?1:0,isRelayMessage:t._relayFlag===!0?1:0,cmConfigID:t._cmConfigID,forbidCallbackControl:lr(o)};return Lt(t.to)&&(C.groupID=un(t.to),C.topicID=t.to),{P:P.SEND_GRP_MSG,data:C}}},{key:"revokeMessage",value:function(t){var o={groupID:t.to,msgSeqList:[{msgSeq:t.sequence}]};return Lt(t.to)&&(o.groupID=un(t.to),o.topicID=t.to),this.req({P:P.REVOKE_GRP_MSG,data:o})}},{key:"deleteMessage",value:function(i){var o=i.to,i=i.keyList,i=(E.l("".concat(this._n,".deleteMessage groupID:").concat(o," count:").concat(i.length)),{groupID:o,deleter:this.getMyUserID(),keyList:i});return Lt(o)&&(i.groupID=un(o),i.topicID=o),this.req({P:P.DEL_GRP_MSG,data:i})}},{key:"modifyRemoteMessage",value:function(p){var C=p.to,o=p.sequence,i=p.payload,s=p.type,c=p.version,c=c===void 0?0:c,l=p.cloudCustomData,p=p._elements,m=C,I=void 0,C=(Lt(C)&&(m=un(C),I=C),void 0);return Fa(s)&&(1<p.length&&p.splice(0,1,{type:s,content:i}),C=p),this.req({P:P.MODIFY_GRP_MSG,data:{groupID:m,topicID:I,sequence:o,version:c,elements:C,cloudCustomData:l}})}},{key:"getRoamingMessage",value:function(l){var o=this,i="".concat(this._n,".").concat("getRoamingMessage"),s=l.conversationID,c=l.groupID,l=l.sequence,p=new ue("getRoamingMessage"),m=0,I=void 0;return Lt(c)&&(c=un(I=c)),this._computeLastSequence({groupID:c,topicID:I,sequence:l}).then(function(C){return m=C,E.l("".concat(i," groupID:").concat(c," startSequence:").concat(m)),o.req({P:P.GET_GRP_ROAMING_MSG,data:{groupID:c,count:21,sequence:m,topicID:I}})}).then(function(G){var k=G.data,$=k.messageList,S=k.complete,k=k.invisibleSequenceList,k=k===void 0?[]:k,G=G.data.nextSequence,G=G===void 0?0:G,U=(q($)?E.l("".concat(i," ok. complete:").concat(S," nextSequence:").concat(G," but messageList is undefined!")):E.l("".concat(i," ok. complete:").concat(S," nextSequence:").concat(G," count:").concat($.length)),p.setMessage("groupID:".concat(c," topicID:").concat(I," startSequence:").concat(m," complete:").concat(S," nextSequence:").concat(G)).end(),o.get(11)),Y=[],Z=[],$=(Te($)||(Y=U.onRoamingMessage($,s,!0,Z),U.updateIsRead(s),U.patchConvLastMessage(s)),S===2||G<1);return $&&(U.setCompleted(s),G=""),E.l("".concat(i," isPullingCompleted:").concat($," nextReqID:").concat(G," storedMsgCount:").concat(Y.length)+" invisibleSeqCount:".concat(k.length)),{nextReqID:G+"",storedMessageList:Y,assembledMessageList:Z,isPullingCompleted:$}}).catch(function(C){return p.setError(C).setMessage("groupID:".concat(c," topicID:").concat(I," startSequence:").concat(m)).end(),E.w("".concat(i," failed. error:"),C),W(C)})}},{key:"_getGroupIDOfMessage",value:function(t){return t.conversationID.replace(O.CONV_GROUP,"")}},{key:"getReadReceiptList",value:function(t){var o="".concat(this._n,".").concat("getReadReceiptList"),i=this._getGroupIDOfMessage(t[0]),s=this.getMyUserID(),c=t.filter(function(p){return p.from===s&&p.needReadReceipt===!0}).map(function(p){return{sequence:p.sequence}});if(E.l("".concat(o," groupID:").concat(i," sequenceList:").concat(JSON.stringify(c))),c.length===0)return we({messageList:t});var l=new ue("getReadReceiptList");return l.setMessage("groupID:".concat(i)),this.req({P:P.GET_READ_RECEIPT,data:{groupID:i,sequenceList:c}}).then(function(p){return l.end(),E.l("".concat(o," ok")),p=p.data.readReceiptList,ye(p)&&p.forEach(function(m){t.forEach(function(I){m.code===0&&m.sequence===I.sequence&&(I.readReceiptInfo.readCount=m.readCount,I.readReceiptInfo.unreadCount=m.unreadCount)})}),Ae({messageList:t})}).catch(function(p){return l.setError(p).end(),E.w("".concat(o," failed. error:"),p),W(p)})}},{key:"sendReadReceipt",value:function(l){var o="".concat(this._n,".").concat("sendReadReceipt"),i=this._getGroupIDOfMessage(l[0]),s=new ue("sendReadReceipt"),c=(s.setMessage("groupID:".concat(i)),this.getMyUserID()),l=l.filter(function(p){return p.from!==c&&p.needReadReceipt===!0}).map(function(p){return{sequence:p.sequence}});return l.length===0?W({code:Q.READ_RECEIPT_MSG_LIST_EMPTY}):(E.l("".concat(o,". sequenceList:").concat(JSON.stringify(l))),this.req({P:P.SEND_READ_RECEIPT,data:{groupID:i,sequenceList:l}}).then(function(p){return s.end(),E.l("".concat(o," ok")),Ae()}).catch(function(p){return s.setError(p).end(),E.w("".concat(o," failed. error:"),p),W(p)}))}},{key:"getReadReceiptDetail",value:function(S){var o=this,c=S.message,I=S.filter,C=S.cursor,S=S.count,i=this._getGroupIDOfMessage(c),s=c.ID,c=c.sequence,l="".concat(this._n,".").concat("getReadReceiptDetail"),p=this._receiptDetailCompleteMap.get(s)||!1,m=I!==0&&I!==1?0:I,I=Ee(C)?C:"",C=!ut(S)||S<=0||100<=S?100:S,S="groupID:".concat(i," sequence:").concat(c," cursor:").concat(I," filter:").concat(m," completeFlag:").concat(p),k=(E.l("".concat(l," ").concat(S)),{cursor:"",isCompleted:!1,messageID:s,unreadUserIDList:[],readUserIDList:[]}),G=new ue("getReadReceiptDetail");return G.setMessage(S),this.req({P:P.GET_READ_RECEIPT_DETAIL,data:{groupID:i,sequence:c,flag:m,cursor:I,count:C}}).then(function(De){G.end();var De=De.data,Y=De.cursor,Z=De.isCompleted,$=De.unreadUserIDList,De=De.readUserIDList;return k.cursor=Y,Z===1&&(k.isCompleted=!0,o._receiptDetailCompleteMap.set(s,!0)),m===0?k.readUserIDList=De.map(function(_e){return _e.userID}):m===1&&(k.unreadUserIDList=$.map(function(_e){return _e.userID})),E.l("".concat(l," ok")),Ae(k)}).catch(function(U){return G.setError(U).end(),E.w("".concat(l," failed. error:"),U),W(U)})}},{key:"getRoamingMessagesHopping",value:function(t){var o=this,i="".concat(this._n,".").concat("getRoamingMessagesHopping"),s=t.groupID,c=t.count,l=t.sequence,p=t.direction,m=void 0;return q(l)&&p===1?we({messageList:[],isCompleted:!0,nextMessageSeq:""}):(Lt(s)&&(s=un(m=s)),this._computeReqSeqHopping({groupID:s,topicID:m,sequence:l}).then(function(I){q(l)||p!==1||(I=l+c-1);var C="".concat(m?"topicID:".concat(m):"groupID:".concat(s)," sequence:").concat(l," reqSeq:").concat(I," direction:").concat(p),S=(E.l("".concat(i," ").concat(C)),new ue("getRoamingMessagesHopping"));return o.req({P:P.GET_GRP_ROAMING_MSG,data:{groupID:s,topicID:m,count:c,sequence:I}}).then(function(Y){var Y=Y.data,De=Y.messageList,De=De===void 0?[]:De,G=Y.complete,U=Y.nextSequence,U=U===void 0?0:U,Y=Y.invisibleSequenceList,Y=Y===void 0?[]:Y,$="complete:".concat(G," nextSequence:").concat(U," remoteMsgCount:").concat(De.length," invisibleSequenceList:").concat(Y),$=(S.setMessage("".concat(C," ").concat($)).end(),E.l("".concat(i," ok. ").concat($)),"".concat(O.CONV_GROUP).concat(t.groupID)),Z=o.get(11),$=Z.onRoamingMessage(De,$,!1),De=o._computeResult({groupID:t.groupID,direction:p,sequence:l,remoteMessageList:De,processedMessageList:$,complete:G,nextSequence:U,invisibleSequenceList:Y});return Z.storeHoppingMessageList(De.messageList),Ae(De)}).catch(function(k){return S.setError(k).setMessage("groupID:".concat(s," sequence:").concat(l," count:").concat(c)).end(),E.w("".concat(i," failed. error:"),k),W(k)})}))}},{key:"_computeReqSeqHopping",value:function(c){var o=this,i=c.groupID,s=c.topicID,s=s===void 0?void 0:s,c=c.sequence,c=c===void 0?void 0:c;return 0<c?Promise.resolve(c):q(s)?this.getGroupProfileAdvance({groupIDList:[i],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then(function(p){var p=p.data.successGroupList,m=0;return Te(p)||(m=p[0].nextMessageSeq-1),E.l("".concat(o._n,"._computeReqSeqHopping groupID:").concat(i," lastSequence:").concat(m," from remote")),m}).catch(function(l){return W(l)}):Promise.resolve(0)}},{key:"_computeResult",value:function(C){var o={messageList:[],isCompleted:!1,nextMessageSeq:""},i=C.groupID,s=C.direction,c=C.sequence,l=C.remoteMessageList,l=l===void 0?[]:l,p=C.processedMessageList,p=p===void 0?[]:p,m=C.complete,I=C.nextSequence,C=C.invisibleSequenceList;if(s===0)return o.nextMessageSeq=I,(m===2||I<1)&&(o.isCompleted=!0,o.nextMessageSeq=""),o.messageList=p,o;if(s===1){if(Te(l)){if(Te(C))return o.isCompleted=!0,o.nextMessageSeq="",o;o.nextMessageSeq=C[0]+1}else m=l[0].sequence,I=C[0]||0,o.nextMessageSeq=I<m?m+1:I+1;return p.forEach(function(S){S.sequence>=c&&o.messageList.push(S)}),(bt({groupID:i})||Lt(i))&&o.messageList.length===0&&l[0].sequence<c&&(o.isCompleted=!0,o.nextMessageSeq=""),o}}},{key:"setMessageRead",value:function(l){var o=this,i=l.conversationID,s=l.lastMessageSeq,c="".concat(this._n,".").concat("setMessageRead"),l="convID:".concat(i," lastMessageSeq:").concat(s),p=(E.l("".concat(c," ").concat(l)),ut(s)||this.warn("DoNotModifyLastSeq"),new ue("setMessageRead")),m=(p.setMessage(l),i.replace(O.CONV_GROUP,"")),I=void 0;return Lt(m)&&(m=un(I=m)),this.req({P:P.SET_GRP_MSG_READ,data:{groupID:m,topicID:I,messageReadSeq:s}}).then(function(){p.end(),E.l("".concat(c," ok"));var C,S=o.get(11),k=(S.updateIsReadAfterReadReport({conversationID:i,lastMessageSeq:s}),!0);return q(I)||(k=!1,(C=o.get(10).getLocalTopic(m,I))&&C.updateSelfInfo({readedSequence:s})),S.updateUnreadCount(i,k),Ae()}).catch(function(C){return p.setError(C).end(),E.l("".concat(c," failed. error:"),C),W(C)})}},{key:"_computeLastSequence",value:function(s){var o=s.groupID,i=s.topicID,i=i===void 0?void 0:i,s=s.sequence;return 0<s?Promise.resolve(s):q(i)?this.getGroupLastSequence(o):Promise.resolve(0)}},{key:"getGroupLastSequence",value:function(t){var o="".concat(this._n,".").concat("getGroupLastSequence"),i=new ue("getGroupLastSequence"),s=0,c="",l="groupID:".concat(t);if(this.hasLocalGroup(t)){var p=this.getLocalGroupProfile(t),m=p.lastMessage;if(0<m.lastSequence&&m.onlineOnlyFlag===!1)return s=m.lastSequence,c="".concat(l,", ").concat(s," from group.lastMessage.lastSequence"),E.l("".concat(o," ").concat(c)),i.setMessage(c).end(),Promise.resolve(s);if(1<p.nextMessageSeq)return s=p.nextMessageSeq-1,c="".concat(l,", ").concat(s," from group.nextMessageSeq"),E.l("".concat(o," ").concat(c)),i.setMessage(c).end(),Promise.resolve(s)}return m=this.get(11).getLocalConversation("GROUP".concat(t)),m&&m.lastMessage.lastSequence&&m.lastMessage.onlineOnlyFlag===!1?(s=m.lastMessage.lastSequence,c="".concat(l,", ").concat(s," from conversation.lastMessage.lastSequence"),E.l("".concat(o," ").concat(c)),i.setMessage(c).end(),Promise.resolve(s)):this.getGroupProfileAdvance({groupIDList:[t],responseFilter:{groupBaseInfoFilter:["NextMsgSeq"]}}).then(function(I){return I=I.data.successGroupList,Te(I)?E.w("".concat(o," ").concat(l,", empty successGroupList")):(s=I[0].nextMessageSeq-1,c="".concat(l,", ").concat(s," from remote"),E.l("".concat(o," ").concat(c))),i.setMessage(c).end(),s}).catch(function(I){return i.setError(I).setMessage(l).end(),E.w("".concat(o," failed. error:"),I),W(I)})}},{key:"isMessageFromOrToAVChatroom",value:function(t){return this._AVChatRoomHandler.checkJoinedAVChatRoomByID(t)}},{key:"hasJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.hasJoinedAVChatRoom()}},{key:"getJoinedAVChatRoom",value:function(){return this._AVChatRoomHandler.getJoinedAVChatRoom()}},{key:"getGroupRemoteLastSeq",value:function(t){return t=this.getLocalGroupProfile(t),t?t.nextMessageSeq-1:1}},{key:"isOnlineMessage",value:function(t,o){return!(!this._canIUseOnlineOnlyFlag(t)||!o||o.onlineUserOnly!==!0)}},{key:"_canIUseOnlineOnlyFlag",value:function(t){var o=this.getJoinedAVChatRoom();return!o||!o.includes(t.to)||t.conversationType!==O.CONV_GROUP}},{key:"_onAVChatRoomHistoryMessage",value:function(t,o){var i;Te(t)||(E.l("".concat(this._n,"._onAVChatRoomHistoryMessage groupID:").concat(o," count:").concat(t.length)),i=[],t.forEach(function(s){i.push(v(v({},s),{},{isHistoryMessage:1}))}),this.onAVChatRoomMessage(i,o))}},{key:"onAVChatRoomMessage",value:function(t){this._AVChatRoomHandler.onMessage(t,1<arguments.length&&arguments[1]!==void 0?arguments[1]:"")}},{key:"onAVChatRoomMemberBanned",value:function(t){this._AVChatRoomHandler.onAVChatRoomMemberBanned(t)}},{key:"setUnjoinedAVChatRoom",value:function(t){this._unjoinedAVChatRoomList.set(t,1)}},{key:"deleteUnjoinedAVChatRoom",value:function(t){this._unjoinedAVChatRoomList.has(t)&&this._unjoinedAVChatRoomList.delete(t)}},{key:"isUnjoinedAVChatRoom",value:function(t){return this._unjoinedAVChatRoomList.has(t)}},{key:"isGroupAttributesUpdatedNotice",value:function(t){return this._groupAttributesHandler.isGroupAttributesUpdatedNotice(t)}},{key:"updateLocalMainSequenceOnReconnected",value:function(){this._groupAttributesHandler.updateLocalMainSequenceOnReconnected()}},{key:"initGroupAttributes",value:function(t){return this._groupAttributesHandler.initGroupAttributes(t)}},{key:"setGroupAttributes",value:function(t){return this._groupAttributesHandler.setGroupAttributes(t)}},{key:"deleteGroupAttributes",value:function(t){return this._groupAttributesHandler.deleteGroupAttributes(t)}},{key:"getGroupAttributes",value:function(t){return this._groupAttributesHandler.getGroupAttributes(t)}},{key:"isMessageFromTopic",value:function(t,o){return t===2&&!Te(o)}},{key:"isMessageFromCommunityOfTopic",value:function(t,o){return t===2&&Te(o)}},{key:"getMessageExtensions",value:function(t,o){return E.l("".concat(this._n,".getMessageExtensions startSequence:").concat(o)),this.req({P:P.GET_GRP_MSG_EXT,data:{groupID:t.to,messageSequence:t.sequence,startSequence:o}})}},{key:"modifyMsgExts",value:function(t,o){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1;return E.l("".concat(this._n,".modifyMsgExts operateType:").concat(i)),this.req({P:P.MODIFY_GRP_MSG_EXT,data:{groupID:t.to,messageSequence:t.sequence,extensionList:o,operateType:i}})}},{key:"_genNotifyReqList",value:function(t){for(var o,i,s,c,l=[],p=0,m=t.length;p<m;p++)o=t[p],c=this.getLocalGroupProfile(o).type,i=this._getGroupLastRevokedTime(o),s=1e3*no(),c={notifyType:1,limit:20,type:bt({type:c,groupID:o})?O.GRP_COMMUNITY:void 0,groupID:o,beginTime:i,endTime:s},l.push(c);return l}},{key:"getNotice",value:function(s){var o=this,i="".concat(this._n,".getNotice"),s=s.filter(function(p){if(!o.hasLocalGroup(p))return!1;var p=o.getLocalGroupProfile(p),l=p.type,p=p.isSupportTopic;return!Vt(l)&&!p});s.length!==0&&(E.l("".concat(i," list:").concat(s)),this.req({P:P.GET_GRP_NOTIFY,data:{notifyReqList:this._genNotifyReqList(s)}}).then(function(m){var l,p,m=m.data.notifyRspList,I=[];ye(m)&&(l={dataList:[]},p="".concat(i," ok."),m.forEach(function(C){var S=C.nextRevokedTime,k=C.groupID,G=C.notifyList;p+=" groupID:".concat(k," nextRevokedTime:").concat(S," count:").concat(G.length,`
`),l.dataList.push({elements:{revokedInfos:o._genRevokedInfos(C)}}),S!==0?(o._setGroupLastRevokedTime(k,S),I.push(k)):o._setGroupLastRevokedTime(k,1e3*no())}),E.l(p),o.onMsgRevoked(l,!1)),0<I.length&&o.getNotice(I)}).catch(function(c){E.e("".concat(i," failed. error:"),c)}))}},{key:"_genRevokedInfos",value:function(t){var o=t.notifyList,i=t.groupID,s=[];return ye(o)&&o.forEach(function(c){s.push({groupID:i,sequence:c.sequence,random:c.random,revokerInfo:v({},c.revokerInfo)})}),s}},{key:"_getGroupLastRevokedTime",value:function(t){return this.hasLocalGroup(t)?this.getLocalGroupProfile(t)._lastRevokedTime:0}},{key:"_setGroupLastRevokedTime",value:function(t,o){this.hasLocalGroup(t)&&(this.getLocalGroupProfile(t)._lastRevokedTime=o)}},{key:"isGroupCountersNotice",value:function(t){return this._groupCountersHandler.isGroupCountersNotice(t)}},{key:"setGroupCounters",value:function(t){return this._groupCountersHandler.setGroupCounters(t)}},{key:"increaseGroupCounter",value:function(t){return this._groupCountersHandler.increaseGroupCounter(t)}},{key:"decreaseGroupCounter",value:function(t){return this._groupCountersHandler.decreaseGroupCounter(t)}},{key:"getGroupCounters",value:function(t){return this._groupCountersHandler.getGroupCounters(t)}},{key:"getGroupMemberHandler",value:function(){return this._groupMemberHandler}},{key:"getGroupMemberList",value:function(t){return this._groupMemberHandler.getGroupMemberList(t)}},{key:"getGroupMemberProfile",value:function(t){return this._groupMemberHandler.getGroupMemberProfile(t)}},{key:"addGroupMember",value:function(t){return this._groupMemberHandler.addGroupMember(t)}},{key:"deleteGroupMember",value:function(t){return this._groupMemberHandler.deleteGroupMember(t)}},{key:"setGroupMemberMuteTime",value:function(t){return this._groupMemberHandler.setGroupMemberMuteTime(t)}},{key:"setGroupMemberRole",value:function(t){return this._groupMemberHandler.setGroupMemberRole(t)}},{key:"setGroupMemberNameCard",value:function(t){return this._groupMemberHandler.setGroupMemberNameCard(t)}},{key:"setGroupMemberCustomField",value:function(t){return this._groupMemberHandler.setGroupMemberCustomField(t)}},{key:"markGroupMemberList",value:function(t){return this._groupMemberHandler.markGroupMemberList(t)}},{key:"modifyGroupMemberInfo",value:function(t){return this._groupMemberHandler.modifyGroupMemberInfo(t)}},{key:"restartPolling",value:function(){this._AVChatRoomHandler.restartPolling()}},{key:"getPollingTimerID",value:function(t){if(!t)return-1;var o=this.getLocalGroupProfile(t);return o&&Vt(o.type)?this._AVChatRoomHandler.getPollingTimerID(t):-1}},{key:"_canIUseJoinOption",value:function(t){return t===O.GRP_PUBLIC||bt({type:t})}},{key:"_silentlyGetGroupProfile",value:function(t,o){var i=setTimeout(this.getGroupProfile.bind(this,{groupID:o}),3e3);this._timeoutIDs.push(i),E.l("".concat(this._n,"._silentlyGetGroupProfile errorCode:").concat(t," groupID:").concat(o," timeoutIDs:").concat(this._timeoutIDs))}},{key:"_clearTimeoutIDs",value:function(){this._timeoutIDs.forEach(function(t){t&&clearTimeout(t)}),this._timeoutIDs=[]}},{key:"startMessageLongPolling",value:function(s){var o=s.groupID,i=s.longPollingKey,s=s.longPollingSequence,s=s===void 0?1:s,l=this.get(12).isUnlimitedAVChatRoom(),c=(this._AVChatRoomHandler.hasPollingInstance(o)&&this.stopMessageLongPolling({groupID:o}),this._AVChatRoomHandler.getJoinedLiveList()),l=(!l&&0<c.length&&this.stopMessageLongPolling({groupID:c[0]}),new Go({groupID:o,type:O.GRP_LIVE}));return E.l("".concat(this._n,".startMessageLongPolling groupID:").concat(o," longPollingKey:").concat(i," longPollingSequence:").concat(s)),this._AVChatRoomHandler.startRunLoop({group:l,longPollingKey:i,startSeq:s})}},{key:"stopMessageLongPolling",value:function(o){var o=o.groupID,i=this.get(11);return this._AVChatRoomHandler.reset(o),this._deleteLocalGroup(o),i.deleteLocalConv("".concat(O.CONV_GROUP).concat(o)),E.l("".concat(this._n,".stopMessageLongPolling ok, groupID:").concat(o)),we({groupID:o})}},{key:"reset",value:function(){this.groupMap.clear(),this._unjoinedAVChatRoomList.clear(),this._receiptDetailCompleteMap.clear(),this._onlineMemberCountMap.clear(),this._commonGroupHandler.reset(),this._groupSystemNoticeHandler.reset(),this._groupTipsHandler.reset(),this._groupAttributesHandler.reset(),this._groupCountersHandler.reset(),this._AVChatRoomHandler.reset(),this._groupMemberHandler.reset(),this._clearTimeoutIDs()}}]),Ri),gd=["topicID","topicName","avatar","introduction","notification","unreadCount","muteAllMembers","customData","groupAtInfoList","nextMessageSeq","selfInfo"],hd=(V(vs,[{key:"_initTopic",value:function(t){for(var o in t)gd.indexOf(o)<0||(o==="selfInfo"?this.updateSelfInfo(t[o]):this[o]=o==="muteAllMembers"?t[o]===1:t[o])}},{key:"updateUnreadCount",value:function(){this.unreadCount=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0}},{key:"updateNextMessageSeq",value:function(t){this.nextMessageSeq=t}},{key:"updateLastMessage",value:function(t){this.lastMessage=Uu(t)}},{key:"updateGroupAtInfoList",value:function(t){this.groupAtInfoList=JSON.parse(JSON.stringify(t))}},{key:"updateTopic",value:function(t){q(t.selfInfo)||this.updateSelfInfo(t.selfInfo),q(t.muteAllMembers)||(this.muteAllMembers=t.muteAllMembers===1),Gn(this,t,["groupID","lastMessageTime","selfInfo","muteAllMembers","lastMsg"])}},{key:"updateSelfInfo",value:function(t){return Gn(this.selfInfo,t,[],[""])===0}},{key:"reduceUnreadCount",value:function(){return 1<=this.unreadCount&&(--this.unreadCount,!0)}},{key:"isLastMessageRevoked",value:function(t){return t.sequence===this.lastMessage.lastSequence}},{key:"setLastMessageRevoked",value:function(t){this.lastMessage.isRevoked=t}},{key:"setLastMessageRevoker",value:function(t){this.lastMessage.revoker=t}}]),vs),_d=(z(Ei,Ht),Po=J(Ei),V(Ei,[{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("topic_cache_time"),o=this.getCloudConfig("topic_last_active_time");q(t)||(this.TOPIC_CACHE_TIME=Number(t)),q(o)||(this.TOPIC_LAST_ACTIVE_TIME=Number(o))}},{key:"onTopicCreated",value:function(t){var o=t.groupID;this.resetGetTopicTime(o),this.emitOEvt(Me.TOPIC_CREATED,t)}},{key:"onTopicDeleted",value:function(t){var o=this,i=t.groupID,s=t.topicIDList;(s===void 0?[]:s).forEach(function(c){o._deleteLocalTopic(i,c)}),this.emitOEvt(Me.TOPIC_DELETED,t)}},{key:"onTopicProfileUpdated",value:function(t){var o=t.groupID,i=t.topicID,i=this.getLocalTopic(o,i);i&&(i.updateTopic(t),this.emitOEvt(Me.TOPIC_UPDATED,{groupID:o,topic:i}))}},{key:"onTopicLatestMsg",value:function(c){var o,i,c=c||{},s=c.topicLatestMessage,c=c.excludedUnreadSequenceList;Te(s)||(o=s.groupProfile.topicID,s.conversationType=O.CONV_GROUP,s.to=o,(i=new Mn(s)).setElement(s.elements),this.updateUnreadCountAndLastMsg(o,i,c))}},{key:"onMessageRemindTypeUpdated",value:function(c){var o,i=c.groupID,s=c.topicID,c=c.messageRemindType,l=this.getLocalTopic(i,s);l&&((o=l.updateSelfInfo({messageRemindType:c}))&&this.emitOEvt(Me.TOPIC_UPDATED,{groupID:i,topic:l}),E.l("".concat(this._n,".onMessageRemindTypeUpdated topicID:").concat(s," messageRemindType:").concat(c," isUpdated:").concat(o)))}},{key:"onAtInfoUpdated",value:function(o){var s=o.topicID,o=o.groupAtInfoList,i=un(s),s=this.getLocalTopic(i,s);s&&!q(o)&&(s.updateGroupAtInfoList(o),this.emitOEvt(Me.TOPIC_UPDATED,{groupID:i,topic:s}))}},{key:"onUnreadCountUpdatedFromConv",value:function(s){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:0,i=un(s),s=this.getLocalTopic(i,s);s&&s.unreadCount!==o&&(s.updateUnreadCount(o),o===0&&s.updateSelfInfo({readedSequence:s.lastMessage.lastSequence}),this.emitOEvt(Me.TOPIC_UPDATED,{groupID:i,topic:s}))}},{key:"onMessageSent",value:function(c){var o,i,s=c.groupID,l=c.topicID,c=c.lastMessage,l=this.getLocalTopic(s,l);!l||(i=(o=(o=c.sequence)===void 0?0:o)+1)>l.nextMessageSeq&&(l.updateNextMessageSeq(i),l.updateLastMessage(c),l.updateSelfInfo({readedSequence:o}),l.updateUnreadCount(0),this.emitOEvt(Me.TOPIC_UPDATED,{groupID:s,topic:l}))}},{key:"onMessageModified",value:function(t){var o,i=t.to,s=t.time,c=t.sequence,l=t.elements,p=t.cloudCustomData,m=t.messageVersion,I=un(i),C=this.getLocalTopic(I,i);C&&(o=C.lastMessage,E.d("".concat(this._n,".onMessageModified topicID:").concat(i," lastMessage:"),JSON.stringify(o),"options:",JSON.stringify(t)),o&&(o.payload===null||o.lastTime===s&&o.lastSequence===c&&o.version!==m)&&(o.type=l[0].type,o.payload=l[0].content,o.messageForShow=Qi(o.type,o.payload,this.isIntl()),o.cloudCustomData=p,o.version=m,o.lastSequence=c,o.lastTime=s,this.emitOEvt(Me.TOPIC_UPDATED,{groupID:I,topic:C})))}},{key:"onMessageRevoked",value:function(t){var o,i,s,c=this;t.length!==0&&(i=o=null,s=!1,t.forEach(function(l){var p=l.to;i=un(p),(o=c.getLocalTopic(i,p))&&(o.reduceUnreadCount()&&(s=!0),o.isLastMessageRevoked(l)&&(o.setLastMessageRevoked(!0),o.setLastMessageRevoker(l.revoker),s=!0),(p=o.selfInfo.excludedUnreadSequenceList||[]).push(l.sequence),o.updateSelfInfo({excludedUnreadSequenceList:p}))}),s&&this.emitOEvt(Me.TOPIC_UPDATED,{groupID:i,topic:o}))}},{key:"isLastMessageRevoked",value:function(o){var s=o.topicID,o=o.sequence,i=un(s),i=this.getLocalTopic(i,s),s=!1;return s=i?i.isLastMessageRevoked({sequence:o}):s}},{key:"updateUnreadCountAndLastMsg",value:function(t,o,i){var s,c=un(t),l=this.getLocalTopic(c,t);l&&(s=l.selfInfo.excludedUnreadSequenceList||[],q(i)||(s=i),o._isExcludedFromUnreadCount&&s.push(o.sequence),l.updateSelfInfo({excludedUnreadSequenceList:s}),E.l("".concat(this._n,".updateUnreadCountAndLastMsg seq:").concat(o.sequence," lastSeq:").concat(l.lastMessage.lastSequence)),o.sequence>l.lastMessage.lastSequence&&(l.updateLastMessage(o),i=o.sequence+1,l.updateNextMessageSeq(i),s=this._computeUnreadCount(l),l.updateUnreadCount(s),(o=this.get(11).getLocalConversation("".concat(O.CONV_GROUP).concat(t)))&&o.updateUnreadCount({nextUnreadCount:s,isFromGetConversations:!0}),this.emitOEvt(Me.TOPIC_UPDATED,{groupID:c,topic:l})))}},{key:"getJoinedCommunityList",value:function(){return this.get(7).syncCommunityWithTopic()}},{key:"createTopicInCommunity",value:function(t){var o=this,i="".concat(this._n,".").concat("createTopicInCommunity"),s=t.topicID;if(!q(s)&&!Lt(s))return W({code:Q.ILLEGAL_TOPIC_ID});if(t.topicName&&this._filterProfanity("topicName",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.introduction&&this._filterProfanity("introduction",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.notification&&this._filterProfanity("notification",t)===!1)return W({code:Q.PROFANITY_FOUND});var c=new ue("createTopicInCommunity");return this.req({P:P.CREATE_TOPIC,data:v({},t)}).then(function(l){return l=l.data.topicID,c.setMessage("topicID:".concat(l)).end(),E.l("".concat(i," ok. topicID:").concat(l)),o._updateTopicMap([v(v({},t),{},{topicID:l})]),Ae({topicID:l})}).catch(function(l){return c.setError(l).end(),E.e("".concat(i," failed. error:"),l),W(l)})}},{key:"deleteTopicFromCommunity",value:function(c){var o=this,i="".concat(this._n,".").concat("deleteTopicFromCommunity"),s=c.groupID,c=c.topicIDList,c=c===void 0?[]:c,l=new ue("deleteTopicFromCommunity");return l.setMessage("groupID:".concat(s," topicIDList:").concat(c)),this.req({P:P.DEL_TOPIC,data:{groupID:s,topicIDList:c}}).then(function(C){var C=C.data.resultList,m=[],I=[],C=((C===void 0?[]:C).forEach(function(U){var k=U.topicID,G=U.errorCode,U=U.errorInfo;G===0?m.push({topicID:k}):I.push({topicID:k,code:G,message:U})}),"success count:".concat(m.length,", fail count:").concat(I.length));return l.setMoreMessage(C).end(),E.l("".concat(i," ok. ").concat(C)),m.forEach(function(S){o._deleteLocalTopic(s,S.topicID)}),Ae({successTopicList:m,failureTopicList:I})}).catch(function(p){return l.setError(p).end(),E.e("".concat(i," failed. error:"),p),W(p)})}},{key:"updateTopicProfile",value:function(t){var o=this,i="".concat(this._n,".").concat("updateTopicProfile");if(E.l("".concat(i," options:"),t),t.topicName&&this._filterProfanity("topicName",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.introduction&&this._filterProfanity("introduction",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.notification&&this._filterProfanity("notification",t)===!1)return W({code:Q.PROFANITY_FOUND});var s=new ue("updateTopicProfile");return s.setMessage("groupID:".concat(t.groupID," topicID:").concat(t.topicID)),q(t.muteAllMembers)||(t.muteAllMembers=t.muteAllMembers===!0?"On":"Off"),this.req({P:P.UPDATE_TOPIC_PROFILE,data:v({},t)}).then(function(){return s.end(),E.l("".concat(i," ok")),o._updateTopicMap([t]),Ae({topic:o.getLocalTopic(t.groupID,t.topicID)})}).catch(function(c){return s.setError(c).end(),E.e("".concat(i," failed. error:"),c),W(c)})}},{key:"getTopicList",value:function(c){var o=this,i="".concat(this._n,".").concat("getTopicList"),s=c.groupID,c=c.topicIDList,c=c===void 0?[]:c,l=c.length===0,p=new ue("getTopicList");if(p.setMessage("groupID:".concat(s)),this._getTopicTimeMap.has(s)){var I=this._getTopicTimeMap.get(s),m=I.isGetAll,I=I.time;if((m||!m&&!l)&&Date.now()-I<1e3*this.TOPIC_CACHE_TIME&&(m=this._getLocalTopicList(s,c),l||m.length===c.length))return p.setMoreMessage("from cache, topic count:".concat(m.length)).end(),E.l("".concat(i," groupID:").concat(s," from cache, topic count:").concat(m.length)),we({successTopicList:m,failureTopicList:[]})}return this.req({P:P.GET_TOPIC_LIST,data:{groupID:s,topicIDList:c}}).then(function(U){var U=U.data.topicInfoList,S=[],k=[],G=[],U=((U===void 0?[]:U).forEach(function(_e){var Z=_e.topic,$=_e.selfInfo,De=_e.errorCode,_e=_e.errorInfo,Pe=Z.topicID;De===0?(S.push(v(v({},Z),{},{selfInfo:$})),k.push(Pe)):G.push({topicID:Pe,code:De,message:_e})}),o._updateTopicMap(S),o._handleTopicAtInfo(S),"success count:".concat(k.length,", fail count:").concat(G.length)),U=(p.setMoreMessage(U).end(),E.l("".concat(i," groupID:").concat(s," from remote, ").concat(U)),[]);return Te(k)||(o._getTopicTimeMap.set(s,{time:Date.now(),isGetAll:l}),U=o._getLocalTopicList(s,k)),Ae({successTopicList:U,failureTopicList:G})}).catch(function(C){return p.setError(C).end(),E.e("".concat(i," failed. error:"),C),W(C)})}},{key:"hasLocalTopic",value:function(t,o){return!!this._topicMap.has(t)&&this._topicMap.get(t).has(o)}},{key:"getLocalTopic",value:function(t,o){var i=null;return i=this._topicMap.has(t)?this._topicMap.get(t).get(o):i}},{key:"_getLocalTopicList",value:function(i){var o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:[],i=this._topicMap.get(i),s=[];return i&&(s=re(i.values())),o.length===0?s:s.filter(function(c){return o.includes(c.topicID)})}},{key:"_deleteLocalTopic",value:function(t,o){this._topicMap.has(t)&&this._topicMap.get(t).has(o)&&(this._topicMap.get(t).delete(o),E.l("".concat(this._n,"._deleteLocalTopic groupID:").concat(t," topicID:").concat(o)))}},{key:"_updateTopicMap",value:function(t){var o=this,i=[];t.forEach(function(m){var c=m.groupID,l=m.topicID,p=null,m=(o._topicMap.has(c)||o._topicMap.set(c,new Map),o._topicMap.get(c).has(l)?(p=o._topicMap.get(c).get(l)).updateTopic(m):(o._getTopicLastMessage(m),p=new hd(m,o.isIntl()),o._topicMap.get(c).set(l,p)),o._computeUnreadCount(p));p.updateUnreadCount(m),i.push({conversationID:"".concat(O.CONV_GROUP).concat(l),type:O.CONV_TOPIC,unreadCount:m})}),0<i.length&&this.get(11).updateTopicConversation(i)}},{key:"resetGetTopicTime",value:function(t){var o=this;q(t)?re(this._getTopicTimeMap.keys()).forEach(function(i){o._getTopicTimeMap.set(i,0)}):this._getTopicTimeMap.set(t,0)}},{key:"getTopicListOnReconnected",value:function(){var t=this,o=re(this._topicMap.keys()),i=[],s=this.get(11);o.forEach(function(c){var l=[],p=t._getLocalTopicList(c);s.deleteTopicRoamingInfo(c),p.forEach(function(m){var I=m.lastMessage.lastTime,I=I===void 0?0:I;Date.now()-1e3*I<1e3*t.TOPIC_LAST_ACTIVE_TIME&&l.push(m.topicID)}),0<l.length&&i.push({groupID:c,topicIDList:l})}),E.l("".concat(this._n,".getTopicListOnReconnected. active community count:").concat(i.length)),this._relayGetTopicList(i)}},{key:"_relayGetTopicList",value:function(t){var o,i,s,c=this;t.length!==0&&(i=5<(o=t.shift()).topicIDList.length?"topicIDList.length:".concat(o.topicIDList.length):"topicIDList:".concat(o.topicIDList),(s=new ue("relayGetTopicList")).setMessage(i),E.l("".concat(this._n,"._relayGetTopicList. ").concat(i)),this.getTopicList(o).then(function(){s.end(),c._relayGetTopicList(t)}).catch(function(l){s.setError(l).end(),c._relayGetTopicList(t)}))}},{key:"_handleTopicAtInfo",value:function(t){var o=this;t.length!==0&&t.forEach(function(l){var s=l.groupID,c=l.topicID,l=l.groupAtInfoList,p=[];q(l)||(l.forEach(function(m){p.push(v(v({},m),{},{groupID:s,topicID:c}))}),o.get(11).onNewGroupAtTips({dataList:p}))})}},{key:"_getTopicLastMessage",value:function(t){var o;q(t.lastMsg)||(o={time:t.lastMsg.time,sequence:t.lastMsg.sequence,from:t.lastMsg.from,payload:t.lastMsg.elements[0]?t.lastMsg.elements[0].content:null,type:t.lastMsg.elements[0]?t.lastMsg.elements[0].type:"",nick:t.lastMsg.nick,avatar:t.lastMsg.avatar,version:t.lastMsg.messageVersion,cloudCustomData:t.lastMsg.cloudCustomData,isRevoked:t.lastMsg.isPlaceMessage===2,revoker:Te(t.lastMsg.revokerInfo)?null:t.lastMsg.revokerInfo.revoker},t.lastMessage=o)}},{key:"deleteTopicListInCommunity",value:function(t){var o=this,i=this._getLocalTopicList(t),s=this.get(11);i.forEach(function(c){c=c.topicID,o._deleteLocalTopic(t,c),o._getTopicTimeMap.delete(t),s.deleteLocalConv("".concat(O.CONV_GROUP).concat(c))})}},{key:"_computeUnreadCount",value:function(t){var o,c=t.selfInfo,i=c.excludedUnreadSequenceList,s=c.readedSequence,c=t.nextMessageSeq-t.selfInfo.readedSequence-1;return ye(i)&&(o=0,i.forEach(function(l){s<l&&l<=t.nextMessageSeq-1&&(o+=1)}),1<=o&&(c-=o)),c<0?0:c}},{key:"_filterProfanity",value:function(t,o){var s=this.get(29);if(!s)return!0;var s=s.filterText(o[t],At),i=s.isAllowedToSend,s=s.modifiedText;return i===!0&&(o[t]=s,!0)}},{key:"getMessageExtensions",value:function(t,o){E.l("".concat(this._n,".getMessageExtensions startSequence:").concat(o));var i=un(t.to);return this.req({P:P.GET_GRP_MSG_EXT,data:{groupID:i,topicID:t.to,messageSequence:t.sequence,startSequence:o}})}},{key:"modifyMsgExts",value:function(t,o){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,s=(E.l("".concat(this._n,".modifyMsgExts operateType:").concat(i)),un(t.to));return this.req({P:P.MODIFY_GRP_MSG_EXT,data:{groupID:s,topicID:t.to,messageSequence:t.sequence,extensionList:o,operateType:i}})}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._topicMap.clear(),this._getTopicTimeMap.clear(),this.TOPIC_CACHE_TIME=300,this.TOPIC_LAST_ACTIVE_TIME=3600}}]),Ei),ds=(V(ms,[{key:"setExpirationTime",value:function(t){this.expirationTime=t}},{key:"getUserProfile",value:function(t){var o=this,i="".concat(this._n,".").concat("getUserProfile"),s=t.userIDList;t.fromAccount=this._userM.getMyAccount(),100<s.length&&(E.w("".concat(i," ").concat(ni(100))),s.length=100);for(var c,l=[],p=[],m=0,I=s.length;m<I;m++)c=s[m],this._userM.isMyFriend(c)&&this._contains(c)?p.push(this._getProfileFromMap(c)):l.push(c);if(l.length===0)return we(p);t.toAccount=l;var C=t.bFromGetMyProfile||!1,S=[],k=(t.toAccount.forEach(function(G){S.push({toAccount:G,standardSequence:0,customSequence:0})}),t.userItem=S,new ue("getUserProfile"));return k.setMessage(5<s.length?"userIDList.length:".concat(s.length):"userIDList:".concat(s)),this._userM.req({P:P.GET_USER_PROFILE,data:t}).then(function(G){return k.end(),E.i("".concat(i," ok")),G=o._handleResponse(G).concat(p),Ae(C?G[0]:G)}).catch(function(G){return k.setError(G).end(),E.e("".concat(i," failed. error:"),G),W(G)})}},{key:"getMyProfile",value:function(){var t,o=this._userM.getMyAccount(),i="".concat(this._n,".getMyProfile");return E.l("".concat(i," myAccount:").concat(o)),this._fill(),this._contains(o)?(t=this._getProfileFromMap(o),E.d("".concat(i," from cache, myProfile:").concat(JSON.stringify(t))),we(t)):this.getUserProfile({fromAccount:o,userIDList:[o],bFromGetMyProfile:!0})}},{key:"_handleResponse",value:function(t){var o=t.data.userProfileItem;if(!ye(o))return[];for(var i=[],t=Date.now(),s=0,c=o.length;s<c;s++){var p=o[s],l=p.to,p=p.profileItem;l!=="@TLS#NOT_FOUND"&&l!==""&&(l=this._update(l,this._getLatestProfileFromResponse(l,p)).latestProfile,i.push(l))}return E.l("".concat(this._n,"._handleResponse cost:").concat(An(t))),i}},{key:"_getLatestProfileFromResponse",value:function(t,o){var i={userID:t,profileCustomField:[]};if(!Te(o))for(var s=0,c=o.length;s<c;s++)if(-1<o[s].tag.indexOf("Tag_Profile_Custom"))i.profileCustomField.push({key:o[s].tag,value:o[s].value});else switch(o[s].tag){case at.NICK:i.nick=o[s].value;break;case at.GENDER:i.gender=o[s].value;break;case at.BIRTHDAY:i.birthday=o[s].value;break;case at.LOCATION:i.location=o[s].value;break;case at.SELFSIGNATURE:i.selfSignature=o[s].value;break;case at.ALLOWTYPE:i.allowType=o[s].value;break;case at.LANGUAGE:i.language=o[s].value;break;case at.AVATAR:i.avatar=o[s].value;break;case at.MESSAGESETTINGS:i.messageSettings=o[s].value;break;case at.ADMINFORBIDTYPE:i.adminForbidType=o[s].value;break;case at.LEVEL:i.level=o[s].value;break;case at.ROLE:i.role=o[s].value;break;default:E.w("".concat(this._n,"._getLatestProfileFromResponse unknown tag:"),o[s].tag,o[s].value)}return i}},{key:"updateMyProfile",value:function(t){var o=this,i="".concat(this._n,".").concat("updateMyProfile");if(t.nick&&this._userM.filterProfanity("nick",t)===!1)return W({code:Q.PROFANITY_FOUND});if(t.selfSignature&&this._userM.filterProfanity("selfSignature",t)===!1)return W({code:Q.PROFANITY_FOUND});var s=new ue("updateMyProfile"),c=(s.setMessage(JSON.stringify(t)),new us().validate(t));if(!c.valid)return s.setCode(Q.UPDATE_PROFILE_INVALID_PARAM).setMoreMessage("info:".concat(c.tips)).end(),E.e("".concat(i," info:").concat(c.tips)),W({code:Q.UPDATE_PROFILE_INVALID_PARAM});var l,p=[];for(l in t)Object.prototype.hasOwnProperty.call(t,l)&&(l==="profileCustomField"?t.profileCustomField.forEach(function(I){p.push({tag:I.key,value:I.value})}):p.push({tag:at[l.toUpperCase()],value:t[l]}));if(p.length===0)return c=new Gt({code:Q.UPDATE_PROFILE_NO_KEY}),s.setError(c).end(),E.e("".concat(i," failed. error:"),c),W(c);var m=this._userM.getMyAccount();return this._userM.req({P:P.UPDATE_MY_PROFILE,data:{fromAccount:m,profileItem:p}}).then(function(I){s.end(),E.i("".concat(i," ok"));var S=o._update(m,t),C=S.isProfileUpdated,S=S.latestProfile;return C===!0&&o._userM.emitOEvt(Me.PROFILE_UPDATED,[S]),we(S)}).catch(function(I){return s.setError(I).end(),E.e("".concat(i," failed. error:"),I),W(I)})}},{key:"onProfileModified",value:function(t){var o=t.dataList;if(!Te(o)){var i=o.length;E.d("".concat(this._n,".onProfileModified count:").concat(i," dataList:"),t.dataList);for(var s=[],c=0;c<i;c++){var p=o[c].userID,p=this._update(p,this._getLatestProfileFromResponse(p,o[c].profileList)),l=p.isProfileUpdated,p=p.latestProfile;l===!0&&s.push(p)}0<s.length&&(this._userM.emitIEvt(Yt.PROFILE_UPDATED,s),this._userM.emitOEvt(Me.PROFILE_UPDATED,s))}}},{key:"_fill",value:function(){if(this.accountProfileMap.size===0){for(var t=this._getCachedProfiles(),o=Date.now(),i=0,s=t.length;i<s;i++)o-t[i].lastUpdatedTime<this.expirationTime&&this.accountProfileMap.set(t[i].userID,t[i]);E.l("".concat(this._n,"._fill from cache, size:").concat(this.accountProfileMap.size))}}},{key:"_update",value:function(t,o){var i,s=!1,c=Date.now();return this._contains(t)?(i=this._getProfileFromMap(t),o.profileCustomField&&Ho(i.profileCustomField,o.profileCustomField)===!0&&(i.lastUpdatedTime=c,s=!0),0<Gn(i,o,["profileCustomField"])&&(i.lastUpdatedTime=c,s=!0)):(i=new us(o),!this._userM.isMyFriend(t)&&t!==this._userM.getMyAccount()||(i.lastUpdatedTime=c,s=!0,this.accountProfileMap.set(t,i))),this._flush(t===this._userM.getMyAccount()),s===!0&&E.l("".concat(this._n,"._update account:").concat(t," isUpdated:").concat(s)),{isProfileUpdated:s,latestProfile:i}}},{key:"_flush",value:function(t){var o=re(this.accountProfileMap.values()),i=this._userM.getStorageModule();E.d("".concat(this._n,"._flush length:").concat(o.length," flushAtOnce:").concat(t)),i.setItem(this.TAG,o,t)}},{key:"_contains",value:function(t){return this.accountProfileMap.has(t)}},{key:"_getProfileFromMap",value:function(t){return this.accountProfileMap.get(t)}},{key:"_getCachedProfiles",value:function(){var t=this._userM.getStorageModule().getItem(this.TAG);return Te(t)?[]:t}},{key:"onConvProfileUpdated",value:function(t){for(var o,i,s,c=[],l=0,p=t.length;l<p;l++)i=(o=t[l]).userID,this._userM.isMyFriend(i)&&(this._contains(i)?(s=this._getProfileFromMap(i),0<Gn(s,o)&&c.push(i)):c.push(o.userID));c.length!==0&&(E.l("".concat(this._n,".onConvProfileUpdated toAccountList:").concat(c)),this.getUserProfile({userIDList:c}))}},{key:"getNickAndAvatarByUserID",value:function(t){return this._contains(t)?{nick:(t=this._getProfileFromMap(t)).nick,avatar:t.avatar}:{nick:"",avatar:""}}},{key:"getUserNickAndAvatar",value:function(c){var o=this,i=re(new Set(c)),s=(E.l("".concat(this._n,".getUserNickAndAvatar userIDList.length:").concat(c.length," uniqueUserIDList.length:").concat(i.length)),[]);if(c.length===0)return Promise.resolve(s);var c=this._createUserIDListGroup(i),l=[];return c.forEach(function(p){l.push(o.getUserProfile({userIDList:p}))}),Promise.all(l).then(function(p){return p.forEach(function(m){m=m.data.map(function(I){return{userID:I.userID,nick:I.nick,avatar:I.avatar}}),s.push.apply(s,re(m))}),s})}},{key:"_createUserIDListGroup",value:function(t){for(var o=[],i=0;i<t.length;)o.push(t.slice(i,i+=100));return o}},{key:"reset",value:function(){this._flush(!0),this.accountProfileMap.clear()}}]),ms),Dr=V(function t(o){N(this,t)}),ps=(V(fs,[{key:"getLocalBlacklist",value:function(){return re(this._blacklistMap.keys())}},{key:"getBlacklist",value:function(){var t=this,o="".concat(this._n,".getBlacklist"),i={fromAccount:this._userM.getMyAccount(),maxLimited:100,startIndex:this._startIndex},s=new ue("getBlacklist");return this._userM.req({P:P.GET_BL,data:i}).then(function(p){var p=p.data,l=p.blackListItem,p=p.startIndex,m=Te(l)?0:l.length;s.setMessage("count:".concat(m)).end(),E.i("".concat(o," ok")),t._startIndex=p,t._handleResponse(l,!0),t._userM.emitOEvt(Me.BLACKLIST_UPDATED,re(t._blacklistMap.keys())),t._startIndex!==0&&t.getBlacklist()}).catch(function(c){return s.setError(c).end(),E.e("".concat(o," failed. error:"),c),W(c)})}},{key:"addBlacklist",value:function(t){var o,i,s=this,c=new ue("addToBlacklist"),l="".concat(this._n,".addBlacklist"),p=this._userM.getMyAccount();return t.userIDList.length===1&&t.userIDList[0]===p?(i=this._userM.getErrMsg(o=Q.CANNOT_ADD_SELF_TO_BLACKLIST),c.setCode(o).setMessage(i).end(),i=new Gt({code:o}),E.e("".concat(l," failed. error:"),i),W(i)):(t.userIDList.includes(p)&&(t.userIDList=t.userIDList.filter(function(m){return m!==p})),t.fromAccount=this._userM.getMyAccount(),t.toAccount=t.userIDList,this._userM.req({P:P.ADD_TO_BL,data:t}).then(function(m){return c.setMessage(5<t.userIDList.length?"userIDList.length:".concat(t.userIDList.length):"userIDList:".concat(t.userIDList)).end(),E.i("".concat(l," ok")),s._handleResponse(m.resultItem,!0),Ae(re(s._blacklistMap.keys()))}).catch(function(m){return c.setError(m).end(),E.e("".concat(l," failed. error:"),m),W(m)}))}},{key:"_handleResponse",value:function(t,o){if(!Te(t))for(var i,s,c,l=0,p=t.length;l<p;l++)s=t[l].to,c=t[l].resultCode,!q(c)&&c!==0||(o?((i=this._blacklistMap.has(s)?this._blacklistMap.get(s):new Dr).userID=s,Te(t[l].addBlackTimeStamp)||(i.timeStamp=t[l].addBlackTimeStamp),this._blacklistMap.set(s,i)):this._blacklistMap.has(s)&&(i=this._blacklistMap.get(s),this._blacklistMap.delete(s)));E.l("".concat(this._n,"._handleResponse total:").concat(this._blacklistMap.size," bAdd:").concat(o))}},{key:"deleteBlacklist",value:function(t){var o=this,i="".concat(this._n,".deleteBlacklist"),s=new ue("removeFromBlacklist");return t.fromAccount=this._userM.getMyAccount(),t.toAccount=t.userIDList,this._userM.req({P:P.RM_FROM_BL,data:t}).then(function(c){return s.setMessage(5<t.userIDList.length?"userIDList.length:".concat(t.userIDList.length):"userIDList:".concat(t.userIDList)).end(),E.i("".concat(i," ok")),o._handleResponse(c.data.resultItem,!1),Ae(re(o._blacklistMap.keys()))}).catch(function(c){return s.setError(c).end(),E.e("".concat(i," failed. error:"),c),W(c)})}},{key:"onAccountDeleted",value:function(t){for(var o=0,i=t.length;o<i;o++){var s=t[o];this._blacklistMap.has(s)&&this._blacklistMap.delete(s)}var c=t.length;0<c&&(E.l("".concat(this._n,".onAccountDeleted count:").concat(c," ").concat(c<30?"userIDList:".concat(t):"")),this._userM.emitOEvt(Me.BLACKLIST_UPDATED,re(this._blacklistMap.keys())))}},{key:"onAccountAdded",value:function(t){for(var o,i=[],s=0,c=t.length;s<c;s++)o=t[s],this._blacklistMap.has(o)||(this._blacklistMap.set(o,new Dr({userID:o})),i.push(o));0<i.length&&(E.l("".concat(this._n,".onAccountAdded count:").concat(i.length," userIDList:"),i),this._userM.emitOEvt(Me.BLACKLIST_UPDATED,re(this._blacklistMap.keys())))}},{key:"reset",value:function(){this._blacklistMap.clear(),this._startIndex=0}}]),fs),Pc=(V(_s,[{key:"_onCloudConfig",value:function(){var t=this._userM.getCloudConfig("status_query_count"),o=this._userM.getCloudConfig("status_sub_count"),i=this._userM.getCloudConfig("status_unsub_count");E.l("".concat(this._n,"._onCloudConfig statusQueryCount:").concat(t," statusSubscribeCount:").concat(o)+" statusUnsubscribeCount:".concat(i)),q(t)||(this.MAX_QUERY_USER_COUNT=parseInt(t,10)),q(t)||(this.MAX_SUBSCRIBE_USER_COUNT=parseInt(o,10)),q(t)||(this.MAX_UNSUBSCRIBE_USER_COUNT=parseInt(i,10))}},{key:"onUserStatusUpdated",value:function(s){var s=s.dataList,o=this._userM.getMyUserID(),i=this._userM.get(12),s=s.map(function(m){var l=m.to,p=m.statusType,m=m.customStatus,m=ui(m);return l===o&&i.setCustomStatus(m),{userID:l,statusType:p,customStatus:m}});E.l("".concat(this._n,".onUserStatusUpdated list:").concat(JSON.stringify(s))),this._userM.emitOEvt(Me.USER_STATUS_UPDATED,s)}},{key:"setSelfStatus",value:function(t){var o=this,i="".concat(this._n,".setSelfStatus");if(this._userM.filterProfanity("customStatus",t)===!1)return W({code:Q.PROFANITY_FOUND});var s=new ue("setSelfStatus"),c=t.customStatus;return this._userM.req({P:P.SET_SELF_STATUS,data:{customStatus:c}}).then(function(l){return s.setMessage("customStatus:".concat(c)).end(),E.l("".concat(i," ok. customStatus:").concat(c)),o._userM.get(12).setCustomStatus(c),Ae({userID:o._userM.getMyUserID(),statusType:1,customStatus:c})}).catch(function(l){return s.setError(l).end(),E.e("".concat(i," failed. error:"),l),W(l)})}},{key:"getUserStatus",value:function(s){var o="".concat(this._n,".").concat("getUserStatus"),s=s.userIDList,i=s===void 0?[]:s,s=this._userM.getMyUserID(),c=re(i),l=void 0,p=c.indexOf(s);if(-1<p&&(c.splice(p,1),l={userID:s,statusType:1,customStatus:this._userM.get(12).getCustomStatus()}),c.length===0)return we({successUserList:[l],failureUserList:[]});if(!this._userM.canIUse(Ue.USER_STATUS))return this._userM.noUse("getUserStatus");c.length>this.MAX_QUERY_USER_COUNT&&(E.w("".concat(o," ").concat(ni(this.MAX_QUERY_USER_COUNT))),c=i.slice(0,this.MAX_QUERY_USER_COUNT));var m=new ue("getUserStatus");return this._userM.req({P:P.GET_USER_STATUS,data:{userIDList:c}}).then(function(S){var S=S.data,C=S.successUserList,C=C===void 0?[]:C,S=S.failureUserList,S=S===void 0?[]:S,C=C.map(function(Z){var U=Z.userID,Y=Z.statusType,Z=Z.customStatus;return{userID:U,statusType:Y,customStatus:ui(Z)}}),S=S.map(function($){var U=$.userID,Y=$.invalidUserID,Z=$.errorCode,$=$.errorInfo;return{userID:Te(Y)?U:Y,code:Z,message:$}}),k=(q(l)||C.unshift(l),"userID count:".concat(i.length,", success count:").concat(C.length,", fail count:").concat(S.length));return m.setMessage("".concat(k)).end(),E.l("".concat(o," ok. ").concat(k,".")),Ae({successUserList:C,failureUserList:S})}).catch(function(I){return m.setMessage("userID count:".concat(i.length)).setError(I).end(),E.e("".concat(o," failed. error:"),I),W(I)})}},{key:"subscribeUserStatus",value:function(s){var o="subscribeUserStatus";if(!this._userM.canIUse(Ue.USER_STATUS))return this._userM.noUse(o);var i="".concat(this._n,".").concat(o),s=s.userIDList,s=s===void 0?[]:s,c=re(s),l=(c.length>this.MAX_SUBSCRIBE_USER_COUNT&&(E.w("".concat(i," ").concat(ni(this.MAX_SUBSCRIBE_USER_COUNT))),c=s.slice(0,this.MAX_SUBSCRIBE_USER_COUNT)),new ue(o)),p="userID count:".concat(s.length);return E.l("".concat(i," ").concat(p)),this._userM.req({P:P.SUB_USER_STATUS,data:{userIDList:c}}).then(function(m){return m=m.data.failureUserList,m=(m===void 0?[]:m).map(function(G){var C=G.userID,S=G.invalidUserID,k=G.errorCode,G=G.errorInfo;return{userID:Te(S)?C:S,code:k,message:G}}),l.setMessage("".concat(p," fail count:").concat(m.length)).end(),E.l("".concat(i," ok. fail count:").concat(m.length,".")),Ae({failureUserList:m})}).catch(function(m){return l.setMessage(p).setError(m).end(),E.e("".concat(i," failed. error:"),m),W(m)})}},{key:"unsubscribeUserStatus",value:function(i){var p="unsubscribeUserStatus";if(!this._userM.canIUse(Ue.USER_STATUS))return this._userM.noUse(p);var o="".concat(this._n,".").concat(p),i=(i||{}).userIDList,i=i===void 0?[]:i,s=re(i),c=(i.length>this.MAX_UNSUBSCRIBE_USER_COUNT&&(E.w("".concat(o," ").concat(ni(this.MAX_UNSUBSCRIBE_USER_COUNT))),s=i.slice(0,this.MAX_UNSUBSCRIBE_USER_COUNT)),new ue(p)),l="userID count:".concat(i.length),p=(E.l("".concat(o," ").concat(l)),{userIDList:s});return s.length===0&&(p.userIDList=void 0,p.unsubscribeAll=1),this._userM.req({P:P.UNSUB_USER_STATUS,data:p}).then(function(m){return m=m.data.failureUserList,m=(m===void 0?[]:m).map(function(G){var C=G.userID,S=G.invalidUserID,k=G.errorCode,G=G.errorInfo;return{userID:Te(S)?C:S,code:k,message:G}}),c.setMessage("".concat(l," fail count:").concat(m.length)).end(),E.l("".concat(o," ok. fail count:").concat(m.length,".")),Ae({failureUserList:m})}).catch(function(m){return c.setMessage("".concat(l)).setError(m).end(),E.e("".concat(o," failed. error:"),m),W(m)})}},{key:"reset",value:function(){this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100}}]),_s),Gc=(z(Di,Ht),wu=J(Di),V(Di,[{key:"onContextUpdated",value:function(t){this._profileHandler.getMyProfile(),this._blacklistHandler.getBlacklist()}},{key:"mockOnNickAvatarModified",value:function(t,o){E.l("".concat(this._n,"._mockOnNickAvatarModified nick:").concat(t," avatar:").concat(o)),this.onProfileModified({dataList:[{pushType:1,userID:this.getMyUserID(),profileList:[{tag:at.NICK,value:t},{tag:at.AVATAR,value:o}]}]})}},{key:"onProfileModified",value:function(t){this._profileHandler.onProfileModified(t)}},{key:"onRelationChainModified",value:function(s){var o,i,s=s.dataList;Te(s)||(o=[],s.forEach(function(c){c.blackListDelAccount&&o.push.apply(o,re(c.blackListDelAccount))}),0<o.length&&this._blacklistHandler.onAccountDeleted(o),i=[],s.forEach(function(c){c.blackListAddAccount&&i.push.apply(i,re(c.blackListAddAccount))}),0<i.length&&this._blacklistHandler.onAccountAdded(i))}},{key:"onConvProfileUpdated",value:function(t){this._profileHandler.onConvProfileUpdated(t)}},{key:"getMyAccount",value:function(){return this.getMyUserID()}},{key:"getMyNick",value:function(){return this._profileHandler.getNickAndAvatarByUserID(this.getMyUserID()).nick}},{key:"getMyProfile",value:function(){return this._profileHandler.getMyProfile()}},{key:"getStorageModule",value:function(){return this.get(13)}},{key:"filterProfanity",value:function(t,o){var s=this.get(29);if(!s)return!0;var s=s.filterText(o[t],"user_profile"),i=s.isAllowedToSend,s=s.modifiedText;return i===!0&&(o[t]=s,!0)}},{key:"isMyFriend",value:function(t){var o=this.get(8);return!!o&&o.isMyFriend(t)}},{key:"getUserProfile",value:function(t){return this._profileHandler.getUserProfile(t)}},{key:"updateMyProfile",value:function(t){return this._profileHandler.updateMyProfile(t)}},{key:"getNickAndAvatarByUserID",value:function(t){return this._profileHandler.getNickAndAvatarByUserID(t)}},{key:"getUserNickAndAvatar",value:function(t){return this._profileHandler.getUserNickAndAvatar(t)}},{key:"getLocalBlacklist",value:function(){var t=this._blacklistHandler.getLocalBlacklist();return we(t)}},{key:"addBlacklist",value:function(t){return this._blacklistHandler.addBlacklist(t)}},{key:"deleteBlacklist",value:function(t){return this._blacklistHandler.deleteBlacklist(t)}},{key:"onUserStatusUpdated",value:function(t){this._userStatusHandler.onUserStatusUpdated(t)}},{key:"setSelfStatus",value:function(t){return this._userStatusHandler.setSelfStatus(t)}},{key:"getUserStatus",value:function(t){return this._userStatusHandler.getUserStatus(t)}},{key:"subscribeUserStatus",value:function(t){return this._userStatusHandler.subscribeUserStatus(t)}},{key:"unsubscribeUserStatus",value:function(t){return this._userStatusHandler.unsubscribeUserStatus(t)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._profileHandler.reset(),this._blacklistHandler.reset(),this._userStatusHandler.reset()}}]),Di),Uc=(V(hs,[{key:"isLoggedIn",value:function(){return this._isLoggedIn}},{key:"isOversea",value:function(){return this._oversea}},{key:"isPrivateNetWork",value:function(){return this._proxyServer}},{key:"isDevMode",value:function(){return this._isDevMode}},{key:"isTestEnv",value:function(){return this._isTestEnv}},{key:"isPartialUpdatedConvs",value:function(){return this._isPartialUpdatedConvs}},{key:"isIndependentDomainDisabled",value:function(){return this._isIndependentDomainDisabled}},{key:"isSingaporeSite",value:function(){return 2e7<=this._SDKAppID&&this._SDKAppID<3e7||172e7<=this._SDKAppID&&this._SDKAppID<173e7}},{key:"isKoreaSite",value:function(){return 3e7<=this._SDKAppID&&this._SDKAppID<4e7||173e7<=this._SDKAppID&&this._SDKAppID<174e7}},{key:"isGermanySite",value:function(){return 4e7<=this._SDKAppID&&this._SDKAppID<5e7||174e7<=this._SDKAppID&&this._SDKAppID<175e7}},{key:"isIndiaSite",value:function(){return 5e7<=this._SDKAppID&&this._SDKAppID<6e7||175e7<=this._SDKAppID&&this._SDKAppID<176e7}},{key:"isJapanSite",value:function(){return 6e7<=this._SDKAppID&&this._SDKAppID<7e7||176e7<=this._SDKAppID&&this._SDKAppID<177e7}},{key:"isUSASite",value:function(){return 7e7<=this._SDKAppID&&this._SDKAppID<8e7||177e7<=this._SDKAppID&&this._SDKAppID<178e7}},{key:"isIndonesiaSite",value:function(){return 8e7<=this._SDKAppID&&this._SDKAppID<9e7||178e7<=this._SDKAppID&&this._SDKAppID<179e7}},{key:"isIntl",value:function(){return(t=this._SDKAppID)===0||2e7<=t&&t<9e7||172e7<=t&&t<179e7;var t}},{key:"isUnlimitedAVChatRoom",value:function(){return this._unlimitedAVChatRoom}},{key:"isUsingChatCore",value:function(){return this._isUsingChatCore}},{key:"setUsingChatCore",value:function(t){this._isUsingChatCore=t}},{key:"getUIPlatform",value:function(){return this._uiPlatform}},{key:"setUIPlatform",value:function(t){this._uiPlatform=t}},{key:"setUserID",value:function(t){this._userID=t}},{key:"getUserID",value:function(){return this._userID}},{key:"setUserSig",value:function(t){this._userSig=t}},{key:"getUserSig",value:function(){return this._userSig}},{key:"getSDKAppID",value:function(){return this._SDKAppID}},{key:"setTinyID",value:function(t){this._tinyID=t,this._isLoggedIn=!0}},{key:"getTinyID",value:function(){return this._tinyID}},{key:"setCustomStatus",value:function(t){this._customStatus=t}},{key:"getCustomStatus",value:function(){return this._customStatus}},{key:"getScene",value:function(){return cr?window.tencent_cloud_im_csig_flutter_for_web_25F_cy:this._isTUIKit()?"tuikit":this._scene}},{key:"getInstanceID",value:function(){return this._instanceID}},{key:"getStatusInstanceID",value:function(){return this._statusInstanceID}},{key:"setStatusInstanceID",value:function(t){this._statusInstanceID=t}},{key:"getVersion",value:function(){return this._version}},{key:"getA2Key",value:function(){return this._a2Key}},{key:"setA2Key",value:function(t){this._a2Key=t}},{key:"getContentType",value:function(){return this._contentType}},{key:"getProxyServer",value:function(){return this._proxyServer}},{key:"getFileUploadProxy",value:function(){return this._fileUploadProxy}},{key:"getFileDownloadProxy",value:function(){return this._fileDownloadProxy}},{key:"setApplicationID",value:function(t){this._applicationID=t}},{key:"getApplicationID",value:function(){return this._applicationID}},{key:"setDowloadFileAuthKey",value:function(t){this._authKey=t}},{key:"getDowloadFileAuthKey",value:function(){return this._authKey}},{key:"setCustomLoginInfo",value:function(t){this._customLoginInfo=t}},{key:"getCustomLoginInfo",value:function(){return this._customLoginInfo}},{key:"_isTUIKit",value:function(){var t=!1,o=!1,i=!1,s=!1,m=[];qe&&(m=Object.keys(mt));for(var c=0,l=(m=$t?Object.keys(ba?uni:window):m).length;c<l;c++)if(m[c].toLowerCase().includes("uikit")){t=!0;break}var p,m=null,I=(qe&&!Ot(mt.createGamePortal)&&Ot(getApp)&&!q(getApp())&&(p=getApp().globalData,It(p)&&p.isTUIKit===!0&&(o=!0)),this._m.get(13).getStorageSync("TIM_".concat(this._SDKAppID,"_isTUIKit"))===!0&&(i=!0),null);if(rn&&!Ft&&typeof uni=="undefined"&&__wxConfig&&(I=__wxConfig.pages),St&&typeof uni=="undefined"&&__qqConfig&&(I=__qqConfig.pages),ye(I)&&0<I.length){for(var C=0,S=I.length;C<S;C++)if(I[C].toLowerCase().includes("tui")){s=!0;break}I=null}return t||o||i||s}},{key:"reset",value:function(){this._isLoggedIn=!1,this._userSig="",this._a2Key="",this._tinyID="",this._customStatus="",this._statusInstanceID=0}}]),hs),gs={"k-vue2-pc":1,"k-vue2-h5":2,"k-vue2-h5-uni":3,"k-vue2-app-uni":4,"k-vue2-mp-uni":5,"k-vue2-pc-uni":6,"k-vue3-pc":7,"k-vue3-h5":8,"k-vue3-h5-uni":9,"k-vue3-app-uni":10,"k-vue3-mp-uni":11,"k-vue3-pc-uni":12,"k-rn":13},wc=(z(Yo,Ht),Sr=J(Yo),V(Yo,[{key:"onCheckTimer",value:function(t){this.isLoggedIn()&&t%this._helloInterval==0&&this._hello()}},{key:"getPushModule",value:function(){var t=void 0,o=this.get(36),i=this.get(28);return o.canIUseTIMPush()?t=o:i.canIUseOfflinePush()&&(t=i),t}},{key:"login",value:function(s){if(this.isLoggedIn())return o=this.getMyUserID(),(o=this.getErrMsg("RepeatLogin",o))&&E.w(o),we({actionStatus:"OK",errorCode:0,errorInfo:o,repeatLogin:!0});if(Date.now()-this._lastLoginTs<=15e3)return this.warn("LoggingIn",s.userID),W({code:Q.REPEAT_LOGIN});E.l("".concat(this._n,".login userID:").concat(s.userID));var o=this._checkLoginInfo(s);if(o.code!==0)return W(o);var o=this.get(12),i=s.userID,s=s.userSig;return o.setUserID(i),o.setUserSig(s),this.get(20).updateProtocolConfig(),this._login()}},{key:"_login",value:function(){var t=this,o=this.get(12),i=o.getScene(),s=0,c=i,l=(i&&i.startsWith("k-")&&(c=gs[i],i="tuikit"),new ue("login")),m=(l.setMessage("".concat(c)).setMoreMessage("identifier:".concat(this.getMyUserID())),i==="tuikit"),p=0,m=(ba?p=m?c===3||c===4||c===5||c===6?31:c===9||c===10||c===11||c===12?32:4:3:qe?p=gt?36:i==="tuikit"?12:11:$t?p=cr?i==="flutter_web_uikit"?21:20:this._isReactUIKit()?ti?25:24:m?c===1||c===2?29:c===7||c===8?30:ti?17:14:ti?16:13:c===13&&(p=38),l.setUIPlatform(p),o.setUIPlatform(p),this.getPushModule()),I=(m&&(this._isWebUniapp=m.getUniAppPlatform(),c=this._getStatusInstanceID(),o.setStatusInstanceID(c),this.get(20).updateProtocolConfig(),s=m.getDeviceBrand()),"".concat(this._n,"._login"));return this._lastLoginTs=Date.now(),this.req({P:P.LOGIN,data:{deviceBrand:s,isWebUniapp:this._isWebUniapp,customInfo:o.getCustomLoginInfo()}}).then(function(C){t._lastLoginTs=0;var et=Date.now(),S=null,_e=C.data,k=_e.a2Key,G=_e.tinyID,U=_e.helloInterval,Y=_e.instanceID,Z=_e.timeStamp,$=_e.customStatus,$=$===void 0?"":$,De=_e.purchaseBits,_e=_e.authKey,_e=_e===void 0?"":_e,Pe=1e3*Z,Ge=et-l.getStartTs(),Ge=Pe+parseInt(Ge/2)-et,et=l.getStartTs()+Ge;if(l.start(et),et=Pe,$i=Ge,(Pe=new Date).setTime(et),E.i("baseTime from server:".concat(Pe," offset:").concat($i)),!G)throw S=new Gt({code:Q.NO_TINYID}),l.setError(S).end(),S;if(!k)throw S=new Gt({code:Q.NO_A2KEY}),l.setError(S).end(),S;return et=t.get(21).getSocketID(),Pe=ui($),S="socketID:".concat(et," scene:").concat(i," helloInterval:").concat(U," instanceID:").concat(Y," timeStamp:").concat(Z)+" offset:".concat(Ge," customStatus:").concat(Pe," isWebUniapp:").concat(t._isWebUniapp),E.l("".concat(I," ok. ").concat(S)),$="",et="",rn&&Ot(mt.getAccountInfoSync)&&(Z=mt.getAccountInfoSync().miniProgram)&&($=Z.appId,et=Z.envVersion),l.setMoreMessage("".concat(S," href:").concat($t?window.location.href:""," mpAppId:").concat($," envVersion:").concat(et," authKey:").concat(_e)).end(),o.setA2Key(k),o.setTinyID(G),o.setStatusInstanceID(Y),o.setCustomStatus(Pe),o.setDowloadFileAuthKey(_e),De&&t.get(27).onPushedConfig({errorCode:0,expiredTime:0,purchaseBits:De}),t.get(20).updateProtocolConfig(),t.emitIEvt(Yt.A2KEY_AND_TINYID_UPDATED),t._helloInterval=U,t.triggerReady(),Ge=t.getPushModule(),Ge&&(uni.setStorageSync("timUniAppInstanceID",Y),Ge.init()),t._fetchCloudControlConfig(),t.get(29).init(),C}).catch(function(C){return l.setError(C).end(!0),t._m.setNotReadyReason(Q.LOGIN_FAILED),E.e("".concat(I," failed. error:"),C),t._lastLoginTs=0,t._m.onLoginFailed(),W(C)})}},{key:"logout",value:function(){var t=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:0,i="".concat(this._n,".logout"),s=this.isLoggedIn();return E.i("".concat(i," type:").concat(o," isLoggedIn:").concat(s," isWebUniapp:").concat(this._isWebUniapp)),s?(new ue("logout").setMessage("identifier:".concat(this.getMyUserID())).end(!0),o===0&&this._m.setNotReadyReason(Q.LOGGED_OUT),this.req({P:P.LOGOUT,data:{type:o,isWebUniapp:this._isWebUniapp}}).then(function(){return t.resetReady(),we({})}).catch(function(c){return E.e("".concat(i," error:"),c),t.resetReady(),we({})})):W({code:Q.USER_NOT_LOGGED_IN})}},{key:"getLoginUser",value:function(){return this.isLoggedIn()?this.getMyUserID():""}},{key:"_fetchCloudControlConfig",value:function(){this.get(23).fetchConfig()}},{key:"_getStatusInstanceID",value:function(){return uni.getStorageSync("timUniAppInstanceID")||0}},{key:"_hello",value:function(){var t=this;this._lastWsHelloTs=Date.now(),this.req({P:P.HELLO,data:{isWebUniapp:this._isWebUniapp}}).catch(function(o){E.w("".concat(t._n,"._hello error:"),o)})}},{key:"getLastWsHelloTs",value:function(){return this._lastWsHelloTs}},{key:"_checkLoginInfo",value:function(t){var o=0;return Te(this.get(12).getSDKAppID())?o=Q.NO_SDKAPPID:Te(t.userID)?o=Q.NO_IDENTIFIER:Te(t.userSig)&&(o=Q.NO_USERSIG),{code:o}}},{key:"_isReactUIKit",value:function(){return $t&&window.tencent_cloud_im_csig_react_uikit_23F_xa!==void 0}},{key:"onMultipleAccountKickedOut",value:function(t){var o=this;new ue("kickedOut").setMessage("type:".concat(O.KICKED_OUT_MULT_ACCOUNT," newInstanceInfo:").concat(JSON.stringify(t))).end(!0),E.w("".concat(this._n,".onMultipleAccountKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),t),this.logout(1).then(function(){o.emitOEvt(Me.KICKED_OUT,{type:O.KICKED_OUT_MULT_ACCOUNT}),o._m.setNotReadyReason(Q.KICKED_OUT_MULT_ACCOUNT),o._m.reset()})}},{key:"onMultipleDeviceKickedOut",value:function(t){var o=this;new ue("kickedOut").setMessage("type:".concat(O.KICKED_OUT_MULT_DEVICE," newInstanceInfo:").concat(JSON.stringify(t))).end(!0),E.w("".concat(this._n,".onMultipleDeviceKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),t),this.logout(1).then(function(){o.emitOEvt(Me.KICKED_OUT,{type:O.KICKED_OUT_MULT_DEVICE}),o._m.setNotReadyReason(Q.KICKED_OUT_MULT_DEVICE),o._m.reset()})}},{key:"onUserSigExpired",value:function(){new ue("kickedOut").setMessage(O.KICKED_OUT_USERSIG_EXPIRED).end(!0),E.w("".concat(this._n,".onUserSigExpired userID:").concat(this.getMyUserID())),this.get(12).getStatusInstanceID()!==0&&(this.emitOEvt(Me.KICKED_OUT,{type:O.KICKED_OUT_USERSIG_EXPIRED}),this._m.setNotReadyReason(Q.KICKED_OUT_USERSIG_EXPIRED),this._m.reset())}},{key:"onRestApiKickedOut",value:function(t){new ue("kickedOut").setMessage("type:".concat(O.KICKED_OUT_REST_API," newInstanceInfo:").concat(JSON.stringify(t))).end(!0),E.w("".concat(this._n,".onRestApiKickedOut userID:").concat(this.getMyUserID()," newInstanceInfo:"),t),this.get(12).getStatusInstanceID()!==0&&(this.emitOEvt(Me.KICKED_OUT,{type:O.KICKED_OUT_REST_API}),this._m.setNotReadyReason(Q.KICKED_OUT_REST_API),this._m.reset(),this.get(21).onRestApiKickedOut())}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this.resetReady(),this._helloInterval=120,this._lastLoginTs=0,this._lastWsHelloTs=0,this._isWebUniapp=0}}]),Yo);function Yo(t){return N(this,Yo),(t=Sr.call(this,t))._n="SignModule",t._helloInterval=120,t._lastLoginTs=0,t._lastWsHelloTs=0,t._isWebUniapp=0,Tr.mixin(te(t)),t}function hs(t,o){N(this,hs),this._m=t,this._isLoggedIn=!1,this._SDKAppID=o.SDKAppID,this._userID=o.userID||"",this._userSig=o.userSig||"",this._version="3.5.2",this._a2Key="",this._tinyID="",this._customStatus="",this._contentType="json",this._unlimitedAVChatRoom=o.unlimitedAVChatRoom,this._scene=o.scene||"",this._oversea=o.oversea,this._instanceID=o.instanceID,this._statusInstanceID=0,this._isDevMode=o.devMode,this._isTestEnv=o.testEnv,this._proxyServer=o.proxyServer,this._fileUploadProxy=o.fileUploadProxy,this._fileDownloadProxy=o.fileDownloadProxy,this._applicationID=0,this._isPartialUpdatedConvs=o.partialUpdatedConversations,this._isIndependentDomainDisabled=o.disableIndependentDomain,this._isUsingChatCore=!1,this._uiPlatform=0,this._authKey="",this._customLoginInfo=""}function Di(t){return N(this,Di),(t=wu.call(this,t))._n="UserModule",t._profileHandler=new ds(te(t)),t._blacklistHandler=new ps(te(t)),t._userStatusHandler=new Pc(te(t)),t.getIEmitInst().on(Yt.A2KEY_AND_TINYID_UPDATED,t.onContextUpdated,te(t)),t}function _s(t){N(this,_s),this._userM=t,this._n="UserStatusHandler",this.MAX_QUERY_USER_COUNT=500,this.MAX_SUBSCRIBE_USER_COUNT=100,this.MAX_UNSUBSCRIBE_USER_COUNT=100,this._userM.getIEmitInst().on(Yt.CLOUD_CONFIG,this._onCloudConfig,this)}function fs(t){N(this,fs),this._userM=t,this._n="BlacklistHandler",this._blacklistMap=new Map,this._startIndex=0}function ms(t){N(this,ms),this._userM=t,this._n="ProfileHandler",this.TAG="profile",this.accountProfileMap=new Map,this.expirationTime=864e5}function Ei(t){return N(this,Ei),(t=Po.call(this,t))._n="TopicModule",t._topicMap=new Map,t._getTopicTimeMap=new Map,t.TOPIC_CACHE_TIME=300,t.TOPIC_LAST_ACTIVE_TIME=3600,t.getIEmitInst().on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function vs(t,o){N(this,vs),this.topicID="",this.topicName="",this.avatar="",this.introduction="",this.notification="",this.unreadCount=0,this.muteAllMembers=!1,this.customData="",this.groupAtInfoList=[],this.nextMessageSeq=0,this.lastMessage=Uu(t.lastMessage,o),this.selfInfo={muteTime:0,readedSequence:0,messageRemindType:"",excludedUnreadSequenceList:void 0},this._initTopic(t)}function Ri(t){return N(this,Ri),(t=ua.call(this,t))._n="GroupModule",t._commonGroupHandler=new od(te(t)),t._groupAttributesHandler=new id(te(t)),t._groupCountersHandler=new ad(te(t)),t._AVChatRoomHandler=new rd(te(t)),t._groupTipsHandler=new nd(te(t)),t._groupSystemNoticeHandler=new ld(te(t)),t._groupMemberHandler=new ud(te(t)),t.groupMap=new Map,t._unjoinedAVChatRoomList=new Map,t._receiptDetailCompleteMap=new Map,t._onlineMemberCountMap=new Map,t._timeoutIDs=[],t.getIEmitInst().on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function ys(t){N(this,ys),this._grpM=t,this._n="GroupSystemNoticeHandler",this.pendencyMap=new Map}function Li(t){N(this,Li),this._grpM=t,this._n="GroupMemberHandler",this.groupMemberListMap=new Map,this.DEFAULT_MEMBER_INFO_FILTER=["Role","JoinTime","NameCard","ShutUpUntil","OnlineStatus"],this._grpM.getIEmitInst().on(Yt.PROFILE_UPDATED,this._onProfileUpdated,this)}function Is(t){N(this,Is),this.userID="",this.avatar="",this.nick="",this.role="",this.joinTime="",this.lastSendMsgTime="",this.nameCard="",this.muteUntil=0,this.memberCustomField=[],this.isOnline=!1,this.updateMember(t)}function Ms(t){N(this,Ms),this._grpM=t,this._n="AVChatRoomHandler",this._joinedGroupMap=new Map,this._pollingRequestInfoMap=new Map,this._pollingInstanceMap=new Map,this._seqSll=new bc(200),this._IDSll=new bc(100),this._reportMessageStackedCount=0,this._onlineMemberCountMap=new Map,this.DEFAULT_EXPIRE_TIME=60,this.DEFAULT_POLLING_INTERVAL=300,this.MAX_POLLING_INTERVAL=2e3,this._pollingInterval=this.DEFAULT_POLLING_INTERVAL,this.DEFAULT_POLLING_NO_MESSAGE_COUNT=20,this.DEFAULT_POLLING_INTERVAL_PLUS=2e3,this._pollingNoMessageCount=0,this._startBroadcastSeq=1,this._broadcastMessageIDMap=new Map,this.DEFAULT_POLLING_SIMPLIFIED_MSG=0}function Cs(l){N(this,Cs);var o=l.manager,i=l.groupID,s=l.onInit,c=l.onSuccess,l=l.onFail;this._n="Polling",this._manager=o,this._grpM=o._grpM,this._onInit=s,this._onSuccess=c,this._onFail=l,this._groupID=i,this._timeoutID=-1,this._isRunning=!1,this._proto=P.AV_POLLING}function Ts(t){N(this,Ts),this._grpM=t,this._n="GroupCountersHandler",this._groupCountersMap=new Map,this.EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Yt.CLOUD_CONFIG,this._onCloudConfig,this)}function Ss(t){N(this,Ss),this._grpM=t,this._n="GroupAttributesHandler",this._groupAttributesMap=new Map,this._groupAttributesCopy={},this.CACHE_EXPIRE_TIME=3e4,this._grpM.getIEmitInst().on(Yt.CLOUD_CONFIG,this._onCloudConfig,this)}function Ds(t){N(this,Ds),this._grpM=t,this._n="CommonGroupHandler",this.tempConversationList=null,this._cachedGroupMessageMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4,this.PAGING_GRP_COUNT_LIMIT=200,this._pagingStatus=On,this._pagingGetCostList=[],t.getIEmitInst().on(Yt.A2KEY_AND_TINYID_UPDATED,this.syncGroupList,this)}function la(t){N(this,la),this._grpM=t,this._n="GroupTipsHandler",this._cachedGroupTipsMap=new Map,this._checkCountMap=new Map,this.MAX_CHECK_COUNT=4}function da(t){return N(this,da),(t=Nc.call(this,t))._n="ConvModule",Tr.mixin(te(t)),t._msgListHandler=new Pu(te(t)),t._msgRemindHandler=new xu(te(t)),t._convGroupHandler=new ed(te(t)),t._sll=new bc(100),t._pagingStatus=On,t._pagingTs=0,t._pagingStartIdx=0,t._pagingPinnedTs=0,t._pagingPinnedStartIdx=0,t._pagingConvIDMap=new Map,t._convIDFromUnreadDBMap=new Map,t._convMap=new Map,t._tmpGroupList=[],t._tmpGroupAtTipsList=[],t._peerReadTimeMap=new Map,t._completedMap=new Map,t._roamingMsgKeyAndTimeMap=new Map,t._remoteGroupReadSeqMap=new Map,t._convTotalUnreadCount=0,t._pagingGetCostList=[],t._convMapForDiff=new Map,t._partialUpdatedConvMap=new Map,t._everClearedMap=new Map,t._bPullOnInvite=!0,t._initListeners(),t}function Er(t){N(this,Er),this._convM=t,this._n="ConvGroupHandler",this._convGroupMap=new Map,this._startIndex=0,this._pagingStatus=On}function Fc(t){N(this,Fc),this._convM=t,this._n="MsgRemindHandler"}function xc(t,o){var i=2<arguments.length&&arguments[2]!==void 0&&arguments[2];N(this,xc),this.conversationID=t.conversationID||"",this.unreadCount=t.unreadCount||0,this.type=t.type||"",this.lastMessage=Gu(t.lastMessage,o,i),t.lastMsgTime&&(this.lastMessage.lastTime=t.lastMsgTime),this._isInfoCompleted=!1,this.peerReadTime=t.peerReadTime||0,this.groupAtInfoList=[],this.remark="",this.isPinned=t.isPinned||!1,this.messageRemindType=t.messageRemindType,this.markList=t.markList||[],this.customData=t.customData||"",this.conversationGroupList=t.conversationGroupList||[],this.draftText=t.draftText||"",this._initProfile(t),this.subType=this.groupProfile?this.groupProfile.type:""}function qc(t){N(this,qc),this.groupID="",this.name="",this.avatar="",this.type="",this.introduction="",this.notification="",this.ownerID="",this.createTime="",this.infoSequence="",this.lastInfoTime="",this.selfInfo={messageRemindType:"",joinTime:"",nameCard:"",role:"",userID:"",memberCustomField:void 0,readedSequence:0,excludedUnreadSequenceList:void 0},this.lastMessage={lastTime:"",lastSequence:"",fromAccount:"",messageForShow:""},this.nextMessageSeq="",this.memberNum="",this.memberCount="",this.maxMemberNum="",this.maxMemberCount="",this.joinOption="",this.inviteOption="",this.groupCustomField=[],this.muteAllMembers=!1,this.isSupportTopic=!1,this._lastRevokedTime=0,this._initGroup(t)}function Es(t){N(this,Es),this.MAX_LENGTH=t,this.map=new Map}function Rs(t){var o=this;N(this,Rs),Te(t)||(this.userID=t.userID||"",this.nick=t.nick||"",this.gender=t.gender||"",this.birthday=t.birthday||0,this.location=t.location||"",this.selfSignature=t.selfSignature||"",this.allowType=t.allowType||O.ALLOW_TYPE_ALLOW_ANY,this.language=t.language||0,this.avatar=t.avatar||"",this.messageSettings=t.messageSettings||0,this.adminForbidType=t.adminForbidType||O.FORBID_TYPE_NONE,this.level=t.level||0,this.role=t.role||0,this.lastUpdatedTime=0,this.profileCustomField=[],Te(t.profileCustomField)||t.profileCustomField.forEach(function(i){o.profileCustomField.push({key:i.key,value:i.value})}))}function Rr(){return null}function Lr(t){var o=t.get(12);return{SDKType:10,SDKAppID:o.getSDKAppID(),SDKVersion:o.getVersion(),tinyID:Number(o.getTinyID()),userID:o.getUserID(),platform:t.getPlatform(),instanceID:o.getInstanceID(),traceID:no()}}V(Wc,[{key:"_errorTolerantHandle",value:function(){qe||typeof window!="undefined"&&this._canIUseCookies()||(this.getItem=Rr,this.setItem=Rr,this.removeItem=Rr,this.clear=Rr)}},{key:"onCheckTimer",value:function(t){t%20==0&&this._storageQueue.size!==0&&this._doFlush()}},{key:"_doFlush",value:function(){try{var t,o=A(this._storageQueue);try{for(o.s();!(t=o.n()).done;){var i=Le(t.value,2),s=i[0],c=i[1];this._setStorageSync(this._getKey(s),c)}}catch(l){o.e(l)}finally{o.f()}this._storageQueue.clear()}catch(l){E.w("".concat(this._n,"._doFlush error:"),l)}}},{key:"_getPrefix",value:function(){var t=this._m.get(12);return"TIM_".concat(t.getSDKAppID(),"_").concat(t.getUserID(),"_")}},{key:"_getKey",value:function(t){return"".concat(this._getPrefix()).concat(t)}},{key:"getItem",value:function(t){var o=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var i=o?this._getKey(t):t;return this.getStorageSync(i)}catch(s){return E.w("".concat(this._n,".getItem error:"),s),{}}}},{key:"setItem",value:function(t,o){var i;2<arguments.length&&arguments[2]!==void 0&&arguments[2]?(i=!(3<arguments.length&&arguments[3]!==void 0)||arguments[3]?this._getKey(t):t,this._setStorageSync(i,o)):this._storageQueue.set(t,o)}},{key:"clear",value:function(){try{qe?mt.clearStorageSync():this._canIUseCookies()&&localStorage.clear()}catch(t){E.w("".concat(this._n,".clear error:"),t)}}},{key:"removeItem",value:function(t){var o=!(1<arguments.length&&arguments[1]!==void 0)||arguments[1];try{var i=o?this._getKey(t):t;this._removeStorageSync(i)}catch(s){E.w("".concat(this._n,".removeItem error:"),s)}}},{key:"getSize",value:function(t){var o=this,i=1<arguments.length&&arguments[1]!==void 0?arguments[1]:"b";try{var s={size:0,limitSize:5242880,unit:i};if(Object.defineProperty(s,"leftSize",{enumerable:!0,get:function(){return s.limitSize-s.size}}),qe&&(s.limitSize=1024*mt.getStorageInfoSync().limitSize),t)s.size=JSON.stringify(this.getItem(t)).length+this._getKey(t).length;else if(qe)mt.getStorageInfoSync().keys.forEach(function(l){s.size+=JSON.stringify(o.getStorageSync(l)).length+o._getKey(l).length});else if(this._canIUseCookies())for(var c in localStorage)localStorage.hasOwnProperty(c)&&(s.size+=localStorage.getItem(c).length+c.length);return this._convertUnit(s)}catch(l){E.w("".concat(this._n," error:"),l)}}},{key:"_convertUnit",value:function(t){var o,i={},s=t.unit;for(o in i.unit=s,t)typeof t[o]=="number"&&(s.toLowerCase()==="kb"?i[o]=Math.round(t[o]/1024):s.toLowerCase()==="mb"?i[o]=Math.round(t[o]/1024/1024):i[o]=t[o]);return i}},{key:"_setStorageSync",value:function(t,o){qe?Ct?my.setStorageSync({key:t,data:o}):mt.setStorageSync(t,o):this._canIUseCookies()&&localStorage.setItem(t,JSON.stringify(o))}},{key:"getStorageSync",value:function(t){return qe?Ct?my.getStorageSync({key:t}).data:mt.getStorageSync(t):this._canIUseCookies()?JSON.parse(localStorage.getItem(t)):{}}},{key:"_removeStorageSync",value:function(t){qe?Ct?my.removeStorageSync({key:t}):mt.removeStorageSync(t):this._canIUseCookies()&&localStorage.removeItem(t)}},{key:"_canIUseCookies",value:function(){return typeof window!="undefined"&&navigator&&navigator.cookieEnabled&&localStorage}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._doFlush()}}]);var pa,Vc=Wc,Bc=(V(Kc,[{key:"pushIn",value:function(t){E.d("".concat(this._n,".pushIn"),this._report.length,t),this._report.push(t)}},{key:"backfill",value:function(t){var o;ye(t)&&t.length!==0&&(E.d("".concat(this._n,".backfill"),this._report.length,t.length),(o=this._report).unshift.apply(o,re(t)))}},{key:"getLogsNumInMemory",value:function(){return this._report.length}},{key:"isEmpty",value:function(){return this._report.length===0}},{key:"_reset",value:function(){this._report.length=0,this._report=[]}},{key:"getLogsInMemory",value:function(){var t=this._report.slice();return this._reset(),t}}]),Kc),Bu=(z(Ls,Ht),pa=J(Ls),V(Ls,[{key:"reportAtOnce",value:function(){this._report()}},{key:"_onLoginSuccess",value:function(){var t=this,o=this.get(13),i=o.getItem(this.TAG,!1);!Te(i)&&Ot(i.forEach)&&(E.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(i.length)),i.forEach(function(s){t._reportBody.pushIn(s)}),o.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("evt_rpt_threshold"),o=this.getCloudConfig("evt_rpt_waiting"),i=this.getCloudConfig("evt_rpt_level"),s=this.getCloudConfig("evt_rpt_sdkappid_bl"),c=this.getCloudConfig("evt_rpt_tinyid_wl");q(t)||(this.MIN_THRESHOLD=Number(t)),q(o)||(this.WAITING_TIME=Number(o)),q(i)||(this.REPORT_LEVEL=i.split(",").map(function(l){return Number(l)})),q(s)||(this.REPORT_SDKAPPID_BLACKLIST=s.split(",").map(function(l){return Number(l)})),q(c)||(this.REPORT_TINYID_WHITELIST=c.split(","))}},{key:"pushIn",value:function(t){t instanceof ue&&(t.updateTimeStamp(),this._reportBody.pushIn(t),this._reportBody.getLogsNumInMemory()>=this.MIN_THRESHOLD&&this._report())}},{key:"onCheckTimer",value:function(){Date.now()<this._lastReportTime+this.WAITING_TIME||this._reportBody.isEmpty()||this._report()}},{key:"_filterLogs",value:function(t){var o=this,s=this.get(12),i=s.getSDKAppID(),s=s.getTinyID();return Mc(this.REPORT_SDKAPPID_BLACKLIST,i)&&!vn(this.REPORT_TINYID_WHITELIST,s)?[]:t.filter(function(c){return o.REPORT_LEVEL.includes(c.level)})}},{key:"_report",value:function(){var t,o,i=this;this._reportBody.isEmpty()||(t=this._reportBody.getLogsInMemory(),(o=this._filterLogs(t)).length!==0?(o={header:Lr(this),event:o},this.req({P:P.SSO_STAT,data:v({},o)}).then(function(){i._lastReportTime=Date.now()}).catch(function(s){E.w("".concat(i._n,"._report failed. error:"),s),i._lastReportTime=Date.now(),i._reportBody.backfill(t),i._reportBody.getLogsNumInMemory()>i.MAX_THRESHOLD&&i._flushAtOnce()})):this._lastReportTime=Date.now())}},{key:"_flushAtOnce",value:function(){var t=this.get(13),o=t.getItem(this.TAG,!1),i=this._reportBody.getLogsInMemory(),s="".concat(this._n,"._flushAtOnce");Te(o)?(E.l("".concat(s," count:").concat(i.length)),t.setItem(this.TAG,i,!0,!1)):((i=i.concat(o)).length>this.MAX_THRESHOLD&&(i=i.slice(0,this.MAX_THRESHOLD)),E.l("".concat(s," count:").concat(i.length)),t.setItem(this.TAG,i,!0,!1))}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._lastReportTime=0,this._report(),this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[]}}]),Ls),kr="none",Ar="online",fd=(V(Hc,[{key:"_startRN",value:function(){var t,o=this;!Ze||(t=this._m.get(18).getPlugin("chat-network-monitor"))&&(this._removeListener=t.addEventListener(function(c){var s=c.isConnected,c=c.type;o._networkType!==c&&o._onNetworkStatusChange({isConnected:s!==void 0&&s,networkType:c})}))}},{key:"start",value:function(){var t=this,o="".concat(this._n,".start");qe?(mt.getNetworkType({success:function(i){t._networkType=i.networkType||i.subtype||"",i.networkType===kr?E.w("".concat(o," no network, please check!")):E.i("".concat(o," networkType:").concat(i.networkType))}}),this._mpNetworkStatusCallback=this._onNetworkStatusChange.bind(this),mt.onNetworkStatusChange(this._mpNetworkStatusCallback)):$t&&(this._networkType=Ar,this._webOnlineCallback=this._onWebOnline.bind(this),this._webOfflineCallback=this._onWebOffline.bind(this),window.addEventListener("online",this._webOnlineCallback),window.addEventListener("offline",this._webOfflineCallback))}},{key:"_onWebOnline",value:function(){this._onNetworkStatusChange({isConnected:!0,networkType:Ar})}},{key:"_onWebOffline",value:function(){this._onNetworkStatusChange({isConnected:!1,networkType:kr})}},{key:"_onNetworkStatusChange",value:function(i){var o=i.isConnected,i=i.networkType,s="".concat(this._n,"._onNetworkStatusChange"),c=!1,l="previous:".concat(this._networkType," current:").concat(i);o?(E.i("".concat(s," ").concat(l)),this._networkType!==i&&(c=!0,this._networkType=i,this._m.get(21).reConnect(!0))):this._networkType!==i&&(c=!0,this._networkType=i,E.w("".concat(s," no network, please check!")),this._m.get(21).offline()),c&&new ue("networkChange").setMessage("isConnected:".concat(o," ").concat(l)).end()}},{key:"isOnline",value:function(){return this._networkType!==kr}},{key:"getNetworkType",value:function(){return this._networkType}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),qe?this._mpNetworkStatusCallback!==null&&(mt.offNetworkStatusChange&&mt.offNetworkStatusChange(this._mpNetworkStatusCallback),this._mpNetworkStatusCallback=null):$t?(this._webOnlineCallback!==null&&(window.removeEventListener("online",this._webOnlineCallback),this._webOnlineCallback=null),this._onWebOffline!==null&&(window.removeEventListener("offline",this._webOfflineCallback),this._webOfflineCallback=null)):Ze&&this._removeListener&&(this._removeListener(),this._removeListener=null)}}]),Hc);function Hc(t){N(this,Hc),this._m=t,this._networkType=Ar,this._n="NetMonitorModule",this._mpNetworkStatusCallback=null,this._webOnlineCallback=null,this._webOfflineCallback=null,this._removeListener=null,this._m.getIEmitInst().on(Yt.A2KEY_AND_TINYID_UPDATED,this._startRN,this)}function Ls(t){N(this,Ls),(t=pa.call(this,t))._n="EventStatModule",t.TAG="im-ssolog-event",t._reportBody=new Bc,t.MIN_THRESHOLD=20,t.MAX_THRESHOLD=100,t.WAITING_TIME=6e4,t.REPORT_LEVEL=[4,5,6],t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._lastReportTime=Date.now();var o=t.getIEmitInst();return o.on(Yt.A2KEY_AND_TINYID_UPDATED,t._onLoginSuccess,te(t)),o.on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function Kc(t){N(this,Kc),this._n="SSOLogBody",this._report=[]}function Wc(t){N(this,Wc),this._m=t,this._n="StorageModule",this._storageQueue=new Map,this._errorTolerantHandle()}function Hu(t,o){return t(o={exports:{}},o.exports),o.exports}var Ku,Or=Hu(function(t){var o=Object.prototype.hasOwnProperty,i="~";function s(){}function c(I,C,S){this.fn=I,this.context=C,this.once=S||!1}function l(I,C,S,k,G){if(typeof S!="function")throw new TypeError("The listener must be a function");return S=new c(S,k||I,G),k=i?i+C:C,I._events[k]?I._events[k].fn?I._events[k]=[I._events[k],S]:I._events[k].push(S):(I._events[k]=S,I._eventsCount++),I}function p(I,C){--I._eventsCount==0?I._events=new s:delete I._events[C]}function m(){this._events=new s,this._eventsCount=0}Object.create&&(s.prototype=Object.create(null),new s().__proto__||(i=!1)),m.prototype.eventNames=function(){var I,C,S=[];if(this._eventsCount===0)return S;for(C in I=this._events)o.call(I,C)&&S.push(i?C.slice(1):C);return Object.getOwnPropertySymbols?S.concat(Object.getOwnPropertySymbols(I)):S},m.prototype.listeners=function(C){var C=i?i+C:C,S=this._events[C];if(!S)return[];if(S.fn)return[S.fn];for(var k=0,G=S.length,U=new Array(G);k<G;k++)U[k]=S[k].fn;return U},m.prototype.listenerCount=function(I){return I=i?i+I:I,I=this._events[I],I?I.fn?1:I.length:0},m.prototype.emit=function(I,C,S,k,G,U){var Y=i?i+I:I;if(!this._events[Y])return!1;var Z,$=this._events[Y],De=arguments.length;if($.fn){switch($.once&&this.removeListener(I,$.fn,void 0,!0),De){case 1:return $.fn.call($.context),!0;case 2:return $.fn.call($.context,C),!0;case 3:return $.fn.call($.context,C,S),!0;case 4:return $.fn.call($.context,C,S,k),!0;case 5:return $.fn.call($.context,C,S,k,G),!0;case 6:return $.fn.call($.context,C,S,k,G,U),!0}for(Ge=1,Z=new Array(De-1);Ge<De;Ge++)Z[Ge-1]=arguments[Ge];$.fn.apply($.context,Z)}else for(var _e,Pe=$.length,Ge=0;Ge<Pe;Ge++)switch($[Ge].once&&this.removeListener(I,$[Ge].fn,void 0,!0),De){case 1:$[Ge].fn.call($[Ge].context);break;case 2:$[Ge].fn.call($[Ge].context,C);break;case 3:$[Ge].fn.call($[Ge].context,C,S);break;case 4:$[Ge].fn.call($[Ge].context,C,S,k);break;default:if(!Z)for(_e=1,Z=new Array(De-1);_e<De;_e++)Z[_e-1]=arguments[_e];$[Ge].fn.apply($[Ge].context,Z)}return!0},m.prototype.on=function(I,C,S){return l(this,I,C,S,!1)},m.prototype.once=function(I,C,S){return l(this,I,C,S,!0)},m.prototype.removeListener=function(I,C,S,k){if(I=i?i+I:I,!this._events[I])return this;if(!C)return p(this,I),this;var G=this._events[I];if(G.fn)G.fn!==C||k&&!G.once||S&&G.context!==S||p(this,I);else{for(var U=0,Y=[],Z=G.length;U<Z;U++)(G[U].fn!==C||k&&!G[U].once||S&&G[U].context!==S)&&Y.push(G[U]);Y.length?this._events[I]=Y.length===1?Y[0]:Y:p(this,I)}return this},m.prototype.removeAllListeners=function(I){return I?(I=i?i+I:I,this._events[I]&&p(this,I)):(this._events=new s,this._eventsCount=0),this},m.prototype.off=m.prototype.removeListener,m.prototype.addListener=m.prototype.on,m.prefixed=i,t.exports=m.EventEmitter=m}),ks=["rich.my-imcloud.com","imrich.qcloud.com"],Wu=["requestSnapshotUrl"],ju=(z(As,Ht),Ku=J(As),V(As,[{key:"_init",value:function(){this._fileDownloadProxy=this.getFileDownloadProxy(),this._authKey=this.getDowloadFileAuthKey();var t=this.get(18);this.TIMUploadPlugin=t.getPlugin("tim-upload-plugin"),this.TIMUploadPlugin?this._initUploaderMethod():(this.COSSDK=t.getPlugin(t=qe?"cos-wx-sdk":"cos-js-sdk"),this.COSSDK?(this._getAuthorizationKey(),this.warn("CosReplacement",t)):this.warn("PluginUndetected"))}},{key:"_onCloudConfig",value:function(){var t=this,o="".concat(this._n,"._onCloudConfig"),i=this.getCloudConfig("upload_size_limit"),s=this.getCloudConfig("simple_cos"),c=this.getCloudConfig("file_dn_list");if(E.l("".concat(o," uploadSizeLimit:").concat(i," simpleCos:").concat(s)),!q(i))try{var l=JSON.parse(i);this.UPLOAD_SIZE_LIMIT={A:l.a?1048576*parseInt(l.a):this.UPLOAD_SIZE_LIMIT.A,F:l.f?1048576*parseInt(l.f):this.UPLOAD_SIZE_LIMIT.F,I:l.i?1048576*parseInt(l.i):this.UPLOAD_SIZE_LIMIT.I,V:l.v?1048576*parseInt(l.v):this.UPLOAD_SIZE_LIMIT.V}}catch(p){}if(q(s)||(this.isSimpleCos=s==="1"),!q(c))try{JSON.parse(c).forEach(function(p){t._fileDNList.includes(p)||t._fileDNList.push(p)})}catch(p){}}},{key:"_getAuthorizationKey",value:function(){var t=this,o="".concat(this._n,".").concat("_getAuthorizationKey"),i=new ue("_getAuthorizationKey"),s=Math.ceil(Date.now()/1e3);this.req({P:P.COS_SIGN,data:{duration:this.expiredTimeLimit}}).then(function(l){var l=l.data,p=(E.l("".concat(o," ok. data:"),l),l.expiredTime-s);i.setMessage("requestId:".concat(l.requestId," requestTime:").concat(s," expiredTime:").concat(l.expiredTime," diff:").concat(p,"s")).end(),!qe&&l.region&&(t.region=l.region),t.appid=l.appid,t.bucketName=l.bucketName,t.ciUrl=l.ciUrl,t.directory=l.directory,t.downloadUrl=l.downloadUrl,t.uploadUrl=l.uploadUrl,t.cosOptions={secretId:l.secretId,secretKey:l.secretKey,sessionToken:l.sessionToken,expiredTime:l.expiredTime},E.l("".concat(o," ok. region:").concat(t.region," bucketName:").concat(t.bucketName)),t._initUploaderMethod()}).catch(function(c){i.setError(c).end(),E.w("".concat(o," failed. error:"),c)})}},{key:"_getCosPreSigUrl",value:function(t){var o=this,i="".concat(this._n,".").concat("_getCosPreSigUrl"),s=Math.ceil(Date.now()/1e3),c=new ue("_getCosPreSigUrl"),l={uploadMethod:t.uploadMethod,platform:this.getPlatform(),SDKAppID:this.getSDKAppID(),userID:t.userID,conversationType:t.conversationType,uploadConfig:[{fileID:1,fileType:t.fileType,fileName:t.fileName}]},p=P.SIMPLE_COS_PRE_SIG;return this.isSimpleCos||(l={fileType:t.fileType,fileName:t.fileName,uploadMethod:t.uploadMethod,duration:t.duration},p=P.COS_PRE_SIG),this.req({P:p,data:l}).then(function(S){o.tryCount=0;var I,C,S=S.data||{},k=(E.l("".concat(i," ok. isSimpleCos:").concat(o.isSimpleCos," data:"),S),"");return k=o.isSimpleCos?(I=(C=S.preSig[0]).uploadUrl,C=C.fileKey,"uploadIP:".concat(S.uploadIP," uploadUrl:").concat(I," fileKey:").concat(C," cost:").concat(An(s))):"requestId:".concat(S.requestId," expiredTime:").concat(S.expiredTime," diff:").concat(S.expiredTime-s,"s"),c.setMessage(k).end(),S}).catch(function(m){return m.code===-1&&(m.code=Q.COS_GET_SIG_FAIL),c.setError(m).end(),E.w("".concat(i," failed. error:"),m),o.tryCount<1?(o.tryCount++,o._getCosPreSigUrl(t)):(o.tryCount=0,W({code:Q.COS_GET_SIG_FAIL}))})}},{key:"_initUploaderMethod",value:function(){var t=this;if(this.TIMUploadPlugin)return this.timUploadPlugin=new this.TIMUploadPlugin,void(this._cosUploadMethod=function(o,i){t.timUploadPlugin.uploadFile(o,i)});this.appid&&(this.cos=qe?new this.COSSDK({ForcePathStyle:!0,getAuthorization:this._getAuthorization.bind(this)}):new this.COSSDK({getAuthorization:this._getAuthorization.bind(this)}),this._cosUploadMethod=qe?function(o,i){t.cos.postObject(o,i)}:function(o,i){t.cos.uploadFiles(o,i)})}},{key:"onCheckTimer",value:function(t){this.COSSDK&&(this.TIMUploadPlugin||this.isLoggedIn()&&t%60==0&&Math.ceil(Date.now()/1e3)>=this.cosOptions.expiredTime-120&&this._getAuthorizationKey())}},{key:"getFileDNList",value:function(){return this._fileDNList}},{key:"_getAuthorization",value:function(t,o){o({TmpSecretId:this.cosOptions.secretId,TmpSecretKey:this.cosOptions.secretKey,XCosSecurityToken:this.cosOptions.sessionToken,ExpiredTime:this.cosOptions.expiredTime})}},{key:"upload",value:function(t){if(t._relayFlag===!0)return Promise.resolve();var o=this.get(26);switch(t.type){case O.MSG_IMAGE:return o.addTotalCount(oo),this._uploadImage(t);case O.MSG_FILE:return o.addTotalCount(oo),this._uploadFile(t);case O.MSG_AUDIO:return o.addTotalCount(oo),this._uploadAudio(t);case O.MSG_VIDEO:return o.addTotalCount(oo),this._uploadVideo(t);default:return Promise.resolve()}}},{key:"_uploadImage",value:function(t){var o=this,i=this.get(2),s=t.getElements()[0],c=i.getMessageOption(t.clientSequence);return this.doUploadImage({file:c.payload.file,to:c.to,message:t,onProgress:function(l){if(s.updatePercent(l),Ot(c.onProgress))try{c.onProgress(l)}catch(p){return W({code:Q.MSG_ONPROGRESS_ERR})}}}).then(function(_e){var p=_e.location,m=_e.fileType,I=_e.fileSize,C=_e.width,S=_e.height,k=_e.smallImageUrl,G=_e.smallImageWidth,U=_e.smallImageHeight,Y=_e.largeImageUrl,Z=_e.largeImageWidth,$=_e.largeImageHeight,De=_e.imageInfoArray,_e=o.isPrivateNetWork()?p:Vo(p);s.updateImageFormat(m);var Pe,Ge,et={size:I,url:_e,width:C,height:S};if(De&&0<De.length)for(var lt=0;lt<De.length;lt++){var We=De[lt];We.type===1?Pe=We:We.type===2?Ge=We:et=v(v({},et),We)}else Ge=k&&Y?(Pe={url:k,width:G,height:U},{url:Y,width:Z,height:$}):(Pe=pr({originUrl:_e,originWidth:C,originHeight:S,min:198}),pr({originUrl:_e,originWidth:C,originHeight:S,min:720}));return s.updateImageInfoArray([v({},et),v({},Ge),v({},Pe)]),t})}},{key:"_uploadFile",value:function(t){var o=this,i=this.get(2),s=t.getElements()[0],c=i.getMessageOption(t.clientSequence);return this.doUploadFile({file:c.payload.file,to:c.to,message:t,onProgress:function(l){if(s.updatePercent(l),Ot(c.onProgress))try{c.onProgress(l)}catch(p){return W({code:Q.MSG_ONPROGRESS_ERR})}}}).then(function(p){var p=p.location,m=p;return o.isPrivateNetWork()||(m=Zn(m=Vo(p),o._fileDownloadProxy,o._authKey,o._fileDNList)),s.updateFileUrl(m),t})}},{key:"_uploadAudio",value:function(t){var o=this,i=this.get(2),s=t.getElements()[0],c=i.getMessageOption(t.clientSequence);return this.doUploadAudio({file:c.payload.file,to:c.to,message:t,onProgress:function(l){if(s.updatePercent(l),Ot(c.onProgress))try{c.onProgress(l)}catch(p){return W({code:Q.MSG_ONPROGRESS_ERR})}}}).then(function(l){return l=l.location,l=o.isPrivateNetWork()?l:Vo(l),s.updateAudioUrl(l),t})}},{key:"_uploadVideo",value:function(t){var o=this,i=this.get(2),s=t.getElements()[0],c=i.getMessageOption(t.clientSequence);return this.doUploadVideo({file:c.payload.file,to:c.to,message:t,onProgress:function(l){if(s.updatePercent(l),Ot(c.onProgress))try{c.onProgress(l)}catch(p){return W({code:Q.MSG_ONPROGRESS_ERR})}}}).then(function(p){var m=p.location,p=p.snapshotInfo,m=o.isPrivateNetWork()?m:Vo(m);return s.updateVideoUrl(m),Te(p)||s.updateSnapshotInfo(p),t})}},{key:"_checkSizeError",value:function(t){var o="";return t==="A"?o="audio":t==="I"?o="image":t==="V"?o="video":t==="F"&&(o="file"),W({code:Q["MSG_".concat(t,"_SIZE_LIMIT")],message:this.getErrMsg("UploadSizeLimit",o,"".concat(this.UPLOAD_SIZE_LIMIT[t]/1048576,"MB"))})}},{key:"doUploadImage",value:function(t){var o=this;if(!t.file||this._isEmptyFileList(t.file.files))return W({code:Q.MSG_I_SELECT_F_FIRST});var i=this._checkImageType(t.file);if(i!==!0||(i=this._checkImageSize(t.file),i!==!0))return i;var s=null;return this._setUploadFileType(1),this.uploadByCOS(t).then(function(c){if(s=c,o.isPrivateNetWork())return fi(p);if(ye(s.imageInfoArray)){var l=s.imageInfoArray.find(function(m){return m.type===3});if(l)return l}if(Ze)return{width:t.file.width,height:t.file.height};var p=Vo(c.location);return o.COSSDK?fi(p):fi(p=Zn(p,o._fileDownloadProxy,o._authKey,o._fileDNList))}).then(function(c){return s.width=c.width,s.height=c.height,Promise.resolve(s)})}},{key:"_checkImageType",value:function(t){var o="",o=qe?t.url.slice(t.url.lastIndexOf(".")+1):Ze?t.type.split("/")[1]:t.files[0].name.slice(t.files[0].name.lastIndexOf(".")+1);return 0<=Xl.indexOf(o.toLowerCase())||W({code:Q.MSG_I_TYPES_LIMIT})}},{key:"_checkImageSize",value:function(t){return(t=(qe||Ze?t:t.files[0]).size)===0?W({code:Q.MSG_F_IS_EMPTY}):t<this.UPLOAD_SIZE_LIMIT.I||this._checkSizeError("I")}},{key:"doUploadFile",value:function(t){return!t.file||this._isEmptyFileList(t.file.files)?W({code:Q.MSG_F_SELECT_F_FIRST}):t.file.files[0].size>this.UPLOAD_SIZE_LIMIT.F?this._checkSizeError("F"):t.file.files[0].size===0?W({code:Q.MSG_F_IS_EMPTY}):(this._setUploadFileType(255),this.uploadByCOS(t))}},{key:"doUploadVideo",value:function(t){return t.file.videoFile.size>this.UPLOAD_SIZE_LIMIT.V?this._checkSizeError("V"):t.file.videoFile.size===0?W({code:Q.MSG_F_IS_EMPTY}):Ql.indexOf(t.file.videoFile.type)===-1?W({code:Q.MSG_V_TYPES_LIMIT}):(this._setUploadFileType(2),qe||Ze?this.handleVideoUpload(v(v({},t),{},{file:t.file.videoFile})):$t?this.handleVideoUpload(t):void 0)}},{key:"handleVideoUpload",value:function(t){var o=this;return new Promise(function(i,s){o.uploadByCOS(t).then(function(c){i(c)}).catch(function(){o.uploadByCOS(t).then(function(c){i(c)}).catch(function(){s(new Gt({code:Q.MSG_V_UPLOAD_FAIL}))})})})}},{key:"doUploadAudio",value:function(t){return t.file?t.file.size>this.UPLOAD_SIZE_LIMIT.A?this._checkSizeError("A"):t.file.size===0?W({code:Q.MSG_F_IS_EMPTY}):(this._setUploadFileType(3),this.uploadByCOS(t)):W({code:Q.MSG_A_UPLOAD_FAIL})}},{key:"uploadByCOS",value:function(t){var o=this;if(!Ot(this._cosUploadMethod))return this.warn("PluginUndetected"),W({code:Q.COS_UNDETECTED});if(this.timUploadPlugin)return this._uploadWithPreSigUrl(t);var i=new ue("upload"),s="".concat(this._n,".uploadByCOS"),c=Date.now(),l=this._getFile(t);return new Promise(function(p,m){var I=qe?o._createCosOptionsWXMiniApp(t):o._createCosOptionsWeb(t),C=o;o._cosUploadMethod(I,function(S,k){var G=Object.create(null);if(k){if(S||ye(k.files)&&k.files[0].error)return U=new Gt({code:Q.MSG_F_UPLOAD_FAIL}),i.setError(U).end(),E.l("".concat(s," failed. error:"),k.files[0].error),k.files[0].error.statusCode===403&&o._getAuthorizationKey(),void m(U);G.fileName=l.name,G.fileSize=l.size,G.fileType=l.type.slice(l.type.indexOf("/")+1).toLowerCase(),G.location=(qe?k:k.files[0].data).Location;var U=Date.now()-c,k=C._formatFileSize(l.size),Y=C._formatSpeed(1e3*l.size/U),k="size:".concat(k," time:").concat(U,"ms speed:").concat(Y),Y=(E.l("".concat(s," success. name:").concat(l.name," ").concat(k)),p(G),o.get(26));return Y.addCost(oo,U),Y.addFileSize(oo,l.size),void i.setMessage(k).end()}G=new Gt({code:Q.MSG_F_UPLOAD_FAIL}),i.setError(G).end(),E.w("".concat(s," failed. error:"),S),S.statusCode===403&&o._getAuthorizationKey(),m(G)})})}},{key:"_uploadWithPreSigUrl",value:function(t){var o=this,i="".concat(this._n,"._uploadWithPreSigUrl"),s=this._getFile(t);return this._createCosOptionsPreSigUrl(t).then(function(c){return new Promise(function(l,p){var m=new ue("upload"),I=c.requestSnapshotUrl,C=I===void 0?void 0:I,S=ae(c,Wu),k=Date.now();o._cosUploadMethod(S,function(G,U){var Y,Z,$;return G||U.statusCode===403?(m.setError(new Gt(G)).end(),Z={HttpStatusCode:9999,CostTime:An(k,!1),error:G,url:c.url},U.data&&U.data.uploadIP&&(Z.uploadIP=U.data.uploadIP),o._uploadSSOLog(Z),E.l("".concat(i," failed, error:"),G),void p(new Gt({code:Q.MSG_F_UPLOAD_FAIL}))):(Y=Object.create(null),Z=U.data.location||"",o.isPrivateNetWork()||Z.indexOf("https://")!==0&&Z.indexOf("http://")!==0||(Z=Z.split("//")[1]),Y.fileName=s.name,Y.fileSize=s.size,Y.fileType=s.type.slice(s.type.indexOf("/")+1).toLowerCase(),Y.location=Z,G=An(k,!1),Z=o._formatFileSize(s.size),$=o._formatSpeed(1e3*s.size/G),Z="size:".concat(Z," time:").concat(G,"ms speed:").concat($," res:").concat(JSON.stringify(U.data)),E.l("".concat(i," ok. name:").concat(s.name," ").concat(Z)),m.setMessage(Z).end(),$={HttpStatusCode:U.statusCode,FileSize:s.size,CostTime:G,url:c.url},U.data&&U.data.uploadIP&&($.uploadIP=U.data.uploadIP),o._uploadSSOLog($),(Z=o.get(26)).addCost(oo,G),Z.addFileSize(oo,s.size),$=[],S.thumbUrl&&S.largeUrl&&$.push.apply($,[o._getSmallImageInfoByUrl(S.thumbUrl,Y),o._getLargeImageInfoByUrl(S.largeUrl,Y)]),o.uploadFileType===1&&o.isSimpleCos&&!o.isPrivateNetWork()&&($.push(o._getImageInfoArray(S.downloadUrl,Y)),U.data.uploadIP&&$.push(o._getDownloadIP(S.downloadUrl.split("//")[1].split("/")[0],Y))),C&&$.push(o._getSnapshotInfoByUrl(C,Y)),0<$.length?Promise.all($).then(function(){l(Y)}):void l(Y))})})})}},{key:"_getDownloadIP",value:function(t,o){var i="".concat(this._n,"._getDownloadIP"),s=Date.now();return this.req({P:P.GET_IP,data:{domainName:t}}).then(function(c){var l;c.data&&c.data.ip&&(E.l("".concat(i," ok. downloadIP:").concat(c.data.ip," cost:").concat(An(s))),(l=o.location.split("/"))[0]=c.data.ip,o.location=l.join("/"))}).catch(function(c){})}},{key:"_getImageInfoArray",value:function(t,o){var i=this,s="".concat(this._n,"._getImageInfoArray"),c=Date.now();return this.req({P:P.GET_IMAGE_INFO,data:{imageUrl:t}}).then(function(l){return l=l.data||{},E.l("".concat(s," ok. data: ").concat(JSON.stringify(l)," cost:").concat(An(c))),o.imageInfoArray=l.imageInfoArray,l}).catch(function(l){o.imageInfoArray=void 0,i._uploadSSOLog({HttpStatusCode:1e4,CostTime:An(c,!1),url:t})})}},{key:"_uploadSSOLog",value:function(t){var o,i;this.isSimpleCos&&((o=new ue).setEventType(18),t.error&&o.setError(new Gt(t.error)),i="HttpStatusCode:".concat(t.HttpStatusCode,"|CosRequestId:").concat(t.CosRequestId||"","|")+"FileAlreadyExist:".concat(t.FileAlreadyExist||0,"|FileSize:").concat(t.FileSize||0,"|CostTime:").concat(t.CostTime),t.uploadIP&&(i+="|FinalIP:".concat(t.uploadIP)),o.setMessage("OK").setMoreMessage(t.url).setExtension(i).end())}},{key:"_getRawOrUploadProxyUrl",value:function(t){var o=this.get(12).getFileUploadProxy(),i=t;return i=o?t.replace(/^https:\/\/[^/]+/,o):i}},{key:"_getFile",value:function(t){return ye(t.file.files)||_c(t.file.files)?t.file.files[0]:t.file}},{key:"_formatFileSize",value:function(t){return t<1024?t+"B":t<1048576?Math.floor(t/1024)+"KB":Math.floor(t/1048576)+"MB"}},{key:"_formatSpeed",value:function(t){return t<=1048576?uo(t/1024,1)+"KB/s":uo(t/1048576,1)+"MB/s"}},{key:"_createCosOptionsWeb",value:function(t){var o=this._getFile(t),i=o.name,i=i.slice(i.lastIndexOf(".")),i=this._genFileName("".concat(mn(999999)).concat(i));return{files:[{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(i),Body:o}],SliceSize:1048576,onProgress:function(s){if(typeof t.onProgress=="function")try{t.onProgress(s.percent)}catch(c){E.w("onProgress callback error:",c)}},onFileFinish:function(s,c,l){}}}},{key:"_createCosOptionsWXMiniApp",value:function(t){var i=this._getFile(t),o=this._genFileName(i.name),i=i.url;return{Bucket:"".concat(this.bucketName,"-").concat(this.appid),Region:this.region,Key:"".concat(this.directory,"/").concat(o),FilePath:i,onProgress:function(s){if(E.l(JSON.stringify(s)),typeof t.onProgress=="function")try{t.onProgress(s.percent)}catch(c){E.w("onProgress callback error:",c)}}}}},{key:"_createCosOptionsPreSigUrl",value:function(t){var o,i=this,s="",c="",p=0,l=this._getFile(t),p=qe||Ze?(s=t.message.type===O.MSG_FILE?(o=(o=l.name).slice(o.lastIndexOf(".")),this._genFileName("".concat(mn(999999)).concat(o))):this._genFileName(l.name),c=l.url,1):(o=(o=l.name).slice(o.lastIndexOf(".")),s=this._genFileName("".concat(mn(999999)).concat(o)),c=l,0);return this._getCosPreSigUrl({fileType:this.uploadFileType,fileName:s,uploadMethod:p,duration:this.duration,userID:t.message.from,conversationType:Bt(t.message.conversationID)?1:2}).then(function(Y){var U=i.isSimpleCos?Y.preSig[0]:Y,I=U.uploadUrl,C=U.downloadUrl,S=U.requestSnapshotUrl,S=S===void 0?void 0:S,k=U.thumbUrl,G=U.largeUrl,U=U.fileKey,Y=Y.uploadIP,Y=Y===void 0?"":Y;return{url:i._getRawOrUploadProxyUrl(I),fileType:i.uploadFileType,fileName:s,resources:c,downloadUrl:C,requestSnapshotUrl:S,thumbUrl:k,largeUrl:G,fileKey:U,uploadIP:!i.isPrivateNetWork()&&Y,onProgress:function(Z){if(typeof t.onProgress=="function")try{t.onProgress(Z.percent)}catch($){E.w("onProgress callback error:",$),E.e($)}}}})}},{key:"_genFileName",value:function(t){return"".concat(yc(),"-").concat(t)}},{key:"_setUploadFileType",value:function(t){this.uploadFileType=t}},{key:"_getSnapshotInfoByUrl",value:function(t,o){var i=this,s="_getSnapshotInfoByUrl",c=new ue(s);return this.req({P:P.VIDEO_COVER,data:{platform:this.getPlatform(),coverName:this._genFileName(mn(99999)),requestSnapshotUrl:t}}).then(function(l){if(l=(l.data||{}).snapshotUrl,E.l("".concat(i._n,".").concat(s," ok. snapshotUrl:").concat(l)),c.setMessage("snapshotUrl:".concat(l)).end(),Te(l))return{};var p=Zn(l,i._fileDownloadProxy,i._authKey,i._fileDNList);return fi(p).then(function(m){o.snapshotInfo={snapshotUrl:p,snapshotWidth:m.width,snapshotHeight:m.height}})}).catch(function(l){return E.w("".concat(i._n,".").concat(s," failed. error:"),l),c.setCode(l.errorCode).setMessage(l.errorInfo).end(),{}})}},{key:"_getSmallImageInfoByUrl",value:function(t,o){return fi(Zn(t,this._fileDownloadProxy,this._authKey,this._fileDNList)).then(function(i){o.smallImageUrl=t,o.smallImageWidth=i.width,o.smallImageHeight=i.height})}},{key:"_getLargeImageInfoByUrl",value:function(t,o){return fi(Zn(t,this._fileDownloadProxy,this._authKey,this._fileDNList)).then(function(i){o.largeImageUrl=t,o.largeImageWidth=i.width,o.largeImageHeight=i.height})}},{key:"_isEmptyFileList",value:function(t){return!(!_c(t)||t.length!==0)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset"))}}]),As),Yu=["downloadKey","pbDownloadKey","messageList"],zu=(V(Nr,[{key:"uploadMergerMessage",value:function(s,o){var i="".concat(this._n,".").concat("uploadMergerMessage"),s=(E.d("".concat(i," message:"),s,"messageBytes:".concat(o)),JSON.parse(JSON.stringify(s.payload)).messageList),c=s.length,l=this._msgM.get(17).getFileDNList(),p=new ue("uploadMergerMessage");return s.forEach(function(m){za(m.messageBody[0].type,m.messageBody,l)}),this._msgM.req({P:P.UPLOAD_MERGER_MSG,data:{messageList:s}}).then(function(I){E.d("".concat(i," ok. response:"),I.data);var I=I.data,C=I.pbDownloadKey,I=I.downloadKey,C={pbDownloadKey:C,downloadKey:I,messageNumber:c};return p.setMessage("".concat(c,"-").concat(o,"-").concat(I)).end(),C}).catch(function(m){throw E.w("".concat(i," failed. error:"),m),p.setError(m).end(),m})}},{key:"downloadMergerMessage",value:function(t){var o=this,i="".concat(this._n,".").concat("downloadMergerMessage"),s=(E.d("".concat(i," message:"),t),t.payload.downloadKey),c=this._msgM.getFileDownloadProxy(),l=this._msgM.getDowloadFileAuthKey(),p=new ue("downloadMergerMessage");return p.setMessage("downloadKey:".concat(s)),this._msgM.req({P:P.DOWNLOAD_MERGER_MSG,data:{downloadKey:s}}).then(function(m){E.d("".concat(i," ok. response:"),m.data);var I,C,S=o._msgM.get(17).getFileDNList();return Ot(t.clearElement)?((I=t.payload).downloadKey,I.pbDownloadKey,I.messageList,I=ae(I,Yu),t.clearElement(),t.setElement({type:t.type,content:v({messageList:m.data.messageList},I)},c,l,S)):(C=[],m.data.messageList.forEach(function(k){Te(k)||(k=new yr(k,c,l,S),C.push(k))}),t.payload.messageList=C,t.payload.downloadKey="",t.payload.pbDownloadKey=""),p.end(),t}).catch(function(m){throw E.w("".concat(i," failed. key:").concat(s," error:"),m),p.setError(m).end(),m})}},{key:"createMergerMessagePack",value:function(t,o,i){return t.conversationType===O.CONV_C2C?this._createC2CMergerMessagePack(t,o,i):this._createGroupMergerMessagePack(t,o,i)}},{key:"_createC2CMergerMessagePack",value:function(t,o,I){var s=null,c=(o&&(o.offlinePushInfo&&(s=o.offlinePushInfo),o.onlineUserOnly===!0&&(s?s.disablePush=!0:s={disablePush:!0})),[]),l=(It(o)&&It(o.messageControlInfo)&&(l=(m=o.messageControlInfo).excludedFromUnreadCount,p=m.excludedFromLastMessage,m=m.excludedFromContentModeration,l===!0&&c.push("NoUnread"),p===!0&&c.push("NoLastMsg"),m===!0&&c.push("NoMsgCheck")),""),p=(Ee(t.cloudCustomData)&&0<t.cloudCustomData.length&&(l=t.cloudCustomData),I.pbDownloadKey),m=I.downloadKey,I=I.messageNumber,k=t.payload,C=k.title,S=k.abstractList,k=k.compatibleText,G=this._msgM.get(6),G=G&&G.isOnlineMessage(t,o)?0:void 0;return{P:P.SEND_C2C_MSG,data:{fromAccount:this._msgM.getMyUserID(),toAccount:t.to,msgBody:[{msgType:t.type,msgContent:{pbDownloadKey:p,downloadKey:m,title:C,abstractList:S,compatibleText:k,messageNumber:I}}],cloudCustomData:l,clientTime:t.clientTime,msgSeq:t.sequence,msgRandom:t.random,msgLifeTime:G,offlinePushInfo:cs(s),messageControlInfo:G!==0?c:void 0,isSupportExtension:t.isSupportExtension===!0?1:0,isRelayMessage:t._relayFlag===!0?1:0}}}},{key:"_createGroupMergerMessagePack",value:function(t,U,I){var s=null,c=(U&&U.offlinePushInfo&&(s=U.offlinePushInfo),[]),l=(It(U)&&It(U.messageControlInfo)&&(l=(m=U.messageControlInfo).excludedFromUnreadCount,p=m.excludedFromLastMessage,m=m.excludedFromContentModeration,l===!0&&c.push("NoUnread"),p===!0&&c.push("NoLastMsg"),m===!0&&c.push("NoMsgCheck")),""),p=(Ee(t.cloudCustomData)&&0<t.cloudCustomData.length&&(l=t.cloudCustomData),I.pbDownloadKey),m=I.downloadKey,I=I.messageNumber,k=t.payload,C=k.title,S=k.abstractList,k=k.compatibleText,G=this._msgM.get(7),U=G&&G.isOnlineMessage(t,U)?1:0;return{P:P.SEND_GRP_MSG,data:{fromAccount:this._msgM.getMyUserID(),groupID:t.to,msgBody:[{msgType:t.type,msgContent:{pbDownloadKey:p,downloadKey:m,title:C,abstractList:S,compatibleText:k,messageNumber:I}}],random:t.random,priority:t.priority,clientSequence:t.clientSequence,groupAtInfo:void 0,cloudCustomData:l,onlineOnlyFlag:U,offlinePushInfo:cs(s),clientTime:t.clientTime,needReadReceipt:t.needReadReceipt!==!0||G.isMessageFromOrToAVChatroom(t.to)?0:1,messageControlInfo:U==0?c:void 0,isSupportExtension:t.isSupportExtension===!0?1:0,isRelayMessage:t._relayFlag===!0?1:0}}}}]),Nr),Ju={ERR_SVR_COMM_SENSITIVE_TEXT:80001,ERR_SVR_COMM_BODY_SIZE_LIMIT:80002,OPEN_SERVICE_OVERLOAD_ERROR:60022,ERR_SVR_MSG_PKG_PARSE_FAILED:20001,ERR_SVR_MSG_INTERNAL_AUTH_FAILED:20002,ERR_SVR_MSG_INVALID_ID:20003,ERR_SVR_MSG_PUSH_DENY:20006,ERR_SVR_MSG_IN_PEER_BLACKLIST:20007,ERR_SVR_MSG_BOTH_NOT_FRIEND:20009,ERR_SVR_MSG_NOT_PEER_FRIEND:20010,ERR_SVR_MSG_NOT_SELF_FRIEND:20011,ERR_SVR_MSG_SHUTUP_DENY:20012,ERR_SVR_GROUP_INVALID_PARAMETERS:10004,ERR_SVR_GROUP_PERMISSION_DENY:10007,ERR_SVR_GROUP_NOT_FOUND:10010,ERR_SVR_GROUP_INVALID_GROUPID:10015,ERR_SVR_GROUP_REJECT_FROM_THIRDPARTY:10016,ERR_SVR_GROUP_SHUTUP_DENY:10017,MSG_SEND_FAIL:2100,OVER_FREQUENCY_LIMIT:2996},$u=[Q.MSG_ONPROGRESS_ERR,Q.MSG_I_SELECT_F_FIRST,Q.MSG_I_TYPES_LIMIT,Q.MSG_F_IS_EMPTY,Q.MSG_I_SIZE_LIMIT,Q.MSG_F_SELECT_F_FIRST,Q.MSG_F_SIZE_LIMIT,Q.MSG_V_SIZE_LIMIT,Q.MSG_V_TYPES_LIMIT,Q.MSG_A_UPLOAD_FAIL,Q.MSG_A_SIZE_LIMIT,Q.COS_UNDETECTED];function Nr(t){N(this,Nr),this._n="MergerMessageHandler",this._msgM=t}function As(t){N(this,As),(t=Ku.call(this,t))._n="UploadModule",t.TIMUploadPlugin=null,t.timUploadPlugin=null,t.COSSDK=null,t._cosUploadMethod=null,t.expiredTimeLimit=600,t.appid=0,t.bucketName="",t.ciUrl="",t.directory="",t.downloadUrl="",t.uploadUrl="",t.region="ap-shanghai",t.cos=null,t.cosOptions={secretId:"",secretKey:"",sessionToken:"",expiredTime:0},t.uploadFileType="",t.duration=900,t.tryCount=0,t.UPLOAD_SIZE_LIMIT={A:20971520,F:104857600,I:20971520,V:104857600},t.isSimpleCos=!1,t._fileDownloadProxy="",t._authKey="",t._fileDNList=ks;var o=t.getIEmitInst();return o.on(Yt.A2KEY_AND_TINYID_UPDATED,t._init,te(t)),o.on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function Xu(t){var o=!1;return Object.values(Ju).includes(t)&&(o=!0),o=120001<=t&&t<=13e4||10100<=t&&t<=10200?!0:o}z(li,Ht),Os=J(li),V(li,[{key:"createTextMessage",value:function(i){var s=this.getMyUserID(),o=(i.currentUser=s,i.senderTinyID=this.getMyTinyID(),new Mn(i)),i=Ee(i.payload)?i.payload:i.payload.text,i=new ci({text:i}),s=this._getNickAndAvatarByUserID(s);return o.setElement(i),o.setNickAndAvatar(s),o.setNameCard(this._getNameCardByGroupID(o)),o}},{key:"createImageMessage",value:function(t){var o=this.getMyUserID(),i=(t.currentUser=o,t.senderTinyID=this.getMyTinyID(),new Mn(t));if(qe){var c=t.payload.file;if(ko(c))return void this.warn("FileUnsupportedInMP","createImageMessage");var s=c.tempFiles[0].path||c.tempFiles[0].tempFilePath,c={url:s,name:s.slice(s.lastIndexOf("/")+1),size:c.tempFiles&&c.tempFiles[0].size||1,type:s.slice(s.lastIndexOf(".")+1).toLowerCase()};t.payload.file=c}else Ze?(c={url:(s=t.payload.file).uri,name:s.fileName,size:s.fileSize||1,type:s.type,width:s.width,height:s.height},t.payload.file=c):$t&&(ko(t.payload.file)?(s=t.payload.file,t.payload.file={files:[s]}):It(t.payload.file)&&typeof uni!="undefined"&&(c=t.payload.file.tempFiles[0],t.payload.file={files:[c]}));return s=new Ja({imageFormat:D.UNKNOWN,uuid:this._generateUUID(t.payload.file),file:t.payload.file}),c=this._getNickAndAvatarByUserID(o),i.setElement(s),i.setNickAndAvatar(c),i.setNameCard(this._getNameCardByGroupID(i)),this._messageOptionsMap.set(i.clientSequence,t),i}},{key:"createAudioMessage",value:function(t){var i=t.payload.file,s=(qe&&(s={url:i.tempFilePath,name:i.tempFilePath.slice(i.tempFilePath.lastIndexOf("/")+1),size:i.fileSize,second:parseInt(i.duration)/1e3,type:i.tempFilePath.slice(i.tempFilePath.lastIndexOf(".")+1).toLowerCase()},t.payload.file=s),Ze&&(s={url:i.uri,name:i.uri.slice(i.uri.lastIndexOf("/")+1),size:i.fileSize||1,second:Math.floor(i.duration/1e3),type:i.uri.slice(i.uri.lastIndexOf(".")+1).toLowerCase()},t.payload.file=s,Te(i.uri)&&this.warn("VoiceFileInRN")),this.getMyUserID()),o=(t.currentUser=s,t.senderTinyID=this.getMyTinyID(),new Mn(t)),i=new Xa({second:Math.floor(i.duration/1e3),size:i.fileSize||i.size||1,url:i.tempFilePath||i.uri,uuid:this._generateUUID(t.payload.file)}),s=this._getNickAndAvatarByUserID(s);return o.setElement(i),o.setNickAndAvatar(s),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,t),o}},{key:"createVideoMessage",value:function(t){var o=this.getMyUserID(),i=(t.currentUser=o,t.senderTinyID=this.getMyTinyID(),t.payload.file.thumbUrl="",t.payload.file.thumbSize=0,{});if(qe){if(Ct)return void this.warn("VideoUnsupportedInAlipay");if(ko(t.payload.file))return void this.warn("FileUnsupportedInMP","createVideoMessage");var s=t.payload.file;ye(s.tempFiles)&&(s=s.tempFiles[0]),i.url=s.tempFilePath,i.name=s.tempFilePath.slice(s.tempFilePath.lastIndexOf("/")+1),i.size=s.size||1,i.second=s.duration||0,i.type=s.tempFilePath.slice(s.tempFilePath.lastIndexOf(".")+1).toLowerCase()}else Ze?(s=t.payload.file,i.url=s.uri,i.name=s.fileName,i.size=s.fileSize||1,i.second=s.duration||0,i.type=s.type.split("/")[1]):$t&&(ko(t.payload.file)?(s=t.payload.file,t.payload.file.files=[s]):It(t.payload.file)&&typeof uni!="undefined"&&(s=t.payload.file.tempFile,t.payload.file.files=[s]),s=t.payload.file,i.url=window.URL.createObjectURL(s.files[0]),i.name=s.files[0].name,i.size=s.files[0].size||1,i.second=s.files[0].duration||0,i.type=s.files[0].type.split("/")[1]);return t.payload.file.videoFile=i,s=new Mn(t),i=new Za({videoFormat:i.type,videoSecond:uo(i.second,0),videoSize:i.size,remoteVideoUrl:"",videoUrl:i.url,videoUUID:this._generateUUID(t.payload.file.videoFile),thumbUUID:this._generateUUID(t.payload.file.videoFile),thumbWidth:t.payload.file.width||200,thumbHeight:t.payload.file.height||200,thumbUrl:t.payload.file.thumbUrl,thumbSize:t.payload.file.thumbSize,thumbFormat:t.payload.file.thumbUrl.slice(t.payload.file.thumbUrl.lastIndexOf(".")+1).toLowerCase()}),o=this._getNickAndAvatarByUserID(o),s.setElement(i),s.setNickAndAvatar(o),s.setNameCard(this._getNameCardByGroupID(s)),this._messageOptionsMap.set(s.clientSequence,t),s}},{key:"createCustomMessage",value:function(i){var s=this.getMyUserID(),o=(i.currentUser=s,i.senderTinyID=this.getMyTinyID(),new Mn(i)),i=new Qa({data:i.payload.data,description:i.payload.description,extension:i.payload.extension}),s=this._getNickAndAvatarByUserID(s);return o.setElement(i),o.setNickAndAvatar(s),o.setNameCard(this._getNameCardByGroupID(o)),o}},{key:"createFaceMessage",value:function(i){var s=this.getMyUserID(),o=(i.currentUser=s,i.senderTinyID=this.getMyTinyID(),new Mn(i)),i=new $a(i.payload),s=this._getNickAndAvatarByUserID(s);return o.setElement(i),o.setNickAndAvatar(s),o.setNameCard(this._getNameCardByGroupID(o)),o}},{key:"createMergerMessage",value:function(s){var o=this.getMyUserID(),o=(s.currentUser=o,s.senderTinyID=this.getMyTinyID(),this._getNickAndAvatarByUserID(o)),i=new Mn(s),s=new sa(s.payload);return i.setElement(s),i.setNickAndAvatar(o),i.setNameCard(this._getNameCardByGroupID(i)),i.setRelayFlag(!0),i}},{key:"createForwardMessage",value:function(t){var o=t.to,i=t.conversationType,s=t.priority,c=t.payload,l=t.needReadReceipt,p=t.receiverList;if(!ye(c._elements))return W({code:Q.MSG_FORWARD_INVALID_ELEMENTS});var m=this.getMyUserID(),I=this._getNickAndAvatarByUserID(m);return c.type===O.MSG_GRP_TIP?W({code:Q.MSG_FORWARD_TYPE_INVALID}):(i={to:o,conversationType:i,conversationID:"".concat(i).concat(o),priority:s,isPlaceMessage:0,status:Ha,currentUser:m,senderTinyID:this.getMyTinyID(),cloudCustomData:t.cloudCustomData||c.cloudCustomData||"",needReadReceipt:l,receiverList:p,isSupportExtension:t.isSupportExtension||!1},o=new Mn(i),o.setElement(c._elements[0]),o.setNickAndAvatar(I),o.setNameCard(this._getNameCardByGroupID(c)),o.setRelayFlag(!0),o)}},{key:"downloadMergerMessage",value:function(t){return this._mergerMessageHandler.downloadMergerMessage(t)}},{key:"createFileMessage",value:function(t){if(qe){if(!rn&&!St&&!Ce)return;var s=mt.getSystemInfoSync().SDKVersion;if(rn&&dr(s,"2.5.0")<0)return void this.warn("WXChooseMessageFile");if(St&&dr(s,"1.18.0")<0)return void this.warn("QQChooseMessageFile")}$t||Ce?ko(t.payload.file)?(s=t.payload.file,t.payload.file={files:[s]}):It(t.payload.file)&&typeof uni!="undefined"&&(i=(s=t.payload.file).tempFiles,s=s.files,o=null,ye(i)?o=i[0]:ye(s)&&(o=s[0]),t.payload.file={files:[o]}):rn||St?(s=v(v({},(i=t.payload.file.tempFiles)[0]),{},{url:i[0].path}),t.payload.file={files:[s]}):Ze&&(i=v(v({},o=t.payload.file),{},{url:o.uri}),t.payload.file={files:[i]});var s=this.getMyUserID(),o=(t.currentUser=s,t.senderTinyID=this.getMyTinyID(),new Mn(t)),i=new In({uuid:this._generateUUID(t.payload.file),file:t.payload.file}),s=this._getNickAndAvatarByUserID(s);return o.setElement(i),o.setNickAndAvatar(s),o.setNameCard(this._getNameCardByGroupID(o)),this._messageOptionsMap.set(o.clientSequence,t),o}},{key:"createLocationMessage",value:function(i){var s=this.getMyUserID(),o=(i.currentUser=s,i.senderTinyID=this.getMyTinyID(),new Mn(i)),i=new es(i.payload),s=this._getNickAndAvatarByUserID(s);return o.setElement(i),o.setNickAndAvatar(s),o.setNameCard(this._getNameCardByGroupID(o)),o}},{key:"_onNoModule",value:function(){return W({code:Q.NO_MODULE})}},{key:"sendMessageInstance",value:function(t,o){var i=this;if(this.get(29).filterMessage(t,o)===!1)return t.hasRiskContent=!0,this._onSendMessageFailed(t,new Gt({code:Q.PROFANITY_FOUND}));var s=null;if(t.conversationType===O.CONV_C2C)s=this.get(6);else{if(t.conversationType!==O.CONV_GROUP)return W({code:Q.MSG_INVALID_CONV_TYPE});s=this.get(7)}if(!s)return this._onNoModule();var c,l="".concat(this._n,".sendMessageInstance"),p=this.get(11),m=s.isOnlineMessage(t,o);return this.get(17).upload(t).then(function(){return i._getSendMessageSpecifiedKey(t)===ri&&i.get(26).addSuccessCount(oo),i._guardForGroup(t).then(function(){if(!t.isSendable())return W({code:Q.MSG_F_URL_IS_EMPTY});i._addSendMessageTotalCount(t),c=Date.now();var I=function(C){var S="utf-8";$t&&document&&(S=document.charset.toLowerCase());var k,G=0,U=C.length;if(S==="utf-8"||S==="utf8")for(var Y=0;Y<U;Y++)(k=C.codePointAt(Y))<=127?G+=1:k<=2047?G+=2:k<=65535?G+=3:(G+=4,Y++);else if(S==="utf-16"||S==="utf16")for(var Z=0;Z<U;Z++)(k=C.codePointAt(Z))<=65535?G+=2:(G+=4,Z++);else G=C.replace(/[^\x00-\xff]/g,"aa").length;return G}(JSON.stringify(t));return t.type===O.MSG_MERGER&&11264<I?i._mergerMessageHandler.uploadMergerMessage(t,I).then(function(C){return C=i._mergerMessageHandler.createMergerMessagePack(t,o,C),i.req(C)}):(p.setMessageRandom(t),s.sendMessage(t,o))}).then(function(G){var C,G=G.data,S=G.time,k=G.sequence,U=G.readReceiptCode,G=G.messageDropReason,U=(ut(U)&&U!==0&&(new ue("sendMessageWithReceipt").setMessage("from:".concat(t.from," to:").concat(t.to," sequence:").concat(k," readReceiptCode:").concat(U)).end(),E.w("".concat(l," readReceiptCode:").concat(U," message:").concat(i.getErrMsg(U)))),G&&(U=new ue("messageDropReason"),G="from:".concat(t.from," to:").concat(t.to," sequence:").concat(k," messageDropReason:").concat(G),U.setMessage(G).end(),E.w("".concat(l," ").concat(G))),i._addSendMessageSuccessCount(t,c),i._messageOptionsMap.delete(t.clientSequence),t.isResend===!0&&(C=p.findMessage(t.ID))&&(E.l("".concat(l," resend ok. ID:").concat(C.ID)),p.deleteLocalMessage(C)),t.status=Jn,t.time=S,!1);return t.conversationType===O.CONV_GROUP?t.sequence=k:t.conversationType!==O.CONV_C2C||(G=p.getLatestMessageSentByMe(t.conversationID))&&(C=G.nick,S=G.avatar,C===t.nick&&S===t.avatar||(U=!0)),U&&p.modifyMessageSentByMe({conversationID:t.conversationID,latestNick:t.nick,latestAvatar:t.avatar}),m===!0?t._onlineOnlyFlag=!0:(p.appendToMessageList(t),k=t,It(o)&&It(o.messageControlInfo)&&(o.messageControlInfo.excludedFromLastMessage===!0&&(t._isExcludedFromLastMessage=!0,k=""),o.messageControlInfo.excludedFromUnreadCount===!0&&(t._isExcludedFromUnreadCount=!0)),G=t.conversationType,Lt(t.to)&&(G=O.CONV_TOPIC,i.get(10).onMessageSent({groupID:un(t.to),topicID:t.to,lastMessage:k})),p.onMessageSent({conversationOptionsList:[{conversationID:t.conversationID,unreadCount:0,type:G,subType:t.conversationSubType,lastMessage:k}]})),t._relayFlag||t.type!=="TIMImageElem"||gr(t.payload.imageInfoArray),Ae({message:t})})}).catch(function(I){return i._onSendMessageFailed(t,I,m)})}},{key:"_guardForGroup",value:function(t){if(t.conversationType!==O.CONV_GROUP)return Promise.resolve();var o=this.get(7);if(!o)return this._onNoModule();if(bt({groupID:t.to})){var i=o.getLocalGroupProfile(t.to);if(i&&i.isSupportTopic)return W({code:Q.MSG_SEND_GRP_WITH_TOPIC_FAIL})}return o.guardForAVChatRoom(t)}},{key:"_onSendMessageFailed",value:function(t,o){var c=2<arguments.length&&arguments[2]!==void 0&&arguments[2],i="".concat(this._n,"._onSendMessageFailed"),s=(t.status=ai,o.code!==80001&&o.code!==80004||(t.hasRiskContent=!0),this.get(11)),l=(s.deleteMessageRandom(t),10100<=o.code&&o.code<=10200||120001<=o.code&&o.code<=13e4),c=(c||l||s.appendToMessageList(t)===!0&&E.l("".concat(i," message stored, ID:").concat(t.ID)),this._addSendMessageFailCountOnUser(t,o),new ue("sendMessage")),l="head.seq:".concat(o.data.headSeq," type:").concat(t.type," from:").concat(t.from," to:").concat(t.to);return $t&&("connection"in navigator&&(s=navigator.connection,l+=" downlink:".concat(s.downlink," effectiveType:").concat(s.effectiveType," rtt:").concat(s.rtt)),"memory"in window.performance&&(s=window.performance.memory,l+=" usedJSHeapSize:".concat(s.usedJSHeapSize," totalJSHeapSize:").concat(s.totalJSHeapSize," jsHeapSizeLimit:").concat(s.jsHeapSizeLimit))),c.setMessage(l).setError(o).end(),E.e("".concat(i," ").concat(l," error:"),o),W(new Gt({code:o&&o.code?o.code:Q.MSG_SEND_FAIL,message:o&&o.message?o.message:void 0,data:{message:t}}))}},{key:"_getSendMessageSpecifiedKey",value:function(t){if([O.MSG_IMAGE,O.MSG_AUDIO,O.MSG_VIDEO,O.MSG_FILE].includes(t.type))return ri;if(t.conversationType===O.CONV_C2C)return bo;if(t.conversationType===O.CONV_GROUP){var o=this.get(7);if(o&&(o=o.getLocalGroupProfile(t.to),o))return t=o.type,Vt(t)?oa:na}}},{key:"_addSendMessageTotalCount",value:function(t){t=this._getSendMessageSpecifiedKey(t),t&&this.get(26).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(s,o){var i,s=this._getSendMessageSpecifiedKey(s);s&&((i=this.get(26)).addSuccessCount(s),i.addCost(s,An(o,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(l,s){var i,s=s.code,s=s===void 0?-1:s,c=this.get(26),l=this._getSendMessageSpecifiedKey(l);l===ri&&(i=!1,i=$u.includes(s)?!0:i)?c.addFailedCountOfUserSide(oo):Xu(s)&&l&&c.addFailedCountOfUserSide(l)}},{key:"resendMessage",value:function(t,o){return t.isResend=!0,t.status=Ha,this.sendMessageInstance(t,o)}},{key:"revokeMessage",value:function(t){var o=this,i=null;if(t.conversationType===O.CONV_C2C?i=this.get(6):t.conversationType===O.CONV_GROUP&&(i=this.get(7)),!i)return this._onNoModule();var s=new ue("revokeMessage"),c=(s.setMessage("type:".concat(t.type," from:").concat(t.from," to:").concat(t.to)),"".concat(this._n,".").concat("revokeMessage"));return i.revokeMessage(t).then(function(p){var p=p.data.recallRetList;return Te(p)||p[0].retCode===0?(E.i("".concat(c," ok. ID:").concat(t.ID)),t.isRevoked=!0,s.end(),o.get(11).onMessageRevoked([t]),Ae({message:t})):(p=new Gt({code:p[0].retCode,data:{message:t}}),s.setCode(p.code).setMoreMessage(p.message).end(),W(p))}).catch(function(l){s.setError(l).end();var p=new Gt({code:l&&l.code?l.code:Q.MSG_REVOKE_FAIL,message:l&&l.message?l.message:void 0,data:{message:t}});return E.w("".concat(c," failed. error:"),l),W(p)})}},{key:"deleteMessage",value:function(t){var o=this,i=null,s=t[0],c=s.conversationID,l="",p=[],m=[];if(s.conversationType===O.CONV_C2C)i=this.get(6),l=c.replace(O.CONV_C2C,""),t.forEach(function(S){S&&S.status===Jn&&S.conversationID===c&&(S._onlineOnlyFlag||p.push("".concat(S.sequence,"_").concat(S.random,"_").concat(S.time)),m.push(S))});else if(s.conversationType===O.CONV_GROUP)i=this.get(7),l=c.replace(O.CONV_GROUP,""),t.forEach(function(S){S&&S.status===Jn&&S.conversationID===c&&(S._onlineOnlyFlag||p.push("".concat(S.sequence)),m.push(S))});else if(s.conversationType===O.CONV_SYSTEM)return W({code:Q.CANNOT_DELETE_GRP_SYSTEM_NOTICE});if(!i)return this._onNoModule();if(p.length===0)return this._onMessageDeleted(m);30<p.length&&(p=p.slice(0,30),m=m.slice(0,30));var I=new ue("deleteMessage"),C=(I.setMessage("to:".concat(l," count:").concat(p.length)),"".concat(this._n,".").concat("deleteMessage"));return i.deleteMessage({to:l,keyList:p}).then(function(S){return I.end(),E.i("".concat(C," ok")),o._onMessageDeleted(m)}).catch(function(S){return I.setError(S).end(),E.w("".concat(C," failed. error:"),S),S=new Gt({code:S&&S.code?S.code:Q.MSG_DELETE_FAIL,message:S&&S.message?S.message:void 0}),W(S)})}},{key:"_onMessageDeleted",value:function(t){return this.get(11).onMessageDeleted(t),we({messageList:t})}},{key:"translateText",value:function(c){var o="".concat(this._n,".").concat("translateText"),i=c.sourceTextList,s=c.sourceLanguage,c=c.targetLanguage,l=new ue("translateText");return l.setMessage("sourceLanguage:".concat(s," targetLanguage:").concat(c)),this.req({P:P.TRANSLATE_TEXT,data:{sourceTextList:i,source:s||"auto",target:c,from:this.getMyTinyID(),SDKAppID:this.getSDKAppID()}}).then(function(C){var C=C.data,m=C.error,I=C.requestID,C=C.translatedTextList;if(m.code===0)return l.end(),E.i("".concat(o," ok. requestID:").concat(I)),Ae({translatedTextList:C});throw v(v({},m),{},{requestID:I})}).catch(function(p){return l.setCode(p.code).setMoreMessage(p.requestID).end(),E.w("".concat(o," failed. error:"),p),W({code:Q.TRANSLATE_TEXT_FAIL})})}},{key:"convertVoiceToText",value:function(c){var i=c.message,c=c.language,o=i.payload.url,i=(i.from===this.getMyUserID()&&i.flow==="out"&&(o=i.payload.remoteAudioUrl),/\.(wav|pcm|ogg-opus|speex|silk|mp3|m4a|aac|amr)/);if(!i.test(o))return W({code:Q.UNSUPPORTED_VOICE_FORMAT});var i=i.exec(o)[1]||"mp3",s="16k_zh-PY",c=(c?c==="zh (cmn-Hans-CN)"?s="16k_zh":c==="en-US"?s="16k_en":c==="yue-Hant-HK"?s="16k_yue":c==="ja-JP"&&(s="16k_ja"):s="16k_zh-PY","serviceType:".concat(s," url:").concat(o)),l="".concat(this._n,".").concat("convertVoiceToText"),p=(E.i("".concat(l," ").concat(c)),new ue("convertVoiceToText"));return p.setMessage(c),this.req({P:P.VOICE_TO_TEXT,data:{url:o,language:s,SDKAppID:this.getSDKAppID(),format:i}}).then(function(S){var S=S.data,I=S.error,C=S.requestID,S=S.result;if(I.code===0)return p.end(),E.i("".concat(l," ok. requestID:").concat(C)),Ae({result:S});throw v(v({},I),{},{requestID:C})}).catch(function(m){return p.setCode(m.code).setMoreMessage(m.requestID||"").end(),E.w("".concat(l," failed. error:"),m),W({code:Q.VOICE_TO_TEXT_FAIL})})}},{key:"modifyRemoteMessage",value:function(t){var o=this;if(this.get(29).filterMessage(t)===!1)return t.hasRiskContent=!0,W({code:Q.PROFANITY_FOUND,data:{message:t}});var i=null,s=t.conversationType,c=t.to;if(s===O.CONV_C2C)i=this.get(6);else if(s===O.CONV_GROUP){if(!(i=this.get(7)))return this._onNoModule();if(i.isMessageFromOrToAVChatroom(c))return W({code:Q.MSG_MODIFY_DISABLED_IN_AV,data:{message:t}})}var l=new ue("modifyMessage"),p=(l.setMessage("to:".concat(c)),"".concat(this._n,".modifyRemoteMessage"));return i.modifyRemoteMessage(t).then(function(m){return l.end(),E.i("".concat(p," ok")),m=o._onModifyRemoteMessageResp(t,m.data),Ae({message:m})}).catch(function(m){var I;return l.setCode(m.code).setMoreMessage(m.message).end(),E.w("".concat(p," failed. error:"),m),m.code===20027?(I=o._onModifyRemoteMessageResp(t,m.data),W({code:Q.MSG_MODIFY_CONFLICT,data:{message:I}})):W({code:m.code,message:m.message,data:{message:t}})})}},{key:"_onModifyRemoteMessageResp",value:function(m,S){E.d("".concat(this._n,"._onModifyRemoteMessageResp options:"),S);var i=m.conversationType,s=m.from,c=m.to,l=m.random,p=m.sequence,m=m.time,I=S.elements,C=S.messageVersion,S=S.cloudCustomData,S=S===void 0?"":S;return this.get(11).onMessageModified({conversationType:i,from:s,to:c,time:m,random:l,sequence:p,elements:I,cloudCustomData:S,messageVersion:C})}},{key:"_generateUUID",value:function(i){var o=this.get(12),o="".concat(o.getSDKAppID(),"-").concat(o.getUserID(),"-").concat(mc()),i=i.name||i.value||i.url||i.tempFilePath,i=i&&i.slice(i.lastIndexOf(".")+1);return o=i?"".concat(o,".").concat(i):o}},{key:"getMessageOption",value:function(t){return this._messageOptionsMap.get(t)}},{key:"_getNickAndAvatarByUserID",value:function(t){return this.get(4).getNickAndAvatarByUserID(t)}},{key:"_getNameCardByGroupID",value:function(t){if(t.conversationType===O.CONV_GROUP){var o=this.get(7);if(o)return o.getMyNameCardByGroupID(t.to)}return""}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._messageOptionsMap.clear()}}]);var Qu,Zu,el,tl,nl,Os,Ns=li,bs=(z(qs,Ht),nl=J(qs),V(qs,[{key:"onMsgExtNotify",value:function(l){var o=this,l=l.dataList,m=l.messageInfo,i=l.operateType,s=l.operateResultList,c=l.tinyID,l=l.globalSequence,p=m.clientTime,m=m.random,I="".concat(c,"-").concat(p,"-").concat(m),C=[],S=[],k=(E.l("".concat(this._n,".onMsgExtNotify messageID:").concat(I," operateType:").concat(i," globalSequence:").concat(l)),this._updateGlobalSeq(I,l),!1),G=!1;s.forEach(function(U){var Y=U.extensions,Y=Y===void 0?[]:Y,Z=U.clearSequence;i===1?(k=!0,Y.forEach(function($){C.push({key:$.key,value:$.value})}),o._updateLocalExt(I,Y)):i===2?(G=!0,Y.forEach(function($){S.push($.key)}),o._updateLocalExt(I,Y)):i===3&&(G=!0,o._hasLocalExt(I)&&o._getLocalExt(I).forEach(function($,De){$.seq<=Z&&!Te($.value)&&S.push(De)}),o._clearLocalExt(I,Z))}),k&&this.emitOEvt(Me.MESSAGE_EXTENSIONS_UPDATED,{messageID:I,extensions:C}),G&&this.emitOEvt(Me.MESSAGE_EXTENSIONS_DELETED,{messageID:I,keyList:S})}},{key:"setMessageExtensions",value:function(t,C){var i="setMessageExtensions";if(!this.canIUse(Ue.MSG_EXT))return this.noUse(i);var s="".concat(this._n,".").concat(i),c=t.ID,l=t.conversationID,p=t.sequence,m=t.time,I=re(C),C=(20<C.length&&(I=C.slice(0,20),E.w("".concat(s,". the length of extensions cannot exceed 20."))),"convID:".concat(l," messageID:").concat(c," sequence:").concat(p," time:").concat(m," count:").concat(I.length)),S=new ue(i);return S.setMessage(C),E.l("".concat(s," ").concat(C)),this._modifyMsgExts(t,I).then(function(U){var G=U.resultList,Y=U.successCount,U=U.failureCount,Y="successCount:".concat(Y," failCount:").concat(U);return S.setMoreMessage(Y).end(),E.l("".concat(s," ok. ").concat(Y)),Ae({extensions:G})}).catch(function(k){return S.setError(k).end(),E.e("".concat(s," failed. error:"),k),W(k)})}},{key:"getMessageExtensions",value:function(t){var o=this,i="getMessageExtensions";if(!this.canIUse(Ue.MSG_EXT))return this.noUse(i);var s="".concat(this._n,".").concat(i),c=t.ID,m=t.conversationID,l=t.sequence,p=t.time,m="convID:".concat(m," messageID:").concat(c," sequence:").concat(l," time:").concat(p),I=new ue(i),C=(I.setMessage(m),E.l("".concat(s," ").concat(m)),void 0);return this.getMsgExtsMap.has(c)&&(C=this._getGlobalSeq(c)),this._getMsgExts(t,C).then(function(S){return I.end(),E.l("".concat(s," ok. extCount:").concat(S.length)),q(C)&&0<S.length&&o.getMsgExtsMap.set(c,1),Ae({extensions:S})}).catch(function(S){return I.setError(S).end(),E.e("".concat(s," failed. error:"),S),W(S)})}},{key:"deleteMessageExtensions",value:function(t,p){var i="deleteMessageExtensions";if(!this.canIUse(Ue.MSG_EXT))return this.noUse(i);var s="".concat(this._n,".").concat(i),c=[],l=3,p=(Te(p)||(l=2,p.forEach(function(k){c.push({key:k,value:"",seq:0})})),t.ID),C=t.conversationID,m=t.sequence,I=t.time,C="convID:".concat(C," messageID:").concat(p," sequence:").concat(m," time:").concat(I," operateType:").concat(l),S=new ue(i);return S.setMessage(C),E.l("".concat(s," ").concat(C)),this._modifyMsgExts(t,c,l).then(function(Y){var G=Y.resultList,U=Y.successCount,Y=Y.failureCount,Z="";return l===2&&(Z="success count:".concat(U," fail count:").concat(Y)),S.setMoreMessage("".concat(Z)).end(),E.l("".concat(s," ok. ").concat(Z)),Ae({extensions:G})}).catch(function(k){return S.setError(k).end(),E.e("".concat(s," failed. error:"),k),W(k)})}},{key:"_modifyMsgExts",value:function(t,o){var i=this,s=2<arguments.length&&arguments[2]!==void 0?arguments[2]:1,c=Lt(t.to)?O.CONV_TOPIC:t.conversationType,l=void 0,p=(s!==3&&(l=this._getReqExts(t,o)),null);switch(c){case O.CONV_C2C:p=this.get(6);break;case O.CONV_GROUP:p=this.get(7);break;case O.CONV_TOPIC:p=this.get(10);break;default:return W({code:Q.NO_MODULE})}return p.modifyMsgExts(t,l,s).then(function(C){var C=C.data,I=C.extensions,C=C.seq,S=[],k=0,G=0,U=[];return(I=Te(I)?[]:I).forEach(function(_e){var Z=_e.errorCode,_e=_e.extension,$=_e.key,De=_e.value,_e=_e.seq;S.push({code:Z,key:$,value:De}),Z===0?k++:G++,U.push({key:$,value:De,seq:_e})}),i._updateGlobalSeq(t.ID,C),0<U.length&&(i._updateLocalExt(t.ID,U),U=null),{resultList:S,successCount:k,failureCount:G}}).catch(function(m){return W(m)})}},{key:"_getReqExts",value:function(t,o){var i,s=[];return this._hasLocalExt(t.ID)?(i=this._getLocalExt(t.ID),o.forEach(function(p){var l=p.key,p=p.value,m=0;i.has(l)&&(m=i.get(l).seq),s.push({key:l,value:p,seq:m})})):o.forEach(function(p){var l=p.key,p=p.value;s.push({key:l,value:p,seq:0})}),s}},{key:"_getMsgExts",value:function(t,o){var i=this,s="".concat(this._n,"._getMsgExts"),c=t.ID,l=t.to,p=null;switch(Lt(l)?O.CONV_TOPIC:t.conversationType){case O.CONV_C2C:p=this.get(6);break;case O.CONV_GROUP:p=this.get(7);break;case O.CONV_TOPIC:p=this.get(10);break;default:return W({code:Q.NO_MODULE})}return p.getMessageExtensions(t,o).then(function(S){var S=S.data,k=S.extensions,I=S.completeFlag,C=S.globalSequence,S=S.clearSequence,k=Te(k)?[]:k;return E.l("".concat(s," ok. completeFlag:").concat(I," globalSequence:").concat(C," clearSequence:").concat(S," count:").concat(k.length)),i._updateLocalExt(c,k),i._clearLocalExt(c,S),i._updateGlobalSeq(c,C),I!==1?(S=k.slice(-1)[0].seq+1,i._getMsgExts(t,S)):i._getLocalExtList(c)}).catch(function(m){return W(m)})}},{key:"_hasLocalExt",value:function(t){return this.msgExtMap.has(t)}},{key:"_getLocalExt",value:function(t){return this.msgExtMap.get(t)}},{key:"_updateLocalExt",value:function(t,o){this._hasLocalExt(t)||this.msgExtMap.set(t,new Map);var i=this._getLocalExt(t);o.forEach(function(p){var c=p.key,l=p.value,p=p.seq;i.set(c,{value:l===void 0?"":l,seq:p})})}},{key:"_clearLocalExt",value:function(t,o){var i;o<=0||!this._hasLocalExt(t)||(i=this._getLocalExt(t)).forEach(function(s,c){s.seq<=o&&i.delete(c)})}},{key:"_getLocalExtList",value:function(t){var o=[];return this._hasLocalExt(t)&&this._getLocalExt(t).forEach(function(i,s){i=i.value,Te(i)||o.push({key:s,value:i})}),o}},{key:"_getGlobalSeq",value:function(t){return this.globalSeqMap.get(t)}},{key:"_updateGlobalSeq",value:function(t,o){this.globalSeqMap.set(t,o)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this.msgExtMap.clear(),this.globalSeqMap.clear(),this.getMsgExtsMap.clear()}}]),qs),Ps=(z(ki,Ht),tl=J(ki),V(ki,[{key:"onReactionNotifyList",value:function(i){var o=this,i=(i||{}).dataList;(i===void 0?[]:i).forEach(function(c){var p=c.C2CMessageInfo,m=c.groupMessageInfo,m=m===void 0?{}:m,c=c.reactionList,c=c===void 0?[]:c,p=v(v({},p===void 0?{}:p),m),m=p.tinyID,l=p.clientTime,p=p.random,m="".concat(m,"-").concat(l,"-").concat(p),I=[];c.forEach(function(C){q(C.userIDList)&&(C.userIDList=[],C.count=0),I.push.apply(I,re(C.userIDList))}),E.l("".concat(o._n,".onReactionNotifyList messageID:").concat(m," reactionList:").concat(c.length)),o._handleReactionSummary([{messageID:m,reactionList:c}],I).then(function(C){o.emitOEvt(Me.MESSAGE_REACTIONS_UPDATED,v({},C[0]))})})}},{key:"onReactionNotify",value:function(i){var i=i.dataList||{},s=i.C2CMessageInfo,c=i.groupMessageInfo,c=c===void 0?{}:c,o=i.reactionID,i=i.operateType,s=v(v({},s===void 0?{}:s),c),c=s.tinyID,l=s.clientTime,s=s.random,c="".concat(c,"-").concat(l,"-").concat(s),l=(E.l("".concat(this._n,".onReactionNotify messageID:").concat(c," reactionID:").concat(o," operateType:").concat(i)),i===1?this._addReactedByMyselfMap(c,o):this._removeReactedByMyselfMap(c,o),"".concat(c,"-").concat(o));this._reactionInfoMap.has(l)&&((s=this._reactionInfoMap.get(l)).reactedByMyself=i===1,this.emitOEvt(Me.MESSAGE_REACTIONS_UPDATED,{messageID:c,reactionList:[s]}))}},{key:"addMessageReaction",value:function(t,o){var i=this,s="addMessageReaction";if(!this.canIUse(Ue.MSG_REACTION))return this.noUse(s);var c="".concat(this._n,".").concat(s),m=t.ID,l=t.conversationID,l="convID:".concat(l," messageID:").concat(m," reactionID:").concat(o),p=new ue(s),m=(p.setMessage(l),E.l("".concat(c," ").concat(l)),this._createReactionOperationPack(t,o,1));return this._addReactedByMyselfMap(t.ID,o),this.req(m).then(function(){return p.end(),E.l("".concat(c," ok.")),Ae()}).catch(function(I){return i._removeReactedByMyselfMap(t.ID,o),p.setError(I).end(),E.e("".concat(c," failed. error:"),I),W(I)})}},{key:"removeMessageReaction",value:function(t,o){var i="removeMessageReaction";if(!this.canIUse(Ue.MSG_REACTION))return this.noUse(i);var s="".concat(this._n,".").concat(i),p=t.ID,c=t.conversationID,c="convID:".concat(c," messageID:").concat(p," reactionID:").concat(o),l=new ue(i),p=(l.setMessage(c),E.l("".concat(s," ").concat(c)),this._createReactionOperationPack(t,o,2));return this._removeReactedByMyselfMap(t.ID,o),this.req(p).then(function(){return l.end(),E.l("".concat(s," ok.")),Ae()}).catch(function(m){return l.setError(m).end(),E.e("".concat(s," failed. error:"),m),W(m)})}},{key:"getMessageReactions",value:function(t){var o=this,i="getMessageReactions";if(!this.canIUse(Ue.MSG_REACTION))return this.noUse(i);var s="".concat(this._n,".").concat(i),c=t.messageList,I=t.maxUserCountPerReaction,l=c[0].conversationID,l="convID:".concat(l," maxUserCountPerReaction:").concat(I," msgCount:").concat(c.length),p=new ue(i),m=(p.setMessage(l),E.l("".concat(s," ").concat(l)),new Map),I=this._createReactionSummaryPack(v(v({},t),{},{messageIDMap:m}));return this.req(I).then(function(S){var S=S.data.resultList,k=[],G=[];return(S===void 0?[]:S).forEach(function(Z){var Y=Z.messageKey,Y=Y===void 0?void 0:Y,$=Z.messageSequence,$=$===void 0?void 0:$,Z=Z.reactionList,Z=Z===void 0?[]:Z,$=q(Y)?m.get($):m.get(Y);k.push({messageID:$,reactionList:Z}),Z.forEach(function(De){G.push.apply(G,re(De.userIDList))})}),o._handleReactionSummary(k,G)}).then(function(C){return p.end(),E.l("".concat(s," ok.")),m.clear(),Ae({resultList:C})}).catch(function(C){return p.setError(C).end(),E.e("".concat(s," failed. error:"),C),W(C)})}},{key:"getAllUserListOfMessageReaction",value:function(t){var o=this,i="getAllUserListOfMessageReaction";if(!this.canIUse(Ue.MSG_REACTION))return this.noUse(i);var s="".concat(this._n,".").concat(i),m=t.message,c=t.reactionID,l=t.nextSeq,p=t.count,S=m.ID,m=m.conversationID,m="convID:".concat(m," messageID:").concat(S," reactionID:").concat(c," nextSeq:").concat(l," count:").concat(p),I=new ue(i),C=(I.setMessage(m),E.l("".concat(s," ").concat(m)),{userList:[],nextSeq:0,isCompleted:!1}),S=this._createReactionUserListPack(t);return this.req(S).then(function(U){var U=U.data,G=U.userIDList,G=G===void 0?[]:G,U=U.nextSeq,U=U===void 0?0:U;return C.nextSeq=U,C.isCompleted=U===0,o.get(4).getUserNickAndAvatar(G)}).then(function(k){return C.userList=k,I.end(),E.l("".concat(s," ok.")),Ae(C)}).catch(function(k){return I.setError(k).end(),E.e("".concat(s," failed. error:"),k),W(k)})}},{key:"_createReactionOperationPack",value:function(t,p,i){var s,c,l=void 0,p={reactionID:p,userIDList:[this.getMyUserID()]};return t.conversationType===O.CONV_C2C&&(s=this.get(6),l=i===1?P.ADD_C2C_MSG_REACTION:P.RM_C2C_MSG_REACTION,p.from=t.from,p.to=t.to,p.messageKey=s.getMessageKey(t)),t.conversationType===O.CONV_GROUP&&(s=void 0,c=t.to,Lt(t.to)&&(c=un(s=t.to)),l=i===1?P.ADD_GRP_MSG_REACTION:P.RM_GRP_MSG_REACTION,p.groupID=c,p.topicID=s,p.messageSequence=t.sequence),{P:l,data:p}}},{key:"_createReactionSummaryPack",value:function(m){var o,i,s,c=m.messageList,l=m.maxUserCountPerReaction,l=l===void 0?10:l,p=m.messageIDMap,m=c[0],I=void 0,C=void 0;return m.conversationType===O.CONV_C2C&&(o=this.get(6),i=c.map(function(S){var k=o.getMessageKey(S);return p.set(k,S.ID),k}),I=P.GET_C2C_MSG_REACTIONS,C={from:m.from,to:m.to,messageKeyList:i,count:l}),m.conversationType===O.CONV_GROUP&&(i=void 0,s=m.to,Lt(m.to)&&(s=un(i=m.to)),m=c.map(function(S){return p.set(S.sequence,S.ID),S.sequence}),I=P.GET_GRP_MSG_REACTIONS,C={groupID:s,topicID:i,messageSequenceList:m,count:l}),{P:I,data:C}}},{key:"_createReactionUserListPack",value:function(s){var o=s.message,l=s.reactionID,i=s.nextSeq,s=s.count,s=s===void 0?100:s,c=void 0,l={reactionID:l,nextSeq:i===void 0?0:i,count:100<s?100:s};return o.conversationType===O.CONV_C2C&&(i=this.get(6),c=P.GET_C2C_MSG_REACTION_USER_LIST,l.from=o.from,l.to=o.to,l.messageKey=i.getMessageKey(o)),o.conversationType===O.CONV_GROUP&&(s=void 0,i=o.to,Lt(o.to)&&(i=un(s=o.to)),c=P.GET_GRP_MSG_REACTION_USER_LIST,l.groupID=i,l.topicID=s,l.messageSequence=o.sequence),{P:c,data:l}}},{key:"_handleReactionSummary",value:function(t,o){var i=this;return this.get(4).getUserNickAndAvatar(o).then(function(s){var c=[];return t.forEach(function(l){var p=[];l.reactionList.forEach(function(S){var I=S.reactionID,C=S.count,G=S.userIDList,S=S.reactedByMyself,S=S===void 0?void 0:S,k=[],G=(G.forEach(function(U){s.forEach(function(Y){U===Y.userID&&k.push(Y)})}),{reactionID:I,totalUserCount:C,partialUserList:k,reactedByMyself:i._computeReactedByMyself({reactedByMyself:S,messageID:l.messageID,reactionID:I})});p.push(G),q(S)&&!i._reactedByMyselfMap.has(l.messageID)&&(C="".concat(l.messageID,"-").concat(I),i._reactionInfoMap.set(C,G))}),c.push({messageID:l.messageID,reactionList:p})}),c})}},{key:"_addReactedByMyselfMap",value:function(t,o){this._reactedByMyselfMap.has(t)||this._reactedByMyselfMap.set(t,[]),t=this._reactedByMyselfMap.get(t),t.indexOf(o)===-1&&t.push(o)}},{key:"_removeReactedByMyselfMap",value:function(t,o){!this._reactedByMyselfMap.has(t)||-1<(o=(t=this._reactedByMyselfMap.get(t)).indexOf(o))&&t.splice(o,1)}},{key:"_computeReactedByMyself",value:function(s){var o=s.reactedByMyself,i=s.messageID,s=s.reactionID;return q(o)?!!this._reactedByMyselfMap.has(i)&&this._reactedByMyselfMap.get(i).includes(s):o===1}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._reactedByMyselfMap.clear(),this._reactionInfoMap.clear()}}]),ki),Gs=(z(ha,Ht),el=J(ha),V(ha,[{key:"sendMessage",value:function(t){var o=this,i=this._createMsg(t);if(i===null)return W({code:Q.MSG_SEND_FAIL});this._addSendMessageTotalCount(i);var s=Date.now();return this.get(11).setMessageRandom(i),this._sendComboMessage(i,t).then(function(p){var p=p.data,m=p.time,l=p.sequence,p=p.readReceiptCode,p=(ut(p)&&p!==0&&(new ue("sendMessageWithReceipt").setMessage("from:".concat(i.from," to:").concat(i.to," sequence:").concat(l," readReceiptCode:").concat(p)).end(),E.w("".concat(o._n,".sendMessage readReceiptCode:").concat(p," message:").concat(o.getErrMsg(p)))),o._addSendMessageSuccessCount(i,s),o.get(11)),m=(i.status=Jn,i.time=m,i.conversationType===O.CONV_GROUP&&(i.sequence=l),p.appendToMessageList(i),i);return i._isExcludedFromLastMessage===!0&&(m=""),p.onMessageSent({conversationOptionsList:[{conversationID:i.conversationID,unreadCount:0,type:i.conversationType,subType:i.conversationSubType,lastMessage:m}]}),Ae({message:i})}).catch(function(c){return o._onSendMessageFailed(i,c)})}},{key:"_sendComboMessage",value:function(t,o){var i=this._m.get(20),s="";return t.conversationType===O.CONV_C2C&&(s="".concat(se.NAME.OPEN_IM,".").concat(P.SEND_C2C_MSG)),t.conversationType===O.CONV_GROUP&&(s="".concat(se.NAME.GRP,".").concat(P.SEND_GRP_MSG)),i.sendComboMessage({servcmd:s,data:o})}},{key:"_createMsg",value:function(t){var o="".concat(this._n,"._createMsg"),i=null;try{var s,c=this.getMyUserID(),l={};l.senderTinyID=this.getMyTinyID(),l.currentUser=c,l.from=t.From_Account||c,t.GroupId?(l.conversationID="".concat(O.CONV_GROUP).concat(t.GroupId),l.conversationType=O.CONV_GROUP,l.to=t.GroupId):t.To_Account&&(l.conversationID="".concat(O.CONV_C2C).concat(t.To_Account),l.conversationType=O.CONV_C2C,l.to=t.To_Account),l.time=t.MsgTimeStamp||0,l.random=t.Random||t.MsgRandom||0,l.priority=t.MsgPriority,Ee(t.CloudCustomData)&&0<t.CloudCustomData.length&&(l.cloudCustomData=t.CloudCustomData),ye(t.SendMsgControl)&&(l.messageControlInfo={},t.SendMsgControl.includes("NoUnread")&&(l.messageControlInfo.excludedFromUnreadCount=1),t.SendMsgControl.includes("NoLastMsg")&&(l.messageControlInfo.excludedFromLastMessage=1)),l.conversationType===O.CONV_GROUP&&ye(t.To_Account)&&0<t.To_Account.length&&(s=t.To_Account,50<t.To_Account.length&&(s=t.To_Account.slice(0,50),E.w("".concat(o," To_Account must be less than or equal to 50."))),l.receiverList=re(s),t.To_Account=re(s)),t.IsNeedReadReceipt!==1&&t.NeedReadReceipt!==1||(l.needReadReceipt=!0),t.SupportMessageExtension===1&&(l.isSupportExtension=!0),(i=new Mn(l)).status=Ha,t.MsgClientTime=i.clientTime,i.conversationType===O.CONV_C2C&&(t.MsgSeq=i.sequence);for(var p,m=t.MsgBody.length,I=0;I<m;I++)(p=t.MsgBody[I]).MsgType==="TIMTextElem"?i.setTextElement(p.MsgContent.Text):p.MsgType==="TIMCustomElem"?i.setCustomElement({data:p.MsgContent.Data||"",description:p.MsgContent.Desc||"",extension:p.MsgContent.Ext||""}):p.MsgType==="TIMFaceElem"&&i.setFaceElement({index:p.MsgContent.Index,data:p.MsgContent.Data});var C=i.getElements();i.payload=C[0].content,i.type=C[0].type}catch(S){i=null,E.e("".concat(o," failed. error:"),S)}return i}},{key:"_onSendMessageFailed",value:function(t,o){t.status=ai,this.get(11).deleteMessageRandom(t),this._addSendMessageFailCountOnUser(t,o);var i=new ue("sendMessage"),s="head.seq:".concat(o.data.headSeq,"  type:").concat(t.type," from:").concat(t.from," to:").concat(t.to);return i.setMessage(s).setError(o).end(),E.e("".concat(this._n,"._onSendMessageFailed ").concat(s," error:"),o),W(new Gt({code:o&&o.code?o.code:Q.MSG_SEND_FAIL,message:o&&o.message?o.message:void 0,data:{message:t}}))}},{key:"_getSendMessageSpecifiedKey",value:function(t){if(t.conversationType===O.CONV_C2C)return bo;if(t.conversationType===O.CONV_GROUP){var t=this.get(7).getLocalGroupProfile(t.to);if(t)return t=t.type,Vt(t)?oa:na}}},{key:"_addSendMessageTotalCount",value:function(t){t=this._getSendMessageSpecifiedKey(t),t&&this.get(26).addTotalCount(t)}},{key:"_addSendMessageSuccessCount",value:function(s,o){var i,s=this._getSendMessageSpecifiedKey(s);s&&((i=this.get(26)).addSuccessCount(s),i.addCost(s,An(o,!1)))}},{key:"_addSendMessageFailCountOnUser",value:function(c,i){var i=i.code,i=i===void 0?-1:i,s=this.get(26),c=this._getSendMessageSpecifiedKey(c);Xu(i)&&c&&s.addFailedCountOfUserSide(c)}}]),ha),Us=(z(xs,Ht),Zu=J(xs),V(xs,[{key:"registerPlugin",value:function(t){var o=this,i="0";Object.keys(t).forEach(function(s){o.plugins[s]=t[s],s==="tim-upload-plugin"&&typeof t[s].getVersion=="function"&&(i=t[s].getVersion())}),new ue("registerPlugin").setMessage("".concat(Object.keys(t))).setMoreMessage("version:".concat(i)).end()}},{key:"getPlugin",value:function(t){return this.plugins[t]}},{key:"reset",value:function(){}}]),xs),ws=(z(Fs,Ht),Qu=J(Fs),V(Fs,[{key:"_init",value:function(){this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"_startSync",value:function(t){var o=this,i=t.cookie,s=t.syncFlag,c=t.isOnlineSync,l="".concat(this._n,"._startSync"),p=(E.l("".concat(l," options:"),t),new ue("syncUnread"));p.setMessage(JSON.stringify(t)),this.req({P:P.SYNC_UNREAD_MSG,data:{cookie:i,syncFlag:s,isOnlineSync:c}}).then(function(m){var C=m.data,I=C.cookie,C=C.syncFlag,S="$cookie:".concat(I," syncFlag:").concat(C);E.l("".concat(l," ok. ").concat(S)),o._cookie=I,p.setMoreMessage(S).end(),Te(I)||(C===0||C===1?(o._dispatch(v(v({},m.data),{},{isSyncingEnded:!1})),o._startSync({cookie:I,syncFlag:C,isOnlineSync:0})):C===2&&o._dispatch(v(v({},m.data),{},{isSyncingEnded:!0})))}).catch(function(m){p.setError(m).end(),E.e("".concat(l," failed. error:"),m)})}},{key:"_dispatch",value:function(t){t.eventArray&&this.get(20).onMessage({head:{},body:{eventArray:t.eventArray,isInstantMessage:this._onlineSyncFlag,isSyncingEnded:t.isSyncingEnded}}),this.get(6).onNewMessage({dataList:t.messageList,isInstantMessage:!!t.isSyncingEnded&&this._onlineSyncFlag,C2CRemainingUnreadList:t.C2CRemainingUnreadList,C2CPairUnreadList:t.C2CPairUnreadList,isSyncingEnded:t.isSyncingEnded})}},{key:"syncOnNeed",value:function(){E.l("".concat(this._n,".syncOnNeed cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:1})}},{key:"syncOnReconnected",value:function(){E.l("".concat(this._n,".syncOnReconnected cookie:").concat(this._cookie)),this._onlineSyncFlag=!0,this._startSync({cookie:this._cookie,syncFlag:0,isOnlineSync:0})}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._onlineSyncFlag=!1,this._cookie=""}}]),Fs),ga={req:{toAccount:"To_Account",fromAccount:"From_Account",to:"To_Account",from:"From_Account",groupID:"GroupId",groupAtUserID:"GroupAt_Account",extension:"Ext",data:"Data",description:"Desc",elements:"MsgBody",sizeType:"Type",downloadFlag:"Download_Flag",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",videoUrl:"",imageUrl:"URL",fileUrl:"Url",uuid:"UUID",priority:"MsgPriority",receiverUserID:"To_Account",receiverGroupID:"GroupId",messageSender:"SenderId",messageReceiver:"ReceiverId",nick:"From_AccountNick",avatar:"From_AccountHeadurl",messageNumber:"MsgNum",pbDownloadKey:"PbMsgKey",downloadKey:"JsonMsgKey",applicationType:"PendencyType",userIDList:"To_Account",groupNameList:"GroupName",userID:"To_Account",groupAttributeList:"GroupAttr",mainSequence:"AttrMainSeq",avChatRoomKey:"BytesKey",attributeControl:"AttrControl",sequence:"seq",messageControlInfo:"SendMsgControl",updateSequence:"UpdateSeq",clientTime:"MsgClientTime",sequenceList:"MsgSeqList",topicID:"TopicId",customData:"CustomString",isSupportTopic:"SupportTopic",isWebUniapp:"is_web_uniapp",isSupportExtension:"SupportMessageExtension",messageSequence:"MsgSeq",messageKey:"MsgKey",startSequence:"startSeq",simplifiedMessage:"DownsizeFlag",isRelayMessage:"IsRelayMsg",reactionID:"Reaction",messageSequenceList:"MsgSeqList",messageKeyList:"MsgKeyList",cmConfigID:"CustomModerationConfigID"},res:{MsgPriority:"priority",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",Download_Flag:"downloadFlag",GroupId:"groupID",Member_Account:"userID",MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",MsgSeq:"sequence",MsgRandom:"random",MsgTime:"time",MsgTimeStamp:"time",MsgContent:"content",MsgBody:"elements",From_AccountNick:"nick",From_AccountHeadurl:"avatar",GroupWithdrawInfoArray:"revokedInfos",GroupReadInfoArray:"groupMessageReadNotice",LastReadMsgSeq:"lastMessageSeq",WithdrawC2cMsgNotify:"c2cMessageRevokedNotify",C2cWithdrawInfoArray:"revokedInfos",C2cReadedReceipt:"c2cMessageReadReceipt",ReadC2cMsgNotify:"c2cMessageReadNotice",LastReadTime:"peerReadTime",MsgRand:"random",MsgType:"type",MsgShow:"messageShow",NextMsgSeq:"nextMessageSeq",FaceUrl:"avatar",ProfileDataMod:"profileModify",Profile_Account:"userID",ValueBytes:"value",ValueNum:"value",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgFrom_AccountExtraInfo:"messageFromAccountExtraInformation",Operator_Account:"operatorID",OpType:"operationType",ReportType:"operationType",UserId:"userID",User_Account:"userID",List_Account:"userIDList",MsgOperatorMemberExtraInfo:"operatorInfo",MsgMemberExtraInfo:"memberInfoList",ImageUrl:"avatar",NickName:"nick",MsgGroupNewInfo:"newGroupProfile",MsgAppDefinedData:"groupCustomField",Owner_Account:"ownerID",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupNotification:"notification",GroupApplyJoinOption:"joinOption",MsgKey:"messageKey",GroupInfo:"groupProfile",ShutupTime:"muteTime",Desc:"description",Ext:"extension",GroupAt_Account:"groupAtUserID",MsgNum:"messageNumber",PbMsgKey:"pbDownloadKey",JsonMsgKey:"downloadKey",MsgModifiedFlag:"isModified",PendencyItem:"applicationItem",PendencyType:"applicationType",AddTime:"time",AddSource:"source",AddWording:"wording",ProfileImImage:"avatar",PendencyAdd:"friendApplicationAdded",FrienPencydDel_Account:"friendApplicationDeletedUserIDList",Peer_Account:"userID",GroupAttr:"groupAttributeList",GroupAttrAry:"groupAttributeList",AttrMainSeq:"mainSequence",seq:"sequence",GroupAttrOption:"groupAttributeOption",BytesChangedKeys:"changedKeyList",GroupAttrInfo:"groupAttributeList",GroupAttrSeq:"mainSequence",PushChangedAttrValFlag:"isWithChangedAttributeInfo",SubKeySeq:"sequence",Val:"value",MsgGroupFromCardName:"senderNameCard",MsgGroupFromNickName:"senderNick",C2cNick:"peerNick",C2cImage:"peerAvatar",SendMsgControl:"messageControlInfo",NoLastMsg:"excludedFromLastMessage",NoUnread:"excludedFromUnreadCount",UpdateSeq:"updateSequence",MuteNotifications:"muteFlag",MsgClientTime:"clientTime",TinyId:"tinyID",GroupMsgReceiptList:"readReceiptList",ReadNum:"readCount",UnreadNum:"unreadCount",TopicId:"topicID",MillionGroupFlag:"communityType",SupportTopic:"isSupportTopic",MsgTopicNewInfo:"newTopicInfo",ShutupAll:"muteAllMembers",CustomString:"customData",TopicFaceUrl:"avatar",TopicIntroduction:"introduction",TopicNotification:"notification",TopicIdArray:"topicIDList",MsgVersion:"messageVersion",C2cMsgModNotifys:"c2cMessageModified",GroupMsgModNotifys:"groupMessageModified",ApplyJoinOption:"joinOption",MsgFlag:"messageRemindType",AtInfoList:"groupAtInfoList",AtFlagList:"groupAtType",AtMsgSeq:"sequence",BanDuration:"duration",BanDescription:"reason",NotVisible:"invisible",BytesTag:"tag",BytesValue:"value",RptBytesValue:"value",LatestSeq:"globalSequence",ClearSeq:"clearSequence",SupportMessageExtension:"isSupportExtension",ExtensionList:"extensions",GroupCounter:"counterList",Revoker_Account:"revoker",MsgExtensionNotify:"messageExtensionNotify",ExtensionC2cMsgInfo:"messageInfo",ExtensionGroupMsgInfo:"messageInfo",MsgOptType:"operateType",SetKVInfo:"operateResultList",DeleteKVInfo:"operateResultList",ClearKVInfo:"operateResultList",MsgKeyValue:"extensions",ClearMsgSeq:"clearSequence",MsgLastSeq:"globalSequence",InviteJoinOption:"inviteOption",MemberList_Account:"inviteeList",MsgMemberExtraInfoList:"inviteeInfoList",E:"event",GInf:"groupProfile",MCT:"clientTime",MR:"random",MP:"priority",MTS:"time",GId:"groupID",MS:"sequence",CCD:"cloudCustomData",F_Account:"from",F_Hd:"avatar",F_NN:"nick",GN:"groupName",GT:"groupType",IsSys:"isSystemMessage",OpInf:"operatorInfo",Img:"avatar",NN:"nick",OnlineInf:"onlineMemberInfo",ET:"expireTime",Num:"onlineMemberNum",Opt:"operationType",O_Account:"operatorID",RT:"operationType",UDF:"userDefinedField",L_Account:"userIDList",IsPlaceMsg:"isPlaceMessage",MsgCheckResult:"checkResult",Results:"resultList",Reaction:"reactionID",Reaction_Account:"userIDList",MsgReactionNotifyList:"messageReactionNotifyList",MsgReactionNotify:"messageReactionNotify",MsgReactionSummary:"reactionList",C2CMsgInfo:"C2CMessageInfo",GroupMsgInfo:"groupMessageInfo",int32_err_code:"errorCode",str_err_msg:"errorMsg",MsgDropReason:"messageDropReason",ReactedByMe:"reactedByMyself",Level:"messageRemindType",PeerReadTime:"timestamp",NoUnreadSeqList:"excludedUnreadSequenceList",NewMsg:"topicLatestMessage"},ignoreKeyWord:["C2C","ID","USP"]};function Fs(t){return N(this,Fs),(t=Qu.call(this,t))._n="SyncUnreadMsgModule",t._cookie="",t._onlineSyncFlag=!1,t.getIEmitInst().on(Yt.A2KEY_AND_TINYID_UPDATED,t._init,te(t)),t}function xs(t){return N(this,xs),(t=Zu.call(this,t))._n="PluginModule",t.plugins={},t}function ha(t){return N(this,ha),(t=el.call(this,t))._n="ComboMsgModule",t}function ki(t){return N(this,ki),(t=tl.call(this,t))._n="MsgReactionModule",t._reactedByMyselfMap=new Map,t._reactionInfoMap=new Map,t}function qs(t){return N(this,qs),(t=nl.call(this,t))._n="MsgExtModule",t.msgExtMap=new Map,t.globalSeqMap=new Map,t.getMsgExtsMap=new Map,t}function li(t){return N(this,li),(t=Os.call(this,t))._n="MessageModule",t._messageOptionsMap=new Map,t._mergerMessageHandler=new zu(te(t)),t}function jc(t,o){if(typeof t!="string"&&!Array.isArray(t))throw new TypeError("Expected the input to be `string | string[]`");return o=Object.assign({pascalCase:!1},o),(t=Array.isArray(t)?t.map(function(i){return i.trim()}).filter(function(i){return i.length}).join("-"):t.trim()).length===0?"":t.length===1?o.pascalCase?t.toUpperCase():t.toLowerCase():(t=t=(t=t!==t.toLowerCase()?md(t):t).replace(/^[_.\- ]+/,"").toLowerCase().replace(/[_.\- ]+(\w|$)/g,function(i,s){return s.toUpperCase()}).replace(/\d+(\w|$)/g,function(i){return i.toUpperCase()}),o.pascalCase?t.charAt(0).toUpperCase()+t.slice(1):t)}var md=function(t){for(var o=!1,i=!1,s=!1,c=0;c<t.length;c++){var l=t[c];o&&/[a-zA-Z]/.test(l)&&l.toUpperCase()===l?(t=t.slice(0,c)+"-"+t.slice(c),s=i,i=!(o=!1),c++):i&&s&&/[a-zA-Z]/.test(l)&&l.toLowerCase()===l?(t=t.slice(0,c-1)+"-"+t.slice(c-1),s=i,o=!(i=!1)):(o=l.toLowerCase()===l&&l.toUpperCase()!==l,s=i,i=l.toUpperCase()===l&&l.toLowerCase()!==l)}return t};function vd(t,o){var i=0;return function s(c,l){return 100<++i?(i--,c):ye(c)?(p=c.map(function(S){return ft(S)?s(S,l):S}),i--,p):ft(c)?(m=c,I=function(S,k){if(!fc(k))return!1;if(k!==jc(k))for(var G=0;G<ga.ignoreKeyWord.length&&!k.includes(ga.ignoreKeyWord[G]);G++);var U;return q(l[k])?(U=k)[0].toUpperCase()+jc(U).slice(1):l[k]},C=Object.create(null),Object.keys(m).forEach(function(S){var k=I(m[S],S);k&&(C[k]=m[S])}),p=_i(p=C,function(S,k){return ye(S)||ft(S)?s(S,l):S}),i--,p):void 0;var p,m,I,C}(t,o)}for(var Ai,Vs=String.fromCharCode,_a=function(t){var o=0|t.charCodeAt(0);if(55296<=o)if(o<56320)if(t=0|t.charCodeAt(1),56320<=t&&t<=57343){if(65535<(o=(o<<10)+t-56613888|0))return Vs(240|o>>>18,128|o>>>12&63,128|o>>>6&63,128|63&o)}else o=65533;else o<=57343&&(o=65533);return o<=2047?Vs(192|o>>>6,128|63&o):Vs(224|o>>>12,128|o>>>6&63,128|63&o)},br=function(t){for(var o=t===void 0?"":(""+t).replace(/[\x80-\uD7ff\uDC00-\uFFFF]|[\uD800-\uDBFF][\uDC00-\uDFFF]?/g,_a),i=0|o.length,s=new Uint8Array(i),c=0;c<i;c=c+1|0)s[c]=0|o.charCodeAt(c);return s},Yc=(V(xr,[{key:"getID",value:function(){return this._id}},{key:"_onOpen",value:function(t){this._handler.onOpen({id:this._id,res:JSON.stringify(t)})}},{key:"_onClose",value:function(t){this._handler.onClose({id:this._id,e:t})}},{key:"_onMessage",value:function(t){t=this._canIUseBinaryFrame?this._isAppCompressedData(t.data)?this._handler.inflate(t.data):function(o){for(var i=new Uint8Array(o),s="",c=0,l=i.length;c<l;){var p=i[c],m=0,I=0;if(p<=127?(m=0,I=255&p):p<=223?(m=1,I=31&p):p<=239?(m=2,I=15&p):p<=244&&(m=3,I=7&p),0<l-c-m)for(var C=0;C<m;)I=I<<6|63&(p=i[c+C+1]),C+=1;else I=65533,m=l-c;s+=String.fromCodePoint(I),c+=m+1}return s}(t.data):t.data,this._handler.onMessage({data:t})}},{key:"_isAppCompressedData",value:function(t){return t=new Uint8Array(t),t[0]===67&&t[1]===79&&t[2]===77&&t[3]===80}},{key:"_onError",value:function(t){this._handler.onError({id:this._id,e:t})}},{key:"setIsWorkerEnabled",value:function(t){this._isWorkerEnabled=!0}},{key:"close",value:function(t){if(this._workerSocket&&(this._workerSocket.postMessage({cmd:"stop",code:t}),this._workerSocket.terminate(),this._workerSocket=null),Ct)return mt.offSocketClose(),mt.offSocketMessage(),mt.offSocketOpen(),mt.offSocketError(),void mt.closeSocket();this._socket&&(qe?(this._socket.onClose(function(){}),this._socket.onOpen(function(){}),this._socket.onMessage(function(){}),this._socket.onError(function(){})):(this._socket.onopen=null,this._socket.onmessage=null,this._socket.onclose=null,this._socket.onerror=null),Ve?this._socket.close({code:t}):this._socket.close(t),this._socket=null)}},{key:"send",value:function(t){this._workerSocket?this._workerSocket.postMessage({cmd:"sendMessage",data:this._canIUseBinaryFrame?br(t.data).buffer:t.data}):Ct?mt.sendSocketMessage({data:t.data,fail:function(){t.fail&&t.requestID&&t.fail(t.requestID)}}):this._socket&&(qe?this._socket.send({data:this._canIUseBinaryFrame?br(t.data).buffer:t.data,fail:function(){t.fail&&t.requestID&&t.fail(t.requestID)}}):this._socket.send(this._canIUseBinaryFrame?br(t.data):t.data))}}]),xr),yd=["keyMap"],Id=["keyMap"],fa="connected",zc="connecting",ma="disconnected",Md=(V(Fr,[{key:"_setWebsocketHost",value:function(){var t=this._chM.get(12);this._currentSite=Qe,this._chM.isOversea()&&(this._currentSite="OVERSEA"),t.isSingaporeSite()?this._currentSite="SINGAPORE":t.isKoreaSite()?this._currentSite="KOREA":t.isGermanySite()?this._currentSite="GERMANY":t.isIndiaSite()?this._currentSite="IND":t.isJapanSite()?this._currentSite="JPN":t.isUSASite()?this._currentSite="USA":t.isIndonesiaSite()&&(this._currentSite="INDONESIA"),se.HOST.setCurrent(this._currentSite)}},{key:"_initConnection",value:function(){var o=this._chM.get(12).getSDKAppID()+"",t=this._chM.get(12).isIndependentDomainDisabled(),t=(q(se.HOST.CURRENT.BACKUP)?this._url=se.HOST.CURRENT.DEFAULT:this._url===""?this._url=t?se.HOST.CURRENT.DEFAULT:se.HOST.CURRENT.DEFAULT0.replace("*",o):-1<this._url.indexOf(o)?this._url=se.HOST.CURRENT.DEFAULT:this._url===se.HOST.CURRENT.DEFAULT?this._url=se.HOST.CURRENT.IPV6||se.HOST.CURRENT.BACKUP:this._url===se.HOST.CURRENT.IPV6?this._url=se.HOST.CURRENT.BACKUP:this._url===se.HOST.CURRENT.BACKUP?this._url=this._canIUseAnyCast()?se.HOST.CURRENT.ANYCAST:se.HOST.CURRENT.DEFAULT:this._url===se.HOST.CURRENT.ANYCAST&&(se.HOST.CURRENT.ANYCAST="",this._url=se.HOST.CURRENT.DEFAULT),this._chM.get(12)),o=t.getProxyServer();Te(o)||(this._url=o),t.isTestEnv()&&(this._url=pt.TEST[this._currentSite].DEFAULT),this._connect(),this._nextPingTs=0}},{key:"_canIUseAnyCast",value:function(){return $t&&se.HOST.CURRENT.ANYCAST}},{key:"onCheckTimer",value:function(t){t%1==0&&(this._checkPromiseMap(),this._checkNativeAppWS())}},{key:"_checkPromiseMap",value:function(){var t=this;this._promiseMap.size!==0&&this._promiseMap.forEach(function(l,i){var s=l.reject,c=l.timestamp,l=l.headSeq,p=15e3;i.indexOf(P.LOGIN)!==-1?p=9e4:i.indexOf(P.PING)!==-1&&(p=3e3),Date.now()-c>=p&&(E.l("".concat(t._n,"._checkPromiseMap request timeout, delete requestID:").concat(i)),t._promiseMap.delete(i),s(new Gt({code:Q.NETWORK_TIMEOUT,data:{headSeq:l}})),t._chM.onRequestTimeout())})}},{key:"_checkNativeAppWS",value:function(){Ce&&!this.isConnected()&&this._reConnect()}},{key:"onOpen",value:function(t){var o,i;this._readyState!==ma&&(this._onOpenTs=Date.now(),i=t.id,t=t.res,this._socketID=i,o=An(this._startTs,!1),i="socketID:".concat(i," res:").concat(t),E.l("".concat(this._n,"._onOpen cost:").concat(o," ms. ").concat(i)),new ue("wsOnOpen").setMessage(o).setCostTime(o).setMoreMessage(i).end(),this._readyState=fa,this._reConnectCount=0,this._resend(),this._reConnectFlag===!0&&(this._chM.onReconnected(),this._reConnectFlag=!1),this._chM.onOpen())}},{key:"onClose",value:function(s){var o=new ue("wsOnClose"),i=s.id,s=s.e,c="sourceSocketID:".concat(i," currentSocketID:").concat(this._socketID," code:").concat(s.code," reason:").concat(s.reason),l=0;this._onOpenTs!==0&&(l=Date.now()-this._onOpenTs),o.setMessage(l).setCostTime(l).setMoreMessage(c).setCode(s.code).end(!0),E.l("".concat(this._n,"._onClose ").concat(c," onlineTime:").concat(l)),i===this._socketID&&(this._readyState=ma,l<1e3?this._chM.onReconnectFailed():this._chM.onClose())}},{key:"onError",value:function(i){var o=i.id,i=i.e,s="sourceSocketID:".concat(o," currentSocketID:").concat(this._socketID);new ue("wsOnError").setMessage(i.errMsg||JSON.stringify(i,["message","code"])).setMoreMessage(s).setLevel("error").end(!0),E.w("".concat(this._n,"._onError"),i,s),o===this._socketID&&(this._readyState=ma,this._chM.onError())}},{key:"onMessage",value:function(t){var o;try{o=JSON.parse(t.data)}catch(m){new ue("jsonParseError").setMessage(t.data).end()}if(o&&o.head){var i,s,c,l,t=this._getRequestIDFromHead(o.head),p=o.body;if(this._chM.get(30).isTRTCCommand(t)||(l=ao(o.head),p=function I(C,S){return ye(C)?C.map(function(Y){return ft(Y)?I(Y,S):Y}):ft(C)?(k=C,G=function(Y,Z){return q(S[Z])?jc(Z):S[Z]},U={},Object.keys(k).forEach(function(Y){U[G(k[Y],Y)]=k[Y]}),_i(U,function(Y){return ye(Y)||ft(Y)?I(Y,S):Y})):void 0;var k,G,U}(o.body,this._getResKeyMap(l))),E.d("".concat(this._n,".onMessage ret:").concat(JSON.stringify(p)," requestID:").concat(t," has:").concat(this._promiseMap.has(t))),this._setNextPingTs(),this._promiseMap.has(t))return i=(l=this._promiseMap.get(t)).resolve,s=l.reject,c=l.timestamp,l=l.headSeq,this._promiseMap.delete(t),this._calcRTT(c),void(p.errorCode&&p.errorCode!==0?(this._chM.onErrorCodeNotZero(p),s(new Gt({code:p.errorCode,message:p.errorInfo||"",data:t.includes(P.MODIFY_C2C_MSG)||t.includes(P.MODIFY_GRP_MSG)?{elements:p.elements,messageVersion:p.messageVersion,cloudCustomData:p.cloudCustomData,headSeq:l}:{headSeq:l}}))):i(Ae(p)));this._chM.onMessage({head:o.head,body:p})}}},{key:"_calcRTT",value:function(t){t=Date.now()-t,this._chM.get(26).addRTT(t)}},{key:"_connect",value:function(){this._readyState!==zc&&this._readyState!==fa&&(this._startTs=Date.now(),this._onOpenTs=0,this._readyState=zc,this._socket=new Yc(this),this._socketID=this._socket.getID(),E.l("".concat(this._n,"._connect isWorkerEnabled:").concat(this.getIsWorkerEnabled()," socketID:").concat(this._socketID," url:").concat(this.getURL())),new ue("wsConnect").setMessage("socketID:".concat(this._socketID," url:").concat(this.getURL())).end())}},{key:"getURL",value:function(){this._chM.isDevMode()&&(this._canIUseBinaryFrame=!1);var t=Ic(),o=((Ct||rn&&t==="windows"||Ce)&&(this._canIUseBinaryFrame=!1),-1),s=(t==="ios"?o=nc||-1:t==="android"&&(o=ic||-1),this._chM.get(12)),i=this._chM.getPlatform(),c=s.getSDKAppID(),s=s.getInstanceID(),c="sdkappid=".concat(c,"&instanceid=").concat(s,"&random=").concat(this._getRandom(),"&platform=").concat(i,"&host=").concat(t)+"&version=".concat(o,"&sdkversion=").concat("3.5.2");return gt&&(c+="&isminigame=1"),this._chM.canIUseInflate()&&(c+="&compress=gzip"),(this._canIUseBinaryFrame?"".concat(this._url,"/binfo?"):"".concat(this._url,"/info?")).concat(c)}},{key:"_closeConnection",value:function(t){E.l("".concat(this._n,"._closeConnection socketID:").concat(this._socketID)),this._socket&&(this._socket.close(t),this._socketID=-1,this._socket=null,this._readyState=ma)}},{key:"_resend",value:function(){var t=this;if(E.l("".concat(this._n,"._resend reConnectFlag:").concat(this._reConnectFlag),"promiseMap.size:".concat(this._promiseMap.size," simpleRequestMap.size:").concat(this._simpleRequestMap.size)),0<this._promiseMap.size&&this._promiseMap.forEach(function(S,m){var I=S.uplinkData,C=S.resolve,S=S.reject;m.indexOf(P.AV_POLLING)!==-1?t._promiseMap.delete(m):(t._promiseMap.set(m,{resolve:C,reject:S,timestamp:Date.now(),uplinkData:I}),t._execute(m,I))}),0<this._simpleRequestMap.size){var o,i=A(this._simpleRequestMap);try{for(i.s();!(o=i.n()).done;){var s=Le(o.value,2),c=s[0],l=s[1];this._execute(c,l)}}catch(p){i.e(p)}finally{i.f()}this._simpleRequestMap.clear()}}},{key:"send",value:function(t){var o=this,i=(t.head.seq=this._getSequence(),t.head.reqtime=Math.floor(Date.now()/1e3),t.head.cs=this._calcCheckSum(t.head.servcmd,t.body),t.keyMap,ae(t,yd)),s=this._getRequestIDFromHead(t.head),c=JSON.stringify(i);return new Promise(function(l,p){o._promiseMap.set(s,{resolve:l,reject:p,timestamp:Date.now(),uplinkData:c,headSeq:t.head.seq}),E.d("".concat(o._n,".send uplinkData:").concat(JSON.stringify(i)," requestID:").concat(s," readyState:").concat(o._readyState)),o._readyState!==fa?o._reConnect():(o._execute(s,c),o._chM.get(26).addRequestCount())})}},{key:"simplySend",value:function(o){o.head.seq=this._getSequence(),o.head.reqtime=Math.floor(Date.now()/1e3),o.keyMap;var i=ae(o,Id),o=this._getRequestIDFromHead(o.head),i=JSON.stringify(i);this._readyState!==fa?(this._simpleRequestMap.size<this.MAX_SIZE?this._simpleRequestMap.set(o,i):E.l("".concat(this._n,".simplySend. simpleRequestMap is full, drop request!")),this._reConnect()):this._execute(o,i)}},{key:"_execute",value:function(t,o){this._socket.send({data:o,fail:qe?this._onSendFail.bind(this):void 0,requestID:t})}},{key:"_onSendFail",value:function(t){E.l("".concat(this._n,"._onSendFail requestID:").concat(t)),this._chM.onSendFail()}},{key:"_getSequence",value:function(){var t;if(this._startSequence<2415919103)return t=this._startSequence,this._startSequence+=1,this._startSequence===2415919103&&(this._startSequence=mn()),t}},{key:"_getRequestIDFromHead",value:function(t){return t.servcmd+t.seq}},{key:"_getResKeyMap",value:function(t){return t=this._chM.getKeyMap(t),v(v({},ga.res),t.res)}},{key:"_reConnect",value:function(){this._readyState!==fa&&this._readyState!==zc&&this.forcedReconnect()}},{key:"forcedReconnect",value:function(){var t="".concat(this._n,".forcedReconnect");E.l("".concat(t," count:").concat(this._reConnectCount," readyState:").concat(this._readyState)),this._reConnectFlag=!0,this._resetRandom(),this._reConnectCount<this.MAX_RECONNECT_COUNT?(this._reConnectCount+=1,this._closeConnection(4001),this._initConnection()):(this._reConnectCount=0,this._chM.get(15).isOnline()?(E.w("".concat(t," disconnected from wsserver but network is ok, continue...")),this._closeConnection(4001),this._initConnection()):this._chM.onReconnectFailed())}},{key:"getReconnectFlag",value:function(){return this._reConnectFlag}},{key:"_setNextPingTs",value:function(){this._nextPingTs=Ce?Date.now()+5e3:Date.now()+1e4}},{key:"getNextPingTs",value:function(){return this._nextPingTs}},{key:"isConnected",value:function(){return this._readyState===fa}},{key:"canIUseBinaryFrame",value:function(){return this._canIUseBinaryFrame}},{key:"getSocketID",value:function(){return this._socketID}},{key:"inflate",value:function(t){if(this._chM.canIUseInflate())return this._chM.get(37).inflate(t)}},{key:"setIsWorkerEnabled",value:function(t){E.l("".concat(this._n,".setIsWorkerEnabled flag:").concat(t)),this._isWorkerEnabled=t}},{key:"getIsWorkerEnabled",value:function(){return this._isWorkerEnabled&&Yi}},{key:"_getRandom",value:function(){return this._random===0&&(this._random=Math.random()),this._random}},{key:"_resetRandom",value:function(){this._random=0}},{key:"_calcCheckSum",value:function(t,o){if(t.indexOf(P.PING)!==-1||t.indexOf(P.LOGIN)!==-1||t.indexOf(P.LOGOUT)!==-1||t.indexOf(P.AV_POLLING)!==-1||t.indexOf(P.AV_NOAUTH_POLLING)!==-1)return 0;for(var i=br(JSON.stringify(o)),s=4294967295,c=0,l=i.length;c<l;c++){s^=i[c];for(var p=0;p<8;p++)(1&s)==1?s=s>>>1^3988292384:s>>>=1}return(4294967295^s)>>>0}},{key:"close",value:function(){E.l("".concat(this._n,".close")),this._closeConnection(4e3),this._promiseMap.clear(),this._startSequence=mn(),this._readyState=ma,this._simpleRequestMap.clear(),this._reConnectFlag=!1,this._reConnectCount=0,this._onOpenTs=0,this._url="",this._random=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0}}]),Fr),Pr=function(t,o,i){return new Promise(function(s,c){var l,p,m="application/x-www-form-urlencoded;charset=UTF-8";qe?mt.request({url:o,data:i,method:t,timeout:3e3,header:{"content-type":m},success:function(I){I&&I.data&&I.data.NetCheckInfo&&E.l("".concat("getconninfo ok in"," miniapp. ret:"),I.data),s()},fail:function(){c(new Gt({code:Q.NETWORK_ERROR}))}}):(l=new XMLHttpRequest,p=setTimeout(function(){l.abort(),c(new Gt({code:Q.NETWORK_TIMEOUT}))},3e3),l.onreadystatechange=function(){l.readyState===4&&(p&&clearTimeout(p),l.status===200||l.status===304?(l.responseText&&-1<l.responseText.indexOf("NetCheckInfo")&&E.l("".concat("getconninfo ok in"," web. ret:"),JSON.parse(l.responseText)),s()):c(new Gt({code:Q.NETWORK_ERROR})))},l.open(t,o,!0),l.setRequestHeader("Content-type",m),i?l.send(i):l.send())})},Jc=(z(Ia,Ht),Ai=J(Ia),V(Ia,[{key:"onCheckTimer",value:function(t){this._socketHandler&&(this.isLoggedIn()?(0<this._timerForNotLoggedIn&&(clearInterval(this._timerForNotLoggedIn),this._timerForNotLoggedIn=-1),this._socketHandler.onCheckTimer(t)):this._socketHandler.onCheckTimer(1),this._checkNextPing())}},{key:"onErrorCodeNotZero",value:function(t){this.get(20).onErrorCodeNotZero(t)}},{key:"onMessage",value:function(t){this.get(20).onMessage(t)}},{key:"send",value:function(t){return this._socketHandler?this._previousState!==O.NET_STATE_CONNECTED&&t.head.servcmd.includes(P.SSO_STAT)?(this.reConnect(),this.isPrivateNetWork()?Promise.resolve():this._sendLogViaHTTP(t)):this._socketHandler.send(t):Promise.reject()}},{key:"_sendLogViaHTTP",value:function(i){var o=se.HOST.CURRENT.STAT,o="".concat(o,"/v4/imopenstat/tim_web_report_v2?sdkappid=").concat(i.head.sdkappid,"&reqtime=").concat(Date.now()),i=JSON.stringify(i.body);return Pr("POST",o,i)}},{key:"simplySend",value:function(t){return this._socketHandler?this._socketHandler.simplySend(t):Promise.reject()}},{key:"onOpen",value:function(){this._ping()}},{key:"onClose",value:function(){this._socketHandler&&this._socketHandler.getReconnectFlag()&&this._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED),this.reConnect()}},{key:"onError",value:function(){qe&&!Ce&&this.warn("DomainNameInMP"),this._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED)}},{key:"getKeyMap",value:function(t){return this.get(20).getKeyMap(t)}},{key:"onRequestTimeout",value:function(){3e4<=Date.now()-this._lastDiagnoseTS&&this.diagnose()}},{key:"onSendFail",value:function(){this._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED)}},{key:"onReconnected",value:function(){E.l("".concat(this._n,".onReconnected cost:").concat(An(this._disconnectedTS,!0,!0))),this._m.restartTimer(),this.get(20).onReconnected(An(this._disconnectedTS,!1,!1)),this._disconnectedTS=0,this._emitNetStateChangeEvent(O.NET_STATE_CONNECTED)}},{key:"onReconnectFailed",value:function(){E.l("".concat(this._n,".onReconnectFailed")),this._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED)}},{key:"setIsWorkerEnabled",value:function(t){this._socketHandler&&this._socketHandler.setIsWorkerEnabled(!1)}},{key:"offline",value:function(){this._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED)}},{key:"reConnect",value:function(){var t=0<arguments.length&&arguments[0]!==void 0&&arguments[0],o=!1,i=(this._socketHandler&&(o=this._socketHandler.getReconnectFlag()),"forcedFlag:".concat(t," fatalErrorFlag:").concat(this._fatalErrorFlag," previousState:").concat(this._previousState," reconnectFlag:").concat(o));if(E.l("".concat(this._n,".reConnect ").concat(i)),!this._fatalErrorFlag&&this._socketHandler){if(t===!0)this._socketHandler.forcedReconnect();else{if(this._previousState===O.NET_STATE_CONNECTING&&o)return;this._socketHandler.forcedReconnect()}this._emitNetStateChangeEvent(O.NET_STATE_CONNECTING)}}},{key:"_emitNetStateChangeEvent",value:function(t){this._previousState!==t&&(E.l("".concat(this._n,"._emitNetStateChangeEvent from ").concat(this._previousState," to ").concat(t)),t===O.NET_STATE_DISCONNECTED&&this._disconnectedTS===0&&(this._disconnectedTS=Date.now(),this.diagnose()),this._previousState=t,this.emitOEvt(Me.NET_STATE_CHANGE,{state:t}))}},{key:"_ping",value:function(){var t,o=this;this._probing!==!0&&(this._probing=!0,t=this.get(20).getProtocolData({P:P.PING}),this.send(t).then(function(){o._probing=!1}).catch(function(i){o._probing=!1;var s=o.get(15).isOnline();if(E.w("".concat(o._n,"._ping failed. bOnline:").concat(s," error:"),i),i&&i.code===60002)return new ue("error").setMessage("code:".concat(i.code," message:").concat(i.message)).end(),o._fatalErrorFlag=!0,void o._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED);s?o.reConnect():o._emitNetStateChangeEvent(O.NET_STATE_DISCONNECTED)}))}},{key:"_checkNextPing",value:function(){this._socketHandler&&this._socketHandler.isConnected()&&Date.now()>=this._socketHandler.getNextPingTs()&&this._ping()}},{key:"dealloc",value:function(){this._socketHandler&&(this._socketHandler.close(),this._socketHandler=null),-1<this._timerForNotLoggedIn&&clearInterval(this._timerForNotLoggedIn)}},{key:"onRestApiKickedOut",value:function(){this._socketHandler&&(this._socketHandler.close(),this.reConnect(!0))}},{key:"canIUseInflate",value:function(){return this._m.canIUseInflate()}},{key:"getSocketID",value:function(){if(this._socketHandler)return this._socketHandler.getSocketID()}},{key:"diagnose",value:function(){this.isPrivateNetWork()||(this._lastDiagnoseTS=Date.now(),this._diagnoseBySSO(),this._diagnoseByCDN())}},{key:"_diagnoseBySSO",value:function(){var t=this,o=this._socketHandler.getURL(),i=o.split("/")[2];i.startsWith("ws")&&(o=o.slice(o.indexOf("info?")+5),i="https://".concat(i,"/v3/netcheck/getconninfo?").concat(o,"&reqtime=").concat(Date.now()),Pr("GET",i).catch(function(s){E.w("".concat(t._n,"._diagnoseBySSO failed. error:"),s)}))}},{key:"_diagnoseByCDN",value:function(){var t=this,o=this._socketHandler.getURL(),o=o.slice(o.indexOf("info?")+5),o="https://boce-cdn.my-imcloud.com/v3/netcheck/getconninfo?".concat(o,"&reqtime=").concat(Date.now());Pr("GET",o).catch(function(i){E.w("".concat(t._n,"._diagnoseByCDN failed. error:"),i)})}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._previousState=O.NET_STATE_CONNECTED,this._probing=!1,this._fatalErrorFlag=!1,this._timerForNotLoggedIn=setInterval(this.onCheckTimer.bind(this),1e3),this._disconnectedTS=0,this._lastDiagnoseTS=0}}]),Ia),ol=["a2","tinyid"],Gr=["a2","tinyid"],Cd=(V(wr,[{key:"_fillMap",value:function(){this._map.clear();var t=this._sessionM.genCommonHead(),o=this._sessionM.genCosSpecifiedHead(),i=this._sessionM.genSSOReportHead();this._map.set(P.LOGIN,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.LOGIN)}),body:{state:"Online",isWebUniapp:0,deviceBrand:0,customInfo:""},keyMap:{req:{deviceBrand:"InstType"},res:{InstId:"instanceID",HelloInterval:"helloInterval",RichMsgAuthKey:"authKey"}}}),this._map.set(P.LOGOUT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.LOGOUT)}),body:{type:0,isWebUniapp:0},keyMap:{req:{type:"wslogout_type"}}}),this._map.set(P.HELLO,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.HELLO)}),body:{isWebUniapp:0},keyMap:{res:{NewInstInfo:"newInstanceInfo"}}}),this._map.set(P.KICK_OTHER,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.STAT_SERVICE,".").concat(P.KICK_OTHER)}),body:{}}),this._map.set(P.COS_SIGN,{head:v(v({},o),{},{servcmd:"".concat(se.NAME.IM_COS_SIGN,".").concat(P.COS_SIGN)}),body:{cmd:"open_im_cos_svc",subCmd:"get_cos_token",duration:300,version:2},keyMap:{req:{userSig:"usersig",subCmd:"sub_cmd",cmd:"cmd",duration:"duration",version:"version"},res:{expired_time:"expiredTime",bucket_name:"bucketName",session_token:"sessionToken",tmp_secret_id:"secretId",tmp_secret_key:"secretKey"}}}),this._map.set(P.COS_PRE_SIG,{head:v(v({},o),{},{servcmd:"".concat(se.NAME.CUSTOM_UPLOAD,".").concat(P.COS_PRE_SIG)}),body:{fileType:void 0,fileName:void 0,uploadMethod:0,duration:900},keyMap:{req:{userSig:"usersig",fileType:"file_type",fileName:"file_name",uploadMethod:"upload_method"},res:{expired_time:"expiredTime",request_id:"requestId",head_url:"headUrl",upload_url:"uploadUrl",download_url:"downloadUrl",ci_url:"ciUrl",snapshot_url:"requestSnapshotUrl"}}}),this._map.set(P.SIMPLE_COS_PRE_SIG,{head:v(v({},o),{},{servcmd:"".concat(se.NAME.CUSTOM_UPLOAD,".").concat(P.SIMPLE_COS_PRE_SIG)}),body:{uploadMethod:0,platform:2,SDKAppID:0,userID:"",conversationType:1,uploadConfig:[{fileID:1,fileType:1,fileName:""}]},keyMap:{req:{platform:"uint32_platform",SDKAppID:"uint32_sdkappid",userID:"str_user_id",uploadMethod:"uint32_upload_method",conversationType:"uint32_scene",uploadConfig:"rpt_upload_object",fileID:"uint32_file_id",fileType:"uint32_file_type",fileName:"str_file_name"},res:{str_final_ip:"uploadIP",rpt_pre_sig:"preSig",uint32_file_id:"fileID",uint32_exist_flag:"existFlag",str_download_url:"downloadUrl",str_upload_url:"uploadUrl",str_snapshot_url:"requestSnapshotUrl",str_file_key:"fileKey"}}}),this._map.set(P.GET_IMAGE_INFO,{head:v(v({},o),{},{servcmd:"".concat(se.NAME.CUSTOM_UPLOAD,".").concat(P.GET_IMAGE_INFO)}),body:{imageUrl:""},keyMap:{req:{imageUrl:"str_image_url"},res:{rpt_msg_image_info:"imageInfoArray",uint32_image_type:"type",str_url:"url",uint32_width:"width",uint32_height:"height",str_image_format:"imageFormat"}}}),this._map.set(P.GET_IP,{head:v(v({},o),{},{servcmd:"".concat(se.NAME.CUSTOM_UPLOAD,".").concat(P.GET_IP)}),body:{domainName:""},keyMap:{req:{domainName:"str_domain"},res:{str_final_ip:"ip"}}}),this._map.set(P.VIDEO_COVER,{head:v(v({},o),{},{servcmd:"".concat(se.NAME.CUSTOM_UPLOAD,".").concat(P.VIDEO_COVER)}),body:{version:1,platform:void 0,coverName:void 0,requestSnapshotUrl:void 0},keyMap:{req:{version:"version",platform:"platform",coverName:"cover_name",requestSnapshotUrl:"snapshot_url"},res:{error_code:"errorCode",error_msg:"errorInfo",download_url:"snapshotUrl"}}}),this._map.set(P.FETCH_COMMERCIAL_CONFIG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_CONFIG_MANAGER,".").concat(P.FETCH_COMMERCIAL_CONFIG)}),body:{SDKAppID:0},keyMap:{req:{SDKAppID:"uint32_sdkappid"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(P.PUSHED_COMMERCIAL_CONFIG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_CONFIG_MANAGER,".").concat(P.PUSHED_COMMERCIAL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_purchase_bits:"purchaseBits",uint32_expired_time:"expiredTime"}}}),this._map.set(P.FETCH_CLOUD_CTRL_CONFIG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_CONFIG_MANAGER,".").concat(P.FETCH_CLOUD_CTRL_CONFIG)}),body:{SDKAppID:0,version:0},keyMap:{req:{SDKAppID:"uint32_sdkappid",version:"uint64_version"},res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(P.PUSHED_CLOUD_CTRL_CONFIG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_CONFIG_MANAGER,".").concat(P.PUSHED_CLOUD_CTRL_CONFIG)}),body:{},keyMap:{res:{int32_error_code:"errorCode",str_error_message:"errorMessage",str_json_config:"cloudControlConfig",uint32_expired_time:"expiredTime",uint32_sdkappid:"SDKAppID",uint64_version:"version"}}}),this._map.set(P.OVERLOAD_NOTIFY,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OVERLOAD_PUSH,".").concat(P.OVERLOAD_NOTIFY)}),body:{},keyMap:{res:{OverLoadServCmd:"overloadCommand",DelaySecs:"waitingTime"}}}),this._map.set(P.SYNC_UNREAD_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.SYNC_UNREAD_MSG)}),body:{cookie:"",syncFlag:0,needAbstract:1,isOnlineSync:0,needSignaling:1,needCachedMsg:1},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",from:"From_Account",to:"To_Account",time:"MsgTimeStamp",sequence:"MsgSeq",random:"MsgRandom",elements:"MsgBody"},res:{MsgList:"messageList",SyncFlag:"syncFlag",To_Account:"to",From_Account:"from",ClientSeq:"clientSequence",MsgSeq:"sequence",NoticeSeq:"noticeSequence",NotifySeq:"notifySequence",MsgRandom:"random",MsgTimeStamp:"time",MsgContent:"content",ToGroupId:"to",MsgKey:"messageKey",GroupTips:"groupTips",MsgBody:"elements",MsgType:"type",C2CRemainingUnreadCount:"C2CRemainingUnreadList",C2CPairUnreadCount:"C2CPairUnreadList"}}}),this._map.set(P.GET_PROFANITY_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_MSG_AUDIT_MGR,".").concat(P.GET_PROFANITY_LIST)}),body:{version:0,deviceID:"",startIndex:void 0},keyMap:{req:{version:"uint64_version",deviceID:"str_device_id",startIndex:"uint64_start_index"},res:{msg_cmd_error_code:"errorInfo",str_err_msg:"errorMessage",uint32_code:"errorCode",msg_scene_ctl_config:"filterConfig",uint64_c2c_custom_msg_flag:"c2c_custom_message",uint64_c2c_text_msg_flag:"c2c_text_message",uint64_group_custom_msg_flag:"group_custom_message",uint64_group_text_msg_flag:"group_text_message",uint64_group_info_flag:"group_profile",uint64_group_member_info_flag:"group_member_profile",uint64_relation_chain_flag:"sns",uint64_user_info_flag:"user_profile",rpt_msg_dirty_word:"lexicon",str_dirty_word:"profanity",str_replaced_content:"replacement",uint64_filter_type:"filterType",uint64_id:"id",uint64_word_type:"profanityType",uint64_complete_flag:"completeFlag",uint64_next_start_index:"nextStartIndex",uint64_version:"version",uint64_expired_time:"expiredTime"}}}),this._map.set(P.SEND_C2C_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.SEND_C2C_MSG)}),body:{fromAccount:"",toAccount:"",msgSeq:0,msgRandom:0,msgBody:[],cloudCustomData:void 0,nick:"",avatar:"",msgLifeTime:void 0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",OPPOCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:"",HonorImportance:""}},messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0,forbidCallbackControl:void 0},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",count:"MaxCnt",lastMessageTime:"LastMsgTime",messageKey:"MsgKey",peerAccount:"Peer_Account",data:"Data",description:"Desc",extension:"Ext",type:"MsgType",content:"MsgContent",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",nick:"From_AccountNick",avatar:"From_AccountHeadurl",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"IsNeedReadReceipt",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID",OPPOChannelID:"OPPOChannelID",OPPOCategory:"OPPOCategory",VIVOClassification:"VIVOClassification",VIVOCategory:"VIVOCategory",HonorImportance:"HonorImportance"}}}),this._map.set(P.SEND_GRP_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.SEND_GRP_MSG)}),body:{fromAccount:"",groupID:"",random:0,clientSequence:0,priority:"",msgBody:[],cloudCustomData:void 0,onlineOnlyFlag:0,offlinePushInfo:{pushFlag:0,title:"",desc:"",ext:"",apnsInfo:{sound:"",badgeMode:0,isVoipPush:void 0,image:""},androidInfo:{sound:"",XiaoMiChannelID:"",OPPOChannelID:"",GoogleChannelID:"",VIVOClassification:1,VIVOCategory:"",HuaWeiCategory:"",OPPOCategory:"",HuaWeiImage:"",HonorImage:"",GoogleImage:"",HonorImportance:""}},groupAtInfo:[],messageControlInfo:void 0,clientTime:void 0,needReadReceipt:0,topicID:void 0,receiverList:void 0,isSupportExtension:0,isRelayMessage:0,cmConfigID:void 0,forbidCallbackControl:void 0},keyMap:{req:{to:"GroupId",extension:"Ext",data:"Data",description:"Desc",random:"Random",sequence:"ReqMsgSeq",count:"ReqMsgNumber",type:"MsgType",priority:"MsgPriority",content:"MsgContent",elements:"MsgBody",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",clientSequence:"ClientSeq",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody",needReadReceipt:"NeedReadReceipt",receiverList:"To_Account",GoogleChannelID:"GoogleChannelID",XiaoMiChannelID:"XiaoMiChannelID",OPPOChannelID:"OPPOChannelID",OPPOCategory:"OPPOCategory",VIVOClassification:"VIVOClassification",VIVOCategory:"VIVOCategory",HonorImportance:"HonorImportance"},res:{MsgTime:"time",MsgSeq:"sequence"}}}),this._map.set(P.REVOKE_C2C_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.REVOKE_C2C_MSG)}),body:{msgInfo:{fromAccount:"",toAccount:"",msgTimeStamp:0,msgSeq:0,msgRandom:0}},keyMap:{req:{msgInfo:"MsgInfo",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom"}}}),this._map.set(P.REVOKE_GRP_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.REVOKE_GRP_MSG)}),body:{groupID:"",msgSeqList:void 0,topicID:""},keyMap:{req:{msgSeqList:"MsgSeqList",msgSeq:"MsgSeq"}}}),this._map.set(P.GET_C2C_ROAMING_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.GET_C2C_ROAMING_MSG)}),body:{peerAccount:"",count:15,lastMessageTime:0,messageKey:"",withRecalledMessage:1,direction:0},keyMap:{req:{messageKey:"MsgKey",peerAccount:"Peer_Account",count:"MaxCnt",lastMessageTime:"LastMsgTime",withRecalledMessage:"WithRecalledMsg",direction:"GetDirection"},res:{LastMsgTime:"lastMessageTime",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer"}}}),this._map.set(P.MODIFY_C2C_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.MODIFY_C2C_MSG)}),body:{from:"",to:"",sequence:0,random:0,time:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(P.GET_GRP_ROAMING_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_ROAMING_MSG)}),body:{withRecalledMsg:1,groupID:"",count:15,sequence:"",topicID:void 0},keyMap:{req:{sequence:"ReqMsgSeq",count:"ReqMsgNumber",withRecalledMessage:"WithRecalledMsg"},res:{Random:"random",MsgTime:"time",MsgSeq:"sequence",ReqMsgSeq:"sequence",RspMsgList:"messageList",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgPriority:"priority",MsgBody:"elements",MsgType:"type",MsgContent:"content",IsFinished:"complete",Download_Flag:"downloadFlag",ClientSeq:"clientSequence",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",NextReqMsgSeq:"nextSequence"}}}),this._map.set(P.SET_C2C_MSG_READ,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.SET_C2C_MSG_READ)}),body:{C2CMsgReaded:void 0},keyMap:{req:{lastMessageTime:"LastedMsgTime"}}}),this._map.set(P.SET_C2C_PEER_MUTE_NOTIFICATIONS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.SET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{userIDList:void 0,muteFlag:0},keyMap:{req:{userIDList:"Peer_Account",muteFlag:"Mute_Notifications"}}}),this._map.set(P.GET_C2C_PEER_MUTE_NOTIFICATIONS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.GET_C2C_PEER_MUTE_NOTIFICATIONS)}),body:{toAccount:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Peer_Account"},res:{MuteNotificationsList:"muteFlagList"}}}),this._map.set(P.SET_GRP_MSG_READ,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.SET_GRP_MSG_READ)}),body:{groupID:void 0,messageReadSeq:void 0,topicID:void 0},keyMap:{req:{messageReadSeq:"MsgReadedSeq"}}}),this._map.set(P.SET_ALL_MSG_READ,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.SET_ALL_MSG_READ)}),body:{readAllC2CMessage:0,groupMessageReadInfoList:[]},keyMap:{req:{readAllC2CMessage:"C2CReadAllMsg",groupMessageReadInfoList:"GroupReadInfo",messageSequence:"MsgSeq"},res:{C2CReadAllMsg:"readAllC2CMessage",GroupReadInfoArray:"groupMessageReadInfoList"}}}),this._map.set(P.DEL_C2C_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.DEL_C2C_MSG)}),body:{fromAccount:"",to:"",keyList:void 0},keyMap:{req:{keyList:"MsgKeyList"}}}),this._map.set(P.DEL_GRP_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.DEL_GRP_MSG)}),body:{groupID:"",deleter:"",keyList:void 0,topicID:void 0},keyMap:{req:{deleter:"Deleter_Account",keyList:"Seqs"}}}),this._map.set(P.TRANSLATE_TEXT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_TRANSLATE,".").concat(P.TRANSLATE_TEXT)}),body:{sourceTextList:void 0,SDKAppID:0,from:0,source:"",target:""},keyMap:{req:{sourceTextList:"SourceText",SDKAppID:"SdkAppId",from:"FromAccount"},res:{TargetText:"translatedTextList",RequestId:"requestID",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(P.VOICE_TO_TEXT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_SPEECH,".").concat(P.VOICE_TO_TEXT)}),body:{url:"",SDKAppID:0,format:"",sourceType:0,language:""},keyMap:{req:{url:"BytesUrl",SDKAppID:"Uint32Sdkappid",format:"BytesVoiceFormat",sourceType:"Uint64SourceType",language:"BytesEngServiceType"},res:{BytesRequestid:"requestID",BytesResult:"result",CmdErrorCode:"error",ErrorCode:"code",ErrorInfo:"message"}}}),this._map.set(P.MODIFY_GRP_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.MODIFY_GRP_MSG)}),body:{groupID:"",topicID:void 0,sequence:0,version:0,elements:void 0,cloudCustomData:void 0},keyMap:{req:{sequence:"MsgSeq",version:"MsgVersion",type:"MsgType",content:"MsgContent"}}}),this._map.set(P.GET_READ_RECEIPT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequence:"MsgSeq"}}}),this._map.set(P.SEND_C2C_READ_RECEIPT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.SEND_C2C_READ_RECEIPT)}),body:{peerAccount:"",messageInfoList:void 0},keyMap:{req:{peerAccount:"Peer_Account",messageInfoList:"C2CMsgInfo",fromAccount:"From_Account",toAccount:"To_Account",sequence:"MsgSeq",random:"MsgRandom",time:"MsgTime",clientTime:"MsgClientTime"}}}),this._map.set(P.SEND_READ_RECEIPT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.SEND_READ_RECEIPT)}),body:{groupID:"",sequenceList:void 0},keyMap:{req:{sequenceList:"MsgSeqList",sequence:"MsgSeq"}}}),this._map.set(P.GET_READ_RECEIPT_DETAIL,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_READ_RECEIPT_DETAIL)}),body:{groupID:"",sequence:void 0,flag:0,cursor:0,count:0},keyMap:{req:{sequence:"MsgSeq",count:"Num"},res:{ReadList:"readUserIDList",Read_Account:"userID",UnreadList:"unreadUserIDList",Unread_Account:"userID",IsFinish:"isCompleted"}}}),this._map.set(P.MODIFY_C2C_MSG_EXT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.MODIFY_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(P.GET_C2C_MSG_EXT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.GET_C2C_MSG_EXT)}),body:{from:void 0,to:void 0,messageKey:void 0,startSequence:void 0}}),this._map.set(P.MODIFY_GRP_MSG_EXT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.MODIFY_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,operateType:void 0,extensionList:void 0}}),this._map.set(P.GET_GRP_MSG_EXT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.GET_GRP_MSG_EXT)}),body:{groupID:void 0,topicID:void 0,messageSequence:void 0,startSequence:void 0}}),this._map.set(P.ADD_C2C_MSG_REACTION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.ADD_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(P.RM_C2C_MSG_REACTION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.RM_C2C_MSG_REACTION)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(P.GET_C2C_MSG_REACTIONS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.GET_C2C_MSG_REACTIONS)}),body:{from:void 0,to:void 0,messageKeyList:void 0,count:void 0}}),this._map.set(P.GET_C2C_MSG_REACTION_USER_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.GET_C2C_MSG_REACTION_USER_LIST)}),body:{from:void 0,to:void 0,reactionID:void 0,messageKey:void 0,count:void 0}}),this._map.set(P.ADD_GRP_MSG_REACTION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.ADD_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Add_Account"}}}),this._map.set(P.RM_GRP_MSG_REACTION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.RM_GRP_MSG_REACTION)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,userIDList:void 0},keyMap:{req:{userIDList:"Del_Account"}}}),this._map.set(P.GET_GRP_MSG_REACTIONS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.GET_GRP_MSG_REACTIONS)}),body:{groupID:void 0,topicID:void 0,messageSequenceList:void 0,count:void 0},keyMap:{res:{MsgSeq:"messageSequence"}}}),this._map.set(P.GET_GRP_MSG_REACTION_USER_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM_MSG_EXT,".").concat(P.GET_GRP_MSG_REACTION_USER_LIST)}),body:{groupID:void 0,topicID:void 0,reactionID:void 0,messageSequence:void 0,nextSeq:void 0,count:void 0}}),this._map.set(P.GET_C2C_PEER_READ_TIME,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.GET_C2C_PEER_READ_TIME)}),body:{userIDList:void 0},keyMap:{req:{userIDList:"To_Account"},res:{ReadTime:"peerReadTimeList"}}}),this._map.set(P.PAGING_GET_CONV_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.PAGING_GET_CONV_LIST)}),body:{fromAccount:void 0,timeStamp:void 0,startIndex:void 0,pinnedTimeStamp:void 0,pinnedStartIndex:void 0,orderType:void 0,messageAssistFlag:15,assistFlag:31},keyMap:{req:{messageAssistFlag:"MsgAssistFlags",assistFlag:"AssistFlags",pinnedTimeStamp:"TopTimeStamp",pinnedStartIndex:"TopStartIndex"},res:{SessionItem:"conversations",ToAccount:"groupID",To_Account:"userID",UnreadMsgCount:"unreadCount",MsgGroupReadedSeq:"messageReadSeq",C2cPeerReadTime:"c2cPeerReadTime",LastMsgFlags:"lastMessageFlag",TopFlags:"isPinned",TopTimeStamp:"pinnedTimeStamp",TopStartIndex:"pinnedStartIndex",GroupId:"convGroupID",C2cRemark:"friendRemark",MsgRecvOption:"messageRemindType",GroupIgnoredUnreadSeqCount:"noUnreadCount",GroupNextMsgSeq:"nextMessageSeq"}}}),this._map.set(P.DEL_CONV,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.DEL_CONV)}),body:{fromAccount:"",conversationList:void 0,clearHistoryMessage:void 0},keyMap:{req:{toGroupID:"ToGroupid",clearHistoryMessage:"ClearRamble",conversationList:"ContactItem"},res:{ResultItem:"resultList",ToGroupid:"groupID",ResultCode:"code",ResultInfo:"info"}}}),this._map.set(P.CLEAR_HISTORY_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.CLEAR_HISTORY_MSG)}),body:{fromAccount:"",toAccount:void 0,type:1,toGroupID:void 0},keyMap:{req:{toGroupID:"ToGroupid"}}}),this._map.set(P.PIN_CONV,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.PIN_CONV)}),body:{fromAccount:"",operationType:1,itemList:void 0},keyMap:{req:{itemList:"RecentContactItem"}}}),this._map.set(P.DEL_GROUP_AT_TIPS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.DEL_GROUP_AT_TIPS)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(P.SET_CONV_CUSTOM_DATA,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(P.MARK_CONV,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.MARK_CONV)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"MarkItem",operationType:"OptType",groupID:"ToGroupId"},res:{ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(P.CREATE_CONV_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.CREATE_CONV_GRP)}),body:{fromAccount:"",itemList:void 0},keyMap:{req:{itemList:"GroupContactItem",groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType"}}}),this._map.set(P.DEL_CONV_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.DEL_CONV_GRP)}),body:{fromAccount:"",groupName:void 0},keyMap:{res:{GroupId:"convGroupID"}}}),this._map.set(P.RENAME_CONV_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0},keyMap:{req:{oldName:"OldGroupName",newName:"NewGroupName",groupID:"ToGroupId",operationType:"ContactOptType",groupName:"OldGroupName",updateItem:"ContactUpdateItem"},res:{ContactOptType:"operationType",ToGroupId:"groupID",GroupId:"convGroupID"}}}),this._map.set(P.ADD_CONV_TO_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:{groupName:void 0,updateGroupType:void 0,updateItem:void 0}}}),this._map.set(P.DEL_CONV_FROM_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.RENAME_CONV_GRP)}),body:{fromAccount:"",updateType:void 0,updateGroup:void 0}}),this._map.set(P.GET_CONV_GRP_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.GET_CONV_GRP_LIST)}),body:{fromAccount:"",startIndex:void 0},keyMap:{res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList"}}}),this._map.set(P.SEARCH_CONV_GRP_MARK,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.RECENT_CONTACT,".").concat(P.SEARCH_CONV_GRP_MARK)}),body:{fromAccount:"",contactItem:void 0},keyMap:{req:{groupID:"ToGroupId"},res:{GroupId:"convGroupID",ToGroupId:"groupID",OptType:"operationType",CustomMark:"customData",ContactGroupId:"convGroupIDList",ContactResultItem:"contactItem"}}}),this._map.set(P.GET_USER_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.PROFILE,".").concat(P.GET_USER_PROFILE)}),body:{fromAccount:"",userItem:[]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(P.UPDATE_MY_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.PROFILE,".").concat(P.UPDATE_MY_PROFILE)}),body:{fromAccount:"",profileItem:[{tag:at.NICK,value:""},{tag:at.GENDER,value:""},{tag:at.ALLOWTYPE,value:""},{tag:at.AVATAR,value:""}]},keyMap:{req:{toAccount:"To_Account",standardSequence:"StandardSequence",customSequence:"CustomSequence"}}}),this._map.set(P.GET_BL,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.GET_BL)}),body:{fromAccount:"",startIndex:0,maxLimited:30}}),this._map.set(P.ADD_TO_BL,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.ADD_TO_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(P.RM_FROM_BL,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.RM_FROM_BL)}),body:{fromAccount:"",toAccount:[]}}),this._map.set(P.SET_SELF_STATUS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.SET_SELF_STATUS)}),body:{customStatus:""}}),this._map.set(P.GET_USER_STATUS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.GET_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{UserStatusList:"successUserList",ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID",Status:"statusType"}}}),this._map.set(P.SUB_USER_STATUS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.SUB_USER_STATUS)}),body:{userIDList:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(P.UNSUB_USER_STATUS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.UNSUB_USER_STATUS)}),body:{userIDList:void 0,unsubscribeAll:void 0},keyMap:{res:{ErrorList:"failureUserList",To_Account:"userID",Invalid_Account:"invalidUserID"}}}),this._map.set(P.GET_FD_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.GET_FD_LIST)}),body:{fromAccount:"",startIndex:0,standardSequence:0,customSequence:0},keyMap:{res:{FriendNum:"friendCount",UserDataItem:"resultList",ValueItem:"tagValueList"}}}),this._map.set(P.ADD_FD,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.ADD_FD)}),body:{fromAccount:"",addFriendItem:[],type:""},keyMap:{req:{source:"AddSource",wording:"AddWording",type:"AddType"},res:{ResultItem:"resultList"}}}),this._map.set(P.UPDATE_FD,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.UPDATE_FD)}),body:{fromAccount:"",updateItem:void 0},keyMap:{req:{snsItem:"SnsItem"},res:{ResultItem:"resultList"}}}),this._map.set(P.DEL_FD,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.DEL_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"DeleteType"},res:{ResultItem:"resultList"}}}),this._map.set(P.GET_FD_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.GET_FD_PROFILE)}),body:{fromAccount:"",userIDList:void 0},keyMap:{res:{InfoItem:"resultList",SnsProfileItem:"tagValueList"}}}),this._map.set(P.CHECK_FD,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.CHECK_FD)}),body:{fromAccount:"",userIDList:[],type:""},keyMap:{req:{type:"CheckType"},res:{InfoItem:"resultList"}}}),this._map.set(P.GET_FD_APPLICATION_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.GET_FD_APPLICATION_LIST)}),body:{fromAccount:"",applicationType:"",startTime:0,maxLimited:0,lastSequence:0},keyMap:{res:{PendencyItem:"resultList",AddSource:"source",AddTime:"time",AddWording:"wording",Image:"avatar",UnreadPendencyCount:"unreadCount",To_Account:"userID",PendencyType:"type"}}}),this._map.set(P.RESPOND_FD_APPLICATION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.RESPOND_FD_APPLICATION)}),body:{fromAccount:"",responseFriendItem:[]},keyMap:{req:{tag:"TagName",action:"ResponseAction"},res:{ResultItem:"resultList"}}}),this._map.set(P.DEL_FD_APPLICATION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.DEL_FD_APPLICATION)}),body:{fromAccount:"",type:"",userIDList:void 0},keyMap:{req:{type:"PendencyType",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(P.REPORT_FD_APPLICATION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.REPORT_FD_APPLICATION)}),body:{fromAccount:"",latestTimeStamp:""},keyMap:{req:{latestTimeStamp:"LatestPendencyTimeStamp"}}}),this._map.set(P.CREATE_FD_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.CREATE_FD_GRP)}),body:{fromAccount:"",groupName:void 0,userIDList:void 0},keyMap:{req:{groupName:"GroupName",userIDList:"To_Account"},res:{ResultItem:"resultList"}}}),this._map.set(P.DEL_FD_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.DEL_FD_GRP)}),body:{fromAccount:"",nameList:void 0},keyMap:{req:{nameList:"GroupName"}}}),this._map.set(P.GET_FD_GRP_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.GET_FD_GRP_LIST)}),body:{fromAccount:"",lastSequence:0,needFriend:"Need_Friend_Type_Yes"},keyMap:{res:{ResultItem:"resultList",GroupName:"name",FriendNumber:"friendCount",To_Account:"userIDList"}}}),this._map.set(P.UPDATE_FD_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FD,".").concat(P.UPDATE_FD_GRP)}),body:{fromAccount:"",oldName:"",newName:void 0,updateGroupItem:void 0},keyMap:{req:{oldName:"GroupOldName",newName:"GroupNewName"},res:{UpdateType:"type",ResultItem:"resultList"}}}),this._map.set(P.GET_GRP_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_LIST)}),body:{memberAccount:"",limit:void 0,offset:void 0,groupType:void 0,responseFilter:{groupBaseInfoFilter:void 0,selfInfoFilter:void 0},isSupportTopic:0,needAppDefineData:1},keyMap:{req:{memberAccount:"Member_Account"},res:{GroupIdList:"groups",MsgSeq:"readedSequence",LastRecallTime:"_lastRevokedTime",AppDefinedData:"groupCustomField"}}}),this._map.set(P.GET_GRP_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_PROFILE)}),body:{groupIDList:void 0,responseFilter:{groupBaseInfoFilter:void 0,groupCustomFieldFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0}},keyMap:{req:{groupIDList:"GroupIdList",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",groupCustomFieldFilter:"AppDefinedDataFilter_Group",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{GroupIdList:"groups",AppDefinedData:"groupCustomField",AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_Group:"groupCustomFieldFilter",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",InfoSeq:"infoSequence",MemberList:"members",GroupInfo:"groups",ShutUpUntil:"muteUntil",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(P.CREATE_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.CREATE_GRP)}),body:{type:void 0,name:void 0,groupID:void 0,ownerID:void 0,introduction:void 0,notification:void 0,maxMemberNum:void 0,joinOption:void 0,memberList:void 0,groupCustomField:void 0,memberCustomField:void 0,webPushFlag:1,avatar:"",isSupportTopic:void 0,inviteOption:void 0},keyMap:{req:{ownerID:"Owner_Account",userID:"Member_Account",avatar:"FaceUrl",maxMemberNum:"MaxMemberCount",joinOption:"ApplyJoinOption",groupCustomField:"AppDefinedData",memberCustomField:"AppMemberDefinedData",inviteOption:"InviteJoinOption"},res:{HugeGroupFlag:"avChatRoomFlag",OverJoinedGroupLimit_Account:"overLimitUserIDList"}}}),this._map.set(P.DISMISS_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.DISMISS_GRP)}),body:{groupID:void 0}}),this._map.set(P.UPDATE_GRP_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.UPDATE_GRP_PROFILE)}),body:{groupID:void 0,name:void 0,introduction:void 0,notification:void 0,avatar:void 0,joinOption:void 0,groupCustomField:void 0,muteAllMembers:void 0,inviteOption:void 0},keyMap:{req:{groupCustomField:"AppDefinedData",muteAllMembers:"ShutUpAllMember",joinOption:"ApplyJoinOption",avatar:"FaceUrl",inviteOption:"InviteJoinOption"},res:{AppDefinedData:"groupCustomField",ShutUpAllMember:"muteAllMembers"}}}),this._map.set(P.APPLY_JOIN_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1,historyMessageFlag:void 0},keyMap:{req:{applyMessage:"ApplyMsg",historyMessageFlag:"HugeGroupHistoryMsgFlag"},res:{HugeGroupFlag:"avChatRoomFlag",AVChatRoomKey:"avChatRoomKey",RspMsgList:"messageList",ToGroupId:"to"}}}),this._map.set(P.APPLY_JOIN_GRP_NOAUTH,(t.a2,t.tinyid,{head:v(v({},ae(t,ol)),{},{servcmd:"".concat(se.NAME.BIG_GRP_NO_AUTH,".").concat(P.APPLY_JOIN_GRP)}),body:{groupID:void 0,applyMessage:void 0,userDefinedField:void 0,webPushFlag:1},keyMap:{req:{applyMessage:"ApplyMsg"},res:{HugeGroupFlag:"avChatRoomFlag"}}})),this._map.set(P.QUIT_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.QUIT_GRP)}),body:{groupID:void 0}}),this._map.set(P.SEARCH_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.SEARCH_GRP)}),body:{groupIDList:void 0,responseFilter:{groupBasePublicInfoFilter:["Type","Name","Introduction","Notification","FaceUrl","CreateTime","Owner_Account","LastInfoTime","LastMsgTime","NextMsgSeq","MemberNum","MaxMemberNum","ApplyJoinOption","InviteJoinOption"]}}}),this._map.set(P.CHANGE_GRP_OWNER,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.CHANGE_GRP_OWNER)}),body:{groupID:void 0,newOwnerID:void 0},keyMap:{req:{newOwnerID:"NewOwner_Account"}}}),this._map.set(P.HANDLE_GRP_APPLICATION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.HANDLE_GRP_APPLICATION)}),body:{groupID:void 0,applicant:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(P.HANDLE_INVITE_JOIN_GRP,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.HANDLE_INVITE_JOIN_GRP)}),body:{groupID:void 0,applicant:void 0,invitee:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,userDefinedField:void 0},keyMap:{req:{applicant:"Applicant_Account",invitee:"Invited_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg"}}}),this._map.set(P.HANDLE_GRP_INVITATION,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.HANDLE_GRP_INVITATION)}),body:{groupID:void 0,inviter:void 0,handleAction:void 0,handleMessage:void 0,authentication:void 0,messageKey:void 0,userDefinedField:void 0},keyMap:{req:{inviter:"Inviter_Account",handleAction:"HandleMsg",handleMessage:"ApprovalMsg",messageKey:"MsgKey"}}}),this._map.set(P.GET_GRP_PENDENCY,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_PENDENCY)}),body:{startTime:void 0,limit:void 0,handleAccount:void 0},keyMap:{req:{handleAccount:"Handle_Account"},res:{To_Account:"userID",ApplyInviteMsg:"note"}}}),this._map.set(P.DEL_GRP_SYSTEM_NOTICE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.DEL_GRP_SYSTEM_NOTICE)}),body:{messageListToDelete:void 0},keyMap:{req:{messageListToDelete:"DelMsgList",messageSeq:"MsgSeq",messageRandom:"MsgRandom"}}}),this._map.set(P.AV_POLLING,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.BIG_GRP_POLLING,".").concat(P.AV_POLLING)}),body:{USP:1,startSeq:1,startBroadcastSeq:void 0,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}}),this._map.set(P.AV_NOAUTH_POLLING,(t.a2,t.tinyid,{head:v(v({},ae(t,Gr)),{},{servcmd:"".concat(se.NAME.BIG_GRP_POLLING_NO_AUTH,".").concat(P.AV_POLLING)}),body:{USP:1,startSeq:1,holdTime:90,key:void 0,simplifiedMessage:void 0},keyMap:{req:{USP:"USP"},res:{ToGroupId:"groupID",RspBroadcastMsgList:"broadcastMessageList",IsSystemMsg:"isSystemMessage"}}})),this._map.set(P.GET_ONLINE_MBR_NUM,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_ONLINE_MBR_NUM)}),body:{groupID:void 0},keyMap:{res:{OnlineMemberNum:"memberCount"}}}),this._map.set(P.SET_GRP_ATTR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.SET_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(P.MODIFY_GRP_ATTR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.MODIFY_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key",value:"value"}}}),this._map.set(P.DEL_GRP_ATTR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.DEL_GRP_ATTR)}),body:{groupID:void 0,groupAttributeList:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]},keyMap:{req:{key:"key"}}}),this._map.set(P.CLEAR_GRP_ATTR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.CLEAR_GRP_ATTR)}),body:{groupID:void 0,mainSequence:void 0,avChatRoomKey:void 0,attributeControl:["RaceConflict"]}}),this._map.set(P.GET_GRP_ATTR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_ATTR,".").concat(P.GET_GRP_ATTR)}),body:{groupID:void 0,avChatRoomKey:void 0,groupType:1},keyMap:{req:{avChatRoomKey:"Key",groupType:"GroupType"}}}),this._map.set(P.GET_GRP_NOTIFY,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_NOTIFY)}),body:{notifyReqList:[]},keyMap:{req:{notifyReqList:"NotifyReqList"},res:{NextMsgTime:"nextRevokedTime",NotifyMsgList:"notifyList",NotifyRspList:"notifyRspList"}}}),this._map.set(P.UPDATE_GRP_COUNTER,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.UPDATE_GRP_COUNTER)}),body:{groupID:void 0,counterList:void 0,avChatRoomKey:void 0,mode:void 0},keyMap:{req:{counterList:"GroupCounter"}}}),this._map.set(P.GET_GRP_COUNTER,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_COUNTER)}),body:{groupID:void 0,keyList:[],avChatRoomKey:void 0},keyMap:{req:{keyList:"GroupCounterKeys"}}}),this._map.set(P.CREATE_TOPIC,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_COMMUNITY,".").concat(P.CREATE_TOPIC)}),body:{groupID:void 0,topicName:void 0,avatar:void 0,customData:void 0,topicID:void 0,notification:void 0,introduction:void 0},keyMap:{req:{avatar:"FaceUrl"}}}),this._map.set(P.DEL_TOPIC,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_COMMUNITY,".").concat(P.DEL_TOPIC)}),body:{groupID:void 0,topicIDList:void 0},keyMap:{req:{topicIDList:"TopicIdList"},res:{DestroyResultItem:"resultList"}}}),this._map.set(P.UPDATE_TOPIC_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_COMMUNITY,".").concat(P.UPDATE_TOPIC_PROFILE)}),body:{groupID:void 0,topicID:void 0,avatar:void 0,customData:void 0,notification:void 0,introduction:void 0,muteAllMembers:void 0,topicName:void 0},keyMap:{req:{avatar:"FaceUrl",muteAllMembers:"ShutUpAllMember"}}}),this._map.set(P.GET_TOPIC_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_COMMUNITY,".").concat(P.GET_TOPIC_LIST)}),body:{groupID:void 0,topicIDList:void 0,MemberInfoFilter:["NoUnreadSeqList"]},keyMap:{req:{topicIDList:"TopicIdList"},res:{TopicAndSelfInfo:"topicInfoList",TopicInfo:"topic",GroupID:"groupID",ShutUpTime:"muteTime",ShutUpAllFlag:"muteAllMembers",LastMsgTime:"lastMessageTime",MsgSeq:"readedSequence",LastMsgSeq:"sequence"}}}),this._map.set(P.GET_GRP_MBR_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_MBR_LIST)}),body:{groupID:void 0,limit:0,offset:void 0,next:void 0,memberRoleFilter:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{AppMemberDefinedData:"memberCustomField",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",MemberList:"members",ShutUpUntil:"muteUntil"}}}),this._map.set(P.GET_AV_MBR_LIST,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_AV,".").concat(P.GET_AV_MBR_LIST)}),body:{groupID:void 0,offset:void 0,filter:void 0},keyMap:{req:{offset:"Timestamp",filter:"Mark"},res:{NextTimestamp:"offset"}}}),this._map.set(P.GET_GRP_MBR_PROFILE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.GET_GRP_MBR_PROFILE)}),body:{groupID:void 0,userIDList:void 0,memberInfoFilter:void 0,memberCustomFieldFilter:void 0},keyMap:{req:{userIDList:"Member_List_Account",memberCustomFieldFilter:"AppDefinedDataFilter_GroupMember"},res:{MemberList:"members",ShutUpUntil:"muteUntil",AppDefinedDataFilter_GroupMember:"memberCustomFieldFilter",AppMemberDefinedData:"memberCustomField"}}}),this._map.set(P.ADD_GRP_MBR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.ADD_GRP_MBR)}),body:{groupID:void 0,silence:void 0,userIDList:void 0},keyMap:{req:{userID:"Member_Account",userIDList:"MemberList"},res:{MemberList:"members"}}}),this._map.set(P.DEL_GRP_MBR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.DEL_GRP_MBR)}),body:{groupID:void 0,userIDList:void 0,reason:void 0},keyMap:{req:{userIDList:"MemberToDel_Account"}}}),this._map.set(P.BAN_AV_MBR,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.BAN_AV_MBR)}),body:{groupID:void 0,userIDList:void 0,duration:void 0,reason:""},keyMap:{req:{userIDList:"Members_Account",duration:"Duration",reason:"Description"}}}),this._map.set(P.MODIFY_GRP_MBR_INFO,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP,".").concat(P.MODIFY_GRP_MBR_INFO)}),body:{groupID:void 0,topicID:void 0,userID:void 0,messageRemindType:void 0,nameCard:void 0,role:void 0,memberCustomField:void 0,muteTime:void 0},keyMap:{req:{userID:"Member_Account",memberCustomField:"AppMemberDefinedData",muteTime:"ShutUpTime",messageRemindType:"MsgFlag"}}}),this._map.set(P.MARK_AV_MBR_INFO,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_AV,".").concat(P.MARK_AV_MBR_INFO)}),body:{groupID:void 0,operationType:1,memberList:[]},keyMap:{req:{operationType:"CommandType",memberList:"MemberList",markType:"Marks",userID:"Member_Account"},res:{CommandType:"operationType",Marks:"markType",Member_Account:"userID"}}}),this._map.set(P.CS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.MSG_SEARCH,".").concat(P.CS)}),body:{keywordList:void 0,keywordListMatchType:"or",account:void 0,groupID:void 0,count:100,cursor:void 0,messageTypeList:void 0,senderUserIDList:void 0,startTime:void 0,endTime:void 0},keyMap:{req:{keywordListMatchType:"MatchType",account:"PeerAccount",groupID:"GroupID",messageTypeList:"MsgTypeList",senderUserIDList:"SendUserIDList",keywords:"Keywords",keywordMatchType:"KeywordMatchType",count:"Count",miniBirthday:"UserBirthStart",maxBirthday:"UserBirthEnd",gender:"UserGenderType",groupTypeList:"GroupType",groupIDList:"GroupIdList"},res:{GroupID:"groupID",UserID:"userID",ErrorCode:"code",ErrorInfo:"message",TotalCount:"totalCount",Count:"messageCount",LastMsgTime:"lastMessageTime",ConversationMsgs:"searchResult",IsNeedReadReceipt:"needReadReceipt",IsPeerRead:"readReceiptSentByPeer",MsgSeq:"sequence",ReqMsgSeq:"sequence",IsSystemMsg:"isSystemMessage",ToGroupId:"to",EnumFrom_AccountType:"fromAccountType",EnumTo_AccountType:"toAccountType",GroupCode:"groupCode",MsgContent:"content",ClientSeq:"clientSequence",ToTopicId:"topicID",InvisibleMsgSeq:"invisibleSequenceList",Users:"userList",ProfileItems:"profileItems",StrValue:"value",IntValue:"value",Groups:"groupList",GroupFaceUrl:"avatar",GroupIntroduction:"introduction",GroupOwnerUserID:"ownerID",GroupOwnerUserName:"ownerNick",GroupOwnerTinyID:"ownerTinyID",GroupMemberNum:"memberNum",GroupName:"name",GroupType:"type",GroupMembers:"groupMemberList",GroupMemberUserID:"userID",GroupMemberTinyID:"userTinyID",GroupMemberUserName:"nick",GroupMemberNameCard:"nameCard"}}}),this._map.set(P.USER_CS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.USER_SEARCH,".").concat(P.CS)}),body:{keywords:void 0,keywordMatchType:0,miniBirthday:void 0,maxBirthday:void 0,gender:void 0,count:20,cursor:void 0}}),this._map.set(P.GRP_CS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_SEARCH,".").concat(P.CS)}),body:{keywords:void 0,keywordMatchType:0,groupType:void 0,count:20,cursor:void 0}}),this._map.set(P.MBR_CS,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.GRP_MEMBER_SEARCH,".").concat(P.CS)}),body:{keywords:void 0,keywordMatchType:0,groupType:void 0,groupIDList:void 0,count:20,cursor:void 0}}),this._map.set(P.SSO_STAT,{head:v(v({},i),{},{servcmd:"".concat(se.NAME.IM_OPEN_STAT,".").concat(P.SSO_STAT)}),body:{header:{},event:[],quality:[]},keyMap:{req:{SDKType:"sdk_type",SDKVersion:"sdk_version",deviceType:"device_type",platform:"platform",instanceID:"instance_id",traceID:"trace_id",SDKAppID:"sdk_app_id",userID:"user_id",tinyID:"tiny_id",extension:"extension",timestamp:"timestamp",networkType:"network_type",eventType:"event_type",code:"error_code",message:"error_message",moreMessage:"more_message",duplicate:"duplicate",costTime:"cost_time",level:"level",qualityType:"quality_type",reportIndex:"report_index",wholePeriod:"whole_period",totalCount:"total_count",rttCount:"success_count_business",successRateOfRequest:"percent_business",countLessThan1Second:"success_count_business",percentOfCountLessThan1Second:"percent_business",countLessThan3Second:"success_count_platform",percentOfCountLessThan3Second:"percent_platform",successCountOfBusiness:"success_count_business",successRateOfBusiness:"percent_business",successCountOfPlatform:"success_count_platform",successRateOfPlatform:"percent_platform",successCountOfMessageReceived:"success_count_business",successRateOfMessageReceived:"percent_business",avgRTT:"average_value",avgDelay:"average_value",avgValue:"average_value",uiPlatform:"ui_platform"}}}),this._map.set(P.PING,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.HEARTBEAT,".").concat(P.PING)}),body:{}}),this._map.set(P.MSG_PUSH,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_PUSH,".").concat(P.MSG_PUSH)}),body:{},keyMap:{res:{C2cMsgArray:"C2CMessageArray",GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",C2cNotifyMsgArray:"C2CNotifyMessageArray",C2cMsgInfo:"C2CReadReceiptArray",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyAdd_Account:"userID",ProfileImNick:"nick",PendencyType:"applicationType",C2CReadAllMsg:"readAllC2CMessage",IsNeedReadReceipt:"needReadReceipt",Status:"statusType"}}}),this._map.set(P.MULTI_MSG_PUSH,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_PUSH,".").concat(P.MULTI_MSG_PUSH)}),body:{},keyMap:{res:{GroupMsgArray:"groupMessageArray",GroupTips:"groupTips",ClientSeq:"clientSequence",MsgPriority:"priority",NoticeSeq:"noticeSequence",MsgContent:"content",MsgType:"type",MsgBody:"elements",ToGroupId:"to",Desc:"description",Ext:"extension",IsSyncMsg:"isSyncMessage",Flag:"needSync",NeedAck:"needAck",PendencyType:"applicationType"}}}),this._map.set(P.MSG_PUSH_ACK,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OPEN_IM,".").concat(P.MSG_PUSH_ACK)}),body:{sessionData:void 0},keyMap:{req:{sessionData:"SessionData"}}}),this._map.set(P.STATUS_FORCE_OFFLINE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.STATUS_FORCE_OFFLINE)}),body:{},keyMap:{res:{C2cNotifyMsgArray:"C2CNotifyMessageArray",NoticeSeq:"noticeSequence",KickoutMsgNotify:"kickoutMsgNotify",NewInstInfo:"newInstanceInfo"}}}),this._map.set(P.DOWNLOAD_MERGER_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_LONG_MSG,".").concat(P.DOWNLOAD_MERGER_MSG)}),body:{downloadKey:""},keyMap:{res:{Data:"data",Desc:"description",Ext:"extension",Download_Flag:"downloadFlag",ThumbUUID:"thumbUUID",VideoUUID:"videoUUID"}}}),this._map.set(P.UPLOAD_MERGER_MSG,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_LONG_MSG,".").concat(P.UPLOAD_MERGER_MSG)}),body:{messageList:[]},keyMap:{req:{fromAccount:"From_Account",toAccount:"To_Account",msgTimeStamp:"MsgTimeStamp",msgSeq:"MsgSeq",msgRandom:"MsgRandom",msgBody:"MsgBody",type:"MsgType",content:"MsgContent",data:"Data",description:"Desc",extension:"Ext",sizeType:"Type",uuid:"UUID",url:"",imageUrl:"URL",fileUrl:"Url",remoteAudioUrl:"Url",remoteVideoUrl:"VideoUrl",thumbUUID:"ThumbUUID",videoUUID:"VideoUUID",videoUrl:"",downloadFlag:"Download_Flag",from:"From_Account",time:"MsgTimeStamp",messageRandom:"MsgRandom",messageSequence:"MsgSeq",elements:"MsgBody",clientSequence:"ClientSeq",payload:"MsgContent",messageList:"MsgList",messageNumber:"MsgNum",abstractList:"AbstractList",messageBody:"MsgBody"}}}),this._map.set(P.FOLLOW,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FOLLOW,".").concat(P.FOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"FollowItem"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(P.UNFOLLOW,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FOLLOW,".").concat(P.UNFOLLOW)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(P.GET_FOLLOW_INFO,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FOLLOW,".").concat(P.GET_FOLLOW_INFO)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{FollowInfo:"followInfoList",To_Account:"userID",FollowerCount:"followersCount",FollowingCount:"followingCount",MutualFollowingCount:"mutualFollowersCount"}}}),this._map.set(P.GET_FOLLOW,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FOLLOW,".").concat(P.GET_FOLLOW)}),body:{fromAccount:"",type:1,nextCursor:"",count:500},keyMap:{req:{type:"FollowType",nextCursor:"StartCursor",count:"WantNum"},res:{FollowItem:"resultList",To_Account:"userID",ProfileItem:"profileList"}}}),this._map.set(P.CHECK_FOLLOW_TYPE,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.FOLLOW,".").concat(P.CHECK_FOLLOW_TYPE)}),body:{fromAccount:"",userIDList:[]},keyMap:{req:{userIDList:"To_Account"},res:{ResultItem:"resultList",To_Account:"userID"}}}),this._map.set(P.SET_TOKEN,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.SET_TOKEN)}),body:{tokenID:"",pushMsg:0,sdkAppID:0,businessID:"",deviceBrand:"",deviceToken:"",isTpns:0,isWebUniapp:0,notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:""},keyMap:{req:{tokenID:"TokenID",pushMsg:"PushMsg",sdkAppID:"EnterVersion",businessID:"BusiID",deviceBrand:"InstType",deviceToken:"VarToken",isTpns:"IsTpns",notificationStatus:"NotificationStatus",deviceModel:"DeviceModel",systemVersion:"SystemVersion",pushVersion:"PushPluginVersion"}}}),this._map.set(P.STAT_FOREGROUND,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.STAT_FOREGROUND)}),body:{isWebUniapp:0}}),this._map.set(P.STAT_BACKGROUND,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_OPEN_STATUS,".").concat(P.STAT_BACKGROUND)}),body:{C2CUnread:0,GroupUnread:0,isWebUniapp:0},keyMap:{req:{c2cUnreadCount:"C2cUnread",groupUnreadCount:"GrpUnread"}}}),this._map.set(P.PUSH_REPORT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.OFFLINE_PUSH_REPORT,".").concat(P.PUSH_REPORT)}),body:{eventList:[]},keyMap:{req:{eventList:"UinappPushEvents",type:"EventType",time:"EventTime",pushId:"ClickExt"}}}),this._map.set(P.SET_ALL_RECEIVE_MSG_OPT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_MSG_LOGIC,".").concat(P.SET_ALL_RECEIVE_MSG_OPT)}),body:{startTime:0,endTime:0,isRepeated:0,messageRemindType:0},keyMap:{req:{messageRemindType:"Level"}}}),this._map.set(P.GET_ALL_RECEIVE_MSG_OPT,{head:v(v({},t),{},{servcmd:"".concat(se.NAME.IM_MSG_LOGIC,".").concat(P.GET_ALL_RECEIVE_MSG_OPT)}),body:{toAccount:void 0}})}},{key:"has",value:function(t){return this._map.has(t)}},{key:"get",value:function(t){return this._map.get(t)}},{key:"update",value:function(){this._fillMap()}},{key:"getKeyMap",value:function(t){return this.has(t)?this.get(t).keyMap||{}:(E.w("".concat(this._n,".getKeyMap unknown P:").concat(t)),{})}},{key:"getProtocolData",value:function(i){var s=i.P,o=i.data,i=this.get(s),s=null;if(o){var c,l=this._simpleDeepCopy(i),l=this._updateService(o,l),p=l.body,m=Object.create(null);for(c in p)if(Object.prototype.hasOwnProperty.call(p,c)){if(m[c]=p[c],o[c]===void 0)continue;m[c]=o[c]}l.body=m,s=this._getUplinkData(l)}else s=this._getUplinkData(i);return s}},{key:"_getUplinkData",value:function(o){var o=this._dataCleaner(o),i=ao(o.head),i=vd(o.body,this._getReqKeyMap(i));return o.body=i,o}},{key:"_updateService",value:function(t,o){var i,s,c=ao(o.head);return this._isFromGroupRequest(o)&&(i=t.type,s=t.groupID,t=(t=t.groupIDList)===void 0?[]:t,q(s=s===void 0?void 0:s)&&(s=t[0]||""),bt({type:i,groupID:s})&&(o.head.servcmd="".concat(se.NAME.GRP_COMMUNITY,".").concat(c))),o}},{key:"_isFromGroupRequest",value:function(t){return t.head.servcmd.includes(se.NAME.GRP)||t.head.servcmd.includes(se.NAME.GRP_ATTR)}},{key:"_getReqKeyMap",value:function(t){return t=this.getKeyMap(t),v(v({},ga.req),t.req)}},{key:"_dataCleaner",value:function(t){var o,i=Array.isArray(t)?[]:Object.create(null);for(o in t)Object.prototype.hasOwnProperty.call(t,o)&&fc(o)&&t[o]!==null&&t[o]!==void 0&&(w(t[o])!=="object"?i[o]=t[o]:i[o]=this._dataCleaner.bind(this)(t[o]));return i}},{key:"_simpleDeepCopy",value:function(t){for(var o,i=Object.keys(t),s={},c=0,l=i.length;c<l;c++)o=i[c],ye(t[o])?s[o]=Array.from(t[o]):ft(t[o])?s[o]=this._simpleDeepCopy(t[o]):s[o]=t[o];return s}}]),wr),$c=[P.MSG_PUSH_ACK],Xc=(V(Qc,[{key:"_onC2CMsgArray",value:function(t){var o=this._sessionM.get(6);t.dataList.forEach(function(i){var s;i.isSyncMessage===1&&(s=i.from,i.from=i.to,i.to=s)}),t.needSync===1&&this._sessionM.get(19).syncOnNeed(),o.onNewMessage({dataList:t.dataList,isInstantMessage:!0})}},{key:"_onC2CMsgModified",value:function(t){this._sessionM.get(6).onMsgModified(t)}},{key:"_onGroupMsgArray",value:function(t){var o=this._sessionM.get(7);o&&o.onNewMessage({event:t.event,dataList:t.dataList,isInstantMessage:!0})}},{key:"_onGroupMsgModified",value:function(t){var o=this._sessionM.get(7);o&&o.onMsgModified(t)}},{key:"_onGroupTips",value:function(t){var o=this._sessionM.get(7);if(o){var i=t.event,s=t.dataList,c=t.isInstantMessage,l=c===void 0||c,p=t.isSyncingEnded;switch(i){case 4:case 6:o.onNewGroupTips({event:i,dataList:s});break;case 5:for(var m=0;m<s.length;m++)if(ye(s[m].elements.revokedInfos))o.onMsgRevoked({dataList:s});else if(ye(s[m].elements.groupMessageReadNotice))o.onMsgReadNotice({dataList:s});else{if(!ye(s[m].elements.readReceiptList)){o.onNewGroupSystemNotice({dataList:s,isInstantMessage:l,isSyncingEnded:p});break}o.onReadReceiptList({dataList:s})}break;case 12:this._sessionM.get(11).onNewGroupAtTips({dataList:s});break;default:E.l("".concat(this._n,"._onGroupTips unknown event:").concat(i," dataList:"),s)}}}},{key:"_onC2CNotifyMsgArray",value:function(t){var o,i=this,s=t.dataList;ye(s)&&(o=this._sessionM.get(6),s.forEach(function(c){var l,p;It(c)&&(c.hasOwnProperty("kickoutMsgNotify")?(l=(p=c.kickoutMsgNotify).kickType,p=(p=p.newInstanceInfo)===void 0?{}:p,l===1?i._sessionM.onMultipleAccountKickedOut(p):l===2?i._sessionM.onMultipleDeviceKickedOut(p):l===3&&i._sessionM.onRestApiKickedOut(p)):c.hasOwnProperty("c2cMessageRevokedNotify")?o&&o.onMsgRevoked({dataList:s},!0):c.hasOwnProperty("c2cMessageReadReceipt")?o&&o.onMsgReadReceipt({dataList:s}):c.hasOwnProperty("c2cMessageReadNotice")?o&&o.onMsgReadNotice({dataList:s}):c.hasOwnProperty("muteNotificationsSync")&&i._sessionM.get(11).onC2CMsgRemindTypeSynced({dataList:s}))}))}},{key:"_onC2CReadReceiptArray",value:function(t){this._sessionM.get(6).onReadReceiptList(t)}},{key:"_onProfileModified",value:function(t){this._sessionM.get(4).onProfileModified({dataList:t.dataList});var o=this._sessionM.get(8);o&&o.onFriendProfileModified({dataList:t.dataList})}},{key:"_onRelationChainModified",value:function(t){this._sessionM.get(4).onRelationChainModified({dataList:t.dataList});var o=this._sessionM.get(8);o&&o.onRelationChainModified({dataList:t.dataList})}},{key:"_onRecentContact",value:function(i){var o,i=i.dataList;!ye(i)||(o=this._sessionM.get(11))&&i.forEach(function(s){var c,l,p=s.pushType;p===1?(c=s.recentContactDeleteItem,o.onConvDeleted(c.recentContactList)):p===2?(c=s.recentContactTopItem,o.onConvPinnedStatus(c.recentContactList,!0)):p===3?(c=s.recentContactTopItem,o.onConvPinnedStatus(c.recentContactList,!1)):p===4?(c=s.recentContactMarkContact,o.onConvMarkUpdated(c.recentContactMarkContactItem)):p===5?(c=s.recentContactCreateContactGroup,o.onConvGroupCreated(c.msgContactGroupContactItem)):p===6?(c=s.recentContactDelContactGroup,o.onConvGroupDeleted(c.msgGroupItem)):p===7&&(p=(c=s.recentContactUpdateContactGroup).updateType,s=c.msgUpdateGroup,c=c.msgUpdateContact,p===1?(l=s.updateGroupType)===1?o.onConvGroupNameUpdated(s):l===2&&o.onConvInGroupUpdated(s):p===2&&o.onConvAddedToOrDeletedFromGroup(c))})}},{key:"_onAllMsgRead",value:function(o){var o=o.dataList,i=this._sessionM.get(11);i&&i.onPushedAllMessageRead(o)}},{key:"_onUserStatusList",value:function(t){this._sessionM.get(4).onUserStatusUpdated(t)}},{key:"_onMsgExtNotify",value:function(t){this._sessionM.get(3).onMsgExtNotify(t)}},{key:"_onMsgReactionNotifyList",value:function(t){this._sessionM.get(34).onReactionNotifyList(t)}},{key:"_onMsgReactionNotify",value:function(t){this._sessionM.get(34).onReactionNotify(t)}},{key:"_onFollowNotify",value:function(t){this._sessionM.get(35).onFollowNotify(t)}},{key:"_onTopicLatestMsg",value:function(t){this._sessionM.get(10).onTopicLatestMsg(t)}},{key:"onMessage",value:function(t){var o=this,i=t.body;if(this._filterMsgFromIMOpenPush(t)){var s,c=i.eventArray,l=i.isInstantMessage,p=i.isSyncingEnded,m=i.needSync;if(ye(c))for(var I,C,S,k=0,G=c.length;k<G;k++)(S=(I=c[k]).event)!==100?S!==24?S!==26?(s=Object.keys(I).find(function(U){return o._keys.indexOf(U)!==-1}))?(C=S===14?{readAllC2CMessage:I[s],groupMessageReadInfoList:I.groupMessageReadNotice||[]}:S===16?{userID:I.userID,timestamp:I.timestamp,readReceiptList:I[s]}:I[s],this._eventHandlerMap.get(s)({event:S,dataList:C,isInstantMessage:l,isSyncingEnded:p,needSync:m})):E.l("".concat(this._n,".onMessage unknown eventItem:"),I):this._onTopicLatestMsg(I):this._onAllRcvMsgOptNotify(I):this._onRoomCustomData(I.content)}}},{key:"_onRoomCustomData",value:function(t){this._sessionM.get(30).onRoomCustomDataReceived(t),E.l("".concat(this._n,"._onRoomCustomData data:").concat(t))}},{key:"_onAllRcvMsgOptNotify",value:function(t){this._sessionM.get(11).onAllRcvMsgOptNotify(t)}},{key:"_filterMsgFromIMOpenPush",value:function(o){var i=o.head,o=o.body,i=i.servcmd,s=!1;return!(s=q(i)?s:i.includes(se.NAME.IM_CONFIG_MANAGER)||i.includes(se.NAME.OVERLOAD_PUSH)||i.includes(se.NAME.STAT_SERVICE))||(i.includes(P.PUSHED_CLOUD_CTRL_CONFIG)?this._sessionM.get(23).onPushedConfig(o):i.includes(P.PUSHED_COMMERCIAL_CONFIG)?this._sessionM.get(27).onPushedConfig(o):i.includes(P.OVERLOAD_NOTIFY)?this._sessionM.onPushedServerOverload(o):i.includes(P.KICK_OTHER)&&(s=Date.now(),this._sessionM.reLoginOnKickOther(),o=new ue("kickOther"),s=s-(i=this._sessionM.get(1).getLastWsHelloTs()),o.setMessage("last wshello time:".concat(i," diff:").concat(s,"ms")).end()),!1)}}]),Qc),va=[{cmd:P.GET_GRP_PROFILE,interval:1,count:8},{cmd:P.UPDATE_GRP_PROFILE,interval:1,count:8},{cmd:P.GET_AV_MBR_LIST,interval:3,count:1},{cmd:P.GET_GRP_PENDENCY,interval:1,count:15},{cmd:P.GET_TOPIC_LIST,interval:1,count:10},{cmd:P.SET_GRP_ATTR,interval:5,count:10},{cmd:P.MODIFY_GRP_ATTR,interval:5,count:10},{cmd:P.DEL_GRP_ATTR,interval:5,count:10},{cmd:P.CLEAR_GRP_ATTR,interval:5,count:10},{cmd:P.GET_GRP_ATTR,interval:5,count:20},{cmd:P.UPDATE_GRP_COUNTER,interval:5,count:20},{cmd:P.GET_GRP_COUNTER,interval:5,count:20},{cmd:P.SET_ALL_MSG_READ,interval:1,count:1},{cmd:P.GET_USER_STATUS,interval:5,count:20},{cmd:P.SUB_USER_STATUS,interval:5,count:20},{cmd:P.UNSUB_USER_STATUS,interval:5,count:20},{cmd:P.CS,interval:5,count:20},{cmd:P.GRP_CS,interval:5,count:20},{cmd:P.MBR_CS,interval:5,count:20},{cmd:P.USER_CS,interval:5,count:20},{cmd:P.CHECK_FOLLOW_TYPE,interval:5,count:20},{cmd:P.GET_GRP_ROAMING_MSG,interval:1,count:20},{cmd:P.GET_C2C_ROAMING_MSG,interval:1,count:20}],Bs=new Map,Ur=["0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F"],ya=0,Td=Ur.length;ya<Td;ya++)Bs.set(ya,Ur[ya]);function Qc(t){N(this,Qc),this._sessionM=t,this._n="MsgDispatcher",this._eventHandlerMap=new Map,this._eventHandlerMap.set("C2CMessageArray",this._onC2CMsgArray.bind(this)),this._eventHandlerMap.set("groupMessageArray",this._onGroupMsgArray.bind(this)),this._eventHandlerMap.set("groupTips",this._onGroupTips.bind(this)),this._eventHandlerMap.set("C2CNotifyMessageArray",this._onC2CNotifyMsgArray.bind(this)),this._eventHandlerMap.set("C2CReadReceiptArray",this._onC2CReadReceiptArray.bind(this)),this._eventHandlerMap.set("profileModify",this._onProfileModified.bind(this)),this._eventHandlerMap.set("friendListMod",this._onRelationChainModified.bind(this)),this._eventHandlerMap.set("recentContactMod",this._onRecentContact.bind(this)),this._eventHandlerMap.set("readAllC2CMessage",this._onAllMsgRead.bind(this)),this._eventHandlerMap.set("c2cMessageModified",this._onC2CMsgModified.bind(this)),this._eventHandlerMap.set("groupMessageModified",this._onGroupMsgModified.bind(this)),this._eventHandlerMap.set("userStatusList",this._onUserStatusList.bind(this)),this._eventHandlerMap.set("messageExtensionNotify",this._onMsgExtNotify.bind(this)),this._eventHandlerMap.set("messageReactionNotifyList",this._onMsgReactionNotifyList.bind(this)),this._eventHandlerMap.set("messageReactionNotify",this._onMsgReactionNotify.bind(this)),this._eventHandlerMap.set("followChangeList",this._onFollowNotify.bind(this)),this._keys=re(this._eventHandlerMap.keys())}function wr(t){N(this,wr),this._n="PHandler",this._sessionM=t,this._map=new Map,this._fillMap()}function Ia(t){return N(this,Ia),(t=Ai.call(this,t))._n="ChannelModule",t._socketHandler=new Md(te(t)),t._probing=!1,t._isAppShowing=!0,t._previousState=O.NET_STATE_CONNECTED,t._timerForNotLoggedIn=-1,t._timerForNotLoggedIn=setInterval(t.onCheckTimer.bind(te(t)),1e3),t._fatalErrorFlag=!1,t._disconnectedTS=0,t._lastDiagnoseTS=0,t}function Fr(t){N(this,Fr),this._chM=t,this._n="SocketHandler",this._promiseMap=new Map,this._readyState=ma,this._simpleRequestMap=new Map,this.MAX_SIZE=100,this._startSequence=mn(),this._startTs=0,this._reConnectFlag=!1,this._nextPingTs=0,this._reConnectCount=0,this.MAX_RECONNECT_COUNT=3,this._socketID=-1,this._random=0,this._socket=null,this._url="",this._onOpenTs=0,this._canIUseBinaryFrame=!0,this._isWorkerEnabled=!0,this._currentSite=Qe,this._setWebsocketHost(),this._initConnection()}function xr(t){N(this,xr);var o,i,s=(this._handler=t).getURL();this._socket=null,this._workerSocket=null,this._id=mn(),this._handler.getIsWorkerEnabled()?(o=URL.createObjectURL(new Blob([';let _socket = null;onmessage = function(event) {  if (event.data.cmd === "start") {    const url = event.data.url;    _socket = new WebSocket(url);    _socket.binaryType = "arraybuffer";    _socket.onopen = function() {      postMessage({ callback: "onOpen", extensions: _socket.extensions });    };    _socket.onclose = function(e) {      postMessage({ callback: "onOpen", e: { code: e.code, reason: e.reason } });    };    _socket.onmessage = function(e) {      postMessage({ callback: "onMessage", data: e.data });    };    _socket.onerror = function(e) {      postMessage({ callback: "onError", e: { isTrusted: "true" } });    };  } else if (event.data.cmd === "sendMessage") {    if (_socket !== null) {      _socket.send(event.data.data);    }  } else if (event.data.cmd === "stop") {    if (_socket !== null) {      _socket.close(event.data.code);      _socket = null;    }  }};'],{type:"application/javascript; charset=utf-8"})),this._workerSocket=new Worker(o),(i=this)._workerSocket.onmessage=function(c){var m=c.data,l=m.callback,p=m.e,m=m.extensions;l==="onOpen"?i._onOpen(m):l==="onClose"?i._onClose(p):l==="onError"?i._onError(p):l==="onMessage"&&i._onMessage(c.data)},this._workerSocket.postMessage({cmd:"start",id:this._id,url:s})):qe?Ct?(mt.connectSocket({url:s,header:{"content-type":"application/json"}}),mt.onSocketClose(this._onClose.bind(this)),mt.onSocketOpen(this._onOpen.bind(this)),mt.onSocketMessage(this._onMessage.bind(this)),mt.onSocketError(this._onError.bind(this))):(this._socket=mt.connectSocket({url:s,header:{"content-type":"application/json"},complete:function(){}}),this._socket.onClose(this._onClose.bind(this)),this._socket.onOpen(this._onOpen.bind(this)),this._socket.onMessage(this._onMessage.bind(this)),this._socket.onError(this._onError.bind(this))):(this._socket=new WebSocket(s),this._socket.binaryType="arraybuffer",this._socket.onopen=this._onOpen.bind(this,this._socket.extensions),this._socket.onmessage=this._onMessage.bind(this),this._socket.onclose=this._onClose.bind(this),this._socket.onerror=this._onError.bind(this)),this._canIUseBinaryFrame=t.canIUseBinaryFrame()}function qr(t){for(var o,i,s=t,c="",l=0,p=(s=t.length%8!=0?"0".repeat(8-t.length%8)+t:s).length;l<p;l+=8)o=parseInt(s.slice(l,l+4),2),i=parseInt(s.slice(l+4,l+8),2),c+=Bs.get(o)+Bs.get(i);return c}function il(t){if(t<0||53<t)return NaN;var o=0|1073741824*Math.random();return 30<t?o+1073741824*(0|Math.random()*(1<<t-30)):o>>>30-t}function al(t,o){for(var i=t.toString(16),s=o-i.length,c="0";0<s;s>>>=1,c+=c)1&s&&(i=c+i);return i}z(Zs,Ht),pl=J(Zs),V(Zs,[{key:"_init",value:function(){this._updateCmdFreqLimitMap(va)}},{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("cmd_frequency_limit");q(t)||(t=JSON.parse(t),this._updateCmdFreqLimitMap(t))}},{key:"_updateCmdFreqLimitMap",value:function(t){var o=this;t.forEach(function(i){o._cmdFreqLimitMap.set(i.cmd,{interval:i.interval,count:i.count})})}},{key:"updateProtocolConfig",value:function(){this._pHandler.update()}},{key:"req",value:function(i){E.d("".concat(this._n,".req options:"),i);var o=i.P;if(!this._pHandler.has(o))return E.w("".concat(this._n,".req unknown P:").concat(o)),W({code:Q.NO_PROTOCOL});var i=this.getProtocolData(i),s=i.head.servcmd;if(this._isFreqOverLimit(s))return W({code:c=Q.OVER_FREQUENCY_LIMIT,message:this.getErrMsg(c,this._getCmd(s))});if(this._isServerOverload(s))return W({code:c=Q.OPEN_SERVICE_OVERLOAD_ERROR,message:this.getErrMsg(c,this._getCmd(s))});var c=this.get(21);return $c.includes(o)?c.simplySend(i):c.send(i)}},{key:"getKeyMap",value:function(t){return this._pHandler.getKeyMap(t)}},{key:"genCommonHead",value:function(){var t=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:ee,websdkversion:He,a2:t.getA2Key()||void 0,tinyid:t.getTinyID()||void 0,status_instid:t.getStatusInstanceID(),sdkappid:t.getSDKAppID(),contenttype:t.getContentType(),reqtime:0,identifier:t.getA2Key()?void 0:t.getUserID(),usersig:t.getA2Key()?void 0:t.getUserSig(),sdkability:12775283,sdkability_ext:qr(""),cappid:t.getApplicationID(),cs:0}}},{key:"genCosSpecifiedHead",value:function(){var t=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:ee,websdkversion:He,sdkappid:t.getSDKAppID(),contenttype:t.getContentType(),reqtime:0,identifier:t.getUserID(),usersig:t.getUserSig(),status_instid:t.getStatusInstanceID(),sdkability:12775283,sdkability_ext:qr(""),cappid:t.getApplicationID(),cs:0}}},{key:"genSSOReportHead",value:function(){var t=this.get(12);return{ver:"v4",platform:this._platform,websdkappid:ee,websdkversion:He,sdkappid:t.getSDKAppID(),contenttype:"",reqtime:0,identifier:"",usersig:"",status_instid:t.getStatusInstanceID(),sdkability:12775283,sdkability_ext:qr(""),cappid:t.getApplicationID(),cs:0}}},{key:"getProtocolData",value:function(t){return this._pHandler.getProtocolData(t)}},{key:"trans",value:function(o){var i=o.servcmd,o=o.data,i={head:v(v({},this.genCommonHead()),{},{servcmd:i}),body:o};return this.get(21).send(i)}},{key:"sendComboMessage",value:function(o){var i=o.servcmd,o=o.data,i={head:v(v({},this.genCommonHead()),{},{servcmd:i}),body:o};return this.get(21).send(i)}},{key:"onErrorCodeNotZero",value:function(t){var o,i=t.errorCode;i===Q.HELLO_ANSWER_KICKED_OUT&&(o=t.kickType,t=(t=t.newInstanceInfo)===void 0?{}:t,o===1?this.onMultipleAccountKickedOut(t):o===2?this.onMultipleDeviceKickedOut(t):o===3&&this.onRestApiKickedOut(t)),i!==Q.MSG_A2KEY_EXPIRED&&i!==Q.ACCOUNT_A2KEY_EXPIRED||(this._onUserSigExpired(),this.get(21).reConnect())}},{key:"onMessage",value:function(t){var i=t.body,o=i.needAck,i=i.sessionData;(o===void 0?0:o)===1&&this._sendACK(i),this._msgDispatcher.onMessage(t)}},{key:"onReconnected",value:function(t){this._incrementalPullContactFlag=t<=300,this._reLoginOnReconnected()}},{key:"reLoginOnKickOther",value:function(){E.l("".concat(this._n,".reLoginOnKickOther")),this._reLogin()}},{key:"_reLoginOnReconnected",value:function(){E.l("".concat(this._n,"._reLoginOnReconnected")),this._reLogin()}},{key:"_reLogin",value:function(){var t,o,i,s=this,c="".concat(this._n,"._reLogin");this.isLoggedIn()&&(t=0,(o=this.get(1).getPushModule())&&(t=o.getUniAppPlatform()),i=new ue("reLogin"),this.req({P:P.LOGIN,data:{isWebUniapp:t,customInfo:this.get(12).getCustomLoginInfo()}}).then(function(p){var p=p.data,C=p.instanceID,p=p.customStatus,k=s.get(12),m=ui(p),I=(k.setStatusInstanceID(C),s.get(21)),S=I.getSocketID(),S="socketID:".concat(S," instanceID:").concat(C," customStatus:").concat(m),C=(i.setMessage(S).end(!0),E.l("".concat(c," ok. ").concat(S)),k.getCustomStatus()!==m&&s.get(4).onUserStatusUpdated({dataList:[{to:s.getMyUserID(),statusType:O.USER_STATUS_ONLINE,customStatus:p}]}),I.diagnose(),s.get(11).syncConvList(s._incrementalPullContactFlag).then(function(){E.l("".concat(c,", sync conv list ok.")),s.get(25).start()}),s.get(7)),S=(C&&C.updateLocalMainSequenceOnReconnected(),s.get(10)),k=(S.resetGetTopicTime(),S.getTopicListOnReconnected(),s.get(35));k&&k.clearCacheOnReconnected()}))}},{key:"onMultipleAccountKickedOut",value:function(t){this.get(1).onMultipleAccountKickedOut(t)}},{key:"onMultipleDeviceKickedOut",value:function(t){this.get(1).onMultipleDeviceKickedOut(t)}},{key:"_onUserSigExpired",value:function(){this.get(1).onUserSigExpired()}},{key:"onRestApiKickedOut",value:function(t){this.get(1).onRestApiKickedOut(t)}},{key:"_sendACK",value:function(t){this.req({P:P.MSG_PUSH_ACK,data:{sessionData:t}})}},{key:"_isFreqOverLimit",value:function(t){if(t=t.split(".")[1],!this._cmdFreqLimitMap.has(t))return!1;if(!this._cmdReqInfoMap.has(t))return this._cmdReqInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1;var i=this._cmdFreqLimitMap.get(t),o=i.count,i=i.interval,c=this._cmdReqInfoMap.get(t),s=c.startTime,c=c.requestCount;return Date.now()-s>1e3*i?(this._cmdReqInfoMap.set(t,{startTime:Date.now(),requestCount:1}),!1):(this._cmdReqInfoMap.set(t,{startTime:s,requestCount:c+=1}),o<c)}},{key:"_isServerOverload",value:function(t){if(!this._serverOverloadInfoMap.has(t))return!1;var i=this._serverOverloadInfoMap.get(t),o=i.overloadTime,i=i.waitingTime;return Date.now()-o<=1e3*i||(this._serverOverloadInfoMap.delete(t),!1)}},{key:"_getCmd",value:function(t){var o="";if(!t.includes("."))return o;var i,s=t.split(".")[1];for(i in P)if(P[i]===s){o=i;break}return o}},{key:"onPushedServerOverload",value:function(i){var o=i.overloadCommand,i=i.waitingTime;this._serverOverloadInfoMap.set(o,{overloadTime:Date.now(),waitingTime:i}),E.w("".concat(this._n,".onPushedServerOverload waitingTime:").concat(i,"s cmd:").concat(this._getCmd(o)))}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._updateCmdFreqLimitMap(va),this._cmdReqInfoMap.clear(),this._serverOverloadInfoMap.clear(),this._incrementalPullContactFlag=!0}}]);var Zc,eu,tu,nu,sl,rl,cl,ul,ll,dl,pl,Sd=Zs,gl=(z(Qs,Ht),dl=J(Qs),V(Qs,[{key:"getCloudConfig",value:function(t){return q(t)?this._cloudConfig:this._cloudConfig.has(t)?this._cloudConfig.get(t):void 0}},{key:"getServerConfig",value:function(t){var o={code:0,data:""};return!q(t)&&this._cloudConfig.has(t)&&(o.data=this._cloudConfig.get(t)),Promise.resolve(o)}},{key:"_canFetch",value:function(){return this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime}},{key:"fetchConfig",value:function(){var t,o=this,i="".concat(this._n,".fetchConfig"),s=this._canFetch();E.l("".concat(i," canFetch:").concat(s)),s&&(t=new ue("fetchCloudCtrlConfig"),s=this.get(12).getSDKAppID(),this._isFetching=!0,this.req({P:P.FETCH_CLOUD_CTRL_CONFIG,data:{SDKAppID:s,version:this._version}}).then(function(c){o._isFetching=!1;var p=c.data,l=p.version,p=p.cloudControlConfig;t.setMessage("version:".concat(o._version," newVersion:").concat(l," config:").concat(p)).end(),E.l("".concat(i," ok")),o._parse(c.data)}).catch(function(c){o._isFetching=!1,t.setError(c).end(),E.l("".concat(i," failed. error:"),c),o._setExpiredTime(12e4)}))}},{key:"onPushedConfig",value:function(t){E.l("".concat(this._n,".onPushedConfig config:"),t),new ue("pushedCloudCtrlConfig").setMessage("newVersion:".concat(t.version," config:").concat(t.cloudControlConfig)).end(),this._parse(t)}},{key:"onCheckTimer",value:function(t){this._canFetch()&&this.fetchConfig()}},{key:"_parse",value:function(t){var o=this,i="".concat(this._n,"._parse"),s=t.errorCode,c=t.errorMessage,l=t.cloudControlConfig,p=t.version,m=t.expiredTime;if(s===0){if(this._version!==p){var I=null;try{I=JSON.parse(l)}catch(C){this.isPrivateNetWork()||E.e("".concat(i," failed. config:"),l)}I&&(this._cloudConfig.clear(),Object.keys(I).forEach(function(C){o._cloudConfig.set(C,I[C])}),this._version=p,this.emitIEvt(Yt.CLOUD_CONFIG))}this._setExpiredTime(1e3*m)}else q(s)?(E.l("".concat(i," failed. Invalid message format:"),t),this._setExpiredTime(36e5)):(E.e("".concat(i," errorCode:").concat(s," errorMessage:").concat(c)),this._setExpiredTime(12e4))}},{key:"_setExpiredTime",value:function(t){this._expiredTime=Date.now()+t}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._cloudConfig.clear(),this._expiredTime=0,this._version=0,this._isFetching=!1}}]),Qs),Dd=(z(Xs,Ht),ll=J(Xs),V(Xs,[{key:"start",value:function(){this._recoverGroupChat(),this._recoverC2CChat()}},{key:"_recoverGroupChat",value:function(){var t,o,i,s,c=this,l=this._getLocalConvList().filter(function(I){return I.type===O.CONV_GROUP&&I.groupProfile.type!==O.GRP_AVCHATROOM}),p=this.get(11),m=[];l.forEach(function(S){var C=S.conversationID,S=S.lastMessage;t=C.replace(O.CONV_GROUP,""),o=p.getLocalLastMessage(C),S&&S.lastSequence!==0&&o?(i=S.lastSequence,o=o.sequence,s=i-o,0<o&&1<=s&&s<300?c._recoverGroupMsg({groupID:t,localLastMessageSequence:o,remoteLastMessageSequence:i}):m.push(t)):m.push(t)}),this._getGroupNotice(m)}},{key:"_recoverC2CChat",value:function(){var t,o,i,s=this,c=this._getLocalConvList().filter(function(m){return m.type===O.CONV_C2C}),l=this.get(11),p=[Promise.resolve()];c.forEach(function(C){var I=C.conversationID,C=C.lastMessage;t=l.getLocalLastMessage(I),C&&C.lastTime!==0&&t&&(o=C.lastTime,t=t.time,i=o-t,0<t&&1<=i&&i<=600&&p.push(s._recoverC2CMsg({conversationID:I,localLastMessageTime:t,remoteLastMessageTime:o})))}),Promise.all(p).then(function(){E.l("".concat(s._n,"._recoverC2CChat all done")),s.get(19).syncOnReconnected()})}},{key:"_getLocalConvList",value:function(){return this.get(11).getLocalConvList()}},{key:"_recoverGroupMsg",value:function(t){var o=this,i="".concat(this._n,".").concat("_recoverGroupMsg"),s=(E.l("".concat(i," options:"),t),t.groupID),c=t.localLastMessageSequence,l=t.remoteLastMessageSequence,p=JSON.stringify(t),m=new ue("_recoverGroupMsg");m.setMessage(p),this._getGroupRoamingMsg({groupID:s,sequence:c}).then(function(C){var C=C.data,S=C.complete,k=C.messageList;if(!q(k)){var C=k[0].sequence,G=k.map(function(et){return et.sequence}),G="".concat(p," complete:").concat(S," sequenceList:").concat(G),U=(E.l("".concat(i," ").concat(G)),C!==c&&C<l&&S!==2&&o._recoverGroupMsg({groupID:s,localLastMessageSequence:C,remoteLastMessageSequence:l}),m.setMessage(G).end(),o.get(7));1<k.length&&k.sort(function(et,lt){return et.sequence-lt.sequence});for(var Y=!1,Z=0,$=k.length;Z<$;Z++)if(k[Z].from===O.CONV_SYSTEM){Y=!0;break}if(Y)for(var De=0,_e=k.length;De<_e;De++){var Pe=k[De];Pe.from!==O.CONV_SYSTEM?U.onNewMessage({dataList:[Pe],isInstantMessage:!1,updateUnreadCount:!1}):U.onNewGroupTips({event:Pe.event,dataList:[Pe]})}else U.onNewMessage({dataList:k,isInstantMessage:!1,updateUnreadCount:!1})}}).catch(function(I){m.setError(I).end(),E.w("".concat(i," failed. error:"),I)})}},{key:"_getGroupNotice",value:function(t){var o=t.length;if(E.l("".concat(this._n,"._getGroupNotice length:").concat(o)),o!==0){var i=this.get(7);if(o<=10)i.getNotice(t);else{var s=Math.floor(o/10);5<=s&&(s=5);for(var c=0;c<=s;c++)i.getNotice(t.slice(10*c,10*(c+1)))}}}},{key:"_getGroupRoamingMsg",value:function(i){var o=i.groupID,i=i.sequence;return this.req({P:P.GET_GRP_ROAMING_MSG,data:{groupID:o,count:this.PULL_LIMIT_COUNT,sequence:i+this.PULL_LIMIT_COUNT-1}})}},{key:"_recoverC2CMsg",value:function(t){var o=this,i="".concat(this._n,".").concat("_recoverC2CMsg"),s=(E.l("".concat(i," options:"),t),t.conversationID),c=t.localLastMessageTime,l=t.remoteLastMessageTime,p=JSON.stringify(t),m=new ue("_recoverC2CMsg");return m.setMessage(p),this._getC2CRoamingMsg({conversationID:s,time:c}).then(function(S){var S=S.data,C=S.complete,S=S.messageList;if(!q(S)){var k=S.length,k=(o.get(6).onNewMessage({dataList:S,isInstantMessage:!0}),S[k-1].time),S=S.map(function(U){return U.random}),S="".concat(p," complete:").concat(C," randomList:").concat(S);if(E.l("".concat(i," ").concat(S)),m.setMessage(S).end(),k<l&&C!==1)return o._recoverC2CMsg({conversationID:s,localLastMessageTime:k,remoteLastMessageTime:l})}}).catch(function(I){m.setError(I).end(),E.w("".concat(i," failed. error:"),I)})}},{key:"_getC2CRoamingMsg",value:function(i){var o=i.conversationID,i=i.time;return this.req({P:P.GET_C2C_ROAMING_MSG,data:{peerAccount:o.replace(O.CONV_C2C,""),count:this.PULL_LIMIT_COUNT+1,lastMessageTime:i,direction:1}})}},{key:"reset",value:function(){E.l("".concat(this._n,".reset"))}}]),Xs),ou=(V(lu,[{key:"addMessageDelay",value:function(t){t=zi()-t,0<=t&&this._e2eDelayArray.push(t)}},{key:"_calcAvg",value:function(t,o){if(o===0)return 0;var i=0;return t.forEach(function(s){i+=s}),uo(i/o,1)}},{key:"_calcCountWithLimit",value:function(t){var o=t.e2eDelayArray,i=t.min,s=t.max;return o.filter(function(c){return i<=c&&c<s}).length}},{key:"_calcPercent",value:function(t,o){return t=uo(t/o*100,2),t=100<t?100:t}},{key:"_checkE2EDelayException",value:function(t,o){var i,s,c,l=t.filter(function(p){return o<p});0<l.length&&(i=l.length,s=Math.min.apply(Math,re(l)),c=Math.max.apply(Math,re(l)),l=this._calcAvg(l,i),50<(t=uo(i/t.length*100,2))&&new ue("messageE2EDelayException").setMessage("count:".concat(i," min:").concat(s," max:").concat(c," avg:").concat(l," percent:").concat(t)).setLevel("warning").end())}},{key:"getStatResult",value:function(){var t=this._e2eDelayArray.length;if(t===0)return null;var o=re(this._e2eDelayArray),i=this._calcCountWithLimit({e2eDelayArray:o,min:0,max:1}),s=this._calcCountWithLimit({e2eDelayArray:o,min:1,max:3}),c=this._calcPercent(i,t),l=this._calcPercent(s,t),p=this._calcAvg(o,t);return this._checkE2EDelayException(o,3),o.length=0,this.reset(),{totalCount:t,countLessThan1Second:i,percentOfCountLessThan1Second:c,countLessThan3Second:s,percentOfCountLessThan3Second:l,avgDelay:p}}},{key:"reset",value:function(){this._e2eDelayArray.length=0}}]),lu),Ed=(V(uu,[{key:"addRequestCount",value:function(){this._requestCount+=1}},{key:"addRTT",value:function(t){this._rttArray.push(t)}},{key:"_calcTotalCount",value:function(){return this._requestCount}},{key:"_calcRTTCount",value:function(t){return t.length}},{key:"_calcSuccessRateOfRequest",value:function(t,o){return o===0?0:(t=uo(t/o*100,2),t=100<t?100:t)}},{key:"_calcAvg",value:function(t,o){if(o===0)return 0;var i=0;return t.forEach(function(s){i+=s}),parseInt(i/o)}},{key:"_calcMax",value:function(){return Math.max.apply(Math,re(this._rttArray))}},{key:"_calcMin",value:function(){return Math.min.apply(Math,re(this._rttArray))}},{key:"getStatResult",value:function(){var t=this._calcTotalCount(),s=re(this._rttArray);if(t===0)return null;var o=this._calcRTTCount(s),i=this._calcSuccessRateOfRequest(o,t),s=this._calcAvg(s,o);return E.l("".concat(this._n,".getStatResult max:").concat(this._calcMax()," min:").concat(this._calcMin()," avg:").concat(s)),this.reset(),{totalCount:t,rttCount:o,successRateOfRequest:i,avgRTT:s}}},{key:"reset",value:function(){this._requestCount=0,this._rttArray.length=0}}]),uu),hl=(V(Hi,[{key:"initMap",value:function(t){var o=this;t.forEach(function(i){o._map.set(i,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})})}},{key:"addTotalCount",value:function(t){return!(q(t)||!this._map.has(t)||(this._map.get(t).totalCount+=1,0))}},{key:"addSuccessCount",value:function(t){return!(q(t)||!this._map.has(t)||(this._map.get(t).successCount+=1,0))}},{key:"addFailedCountOfUserSide",value:function(t){return!(q(t)||!this._map.has(t)||(this._map.get(t).failedCountOfUserSide+=1,0))}},{key:"addCost",value:function(t,o){return!(q(t)||!this._map.has(t)||(this._map.get(t).costArray.push(o),0))}},{key:"addFileSize",value:function(t,o){return!(q(t)||!this._map.has(t)||(this._map.get(t).fileSizeArray.push(o),0))}},{key:"_calcSuccessRateOfBusiness",value:function(t){return q(t)||!this._map.has(t)?-1:(t=this._map.get(t),t=uo(t.successCount/t.totalCount*100,2),t=100<t?100:t)}},{key:"_calcSuccessRateOfPlatform",value:function(i){if(q(i)||!this._map.has(i))return-1;var o=this._map.get(i),i=this._calcSuccessCountOfPlatform(i)/o.totalCount*100;return i=100<(i=uo(i,2))?100:i}},{key:"_calcTotalCount",value:function(t){return q(t)||!this._map.has(t)?-1:this._map.get(t).totalCount}},{key:"_calcSuccessCountOfBusiness",value:function(t){return q(t)||!this._map.has(t)?-1:this._map.get(t).successCount}},{key:"_calcSuccessCountOfPlatform",value:function(t){return q(t)||!this._map.has(t)?-1:(t=this._map.get(t),t.successCount+t.failedCountOfUserSide)}},{key:"_calcAvg",value:function(t){return q(t)||!this._map.has(t)?-1:t===oo?this._calcAvgSpeed(t):this._calcAvgCost(t)}},{key:"_calcAvgCost",value:function(t){var o=this._map.get(t).costArray.length;if(o===0)return 0;var i=0;return this._map.get(t).costArray.forEach(function(s){i+=s}),parseInt(i/o)}},{key:"_calcAvgSpeed",value:function(t){var o=0,i=0;return this._map.get(t).costArray.forEach(function(s){o+=s}),this._map.get(t).fileSizeArray.forEach(function(s){i+=s}),parseInt(1e3*i/o)}},{key:"getStatResult",value:function(t){var o=this._calcTotalCount(t);if(o===0)return null;var i=this._calcSuccessCountOfBusiness(t),s=this._calcSuccessRateOfBusiness(t),c=this._calcSuccessCountOfPlatform(t),l=this._calcSuccessRateOfPlatform(t),p=this._calcAvg(t);return this.reset(t),{totalCount:o,successCountOfBusiness:i,successRateOfBusiness:s,successCountOfPlatform:c,successRateOfPlatform:l,avgValue:p}}},{key:"reset",value:function(t){q(t)?this._map.clear():this._map.set(t,{totalCount:0,successCount:0,failedCountOfUserSide:0,costArray:[],fileSizeArray:[]})}}]),Hi),Rd=(V(go,[{key:"initMap",value:function(t){var o=this;t.forEach(function(i){o._lastMap.set(i,new Map),o._currentMap.set(i,new Map)})}},{key:"addMessageSequence",value:function(t){var o=t.key,c=t.message;if(q(o)||!this._lastMap.has(o)||!this._currentMap.has(o))return!1;var i,s,l=c.conversationID,c=c.sequence,l=l.replace(O.CONV_GROUP,"");return this._lastMap.get(o).size!==0&&this._lastMap.get(o).has(l)?(s=(i=this._lastMap.get(o).get(l)).length-1,c>i[0]&&c<i[s]?(i.push(c),i.sort(),this._lastMap.get(o).set(l,i)):this._addCurrentMap(t)):this._addCurrentMap(t),!0}},{key:"_addCurrentMap",value:function(i){var o=i.key,i=i.message,s=i.conversationID,i=i.sequence,s=s.replace(O.CONV_GROUP,"");this._currentMap.get(o).has(s)||this._currentMap.get(o).set(s,[]),this._currentMap.get(o).get(s).push(i)}},{key:"_copyData",value:function(t){if(!q(t)){this._lastMap.set(t,new Map);var o,i=this._lastMap.get(t),s=A(this._currentMap.get(t));try{for(s.s();!(o=s.n()).done;){var c=Le(o.value,2),l=c[0],p=c[1];i.set(l,p)}}catch(m){s.e(m)}finally{s.f()}i=null,this._currentMap.set(t,new Map)}}},{key:"getStatResult",value:function(t){if(q(this._currentMap.get(t))||q(this._lastMap.get(t)))return null;if(this._lastMap.get(t).size===0)return this._copyData(t),null;var o=0,i=0;if(this._lastMap.get(t).forEach(function(m,l){var m=re(m.values()),p=m.length,m=m[p-1]-m[0]+1;o+=m,i+=p}),o===0)return null;var s=uo(i/o*100,2);return 100<s&&(s=100),this._copyData(t),{totalCount:o,successCountOfMessageReceived:i,successRateOfMessageReceived:s}}},{key:"reset",value:function(){this._currentMap.clear(),this._lastMap.clear()}}]),go),Ld=(z(Bi,Ht),ul=J(Bi),V(Bi,[{key:"_onLoginSuccess",value:function(){var t=this,o=(this._rateMessageSent.initMap(this._messageSentItems),this._rateMessageReceived.initMap(this._messageReceivedItems),this.get(13)),i=o.getItem(this.TAG,!1);!Te(i)&&Ot(i.forEach)&&(E.l("".concat(this._n,"._onLoginSuccess. logs count:").concat(i.length)),i.forEach(function(s){t._statInfoArr.push(s)}),o.removeItem(this.TAG,!1))}},{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("q_rpt_interval"),o=this.getCloudConfig("q_rpt_sdkappid_bl"),i=this.getCloudConfig("q_rpt_tinyid_wl");q(t)||(this.REPORT_INTERVAL=Number(t)),q(o)||(this.REPORT_SDKAPPID_BLACKLIST=o.split(",").map(function(s){return Number(s)})),q(i)||(this.REPORT_TINYID_WHITELIST=i.split(","))}},{key:"onCheckTimer",value:function(t){this.isLoggedIn()&&t%this.REPORT_INTERVAL==0&&(this.wholePeriod=!0,this._report())}},{key:"addRequestCount",value:function(){this._avgRTT.addRequestCount()}},{key:"addRTT",value:function(t){this._avgRTT.addRTT(t)}},{key:"addMessageDelay",value:function(t){this._avgE2EDelay.addMessageDelay(t)}},{key:"addTotalCount",value:function(t){this._rateMessageSent.addTotalCount(t)||E.w("".concat(this._n,".addTotalCount invalid key:"),t)}},{key:"addSuccessCount",value:function(t){this._rateMessageSent.addSuccessCount(t)||E.w("".concat(this._n,".addSuccessCount invalid key:"),t)}},{key:"addFailedCountOfUserSide",value:function(t){this._rateMessageSent.addFailedCountOfUserSide(t)||E.w("".concat(this._n,".addFailedCountOfUserSide invalid key:"),t)}},{key:"addCost",value:function(t,o){this._rateMessageSent.addCost(t,o)||E.w("".concat(this._n,".addCost invalid key or cost:"),t,o)}},{key:"addFileSize",value:function(t,o){this._rateMessageSent.addFileSize(t,o)||E.w("".concat(this._n,".addFileSize invalid key or size:"),t,o)}},{key:"addMessageSequence",value:function(t){this._rateMessageReceived.addMessageSequence(t)||E.w("".concat(this._n,".addMessageSequence invalid key:"),t.key)}},{key:"_getQualityItem",value:function(t){var o={},i=Wa[this.get(15).getNetworkType()],i=(q(i)&&(i=8),{qualityType:Ka[t],timestamp:no(),networkType:i,extension:""});switch(t){case si:o=this._avgRTT.getStatResult();break;case Ii:o=this._avgE2EDelay.getStatResult();break;case bo:case na:case oa:case ri:case oo:o=this._rateMessageSent.getStatResult(t);break;case ce:case Mi:case Ci:o=this._rateMessageReceived.getStatResult(t)}return o===null?null:v(v({},i),o)}},{key:"_report",value:function(l){var o=this,i=[],s=null,l=(q(l)?this._qualityItems.forEach(function(p){(s=o._getQualityItem(p))!==null&&(s.reportIndex=o.reportIndex,s.wholePeriod=o.wholePeriod,i.push(s))}):(s=this._getQualityItem(l))!==null&&(s.reportIndex=this.reportIndex,s.wholePeriod=this.wholePeriod,i.push(s)),E.d("".concat(this._n,"._report"),i),0<this._statInfoArr.length&&(i=i.concat(this._statInfoArr),this._statInfoArr=[]),this.get(12)),c=l.getSDKAppID(),l=l.getTinyID();0<(i=Mc(this.REPORT_SDKAPPID_BLACKLIST,c)&&!vn(this.REPORT_TINYID_WHITELIST,l)?[]:i).length&&this._doReport(i)}},{key:"_doReport",value:function(t){var o=this,i={header:Lr(this),quality:t};this.req({P:P.SSO_STAT,data:v({},i)}).then(function(){o.reportIndex++,o.wholePeriod=!1}).catch(function(s){E.w("".concat(o._n,"._doReport failed. error:"),s),o._statInfoArr=o._statInfoArr.concat(t),o._flushAtOnce()})}},{key:"_flushAtOnce",value:function(){var t=this.get(13),o=t.getItem(this.TAG,!1),i=this._statInfoArr,s="".concat(this._n,"._flushAtOnce");Te(o)?(E.l("".concat(s," count:").concat(i.length)),t.setItem(this.TAG,i,!0,!1)):(10<(i=i.concat(o)).length&&(i=i.slice(0,10)),E.l("".concat(s," count:").concat(i.length)),t.setItem(this.TAG,i,!0,!1)),this._statInfoArr=[]}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._report(),this.reportIndex=0,this.wholePeriod=!1,this.REPORT_SDKAPPID_BLACKLIST=[],this.REPORT_TINYID_WHITELIST=[],this._avgRTT.reset(),this._avgE2EDelay.reset(),this._rateMessageSent.reset(),this._rateMessageReceived.reset()}}]),Bi),_l=V(function t(o){N(this,t),Te(o)||(this.userID=o.userID||"",this.nick=o.nick||"",this.avatar=o.avatar||"",this.time=o.time||0,this.source=o.source||"",this.wording=o.wording||"",this.type=o.type||"")}),kd=(V(Vi,[{key:"getLocalApplicationList",value:function(){return{friendApplicationList:re(this._map.values()),unreadCount:this._unreadCount}}},{key:"_onApplicationListUpdated",value:function(){this._snsM.emitOEvt(Me.FRIEND_APPLICATION_LIST_UPDATED,{friendApplicationList:re(this._map.values()),unreadCount:this._unreadCount})}},{key:"onApplicationRead",value:function(){this._unreadCount=0,this._onApplicationListUpdated()}},{key:"onApplicationAdded",value:function(t,o){var i,s,c=this;Te(t)||(i="",i=o===this._snsM.getMyUserID()?O.SNS_APPLICATION_SENT_BY_ME:O.SNS_APPLICATION_SENT_TO_ME,s=!1,t.forEach(function(l){var p="".concat(l.userID,"_").concat(i);i!==O.SNS_APPLICATION_SENT_TO_ME||c._map.has(p)||(c._unreadCount+=1),c._map.set(p,new _l(v(v({},l),{},{type:i}))),s=!0}),s&&this._onApplicationListUpdated())}},{key:"onApplicationDeleted",value:function(t){Te(t)||(this._startTime=0,this._currentSeq=0,this.getApplicationList())}},{key:"getApplicationList",value:function(){var t=this,o="".concat(this._n,".").concat("getApplicationList"),i=new ue("getApplicationList");return this._snsM.req({P:P.GET_FD_APPLICATION_LIST,data:{applicationType:O.SNS_APPLICATION_TYPE_BOTH,fromAccount:this._snsM.getMyUserID(),maxLimited:this._maxLimited,startTime:this._startTime,lastSequence:this._currentSeq}}).then(function(m){var m=m.data,c=m.resultList,l=m.unreadCount,p=m.startTime,m=m.currentSequence,I=(t._startTime=p,t._currentSeq=m,t._unreadCount=l,ye(c)?c.length:0),I="applicationCount:".concat(I," unreadCount:").concat(l," startTime:").concat(p," currentSequence:").concat(m);i.setMessage(I).end(),E.i("".concat(o," ok. ").concat(I)),t._map.clear(),ye(c)&&c.forEach(function(G){var S=G.userID,k=G.type,G=new _l(G);t._map.set("".concat(S,"_").concat(k),G)}),t._onApplicationListUpdated()}).catch(function(s){return i.setError(s).end(),E.w("".concat(o," failed. error:"),s),W(s)})}},{key:"deleteApplication",value:function(t){var o="".concat(this._n,".").concat("deleteApplication"),i=t.userID,s=t.type;if(s&&(s===O.SNS_APPLICATION_SENT_BY_ME||s===O.SNS_APPLICATION_SENT_TO_ME)||(s=O.SNS_APPLICATION_SENT_TO_ME),!this._map.has("".concat(i,"_").concat(s)))return W({code:Q.FRIEND_APPLICATION_NOT_EXIST});var c=new ue("deleteApplication");return c.setMessage("userID:".concat(i," type:").concat(s)),this._snsM.req({P:P.DEL_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),userIDList:[i],type:s}}).then(function(p){var p=p.data.resultList,C=p[0],m=C.to,I=C.resultCode,C=C.resultInfo;return c.setMoreMessage("resultList:".concat(JSON.stringify(p))).end(),E.i("".concat(o," ok. userID:").concat(i," type:").concat(s)),I===0?Ae():W({userID:m,code:I,message:C})}).catch(function(l){return c.setError(l).end(),E.w("".concat(o," failed. error:"),l),W(l)})}},{key:"acceptApplication",value:function(t){var o="".concat(this._n,".").concat("acceptApplication"),i=t.userID,s=t.remark,c=t.tag,l=t.type,p=(l&&(l===O.SNS_APPLICATION_AGREE||l===O.SNS_APPLICATION_AGREE_AND_ADD)||(l=O.SNS_APPLICATION_AGREE_AND_ADD),new ue("acceptApplication"));return p.setMessage("userID:".concat(i," type:").concat(l)),this._snsM.req({P:P.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:i,remark:s,tag:c,action:l}]}}).then(function(C){p.end();var C=C.data.resultList[0],I=C.resultCode,C=C.resultInfo;if(I!==0)return W({code:I,message:C});E.i("".concat(o," ok. userID:").concat(i," type:").concat(l))}).catch(function(m){return p.setError(m).end(),E.w("".concat(o," failed. error:"),m),W(m)})}},{key:"refuseApplication",value:function(t){var o="".concat(this._n,".").concat("refuseApplication"),i=t.userID,s=new ue("refuseApplication");return s.setMessage("userID:".concat(i)),this._snsM.req({P:P.RESPOND_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),responseFriendItem:[{userID:i,action:"Response_Action_Reject"}]}}).then(function(p){s.end();var p=p.data.resultList[0],l=p.resultCode,p=p.resultInfo;if(l!==0)return W({code:l,message:p});E.i("".concat(o," ok. userID:").concat(i))}).catch(function(c){return s.setError(c).end(),E.w("".concat(o," failed. error:"),c),W(c)})}},{key:"setApplicationRead",value:function(){var t=this,o="".concat(this._n,".").concat("setApplicationRead"),i=new ue("setApplicationRead");return this._snsM.req({P:P.REPORT_FD_APPLICATION,data:{fromAccount:this._snsM.getMyUserID(),latestTimeStamp:uo(no()/1e3,0)}}).then(function(s){i.end(),E.i("".concat(o," ok")),t._unreadCount=0}).catch(function(s){return i.setError(s).end(),E.w("".concat(o," failed. error:"),s),W(s)})}},{key:"reset",value:function(){this._maxLimited=100,this._currentSeq=0,this._unreadCount=0,this._map.clear()}}]),Vi),iu=(V(qi,[{key:"validate",value:function(t){var o,i=!0,s="";if(Te(t))return{valid:!1,tips:"empty options"};if(t.profileCustomField)for(var c=t.profileCustomField.length,l=null,p=0;p<c;p++){if(l=t.profileCustomField[p],!Ee(l.key)||l.key.indexOf("Tag_Profile_Custom")===-1)return{valid:!1,tips:"The prefix of keys of the custom profile key-value pairs (which is profileCustomField) must be Tag_Profile_Custom"};if(!Ee(l.value))return{valid:!1,tips:"The type of values of the custom profile key-value pairs (which is profileCustomField) must be String"}}for(o in t)if(Object.prototype.hasOwnProperty.call(t,o)){if(o==="profileCustomField")continue;if(Te(t[o])&&!Ee(t[o])&&!ut(t[o])){s="key:"+o+", invalid value:"+t[o],i=!1;continue}switch(o){case"nick":Ee(t[o])||(i=!(s="nick must be a string")),500<gi(t[o])&&(s="nick name limited: must less than or equal to ".concat(500," bytes, current size: ").concat(gi(t[o])," bytes"),i=!1);break;case"gender":vo(co,t.gender)||(s="key:gender, invalid value:"+t.gender,i=!1);break;case"birthday":ut(t.birthday)||(i=!(s="birthday must be a number"));break;case"location":Ee(t.location)||(i=!(s="location must be a string"));break;case"selfSignature":Ee(t.selfSignature)||(i=!(s="selfSignature must be a string"));break;case"allowType":vo(hc,t.allowType)||(s="key:allowType, invalid value:"+t.allowType,i=!1);break;case"language":ut(t.language)||(i=!(s="language must be a number"));break;case"avatar":Ee(t.avatar)||(i=!(s="avatar must be a string"));break;case"messageSettings":t.messageSettings!==0&&t.messageSettings!==1&&(i=!(s="messageSettings must be 0 or 1"));break;case"adminForbidType":vo(gc,t.adminForbidType)||(s="key:adminForbidType, invalid value:"+t.adminForbidType,i=!1);break;case"level":ut(t.level)||(i=!(s="level must be a number"));break;case"role":ut(t.role)||(i=!(s="role must be a number"));break;default:s="unknown key:"+o+"  "+t[o],i=!1}}return{valid:i,tips:s}}},{key:"update",value:function(t){var o,i="",s=[];this.friendCustomField.forEach(function(m){s.push(m.key)});for(var c=0,l=t.length;c<l;c++)if(i=t[c].tag,o=t[c].value,-1<i.indexOf("Tag_SNS_Custom"))-1<s.indexOf(i)?this.friendCustomField.forEach(function(m){m.key===i&&(m.value=o)}):this.friendCustomField.push({key:i,value:o});else if(-1<i.indexOf("Tag_Profile_Custom")){var p=!1;this.profile.profileCustomField.forEach(function(m){m.key===i&&(m.value=o,p=!0)}),p||this.profile.profileCustomField.push({key:i,value:o})}else switch(i){case at.NICK:this.profile.nick=o;break;case at.GENDER:this.profile.gender=o;break;case at.BIRTHDAY:this.profile.birthday=o;break;case at.LOCATION:this.profile.location=o;break;case at.SELFSIGNATURE:this.profile.selfSignature=o;break;case at.ALLOWTYPE:this.profile.allowType=o;break;case at.LANGUAGE:this.profile.language=o;break;case at.AVATAR:this.profile.avatar=o;break;case at.MESSAGESETTINGS:this.profile.messageSettings=o;break;case at.ADMINFORBIDTYPE:this.profile.adminForbidType=o;break;case at.LEVEL:this.profile.level=o;break;case at.ROLE:this.profile.role=o;break;case Je.REMARK:this.remark=o;break;case Je.ADDTIME:this.addTime=o;break;case Je.GROUP:this.groupList=JSON.parse(JSON.stringify(o));break;case Je.ADDSOURCE:this.source=o;break;case Je.ADDWORDING:break;default:E.d("snsProfileItem unkown tag->",t[c].tag)}this.timestamp=Date.now(),s.length=0}},{key:"updateProfile",value:function(t){this.profile=JSON.parse(JSON.stringify(t)),this.timestamp=Date.now()}},{key:"addToGroupList",value:function(t){this.groupList.indexOf(t)===-1&&(this.groupList.push(t),this.count=this.groupList.length)}},{key:"removeFromGroupList",value:function(t){t=this.groupList.indexOf(t),-1<t&&(this.groupList.splice(t,1),this.count=this.groupList.length)}}]),qi),Ad=(V(xi,[{key:"getLocalFriendList",value:function(){return re(this._map.values())}},{key:"getFriendRemark",value:function(t){return this._map.has(t)?this._map.get(t).remark:""}},{key:"onFriendProfileModified",value:function(s){var o,i=this,s=s.dataList;Te(s)||(o=this._snsM.get(11),s.forEach(function(m){var l,p=m.userID,m=m.profileList;i.isMyFriend(p)&&(E.l("".concat(i._n,".onFriendProfileModified. friend account:").concat(p,", profileList:").concat(JSON.stringify(m))),(l=i._map.get(p)).update(m),o.modifyMessageSentByPeer({conversationID:"".concat(O.CONV_C2C).concat(p),latestNick:l.profile.nick,latestAvatar:l.profile.avatar}))}),this._onFriendListUpdated())}},{key:"onFriendAdded",value:function(t){var o=this;t.length!==0&&(E.l("".concat(this._n,".onFriendAdded userIDList:").concat(t)),t.forEach(function(i){o._map.set(i,new iu(i))}),this.getFriendProfile({userIDList:t}).then(function(i){t.forEach(function(s){var c=o._map.get(s);0<c.groupList.length&&o._snsM.updateWhenFriendAdded({nameList:c.groupList,userID:s})}),o._onFriendListUpdated()}))}},{key:"onFriendDeleted",value:function(t){var o=this;t.length!==0&&(E.l("".concat(this._n,".onFriendDeleted userIDList:").concat(t)),t.forEach(function(i){var s=o._map.get(i);0<s.groupList.length&&o._snsM.updateWhenFriendDeleted({nameList:s.groupList,userID:i}),o._map.delete(i)}),this._onFriendListUpdated())}},{key:"_onFriendListUpdated",value:function(){this._snsM.emitOEvt(Me.FRIEND_LIST_UPDATED),this._snsM.get(11).checkAndPatchRemark()}},{key:"getFriendProfile",value:function(s){var o=this,i="".concat(this._n,".").concat("getFriendProfile"),s=s.userIDList,c=[],l=[],p=[];if(s.forEach(function(I){var C;o._map.has(I)?(C=o._map.get(I),Date.now()-C.timestamp<o._expirationTime?l.push(C):p.push(I)):c.push({userID:I,code:Q.NOT_MY_FRIEND,message:o._snsM.getErrMsg(Q.NOT_MY_FRIEND)})}),p.length===0)return E.i("".concat(i," newUserIDList is empty")),we({friendList:l,failureUserIDList:c});var m=new ue("getFriendProfile");return m.setMessage("userIDList:".concat(p)),E.i("".concat(i," userIDList:").concat(p)),this._snsM.req({P:P.GET_FD_PROFILE,data:{fromAccount:this._snsM.getMyUserID(),userIDList:p}}).then(function(I){return m.end(),E.i("".concat(i," ok")),I.data.resultList.forEach(function(Y){var S,k=Y.to,G=Y.resultCode,U=Y.resultInfo,Y=Y.tagValueList;q(G)||G===0?(o._map.has(k)?(S=o._map.get(k)).update(Y):(S=new iu(k,Y),o._map.set(k,S)),l.push(S)):c.push({userID:k,code:G,message:U})}),Ae({friendList:l,failureUserIDList:c})}).catch(function(I){return m.setError(I).end(),E.w("".concat(i," failed. error:"),I),W(I)})}},{key:"isMyFriend",value:function(t){return this._map.has(t)}},{key:"pagingGetFriendList",value:function(){var t=this,o="".concat(this._n,".").concat("getFriendList"),i=new ue("getFriendList"),s=Date.now();this._snsM.req({P:P.GET_FD_LIST,data:{fromAccount:this._snsM.getMyUserID(),startIndex:this._startIdx,standardSequence:this._standardSeq,customSequence:this._customSeq}}).then(function(C){var C=C.data,S=C.friendCount,l=C.resultList,p=C.nextStartIndex,m=C.standardSequence,I=C.customSequence,C=C.completeFlag,S=(t._startIdx=p,t._standardSeq=m,t._customSeq=I,"friendCount:".concat(S," nextStartIndex:").concat(p," standardSequence:").concat(m," ")+"customSequence:".concat(I," completeFlag:").concat(C," cost:").concat(An(s)));i.setMessage(S).end(),E.i("".concat(o," ok."),S),Te(l)||l.forEach(function(U){var G=U.to,U=U.tagValueList;t._map.set(G,new iu(G,U))}),C===0?t.pagingGetFriendList():(t._snsM.emitOEvt(Me.FRIEND_LIST_UPDATED),t._pagingGetFriendProfile())}).catch(function(c){return i.setError(c).end(),E.w("".concat(o," failed. error:"),c),W(c)})}},{key:"_pagingGetFriendProfile",value:function(){var t=this,o=re(this._map.keys()),i=this._snsM.get(4),s=o.length,c=s<=100?1:Math.ceil(s/100);E.l("".concat(this._n,"._pagingGetFriendProfile friendCount:").concat(s," pageCount:").concat(c));for(var l=0;l<c;l++)i.getUserProfile({userIDList:o.slice(100*l,100*(l+1))}).then(function(p){p.data.forEach(function(m){var I=t._map.get(m.userID);I&&I.updateProfile(m)}),t._onFriendListUpdated()})}},{key:"addFriend",value:function(I){var o=this,i="".concat(this._n,".").concat("addFriend");if(this._map.has(I.to))return W({code:Q.ALREADY_MY_FRIEND});if(I.wording&&this._snsM.filterProfanity("wording",I)===!1)return W({code:Q.PROFANITY_FOUND});var s=I.to,c=I.source,l=I.type,p=I.wording,m=I.remark,I=I.groupName,C=l,S=(C&&(C===O.SNS_ADD_TYPE_SINGLE||C===O.SNS_ADD_TYPE_BOTH)||(C=O.SNS_ADD_TYPE_BOTH),new ue("addFriend"));return S.setMessage("to:".concat(s," source:").concat(c," type:").concat(C)),this._snsM.req({P:P.ADD_FD,data:{fromAccount:this._snsM.getMyUserID(),addFriendItem:[{to:s,source:c,wording:p,remark:m,groupName:I}],type:C}}).then(function(Y){var Y=Y.data.resultList,Y=(S.setMoreMessage("resultList:".concat(JSON.stringify(Y))).end(),Y[0]),G=Y.to,U=Y.resultCode,Y=Y.resultInfo;return E.i("".concat(i," ok. to:").concat(G," type:").concat(C," code:").concat(U)),q(U)||U===0?Ae({userID:G,code:0}):U===30539?Ae({userID:G,code:U,message:o._snsM.getErrMsg(U)}):W({userID:G,code:U,message:o._snsM.getErrMsg(U)||Y})}).catch(function(k){return S.setError(k).end(),E.w("".concat(i," failed. error:"),k),W(k)})}},{key:"deleteFriend",value:function(s){var o=this,i="".concat(this._n,".").concat("deleteFriend"),m=s.userIDList,s=s.type,c=(1e3<m.length&&(E.w("".concat(i," ").concat(ni(1e3))),m.length=1e3),[]),l=[],p=[];if(m.forEach(function(C){o._map.has(C)?p.push(C):c.push({userID:C,code:Q.NOT_MY_FRIEND,message:o._snsM.getErrMsg(Q.NOT_MY_FRIEND)})}),p.length===0)return we({successUserIDList:l,failureUserIDList:c});var m=s,I=(m&&(m===O.SNS_DELETE_TYPE_SINGLE||m===O.SNS_DELETE_TYPE_BOTH)||(m=O.SNS_DELETE_TYPE_BOTH),new ue("deleteFriend"));return I.setMessage("userIDList:".concat(p," type:").concat(m)),this._snsM.req({P:P.DEL_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:p,type:m}}).then(function(C){return I.end(),E.i("".concat(i," ok")),C=C.data.resultList,Te(C)||C.forEach(function(U){var k=U.to,G=U.resultCode,U=U.resultInfo;q(G)||G===0?l.push({userID:k}):c.push({userID:k,code:G,message:U})}),Ae({successUserIDList:l,failureUserIDList:c})}).catch(function(C){return I.setError(C).end(),E.w("".concat(i," error:"),C),W(C)})}},{key:"updateFriend",value:function(t){var o=this,i=t.userID,s=t.remark,c=t.friendCustomField;if(!this._map.has(i))return W({code:Q.NOT_MY_FRIEND});var l="".concat(this._n,".").concat("updateFriend"),p=new ue("updateFriend"),m=(p.setMessage("userID:".concat(i," remark:").concat(s," friendCustomField:").concat(c)),[]);return q(s)||m.push({tag:Je.REMARK,value:s}),ye(c)&&0<c.length&&c.forEach(function(I){m.push({tag:I.key,value:I.value})}),this._snsM.req({P:P.UPDATE_FD,data:{fromAccount:this._snsM.getMyUserID(),updateItem:[{to:i,snsItem:m}]}}).then(function(k){p.end(),E.i("".concat(l," ok"));var k=k.data.resultList[0],C=k.to,S=k.resultCode,k=k.resultInfo;return q(S)||S===0?((C=o._map.get(C))&&(q(s)||(C.remark=s),ye(c)&&0<c.length&&Ho(C.friendCustomField,c),o._onFriendListUpdated()),Ae(C)):W({code:S,message:k})}).catch(function(I){return p.setError(I).end(),E.w("".concat(l," failed. error:"),I),W(I)})}},{key:"checkFriend",value:function(t){var o="".concat(this._n,".").concat("checkFriend"),i=t.userIDList,s=t.type,c=(s&&(s===O.SNS_CHECK_TYPE_SINGLE||s===O.SNS_CHECK_TYPE_BOTH)||(s=O.SNS_CHECK_TYPE_BOTH),new ue("checkFriend"));return c.setMessage("userIDList:".concat(i," type:").concat(s)),this._snsM.req({P:P.CHECK_FD,data:{fromAccount:this._snsM.getMyUserID(),userIDList:i,type:s}}).then(function(I){c.end(),E.i("".concat(o," ok. userIDList:").concat(i," type:").concat(s));var p=[],m=[],I=I.data.resultList;return ye(I)&&I.forEach(function(U){var S=U.to,k=U.relation,G=U.resultCode,U=U.resultInfo;q(G)||G===0?p.push({userID:S,code:0,relation:k}):m.push({userID:S,code:G,message:U})}),Ae({successUserIDList:p,failureUserIDList:m})}).catch(function(l){return c.setError(l).end(),E.w("".concat(o," failed. error:"),l),W(l)})}},{key:"onAddedToFriendGroup",value:function(s){var o=this,i=s.name,s=s.userIDList;E.l("".concat(this._n,".onAddedToFriendGroup groupName:").concat(i," userIDList:").concat(s)),i&&!Te(s)&&s.forEach(function(c){o._map.has(c)&&o._map.get(c).addToGroupList(i)})}},{key:"onRemovedFromFriendGroup",value:function(s){var o=this,i=s.name,s=s.userIDList;E.l("".concat(this._n,".onRemovedFromFriendGroup groupName:").concat(i," userIDList:").concat(s)),i&&!Te(s)&&s.forEach(function(c){o._map.has(c)&&o._map.get(c).removeFromGroupList(i)})}},{key:"reset",value:function(){this._map.clear(),this._startIdx=0,this._standardSeq=0,this._customSeq=0}}]),xi),fl=(V($s,[{key:"addToUserIDList",value:function(t){this.userIDList.indexOf(t)===-1&&(this.userIDList.push(t),this.count=this.userIDList.length)}},{key:"removeFromUserIDList",value:function(t){t=this.userIDList.indexOf(t),-1<t&&(this.userIDList.splice(t,1),this.count=this.userIDList.length)}}]),$s),Od=(V(Js,[{key:"getLocalGroupList",value:function(){return re(this._map.values())}},{key:"_onGroupListUpdated",value:function(){var t=re(this._map.values());this._snsM.emitOEvt(Me.FRIEND_GROUP_LIST_UPDATED,t)}},{key:"getGroupList",value:function(){var t=this,o="".concat(this._n,".").concat("getGroupList"),i=new ue("getGroupList");return this._snsM.req({P:P.GET_FD_GRP_LIST,data:{fromAccount:this._snsM.getMyUserID()}}).then(function(s){i.end(),s=s.data.resultList,Te(s)?E.i("".concat(o," ok. count:0")):(E.i("".concat(o," ok. count:").concat(s.length)),t._map.clear(),s.forEach(function(c){var l=new fl(c);t._map.set(c.name,l)}),t._onGroupListUpdated())}).catch(function(s){return i.setError(s).end(),E.w("".concat(o," error:"),s),W(s)})}},{key:"createGroup",value:function(c){var o=this,i="".concat(this._n,".").concat("createGroup"),s=c.name,c=c.userIDList;if(this._map.has(s))return W({code:Q.FRIEND_GRP_EXISTED});var l="name:".concat(s," userIDList:").concat(c),p=new ue("createGroup");return p.setMessage(l),this._snsM.req({P:P.CREATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),groupName:[s],userIDList:ye(c)?c:void 0}}).then(function(S){p.end(),E.l("".concat(i," ok. ").concat(l));var S=S.data.resultList,I=[],C=[],S=(S&&S.forEach(function(k){var G=k.to,U=k.resultCode,Y=k.resultInfo;q(U)||U===0?I.push(G):(G={userID:k.to,code:U,message:Y},C.push(G))}),new fl({name:s,userIDList:I}));return o._map.set(s,S),o._snsM.onAddedToFriendGroup({name:s,userIDList:I}),o._onGroupListUpdated(),Ae({friendGroup:S,failureUserIDList:C})}).catch(function(m){return p.setError(m).end(),E.w("".concat(i," failed. error:"),m),W(m)})}},{key:"deleteGroup",value:function(t){var o=this,i="".concat(this._n,".").concat("deleteGroup"),s=t.name;if(!this._map.has(s))return this._onGroupNotExist();var c="name:".concat(s),l=new ue("deleteGroup");return l.setMessage(c),this._snsM.req({P:P.DEL_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),nameList:[s]}}).then(function(p){l.end(),E.l("".concat(i," ok. ").concat(c));var m=o._map.get(s);return m&&(o._snsM.onRemovedFromFriendGroup({name:s,userIDList:m.userIDList}),o._map.delete(s),m.userIDList.length=0),o._onGroupListUpdated(),Ae(m)}).catch(function(p){return l.setError(p).end(),E.w("".concat(i," failed. error:"),p),W(p)})}},{key:"renameGroup",value:function(t){var o=this,i="".concat(this._n,".").concat("renameGroup"),s=t.oldName,c=t.newName;if(!this._map.has(s))return this._onGroupNotExist();var l="oldName:".concat(s," newName:").concat(c),p=new ue("renameGroup");return p.setMessage(l),this._snsM.req({P:P.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:s,newName:c}}).then(function(){var m;return p.end(),E.l("".concat(i," ok. ").concat(l)),o._map.has(s)?((m=o._map.get(s)).name=c,o._map.delete(s),o._map.set(c,m),o._snsM.onRemovedFromFriendGroup({name:s,userIDList:m.userIDList}),o._snsM.onAddedToFriendGroup({name:c,userIDList:m.userIDList}),o._onGroupListUpdated(),Ae(m)):Ae()}).catch(function(m){return p.setError(m).end(),E.w("".concat(i," failed. error:"),m),W(m)})}},{key:"addToGroup",value:function(c){var o=this,i="".concat(this._n,".").concat("addToGroup"),s=c.name,c=c.userIDList;if(!this._map.has(s))return this._onGroupNotExist();var l="name:".concat(s," userIDList:").concat(c),p=new ue("addToGroup");return p.setMessage(l),this._snsM.req({P:P.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:s,updateGroupItem:c.filter(function(m){return o._snsM.isMyFriend(m)}).map(function(m){return{to:m,updateType:"Update_Type_Add"}})}}).then(function(m){return p.end(),E.l("".concat(i," ok. ").concat(l)),o._onGroupUpdated(s,m)}).catch(function(m){return p.setError(m).end(),E.w("".concat(i," failed. error:"),m),W(m)})}},{key:"removeFromGroup",value:function(c){var o=this,i="".concat(this._n,".").concat("removeFromGroup"),s=c.name,c=c.userIDList;if(!this._map.has(s))return this._onGroupNotExist();var l="name:".concat(s," userIDList:").concat(c),p=new ue("removeFromGroup");return p.setMessage(l),this._snsM.req({P:P.UPDATE_FD_GRP,data:{fromAccount:this._snsM.getMyUserID(),oldName:s,updateGroupItem:c.filter(function(m){return o._snsM.isMyFriend(m)}).map(function(m){return{to:m,updateType:"Update_Type_Delete"}})}}).then(function(m){return p.end(),E.l("".concat(i," ok. ").concat(l)),o._onGroupUpdated(s,m)}).catch(function(m){return p.setError(m).end(),E.w("".concat(i," failed. error:"),m),W(m)})}},{key:"_onGroupUpdated",value:function(t,i){var i=i.data.resultList,s=this._map.get(t),c=[],l=[],p=[];return ye(i)&&i.forEach(function(m){var I=m.to,C=m.resultCode,S=m.resultInfo,k=m.type;C===0?k==="Update_Type_Add"?s&&(s.addToUserIDList(I),l.push(I)):k==="Update_Type_Delete"&&s&&(s.removeFromUserIDList(I),p.push(I)):c.push({to:m.to,code:C,message:S})}),E.l("".concat(this._n,"._onGroupUpdated name:").concat(t," userIDList:").concat(s.userIDList)),0<l.length&&this._snsM.onAddedToFriendGroup({name:t,userIDList:l}),0<p.length&&this._snsM.onRemovedFromFriendGroup({name:t,userIDList:p}),Ae({friendGroup:s,failureUserIDList:c})}},{key:"updateWhenFriendAdded",value:function(t){var o=this,i=t.nameList,s=t.userID;E.l("".concat(this._n,".updateWhenFriendAdded userID:").concat(s," nameList:").concat(i)),Te(i)||i.forEach(function(c){o._map.has(c)&&o._map.get(c).addToUserIDList(s)})}},{key:"updateWhenFriendDeleted",value:function(t){var o=this,i=t.nameList,s=t.userID;E.l("".concat(this._n,".updateWhenFriendDeleted userID:").concat(s," nameList:").concat(i)),Te(i)||i.forEach(function(c){o._map.has(c)&&o._map.get(c).removeFromUserIDList(s)})}},{key:"_onGroupNotExist",value:function(t){return W({code:Q.FRIEND_GRP_NOT_EXIST})}},{key:"reset",value:function(){this._map.clear()}}]),Js),Nd=(z(Fi,Ht),cl=J(Fi),V(Fi,[{key:"onContextUpdated",value:function(t){this._friendHandler.pagingGetFriendList(),this._friendGroupHandler.getGroupList(),this._friendApplicationHandler.getApplicationList()}},{key:"onRelationChainModified",value:function(I){var o,i,s,c,l,p,m=this,I=I.dataList;Te(I)||(o=[],i=[],s=[],l=!(c=[]),p="",I.forEach(function(C){var S;C.pushType!==3&&C.pushType!==4||!C.from||(p=C.from),C.friendAddAccount&&(o.push.apply(o,re(C.friendAddAccount)),c.push.apply(c,re(C.friendAddAccount))),C.friendDelAccount&&i.push.apply(i,re(C.friendDelAccount)),C.friendApplicationAdded&&s.push.apply(s,re(C.friendApplicationAdded)),C.friendApplicationDeletedUserIDList&&c.push.apply(c,re(C.friendApplicationDeletedUserIDList)),C.reportTime&&C.pushType===7&&(l=!0),C.friendUpInfo&&(S={dataList:[]},C.friendUpInfo.forEach(function(k){S.dataList.push({userID:k.friendAccount,profileList:re(k.sns)})}),m.onFriendProfileModified(S))}),l&&this._friendApplicationHandler.onApplicationRead(),this._friendApplicationHandler.onApplicationAdded(s,p),this._friendApplicationHandler.onApplicationDeleted(c),this._friendHandler.onFriendAdded(o),this._friendHandler.onFriendDeleted(i))}},{key:"isMyFriend",value:function(t){return this._friendHandler.isMyFriend(t)}},{key:"filterProfanity",value:function(t,o){var s=this.get(29);if(!s)return!0;var s=s.filterText(o[t],"sns"),i=s.isAllowedToSend,s=s.modifiedText;return i===!0&&(o[t]=s,!0)}},{key:"onFriendProfileModified",value:function(t){this._friendHandler.onFriendProfileModified(t)}},{key:"getLocalFriendList",value:function(){var t=!(0<arguments.length&&arguments[0]!==void 0)||arguments[0],o=this._friendHandler.getLocalFriendList();return t?we(o):o}},{key:"getFriendRemark",value:function(t){return this._friendHandler.getFriendRemark(t)}},{key:"getFriendList",value:function(){return this._friendHandler.pagingGetFriendList()}},{key:"addFriend",value:function(t){return this._friendHandler.addFriend(t)}},{key:"deleteFriend",value:function(t){return this._friendHandler.deleteFriend(t)}},{key:"checkFriend",value:function(t){return this._friendHandler.checkFriend(t)}},{key:"getFriendProfile",value:function(t){return this._friendHandler.getFriendProfile(t)}},{key:"updateFriend",value:function(t){return this._friendHandler.updateFriend(t)}},{key:"onAddedToFriendGroup",value:function(t){this._friendHandler.onAddedToFriendGroup(t)}},{key:"onRemovedFromFriendGroup",value:function(t){this._friendHandler.onRemovedFromFriendGroup(t)}},{key:"getLocalFriendApplicationList",value:function(){var t=this._friendApplicationHandler.getLocalApplicationList();return we(t)}},{key:"deleteFriendApplication",value:function(t){return this._friendApplicationHandler.deleteApplication(t)}},{key:"refuseFriendApplication",value:function(t){return this._friendApplicationHandler.refuseApplication(t)}},{key:"acceptFriendApplication",value:function(t){return this._friendApplicationHandler.acceptApplication(t)}},{key:"setFriendApplicationRead",value:function(t){return this._friendApplicationHandler.setApplicationRead(t)}},{key:"getLocalFriendGroupList",value:function(){var t=this._friendGroupHandler.getLocalGroupList();return we(t)}},{key:"createFriendGroup",value:function(t){return this._friendGroupHandler.createGroup(t)}},{key:"deleteFriendGroup",value:function(t){return this._friendGroupHandler.deleteGroup(t)}},{key:"addToFriendGroup",value:function(t){return this._friendGroupHandler.addToGroup(t)}},{key:"removeFromFriendGroup",value:function(t){return this._friendGroupHandler.removeFromGroup(t)}},{key:"renameFriendGroup",value:function(t){return this._friendGroupHandler.renameGroup(t)}},{key:"updateWhenFriendAdded",value:function(t){this._friendGroupHandler.updateWhenFriendAdded(t)}},{key:"updateWhenFriendDeleted",value:function(t){this._friendGroupHandler.updateWhenFriendDeleted(t)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._friendHandler.reset(),this._friendGroupHandler.reset(),this._friendApplicationHandler.reset()}}]),Fi),bd=(z(wi,Ht),rl=J(wi),V(wi,[{key:"isWorkerEnabled",value:function(){return this._isWorkerEnabled&&Yi}},{key:"startWorkerTimer",value:function(){E.l("".concat(this._n,".startWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("start")}},{key:"stopWorkerTimer",value:function(){E.l("".concat(this._n,".stopWorkerTimer")),this._workerTimer&&this._workerTimer.postMessage("stop")}},{key:"_init",value:function(){var t,o;Yi&&(t=URL.createObjectURL(new Blob(['let interval = -1;onmessage = function(event) {  if (event.data === "start") {    if (interval > 0) {      clearInterval(interval);    }    interval = setInterval(() => {      postMessage("");    }, 1000);    postMessage(interval);  } else if (event.data === "stop") {    clearInterval(interval);    interval = -1;  }};'],{type:"application/javascript; charset=utf-8"})),this._workerTimer=new Worker(t),(o=this)._workerTimer.onmessage=function(i){i.data?(o._timerID=i.data,E.l("".concat(o._n,"._init seed:").concat(o._timerID))):o._m.onCheckTimer()})}},{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("enable_worker");E.l("".concat(this._n,"._onCloudConfig enableWorker:").concat(t)),q(t)||t==="1"?!this._isWorkerEnabled&&Yi&&(this._isWorkerEnabled=!0,this.startWorkerTimer(),this._m.onWorkerTimerEnabled()):this._isWorkerEnabled&&Yi&&(this._isWorkerEnabled=!1,this.stopWorkerTimer(),this._m.onWorkerTimerDisabled())}},{key:"terminate",value:function(){E.l("".concat(this._n,".terminate")),this._workerTimer&&(this._workerTimer.terminate(),this._workerTimer=null,this._timerID=-1)}},{key:"getTimerID",value:function(){return this._timerID}},{key:"reset",value:function(){E.l("".concat(this._n,".reset"))}}]),wi),Pd=(V(Ui,[{key:"isValidPurchaseBits",value:function(t){return t&&typeof t=="string"&&1<=t.length&&t.length<=64&&/[01]{1,64}/.test(t)}},{key:"parsePurchaseBits",value:function(t){if(this.isValidPurchaseBits(t)){this._featureMap.clear();for(var o,i=t.length-1,s=0;0<=i;i--,s++)o=(s<32?new ct(0,Math.pow(2,s)):new ct(Math.pow(2,s-32),0)).toString(),t[i]==="1"?this._featureMap.set(o,!0):this._featureMap.set(o,!1)}else E.w("".concat(this._n,".parsePurchaseBits invalid purchasebits:").concat(t))}},{key:"hasPurchasedFeature",value:function(t){return!!this._featureMap.get(t)}},{key:"isFeatureEnabled",value:function(t){for(var o=parseInt(t).toString(2),i=void 0,s=!0,c=o.length-1,l=0;0<=c;c--,l++)if(o.charAt(c)==="1"&&(i=(l<32?new ct(0,Math.pow(2,l)):new ct(Math.pow(2,l-32),0)).toString(),!this._featureMap.get(i))){s=!1;break}return E.l("".concat(this._n,".isFeatureEnabled decimalNumber:").concat(t," key:").concat(i," ret:").concat(s)),we({enabled:s})}},{key:"isFeatureEnabledForStat",value:function(t){for(var o=parseInt(t).toString(2),i=o.length-1,s=0;0<=i;i--,s++)if(o.charAt(i)==="1"){if(c=(s<32?new ct(0,Math.pow(2,s)):new ct(Math.pow(2,s-32),0)).toString(),!this._featureMap.get(c))break;var c,l="",p=0;c===Ue.PLUGIN_TRANSLATE?(l="plugin_translate",p=16):c===Ue.PLUGIN_VOICE_TO_TEXT?(l="plugin_voice_to_text",p=17):c===Ue.PLUGIN_CS?(l="plugin_cs",p=14):c===Ue.PLUGIN_PUSH?(l="plugin_push",p=13):c===Ue.PLUGIN_BOT?(l="plugin_bot",p=15):c===Ue.MSG_REACTION&&(l="plugin_emoji_reaction",p=18),l!==""&&(c=this._commercialConfigM.get(12).getUIPlatform(),new ue(l).setCode(p).setUIPlatform(c).end(),E.l("".concat(this._n,".isFeatureEnabledForStat ").concat(l," code:").concat(p," uiPlatform:").concat(c)))}}},{key:"isCSPluginEnabled",value:function(){var t;this._isCSPluginReported||(t=this._commercialConfigM.get(12).getUIPlatform(),new ue("plugin_search").setCode(6).setUIPlatform(t).end(),this._isCSPluginReported=!0)}},{key:"clear",value:function(){this._featureMap.clear(),this._isCSPluginReported=!1}}]),Ui),Gd=(V(zs,[{key:"_canFetch",value:function(){return this.get(12).isLoggedIn()?!this._isFetching&&Date.now()>=this._expiredTime:(this._expiredTime=Date.now()+2e3,!1)}},{key:"onCheckTimer",value:function(t){this._canFetch()&&this.fetchConfig()}},{key:"fetchConfig",value:function(){var t,o,i=this,s=this._canFetch(),c="".concat(this._n,".fetchConfig");E.l("".concat(c," canFetch:").concat(s)),s&&(t=new ue("fetchCommercialConfig"),s=this.get(12).getSDKAppID(),o=this.get(20),this._isFetching=!0,o.req({P:P.FETCH_COMMERCIAL_CONFIG,data:{SDKAppID:s}}).then(function(l){t.setMessage("purchaseBits:".concat(l.data.purchaseBits)).end(),E.l("".concat(c," ok.")),i._parseConfig(l.data),i._isFetching=!1}).catch(function(l){t.setError(l).end(),i._isFetching=!1}))}},{key:"onPushedConfig",value:function(t){var o="".concat(this._n,".onPushedConfig data:").concat(JSON.stringify(t));E.l("".concat(o)),new ue("pushedCommercialConfig").setMessage("purchaseBits:".concat(t.purchaseBits)).end(),this._parseConfig(t)}},{key:"_parseConfig",value:function(t){var o="".concat(this._n,"._parseConfig"),i=t.errorCode,s=t.errorMessage,c=t.purchaseBits,l=t.expiredTime;i===0?(this._purchasedFeatureHandler.parsePurchaseBits(c),this._expiredTime=Date.now()+1e3*l):q(i)?(E.l("".concat(o," failed. Invalid message format:"),t),this._setExpiredTimeOnResponseError(36e5)):(E.e("".concat(o," errorCode:").concat(i," errorMessage:").concat(s)),this._setExpiredTimeOnResponseError(12e4))}},{key:"_setExpiredTimeOnResponseError",value:function(t){this._expiredTime=Date.now()+t}},{key:"canIUse",value:function(t){return this._purchasedFeatureHandler.hasPurchasedFeature(t)}},{key:"isFeatureEnabled",value:function(t){return this._purchasedFeatureHandler.isFeatureEnabled(t)}},{key:"isFeatureEnabledForStat",value:function(t){this._purchasedFeatureHandler.isFeatureEnabledForStat(t)}},{key:"isCSPluginEnabled",value:function(){this._purchasedFeatureHandler.isCSPluginEnabled()}},{key:"get",value:function(t){return this._m.get(t)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler.clear()}}]),zs),Ud=(z(Gi,Ht),sl=J(Gi),V(Gi,[{key:"registerPlugin",value:function(t){var o,i,s,c,l,p,m,I,C,S,k,G,U;Ce?(this._offlinePushPlugin=t["tim-offline-push-plugin"],o=(U=t.offlinePushConfig||{}).huaweiBusinessID,i=U.xiaomiBusinessID,s=U.xiaomiAppID,c=U.xiaomiAppKey,l=U.meizuBusinessID,p=U.meizuAppID,m=U.meizuAppKey,I=U.vivoBusinessID,C=U.oppoBusinessID,S=U.oppoAppKey,k=U.oppoAppSecret,G=U.honorBusinessID,U=U.iosBusinessID,this._androidPushConfig.huaweiPushBussinessId=o,this._androidPushConfig.xiaomiPushBussinessId=i,this._androidPushConfig.xiaomiPushAppId=s,this._androidPushConfig.xiaomiPushAppKey=c,this._androidPushConfig.meizuPushBussinessId=l,this._androidPushConfig.meizuPushAppId=p,this._androidPushConfig.meizuPushAppKey=m,this._androidPushConfig.vivoPushBussinessId=I,this._androidPushConfig.oppoPushBussinessId=C,this._androidPushConfig.oppoPushAppKey=S,this._androidPushConfig.oppoPushAppSecret=k,this._androidPushConfig.honorPushBussinessId=G,new ue("registerPlugin").setMessage("tim-offline-push-plugin").setMoreMessage("isExist:".concat(!q(this._offlinePushPlugin))).end(!0),E.l("".concat(this._n,".").concat("registerPlugin"," ok. offlinePushConfig:").concat(JSON.stringify(t.offlinePushConfig))),this._iosBusinessID=U,this._setAppShowListener()):this.warn("OfflinePushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._getDeviceToken()}},{key:"_getDeviceToken",value:function(){var t,o=this,i="".concat(this._n,".").concat("_getDeviceToken");Ot(this._offlinePushPlugin.getDeviceToken)?(t="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig),", iosBusinessID:").concat(this._iosBusinessID),E.l("".concat(i," start. ").concat(t)),new ue("_getDeviceToken").setMessage("".concat(t)).end(!0),this._offlinePushPlugin.getDeviceToken(this._androidPushConfig,function(s){var c,l,p,m,I=new ue("getDeviceTokenRes"),C=s.code,S=s.msg;C===0?(c=(m=s.data).deviceToken,l=m.deviceBrand,p=m.deviceType,m=m.bussinessId,o._deviceToken=c,o._businessID=m||o._iosBusinessID,t="deviceToken:".concat(c,", deviceBrand:").concat(l||p,", businessID:").concat(o._businessID),E.l("".concat(i," ok. ").concat(t)),I.setMessage(t).end(!0),o._setToken()):(I.setMessage("code:".concat(C,", msg:").concat(S)).end(!0),E.e("".concat(i," failed. error:"),s))})):E.e("".concat(i," getDeviceToken is not a function"))}},{key:"canIUseOfflinePush",value:function(){return Ce&&!q(this._offlinePushPlugin)}},{key:"_setAppShowListener",value:function(){var t=this,o="".concat(this._n,".").concat("_setAppShowListener");q(this._offlinePushPlugin)?E.e("".concat(o," offlinePushPlugin is undefined")):Ot(this._offlinePushPlugin.setAppShowListener)?(new ue("_setAppShowListener").end(!0),E.l("".concat(o," start")),this._offlinePushPlugin.setAppShowListener(function(i){i=(i||{}).appShow,new ue("setAppShowListenerRes").setMessage("appShow:".concat(i)).end(!0),E.l("".concat(o," ok. appShow:").concat(i)),t._m.isReady()&&(i===0?(t._getConvUnreadCount(),t._onBackground()):i===1&&t._onForeground())})):E.e("".concat(o," setAppShowListener is not a function"))}},{key:"getDeviceBrand",value:function(){var t;if(!q(this._offlinePushPlugin)&&Ot(this._offlinePushPlugin.getDeviceType))return t=(this._offlinePushPlugin.getDeviceType()||{}).deviceType,E.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(t)),t}},{key:"_setToken",value:function(){var t="".concat(this._n,"._setToken"),o=this.get(12),i=1,s="",c="",m=(Te(this._deviceToken)&&(i=0),this.getUniAppPlatform()),l=this.getDeviceBrand(),p=(m===dt.IOS||m===dt.IPAD||m===dt.MAC?c=this._deviceToken:m===dt.ANDROID&&(s=this._deviceToken),new ue("offlinePushSetToken")),m="deviceToken:".concat(c||s,", businessID:").concat(this._businessID,", ")+"deviceBrand:".concat(l,", isWebUniapp:").concat(this._isWebUniapp,", pushMsg:").concat(i,", platform:").concat(m);return p.setMessage("".concat(m)),E.l("".concat(t," ").concat(m)),this.req({P:P.SET_TOKEN,data:{tokenID:s,pushMsg:i,sdkAppID:o.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:l,deviceToken:c,isWebUniapp:this._isWebUniapp}}).then(function(I){return p.end(),E.l("".concat(t," ok")),I}).catch(function(I){return p.setError(I).end(),E.e("".concat(t," failed. error:"),I),W(I)})}},{key:"_getConvUnreadCount",value:function(){var t=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach(function(o){o.type===O.CONV_C2C&&(t._c2cUnreadCount+=o.unreadCount),o.type===O.CONV_GROUP&&(t._groupUnreadCount+=o.unreadCount)})}},{key:"_onBackground",value:function(){var t=this,o="".concat(this._n,".").concat("_onBackground"),i=new ue("_onBackground");this.req({P:P.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(s){return i.setMessage("c2cUnreadCount: ".concat(t._c2cUnreadCount,", groupUnreadCount: ").concat(t._groupUnreadCount)).end(),E.l("".concat(o," ok")),s}).catch(function(s){i.setError(s).end(),E.e("".concat(o," failed. error:"),s)})}},{key:"_onForeground",value:function(){var t="".concat(this._n,".").concat("_onForeground"),o=new ue("_onForeground");this.req({P:P.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(i){return o.end(),E.l("".concat(t," ok")),i}).catch(function(i){o.setError(i).end(),E.e("".concat(t," failed. error:"),i)})}},{key:"getUniAppPlatform",value:function(){var t=uni.getSystemInfoSync().platform,o=this.getDeviceBrand();return t==="ios"?dt.IOS:t==="android"?dt.ANDROID:o===1002?dt.IPAD:o===1001?dt.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,E.l("".concat(this._n,".reset"))}}]),Gi),wd=(z(Pi,Ht),nu=J(Pi),V(Pi,[{key:"registerPlugin",value:function(t){var o,i,s;Ce?(o="".concat(this._n,".").concat("registerPlugin"),this._pushPlugin=t["tim-push"],this._getDeviceInfo(),i=(s=t.pushConfig||{}).androidConfig,s=s.iOSConfig,ft(i)&&(this._androidPushConfig=i[this._deviceInfo.packageName]),i=(s||{}).iOSBusinessID,this._iOSBusinessID=i,s=!q(this._pushPlugin),new ue("registerPlugin").setMessage(this._pluginName).setMoreMessage("isExisted:".concat(s)).end(!0),E.l("".concat(o," ok. pushConfig:").concat(JSON.stringify(t.pushConfig))),s?(this._setAppShowListener(),this._setPushEventReportListener()):E.e("".concat(o," ").concat(this._pluginName," is undefined"))):this.warn("TIMPushInUniapp")}},{key:"init",value:function(){this._isWebUniapp=this.getUniAppPlatform(),this._reportEventCacheList(),this._getDeviceToken(),this.get(27).isFeatureEnabledForStat(Math.pow(2,41))}},{key:"_reportEventCacheList",value:function(){var t=this,o="".concat(this._n,".").concat("_reportEventCacheList");Ot(this._pushPlugin.getPushEventCacheList)?(new ue("_reportEventCacheList").end(!0),this._pushPlugin.getPushEventCacheList(function(i){var s=i.code,c=i.data.eventList,l=new ue("getPushEventCacheListRes");if(l.setCode(s),s!==0)l.setMessage("res:".concat(JSON.stringify(i))).end(!0),E.e("".concat(o," failed. error:").concat(JSON.stringify(i)));else{s=c.length<10?"eventList:".concat(JSON.stringify(c)):"eventList.length:".concat(c.length),E.l("".concat(o," ok. ").concat(s)),l.setMessage(s).end(!0);for(var p=v(v({},i.data),{},{eventList:[]});0<c.length;)p.eventList=c.splice(0,40),t._pushReport(p)}})):E.e("".concat(this._pluginName,".getPushEventCacheList is not a function"))}},{key:"_getDeviceToken",value:function(){var t,o=this,i="".concat(this._n,".").concat("_getDeviceToken");Ot(this._pushPlugin.getDeviceToken)?(t="androidPushConfig:".concat(JSON.stringify(this._androidPushConfig)," iOSBusinessID:").concat(this._iOSBusinessID),E.l("".concat(i," start. ").concat(t)),new ue("_getDeviceToken").setMessage("".concat(t)).end(!0),this._pushPlugin.getDeviceToken(this._androidPushConfig,function(s){var c,l,p,m=s.code,I=s.msg,C=new ue("getDeviceTokenRes");if(C.setCode(m),m===0)return c=(m=s.data).deviceToken,l=m.deviceBrand,p=m.deviceType,m=m.bussinessId,o._deviceToken=c,o._businessID=m||o._iOSBusinessID,t="deviceToken:".concat(c," deviceBrand:").concat(l||p," businessID:").concat(o._businessID),E.l("".concat(i," ok. ").concat(t)),C.setMessage(t).end(!0),void o._setToken();C.setMessage(I).end(!0),E.e("".concat(i," failed. error:").concat(JSON.stringify(s)))})):E.e("".concat(this._pluginName,".getDeviceToken is not a function"))}},{key:"_getDeviceInfo",value:function(){var t="".concat(this._n,".").concat("_getDeviceInfo");if(Ot(this._pushPlugin.getDeviceInfo)){var o=this._pushPlugin.getDeviceInfo(),i=o.code,s=o.data,c=new ue("_getDeviceInfo");if(c.setCode(i),i===0)return this._deviceInfo=v(v({},this._deviceInfo),s),this._deviceInfo.pushVersion||(this._deviceInfo.pushVersion="1.0.1"),i="deviceInfo:".concat(JSON.stringify(this._deviceInfo)),E.l("".concat(t," ok. ").concat(i)),void c.setMessage(i).end(!0);c.setMessage("deviceInfoRes:".concat(JSON.stringify(o))).end(!0),E.e("".concat(t," failed. error:").concat(JSON.stringify(o)))}else E.e("".concat(this._pluginName,".getDeviceInfo is not a function"))}},{key:"canIUseTIMPush",value:function(){return Ce&&!q(this._pushPlugin)}},{key:"_setAppShowListener",value:function(){var t=this,o="".concat(this._n,".").concat("_setAppShowListener");Ot(this._pushPlugin.setAppShowListener)?(new ue("_setAppShowListener").end(!0),E.l("".concat(o," start")),this._pushPlugin.setAppShowListener(function(i){i=(i||{}).appShow,new ue("setAppShowListenerRes").setMessage("appShow:".concat(i)).end(!0),E.l("".concat(o," ok. appShow:").concat(i)),t._m.isReady()&&(i===0?(t._getConvUnreadCount(),t._onBackground()):i===1&&t._onForeground())})):E.e("".concat(this._pluginName,".setAppShowListener is not a function"))}},{key:"_setPushEventReportListener",value:function(){var t=this,o="".concat(this._n,".").concat("_setPushEventReportListener");Ot(this._pushPlugin.setPushEventReportListener)?(new ue("_setPushEventReportListener").end(!0),this._pushPlugin.setPushEventReportListener(function(i){var s=i.code,c=i.data,l=c.eventList,p=new ue("setPushEventReportListenerRes");if(p.setCode(s),s===0)return s="eventList:".concat(JSON.stringify(l)),E.l("".concat(o," ok. ").concat(s)),p.setMessage(s).end(!0),void(t._m.isReady()&&ye(l)&&0<l.length&&t._pushReport(c));p.setMessage("res:".concat(JSON.stringify(i))).end(!0),E.e("".concat(o," failed. error:").concat(JSON.stringify(i)))})):E.e("".concat(this._pluginName,".setPushEventReportListener is not a function"))}},{key:"getDeviceBrand",value:function(){var t;if(!q(this._pushPlugin)&&Ot(this._pushPlugin.getDeviceType))return t=(this._pushPlugin.getDeviceType()||{}).deviceType,E.l("".concat(this._n,".getDeviceBrand ok. deviceType:").concat(t)),t}},{key:"_setToken",value:function(){var t="".concat(this._n,".").concat("_setToken"),o=this.get(12),i=1,m="",s="",l=(Te(this._deviceToken)&&(i=0),this.getUniAppPlatform()),c=this.getDeviceBrand(),l=(l===dt.IOS||l===dt.IPAD||l===dt.MAC?s=this._deviceToken:l===dt.ANDROID&&(m=this._deviceToken),v({tokenID:m,pushMsg:i,sdkAppID:o.getSDKAppID(),businessID:parseInt(this._businessID),deviceBrand:c,deviceToken:s,isWebUniapp:this._isWebUniapp},this._deviceInfo)),p=new ue("_setToken"),m="data:".concat(JSON.stringify(l));p.setMessage("".concat(m)),E.l("".concat(t," ").concat(m)),this.req({P:P.SET_TOKEN,data:l}).then(function(){p.end(),E.w("".concat(t," ok"))}).catch(function(I){p.setError(I).end(),E.e("".concat(t," failed. error:"),I),W(I)})}},{key:"_getConvUnreadCount",value:function(){var t=this;this._c2cUnreadCount=0,this._groupUnreadCount=0,this.get(11).getLocalConvList().forEach(function(o){o.type===O.CONV_C2C&&(t._c2cUnreadCount+=o.unreadCount),o.type===O.CONV_GROUP&&(t._groupUnreadCount+=o.unreadCount)})}},{key:"_onBackground",value:function(){var t=this,o="".concat(this._n,".").concat("_onBackground"),i=new ue("_onBackground");this.req({P:P.STAT_BACKGROUND,data:{c2cUnreadCount:this._c2cUnreadCount,groupUnreadCount:this._groupUnreadCount,isWebUniapp:this._isWebUniapp}}).then(function(){i.setMessage("c2cUnreadCount:".concat(t._c2cUnreadCount," groupUnreadCount:").concat(t._groupUnreadCount)).end(),E.l("".concat(o," ok"))}).catch(function(s){i.setError(s).end(),E.e("".concat(o," failed. error:"),s)})}},{key:"_onForeground",value:function(){var t="".concat(this._n,".").concat("_onForeground"),o=new ue("_onForeground");this.req({P:P.STAT_FOREGROUND,data:{isWebUniapp:this._isWebUniapp}}).then(function(){o.end(),E.l("".concat(t," ok"))}).catch(function(i){o.setError(i).end(),E.e("".concat(t," failed. error:"),i)})}},{key:"_pushReport",value:function(t){var o=this,i="".concat(this._n,".").concat("_pushReport"),s=new ue("_pushReport");this.req({P:P.PUSH_REPORT,data:{eventList:t.eventList}}).then(function(){s.end(),o._notifyReportSuccess(t)}).catch(function(c){s.setError(c).end(),E.e("".concat(i," failed. error:"),c)})}},{key:"_notifyReportSuccess",value:function(t){!q(this._pushPlugin)&&Ot(this._pushPlugin.notifyReportSuccess)&&(this._pushPlugin.notifyReportSuccess(t),E.l("".concat(this._n,"._notifyReportSuccess ok")))}},{key:"getUniAppPlatform",value:function(){var t=uni.getSystemInfoSync().platform,o=this.getDeviceBrand();return t==="ios"?dt.IOS:t==="android"?dt.ANDROID:o===1002?dt.IPAD:o===1001?dt.MAC:void 0}},{key:"reset",value:function(){this._deviceToken="",this._businessID=0,this._c2cUnreadCount=0,this._groupUnreadCount=0,this._isWebUniapp=0,E.l("".concat(this._n,".reset"))}}]),Pi),Fd=(z(bi,Ht),tu=J(bi),V(bi,[{key:"init",value:function(){var t=this.get(18).getPlugin("tim-profanity-filter-plugin");t&&(this._plugin=new t({logger:E,isArray:ye,isMap:Se,isDevMode:this.isDevMode()}),this._getLexicon())}},{key:"onCheckTimer",value:function(){this._plugin&&this._canIUseLexicon&&this.isLoggedIn()&&!this._isFetching&&Date.now()>=this._expiredTime&&this._getLexicon()}},{key:"filterMessage",value:function(t,s){var i=!0;if(!this._plugin||!this._canIUseLexicon||s&&s.messageControlInfo&&s.messageControlInfo.excludedFromContentModeration===!0)return i;var s=t.type,c=t.conversationType;if(s!==O.MSG_TEXT&&s!==O.MSG_CUSTOM)return i;var l,p="".concat(this._n,".filterMessage");if(E.l("".concat(p)),s===O.MSG_TEXT){if(c===O.CONV_C2C?l="c2c_text_message":c===O.CONV_GROUP&&(l="group_text_message"),!this._isConfigOn(l))return i;var I=this._plugin.filter(t.payload.text),m=I.type,I=I.modifiedText;m===1?i=!1:m===2&&(t.payload.text=I)}else if(s===O.MSG_CUSTOM){if(c===O.CONV_C2C?l="c2c_custom_message":c===O.CONV_GROUP&&(l="group_custom_message"),!this._isConfigOn(l))return i;m=this._plugin.filter(t.payload.data),I=this._plugin.filter(t.payload.description),s=this._plugin.filter(t.payload.extension),m.type===1||I.type===1||s.type===1?i=!1:(m.type===2&&(t.payload.data=m.modifiedText),I.type===2&&(t.payload.description=I.modifiedText),s.type===2&&(t.payload.extension=s.modifiedText))}return E.l("".concat(p," done. isAllowedToSend:").concat(i)),i}},{key:"filterText",value:function(t,o){var i="".concat(this._n,".filterText"),s={isAllowedToSend:!0,modifiedText:t};return!this._plugin||!this._canIUseLexicon||!this._isConfigOn(o)?s:(E.l("".concat(i)),o=this._plugin.filter(t),t=o.type,o=o.modifiedText,t===1?s.isAllowedToSend=!1:t===2&&(s.modifiedText=o),E.l("".concat(i," done. ret:"),s),s)}},{key:"_getLexicon",value:function(){var t=this,o=new ue("profanityFilter"),i="".concat(this._n,"._getLexicon");this._isFetching=!0,this.req({P:P.GET_PROFANITY_LIST,data:{startIndex:this._startIndex,version:this._version}}).then(function(k){var k=k.data,c=k.errorInfo,l=k.filterConfig,p=k.lexicon,m=k.strToken,I=k.completeFlag,C=k.nextStartIndex,S=k.version,k=k.expiredTime,G=c.errorCode,U=c.errorMessage;return G!==0?(t._isFetching=!1,E.w("".concat(i," failed. error:"),c),void o.setCode(G).setMessage(U).end()):(t._onFilterConfig(l),t._getToken(m),I===1?(E.l("".concat(i," done. version:").concat(S," expiredTime:").concat(k)),t._version=S,t._canIUseLexicon=!0,t._isFetching=!1,t._expiredTime=Date.now()+1e3*k,void t._plugin.onLexiconCompleted(p)):(t._startIndex=C,t._plugin.onLexiconSliced(p),void t._getLexicon()))}).catch(function(s){o.setError(s).end(),t._isFetching=!1,E.l("".concat(i," failed. error:"),s)})}},{key:"_onFilterConfig",value:function(t){var o=this;Te(t)||(this._filterConfigMap.clear(),Object.keys(t).forEach(function(i){o._filterConfigMap.set(i,t[i])}),E.l("".concat(this._n,"._onFilterConfig. keys:").concat(Array.from(this._filterConfigMap.keys())," values:").concat(Array.from(this._filterConfigMap.values()))))}},{key:"_isConfigOn",value:function(t){return this._filterConfigMap.get(t)===1}},{key:"_getToken",value:function(t){if(Ee(t)){var o=t.length,i="";if(o%2==0)for(var s=0;s<=o-1;s+=2)i=(i+=t[s+1])+t[s];else{for(var c=0;c<o-1;c+=2)i=(i+=t[c+1])+t[c];i+=t[o-1]}this._plugin.onToken(i)}}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._plugin&&(this._plugin.reset(),this._plugin=null),this._filterConfigMap.clear(),this._startIndex=0,this._version=0,this._canIUseLexicon=!1,this._isFetching=!1,this._expiredTime=0}}]),bi),xd=(V(Ys,[{key:"_onCloudConfig",value:function(){var t=this,o=this._m.get(23).getCloudConfig("rtc_cmd");q(o)||((o=JSON.parse(o)).forEach(function(i){t._TRTCCommandList.includes(i)||t._TRTCCommandList.push(i)}),this._setTRTCCommandMap())}},{key:"_setTRTCCommandMap",value:function(){for(var t,o=0,i=this._TRTCCommandList.length;o<i;o++)t=this._TRTCCommandList[o].split(".")[0],this._TRTCCommandMap.set(t,1)}},{key:"onRoomCustomDataReceived",value:function(t){this._m.getOEmitInst().emit(Me.ROOM_CUSTOM_DATA_RECEIVED,t)}},{key:"sendTRTCCustomData",value:function(i){var o=i.serviceCommand,i=i.data,s="".concat(se.NAME.TUIROOM_SVR,".*");return q(o)||(s=o),this._isValidServiceCommand(s)?this._trans({servcmd:s,data:i}):W({code:Q.INVALID_TRTC_CMD})}},{key:"_trans",value:function(i){E.d("".concat(this._n,"._trans. options:").concat(JSON.stringify(i)));var o=i.servcmd,i=i.data;return this._m.get(20).trans({servcmd:o,data:Ee(i)?JSON.parse(i):i})}},{key:"_isValidServiceCommand",value:function(t){return t.endsWith(".*")?this._TRTCCommandList.includes(t):(t=t.split(".")[0],this._TRTCCommandMap.has(t))}},{key:"isTRTCCommand",value:function(t){return t=t.split(".")[0],this._TRTCCommandMap.has(t)}},{key:"reset",value:function(){E.l("".concat(this._n,".reset"))}}]),Ys),qd=(V(Ni,[{key:"_init",value:function(){var t,o=this._getStorageModule().getItem(this.TIM_ERROR_ASSISTANCE,!1);if(o){try{t=JSON.parse(o)}catch(i){this._getStorageModule().removeItem(this.TIM_ERROR_ASSISTANCE,!1),E.w("".concat(this._n,"._init error:"),i)}t&&(this._needToUpdate(t)?this._fetch():this._fillMap(t.message))}else this._fetch()}},{key:"_needToUpdate",value:function(i){var o=i.localSavedTime,i=i.localSavedVersion,o=o&&new Date().getTime()-o>=this.STORAGE_EXPIRES_TIME,i=!i||i!=="3.5.2";return E.l("".concat(this._n,"._needToUpdate isTimeout:").concat(o," isDifferentVersion:").concat(i)),o||i}},{key:"_fetch",value:function(){var t,o,i,s,c,l;this._m.get(12).isPrivateNetWork()||(t="https://web.sdk.qcloud.com/im/download/error-message/v3/0.0.7/tim-error-message.txt",o="application/x-www-form-urlencoded;charset=UTF-8",i="".concat(this._n,"._fetch ok in"),s=this,qe?mt.request({url:t,method:"GET",timeout:3e3,header:{"content-type":o},dataType:"text",success:function(p){s._fillAndSave(p.data),E.l("".concat(i," mini program"))},fail:function(){}}):(c=new XMLHttpRequest,l=setTimeout(function(){c.abort()},3e3),c.onreadystatechange=function(){c.readyState===4&&(l&&clearTimeout(l),c.status!==200&&c.status!==304||(E.l("".concat(i," browser")),s._fillAndSave(c.responseText)))},c.open("GET",t,!0),c.setRequestHeader("Content-type",o),c.send()))}},{key:"_fillAndSave",value:function(t){this._fillMap(t),this._getStorageModule().setItem(this.TIM_ERROR_ASSISTANCE,JSON.stringify({message:t,localSavedTime:new Date().getTime(),localSavedVersion:"3.5.2"}),!0,!1)}},{key:"_getStorageModule",value:function(){return this._m.get(13)}},{key:"_fillMap",value:function(t){this._map.clear();for(var o,i,s=t.split(`;
`),c=s.length,l=new RegExp(/'/g),p=0;p<c;p++)if(i=s[p].indexOf(":"),o=s[p].slice(0,i),i=s[p].slice(i+1,s[p].length),!o.startsWith("//")){if(q(i))continue;this._map.set(o,i.replace(l,""))}}},{key:"get",value:function(i){var s=i.isIntl,c=i.key,o=i.replacement1,i=i.replacement2,s="".concat(c,s?"_en":"_cn"),c=(!this._map.has(s)&&this._map.has(c)&&(s=c),"");return this._map.has(s)&&(c=this._map.get(s),q(o)||(c=c.replace("$replacement1",o)),q(i)||(c=c.replace("$replacement2",i))),c}},{key:"reset",value:function(){E.l("".concat(this._n,".reset"))}}]),Ni),Vd=(V(Oi,[{key:"onNewMessageList",value:function(t){var o=this;t.forEach(function(i){var s=o.getPayloadData(i);s&&o._handleActionType(s,i)})}},{key:"onMessageModified",value:function(t){var o=this;t.forEach(function(i){var s=o.getPayloadData(i);s&&o._onInvitationModified(s,i)})}},{key:"getPayloadData",value:function(i){var o="".concat(this._n,".getPayloadData"),i=i.payload.data;try{return JSON.parse(i)}catch(s){return E.e("".concat(o," JSON parse error. signalingData:").concat(i)),null}}},{key:"_handleActionType",value:function(t,o){switch(t.actionType){case ze.ACTION_TYPE_INVITE:this._onNewInvitationReceived(t,o);break;case ze.ACTION_TYPE_REJECT_INVITE:this._onInviteeRejected(t);break;case ze.ACTION_TYPE_ACCEPT_INVITE:this._onInviteeAccepted(t);break;case ze.ACTION_TYPE_CANCEL_INVITE:this._onInvitationCancelled(t);break;case ze.ACTION_TYPE_INVITE_TIMEOUT:this._onInvitationTimeout(t)}}},{key:"_genBaseEmitData",value:function(t){return{inviteID:t.inviteID,inviter:t.inviter,groupID:t.groupID,data:t.data||""}}},{key:"_onNewInvitationReceived",value:function(t,o){var S="".concat(this._n,"._onNewInvitationReceived"),i=t.inviteID,s=t.inviteeList,c=t.groupID,l=t.inviter,p=this._sigM.getMyUserID(),m=s.includes(p),I=t.timeout,C=(lc().getTime()-1e3*o.time)/1e3,S=(0<I&&0<C&&C<I&&(I-=C),"".concat(S," myselfIncluded:").concat(m," groupID:").concat(c," signalObj:").concat(JSON.stringify(t)));E.l("".concat(S," timeout:").concat(I,"s delta:").concat(C,"s")),(c&&m||!c)&&((S=this._sigM.getInviteInfo(i))&&S===t||(S||this._sigM.setInviteInfo(i,v(v({},t),{},{message:o})),this._sigM.emitEvent(ze.NEW_INVITATION_RECEIVED,v(v({},this._genBaseEmitData(t)),{},{inviteeList:s})),l!==p&&this._sigM.startTimer(v(v({},t),{},{timeout:I}))))}},{key:"_onInviteeRejected",value:function(t){var o="".concat(this._n,"._onInviteeRejected"),i=t.inviteID,s=t.inviter,c=t.groupID,l=this._sigM.hasInviteInfo(i);E.l("".concat(o," inviteID:").concat(i," hasInviteID:").concat(l," inviter:").concat(s," groupID:").concat(c)),l&&(this._sigM.updateInviteInfo(t),this._sigM.emitEvent(ze.INVITEE_REJECTED,v(v({},this._genBaseEmitData(t)),{},{invitee:t.inviteeList[0]})))}},{key:"_onInviteeAccepted",value:function(t){var o="".concat(this._n,"._onInviteeAccepted"),i=t.inviteID,s=t.inviter,c=t.groupID,l=this._sigM.hasInviteInfo(i);E.l("".concat(o," inviteID:").concat(i," hasInviteID:").concat(l," inviter:").concat(s," groupID:").concat(c)),l&&(this._sigM.updateInviteInfo(t),this._sigM.emitEvent(ze.INVITEE_ACCEPTED,v(v({},this._genBaseEmitData(t)),{},{invitee:t.inviteeList[0]})))}},{key:"_onInvitationCancelled",value:function(t){var o="".concat(this._n,"._onInvitationCancelled"),i=t.inviteID,s=t.inviter,c=t.groupID,l=this._sigM.hasInviteInfo(i);E.l("".concat(o," inviteID:").concat(i," hasInviteID:").concat(l," inviter:").concat(s," groupID:").concat(c)),l&&(this._sigM.deleteInviteInfo(i),this._sigM.emitEvent(ze.INVITATION_CANCELLED,this._genBaseEmitData(t)))}},{key:"_onInvitationTimeout",value:function(t){var o="".concat(this._n,"._onInvitationTimeout"),i=t.inviteID,s=t.inviter,c=t.groupID,l=t.inviteeList,p=this._sigM.hasInviteInfo(i);E.l("".concat(o," inviteID:").concat(i," hasInviteID:").concat(p," inviter:").concat(s," groupID:").concat(c,"  data:").concat(t.data)),p&&(this._sigM.updateInviteInfo(t),this._sigM.emitEvent(ze.INVITATION_TIMEOUT,v(v({},this._genBaseEmitData(t)),{},{inviteeList:l,isSelfTimeout:!1})))}},{key:"_onInvitationModified",value:function(t,o){var i="".concat(this._n,"._onInvitationModified"),s=t.inviteID,c=t.data,l=this._sigM.hasInviteInfo(s);E.l("".concat(i," inviteID:").concat(s," hasInviteID:").concat(l," data:").concat(c)),l&&(this._sigM.setInviteInfo(s,v(v({},t),{},{message:o})),this._sigM.emitEvent(ze.INVITATION_MODIFIED,{inviteID:s,data:c}))}}]),Oi),io=(V(js,[{key:"generateInviteID",value:function(){var t,o=(o=al)((t=il)(32),8)+"-"+o(t(16),4)+"-"+o(16384|t(12),4)+"-"+o(32768|t(14),4)+"-"+o(t(48),12);return E.l("".concat(this._n,".generateInviteID inviteID:").concat(o)),o}},{key:"createInviteInfo",value:function(i){var o=this.generateInviteID(),i=this.createInviteCustomData(v(v({},i),{},{inviteID:o})),c=i.groupID,s=i.inviteeList,c=c||s[0];return{customData:i,message:this._sigM.createSignaling(i,c),inviteID:o}}},{key:"_genBaseCustomData",value:function(s){var o=s.data,i=s.inviteID,s=s.groupID;return{businessID:1,timeout:0,data:o===void 0?"":o,inviteID:i===void 0?"":i,groupID:s===void 0?"":s}}},{key:"createInviteCustomData",value:function(t){var o=t.userID,i=t.timeout,i=i===void 0?0:i,s=t.groupID,s=s===void 0?"":s,c=this._sigM.getMyUserID(),c=v(v({},this._genBaseCustomData(t)),{},{actionType:ze.ACTION_TYPE_INVITE,inviter:c,inviteeList:s?t.inviteeList:[o],timeout:i});return E.l("".concat(this._n,".createInviteCustomData customData:"),c),c}},{key:"createCancelCustomData",value:function(t){var o,i="".concat(this._n,".createCancelCustomData"),p=t.inviteID,s=this._sigM.getMyUserID(),p=this._sigM.getInviteInfo(p),c=p.inviteeList,l=p.groupID,p=p.inviter;return p===s?o=v(v({},this._genBaseCustomData(t)),{},{actionType:ze.ACTION_TYPE_CANCEL_INVITE,groupID:l,inviter:s,inviteeList:c}):E.e("".concat(i," unmatched inviter:").concat(p," and my userID:").concat(s)),E.l("".concat(i," customData:"),o),o}},{key:"createAcceptCustomData",value:function(t){var o,i="".concat(this._n,".createAcceptCustomData"),s=t.inviteID,c=this._sigM.getMyUserID(),l=this._sigM.getInviteInfo(s),p=l.inviter,m=l.groupID;return l.inviteeList.includes(c)?o=v(v({},this._genBaseCustomData(t)),{},{actionType:ze.ACTION_TYPE_ACCEPT_INVITE,groupID:m,inviter:p,inviteeList:[c]}):E.e("".concat(i," userID:").concat(c," not in inviteeList. inviteID:").concat(s," groupID:").concat(m)),E.l("".concat(i," customData:"),o),o}},{key:"createRejectCustomData",value:function(t){var o,i="".concat(this._n,".createRejectCustomData"),s=t.inviteID,c=this._sigM.getMyUserID(),l=this._sigM.getInviteInfo(s),p=l.inviter,m=l.groupID;return l.inviteeList.includes(c)?o=v(v({},this._genBaseCustomData(t)),{},{actionType:ze.ACTION_TYPE_REJECT_INVITE,groupID:m,inviter:p,inviteeList:[c]}):E.e("".concat(i," userID:").concat(c," not in inviteeList. inviteID:").concat(s," groupID:").concat(m)),E.l("".concat(i," customData:"),o),o}},{key:"createTimeoutCustomData",value:function(p){var o="".concat(this._n,".createTimeoutCustomData"),i=p.inviteeList,s=p.inviter,c=p.isInviter,c=c!==void 0&&c,l=this._sigM.getMyUserID(),p=v(v({},this._genBaseCustomData(p)),{},{actionType:ze.ACTION_TYPE_INVITE_TIMEOUT,inviter:s,inviteeList:c?i:[l]});return E.l("".concat(o," customData:"),p),p}}]),js),Bd=(V(Ws,[{key:"setCloudConfig",value:function(){var t=0<arguments.length&&arguments[0]!==void 0?arguments[0]:20,o=1<arguments.length&&arguments[1]!==void 0?arguments[1]:300;this.COUNT=t,this.EXPIRED_TIME=o,E.l("".concat(this._n,".setCloudConfig count:").concat(t,", time:").concat(o))}},{key:"getHistorySignaling",value:function(){var t=this,o=this._sigM.get(11).getLocalConvList();Te(o)||(this._getC2CSignalingList(),o=this._getValidGroupConvList(o),this._getGroupSignalingList(o).then(function(i){t._handleSignalingList(i)}))}},{key:"_getC2CSignalingList",value:function(){var t=this._sigM.get(6).getMessageListFromUnreadDB(),t=this._sigM.filterMessageList(t);this._getRelatedToMeMap(t)}},{key:"_getGroupSignalingList",value:function(i){var o=this,i=this._createPromiseList(i);return i.length===0?Promise.resolve(this._sortSignaling(this._relatedToMeMap)):this._concurrentGetMessageList(i).then(function(s){var c=new Map;return s.forEach(function(l){l=l.list,l=o._getRelatedToMeMap(l),c=new Map([].concat(re(c),re(l)))}),o._sortSignaling(c)})}},{key:"_handleSignalingList",value:function(t){Te(t)||this._sigM.onNewMessageList(t)}},{key:"_getValidGroupConvList",value:function(t){for(var o=[],i=0,s=t.length;i<s;i++){var p=t[i],l=p.type,c=p.unreadCount,p=p.lastMessage,l=l===O.CONV_GROUP,p=this._isNotExpired(p);l&&c&&p&&o.push(t[i])}return o}},{key:"_isNotExpired",value:function(t){return!(!t||!t.lastTime)&&t.lastTime>zi()-this.EXPIRED_TIME}},{key:"_createPromiseList",value:function(t){for(var o=[],i=0;i<t.length;i++){var c=t[i],s=c.conversationID,c=c.unreadCount,c=c<this.COUNT?c:this.COUNT,c=(this._map.set(s,{msgCount:c,list:[]}),this._sigM.get(11).getMessageList({conversationID:s}));o.push(c)}return o}},{key:"_concurrentGetMessageList",value:function(t){var o=this,i=[];return Promise.all(t).then(function(s){for(var c=0;c<s.length;c++){var p=s[c],l=p.code,p=p.data;l===0&&p.messageList.length!==0&&(o._handleMessageList(p.messageList),(l=o._relayGetMessageList(p))&&i.push(l))}return 0<i.length?o._concurrentGetMessageList(i):o._map})}},{key:"_relayGetMessageList",value:function(i){var s=i.messageList,o=i.nextReqMessageID,i=i.isCompleted;if(s.length===0)return null;var s=s[0].conversationID,c=this._map.get(s).msgCount;return c===0||i?null:this._sigM.get(11).getMessageList({conversationID:s,nextReqMessageID:o,count:c})}},{key:"_handleMessageList",value:function(t){var o=t.length,i=t[0].conversationID,c=this._map.get(i),s=c.msgCount,c=c.list;this._map.set(i,{msgCount:0<s-o?s-o:0,list:c.concat(this._sigM.filterMessageList(t))})}},{key:"_getRelatedToMeMap",value:function(t){for(var o=0;o<t.length;o++){var i=t[o];this._saveRelatedToMe(i)}return this._relatedToMeMap}},{key:"_saveRelatedToMe",value:function(t){var i=this._sigM.getPayloadData(t)||{},o=i.actionType,i=i.inviteID,s=i===void 0?"":i;switch(o===void 0?"":o){case ze.ACTION_TYPE_INVITE:this._setHistoryInvite(t);break;case ze.ACTION_TYPE_REJECT_INVITE:case ze.ACTION_TYPE_ACCEPT_INVITE:this._updateHistoryInvite(t);break;case ze.ACTION_TYPE_CANCEL_INVITE:this._delHistoryInvite(s);break;case ze.ACTION_TYPE_INVITE_TIMEOUT:this._updateHistoryInvite(t)}}},{key:"_setHistoryInvite",value:function(t){var o=this._sigM.getPayloadData(t)||{},i=o.inviteID,i=i===void 0?"":i,s=o.inviteeList,s=s===void 0?[]:s,c=o.timeout,c=c===void 0?0:c,l=this._sigM.getMyUserID();s.includes(l)&&(s=zi()-t.time,0<c&&c<s&&c!==0||this._relatedToMeMap.set(i,v(v({},o),{},{messageList:[t]})))}},{key:"_delHistoryInvite",value:function(t){this._relatedToMeMap.has(t)&&this._relatedToMeMap.delete(t)}},{key:"_updateHistoryInvite",value:function(t){var i=this._sigM.getPayloadData(t)||{},o=i.inviteID,o=o===void 0?"":o,i=i.inviteeList,s=i===void 0?[]:i;if(this._relatedToMeMap.has(o)){for(var i=this._relatedToMeMap.get(o),c=i.inviteeList,i=i.messageList,l=0;l<s.length;l++){var p=s[l];c.includes(p)&&c.splice(c.indexOf(p),1)}c.length===0?this._delHistoryInvite(o):i.push(t)}else this._delHistoryInvite(o)}},{key:"_sortSignaling",value:function(t){var o=[];return t.forEach(function(i){o=[].concat(re(o),re(i.messageList))}),o.sort(function(i,s){return i.time-s.time})}},{key:"reset",value:function(){this._map.clear(),this._relatedToMeMap.clear()}}]),Ws),tn=V(function t(o,i){N(this,t),this.businessID=o.businessID||1,this.inviteID=o.inviteID,this.groupID=o.groupID||"",this.inviter=o.inviter||"",this.inviteeList=o.inviteeList||[],this.data=o.data||"",this.actionType=o.actionType||ze.ACTION_TYPE_INVITE,this.timeout=o.timeout||0}),Hs=["message"],Ks=["message"],au=(z(Jo,Ht),eu=J(Jo),V(Jo,[{key:"onC2CUnreadHandleCompleted",value:function(){this._isC2CUnreadHandleCompleted=!0,this._isCloudConfigCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onConvSyncCompleted",value:function(){this._isConvSyncCompleted=!0,this._isC2CUnreadHandleCompleted&&this._isCloudConfigCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"onCloudConfig",value:function(){this._isCloudConfigCompleted=!0;var t=this.getCloudConfig("history_s_count"),o=this.getCloudConfig("history_s_time");q(t)||(t=Number(t)),q(o)||(o=Number(o)),this._historySignalingHandler.setCloudConfig(t,o),this._isC2CUnreadHandleCompleted&&this._isConvSyncCompleted&&!this._isSyncCompleted&&this.onReady()}},{key:"_isListenerExisted",value:function(){return-1<this._m.getOEmitInst().eventNames().indexOf(ze.NEW_INVITATION_RECEIVED)}},{key:"onReady",value:function(){this._isSyncCompleted=!0;var t=this._isListenerExisted();E.l("".concat(this._n,".onReady. isListenerExisted: ").concat(t)),t&&this._historySignalingHandler.getHistorySignaling()}},{key:"onNewMessageList",value:function(t){if(t=this.filterMessageList(t),0<t.length)return this._remoteSignalingHandler.onNewMessageList(t)}},{key:"onMessageModified",value:function(t){if(t=this.filterMessageList(t),0<t.length)return this._remoteSignalingHandler.onMessageModified(t)}},{key:"hasInviteInfo",value:function(t){return this._inviteInfoMap.has(t)}},{key:"getInviteInfo",value:function(t){return this._inviteInfoMap.get(t)}},{key:"setInviteInfo",value:function(t,s){var i=s.message,s=ae(s,Hs);E.l("".concat(this._n,".setInviteInfo inviteID:").concat(t," data:"),s),this._inviteInfoMap.set(t,v(v({},s),{},{message:i}))}},{key:"deleteInviteInfo",value:function(t){this.hasInviteInfo(t)&&(E.l("".concat(this._n,".deleteInviteInfo inviteID:").concat(t,".")),this._inviteInfoMap.delete(t))}},{key:"updateInviteInfo",value:function(l){var o="".concat(this._n,".updateInviteInfo"),i=l.inviteID,s=l.inviter,c=l.inviteeList,l=l.groupID;E.l("".concat(o," inviteID:").concat(i," inviter:").concat(s," groupID:").concat(l)),l&&this.hasInviteInfo(i)?(s=c[0],(l=this.getInviteInfo(i).inviteeList).includes(s)&&(l.splice(l.indexOf(s),1),E.l("".concat(o," remove ").concat(s,". localInviteeList.length:").concat(l.length))),l.length===0&&this.deleteInviteInfo(i)):this.deleteInviteInfo(i)}},{key:"canIUseSignaling",value:function(){return this._canIUseSignaling}},{key:"emitEvent",value:function(t,o){this.emitOEvt(t,o)}},{key:"addSignalingListener",value:function(t,o,i){this._canIUseSignaling||(this._canIUseSignaling=!0),this._m.getOEmitInst().on(t,o,i)}},{key:"removeSignalingListener",value:function(t,o,i){this._m.getOEmitInst().off(t,o,i),this._isListenerExisted()||(this._canIUseSignaling=!1)}},{key:"invite",value:function(t){var o=this,i="".concat(this._n,".").concat("invite"),s=this._localSignalingHandler.createInviteInfo(t),c=s.message,l=s.customData,p=s.inviteID;return E.l("".concat(i," options:").concat(JSON.stringify(t)," inviteID:").concat(p)),this.sendSignaling(c,t).then(function(m){return m&&m.code===0?(o.setInviteInfo(p,v(v({},l),{},{message:c})),o.startTimer(v(v({},l),{},{inviteID:p})),v(v({},m),{},{inviteID:p})):m}).catch(function(m){return W(m)})}},{key:"inviteSync",value:function(t,o,i){var s=this,c="".concat(this._n,".").concat("inviteSync"),l=this._localSignalingHandler.createInviteInfo(t),p=l.message,m=l.customData,I=l.inviteID;return E.l("".concat(c," options:").concat(JSON.stringify(t)," inviteID:").concat(I)),this.sendSignaling(p,t).then(function(C){if(C&&C.code===0)return s.setInviteInfo(I,v(v({},m),{},{message:p})),s.startTimer(v(v({},m),{},{inviteID:I})),o&&o({inviteID:I}),{inviteID:I};i&&i(C.code===0,C.message||"")}).catch(function(C){return i&&i(C.code,C.message),W(C)}),I}},{key:"_handleImResponse",value:function(t,o,i){o&&o.code===0&&(this._isHandling=!1,i?this.deleteInviteInfo(t.inviteID):this.updateInviteInfo(t))}},{key:"cancel",value:function(t){var o=this,s="".concat(this._n,".").concat("cancel");if(E.l("".concat(s," options:").concat(JSON.stringify(t))),!this.hasInviteInfo(t.inviteID)||this._isHandling)return W({code:Q.INVALID_CANCEL_MESSAGE});this._isHandling=!0;var i=this._localSignalingHandler.createCancelCustomData(t);if(!i)return this._isHandling=!1,W({code:Q.SIGNALING_NO_PERMISSION});var s=i.groupID,c=i.inviteeList,s=s||c[0],c=this.createSignaling(i,s);return this.sendSignaling(c,t).then(function(l){return o._handleImResponse(i,l,!0),l.code===0?v(v({},l),{},{inviteID:t.inviteID}):l}).catch(function(l){return W(l)})}},{key:"accept",value:function(t){var o=this,i="".concat(this._n,".").concat("accept");if(E.l("".concat(i," options:").concat(JSON.stringify(t))),!this.hasInviteInfo(t.inviteID)||this._isHandling)return W({code:Q.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var s=this._localSignalingHandler.createAcceptCustomData(t);return s?(i=this.createSignaling(s),this.sendSignaling(i,t).then(function(c){return o._handleImResponse(s,c),c.code===0?v(v({},c),{},{inviteID:t.inviteID}):c}).catch(function(c){return W(c)})):(this._isHandling=!1,W({code:Q.SIGNALING_NO_PERMISSION}))}},{key:"reject",value:function(t){var o=this,i="".concat(this._n,".").concat("reject");if(E.l("".concat(i," options:").concat(JSON.stringify(t))),!this.hasInviteInfo(t.inviteID)||this._isHandling)return W({code:Q.SIGNALING_INVALID_INVITE_ID});this._isHandling=!0;var s=this._localSignalingHandler.createRejectCustomData(t);return s?(i=this.createSignaling(s),this.sendSignaling(i,t).then(function(c){return o._handleImResponse(s,c,!0),c.code===0?v(v({},c),{},{inviteID:t.inviteID}):c}).catch(function(c){return W(c)})):(this._isHandling=!1,W({code:Q.SIGNALING_NO_PERMISSION}))}},{key:"getSignalingInfo",value:function(m){var o="".concat(this._n,".getSignalingInfo"),i=m.ID,s=m.from,c=m.to,l=this._filterSignaling(m),p=null,m=(l&&(m=this.getPayloadData(m),p=new tn(m)),l?"actionType:".concat(p.actionType):"");return E.l("".concat(o," messageID:").concat(i," from:").concat(s," to:").concat(c," ")+"".concat(m," isSignaling:").concat(l)),p}},{key:"modifyInvitation",value:function(s){var o=this,i=s.inviteID,s=s.data;if(!this.hasInviteInfo(i))return W({code:Q.SIGNALING_INVALID_INVITE_ID});var c=this.getInviteInfo(i),l=c.message,p=ae(c,Ks),m=l.payload.data;return p.data=s,l.payload.data=JSON.stringify(p),this.get(2).modifyRemoteMessage(l).then(function(I){return o.hasInviteInfo(i)&&o.setInviteInfo(i,v(v({},p),{},{message:l})),I}).catch(function(I){return l.payload.data=m,W(I)})}},{key:"_genMsgCtrlInfo",value:function(){var s=0<arguments.length&&arguments[0]!==void 0?arguments[0]:{},t=s.data,t=t===void 0?"":t,o=s.onlineUserOnly,l=s.inviteID,l=l===void 0?"":l,i=s.offlinePushInfo,s=s.actionType,c={_onlineOnlyFlag:!1},l={onlineUserOnly:(c=l&&this.getInviteInfo(l)?this.getInviteInfo(l).message:c)._onlineOnlyFlag||o||!1,offlinePushInfo:i,messageControlInfo:{excludedFromContentModeration:!0,excludedFromUnreadCount:!1,excludedFromLastMessage:!1}};return s===ze.ACTION_TYPE_INVITE_TIMEOUT?(c=!!t.match(/excludeTimeoutSignalingFromHistoryMessage/),l.messageControlInfo.excludedFromUnreadCount=c,l.messageControlInfo.excludedFromLastMessage=c,l):(o=!!t.match(/excludeFromHistoryMessage/),i=!!t.match(/excludeOriginalSignalingFromHistoryMessage/),l.messageControlInfo.excludedFromUnreadCount=o||i,l.messageControlInfo.excludedFromLastMessage=o||i,l)}},{key:"sendSignaling",value:function(t,o){var i=this;return this.get(2).sendMessageInstance(t,this._genMsgCtrlInfo(o)).catch(function(s){return i._isHandling=!1,W(s)})}},{key:"filterMessageList",value:function(t){var o=this;return t.filter(function(i){return o._filterSignaling(i)})}},{key:"getPayloadData",value:function(t){return this._remoteSignalingHandler.getPayloadData(t)}},{key:"createSignaling",value:function(t,s){var i=t.groupID,c=t.inviter,s={to:s||i||c,conversationType:i?O.CONV_GROUP:O.CONV_C2C,priority:O.MSG_PRIORITY_HIGH,payload:{data:JSON.stringify(t)}},c=this.get(2).createCustomMessage(s);return E.l("".concat(this._n,".createSignaling. message:"),c),c}},{key:"_filterSignaling",value:function(t){var o,i,s=!1;return t.type&&t.type===O.MSG_CUSTOM&&(o=t.cloudCustomData,t=(t=t.payload.data)===void 0?"":t,o=(o===void 0?"":o).match(/"type":"tsignaling"/),i=t.match(/inviteID/),t=t.match(/actionType/),s=o||i&&t),!!s}},{key:"startTimer",value:function(t){var o,i,s,c=this,l="".concat(this._n,".startTimer"),p=t.timeout,m=t.inviteID,I=t.inviter,C=t.groupID,S=I===this.getMyUserID();E.l("".concat(l," timeout:").concat(p," isInviter:").concat(S," groupID:").concat(C)),p<=0||(o=S?p+5:p,i=1,s=setInterval(function(){var k=c._hasLocalInviteInfo(t,S);i<o&&k?++i:(k&&c._sendTimeoutNotice(m,S),E.l("".concat(l," end.")),clearInterval(s))},1e3))}},{key:"_hasLocalInviteInfo",value:function(s,o){var i=s.inviteID,s=s.groupID;if(!this.hasInviteInfo(i))return!1;var c="".concat(this._n,"._hasLocalInviteInfo"),l=this.getInviteInfo(i).inviteeList;return E.l("".concat(c," inviteID:").concat(i," inviteeList:").concat(l," groupID:").concat(s)),!s||(o?0<l.length:0<l.length&&l.includes(this.getMyUserID()))}},{key:"_getReceiver",value:function(t,c){var i=c.groupID,s=c.inviteeList,c=c.inviter;return t?i||s[0]:i||c}},{key:"_sendTimeoutNotice",value:function(t,o){var i=this,s=this.getInviteInfo(t),c=this._getReceiver(o,s),l=(E.l("".concat(this._n,"._sendTimeoutNotice inviteID:").concat(t," to:").concat(c," isInviter:").concat(o)),this._localSignalingHandler.createTimeoutCustomData(v(v({},s),{},{isInviter:o}))),p=this.createSignaling(l,c);return this.sendSignaling(p,l).then(function(m){var I,C,S;m&&m.code===0&&(m=l.data,I=l.groupID,C=l.inviteeList,S=l.inviter,i.emitEvent(ze.INVITATION_TIMEOUT,{data:m,groupID:I,inviteID:t,inviteeList:C,inviter:S,isSelfTimeout:!0,message:p}),o?i.deleteInviteInfo(t):i.updateInviteInfo(l))})}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._inviteInfoMap.clear(),this._canIUseSignaling=!1,this._isHandling=!1,this._historySignalingHandler.reset(),this._isC2CUnreadHandleCompleted=!1,this._isConvSyncCompleted=!1,this._isSyncCompleted=!1,this._isCloudConfigCompleted=!1}}]),Jo),su=["followDiffList"],ru=["from"],eo={NONE:0,FOLLOWERS:1,FOLLOWING:2,MUTUAL:3},cu=(z(zo,Ht),Zc=J(zo),V(zo,[{key:"_onCloudConfig",value:function(){var t=this.getCloudConfig("follow_req_count");q(t)||(t=Number(t),this.DEFAULT_COUNT=t>this.MAX_COUNT?this.MAX_COUNT:t,this._clearFollowList())}},{key:"clearCacheOnReconnected",value:function(){this._clearFollowList()}},{key:"onFollowNotify",value:function(i){var o=this,i=i.dataList||[];E.l("".concat(this._n,".onFollowNotify followChangeList:").concat(i.length)),i.forEach(function(l){var c=l.followDiffList,c=c===void 0?[]:c,l=ae(l,su),p=l.from,m=ae(l,ru);c.forEach(function(S){var C=S.isAdd,S=S.followType,S=S===void 0?0:S,k=o._initFollowInfo();C===1?(m.userID=p,k[S].userInfoList.push(m),k[S].isAdd=!0):(k[S].userInfoList.push(p),k[S].isAdd=!1),o._emitEvent(k)})})}},{key:"_initFollowInfo",value:function(){var t={};return Object.values(eo).forEach(function(o){o!==eo.NONE&&(t[o]={userInfoList:[],isAdd:!1})}),t}},{key:"_emitEvent",value:function(t){var o=this;Object.keys(t).forEach(function(s){var s=Number(s),c=t[s];0<c.userInfoList.length&&(s===eo.FOLLOWERS&&(o._clearFollowList(eo.FOLLOWERS),o.emitOEvt(Me.MY_FOLLOWERS_LIST_UPDATED,c)),s===eo.FOLLOWING&&(o._clearFollowList(eo.FOLLOWING),o.emitOEvt(Me.MY_FOLLOWING_LIST_UPDATED,c)),s===eo.MUTUAL&&(o._clearFollowList(eo.MUTUAL),o.emitOEvt(Me.MUTUAL_FOLLOWERS_LIST_UPDATED,c)))})}},{key:"followUser",value:function(t){if(!this.canIUse(Ue.FOLLOW))return this.noUse("followUser");var o="".concat(this._n,".").concat("followUser"),i="userIDList:".concat(t.length),s=new ue("followUser");return s.setMessage(i),E.l("".concat(o," ").concat(i)),this.req({P:P.FOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:t.map(function(c){return{userID:c}})}}).then(function(c){return s.end(),E.l("".concat(o," ok.")),Ae(c.data.resultList)}).catch(function(c){return s.setError(c).end(),E.e("".concat(o," failed. error:"),c),W(c)})}},{key:"unfollowUser",value:function(t){if(!this.canIUse(Ue.FOLLOW))return this.noUse("unfollowUser");var o="".concat(this._n,".").concat("unfollowUser"),i="userIDList:".concat(t.length),s=new ue("unfollowUser");return s.setMessage(i),E.l("".concat(o," ").concat(i)),this.req({P:P.UNFOLLOW,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then(function(c){return s.end(),E.l("".concat(o," ok.")),Ae(c.data.resultList)}).catch(function(c){return s.setError(c).end(),E.e("".concat(o," failed. error:"),c),W(c)})}},{key:"getMyFollowersList",value:function(){var t=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",i="getMyFollowersList";if(!this.canIUse(Ue.FOLLOW))return this.noUse(i);var s=o||this.FIRST_PAGE_INDEX;if(this._myFollowersList.has(s)){var p=this._myFollowersList.get(s),c=p.resultList,l=p.nextCursor,p=p.lastUpdateTime;if(Date.now()-p<this.MAX_CATCH_TIME&&0<c.length)return E.l("".concat(this._n,".").concat(i," nextCursor:").concat(o," from local.")),we({resultList:c,nextCursor:l})}return this._getFollowList(o,eo.FOLLOWERS).then(function(m){return t._myFollowersList.set(s,v(v({},m),{},{lastUpdateTime:Date.now()})),E.l("".concat(t._n,".").concat(i," nextCursor:").concat(o," from remote.")),Ae(m)})}},{key:"getMyFollowingList",value:function(){var t=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",i="getMyFollowingList";if(!this.canIUse(Ue.FOLLOW))return this.noUse(i);var s=o||this.FIRST_PAGE_INDEX;if(this._myFollowingList.has(s)){var p=this._myFollowingList.get(s),c=p.resultList,l=p.nextCursor,p=p.lastUpdateTime;if(Date.now()-p<this.MAX_CATCH_TIME&&0<c.length)return E.l("".concat(this._n,".").concat(i," nextCursor:").concat(o," from local.")),we({resultList:c,nextCursor:l})}return this._getFollowList(o,eo.FOLLOWING).then(function(m){return t._myFollowingList.set(s,v(v({},m),{},{lastUpdateTime:Date.now()})),E.l("".concat(t._n,".").concat(i," nextCursor:").concat(o," from remote.")),Ae(m)})}},{key:"getMutualFollowersList",value:function(){var t=this,o=0<arguments.length&&arguments[0]!==void 0?arguments[0]:"",i="getMutualFollowersList";if(!this.canIUse(Ue.FOLLOW))return this.noUse(i);var s=o||this.FIRST_PAGE_INDEX;if(this._myMutualFollowersList.has(s)){var p=this._myMutualFollowersList.get(s),c=p.resultList,l=p.nextCursor,p=p.lastUpdateTime;if(Date.now()-p<this.MAX_CATCH_TIME&&0<c.length)return E.l("".concat(this._n,".").concat(i," nextCursor:").concat(o," from local.")),we({resultList:c,nextCursor:l})}return this._getFollowList(o,eo.MUTUAL).then(function(m){return t._myMutualFollowersList.set(s,v(v({},m),{},{lastUpdateTime:Date.now()})),E.l("".concat(t._n,".").concat(i," nextCursor:").concat(o," from remote.")),Ae(m)})}},{key:"_getFollowList",value:function(t,o){var i=this,s=new ue("_getFollowList");return s.setMessage("nextCursor:".concat(t," type:").concat(o)),this.req({P:P.GET_FOLLOW,data:{fromAccount:this.getMyUserID(),count:this.DEFAULT_COUNT,nextCursor:t,type:o}}).then(function(p){s.end();var p=p.data,l=p.resultList,l=l===void 0?[]:l,p=p.nextCursor,p=p===void 0?"":p,m=[];return l.forEach(function(k){var C=k.userID,S=k.followTime,k=k.profileList;m.push(v({userID:C,followTime:S},i._handleProfileItem(k===void 0?[]:k)))}),{resultList:m,nextCursor:p}}).catch(function(c){return s.setError(c).end(),E.e("".concat(i._n,"._getFollowList failed. error:"),c),W(c)})}},{key:"_handleProfileItem",value:function(t){var o={};return t.forEach(function(i){switch(i.tag){case at.NICK:o.nick=i.value;break;case at.GENDER:o.gender=i.value;break;case at.BIRTHDAY:o.birthday=i.value;break;case at.LOCATION:o.location=i.value;break;case at.SELFSIGNATURE:o.selfSignature=i.value;break;case at.ALLOWTYPE:o.allowType=i.value;break;case at.LANGUAGE:o.language=i.value;break;case at.AVATAR:o.avatar=i.value;break;case at.MESSAGESETTINGS:o.messageSettings=i.value;break;case at.ADMINFORBIDTYPE:o.adminForbidType=i.value;break;case at.LEVEL:o.level=i.value;break;case at.ROLE:o.role=i.value;break;default:o[i.tag]=i.value}}),o}},{key:"getUserFollowInfo",value:function(c){if(!this.canIUse(Ue.FOLLOW))return this.noUse("getUserFollowInfo");var o=c,i=!1,s=(q(c)&&(o=[this.getMyUserID()],i=!0),"".concat(this._n,".").concat("getUserFollowInfo")),c="userIDList:".concat(o.length," isGetMyFollowInfo:").concat(i),l=new ue("getUserFollowInfo");return l.setMessage(c),E.l("".concat(s," ").concat(c)),this.req({P:P.GET_FOLLOW_INFO,data:{fromAccount:this.getMyUserID(),userIDList:o}}).then(function(m){l.end(),E.l("".concat(s," ok."));var m=m.data.followInfoList,I=[];return(m===void 0?[]:m).forEach(function(G){var S=G.followersCount,k=G.followingCount,G=G.mutualFollowersCount;I.push({followersCount:S,followingCount:k,mutualFollowersCount:G})}),Ae(I)}).catch(function(p){return l.setError(p).end(),E.e("".concat(s," failed. error:"),p),W(p)})}},{key:"checkFollowType",value:function(t){if(!this.canIUse(Ue.FOLLOW))return this.noUse("checkFollowType");100<t.length&&(t=t.slice(0,100),E.w("".concat(o," ").concat(ni(100))));var o="".concat(this._n,".").concat("checkFollowType"),i="userIDList length:".concat(t.length," "),s=new ue("checkFollowType");return s.setMessage(i),E.l("".concat(o," ").concat(i)),this.req({P:P.CHECK_FOLLOW_TYPE,data:{fromAccount:this.getMyUserID(),userIDList:t}}).then(function(l){s.end(),E.l("".concat(o," ok."));var l=l.data.resultList,p=[];return(l===void 0?[]:l).forEach(function(C){var I=C.userID,C=C.followType;p.push({userID:I,followType:C})}),Ae(p)}).catch(function(c){return s.setError(c).end(),E.e("".concat(o," failed. error:"),c),W(c)})}},{key:"_clearFollowList",value:function(t){if(q(t))return this._myFollowersList.clear(),this._myFollowingList.clear(),void this._myMutualFollowersList.clear();t!==eo.FOLLOWERS?t!==eo.FOLLOWING?t!==eo.MUTUAL||this._myMutualFollowersList.clear():this._myFollowingList.clear():this._myFollowersList.clear()}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._clearFollowList()}}]),zo),zt=Hu(function(t,o){var i=typeof Uint8Array!="undefined"&&typeof Uint16Array!="undefined"&&typeof Int32Array!="undefined";o.assign=function(l){for(var p,m,I=Array.prototype.slice.call(arguments,1);I.length;){var C=I.shift();if(C){if(w(C)!=="object")throw new TypeError(C+"must be non-object");for(var S in C)p=C,m=S,Object.prototype.hasOwnProperty.call(p,m)&&(l[S]=C[S])}}return l},o.shrinkBuf=function(l,p){return l.length===p?l:l.subarray?l.subarray(0,p):(l.length=p,l)};var s={arraySet:function(l,p,m,I,C){if(p.subarray&&l.subarray)l.set(p.subarray(m,m+I),C);else for(var S=0;S<I;S++)l[C+S]=p[m+S]},flattenChunks:function(l){for(var p,m,I,C=0,S=0,k=l.length;S<k;S++)C+=l[S].length;for(I=new Uint8Array(C),S=p=0,k=l.length;S<k;S++)m=l[S],I.set(m,p),p+=m.length;return I}},c={arraySet:function(l,p,m,I,C){for(var S=0;S<I;S++)l[C+S]=p[m+S]},flattenChunks:function(l){return[].concat.apply([],l)}};o.setTyped=function(l){l?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,s)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,c))},o.setTyped(i)});function zo(t){return N(this,zo),(t=Zc.call(this,t))._n="FollowModule",t._myFollowersList=new Map,t._myFollowingList=new Map,t._myMutualFollowersList=new Map,t.MAX_CATCH_TIME=6e5,t.FIRST_PAGE_INDEX=mc(),t.DEFAULT_COUNT=500,t.MAX_COUNT=1e3,t.getIEmitInst().on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function Jo(t){N(this,Jo),(t=eu.call(this,t))._n="SignalingModule",t._inviteInfoMap=new Map,t._canIUseSignaling=!1,t._isHandling=!1,t._remoteSignalingHandler=new Vd(te(t)),t._localSignalingHandler=new io(te(t)),t._historySignalingHandler=new Bd(te(t)),t._isC2CUnreadHandleCompleted=!1,t._isConvSyncCompleted=!1,t._isSyncCompleted=!1,t._isCloudConfigCompleted=!1;var o=t.getIEmitInst();return o.on(Yt.C2C_UNREAD_HANDLE_COMPLETED,t.onC2CUnreadHandleCompleted,te(t)),o.on(Yt.CONV_SYNC_COMPLETED,t.onConvSyncCompleted,te(t)),o.on(Yt.CLOUD_CONFIG,t.onCloudConfig,te(t)),t}function Ws(t){N(this,Ws),this._n="HistorySignalingHandler",this._sigM=t,this.COUNT=20,this.EXPIRED_TIME=300,this._map=new Map,this._relatedToMeMap=new Map}function js(t){N(this,js),this._n="LocalSignalingHandler",this._sigM=t}function Oi(t){N(this,Oi),this._n="RemoteSignalingHandler",this._sigM=t}function Ni(t){N(this,Ni),this._m=t,this._n="ErrMsgModule",this.TIM_ERROR_ASSISTANCE="tim_error_assistance",this.STORAGE_EXPIRES_TIME=6048e5,this._map=new Map,this._init()}function Ys(t){N(this,Ys),this._m=t,this._n="TransCmdModule",this._TRTCCommandList=["tui_room_svr.*","callkit_records_svr.*","room_engine_srv.*","room_engine_http_srv.*","room_engine_mic.*","live_engine_srv.*","live_engine_http_srv.*","live_engine_pk.*","trtc_ai_service.*","call_engine_srv.*"],this._TRTCCommandMap=new Map,this._setTRTCCommandMap(),this._m.getIEmitInst().on(Yt.CLOUD_CONFIG,this._onCloudConfig,this)}function bi(t){return N(this,bi),(t=tu.call(this,t))._n="ProfanityFilterModule",t._plugin=null,t._filterConfigMap=new Map,t._startIndex=0,t._version=0,t._canIUseLexicon=!1,t._isFetching=!1,t._expiredTime=0,t}function Pi(t){var o;return N(this,Pi),(o=nu.call(this,t))._m=t,o._n="TIMPushModule",o._pluginName="TIMPush",o._pushPlugin=void 0,o._androidPushConfig={},o._deviceToken="",o._businessID=0,o._iOSBusinessID=0,o._c2cUnreadCount=0,o._groupUnreadCount=0,o._isWebUniapp=0,o._deviceInfo={notificationStatus:0,deviceModel:"",systemVersion:"",pushVersion:"1.0.1",packageName:""},o}function Gi(t){var o;return N(this,Gi),(o=sl.call(this,t))._m=t,o._n="OfflinePushModule",o._offlinePushPlugin=void 0,o._androidPushConfig={huaweiPushBussinessId:"",xiaomiPushBussinessId:"",xiaomiPushAppId:"",xiaomiPushAppKey:"",meizuPushBussinessId:"",meizuPushAppId:"",meizuPushAppKey:"",vivoPushBussinessId:"",fcmPushBussinessId:"",oppoPushBussinessId:"",oppoPushAppKey:"",oppoPushAppSecret:"",honorPushBussinessId:""},o._deviceToken="",o._businessID=0,o._iosBusinessID=0,o._c2cUnreadCount=0,o._groupUnreadCount=0,o._isWebUniapp=0,o}function zs(t){N(this,zs),this._m=t,this._n="CommercialConfigModule",this._expiredTime=0,this._isFetching=!1,this._purchasedFeatureHandler=new Pd(this)}function Ui(t){N(this,Ui),this._commercialConfigM=t,this._n="PurchasedFeatureHandler",this._isCSPluginReported=!1,this._featureMap=new Map}function wi(t){return N(this,wi),(t=rl.call(this,t))._n="WorkerTimerModule",t._isWorkerEnabled=!0,t._workerTimer=null,t._timerID=-1,t._init(),t.getIEmitInst().on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function Fi(t){return N(this,Fi),(t=cl.call(this,t))._n="SnsModule",t._friendHandler=new Ad(te(t)),t._friendApplicationHandler=new kd(te(t)),t._friendGroupHandler=new Od(te(t)),t.getIEmitInst().on(Yt.A2KEY_AND_TINYID_UPDATED,t.onContextUpdated,te(t)),t}function Js(t){N(this,Js),this._snsM=t,this._n="FriendGroupHandler",this._map=new Map}function $s(t){N(this,$s),Te(t)||(this.name=t.name||"",this.userIDList=t.userIDList||[],this.count=this.userIDList.length||0)}function xi(t){N(this,xi),this._snsM=t,this._n="FriendHandler",this._map=new Map,this._startIdx=0,this._standardSeq=0,this._customSeq=0,this._expirationTime=18e4}function qi(t,o){N(this,qi),this.userID=t,this.remark="",this.groupList=[],this.source="",this.addTime=0,this.friendCustomField=[],this.timestamp=0;var i={},s=[];if(i.userID=t,!Te(o))for(var c,l="",p=0,m=o.length;p<m;p++)if(l=o[p].tag,c=o[p].value,-1<l.indexOf("Tag_SNS_Custom"))this.friendCustomField.push({key:l,value:c});else if(-1<l.indexOf("Tag_Profile_Custom"))s.push({key:l,value:c});else switch(l){case at.NICK:i.nick=c;break;case at.GENDER:i.gender=c;break;case at.BIRTHDAY:i.birthday=c;break;case at.LOCATION:i.location=c;break;case at.SELFSIGNATURE:i.selfSignature=c;break;case at.ALLOWTYPE:i.allowType=c;break;case at.LANGUAGE:i.language=c;break;case at.AVATAR:i.avatar=c;break;case at.MESSAGESETTINGS:i.messageSettings=c;break;case at.ADMINFORBIDTYPE:i.adminForbidType=c;break;case at.LEVEL:i.level=c;break;case at.ROLE:i.role=c;break;case Je.REMARK:this.remark=c;break;case Je.ADDTIME:this.addTime=c;break;case Je.GROUP:this.groupList=JSON.parse(JSON.stringify(c));break;case Je.ADDSOURCE:this.source=c;break;case Je.ADDWORDING:break;default:E.l("snsProfileItem unknown tag->",o[p].tag)}this.profile=new us(v(v({},i),{},{profileCustomField:s}))}function Vi(t){N(this,Vi),this._snsM=t,this._n="FriendApplicationHandler",this._startTime=0,this._maxLimited=100,this._currentSeq=0,this._map=new Map,this._unreadCount=0}function Bi(t){N(this,Bi),(t=ul.call(this,t))._n="QualityStatModule",t.TAG="im-ssolog-quality-stat",t.reportIndex=0,t.wholePeriod=!1,t._qualityItems=[si,Ii,bo,na,oa,ri,oo,ce,Mi,Ci],t._messageSentItems=[bo,na,oa,ri,oo],t._messageReceivedItems=[ce,Mi,Ci],t.REPORT_INTERVAL=120,t.REPORT_SDKAPPID_BLACKLIST=[],t.REPORT_TINYID_WHITELIST=[],t._statInfoArr=[],t._avgRTT=new Ed,t._avgE2EDelay=new ou,t._rateMessageSent=new hl,t._rateMessageReceived=new Rd;var o=t.getIEmitInst();return o.on(Yt.A2KEY_AND_TINYID_UPDATED,t._onLoginSuccess,te(t)),o.on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}function go(){N(this,go),this._lastMap=new Map,this._currentMap=new Map}function Hi(){N(this,Hi),this._map=new Map}function uu(){N(this,uu),this._n="AvgRTT",this._requestCount=0,this._rttArray=[]}function lu(){N(this,lu),this._n="AvgE2EDelay",this._e2eDelayArray=[]}function Xs(t){return N(this,Xs),(t=ll.call(this,t))._n="RecoverMsgModule",t.PULL_LIMIT_COUNT=15,t}function Qs(t){return N(this,Qs),(t=dl.call(this,t))._n="CloudControlModule",t._cloudConfig=new Map,t._expiredTime=0,t._version=0,t._isFetching=!1,t}function Zs(t){return N(this,Zs),(t=pl.call(this,t))._n="SessionModule",t._platform=t.getPlatform(),t._pHandler=new Cd(te(t)),t._msgDispatcher=new Xc(te(t)),t._cmdFreqLimitMap=new Map,t._cmdReqInfoMap=new Map,t._serverOverloadInfoMap=new Map,t._incrementalPullContactFlag=!0,t._init(),t.getIEmitInst().on(Yt.CLOUD_CONFIG,t._onCloudConfig,te(t)),t}zt.assign,zt.shrinkBuf,zt.setTyped,zt.Buf8,zt.Buf16,zt.Buf32;function Vr(t,o,i,s){for(var c=65535&t|0,l=t>>>16&65535|0,p=0;i!==0;){for(i-=p=2e3<i?2e3:i;l=l+(c=c+o[s++]|0)|0,--p;);c%=65521,l%=65521}return c|l<<16|0}function Uo(t,o,i,s){var c=ml,l=s+i;t^=-1;for(var p=s;p<l;p++)t=t>>>8^c[255&(t^o[p])];return-1^t}function Ma(t,o,i,s,c,l,p,m){for(var I,C,S,k,G,U,Y,Z,$,De=m.bits,$e=0,_e=0,Pe=0,Ge=0,et=0,lt=0,We=0,_t=0,Jt=0,Pt=0,cn=null,Xo=0,Xt=new zt.Buf16(16),nn=new zt.Buf16(16),hn=null,ot=0,$e=0;$e<=15;$e++)Xt[$e]=0;for(_e=0;_e<s;_e++)Xt[o[i+_e]]++;for(et=De,Ge=15;1<=Ge&&Xt[Ge]===0;Ge--);if(Ge<et&&(et=Ge),Ge===0)return c[l++]=20971520,c[l++]=20971520,m.bits=1,0;for(Pe=1;Pe<Ge&&Xt[Pe]===0;Pe++);for(et<Pe&&(et=Pe),$e=_t=1;$e<=15;$e++)if((_t=(_t<<1)-Xt[$e])<0)return-1;if(0<_t&&(t===0||Ge!==1))return-1;for(nn[1]=0,$e=1;$e<15;$e++)nn[$e+1]=nn[$e]+Xt[$e];for(_e=0;_e<s;_e++)o[i+_e]!==0&&(p[nn[o[i+_e]]++]=_e);if(U=t===0?(cn=hn=p,19):t===1?(cn=vl,Xo-=257,hn=yl,ot-=257,256):(cn=du,hn=pu,-1),$e=Pe,G=l,We=_e=Pt=0,S=-1,k=(Jt=1<<(lt=et))-1,t===1&&852<Jt||t===2&&592<Jt)return 1;for(;;){for($=p[_e]<U?(Z=0,p[_e]):p[_e]>U?(Z=hn[ot+p[_e]],cn[Xo+p[_e]]):(Z=96,0),I=1<<(Y=$e-We),Pe=C=1<<lt;c[G+(Pt>>We)+(C-=I)]=Y<<24|Z<<16|$|0,C!==0;);for(I=1<<$e-1;Pt&I;)I>>=1;if(I!==0?Pt=(Pt&I-1)+I:Pt=0,_e++,--Xt[$e]==0){if($e===Ge)break;$e=o[i+p[_e]]}if(et<$e&&(Pt&k)!==S){for(G+=Pe,_t=1<<(lt=$e-(We=We===0?et:We));lt+We<Ge&&!((_t-=Xt[lt+We])<=0);)lt++,_t<<=1;if(Jt+=1<<lt,t===1&&852<Jt||t===2&&592<Jt)return 1;c[S=Pt&k]=et<<24|lt<<16|G-l|0}}return Pt!==0&&(c[G+Pt]=$e-We<<24|64<<16|0),m.bits=et,0}var ml=function(){for(var t=[],o=0;o<256;o++){for(var i=o,s=0;s<8;s++)i=1&i?3988292384^i>>>1:i>>>1;t[o]=i}return t}(),vl=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],yl=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],du=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],pu=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];function gu(t){return(t>>>24&255)+(t>>>8&65280)+((65280&t)<<8)+((255&t)<<24)}function Il(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new zt.Buf16(320),this.work=new zt.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function Ki(t){var o;return t&&t.state?(o=t.state,t.total_in=t.total_out=o.total=0,t.msg="",o.wrap&&(t.adler=1&o.wrap),o.mode=1,o.last=0,o.havedict=0,o.dmax=32768,o.head=null,o.hold=0,o.bits=0,o.lencode=o.lendyn=new zt.Buf32(852),o.distcode=o.distdyn=new zt.Buf32(592),o.sane=1,o.back=-1,0):-2}function hu(t){var o;return t&&t.state?((o=t.state).wsize=0,o.whave=0,o.wnext=0,Ki(t)):-2}function _u(t,o){var i,s;return t&&t.state?(s=t.state,o<0?(i=0,o=-o):(i=1+(o>>4),o<48&&(o&=15)),o&&(o<8||15<o)?-2:(s.window!==null&&s.wbits!==o&&(s.window=null),s.wrap=i,s.wbits=o,hu(t))):-2}function Ca(t,o){var i;return t?(i=new Il,(t.state=i).window=null,(i=_u(t,o))!==0&&(t.state=null),i):-2}var wo,fu,Ml=!0;function Cl(l,o,i,s){var c,l=l.state;return l.window===null&&(l.wsize=1<<l.wbits,l.wnext=0,l.whave=0,l.window=new zt.Buf8(l.wsize)),s>=l.wsize?(zt.arraySet(l.window,o,i-l.wsize,l.wsize,0),l.wnext=0,l.whave=l.wsize):((c=l.wsize-l.wnext)>s&&(c=s),zt.arraySet(l.window,o,i-s,c,l.wnext),(s-=c)?(zt.arraySet(l.window,o,i-s,s,0),l.wnext=s,l.whave=l.wsize):(l.wnext+=c,l.wnext===l.wsize&&(l.wnext=0),l.whave<l.wsize&&(l.whave+=c))),0}var pn={inflateReset:hu,inflateReset2:_u,inflateResetKeep:Ki,inflateInit:function(t){return Ca(t,15)},inflateInit2:Ca,inflate:function(t,o){var i,s,c,l,p,m,I,C,S,k,G,U,Y,Z,$,De,_e,Pe,Ge,et,lt,We,_t,Jt,Pt=0,cn=new zt.Buf8(4),Xo=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!t||!t.state||!t.output||!t.input&&t.avail_in!==0)return-2;(i=t.state).mode===12&&(i.mode=13),p=t.next_out,c=t.output,I=t.avail_out,l=t.next_in,s=t.input,m=t.avail_in,C=i.hold,S=i.bits,k=m,G=I,We=0;e:for(;;)switch(i.mode){case 1:if(i.wrap===0){i.mode=13;break}for(;S<16;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(2&i.wrap&&C===35615){cn[i.check=0]=255&C,cn[1]=C>>>8&255,i.check=Uo(i.check,cn,2,0),S=C=0,i.mode=2;break}if(i.flags=0,i.head&&(i.head.done=!1),!(1&i.wrap)||(((255&C)<<8)+(C>>8))%31){t.msg="incorrect header check",i.mode=30;break}if((15&C)!=8){t.msg="unknown compression method",i.mode=30;break}if(S-=4,lt=8+(15&(C>>>=4)),i.wbits===0)i.wbits=lt;else if(lt>i.wbits){t.msg="invalid window size",i.mode=30;break}i.dmax=1<<lt,t.adler=i.check=1,i.mode=512&C?10:12,S=C=0;break;case 2:for(;S<16;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(i.flags=C,(255&i.flags)!=8){t.msg="unknown compression method",i.mode=30;break}if(57344&i.flags){t.msg="unknown header flags set",i.mode=30;break}i.head&&(i.head.text=C>>8&1),512&i.flags&&(cn[0]=255&C,cn[1]=C>>>8&255,i.check=Uo(i.check,cn,2,0)),S=C=0,i.mode=3;case 3:for(;S<32;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}i.head&&(i.head.time=C),512&i.flags&&(cn[0]=255&C,cn[1]=C>>>8&255,cn[2]=C>>>16&255,cn[3]=C>>>24&255,i.check=Uo(i.check,cn,4,0)),S=C=0,i.mode=4;case 4:for(;S<16;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}i.head&&(i.head.xflags=255&C,i.head.os=C>>8),512&i.flags&&(cn[0]=255&C,cn[1]=C>>>8&255,i.check=Uo(i.check,cn,2,0)),S=C=0,i.mode=5;case 5:if(1024&i.flags){for(;S<16;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}i.length=C,i.head&&(i.head.extra_len=C),512&i.flags&&(cn[0]=255&C,cn[1]=C>>>8&255,i.check=Uo(i.check,cn,2,0)),S=C=0}else i.head&&(i.head.extra=null);i.mode=6;case 6:if(1024&i.flags&&((U=(U=i.length)>m?m:U)&&(i.head&&(lt=i.head.extra_len-i.length,i.head.extra||(i.head.extra=new Array(i.head.extra_len)),zt.arraySet(i.head.extra,s,l,U,lt)),512&i.flags&&(i.check=Uo(i.check,s,U,l)),m-=U,l+=U,i.length-=U),i.length))break e;i.length=0,i.mode=7;case 7:if(2048&i.flags){if(m===0)break e;for(U=0;lt=s[l+U++],i.head&&lt&&i.length<65536&&(i.head.name+=String.fromCharCode(lt)),lt&&U<m;);if(512&i.flags&&(i.check=Uo(i.check,s,U,l)),m-=U,l+=U,lt)break e}else i.head&&(i.head.name=null);i.length=0,i.mode=8;case 8:if(4096&i.flags){if(m===0)break e;for(U=0;lt=s[l+U++],i.head&&lt&&i.length<65536&&(i.head.comment+=String.fromCharCode(lt)),lt&&U<m;);if(512&i.flags&&(i.check=Uo(i.check,s,U,l)),m-=U,l+=U,lt)break e}else i.head&&(i.head.comment=null);i.mode=9;case 9:if(512&i.flags){for(;S<16;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(C!==(65535&i.check)){t.msg="header crc mismatch",i.mode=30;break}S=C=0}i.head&&(i.head.hcrc=i.flags>>9&1,i.head.done=!0),t.adler=i.check=0,i.mode=12;break;case 10:for(;S<32;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}t.adler=i.check=gu(C),S=C=0,i.mode=11;case 11:if(i.havedict===0)return t.next_out=p,t.avail_out=I,t.next_in=l,t.avail_in=m,i.hold=C,i.bits=S,2;t.adler=i.check=1,i.mode=12;case 12:if(o===5||o===6)break e;case 13:if(i.last){C>>>=7&S,S-=7&S,i.mode=27;break}for(;S<3;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}switch(i.last=1&C,--S,3&(C>>>=1)){case 0:i.mode=14;break;case 1:Xt=nn=void 0;var Xt,nn=i;if(Ml){for(wo=new zt.Buf32(512),fu=new zt.Buf32(32),Xt=0;Xt<144;)nn.lens[Xt++]=8;for(;Xt<256;)nn.lens[Xt++]=9;for(;Xt<280;)nn.lens[Xt++]=7;for(;Xt<288;)nn.lens[Xt++]=8;for(Ma(1,nn.lens,0,288,wo,0,nn.work,{bits:9}),Xt=0;Xt<32;)nn.lens[Xt++]=5;Ma(2,nn.lens,0,32,fu,0,nn.work,{bits:5}),Ml=!1}if(nn.lencode=wo,nn.lenbits=9,nn.distcode=fu,nn.distbits=5,i.mode=20,o!==6)break;C>>>=2,S-=2;break e;case 2:i.mode=17;break;case 3:t.msg="invalid block type",i.mode=30}C>>>=2,S-=2;break;case 14:for(C>>>=7&S,S-=7&S;S<32;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if((65535&C)!=(C>>>16^65535)){t.msg="invalid stored block lengths",i.mode=30;break}if(i.length=65535&C,S=C=0,i.mode=15,o===6)break e;case 15:i.mode=16;case 16:if(U=i.length){if((U=I<(U=m<U?m:U)?I:U)===0)break e;zt.arraySet(c,s,l,U,p),m-=U,l+=U,I-=U,p+=U,i.length-=U;break}i.mode=12;break;case 17:for(;S<14;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(i.nlen=257+(31&C),C>>>=5,S-=5,i.ndist=1+(31&C),C>>>=5,S-=5,i.ncode=4+(15&C),C>>>=4,S-=4,286<i.nlen||30<i.ndist){t.msg="too many length or distance symbols",i.mode=30;break}i.have=0,i.mode=18;case 18:for(;i.have<i.ncode;){for(;S<3;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}i.lens[Xo[i.have++]]=7&C,C>>>=3,S-=3}for(;i.have<19;)i.lens[Xo[i.have++]]=0;if(i.lencode=i.lendyn,i.lenbits=7,_t={bits:i.lenbits},We=Ma(0,i.lens,0,19,i.lencode,0,i.work,_t),i.lenbits=_t.bits,We){t.msg="invalid code lengths set",i.mode=30;break}i.have=0,i.mode=19;case 19:for(;i.have<i.nlen+i.ndist;){for(;De=(Pt=i.lencode[C&(1<<i.lenbits)-1])>>>16&255,_e=65535&Pt,!(($=Pt>>>24)<=S);){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(_e<16)C>>>=$,S-=$,i.lens[i.have++]=_e;else{if(_e===16){for(Jt=$+2;S<Jt;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(C>>>=$,S-=$,i.have===0){t.msg="invalid bit length repeat",i.mode=30;break}lt=i.lens[i.have-1],U=3+(3&C),C>>>=2,S-=2}else if(_e===17){for(Jt=$+3;S<Jt;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}lt=0,U=3+(7&(C>>>=$)),C>>>=3,S=S-$-3}else{for(Jt=$+7;S<Jt;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}lt=0,U=11+(127&(C>>>=$)),C>>>=7,S=S-$-7}if(i.have+U>i.nlen+i.ndist){t.msg="invalid bit length repeat",i.mode=30;break}for(;U--;)i.lens[i.have++]=lt}}if(i.mode===30)break;if(i.lens[256]===0){t.msg="invalid code -- missing end-of-block",i.mode=30;break}if(i.lenbits=9,_t={bits:i.lenbits},We=Ma(1,i.lens,0,i.nlen,i.lencode,0,i.work,_t),i.lenbits=_t.bits,We){t.msg="invalid literal/lengths set",i.mode=30;break}if(i.distbits=6,i.distcode=i.distdyn,_t={bits:i.distbits},We=Ma(2,i.lens,i.nlen,i.ndist,i.distcode,0,i.work,_t),i.distbits=_t.bits,We){t.msg="invalid distances set",i.mode=30;break}if(i.mode=20,o===6)break e;case 20:i.mode=21;case 21:if(6<=m&&258<=I){t.next_out=p,t.avail_out=I,t.next_in=l,t.avail_in=m,i.hold=C,i.bits=S,bn=Ta=So=_n=To=$e=ot=hn=Bp=Vp=Jd=zd=Rn=jn=Kr=Sa=qp=Yd=xp=Mu=Fp=fn=Iu=so=Wn=void 0;var hn,ot,$e,To,_n,So,$n=t,lh=G,Wn=$n.state,so=$n.next_in,Ta=$n.input,Iu=so+($n.avail_in-5),fn=$n.next_out,bn=$n.output,Fp=fn-(lh-$n.avail_out),Mu=fn+($n.avail_out-257),xp=Wn.dmax,Yd=Wn.wsize,qp=Wn.whave,Sa=Wn.wnext,Kr=Wn.window,jn=Wn.hold,Rn=Wn.bits,zd=Wn.lencode,Jd=Wn.distcode,Vp=(1<<Wn.lenbits)-1,Bp=(1<<Wn.distbits)-1;t:do for(Rn<15&&(jn+=Ta[so++]<<Rn,Rn+=8,jn+=Ta[so++]<<Rn,Rn+=8),hn=zd[jn&Vp];;){if(jn>>>=ot=hn>>>24,Rn-=ot,(ot=hn>>>16&255)==0)bn[fn++]=65535&hn;else{if(!(16&ot)){if(!(64&ot)){hn=zd[(65535&hn)+(jn&(1<<ot)-1)];continue}if(32&ot){Wn.mode=12;break t}$n.msg="invalid literal/length code",Wn.mode=30;break t}for($e=65535&hn,(ot&=15)&&(Rn<ot&&(jn+=Ta[so++]<<Rn,Rn+=8),$e+=jn&(1<<ot)-1,jn>>>=ot,Rn-=ot),Rn<15&&(jn+=Ta[so++]<<Rn,Rn+=8,jn+=Ta[so++]<<Rn,Rn+=8),hn=Jd[jn&Bp];;){if(jn>>>=ot=hn>>>24,Rn-=ot,!(16&(ot=hn>>>16&255))){if(!(64&ot)){hn=Jd[(65535&hn)+(jn&(1<<ot)-1)];continue}$n.msg="invalid distance code",Wn.mode=30;break t}if(To=65535&hn,Rn<(ot&=15)&&(jn+=Ta[so++]<<Rn,(Rn+=8)<ot&&(jn+=Ta[so++]<<Rn,Rn+=8)),(To+=jn&(1<<ot)-1)>xp){$n.msg="invalid distance too far back",Wn.mode=30;break t}if(jn>>>=ot,Rn-=ot,To>(ot=fn-Fp)){if((ot=To-ot)>qp&&Wn.sane){$n.msg="invalid distance too far back",Wn.mode=30;break t}if(So=Kr,(_n=0)===Sa){if(_n+=Yd-ot,ot<$e){for($e-=ot;bn[fn++]=Kr[_n++],--ot;);_n=fn-To,So=bn}}else if(Sa<ot){if(_n+=Yd+Sa-ot,(ot-=Sa)<$e){for($e-=ot;bn[fn++]=Kr[_n++],--ot;);if(_n=0,Sa<$e){for($e-=ot=Sa;bn[fn++]=Kr[_n++],--ot;);_n=fn-To,So=bn}}}else if(_n+=Sa-ot,ot<$e){for($e-=ot;bn[fn++]=Kr[_n++],--ot;);_n=fn-To,So=bn}for(;2<$e;)bn[fn++]=So[_n++],bn[fn++]=So[_n++],bn[fn++]=So[_n++],$e-=3;$e&&(bn[fn++]=So[_n++],1<$e&&(bn[fn++]=So[_n++]))}else{for(_n=fn-To;bn[fn++]=bn[_n++],bn[fn++]=bn[_n++],bn[fn++]=bn[_n++],2<($e-=3););$e&&(bn[fn++]=bn[_n++],1<$e&&(bn[fn++]=bn[_n++]))}break}}break}while(so<Iu&&fn<Mu);so-=$e=Rn>>3,jn&=(1<<(Rn-=$e<<3))-1,$n.next_in=so,$n.next_out=fn,$n.avail_in=so<Iu?Iu-so+5:5-(so-Iu),$n.avail_out=fn<Mu?Mu-fn+257:257-(fn-Mu),Wn.hold=jn,Wn.bits=Rn,p=t.next_out,c=t.output,I=t.avail_out,l=t.next_in,s=t.input,m=t.avail_in,C=i.hold,S=i.bits,i.mode===12&&(i.back=-1);break}for(i.back=0;De=(Pt=i.lencode[C&(1<<i.lenbits)-1])>>>16&255,_e=65535&Pt,!(($=Pt>>>24)<=S);){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(De&&!(240&De)){for(Pe=$,Ge=De,et=_e;De=(Pt=i.lencode[et+((C&(1<<Pe+Ge)-1)>>Pe)])>>>16&255,_e=65535&Pt,!(Pe+($=Pt>>>24)<=S);){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}C>>>=Pe,S-=Pe,i.back+=Pe}if(C>>>=$,S-=$,i.back+=$,i.length=_e,De===0){i.mode=26;break}if(32&De){i.back=-1,i.mode=12;break}if(64&De){t.msg="invalid literal/length code",i.mode=30;break}i.extra=15&De,i.mode=22;case 22:if(i.extra){for(Jt=i.extra;S<Jt;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}i.length+=C&(1<<i.extra)-1,C>>>=i.extra,S-=i.extra,i.back+=i.extra}i.was=i.length,i.mode=23;case 23:for(;De=(Pt=i.distcode[C&(1<<i.distbits)-1])>>>16&255,_e=65535&Pt,!(($=Pt>>>24)<=S);){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(!(240&De)){for(Pe=$,Ge=De,et=_e;De=(Pt=i.distcode[et+((C&(1<<Pe+Ge)-1)>>Pe)])>>>16&255,_e=65535&Pt,!(Pe+($=Pt>>>24)<=S);){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}C>>>=Pe,S-=Pe,i.back+=Pe}if(C>>>=$,S-=$,i.back+=$,64&De){t.msg="invalid distance code",i.mode=30;break}i.offset=_e,i.extra=15&De,i.mode=24;case 24:if(i.extra){for(Jt=i.extra;S<Jt;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}i.offset+=C&(1<<i.extra)-1,C>>>=i.extra,S-=i.extra,i.back+=i.extra}if(i.offset>i.dmax){t.msg="invalid distance too far back",i.mode=30;break}i.mode=25;case 25:if(I===0)break e;if(i.offset>(U=G-I)){if((U=i.offset-U)>i.whave&&i.sane){t.msg="invalid distance too far back",i.mode=30;break}Y=U>i.wnext?(U-=i.wnext,i.wsize-U):i.wnext-U,U>i.length&&(U=i.length),Z=i.window}else Z=c,Y=p-i.offset,U=i.length;for(I-=U=I<U?I:U,i.length-=U;c[p++]=Z[Y++],--U;);i.length===0&&(i.mode=21);break;case 26:if(I===0)break e;c[p++]=i.length,I--,i.mode=21;break;case 27:if(i.wrap){for(;S<32;){if(m===0)break e;m--,C|=s[l++]<<S,S+=8}if(G-=I,t.total_out+=G,i.total+=G,G&&(t.adler=i.check=(i.flags?Uo:Vr)(i.check,c,G,p-G)),G=I,(i.flags?C:gu(C))!==i.check){t.msg="incorrect data check",i.mode=30;break}S=C=0}i.mode=28;case 28:if(i.wrap&&i.flags){for(;S<32;){if(m===0)break e;m--,C+=s[l++]<<S,S+=8}if(C!==(4294967295&i.total)){t.msg="incorrect length check",i.mode=30;break}S=C=0}i.mode=29;case 29:We=1;break e;case 30:We=-3;break e;case 31:return-4;default:return-2}return t.next_out=p,t.avail_out=I,t.next_in=l,t.avail_in=m,i.hold=C,i.bits=S,(i.wsize||G!==t.avail_out&&i.mode<30&&(i.mode<27||o!==4))&&Cl(t,t.output,t.next_out,G-t.avail_out),k-=t.avail_in,G-=t.avail_out,t.total_in+=k,t.total_out+=G,i.total+=G,i.wrap&&G&&(t.adler=i.check=(i.flags?Uo:Vr)(i.check,c,G,t.next_out-G)),t.data_type=i.bits+(i.last?64:0)+(i.mode===12?128:0)+(i.mode===20||i.mode===15?256:0),We=(k==0&&G===0||o===4)&&We===0?-5:We},inflateEnd:function(t){if(!t||!t.state)return-2;var o=t.state;return o.window&&(o.window=null),t.state=null,0},inflateGetHeader:function(t,o){var i;return!t||!t.state||!(2&(i=t.state).wrap)?-2:((i.head=o).done=!1,0)},inflateSetDictionary:function(t,o){var i,s=o.length;return!t||!t.state||(i=t.state).wrap!==0&&i.mode!==11?-2:i.mode===11&&Vr(1,o,s,0)!==i.check?-3:Cl(t,o,s,s)?(i.mode=31,-4):(i.havedict=1,0)},inflateInfo:"pako inflate (from Nodeca project)"},Br=!0,mu=!0;try{String.fromCharCode.apply(null,[0])}catch(t){Br=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch(t){mu=!1}for(var Co=new zt.Buf8(256),Fo=0;Fo<256;Fo++)Co[Fo]=252<=Fo?6:248<=Fo?5:240<=Fo?4:224<=Fo?3:192<=Fo?2:1;Co[254]=Co[254]=1;function Hd(t,o){for(var i,s,c=o||t.length,l=new Array(2*c),p=0,m=0;m<c;)if((i=t[m++])<128)l[p++]=i;else if(4<(s=Co[i]))l[p++]=65533,m+=s-1;else{for(i&=s===2?31:s===3?15:7;1<s&&m<c;)i=i<<6|63&t[m++],s--;1<s?l[p++]=65533:i<65536?l[p++]=i:(i-=65536,l[p++]=55296|i>>10&1023,l[p++]=56320|1023&i)}var I=l,C=p;if(C<65534&&(I.subarray&&mu||!I.subarray&&Br))return String.fromCharCode.apply(null,zt.shrinkBuf(I,C));for(var S="",k=0;k<C;k++)S+=String.fromCharCode(I[k]);return S}function Kd(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}function Wd(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}var Nn={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8},vu={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"},Tl=Object.prototype.toString;function $o(i){if(!(this instanceof $o))return new $o(i);this.options=zt.assign({chunkSize:16384,windowBits:0,to:""},i||{});var o=this.options,i=(o.raw&&0<=o.windowBits&&o.windowBits<16&&(o.windowBits=-o.windowBits,o.windowBits===0&&(o.windowBits=-15)),!(0<=o.windowBits&&o.windowBits<16)||i&&i.windowBits||(o.windowBits+=32),15<o.windowBits&&o.windowBits<48&&!(15&o.windowBits)&&(o.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new Kd,this.strm.avail_out=0,pn.inflateInit2(this.strm,o.windowBits));if(i!==Nn.Z_OK)throw new Error(vu[i]);if(this.header=new Wd,pn.inflateGetHeader(this.strm,this.header),o.dictionary&&(typeof o.dictionary=="string"?o.dictionary=function(s){for(var c,l,p,m,I=s.length,C=0,S=0;S<I;S++)(64512&(l=s.charCodeAt(S)))==55296&&S+1<I&&(64512&(p=s.charCodeAt(S+1)))==56320&&(l=65536+(l-55296<<10)+(p-56320),S++),C+=l<128?1:l<2048?2:l<65536?3:4;for(c=new zt.Buf8(C),S=m=0;m<C;S++)(64512&(l=s.charCodeAt(S)))==55296&&S+1<I&&(64512&(p=s.charCodeAt(S+1)))==56320&&(l=65536+(l-55296<<10)+(p-56320),S++),l<128?c[m++]=l:(l<2048?c[m++]=192|l>>>6:(l<65536?c[m++]=224|l>>>12:(c[m++]=240|l>>>18,c[m++]=128|l>>>12&63),c[m++]=128|l>>>6&63),c[m++]=128|63&l);return c}(o.dictionary):Tl.call(o.dictionary)==="[object ArrayBuffer]"&&(o.dictionary=new Uint8Array(o.dictionary)),o.raw&&(i=pn.inflateSetDictionary(this.strm,o.dictionary))!==Nn.Z_OK))throw new Error(vu[i])}function er(t,o){if(o=new $o(o),o.push(t,!0),o.err)throw o.msg||vu[o.err];return o.result}$o.prototype.push=function(t,o){var i,s,c,l,p,m=this.strm,I=this.options.chunkSize,C=this.options.dictionary,S=!1;if(this.ended)return!1;s=o===~~o?o:o===!0?Nn.Z_FINISH:Nn.Z_NO_FLUSH,typeof t=="string"?m.input=function(k){for(var G=new zt.Buf8(k.length),U=0,Y=G.length;U<Y;U++)G[U]=k.charCodeAt(U);return G}(t):Tl.call(t)==="[object ArrayBuffer]"?m.input=new Uint8Array(t):m.input=t,m.next_in=0,m.avail_in=m.input.length;do{if(m.avail_out===0&&(m.output=new zt.Buf8(I),m.next_out=0,m.avail_out=I),(i=(i=pn.inflate(m,Nn.Z_NO_FLUSH))===Nn.Z_NEED_DICT&&C?pn.inflateSetDictionary(this.strm,C):i)===Nn.Z_BUF_ERROR&&S===!0&&(i=Nn.Z_OK,S=!1),i!==Nn.Z_STREAM_END&&i!==Nn.Z_OK)return this.onEnd(i),!(this.ended=!0);m.next_out&&(m.avail_out!==0&&i!==Nn.Z_STREAM_END&&(m.avail_in!==0||s!==Nn.Z_FINISH&&s!==Nn.Z_SYNC_FLUSH)||(this.options.to==="string"?(c=function(k,G){for(var U=(G=(G=G||k.length)>k.length?k.length:G)-1;0<=U&&(192&k[U])==128;)U--;return!(U<0||U===0)&&U+Co[k[U]]>G?U:G}(m.output,m.next_out),l=m.next_out-c,p=Hd(m.output,c),m.next_out=l,m.avail_out=I-l,l&&zt.arraySet(m.output,m.output,c,l,0),this.onData(p)):this.onData(zt.shrinkBuf(m.output,m.next_out)))),m.avail_in===0&&m.avail_out===0&&(S=!0)}while((0<m.avail_in||m.avail_out===0)&&i!==Nn.Z_STREAM_END);return(s=i===Nn.Z_STREAM_END?Nn.Z_FINISH:s)===Nn.Z_FINISH?(i=pn.inflateEnd(this.strm),this.onEnd(i),this.ended=!0,i===Nn.Z_OK):s!==Nn.Z_SYNC_FLUSH||(this.onEnd(Nn.Z_OK),!(m.avail_out=0))},$o.prototype.onData=function(t){this.chunks.push(t)},$o.prototype.onEnd=function(t){t===Nn.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=zt.flattenChunks(this.chunks)),this.chunks=[],this.err=t,this.msg=this.strm.msg},ht={},(0,zt.assign)(ht,{Inflate:$o,inflate:er,inflateRaw:function(t,o){return(o=o||{}).raw=!0,er(t,o)},ungzip:er},Nn);var Hr,yu=ht,tr=(V(Fe,[{key:"inflate",value:function(s){var o,s=new Uint8Array(s).slice(4),i=Date.now();try{o=yu.inflate(s,{to:"string"}),this._bLogForInflateOK||(this._bLogForInflateOK=!0,new ue("inflateOK").end())}catch(l){return this._bLogForInflateError?void 0:(this._bLogForInflateError=!0,void new ue("inflateError").setMessage(l).end())}var s=s.length+4,c=o.length;return E.d("inflate ok. zipped:".concat(s," unzipped:").concat(c)+" compression ratio:".concat(Math.round(100*(c-s)/c),"% cost:").concat(Date.now()-i)),o}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._bLogForInflateOK=!1,this._bLogForInflateError=!1}}]),Fe),e="Message",n="User",a="Group",r="GroupMember",u=["count"],d=["conversationID","timePosition","timePeriod"],_=["miniBirthday","maxBirthday"],y=(H(xe={},e,P.CS),H(xe,n,P.USER_CS),H(xe,a,P.GRP_CS),H(xe,r,P.MBR_CS),xe),M=(z(fe,Ht),Hr=J(fe),V(fe,[{key:"searchCloudMessages",value:function(t){return this.search(e,t)}},{key:"searchCloudUsers",value:function(t){return this.search(n,t)}},{key:"searchCloudGroups",value:function(t){return this.search(a,t)}},{key:"searchCloudGroupMembers",value:function(t){return this.search(r,t)}},{key:"search",value:function(t,o){var i=this,s="searchCloud".concat(t,"s"),c="".concat(this._n,".").concat(s);if(!o)return W({code:Q.OPTIONS_IS_EMPTY,message:this.getErrMsg(Q.OPTIONS_IS_EMPTY,s)});var l=o.keywordList,p=ke(l),m=o.count;if(o.count&&(m=parseInt(m)),t===e&&!p&&!ke(o.senderUserIDList)&&!ke(o.messageTypeList)||t!==e&&!p)throw E.e("[".concat(s,'] Missing required params: "keywordList".')),new Error("Params validate failed.");var I=Date.now(),C=new ue(s),S="keywordList:".concat(l," keywordListMatchType:").concat(o.keywordListMatchType," cursor:").concat(o.cursor," count:").concat(m);return E.l("".concat(c," ").concat(S)),this.req({P:y[t],data:this._genParams(t,o)}).then(function(k){var G=k.data,Y=G.code,G=G.message;if(Y!==0)return(U=Y)===60020?U="SearchUnable":t!==e&&Y===27003?U="SearchParamsError":t!==e&&Y===60018&&(U="SearchOverLimit"),U=i.getErrMsg(U)||G,G=new Gt({code:Y,message:U}),C.setMessage(S).setError(G).end(),W(G);i.get(27).isCSPluginEnabled();var Y=k.data,U=Y.cursor,G=U===void 0?"":U,U=Y.totalCount,Y="totalCount:".concat(U," cost:").concat(An(I)),Y=(E.l("".concat(c," ok. cursor:").concat(G," ").concat(Y)),C.setMessage("".concat(S," ").concat(Y)).end(),i._genRes(t,o,k.data));return Ae({searchResultList:Y,cursor:G,totalCount:U})}).catch(function(k){return C.setMessage(S).setError(k).end(),W(k)})}},{key:"_genParams",value:function(t,o){var i=o.count,s=ae(o,u);return i&&(s.count=parseInt(i)),t===e?this._genMsgParams(s):(i=o.keywordList,o=o.keywordListMatchType,s.keywords=i,s.keywordMatchType=o==="and"?1:0,t===n?this._genUserParams(s):s)}},{key:"_genMsgParams",value:function(c){var o=c.conversationID,i=c.timePosition,s=c.timePeriod,c=ae(c,d);return q(o)||(Bt(o)&&(c.account=o.replace(O.CONV_C2C,"")),wn(o)&&(c.groupID=o.replace(O.CONV_GROUP,""))),ut(s)&&0<s&&(ut(i)&&0<i?c.startTime=i-s:c.startTime=zi()-s),c.startTime&&c.startTime<0&&(c.startTime=void 0),ut(i)&&0<i&&(c.endTime=i),c}},{key:"_genUserParams",value:function(s){var o=s.miniBirthday,i=s.maxBirthday,s=ae(s,_);return ut(o)&&(s.miniBirthday=parseInt(o),ut(i)||(s.maxBirthday=4294967295)),ut(i)&&(s.maxBirthday=parseInt(i)),s}},{key:"_genRes",value:function(t,o,i){switch(t){case e:return this._genMsgRes(i.searchResult,!o.conversationID);case n:return this._genUserRes(i.userList);case a:return this._genGrpRes(i.groupList);case r:return this._genMemberRes(i.groupMemberList);default:return[]}}},{key:"_genMsgRes",value:function(t,o){var i=this.get(11);return ye(t)&&t.length!==0?t.map(function(p){var c=p.groupID,m=p.userID,l=p.messageCount,p=p.messageList,p=p===void 0?[]:p,m=c?"".concat(O.CONV_GROUP).concat(c):"".concat(O.CONV_C2C).concat(m),I={conversationID:m,messageCount:l,messageList:[]};return o&&1<l?I:(l=p.filter(function(C){return!!C}),0<l.length&&(p=i.onRoamingMessage(l,m,!1),c&&p.reverse(),I.messageList=p,I.messageCount=p.length),I)}):[]}},{key:"_genUserRes",value:function(t){var o=this.get(4)._profileHandler;if(!ye(t))return[];for(var i=[],s=0,c=t.length;s<c;s++){var p=t[s],l=p.userID,p=p.profileItems;l!=="@TLS#NOT_FOUND"&&l!==""&&(l=o._update(l,o._getLatestProfileFromResponse(l,p)).latestProfile,i.push(l))}return i}},{key:"_genGrpRes",value:function(t){if(!ye(t))return[];for(var o=[],i=0,s=t.length;i<s;i++)t[i]&&t[i].groupID&&o.push(new Go(t[i]));return o}},{key:"_genMemberRes",value:function(t){if(!ye(t))return[];for(var o,i,s,c,l,p,m=new Map,I=0,C=t.length;I<C;I++)t[I]&&t[I].userID&&t[I].groupID&&(i=(o=t[I]).groupID,c=o.name,l=o.type,p=o.avatar,s=o.nick,c={groupID:i,name:c,type:l,avatar:p},l={userID:o.userID,nick:s,nameCard:o.nameCard},m.has(i)?((p=m.get(i)).memberList.push(l),m.set(i,p)):m.set(i,{groupInfo:c,memberList:[l]}));return re(m.values())}}]),fe),R=(V(he,[{key:"_startTimer",value:function(){var t=this._map.get(24),o=t.isWorkerEnabled();E.l("".concat(this._n,".startTimer isWorkerEnabled:").concat(o," seed:").concat(this._checkTimer)),o?t.startWorkerTimer():this._startMainThreadTimer()}},{key:"_startMainThreadTimer",value:function(){this._checkTimer<0&&(this._checkTimer=setInterval(this.onCheckTimer.bind(this),1e3)),E.l("".concat(this._n,"._startMainThreadTimer seed:").concat(this._checkTimer))}},{key:"stopTimer",value:function(){var t=this._map.get(24),o=t.isWorkerEnabled();E.l("".concat(this._n,".stopTimer isWorkerEnabled:").concat(o," seed:").concat(this._checkTimer)),o?t.stopWorkerTimer():this._stopMainThreadTimer()}},{key:"_stopMainThreadTimer",value:function(){E.l("".concat(this._n,"._stopMainThreadTimer")),0<this._checkTimer&&(clearInterval(this._checkTimer),this._checkTimer=-1,this._checkCount=0)}},{key:"_stopMainThreadSocket",value:function(){E.l("".concat(this._n,"._stopMainThreadSocket"));var t=this._map.get(21);t.setIsWorkerEnabled(!0),t.reConnect()}},{key:"_startMainThreadSocket",value:function(){E.l("".concat(this._n,"._startMainThreadSocket"));var t=this._map.get(21);t.setIsWorkerEnabled(!1),t.reConnect()}},{key:"onWorkerTimerEnabled",value:function(){E.l("".concat(this._n,".onWorkerTimerEnabled, disable main thread timer and socket")),this._stopMainThreadTimer(),this._stopMainThreadSocket()}},{key:"onWorkerTimerDisabled",value:function(){E.l("".concat(this._n,".onWorkerTimerDisabled, enable main thread timer and socket")),this._startMainThreadTimer(),this._startMainThreadSocket()}},{key:"onCheckTimer",value:function(){this._checkCount+=1;var t,o=A(this._map);try{for(o.s();!(t=o.n()).done;){var i=Le(t.value,2)[1];i.onCheckTimer&&i.onCheckTimer(this._checkCount)}}catch(s){o.e(s)}finally{o.f()}}},{key:"_initReadyList",value:function(){var t=this;this._readyList=[this._map.get(1)],this._readyList.forEach(function(o){o.ready(function(){return t._onModuleReady()})})}},{key:"_onModuleReady",value:function(){var t,o,i=!0;this._readyList.forEach(function(s){s.isReady()||(i=!1)}),i&&!this._isReady&&(this._isReady=!0,this._oEmitter.emit(Me.SDK_READY),t=Date.now()-this._startLoginTs,E.w("SDK is ready. cost ".concat(t," ms")),this._startLoginTs=Date.now(),o=this._ssoLogForReady.getStartTs()+$i,this._ssoLogForReady.setMessage(t).start(o).end())}},{key:"login",value:function(){this._startLoginTs===0&&(dc(),this._startLoginTs=Date.now(),this._startTimer(),this._map.get(15).start(),this._ssoLogForReady=new ue("sdkReady"),this._reason=Q.LOGGING_IN)}},{key:"onLoginFailed",value:function(){this._startLoginTs=0}},{key:"getOEmitInst",value:function(){return this._oEmitter===null&&(this._oEmitter=new Or,t=this._oEmitter,po=t,this._oEmitter._emit=this._oEmitter.emit,this._oEmitter.emit=function(o,i){var s,c,l=this;this._canIUseSignaling()&&(o===Me.MESSAGE_RECEIVED&&this.get(33).onNewMessageList(i),o===Me.MESSAGE_MODIFIED&&this.get(33).onMessageModified(i)),o===Me.CONVERSATION_LIST_UPDATED||o===Me.FRIEND_LIST_UPDATED||o===Me.GROUP_LIST_UPDATED||o===Me.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._eventThrottling!==!1?this._eventThrottleMap.has(o)?(s=Date.now())-(c=this._eventThrottleMap.get(o)).last<=1e3?(-1<c.timeoutID&&clearTimeout(c.timeoutID),c.timeoutID=setTimeout(function(){c.last=Date.now(),l._oEmitter._emit.apply(l._oEmitter,[o,{name:o,data:l._getEventData(o)}])},1e3)):(c.last=s,this._oEmitter._emit.apply(this._oEmitter,[o,{name:o,data:this._getEventData(o)}])):(this._eventThrottleMap.set(o,{last:Date.now(),timeoutID:-1}),this._oEmitter._emit.apply(this._oEmitter,[o,{name:o,data:this._getEventData(o)}])):this._oEmitter._emit.apply(this._oEmitter,[o,{name:o,data:this._getEventData(o)}]):this._oEmitter._emit.apply(this._oEmitter,[o,{name:o,data:i}])}.bind(this)),this._oEmitter;var t}},{key:"_canIUseSignaling",value:function(){var t=this.get(33);return!!t&&t.canIUseSignaling()}},{key:"_getEventData",value:function(t){return t===Me.CONVERSATION_LIST_UPDATED?this._map.get(12).isPartialUpdatedConvs()?this._map.get(11).getPartialUpdatedConvs():this._map.get(11).getLocalConvList():t===Me.FRIEND_LIST_UPDATED?this._map.get(8).getLocalFriendList(!1):t===Me.GROUP_LIST_UPDATED?this._map.get(7).getLocalGroupList():t===Me.TOTAL_UNREAD_MESSAGE_COUNT_UPDATED?this._map.get(11).getTotalUnreadCount():t===Me.CONVERSATION_ID_LIST_UPDATED?this._map.get(11).getUpdatedConvIDList():void 0}},{key:"getIEmitInst",value:function(){return this._iEmitter===null&&(this._iEmitter=new Or,this._iEmitter._emit=this._iEmitter.emit,this._iEmitter.emit=function(t,o){t=It(o)&&o.data?[t,{name:t,data:o.data}]:[t,{name:t,data:o}],this._iEmitter._emit.apply(this._iEmitter,t)}.bind(this)),this._iEmitter}},{key:"hasModule",value:function(t){return this._map.has(t)}},{key:"get",value:function(t){return this._map.get(t)}},{key:"canIUseModule",value:function(t){return!this._map.get(12).isUsingChatCore()||this._optionalModuleMap.has(t)}},{key:"canIUseInflate",value:function(){return!!this._map.get(37)}},{key:"isReady",value:function(){return this._isReady}},{key:"isIntl",value:function(){return this.get(12).isIntl()}},{key:"getNotReadyReason",value:function(){return this._reason}},{key:"setNotReadyReason",value:function(t){this._reason=t}},{key:"getErrMsg",value:function(t,o,i){return this._map.get(32).get({key:t,replacement1:o,replacement2:i,isIntl:this.isIntl()})}},{key:"warn",value:function(t,o,i){t=this.getErrMsg(t,o,i),t&&E.w(t)}},{key:"onError",value:function(t){var o="code:".concat(t.code," message:").concat(t.message);E.w("Oops! ".concat(o)),new ue("error").setMessage(o).setLevel("error").end(),this.getOEmitInst().emit(Me.ERROR,t)}},{key:"restartTimer",value:function(){E.l("".concat(this._n,".restartTimer")),this.stopTimer(),this._startTimer();var t=this.get(7);t&&t.restartPolling()}},{key:"getTimerID",value:function(){var t=this._map.get(24);return t.isWorkerEnabled()?t.getTimerID():this._checkTimer}},{key:"getPollingTimerID",value:function(t){return this._map.get(7).getPollingTimerID(t)}},{key:"statTUIKeyFeatures",value:function(i){var o=i.code,i=i.msg,i=i===void 0?"":i,s=o+i;this._codeMsgForTUIMap.has(s)||(this._codeMsgForTUIMap.set(s,1),s=this.get(12).getUIPlatform(),new ue("tui_key_features").setCode(o).setMessage(i).setUIPlatform(s).end())}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),dc();var t,o=A(this._map);try{for(o.s();!(t=o.n()).done;){var i=Le(t.value,2)[1];i.reset&&i.reset()}}catch(p){o.e(p)}finally{o.f()}this._startLoginTs=0,this._initReadyList(),this._isReady=!1,this.stopTimer(),this._oEmitter.emit(Me.SDK_NOT_READY);var s,c=A(this._eventThrottleMap);try{for(c.s();!(s=c.n()).done;){var l=Le(s.value,2)[1];-1<l.timeoutID&&clearTimeout(l.timeoutID)}}catch(p){c.e(p)}finally{c.f()}this._eventThrottleMap.clear(),this._codeMsgForTUIMap.clear()}}]),he),L=(V(le,[{key:"defense",value:function(t,o){var i=2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0;if(typeof t!="string"||t.length===0||typeof o!="function")return null;if(this._funcMap.has(t)&&this._funcMap.get(t).has(o))return this._funcMap.get(t).get(o);this._funcMap.has(t)||this._funcMap.set(t,new Map);var s=null;return this._funcMap.get(t).has(o)?s=this._funcMap.get(t).get(o):(s=this._pack(t,o,i),this._funcMap.get(t).set(o,s)),s}},{key:"defenseOnce",value:function(t,o){return typeof o!="function"?null:this._pack(t,o,2<arguments.length&&arguments[2]!==void 0?arguments[2]:void 0)}},{key:"find",value:function(t,o){return typeof t!="string"||t.length===0||typeof o!="function"?null:this._funcMap.has(t)&&this._funcMap.get(t).has(o)?this._funcMap.get(t).get(o):(this._m.warn("ListenerFnNotFound",t),null)}},{key:"delete",value:function(t,o){return typeof o=="function"&&!!this._funcMap.has(t)&&!!this._funcMap.get(t).has(o)&&(this._funcMap.get(t).delete(o),this._funcMap.get(t).size===0&&this._funcMap.delete(t),!0)}},{key:"_pack",value:function(t,o,i){var s=this;return function(){try{o.apply(i,Array.from(arguments))}catch(p){var c=Object.values(Me).indexOf(t),l="CallbackError";c!==-1&&(c=Object.keys(Me)[c],s._m.warn(l,c,p)),s._reportCount<5&&(new ue(l).setMessage("eventName:".concat(t)).setMoreMessage(p.message).end(),s._reportCount+=1)}}}},{key:"destroy",value:function(){this._funcMap.clear()}},{key:"reset",value:function(){E.l("".concat(this._n,".reset")),this._reportCount=0}}]),le),F=(V(K,[{key:"onError",value:function(t){this._m.onError(t)}},{key:"login",value:function(t){return this._m.login(),this._get(1).login(t)}},{key:"logout",value:function(){var t=this;return this._get(1).logout().then(function(o){return t._safetyCallbackFactory.reset(),t._m.reset(),o})}},{key:"getLoginUser",value:function(){return this._get(1).getLoginUser()}},{key:"getServerTime",value:function(){return no()}},{key:"isReady",value:function(){return this._m.isReady()}},{key:"isIntl",value:function(){return this._m.isIntl()}},{key:"getNotReadyReason",value:function(){return this._m.getNotReadyReason()}},{key:"getErrMsg",value:function(t,o,i){return this._m.getErrMsg(t,o,i)}},{key:"_get",value:function(t){return this._m.get(t)}},{key:"destroy",value:function(){var t=this,o=this._get(12),i=o.getSDKAppID();return E.w("destroy ".concat(i," ").concat(o.getInstanceID())),this.logout().finally(function(){t._safetyCallbackFactory.destroy(),t._m.stopTimer(),t._get(24).terminate(),t._get(21).dealloc(),t._m.getOEmitInst().emit(Me.SDK_DESTROY,{SDKAppID:i})})}},{key:"on",value:function(t,o,i){E.d("on","eventName:".concat(t)),this._m.getOEmitInst().on(t,this._safetyCallbackFactory.defense(t,o,i),i)}},{key:"once",value:function(t,o,i){E.d("once","eventName:".concat(t)),this._m.getOEmitInst().once(t,this._safetyCallbackFactory.defenseOnce(t,o,i),i||this)}},{key:"off",value:function(t,o,i,s){E.d("off","eventName:".concat(t));var c=this._safetyCallbackFactory.find(t,o);c!==null&&(this._m.getOEmitInst().off(t,c,i,s),this._safetyCallbackFactory.delete(t,o))}},{key:"registerPlugin",value:function(t){(q(t["tim-push"])?q(t["tim-offline-push-plugin"])?this._get(18):this._get(28):this._get(36)).registerPlugin(t)}},{key:"setLogLevel",value:function(t){var o;t<=0&&((o=this.getErrMsg("TIM_ASCII_ART"))&&st("log","at node_modules/@tencentcloud/chat/index.js:1",o),(o=this.getErrMsg("API_REFER"))&&(Ko()?st("log","at node_modules/@tencentcloud/chat/index.js:1","%c ".concat("IM SDK API ->"," %c"),"background:#ff9d00; padding:1px; border-radius:3px; color: #fff","background:transparent",o):st("log","at node_modules/@tencentcloud/chat/index.js:1","IM SDK API ->",o)),(o=this.getErrMsg("DOCS_GUIDE"))&&st("log","at node_modules/@tencentcloud/chat/index.js:1",o),o=this.getErrMsg("IOS_WEBVIEW_WARNING"),rc&&o&&st("warn","at node_modules/@tencentcloud/chat/index.js:1",o)),E.setLevel(t)}},{key:"createTextMessage",value:function(t){return this._get(2).createTextMessage(t)}},{key:"createTextAtMessage",value:function(t){return this._get(2).createTextMessage(t)}},{key:"createImageMessage",value:function(t){return this._get(2).createImageMessage(t)}},{key:"createAudioMessage",value:function(t){return this._get(2).createAudioMessage(t)}},{key:"createVideoMessage",value:function(t){return this._get(2).createVideoMessage(t)}},{key:"createCustomMessage",value:function(t){return this._get(2).createCustomMessage(t)}},{key:"createFaceMessage",value:function(t){return this._get(2).createFaceMessage(t)}},{key:"createFileMessage",value:function(t){return this._get(2).createFileMessage(t)}},{key:"createLocationMessage",value:function(t){return this._get(2).createLocationMessage(t)}},{key:"createMergerMessage",value:function(t){return this._get(2).createMergerMessage(t)}},{key:"downloadMergerMessage",value:function(t){return t.type!==O.MSG_MERGER?W({code:Q.MSG_MERGER_TYPE_INVALID}):Te(t.payload.downloadKey)?W({code:Q.MSG_MERGER_KEY_INVALID}):this._get(2).downloadMergerMessage(t).catch(function(o){return W({code:Q.MSG_MERGER_DOWNLOAD_FAIL})})}},{key:"createForwardMessage",value:function(t){return this._get(2).createForwardMessage(t)}},{key:"sendMessage",value:function(t,o){return t instanceof Mn?this._get(2).sendMessageInstance(t,o):W({code:Q.MSG_INSTANCE_REQUIRED})}},{key:"callExperimentalAPI",value:function(t,o){return t==="sendComboMessage"?this._get(31).sendMessage(o):t==="handleGroupInvitation"?this._get(7).handleGroupInvitation(o):t==="isCommercialAbilityEnabled"?this._get(27).isFeatureEnabled(o):t==="isFeatureEnabledForStat"?this._get(27).isFeatureEnabledForStat(o):t==="isIntl"?this.isIntl():t==="sendTRTCCustomData"||t==="sendRoomCustomData"?this._get(30).sendTRTCCustomData(o):t==="getTimerID"?this._m.getTimerID():t==="getPollingTimerID"?this._m.getPollingTimerID(o):t==="setApplicationID"?(this._get(12).setApplicationID(o),void this._get(20).updateProtocolConfig()):t==="getServerConfig"?this._get(23).getServerConfig(o):t==="canIUseModule"?this._m.canIUseModule(o):t==="startMessageLongPolling"?this._get(7).startMessageLongPolling(o):t==="stopMessageLongPolling"?this._get(7).stopMessageLongPolling(o):t==="disableMessagePullOnInvite"?this._get(11).disableMsgPullOnInvite(o):t==="clearLocalMessage"?this._get(11).clearMemMsg(o,!1):t==="setCustomLoginInfo"?this._get(12).setCustomLoginInfo(o):t==="statTUIKeyFeatures"?this._m.statTUIKeyFeatures(o):W({code:Q.INVALID_OPERATION})}},{key:"revokeMessage",value:function(t){return this._get(2).revokeMessage(t)}},{key:"resendMessage",value:function(t,o){return t instanceof Mn?this._get(2).resendMessage(t,o):W({code:Q.MSG_INSTANCE_REQUIRED})}},{key:"deleteMessage",value:function(t){return this._get(2).deleteMessage(t)}},{key:"translateText",value:function(t){return this._get(2).translateText(t)}},{key:"convertVoiceToText",value:function(t){return this._get(2).convertVoiceToText(t)}},{key:"setMessageExtensions",value:function(t,o){return this._get(3).setMessageExtensions(t,o)}},{key:"getMessageExtensions",value:function(t){return this._get(3).getMessageExtensions(t)}},{key:"deleteMessageExtensions",value:function(t,o){return this._get(3).deleteMessageExtensions(t,o)}},{key:"addMessageReaction",value:function(t,o){return this._get(34).addMessageReaction(t,o)}},{key:"removeMessageReaction",value:function(t,o){return this._get(34).removeMessageReaction(t,o)}},{key:"getMessageReactions",value:function(t){return this._get(34).getMessageReactions(t)}},{key:"getAllUserListOfMessageReaction",value:function(t){return this._get(34).getAllUserListOfMessageReaction(t)}},{key:"modifyMessage",value:function(t){return this._get(2).modifyRemoteMessage(t)}},{key:"getMessageList",value:function(t){return this._get(11).getMessageList(t)}},{key:"getMessageListHopping",value:function(t){return this._get(11).getMessageListHopping(t)}},{key:"sendMessageReadReceipt",value:function(t){return this._get(11).sendReadReceipt(t)}},{key:"getMessageReadReceiptList",value:function(t){return this._get(11).getReadReceiptList(t)}},{key:"getGroupMessageReadMemberList",value:function(t){var o=this._get(7);return o?o.getReadReceiptDetail(t):W({code:Q.NO_MODULE})}},{key:"findMessage",value:function(t){return this._get(11).findMessage(t)}},{key:"setMessageRead",value:function(t){return this._get(11).setMessageRead(t)}},{key:"getConversationList",value:function(t){return this._get(11).getConvList(t)}},{key:"getConversationProfile",value:function(t){return this._get(11).getConversationProfile(t)}},{key:"deleteConversation",value:function(t){return this._get(11).deleteConversation(t)}},{key:"setConversationDraft",value:function(t){return this._get(11).setConvDraft(t)}},{key:"clearHistoryMessage",value:function(t){return this._get(11).clearHistoryMessage(t)}},{key:"pinConversation",value:function(t){return this._get(11).pinConversation(t)}},{key:"setAllMessageRead",value:function(t){return this._get(11).setAllMessageRead(t)}},{key:"setMessageRemindType",value:function(t){return this._get(11).setMessageRemindType(t)}},{key:"setAllReceiveMessageOpt",value:function(t){return this._get(11).setAllRcvMsgOpt(t)}},{key:"getAllReceiveMessageOpt",value:function(){return this._get(11).getAllRcvMsgOpt()}},{key:"getTotalUnreadMessageCount",value:function(){return this._get(11).getTotalUnreadCount()}},{key:"setConversationCustomData",value:function(t){return this._get(11).setConvCustomData(t)}},{key:"markConversation",value:function(t){return this._get(11).markConv(t)}},{key:"getConversationGroupList",value:function(){return this._get(11).getConvGroupList()}},{key:"createConversationGroup",value:function(t){return this._get(11).createConvGroup(t)}},{key:"deleteConversationGroup",value:function(t){return this._get(11).deleteConvGroup(t)}},{key:"renameConversationGroup",value:function(t){return this._get(11).renameConvGroup(t)}},{key:"addConversationsToGroup",value:function(t){return this._get(11).addConvsToGroup(t)}},{key:"deleteConversationsFromGroup",value:function(t){return this._get(11).deleteConvsFromGroup(t)}},{key:"searchCloudMessages",value:function(t){var o=this._get(38);return o?o.searchCloudMessages(t):W({code:Q.NO_MODULE})}},{key:"searchCloudUsers",value:function(t){var o=this._get(38);return o?o.searchCloudUsers(t):W({code:Q.NO_MODULE})}},{key:"searchCloudGroups",value:function(t){var o=this._get(38);return o?o.searchCloudGroups(t):W({code:Q.NO_MODULE})}},{key:"searchCloudGroupMembers",value:function(t){var o=this._get(38);return o?o.searchCloudGroupMembers(t):W({code:Q.NO_MODULE})}},{key:"getMyProfile",value:function(){return this._get(4).getMyProfile()}},{key:"getUserProfile",value:function(t){return this._get(4).getUserProfile(t)}},{key:"updateMyProfile",value:function(t){return this._get(4).updateMyProfile(t)}},{key:"getBlacklist",value:function(){return this._get(4).getLocalBlacklist()}},{key:"addToBlacklist",value:function(t){return this._get(4).addBlacklist(t)}},{key:"removeFromBlacklist",value:function(t){return this._get(4).deleteBlacklist(t)}},{key:"setSelfStatus",value:function(t){return this._get(4).setSelfStatus(t)}},{key:"getUserStatus",value:function(t){return this._get(4).getUserStatus(t)}},{key:"subscribeUserStatus",value:function(t){return this._get(4).subscribeUserStatus(t)}},{key:"unsubscribeUserStatus",value:function(t){return this._get(4).unsubscribeUserStatus(t)}},{key:"getFriendList",value:function(){var t=this._get(8);return t?t.getLocalFriendList():W({code:Q.NO_MODULE})}},{key:"addFriend",value:function(t){var o=this._get(8);return o?o.addFriend(t):W({code:Q.NO_MODULE})}},{key:"deleteFriend",value:function(t){var o=this._get(8);return o?o.deleteFriend(t):W({code:Q.NO_MODULE})}},{key:"checkFriend",value:function(t){var o=this._get(8);return o?o.checkFriend(t):W({code:Q.NO_MODULE})}},{key:"getFriendProfile",value:function(t){var o=this._get(8);return o?o.getFriendProfile(t):W({code:Q.NO_MODULE})}},{key:"updateFriend",value:function(t){var o=this._get(8);return o?o.updateFriend(t):W({code:Q.NO_MODULE})}},{key:"getFriendApplicationList",value:function(){var t=this._get(8);return t?t.getLocalFriendApplicationList():W({code:Q.NO_MODULE})}},{key:"acceptFriendApplication",value:function(t){var o=this._get(8);return o?o.acceptFriendApplication(t):W({code:Q.NO_MODULE})}},{key:"refuseFriendApplication",value:function(t){var o=this._get(8);return o?o.refuseFriendApplication(t):W({code:Q.NO_MODULE})}},{key:"deleteFriendApplication",value:function(t){var o=this._get(8);return o?o.deleteFriendApplication(t):W({code:Q.NO_MODULE})}},{key:"setFriendApplicationRead",value:function(){var t=this._get(8);return t?t.setFriendApplicationRead():W({code:Q.NO_MODULE})}},{key:"getFriendGroupList",value:function(){var t=this._get(8);return t?t.getLocalFriendGroupList():W({code:Q.NO_MODULE})}},{key:"createFriendGroup",value:function(t){var o=this._get(8);return o?o.createFriendGroup(t):W({code:Q.NO_MODULE})}},{key:"deleteFriendGroup",value:function(t){var o=this._get(8);return o?o.deleteFriendGroup(t):W({code:Q.NO_MODULE})}},{key:"addToFriendGroup",value:function(t){var o=this._get(8);return o?o.addToFriendGroup(t):W({code:Q.NO_MODULE})}},{key:"removeFromFriendGroup",value:function(t){var o=this._get(8);return o?o.removeFromFriendGroup(t):W({code:Q.NO_MODULE})}},{key:"renameFriendGroup",value:function(t){var o=this._get(8);return o?o.renameFriendGroup(t):W({code:Q.NO_MODULE})}},{key:"followUser",value:function(t){var o=this._get(35);return o?o.followUser(t):W({code:Q.NO_MODULE})}},{key:"unfollowUser",value:function(t){var o=this._get(35);return o?o.unfollowUser(t):W({code:Q.NO_MODULE})}},{key:"getMyFollowersList",value:function(t){var o=this._get(35);return o?o.getMyFollowersList(t):W({code:Q.NO_MODULE})}},{key:"getMyFollowingList",value:function(t){var o=this._get(35);return o?o.getMyFollowingList(t):W({code:Q.NO_MODULE})}},{key:"getMutualFollowersList",value:function(t){var o=this._get(35);return o?o.getMutualFollowersList(t):W({code:Q.NO_MODULE})}},{key:"getUserFollowInfo",value:function(t){var o=this._get(35);return o?o.getUserFollowInfo(t):W({code:Q.NO_MODULE})}},{key:"checkFollowType",value:function(t){var o=this._get(35);return o?o.checkFollowType(t):W({code:Q.NO_MODULE})}},{key:"getGroupList",value:function(){var t=this._get(7);return t?t.getGroupList():W({code:Q.NO_MODULE})}},{key:"getGroupProfile",value:function(t){var o=this._get(7);return o?o.getGroupProfile(t):W({code:Q.NO_MODULE})}},{key:"createGroup",value:function(t){var o=this._get(7);return o?o.createGroup(t):W({code:Q.NO_MODULE})}},{key:"dismissGroup",value:function(t){var o=this._get(7);return o?o.dismissGroup(t):W({code:Q.NO_MODULE})}},{key:"updateGroupProfile",value:function(t){var o=this._get(7);return o?o.updateGroupProfile(t):W({code:Q.NO_MODULE})}},{key:"joinGroup",value:function(t){var o=this._get(7);return o?o.joinGroup(t):W({code:Q.NO_MODULE})}},{key:"quitGroup",value:function(t){var o=this._get(7);return o?o.quitGroup(t):W({code:Q.NO_MODULE})}},{key:"searchGroupByID",value:function(t){var o=this._get(7);return o?o.searchGroupByID(t):W({code:Q.NO_MODULE})}},{key:"getGroupOnlineMemberCount",value:function(t){var o=this._get(7);return o?o.getGroupOnlineMemberCount(t):W({code:Q.NO_MODULE})}},{key:"changeGroupOwner",value:function(t){var o=this._get(7);return o?o.changeGroupOwner(t):W({code:Q.NO_MODULE})}},{key:"getGroupApplicationList",value:function(){var t=this._get(7);return t?t.getGroupApplicationList():W({code:Q.NO_MODULE})}},{key:"handleGroupApplication",value:function(t){var o=this._get(7);return o?o.handleGroupApplication(t):W({code:Q.NO_MODULE})}},{key:"initGroupAttributes",value:function(t){var o=this._get(7);return o?o.initGroupAttributes(t):W({code:Q.NO_MODULE})}},{key:"setGroupAttributes",value:function(t){var o=this._get(7);return o?o.setGroupAttributes(t):W({code:Q.NO_MODULE})}},{key:"deleteGroupAttributes",value:function(t){var o=this._get(7);return o?o.deleteGroupAttributes(t):W({code:Q.NO_MODULE})}},{key:"getGroupAttributes",value:function(t){var o=this._get(7);return o?o.getGroupAttributes(t):W({code:Q.NO_MODULE})}},{key:"setGroupCounters",value:function(t){var o=this._get(7);return o?o.setGroupCounters(t):W({code:Q.NO_MODULE})}},{key:"increaseGroupCounter",value:function(t){var o=this._get(7);return o?o.increaseGroupCounter(t):W({code:Q.NO_MODULE})}},{key:"decreaseGroupCounter",value:function(t){var o=this._get(7);return o?o.decreaseGroupCounter(t):W({code:Q.NO_MODULE})}},{key:"getGroupCounters",value:function(t){var o=this._get(7);return o?o.getGroupCounters(t):W({code:Q.NO_MODULE})}},{key:"getGroupMemberList",value:function(t){var o=this._get(7);return o?o.getGroupMemberList(t):W({code:Q.NO_MODULE})}},{key:"getGroupMemberProfile",value:function(t){var o=this._get(7);return o?o.getGroupMemberProfile(t):W({code:Q.NO_MODULE})}},{key:"addGroupMember",value:function(t){var o=this._get(7);return o?o.addGroupMember(t):W({code:Q.NO_MODULE})}},{key:"deleteGroupMember",value:function(t){var o=this._get(7);return o?o.deleteGroupMember(t):W({code:Q.NO_MODULE})}},{key:"setGroupMemberMuteTime",value:function(t){var o=this._get(7);return o?o.setGroupMemberMuteTime(t):W({code:Q.NO_MODULE})}},{key:"setGroupMemberRole",value:function(t){var o=this._get(7);return o?o.setGroupMemberRole(t):W({code:Q.NO_MODULE})}},{key:"setGroupMemberNameCard",value:function(t){var o=this._get(7);return o?o.setGroupMemberNameCard(t):W({code:Q.NO_MODULE})}},{key:"setGroupMemberCustomField",value:function(t){var o=this._get(7);return o?o.setGroupMemberCustomField(t):W({code:Q.NO_MODULE})}},{key:"markGroupMemberList",value:function(t){var o=this._get(7);return o?o.markGroupMemberList(t):W({code:Q.NO_MODULE})}},{key:"getJoinedCommunityList",value:function(){return this._get(10).getJoinedCommunityList()}},{key:"createTopicInCommunity",value:function(t){return this._get(10).createTopicInCommunity(t)}},{key:"deleteTopicFromCommunity",value:function(t){return this._get(10).deleteTopicFromCommunity(t)}},{key:"updateTopicProfile",value:function(t){return this._get(10).updateTopicProfile(t)}},{key:"getTopicList",value:function(t){return this._get(10).getTopicList(t)}},{key:"addSignalingListener",value:function(t,o,i){var s=this._get(33);s&&s.addSignalingListener(t,this._safetyCallbackFactory.defense(t,o,i),i)}},{key:"removeSignalingListener",value:function(t,o,i){var s,c=this._safetyCallbackFactory.find(t,o);c===null||(s=this._get(33))&&(s.removeSignalingListener(t,c,i),this._safetyCallbackFactory.delete(t,o))}},{key:"invite",value:function(t){var o=this._get(33);return o?o.invite(t):W({code:Q.NO_MODULE})}},{key:"inviteSync",value:function(t,o,i){var s=this._get(33);return s?s.inviteSync(t,o,i):""}},{key:"inviteInGroup",value:function(t){var o=this._get(33);return o?o.invite(t):W({code:Q.NO_MODULE})}},{key:"inviteInGroupSync",value:function(t,o,i){var s=this._get(33);return s?s.inviteSync(t,o,i):""}},{key:"cancel",value:function(t){var o=this._get(33);return o?o.cancel(t):W({code:Q.NO_MODULE})}},{key:"accept",value:function(t){var o=this._get(33);return o?o.accept(t):W({code:Q.NO_MODULE})}},{key:"reject",value:function(t){var o=this._get(33);return o?o.reject(t):W({code:Q.NO_MODULE})}},{key:"getSignalingInfo",value:function(t){var o=this._get(33);return o?o.getSignalingInfo(t):null}},{key:"modifyInvitation",value:function(t){var o=this._get(33);return o?o.modifyInvitation(t):W({code:Q.NO_MODULE})}}]),K),x={login:1,logout:1,getLoginUser:1,destroy:1,on:1,off:1,ready:1,setLogLevel:1,joinGroup:1,quitGroup:1,registerPlugin:1,getGroupOnlineMemberCount:1,isReady:1,addSignalingListener:1,removeSignalingListener:1,callExperimentalAPI:1};function K(t){N(this,K),t={SDKAppID:t.SDKAppID,unlimitedAVChatRoom:t.unlimitedAVChatRoom||!1,scene:t.scene||"",oversea:t.oversea||!1,instanceID:yc(),devMode:t.devMode||!1,testEnv:t.testEnv||!1,proxyServer:t.proxyServer||void 0,fileUploadProxy:t.fileUploadProxy||void 0,fileDownloadProxy:t.fileDownloadProxy||t.fileUploadProxy||void 0,eventThrottling:t.eventThrottling!==!1,partialUpdatedConversations:t.partialUpdatedConversations===!0,disableIndependentDomain:t.disableIndependentDomain===!0,modules:t.modules||void 0},this._m=new R(t),this._safetyCallbackFactory=new L(this._m)}function le(t){N(this,le),this._funcMap=new Map,this._m=t,this._n="SafetyCallback",this._reportCount=0}function he(t){var o=this;N(this,he);var i,s=new ue("sdkConstruct"),m=(this._n="ModuleManager",this._isReady=!1,this._reason=Q.USER_NOT_LOGGED_IN,this._startLoginTs=0,this._map=new Map,this._optionalModuleMap=new Map,this._codeMsgForTUIMap=new Map,this._iEmitter=null,this._oEmitter=null,this._checkCount=0,this._checkTimer=-1,this._map.set(12,new Uc(this,t)),this._map.set(37,new tr(this)),this._map.set(15,new fd(this)),this._map.set(27,new Gd(this)),this._map.set(23,new gl(this)),this._map.set(24,new bd(this)),this._map.set(26,new Ld(this)),this._map.set(21,new Jc(this)),this._map.set(20,new Sd(this)),this._map.set(1,new wc(this)),this._map.set(2,new Ns(this)),this._map.set(3,new bs(this)),this._map.set(34,new Ps(this)),this._map.set(31,new Gs(this)),this._map.set(4,new Gc(this)),this._map.set(6,new Mr(this)),this._map.set(11,new td(this)),this._map.set(7,new pd(this)),this._map.set(10,new _d(this)),this._map.set(13,new Vc(this)),this._map.set(32,new qd(this)),this._map.set(14,new Bu(this)),this._map.set(17,new ju(this)),this._map.set(18,new Us(this)),this._map.set(19,new ws(this)),this._map.set(25,new Dd(this)),this._map.set(8,new Nd(this)),this._map.set(28,new Ud(this)),this._map.set(36,new wd(this)),this._map.set(29,new Fd(this)),this._map.set(30,new xd(this)),this._map.set(33,new au(this)),this._map.set(35,new cu(this)),this._map.set(38,new M(this)),this._eventThrottleMap=new Map,this._eventThrottling=t.eventThrottling,this._map.get(12).isPartialUpdatedConvs()&&(this._eventThrottling=!1),It(t.modules)?(Object.keys(t.modules).forEach(function(I){i=t.modules[I],I==="group-module"?o._map.set(7,new i(o)):I==="relationship-module"?o._map.set(8,new i(o)):I==="signaling-module"?o._map.set(33,new i(o)):I==="follow-module"?o._map.set(35,new i(o)):I==="cloud-search-module"&&o._map.set(38,new i(o)),o._optionalModuleMap.set(I,1)}),this._map.get(12).setUsingChatCore(!0)):this._map.has(7)||this._map.get(12).setUsingChatCore(!0),t.instanceID),c=t.SDKAppID,l=this._map.get(12).isIntl(),p=this._map.get(12).isUsingChatCore(),m="instanceID:".concat(m," SDKAppID:").concat(c," isIntl:").concat(l," isUsingChatCore:").concat(p," host:").concat(Ic())+" isIOSWebView:".concat(rc," platform:").concat(xn," canIUseInflate:").concat(this.canIUseInflate())+" workerAvailable:".concat(Yi," eventThrottling:").concat(this._eventThrottling," UserAgent:").concat(vt);ue.bindEventStatModule(this._map.get(14)),ue.bindNetMonitorModule(this._map.get(15)),s.setMessage("".concat(m," ").concat(function(){var I="";if(qe)try{var C=mt.getSystemInfoSync(),S=C.model,k=C.version,G=C.system,U=C.platform,Y=C.SDKVersion,I="model:".concat(S," version:").concat(k," system:").concat(G," platform:").concat(U," SDKVersion:").concat(Y)}catch(Z){I=""}return I}())).end(),E.i("SDK ".concat(m)),Gt.prototype._getErrMsg=this.getErrMsg.bind(this),this._readyList=void 0,this._ssoLogForReady=null,this._initReadyList()}function fe(t){return N(this,fe),(t=Hr.call(this,t))._n="CSModule",t}function Fe(t){N(this,Fe),this._m=t,this._n="InflateModule",this._bLogForInflateOK=!1,this._bLogForInflateError=!1}var Re={},ie={};return ie.create=function(p){var o="TencentCloudChat.create",i=0,l=p.SDKAppID;if(ut(l))i=l;else if(i=parseInt(l),isNaN(l))return E.e("".concat(o," failed. Failed to parse the SDKAppID, please check the arguments")),null;if(i&&Re[i])return Re[i];E.l("".concat(o));var s,c,l=new F(v(v({},p),{},{SDKAppID:i})),p=(l.on(Me.SDK_DESTROY,function(m){Re[m.data.SDKAppID]=null,delete Re[m.data.SDKAppID]}),s=l,c=Object.create(null),Object.keys(Sc).forEach(function(m){var I;s[m]&&(I=new gn,c[m]=function(){var C=Array.from(arguments);return I.use(function(S,k){var G=function(U,Y){if(U.isReady()||x[Y]===1)return!0;var Z={code:Z=U.getNotReadyReason(),message:"".concat(U.getErrMsg(Z)," | ").concat(Y," | ").concat(U.getErrMsg(Q.SDK_IS_NOT_READY))};return U.onError(Z),Z}(s,m);return G===!0?k():W(G)}).use(function(S,k){if(function(G,U,Y){if(U===void 0)return!0;var Z=!0;if(It(U))Object.keys(U).forEach(function(De){var _e=G.length===1?G[0][De]:void 0;Z=!!Wo(_e,U[De],Y,De)&&Z});else if(ye(U))for(var $=0;$<U.length;$++)Z=!!Wo(G[$],U[$],Y,U[$].name)&&Z;if(Z)return Z;throw new Error("Params validate failed.")}(S,_r[m],m)===!0)return k()}).use(function(S,k){return s[m].apply(s,S)}),I.run(C)})}),c);return Re[i]=p,_r.hookGetAPITips(l.getErrMsg.bind(l)),E.l("".concat(o," ok")),p},ie.TYPES=O,ie.EVENT=Me,ie.TSignaling=ze,ie.VERSION="3.5.2",E.l("TencentCloudChat.VERSION:".concat(ie.VERSION)),ie})})(zg);var u_=zg.exports,or=c_(u_),l_=zn(),Eo={instance:null};rt.once("ready",()=>{var f;Eo.instance=(f=l_.instance)==null?void 0:f.getMediaDeviceManager()});function Au(f){let g=Dn(),{t:T}=Pp.global;function v(){return Oe(this,null,function*(){var N,B,V,H,z,ne;if(!Eo.instance)return;let ge=yield(N=Eo.instance)==null?void 0:N.getDevicesList({type:Yn.kMediaDeviceTypeVideoCamera}),pe=yield(B=Eo.instance)==null?void 0:B.getDevicesList({type:Yn.kMediaDeviceTypeAudioInput}),oe=yield(V=Eo.instance)==null?void 0:V.getDevicesList({type:Yn.kMediaDeviceTypeAudioOutput});if(!mo){let J=ge&&ge.length>0,Le=pe&&pe.length>0,re="";J&&!Le?re="Microphone not detected on current device":!J&&Le?re="Camera not detected on current device":!J&&!Le&&(re="Camera And Microphone not detected on current device"),re&&tc({title:T("Note"),message:T(re),appendToRoomContainer:!0,confirmButtonText:T("Sure")})}ge&&g.setCameraList(ge),pe&&g.setMicrophoneList(pe),oe&&g.setSpeakerList(oe);let de=(H=Eo.instance)==null?void 0:H.getCurrentDevice({type:Yn.kMediaDeviceTypeVideoCamera}),ae=(z=Eo.instance)==null?void 0:z.getCurrentDevice({type:Yn.kMediaDeviceTypeAudioInput}),te=(ne=Eo.instance)==null?void 0:ne.getCurrentDevice({type:Yn.kMediaDeviceTypeAudioOutput});de&&de.deviceId&&g.setCurrentCameraId(de.deviceId),ae&&ae.deviceId&&g.setCurrentMicrophoneId(ae.deviceId),te&&te.deviceId&&g.setCurrentSpeakerId(te.deviceId)})}function w(N){return Oe(this,null,function*(){var B;if(!Eo.instance)return;let V=["add","remove","active"],H=["mic","speaker","camera"],{deviceId:z,type:ne,state:ge}=N;Qt.log(`onDeviceChanged: deviceId: ${z}, type: ${H[ne]}, state: ${V[ge]}`);let pe=yield(B=Eo.instance)==null?void 0:B.getDevicesList({type:ne});pe&&g.setDeviceList(ne,pe),ge===rp.kMediaDeviceStateActive&&g.setCurrentDeviceId(ne,z)})}return rt.once("ready",()=>{var N;f&&f.listenForDeviceChange&&(v(),(N=Eo.instance)==null||N.on(Gl.onDeviceChanged,w))}),(0,h.onUnmounted)(()=>{var N;f&&f.listenForDeviceChange&&((N=Eo.instance)==null||N.off(Gl.onDeviceChanged,w))}),{deviceManager:Eo,initMediaDeviceList:v}}var ir="[RoomService:roomActionManager]",Hl=new wl;Hl.videoResolution=$r.TRTCVideoResolution_640_360;Hl.videoFps=10;Hl.videoBitrate=550;var Ip=class{constructor(g){this.service=g}start(v){return Oe(this,arguments,function*(g,T={}){let{roomName:w,isSeatEnabled:N=!1,isOpenCamera:B=!1,isOpenMicrophone:V=!1,defaultCameraId:H,defaultMicrophoneId:z,defaultSpeakerId:ne}=T,ge=N?"SpeakAfterTakingSeat":"FreeToSpeak";yield this.createRoom({roomId:g,roomName:w,roomMode:ge,roomParam:{isOpenCamera:B,isOpenMicrophone:V,defaultCameraId:H,defaultMicrophoneId:z,defaultSpeakerId:ne}}),yield this.enterRoom({roomId:g,roomParam:{isOpenCamera:B,isOpenMicrophone:V,defaultCameraId:H,defaultMicrophoneId:z,defaultSpeakerId:ne}}),this.service.emit(Nt.ROOM_START)})}join(v){return Oe(this,arguments,function*(g,T={}){let{isOpenCamera:w=!1,isOpenMicrophone:N=!1,defaultCameraId:B,defaultMicrophoneId:V,defaultSpeakerId:H}=T;yield this.enterRoom({roomId:g,roomParam:{isOpenCamera:w,isOpenMicrophone:N,defaultCameraId:B,defaultMicrophoneId:V,defaultSpeakerId:H}}),this.service.emit(Nt.ROOM_JOIN)})}leaveRoom(){return Oe(this,null,function*(){var g;try{this.closeMediaBeforeLeave();let T=yield(g=this.service.roomEngine.instance)==null?void 0:g.exitRoom();this.service.resetStore(),Qt.log(`${ir}leaveRoom:`,T),this.service.emit(Nt.ROOM_LEAVE,T)}catch(T){Qt.error(`${ir}leaveRoom error:`,T)}})}dismissRoom(){return Oe(this,null,function*(){var g;try{Qt.log(`${ir}dismissRoom: enter`),this.closeMediaBeforeLeave(),yield(g=this.service.roomEngine.instance)==null?void 0:g.destroyRoom(),this.service.resetStore(),this.service.emit(Nt.ROOM_DISMISS,{})}catch(T){Qt.error(`${ir}dismissRoom error:`,T)}})}createRoom(g){return Oe(this,null,function*(){try{let{roomId:T,roomName:v,roomMode:w}=g,N={roomId:T,roomName:v,roomType:ar.kConference,isSeatEnabled:w!=="FreeToSpeak",seatMode:w==="SpeakAfterTakingSeat"?ji.kApplyToTake:void 0};yield this.handleRoomCreation(N,g)}catch(T){throw Qt.error(`${ir}createRoom error:`,T),this.service.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{title:this.service.t("Note"),message:this.service.t("Failed to initiate meeting"),confirmButtonText:this.service.t("Sure"),callback:()=>Oe(this,null,function*(){this.service.emit(Nt.ROOM_ERROR,T),this.service.resetStore()})}),T}})}handleRoomCreation(g,T){return Oe(this,null,function*(){var v;let{roomEngine:w}=this.service;w.instance&&(this.service.basicStore.setRoomId(g.roomId),Qt.debug(`${ir}createRoom:`,g,T),yield(v=w.instance)==null?void 0:v.createRoom(g))})}enterRoom(g){return Oe(this,null,function*(){var T;try{let{roomId:v,roomParam:w}=g,N={roomId:v,roomType:ar.kConference},B=yield this.doEnterRoom(N);this.service.roomStore.setRoomInfo(B),yield this.getUserList(),yield this.syncUserInfo(this.service.basicStore.userId),B.isSeatEnabled&&(yield this.getSeatList(),this.service.roomStore.isMaster&&(yield(T=this.service.roomEngine.instance)==null?void 0:T.takeSeat({seatIndex:-1,timeout:0}))),this.service.roomStore.setRoomParam(w)}catch(v){throw Qt.error(`${ir}enterRoom error:`,v),this.service.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{title:this.service.t("Note"),message:this.service.t("Failed to enter the meeting"),confirmButtonText:this.service.t("Sure"),callback:()=>Oe(this,null,function*(){this.service.emit(Nt.ROOM_ERROR,v),this.service.roomStore.reset()})}),v}})}doEnterRoom(g){return Oe(this,null,function*(){var T,v,w,N,B;let{roomEngine:V}=this.service,{roomId:H,roomType:z}=g;if(this.service.basicStore.setRoomId(H),!Ro){let ge=Fn&&!mo,pe=(T=V.instance)==null?void 0:T.getTRTCCloud();pe==null||pe.setDefaultStreamRecvMode(!0,!1),pe==null||pe.enableSmallVideoStream(!ge,Hl)}yield(v=V.instance)==null?void 0:v.enterRoom({roomId:H,roomType:z});let ne=yield(w=V.instance)==null?void 0:w.fetchRoomInfo();return(N=V.instance)==null||N.muteLocalAudio(),ne.isSeatEnabled||((B=V.instance)==null||B.openLocalMicrophone(),this.service.basicStore.setIsOpenMic(!0)),ne})}getUserList(){return Oe(this,null,function*(){var g;let{roomEngine:T}=this.service,v="";try{do{let w=yield(g=T.instance)==null?void 0:g.getUserList({nextSequence:v});this.service.roomStore.updateUserList(w.userInfoList),v=w.nextSequence}while(v!=="0")}catch(w){Qt.error("TUIRoomEngine.getUserList",w.code,w.message)}})}syncUserInfo(g){return Oe(this,null,function*(){var T;let{roomEngine:v}=this.service,w=yield(T=v.instance)==null?void 0:T.getUserInfo({userId:g}),{isMessageDisabled:N}=w;this.service.chatStore.setSendMessageDisableChanged(N)})}getSeatList(){return Oe(this,null,function*(){var g;let{roomEngine:T}=this.service;try{let v=yield(g=T.instance)==null?void 0:g.getSeatList();this.service.roomStore.setSeatList(v)}catch(v){Qt.error("TUIRoomEngine.getSeatList",v.code,v.message)}})}closeMediaBeforeLeave(){var g,T;let{roomEngine:v}=this.service;this.service.roomStore.localUser.hasAudioStream&&((g=v.instance)==null||g.closeLocalMicrophone()),this.service.roomStore.localUser.hasVideoStream&&((T=v.instance)==null||T.closeLocalCamera())}},Mp=class{constructor(g){this.service=g}setSelfInfo(g){return Oe(this,null,function*(){let{avatarUrl:T,userName:v}=yield rt.getSelfInfo(),w={userName:g.userName||v,avatarUrl:g.avatarUrl||T};return this.service.basicStore.setBasicInfo(w),rt.setSelfInfo(w)})}setCustomInfoForUser(g){return Oe(this,null,function*(){let T=this.service.roomEngine.instance;return T==null?void 0:T.setCustomInfoForUser(g)})}getDisplayName(g){let{userName:T,userId:v}=g;return T||v}},Eu=(f=>(f.UNMUTE_LOCAL_MIC_FAIL_MUTE_ALL="Has been fully muted and cannot open the microphone",f.UNMUTE_LOCAL_MIC_FAIL_MUTE_BY_MASTER="Has been muted by the host and cannot open the microphone",f.UNMUTE_LOCAL_MIC_FAIL_AUDIENCE="To apply to speak in the room, please raise your hand first to apply for the microphone",f.UNMUTE_LOCAL_CAMERA_FAIL_MUTE_ALL="Has been full static painting, can not open the video",f.UNMUTE_LOCAL_CAMERA_FAIL_MUTE_BY_MASTER="It has been stilled by the host and cannot open the video",f.UNMUTE_LOCAL_CAMERA_FAIL_AUDIENCE="To apply to speak in the room, please raise your hand first to apply for the microphone",f))(Eu||{}),ln=(f=>(f[f.NORMAL=3e3]="NORMAL",f[f.LONG=5e3]="LONG",f))(ln||{}),{t:Pn}=Pp.global,wg="[RoomService]",Cn=zn(),Gp=new wl;Gp.videoResolution=$r.TRTCVideoResolution_640_360;Gp.videoFps=10;Gp.videoBitrate=550;var Fl=class f{constructor(){this.emitter=Yg(),this.roomActionManager=new Ip(this),this.userManager=new Mp(this),this.roomEngine=Cn,this.t=Pn,this.initEventCtx(),rt.once("ready",()=>{Cn.instance===null&&(Cn.instance=new rt),this.bindRoomEngineEvents(),this.handleRoomEngineReady()})}get basicStore(){return qt()}get roomStore(){return Dn()}get chatStore(){return bp()}initEventCtx(){this.onError=this.onError.bind(this),this.onRoomDismissed=this.onRoomDismissed.bind(this),this.onUserVoiceVolumeChanged=this.onUserVoiceVolumeChanged.bind(this),this.onUserNetworkQualityChanged=this.onUserNetworkQualityChanged.bind(this),this.onKickedOutOfRoom=this.onKickedOutOfRoom.bind(this),this.onSendMessageForUserDisableChanged=this.onSendMessageForUserDisableChanged.bind(this),this.onUserSigExpired=this.onUserSigExpired.bind(this),this.onKickedOffLine=this.onKickedOffLine.bind(this),this.onAllUserCameraDisableChanged=this.onAllUserCameraDisableChanged.bind(this),this.onAllUserMicrophoneDisableChanged=this.onAllUserMicrophoneDisableChanged.bind(this),this.onSendMessageForAllUserDisableChanged=this.onSendMessageForAllUserDisableChanged.bind(this),this.onReceiveMessage=this.onReceiveMessage.bind(this)}static getInstance(){return f.instance||(f.instance=new f),f.instance}static destroyInstance(){f.instance&&(f.instance.unBindRoomEngineEvents(),f.instance=void 0)}useExtension(g){g._bind(this)}getComponentConfig(g){return g.map(T=>this.basicStore.componentConfig[T]||{})}setComponentConfig(g){try{for(let T in g){let v=g[T];for(let w in v)this.basicStore.componentConfig[T][w]=v[w]}return!0}catch(T){return Qt.error(T),!1}}getRoomContainer(){return(document==null?void 0:document.fullscreenElement)||(document==null?void 0:document.getElementById("roomContainer"))||(document==null?void 0:document.body)}initMediaDeviceList(){Au({listenForDeviceChange:!0})}bindChatEvents(){this.tim.on(or.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage)}bindRoomEngineEvents(){var g,T,v,w,N,B,V,H,z,ne,ge;(g=Cn.instance)==null||g.on(it.onError,this.onError),(T=Cn.instance)==null||T.on(it.onRoomDismissed,this.onRoomDismissed),(v=Cn.instance)==null||v.on(it.onUserVoiceVolumeChanged,this.onUserVoiceVolumeChanged),(w=Cn.instance)==null||w.on(it.onUserNetworkQualityChanged,this.onUserNetworkQualityChanged),(N=Cn.instance)==null||N.on(it.onKickedOutOfRoom,this.onKickedOutOfRoom),(B=Cn.instance)==null||B.on(it.onSendMessageForUserDisableChanged,this.onSendMessageForUserDisableChanged),(V=Cn.instance)==null||V.on(it.onUserSigExpired,this.onUserSigExpired),(H=Cn.instance)==null||H.on(it.onKickedOffLine,this.onKickedOffLine),(z=Cn.instance)==null||z.on(it.onAllUserCameraDisableChanged,this.onAllUserCameraDisableChanged),(ne=Cn.instance)==null||ne.on(it.onAllUserMicrophoneDisableChanged,this.onAllUserMicrophoneDisableChanged),(ge=Cn.instance)==null||ge.on(it.onSendMessageForAllUserDisableChanged,this.onSendMessageForAllUserDisableChanged)}unBindRoomEngineEvents(){var g,T,v,w,N,B,V,H,z,ne;(g=Cn.instance)==null||g.off(it.onError,this.onError),(T=Cn.instance)==null||T.off(it.onUserVoiceVolumeChanged,this.onUserVoiceVolumeChanged),(v=Cn.instance)==null||v.off(it.onUserNetworkQualityChanged,this.onUserNetworkQualityChanged),(w=Cn.instance)==null||w.off(it.onKickedOutOfRoom,this.onKickedOutOfRoom),(N=Cn.instance)==null||N.off(it.onSendMessageForUserDisableChanged,this.onSendMessageForUserDisableChanged),(B=Cn.instance)==null||B.off(it.onUserSigExpired,this.onUserSigExpired),(V=Cn.instance)==null||V.off(it.onKickedOffLine,this.onKickedOffLine),(H=Cn.instance)==null||H.off(it.onAllUserCameraDisableChanged,this.onAllUserCameraDisableChanged),(z=Cn.instance)==null||z.off(it.onAllUserMicrophoneDisableChanged,this.onAllUserMicrophoneDisableChanged),(ne=Cn.instance)==null||ne.off(it.onSendMessageForAllUserDisableChanged,this.onSendMessageForAllUserDisableChanged),this.tim.off(or.EVENT.MESSAGE_RECEIVED,this.onReceiveMessage)}onError(g){Qt.error("roomEngine.onError: ",g),g.message==="enter trtc room failed , error code : -1"&&this.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{type:"warning",message:Pn("Failed to enter the meeting"),callback:()=>{this.resetStore()}})}onRoomDismissed(g){let{roomId:T}=g;Qt.log(`${wg}onRoomDismissed:`,T),this.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{title:Pn("Note"),message:Pn("The host closed the room."),confirmButtonText:Pn("Sure"),callback:()=>Oe(this,null,function*(){this.emit(Nt.ROOM_DISMISS,{}),this.resetStore()})})}onReceiveMessage(g){let T=[or.TYPES.MSG_TEXT,or.TYPES.MSG_IMAGE,or.TYPES.MSG_FILE,or.TYPES.MSG_FACE,or.TYPES.MSG_VIDEO];!g||!g.data||g.data.forEach(v=>{var w,N,B,V;let z=((N=(w=getCurrentPages())==null?void 0:w.slice(-1)[0])==null?void 0:N.route)===this.chatStore.route;T.includes(v.type)&&!z&&((V=this.chatStore)==null||V.updateUnReadCount((((B=this.chatStore)==null?void 0:B.unReadCount)||0)+1))})}onUserVoiceVolumeChanged(g){let{userVolumeList:T}=g;this.roomStore.setAudioVolume(T)}onUserNetworkQualityChanged(g){this.basicStore.setLocalQuality(g.userNetworkList)}onKickedOutOfRoom(g){return Oe(this,null,function*(){let{roomId:T,reason:v,message:w}=g;try{let N="";switch(v){case Du.kKickedByAdmin:N=Pn("kicked out of the room by the host");break;case Du.kKickedByLoggedOnOtherDevice:N=Pn("kicked out of the room by other device");break;case Du.kKickedByServer:N=Pn("kicked out of the room by serve");break}this.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{title:Pn("Note"),message:N,confirmButtonText:Pn("Sure"),showCancel:!1,appendToRoomContainer:!0,callback:()=>Oe(this,null,function*(){this.emit(Nt.KICKED_OUT,{roomId:T,reason:v,message:w}),this.resetStore()})})}catch(N){Qt.error(`${wg}onKickedOutOfRoom error:`,N)}})}onSendMessageForUserDisableChanged(g){let{userId:T,isDisable:v}=g;if(T===this.roomStore.localUser.userId){let w=Pn(v?"You have been banned from text chat":"You are allowed to text chat");this.emit(Nt.ROOM_NOTICE_MESSAGE,{code:-1,type:"warning",message:w,duration:ln.NORMAL}),this.chatStore.setSendMessageDisableChanged(v)}this.roomStore.setMuteUserChat(T,v)}onUserSigExpired(){this.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{title:Pn("Note"),message:Pn("userSig \u5DF2\u8FC7\u671F"),showCancel:!1,confirmButtonText:Pn("Sure"),appendToRoomContainer:!0,callback:()=>{this.emit(Nt.USER_SIG_EXPIRED,{})}})}onKickedOffLine(g){let{message:T}=g;this.emit(Nt.ROOM_NOTICE_MESSAGE_BOX,{title:Pn("Note"),message:Pn("\u7CFB\u7EDF\u68C0\u6D4B\u5230\u60A8\u7684\u8D26\u53F7\u88AB\u8E22\u4E0B\u7EBF"),showCancel:!1,confirmButtonText:Pn("Sure"),appendToRoomContainer:!0,callback:()=>Oe(this,null,function*(){this.emit(Nt.KICKED_OFFLINE,{message:T})})})}onAllUserCameraDisableChanged(g){return Oe(this,null,function*(){let{isDisable:T}=g;T!==this.roomStore.isCameraDisableForAllUser&&this.roomStore.localUser.userRole===Et.kGeneralUser&&this.roomStore.setCanControlSelfVideo(!T),this.handleVideoStateChange(T),this.roomStore.setDisableCameraForAllUserByAdmin(T)})}handleVideoStateChange(g){return Oe(this,null,function*(){var T;let v=Pn(g?"All videos disabled":"All videos enabled");this.emit(Nt.ROOM_NOTICE_MESSAGE,{type:"success",message:v,duration:ln.NORMAL}),g&&this.roomStore.localUser.userRole===Et.kGeneralUser&&(yield(T=Cn.instance)==null?void 0:T.closeLocalCamera())})}onAllUserMicrophoneDisableChanged(g){return Oe(this,null,function*(){let{isDisable:T}=g;T!==this.roomStore.isMicrophoneDisableForAllUser&&this.roomStore.localUser.userRole===Et.kGeneralUser&&this.roomStore.setCanControlSelfAudio(!T),this.handleAudioStateChange(T),this.roomStore.setDisableMicrophoneForAllUserByAdmin(T)})}onSendMessageForAllUserDisableChanged(g){return Oe(this,null,function*(){let{isDisable:T}=g;T!==this.roomStore.isMessageDisableForAllUser&&this.roomStore.localUser.userRole===Et.kGeneralUser&&this.handleMessageStateChange(T),this.roomStore.setDisableMessageAllUserByAdmin(T)})}handleMessageStateChange(g){return Oe(this,null,function*(){let T=Pn(g?"Disabling text chat for all is enabled":"Unblocked all text chat");this.emit(Nt.ROOM_NOTICE_MESSAGE,{type:"success",message:T,duration:ln.NORMAL})})}handleAudioStateChange(g){return Oe(this,null,function*(){var T;let v=Pn(g?"All audios disabled":"All audios enabled");this.emit(Nt.ROOM_NOTICE_MESSAGE,{type:"success",message:v,duration:ln.NORMAL}),g&&this.roomStore.localUser.userRole===Et.kGeneralUser&&(yield(T=Cn.instance)==null?void 0:T.muteLocalAudio())})}resetStore(){this.basicStore.reset(),this.chatStore.reset(),this.roomStore.reset()}storeInit(g){this.basicStore.setBasicInfo(g),this.roomStore.setLocalUser(g)}initRoomKit(g){return Oe(this,null,function*(){this.storeInit(g);let{sdkAppId:T,userId:v,userSig:w}=g,N={sdkAppId:T,userId:v,userSig:w};uni.$tim&&(N.tim=uni.$tim),yield rt.login(N),this.tim=rt.getTIM(),this.bindChatEvents(),this.emit(Nt.ROOM_LOGIN)})}start(g,T){return Oe(this,null,function*(){return this.roomActionManager.start(g,T)})}join(g,T){return Oe(this,null,function*(){return this.roomActionManager.join(g,T)})}createRoom(g){return Oe(this,null,function*(){yield this.roomActionManager.createRoom(g)})}enterRoom(g){return Oe(this,null,function*(){yield this.roomActionManager.enterRoom(g)})}leaveRoom(){return Oe(this,null,function*(){yield this.roomActionManager.leaveRoom()})}dismissRoom(){return Oe(this,null,function*(){yield this.roomActionManager.dismissRoom()})}handleRoomEngineReady(){return Oe(this,null,function*(){var g;let T=uni.getStorageSync("tuiRoom-currentTheme");if(T&&this.basicStore.setDefaultTheme(T),Ro)return;let v=(g=Cn.instance)==null?void 0:g.getTRTCCloud(),w=Fn?Zo.TRTCVideoMirrorType_Auto:this.basicStore.isLocalStreamMirror?Zo.TRTCVideoMirrorType_Enable:Zo.TRTCVideoMirrorType_Disable;yield v==null?void 0:v.setLocalRenderParams({mirrorType:w,rotation:Qr.TRTCVideoRotation0,fillMode:Xr.TRTCVideoFillMode_Fill})})}logOut(){this.resetStore()}on(g,T){this.emitter.on(g,T)}off(g,T){this.emitter.off(g,T)}emit(g,T){this.emitter.emit(g,T)}setSelfInfo(g){return this.userManager.setSelfInfo(g)}},yt=Fl.getInstance(),d_=(0,h.defineComponent)({__name:"index",emits:["on-exit-room","on-destroy-room"],setup(f,{emit:g}){let{t:T,isShowLeaveRoomDialog:v,roomStore:w,basicStore:N,roomEngine:B,stopMeeting:V,cancel:H,DialogType:z,logPrefix:ne,currentDialogType:ge,visible:pe,resetState:oe,toggleMangeMemberSidebar:de,searchName:ae,hasNoData:te,handleShowMemberControl:J,filteredList:Le,selectedUser:re,showSideBar:Be,remoteUserList:Ye,isMasterWithOneRemoteUser:Xe,isMasterWithRemoteUser:Ne}=Yh(),me=g;function A(){V()}function Me(){if(!w.isMaster){ze();return}if(Ne.value){if(re.value=Ye.value[0].userId,Xe.value){gn();return}ge.value=z.TransferDialog,de(),oe();return}}function O(){return Oe(this,null,function*(){try{Qt.log(`${ne}dismissRoom: enter`),oe(),yield yt.dismissRoom()}catch(pt){Qt.error(`${ne}dismissRoom error:`,pt)}})}function ze(){return Oe(this,null,function*(){try{oe(),yield yt.leaveRoom()}catch(pt){Qt.error(`${ne}leaveRoom error:`,pt)}})}function gn(){return Oe(this,null,function*(){var pt;if(re.value)try{let dt=re.value,He=yield(pt=B.instance)==null?void 0:pt.changeUserRole({userId:dt,userRole:Et.kRoomOwner});Qt.log(`${ne}transferAndLeave:`,He),yield yt.leaveRoom(),N.setSidebarOpenStatus(!1),N.setSidebarName(""),oe(),me("on-exit-room",{code:0,message:""})}catch(dt){Qt.error(`${ne}transferAndLeave error:`,dt)}})}let ct=pt=>Oe(this,null,function*(){try{let{roomId:dt}=pt;Qt.log(`${ne}onRoomDismissed:`,dt),tc({title:T("Note"),message:T("The host closed the room."),showCancel:!1,appendToRoomContainer:!0,confirmButtonText:T("Sure"),callback:()=>Oe(this,null,function*(){oe(),me("on-destroy-room",{code:0,message:""})})})}catch(dt){Qt.error(`${ne}onRoomDestroyed error:`,dt)}});return rt.once("ready",()=>{var pt;(pt=B.instance)==null||pt.on(it.onRoomDismissed,ct)}),(0,h.onUnmounted)(()=>{var pt;(pt=B.instance)==null||pt.off(it.onRoomDismissed,ct)}),(pt,dt)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createElementVNode)("div",{class:"end-control-container"},[(0,h.createElementVNode)("div",{class:"end-button",tabindex:"1",onClick:A},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:"EndRoomIcon",size:"20",color:"red"}),(0,h.createElementVNode)("u-text",{class:"end-button-title"},(0,h.toDisplayString)((0,h.unref)(T)("EndH5")),1)])]),(0,h.unref)(pe)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"end-main-content"},[(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)((0,h.unref)(v)?"end-dialog-leave":"end-dialog-dismiss")},[(0,h.unref)(ge)===(0,h.unref)(z).BasicDialog?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0},[(0,h.unref)(w).isMaster?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"end-dialog-header"},[(0,h.unref)(w).isMaster?((0,h.openBlock)(),(0,h.createElementBlock)("u-text",{key:0,class:"end-dialog-text"},(0,h.toDisplayString)((0,h.unref)(T)("If you do not want to end the meeting, please designate a new host before leaving the meeting.")),1)):((0,h.openBlock)(),(0,h.createElementBlock)("u-text",{key:1},(0,h.toDisplayString)((0,h.unref)(T)("Are you sure you want to leave this room?")),1))])):(0,h.createCommentVNode)("",!0)])):(0,h.createCommentVNode)("",!0),(0,h.unref)(ge)===(0,h.unref)(z).BasicDialog?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:"dialog-middle-content"},[(0,h.unref)(w).isMaster?((0,h.openBlock)(),(0,h.createElementBlock)("u-text",{key:0,class:(0,h.normalizeClass)((0,h.unref)(v)?"end-button-dismiss":"end-button-dismiss-single"),onClick:(0,h.withModifiers)(O,["stop"])},(0,h.toDisplayString)((0,h.unref)(T)("Dismiss")),3)):(0,h.createCommentVNode)("",!0),(0,h.unref)(v)?((0,h.openBlock)(),(0,h.createElementBlock)("u-text",{key:1,class:(0,h.normalizeClass)((0,h.unref)(w).isMaster?"end-button-leave":"end-button-leave-single"),onClick:Me},(0,h.toDisplayString)((0,h.unref)(T)("Leave")),3)):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("u-text",{class:"end-button-cancel",onClick:dt[0]||(dt[0]=(0,h.withModifiers)((...He)=>(0,h.unref)(H)&&(0,h.unref)(H)(...He),["stop"]))},(0,h.toDisplayString)((0,h.unref)(T)("Cancel")),1)])):(0,h.createCommentVNode)("",!0),(0,h.unref)(ge)===(0,h.unref)(z).TransferDialog?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:2},[(0,h.createElementVNode)("u-text",{class:"end-button-cancel",onClick:dt[1]||(dt[1]=(0,h.withModifiers)((...He)=>(0,h.unref)(H)&&(0,h.unref)(H)(...He),["stop"]))},(0,h.toDisplayString)((0,h.unref)(T)("Cancel")),1)])):(0,h.createCommentVNode)("",!0)],2)])):(0,h.createCommentVNode)("",!0),(0,h.unref)(Be)?((0,h.openBlock)(),(0,h.createBlock)(jg,{key:1,title:(0,h.unref)(T)("Appoint a new host"),class:"transfer-container"},{sidebarContent:(0,h.withCtx)(()=>[(0,h.createElementVNode)("div",{style:{height:"1440rpx"}},[(0,h.createElementVNode)("div",{class:"transfer-list-container"},[(0,h.createElementVNode)("div",{class:"transfer-header"},[(0,h.createElementVNode)("div",{class:"search-container"},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:"SearchIcon"}),(0,h.createElementVNode)("u-input",{modelValue:(0,h.unref)(ae),onInput:dt[2]||(dt[2]=He=>(0,h.isRef)(ae)?ae.value=He.detail.value:null),type:"text",class:"searching-input",placeholder:(0,h.unref)(T)("Search for conference attendees"),enterkeyhint:"done"},null,40,["modelValue","placeholder"])])]),(0,h.createElementVNode)("div",{class:"transfer-body"},[(0,h.createElementVNode)("scroll-view",{class:"scroll-view",scrollY:"true"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(Le),He=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:He.userId,class:"transfer-list-content",onClick:ee=>(0,h.unref)(J)(He.userId)},[(0,h.createElementVNode)("div",{class:"member-basic-info"},[(0,h.createElementVNode)("div",{class:"avatar-url"},[(0,h.createVNode)(ku,{"img-src":He.avatarUrl},null,8,["img-src"])]),(0,h.createElementVNode)("u-text",{class:"user-name"},(0,h.toDisplayString)(He.userName||He.userId),1)]),(0,h.unref)(re)===He.userId?((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:0,icon:"CorrectIcon",color:"#006EFF"})):(0,h.createCommentVNode)("",!0)],8,["onClick"]))),128))]),(0,h.unref)(te)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"member-hasNoData"},[(0,h.createElementVNode)("div",{class:"no-data-region"},[(0,h.createElementVNode)("u-text",{class:"no-data-text"},(0,h.toDisplayString)((0,h.unref)(T)("No relevant user found.")),1)])])):(0,h.createCommentVNode)("",!0)]),(0,h.createElementVNode)("div",{class:"transfer-leave",onClick:gn},[(0,h.createElementVNode)("div",{class:"transfer-button"},[(0,h.createElementVNode)("u-text",{class:"transfer-text"},(0,h.toDisplayString)((0,h.unref)(T)("Transfer and leave")),1)])])])])]),_:1},8,["title"])):(0,h.createCommentVNode)("",!0)]))}}),p_={"end-button":{".end-control-container ":{display:"flex",alignItems:"center",flexDirection:"row"}},"end-button-title":{".end-control-container .end-button ":{fontWeight:"400",lineHeight:21,fontSize:12,color:"#ff2e2e",marginLeft:3}},"dialog-middle-content":{"":{width:"750rpx",display:"flex",flexDirection:"column"}},"end-main-content":{"":{position:"fixed",left:0,top:0,bottom:0,width:"750rpx",backgroundColor:"rgba(0,0,0,0.7)"}},"end-dialog-leave":{".end-main-content ":{borderRadius:14,position:"fixed",right:0,left:0,bottom:"144rpx",zIndex:9}},"end-dialog-dismiss":{".end-main-content ":{borderRadius:14,position:"fixed",right:0,left:0,bottom:"144rpx",zIndex:9}},"manage-transfer":{".end-main-content .end-dialog-leave ":{position:"absolute",top:0},".end-main-content .end-dialog-dismiss ":{position:"absolute",top:0}},"end-dialog-header":{".end-main-content .end-dialog-leave ":{backgroundColor:"#cacacb",height:56,width:"750rpx",borderTopLeftRadius:14,borderTopRightRadius:14,borderBottomWidth:.5,borderBottomStyle:"solid",borderBottomColor:"#4f4e4e",display:"flex",justifyContent:"center",alignItems:"center"},".end-main-content .end-dialog-dismiss ":{backgroundColor:"#cacacb",height:56,width:"750rpx",borderTopLeftRadius:14,borderTopRightRadius:14,borderBottomWidth:.5,borderBottomStyle:"solid",borderBottomColor:"#4f4e4e",display:"flex",justifyContent:"center",alignItems:"center"}},"end-dialog-text":{".end-main-content .end-dialog-leave .end-dialog-header ":{width:230,fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:14,lineHeight:17,textAlign:"center",color:"#6a6c74"},".end-main-content .end-dialog-dismiss .end-dialog-header ":{width:230,fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:14,lineHeight:17,textAlign:"center",color:"#6a6c74"}},"end-button-dismiss":{".end-main-content .end-dialog-leave ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#ff2e2e",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0},".end-main-content .end-dialog-dismiss ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#ff2e2e",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0}},"end-button-leave":{".end-main-content .end-dialog-leave ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#007aff",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,borderBottomLeftRadius:14,borderBottomRightRadius:14,borderTopWidth:.5,borderTopStyle:"solid",borderTopColor:"#8f8e8e"},".end-main-content .end-dialog-dismiss ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#007aff",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,borderBottomLeftRadius:14,borderBottomRightRadius:14,borderTopWidth:.5,borderTopStyle:"solid",borderTopColor:"#8f8e8e"}},"end-button-cancel":{".end-main-content .end-dialog-leave ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"600",fontSize:20,lineHeight:24,textAlign:"center",color:"#007aff",backgroundColor:"#ffffff",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,position:"fixed",bottom:5,left:0,borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center"},".end-main-content .end-dialog-dismiss ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"600",fontSize:20,lineHeight:24,textAlign:"center",color:"#007aff",backgroundColor:"#ffffff",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,position:"fixed",bottom:5,left:0,borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center"}},"end-button-dismiss-single":{".end-main-content .end-dialog-leave ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#ff2e2e",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,borderBottomLeftRadius:14,borderBottomRightRadius:14,display:"flex",alignItems:"center",justifyContent:"center"},".end-main-content .end-dialog-dismiss ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#ff2e2e",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,borderBottomLeftRadius:14,borderBottomRightRadius:14,display:"flex",alignItems:"center",justifyContent:"center"}},"end-button-leave-single":{".end-main-content .end-dialog-leave ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#ff2e2e",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center"},".end-main-content .end-dialog-dismiss ":{width:"750rpx",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:20,lineHeight:24,textAlign:"center",color:"#ff2e2e",backgroundColor:"#cacacb",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,borderRadius:14,display:"flex",alignItems:"center",justifyContent:"center"}},"transfer-container":{"":{position:"fixed",left:0,top:0,height:"1440rpx",zIndex:102}},"transfer-list-container":{".transfer-container ":{position:"relative",height:"1440rpx",display:"flex",flexDirection:"column",alignItems:"stretch"}},"transfer-header":{".transfer-container ":{display:"flex",flexDirection:"row",justifyContent:"center",paddingTop:0,paddingRight:16,paddingBottom:0,paddingLeft:16}},"search-container":{".transfer-container .transfer-header ":{height:34,borderRadius:8,backgroundColor:"#d4d4d4",display:"flex",flexDirection:"row",paddingTop:0,paddingRight:16,paddingBottom:0,paddingLeft:16,color:"#676c80",flex:1,alignItems:"center"}},"searching-input":{".transfer-container .transfer-header .search-container ":{flex:1}},"transfer-body":{".transfer-container ":{flex:1,display:"flex",marginTop:20,flexDirection:"column",alignItems:"stretch"}},"scroll-view":{".transfer-container .transfer-body ":{display:"flex",flex:1,flexDirection:"column",alignItems:"stretch"}},"transfer-list-content":{".transfer-container .transfer-body ":{paddingBottom:0,marginBottom:10,display:"flex",flexDirection:"row",alignItems:"center",height:69,justifyContent:"space-between",paddingTop:0,paddingRight:32,paddingLeft:32}},"member-basic-info":{".transfer-container .transfer-body .transfer-list-content ":{display:"flex",position:"relative",flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},"avatar-url":{".transfer-container .transfer-body .transfer-list-content .member-basic-info ":{"!width":40,"!height":40,borderRadius:50}},"user-name":{".transfer-container .transfer-body .transfer-list-content .member-basic-info ":{flex:1,marginLeft:9,color:"#000000",textOverflow:"ellipsis",overflow:"hidden",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500","!fontSize":16,lineHeight:22,lines:1}},correct:{".transfer-container .transfer-body .transfer-list-content ":{position:"absolute",right:5}},"member-hasNoData":{".transfer-container .transfer-body ":{marginTop:30,display:"flex",flexDirection:"row",justifyContent:"center"}},"no-data-region":{".transfer-container .transfer-body .member-hasNoData ":{backgroundColor:"#F6F6F6",width:200,borderRadius:4,display:"flex",flexDirection:"row",justifyContent:"center"}},"no-data-text":{".transfer-container .transfer-body .member-hasNoData .no-data-region ":{color:"#000000"}},"transfer-leave":{"":{display:"flex",alignItems:"center",justifyContent:"center",marginBottom:40,marginTop:10}},"transfer-button":{".transfer-leave ":{width:300,height:40,backgroundColor:"#006eff",borderRadius:8,display:"flex",flexDirection:"row",justifyContent:"center",alignItems:"center"}},"transfer-text":{".transfer-leave .transfer-button ":{color:"#FFFFFF",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:16,lineHeight:22}}},g_=Dt(d_,[["styles",[p_]]]),h_=(0,h.defineComponent)({__name:"SwitchCamera",setup(f){let g=zn(),T=qt(),{isFrontCamera:v}=(0,Mt.storeToRefs)(T);function w(){return Oe(this,null,function*(){var N;let B=(N=g.instance)==null?void 0:N.getMediaDeviceManager();yield B==null?void 0:B.switchCamera({isFrontCamera:!v.value}),T.setIsFrontCamera(!v.value)})}return(N,B)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"camera-icon",onClick:w},[(0,h.createVNode)(Sn,{icon:"CameraSwitchIcon",size:"20"})]))}}),__={"camera-icon":{"":{display:"flex"}}},f_=Dt(h_,[["styles",[__]]]),m_=(0,h.defineComponent)({__name:"SwitchMirror",setup(f){let g=zn(),T=qt();function v(){var w;let N=(w=g.instance)==null?void 0:w.getTRTCCloud();N==null||N.setLocalRenderParams({mirrorType:T.isLocalStreamMirror?Zo.TRTCVideoMirrorType_Enable:Zo.TRTCVideoMirrorType_Disable,rotation:Qr.TRTCVideoRotation0,fillMode:Xr.TRTCVideoFillMode_Fill}),T.setIsLocalStreamMirror(T.isLocalStreamMirror),T.isLocalStreamMirror=!T.isLocalStreamMirror}return(w,N)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"mirror-icon",onClick:v},[(0,h.createVNode)(Sn,{icon:"MirrorIcon",size:"16"})]))}}),v_={"mirror-icon":{"":{display:"flex"}}},y_=Dt(m_,[["styles",[v_]]]);function Jg(){let{t:f}=on(),g=qt(),{roomId:T,shareLink:v,isRoomLinkVisible:w,isSchemeLinkVisible:N}=(0,Mt.storeToRefs)(g),{origin:B,pathname:V}=location||{},H=(0,h.ref)(!0),z=(0,h.computed)(()=>{if(v.value){let ae=v.value.indexOf("?")!==-1?"&":"?";return`${v.value}${ae}roomId=${T.value}`}return`${B}${V}#/home?roomId=${T.value}`}),ne=(0,h.computed)(()=>`tuiroom://joinroom?roomId=${T.value}`),ge=(0,h.computed)(()=>w.value?f("You can share the room number or link to invite more people to join the room."):f("You can share the room number to invite more people to join the room"));function pe(ae){return Oe(this,null,function*(){try{yield Op(ae),kt({message:f("Copied successfully"),type:"success"})}catch(te){kt({message:f("Copied failure"),type:"error"})}})}let oe=(0,h.computed)(()=>[{id:1,mobileTitle:"Room ID",pcTitle:"Invite by room number",content:T.value,copyLink:T.value,visible:H.value},{id:3,mobileTitle:"scheme",pcTitle:"Invite via client scheme",content:ne.value,copyLink:ne.value,visible:N.value}]),de=(0,h.computed)(()=>oe.value.filter(ae=>ae.visible));return{t:f,isRoomLinkVisible:w,roomId:T,origin:B,pathname:V,isElectron:Aa,inviteLink:z,schemeLink:ne,inviteBarTitle:ge,onCopy:pe,visibleInviteContentList:de}}function I_(){Jg();let f=qt(),g=Dn(),{roomId:T,isRoomLinkVisible:v}=(0,Mt.storeToRefs)(f),{masterUserId:w}=(0,Mt.storeToRefs)(g),{t:N}=on(),B=(0,h.ref)(!1),V=(0,h.computed)(()=>g.isFreeSpeakMode?N("Free Speech Room"):N("On-stage Speaking Room")),H=(0,h.ref)(!1);yt.getComponentConfig(["RoomLink"]);let z=(0,h.computed)(()=>g.getUserName(w.value)||w.value),ne=(0,h.computed)(()=>z.value),ge=(0,h.computed)(()=>`${z.value}${N("Quick Meeting")}`),pe=(0,h.computed)(()=>[{id:1,title:"Host",content:z.value,copyLink:"",isShowCopyIcon:!1,visible:!0},{id:2,title:"Room Type",content:V.value,copyLink:"",isShowCopyIcon:!1,visible:!0},{id:3,title:"Room ID",content:T.value,copyLink:T.value,isShowCopyIcon:!0,visible:!0}]);function oe(){B.value=!B.value,H.value=!H.value}function de(){(B.value||H.value)&&(B.value=!1,H.value=!1)}function ae(){B.value=!1,H.value=!1}function te(J){return Oe(this,null,function*(){try{yield Op(J),kt({message:N("Copied successfully"),type:"success"})}catch(Le){kt({message:N("Copied failure"),type:"error"})}})}return{t:N,arrowDirection:H,isShowRoomInfo:B,isShowRoomInfoTitle:ne,conferenceTitle:ge,roomInfoTabList:pe,handleCloseRoomInfo:ae,toggleShowRoomInfoStatus:oe,handleClickOutsideRoomInfoContainer:de,onCopy:te}}var M_=(0,h.defineComponent)({__name:"RoomTime",setup(f){let g=(0,h.ref)(0),T=null,v=(0,h.computed)(()=>{let N=Math.floor(g.value/60),B=g.value%60;return`${N.toString().padStart(2,"0")}:${B.toString().padStart(2,"0")}`});function w(){T=setInterval(()=>{g.value+=1},1e3)}return(0,h.onMounted)(()=>{w()}),(0,h.onUnmounted)(()=>{T&&clearInterval(T)}),(N,B)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"timing"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(v.value),1)]))}}),C_={timing:{"":{textAlign:"center",fontSize:14,fontWeight:"500",lineHeight:20}}},T_=Dt(M_,[["styles",[C_]]]),S_=(0,h.defineComponent)({__name:"index",setup(f){let{t:g,arrowDirection:T,handleCloseRoomInfo:v,isShowRoomInfo:w,isShowRoomInfoTitle:N,conferenceTitle:B,roomInfoTabList:V,toggleShowRoomInfoStatus:H,onCopy:z}=I_();return(ne,ge)=>(0,h.unref)(N)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"conference-container"},[(0,h.createElementVNode)("div",{class:"title-container",onClick:ge[0]||(ge[0]=(...pe)=>(0,h.unref)(H)&&(0,h.unref)(H)(...pe))},[(0,h.createElementVNode)("div",{class:"title-text"},[(0,h.createElementVNode)("span",{class:"text"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(B)),1)]),(0,h.createElementVNode)("span",{class:(0,h.normalizeClass)(["arrow-icon",{"arrow-down-icon":(0,h.unref)(T)}])},[(0,h.createVNode)(Sn,{icon:"ArrowUpIcon"})],2)]),(0,h.createVNode)(T_,{class:"text"})]),(0,h.unref)(w)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"roomInfo-container",onTouchmove:(0,h.withModifiers)(()=>{},["stop","prevent"])},[(0,h.createElementVNode)("div",{class:"roomInfo-container-main"},[(0,h.createElementVNode)("div",{class:"roomInfo-conference-title"},[(0,h.createElementVNode)("u-text",{class:"master-header"},(0,h.toDisplayString)((0,h.unref)(B)),1),(0,h.createElementVNode)("u-text",{class:"cancel",onClick:ge[1]||(ge[1]=(...pe)=>(0,h.unref)(v)&&(0,h.unref)(v)(...pe))},(0,h.toDisplayString)((0,h.unref)(g)("Cancel")),1)]),((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(V),pe=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:pe.id},[pe.visible?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"roomInfo-content"},[(0,h.createElementVNode)("u-text",{class:"roomInfo-title"},(0,h.toDisplayString)((0,h.unref)(g)(pe.title)),1),(0,h.createElementVNode)("u-text",{class:"roomInfo-item"},(0,h.toDisplayString)(pe.content),1),pe.isShowCopyIcon&&pe.visible?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"copy-container",onClick:oe=>(0,h.unref)(z)(pe.copyLink)},[(0,h.createVNode)(Sn,{style:{display:"flex"},class:"copy",icon:"CopyIcon"})],8,["onClick"])):(0,h.createCommentVNode)("",!0)])):(0,h.createCommentVNode)("",!0)]))),128)),(0,h.unref)(Bl)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"roomInfo-bottom"},[(0,h.createElementVNode)("span",null,[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(g)("You can share the room number or link to invite more people to join the room.")),1)])])):(0,h.createCommentVNode)("",!0)])],32)):(0,h.createCommentVNode)("",!0)])):(0,h.createCommentVNode)("",!0)}}),D_={"title-container":{"":{display:"flex",flexDirection:"column",alignItems:"center"}},"title-text":{".title-container ":{flexDirection:"row",alignItems:"center"}},"arrow-icon":{".title-container ":{display:"flex",marginLeft:5,alignItems:"center",transform:"rotate(180deg)"}},"arrow-down-icon":{".title-container ":{transform:"rotate(0deg)"}},text:{"":{fontSize:14,fontWeight:"500",overflow:"hidden",textOverflow:"ellipsis",color:"#000000"}},"text-right":{"":{paddingLeft:30}},"text-type":{"":{paddingLeft:12}},"roomInfo-middle":{"":{color:"#141313",paddingLeft:25}},"roomInfo-container":{"":{position:"fixed",left:0,top:0,bottom:0,width:"750rpx",backgroundColor:"rgba(0,0,0,0.7)"}},"roomInfo-container-main":{".roomInfo-container ":{width:"750rpx",backgroundColor:"#d4d4d4",borderTopLeftRadius:15,borderTopRightRadius:15,borderBottomRightRadius:0,borderBottomLeftRadius:0,position:"fixed",bottom:0,display:"flex",flexDirection:"column",paddingBottom:20}},"roomInfo-conference-title":{".roomInfo-container .roomInfo-container-main ":{display:"flex",flexDirection:"row",alignItems:"center",paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:25}},"master-header":{".roomInfo-container .roomInfo-container-main .roomInfo-conference-title ":{overflow:"hidden",textOverflow:"ellipsis",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:0,fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:20,lineHeight:24,color:"#141313"}},cancel:{".roomInfo-container .roomInfo-container-main .roomInfo-conference-title ":{fontFamily:'"PingFang SC"',fontStyle:"normal",lineHeight:24,color:"#141313",flex:1,textAlign:"right",fontWeight:"400",paddingRight:30,fontSize:16}},"roomInfo-content":{".roomInfo-container .roomInfo-container-main ":{display:"flex",alignItems:"stretch",flexDirection:"row",paddingTop:5,paddingRight:25,paddingBottom:5,paddingLeft:25}},"roomInfo-title":{".roomInfo-container .roomInfo-container-main .roomInfo-content ":{display:"flex",width:"225rpx",fontSize:14,fontWeight:"400",color:"#141313"}},"roomInfo-item":{".roomInfo-container .roomInfo-container-main .roomInfo-content ":{width:"375rpx",overflow:"hidden",textOverflow:"ellipsis",fontSize:14,fontWeight:"400",color:"#141313"}},"copy-container":{".roomInfo-container .roomInfo-container-main .roomInfo-content ":{position:"absolute",right:"40rpx"}},copy:{".roomInfo-container .roomInfo-container-main .roomInfo-content .copy-container ":{width:20,height:20}},"roomInfo-bottom":{".roomInfo-container .roomInfo-container-main ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:12,lineHeight:17,textAlign:"center",color:"#141313",paddingTop:2,paddingLeft:"40rpx"}}},E_=Dt(S_,[["styles",[D_]]]),R_=(location==null?void 0:location.protocol)==="file:"||(location==null?void 0:location.hostname)==="localhost"||(location==null?void 0:location.hostname)==="127.0.0.1",$g=(location==null?void 0:location.host)==="web.sdk.qcloud.com",L_=R_||$g,k_=$g,A_=Fn?"TUIRoomKit-H5-vue3":"TUIRoomKit-Web",Cp=class{constructor(){this.sdkAppId=0,this.projectName=A_,this.isUploadLoaded=L_,this.isUploadDetailEvent=k_,this.hasUploadedEventList=[],this.storedReportEventList=[]}setSdkAppId(g){this.sdkAppId=g}reportEvent(g){if(!this.isUploadLoaded)return;let{name:T,ext1:v}=g;if(this.isUploadDetailEvent||T==="loaded"){let w=jp(Xd({},g),{ext2:this.projectName,ext3:this.sdkAppId});this.storedReportEventList.push(w)}}},O_=new Cp,ec=O_,N_="/assets/ArrowUpIcon.f4c7f21f.png",xl=(f=>(f.VERTICAl="vertical",f.HORIZONTAL="horizontal",f))(xl||{}),Xg={videoResolution:$r.TRTCVideoResolution_640_360,videoFps:15,videoBitrate:800},b_="/assets/UnSupportIcon.eb1c5edd.png",P_=(0,h.defineComponent)({__name:"IconButton",props:{title:{default:"",type:String},hasMore:{type:Boolean,default:!1},hideHoverEffect:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},isActive:{type:Boolean,default:!1},layout:{default:xl.VERTICAl,type:String},icon:{default:null,type:null},isNotSupport:{type:Boolean,default:!1}},emits:["click-icon","click-more"],setup(f,{emit:g}){let T=f,v=g,w=(0,h.computed)(()=>T.layout===xl.HORIZONTAL?"icon-content-horizontal":"icon-content-vertical"),N=()=>{v("click-icon")};return(B,V)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"icon-button-container"},[(0,h.unref)(Fn)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,onClick:N,class:(0,h.normalizeClass)(["icon-content",w.value,`${B.disabled&&"disabled"}`])},[(0,h.renderSlot)(B.$slots,"default"),B.icon?((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:0,style:{display:"flex"},size:"24",icon:B.icon},null,8,["icon"])):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("u-text",{class:"title"},(0,h.toDisplayString)(B.title),1)],2)):((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:(0,h.normalizeClass)(["icon-content",w.value,`${B.disabled&&"disabled"}`]),onClick:N},[(0,h.renderSlot)(B.$slots,"default"),B.icon?((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:0,style:{display:"flex"},size:"24",icon:B.icon},null,8,["icon"])):(0,h.createCommentVNode)("",!0),B.isNotSupport?((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:1,style:{display:"flex"},class:"unsupport-icon",icon:(0,h.unref)(b_)},null,8,["icon"])):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("u-text",{class:"title"},(0,h.toDisplayString)(B.title)+" ",1)],2)),B.hasMore?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:2,ref:"moreSpanRef",class:"icon-arrow",onClick:V[0]||(V[0]=H=>B.$emit("click-more"))},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:(0,h.unref)(N_)},null,8,["icon"])],512)):(0,h.createCommentVNode)("",!0)]))}}),G_={"icon-button-container":{"":{position:"relative",display:"flex",alignItems:"center",color:"#4F586B"}},"icon-content":{".icon-button-container .disabled":{opacity:.4},".icon-button-container ":{"backgroundColor:hover":"rgba(79,88,107,0.05)"}},"icon-content-horizontal":{".icon-button-container ":{display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:6,height:32,flexDirection:"row",paddingTop:0,paddingRight:5,paddingBottom:0,paddingLeft:5}},title:{".icon-button-container .icon-content-horizontal ":{fontSize:14,lineHeight:26,fontWeight:"600",marginLeft:4},".icon-button-container .icon-content-vertical ":{fontSize:12,lineHeight:20,fontWeight:"500",marginTop:4}},"icon-content-vertical":{".icon-button-container ":{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",borderRadius:6,height:56,paddingTop:5,paddingRight:5,paddingBottom:5,paddingLeft:5}},"icon-arrow":{".icon-button-container ":{position:"relative",width:12,height:56,display:"flex",justifyContent:"center",alignItems:"center",borderRadius:6,"backgroundColor:hover":"rgba(79,88,107,0.05)"}},"unsupport-icon":{"":{position:"absolute",top:13,left:26}},"@FONT-FACE":[{"icon-box":{"":{width:72},".hover-effect:hover:before":{width:72},".hover-effect:hover:after":{width:72}}}]},ei=Dt(P_,[["styles",[G_]]]),U_="/assets/SwitchThemeIcon.39885fa7.svg",w_=(0,h.defineComponent)({__name:"SwitchTheme",props:{visible:{type:Boolean,default:!0}},setup(f){let g=qt(),{defaultTheme:T}=(0,Mt.storeToRefs)(g),{t:v}=on(),[w]=yt.getComponentConfig(["SwitchTheme"]);function N(){T.value==="white"?g.setDefaultTheme("black"):T.value==="black"&&g.setDefaultTheme("white")}function B(H){switch(H){case"black":document==null||document.body.classList.remove("tui-theme-white"),document==null||document.body.classList.add("tui-theme-black"),uni.setStorageSync("tuiRoom-currentTheme","black");break;case"white":document==null||document.body.classList.remove("tui-theme-black"),document==null||document.body.classList.add("tui-theme-white"),uni.setStorageSync("tuiRoom-currentTheme","white");break}}let V=uni.getStorageSync("tuiRoom-currentTheme");return V&&g.setDefaultTheme(V),(0,h.watch)(T,H=>{B(H)},{immediate:!0}),(H,z)=>H.visible&&(0,h.unref)(w).visible?((0,h.openBlock)(),(0,h.createBlock)(ei,{key:0,title:(0,h.unref)(v)("Switch Theme"),layout:(0,h.unref)(xl).HORIZONTAL,icon:(0,h.unref)(U_),onClickIcon:N},null,8,["title","layout","icon"])):(0,h.createCommentVNode)("",!0)}}),F_=(0,h.defineComponent)({__name:"index",emits:["log-out","on-destroy-room","on-exit-room"],setup(f,{emit:g}){let T=g,v=(0,h.inject)("showRoomTool"),w=B=>{T("on-destroy-room",B),ec.reportEvent({name:"destroyRoom",ext1:"destroyRoom-success"})},N=B=>{T("on-exit-room",B),ec.reportEvent({name:"exitRoom",ext1:"exitRoom-success"})};return(B,V)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["header",[(0,h.unref)(v)?"":"header-hidden"]])},[(0,h.createElementVNode)("div",{class:"header-container"},[(0,h.createElementVNode)("div",{class:"icon-box"},[(0,h.createVNode)(f_),(0,h.createVNode)(y_)]),(0,h.createVNode)(E_),(0,h.createVNode)(g_,{onOnDestroyRoom:w,onOnExitRoom:N})]),(0,h.createVNode)(w_,{visible:!1})],2))}}),x_={header:{"":{width:"750rpx",height:64,position:"absolute",top:0,left:0,backgroundColor:"#FBFCFE",boxShadow:"0px 1px 0px #e3eaf7",paddingTop:0,paddingRight:12,paddingBottom:0,paddingLeft:12,display:"flex"}},"header-hidden":{"":{"!top":-70}},"header-container":{"":{display:"flex",flex:1,flexDirection:"row",alignItems:"center",justifyContent:"space-between"}},"icon-box":{"":{width:50,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"space-between"}}},q_=Dt(F_,[["styles",[x_]]]),op=(0,h.ref)(0),V_=3e3;function Qg(){let f=(0,h.computed)(()=>V_+op.value),g=()=>(op.value=op.value+1,f.value);return{currentZIndex:f.value,nextZIndex:g}}var B_=(0,h.defineComponent)({__name:"index",props:{modelValue:{type:Boolean,default:!1},title:{default:"",type:String},confirmButton:{default:"",type:String},cancelButton:{default:"",type:String},closeOnClickModal:{type:Boolean,default:!0},appendToBody:{type:Boolean,default:!1},appendToRoomContainer:{type:Boolean,default:!1},modal:{type:Boolean,default:!1}},emits:["update:modelValue","close","confirm","cancel"],setup(f,{emit:g}){let T=(0,h.ref)(!1),v=(0,h.ref)({}),{nextZIndex:w}=Qg(),N=(0,h.ref)(),B=(0,h.computed)(()=>V.title!==""),V=f,H=g;(0,h.watch)(()=>V.modelValue,oe=>{T.value=oe}),(0,h.watch)(T,oe=>{var de;oe&&(v.value={zIndex:w()},V.appendToRoomContainer&&((de=document==null?void 0:document.getElementById("roomContainer"))==null||de.appendChild(N.value)))});function z(){H("confirm"),ge()}function ne(){H("cancel"),ge()}function ge(){T.value=!1,H("update:modelValue",!1),H("close")}function pe(oe){V.closeOnClickModal&&oe.target===oe.currentTarget&&ge()}return(oe,de)=>T.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,ref_key:"dialogRef",ref:N,class:(0,h.normalizeClass)(["overlay-container",[oe.modal&&"overlay"]]),style:(0,h.normalizeStyle)(v.value),onClick:pe},[(0,h.createElementVNode)("div",{class:"dialog-container"},[(0,h.createElementVNode)("u-text",{class:"dialog-title"},(0,h.toDisplayString)(V.title),1),(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)([B.value?"dialog-content":"dialog-content-notitle"])},[(0,h.renderSlot)(oe.$slots,"default")],2),(0,h.createElementVNode)("div",{class:"dialog-footer"},[(0,h.createElementVNode)("u-text",{class:"cancel-button",onClick:ne},(0,h.toDisplayString)(V.cancelButton),1),(0,h.createElementVNode)("u-text",{class:"confirm-button",onClick:z},(0,h.toDisplayString)(V.confirmButton),1)])])],6)):(0,h.createCommentVNode)("",!0)}}),H_={"overlay-container":{"":{position:"fixed",top:0,bottom:0,left:0,right:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"rgba(15,16,20,0.6)"}},"dialog-container":{".overlay-container ":{width:"640rpx",position:"absolute",backgroundColor:"#ffffff",borderRadius:8,display:"flex",flexDirection:"column",fontStyle:"normal",color:"#000000"}},"dialog-title":{".overlay-container .dialog-container ":{fontSize:16,textAlign:"center",fontWeight:"500",paddingTop:24,paddingRight:24,paddingBottom:12,paddingLeft:24}},"dialog-content":{".overlay-container .dialog-container ":{display:"flex",alignItems:"center",fontWeight:"400",fontSize:14,color:"#4F586B",paddingTop:0,paddingRight:24,paddingBottom:20,paddingLeft:24}},"dialog-content-notitle":{".overlay-container .dialog-container ":{fontSize:14,textAlign:"center",paddingTop:40,paddingRight:40,paddingBottom:40,paddingLeft:40}},"dialog-footer":{".overlay-container .dialog-container ":{borderTopWidth:1,borderTopStyle:"solid",borderTopColor:"#d5e0f2",display:"flex",flexDirection:"row"}},"confirm-button":{".overlay-container .dialog-container .dialog-footer ":{flex:1,color:"#1C66E5",textAlign:"center",fontSize:16,fontWeight:"400",paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,display:"flex",alignItems:"center",justifyContent:"center",borderLeftWidth:1,borderLeftStyle:"solid",borderLeftColor:"#d5e0f2"}},"cancel-button":{".overlay-container .dialog-container .dialog-footer ":{flex:1,color:"#4F586B",textAlign:"center",fontSize:16,fontWeight:"400",paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,display:"flex",alignItems:"center",justifyContent:"center"}}},Oa=Dt(B_,[["styles",[H_]]]),K_=(0,h.defineComponent)({__name:"Button",props:{size:{default:void 0,type:String},type:{default:void 0,type:String},customStyle:{type:[Boolean,null,String,Object,Array],default:()=>({})},loading:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},round:{type:Boolean,default:!0}},emits:["click"],setup(f,{emit:g}){let T=f,v=g;function w(B){T.disabled||v("click",B)}let N=(0,h.computed)(()=>["tui-button",`tui-button-${T.type}`,`tui-button-${T.size}`,{"tui-button-round":T.round},{"tui-button-loading":T.loading},{"tui-button-disabled":T.disabled}]);return(B,V)=>{let H=(0,h.resolveComponent)("button",!0);return(0,h.openBlock)(),(0,h.createBlock)(H,{class:(0,h.normalizeClass)(N.value),style:(0,h.normalizeStyle)(B.customStyle),onClick:w},{default:(0,h.withCtx)(()=>[B.$slots.icon?((0,h.openBlock)(),(0,h.createElementBlock)("span",{key:0,class:"button-icon"},[(0,h.renderSlot)(B.$slots,"icon")])):(0,h.createCommentVNode)("",!0),(0,h.renderSlot)(B.$slots,"default")]),_:3},8,["class","style"])}}}),W_={"tui-button":{"":{justifyContent:"center",alignItems:"center",textAlign:"center",transitionProperty:"backgroundColor",transitionDuration:200,transitionTimingFunction:"ease-in-out",borderWidth:1,borderStyle:"solid",borderColor:"#1C66E5",fontWeight:"400",lineHeight:22,backgroundColor:"#1C66E5",color:"#FFFFFF","backgroundColor:hover":"#144FB6","borderWidth:hover":1,"borderStyle:hover":"solid","borderColor:hover":"#144FB6"}},"tui-button-primary":{"":{backgroundColor:"rgba(0,0,0,0)",borderWidth:1,borderStyle:"solid",borderColor:"#1C66E5",color:"#1C66E5",fontSize:14,fontWeight:"500",lineHeight:22,"backgroundColor:hover":"rgba(213,224,242,0.6)"}},"tui-button-large":{"":{paddingTop:19,paddingRight:48,paddingBottom:19,paddingLeft:48,fontSize:20}},"tui-button-default":{"":{paddingTop:5,paddingRight:30,paddingBottom:5,paddingLeft:30,fontSize:14}},"tui-button-round":{"":{borderRadius:999999}},"tui-button-disabled":{"":{opacity:.4}},"tui-button-icon":{"":{marginRight:5,display:"flex"}},"tui-button-text":{"":{borderWidth:0,borderStyle:"solid",borderColor:"rgba(0,0,0,0)",backgroundColor:"rgba(0,0,0,0)",color:"#4F586B","borderWidth:hover":0,"borderStyle:hover":"solid","borderColor:hover":"rgba(0,0,0,0)","backgroundColor:hover":"rgba(0,0,0,0)","color:hover":"#4F586B"}},"@TRANSITION":{"tui-button":{property:"backgroundColor",duration:200,timingFunction:"ease-in-out"}}},Na=Dt(K_,[["styles",[W_]]]),j_="/assets/ArrowStrokeSelectDownIcon.e0254bfd.svg",Y_=(0,h.defineComponent)({__name:"Select",props:{modelValue:{type:[String,Number,Boolean,Object]},disabled:{type:Boolean},theme:{type:String}},emits:["update:modelValue","change"],setup(f,{emit:g}){let{nextZIndex:T}=Qg(),v=f,w=g,N=(0,h.ref)(!1),B=(0,h.ref)(new Map),V=(0,h.computed)(()=>Array.from(B.value.values())),H=(0,h.ref)(""),z=(0,h.ref)(v.modelValue),ne=(0,h.ref)(),ge=(0,h.ref)(),pe=(0,h.ref)("down"),oe=(0,h.computed)(()=>v.theme?`tui-theme-${v.theme}`:"");(0,h.watch)(()=>v.modelValue,Be=>{z.value=Be,B.value.get(Be)&&(H.value=B.value.get(v.modelValue).label)}),(0,h.watch)(V,()=>{B.value.get(v.modelValue)&&(H.value=B.value.get(v.modelValue).label)});let de=(0,h.ref)({});function ae(Be){B.value.set(Be.value,Be)}function te(Be){B.value.delete(Be)}function J(Be){z.value=Be.value,N.value=!1,w("update:modelValue",Be.value)}(0,h.watch)(z,Be=>{w("change",Be)}),(0,h.provide)("select",(0,h.reactive)({selectedValue:z,optionObj:B,optionDataList:V,onOptionCreated:ae,onOptionDestroyed:te,onOptionSelected:J}));function Le(){v.disabled||(N.value?N.value=!1:(re(),de.value={zIndex:T()},N.value=!0))}function re(){var Be,Ye;let{top:Xe,bottom:Ne}=(Be=ne.value)==null?void 0:Be.getBoundingClientRect(),me=yt.getRoomContainer(),A=me instanceof HTMLElement?me.offsetHeight-Ne:-1,Me=0;N.value?Me=(Ye=ge.value)==null?void 0:Ye.offsetHeight:(ge.value.style="display:block;position:absolute;z-index:-1000",Me=ge.value.offsetHeight,ge.value.style=""),A<Xe&&A<Me&&(pe.value="up")}return(Be,Ye)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{ref_key:"selectContainerRef",ref:ne,class:(0,h.normalizeClass)(["select-container",oe.value])},[(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)(["select-content",{disabled:Be.disabled}]),onClick:Le},[(0,h.createElementVNode)("span",{class:"select-text"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(H.value||z.value),1)]),(0,h.createVNode)(Sn,{style:{display:"flex"},class:(0,h.normalizeClass)(["arrow-icon",{reverse:N.value}]),icon:(0,h.unref)(j_)},null,8,["class","icon"])],2),(0,h.createVNode)(h.Transition,{name:"select-fade"},{default:(0,h.withCtx)(()=>[N.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,ref_key:"selectDropDownRef",ref:ge,style:(0,h.normalizeStyle)(de.value),class:(0,h.normalizeClass)(["select-dropdown-container",pe.value])},[(0,h.renderSlot)(Be.$slots,"default")],6)):(0,h.createCommentVNode)("",!0)]),_:3})],2))}}),z_={"select-container":{"":{position:"relative"}},"select-content":{".select-container ":{position:"relative",borderWidth:1,borderStyle:"solid",borderColor:"#E4E8EE",backgroundColor:"#F9FAFC",color:"#000000",borderRadius:8,height:42,paddingTop:10,paddingRight:16,paddingBottom:10,paddingLeft:16,display:"flex"},".select-container .disabled":{backgroundColor:"rgba(255,255,255,0.5)",color:"#8F9AB2"}},"select-text":{".select-container .select-content ":{width:0,fontSize:14,fontStyle:"normal",fontWeight:"500",lineHeight:22,flex:1,overflow:"hidden"}},"arrow-icon":{".select-container .select-content ":{marginLeft:10,transitionProperty:"transform",transitionDuration:200,transform:"rotate(0deg)"},".select-container .select-content .reverse":{transform:"rotate(-180deg)"}},"select-dropdown-container":{".select-container ":{paddingTop:7,paddingRight:0,paddingBottom:7,paddingLeft:0,position:"absolute",backgroundColor:"#F9FAFC",borderWidth:1,borderStyle:"solid",borderColor:"#E4E8EE",borderRadius:8},".select-container .down":{left:0,transformOrigin:"50% 0"},".select-container .up":{left:0,transformOrigin:"50% 100%"}},"select-fade-enter-active":{"":{transform:"scaleY(0)",opacity:0}},"select-fade-leave-to":{"":{transform:"scaleY(0)",opacity:0}},"select-fade-enter-to":{"":{transform:"scaleY(1)",opacity:1}},"select-fade-leave-from":{"":{transform:"scaleY(1)",opacity:1}},"@TRANSITION":{"arrow-icon":{property:"transform",duration:200}}},Zg=Dt(Y_,[["styles",[z_]]]),J_=(0,h.defineComponent)({__name:"Option",props:{label:{type:String},value:{type:[String,Number,Boolean,Object]}},setup(f){let g=f,T=(0,h.inject)("select"),v=(0,h.computed)(()=>T&&T.selectedValue===g.value),w=(0,h.computed)(()=>({label:g.label,value:g.value}));T==null||T.onOptionCreated(w.value),(0,h.onBeforeUnmount)(()=>{T==null||T.onOptionDestroyed(g.value)}),(0,h.watch)(()=>[g.value,g.label],(B,V)=>{JSON.stringify(B)!==JSON.stringify(V)&&(T==null||T.onOptionDestroyed(V),T==null||T.onOptionCreated(w.value))});function N(){T==null||T.onOptionSelected(w.value)}return(B,V)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["option-container",{active:v.value}]),onClick:N},[(0,h.createElementVNode)("span",{class:"option-content"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(B.label||B.value),1)])],2))}}),$_={"option-container":{"":{paddingTop:6,paddingRight:15,paddingBottom:6,paddingLeft:15,overflow:"hidden",color:"#000000","backgroundColor:hover":"rgba(213,224,242,0.5)"},".active":{color:"#1C66E5"}},"option-content":{".option-container ":{fontSize:14,lineHeight:22,fontWeight:"500"}}},eh=Dt(J_,[["styles",[$_]]]),X_=(0,h.defineComponent)({__name:"DeviceSelect",props:{deviceType:{type:String},onChange:{type:Function},disabled:{type:Boolean}},setup(f){let{deviceManager:g}=Au(),{deviceType:T,onChange:v,disabled:w=!1}=f,N=Dn(),{cameraList:B,microphoneList:V,speakerList:H,currentCameraId:z,currentMicrophoneId:ne,currentSpeakerId:ge}=(0,Mt.storeToRefs)(N),pe=(0,h.ref)(ae()),oe=(0,h.ref)(de());function de(){return T==="camera"?z:T==="microphone"?ne:T==="speaker"?ge:""}function ae(){return T==="camera"?B:T==="microphone"?V:T==="speaker"?H:[]}function te(J){return Oe(this,null,function*(){var Le,re,Be;switch(v&&v(J),T){case"camera":yield(Le=g.instance)==null?void 0:Le.setCurrentDevice({type:Yn.kMediaDeviceTypeVideoCamera,deviceId:J}),N.setCurrentCameraId(J);break;case"microphone":yield(re=g.instance)==null?void 0:re.setCurrentDevice({type:Yn.kMediaDeviceTypeAudioInput,deviceId:J}),N.setCurrentMicrophoneId(J);break;case"speaker":yield(Be=g.instance)==null?void 0:Be.setCurrentDevice({type:Yn.kMediaDeviceTypeAudioOutput,deviceId:J}),N.setCurrentSpeakerId(J);break}})}return(J,Le)=>((0,h.openBlock)(),(0,h.createBlock)(Zg,{modelValue:oe.value,"onUpdate:modelValue":Le[0]||(Le[0]=re=>oe.value=re),placeholder:"placeholder",class:"select",disabled:J.disabled,teleported:!1,"popper-append-to-body":!1,onChange:te},{default:(0,h.withCtx)(()=>[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(pe.value,re=>((0,h.openBlock)(),(0,h.createBlock)(eh,{key:re.deviceId,label:re.deviceName,value:re.deviceId},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"]))}}),Q_={select:{"":{width:100,fontSize:14}}},Tp=Dt(X_,[["styles",[Q_]]]),Z_=(0,h.defineComponent)({__name:"AudioSettingTab",props:{mode:{type:String},audioVolume:{type:Number},theme:{type:String}},setup(f){var g;let T=f,v=T.mode||Yr.SIMPLE,w=(0,h.computed)(()=>v===Yr.SIMPLE),N=(0,h.computed)(()=>v===Yr.DETAIL),B=qt(),{userId:V}=(0,Mt.storeToRefs)(B),H=Dn(),{speakerList:z,userVolumeObj:ne,currentSpeakerId:ge}=(0,Mt.storeToRefs)(H),oe=(g=zn().instance)==null?void 0:g.getTRTCCloud(),de=(0,h.computed)(()=>T.theme?`tui-theme-${T.theme}`:""),ae=(0,h.computed)(()=>N.value?36:28),te=(0,h.computed)(()=>(T.audioVolume||ne.value[V.value]||0)*ae.value/100),J=(0,h.computed)(()=>w.value||N.value&&Le.value),Le=(0,h.ref)(!1);function re(){Le.value=!Le.value}let Be=(0,h.ref)(!1),Ye=document==null?void 0:document.createElement("audio"),{t:Xe}=on();function Ne(){return Oe(this,null,function*(){let me="https://web.sdk.qcloud.com/trtc/electron/download/resources/media/TestSpeaker.mp3";Be.value=!Be.value;let A=Be.value;if(Aa){A?oe==null||oe.startSpeakerDeviceTest(me):oe==null||oe.stopSpeakerDeviceTest();return}Ye&&(A?(yield Ye==null?void 0:Ye.setSinkId(ge.value),Ye.src=me,Ye.play()):(Ye.pause(),Ye.currentTime=0))})}return(0,h.onBeforeUnmount)(()=>{if(Aa){oe==null||oe.stopSpeakerDeviceTest();return}Ye&&Ye.pause()}),(me,A)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["audio-setting-tab",de.value])},[(0,h.createElementVNode)("div",{class:"item-setting"},[(0,h.createElementVNode)("span",{class:"title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(Xe)("Mic")),1)]),(0,h.createElementVNode)("div",{class:"flex"},[(0,h.createVNode)(Tp,{class:"select","device-type":"microphone"}),N.value?((0,h.openBlock)(),(0,h.createBlock)(Na,{key:0,class:"button",type:"primary",onClick:re},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(Le.value?(0,h.unref)(Xe)("Stop"):(0,h.unref)(Xe)("Test")),1)]),_:1})):(0,h.createCommentVNode)("",!0)])]),(0,h.createElementVNode)("div",{class:"item-setting"},[(0,h.createElementVNode)("span",{class:"title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(Xe)("Output")),1)]),(0,h.createElementVNode)("div",{class:"mic-bar-container"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(new Array(ae.value).fill(""),(Me,O)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:O,class:(0,h.normalizeClass)(["mic-bar",`${J.value&&te.value>O?"active":""}`])},null,2))),128))])]),(0,h.unref)(z).length>0?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"item-setting"},[(0,h.createElementVNode)("span",{class:"title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(Xe)("Speaker")),1)]),(0,h.createElementVNode)("div",{class:"flex"},[(0,h.createVNode)(Tp,{class:"select","device-type":"speaker",disabled:me.mode===(0,h.unref)(Yr).DETAIL},null,8,["disabled"]),N.value?((0,h.openBlock)(),(0,h.createBlock)(Na,{key:0,class:"button",type:"primary",onClick:Ne},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(Be.value?(0,h.unref)(Xe)("Stop"):(0,h.unref)(Xe)("Test")),1)]),_:1})):(0,h.createCommentVNode)("",!0)])])):(0,h.createCommentVNode)("",!0)],2))}}),ef={"audio-setting-tab":{"":{borderRadius:4,fontSize:14,width:100}},"item-setting":{".audio-setting-tab ":{width:100}},flex:{".audio-setting-tab ":{width:100,display:"flex"}},select:{".audio-setting-tab ":{flex:1}},button:{".audio-setting-tab ":{marginLeft:10,paddingTop:5,paddingRight:23,paddingBottom:5,paddingLeft:23,width:74}},title:{".audio-setting-tab ":{marginBottom:8,width:100,color:"#4f586b",fontSize:14,fontWeight:"400",lineHeight:22}},"mic-bar-container":{".audio-setting-tab ":{display:"flex",justifyContent:"space-between"}},"mic-bar":{".audio-setting-tab .mic-bar-container ":{width:3,height:6,backgroundColor:"#D5E0F2"},".audio-setting-tab .mic-bar-container .active":{backgroundColor:"#27C39F"}},"audio-level-container":{".audio-setting-tab ":{width:100,height:20,display:"flex"}},slider:{".audio-setting-tab .audio-level-container ":{height:20,marginLeft:10}}},th=Dt(Z_,[["styles",[ef]]]),tf=(0,h.defineComponent)({__name:"AudioIcon",props:{userId:{type:String},audioVolume:{type:Number},isMuted:{type:Boolean},size:{type:String},isDisabled:{type:Boolean},color:{type:null}},setup(f){let g=Dn(),{userVolumeObj:T}=(0,Mt.storeToRefs)(g),v=(0,h.computed)(()=>Ol(w.audioVolume)?T.value&&w.userId?T.value[w.userId]:0:w.audioVolume),w=f,N=(0,h.computed)(()=>w.isMuted?"MicOffIcon":"MicOnIcon"),B=(0,h.computed)(()=>!w.isMuted&&v.value>0),V=(0,h.computed)(()=>B.value?`height: ${v.value/100*14}px`:"");return(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["audio-icon-container",`${H.size=="small"&&"small"}`])},[B.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"audio-level-container"},[(0,h.createElementVNode)("div",{class:"audio-level",style:(0,h.normalizeStyle)(V.value)},null,4)])):(0,h.createCommentVNode)("",!0),(0,h.createVNode)(Sn,{size:"24",icon:N.value,color:H.color},null,8,["icon","color"])],2))}}),nf={"audio-icon-container":{"":{position:"relative",width:24,height:24},".small":{transform:"scale(0.8)"}},"audio-level-container":{".audio-icon-container ":{position:"absolute",top:2,left:7,width:10,height:14,display:"flex",flexWrap:"wrap",borderRadius:4,overflow:"hidden",flexDirection:"column-reverse",justifyContent:"space-between"}},"audio-level":{".audio-icon-container .audio-level-container ":{width:10,backgroundColor:"#27C39F",transitionProperty:"height",transitionDuration:200,borderRadius:4}},"@TRANSITION":{"audio-level":{property:"height",duration:200}}},nh=Dt(tf,[["styles",[nf]]]),oh=function(){return Aa||mo||Ro?!0:navigator&&(navigator==null?void 0:navigator.mediaDevices)&&Np(navigator==null?void 0:navigator.mediaDevices.getUserMedia)}();(function(){return Aa||mo?!0:navigator&&(navigator==null?void 0:navigator.mediaDevices)&&Np(navigator==null?void 0:navigator.mediaDevices.getDisplayMedia)})();var ih=function(){return Aa||mo||Ro?!0:navigator&&(navigator==null?void 0:navigator.mediaDevices)&&Np(navigator==null?void 0:navigator.mediaDevices.enumerateDevices)}(),of=(0,h.defineComponent)({__name:"AudioMediaControl",props:{hasMore:{type:Boolean,default:!0},isMuted:{type:Boolean},isDisabled:{type:Boolean,default:!1},audioVolume:{default:0,type:Number}},emits:["click"],setup(f,{emit:g}){let T=g,v=(0,h.ref)(!1),w=oh&&ih,{t:N}=on();function B(){return Oe(this,null,function*(){if(!w){tc({title:N("Note"),message:N("The current browser does not support capturing audio"),appendToRoomContainer:!0,confirmButtonText:N("Sure")});return}T("click"),v.value=!1})}function V(){v.value=!v.value}return(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createElementVNode)("div",{class:"audio-control-container"},[(0,h.createVNode)(ei,{title:(0,h.unref)(N)("Mic"),"has-more":H.hasMore,disabled:H.isDisabled,"is-not-support":!(0,h.unref)(w),onClickIcon:B,onClickMore:V},{default:(0,h.withCtx)(()=>[(0,h.createVNode)(nh,{"audio-volume":H.audioVolume,"is-muted":H.isMuted,"is-disabled":H.isDisabled},null,8,["audio-volume","is-muted","is-disabled"])]),_:1},8,["title","has-more","disabled","is-not-support"]),v.value?((0,h.openBlock)(),(0,h.createBlock)(th,{key:0,theme:"white",class:"audio-tab","audio-volume":H.audioVolume},null,8,["audio-volume"])):(0,h.createCommentVNode)("",!0)])]))}}),af={"audio-control-container":{"":{position:"relative"}},"audio-tab":{".audio-control-container ":{position:"absolute",left:-5,width:305,backgroundColor:"#FFFFFF",paddingTop:20,paddingRight:20,paddingBottom:24,paddingLeft:20,borderRadius:8,boxShadow:"0px 2px 4px -3px rgba(32, 77, 141, 0.03), 0px 6px 10px 1px rgba(32, 77, 141, 0.06), 0px 3px 14px 2px rgba(32, 77, 141, 0.05)","position::before":"absolute","left::before":28,"bottom::before":-10,"borderTopWidth::before":5,"borderTopStyle::before":"solid","borderTopColor::before":"#FFFFFF","borderLeftWidth::before":5,"borderLeftStyle::before":"solid","borderLeftColor::before":"rgba(0,0,0,0)","borderRightWidth::before":5,"borderRightStyle::before":"solid","borderRightColor::before":"rgba(0,0,0,0)","borderBottomWidth::before":5,"borderBottomStyle::before":"solid","borderBottomColor::before":"rgba(0,0,0,0)"}}},sf=Dt(of,[["styles",[af]]]),rf=(0,h.defineComponent)({__name:"AudioControl",emits:["click"],setup(f,{emit:g}){let T=zn(),v=Dn(),w=qt(),{isAudience:N,localStream:B,isLocalAudioIconDisable:V,isMicrophoneDisableForAllUser:H,userVolumeObj:z}=(0,Mt.storeToRefs)(v),ne=g,ge=(0,h.computed)(()=>!Fn),{t:pe}=on(),oe=(0,h.ref)("");function de(){ne("click"),ae()}function ae(){return Oe(this,null,function*(){var Xe,Ne,me;if(V.value){let A="";N.value?A=Eu.UNMUTE_LOCAL_MIC_FAIL_AUDIENCE:H.value&&(A=Eu.UNMUTE_LOCAL_MIC_FAIL_MUTE_ALL),kt({type:"warning",message:pe(A),duration:ln.NORMAL});return}B.value.hasAudioStream?(yield(Xe=T.instance)==null?void 0:Xe.muteLocalAudio(),v.isMicrophoneDisableForAllUser&&v.setCanControlSelfAudio(!1)):(yield(Ne=T.instance)==null?void 0:Ne.unmuteLocalAudio(),w.isOpenMic||((me=T.instance)==null||me.openLocalMicrophone(),w.setIsOpenMic(!0)))})}let te=(0,h.ref)(!1),J=(0,h.ref)("");function Le(Xe){return Oe(this,null,function*(){let{userId:Ne,requestAction:me,requestId:A}=Xe.request;if(me===Jr.kRequestToOpenRemoteMicrophone){let Me=v.getUserRole(Ne)===Et.kRoomOwner?pe("RoomOwner"):pe("Admin");oe.value=pe("Sb invites you to turn on the microphone",{role:Me}),J.value=A,te.value=!0}})}function re(){return Oe(this,null,function*(){var Xe;v.setCanControlSelfAudio(!0),yield(Xe=T.instance)==null?void 0:Xe.responseRemoteRequest({requestId:J.value,agree:!0}),J.value="",te.value=!1})}function Be(){return Oe(this,null,function*(){var Xe;yield(Xe=T.instance)==null?void 0:Xe.responseRemoteRequest({requestId:J.value,agree:!1}),J.value="",te.value=!1})}function Ye(Xe){return Oe(this,null,function*(){let{requestId:Ne}=Xe;J.value===Ne&&(te.value=!1)})}return(0,h.onMounted)(()=>{rt.once("ready",()=>{var Xe,Ne;(Xe=T.instance)==null||Xe.on(it.onRequestReceived,Le),(Ne=T.instance)==null||Ne.on(it.onRequestCancelled,Ye)})}),(0,h.onUnmounted)(()=>{var Xe,Ne;(Xe=T.instance)==null||Xe.off(it.onRequestReceived,Le),(Ne=T.instance)==null||Ne.off(it.onRequestCancelled,Ye)}),(Xe,Ne)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createVNode)(sf,{"has-more":ge.value,"is-muted":!(0,h.unref)(B).hasAudioStream,"is-disabled":(0,h.unref)(V),"audio-volume":(0,h.unref)(z)[(0,h.unref)(B).userId],onClick:de},null,8,["has-more","is-muted","is-disabled","audio-volume"]),(0,h.createVNode)(Oa,{modelValue:te.value,"onUpdate:modelValue":Ne[0]||(Ne[0]=me=>te.value=me),title:(0,h.unref)(pe)("Tips"),modal:!0,"show-close":!1,"close-on-click-modal":!1,width:"500px","append-to-room-container":!0,"confirm-button":(0,h.unref)(pe)("Turn on the microphone"),"cancel-button":(0,h.unref)(pe)("Keep it closed"),onConfirm:re,onCancel:Be},{footer:(0,h.withCtx)(()=>[(0,h.createVNode)(Na,{class:"agree-button",size:"default",onClick:re},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(pe)("Turn on the microphone")),1)]),_:1}),(0,h.createVNode)(Na,{class:"cancel-button",size:"default",type:"primary",onClick:Be},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(pe)("Keep it closed")),1)]),_:1})]),default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("span",null,[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(oe.value),1)])]),_:1},8,["modelValue","title","confirm-button","cancel-button"])]))}}),cf={"cancel-button":{"":{marginLeft:20}}},uf=Dt(rf,[["styles",[cf]]]),lf=(0,h.defineComponent)({__name:"VideoProfile",setup(f){let g=zn(),T=Dn(),{localVideoQuality:v}=(0,Mt.storeToRefs)(T),{t:w}=on(),N=(0,h.computed)(()=>[{label:w("Low Definition"),value:xo.kVideoQuality_360p},{label:w("Standard Definition"),value:xo.kVideoQuality_540p},{label:w("High Definition"),value:xo.kVideoQuality_720p},{label:w("Super Definition"),value:xo.kVideoQuality_1080p}]);return(0,h.watch)(v,B=>{var V;(V=g.instance)==null||V.updateVideoQuality({quality:B})}),rt.once("ready",()=>{var B;(B=g.instance)==null||B.updateVideoQuality({quality:v.value})}),(B,V)=>((0,h.openBlock)(),(0,h.createBlock)(Zg,{modelValue:(0,h.unref)(v),"onUpdate:modelValue":V[0]||(V[0]=H=>(0,h.isRef)(v)?v.value=H:null),placeholder:"placeholder",class:"select",teleported:!1,"popper-append-to-body":!1},{default:(0,h.withCtx)(()=>[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(N.value,(H,z)=>((0,h.openBlock)(),(0,h.createBlock)(eh,{key:z,label:H.label,value:H.value},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]))}}),df={select:{"":{width:100,fontSize:14}}},pf=Dt(lf,[["styles",[df]]]),gf=(0,h.defineComponent)({__name:"TuiSwitch",props:{modelValue:{type:Boolean}},emits:["update:modelValue"],setup(f,{emit:g}){let T=f,v=g;function w(){v("update:modelValue",!T.modelValue)}return(N,B)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)([T.modelValue?"switch-container":"switch-container-active"]),onClick:w},[(0,h.createElementVNode)("div",{class:"switch-core"})],2))}}),hf={"switch-container":{"":{position:"relative",width:40,height:20,backgroundColor:"#1C66E5",borderRadius:20,transitionProperty:"backgroundColor",transitionDuration:300}},"switch-container-active":{"":{position:"relative",width:40,height:20,backgroundColor:"#BDBDBD",borderRadius:20,transitionProperty:"backgroundColor",transitionDuration:300}},"switch-core":{".switch-container ":{position:"absolute",left:2,top:2,width:40,height:80,backgroundColor:"#ffffff",borderRadius:50,boxShadow:"0 1px 5px rgba(0, 0, 0, 0.2)","!transitionProperty":"transform","!transitionDuration":300,transform:"translateX(20px)"},".switch-container-active ":{position:"absolute",left:2,top:2,width:40,height:80,backgroundColor:"#ffffff",borderRadius:50,boxShadow:"0 1px 5px rgba(0, 0, 0, 0.2)","!transitionProperty":"transform","!transitionDuration":300,transform:"translateX(0)"}},"@TRANSITION":{"switch-container":{property:"backgroundColor",duration:300},"switch-container-active":{property:"backgroundColor",duration:300}}},_f=Dt(gf,[["styles",[hf]]]),ff=(0,h.defineComponent)({__name:"VideoSettingTab",props:{withPreview:{type:Boolean},withMore:{type:Boolean},withMirror:{type:Boolean},theme:{type:String}},setup(f){let g=zn(),T=f,v=qt(),{isLocalStreamMirror:w}=(0,Mt.storeToRefs)(v),N=(0,h.computed)(()=>T.theme?`tui-theme-${T.theme}`:"");(0,h.watch)(w,H=>Oe(this,null,function*(){var z;let ne=(z=g.instance)==null?void 0:z.getTRTCCloud();(!Fn||!Ro)&&(yield ne==null?void 0:ne.setLocalRenderParams({mirrorType:H?Zo.TRTCVideoMirrorType_Enable:Zo.TRTCVideoMirrorType_Disable,rotation:Qr.TRTCVideoRotation0,fillMode:Xr.TRTCVideoFillMode_Fill}))}));let{t:B}=on();function V(){v.setShowSettingDialog(!0),v.setActiveSettingTab("video")}return T.withPreview&&((0,h.onMounted)(()=>Oe(this,null,function*(){var H,z;if((H=g.instance)==null||H.startCameraDeviceTest({view:"test-camera-preview"}),Aa){let ne=(z=g.instance)==null?void 0:z.getTRTCCloud();yield ne==null?void 0:ne.setLocalRenderParams({mirrorType:w.value?Zo.TRTCVideoMirrorType_Enable:Zo.TRTCVideoMirrorType_Disable,rotation:Qr.TRTCVideoRotation0,fillMode:Xr.TRTCVideoFillMode_Fill})}})),(0,h.onUnmounted)(()=>{var H;(H=g.instance)==null||H.stopCameraDeviceTest()})),(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["video-tab",N.value])},[(0,h.createElementVNode)("div",{class:"item-setting"},[(0,h.createElementVNode)("span",{class:"title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(B)("Camera")),1)]),(0,h.createVNode)(Tp,{"device-type":"camera"})]),H.withPreview?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"item-setting"},[(0,h.createElementVNode)("span",{class:"title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(B)("Preview")),1)]),(0,h.createElementVNode)("div",{class:"video-preview-container"},[(0,h.createElementVNode)("div",{id:"test-camera-preview",class:"video-preview"})])])):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("div",{class:"item-setting"},[(0,h.createElementVNode)("span",{class:"title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(B)("Resolution")),1)]),(0,h.createVNode)(pf)]),(0,h.createElementVNode)("div",{class:"mirror-container"},[(0,h.createElementVNode)("span",null,[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(B)("Mirror")),1)]),(0,h.createVNode)(_f,{modelValue:(0,h.unref)(w),"onUpdate:modelValue":z[0]||(z[0]=ne=>(0,h.isRef)(w)?w.value=ne:null)},null,8,["modelValue"])]),H.withMore?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:"item-setting"},[(0,h.createElementVNode)("div",{class:"item",onClick:V},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(B)("More Camera Settings")),1)])])):(0,h.createCommentVNode)("",!0)],2))}}),mf={"video-tab":{"":{borderRadius:8,fontSize:14}},title:{".video-tab ":{marginBottom:8,width:100,color:"#4F586B",fontSize:14,fontWeight:"400",lineHeight:22}},"video-preview-container":{".video-tab ":{position:"relative",width:100,height:0,paddingTop:56.25,backgroundColor:"#000000",borderRadius:8,overflow:"hidden"}},"video-preview":{".video-tab .video-preview-container ":{position:"absolute",top:0,left:0,width:100,height:100}},"mirror-container":{".video-tab ":{display:"flex",justifyContent:"space-between",alignItems:"center",color:"#4F586B",fontSize:14,fontStyle:"normal",fontWeight:"400",lineHeight:22,paddingRight:2}},item:{".video-tab ":{width:100,height:20,color:"#000000"}}},ah=Dt(ff,[["styles",[mf]]]),vf=(0,h.defineComponent)({__name:"VideoMediaControl",props:{hasMore:{type:Boolean,default:!0},isMuted:{type:Boolean,default:void 0},isDisabled:{type:Boolean,default:!1}},emits:["click"],setup(f,{emit:g}){let T=f,v=g,{t:w}=on(),N=(0,h.ref)(!1),B=oh&&ih,V=(0,h.computed)(()=>T.isMuted?"CameraOffIcon":"CameraOnIcon");function H(){return Oe(this,null,function*(){if(!B){tc({title:w("Note"),message:w("The current browser does not support capturing video"),appendToRoomContainer:!0,confirmButtonText:w("Sure")});return}v("click"),N.value=!1})}function z(){N.value=!N.value}return(ne,ge)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createElementVNode)("div",{class:"video-control-container"},[(0,h.createVNode)(ei,{title:(0,h.unref)(w)("Camera"),"has-more":ne.hasMore,disabled:ne.isDisabled,"is-not-support":!(0,h.unref)(B),onClickIcon:H,onClickMore:z},{default:(0,h.withCtx)(()=>[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:V.value,size:"24"},null,8,["icon"])]),_:1},8,["title","has-more","disabled","is-not-support"]),N.value?((0,h.openBlock)(),(0,h.createBlock)(ah,{key:0,class:"video-tab","with-mirror":!0,theme:"white"})):(0,h.createCommentVNode)("",!0)])]))}}),yf={"video-control-container":{"":{position:"relative"}},"video-tab":{".video-control-container ":{position:"absolute",left:-5,width:305,backgroundColor:"#FFFFFF",paddingTop:20,paddingRight:20,paddingBottom:24,paddingLeft:20,borderRadius:8,boxShadow:"0px 2px 4px -3px rgba(32, 77, 141, 0.03), 0px 6px 10px 1px rgba(32, 77, 141, 0.06), 0px 3px 14px 2px rgba(32, 77, 141, 0.05)","position::before":"absolute","left::before":30,"bottom::before":-10,"borderTopWidth::before":5,"borderTopStyle::before":"solid","borderTopColor::before":"#FFFFFF","borderLeftWidth::before":5,"borderLeftStyle::before":"solid","borderLeftColor::before":"rgba(0,0,0,0)","borderRightWidth::before":5,"borderRightStyle::before":"solid","borderRightColor::before":"rgba(0,0,0,0)","borderBottomWidth::before":5,"borderBottomStyle::before":"solid","borderBottomColor::before":"rgba(0,0,0,0)"}}},If=Dt(vf,[["styles",[yf]]]),Mf=(0,h.defineComponent)({__name:"VideoControl",emits:["click"],setup(f,{emit:g}){let T=zn(),{deviceManager:v}=Au(),w=Dn(),N=qt(),B=(0,h.ref)(""),V=g,{isCameraDisableForAllUser:H,isAudience:z,localStream:ne,isLocalVideoIconDisable:ge}=(0,Mt.storeToRefs)(w),{t:pe}=on(),oe=(0,h.computed)(()=>!Fn),de=(0,h.ref)(!1);function ae(){V("click"),te()}function te(){return Oe(this,null,function*(){var Ne,me,A,Me,O,ze;if(ge.value){let gn="";z.value?gn=Eu.UNMUTE_LOCAL_CAMERA_FAIL_AUDIENCE:H.value&&(gn=Eu.UNMUTE_LOCAL_CAMERA_FAIL_MUTE_ALL),kt({type:"warning",message:pe(gn),duration:ln.NORMAL});return}if(ne.value.hasVideoStream)yield(Ne=T.instance)==null?void 0:Ne.closeLocalCamera(),w.isCameraDisableForAllUser&&w.setCanControlSelfVideo(!1);else{let gn=yield(me=v.instance)==null?void 0:me.getDevicesList({type:Yn.kMediaDeviceTypeVideoCamera});if(!(gn&&gn.length>0)&&!mo&&!Ro){tc({title:pe("Note"),message:pe("Camera not detected on current device"),appendToRoomContainer:!0,confirmButtonText:pe("Sure")});return}(A=T.instance)==null||A.setLocalVideoView({view:`${w.localStream.userId}_${w.localStream.streamType}`}),Fn?(Bl&&((Me=T.instance)==null?void 0:Me.getTRTCCloud()).enableSmallVideoStream(!1,Xg),yield(O=T.instance)==null?void 0:O.openLocalCamera({isFrontCamera:N.isFrontCamera})):yield(ze=T.instance)==null?void 0:ze.openLocalCamera()}de.value=!1})}let J=(0,h.ref)(!1),Le=(0,h.ref)("");function re(Ne){return Oe(this,null,function*(){let{userId:me,requestAction:A,requestId:Me}=Ne.request;if(A===Jr.kRequestToOpenRemoteCamera){let O=w.getUserRole(me)===Et.kRoomOwner?pe("RoomOwner"):pe("Admin");B.value=pe("Sb invites you to turn on the camera",{role:O}),Le.value=Me,J.value=!0}})}function Be(){return Oe(this,null,function*(){var Ne,me;w.setCanControlSelfVideo(!0),(Ne=T.instance)==null||Ne.setLocalVideoView({view:`${w.localStream.userId}_${w.localStream.streamType}`}),yield(me=T.instance)==null?void 0:me.responseRemoteRequest({requestId:Le.value,agree:!0}),Le.value="",J.value=!1})}function Ye(){return Oe(this,null,function*(){var Ne;yield(Ne=T.instance)==null?void 0:Ne.responseRemoteRequest({requestId:Le.value,agree:!1}),Le.value="",J.value=!1})}function Xe(Ne){return Oe(this,null,function*(){let{requestId:me}=Ne;Le.value===me&&(J.value=!1)})}return(0,h.onMounted)(()=>{rt.once("ready",()=>{var Ne,me;(Ne=T.instance)==null||Ne.on(it.onRequestReceived,re),(me=T.instance)==null||me.on(it.onRequestCancelled,Xe)})}),(0,h.onUnmounted)(()=>{var Ne,me;(Ne=T.instance)==null||Ne.off(it.onRequestReceived,re),(me=T.instance)==null||me.off(it.onRequestCancelled,Xe)}),(Ne,me)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createVNode)(If,{"has-more":oe.value,"is-muted":!(0,h.unref)(ne).hasVideoStream,"is-disabled":(0,h.unref)(ge),onClick:ae},null,8,["has-more","is-muted","is-disabled"]),(0,h.createVNode)(Oa,{modelValue:J.value,"onUpdate:modelValue":me[0]||(me[0]=A=>J.value=A),title:(0,h.unref)(pe)("Tips"),modal:!0,"show-close":!1,"close-on-click-modal":!1,width:"500px","append-to-room-container":!0,"confirm-button":(0,h.unref)(pe)("Turn on the camera"),"cancel-button":(0,h.unref)(pe)("Keep it closed"),onConfirm:Be,onCancel:Ye},{footer:(0,h.withCtx)(()=>[(0,h.createVNode)(Na,{class:"cancel-button",size:"default",onClick:Be},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(pe)("Turn on the camera")),1)]),_:1}),(0,h.createVNode)(Na,{class:"cancel-button",size:"default",type:"primary",onClick:Ye},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(pe)("Keep it closed")),1)]),_:1})]),default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("span",null,[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(B.value),1)])]),_:1},8,["modelValue","title","confirm-button","cancel-button"])]))}}),Cf={"video-control-container":{"":{position:"relative"}},"video-tab":{".video-control-container ":{position:"absolute",bottom:90,left:-60,width:320,backgroundColor:"#FFFFFF",paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20}},agree:{"":{paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,width:50,display:"flex",alignItems:"center",justifyContent:"center",color:"#1C66E5",fontSize:16,fontWeight:"500"}},cancel:{"":{paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,width:50,display:"flex",alignItems:"center",justifyContent:"center",color:"#4F586B",fontSize:16,fontWeight:"500"}},"cancel-button":{"":{marginLeft:20}}},Tf=Dt(Mf,[["styles",[Cf]]]),Sf=(0,h.defineComponent)({__name:"ManageMemberControl",setup(f){let{t:g}=on(),T=qt(),{sidebarName:v}=(0,Mt.storeToRefs)(T),w=Dn(),{userNumber:N}=(0,Mt.storeToRefs)(w),B=(0,h.computed)(()=>`${g("Members")}(${N.value})`);function V(){if(T.setSidebarOpenStatus&&v.value==="manage-member"){T.setSidebarOpenStatus(!1),T.setSidebarName("");return}T.setSidebarOpenStatus(!0),T.setSidebarName("manage-member")}return(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"manage-member-control-container"},[(0,h.createVNode)(ei,{"is-active":(0,h.unref)(v)==="manage-member",title:B.value,icon:"ManageMemberIcon",onClickIcon:V},null,8,["is-active","title"])]))}}),Df=(0,h.defineComponent)({__name:"Badge",props:{type:{default:"primary",type:String},value:{default:"",type:[String,Number]},max:{default:99,type:Number},hidden:{type:Boolean,default:!1},isDot:{type:Boolean,default:!1}},setup(f){let g=f,T=(0,h.computed)(()=>!g.hidden&&(g.value||g.isDot)),v=(0,h.computed)(()=>g.isDot?"":typeof g.value=="number"&&typeof g.max=="number"&&g.value>g.max?`${g.max}+`:g.value),w=(0,h.computed)(()=>["tui-badge",`tui-badge-${g.type}`,g.isDot?"tui-badge-isDot":""]);return(N,B)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(w.value)},[(0,h.renderSlot)(N.$slots,"default",{style:"position: relative;"}),T.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"tui-badge-count"},[(0,h.createElementVNode)("u-text",{style:{"font-size":"12px","font-weight":"500",color:"#fff"}},(0,h.toDisplayString)(v.value),1)])):(0,h.createCommentVNode)("",!0)],2))}}),Ef={"tui-badge":{"":{position:"relative"}},"tui-badge-count":{".tui-badge ":{paddingTop:1,paddingRight:3,paddingBottom:1,paddingLeft:3,position:"absolute",top:0,right:3,borderRadius:10},".tui-badge-primary ":{backgroundColor:"#1C66E5"},".tui-badge-danger ":{backgroundColor:"#F23C5B"},".tui-badge-isDot ":{top:0,height:8,width:8,paddingTop:0,paddingRight:0,paddingBottom:0,paddingLeft:0,borderRadius:50}}},sh=Dt(Df,[["styles",[Ef]]]),rh=(0,h.defineComponent)({__name:"ChatControl",setup(f){let{t:g}=on(),T=qt(),v=bp(),{sidebarName:w}=(0,Mt.storeToRefs)(T);function N(){var B,V;if(!uni.$tim){kt({type:"error",message:"\u8BF7\u96C6\u6210 Chat \u7EC4\u4EF6",duration:2e3}),st("info","at src/roomkit/TUIRoom/components/RoomFooter/ChatControl.vue:36","\u8BF7\u53C2\u8003 https://cloud.tencent.com/document/product/647/112757 \u96C6\u6210 Chat");return}let H=`GROUP${T.roomId}`,z={[T.userId]:{nick:T.userName,avatar:T.avatarUrl||yp}};uni.$emit("update-message-info",z),uni.navigateTo({url:`/src/roomkit/TUIKit/components/TUIChat/index?conversationID=${H}`});let ne=(V=(B=getCurrentPages())==null?void 0:B.slice(-1)[0])==null?void 0:V.route;v.setCurrentsPage(ne),v.updateUnReadCount(0)}return(B,V)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"chat-control-container"},[(0,h.createVNode)(sh,{hidden:(0,h.unref)(v).unReadCount===0,value:(0,h.unref)(v).unReadCount,max:10},{default:(0,h.withCtx)(()=>[(0,h.createVNode)(ei,{title:(0,h.unref)(g)("Chat"),icon:"ChatIcon","is-active":(0,h.unref)(w)==="chat",onClickIcon:N},null,8,["title","is-active"])]),_:1},8,["hidden","value"])]))}}),Rf="/assets/ApplyStageLabelIcon.048ebb5a.png",Do=zn();function ch(){let f=Dn(),{applyToAnchorList:g}=(0,Mt.storeToRefs)(f),{t:T}=on();function v(oe){let{requestAction:de,requestId:ae,userId:te,timestamp:J}=oe.request;de===Jr.kRequestToTakeSeat&&te&&f.addApplyToAnchorUser({userId:te,requestId:ae,timestamp:J})}function w(oe){let{requestId:de}=oe;f.removeApplyToAnchorUser(de)}function N(oe){let{requestId:de}=oe;f.removeApplyToAnchorUser(de)}function B(oe,de){return Oe(this,null,function*(){var ae;try{let te=f.remoteUserObj[oe],J=te.applyToAnchorRequestId;J?(yield(ae=Do.instance)==null?void 0:ae.responseRemoteRequest({requestId:J,agree:de}),f.removeApplyToAnchorUser(J)):Qt.warn("\u5904\u7406\u4E0A\u53F0\u7533\u8BF7\u5931\u8D25\uFF0C\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u91CD\u8BD5\uFF01",te)}catch(te){te.code===Tn.ERR_ALL_SEAT_OCCUPIED?kt({type:"warning",message:T("The current number of people on stage has reached the limit")}):Qt.error("Failure to process a user request",te)}})}function V(oe){return Oe(this,null,function*(){var de;try{let ae=oe.applyToAnchorRequestId;ae?(yield(de=Do.instance)==null?void 0:de.responseRemoteRequest({requestId:ae,agree:!0}),f.removeApplyToAnchorUser(ae)):Qt.warn("\u540C\u610F\u4E0A\u53F0\u7533\u8BF7\u5931\u8D25\uFF0C\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u91CD\u8BD5\uFF01",oe)}catch(ae){ae.code===Tn.ERR_ALL_SEAT_OCCUPIED?kt({type:"warning",message:T("The current number of people on stage has reached the limit")}):Qt.error("Failed application for consent to go on stage",ae)}})}function H(oe){return Oe(this,null,function*(){var de;let ae=oe.applyToAnchorRequestId;ae?(yield(de=Do.instance)==null?void 0:de.responseRemoteRequest({requestId:ae,agree:!1}),f.removeApplyToAnchorUser(ae)):Qt.warn("\u62D2\u7EDD\u4E0A\u53F0\u7533\u8BF7\u5931\u8D25\uFF0C\u6570\u636E\u5F02\u5E38\uFF0C\u8BF7\u91CD\u8BD5\uFF01",oe)})}function z(oe){return Oe(this,null,function*(){var de;let ae=g.value.map(te=>({userId:te.userId,userName:te.userName,applyToAnchorRequestId:te.applyToAnchorRequestId}));for(let{userId:te,userName:J,applyToAnchorRequestId:Le}of ae){let re=oe?"Agree":"Reject",Be=`${re} ${J||te} \u4E0A\u53F0\u7533\u8BF7\u5931\u8D25\uFF0C\u8BF7\u91CD\u8BD5\uFF01`;try{Le&&(yield(de=Do.instance)==null?void 0:de.responseRemoteRequest({requestId:Le,agree:oe}),f.removeApplyToAnchorUser(Le))}catch(Ye){Qt.error(Be),kt({type:"warning",message:T(`${re} sb on stage failed, please retry`,{name:J||te}),duration:ln.NORMAL})}}})}(0,h.onMounted)(()=>{rt.once("ready",()=>{var oe,de,ae;(oe=Do.instance)==null||oe.on(it.onRequestReceived,v),(de=Do.instance)==null||de.on(it.onRequestCancelled,w),(ae=Do.instance)==null||ae.on(it.onRequestProcessed,N)})}),(0,h.onBeforeUnmount)(()=>{var oe,de,ae;(oe=Do.instance)==null||oe.off(it.onRequestReceived,v),(de=Do.instance)==null||de.off(it.onRequestCancelled,w),(ae=Do.instance)==null||ae.off(it.onRequestProcessed,N)});function ne(oe){return Oe(this,null,function*(){var de;let{userId:ae}=oe,te=yield(de=Do.instance)==null?void 0:de.takeUserOnSeatByAdmin({seatIndex:-1,userId:ae,timeout:60,requestCallback:J=>{let{requestCallbackType:Le,userId:re,code:Be}=J,Ye=f.getUserName(re);switch(f.removeInviteToAnchorUser(re),Le){case Hn.kRequestAccepted:kt({type:"success",message:`${Ye||re} ${T("accepted the invitation to the stage")}`,duration:ln.NORMAL});break;case Hn.kRequestRejected:kt({type:"warning",message:`${Ye||re} ${T("declined the invitation to the stage")}`,duration:ln.NORMAL});break;case Hn.kRequestTimeout:kt({type:"warning",message:T("The invitation to sb to go on stage has timed out",{name:Ye||re}),duration:ln.NORMAL});break;case Hn.kRequestError:Be===Tn.ERR_REQUEST_ID_REPEAT&&kt({type:"warning",message:T("This member has already received the same request, please try again later"),duration:ln.NORMAL});break}}});te&&te.requestId&&f.addInviteToAnchorUser({userId:ae,requestId:te.requestId})})}function ge(oe){var de;let{userId:ae,inviteToAnchorRequestId:te}=oe;f.removeInviteToAnchorUser(ae),te&&((de=Do.instance)==null||de.cancelRequest({requestId:te}))}function pe(oe){var de;(de=Do.instance)==null||de.kickUserOffSeatByAdmin({seatIndex:-1,userId:oe.userId})}return{handleUserApply:B,agreeUserOnStage:V,denyUserOnStage:H,inviteUserOnStage:ne,cancelInviteUserOnStage:ge,kickUserOffStage:pe,handleAllUserApply:z}}var Lf=f=>{let{message:g="",duration:T=5e3}=f;return uni.showToast({title:g,icon:"none",image:"",duration:T,mask:!1,position:"top"})},kf=Lf;function Af(){let{t:f}=on(),g=qt(),T=Dn(),{handleUserApply:v,handleAllUserApply:w}=ch(),{showApplyUserList:N}=(0,Mt.storeToRefs)(g),{applyToAnchorList:B}=(0,Mt.storeToRefs)(T),V=(0,h.computed)(()=>B.value.length),H=(0,h.computed)(()=>V.value===0),z=(pe,oe)=>Oe(this,null,function*(){Fn?(g.setSidebarOpenStatus(!0),g.setSidebarName("apply")):pe?v(oe,!0):g.setShowApplyUserList(!0)}),ne=(pe,oe)=>Oe(this,null,function*(){!Fn&&pe&&v(oe,!1)});(0,h.watch)(V,(pe,oe)=>{if(pe<=oe)return;let de=pe===1,ae=B.value[0],te=(ae==null?void 0:ae.userName)||(ae==null?void 0:ae.userId),J=de?`${te} ${f("Applying for the stage")}`:`${te} ${f("and so on number people applying to stage",{number:B.value.length})}`;kf({message:J,appendToRoomContainer:!0,confirmButtonText:f(Fn?"Check":de?"Agree to the stage":"Check"),cancelButtonText:Fn?void 0:f(de?"Reject":"Neglect"),confirm:()=>z(de,ae==null?void 0:ae.userId),cancel:()=>ne(de,ae==null?void 0:ae.userId)})});function ge(){g.setShowApplyUserList(!1)}return{t:f,roomStore:T,showApplyUserList:N,hideApplyList:ge,applyToAnchorUserCount:V,applyToAnchorList:B,handleAllUserApply:w,handleUserApply:v,noUserApply:H}}var Of=(0,h.defineComponent)({__name:"index",setup(f){let g=qt(),{sidebarName:T}=(0,Mt.storeToRefs)(g),{t:v,applyToAnchorList:w,handleAllUserApply:N,handleUserApply:B,applyToAnchorUserCount:V,noUserApply:H}=Af();return(z,ne)=>(0,h.unref)(T)==="apply"?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"apply-control-container"},[(0,h.unref)(V)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"apply-list-mobile"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(w),ge=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:ge.userId,class:"apply-item"},[(0,h.createElementVNode)("div",{class:"user-info"},[(0,h.createVNode)(ku,{class:"avatar-url","img-src":ge.avatarUrl},null,8,["img-src"]),(0,h.createElementVNode)("div",{class:"stage-info"},[(0,h.createElementVNode)("u-text",{class:"user-name",title:ge.userName||ge.userId},(0,h.toDisplayString)(ge.userName||ge.userId),9,["title"]),(0,h.createElementVNode)("u-text",{class:"apply-tip"},(0,h.toDisplayString)((0,h.unref)(v)("Apply for the stage")),1)])]),(0,h.createElementVNode)("div",{class:"control-container"},[(0,h.createElementVNode)("div",{class:"reject-button",onClick:pe=>(0,h.unref)(B)(ge.userId,!1)},[(0,h.createElementVNode)("u-text",{class:"reject-text"},(0,h.toDisplayString)((0,h.unref)(v)("Reject")),1)],8,["onClick"]),(0,h.createElementVNode)("div",{class:"agree-button",onClick:pe=>(0,h.unref)(B)(ge.userId,!0)},[(0,h.createElementVNode)("u-text",{class:"agree-text"},(0,h.toDisplayString)((0,h.unref)(v)("Agree")),1)],8,["onClick"])])]))),128))])):((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:"apply-control-nobody"},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:(0,h.unref)(Rf)},null,8,["icon"]),(0,h.createElementVNode)("u-text",{class:"apply-text"},(0,h.toDisplayString)((0,h.unref)(v)("Currently no member has applied to go on stage")),1)])),(0,h.createElementVNode)("div",{class:"apply-list-footer"},[(0,h.createElementVNode)("u-text",{class:(0,h.normalizeClass)(["action-button",{disabled:(0,h.unref)(H)}]),onClick:ne[0]||(ne[0]=ge=>(0,h.unref)(N)(!1))},(0,h.toDisplayString)((0,h.unref)(v)("Reject All")),3),(0,h.createElementVNode)("u-text",{class:(0,h.normalizeClass)(["action-button agree",{disabled:(0,h.unref)(H)}]),onClick:ne[1]||(ne[1]=ge=>(0,h.unref)(N)(!0))},(0,h.toDisplayString)((0,h.unref)(v)("Agree All")),3)])])):(0,h.createCommentVNode)("",!0)}}),Nf={"apply-control-container":{"":{position:"relative",height:"1440rpx",display:"flex",flexDirection:"column"}},"apply-list-mobile":{".apply-control-container ":{paddingTop:0,paddingRight:16,paddingBottom:0,paddingLeft:16,marginTop:4}},"apply-item":{".apply-control-container .apply-list-mobile ":{display:"flex",alignItems:"center",width:"750rpx",height:48,paddingBottom:8,marginTop:20,flexDirection:"row",position:"relative","position::after":"absolute","left::after":14,"bottom::after":0,"width::after":85,"height::after":1,"backgroundColor::after":"#EAEFF8"}},"user-info":{".apply-control-container .apply-list-mobile .apply-item ":{display:"flex",flexDirection:"row"}},"avatar-url":{".apply-control-container .apply-list-mobile .apply-item .user-info ":{width:40,height:40,borderRadius:50}},"stage-info":{".apply-control-container .apply-list-mobile .apply-item .user-info ":{display:"flex",alignItems:"center",flexDirection:"row",marginLeft:12}},"user-name":{".apply-control-container .apply-list-mobile .apply-item .user-info .stage-info ":{fontWeight:"500",fontSize:16,color:"#4F586B",textOverflow:"ellipsis",overflow:"hidden"}},"apply-tip":{".apply-control-container .apply-list-mobile .apply-item .user-info .stage-info ":{fontSize:14,fontWeight:"400",color:"#4F586B"}},"control-container":{".apply-control-container .apply-list-mobile .apply-item ":{position:"absolute",right:30,display:"flex",flexDirection:"row"}},"agree-button":{".apply-control-container .apply-list-mobile .apply-item .control-container ":{width:48,height:28,borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"400",backgroundColor:"#1C66E5",marginLeft:8}},"reject-button":{".apply-control-container .apply-list-mobile .apply-item .control-container ":{width:48,height:28,borderRadius:6,display:"flex",justifyContent:"center",alignItems:"center",fontWeight:"400",backgroundColor:"#F0F3FA"}},"reject-text":{".apply-control-container .apply-list-mobile .apply-item .control-container ":{color:"#4F586B"}},"agree-text":{".apply-control-container .apply-list-mobile .apply-item .control-container ":{color:"#FFFFFF"}},"apply-control-nobody":{".apply-control-container ":{width:"750rpx",height:200,alignItems:"center",display:"flex",justifyContent:"center",flexDirection:"column"}},"apply-list-footer":{".apply-control-container ":{width:"750rpx",alignItems:"center",position:"fixed",justifyContent:"space-around",flexDirection:"row",bottom:60}},"action-button":{".apply-control-container .apply-list-footer ":{width:167,backgroundColor:"#F0F3FA",color:"#4F586B",textAlign:"center",borderRadius:8,paddingTop:10,paddingRight:0,paddingBottom:10,paddingLeft:0},".apply-control-container .apply-list-footer .agree":{marginLeft:10,backgroundColor:"#1C66E5",color:"#FFFFFF"}}},uh=Dt(Of,[["styles",[Nf]]]),bf=(0,h.defineComponent)({__name:"ManageStageControl",setup(f){let{t:g}=on(),T=qt(),v=Dn(),{sidebarName:w,showApplyUserList:N}=(0,Mt.storeToRefs)(T),{applyToAnchorList:B}=(0,Mt.storeToRefs)(v);function V(){if(!Fn)T.setShowApplyUserList(!N.value);else{if(T.isSidebarOpen&&T.sidebarName==="apply"){T.setSidebarOpenStatus(!1),T.setSidebarName("");return}T.setSidebarOpenStatus(!0),T.setSidebarName("apply")}}return(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createVNode)(sh,{hidden:(0,h.unref)(B).length===0,value:(0,h.unref)(B).length,max:10,type:"danger"},{default:(0,h.withCtx)(()=>[(0,h.createVNode)(ei,{title:(0,h.unref)(g)("Apply to stage"),icon:"StageApplicationIcon","is-active":(0,h.unref)(w)==="apply",onClickIcon:V},null,8,["title","is-active"])]),_:1},8,["hidden","value"]),(0,h.createVNode)(uh)]))}}),Pf=(0,h.defineComponent)({__name:"MemberApplyControl",setup(f){let g=zn(),{t:T}=on(),v=qt(),w=Dn(),{lang:N}=(0,Mt.storeToRefs)(v),{localUser:B,isGeneralUser:V,isAdmin:H}=(0,Mt.storeToRefs)(w),z=(0,h.ref)(!1),ne=(0,h.ref)(!0),ge=(0,h.ref)(),pe=(0,h.ref)(""),oe=(0,h.ref)(""),de=(0,h.ref)(""),ae=(0,h.ref)(!1),te=(0,h.ref)(""),J=(0,h.ref)(""),Le=(0,h.ref)("inviteDialog"),re=(0,h.inject)("showRoomTool");(0,h.watch)([B,z,N],([He,ee])=>{He.onSeat?(ge.value="StepDownIcon",pe.value=T("Step down"),ze()):ee?(ge.value="CancelStageIcon",pe.value=T("Cancel Apply")):(ge.value="ApplyStageIcon",pe.value=T("Apply for the stage"))},{immediate:!0,deep:!0});function Be(){return Oe(this,null,function*(){ze(),B.value.onSeat?Me():z.value?A():me()})}let Ye={content:T("You can turn on the microphone and camera once you are on stage"),confirmButtonText:T("Agree to the stage"),cancelButtonText:T("Reject"),handleConfirm:()=>pt(!0),handleCancel:()=>pt(!1)},Xe=(0,h.computed)(()=>({content:B.value.userRole===Et.kAdministrator?T("To go on stage again, a new application needs to be initiated"):T("To go on stage again, you need to reapply and wait for the roomOwner/administrator to approve"),confirmButtonText:T("Step down"),cancelButtonText:T("Cancel"),handleConfirm:()=>O(),handleCancel:()=>Me()})),Ne=(0,h.computed)(()=>Le.value==="inviteDialog"?Ye:Xe.value);function me(){return Oe(this,null,function*(){var He,ee;if(H.value){yield(He=g.instance)==null?void 0:He.takeSeat({seatIndex:-1,timeout:0}),kt({type:"success",message:T("Succeed on stage")});return}V.value&&kt({type:"info",message:`${T("The request to go on stage has been sent out, please wait for the roomOwner/administrator to approve it")}`,duration:ln.NORMAL});let Qe=yield(ee=g.instance)==null?void 0:ee.takeSeat({seatIndex:-1,timeout:60,requestCallback:se=>{z.value=!1;let{requestCallbackType:Ue}=se;switch(Ue){case Hn.kRequestAccepted:kt({type:"success",message:T("Succeed on stage")});break;case Hn.kRequestRejected:kt({type:"warning",message:T("Application to go on stage was rejected")});break;case Hn.kRequestTimeout:kt({type:"warning",message:T("Failed to go on stage, invitation has timed out")});break}}});Qe&&Qe.requestId&&(oe.value=Qe.requestId),z.value=!0})}function A(){return Oe(this,null,function*(){var He;kt({type:"info",message:`${T("Canceled application to go on stage")}`,duration:ln.NORMAL});try{yield(He=g.instance)==null?void 0:He.cancelRequest({requestId:oe.value}),z.value=!1}catch(ee){Qt.log("member cancelSpeechApplication",ee)}})}function Me(){ae.value=!ae.value,Le.value="leaveSeatDialog",te.value=T("Are you sure you want to step down")}function O(){return Oe(this,null,function*(){var He;yield(He=g.instance)==null?void 0:He.leaveSeat(),ae.value=!1})}function ze(){ne.value=!1}function gn(He){return Oe(this,null,function*(){let{userId:ee,requestId:Qe,requestAction:se}=He.request;if(se===Jr.kRequestRemoteUserOnSeat){de.value=Qe;let Ue=w.getUserRole(ee)===Et.kRoomOwner?T("RoomOwner"):T("Admin");te.value=T("Sb invites you to speak on stage",{role:Ue}),J.value=T("Agree to the stage"),ae.value=!0,Le.value="inviteDialog"}})}function ct(He){let{requestId:ee}=He;de.value===ee&&(de.value="",ae.value=!1)}function pt(He){return Oe(this,null,function*(){var ee;try{yield(ee=g.instance)==null?void 0:ee.responseRemoteRequest({requestId:de.value,agree:He})}catch(Qe){Qe.code===Tn.ERR_ALL_SEAT_OCCUPIED?kt({type:"warning",message:T("The current number of people on stage has reached the limit")}):Qt.error("Failure of a user to accept/reject a roomOwner invitation",Qe)}finally{ae.value=!1}})}function dt(){return Oe(this,null,function*(){kt({type:"warning",message:T("You have been invited by the host to step down, please raise your hand if you need to speak"),duration:ln.NORMAL})})}return(0,h.onMounted)(()=>{rt.once("ready",()=>{var He,ee,Qe;(He=g.instance)==null||He.on(it.onRequestReceived,gn),(ee=g.instance)==null||ee.on(it.onRequestCancelled,ct),(Qe=g.instance)==null||Qe.on(it.onKickedOffSeat,dt)})}),(0,h.onBeforeUnmount)(()=>{var He,ee,Qe;(He=g.instance)==null||He.off(it.onRequestReceived,gn),(ee=g.instance)==null||ee.off(it.onRequestCancelled,ct),(Qe=g.instance)==null||Qe.off(it.onKickedOffSeat,dt)}),(He,ee)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createElementVNode)("div",{class:"apply-control-container"},[(0,h.createVNode)(ei,{title:pe.value,icon:ge.value,onClickIcon:Be},null,8,["title","icon"]),(0,h.unref)(re)&&ne.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"attention member-attention"},[(0,h.createElementVNode)("u-text",{class:(0,h.normalizeClass)((0,h.unref)(Fn)?"mobile-info":"info")},(0,h.toDisplayString)((0,h.unref)(T)("Please raise your hand to apply")),3),(0,h.createElementVNode)("div",{class:"close",onClick:ze},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:"CloseIcon",color:"#FFFFFF"})])])):(0,h.createCommentVNode)("",!0)]),(0,h.createVNode)(Oa,{modelValue:ae.value,"onUpdate:modelValue":ee[0]||(ee[0]=Qe=>ae.value=Qe),title:te.value,modal:!0,"show-close":!1,"close-on-click-modal":!1,width:"480px","append-to-room-container":!0,"confirm-button":Ne.value.confirmButtonText,"cancel-button":Ne.value.cancelButtonText,onConfirm:Ne.value.handleConfirm,onCancel:Ne.value.handleCancel},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("span",null,[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(Ne.value.content),1)])]),_:1},8,["modelValue","title","confirm-button","cancel-button","onConfirm","onCancel"])]))}}),Gf={"apply-control-container":{"":{position:"relative"}},attention:{".apply-control-container ":{backgroundColor:"#1C66E5",boxShadow:"0 4px 16px 0 rgba(47, 48, 164, 0.1)",position:"fixed",borderRadius:8,display:"flex",alignItems:"center",justifyContent:"space-between",left:10,bottom:90,"borderWidth::after":5,"borderStyle::after":"solid","borderColor::after":"rgba(0,0,0,0)","borderTopColor::after":"#1C66E5","position::after":"absolute","top::after":100,"left::after":10,"transform::after":"translateX(-50%)"}},"member-attention":{".apply-control-container ":{paddingTop:12,paddingRight:12,paddingBottom:12,paddingLeft:12,display:"flex",flexDirection:"row"}},info:{".apply-control-container .member-attention ":{height:20,fontWeight:"500",fontSize:14,color:"#ffffff",lineHeight:20}},"mobile-info":{".apply-control-container .member-attention ":{height:20,fontWeight:"500",fontSize:14,color:"#ffffff",lineHeight:20}},close:{".apply-control-container .member-attention ":{color:"#ffffff",paddingLeft:12}},agree:{"":{paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,width:50,display:"flex",alignItems:"center",fontSize:16,fontWeight:"500",justifyContent:"center",color:"#1C66E5"}},cancel:{"":{paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,width:50,display:"flex",alignItems:"center",fontSize:16,fontWeight:"500",justifyContent:"center",color:"#4F586B"}},"cancel-button":{"":{marginLeft:20}}},Uf=Dt(Pf,[["styles",[Gf]]]),Sp=(f=>(f.MicOn="mic-on",f.MicOff="mic-off",f.MicOffDisabled="mic-off-gray",f.CameraOn="camera-on",f.CameraOff="camera-off",f.CameraOffDisabled="camera-off-gray",f.ArrowBorderDown="arrow-border-down",f.ScreenSharing="screen-sharing",f.ScreenShare="screen-share",f.ScreenShareStopped="screen-share-stopped",f.ScreenShareDisabled="screen-share-disabled",f.ChatActive="chat-active",f.Chat="chat",f.ExitFullScreen="exit-fullscreen",f.FullScreen="full-screen",f.InviteActive="invite-active",f.Invite="invite",f.ManageMemberActive="manage-member-active",f.ManageMember="manage-member",f.More="more",f.MoreActive="more-active",f.SettingActive="setting-active",f.Setting="setting",f.LineArrowUp="line-arrow-up",f.LineArrowDown="line-arrow-down",f.ApplyOnSeat="apply",f.ApplyActive="apply-active",f.GoOffSeat="go-off-seat",f))(Sp||{});function wf(){let{t:f}=on(),g=qt(),{sidebarName:T}=(0,Mt.storeToRefs)(g),v=(0,h.computed)(()=>T.value==="more"?Sp.MoreActive:Sp.More);return{t:f,basicStore:g,iconName:v,sidebarName:T}}var Ff=(0,h.defineComponent)({__name:"index",emits:["on-close-invite"],setup(f,{emit:g}){let{t:T,onCopy:v,visibleInviteContentList:w,inviteBarTitle:N}=Jg(),B=g;function V(){B("on-close-invite")}return(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"invite-container-main"},[(0,h.createElementVNode)("div",{class:"invite-title-main"},[(0,h.createElementVNode)("u-text",{class:"invite-header"},(0,h.toDisplayString)((0,h.unref)(T)("Invite")),1),(0,h.createElementVNode)("u-text",{class:"cancel",onClick:V},(0,h.toDisplayString)((0,h.unref)(T)("Cancel")),1)]),((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(w),ne=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:ne.id,class:"invite-content-main"},[(0,h.createElementVNode)("u-text",{class:"invite-title"},(0,h.toDisplayString)((0,h.unref)(T)(ne.mobileTitle)),1),(0,h.createElementVNode)("u-text",{class:"invite-content"},(0,h.toDisplayString)(ne.content),1),(0,h.createElementVNode)("div",{onClick:()=>(0,h.unref)(v)(ne.copyLink)},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:"CopyIcon",class:"copy"})],8,["onClick"])]))),128)),(0,h.createElementVNode)("u-text",{class:"invite-bottom"},(0,h.toDisplayString)((0,h.unref)(N)),1)]))}}),xf={"invite-container-main":{"":{width:"750rpx",backgroundColor:"#d4d4d4",borderTopLeftRadius:15,borderTopRightRadius:15,borderBottomRightRadius:0,borderBottomLeftRadius:0,position:"fixed",bottom:0,display:"flex",flexDirection:"column",paddingBottom:20}},"invite-header":{".invite-container-main ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:20,lineHeight:24,color:"#141313"}},"invite-title-main":{".invite-container-main ":{display:"flex",flexDirection:"row",justifyContent:"space-between",fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:20,lineHeight:24,color:"#141313",paddingTop:30,paddingRight:0,paddingBottom:20,paddingLeft:25,alignItems:"center"}},"invite-content-main":{".invite-container-main ":{display:"flex",alignItems:"stretch",flexDirection:"row",paddingTop:0,paddingRight:25,paddingBottom:0,paddingLeft:25}},"invite-title":{".invite-container-main ":{flex:1,fontFamily:'"PingFang SC"',fontStyle:"normal",fontSize:14,color:"#141313",width:23}},"invite-content":{".invite-container-main ":{flex:1,color:"#636060",overflow:"hidden",textOverflow:"ellipsis",width:64,fontSize:14}},"invite-bottom":{".invite-container-main ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:12,lineHeight:17,textAlign:"center",color:"#141313",paddingLeft:"40rpx"}},copy:{".invite-container-main ":{color:"#1C66E5",marginLeft:30,width:20,height:20}},cancel:{"":{position:"absolute",right:30,fontWeight:"400",fontSize:16,fontFamily:'"PingFang SC"',fontStyle:"normal",lineHeight:24,color:"#141313"}}},qf=Dt(Ff,[["styles",[xf]]]),Vf=(0,h.defineComponent)({__name:"InviteControl",setup(f){let g=qt(),{sidebarName:T}=(0,Mt.storeToRefs)(g),{t:v}=on(),w=(0,h.ref)(!1),N=(0,h.ref)(),[B]=yt.getComponentConfig(["InviteControl"]);function V(){if(Fn){if(w.value=!0,g.sidebarName==="invite"){g.setSidebarName("");return}g.setSidebarName("invite")}else{if(g.setSidebarOpenStatus&&g.sidebarName==="invite"){g.setSidebarOpenStatus(!1),g.setSidebarName("");return}g.setSidebarOpenStatus(!0),g.setSidebarName("invite")}}function H(){w.value=!1}return(z,ne)=>(0,h.unref)(B).visible?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"invite-control-container"},[(0,h.createVNode)(ei,{"is-active":(0,h.unref)(T)==="invite",title:(0,h.unref)(v)("Invite"),icon:"InviteIcon",onClickIcon:V},null,8,["is-active","title"]),w.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"invite-container"},[(0,h.createVNode)(qf,{ref_key:"inviteRef",ref:N,onOnCloseInvite:H},null,512)])):(0,h.createCommentVNode)("",!0)])):(0,h.createCommentVNode)("",!0)}}),Bf={"invite-container":{"":{position:"fixed",left:0,top:0,bottom:0,width:"750rpx",backgroundColor:"rgba(0,0,0,0.7)",zIndex:1}}},Hf=Dt(Vf,[["styles",[Bf]]]);function Kf(){let{t:f}=on(),g="770645461",T="chaooliang@tencent.com";function v(V){return Oe(this,null,function*(){try{yield Op(V),kt({message:f("Copied successfully"),type:"success"})}catch(H){kt({message:f("Copied failure"),type:"error"})}})}let w=(0,h.computed)(()=>Pp.global.locale.value==="zh-CN");return{t:f,onCopy:v,contactContentList:[{id:1,title:"group chat",content:g,copyLink:g},{id:2,title:"Email",content:T,copyLink:T}],email:T,handleClick:()=>{window==null||window.open("https://zhiliao.qq.com/s/c5GY7HIM62CK","_blank")},isZH:w}}var Wf=(0,h.defineComponent)({__name:"index",emits:["on-close-contact"],setup(f,{emit:g}){let{t:T,onCopy:v,contactContentList:w}=Kf(),N=g;function B(){N("on-close-contact")}return(V,H)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"contact-container-main"},[(0,h.createElementVNode)("div",{class:"contact-title-main",onTouchmove:(0,h.withModifiers)(()=>{},["stop","prevent"])},[(0,h.createElementVNode)("u-text",{class:"contact-header"},(0,h.toDisplayString)((0,h.unref)(T)("Contact us")),1),(0,h.createElementVNode)("u-text",{class:"cancel",onClick:B},(0,h.toDisplayString)((0,h.unref)(T)("Cancel")),1)],32),((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(w),z=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:z.id,class:"contact-content-main"},[(0,h.createElementVNode)("u-text",{class:"contact-title"},(0,h.toDisplayString)((0,h.unref)(T)(z.title)),1),(0,h.createElementVNode)("u-text",{class:"contact-content"},(0,h.toDisplayString)(z.content),1),(0,h.createElementVNode)("div",{class:"copy-container",onClick:()=>(0,h.unref)(v)(z.copyLink)},[(0,h.createVNode)(Sn,{style:{display:"flex"},class:"copy",icon:"CopyIcon"})],8,["onClick"])]))),128)),(0,h.createElementVNode)("u-text",{class:"contact-bottom"},(0,h.toDisplayString)((0,h.unref)(T)("If you have any questions, please feel free to join our QQ group or send an email")),1)]))}}),jf={"contact-container-main":{"":{width:"750rpx",backgroundColor:"#d4d4d4",borderTopLeftRadius:15,borderTopRightRadius:15,borderBottomRightRadius:0,borderBottomLeftRadius:0,position:"fixed",bottom:0,display:"flex",flexDirection:"column",paddingBottom:20}},"contact-title-main":{".contact-container-main ":{display:"flex",flexDirection:"row",paddingTop:30,paddingRight:0,paddingBottom:20,paddingLeft:25,alignItems:"center"}},"contact-header":{".contact-container-main .contact-title-main ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"500",fontSize:20,lineHeight:24,color:"#141313"}},cancel:{".contact-container-main .contact-title-main ":{fontFamily:'"PingFang SC"',fontStyle:"normal",lineHeight:24,color:"#141313",flex:1,textAlign:"right",fontWeight:"400",paddingRight:30,fontSize:16}},"contact-content-main":{".contact-container-main ":{display:"flex",alignItems:"stretch",flexDirection:"row",paddingTop:5,paddingRight:25,paddingBottom:5,paddingLeft:25}},"contact-title":{".contact-container-main ":{width:"210rpx",fontSize:14,fontWeight:"400",color:"#141313"}},"contact-content":{".contact-container-main ":{width:"465rpx",fontSize:14,fontWeight:"400",color:"#636060",overflow:"hidden",textOverflow:"ellipsis"}},"copy-container":{".contact-container-main ":{position:"absolute",right:"40rpx"}},copy:{".contact-container-main .copy-container ":{width:20,height:20},".contact-container-main ":{width:20,height:20,position:"absolute",right:"40rpx",color:"#1C66E5"}},"contact-bottom":{".contact-container-main ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:12,lineHeight:17,textAlign:"center",color:"#141313",paddingLeft:"40rpx",paddingTop:5}}},Yf=Dt(Wf,[["styles",[jf]]]),zf=(0,h.defineComponent)({__name:"ContactControl",setup(f){let g=qt(),{sidebarName:T}=(0,Mt.storeToRefs)(g),{t:v}=on(),w=(0,h.ref)(!1),N=(0,h.ref)();function B(){if(Fn){if(w.value=!0,g.sidebarName==="more"){g.setSidebarName("");return}g.setSidebarName("more")}else{if(g.setSidebarOpenStatus&&g.sidebarName==="more"){g.setSidebarOpenStatus(!1),g.setSidebarName("");return}g.setSidebarOpenStatus(!0),g.setSidebarName("more")}}function V(){w.value=!1}return(H,z)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"more-control-container"},[(0,h.createVNode)(ei,{icon:"MoreIcon","is-active":(0,h.unref)(T)==="more",title:(0,h.unref)(v)("Contact us"),onClickIcon:B},null,8,["is-active","title"]),w.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"contact-container"},[(0,h.createVNode)(Yf,{ref_key:"contactRef",ref:N,onOnCloseContact:V},null,512)])):(0,h.createCommentVNode)("",!0)]))}}),Jf={"contact-container":{"":{position:"fixed",left:0,top:0,bottom:0,width:"750rpx",backgroundColor:"rgba(0,0,0,0.7)",zIndex:11}}},$f=Dt(zf,[["styles",[Jf]]]),Xf=Yg(),Ru=Xf,Qf=(0,h.defineComponent)({__name:"index",setup(f){let g=(0,h.ref)(!1),T=(0,h.ref)(),{t:v,sidebarName:w}=wf(),N=Dn();function B(){g.value=!0}function V(){g.value=!1}function H(ne){ec.reportEvent({name:ne,ext1:ne}),Ru.emit("experience-communication",ne)}function z(ne){g.value&&!T.value.contains(ne.target)&&(g.value=!1)}return(0,h.onMounted)(()=>{document==null||document.addEventListener("click",z,!0)}),(0,h.onUnmounted)(()=>{document==null||document.removeEventListener("click",z,!0)}),(ne,ge)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",null,[(0,h.createElementVNode)("div",{class:"more-control-container"},[(0,h.createVNode)(ei,{"is-active":(0,h.unref)(w)==="more",title:(0,h.unref)(v)("More"),icon:"ExtensionIcon",onClick:B},null,8,["is-active","title"])]),g.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,ref_key:"moreContentRef",ref:T,class:"show-more-content"},[(0,h.createElementVNode)("div",{class:"control-compent"},[(0,h.unref)(N).isSpeakAfterTakingSeatMode?((0,h.openBlock)(),(0,h.createBlock)(rh,{key:0,onClick:ge[0]||(ge[0]=pe=>H("chatControl"))})):(0,h.createCommentVNode)("",!0),(0,h.createVNode)($f,{onClick:ge[1]||(ge[1]=pe=>H("contactControl"))}),(0,h.createVNode)(Hf,{onClick:ge[2]||(ge[2]=pe=>H("inviteControl"))})]),(0,h.createElementVNode)("u-text",{class:"close",onClick:V},(0,h.toDisplayString)((0,h.unref)(v)("Cancel")),1)],512)):(0,h.createCommentVNode)("",!0)]))}}),Zf={"show-more-content":{"":{position:"fixed",left:0,bottom:0,width:"750rpx",height:150,backgroundColor:"#FFFFFF",borderRadius:13,paddingTop:10,paddingRight:10,paddingBottom:10,paddingLeft:10}},"control-compent":{"":{display:"flex",flexDirection:"row"}},close:{"":{backgroundColor:"#006EFF",borderRadius:8,borderWidth:1,borderStyle:"solid",borderColor:"#006EFF",display:"flex",width:"715rpx",alignItems:"center",justifyContent:"center",paddingTop:10,paddingRight:10,paddingBottom:10,paddingLeft:10,color:"#FFFFFF",fontStyle:"normal",fontWeight:"400",lineHeight:24,textAlign:"center",marginTop:10}}},em=Dt(Qf,[["styles",[Zf]]]),tm="[ScreenShareControl]",nm=(0,h.defineComponent)({__name:"Index",setup(f){let g=zn(),T=Dn(),v=qt(),{isAnchor:w,isAudience:N,hasOtherScreenShare:B}=(0,Mt.storeToRefs)(T),{isShowScreenShareAntiFraud:V}=(0,Mt.storeToRefs)(v),{t:H}=on(),z=(0,h.ref)(),ne=(0,h.ref)(!1),ge=(0,h.ref)(!1),pe=(0,h.computed)(()=>N.value),oe=(0,h.computed)(()=>T.localUser.hasScreenStream?H("End sharing"):H("Share screen")),de=(0,h.computed)(()=>T.localUser.hasScreenStream);(0,h.watch)(w,(re,Be)=>{!Be&&re&&de.value&&Le()});function ae(){return Oe(this,null,function*(){if(de.value){ne.value=!0;return}if(N.value){kt({type:"warning",message:H("You currently do not have sharing permission, please raise your hand to apply for sharing permission first"),duration:ln.LONG});return}if(B.value){kt({type:"warning",message:H("Another user is currently sharing the screen, screen sharing is not possible."),duration:ln.LONG});return}if(!V.value){yield J();return}ge.value=!0})}function te(){ne.value=!1}function J(){return Oe(this,null,function*(){var re;ge.value=!1,yield(re=g.instance)==null?void 0:re.startScreenSharing()})}function Le(){return Oe(this,null,function*(){var re;if(de.value)try{yield(re=g.instance)==null?void 0:re.stopScreenSharing(),ne.value=!1}catch(Be){Qt.error(`${tm}stopScreenShare error:`,Be)}})}return Ru.on("ScreenShare:stopScreenShare",Le),(0,h.onUnmounted)(()=>{Ru.off("ScreenShare:stopScreenShare",Le)}),(re,Be)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"screen-share-control-container"},[(0,h.createVNode)(ei,{ref_key:"btnStopRef",ref:z,"is-active":de.value,disabled:pe.value,title:oe.value,icon:de.value?"StopScreenShareIcon":"ScreenShareIcon",onClickIcon:ae},null,8,["is-active","disabled","title","icon"]),(0,h.createVNode)(Oa,{"model-value":ge.value&&(0,h.unref)(V),width:"420px",title:(0,h.unref)(H)("Safety Reminder"),modal:!0,"append-to-room-container":!0},{footer:(0,h.withCtx)(()=>[(0,h.createElementVNode)("span",null,[(0,h.createVNode)(Na,{class:"button",size:"default",onClick:J},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(H)("Continue sharing")),1)]),_:1}),(0,h.createVNode)(Na,{type:"primary",size:"default",onClick:Be[0]||(Be[0]=Ye=>ge.value=!1)},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(H)("Cancel")),1)]),_:1})])]),default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("span",null,[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(H)("Sharing screens may lead to the leakage of private information such as SMS verification codes and passwords, resulting in financial losses. Please be vigilant against various forms of fraud.")),1)])]),_:1},8,["model-value","title"]),(0,h.createVNode)(Oa,{modelValue:ne.value,"onUpdate:modelValue":Be[1]||(Be[1]=Ye=>ne.value=Ye),width:"420px",title:(0,h.unref)(H)("End sharing"),modal:!0,"close-on-click-modal":!0,"append-to-room-container":!0,"confirm-button":(0,h.unref)(H)("End sharing"),"cancel-button":(0,h.unref)(H)("Cancel"),onConfirm:Le,onCancel:te},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",{class:"text-toast"},(0,h.toDisplayString)((0,h.unref)(H)("Others will no longer see your screen after you stop sharing. Are you sure you want to stop?")),1)]),_:1},8,["modelValue","title","confirm-button","cancel-button"])]))}}),om={"screen-share-control-container":{"":{position:"relative"}},"stop-share-region":{"":{width:131,height:48,backgroundColor:"#FFFFFF",borderRadius:4,position:"absolute",top:-58,left:50,transform:"translateX(-50%)",display:"flex",justifyContent:"center",alignItems:"center",fontSize:14}},"stop-share-icon":{"":{width:24,height:24,marginRight:10}},button:{"":{marginLeft:20}},"text-toast":{"":{fontSize:14,fontStyle:"normal",fontWeight:"400",lineHeight:22,color:"#4f586b"}}},im=Dt(nm,[["styles",[om]]]);function am(){let f=Dn(),{t:g}=on(),{isMaster:T,isAdmin:v,isAudience:w}=(0,Mt.storeToRefs)(f);return{t:g,roomStore:f,isMaster:T,isAdmin:v,isAudience:w}}var sm=(0,h.defineComponent)({__name:"index",setup(f){let{roomStore:g,isMaster:T,isAdmin:v,isAudience:w}=am(),N=(0,h.inject)("showRoomTool");function B(V){ec.reportEvent({name:V,ext1:V}),Ru.emit("experience-communication",V)}return(V,H)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["footer-container",[(0,h.unref)(N)?"":"footer-hidden"]])},[!(0,h.unref)(w)||(0,h.unref)(v)?((0,h.openBlock)(),(0,h.createBlock)(uf,{key:0,style:{flex:"1.5"},onClick:H[0]||(H[0]=()=>B("audioControl"))})):(0,h.createCommentVNode)("",!0),!(0,h.unref)(w)||(0,h.unref)(v)?((0,h.openBlock)(),(0,h.createBlock)(Tf,{key:1,style:{flex:"1.5"},onClick:H[1]||(H[1]=()=>B("videoControl"))})):(0,h.createCommentVNode)("",!0),(0,h.unref)(g).isSpeakAfterTakingSeatMode?(0,h.createCommentVNode)("",!0):((0,h.openBlock)(),(0,h.createBlock)(rh,{key:2,style:{flex:"1.5"},onClick:H[2]||(H[2]=()=>B("chatControl"))})),(0,h.unref)(g).isSpeakAfterTakingSeatMode&&((0,h.unref)(T)||(0,h.unref)(v))?((0,h.openBlock)(),(0,h.createBlock)(bf,{key:3,style:{flex:"2"},onClick:H[3]||(H[3]=()=>B("MasterApplyControl"))})):(0,h.createCommentVNode)("",!0),(0,h.createVNode)(im,{style:{flex:"2"},onClick:H[4]||(H[4]=z=>B("screenShareControl"))}),(0,h.unref)(g).isSpeakAfterTakingSeatMode&&!(0,h.unref)(T)?((0,h.openBlock)(),(0,h.createBlock)(Uf,{key:4,style:{flex:"1"},onClick:H[5]||(H[5]=()=>B("MemberApplyControl"))})):(0,h.createCommentVNode)("",!0),(0,h.createVNode)(Sf,{style:{flex:"1.5"},onClick:H[6]||(H[6]=()=>B("manageMemberControl"))}),(0,h.createVNode)(em,{style:{flex:"1"},onClick:H[7]||(H[7]=()=>B("moreControl"))})],2))}}),rm={"footer-container":{"":{width:"750rpx",position:"absolute",bottom:0,left:0,display:"flex",justifyContent:"space-around",alignItems:"center",flexWrap:"nowrap",flexDirection:"row",backgroundColor:"#FBFCFE",paddingTop:12,paddingRight:12,paddingBottom:20,paddingLeft:12}},"footer-hidden":{"":{"!bottom":-150}}},cm=Dt(sm,[["styles",[rm]]]);function um(){let{t:f}=on(),g=qt(),{isSidebarOpen:T,sidebarName:v}=(0,Mt.storeToRefs)(g),w=Dn(),{userNumber:N}=(0,Mt.storeToRefs)(w),B=(0,h.computed)(()=>T.value&&v.value!=="transfer-leave"),V=(0,h.computed)(()=>{let z="";switch(v.value){case"chat":z=f("Chat");break;case"invite":z=f("Invite");break;case"more":z=f("More");break;case"apply":z=f("Members applying on stage");break;case"manage-member":z=`${f("Members")} (${N.value})`;break}return z});function H(z){g.setSidebarOpenStatus(!1),g.setSidebarName(""),z()}return{t:f,isSidebarOpen:T,title:V,sidebarName:v,handleClose:H,showSideBar:B}}var lm=(0,h.defineComponent)({__name:"MemberInfo",props:{userInfo:{type:Object},showStateIcon:{type:null}},setup(f){let{t:g}=on(),T=f,v=qt(),w=Dn(),{isMaster:N,isSpeakAfterTakingSeatMode:B}=(0,Mt.storeToRefs)(w),V=(0,h.computed)(()=>v.userId===T.userInfo.userId),H=(0,h.computed)(()=>T.userInfo.userRole===Et.kRoomOwner),z=(0,h.computed)(()=>T.userInfo.userRole===Et.kAdministrator),ne=(0,h.computed)(()=>N.value&&V.value?`${g("Host")}, ${g("Me")}`:H.value?g("Host"):z.value&&V.value?`${g("Admin")}, ${g("Me")}`:z.value?g("Admin"):V.value?g("Me"):""),ge=(0,h.computed)(()=>B.value&&!T.userInfo.onSeat),pe=(0,h.computed)(()=>{let oe=[];return T.userInfo.hasScreenStream&&oe.push({icon:"ScreenOpenIcon",size:20,color:"#B2BBD1"}),ge.value||(oe.push({icon:T.userInfo.hasAudioStream?"AudioOpenIcon":"AudioCloseIcon",size:20,color:"#B2BBD1"}),oe.push({icon:T.userInfo.hasVideoStream?"VideoOpenIcon":"VideoCloseIcon",size:20,color:"#B2BBD1"})),ge.value&&!T.userInfo.isUserApplyingToAnchor&&(oe.push({icon:"AudioCloseIcon",disable:!0,size:20,color:"#B2BBD1"}),oe.push({icon:"VideoCloseIcon",disable:!0,size:20,color:"#B2BBD1"})),ge.value&&T.userInfo.isUserApplyingToAnchor&&oe.push({icon:"ApplyActiveIcon",size:20,color:"#1C66E5"}),oe});return(oe,de)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)([(0,h.unref)(Fn)?"member-info-mobile":"member-info"])},[(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)(!oe.showStateIcon&&z.value?"member-basic-info-admin":"member-basic-info")},[(0,h.createElementVNode)("div",{class:"avatar-url"},[(0,h.createVNode)(ku,{"img-src":oe.userInfo.avatarUrl},null,8,["img-src"])]),(0,h.createElementVNode)("u-text",{class:"user-name"},(0,h.toDisplayString)(oe.userInfo.userName||oe.userInfo.userId),1),(0,h.createElementVNode)("div",{class:"role-info"},[H.value||z.value?((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:0,style:{display:"flex"},color:z.value?"#F06C4B":"#1C66E5",icon:"UserIcon"},null,8,["color"])):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("u-text",{class:(0,h.normalizeClass)(`user-extra-info ${z.value?"user-extra-info-admin":""}`)},(0,h.toDisplayString)(ne.value),3)])],2),oe.showStateIcon?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"member-av-state"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(pe.value,(ae,te)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:(0,h.normalizeClass)(["state-icon",{"disable-icon":ae.disable}])},[((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:te,style:{display:"flex"},icon:ae.icon,size:ae.size,color:ae.color},null,8,["icon","size","color"]))],2))),256))])):(0,h.createCommentVNode)("",!0)],2))}}),dm={"member-info":{"":{display:"flex",width:"750rpx",flexDirection:"row",alignItems:"center",position:"relative"}},"member-info-mobile":{"":{display:"flex",width:"750rpx",flexDirection:"row",alignItems:"center",position:"relative"}},"member-basic-info":{".member-info ":{display:"flex",flexDirection:"row",alignItems:"center"},".member-info-mobile ":{display:"flex",flexDirection:"row",alignItems:"center"}},"member-basic-info-admin":{".member-info ":{display:"flex",flexDirection:"row",alignItems:"center"},".member-info-mobile ":{display:"flex",flexDirection:"row",alignItems:"center"}},"avatar-url":{".member-info .member-basic-info ":{width:32,height:32,display:"flex",borderRadius:50},".member-info .member-basic-info-admin ":{width:32,height:32,display:"flex",borderRadius:50},".member-info-mobile .member-basic-info ":{width:32,height:32,display:"flex",borderRadius:50},".member-info-mobile .member-basic-info-admin ":{width:32,height:32,display:"flex",borderRadius:50}},"user-name":{".member-info .member-basic-info ":{marginLeft:12,fontSize:14,fontWeight:"400",color:"#4F586B",lineHeight:22,textOverflow:"ellipsis",overflow:"hidden"},".member-info .member-basic-info-admin ":{marginLeft:12,fontSize:14,fontWeight:"400",color:"#4F586B",lineHeight:22,textOverflow:"ellipsis",overflow:"hidden"},".member-info-mobile .member-basic-info ":{marginLeft:12,fontSize:14,fontWeight:"400",color:"#4F586B",lineHeight:22,textOverflow:"ellipsis",overflow:"hidden"},".member-info-mobile .member-basic-info-admin ":{marginLeft:12,fontSize:14,fontWeight:"400",color:"#4F586B",lineHeight:22,textOverflow:"ellipsis",overflow:"hidden"}},"role-info":{".member-info .member-basic-info ":{display:"flex",flexDirection:"row",marginLeft:8,alignItems:"center"},".member-info .member-basic-info-admin ":{display:"flex",flexDirection:"row",marginLeft:8,alignItems:"center"},".member-info-mobile .member-basic-info ":{display:"flex",flexDirection:"row",marginLeft:8,alignItems:"center"},".member-info-mobile .member-basic-info-admin ":{display:"flex",flexDirection:"row",marginLeft:8,alignItems:"center"}},"user-extra-info":{".member-info .member-basic-info .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#1C66E5"},".member-info .member-basic-info-admin .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#1C66E5"},".member-info-mobile .member-basic-info .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#1C66E5"},".member-info-mobile .member-basic-info-admin .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#1C66E5"}},"user-extra-info-admin":{".member-info .member-basic-info .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#F06C4B"},".member-info .member-basic-info-admin .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#F06C4B"},".member-info-mobile .member-basic-info .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#F06C4B"},".member-info-mobile .member-basic-info-admin .role-info ":{lineHeight:20,fontSize:14,fontWeight:"400",marginLeft:4,paddingTop:0,paddingRight:6,paddingBottom:0,paddingLeft:6,color:"#F06C4B"}},"member-av-state":{".member-info ":{position:"absolute",right:60,top:2,bottom:0,display:"flex",alignItems:"center",flexDirection:"row",color:"#B2BBD1"},".member-info-mobile ":{position:"absolute",right:60,top:2,bottom:0,display:"flex",alignItems:"center",flexDirection:"row",color:"#B2BBD1"}},"state-icon":{".member-info .member-av-state ":{marginLeft:16},".member-info-mobile .member-av-state ":{marginLeft:16}},"disable-icon":{".member-info .member-av-state ":{opacity:.4},".member-info-mobile .member-av-state ":{opacity:.4}}},pm=Dt(lm,[["styles",[dm]]]);function gm(f){let g=zn(),{t:T}=on(),v=qt(),w=Dn(),N=(0,h.ref)(!1),B=(0,h.ref)({title:"",content:"",confirmText:"",actionType:""}),V=(0,h.computed)(()=>T("whether to kick sb off the room",{name:f.userInfo.userName||f.userInfo.userId})),H=(0,h.computed)(()=>T("Transfer the roomOwner to sb",{name:f.userInfo.userName||f.userInfo.userId})),{isFreeSpeakMode:z,isSpeakAfterTakingSeatMode:ne,localUser:ge,isGeneralUser:pe}=(0,Mt.storeToRefs)(w),{agreeUserOnStage:oe,denyUserOnStage:de,inviteUserOnStage:ae,cancelInviteUserOnStage:te,kickUserOffStage:J}=ch(),Le=(0,h.computed)(()=>v.userId===f.userInfo.userId),re=(0,h.computed)(()=>f.userInfo.onSeat===!0),Be=(0,h.computed)(()=>f.userInfo.onSeat!==!0),Ye=(0,h.computed)(()=>{let nt=f.userInfo.isUserApplyingToAnchor?[ze.value,gn.value]:[],Zt=Be.value&&!f.userInfo.isUserApplyingToAnchor?[O.value]:[],wt=re.value?[Xe.value,Ne.value,ct.value]:[],sn={freeSpeak:{[Et.kRoomOwner]:[Xe.value,Ne.value,A.value,me.value,Me.value],[Et.kAdministrator]:[Xe.value,Ne.value]},speakAfterTakeSeat:{[Et.kRoomOwner]:[...Zt,...wt,...nt,A.value,me.value,Me.value],[Et.kAdministrator]:[...Zt,...wt,...nt]}};return z.value?sn.freeSpeak[ge.value.userRole]||[]:ne.value?sn.speakAfterTakeSeat[ge.value.userRole]||[]:[]}),Xe=(0,h.computed)(()=>({key:"audioControl",icon:"AudioOpenIcon",title:f.userInfo.hasAudioStream?T("Mute"):T("Unmute"),func:dt})),Ne=(0,h.computed)(()=>({key:"videoControl",icon:"VideoOpenIcon",title:f.userInfo.hasVideoStream?T("Disable video"):T("Enable video"),func:He})),me=(0,h.computed)(()=>({key:"transferOwner",icon:"TransferOwnerIcon",title:T("Transfer owner"),func:()=>Ue("transferOwner")})),A=(0,h.computed)(()=>({key:"setOrRevokeAdmin",icon:f.userInfo.userRole===Et.kAdministrator?"RevokeAdminIcon":"SetAdminIcon",title:f.userInfo.userRole===Et.kAdministrator?T("Revoke administrator"):T("Set as administrator"),func:se})),Me=(0,h.computed)(()=>({key:"kickUser",icon:"KickOutIcon",title:T("Kick out"),func:()=>Ue("kickUser")})),O=(0,h.computed)(()=>({key:"inviteOnStage",icon:f.userInfo.isInvitingUserToAnchor?"DenyOnStageIcon":"InviteOnStageIcon",title:f.userInfo.isInvitingUserToAnchor?T("Cancel stage"):T("Invite stage"),func:pt})),ze=(0,h.computed)(()=>({key:"agreeOnStage",icon:"OnStageIcon",title:T("Agree to the stage"),func:oe})),gn=(0,h.computed)(()=>({key:"denyOnStage",icon:"DenyOnStageIcon",title:T("Refuse stage"),func:de})),ct=(0,h.computed)(()=>({key:"makeOffStage",icon:"OffStageIcon",title:T("Step down"),func:J}));function pt(nt){return Oe(this,null,function*(){let{isInvitingUserToAnchor:Zt}=nt;Zt?te(nt):ae(nt)})}function dt(nt){return Oe(this,null,function*(){var Zt,wt;if(nt.hasAudioStream)yield(Zt=g.instance)==null?void 0:Zt.closeRemoteDeviceByAdmin({userId:nt.userId,device:qo.kMicrophone});else{if(nt.isRequestingUserOpenMic){kt({type:"info",message:`${T("An invitation to open the microphone has been sent to sb.",{name:nt.userName||nt.userId})}`,duration:ln.NORMAL});return}let sn=yield(wt=g.instance)==null?void 0:wt.openRemoteDeviceByAdmin({userId:nt.userId,device:qo.kMicrophone,timeout:0,requestCallback:rn=>{w.setRequestUserOpenMic({userId:nt.userId,isRequesting:!1});let{requestCallbackType:gt,code:St}=rn;switch(gt){case Hn.kRequestError:St===Tn.ERR_REQUEST_ID_REPEAT&&kt({type:"warning",message:T("This member has already received the same request, please try again later"),duration:ln.NORMAL});break}}});kt({type:"info",message:`${T("An invitation to open the microphone has been sent to sb.",{name:nt.userName||nt.userId})}`,duration:ln.NORMAL}),sn&&sn.requestId&&w.setRequestUserOpenMic({userId:nt.userId,isRequesting:!0,requestId:sn.requestId})}})}function He(nt){return Oe(this,null,function*(){var Zt,wt;if(nt.hasVideoStream)yield(Zt=g.instance)==null?void 0:Zt.closeRemoteDeviceByAdmin({userId:nt.userId,device:qo.kCamera});else{if(nt.isRequestingUserOpenCamera){kt({type:"info",message:`${T("An invitation to open the camera has been sent to sb.",{name:nt.userName||nt.userId})}`,duration:ln.NORMAL});return}let sn=yield(wt=g.instance)==null?void 0:wt.openRemoteDeviceByAdmin({userId:nt.userId,device:qo.kCamera,timeout:0,requestCallback:rn=>{w.setRequestUserOpenCamera({userId:nt.userId,isRequesting:!1});let{requestCallbackType:gt,code:St}=rn;switch(gt){case Hn.kRequestError:St===Tn.ERR_REQUEST_ID_REPEAT&&kt({type:"warning",message:T("This member has already received the same request, please try again later"),duration:ln.NORMAL});break}}});kt({type:"info",message:`${T("An invitation to open the camera has been sent to sb.",{name:nt.userName||nt.userId})}`,duration:ln.NORMAL}),sn&&sn.requestId&&w.setRequestUserOpenCamera({userId:nt.userId,isRequesting:!0,requestId:sn.requestId})}})}function ee(nt){return Oe(this,null,function*(){var Zt;yield(Zt=g.instance)==null?void 0:Zt.kickRemoteUserOutOfRoom({userId:nt.userId})})}function Qe(nt){return Oe(this,null,function*(){var Zt,wt;let sn=yield(Zt=g.instance)==null?void 0:Zt.fetchRoomInfo();if((sn==null?void 0:sn.roomOwner)===w.localUser.userId)try{yield(wt=g.instance)==null?void 0:wt.changeUserRole({userId:nt.userId,userRole:Et.kRoomOwner}),w.setMasterUserId(nt.userId),kt({type:"success",message:T("The room owner has been transferred to sb",{name:nt.userName||nt.userId}),duration:ln.NORMAL})}catch(rn){kt({type:"error",message:T("Transfer owner failed, please try again."),duration:ln.NORMAL})}})}function se(nt){return Oe(this,null,function*(){var Zt;let wt=nt.userRole===Et.kGeneralUser?Et.kAdministrator:Et.kGeneralUser;yield(Zt=g.instance)==null?void 0:Zt.changeUserRole({userId:nt.userId,userRole:wt});let sn=w.getUserName(nt.userId),rn=wt===Et.kAdministrator?`${T("sb has been set as administrator",{name:sn})}`:`${T("The administrator status of sb has been withdrawn",{name:sn})}`;kt({type:"success",message:rn}),w.setRemoteUserRole(nt.userId,wt)})}function Ue(nt){switch(N.value=!0,nt){case"kickUser":B.value={title:T("Note"),content:V.value,confirmText:T("Confirm"),actionType:nt};break;case"transferOwner":B.value={title:H.value,content:T("After transfer the room owner, you will become a general user"),confirmText:T("Confirm transfer"),actionType:nt};break}}function At(nt){switch(B.value.actionType){case"kickUser":ee(nt);break;case"transferOwner":Qe(nt);break}N.value=!1}function qn(){N.value=!1}return{props:f,isMe:Le,isGeneralUser:pe,controlList:Ye,kickOffDialogContent:V,handleCancelDialog:qn,handleAction:At,isDialogVisible:N,dialogData:B}}var hm=(0,h.defineComponent)({__name:"index",props:{userInfo:{type:Object},showMemberControl:{type:Boolean}},emits:["on-close-control"],setup(f,{emit:g}){let T=f,{t:v}=on(),{isGeneralUser:w,controlList:N,handleCancelDialog:B,handleAction:V,isDialogVisible:H,dialogData:z}=gm(T),ne=g;function ge(){ne("on-close-control")}return(pe,oe)=>(0,h.unref)(w)?(0,h.createCommentVNode)("",!0):((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"member-control-container"},[(0,h.createElementVNode)("div",{class:"member-title"},[(0,h.createElementVNode)("div",{class:"avatar-url"},[(0,h.createVNode)(ku,{"img-src":pe.userInfo.avatarUrl},null,8,["img-src"])]),(0,h.createElementVNode)("u-text",{class:"member-title-content"},(0,h.toDisplayString)(pe.userInfo.userName||pe.userInfo.userId),1),(0,h.unref)(mo)||(0,h.unref)(Ro)?((0,h.openBlock)(),(0,h.createElementBlock)("u-text",{key:0,class:"tab-cancel",onClick:(0,h.withModifiers)(ge,["stop"])},(0,h.toDisplayString)((0,h.unref)(v)("Cancel")),1)):(0,h.createCommentVNode)("",!0)]),((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(N),de=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:de.key,class:"user-operate-item",onClick:()=>de.func(pe.userInfo)},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:de.icon,class:"icon-svg"},null,8,["icon"]),(0,h.createElementVNode)("u-text",{class:"control-title"},(0,h.toDisplayString)(de.title),1)],8,["onClick"]))),128)),(0,h.createVNode)(Oa,{modelValue:(0,h.unref)(H),"onUpdate:modelValue":oe[0]||(oe[0]=de=>(0,h.isRef)(H)?H.value=de:null),title:(0,h.unref)(z).title,width:"480px",modal:!0,"append-to-room-container":!0,"confirm-button":(0,h.unref)(z).confirmText,"cancel-button":(0,h.unref)(v)("Cancel"),onConfirm:oe[1]||(oe[1]=de=>(0,h.unref)(V)(T.userInfo)),onCancel:(0,h.unref)(B)},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(z).content),1)]),_:1},8,["modelValue","title","confirm-button","cancel-button","onCancel"])]))}}),_m={"member-control-container":{"":{width:"750rpx",position:"fixed",bottom:0,left:0,zIndex:2,paddingTop:22,paddingRight:16,paddingBottom:22,paddingLeft:16,backgroundColor:"#F2F2F2",borderTopLeftRadius:15,borderTopRightRadius:15,borderBottomRightRadius:0,borderBottomLeftRadius:0,display:"flex","!flexDirection":"column"}},"member-title":{"":{display:"flex",flexDirection:"row",width:"750rpx",marginBottom:10,alignItems:"center",position:"relative"}},"avatar-url":{".member-title ":{width:30,height:30,borderRadius:50}},"member-title-content":{".member-title ":{fontWeight:"500",fontSize:16,lineHeight:22,color:"#5f5c5c",marginLeft:10}},"user-operate-item":{"":{width:"750rpx",display:"flex",flexDirection:"row",paddingTop:10,alignItems:"center"}},"control-title":{".user-operate-item ":{fontWeight:"500",fontSize:16,lineHeight:22,color:"#5f5c5c",marginLeft:10}},"agree-button":{"":{paddingTop:12,paddingRight:12,paddingBottom:12,paddingLeft:12,width:50,display:"flex",alignItems:"center",color:"#1C66E5"}},"cancel-button":{"":{paddingTop:12,paddingRight:12,paddingBottom:12,paddingLeft:12,width:50,display:"flex",alignItems:"center"}},"tab-cancel":{"":{fontFamily:'"PingFang SC"',fontStyle:"normal",lineHeight:24,fontWeight:"400",fontSize:16,color:"#5f5c5c",position:"absolute",right:40}}},fm=Dt(hm,[["styles",[_m]]]),ip=(0,h.ref)("");function mm(f){let g=Dn(),{isMaster:T,isAdmin:v}=(0,Mt.storeToRefs)(g),w=(0,h.computed)(()=>{let H=f.userRole===Et.kRoomOwner,z=f.userRole===Et.kGeneralUser;return T.value&&!H||v.value&&z}),N=(0,h.computed)(()=>f.userId===ip.value&&w.value);function B(){ip.value=f.userId}function V(){ip.value=""}return{isMemberControlAccessible:N,openMemberControl:B,closeMemberControl:V}}var vm=(0,h.defineComponent)({__name:"index",props:{userInfo:{type:Object}},setup(f){let g=f,T=(0,h.ref)(),{isMemberControlAccessible:v,openMemberControl:w,closeMemberControl:N}=mm(g.userInfo),B=(0,h.ref)(!1);(0,h.watch)(v,z=>{z===!1&&(B.value=!1)});let V=z=>{z.stopPropagation(),w(),v.value===!0&&(B.value=!0)},H=z=>{var ne;Bl&&((ne=T.value)!=null&&ne.contains(z==null?void 0:z.target))||(N(),B.value=!1)};return(0,h.onMounted)(()=>{document==null||document.addEventListener("touchend",H)}),(0,h.onUnmounted)(()=>{document==null||document.removeEventListener("touchend",H)}),(z,ne)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{ref_key:"memberItemContainerRef",ref:T,class:"member-item-container",onClick:V},[(0,h.createVNode)(pm,{"show-state-icon":!0,"user-info":g.userInfo},null,8,["user-info"]),B.value?((0,h.openBlock)(),(0,h.createBlock)(fm,{key:0,"show-member-control":B.value,"user-info":g.userInfo,onOnCloseControl:H},null,8,["show-member-control","user-info"])):(0,h.createCommentVNode)("",!0)],512))}}),ym={"member-item-container":{"":{width:"750rpx",display:"flex",flexDirection:"row",alignItems:"center",height:69,paddingTop:0,paddingRight:32,paddingBottom:0,paddingLeft:32,"backgroundColor:hover":"#F3F3F3"}}},Im=Dt(vm,[["styles",[ym]]]);function Mm(){let f=zn(),{t:g}=on(),T=qt(),v=Dn(),{userList:w,anchorUserList:N,applyToAnchorList:B,isOnStateTabActive:V}=(0,Mt.storeToRefs)(v),H=(0,h.computed)(()=>w.value.filter(pt=>!N.value.includes(pt))),z=(0,h.ref)("");function ne(){V.value=!V.value,v.setOnStageTabStatus(V.value)}let ge=(0,h.computed)(()=>{let pt=[];return v.isFreeSpeakMode?pt=w.value:v.isSpeakAfterTakingSeatMode&&(pt=V.value?N.value:H.value),z.value?pt.filter(dt=>{var He;return((He=dt.userName)==null?void 0:He.includes(z.value))||dt.userId.includes(z.value)}):pt}),pe=(0,h.computed)(()=>`${g("Already on stage")} (${N.value.length})`),oe=(0,h.computed)(()=>`${g("Not on stage")} (${H.value.length})`);function de(){T.setSidebarName("invite")}let ae=(0,h.computed)(()=>v.isMicrophoneDisableForAllUser?g("Lift all mute"):g("All mute")),te=(0,h.computed)(()=>v.isCameraDisableForAllUser?g("Lift stop all video"):g("All stop video")),J=(0,h.ref)(!1),Le=(0,h.ref)(""),re=(0,h.ref)(""),Be=(0,h.ref)(""),Ye=!1,Xe=!1,Ne;(pt=>{pt.AUDIO="audio",pt.VIDEO="video"})(Ne||(Ne={}));let me=(0,h.ref)("audio");function A(pt){return Oe(this,null,function*(){switch(J.value=!0,me.value=pt,pt){case"audio":re.value=v.isMicrophoneDisableForAllUser?g("Enable all audios"):g("All current and new members will be muted"),Le.value=v.isMicrophoneDisableForAllUser?g("After unlocking, users can freely turn on the microphone"):g("Members will not be able to open the microphone"),Ye=!v.isMicrophoneDisableForAllUser,yield(0,h.nextTick)(),Be.value=ae.value;break;case"video":re.value=v.isCameraDisableForAllUser?g("Enable all videos"):g("All and new members will be banned from the camera"),Le.value=v.isCameraDisableForAllUser?g("After unlocking, users can freely turn on the camera"):g("Members will not be able to open the camera"),Xe=!v.isCameraDisableForAllUser,yield(0,h.nextTick)(),Be.value=te.value;break}})}function Me(){return Oe(this,null,function*(){switch(me.value){case"audio":ze();break;case"video":gn();break}J.value=!1})}function O(){Fn?(T.setSidebarOpenStatus(!0),T.setSidebarName("apply")):T.setShowApplyUserList(!0)}function ze(){return Oe(this,null,function*(){var pt;if(v.isMicrophoneDisableForAllUser===Ye){let dt=g(Ye?"All audios disabled":"All audios enabled");kt({type:"success",message:dt,duration:ln.NORMAL});return}yield(pt=f.instance)==null?void 0:pt.disableDeviceForAllUserByAdmin({isDisable:Ye,device:qo.kMicrophone}),v.setMicrophoneDisableState(Ye)})}function gn(){return Oe(this,null,function*(){var pt;if(v.isCameraDisableForAllUser===Xe){let dt=g(Xe?"All videos disabled":"All videos enabled");kt({type:"success",message:dt,duration:ln.NORMAL});return}yield(pt=f.instance)==null?void 0:pt.disableDeviceForAllUserByAdmin({isDisable:Xe,device:qo.kCamera}),v.setCameraDisableState(Xe)})}let ct=(0,h.computed)(()=>{var pt,dt;let He=((pt=B.value[0])==null?void 0:pt.userName)||((dt=B.value[0])==null?void 0:dt.userId);return B.value.length===1?`${He} ${g("Applying for the stage")}`:`${He} ${g("and so on number people applying to stage",{number:B.value.length})}`});return{showApplyUserList:O,searchText:z,handleInvite:de,t:g,toggleManageAllMember:A,doToggleManageAllMember:Me,audioManageInfo:ae,videoManageInfo:te,showManageAllUserDialog:J,dialogContent:Le,dialogTitle:re,dialogActionInfo:Be,ManageControlType:Ne,alreadyStaged:pe,notStaged:oe,filteredUserList:ge,isOnStateTabActive:V,handleToggleStaged:ne,applyToAnchorUserContent:ct}}var Cm=(0,h.defineComponent)({__name:"index",setup(f){let g=Dn(),{userNumber:T,applyToAnchorList:v,isMicrophoneDisableForAllUser:w,isCameraDisableForAllUser:N,isGeneralUser:B}=(0,Mt.storeToRefs)(g),{audioManageInfo:V,videoManageInfo:H,showManageAllUserDialog:z,dialogTitle:ne,dialogContent:ge,ManageControlType:pe,toggleManageAllMember:oe,doToggleManageAllMember:de,t:ae,alreadyStaged:te,notStaged:J,filteredUserList:Le,isOnStateTabActive:re,handleToggleStaged:Be,applyToAnchorUserContent:Ye,showApplyUserList:Xe}=Mm();return(Ne,me)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"manage-member-container"},[(0,h.createElementVNode)("div",{class:"manage-member-header"},[(0,h.unref)(g).isSpeakAfterTakingSeatMode?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"apply-count",onClick:me[0]||(me[0]=(...A)=>(0,h.unref)(Be)&&(0,h.unref)(Be)(...A))},[(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)(["apply-staged",{"apply-count-active":(0,h.unref)(re)}])},[(0,h.createElementVNode)("u-text",{class:"staged-text"},(0,h.toDisplayString)((0,h.unref)(te)),1)],2),(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)(["apply-not-stage",{"apply-count-active":!(0,h.unref)(re)}])},[(0,h.createElementVNode)("u-text",{class:"staged-text"},(0,h.toDisplayString)((0,h.unref)(J)),1)],2)])):(0,h.createCommentVNode)("",!0),(0,h.unref)(v).length>0&&!(0,h.unref)(B)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:"apply-on-stage-info"},[(0,h.createVNode)(Sn,{style:{display:"flex"},icon:"ApplyTipsIcon",color:"#B2BBD1"}),(0,h.createElementVNode)("u-text",{class:"apply-info"},(0,h.toDisplayString)((0,h.unref)(Ye)),1),(0,h.createElementVNode)("u-text",{class:"apply-check",onClick:me[1]||(me[1]=(...A)=>(0,h.unref)(Xe)&&(0,h.unref)(Xe)(...A))},(0,h.toDisplayString)((0,h.unref)(ae)("Check")),1)])):(0,h.createCommentVNode)("",!0)]),(0,h.createElementVNode)("div",{class:"member-list-container"},[(0,h.createElementVNode)("div",{class:"member-list-header"},[(0,h.createElementVNode)("u-text",{class:"member-list"},(0,h.toDisplayString)((0,h.unref)(ae)("Member List")),1),(0,h.createElementVNode)("u-text",{class:"member-count"},"("+(0,h.toDisplayString)((0,h.unref)(T))+(0,h.toDisplayString)((0,h.unref)(ae)("members"))+")",1)]),(0,h.createElementVNode)("div",{class:"member-list-content"},[(0,h.createElementVNode)("scroll-view",{class:"scroll-view",scrollY:"true"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)((0,h.unref)(Le),A=>((0,h.openBlock)(),(0,h.createBlock)(Im,{key:A.userId,"user-info":A},null,8,["user-info"]))),128))])])]),(0,h.unref)(B)?(0,h.createCommentVNode)("",!0):((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"manage-member-bottom"},[(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)(["manage-member-button",(0,h.unref)(w)?"lift-all":""]),onTouchstart:me[2]||(me[2]=A=>(0,h.unref)(oe)((0,h.unref)(pe).AUDIO))},[(0,h.createElementVNode)("u-text",{class:"manage-member-text"},(0,h.toDisplayString)((0,h.unref)(V)),1)],34),(0,h.createElementVNode)("div",{class:(0,h.normalizeClass)(["manage-member-button",(0,h.unref)(N)?"lift-all":""]),onTouchstart:me[3]||(me[3]=A=>(0,h.unref)(oe)((0,h.unref)(pe).VIDEO))},[(0,h.createElementVNode)("u-text",{class:"manage-member-text"},(0,h.toDisplayString)((0,h.unref)(H)),1)],34)])),(0,h.createVNode)(Oa,{modelValue:(0,h.unref)(z),"onUpdate:modelValue":me[4]||(me[4]=A=>(0,h.isRef)(z)?z.value=A:null),title:(0,h.unref)(ne),width:"480px",modal:!0,"append-to-room-container":!0,"confirm-button":(0,h.unref)(ae)("Confirm"),"cancel-button":(0,h.unref)(ae)("Cancel"),onConfirm:(0,h.unref)(de),onCancel:me[5]||(me[5]=A=>z.value=!1)},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(ge)),1)]),_:1},8,["modelValue","title","confirm-button","cancel-button","onConfirm"])]))}}),Tm={"manage-member-container":{"":{position:"relative",width:"750rpx",height:"1440rpx",display:"flex",flexDirection:"column"}},"apply-count":{".manage-member-container .manage-member-header ":{height:36,borderRadius:10,marginTop:16,marginRight:16,marginBottom:8,marginLeft:16,backgroundColor:"#F0F3FA",display:"flex",flexDirection:"row",justifyContent:"space-around",flex:1,paddingTop:3,paddingRight:4,paddingBottom:3,paddingLeft:4}},"apply-staged":{".manage-member-container .manage-member-header .apply-count ":{flex:1,borderRadius:10,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row",textAlign:"center"}},"apply-not-stage":{".manage-member-container .manage-member-header .apply-count ":{flex:1,borderRadius:10,display:"flex",justifyContent:"center",alignItems:"center",flexDirection:"row",textAlign:"center"}},"staged-text":{".manage-member-container .manage-member-header .apply-count .apply-staged ":{color:"#4F586B",fontSize:14,fontWeight:"400"},".manage-member-container .manage-member-header .apply-count .apply-not-stage ":{color:"#4F586B",fontSize:14,fontWeight:"400"}},"apply-count-active":{".manage-member-container .manage-member-header .apply-count ":{backgroundColor:"#FFFFFF"}},"apply-on-stage-info":{".manage-member-container .manage-member-header ":{height:40,paddingTop:0,paddingRight:20,paddingBottom:0,paddingLeft:26,flex:1,display:"flex",justifyContent:"space-between",alignItems:"center",flexDirection:"row"}},"apply-info":{".manage-member-container .manage-member-header .apply-on-stage-info ":{fontWeight:"400",fontSize:14,color:"#4F586B",paddingLeft:4,flex:1},".manage-member-container .manage-member-header ":{fontWeight:"400",fontSize:14,color:"#FFFFFF"}},"apply-check":{".manage-member-container .manage-member-header .apply-on-stage-info ":{textAlign:"center",lineHeight:32,fontWeight:"400",fontSize:14,color:"#1C66E5"}},button:{".manage-member-container .manage-member-header ":{width:82,height:32,backgroundColor:"rgba(255,255,255,0.1)",borderWidth:1,borderStyle:"solid",borderColor:"#FFFFFF",borderRadius:2,textAlign:"center",lineHeight:32,fontWeight:"400",fontSize:14,color:"#FFFFFF"}},"member-list-container":{".manage-member-container ":{flex:1,display:"flex",flexDirection:"column"}},"member-list":{".manage-member-container .member-list-container ":{fontWeight:"500",fontSize:14,color:"#000000",lineHeight:24}},"member-count":{".manage-member-container .member-list-container ":{fontWeight:"500",fontSize:14,color:"#000000",lineHeight:24,display:"flex",flexDirection:"row",marginLeft:5}},"member-list-header":{".manage-member-container .member-list-container ":{paddingTop:0,paddingRight:32,paddingBottom:0,paddingLeft:32,marginBottom:8,display:"flex",flexDirection:"row"}},"member-list-content":{".manage-member-container .member-list-container ":{display:"flex",flexDirection:"row",flex:1}},"scroll-view":{".manage-member-container .member-list-container .member-list-content ":{flex:1,display:"flex",flexDirection:"column"}},"manage-member-bottom":{".manage-member-container ":{display:"flex",justifyContent:"space-around",flexDirection:"row",marginBottom:40,marginTop:10}},"manage-member-button":{".manage-member-container .manage-member-bottom ":{borderRadius:10,paddingTop:13,paddingRight:24,paddingBottom:13,paddingLeft:24,backgroundColor:"#006EFF"}},"manage-member-text":{".manage-member-container .manage-member-bottom .manage-member-button ":{fontWeight:"400",color:"#FFFFFF"}},"lift-all":{".manage-member-container .manage-member-bottom ":{color:"#FFFFFF"}},"popup-dialog-audio":{".manage-member-container ":{width:64,backgroundColor:"#ececed",borderRadius:8,position:"absolute",bottom:46,left:18}},"popup-dialog-video":{".manage-member-container ":{width:64,backgroundColor:"#ececed",borderRadius:8,position:"absolute",bottom:46,left:18}},"popup-dialog-audio-title":{".manage-member-container .popup-dialog-audio ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:16,lineHeight:22,textAlign:"center",color:"#2B2E38",paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20},".manage-member-container .popup-dialog-video ":{fontFamily:'"PingFang SC"',fontStyle:"normal",fontWeight:"400",fontSize:16,lineHeight:22,textAlign:"center",color:"#2B2E38",paddingTop:20,paddingRight:20,paddingBottom:20,paddingLeft:20}},"popup-button":{".manage-member-container .popup-dialog-audio ":{display:"flex",paddingTop:10,paddingRight:10,paddingBottom:10,paddingLeft:10},".manage-member-container .popup-dialog-video ":{display:"flex",paddingTop:10,paddingRight:10,paddingBottom:10,paddingLeft:10}},"popup-button-cancel":{".manage-member-container .popup-dialog-audio .popup-button ":{paddingTop:4,paddingRight:16,paddingBottom:4,paddingLeft:16,backgroundColor:"#ffffff",color:"#646366",borderWidth:1,borderStyle:"solid",borderColor:"#dcdfe6",borderRadius:4},".manage-member-container .popup-dialog-video .popup-button ":{paddingTop:4,paddingRight:16,paddingBottom:4,paddingLeft:16,backgroundColor:"#ffffff",color:"#646366",borderWidth:1,borderStyle:"solid",borderColor:"#dcdfe6",borderRadius:4}},"popup-button-mute":{".manage-member-container .popup-dialog-audio .popup-button ":{paddingTop:4,paddingRight:16,paddingBottom:4,paddingLeft:16,backgroundColor:"#006eff",color:"#ffffff",borderWidth:1,borderStyle:"solid",borderColor:"#dcdfe6",borderRadius:4},".manage-member-container .popup-dialog-video .popup-button ":{paddingTop:4,paddingRight:16,paddingBottom:4,paddingLeft:16,backgroundColor:"#006eff",color:"#ffffff",borderWidth:1,borderStyle:"solid",borderColor:"#dcdfe6",borderRadius:4}},agree:{"":{paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,width:50,display:"flex",alignItems:"center",justifyContent:"center",color:"#1C66E5",fontSize:16,fontWeight:"500"}},cancel:{"":{paddingTop:14,paddingRight:14,paddingBottom:14,paddingLeft:14,width:50,display:"flex",alignItems:"center",justifyContent:"center",color:"#4F586B",fontSize:16,fontWeight:"500"}}},Sm=Dt(Cm,[["styles",[Tm]]]),Dm=(0,h.defineComponent)({__name:"index",setup(f){let g=(0,h.ref)();g.value=uni.getSystemInfoSync().screenHeight;let{title:T,sidebarName:v,showSideBar:w}=um();return(N,B)=>(0,h.unref)(w)?((0,h.openBlock)(),(0,h.createBlock)(jg,{key:0,title:(0,h.unref)(T),class:"sidebar-container-mobile"},{sidebarContent:(0,h.withCtx)(()=>[(0,h.createElementVNode)("div",{style:{height:"1440rpx"}},[(0,h.unref)(v)==="manage-member"?((0,h.openBlock)(),(0,h.createBlock)((0,h.unref)(Sm),{key:0})):(0,h.createCommentVNode)("",!0),(0,h.unref)(v)==="apply"?((0,h.openBlock)(),(0,h.createBlock)((0,h.unref)(uh),{key:1})):(0,h.createCommentVNode)("",!0)])]),_:1},8,["title"])):(0,h.createCommentVNode)("",!0)}}),Em={"sidebar-container-mobile":{"":{height:"1440rpx",position:"fixed",top:0,right:0,zIndex:101}}},Rm=Dt(Dm,[["styles",[Em]]]),Lm="[StreamRegion]",km=(0,h.defineComponent)({__name:"stream",props:{stream:{type:Object},userId:{type:String},layout:{type:String}},setup(f){let g=zn(),T=qt(),v=f;(0,h.ref)();let w=(0,h.computed)(()=>`${v.stream.userId}${v.stream.streamType}${v.layout}`);function N(){return Oe(this,null,function*(){var B,V,H;T.userId===v.stream.userId?v.stream.hasVideoStream&&(yield(B=g.instance)==null?void 0:B.setLocalVideoView({view:`${w.value}`})):(yield(V=g.instance)==null?void 0:V.setRemoteVideoView({userId:v.stream.userId,streamType:v.stream.streamType,view:`${w.value}`}),yield(H=g.instance)==null?void 0:H.startPlayRemoteVideo({userId:v.stream.userId,streamType:v.stream.streamType}))})}return(0,h.onMounted)(()=>{(0,h.watch)(()=>v.stream.hasVideoStream,B=>Oe(this,null,function*(){B&&(yield(0,h.nextTick)(),st("debug","at src/roomkit/TUIRoom/components/RoomContent/StreamRegion/stream.nvue:58",`${Lm}watch isVideoStreamAvailable:`,v.stream.userId),N())}),{immediate:!0,deep:!0})}),(0,h.onMounted)(()=>{(0,h.watch)(()=>v.stream.hasScreenStream,B=>Oe(this,null,function*(){B&&(yield(0,h.nextTick)(),yield N())}),{immediate:!0,deep:!0})}),(B,V)=>{let H=(0,h.resolveComponent)("TencentCloud-LocalViewComponent"),z=(0,h.resolveComponent)("TencentCloud-RemoteViewComponent");return(0,h.openBlock)(),(0,h.createElementBlock)(h.Fragment,null,[(0,h.unref)(T).userId===v.stream.userId?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"stream-region-container"},[(0,h.createVNode)(H,{class:"stream-region"})])):(0,h.createCommentVNode)("",!0),(0,h.unref)(T).userId!==v.stream.userId?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:"stream-region-container"},[(0,h.createVNode)(z,{view:w.value,class:"stream-region"},null,8,["view"])])):(0,h.createCommentVNode)("",!0)],64)}}}),Am={"stream-region-container":{"":{display:"flex",flex:1,overflow:"hidden",backgroundColor:"#000000",borderRadius:6}},"stream-region":{"":{flex:1}}},Om=Dt(km,[["styles",[Am]]]),Nm=(0,h.defineComponent)({__name:"index",props:{stream:{type:Object},enlargeDomId:{type:String},userId:{type:String},styleObject:{type:Object},audioVolume:{type:Number},isPlayStream:{type:Boolean},layout:{type:String}},setup(f){zn();let g=qt();Dn();let{t:T}=on();(0,Mt.storeToRefs)(g);let v=f,w=(0,h.ref)(),N=(0,h.computed)(()=>v.stream.hasAudioStream&&v.audioVolume!==0),B=(0,h.computed)(()=>`${v.stream.userId}${v.stream.streamType}`),V=(0,h.computed)(()=>{let{streamType:pe,userRole:oe}=v.stream;return oe===Et.kRoomOwner&&pe===jt.kCameraStream}),H=(0,h.computed)(()=>{let{streamType:pe,userRole:oe}=v.stream;return oe===Et.kAdministrator&&pe===jt.kCameraStream}),z=(0,h.computed)(()=>V.value||H.value),ne=(0,h.computed)(()=>v.stream.streamType===jt.kScreenStream),ge=(0,h.computed)(()=>v.stream.userName||v.stream.userId);return(pe,oe)=>B.value!==pe.enlargeDomId?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,ref_key:"streamRegionRef",ref:w,style:(0,h.normalizeStyle)(pe.styleObject),class:(0,h.normalizeClass)(["user-stream-container",N.value?"border":""])},[pe.isPlayStream?((0,h.openBlock)(),(0,h.createBlock)((0,h.unref)(Om),{key:0,stream:v.stream,layout:v.layout},null,8,["stream","layout"])):(0,h.createCommentVNode)("",!0),!pe.stream.hasVideoStream&&!pe.stream.hasScreenStream?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:1,class:"center-user-info-container"},[(0,h.createElementVNode)("div",{class:"avatar-region"},[(0,h.createVNode)(ku,{"img-src":pe.stream.avatarUrl},null,8,["img-src"])])])):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("div",{class:"corner-user-info-container"},[z.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:(0,h.normalizeClass)(V.value?"master-icon":"admin-icon")},[(0,h.createVNode)(Sn,{icon:"UserIcon",size:"20",color:"#FFFFFF"})],2)):(0,h.createCommentVNode)("",!0),ne.value?(0,h.createCommentVNode)("",!0):((0,h.openBlock)(),(0,h.createBlock)(nh,{key:1,class:"audio-icon","user-id":pe.stream.userId,"is-muted":!pe.stream.hasAudioStream,audioVolume:pe.audioVolume,size:"small",color:"#FFFFFF"},null,8,["user-id","is-muted","audioVolume"])),ne.value?((0,h.openBlock)(),(0,h.createBlock)(Sn,{key:2,icon:"ScreenOpenIcon",color:"#FFFFFF"})):(0,h.createCommentVNode)("",!0),(0,h.createElementVNode)("u-text",{class:"user-name",title:ge.value},(0,h.toDisplayString)(ge.value),9,["title"]),ne.value?((0,h.openBlock)(),(0,h.createElementBlock)("u-text",{key:3,class:"user-screen-info"},(0,h.toDisplayString)((0,h.unref)(T)("is sharing their screen")),1)):(0,h.createCommentVNode)("",!0)])],6)):(0,h.createCommentVNode)("",!0)}}),bm={"user-stream-container":{"":{position:"relative",borderWidth:2,borderStyle:"solid",borderColor:"rgba(0,0,0,0)",overflow:"hidden",borderRadius:10,display:"flex"},".border":{borderWidth:2,borderStyle:"solid",borderColor:"#37E858"}},"center-user-info-container":{".user-stream-container ":{position:"absolute",top:0,left:0,right:0,bottom:0,display:"flex",justifyContent:"center",alignItems:"center",backgroundColor:"#F2F2F2"}},"avatar-region":{".user-stream-container .center-user-info-container ":{width:130,height:130,display:"flex"},".user-stream-container .center-user-info-container .user-info ":{width:130,height:130,borderRadius:50}},"user-info":{".user-stream-container .center-user-info-container ":{width:130,textAlign:"center"}},"user-name":{".user-stream-container .center-user-info-container .user-info .user-gender-name ":{marginLeft:6,fontSize:14,fontWeight:"400",textOverflow:"ellipsis",overflow:"hidden"},".user-stream-container .corner-user-info-container ":{marginLeft:8,width:60,textOverflow:"ellipsis",overflow:"hidden",lines:1,color:"#FFFFFF"}},"corner-user-info-container":{".user-stream-container ":{position:"absolute",bottom:4,left:0,flex:1,overflow:"hidden",height:30,display:"flex",backgroundColor:"rgba(0,0,0,0.6)",color:"#FFFFFF",alignItems:"center",fontSize:14,flexDirection:"row"}},"user-screen-info":{".user-stream-container .corner-user-info-container ":{paddingRight:5,lines:1,color:"#FFFFFF"}},"master-icon":{".user-stream-container .corner-user-info-container ":{marginLeft:0,width:32,height:32,backgroundColor:"#1C66E5",display:"flex",justifyContent:"center",alignItems:"center"}},"admin-icon":{".user-stream-container .corner-user-info-container ":{marginLeft:0,width:32,height:32,backgroundColor:"#F06C4B",display:"flex",justifyContent:"center",alignItems:"center"}}},ap=Dt(Nm,[["styles",[bm]]]),Pm=(0,h.defineComponent)({__name:"index",props:{isMiniRegion:{type:Boolean}},setup(f){let{t:g}=on(),T=(0,h.ref)(!1);function v(){T.value=!0}function w(){T.value=!1,Ru.emit("ScreenShare:stopScreenShare")}return(N,B)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"local-screen-container"},[(0,h.createElementVNode)("div",{class:"local-screen-control-container"},[(0,h.createVNode)(Sn,{size:"48",icon:"ScreenSharingIcon"}),(0,h.createElementVNode)("u-text",{class:"text"},(0,h.toDisplayString)((0,h.unref)(g)("You are sharing the screen...")),1),(0,h.createElementVNode)("span",{class:"stop-button",onClick:[v,B[0]||(B[0]=(0,h.withModifiers)(()=>{},["stop"]))]},[(0,h.createElementVNode)("u-text",{class:"text-end"},(0,h.toDisplayString)((0,h.unref)(g)("End sharing")),1)])]),(0,h.createVNode)(Oa,{modelValue:T.value,"onUpdate:modelValue":B[1]||(B[1]=V=>T.value=V),width:"420px",title:(0,h.unref)(g)("End sharing"),modal:!0,"close-on-click-modal":!0,"append-to-room-container":!0,"confirm-button":(0,h.unref)(g)("End sharing"),"cancel-button":(0,h.unref)(g)("Cancel"),onConfirm:w,onCancel:B[2]||(B[2]=V=>T.value=!1),onClick:B[3]||(B[3]=(0,h.withModifiers)(()=>{},["stop"]))},{default:(0,h.withCtx)(()=>[(0,h.createElementVNode)("u-text",{class:"text-toast"},(0,h.toDisplayString)((0,h.unref)(g)("Others will no longer see your screen after you stop sharing. Are you sure you want to stop?")),1)]),_:1},8,["modelValue","title","confirm-button","cancel-button"])]))}}),Gm={"local-screen-container":{"":{display:"flex",flex:1,backgroundColor:"rgba(228,232,238,0.4)",justifyContent:"center",alignItems:"center"}},"local-screen-control-container":{".local-screen-container ":{flex:1,justifyContent:"center",alignItems:"center"}},text:{".local-screen-container .local-screen-control-container ":{fontSize:16,fontStyle:"normal",fontWeight:"400",lineHeight:24,color:"#B2BBD1"}},"stop-button":{".local-screen-container .local-screen-control-container ":{display:"flex",marginTop:30,paddingTop:10,paddingRight:20,paddingBottom:10,paddingLeft:20,backgroundColor:"#E5395C",borderWidth:1.5,borderStyle:"solid",borderColor:"#E5395C",borderRadius:6}},"text-end":{".local-screen-container .local-screen-control-container .stop-button ":{color:"#FFFFFF"}},"text-toast":{"":{fontSize:14,fontStyle:"normal",fontWeight:"400",lineHeight:22,color:"#4f586b"}}},Um=Dt(Pm,[["styles",[Gm]]]),Fg="[StreamContainer]";function wm(){let f=zn(),g=qt(),T=Dn(),{t:v}=on(),{deviceManager:w}=Au(),N=ge=>{T.addRemoteUser(ge.userInfo)},B=ge=>{T.removeRemoteUser(ge.userInfo.userId)},V=ge=>{let{seatedList:pe,leftList:oe}=ge;T.updateOnSeatList(pe,oe)},H=ge=>{let{userId:pe,hasAudio:oe,reason:de}=ge;T.updateUserAudioState(pe,oe),pe===g.userId&&!oe&&de===bl.kChangedByAdmin&&(kt({type:"warning",message:v("Your microphone has been turned off"),duration:ln.NORMAL}),T.setCanControlSelfAudio(!T.isMicrophoneDisableForAllUser))},{isDefaultOpenCamera:z,isDefaultOpenMicrophone:ne}=(0,Mt.storeToRefs)(T);return(0,h.watch)(z,ge=>Oe(this,null,function*(){var pe,oe,de,ae,te,J,Le,re,Be;if(ge)if(mo||Ro)yield(pe=f.instance)==null?void 0:pe.setLocalVideoView({view:`${T.localStream.userId}_${T.localStream.streamType}`}),yield(oe=f.instance)==null?void 0:oe.openLocalCamera({isFrontCamera:g.isFrontCamera});else if(Fn){let Ye=document==null?void 0:document.getElementById(`${T.localStream.userId}_${T.localStream.streamType}`);if(!Ye){Qt.error(`${Fg}watch isDefaultOpenCamera:`,z,Ye);return}yield(de=f.instance)==null?void 0:de.setLocalVideoView({view:`${T.localStream.userId}_${T.localStream.streamType}`});let Xe=(ae=f.instance)==null?void 0:ae.getTRTCCloud();Xe==null||Xe.enableSmallVideoStream(!1,Xg),yield(te=f.instance)==null?void 0:te.openLocalCamera({isFrontCamera:g.isFrontCamera});return}else{let Ye=document==null?void 0:document.getElementById(`${T.localStream.userId}_${T.localStream.streamType}`);if(!Ye){Qt.error(`${Fg}watch isDefaultOpenCamera:`,z,Ye);return}if(!T.currentCameraId){let Xe=yield(J=w.instance)==null?void 0:J.getDevicesList({type:Yn.kMediaDeviceTypeVideoCamera});Xe&&Xe.length>0&&T.setCurrentCameraId(Xe[0].deviceId)}yield(Le=w.instance)==null?void 0:Le.setCurrentDevice({type:Yn.kMediaDeviceTypeVideoCamera,deviceId:T.currentCameraId}),yield(re=f.instance)==null?void 0:re.setLocalVideoView({view:`${T.localStream.userId}_${T.localStream.streamType}`}),yield(Be=f.instance)==null?void 0:Be.openLocalCamera()}})),(0,h.watch)(ne,ge=>Oe(this,null,function*(){var pe,oe,de,ae,te,J;if(ge){if(yield(pe=f.instance)==null?void 0:pe.unmuteLocalAudio(),g.isOpenMic||((oe=f.instance)==null||oe.openLocalMicrophone(),g.setIsOpenMic(!0)),!mo&&!Fn){let Le=yield(de=f.instance)==null?void 0:de.getMicDevicesList(),re=yield(ae=f.instance)==null?void 0:ae.getSpeakerDevicesList();if((Le==null?void 0:Le.length)===0||(re==null?void 0:re.length)===0)return;!T.currentMicrophoneId&&Le.length>0&&T.setCurrentMicrophoneId(Le[0].deviceId),!T.currentSpeakerId&&re.length>0&&T.setCurrentSpeakerId(re[0].deviceId),yield(te=f.instance)==null?void 0:te.setCurrentMicDevice({deviceId:T.currentMicrophoneId})}}else yield(J=f.instance)==null?void 0:J.muteLocalAudio()})),{onRemoteUserEnterRoom:N,onRemoteUserLeaveRoom:B,onSeatListChanged:V,onUserAudioStateChanged:H,t:v}}var Fm="[StreamContainer]",xm=(0,h.defineComponent)({__name:"index",setup(f){let{onRemoteUserEnterRoom:g,onRemoteUserLeaveRoom:T,onSeatListChanged:v,onUserAudioStateChanged:w,t:N}=wm(),B=zn(),V=(0,h.ref)(null),H=Dn(),{streamList:z,localStream:ne,remoteStreamObj:ge,userVolumeObj:pe}=(0,Mt.storeToRefs)(H),oe=qt(),de=gt=>Oe(this,null,function*(){yield(0,h.nextTick)(),oe.setLayout(gt)}),{layout:ae}=(0,Mt.storeToRefs)(oe),te=(0,h.ref)(null),J=(0,h.computed)(()=>te.value?`${te.value.userId}_${te.value.streamType}`:""),Le=(0,h.ref)(""),re=(0,h.ref)(),Be=(0,h.ref)(),Ye=(0,h.computed)(()=>z.value.filter(gt=>gt.streamType===jt.kCameraStream)),Xe=(0,h.computed)(()=>H.localUser.hasScreenStream),Ne=(0,h.ref)(0);(0,h.watch)(()=>Ye.value.length,gt=>{if(ae.value===Bn.SIX_EQUAL_POINTS){let St=te.value?Ne.value-1:Ne.value;Math.ceil(gt/6)<St+1&&St>0&&(Ne.value=Ne.value-1)}});let me=(0,h.computed)(()=>ae.value===Bn.SIX_EQUAL_POINTS?te.value?Ne.value===1:Ne.value===0:!1),A=(0,h.computed)(()=>{var gt;return Le.value?Le.value===ne.value.userId?ne.value:ge.value[`${Le.value}_${jt.kCameraStream}`]:ge.value[`${(gt=te.value)==null?void 0:gt.userId}_${jt.kCameraStream}`]}),Me=(0,h.computed)(()=>{let gt=Ye.value.length,St=gt>6?Math.ceil(gt/6):1;return te.value?St+1:St});function O(gt){return ae.value===Bn.LARGE_SMALL_WINDOW?gt===0:ae.value===Bn.SIX_EQUAL_POINTS?gt===Ne.value:!1}function ze(){return Oe(this,null,function*(){Ne.value!==0&&(Ne.value=Ne.value-1,te.value&&Ne.value===0&&(yield de(Bn.LARGE_SMALL_WINDOW)))})}function gn(){return Oe(this,null,function*(){Ne.value!==Me.value-1&&(Ne.value=Ne.value+1,ae.value===Bn.LARGE_SMALL_WINDOW&&(yield de(Bn.SIX_EQUAL_POINTS)))})}let ct=(0,h.ref)(),pt=(0,h.ref)();function dt(gt){var St,Ft;re.value=(St=gt==null?void 0:gt.changedTouches[0])==null?void 0:St.pageX,Be.value=(Ft=gt==null?void 0:gt.changedTouches[0])==null?void 0:Ft.pageY}function He(gt){let St=(gt==null?void 0:gt.changedTouches[0].pageX)-re.value,Ft=(gt==null?void 0:gt.changedTouches[0].pageY)-Be.value;Math.abs(Ft)>Math.abs(St)||Math.abs(St)<5||(St<0&&gn(),St>0&&ze())}let ee=gt=>Oe(this,null,function*(){var St,Ft;let{userId:Ve,streamType:Ct,hasVideo:Ce,reason:ba}=gt;if(H.updateUserVideoState(Ve,Ct,Ce),Ve===oe.userId&&!Ce&&ba===bl.kChangedByAdmin&&(Ct===jt.kCameraStream&&(kt({type:"warning",message:N("Your camera has been turned off"),duration:ln.NORMAL}),H.setCanControlSelfVideo(!H.isCameraDisableForAllUser)),Ct===jt.kScreenStream&&kt({type:"warning",message:N("The host has turned off your screen sharing"),duration:ln.NORMAL})),Ve!==oe.userId&&Ct===jt.kScreenStream)if(Ce){let qe=H.remoteStreamObj[`${Ve}_${Ct}`];qe&&(te.value=qe,ae.value=Bn.LARGE_SMALL_WINDOW,yield de(Bn.LARGE_SMALL_WINDOW),Ne.value=0),Ve!==oe.userId&&H.setHasOtherScreenShare(!0)}else Ve===((St=te.value)==null?void 0:St.userId)&&(Qt.debug(`${Fm} onUserVideoStateChanged: stop`,Ve,Ct),(Ft=B.instance)==null||Ft.stopPlayRemoteVideo({userId:Ve,streamType:Ct}),te.value&&(te.value=null),ae.value===Bn.LARGE_SMALL_WINDOW?(yield de(Bn.SIX_EQUAL_POINTS),Ne.value=0):ae.value===Bn.SIX_EQUAL_POINTS&&Ne.value>0&&(Ne.value=Ne.value-1)),Ve!==oe.userId&&H.setHasOtherScreenShare(!1)});function Qe(gt){if(Le.value){let Ve=gt==null?void 0:gt.find(Ct=>Ct.userId===Le.value);if(Ve&&Ve.volume>0)return}let St=0,Ft="";gt==null||gt.forEach(Ve=>{let{userId:Ct,volume:Ce}=Ve;Ce>St&&(St=Ce,Ft=Ct)}),St===0?Le.value="":Le.value=Ft}let se=Vg(Qe,1e3),Ue=gt=>{let{userVolumeList:St}=gt;ae.value===Bn.LARGE_SMALL_WINDOW&&((St==null?void 0:St.length)===0?Le.value="":se(St))},At=(0,h.ref)(null),qn=Lu("dom");(0,h.onMounted)(()=>{setTimeout(()=>{qn.getComponentRect(V.value,gt=>{At.value=gt.size})},50)});let nt=(0,h.computed)(()=>At.value?{width:`${At.value.width}px`,height:`${At.value.height}px`}:{}),Zt=(0,h.computed)(()=>{if(!At.value)return{};let gt=te.value?Math.ceil(Ye.value.length/6)+1:Math.ceil(Ye.value.length/6);return{transform:`translateX(${0-Ne.value*At.value.width}px)`,width:`${At.value.width*gt}px`,height:`${At.value.height}px`}}),wt=(0,h.ref)({flex:1}),sn=(0,h.computed)(()=>Ye.value.length>1?At.value?{width:`${Math.floor(At.value.width)/2}px`,height:`${Math.floor(At.value.width)/2}px`}:{}:Ye.value.length===1?wt.value:{}),rn=(0,h.computed)(()=>At.value?[{width:`${Math.floor(At.value.width/2)}px`,height:`${Math.floor(At.value.width/2)}px`},Ye.value.length===1?wt.value:{width:`${At.value.width}px`},{width:`${At.value.width}px`,height:`${Math.ceil(At.value.width)/2*3}px`}]:[]);return rt.once("ready",()=>{var gt,St,Ft,Ve,Ct,Ce;(gt=B.instance)==null||gt.on(it.onRemoteUserEnterRoom,g),(St=B.instance)==null||St.on(it.onRemoteUserLeaveRoom,T),(Ft=B.instance)==null||Ft.on(it.onSeatListChanged,v),(Ve=B.instance)==null||Ve.on(it.onUserVideoStateChanged,ee),(Ct=B.instance)==null||Ct.on(it.onUserAudioStateChanged,w),(Ce=B.instance)==null||Ce.on(it.onUserVoiceVolumeChanged,Ue)}),(0,h.onUnmounted)(()=>{var gt,St,Ft,Ve,Ct,Ce;(gt=B.instance)==null||gt.off(it.onRemoteUserEnterRoom,g),(St=B.instance)==null||St.off(it.onRemoteUserLeaveRoom,T),(Ft=B.instance)==null||Ft.off(it.onSeatListChanged,v),(Ve=B.instance)==null||Ve.off(it.onUserVideoStateChanged,ee),(Ct=B.instance)==null||Ct.off(it.onUserAudioStateChanged,w),(Ce=B.instance)==null||Ce.off(it.onUserVoiceVolumeChanged,Ue)}),(gt,St)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{ref_key:"streamContainerRef",ref:V,class:"stream-container",onClick:()=>{},onTouchstart:dt,onTouchend:He},[Xe.value?((0,h.openBlock)(),(0,h.createBlock)(Um,{key:0})):((0,h.openBlock)(),(0,h.createElementBlock)(h.Fragment,{key:1},[(0,h.createElementVNode)("div",{class:"stream-swiper",style:(0,h.normalizeStyle)(Zt.value)},[te.value?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"stream-container-large-small",style:(0,h.normalizeStyle)(nt.value)},[(0,h.createElementVNode)("div",{id:"enlargedStreamContainer",ref_key:"enlargedContainerRef",ref:ct,class:"enlarged-stream-container"},[te.value?((0,h.openBlock)(),(0,h.createBlock)((0,h.unref)(ap),{key:0,"enlarge-dom-id":J.value,stream:te.value,"audio-volume":(0,h.unref)(pe)[te.value.userId]||0,"style-object":wt.value,"is-play-stream":Ne.value===0,layout:(0,h.unref)(Bn).LARGE_SMALL_WINDOW},null,8,["enlarge-dom-id","stream","audio-volume","style-object","is-play-stream","layout"])):(0,h.createCommentVNode)("",!0)],512),(0,h.createElementVNode)("div",{ref_key:"streamListRef",ref:pt,class:(0,h.normalizeClass)(["stream-list",`${me.value?"":"not-first-page"}`,`${Ye.value.length>1?"":"single-stream"}`]),style:(0,h.normalizeStyle)(rn.value[0])},[(0,h.createVNode)((0,h.unref)(ap),{stream:A.value,"audio-volume":(0,h.unref)(pe)[A.value.userId]||0,"enlarge-dom-id":J.value,"style-object":sn.value,"is-play-stream":Ne.value===0,layout:(0,h.unref)(Bn).LARGE_SMALL_WINDOW,class:(0,h.normalizeClass)([Ye.value.length>1?"multi-stream":"single-stream"])},null,8,["stream","audio-volume","enlarge-dom-id","style-object","is-play-stream","layout","class"])],6)],4)):(0,h.createCommentVNode)("",!0),((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(Math.ceil(Ye.value.length/6),(Ft,Ve)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:Ve,style:(0,h.normalizeStyle)(nt.value),class:(0,h.normalizeClass)(["stream-container-flatten",[Ye.value.length>1?"multi-stream-container":"",`${me.value?"":"not-first-page"}`]])},[(0,h.createElementVNode)("div",{ref_for:!0,ref_key:"streamListRef",ref:pt,class:"stream-list",style:(0,h.normalizeStyle)(rn.value[Ft])},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(Ye.value.slice(Ve*6,Ve*6+6),Ct=>((0,h.openBlock)(),(0,h.createBlock)((0,h.unref)(ap),{key:`${Ct.userId}_${Ct.streamType}`,stream:Ct,"audio-volume":(0,h.unref)(pe)[Ct.userId]||0,"enlarge-dom-id":J.value,"style-object":sn.value,layout:(0,h.unref)(Bn).SIX_EQUAL_POINTS,"is-play-stream":te.value&&Ne.value===Ft||!te.value&&Ne.value===Ft-1},null,8,["stream","audio-volume","enlarge-dom-id","style-object","layout","is-play-stream"]))),128))],4)],6))),128))],4),Me.value>1?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"swipe"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(Me.value,(Ft,Ve)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:Ft,class:(0,h.normalizeClass)(["swipe-dots",[O(Ve)?"swipe-current-dots":""]])},null,2))),128))])):(0,h.createCommentVNode)("",!0)],64))],544))}}),qm={"stream-container":{"":{flex:1,display:"flex",position:"relative",justifyContent:"center"}},"stream-swiper":{"":{display:"flex",flexDirection:"row",flexWrap:"nowrap",justifyContent:"center",alignItems:"flex-start"}},"stream-container-large-small":{"":{display:"flex",backgroundColor:"#f2f2f2",overflow:"hidden",position:"relative"}},"enlarged-stream-container":{".stream-container-large-small ":{flex:1,display:"flex"}},"stream-list":{".stream-container-large-small ":{position:"absolute",top:0,right:0,overflow:"hidden"},".stream-container-flatten ":{display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"flex-start",flex:1}},"stream-container-flatten":{"":{backgroundColor:"#f2f2f2",overflow:"hidden",display:"flex",flexWrap:"wrap",flexDirection:"row",justifyContent:"center"},".not-first-page":{alignItems:"flex-start"},".multi-stream-container":{alignItems:"center"}},"icon-control":{"":{backgroundColor:"#FFFFFF",position:"absolute",display:"flex",justifyContent:"center",alignItems:"center"}},swipe:{"":{position:"absolute",bottom:100,display:"flex",flexDirection:"row",alignItems:"center",justifyContent:"center",left:0,right:0}},"swipe-dots":{"":{width:8,height:8,backgroundColor:"#FFFFFF",opacity:.6,borderRadius:20,marginTop:5,marginRight:5,marginBottom:5,marginLeft:5}},"swipe-current-dots":{"":{width:8,height:8,backgroundColor:"#FFFFFF",opacity:1,borderRadius:20,marginTop:5,marginRight:5,marginBottom:5,marginLeft:5}}},Vm=Dt(xm,[["styles",[qm]]]),Bm=(0,h.defineComponent)({__name:"index",setup(f){return(g,T)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{class:"content-container"},[(0,h.createVNode)(Vm)]))}}),Hm={"content-container":{"":{display:"flex",flex:1}}},Km=Dt(Bm,[["styles",[Hm]]]),Wm="/assets/CloseIcon.647fec61.svg",jm=(0,h.defineComponent)({__name:"index",setup(f){let{t:g}=on(),T=qt(),{showSettingDialog:v,activeSettingTab:w}=(0,Mt.storeToRefs)(T),N=(0,h.computed)(()=>[{label:g("Audio settings"),value:"audio"},{label:g("Camera settings"),value:"video"}]);function B(z){T.setActiveSettingTab(z)}function V(){T.setShowSettingDialog(!1)}function H(z){z.target===z.currentTarget&&V()}return(z,ne)=>(0,h.unref)(v)?((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:0,class:"overlay-container overlay",onClick:H},[(0,h.createElementVNode)("div",{class:"setting-container"},[(0,h.createElementVNode)("div",{class:"setting-header"},[(0,h.createElementVNode)("span",{class:"setting-title"},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)((0,h.unref)(g)("Settings")),1)]),(0,h.createVNode)(Sn,{style:{display:"flex"},class:"close-icon",icon:(0,h.unref)(Wm),onClick:V},null,8,["icon"])]),(0,h.createElementVNode)("div",{class:"setting-body"},[(0,h.createElementVNode)("div",{class:"setting-tabs"},[((0,h.openBlock)(!0),(0,h.createElementBlock)(h.Fragment,null,(0,h.renderList)(N.value,(ge,pe)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{key:pe,class:(0,h.normalizeClass)(["tabs-title",`${(0,h.unref)(w)===ge.value?"active":""}`]),onClick:oe=>B(ge.value)},[(0,h.createElementVNode)("u-text",null,(0,h.toDisplayString)(ge.label),1)],10,["onClick"]))),128))]),(0,h.createElementVNode)("div",{class:"divide-line"}),(0,h.createElementVNode)("div",{class:"setting-content"},[(0,h.unref)(w)==="audio"?((0,h.openBlock)(),(0,h.createBlock)(th,{key:0,class:"setting-tab",mode:(0,h.unref)(Yr).DETAIL,theme:"white"},null,8,["mode"])):(0,h.unref)(w)==="video"?((0,h.openBlock)(),(0,h.createBlock)(ah,{key:1,class:"setting-tab","with-preview":!0,theme:"white"})):(0,h.createCommentVNode)("",!0)])])])])):(0,h.createCommentVNode)("",!0)}}),Ym={"overlay-container":{"":{position:"fixed",top:0,bottom:0,left:0,right:0,zIndex:2007},".overlay":{backgroundColor:"rgba(15,16,20,0.6)"}},"setting-container":{"":{width:610,height:590,position:"absolute",top:50,left:50,transform:"translate(-50%, -50%)",display:"flex",backgroundColor:"#ffffff",borderRadius:20,flexDirection:"column"}},"setting-header":{".setting-container ":{height:64,borderBottomWidth:1,borderBottomStyle:"solid",borderBottomColor:"#ebf0f7",boxShadow:"0px 7px 10px -5px rgba(230, 236, 245, 0.8)",display:"flex",flexDirection:"row",justifyContent:"space-between",position:"relative"}},"close-icon":{".setting-container .setting-header ":{width:32,height:32,position:"absolute",top:50,transform:"translateY(-50%)",right:20,display:"flex",justifyContent:"center",alignItems:"center",color:"#4f586b"}},"setting-title":{".setting-container .setting-header ":{fontWeight:"600",lineHeight:24,color:"#000000",paddingTop:20,paddingRight:0,paddingBottom:20,paddingLeft:24,fontSize:16,fontStyle:"normal"}},"setting-body":{".setting-container ":{height:100,display:"flex"}},"setting-tabs":{".setting-container .setting-body ":{width:170,backgroundColor:"#f0f3fa",paddingTop:7,borderBottomLeftRadius:10}},"tabs-title":{".setting-container .setting-body .setting-tabs ":{width:100,height:36,paddingLeft:32,fontWeight:"400",fontSize:14,color:"#4f586b",lineHeight:36,position:"relative"},".setting-container .setting-body .setting-tabs .active":{backgroundColor:"#1c66e5",color:"#ffffff",fontWeight:"400"}},"divide-line":{".setting-container .setting-body ":{width:1,height:100,backgroundColor:"#dcdcdc"}},"setting-content":{".setting-container .setting-body ":{paddingTop:16,paddingRight:30,paddingBottom:16,paddingLeft:30}},"setting-tab":{".setting-container .setting-body .setting-content ":{width:100}}},zm=Dt(jm,[["styles",[Ym]]]),Jm=(0,h.defineComponent)({__name:"conference",emits:["on-log-out","on-create-room","on-enter-room","on-exit-room","on-destroy-room","on-kicked-out-of-room","on-kicked-off-line","on-userSig-expired"],setup(f,{expose:g,emit:T}){Au({listenForDeviceChange:!0});let{t:v}=yt,w=(0,h.ref)(0),N=(0,h.ref)(0);g({init:me,createRoom:A,enterRoom:Me,dismissRoom:Xe,leaveRoom:Ne,resetStore:O,t:v});let B=T,V=Ue=>{let{message:At,showCancel:qn,title:nt=yt.t("Note"),confirmButtonText:Zt=yt.t("Sure"),appendToRoomContainer:wt=!0,callback:sn=()=>{}}=Ue;tc({title:nt,message:At,showCancel:qn,confirmButtonText:Zt,appendToRoomContainer:wt,callback:()=>Oe(this,null,function*(){sn&&sn()})})},H=Ue=>{let{type:At,message:qn,duration:nt}=Ue;kt({type:At,message:qn,duration:nt})};(0,h.onMounted)(()=>{let{windowHeight:Ue,statusBarHeight:At}=uni.getSystemInfoSync();w.value=Ue,N.value=At,yt.setComponentConfig({InviteControl:{visible:!1}}),yt.on(Nt.ROOM_NOTICE_MESSAGE,H),yt.on(Nt.ROOM_NOTICE_MESSAGE_BOX,V),yt.on(Nt.KICKED_OUT,ee),yt.on(Nt.USER_SIG_EXPIRED,Qe),yt.on(Nt.KICKED_OFFLINE,se),yt.on(Nt.ROOM_START,gn),yt.on(Nt.ROOM_JOIN,ct),yt.on(Nt.ROOM_LEAVE,pt),yt.on(Nt.ROOM_DISMISS,dt),yt.on(Nt.USER_LOGOUT,He)}),(0,h.onUnmounted)(()=>{yt.off(Nt.ROOM_NOTICE_MESSAGE,H),yt.off(Nt.ROOM_NOTICE_MESSAGE_BOX,V),yt.off(Nt.KICKED_OUT,ee),yt.off(Nt.USER_SIG_EXPIRED,Qe),yt.off(Nt.KICKED_OFFLINE,se),yt.off(Nt.ROOM_START,gn),yt.off(Nt.ROOM_JOIN,ct),yt.off(Nt.ROOM_LEAVE,pt),yt.off(Nt.ROOM_DISMISS,dt),yt.off(Nt.USER_LOGOUT,He),yt.resetStore(),Fl.destroyInstance()});let{sdkAppId:z}=yt.basicStore;(0,h.watch)(()=>z,Ue=>{Ue&&(ec.setSdkAppId(Ue),ec.reportEvent({name:"loaded",ext1:"loaded-success"}))});let ne=(0,h.ref)(),ge=(0,h.ref)(!0),pe=(0,h.ref)();function oe(){ge.value=!1}(0,h.provide)("showRoomTool",ge),(0,h.watch)(()=>pe.value,(Ue,At)=>{!mo&&!Fn&&(Ue?re(Ue):At&&Be(At))});let de=Dh(oe,5e3),ae=Vg(de,1e3),te=()=>{ge.value=!0,de()},J=()=>{ge.value=!0,ae()},Le=()=>{oe()},re=Ue=>{Ue.addEventListener("mouseenter",te),Ue.addEventListener("click",te),Ue.addEventListener("mousemove",J),Ue.addEventListener("mouseleave",Le)},Be=Ue=>{Ue.removeEventListener("mouseenter",te),Ue.removeEventListener("click",te),Ue.removeEventListener("mousemove",J),Ue.removeEventListener("mouseleave",Le)};function Ye(){ge.value=!ge.value,ge.value&&de()}function Xe(){return Oe(this,null,function*(){yield yt.dismissRoom()})}function Ne(){return Oe(this,null,function*(){yield yt.leaveRoom(),B("on-exit-room")})}function me(Ue){return Oe(this,null,function*(){yield yt.initRoomKit(Ue)})}function A(Ue){return Oe(this,null,function*(){yield yt.createRoom(Ue),B("on-create-room",{code:0,message:"create room success"}),yield yt.enterRoom(Ue),B("on-enter-room",{code:0,message:"enter room success"})})}function Me(Ue){return Oe(this,null,function*(){yield yt.enterRoom(Ue),B("on-enter-room",{code:0,message:"enter room success"})})}function O(){yt.resetStore()}let ze=()=>{yt.logOut()},gn=()=>{B("on-create-room",{code:0,message:"create room"})},ct=()=>{B("on-enter-room",{code:0,message:"enter room"})},pt=()=>{B("on-exit-room",{code:0,message:"exit room"})},dt=()=>{B("on-destroy-room",{code:0,message:"destroy room"})},He=()=>{B("on-log-out",{code:0,message:"user logout"})},ee=Ue=>Oe(this,null,function*(){let{roomId:At,reason:qn,message:nt}=Ue;B("on-kicked-out-of-room",{roomId:At,reason:qn,message:nt})}),Qe=()=>{B("on-userSig-expired")},se=Ue=>{let{message:At}=Ue;B("on-kicked-off-line",{message:At})};return(Ue,At)=>((0,h.openBlock)(),(0,h.createElementBlock)("div",{id:"roomContainer",ref_key:"roomRef",ref:pe,class:"tui-room",style:(0,h.normalizeStyle)({height:w.value+"px",marginTop:N.value+"px"})},[(0,h.createVNode)(Km,{ref_key:"roomContentRef",ref:ne,class:"content",onClick:Ye},null,512),(0,h.createVNode)(q_,{class:"header",onLogOut:ze,onOnDestroyRoom:Ue.onDestroyRoom,onOnExitRoom:Ue.onExitRoom,onTouchmove:(0,h.withModifiers)(()=>{},["stop","prevent"])},null,8,["onOnDestroyRoom","onOnExitRoom"]),(0,h.createVNode)(cm,{onOnDestroyRoom:Ue.onDestroyRoom,onOnExitRoom:Ue.onExitRoom,onTouchmove:(0,h.withModifiers)(()=>{},["stop","prevent"])},null,8,["onOnDestroyRoom","onOnExitRoom"]),(0,h.createVNode)(Rm),(0,h.createVNode)(zm)],4))}}),$m={"tui-room":{"":{position:"relative",display:"flex",flex:1,flexDirection:"column",overflow:"hidden",color:"#FFFFFF",backgroundColor:"#FFFFFF"}}},Xm=Dt(Jm,[["styles",[$m]]]),Su=function(f){switch(typeof f){case"string":return f;case"boolean":return f?"true":"false";case"number":return isFinite(f)?f:"";default:return""}};function Qm(f,g="&",T="=",v){return f===null&&(f=void 0),typeof f=="object"?Object.keys(f).map(w=>{let N=Su(w)+T;return Array.isArray(f[w])?f[w].map(B=>N+Su(B)).join(g):N+Su(f[w])}).filter(Boolean).join(g):v?Su(v)+T+Su(f):""}function Dp(f){if(typeof f=="string")return f;let{path:g,query:T}=f,v=Qm(T);return v?`${g}?${v}`:g}function Ep(f){let g=f||{},T=g.route;return{page:`/${T}`,params:{},query:g.query,hash:"",fullPath:Dp({path:`/${T}`,query:g.query}),name:T&&T.replace(/\/(\w)/g,(v,w)=>w.toUpperCase())}}uni.onAppRoute&&uni.onAppRoute(()=>{let f=getCurrentPages(),g=f[f.length-1];Up.setRoute(Ep(g))});var Rp=class{constructor(){this.route={}}setRoute(g){this.route=g}static useRoute(){return Up.route}},Up=new Rp,Lp=class{push(g,T,v,w){let B={url:Dp(g),complete:T,fail:v,success:w};g!=null&&g.isTab&&uni.switchTab(B),g!=null&&g.reLaunch&&uni.reLaunch(B),uni.navigateTo(B)}replace(g,T,v,w){let B={url:Dp(g),complete:T,fail:v,success:w};Up.setRoute(Ep(g)),uni.setStorageSync("routeInfo",Ep(g)),uni.redirectTo(B)}go(g){uni.navigateBack(g)}back(){uni.navigateBack()}},Zm=new Lp,sp=Zm,ro=(f=>(f.ROOM_START="RoomStart",f.ROOM_JOIN="RoomJoin",f.ROOM_LEAVE="RoomLeave",f.ROOM_DISMISS="RoomDestroy",f.ROOM_ERROR="RoomError",f.KICKED_OUT="KickedOut",f.KICKED_OFFLINE="KickedOffline",f.USER_SIG_EXPIRED="UserSigExpired",f.USER_LOGOUT="UserLogout",f))(ro||{}),kp=class{login(g){return yt.initRoomKit(g)}logout(){return Oe(this,null,function*(){return yt.logOut()})}getRoomEngine(){return yt.roomEngine.instance||Qt.warn("getRoomEngine failed, roomEngine is not exist"),yt.roomEngine.instance}on(g,T){yt.on(g,T)}off(g,T){yt.off(g,T)}start(g,T){return Oe(this,null,function*(){return yield yt.start(g,T)})}join(g,T){return Oe(this,null,function*(){return yield yt.join(g,T)})}leave(){return Oe(this,null,function*(){return yield yt.leaveRoom()})}dismiss(){return Oe(this,null,function*(){return yield yt.dismissRoom()})}setSelfInfo(g){return yt.setSelfInfo(g)}},to=new kp,ev=(0,h.defineComponent)({__name:"room",setup(f){let{t:g}=on(),T=uni.getStorageSync("tuiRoom-roomInfo"),v=uni.getStorageSync("tuiRoom-userInfo"),w=uni.getStorageSync("routeInfo"),N=String(w.query.roomId)?w.query.roomId:"";N?T||sp.push({path:"home",query:{roomId:N}}):sp.push({path:"home"}),(0,h.onMounted)(()=>Oe(this,null,function*(){let{action:ne,roomMode:ge,isSeatEnabled:pe,roomParam:oe,hasCreated:de}=JSON.parse(T),{sdkAppId:ae,userId:te,userSig:J,userName:Le,avatarUrl:re}=JSON.parse(v);try{if(yield to.login({sdkAppId:ae,userId:te,userSig:J}),yield to.setSelfInfo({userName:Le,avatarUrl:re}),ne==="createRoom"&&!de){yield to.start(N,Xd({roomName:`${Le||te}${g("Quick Conference")}`,isSeatEnabled:pe},oe));let Be={action:ne,roomId:N,roomName:N,roomMode:ge,roomParam:oe,hasCreated:!0};uni.setStorageSync("tuiRoom-roomInfo",JSON.stringify(Be))}else yield to.join(N,oe)}catch(Be){uni.removeStorageSync("tuiRoom-currentUserInfo")}}));let B=(ne,ge)=>{uni.removeStorageSync("tuiRoom-roomInfo"),ge&&sessionStorage.removeItem("tuiRoom-currentUserInfo"),z(ne)},V=()=>B("home",!1),H=()=>B("home",!0);to.on(ro.ROOM_DISMISS,V),to.on(ro.ROOM_LEAVE,V),to.on(ro.KICKED_OUT,V),to.on(ro.ROOM_ERROR,V),to.on(ro.KICKED_OFFLINE,V),to.on(ro.USER_SIG_EXPIRED,H),to.on(ro.USER_LOGOUT,H),(0,h.onUnmounted)(()=>{to.off(ro.ROOM_DISMISS,V),to.off(ro.ROOM_LEAVE,V),to.off(ro.KICKED_OUT,V),to.off(ro.ROOM_ERROR,V),to.off(ro.KICKED_OFFLINE,V),to.off(ro.USER_SIG_EXPIRED,H),to.off(ro.USER_LOGOUT,H)});let z=ne=>{sp.replace({path:ne})};return(ne,ge)=>((0,h.openBlock)(),(0,h.createElementBlock)("scroll-view",{scrollY:!0,showScrollbar:!0,enableBackToTop:!0,bubble:"true",style:{flexDirection:"column"}},[(0,h.createVNode)(Xm,{"display-mode":"permanent"})]))}}),tv={"room-container":{"":{display:"flex",flex:1}}},Kl=Dt(ev,[["styles",[tv]]]);var wp=plus.webview.currentWebview();if(wp){let f=parseInt(wp.id),g="src/roomkit/pages/room",T={};try{T=JSON.parse(wp.__query__)}catch(w){}Kl.mpType="page";let v=Vue.createPageApp(Kl,{$store:getApp({allowDefault:!0}).$store,__pageId:f,__pagePath:g,__pageQuery:T});v.provide("__globalStyles",Vue.useCssStyles([...__uniConfig.styles,...Kl.styles||[]])),v.mount("#root")}})();
